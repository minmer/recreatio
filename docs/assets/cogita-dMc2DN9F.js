import{r as i,j as e,R as fr,B as xr,C as yr,H as Lr,P as Cr,a as Rt,b as ui,c as gi,u as Or,d as Vr,e as vr,f as hi}from"./vendor-DrCXrCXJ.js";import{L as qr,A as _r,g as Ur,a as bi,b as jt,c as Wr,s as $t,d as zr,e as Hr,f as Ua,h as hr,i as Et,j as br,k as mi,l as tr,m as Za,u as pi,n as da,o as fi,p as xi,q as yi,r as Jr,t as Yr,v as vi,w as ji,x as wi,y as Wt,z as At,B as ki,C as Ti,D as Ni,E as Li,F as Ci,G as Mi,H as Wa,I as Si,J as Ii,K as Pi,M as Ri,N as $i,O as Ei,P as Ai,Q as Fi,R as Bi,S as Di,T as Ki,U as Oi,V as Vi,W as qi,X as _i,Y as Ui,Z as Mr}from"./recreatio-core-Bh2y2_Tf.js";import"./vendor-cogita-ui-DLgJCpO3.js";const vt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},yt={moveMs:900,pauseMs:220,errorMs:900},Wi=(a=11)=>{let n=a;const o=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:u,height:g,paddingX:w,paddingY:p,levels:I}=vt,M=(g-p*2)/(I.length-1),E=[],l=[],C=[];I.forEach((b,f)=>{const Q=g-p-f*M,A=u-w*2,j=[];for(let G=0;G<b;G+=1){const P=w+(G+1)*A/(b+1),ne=(o()-.5)*18,K=Math.max(w,Math.min(u-w,P+ne)),O=f===0?3:f<2?2.1:1.4,ge=f===0?"root":`l${f}-${G}`;j.push({id:ge,x:f===0?u/2:K,y:Q,r:O,level:f,role:f===0?"root":void 0})}C.push(j),E.push(...j)});const m=C[C.length-1];if(m!=null&&m.length){const b=m[Math.floor(m.length/2)];b.role="goal",b.r=2}for(let b=1;b<C.length;b+=1){const f=C[b-1];C[b].forEach(A=>{const j=[...f].sort((K,O)=>Math.abs(K.x-A.x)-Math.abs(O.x-A.x)),G=j[0],P=j[1]&&o()<.45?j[1]:null;(P?[G,P]:[G]).forEach(K=>{l.push({from:K.id,to:A.id,key:`${K.id}-${A.id}`})}),o()<.2&&j[2]&&l.push({from:j[2].id,to:A.id,key:`${j[2].id}-${A.id}`})})}const x=new Map;l.forEach(b=>{const f=x.get(b.to)??[];f.push(b.from),x.set(b.to,f)});const V=new Map,J=new Map,q=new Map;l.forEach(b=>{const f=V.get(b.from)??[];f.push(b.key),V.set(b.from,f);const Q=J.get(b.from)??[];Q.push(b.to),J.set(b.from,Q);const A=q.get(b.from)??[];A.push(b.to),q.set(b.from,A);const j=q.get(b.to)??[];j.push(b.from),q.set(b.to,j)});const s=new Map;return E.forEach(b=>{s.set(b.id,b)}),{nodes:E,links:l,parentsById:x,linksByFrom:V,childrenByFrom:J,neighborsById:q,nodesById:s}};function zi({slides:a,activeIndex:n,introOpen:o,prefersReducedMotion:u,onNext:g,onPrev:w,onSelect:p,onExit:I,onOpen:M,onRegister:E}){const l=n===a.length-1,C=o&&n===0?"entry":"docked",m=a[a.length-1],[x,V]=i.useState(!1),J=i.useMemo(()=>Array.from({length:20},(v,k)=>({src:`/cogita/logo/Cogita${String(k).padStart(2,"0")}.png`,kind:k<=11?"bubble":k<=17?"text":"recreatio"})),[]),q=o&&n===0;i.useEffect(()=>{if(!o){V(!1);return}n>0&&!x&&V(!0)},[n,o,x]);const s=i.useRef(0),b=i.useRef(null),f=i.useMemo(()=>{const v={x:40,y:160},k={x:260,y:48},Y=6,t=k.x-v.x,r=v.y-k.y,h=t/Y,T=[.3,.45,.6,.65,1.4,2.2],D=T.reduce((se,we)=>se+we,0),Z=T.map(se=>r*se/D),te=[v];let ae=v.x,de=v.y;for(let se=1;se<=Y;se+=1){const we=(Math.random()-.5)*14,aa=(Math.random()-.5)*28;ae=Math.max(v.x+se*14,Math.min(k.x-(Y-se)*14,ae+h+we));const Ge=Z[se-1]??Z[Z.length-1];de=de-Ge+aa;const Ze=Math.max(k.y,Math.min(v.y-4,de));te.push({x:Math.round(ae),y:Math.round(Ze)})}return te[te.length-1]=k,te},[]),Q=i.useMemo(()=>{const r=(D,Z,te)=>Math.min(te,Math.max(Z,D)),h=f.map(D=>{const Z=10+Math.random()*36;return{x:r(D.x,40,260),y:r(D.y-Z,40,140)}}),T=f.map((D,Z)=>{var de;const te=12+Math.random()*40,ae=((de=h[Z])==null?void 0:de.y)??D.y;return{x:r(D.x,40,260),y:r(Math.max(ae+10,D.y+te),60,170)}});return{upper:h,lower:T}},[f]),A=i.useMemo(()=>{var k;const v=((k=f[4])==null?void 0:k.x)??260;return Math.max(0,Math.min(240,v-40))},[f]),j=i.useMemo(()=>{var Z,te;const v=(ae,de,se)=>Math.min(se,Math.max(de,ae)),k=(ae,de,se)=>f.map((we,aa)=>{var Pa,oa;const Ge=((Pa=Q.upper[aa])==null?void 0:Pa.y)??we.y,Ze=((oa=Q.lower[aa])==null?void 0:oa.y)??we.y,Fe=(Math.random()-.5)*70,He=we.y+ae+Fe,_e=v(we.y+de,Ge+6,Ze-6),ea=v(we.y+se,Ge+6,Ze-6);return{x:we.x,y:v(He,Math.min(_e,ea),Math.max(_e,ea))}}),Y=-14+Math.random()*28,t=14+Math.random()*28,r=k(Y,-80,12),h=k(t,-12,80);for(let ae=4;ae<f.length;ae+=1){const de=f[ae],se=((Z=Q.upper[ae])==null?void 0:Z.y)??de.y,we=((te=Q.lower[ae])==null?void 0:te.y)??de.y;r[ae]={x:de.x,y:v(de.y-12,se+6,we-6)},h[ae]={x:de.x,y:v(de.y+12,se+6,we-6)}}const T=Q.upper.length?Q.upper[Q.upper.length-1].y:40,D=Q.lower.length?Q.lower[Q.lower.length-1].y:170;return r[r.length-1]={x:f[f.length-1].x,y:v(f[f.length-1].y-14,T,D)},h[h.length-1]={x:f[f.length-1].x,y:v(f[f.length-1].y+12,T,D)},{higher:r,lower:h}},[f,Q]),G=1e4,P=i.useMemo(()=>{let v=17;const k=()=>(v=(v*1664525+1013904223)%4294967296,v/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const h=(k()-.5)*240,T=(k()-.5)*180,D=(k()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${h.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${D.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),ne=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[K,O]=i.useState([]),ge=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),pe=i.useMemo(()=>{const k=[],t=(h,T)=>h+Math.random()*(T-h);for(let h=0;h<6;h+=1){let T=!1;for(let D=0;D<80;D+=1){const Z=t(14,86),te=t(10,34);if(k.every(de=>{const se=de.x-Z,we=de.y-te;return Math.hypot(se,we)>=12})){k.push({x:Z,y:te}),T=!0;break}}T||k.push({x:t(16,84),y:t(12,32)})}return k.map((h,T)=>({id:`p${T+1}`,x:`${h.x.toFixed(1)}%`,y:`${h.y.toFixed(1)}%`,xNum:h.x,yNum:h.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ve,F]=i.useState(0),[ce,c]=i.useState(0),[ie,re]=i.useState([]),B=1e4,Me=i.useMemo(()=>{if(pe.length<2)return[];const v=T=>{let D=T+1831565813;return D=Math.imul(D^D>>>15,D|1),D^=D+Math.imul(D^D>>>7,D|61),((D^D>>>14)>>>0)/4294967296},k=(T,D)=>Math.floor(v(T)*D),Y=new Set,t=[],r=Math.min(3,pe.length);let h=0;for(;t.length<r&&h<30;){h+=1;const T=k(ve*13+h*5,pe.length),D=k(ve*29+h*7,pe.length);if(T===D)continue;const Z=T<D?`${T}-${D}`:`${D}-${T}`;Y.has(Z)||(Y.add(Z),t.push({id:`link-${Z}`,from:pe[T],to:pe[D],delay:`${(h*.35).toFixed(2)}s`}))}return t},[ve,pe]);i.useEffect(()=>{if(!o||n!==2)return;const v=()=>{const Y=P.map(t=>t.id);for(let t=Y.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[Y[t],Y[r]]=[Y[r],Y[t]]}return Y.slice(0,4)};O(v());const k=window.setInterval(()=>{O(v())},G);return()=>window.clearInterval(k)},[n,o,P,G]),i.useEffect(()=>{if(!o||n!==3)return;const v=()=>{c(Math.floor(Math.random()*ge.length)),re(pe.map(()=>Math.random()<.6?"good":"bad")),F(Y=>Y+1)};v();const k=window.setInterval(v,B);return()=>window.clearInterval(k)},[n,o,ge.length,pe,B]);const oe=i.useMemo(()=>Wi(11),[]),[le,ke]=i.useState(new Set(["root"])),[Te,Ne]=i.useState(new Set),[Be,Se]=i.useState(new Set),[Qe,Ve]=i.useState({fromId:"root",toId:"root",key:0}),Ee=i.useRef(le),ze=i.useRef("root"),sa=i.useRef(0),Re=i.useRef(null),W=i.useRef(null),ee=i.useRef([]);i.useEffect(()=>{Ee.current=le},[le]);const Ke=i.useMemo(()=>{const v=new Set;return le.forEach(k=>{const Y=oe.linksByFrom.get(k);Y&&Y.forEach(t=>v.add(t))}),v},[le,oe]),Le=oe.nodesById.get(Qe.toId)??oe.nodesById.get("root"),fe=Le?`${Le.x/vt.width*100}%`:"50%",$e=Le?`${Le.y/vt.height*100}%`:"90%";i.useEffect(()=>{if(!o||n!==1||u)return;(()=>{ke(new Set(["root"])),Ne(new Set),Se(new Set),Ve({fromId:"root",toId:"root",key:0}),W.current=null,sa.current=0,ze.current="root",ee.current=[]})();const k=()=>{const t=ze.current,r=Ee.current,T=(oe.childrenByFrom.get(t)??[]).filter(we=>!r.has(we));if(T.length)return T[Math.floor(Math.random()*T.length)];if(r.size>=oe.nodes.length){const we=oe.neighborsById.get(t)??[];return we.length?we[Math.floor(Math.random()*we.length)]:null}const D=we=>(oe.childrenByFrom.get(we)??[]).some(Ge=>!r.has(Ge)),Z=[t],te=new Set([t]),ae=new Map;let de=null;for(;Z.length;){const we=Z.shift();if(!we)break;if(we!==t&&D(we)){de=we;break}(oe.neighborsById.get(we)??[]).forEach(Ge=>{te.has(Ge)||(te.add(Ge),ae.set(Ge,we),Z.push(Ge))})}if(!de)return null;let se=de;for(;ae.get(se)&&ae.get(se)!==t;)se=ae.get(se)??se;return se},Y=(t,r)=>{if(t===r){const h=k();h&&Y(t,h);return}sa.current+=1,Ve({fromId:t,toId:r,key:sa.current}),ze.current=r,Re.current=window.setTimeout(()=>{const h=oe.parentsById.get(r)??[],T=Ee.current,D=h.filter(de=>!T.has(de));if(!D.length){const de=new Set(T);de.add(r),ke(de),Re.current=window.setTimeout(()=>{for(;ee.current.length;){const we=ee.current[ee.current.length-1];if(!de.has(we)){if(we!==r){Y(r,we);return}break}ee.current.pop()}const se=k();se&&Y(r,se)},yt.pauseMs);return}const Z=new Set([r,...D]),te=new Set(D.map(de=>`${de}-${r}`));Ne(Z),Se(te),ee.current.includes(r)||ee.current.push(r);const ae=D[Math.floor(Math.random()*D.length)];W.current={fromId:r,toId:ae},Re.current=window.setTimeout(()=>{Ne(new Set),Se(new Set);const de=W.current;de&&Y(de.fromId,de.toId)},yt.errorMs)},yt.moveMs)};return Re.current=window.setTimeout(()=>{const t=k();t&&Y(ze.current,t)},yt.pauseMs),()=>{Re.current&&window.clearTimeout(Re.current)}},[n,o,oe,u]);const qe=v=>{if(!o)return;const k=Date.now();k-s.current<520||Math.abs(v.deltaY)<10||(s.current=k,v.deltaY>0?g():w(),v.preventDefault())},Ae=v=>{if(!o)return;const k=v.touches[0];k&&(b.current={x:k.clientX,y:k.clientY})},Oe=v=>{if(!o)return;const k=b.current;if(b.current=null,!k)return;const Y=v.changedTouches[0];if(!Y)return;const t=Y.clientX-k.x,r=Y.clientY-k.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?g():w())};return e.jsxs("div",{className:`cogita-intro ${o?"is-open":"is-closed"} ${u?"is-reduced":""} ${l?"is-final":""}`,"data-slide":n+1,onWheel:qe,onTouchStart:Ae,onTouchEnd:Oe,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":C,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${q&&!x?"is-entry":""}`,children:J.map((v,k)=>e.jsx("img",{src:v.src,alt:"",className:`cogita-logo-layer ${k===0?"is-base":""} ${v.kind==="text"?"is-text":v.kind==="recreatio"?"is-recreatio":""} ${v.kind==="bubble"?"is-bubble":""}`},v.src))})}),o&&a.map((v,k)=>{const Y=k===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${k+1} ${Y?"is-active":""}`,"aria-hidden":!Y,children:[e.jsxs("div",{className:"cogita-intro-text",children:[v.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:v.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:v.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:v.title}),v.body&&e.jsx("p",{children:v.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),v.micro&&e.jsx("p",{className:"cogita-intro-micro",children:v.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:l?E:g,children:v.cta}),l&&v.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>p(0),children:v.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[k===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${vt.width} ${vt.height}`,preserveAspectRatio:"none",children:[oe.links.map(t=>{const r=oe.nodesById.get(t.from),h=oe.nodesById.get(t.to);if(!r||!h)return null;const T=Ke.has(t.key),D=Be.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${D?"is-error":""}`,x1:r.x,y1:r.y,x2:h.x,y2:h.y},t.key)}),oe.nodes.map(t=>{const r=le.has(t.id),h=Te.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${h?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Le&&e.jsx("span",{className:"map-explorer-dot",style:{left:fe,top:$e,"--move":`${yt.moveMs}ms`}})]}),k===2&&e.jsx("div",{className:"cogita-index-cards",children:P.map(t=>{const r=K.indexOf(t.id),h=r>=0?ne[r]:null,T=(h==null?void 0:h.x)??"140px",D=(h==null?void 0:h.y)??"140px",Z=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":D,"--stack-opacity":Z,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),k===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ge.map((t,r)=>e.jsxs("div",{className:`round-card ${r===ce?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),ge[ce]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ge[ce].x,"--card-y":`calc(${ge[ce].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:pe.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Me.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:pe.map((t,r)=>{const h=ie[r]??"good",T=ge[ce];if(!T)return null;const D=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":D,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${h}`,style:{"--from-x":T.x,"--from-y":D,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${h}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${ve}`)})})]},`round-${ve}`),k===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${f[0].x} ${f[0].y} L${f[1].x} ${f[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${f[1].x} ${f[1].y} L${f[2].x} ${f[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${f[2].x} ${f[2].y} L${f[3].x} ${f[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${f[3].x} ${f[3].y} L${f[4].x} ${f[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${f[4].x} ${f[4].y} L${f[5].x} ${f[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${f[5].x} ${f[5].y} L${f[6].x} ${f[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${A};${A};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${Q.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${Q.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${Q.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${Q.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[j.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${j.higher[r+1].x} ${j.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),j.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${j.lower[r+1].x} ${j.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${f[0].x/300*100}%`,"--p0y":`${f[0].y/200*100}%`,"--p1x":`${f[1].x/300*100}%`,"--p1y":`${f[1].y/200*100}%`,"--p2x":`${f[2].x/300*100}%`,"--p2y":`${f[2].y/200*100}%`,"--p3x":`${f[3].x/300*100}%`,"--p3y":`${f[3].y/200*100}%`,"--p4x":`${f[4].x/300*100}%`,"--p4y":`${f[4].y/200*100}%`,"--p5x":`${f[5].x/300*100}%`,"--p5y":`${f[5].y/200*100}%`,"--p6x":`${f[6].x/300*100}%`,"--p6y":`${f[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${j.higher[0].x/300*100}%`,"--q0y":`${j.higher[0].y/200*100}%`,"--q1x":`${j.higher[1].x/300*100}%`,"--q1y":`${j.higher[1].y/200*100}%`,"--q2x":`${j.higher[2].x/300*100}%`,"--q2y":`${j.higher[2].y/200*100}%`,"--q3x":`${j.higher[3].x/300*100}%`,"--q3y":`${j.higher[3].y/200*100}%`,"--q4x":`${j.higher[4].x/300*100}%`,"--q4y":`${j.higher[4].y/200*100}%`,"--q5x":`${j.higher[5].x/300*100}%`,"--q5y":`${j.higher[5].y/200*100}%`,"--q6x":`${j.higher[6].x/300*100}%`,"--q6y":`${j.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${j.lower[0].x/300*100}%`,"--q0y":`${j.lower[0].y/200*100}%`,"--q1x":`${j.lower[1].x/300*100}%`,"--q1y":`${j.lower[1].y/200*100}%`,"--q2x":`${j.lower[2].x/300*100}%`,"--q2y":`${j.lower[2].y/200*100}%`,"--q3x":`${j.lower[3].x/300*100}%`,"--q3y":`${j.lower[3].y/200*100}%`,"--q4x":`${j.lower[4].x/300*100}%`,"--q4y":`${j.lower[4].y/200*100}%`,"--q5x":`${j.lower[5].x/300*100}%`,"--q5y":`${j.lower[5].y/200*100}%`,"--q6x":`${j.lower[6].x/300*100}%`,"--q6y":`${j.lower[6].y/200*100}%`}})]})})}),k===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),k===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},v.id)}),!o&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:m.title}),m.body&&e.jsx("p",{children:m.body}),m.micro&&e.jsx("p",{className:"cogita-intro-micro",children:m.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:E,children:m.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:M,children:"Otwórz pokaz"})]})]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((v,k)=>e.jsx("button",{type:"button",className:`dot ${n===k?"active":""}`,"aria-label":v.title,onClick:()=>p(k)},v.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:I,children:"Pomiń"})]})]})}const Hi=6,Ji=4;function Yi({copy:a,onAuthAction:n,authLabel:o,showProfileMenu:u,onProfileNavigate:g,onToggleSecureMode:w,onLogout:p,secureMode:I,onNavigate:M,language:E,onLanguageChange:l}){const C=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}M("home")},m=i.useRef(null),x=i.useRef([]),V=i.useMemo(()=>{let re=Date.now()%2147483647;const B=()=>(re=re*48271%2147483647,re/2147483647);return Array.from({length:Hi},(Me,oe)=>{const le=6+B()*8,ke=7+B()*10,Te=6+B()*9,Ne=-B()*le,Be=-B()*ke,Se=-B()*Te,Qe=.18+B()*.28,Ve=12+B()*18,Ee=4+B()*8,ze=(B()-.5)*3.2,sa=(B()-.5)*3.8,Re=B()>.5?"alternate":"alternate-reverse",W=B()>.5?"alternate":"alternate-reverse",ee=B()>.5?"alternate":"alternate-reverse",Ke=.18+B()*.42,Le=30+B()*60,fe=-45-B()*38,$e=188+B()*32,qe=.1+B()*.2;return{id:`wave-${oe+1}`,style:{"--wave-sway-duration":`${le}s`,"--wave-scale-duration":`${ke}s`,"--wave-drift-duration":`${Te}s`,"--wave-sway-delay":`${Ne}s`,"--wave-scale-delay":`${Be}s`,"--wave-drift-delay":`${Se}s`,"--wave-sway-dir":Re,"--wave-scale-dir":W,"--wave-drift-dir":ee,"--wave-scale":`${Qe}`,"--wave-shift":`${Ve}%`,"--wave-xshift":`${Ee}%`,"--wave-x0":`${ze}%`,"--wave-y0":`${sa}%`,"--wave-opacity":`${Ke}`,"--wave-blur":`${Le}px`,"--wave-bottom":`${fe}%`,"--wave-hue":`${$e}`,"--wave-glow":`${qe}`}}})},[]),J=i.useMemo(()=>{let re=Date.now()*3%2147483647;const B=()=>(re=re*48271%2147483647,re/2147483647);return Array.from({length:Ji},(Me,oe)=>{const le=180+B()*220,ke=220+B()*280,Te=-B()*le,Ne=-B()*ke,Be=.12+B()*.22,Se=3+B()*7,Qe=1+B()*3,Ve=(B()-.5)*2.8,Ee=(B()-.5)*2.2;return{id:`mesh-${oe+1}`,seed:1e3+oe*991+Math.floor(B()*999),style:{"--mesh-sway-duration":`${le}s`,"--mesh-drift-duration":`${ke}s`,"--mesh-sway-delay":`${Te}s`,"--mesh-drift-delay":`${Ne}s`,"--mesh-scale":`${Be}`,"--mesh-shift":`${Se}%`,"--mesh-xshift":`${Qe}%`,"--mesh-x0":`${Ee}%`,"--mesh-y0":`${Ve}%`}}})},[]),q=i.useMemo(()=>{const re=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],B=a.cogita.introSlides,Me=new Map(B.map(oe=>[oe.id,oe]));return re.map(oe=>{var ke;const le=Me.get(oe.id);return{...oe,...le,title:(le==null?void 0:le.title)??"Cogita",cta:(le==null?void 0:le.cta)??((ke=a.cogita.introSlides[0])==null?void 0:ke.cta)??a.cogita.loginCta,secondary:le==null?void 0:le.secondary}})},[a.cogita.introSlides]),[s,b]=i.useState(0),[f,Q]=i.useState(!0),[A,j]=i.useState(!1),G=q.length-1,P=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ne=i.useCallback(()=>{P(),n()},[P,n]),K=i.useCallback(()=>{Q(!0),b(0)},[]),O=i.useCallback(()=>{Q(!1),b(G)},[G]),ge=i.useCallback(re=>{b(Math.max(0,Math.min(G,re)))},[G]),pe=i.useCallback(()=>{s>=G?ne():ge(s+1)},[s,ge,ne,G]),ve=i.useCallback(()=>{ge(s-1)},[s,ge]);i.useEffect(()=>{var Me;const re=(Me=window.matchMedia)==null?void 0:Me.call(window,"(prefers-reduced-motion: reduce)");if(!re)return;const B=()=>j(re.matches);return B(),re.addEventListener?(re.addEventListener("change",B),()=>re.removeEventListener("change",B)):(re.addListener(B),()=>re.removeListener(B))},[]),i.useEffect(()=>{if(!f)return;const re=B=>{const Me=B.target;if(!Me)return;const oe=Me.tagName;if(!(Me.isContentEditable||oe==="INPUT"||oe==="TEXTAREA"||oe==="SELECT"||oe==="BUTTON"||oe==="A"||Me.closest('button, a, [role="button"], [role="link"]'))){if(B.key==="Escape"){O();return}if(B.key==="ArrowLeft"||B.key==="ArrowUp"){ve();return}(B.key==="ArrowRight"||B.key==="ArrowDown"||B.code==="Space"||B.key===" ")&&(B.preventDefault(),pe())}};return window.addEventListener("keydown",re),()=>window.removeEventListener("keydown",re)},[O,pe,ve,f]),i.useEffect(()=>{f&&s===G&&P()},[s,f,G,P]),i.useEffect(()=>{const re=m.current;if(!re)return;const B=x.current.filter(fe=>!!fe);if(!B.length)return;const Me=1,oe=.6,le=.6,ke=Math.max(1,Math.min(Me,window.devicePixelRatio||1));let Te=0,Ne=0,Be=oe,Se=0,Qe=0;const Ve=fe=>{let $e=fe%2147483647;return $e<=0&&($e+=2147483646),(qe,Ae)=>{$e=$e*48271%2147483647;const Oe=$e/2147483647;return qe+Oe*(Ae-qe)}},Ee={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},ze=fe=>{const $e=Math.sin(fe*12.9898)*43758.5453;return $e-Math.floor($e)},sa=fe=>{const $e=ze(fe+.1)||1e-4,qe=ze(fe+.7)||1e-4;return Math.sqrt(-2*Math.log($e))*Math.cos(2*Math.PI*qe)},Re=(fe,$e)=>{const qe=Math.floor(fe),Ae=qe+1,Oe=fe-qe,v=Oe*Oe*(3-2*Oe),k=ze(qe*12.9898+$e*78.233),Y=ze(Ae*12.9898+$e*78.233);return k+(Y-k)*v},W=fe=>{const $e=Ve(fe),qe=Math.min(4,Math.max(4,Math.floor(Te/1200*Ee.filamentCount)));return Array.from({length:qe},(Ae,Oe)=>{const v=Math.max(-1,Math.min(1,sa(fe+Oe*.37))),k=Math.min(1,Math.max(0,ze(fe+Oe*1.31))),Y=Math.min(Ee.depthLayers-1,Math.floor(k*Ee.depthLayers));return{seed:$e(0,Math.PI*2)+fe*.01,offset:v,freqA:Ee.freq1*(.75+$e(0,.5)),freqB:Ee.freq2*(.75+$e(0,.5)),ampA:Ee.amp1*(.6+$e(0,.7)),ampB:Ee.amp2*(.6+$e(0,.7)),width:2+Oe%5*.32,depth:k,layer:Y}})},ee=(fe,$e,qe)=>{const Ae=Math.max(30,Math.floor(Te*Ne/14e4));fe.save(),fe.globalAlpha=.6;for(let Oe=0;Oe<Ae;Oe+=1){const v=ze(Oe*9.1+Te*.11)*$e+qe,k=ze(Oe*3.7+Ne*.23)*Ne,Y=1.2+ze(Oe*5.9)*2.4,t=fe.createRadialGradient(v,k,0,v,k,Y*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),fe.fillStyle=t,fe.beginPath(),fe.arc(v,k,Y*2,0,Math.PI*2),fe.fill()}fe.restore()},Ke=(fe,$e)=>{fe.clearRect(0,0,Te,Ne);const qe=Ne*Ee.waveCenter,Ae=Ee.waveBandPx,Oe=Ee.segments,v=Ee.colors.filaments,k=Se||Te,Y=0;ee(fe,k,Y),fe.strokeStyle=v,fe.lineCap="round",fe.lineJoin="round";for(let t=0;t<$e.length;t+=1){const r=$e[t],h=r.offset*Ae*(.85+ze(r.seed)*.4),T=1-Math.min(1,Math.abs(h)/Ae),D=Math.exp(-Math.pow(h/Ee.crestThickness,2)),Z=r.layer===0?1.1:r.layer===1?.85:.6,te=.35+(1-r.depth)*.65,ae=T*te*Z*(.34+D*.45);fe.globalAlpha=ae,fe.lineWidth=r.width*(1+(1-r.depth)*.8);const de=[];for(let we=0;we<=Oe;we+=1){const aa=we/Oe*k+Y,Ge=(Re(aa*.012,r.seed)-.5)*Ee.xJitter,Ze=aa+Ge,Fe=(Re(Ze*r.freqA,r.seed)-.5)*Ee.jitterA,He=(Re(Ze*r.freqB,r.seed*1.7)-.5)*Ee.jitterB,_e=qe+Math.sin(Ze*r.freqA+r.seed)*r.ampA+Math.sin(Ze*r.freqB+r.seed*1.3)*r.ampB+h+Fe+He;de.push({x:Ze,y:_e})}fe.beginPath(),fe.moveTo(de[0].x,de[0].y);for(let we=1;we<de.length-1;we+=1){const aa=(de[we].x+de[we+1].x)/2,Ge=(de[we].y+de[we+1].y)/2;fe.quadraticCurveTo(de[we].x,de[we].y,aa,Ge)}const se=de[de.length-1];fe.quadraticCurveTo(se.x,se.y,se.x,se.y),fe.stroke()}fe.save(),fe.globalCompositeOperation="lighter",fe.strokeStyle=Ee.colors.glow,fe.lineCap="round",fe.lineJoin="round";for(let t=0;t<$e.length;t+=1){const r=$e[t];if(Math.abs(r.offset)*Ae>Ee.crestThickness)continue;const h=Ee.glowAlpha*(.7+(1-r.depth)*.6);fe.globalAlpha=h,fe.lineWidth=1.6+(1-r.depth)*1.2;const T=[];for(let Z=0;Z<=Oe;Z+=1){const te=Z/Oe*k+Y,ae=Math.sin(te*.02+r.seed)*3,de=qe+Math.sin(te*r.freqA+r.seed)*r.ampA+Math.sin(te*r.freqB+r.seed*1.3)*r.ampB+r.offset*Ae*.35+ae;T.push({x:te,y:de})}fe.beginPath(),fe.moveTo(T[0].x,T[0].y);for(let Z=1;Z<T.length-1;Z+=1){const te=(T[Z].x+T[Z+1].x)/2,ae=(T[Z].y+T[Z+1].y)/2;fe.quadraticCurveTo(T[Z].x,T[Z].y,te,ae)}const D=T[T.length-1];fe.quadraticCurveTo(D.x,D.y,D.x,D.y),fe.stroke()}fe.restore()},Le=()=>{Te=Math.floor(re.clientWidth),Ne=Math.floor(re.clientHeight),Se=Math.floor(Te*1.8),Qe=Ne,Be=Te<820?le:oe,B.forEach(fe=>{const $e=fe.getContext("2d");if(!$e)return;fe.width=Math.floor(Se*ke*Be),fe.height=Math.floor(Qe*ke*Be),fe.style.width=`${Se}px`,fe.style.height=`${Qe}px`,fe.style.left=`${-(Se-Te)/2}px`,$e.setTransform(ke*Be,0,0,ke*Be,0,0);const qe=Number(fe.dataset.seed||1),Ae=W(qe);Ke($e,Ae)})};return Le(),window.addEventListener("resize",Le,{passive:!0}),()=>window.removeEventListener("resize",Le)},[J]);const F=q[Math.min(s,q.length-1)],ce=f?F:q[q.length-1],c=(ce==null?void 0:ce.theme)??q[0].theme,ie={"--cogita-bg0":c.bg0,"--cogita-bg1":c.bg1,"--cogita-bg2":c.bg2,"--cogita-bloom":c.bloom,"--cogita-sat":c.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:C,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:E,onChange:l}),e.jsx(_r,{copy:a,label:o,isAuthenticated:u,secureMode:I,onLogin:n,onProfileNavigate:g,onToggleSecureMode:w,onLogout:p,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:m,className:"cogita-section cogita-home",style:ie,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[J.map((re,B)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:re.style,"data-seed":re.seed,ref:Me=>{x.current[B]=Me}},re.id)),V.map(re=>e.jsx("div",{className:"cogita-home-wave",style:re.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},re.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(zi,{slides:q,activeIndex:s,introOpen:f,prefersReducedMotion:A,onNext:pe,onPrev:ve,onSelect:ge,onExit:O,onOpen:K,onRegister:ne})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Yi},Symbol.toStringTag,{value:"Module"})),Qr=i.createContext(!1);function ka({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:l}){if(i.useContext(Qr))return e.jsx(e.Fragment,{children:l});const m=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}I("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:m,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:M,onChange:E}),e.jsx(_r,{copy:a,label:n,isAuthenticated:o,secureMode:p,onLogin:()=>I("home"),onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:l}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function Oa(a){const[n,o]=i.useState("Cogita library"),[u,g]=i.useState(null);return i.useEffect(()=>{let w=!1;return Ur().then(p=>{if(w)return;const I=p.find(M=>M.libraryId===a);I&&o(I.name)}).catch(()=>{w||o("Cogita library")}),()=>{w=!0}},[a]),i.useEffect(()=>{let w=!1;return bi(a).then(p=>{w||g(p)}).catch(()=>{w||g(null)}),()=>{w=!0}},[a]),{libraryName:n,stats:u}}function Sr({slices:a}){const n=a.reduce((u,g)=>u+Math.max(0,g.value),0),o=i.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let u=0;return`conic-gradient(${a.map(w=>{const I=Math.max(0,w.value)/n*360,M=u,E=u+I;return u=E,`${w.color} ${M}deg ${E}deg`}).join(",")})`},[a,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:o}}),e.jsx("div",{className:"cogita-overview-legend",children:a.map(u=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:u.color}}),e.jsx("strong",{children:u.value}),e.jsx("small",{children:u.label})]},u.label))})]})}function Qi({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C,stats:m}=Oa(l),[x,V]=i.useState("infos"),[J,q]=i.useState(0),[s,b]=i.useState(0),[f,Q]=i.useState(0),A=(m==null?void 0:m.totalInfos)??0,j=(m==null?void 0:m.totalCollections)??0,G=0,P=0,ne=0,K=Math.max(0,A-ne-s),O=Math.max(0,A-s-f);i.useEffect(()=>{let pe=!1;return(async()=>{try{const F=await jt({libraryId:l,limit:200}),ce=await Promise.all(F.items.map(c=>Wr({libraryId:l,collectionId:c.collectionId}).catch(()=>[])));if(pe)return;q(ce.reduce((c,ie)=>c+ie.length,0))}catch{pe||q(0)}})(),()=>{pe=!0}},[l]),i.useEffect(()=>{let pe=!1;return(async()=>{try{const[F,ce,c]=await Promise.all([$t({libraryId:l,type:"computed",limit:1}).catch(()=>({total:0})),$t({libraryId:l,type:"source",limit:1}).catch(()=>({total:0})),zr({libraryId:l}).catch(()=>({items:[]}))]);if(pe)return;b((F.total??0)+(ce.total??0));const ie=new Set(c.items.filter(re=>re.childItemType.toLowerCase()==="info").map(re=>re.childItemId).filter(Boolean));Q(ie.size)}catch{pe||(b(0),Q(0))}})(),()=>{pe=!0}},[l]);const ge=[{key:"infos",label:a.cogita.library.overview.stats.totalInfos,value:A},{key:"collections",label:a.cogita.library.overview.stats.collections,value:j},{key:"revisions",label:a.cogita.library.overview.stats.revisions,value:J},{key:"storyboards",label:a.cogita.library.overview.stats.storyboards,value:G},{key:"texts",label:a.cogita.library.overview.stats.texts,value:P}];return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:C})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ge.map(pe=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${x===pe.key?"active":""}`,onClick:()=>V(pe.key),children:[e.jsx("span",{children:pe.label}),e.jsx("strong",{children:pe.value})]},pe.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:a.cogita.library.overview.statsCardTitle})}),x==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.knownChartTitle}),e.jsx(Sr,{slices:[{label:a.cogita.library.overview.known,value:ne,color:"#75d79a"},{label:a.cogita.library.overview.unknown,value:K,color:"#85b9ff"},{label:a.cogita.library.overview.excluded,value:s,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.checksChartTitle}),e.jsx(Sr,{slices:[{label:a.cogita.library.overview.availableChecks,value:f,color:"#75d79a"},{label:a.cogita.library.overview.unavailableChecks,value:O,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:a.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]})]})})]})})}const me=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ba=(a,n,o,u)=>`${a}:${n}:${o??""}:${u??""}`,ra=(a,n)=>{const o=a.cogita.library.infoTypes;return{any:o.any,vocab:o.vocab,language:o.language,word:o.word,sentence:o.sentence,topic:o.topic,collection:o.collection,person:o.person,institution:o.institution,collective:o.collective,orcid:o.orcid,address:o.address,email:o.email,phone:o.phone,media:o.media,work:o.work,geo:o.geo,music_piece:o.musicPiece,music_fragment:o.musicFragment,source:o.source,quote:o.quote,computed:o.computed}[n]??String(n)},Gr=a=>[{value:"any",label:ra(a,"any")},{value:"language",label:ra(a,"language")},{value:"word",label:ra(a,"word")},{value:"sentence",label:ra(a,"sentence")},{value:"topic",label:ra(a,"topic")},{value:"collection",label:ra(a,"collection")},{value:"person",label:ra(a,"person")},{value:"institution",label:ra(a,"institution")},{value:"collective",label:ra(a,"collective")},{value:"orcid",label:ra(a,"orcid")},{value:"address",label:ra(a,"address")},{value:"email",label:ra(a,"email")},{value:"phone",label:ra(a,"phone")},{value:"media",label:ra(a,"media")},{value:"work",label:ra(a,"work")},{value:"geo",label:ra(a,"geo")},{value:"music_piece",label:ra(a,"music_piece")},{value:"music_fragment",label:ra(a,"music_fragment")},{value:"source",label:ra(a,"source")},{value:"quote",label:ra(a,"quote")},{value:"computed",label:ra(a,"computed")}],Gi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Xi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],Zi=a=>[{value:"any",label:ra(a,"any")},{value:"vocab",label:ra(a,"vocab")},...Gr(a).filter(n=>n.value!=="any")],Xa=5,Ir=50,Pr=2,Rr=[];function We({libraryId:a,infoType:n,label:o,placeholder:u,value:g,onChange:w,values:p,onChangeMultiple:I,helperText:M,searchFailedText:E,createFailedText:l,createLabel:C,savingLabel:m,loadMoreLabel:x,inputRef:V,autoAdvance:J,onCommit:q,multiple:s}){const b=s?p??Rr:Rr,[f,Q]=i.useState(s?"":(g==null?void 0:g.label)??""),[A,j]=i.useState([]),[G,P]=i.useState(Xa),[ne,K]=i.useState(-1),[O,ge]=i.useState(!1),[pe,ve]=i.useState(!1),[F,ce]=i.useState(null),c=i.useRef(0),ie=i.useRef(new Map),re=i.useMemo(()=>s?f.trim().length>0:f.trim().length>0&&!g,[f,g,s]);i.useEffect(()=>{s||Q((g==null?void 0:g.label)??"")},[g,s]),i.useEffect(()=>{const oe=f.trim();if(!oe||oe.length<Pr){j([]),ge(!1),P(Xa),K(-1),ve(!1),ce(null);return}const le=oe.toLowerCase(),ke=`${a}:${n}:${le}`,Te=ie.current.get(ke);if(Te){if(s&&b.length>0){const Be=new Set(b.map(Se=>Se.id));j(Te.filter(Se=>!Be.has(Se.id)))}else j(Te);P(Xa),K(-1),ge(Te.length>0),ve(!1),ce(null);return}const Ne=window.setTimeout(async()=>{const Be=Date.now();c.current=Be,ve(!0),ce(null);try{const Se=await Hr({libraryId:a,type:n,query:oe,limit:Ir});if(c.current!==Be)return;const Qe=Se.slice(0,Ir).map(Ve=>({id:Ve.infoId,label:Ve.label,infoType:Ve.infoType}));if(ie.current.set(ke,Qe),s&&b.length>0){const Ve=new Set(b.map(Ee=>Ee.id));j(Qe.filter(Ee=>!Ve.has(Ee.id)))}else j(Qe);P(Xa),K(-1),ge(!0)}catch{if(c.current!==Be)return;ce(E??"Search failed.")}finally{c.current===Be&&ve(!1)}},250);return()=>window.clearTimeout(Ne)},[a,n,f,b]);const B=oe=>{if(s){const le=b.some(ke=>ke.id===oe.id)?b:[...b,oe];I==null||I(le),Q(""),ge(!1),K(-1);return}w==null||w(oe),Q(oe.label),ge(!1),K(-1),J&&(q==null||q())},Me=async()=>{const oe=f.trim();if(oe){ve(!0),ce(null);try{const le=await Ua({libraryId:a,infoType:n,payload:{label:oe}}),ke={id:le.infoId,label:oe,infoType:le.infoType};if(oe.length>=Pr){const Te=`${a}:${n}:${oe.toLowerCase()}`,Ne=ie.current.get(Te)??[];ie.current.set(Te,[ke,...Ne])}if(s){I==null||I([...b,ke]),Q(""),ge(!1),K(-1);return}w==null||w(ke),ge(!1),K(-1),J&&(q==null||q())}catch{ce(l??"Create failed.")}finally{ve(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:o}),e.jsx("input",{value:f,placeholder:u,onChange:oe=>{Q(oe.target.value),!s&&g&&(w==null||w(null))},onKeyDown:oe=>{if(oe.key==="ArrowDown"){if(oe.preventDefault(),!A.length)return;ge(!0),K(le=>{const ke=Math.min(A.length,G)-1,Te=le<0?0:Math.min(le+1,ke);return Te===ke&&A.length>G?(P(Ne=>Math.min(Ne+Xa,A.length)),Math.min(le+1,Math.min(A.length,G+Xa)-1)):Te});return}if(oe.key==="ArrowUp"){if(oe.preventDefault(),!A.length)return;ge(!0),K(le=>le<=0?0:le-1);return}if(oe.key==="Enter"){if(oe.preventDefault(),ne>=0&&A[ne]){B(A[ne]);return}if(re){Me();return}}},onFocus:()=>{A.length>0&&ge(!0)},autoComplete:"off",ref:V})]}),s&&b.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:b.map(oe=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>I==null?void 0:I(b.filter(le=>le.id!==oe.id)),children:[oe.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},oe.id))}),M&&e.jsx("p",{className:"cogita-help",children:M}),F&&e.jsx("p",{className:"cogita-error",children:F}),O&&A.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[A.slice(0,G).map((oe,le)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":le===ne,onClick:()=>B(oe),children:[e.jsx("strong",{children:oe.label}),e.jsx("span",{children:oe.infoType})]},oe.id)),G<A.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>P(oe=>Math.min(oe+Xa,A.length)),children:x??"Load more"})]}),re&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Me,disabled:pe,children:pe?m??"Saving...":C??`Create new ${n}`})]})}function $r({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,mode:C}){const{libraryName:m}=Oa(l),x=`/#/cogita/library/${l}`,[V,J]=i.useState("any"),[q,s]=i.useState(""),[b,f]=i.useState([]),[Q,A]=i.useState("idle"),[j,G]=i.useState(null),[P,ne]=i.useState(null),[K,O]=i.useState("idle"),[ge,pe]=i.useState(0),[ve,F]=i.useState(null),[ce,c]=i.useState("idle"),[ie,re]=i.useState(null),[B,Me]=i.useState(null),[oe,le]=i.useState(null),[ke,Te]=i.useState(null),Ne=i.useMemo(()=>({languageAId:(ie==null?void 0:ie.id)??void 0,languageBId:(B==null?void 0:B.id)??void 0,topicId:(oe==null?void 0:oe.id)??void 0,levelId:(ke==null?void 0:ke.id)??void 0}),[ie,B,oe,ke]),Be=i.useMemo(()=>V==="vocab"||V==="any",[V]);i.useEffect(()=>{A("loading");const Re=window.setTimeout(()=>{$t({libraryId:l,type:V==="any"?void 0:V,query:q.trim()||void 0,limit:30,languageAId:Be?Ne.languageAId:void 0,languageBId:Be?Ne.languageBId:void 0,topicId:Be?Ne.topicId:void 0,levelId:Be?Ne.levelId:void 0}).then(W=>{f(W.items),pe(W.total),F(W.nextCursor??null),A("ready"),G(W.items[0]??null)}).catch(()=>{f([]),pe(0),F(null),A("ready")})},240);return()=>window.clearTimeout(Re)},[l,q,V,Be,Ne]),i.useEffect(()=>{if(!j||j.cardType!=="info"||j.infoType!=="computed"){ne(null),O("idle"),c("idle");return}O("loading"),hr({libraryId:l,infoId:j.cardId}).then(Re=>{ne(Re),O("ready")}).catch(()=>{ne(null),O("ready")})},[l,j]);const Se=async()=>{if(ve){A("loading");try{const Re=await $t({libraryId:l,type:V==="any"?void 0:V,query:q.trim()||void 0,limit:30,cursor:ve,languageAId:Be?Ne.languageAId:void 0,languageBId:Be?Ne.languageBId:void 0,topicId:Be?Ne.topicId:void 0,levelId:Be?Ne.levelId:void 0});f(W=>[...W,...Re.items]),F(Re.nextCursor??null),pe(Re.total),A("ready")}catch{A("ready")}}},Qe=async()=>{if(!(!j||j.cardType!=="connection"&&j.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){c("loading");try{await mi({libraryId:l,connectionId:j.cardId});let W=null;f(ee=>{const Ke=ee.filter(Le=>Le.cardId!==j.cardId);return W=Ke[0]??null,Ke}),pe(ee=>Math.max(0,ee-(j.cardType==="vocab"?3:1))),G(ee=>ee&&ee.cardId===j.cardId?W:ee),c("idle")}catch{c("error")}}},Ve=i.useMemo(()=>C==="collection"?"grid":C==="list"?"list":"detail",[C]),Ee=j?me(j):null,ze=i.useMemo(()=>Zi(a),[a]),sa=i.useMemo(()=>{const Re=ge||b.length;return a.cogita.library.list.cardCount.replace("{shown}",String(b.length)).replace("{total}",String(Re))},[a,b.length,ge]);return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Ve,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:x,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${x}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${x}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(Re=>e.jsx("a",{className:"ghost","data-active":C===Re,href:`${x}/${Re}`,children:Re==="detail"?a.cogita.library.list.modes.detail:Re==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},Re))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:V,onChange:Re=>J(Re.target.value),children:ze.map(Re=>e.jsx("option",{value:Re.value,children:Re.label},Re.value))}),e.jsx("input",{type:"text",value:q,onChange:Re=>s(Re.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(V==="vocab"||V==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:ie,onChange:re,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:B,onChange:Me,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:oe,onChange:le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:ke,onChange:Te,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(ie||B||oe||ke)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{re(null),Me(null),le(null),Te(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:sa}),e.jsx("span",{children:Q==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":C==="collection"?"grid":"list",children:b.length?b.map(Re=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":Ee===me(Re),onClick:()=>G(Re),children:[e.jsx("div",{className:"cogita-card-type",children:Re.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:Re.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:Re.label}),e.jsx("p",{className:"cogita-card-subtitle",children:Re.description})]},me(Re))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${x}/new`,children:a.cogita.library.list.addInfo})]})}),ve?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Se,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(j==null?void 0:j.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(j==null?void 0:j.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${x}/edit/${j.cardId}`,children:a.cogita.library.list.editInfo}):null,(j==null?void 0:j.cardType)==="connection"||(j==null?void 0:j.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:Qe,disabled:ce==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${x}/new`,children:a.cogita.library.actions.addInfo})]})]}),j?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:j.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:j.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),ce==="error"&&(j.cardType==="connection"||j.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,j.cardType==="info"&&j.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),K==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),K!=="loading"&&P?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(Et,{value:P.prompt,mode:"auto"}),P.expectedAnswers&&Object.keys(P.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(P.expectedAnswers).map(([Re,W])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Re}),e.jsx(br,{value:W,mode:"auto"})]},Re))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(br,{value:P.expectedAnswer,mode:"auto"})]})]}):K!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Ft=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Er=8;function Ar({libraryId:a,copy:n,language:o,sourceKindOptions:u,value:g,onChange:w,labels:p}){const[I,M]=i.useState(!1),[E,l]=i.useState(-1),C=i.useMemo(()=>{const J=o;return Ft.map(q=>{var f;const s=(q==null?void 0:q[J])??(q==null?void 0:q.en)??(q==null?void 0:q.la);return{label:`${s.abbr} — ${s.name}`,latin:((f=q==null?void 0:q.la)==null?void 0:f.abbr)??s.abbr}})},[o]),m=(J,q=!1)=>{const s=J.trim().toLowerCase();return s?C.filter(b=>b.label.toLowerCase().includes(s)).slice(0,Er):q?C.slice(0,Er):[]},x=(J,q)=>{const s=J.trim().toLowerCase();if(!s)return null;const b=Ft;for(const f of b){const Q=f==null?void 0:f.la,A=(f==null?void 0:f[q])??(f==null?void 0:f.en)??Q,j=(A==null?void 0:A.abbr)??"",G=(A==null?void 0:A.name)??"";if(j.toLowerCase()===s||G.toLowerCase()===s||`${j} — ${G}`.toLowerCase()===s)return{book:f,entry:A,la:Q}}return null};i.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!I){const J=x(g.locatorValue,o);if(J){const q=`${J.entry.abbr} — ${J.entry.name}`;q!==g.bibleBookDisplay&&w({...g,bibleBookDisplay:q})}}},[o,g,I,w]);const V=J=>w({...g,...J});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:J=>V({sourceKind:J.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:u.map(J=>e.jsx("option",{value:J.value,children:J.label},J.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:J=>{const q=J.target.value;V({bibleBookDisplay:q,locatorValue:""}),M(!0),l(-1)},onKeyDown:J=>{var s;const q=m(g.bibleBookDisplay);if(q.length){if(J.key==="ArrowDown")J.preventDefault(),l(b=>Math.min(b+1,q.length-1));else if(J.key==="ArrowUp")J.preventDefault(),l(b=>Math.max(b-1,0));else if((J.key==="Enter"||J.key==="Tab")&&E>=0&&q[E]){const b=q[E],f=x(b.label,o);if(!f)return;V({bibleBookDisplay:b.label,locatorValue:((s=f.la)==null?void 0:s.abbr)??g.locatorValue}),M(!1)}}},onFocus:()=>M(!0),onBlur:()=>window.setTimeout(()=>M(!1),100),placeholder:p.bibleBookPlaceholder})]}),I&&m(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:m(g.bibleBookDisplay,!0).map((J,q)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":q===E,tabIndex:-1,onMouseDown:()=>{var b;const s=x(J.label,o);s&&V({bibleBookDisplay:J.label,locatorValue:((b=s.la)==null?void 0:b.abbr)??g.locatorValue})},children:e.jsx("strong",{children:J.label})},J.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:J=>V({locatorAux:J.target.value}),placeholder:p.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:J=>V({sourceUrl:J.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:J=>V({sourceAccessedDate:J.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:a,infoType:"work",label:p.churchDocumentLabel,placeholder:p.churchDocumentPlaceholder,value:g.churchDocument,onChange:J=>V({churchDocument:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>V({locatorValue:J.target.value}),placeholder:p.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(We,{libraryId:a,infoType:"work",label:p.workLabel,placeholder:p.workPlaceholder,value:g.work,onChange:J=>V({work:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:a,infoType:"media",label:p.bookLabel,placeholder:p.bookPlaceholder,value:g.bookMedia,onChange:J=>V({bookMedia:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>V({locatorValue:J.target.value}),placeholder:p.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>V({locatorValue:J.target.value}),placeholder:p.locatorPlaceholder})]})]})}const en=[],an=[];function tn({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),o=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),u=a.handles.length,g=u>1?(u-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),o?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((w,p)=>e.jsx(Lr,{type:"target",id:w.id,position:Cr.Left,style:{top:46+p*28},children:w.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:w.label}):null},w.id)),a.output!==!1?e.jsx(Lr,{type:"source",id:"out",position:Cr.Right}):null]})}function rn({copy:a,value:n,onChange:o}){var Ve,Ee,ze,sa,Re,W,ee,Ke,Le,fe,$e,qe,Ae,Oe;const u=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=v=>!v||v.nodes.length===0?en:v.nodes.map((k,Y)=>{var t,r,h,T;return{id:k.id,type:"computed",position:k.position??{x:40+Y*160,y:60+Y%3*80},data:{title:k.name||((t=u[k.type])==null?void 0:t.label)||k.type,subtitle:((r=u[k.type])==null?void 0:r.label)||k.type,type:k.type,name:k.name,outputLabel:k.outputLabel,min:k.min,max:k.max,value:k.type==="input.const"?k.value:void 0,list:k.list,handles:((h=u[k.type])==null?void 0:h.handles)??[],output:((T=u[k.type])==null?void 0:T.output)??!0}}}),w=v=>{if(!v||v.nodes.length===0)return an;const k=new Set(v.nodes.map(r=>r.id)),Y=[];let t=0;return v.nodes.forEach(r=>{const h=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(h).forEach(([T,D])=>{D.forEach(Z=>{k.has(Z)&&Y.push({id:`${r.id}-${T}-${Z}-${t++}`,source:Z,target:r.id,targetHandle:T==="in"?void 0:T})})})}),Y},p=i.useMemo(()=>g(n),[n,u]),I=i.useMemo(()=>w(n),[n]),M=(v,k)=>{if(!v)return"null";const Y=v.nodes.map(r=>{const h=(r.list??[]).join(","),T=r.inputs?r.inputs.join(","):"",D=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([te,ae])=>`${te}:${[...ae].sort().join(",")}`).sort().join("|"):"",Z=k&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",h,T,D,Z].join(":")}).sort().join("||"),t=v.outputs?[...v.outputs].sort().join(","):v.output??"";return`${Y}::${t}`},E=i.useMemo(()=>{var k;const v=!!((k=n==null?void 0:n.nodes)!=null&&k.some(Y=>!!Y.position));return M(n,v)},[n]),[l,C]=i.useState(p),[m,x]=i.useState(I),[V,J]=i.useState(null),[q,s]=i.useState([]),[b,f]=i.useState(null),[Q,A]=i.useState(null),[j,G]=i.useState({}),[P,ne]=i.useState(0),K=i.useRef(o),O=i.useRef(E),ge=i.useRef(E),pe=i.useRef(M(n,!1)),ve=i.useMemo(()=>V?l.find(v=>v.id===V)??null:null,[l,V]),F=i.useMemo(()=>{const v=["in1","in2","in3","in4","in5","in6"],k=new Map;return m.forEach(Y=>{if(!Y.target)return;const t=Y.targetHandle??"in1";k.has(Y.target)||k.set(Y.target,new Set),k.get(Y.target).add(t)}),l.map(Y=>{var t;if(((t=Y.data)==null?void 0:t.type)==="compute.concat"){const r=k.get(Y.id)??new Set,h=[];let T=!1;return v.forEach(D=>{var Z,te;if(r.has(D)||!T){const ae=(te=(Z=u["compute.concat"])==null?void 0:Z.handles)==null?void 0:te.find(de=>de.id===D);ae&&h.push(ae),r.has(D)||(T=!0)}}),{...Y,selected:Y.id===V,data:{...Y.data,handles:h}}}return{...Y,selected:Y.id===V}})},[l,V,m,u]);i.useEffect(()=>{f(null),A(null)},[V]),i.useEffect(()=>{if(q.length===0)return;const v=k=>{if(k.key!=="Delete"&&k.key!=="Backspace")return;const Y=k.target;Y&&(Y.tagName==="INPUT"||Y.tagName==="TEXTAREA"||Y.isContentEditable)||(k.preventDefault(),x(t=>t.filter(r=>!q.includes(r.id))),s([]))};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[q,x]),i.useEffect(()=>{K.current=o},[o]),i.useEffect(()=>{if(O.current!==E){if(ge.current===E||pe.current===E){O.current=E;return}O.current=E,C(p),x(I),J(null),f(null),A(null),G({}),ne(v=>v+1)}},[p,I,x,C,E]),i.useEffect(()=>{const v=l.filter(h=>{var T;return((T=h.data)==null?void 0:T.type)==="output"}).map(h=>h.id).sort(),k=new Map;m.forEach(h=>{let T=k.get(h.target);T||(T={},k.set(h.target,T));const D=h.targetHandle||"in";T[D]||(T[D]=[]),T[D].push(h.source)}),k.forEach(h=>{Object.values(h).forEach(T=>T.sort())});const Y={nodes:l.map(h=>{var T,D,Z,te,ae,de,se,we,aa;return{id:h.id,type:((T=h.data)==null?void 0:T.type)??"compute.add",position:h.position,name:(D=h.data)==null?void 0:D.name,outputLabel:(Z=h.data)==null?void 0:Z.outputLabel,min:(te=h.data)==null?void 0:te.min,max:(ae=h.data)==null?void 0:ae.max,value:((de=h.data)==null?void 0:de.type)==="input.const"?(se=h.data)==null?void 0:se.value:void 0,list:(we=h.data)==null?void 0:we.list,inputs:(aa=k.get(h.id))==null?void 0:aa.in,inputsByHandle:k.get(h.id)}}),output:v[0]??null,outputs:v},t=M(Y,!0),r=M(Y,!1);t===ge.current||r===pe.current||(ge.current=t,pe.current=r,K.current(Y))},[l,m]),i.useEffect(()=>{const v={};let k=!1;l.forEach(Y=>{var D,Z,te,ae,de;if(((D=Y.data)==null?void 0:D.type)!=="input.random")return;if(j[Y.id]!==void 0){v[Y.id]=j[Y.id];return}const t=Number.isFinite((Z=Y.data)==null?void 0:Z.min)?Number((te=Y.data)==null?void 0:te.min):0,r=Number.isFinite((ae=Y.data)==null?void 0:ae.max)?Number((de=Y.data)==null?void 0:de.max):t+10,h=Math.min(t,r),T=Math.max(t,r);v[Y.id]=Math.floor(Math.random()*(T-h+1))+h,k=!0}),(k||Object.keys(v).length!==Object.keys(j).length)&&G(v)},[l,j,P]);const ce=i.useMemo(()=>l.map(k=>{var t,r,h,T,D;const Y=(((t=k.data)==null?void 0:t.list)??[]).join(",");return[k.id,((r=k.data)==null?void 0:r.type)??"",((h=k.data)==null?void 0:h.name)??"",((T=k.data)==null?void 0:T.min)??"",((D=k.data)==null?void 0:D.max)??"",Y].join(":")}).sort().join("|"),[l]),c=i.useMemo(()=>m.map(k=>`${k.source}:${k.target}:${k.targetHandle??""}`).sort().join("|"),[m]),ie=i.useMemo(()=>{const v=new Map(l.map(te=>[te.id,te])),k=new Map;m.forEach(te=>{let ae=k.get(te.target);ae||(ae={},k.set(te.target,ae));const de=te.targetHandle||"in";ae[de]||(ae[de]=[]),ae[de].push(te.source)});const Y=new Map,t=new Set,r=te=>{if(typeof te=="number")return te;if(typeof te=="string"){const ae=Number(te);return Number.isFinite(ae)?ae:0}return 0},h=(te,ae)=>{var de,se;return ae?((de=k.get(te.id))==null?void 0:de[ae])??[]:((se=k.get(te.id))==null?void 0:se.in)??[]},T=(te,ae)=>h(te,ae).map(de=>r(Z(de))),D=(te,ae)=>h(te,ae).map(de=>Z(de)),Z=te=>{var we,aa,Ge,Ze;if(Y.has(te))return Y.get(te);if(t.has(te))return 0;const ae=v.get(te);if(!ae)return 0;t.add(te);const de=((we=ae.data)==null?void 0:we.type)??"";let se=0;switch(de){case"input.random":{se=j[te]??0;break}case"input.const":{se=Number.isFinite((aa=ae.data)==null?void 0:aa.value)?Number((Ge=ae.data)==null?void 0:Ge.value):0;break}case"input.list":{const Fe=(((Ze=ae.data)==null?void 0:Ze.list)??[]).filter(Boolean),He=Math.round(T(ae,"index")[0]??0);se=(Fe.length?Fe[Math.max(0,Math.min(Fe.length-1,He))]:"")||String(He);break}case"compute.add":{se=T(ae,"in").reduce((Fe,He)=>Fe+He,0);break}case"compute.sub":{se=T(ae,"add").reduce((Fe,He)=>Fe+He,0)-T(ae,"sub").reduce((Fe,He)=>Fe+He,0);break}case"compute.mul":{const Fe=T(ae,"in");se=Fe.length?Fe.reduce((He,_e)=>He*_e,1):0;break}case"compute.div":{const Fe=T(ae,"num")[0]??0,He=T(ae,"den").reduce((_e,ea)=>_e+ea,0);se=Math.abs(He)<Number.EPSILON?0:Fe/He;break}case"compute.pow":{const Fe=T(ae,"base")[0]??0,He=T(ae,"exp")[0]??0;se=Math.pow(Fe,He);break}case"compute.exp":{const Fe=T(ae,"base")[0]??0,He=T(ae,"exp")[0]??0;se=Math.pow(Fe,He);break}case"compute.log":{const Fe=T(ae,"value")[0]??0,He=T(ae,"base")[0]??0,_e=Math.max(Fe,Number.EPSILON);se=Math.abs(He)<Number.EPSILON?Math.log(_e):Math.log(_e)/Math.log(He);break}case"compute.abs":{se=Math.abs(T(ae,"in")[0]??0);break}case"compute.min":{const Fe=T(ae,"in");se=Fe.length?Math.min(...Fe):0;break}case"compute.max":{const Fe=T(ae,"in");se=Fe.length?Math.max(...Fe):0;break}case"compute.floor":{se=Math.floor(T(ae,"in")[0]??0);break}case"compute.ceil":{se=Math.ceil(T(ae,"in")[0]??0);break}case"compute.round":{se=Math.round(T(ae,"in")[0]??0);break}case"compute.mod":{const Fe=T(ae,"a")[0]??0,He=T(ae,"b")[0]??0;se=Math.abs(He)<Number.EPSILON?0:Fe%He;break}case"compute.concat":{const He=["in1","in2","in3","in4","in5","in6"].flatMap(oa=>D(ae,oa)),_e=He.length?He:D(ae,"in");se=(_e.length?_e:D(ae)).map(oa=>oa==null?"":String(oa)).join("");break}case"compute.trim":{const Fe=D(ae,"text")[0]??D(ae,"in")[0]??"",He=Fe==null?"":String(Fe),_e=Math.max(0,Math.round(T(ae,"start")[0]??0)),ea=Math.max(0,Math.round(T(ae,"end")[0]??0));se=_e+ea>=He.length?"":He.substring(_e,He.length-ea);break}case"output":{const Fe=h(ae,"in")[0];se=Fe?Z(Fe):0;break}default:se=0}return t.delete(te),Y.set(te,se),se};return l.forEach(te=>Z(te.id)),Y},[ce,c,j]),re=i.useRef(ie);i.useEffect(()=>{re.current=ie},[ie]);const B=i.useCallback(v=>{const k=re.current.get(v.id);return e.jsx(tn,{data:{...v.data,value:k}})},[]),Me=i.useMemo(()=>({computed:B}),[B]),oe=v=>{var r;if(!v.target||!v.targetHandle){x(h=>Rt(v,h));return}const k=l.find(h=>h.id===v.target),Y=k?u[((r=k.data)==null?void 0:r.type)??""]:null,t=Y==null?void 0:Y.handles.find(h=>h.id===v.targetHandle);x(h=>{let T=h;return t!=null&&t.limitOne&&(T=h.filter(D=>!(D.target===v.target&&D.targetHandle===v.targetHandle))),Rt(v,T)})},le=v=>{const k=crypto.randomUUID(),Y=u[v]??{label:v,handles:[]},t=Y.label;C(r=>[...r,{id:k,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:Y.label,type:v,name:"",handles:Y.handles,list:v==="input.list"?[]:void 0,output:Y.output??!0}}])},ke=v=>{if(V){if(v.name!==void 0){const k=v.name.trim(),Y=k===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(k);if(A(Y?null:a.cogita.library.graph.invalidName),!k)f(null);else{const t=l.find(r=>{var h;return r.id!==V&&((h=r.data)==null?void 0:h.name)&&r.data.name.trim().toLowerCase()===k.toLowerCase()});f(t?a.cogita.library.graph.duplicateName:null)}}C(k=>k.map(Y=>{var t,r,h,T;return Y.id===V?{...Y,data:{...Y.data,...v,title:v.name?v.name:(t=Y.data)==null?void 0:t.title,subtitle:((h=u[v.type??((r=Y.data)==null?void 0:r.type)??""])==null?void 0:h.label)??((T=Y.data)==null?void 0:T.subtitle)}}:Y}))}},Te=()=>{V&&(C(v=>v.filter(k=>k.id!==V)),x(v=>v.filter(k=>k.source!==V&&k.target!==V)),G(v=>{const k={...v};return delete k[V],k}),J(null),f(null))},Ne=i.useRef({nodeId:null,edgeIds:[]}),Be=v=>{var T;const k=((T=v.nodes[0])==null?void 0:T.id)??null,Y=v.edges.map(D=>D.id),t=Ne.current,r=t.nodeId===k,h=t.edgeIds.length===Y.length&&t.edgeIds.every((D,Z)=>D===Y[Z]);r&&h||(Ne.current={nodeId:k,edgeIds:Y},J(k),s(Y))},Se=v=>{const k=v.filter(Y=>Y.type!=="select"&&Y.type!=="dimensions");k.length!==0&&C(Y=>gi(k,Y))},Qe=v=>{const k=v.filter(Y=>Y.type!=="select");k.length!==0&&x(Y=>ui(k,Y))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodeTypes:Me,nodes:F,edges:m,onNodesChange:Se,onEdgesChange:Qe,onConnect:oe,onNodeClick:(v,k)=>J(k.id),onSelectionChange:Be,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>le("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>le("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>le("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>le("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>le("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>le("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>le("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>le("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>le("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>le("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>le("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>le("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>le("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>le("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>le("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>le("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>le("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>le("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>le("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>le("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),ve?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Ve=ve.data)==null?void 0:Ve.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:v=>ke({name:v.target.value})}),b?e.jsx("em",{className:"cogita-help",children:b}):null,Q?e.jsx("em",{className:"cogita-help",children:Q}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((ze=u[((Ee=ve.data)==null?void 0:Ee.type)??""])==null?void 0:ze.label)??((sa=ve.data)==null?void 0:sa.type)]}),((Re=ve.data)==null?void 0:Re.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((W=ve.data)==null?void 0:W.outputLabel)??"",onChange:v=>ke({outputLabel:v.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((ee=ve.data)==null?void 0:ee.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Ke=ve.data)==null?void 0:Ke.min)??0,onChange:v=>ke({min:Number(v.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Le=ve.data)==null?void 0:Le.max)??10,onChange:v=>ke({max:Number(v.target.value)})})]})]}),((fe=ve.data)==null?void 0:fe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:(($e=ve.data)==null?void 0:$e.value)??0,onChange:v=>ke({value:Number(v.target.value)})})]}),((qe=ve.data)==null?void 0:qe.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Ae=ve.data)==null?void 0:Ae.list)??[]).join(`
`),onChange:v=>ke({list:v.target.value.split(`
`).map(k=>k.replace(/\r$/,"")).filter(k=>k.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((Oe=ve.data)==null?void 0:Oe.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{V&&(G(v=>{var h,T,D,Z;const k=Number.isFinite((h=ve.data)==null?void 0:h.min)?Number((T=ve.data)==null?void 0:T.min):0,Y=Number.isFinite((D=ve.data)==null?void 0:D.max)?Number((Z=ve.data)==null?void 0:Z.max):k+10,t=Math.min(k,Y),r=Math.max(k,Y);return{...v,[V]:Math.floor(Math.random()*(r-t+1))+t}}),ne(v=>v+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Te,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const rr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function jr(a,n,o){if(!a)return null;const u=new Map(a.nodes.map(A=>[A.id,A])),g=new Map,w=new Set,p=A=>{if(typeof A=="number")return A;if(typeof A=="string"){const j=Number(A);return Number.isFinite(j)?j:0}return 0},I=A=>{if(g.has(A))return g.get(A);if(w.has(A))return 0;const j=u.get(A);if(!j)return 0;w.add(A);const G=ne=>{var O,ge;return(ne?((O=j.inputsByHandle)==null?void 0:O[ne])??[]:j.inputs??((ge=j.inputsByHandle)==null?void 0:ge.in)??[]).map(pe=>I(pe))};let P=0;switch(j.type){case"input.random":{const ne=j.min??0,K=j.max??ne+10,O=Math.min(ne,K),ge=Math.max(ne,K);P=Math.floor(Math.random()*(ge-O+1))+O;break}case"input.const":{P=j.value??0;break}case"input.list":{const ne=(j.list??[]).filter(Boolean),K=Math.round(p(G("index")[0]));P=ne.length?ne[Math.max(0,Math.min(ne.length-1,K))]:String(K);break}case"compute.add":{P=G("in").map(K=>p(K)).reduce((K,O)=>K+O,0);break}case"compute.sub":{const ne=G("add").map(O=>p(O)),K=G("sub").map(O=>p(O));P=ne.reduce((O,ge)=>O+ge,0)-K.reduce((O,ge)=>O+ge,0);break}case"compute.mul":{const ne=G("in").map(K=>p(K));P=ne.length?ne.reduce((K,O)=>K*O,1):0;break}case"compute.div":{const ne=p(G("num")[0]),K=G("den").map(O=>p(O)).reduce((O,ge)=>O+ge,0);P=Math.abs(K)<Number.EPSILON?0:ne/K;break}case"compute.pow":{const ne=p(G("base")[0]),K=p(G("exp")[0]);P=Math.pow(ne,K);break}case"compute.exp":{const ne=p(G("base")[0]),K=p(G("exp")[0]);P=Math.pow(ne,K);break}case"compute.log":{const ne=p(G("value")[0]),K=p(G("base")[0]),O=Math.max(ne,Number.EPSILON);P=Math.abs(K)<Number.EPSILON?Math.log(O):Math.log(O)/Math.log(K);break}case"compute.abs":{P=Math.abs(p(G("in")[0]));break}case"compute.min":{const ne=G("in").map(K=>p(K));P=ne.length?Math.min(...ne):0;break}case"compute.max":{const ne=G("in").map(K=>p(K));P=ne.length?Math.max(...ne):0;break}case"compute.floor":{P=Math.floor(p(G("in")[0]));break}case"compute.ceil":{P=Math.ceil(p(G("in")[0]));break}case"compute.round":{P=Math.round(p(G("in")[0]));break}case"compute.mod":{const ne=p(G("a")[0]),K=p(G("b")[0]);P=Math.abs(K)<Number.EPSILON?0:ne%K;break}case"compute.concat":{const K=["in1","in2","in3","in4","in5","in6"].flatMap(ve=>G(ve)),O=K.length?K:G("in");P=(O.length?O:G()).map(ve=>ve==null?"":String(ve)).join("");break}case"compute.trim":{const ne=G("text")[0]??G("in")[0]??"",K=ne==null?"":String(ne),O=Math.max(0,Math.round(p(G("start")[0]))),ge=Math.max(0,Math.round(p(G("end")[0])));O+ge>=K.length?P="":P=K.substring(O,K.length-ge);break}case"output":{P=G("in")[0]??0;break}default:P=0}return w.delete(A),g.set(A,P),P},M=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(A=>A.type==="output").map(A=>A.id);a.nodes.forEach(A=>I(A.id)),M.forEach(A=>I(A));const E=A=>Math.abs(A%1)<1e-5?String(Math.round(A)):A.toFixed(3).replace(/\.?0+$/,""),l=A=>typeof A=="number"?E(A):A??"",C=new Map;M.forEach(A=>{var K,O,ge,pe;const j=u.get(A);if(!j)return;const G=(O=(K=j.inputsByHandle)==null?void 0:K.name)==null?void 0:O[0],P=G?l(g.get(G)):"",ne=(P==null?void 0:P.toString().trim())||((ge=j.outputLabel)==null?void 0:ge.trim())||((pe=j.name)==null?void 0:pe.trim())||A;C.set(A,ne)});const m={},x={},V={};M.forEach(A=>{var P,ne;const j=u.get(A);if(!j)return;const G=C.get(A)??(((P=j.outputLabel)==null?void 0:P.trim())||((ne=j.name)==null?void 0:ne.trim())||A);m[G]=l(g.get(A)),j.name&&(x[j.name.trim()]=G),x[A]=G});const J=(A,j)=>{let G=A;return a.nodes.forEach(P=>{var pe,ve;const ne=l(g.get(P.id)),K=M.includes(P.id),O=K?C.get(P.id)??((pe=P.outputLabel)==null?void 0:pe.trim())??((ve=P.name)==null?void 0:ve.trim())??P.id:"",ge=K&&j?O:ne;G=G.replace(new RegExp(`\\{\\s*${rr(P.id)}\\s*\\}`,"gi"),ge),P.name&&(G=G.replace(new RegExp(`\\{\\s*${rr(P.name)}\\s*\\}`,"gi"),ge)),K&&P.outputLabel&&(G=G.replace(new RegExp(`\\{\\s*${rr(P.outputLabel)}\\s*\\}`,"gi"),O))}),G},q=n;let s=q.trim().length>0?q:"";s||(s=M.length?`Compute ${M.join(", ")}`:"Compute"),s=J(s,!0);const b=(o==null?void 0:o.trim())??"",f=b?J(b,!1):"",Q={};return g.forEach((A,j)=>{Q[j]=A,V[j]=l(A);const G=u.get(j);G!=null&&G.name&&(V[G.name.trim()]=l(A))}),{prompt:s,answers:m,values:Q,answerText:f,outputVariables:x,variableValues:V}}function Xr(a){var o;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((o=n[0])==null?void 0:o[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function nn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,editInfoId:C}){const{libraryName:m}=Oa(l),x=!!C,V=`/#/cogita/library/${l}`,[J,q]=i.useState("info"),[s,b]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[f,Q]=i.useState(""),[A,j]=i.useState(null),[G,P]=i.useState(null),[ne,K]=i.useState("idle"),[O,ge]=i.useState(null),[pe,ve]=i.useState(-1),[F,ce]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[c,ie]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[re,B]=i.useState(null),[Me,oe]=i.useState("idle"),[le,ke]=i.useState(null),[Te,Ne]=i.useState(null),[Be,Se]=i.useState(null),Qe=i.useRef(null),Ve=i.useRef(null),Ee=i.useRef(null),ze=i.useMemo(()=>Gr(a),[a]),sa=i.useMemo(()=>Gi(a),[a]),Re=i.useMemo(()=>Xi(a),[a]),W=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),ee=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Ke=i.useMemo(()=>ze.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[ze]),Le=i.useMemo(()=>{const t=M;return Ft.map(r=>{var D;const h=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${h.abbr} — ${h.name}`,latin:((D=r==null?void 0:r.la)==null?void 0:D.abbr)??h.abbr}})},[M]),fe=(t,r=!1)=>{const h=t.trim().toLowerCase();return h?Le.filter(T=>T.label.toLowerCase().includes(h)).slice(0,8):r?Le.slice(0,8):[]},$e=(t,r)=>{const h=t.trim().toLowerCase();if(!h)return null;const T=Ft;for(const D of T){const Z=D==null?void 0:D.la,te=(D==null?void 0:D[r])??(D==null?void 0:D.en)??Z;if([te==null?void 0:te.abbr,te==null?void 0:te.name,Z==null?void 0:Z.abbr,Z==null?void 0:Z.name,`${te==null?void 0:te.abbr} — ${te==null?void 0:te.name}`].filter(Boolean).map(de=>de.toLowerCase()).some(de=>de===h))return{book:D,entry:te,la:Z}}return null};i.useEffect(()=>{if(!F.language||!F.word){ke(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:F.language.id,wordId:F.word.id}).then(r=>{ke(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{ke(null)})},200);return()=>window.clearTimeout(t)},[l,F.language,F.word]),i.useEffect(()=>{if(!c.languageA||!c.wordA){Ne(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:c.languageA.id,wordId:c.wordA.id}).then(r=>{Ne(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Ne(null)})},200);return()=>window.clearTimeout(t)},[l,c.languageA,c.wordA]),i.useEffect(()=>{if(!c.languageB||!c.wordB){Se(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:c.languageB.id,wordId:c.wordB.id}).then(r=>{Se(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Se(null)})},200);return()=>window.clearTimeout(t)},[l,c.languageB,c.wordB]),i.useEffect(()=>{if(!x||!C)return;let t=!1;return oe("loading"),B(null),Za({libraryId:l,infoId:C}).then(async r=>{var T,D;if(t)return;const h=r.payload??{};if(b(Z=>({...Z,infoType:r.infoType,label:h.label??"",notes:h.notes??"",language:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,sourceKind:h.sourceKind??"string",sourceResourceType:Z.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:h.text??"",workLanguage:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,workOriginalLanguage:h.originalLanguageId?{id:h.originalLanguageId,label:h.originalLanguageId,infoType:"language"}:null,workDoi:h.doi??"",mediaType:h.mediaType??"book",mediaPublisher:h.publisher??"",mediaPublicationPlace:h.publicationPlace??"",mediaPublicationYear:h.publicationYear??"",mediaPages:h.pages??"",mediaIsbn:h.isbn??"",mediaCover:h.cover??"",mediaHeight:h.height??"",mediaLength:h.length??"",mediaWidth:h.width??"",mediaWeight:h.weight??"",mediaCollection:h.collection??"",mediaLocation:h.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&h.locator&&typeof h.locator=="object"){const Z=h.locator;if(h.sourceKind==="website")b(te=>({...te,sourceUrl:typeof Z.url=="string"?Z.url:"",sourceAccessedDate:typeof Z.date=="string"?Z.date:""}));else if(h.sourceKind==="bible"){const te=typeof Z.book=="string"?Z.book:"",ae=te?$e(te,M):null,de=ae?`${ae.entry.abbr} — ${ae.entry.name}`:te;b(se=>({...se,sourceLocatorValue:te,sourceLocatorAux:typeof Z.rest=="string"?Z.rest:"",sourceBibleBookDisplay:de}))}else h.sourceKind==="book"?b(te=>({...te,sourceLocatorValue:typeof Z.page=="string"?Z.page:""})):h.sourceKind==="number_document"?b(te=>({...te,sourceLocatorValue:typeof Z.number=="string"?Z.number:""})):typeof Z.text=="string"&&b(te=>({...te,sourceLocatorValue:Z.text}))}if(h.languageId&&r.infoType!=="work")try{const Z=await Za({libraryId:l,infoId:h.languageId});if(t)return;b(te=>{var ae;return{...te,language:{id:h.languageId,label:((ae=Z.payload)==null?void 0:ae.label)??h.languageId,infoType:"language"}}})}catch{}if(h.languageId&&r.infoType==="work")try{const Z=await Za({libraryId:l,infoId:h.languageId});if(t)return;b(te=>{var ae;return{...te,workLanguage:{id:h.languageId,label:((ae=Z.payload)==null?void 0:ae.label)??h.languageId,infoType:"language"}}})}catch{}if(h.originalLanguageId)try{const Z=await Za({libraryId:l,infoId:h.originalLanguageId});if(t)return;b(te=>{var ae;return{...te,workOriginalLanguage:{id:h.originalLanguageId,label:((ae=Z.payload)==null?void 0:ae.label)??h.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(Q(((T=h.definition)==null?void 0:T.answerTemplate)??""),j(((D=h.definition)==null?void 0:D.graph)??null),P(null),K("idle")):(Q(""),j(null),P(null),K("idle")),q("info")}).catch(()=>{t||B(a.cogita.library.add.info.failed)}).finally(()=>{t||oe("idle")}),()=>{t=!0}},[a,C,x,l]),i.useEffect(()=>{if(s.sourceKind==="bible"&&s.sourceLocatorValue&&O!=="source"){const t=$e(s.sourceLocatorValue,M);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==s.sourceBibleBookDisplay&&b(h=>({...h,sourceBibleBookDisplay:r}))}}},[M,s.sourceKind,s.sourceLocatorValue,s.sourceBibleBookDisplay]);const qe=async()=>{var t,r;B(null);try{const h={label:s.infoType==="quote"||s.infoType==="source"?"":s.label,notes:s.infoType==="computed"?"":s.notes};if(s.language&&(s.infoType==="word"||s.infoType==="sentence")&&(h.languageId=s.language.id),s.infoType==="source"&&(h.sourceKind=s.sourceKind,s.sourceKind==="website"?h.locator={url:s.sourceUrl.trim(),date:s.sourceAccessedDate.trim()}:s.sourceKind==="bible"?h.locator={book:s.sourceLocatorValue.trim(),rest:s.sourceLocatorAux.trim()}:s.sourceKind==="book"?h.locator={page:s.sourceLocatorValue.trim()}:s.sourceKind==="number_document"?h.locator={number:s.sourceLocatorValue.trim()}:h.locator={text:s.sourceLocatorValue.trim()}),s.infoType==="quote"&&(h.text=s.quoteText),s.infoType==="work"&&(h.languageId=((t=s.workLanguage)==null?void 0:t.id)??null,h.originalLanguageId=((r=s.workOriginalLanguage)==null?void 0:r.id)??null,h.doi=s.workDoi.trim()),s.infoType==="media"&&(h.mediaType=s.mediaType,h.publisher=s.mediaPublisher.trim(),h.publicationPlace=s.mediaPublicationPlace.trim(),h.publicationYear=s.mediaPublicationYear.trim(),h.pages=s.mediaPages.trim(),h.isbn=s.mediaIsbn.trim(),h.cover=s.mediaCover.trim(),h.height=s.mediaHeight.trim(),h.length=s.mediaLength.trim(),h.width=s.mediaWidth.trim(),h.weight=s.mediaWeight.trim(),h.collection=s.mediaCollection.trim(),h.location=s.mediaLocation.trim()),s.infoType==="computed"){if(!A){B(a.cogita.library.add.info.computedRequired);return}if(!f.trim()){B(a.cogita.library.add.info.computedAnswerRequired);return}if(A.nodes.find(se=>se.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(se.name))){B(a.cogita.library.add.info.computedInvalidName);return}const D=A.nodes.map(se=>{var we;return(we=se.name)==null?void 0:we.trim()}).filter(Boolean),Z=new Set;for(const se of D){const we=se.toLowerCase();if(Z.has(we)){B(a.cogita.library.add.info.computedDuplicateName);return}Z.add(we)}const te=A.nodes.filter(se=>se.type==="output"),ae=te.map(se=>{var we;return(we=se.name)==null?void 0:we.trim()}).filter(Boolean);if(ae.length!==te.length){B(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!ae.every(se=>new RegExp(`\\{\\s*${se}\\s*\\}`,"i").test(f))){B(a.cogita.library.add.info.computedAnswerMissingOutput);return}h.definition={answerTemplate:f,graph:A}}if(x&&C)oe("saving"),await pi({libraryId:l,infoId:C,payload:h}),B(a.cogita.library.add.info.updated),oe("idle");else{let T=null;if(s.referenceEnabled){const se={sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},{payload:we,resourceInfoId:aa,error:Ge}=Ae(se);if(Ge){B(a.cogita.library.add.info.referenceMissingSource);return}T={payload:we,resourceInfoId:aa}}const D=await Ua({libraryId:l,infoType:s.infoType,payload:h});if(s.infoType==="source"&&s.sourceResource&&await da({libraryId:l,connectionType:"source-resource",infoIds:[D.infoId,s.sourceResource.id]}),s.infoType==="quote"&&s.language&&await da({libraryId:l,connectionType:"quote-language",infoIds:[D.infoId,s.language.id]}),T){const se=await Ua({libraryId:l,infoType:"source",payload:T.payload});T.resourceInfoId&&await da({libraryId:l,connectionType:"source-resource",infoIds:[se.infoId,T.resourceInfoId]}),await da({libraryId:l,connectionType:"reference",infoIds:[D.infoId,se.infoId]})}B(a.cogita.library.add.info.saved);const Z=s.infoType==="word"||s.infoType==="sentence",te=s.referenceEnabled,ae=s.referenceSourceKind,de={referenceEnabled:te,referenceSourceKind:te?ae:"string",referenceSourceUrl:te&&ae==="website"?s.referenceSourceUrl:"",referenceSourceAccessedDate:te&&ae==="website"?s.referenceSourceAccessedDate:"",referenceChurchDocument:te&&ae==="number_document"?s.referenceChurchDocument:null,referenceBookMedia:te&&ae==="book"?s.referenceBookMedia:null,referenceWork:te&&ae==="work"?s.referenceWork:null,referenceLocatorValue:te&&ae==="bible"?s.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:te&&ae==="bible"?s.referenceBibleBookDisplay:""};b({infoType:s.infoType,label:"",language:Z?s.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:s.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...de}),s.infoType==="computed"&&(Q(""),j(null),P(null),K("idle"))}}catch{B(a.cogita.library.add.info.failed)}},Ae=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const h={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(h.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:h,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(h.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:h,resourceInfoId:r}):(t.sourceKind==="book"?h.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?h.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(h.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:h,resourceInfoId:r})},Oe=()=>{if(K("idle"),!A){P(null),K("error");return}const t=jr(A,"",f);if(!t){P(null),K("error");return}P({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),K("ready")},v=async()=>{B(null);try{if(F.connectionType==="reference"){if(!F.referencedInfo||!F.source){B(a.cogita.library.add.connection.selectReference);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.referencedInfo.id,F.source.id]})}else if(F.connectionType==="source-resource"){if(!F.source||!F.sourceResource){B(a.cogita.library.add.connection.selectSourceResource);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.source.id,F.sourceResource.id]})}else if(F.connectionType==="quote-language"){if(!F.quote||!F.language){B(a.cogita.library.add.connection.selectQuoteLanguage);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.quote.id,F.language.id]})}else if(F.connectionType==="work-contributor"){if(!F.work||!F.contributor||!F.contributorRole.trim()){B(a.cogita.library.add.connection.selectWorkContributor);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.work.id,F.contributor.id],payload:{role:F.contributorRole.trim()}})}else if(F.connectionType==="work-medium"){if(!F.work||!F.medium){B(a.cogita.library.add.connection.selectWorkMedium);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.work.id,F.medium.id]})}else if(F.connectionType==="orcid-link"){if(!F.orcidEntity||!F.orcid){B(a.cogita.library.add.connection.selectOrcidLink);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.orcidEntity.id,F.orcid.id]})}else if(F.connectionType==="word-language"){if(!F.language||!F.word){B(a.cogita.library.add.connection.selectWordLanguage);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.language.id,F.word.id],payload:{note:F.note}})}else if(F.connectionType==="word-topic"){if(!F.word||!F.topic){B(a.cogita.library.add.connection.selectWordTopic);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.word.id,F.topic.id],payload:{note:F.note}})}else if(F.connectionType==="translation"){if(!F.wordA||!F.wordB){B(a.cogita.library.add.connection.selectTwoWords);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.wordA.id,F.wordB.id],payload:{note:F.note}})}else if(F.connectionType==="language-sentence"){if(!F.language||!F.sentence){B(a.cogita.library.add.connection.selectLanguageSentence);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.language.id,F.sentence.id],payload:{note:F.note}})}B(a.cogita.library.add.connection.saved),ce(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{B(a.cogita.library.add.connection.failed)}},k=async()=>{var t,r;B(null);try{if(c.groupType==="citation"){const T=c.citationTitle.trim(),D=c.citationQuoteText.trim();if(!D){B(a.cogita.library.add.group.citationMissingQuote);return}let Z=null;if(c.citationReferenceEnabled){const de={sourceKind:c.citationSourceKind,locatorValue:c.citationLocatorValue,locatorAux:c.citationLocatorAux,bibleBookDisplay:c.citationBibleBookDisplay,sourceUrl:c.citationSourceUrl,sourceAccessedDate:c.citationSourceAccessedDate,churchDocument:c.citationChurchDocument,bookMedia:c.citationBookMedia,work:c.citationWork},{payload:se,resourceInfoId:we,error:aa}=Ae(de);if(aa){B(a.cogita.library.add.info.referenceMissingSource);return}Z={payload:se,resourceInfoId:we}}const te={text:D};T&&(te.title=T);const ae=await Ua({libraryId:l,infoType:"quote",payload:te});if(c.citationLanguage&&await da({libraryId:l,connectionType:"quote-language",infoIds:[ae.infoId,c.citationLanguage.id]}),Z){const de=await Ua({libraryId:l,infoType:"source",payload:Z.payload});Z.resourceInfoId&&await da({libraryId:l,connectionType:"source-resource",infoIds:[de.infoId,Z.resourceInfoId]}),await da({libraryId:l,connectionType:"reference",infoIds:[ae.infoId,de.infoId]})}B(a.cogita.library.add.group.savedCitation),ie(de=>({...de,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:de.citationReferenceEnabled,citationSourceKind:de.citationReferenceEnabled?de.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:de.citationReferenceEnabled?de.citationChurchDocument:null,citationBookMedia:de.citationReferenceEnabled?de.citationBookMedia:null,citationWork:de.citationReferenceEnabled?de.citationWork:null}));return}if(c.groupType==="book"){const T=c.bookTitle.trim();if(!T){B(a.cogita.library.add.group.bookMissingTitle);return}const D=c.bookWorkTitle.trim();if(!D){B(a.cogita.library.add.group.bookMissingWork);return}if(c.bookContributors.find(se=>se.contributor&&!se.role.trim()||!se.contributor&&se.role.trim())){B(a.cogita.library.add.group.bookMissingContributor);return}const te=await Ua({libraryId:l,infoType:"media",payload:{label:T,mediaType:"book",publisher:c.bookPublisher.trim(),publicationPlace:c.bookPublicationPlace.trim(),publicationYear:c.bookPublicationYear.trim(),pages:c.bookPages.trim(),isbn:c.bookIsbn.trim(),cover:c.bookCover.trim(),height:c.bookHeight.trim(),length:c.bookLength.trim(),width:c.bookWidth.trim(),weight:c.bookWeight.trim(),collection:c.bookCollection.trim(),location:c.bookLocation.trim()}}),ae=await Ua({libraryId:l,infoType:"work",payload:{label:D,languageId:((t=c.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=c.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:c.bookWorkDoi.trim()}});await da({libraryId:l,connectionType:"work-medium",infoIds:[ae.infoId,te.infoId]});const de=c.bookContributors.filter(se=>se.contributor&&se.role.trim());for(const se of de)await da({libraryId:l,connectionType:"work-contributor",infoIds:[ae.infoId,se.contributor.id],payload:{role:se.role.trim()}});B(a.cogita.library.add.group.savedBook),ie(se=>({...se,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!c.languageA||!c.wordA||!c.languageB||!c.wordB){B(a.cogita.library.add.group.selectBoth);return}const h=T=>Array.from(new Map(T.map(D=>[D.id,D])).values());Te||await da({libraryId:l,connectionType:"word-language",infoIds:[c.languageA.id,c.wordA.id]}),Be||await da({libraryId:l,connectionType:"word-language",infoIds:[c.languageB.id,c.wordB.id]});for(const T of h(c.wordATags))await da({libraryId:l,connectionType:"word-topic",infoIds:[c.wordA.id,T.id]});for(const T of h(c.wordBTags))await da({libraryId:l,connectionType:"word-topic",infoIds:[c.wordB.id,T.id]});await da({libraryId:l,connectionType:"translation",infoIds:[c.wordA.id,c.wordB.id],payload:{tagIds:h(c.translationTags).map(T=>T.id)}}),B(a.cogita.library.add.group.savedVocab),ie(T=>({...T,groupType:c.groupType,languageA:c.languageA,wordA:null,languageB:c.languageB,wordB:null,wordATags:c.wordATags,wordBTags:c.wordBTags,translationTags:c.translationTags})),requestAnimationFrame(()=>{var T;return(T=Qe.current)==null?void 0:T.focus()})}catch{B(a.cogita.library.add.group.failed)}},Y=c.groupType==="citation"?a.cogita.library.add.group.saveCitation:c.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:V,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${V}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":J===t,onClick:()=>{x||q(t)},disabled:x&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[J==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:s.infoType,onChange:t=>{x||b(r=>({...r,infoType:t.target.value}))},disabled:x,children:ze.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.infoType!=="quote"&&s.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:s.label,onChange:t=>b(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(s.infoType==="word"||s.infoType==="sentence"||s.infoType==="quote")&&e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:s.language,onChange:t=>b(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),s.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:s.workLanguage,onChange:t=>b(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:s.workOriginalLanguage,onChange:t=>b(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:s.workDoi,onChange:t=>b(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),s.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:s.mediaType,onChange:t=>b(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:s.mediaPublisher,onChange:t=>b(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationPlace,onChange:t=>b(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationYear,onChange:t=>b(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:s.mediaPages,onChange:t=>b(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:s.mediaIsbn,onChange:t=>b(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:s.mediaCover,onChange:t=>b(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:s.mediaHeight,onChange:t=>b(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:s.mediaLength,onChange:t=>b(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:s.mediaWidth,onChange:t=>b(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:s.mediaWeight,onChange:t=>b(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:s.mediaCollection,onChange:t=>b(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:s.mediaLocation,onChange:t=>b(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),s.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:s.quoteText,onChange:t=>b(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),s.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:s.sourceKind,onChange:t=>{const r=t.target.value,h=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":s.sourceResourceType;b(T=>({...T,sourceKind:r,sourceResourceType:h,sourceResource:null,sourceLocatorValue:r==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?T.sourceBibleBookDisplay:""}))},children:W.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:s.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;b(h=>({...h,sourceBibleBookDisplay:r,sourceLocatorValue:""})),ge("source"),ve(-1)},onKeyDown:t=>{const r=fe(s.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),ve(h=>Math.min(h+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),ve(h=>Math.max(h-1,0));else if((t.key==="Enter"||t.key==="Tab")&&pe>=0&&r[pe]){const h=r[pe],T=$e(h.label,M);if(!T)return;b(D=>{var Z;return{...D,sourceBibleBookDisplay:h.label,sourceLocatorValue:((Z=T.la)==null?void 0:Z.abbr)??D.sourceLocatorValue}}),ge(null)}}},onFocus:()=>ge("source"),onBlur:()=>window.setTimeout(()=>ge(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),O==="source"&&fe(s.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:fe(s.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===pe,tabIndex:-1,onMouseDown:()=>{const h=$e(t.label,M);h&&b(T=>{var D;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((D=h.la)==null?void 0:D.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorAux,onChange:t=>b(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),s.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:s.sourceUrl,onChange:t=>b(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:s.sourceAccessedDate,onChange:t=>b(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorValue,onChange:t=>b(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),s.sourceKind!=="string"&&s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:s.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(s.sourceKind),onChange:t=>b(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ke.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(We,{libraryId:l,infoType:s.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:s.sourceResource,onChange:t=>b(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,s.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),s.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:s.notes,onChange:t=>b(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,s.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:f,onChange:t=>Q(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(rn,{copy:a,value:A,onChange:t=>j(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Oe,children:a.cogita.library.add.info.computedPreview})}),G&&ne==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(Et,{value:G.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(G.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(br,{value:r,mode:"auto"})]},t))}),G.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(Et,{value:G.answerText,mode:"auto"})]}):null]}):ne==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.referenceEnabled,onChange:t=>b(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),s.referenceEnabled&&e.jsx(Ar,{libraryId:l,copy:a,language:M,sourceKindOptions:W,labels:ee,value:{sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},onChange:t=>b(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:qe,disabled:Me==="saving"||Me==="loading",children:x?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,J==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:F.connectionType,onChange:t=>ce(r=>({...r,connectionType:t.target.value})),children:sa.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),F.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:F.language,onChange:t=>ce(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:F.word,onChange:t=>ce(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),le&&e.jsx("p",{className:"cogita-help",children:le})]}),F.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:F.word,onChange:t=>ce(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:F.topic,onChange:t=>ce(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:F.wordA,onChange:t=>ce(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:F.wordB,onChange:t=>ce(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:F.quote,onChange:t=>ce(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:F.language,onChange:t=>ce(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:F.language,onChange:t=>ce(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:F.sentence,onChange:t=>ce(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:F.referencedInfoType,onChange:t=>ce(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:ze.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(We,{libraryId:l,infoType:F.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:F.referencedInfo,onChange:t=>ce(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,F.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:F.source,onChange:t=>ce(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:F.source,onChange:t=>ce(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:F.sourceResourceType,onChange:t=>ce(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ke.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(We,{libraryId:l,infoType:F.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:F.sourceResource,onChange:t=>ce(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,F.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:F.work,onChange:t=>ce(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:F.contributorType,onChange:t=>ce(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ra(a,t)},t))})]}),e.jsx(We,{libraryId:l,infoType:F.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:F.contributor,onChange:t=>ce(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,F.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:F.contributorRole,onChange:t=>ce(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),F.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:F.work,onChange:t=>ce(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:F.medium,onChange:t=>ce(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:F.orcidEntityType,onChange:t=>ce(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ra(a,t)},t))})]}),e.jsx(We,{libraryId:l,infoType:F.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:F.orcidEntity,onChange:t=>ce(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,F.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(We,{libraryId:l,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:F.orcid,onChange:t=>ce(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:F.note,onChange:t=>ce(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:v,children:a.cogita.library.add.connection.save})})]}):null,J==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:c.groupType,onChange:t=>ie(r=>({...r,groupType:t.target.value})),children:Re.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),c.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:c.citationLanguage,onChange:t=>ie(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:c.citationTitle,onChange:t=>ie(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:c.citationQuoteText,onChange:t=>ie(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:c.citationReferenceEnabled,onChange:t=>ie(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),c.citationReferenceEnabled&&e.jsx(Ar,{libraryId:l,copy:a,language:M,sourceKindOptions:W,labels:ee,value:{sourceKind:c.citationSourceKind,locatorValue:c.citationLocatorValue,locatorAux:c.citationLocatorAux,bibleBookDisplay:c.citationBibleBookDisplay,sourceUrl:c.citationSourceUrl,sourceAccessedDate:c.citationSourceAccessedDate,churchDocument:c.citationChurchDocument,bookMedia:c.citationBookMedia,work:c.citationWork},onChange:t=>ie(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),c.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:c.bookTitle,onChange:t=>ie(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:c.bookPublisher,onChange:t=>ie(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:c.bookPublicationPlace,onChange:t=>ie(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:c.bookPublicationYear,onChange:t=>ie(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:c.bookPages,onChange:t=>ie(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:c.bookIsbn,onChange:t=>ie(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:c.bookCover,onChange:t=>ie(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:c.bookHeight,onChange:t=>ie(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:c.bookLength,onChange:t=>ie(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:c.bookWidth,onChange:t=>ie(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:c.bookWeight,onChange:t=>ie(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:c.bookCollection,onChange:t=>ie(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:c.bookLocation,onChange:t=>ie(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:c.bookWorkTitle,onChange:t=>ie(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:c.bookWorkLanguage,onChange:t=>ie(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:c.bookWorkOriginalLanguage,onChange:t=>ie(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:c.bookWorkDoi,onChange:t=>ie(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>ie(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),c.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:h=>ie(T=>({...T,bookContributors:T.bookContributors.map((D,Z)=>Z===r?{...D,contributorType:h.target.value,contributor:null}:D)})),children:["person","institution","collective"].map(h=>e.jsx("option",{value:h,children:ra(a,h)},h))})]}),e.jsx(We,{libraryId:l,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:h=>ie(T=>({...T,bookContributors:T.bookContributors.map((D,Z)=>Z===r?{...D,contributor:h}:D)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:h=>ie(T=>({...T,bookContributors:T.bookContributors.map((D,Z)=>Z===r?{...D,role:h.target.value}:D)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>ie(h=>{const T=h.bookContributors.filter((D,Z)=>Z!==r);return T.length===0?{...h,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...h,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),c.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:c.languageA,onChange:t=>ie(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:c.languageB,onChange:t=>ie(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:c.wordA,onChange:t=>ie(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Qe,autoAdvance:!0,onCommit:()=>{var t;return(t=Ve.current)==null?void 0:t.focus()}}),e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:c.wordB,onChange:t=>ie(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Ve,autoAdvance:!0,onCommit:()=>{var t;return(t=Ee.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:c.translationTags,onChangeMultiple:t=>ie(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:c.wordATags,onChangeMultiple:t=>ie(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:c.wordBTags,onChangeMultiple:t=>ie(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),c.groupType==="vocab"&&Te&&e.jsx("p",{className:"cogita-help",children:Te}),c.groupType==="vocab"&&Be&&e.jsx("p",{className:"cogita-help",children:Be}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:k,ref:Ee,children:Y})})]}):null,re?e.jsx("p",{className:"cogita-form-error",children:re}):null]})})})})})]})})}const Fr=a=>/\s/.test(a),Bt=a=>/[\p{L}\p{N}]/u.test(a),Br=(a,n)=>{const o=n>0?a[n-1]:"",u=n<a.length?a[n]:"";if(!o||!u)return 0;const g=Fr(o),w=Fr(u);if(g||w)return 3;const p=Bt(o),I=Bt(u);return p!==I?2:!p&&!I?1:0},ir=(a,n,o,u,g)=>{const w=Math.max(u-n,o-u);for(let p=0;p<=w;p+=1){const I=u-p;if(I>=n&&I<=o&&Br(a,I)>=g)return I;const M=u+p;if(M>=n&&M<=o&&Br(a,M)>=g)return M}return null},nr=(a,n)=>{const o=n>0?a[n-1]:"",u=n<a.length?a[n]:"";return!o||!u?!0:Bt(o)!==Bt(u)},ln=(a,n,o,u)=>{const g=o-n,w=n+u,p=o-u;if(g<=u*2||p<=w)return null;const I=Math.floor((n+o)/2),M=ir(a,w,p,I,3);if(M!==null&&nr(a,M))return M;const E=ir(a,w,p,I,2);if(E!==null&&nr(a,E))return E;const l=ir(a,w,p,I,1);return l!==null&&nr(a,l)?l:null},bt=(a,n)=>{const o=Math.max(1,7),u=Math.max(o,13),g={},w=(M,E,l,C,m)=>{const x=String(C),V={id:x,start:M,end:E,text:a.slice(M,E),depth:l,index:C,parentId:m};if(g[x]=V,E-M>u){let q=ln(a,M,E,o);if(q!==null&&q>M&&q<E){const s=w(M,q,l+1,C*2+1,x),b=w(q,E,l+1,C*2+2,x);V.leftId=s.id,V.rightId=b.id}}return V},p=w(0,a.length,0,0),I=Object.values(g).sort((M,E)=>E.depth-M.depth||M.start-E.start).map(M=>M.id);return{text:a,rootId:p.id,nodes:g,order:I}},gt=(a,n,o,u,g,w,p)=>{const I=w==="reverse"?a.order.slice().sort((M,E)=>a.nodes[E].start-a.nodes[M].start||a.nodes[E].depth-a.nodes[M].depth):a.order;for(const M of I){if(p&&M===p||n.has(M))continue;const E=a.nodes[M];if(E){if(g&&(E.leftId||E.rightId)){const l=E.leftId?o[E.leftId]??0:u,C=E.rightId?o[E.rightId]??0:u;if((l+C)/2<u)continue}return E}}return null},Zr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function on({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const C=`/#/cogita/library/${l}`,[m,x,V]=Or([]),[J,q,s]=Vr([]),[b,f]=i.useState(null),[Q,A]=i.useState(null),[j,G]=i.useState(null),[P,ne]=i.useState(null),K=i.useMemo(()=>m.find(c=>c.id===b)??null,[m,b]);i.useEffect(()=>{let c=!0;return fi({libraryId:l}).then(ie=>{if(!c)return;const re=ie.nodes.map(B=>{var Me,oe,le;return{id:B.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:B.payload&&typeof B.payload=="object"&&"label"in B.payload?String(B.payload.label):"Item",nodeType:B.nodeType,itemType:((Me=B.payload)==null?void 0:Me.itemType)??"info",itemId:((oe=B.payload)==null?void 0:oe.itemId)??null,infoType:((le=B.payload)==null?void 0:le.infoType)??null}}});x(re),q(ie.edges.map(B=>({id:B.edgeId,source:B.fromNodeId,target:B.toNodeId})))}).catch(()=>{c&&(x([]),q([]))}),()=>{c=!1}},[l]),i.useEffect(()=>{xi({libraryId:l}).then(A).catch(()=>A(null))},[l,m,J]);const O=i.useCallback(c=>{q(ie=>Rt(c,ie))},[]),ge=()=>{const c=crypto.randomUUID();x(ie=>[...ie,{id:c,type:"default",position:{x:140+ie.length*40,y:120+ie.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},pe=()=>{const c=crypto.randomUUID();x(ie=>[...ie,{id:c,type:"default",position:{x:180+ie.length*40,y:160+ie.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ve=async()=>{G(null);try{const c=m.map(re=>({nodeId:re.id,nodeType:re.data.nodeType,payload:{itemType:re.data.itemType,itemId:re.data.itemId??null,label:re.data.label,infoType:re.data.infoType??null}})),ie=J.map(re=>({edgeId:re.id,fromNodeId:re.source,toNodeId:re.target}));await yi({libraryId:l,nodes:c,edges:ie}),G(a.cogita.library.graph.saveSuccess)}catch{G(a.cogita.library.graph.saveFail)}},F=c=>{K&&x(ie=>ie.map(re=>re.id===K.id?{...re,data:{...re.data,itemId:(c==null?void 0:c.infoId)??null,itemType:"collection",infoType:"collection",label:(c==null?void 0:c.label)??a.cogita.library.infoTypes.collection}}:re))},ce=c=>{K&&x(ie=>ie.map(re=>re.id===K.id?{...re,data:{...re.data,itemId:(c==null?void 0:c.infoId)??null,itemType:"info",infoType:(c==null?void 0:c.infoType)??null,label:(c==null?void 0:c.label)??a.cogita.library.infoTypes.any}}:re))};return i.useEffect(()=>{if(!K||K.data.nodeType!=="info"||K.data.infoType!=="quote"||!K.data.itemId){ne(null);return}let c=!0;return Za({libraryId:l,infoId:K.data.itemId}).then(ie=>{if(!c)return;const re=ie.payload,B=(re==null?void 0:re.text)??"";if(!B){ne(null);return}const Me=bt(B),oe=Object.values(Me.nodes).sort((le,ke)=>le.depth-ke.depth||le.start-ke.start).map(le=>({id:le.id,text:le.text,depth:le.depth}));ne({title:(re==null?void 0:re.title)??K.data.label,fragments:oe})}).catch(()=>ne(null)),()=>{c=!1}},[l,K]),e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:C,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ve,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ge,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:pe,children:a.cogita.library.actions.addInfo}),Q?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(Q.totalCollections))})}):null,j?e.jsx("p",{className:"cogita-help",children:j}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodes:m,edges:J,onNodesChange:V,onEdgesChange:s,onConnect:O,onNodeClick:(c,ie)=>f(ie.id),fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),K?e.jsxs("div",{className:"cogita-graph-inspector",children:[K.data.nodeType==="collection"?e.jsx(We,{libraryId:l,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:K.data.itemId?{id:K.data.itemId,label:K.data.label,infoType:"collection"}:null,onChange:F,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(We,{libraryId:l,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:K.data.itemId?{id:K.data.itemId,label:K.data.label,infoType:K.data.infoType??void 0}:null,onChange:ce,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),P?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:P.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:P.fragments.map(c=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:c.id}),e.jsx("span",{children:c.text})]},c.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function sn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C}){const{libraryName:m}=Oa(l),[x,V]=i.useState([]),[J,q]=i.useState("loading"),[s,b]=i.useState("idle"),f=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Q=`/#/cogita/library/${l}`,A=()=>{q("loading"),Jr({libraryId:l}).then(P=>{V(P),q("idle")}).catch(()=>{V([]),q("error")})};i.useEffect(()=>{A()},[l]);const j=async P=>{try{await Yr({libraryId:l,shareId:P}),A()}catch{A()}},G=async P=>{const ne=`${f}/${P}`;try{await navigator.clipboard.writeText(ne),b("copied")}catch{b("failed")}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:Q,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${Q}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[J==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):J==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):x.filter(P=>!C||P.collectionId===C).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:x.filter(P=>!C||P.collectionId===C).map(P=>e.jsxs("div",{className:"cogita-share-row","data-state":P.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:P.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(P.createdUtc).toLocaleString(),P.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),P.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${f}/${P.shareCode}`}):null]}),P.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[P.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>G(P.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>j(P.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},P.shareId))}),s==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):s==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function cn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C}=Oa(l),[m,x]=i.useState(null),[V,J]=i.useState(null),[q,s]=i.useState(null),[b,f]=i.useState(null),[Q,A]=i.useState(null),[j,G]=i.useState(null),P=i.useRef(null),ne=ge=>{if(!Number.isFinite(ge))return"0 B";if(ge<1024)return`${ge} B`;const pe=ge/1024;if(pe<1024)return`${pe.toFixed(1)} KB`;const ve=pe/1024;return ve<1024?`${ve.toFixed(1)} MB`:`${(ve/1024).toFixed(1)} GB`},K=async()=>{x(null),A({loadedBytes:0,totalBytes:null,percent:null});try{x(a.cogita.library.overview.exporting);const ge=await vi(l,A),pe=URL.createObjectURL(ge),ve=document.createElement("a");ve.href=pe,ve.download=`cogita-library-${C||l}.json`,ve.click(),URL.revokeObjectURL(pe),x(a.cogita.library.overview.exportReady)}catch{x(a.cogita.library.overview.exportFail)}finally{A(ge=>ge??{loadedBytes:0,totalBytes:null,percent:null})}},O=async ge=>{var ve;J(null),s(null),f(null);const pe=(ve=ge.target.files)==null?void 0:ve[0];if(pe)try{J(a.cogita.library.overview.importing),G({loadedBytes:0,totalBytes:pe.size,percent:0});const F=await ji(l,pe,G,ce=>{const c=ce.stage==="infos"?a.cogita.library.overview.importStageInfos:ce.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;f(a.cogita.library.overview.importLiveProgress.replace("{stage}",c).replace("{done}",String(ce.processed)).replace("{total}",String(ce.total)).replace("{infos}",String(ce.infos)).replace("{connections}",String(ce.connections)).replace("{collections}",String(ce.collections)))});s({infos:F.infosImported,connections:F.connectionsImported,collections:F.collectionsImported}),J(a.cogita.library.overview.importDone)}catch(F){const ce=F instanceof wi&&F.message?` ${F.message}`:"";J(`${a.cogita.library.overview.importFail}${ce}`)}finally{P.current&&(P.current.value="")}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:K,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:P,type:"file",accept:"application/json",onChange:O})]})]}),Q?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:Q.percent??void 0,max:Q.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ne(Q.loadedBytes)).replace("{total}",Q.totalBytes?ne(Q.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,j?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:j.percent??void 0,max:j.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ne(j.loadedBytes)).replace("{total}",j.totalBytes?ne(j.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null,V?e.jsx("p",{className:"cogita-help",children:V}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null,q?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(q.infos)).replace("{connections}",String(q.connections)).replace("{collections}",String(q.collections))}):null]})]})})})]})})}function dn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C}=Oa(l),[m,x]=i.useState(""),[V,J]=i.useState([]),q=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:s=>x(s.target.value),placeholder:a.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=m.trim();s&&(J(b=>[{id:q(),name:s},...b]),x(""))},children:a.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[V.length===0?e.jsx("p",{children:a.cogita.library.modules.storyboardsEmpty}):null,V.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function un({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C}=Oa(l),[m,x]=i.useState(""),[V,J]=i.useState([]),q=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:s=>x(s.target.value),placeholder:a.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=m.trim();s&&(J(b=>[{id:q(),name:s},...b]),x(""))},children:a.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[V.length===0?e.jsx("p",{children:a.cogita.library.modules.textsEmpty}):null,V.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function Dr({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C}=Oa(l),m=`/#/cogita/library/${l}`,[x,V]=i.useState(""),[J,q]=i.useState([]),[s,b]=i.useState("idle"),[f,Q]=i.useState(0),[A,j]=i.useState(null);i.useEffect(()=>{b("loading");const P=window.setTimeout(()=>{jt({libraryId:l,query:x.trim()||void 0,limit:30}).then(ne=>{q(ne.items),Q(ne.total),j(ne.nextCursor??null),b("ready")}).catch(()=>{q([]),Q(0),j(null),b("ready")})},240);return()=>window.clearTimeout(P)},[l,x]);const G=async()=>{if(A){b("loading");try{const P=await jt({libraryId:l,query:x.trim()||void 0,limit:30,cursor:A});q(ne=>[...ne,...P.items]),j(P.nextCursor??null),Q(P.total),b("ready")}catch{b("ready")}}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${m}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:x,onChange:P=>V(P.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(J.length)).replace("{total}",String(f||J.length))}),e.jsx("span",{children:s==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:J.length?J.map(P=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${m}/collections/${P.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:P.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(P.itemCount))," ·"," ",P.notes||a.cogita.library.collections.noNotes]})]})},P.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${m}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),A?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:G,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}function gn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C}){Oa(l);const m=`/#/cogita/library/${l}`,[x,V]=i.useState(a.cogita.library.collections.defaultName),[J,q]=i.useState(null),[s,b]=i.useState(0),[f,Q]=i.useState([]),[A,j]=i.useState("idle"),[G,P]=i.useState(null),ne=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(s||f.length)),[a,f.length,s]);i.useEffect(()=>{Wt(l,C).then(O=>{V(O.name),q(O.notes??null),b(O.itemCount)}).catch(()=>{V(a.cogita.library.collections.defaultName),q(null)})},[l,C]),i.useEffect(()=>{j("loading"),At({libraryId:l,collectionId:C,limit:40}).then(O=>{Q(O.items),P(O.nextCursor??null),b(O.total),j("ready")}).catch(()=>{Q([]),P(null),j("ready")})},[l,C]);const K=async()=>{if(G){j("loading");try{const O=await At({libraryId:l,collectionId:C,limit:40,cursor:G});Q(ge=>[...ge,...O.items]),P(O.nextCursor??null),b(O.total),j("ready")}catch{j("ready")}}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:J||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${m}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${m}/collections/${C}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${m}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ne}),e.jsx("span",{children:A==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:f.length?f.map(O=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:O.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:O.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:O.label}),e.jsx("p",{className:"cogita-card-subtitle",children:O.description})]})},me(O))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),G?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:K,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${m}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Da=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,o=a.filter(w=>w.correct).length,u=zt(wr(a));return{score:Math.round(Math.max(0,Math.min(100,u.knowness*100))*100)/100,total:n,correct:o,lastReviewedUtc:u.lastReviewedUtc??null}},hn=a=>{if(a.maskBase64)try{const n=ki(a.maskBase64);if(!n.length)return a.correct?1:0;const o=n.reduce((u,g)=>u+g,0);return Math.max(0,Math.min(1,o/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},wr=a=>a.map(n=>({correctness:hn(n),createdUtc:n.createdUtc})),zt=(a,n=Date.now())=>{var s;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const u=a.slice().sort((b,f)=>b.createdUtc.localeCompare(f.createdUtc)).slice(-5),g=u.reduce((b,f)=>b+f.correctness,0)/u.length,w=5,p=2,I=.15;let M=0,E=0;for(let b=0;b<u.length;b+=1){const f=new Date(u[b].createdUtc).getTime(),Q=b===u.length-1?n:new Date(u[b+1].createdUtc).getTime(),A=Math.max(0,(Q-f)/(1e3*60)),j=1-Math.exp(-A/w);M+=j,u[b].correctness>.5&&(E+=I)}let l=g*M*p+E;const C=((s=u[u.length-1])==null?void 0:s.createdUtc)??null,m=C?Math.max(0,(n-new Date(C).getTime())/(1e3*60)):0,V=1/(1+Math.log1p(m/60));return l*=V,u.length===1&&u[0].correctness>.5&&(l+=5.44*Math.exp(-m/2)),{knowness:l,avgCorrectness:g,lastReviewedUtc:C}},wt=a=>{const n=a.slice();for(let o=n.length-1;o>0;o-=1){const u=Math.floor(Math.random()*(o+1));[n[o],n[u]]=[n[u],n[o]]}return n},Pt=a=>a[Math.floor(Math.random()*a.length)],bn=(a,n)=>{const o=new Map;return a.forEach(u=>o.set(u,Math.random())),a.sort((u,g)=>{const w=n(u)-n(g);return w!==0?w:(o.get(u)??0)-(o.get(g)??0)})},Ht=(a,n,o,u,g)=>{if(!a.length)return null;const w=a.filter(I=>!(g!=null&&g.has(me(I))));if(w.length===0)return null;const p=w.filter(I=>me(I)!==o);return Pt(p.length?p:w)},mn=(a,n,o,u,g)=>{if(!a.length)return null;let w=Number.POSITIVE_INFINITY;for(const E of a){const l=me(E);if(o.has(l))continue;const C=n[l]??1;C<w&&(w=C)}if(!Number.isFinite(w))return null;const p=a.filter(E=>{const l=me(E);return!o.has(l)&&(n[l]??1)===w}),I=p.filter(E=>!g||me(E)!==g),M=u?I.filter(E=>!u.has(me(E))):I;return M.length>0?Pt(M):I.length>0?Pt(I):g&&p.some(E=>me(E)===g)?p.find(E=>me(E)===g)??null:p.length?Pt(p):null},ei=(a,n,o,u,g)=>{const w=[],p=a.filter(M=>!g.has(me(M))&&!o.has(me(M))&&(n[me(M)]??0)<1),I=bn(p,M=>n[me(M)]??0);for(const M of I){if(w.length>=u)break;w.push(M),g.add(me(M))}if(w.length<u){const M=wt(a.filter(E=>!g.has(me(E))&&o.has(me(E))));for(const E of M){if(w.length>=u)break;w.push(E),g.add(me(E))}}return w},pn=(a,n,o,u)=>ei(a,n,o,u,new Set),kr=(a,n,o,u,g,w)=>{const p=Math.max(1,o.stackSize??n),M=wt(a).filter((V,J,q)=>q.findIndex(s=>me(s)===me(V))===J),E=pn(M,u,g,p),l=new Set,C=new Set,m=Ht(E,{},null,l,C),x=m?[m]:[];return m&&C.add(me(m)),{queue:x,meta:{pool:M,active:E,knownessMap:u,unknownSet:g,outcomesById:w,asked:l,queued:C}}},mr={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const u=wt(a).filter((g,w,p)=>p.findIndex(I=>me(I)===me(g))===w);return{queue:u.slice(0,Math.min(n,u.length)),meta:{}}},applyOutcome:a=>a},Tr=(a,n,o,u)=>{const g=Math.max(1,o.stackSize??n),p=wt(a).filter((J,q,s)=>s.findIndex(b=>me(b)===me(J))===q),I={},M=new Set,E=new Set,l=new Set,C=Math.max(1,o.levels??1);p.forEach(J=>{const q=me(J),s=u==null?void 0:u[q],b=typeof s=="number"&&Number.isFinite(s)?s:1;I[q]=Math.min(C,Math.max(1,Math.round(b)))});const m=[];if(p.length>0){const J=new Map;p.forEach(s=>{var f;const b=I[me(s)]??1;J.has(b)||J.set(b,[]),(f=J.get(b))==null||f.push(s)});const q=Array.from(J.keys()).sort((s,b)=>s-b);for(const s of q){if(m.length>=g)break;const b=wt(J.get(s)??[]);for(const f of b){if(m.length>=g)break;m.push(f)}}}const x=Ht(m,I,null,M,E),V=x?[x]:[];return x&&E.add(me(x)),{queue:V,meta:{pool:p,active:m,levelMap:I,asked:M,queued:E,wrongSinceCorrect:l}}},fn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,o)=>Tr(a,n,o),applyOutcome:(a,n,o,u,g)=>{if(!n)return a;const w=Math.max(1,u.levels??1),p=a.meta.pool??[],I=a.meta.active??[],M={...a.meta.levelMap??{}},E=new Set(a.meta.asked??[]),l=new Set(a.meta.queued??[]),C=new Set(a.meta.wrongSinceCorrect??[]),m=me(n);l.delete(m),E.add(m);const x=M[m]??1;g.correct?(M[m]=C.has(m)?1:Math.min(x+1,w),C.delete(m)):(M[m]=1,C.add(m));const V=g.correct?I.filter(s=>me(s)!==m):I.slice();if(g.correct&&V.length<Math.max(1,u.stackSize??1)){const s=new Set(V.map(f=>me(f))),b=mn(p,M,s,E,m);b&&V.push(b)}const J=a.queue.slice(),q=Ht(V,M,m,E,l);return q&&(J.push(q),l.add(me(q))),{queue:J,meta:{pool:p,active:V,levelMap:M,asked:E,queued:l,wrongSinceCorrect:C}}}},xn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,o)=>kr(a,n,o,{},new Set,{}),applyOutcome:(a,n,o,u,g)=>{if(!n)return a;const w=a.meta.pool??[],p=a.meta.active??[],I={...a.meta.knownessMap??{}},M=new Set(a.meta.unknownSet??[]),E={...a.meta.outcomesById??{}},l=new Set(a.meta.asked??[]),C=new Set(a.meta.queued??[]),m=me(n);C.delete(m),l.add(m);const x={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},J=(E[m]??[]).concat(x).sort((A,j)=>A.createdUtc.localeCompare(j.createdUtc)).slice(-5);E[m]=J,M.delete(m);const q=Date.now();w.forEach(A=>{const j=me(A),G=E[j]??[];if(G.length===0){I[j]=0,M.add(j);return}const P=zt(G,q);I[j]=P.knowness});const s=p.slice();if((I[m]??0)>=1){const A=s.filter(j=>me(j)!==m);s.length=0,s.push(...A)}const f=Math.max(1,u.stackSize??o);if(s.length<f){const A=new Set(s.map(G=>me(G))),j=ei(w,I,M,f-s.length,A);s.push(...j)}const Q=a.queue.slice();if(Q.length===0||me(Q[Q.length-1])===m){const A=Ht(s,{},m,l,C);A&&(Q.push(A),C.add(me(A)))}return{queue:Q,meta:{pool:w,active:s,knownessMap:I,unknownSet:M,outcomesById:E,asked:l,queued:C}}}},ai={random:mr,levels:fn,temporal:xn},yn=Object.values(ai),Nr=a=>{if(!a)return mr;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?ai[n]:mr},Jt=(a,n)=>{const o={...a.defaultSettings};return n&&Object.entries(n).forEach(([u,g])=>{typeof g=="number"&&Number.isFinite(g)&&(o[u]=g),typeof g=="string"&&(o[u]=g)}),a.settingsFields.forEach(u=>{var w;const g=o[u.key];if(u.type==="number"){if(typeof g!="number"||Number.isNaN(g)){o[u.key]=a.defaultSettings[u.key]??0;return}u.min!==void 0&&(o[u.key]=Math.max(u.min,o[u.key])),u.max!==void 0&&(o[u.key]=Math.min(u.max,o[u.key]));return}if(u.type==="select"){const p=((w=u.options)==null?void 0:w.map(I=>I.value))??[];(typeof g!="string"||p.length>0&&!p.includes(g))&&(o[u.key]=a.defaultSettings[u.key]??p[0]??"")}}),o},ti=(a,n)=>{const o={};return a.settingsFields.forEach(u=>{const g=n.get(u.key);if(g){if(u.type==="number"){const w=Number(g);Number.isNaN(w)||(o[u.key]=w);return}o[u.key]=g}}),Jt(a,o)},vn=(a,n)=>{const o=new URLSearchParams;return a.settingsFields.forEach(u=>{const g=n[u.key];(typeof g=="number"||typeof g=="string")&&o.set(u.key,String(g))}),o};function jn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C,revisionId:m}){const{libraryName:x}=Oa(l),V=`/#/cogita/library/${l}`,[J,q]=i.useState(a.cogita.library.collections.defaultName),[s,b]=i.useState(""),[f,Q]=i.useState(20),[A,j]=i.useState("random"),[G,P]=i.useState({}),[ne,K]=i.useState("exact"),[O,ge]=i.useState([]),[pe,ve]=i.useState(null),[F,ce]=i.useState([]),[c,ie]=i.useState("idle"),[re,B]=i.useState(null),[Me,oe]=i.useState("idle"),[le,ke]=i.useState("idle"),[Te,Ne]=i.useState("idle"),Be=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Se=i.useMemo(()=>Nr(A),[A]),Qe=i.useMemo(()=>Jt(Se,G),[Se,G]),Ve=i.useMemo(()=>vn(Se,Qe).toString(),[Se,Qe]);i.useEffect(()=>{Wt(l,C).then(ee=>q(ee.name)).catch(()=>q(a.cogita.library.collections.defaultName))},[l,C]),i.useEffect(()=>{m&&Ti({libraryId:l,collectionId:C,revisionId:m}).then(ee=>{b(ee.name),j(ee.mode||"random"),K(ee.check||"exact"),Q(ee.limit||20),P(ee.revisionSettings??{})}).catch(()=>{b("")})},[C,l,m]),i.useEffect(()=>{Ni({libraryId:l}).then(ee=>{ge(ee),!pe&&ee.length>0&&ve(ee[0].roleId)}).catch(()=>{ge([])})},[l]);const Ee=()=>{ke("loading"),Jr({libraryId:l}).then(ee=>{ce(ee),ke("idle")}).catch(()=>{ce([]),ke("error")})};i.useEffect(()=>{Ee()},[l]);const ze=async()=>{ie("working"),oe("idle");try{const ee=await Ci({libraryId:l,collectionId:C,revisionType:Se.id,revisionSettings:Qe,mode:A,check:ne,limit:f});B(`${Be}/${ee.shareCode}${Ve?`?${Ve}`:""}`),ie("ready"),Ee()}catch{ie("error")}},sa=async()=>{if(m){Ne("saving");try{await Li({libraryId:l,collectionId:C,revisionId:m,name:s||J,revisionType:Se.id,revisionSettings:Qe,mode:A,check:ne,limit:f}),Ne("saved")}catch{Ne("error")}}},Re=async()=>{if(re)try{await navigator.clipboard.writeText(re),oe("copied")}catch{oe("failed")}},W=async ee=>{try{await Yr({libraryId:l,shareId:ee}),Ee()}catch{Ee()}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:J}),e.jsx("p",{className:"cogita-library-subtitle",children:x})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:V,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${V}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${V}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${V}/collections/${C}/revision/run?mode=${encodeURIComponent(A)}&check=${encodeURIComponent(ne)}&limit=${f}${Ve?`&${Ve}`:""}${pe?`&reviewer=${encodeURIComponent(pe)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:s,onChange:ee=>b(ee.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:A,onChange:ee=>j(ee.target.value),children:yn.map(ee=>e.jsx("option",{value:ee.id,children:a.cogita.library.revision[ee.labelKey]},ee.id))})]}),Se.settingsFields.map(ee=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[ee.labelKey]}),ee.type==="select"?e.jsx("select",{value:String(Qe[ee.key]??""),onChange:Ke=>P(Le=>({...Le,[ee.key]:Ke.target.value})),children:(ee.options??[]).map(Ke=>e.jsx("option",{value:Ke.value,children:a.cogita.library.revision[Ke.labelKey]},Ke.value))}):e.jsx("input",{type:"number",min:ee.min,max:ee.max,step:ee.step,value:Qe[ee.key]??0,onChange:Ke=>P(Le=>({...Le,[ee.key]:Number(Ke.target.value||0)}))})]},ee.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),Se.id!=="levels"&&Se.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:f,onChange:ee=>Q(Number(ee.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:pe??"",onChange:ee=>ve(ee.target.value||null),children:O.map(ee=>e.jsx("option",{value:ee.roleId,children:ee.label},ee.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[m?e.jsx("button",{type:"button",className:"cta ghost",onClick:sa,disabled:Te==="saving",children:Te==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${V}/collections/${C}/revision/run?mode=${encodeURIComponent(A)}&check=${encodeURIComponent(ne)}&limit=${f}${Ve?`&${Ve}`:""}${pe?`&reviewer=${encodeURIComponent(pe)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Te==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),re?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:re,readOnly:!0})]}):null,c==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,Me==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):Me==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:ze,disabled:c==="working",children:c==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),re?e.jsx("button",{type:"button",className:"cta ghost",onClick:Re,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),le==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):F.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:F.map(ee=>e.jsxs("div",{className:"cogita-share-row","data-state":ee.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:ee.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(ee.createdUtc).toLocaleString(),ee.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),ee.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>W(ee.shareId),children:a.cogita.library.revision.shareRevokeAction})]},ee.shareId))})]})]})]})]})})})]})})}function ri({copy:a,currentCard:n,currentTypeLabel:o,prompt:u,languages:g,answer:w,onAnswerChange:p,computedExpected:I,computedAnswers:M,onComputedAnswerChange:E,answerTemplate:l,outputVariables:C,variableValues:m,computedFieldFeedback:x,feedback:V,canAdvance:J,quoteContext:q,quotePlaceholder:s,onCheckAnswer:b,onSkip:f,onLanguageSelect:Q,onMarkReviewed:A,onAdvance:j,showCorrectAnswer:G,setShowCorrectAnswer:P,onRevealCorrect:ne,answerMask:K,expectedAnswer:O,hasExpectedAnswer:ge,handleComputedKeyDown:pe,answerInputRef:ve,computedInputRefs:F,scriptMode:ce,setScriptMode:c,matchPairs:ie,matchLeftOrder:re,matchRightOrder:B,matchSelection:Me,matchActiveLeft:oe,matchActiveRight:le,matchFeedback:ke,onMatchLeftSelect:Te,onMatchRightSelect:Ne}){const Be=i.useMemo(()=>{var Y;const W=!l&&I.length===2?`The {${I[0].key}} is of type {${I[1].key}}`:null,ee=l??W;if(!ee)return null;const Ke=new Map(I.map(t=>[t.key,t.expected])),Le=new Set,fe=[],$e=/\{([^}]+)\}/g;let qe=0,Ae,Oe=null;for(;(Ae=$e.exec(ee))!==null;){const t=ee.slice(qe,Ae.index);t&&fe.push({type:"text",value:t});const r=((Y=Ae[1])==null?void 0:Y.trim())??"",h=r&&Ke.has(r)?r:r&&C&&C[r]?C[r]:null;r&&Le.add(r),h&&Le.add(h),h&&Ke.has(h)?(fe.push({type:"input",value:h}),Oe||(Oe=h)):r&&m&&m[r]!==void 0?fe.push({type:"text",value:m[r]}):fe.push({type:"text",value:Ae[0]}),qe=Ae.index+Ae[0].length}const v=ee.slice(qe);return v&&fe.push({type:"text",value:v}),I.filter(t=>!Le.has(t.key)).length>0?null:{parts:fe,expectedByKey:Ke,firstInputKey:Oe}},[l,I,C,m]),Se=()=>{if(!Be)return null;const{parts:W,expectedByKey:ee,firstInputKey:Ke}=Be;return e.jsx("div",{className:"cogita-revision-inline-answer",children:W.map((Le,fe)=>{var $e,qe;return Le.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Le.value},`text-${fe}`):e.jsx("input",{ref:Ae=>{F.current[Le.value]=Ae},autoFocus:Le.value===Ke,value:M[Le.value]??"",onChange:Ae=>E(Le.value,Ae.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[Le.value]??(V==="correct"?"correct":V==="incorrect"?"incorrect":void 0),onKeyDown:Ae=>ze(Ae)||pe(Ae),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,(($e=M[Le.value])==null?void 0:$e.length)??0,((qe=ee.get(Le.value))==null?void 0:qe.length)??6)}ch`}},`input-${Le.value}-${fe}`)})})},Qe=i.useMemo(()=>{const W=new Map;return(ie??[]).forEach(ee=>W.set(ee.leftId,ee)),W},[ie]),Ve=i.useMemo(()=>{const W=new Map;return(ie??[]).forEach(ee=>W.set(ee.rightId,ee)),W},[ie]);i.useEffect(()=>{var fe;if(n.cardType!=="info"||n.infoType!=="computed"||I.length===0)return;const W=typeof document<"u"?document.activeElement:null;if(W&&(W.tagName==="INPUT"||W.tagName==="TEXTAREA"))return;const ee=(Be==null?void 0:Be.firstInputKey)??((fe=I[0])==null?void 0:fe.key);if(!ee)return;const Ke=F.current[ee];if(!Ke)return;const Le=requestAnimationFrame(()=>{Ke.focus()});return()=>cancelAnimationFrame(Le)},[n,I,Be]);const Ee=(()=>{const W=[O??"",...I.map(Le=>Le.expected??"")].join(""),ee=[w,...Object.values(M)].join(""),Ke=`${W}${ee}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Ke)})(),ze=W=>W.ctrlKey&&(W.key==="^"||W.key==="6")?(W.preventDefault(),c(ee=>ee==="super"?null:"super"),!0):W.ctrlKey&&(W.key==="_"||W.key==="-")?(W.preventDefault(),c(ee=>ee==="sub"?null:"sub"),!0):!1,sa=()=>{if(!O||!K)return O??"";const W=O.split(""),ee=Array.from(K),Ke=ee.length>0?ee.reduce((Le,fe)=>Le+fe,0)/ee.length:127;return W.map((Le,fe)=>{const $e=ee[fe]??Ke,qe=Math.max(0,Math.min(255,Math.round($e)));let Ae=255,Oe=0;return qe<=127?Oe=Math.round(qe/127*255):(Oe=255,Ae=Math.round(255*(1-(qe-127)/128))),e.jsx("span",{style:{color:`rgb(${Ae}, ${Oe}, 0)`},children:Le},`mask-${fe}`)})},Re=n.cardType==="info"&&n.infoType==="quote"?(q==null?void 0:q.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:o}),e.jsx("strong",{children:Re})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&ie?e.jsxs("div",{className:"cogita-revision-body",children:[u?e.jsx("h2",{children:u}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(re??[]).map(W=>{const ee=Qe.get(W);if(!ee)return null;const Ke=(Me==null?void 0:Me[W])??null,Le=(ke==null?void 0:ke[W])??null,fe=oe===W;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":fe,"data-state":Le??void 0,"data-locked":Ke?"true":void 0,onClick:()=>Te==null?void 0:Te(W),children:[e.jsx("span",{children:ee.leftLabel}),Ke&&G?e.jsx("em",{children:"✓"}):null]},W)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(B??[]).map(W=>{const ee=Ve.get(W);if(!ee)return null;const Ke=Object.values(Me??{}).includes(W),Le=le===W;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Ke||Le,"data-locked":Ke?"true":void 0,onClick:()=>Ne==null?void 0:Ne(W),children:e.jsx("span",{children:ee.rightLabel})},W)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ve,value:w,onChange:W=>p(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":V==="correct"?"correct":V==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?j():b())}})]}),Ee?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ce==="super",onClick:()=>c(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ce==="sub",onClick:()=>c(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,l?null:e.jsx(Et,{value:u??"",mode:"auto"}),I.length>0?(()=>{const W=Se();return W?e.jsx("div",{className:"cogita-inline-answer-wrap",children:W}):e.jsx("div",{className:"cogita-form-grid",children:I.map((ee,Ke)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:ee.key}),e.jsx("textarea",{ref:Le=>{F.current[ee.key]=Le},autoFocus:Ke===0,value:M[ee.key]??"",onChange:Le=>E(ee.key,Le.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[ee.key]??(V==="correct"?"correct":V==="incorrect"?"incorrect":void 0),onKeyDown:Le=>ze(Le)||pe(Le)})]},ee.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ve,value:w,onChange:W=>p(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":V==="correct"?"correct":V==="incorrect"?"incorrect":void 0,onKeyDown:W=>{ze(W)||W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?j():b())}})]})}),Ee?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ce==="super",onClick:()=>c(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ce==="sub",onClick:()=>c(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&q?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(q.completed)).replace("{total}",String(q.total))}),e.jsx("p",{className:"cogita-quote-text",children:q.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ve,value:w,onChange:W=>p(W.target.value),placeholder:s??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":V==="correct"?"correct":V==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?j():b())}})]}),e.jsx("p",{className:"cogita-quote-text",children:q.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(W=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>Q(W.label),children:W.label},W.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:A,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}),V&&e.jsx("div",{className:"cogita-revision-feedback","data-state":V,children:V==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),V==="incorrect"&&ge?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>P(W=>{const ee=!W;return ee&&ne(),ee}),children:a.cogita.library.revision.showAnswer}),G?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),I.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[I.map(W=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:W.key}),e.jsx("span",{children:W.expected})]},W.key)),O?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:O})]}):null]}):e.jsx("p",{children:K?sa():O})]}):null]}):null,J?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:j,children:a.cogita.library.revision.nextQuestion})}):null]})}const lr=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ii({outcomes:a}){const[n,o]=i.useState("day"),u=i.useMemo(()=>{const g=lr.find(I=>I.id===n)??lr[1],w=Date.now()-g.ms,p=a.filter(I=>new Date(I.createdUtc).getTime()>=w);return Da(p)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:lr.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>o(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[u.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[u.correct," / ",u.total]})]})}const wn="cogita-revision",kn=1,Dt="outcomes",Tn=()=>new Promise((a,n)=>{const o=indexedDB.open(wn,kn);o.onupgradeneeded=()=>{const u=o.result;if(!u.objectStoreNames.contains(Dt)){const g=u.createObjectStore(Dt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},o.onerror=()=>n(o.error),o.onsuccess=()=>a(o.result)}),Tt=async(a,n)=>{const o=await Tn();return new Promise((u,g)=>{const w=o.transaction(Dt,a),p=w.objectStore(Dt);n(p).then(u).catch(g),w.onerror=()=>g(w.error)})},ni=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(o=>o.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Nn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const o=ni();return localStorage.setItem(a,o),o},Ln=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),o=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(o)),o},li=(a,n,o,u)=>Ba(a,n,o,u),Kt=async a=>{const n=Nn(),o=Ln(),u=new Date().toISOString(),g={...a,clientId:n,clientSequence:o,createdUtc:u,id:ni(),pending:!0};return await Tt("readwrite",w=>new Promise((p,I)=>{const M={...g,itemKey:li(g.itemType,g.itemId,g.checkType,g.direction)},E=w.add(M);E.onsuccess=()=>p(),E.onerror=()=>I(E.error)})),g},Ot=async(a,n,o,u)=>{if(!n)return[];try{const g=li(a,n,o,u);return await Tt("readonly",w=>new Promise((p,I)=>{const E=w.index("byItem").getAll(g);E.onsuccess=()=>{const C=(E.result??[]).map(m=>({itemType:m.itemType,itemId:m.itemId,checkType:m.checkType??null,direction:m.direction??null,revisionType:m.revisionType,evalType:m.evalType,correct:m.correct,createdUtc:m.createdUtc,maskBase64:m.maskBase64,payloadBase64:m.payloadBase64,payloadHashBase64:m.payloadHashBase64,clientId:m.clientId,clientSequence:m.clientSequence,personRoleId:m.personRoleId??null})).sort((m,x)=>m.createdUtc.localeCompare(x.createdUtc));p(C)},E.onerror=()=>I(E.error)}))}catch{return[]}},Ka=async()=>{try{return await Tt("readonly",a=>new Promise((n,o)=>{const u=a.getAll();u.onsuccess=()=>{const w=(u.result??[]).map(p=>({itemType:p.itemType,itemId:p.itemId,checkType:p.checkType??null,direction:p.direction??null,revisionType:p.revisionType,evalType:p.evalType,correct:p.correct,createdUtc:p.createdUtc,maskBase64:p.maskBase64,payloadBase64:p.payloadBase64,payloadHashBase64:p.payloadHashBase64,clientId:p.clientId,clientSequence:p.clientSequence,personRoleId:p.personRoleId??null}));n(w)},u.onerror=()=>o(u.error)}))}catch{return[]}},Cn=async(a=100)=>{try{return await Tt("readonly",n=>new Promise((o,u)=>{const w=n.index("byPending").getAll(!0);w.onsuccess=()=>{const p=w.result??[];o(p.slice(0,a))},w.onerror=()=>u(w.error)}))}catch{return[]}},Mn=async a=>{if(a.length!==0)try{await Tt("readwrite",n=>new Promise((o,u)=>{let g=a.length;a.forEach(w=>{const p=n.get(w);p.onsuccess=()=>{const I=p.result;if(I){I.pending=!1;const M=n.put(I);M.onsuccess=()=>{g-=1,g===0&&o()},M.onerror=()=>u(M.error)}else g-=1,g===0&&o()},p.onerror=()=>u(p.error)})}))}catch{}},or=async(a,n)=>{const o=await Cn(200);if(o.length===0)return;const u=new Map;o.forEach(g=>{var p;const w=g.personRoleId??n??"";u.has(w)||u.set(w,[]),(p=u.get(w))==null||p.push(g)});for(const[g,w]of u.entries()){const p=w.map(I=>({itemType:I.itemType,itemId:I.itemId,checkType:I.checkType??null,direction:I.direction??null,revisionType:I.revisionType,evalType:I.evalType,correct:I.correct,clientId:I.clientId,clientSequence:I.clientSequence,maskBase64:I.maskBase64??null,payloadHashBase64:I.payloadHashBase64??null,payloadBase64:I.payloadBase64??null,personRoleId:g||null}));try{await Mi({libraryId:a,outcomes:p}),await Mn(w.map(I=>I.id))}catch{}}},Kr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Sn=(a,n)=>{const o=Math.max(a.length,n.length,1),u=Math.abs(a.length-n.length);return Math.max(0,1-u/o)},In=(a,n)=>{const o=new Uint8Array(a.length),u=Sn(a,n);for(let g=0;g<a.length;g+=1){const w=a[g]===(n[g]??"")?128:0,p=a.length-1-g,I=n.length-1-g,M=a[p]===(n[I]??"")?127:0,E=Math.round((w+M)*u);o[g]=Math.max(0,Math.min(255,E))}return o},St=(a,n)=>a===n||(Kr[a]??[]).includes(n)?!0:(Kr[n]??[]).includes(a),Vt=(a,n)=>{const o=new Uint8Array(a.length);if(!a.length)return o;const u=[];for(let w=0;w<=a.length-3;w+=1)u.push({index:w,text:a.slice(w,w+3)});let g=!1;return u.forEach(w=>{for(let p=0;p<=n.length-3;p+=1){const I=n.slice(p,p+3);let M=0;for(let x=0;x<3;x+=1)St(w.text[x],I[x])&&(M+=1);if(M<2)continue;let E=w.index-1,l=p-1;for(;E>=0&&l>=0;){const x=a[E],V=n[l];if(x===V){o[E]=Math.max(o[E],255),E-=1,l-=1,g=!0;continue}if(St(x,V)){o[E]=Math.max(o[E],127),E-=1,l-=1,g=!0;continue}if(E>0&&a[E-1]===V){o[E]=Math.max(o[E],0),E-=1,g=!0;continue}if(l>0&&a[E]===n[l-1]){l-=1,g=!0;continue}break}for(let x=0;x<3;x+=1){const V=w.index+x,J=w.text[x],q=I[x],s=J===q?255:St(J,q)?127:0;o[V]=Math.max(o[V],s),g=!0}let C=w.index+3,m=p+3;for(;C<a.length&&m<n.length;){const x=a[C],V=n[m];if(x===V){o[C]=Math.max(o[C],255),C+=1,m+=1,g=!0;continue}if(St(x,V)){o[C]=Math.max(o[C],127),C+=1,m+=1,g=!0;continue}if(C+1<a.length&&a[C+1]===V){o[C]=Math.max(o[C],0),C+=1,g=!0;continue}if(m+1<n.length&&a[C]===n[m+1]){m+=1,g=!0;continue}break}}}),g?o:In(a,n)},ht=(a,n,o)=>{const u=a.trim().toLowerCase(),g=n.trim().toLowerCase();return Vt(u,g)},mt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),oi=(a,n,o)=>{const u=mt(a),g=mt(n);return Vt(u,g)},va=a=>a.trim().toLowerCase(),Pn=a=>a==="reverse"?"reverse":"forward",kt=(a,n)=>`${a}|${n}`,wa=a=>{if(!a)return null;const[n,o]=a.split("|",2);return(n==="forward"||n==="reverse")&&o?{mode:n,fragmentId:o}:{mode:"forward",fragmentId:a}},qt=(a,n)=>{var u;const o=wa(n);return o?o.fragmentId&&n?(a??null)===n:(((u=wa(a))==null?void 0:u.mode)??"forward")===o.mode:!0},ha=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},si=(a,n)=>{if((ha(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const u=ha(a.childCheckType),g=ha(a.childDirection),w=ha(n.checkType),p=ha(n.direction);return!(u&&u!==w||g&&g!==p)},Rn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},$n={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},_t=(a,n,o)=>{if(!o||!n.startsWith(a))return n;const u=n.slice(a.length);if(!u)return n;const g=o==="super"?Rn:$n,w=u.split("").map(p=>g[p]??p).join("");return a+w},Ut=(a,n,o)=>{var p,I,M;if(!a)return((p=n[0])==null?void 0:p.key)??null;const u=new Set(n.map(E=>E.key)),g=/\{([^}]+)\}/g;let w;for(;(w=g.exec(a))!==null;){const E=((I=w[1])==null?void 0:I.trim())??"";if(!E)continue;if(u.has(E))return E;const l=o==null?void 0:o[E];if(l&&u.has(l))return l}return((M=n[0])==null?void 0:M.key)??null},pr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const o=n.description??"";if(!o.trim())return[n];const u=wa(n.direction),g=(u==null?void 0:u.mode)??Pn(n.direction),w=bt(o),p=Object.keys(w.nodes);return p.length===0?[n]:p.map(I=>({...n,checkType:"quote-fragment",direction:kt(g,I)}))});function En({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C,revisionId:m}){const x=vr(),V=`/#/cogita/library/${l}`,J=i.useMemo(()=>new URLSearchParams(x.search),[x.search]),q=Math.max(1,Number(J.get("limit")??20)),s=J.get("mode")??"random",b=i.useMemo(()=>Nr(s),[s]),f=i.useMemo(()=>Jt(b,ti(b,J)),[b,J]),Q=J.get("check")??"exact",A=J.get("reviewer"),j=i.useMemo(()=>a.cogita.library.revision[b.labelKey]??s,[a,s,b]),G=i.useMemo(()=>Q==="exact"?a.cogita.library.revision.checkValue:Q,[a,Q]),[P,ne]=i.useState(a.cogita.library.collections.defaultName),[K,O]=i.useState([]),[ge,pe]=i.useState([]),[ve,F]=i.useState("idle"),[ce,c]=i.useState({current:0,total:0}),[ie,re]=i.useState(0),[B,Me]=i.useState(""),[oe,le]=i.useState(null),[ke,Te]=i.useState(null),[Ne,Be]=i.useState(null),[Se,Qe]=i.useState(null),[Ve,Ee]=i.useState([]),[ze,sa]=i.useState({}),[Re,W]=i.useState({}),[ee,Ke]=i.useState(null),[Le,fe]=i.useState(null),[$e,qe]=i.useState(null),[Ae,Oe]=i.useState(null),[v,k]=i.useState(null),[Y,t]=i.useState({}),r=i.useRef(0),[h,T]=i.useState(null),D=i.useRef(null),Z=i.useRef(null),[te,ae]=i.useState(null),[de,se]=i.useState(!1),[we,aa]=i.useState(null),[Ge,Ze]=i.useState([]),[Fe,He]=i.useState(null),_e=i.useRef(null),ea=i.useRef(null),[Pa,oa]=i.useState(null),[_,Ce]=i.useState(0),De=i.useRef(null),ta=i.useRef({}),[na,Ue]=i.useState(!1),[la,ga]=i.useState({}),[Na,Ta]=i.useState([]),ma=i.useRef(new Map),[fa,Sa]=i.useState(new Set),[pa,Je]=i.useState(!1),ia=i.useRef(null),La=i.useRef(new Set),Aa=i.useRef({}),be=K[ie]??null,je=(be==null?void 0:be.checkType)==="translation-match"&&v,et=i.useRef(new Map),Va=i.useRef(new Map),at=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useMemo(()=>be?be.cardType==="vocab"?a.cogita.library.revision.vocabLabel:be.infoType?ra(a,be.infoType):a.cogita.library.revision.infoLabel:"",[a,be]),Yt=i.useMemo(()=>{var y;return b.id!=="levels"?K.length:((y=la.pool)==null?void 0:y.length)??b.getFetchLimit(q,f)},[la,f,b,K.length,q]),rt=b.getProgressTotal?b.getProgressTotal(K,la,q,f):b.id==="levels"?Math.min(q,Yt):K.length,it=rt?Math.min(ie+1,rt):0,Ra=Math.max(1,Number(f.tries??1)),ja=f.compare??"anchors",qa=Math.max(0,Math.min(100,Number(f.minCorrectness??0))),ba=(f.considerDependencies??"on")==="on",ca=Math.max(0,Math.min(100,Number(f.dependencyThreshold??85))),Ia=d=>{const y=d.slice();for(let S=y.length-1;S>0;S-=1){const N=Math.floor(Math.random()*(S+1));[y[S],y[N]]=[y[N],y[S]]}return y},za=d=>d.length?d.reduce((S,N)=>S+N,0)/d.length/255*100:0,_a=d=>za(d)>=qa,nt=async()=>{const d=await Ka(),y=new Map,S=new Map,N=new Map;d.forEach($=>{const z=`${$.itemType}:${$.itemId}`,ue=Ba($.itemType,$.itemId,$.checkType,$.direction);if(y.has(z)||y.set(z,[]),y.get(z).push($),S.has(ue)||S.set(ue,[]),S.get(ue).push($),$.itemType==="info"&&$.checkType==="quote-fragment"&&$.direction){const he=`${$.itemId}:${$.direction}`;N.has(he)||N.set(he,[]),N.get(he).push($)}});const H=new Map,L=new Map,U=new Map;return y.forEach(($,z)=>H.set(z,Da($).score)),S.forEach(($,z)=>L.set(z,Da($).score)),N.forEach(($,z)=>U.set(z,Da($).score)),{itemKnowness:H,cardKnowness:L,fragmentKnowness:U}},Qt=async d=>{const y=[];let S=null;for(;;){const N=await At({libraryId:l,collectionId:d,limit:200,cursor:S});if(y.push(...N.items),!N.nextCursor)break;S=N.nextCursor}return pr(y)},ft=async(d,y)=>{if(ma.current.has(d))return ma.current.get(d)??0;const S=await Qt(d);if(S.length===0)return ma.current.set(d,0),0;const H=S.reduce((L,U)=>{const $=me(U);return L+(y.get($)??0)},0)/S.length;return ma.current.set(d,H),H},Gt=(d,y)=>{if(!ba||d.cardType!=="info"||d.infoType!=="quote"||d.checkType!=="quote-fragment")return!0;const S=wa(d.direction);if(!(S!=null&&S.fragmentId))return!0;const N=d.description??"";if(!N.trim())return!0;const L=bt(N).nodes[S.fragmentId];if(!L||!L.leftId&&!L.rightId)return!0;const U=[L.leftId,L.rightId].filter(ue=>!!ue);if(U.length===0)return!0;const $=U.map(ue=>{const he=Ba("info",d.cardId,"quote-fragment",kt(S.mode,ue));return y.get(he)??0});return $.reduce((ue,he)=>ue+he,0)/$.length>=ca},lt=async d=>{const y=la,S=d.concat(y.active??[]).concat(y.pool??[]).filter(($,z,ue)=>ue.findIndex(he=>me(he)===me($))===z);if(!ba){Sa(new Set(S.map(me)));return}const{itemKnowness:N,cardKnowness:H}=await nt(),L=Na.filter($=>ha($.childItemType)==="collection"&&$.childItemId===C&&!ha($.childCheckType)&&!ha($.childDirection)),U=new Set;for(const $ of S){if($.cardType!=="info"){U.add(me($));continue}if(!Gt($,H))continue;const z=Na.filter(ye=>si(ye,$)).concat(L);if(z.length===0){U.add(me($));continue}let ue=0;for(const ye of z)if(ha(ye.parentItemType)==="collection")ue+=await ft(ye.parentItemId,H);else if(ha(ye.parentCheckType)||ha(ye.parentDirection)){const xe=ha(ye.parentCheckType),Ie=ha(ye.parentDirection),Pe=Ba(ye.parentItemType,ye.parentItemId,xe,Ie);ue+=H.get(Pe)??0}else{const xe=`${ye.parentItemType}:${ye.parentItemId}`;ue+=N.get(xe)??0}ue/z.length>=ca&&U.add(me($))}Sa(U)},Xt=d=>{for(let y=d;y<K.length;y+=1){const S=K[y];if(S&&(!ba||S.cardType!=="info"||fa.has(me(S))))return y}return-1},Ca=d=>!ba||d.cardType!=="info"||fa.has(me(d)),ot=d=>{if(b.id!=="temporal"&&b.id!=="levels")return null;const y=la,S=(y.active??[]).concat(y.pool??[]),N=new Set;for(const H of S){const L=me(H);if(!(N.has(L)||d.has(L))&&(N.add(L),Ca(H)))return H}return null},$a=i.useMemo(()=>{if(b.id!=="levels")return null;const d=la,y=d.pool??[],S=d.active??[],N=d.levelMap??{},H=Math.max(1,Number(f.levels??1)),L=Array.from({length:H},()=>0),U=new Set(S.map(he=>me(he)));y.forEach(he=>{const ye=Math.min(H,Math.max(1,N[me(he)]??1));L[ye-1]+=1});const $=y.length||1,z=L.map(he=>he/$*100),ue=be?N[me(be)]??1:null;return{counts:L,percentages:z,currentLevel:ue,levelsCount:H,activeCount:S.length,poolCount:y.length,activeSet:U}},[la,f,b,be]),xa=i.useMemo(()=>{if(b.id!=="temporal")return null;const d=la,y=d.pool??[],S=d.active??[],N=d.knownessMap??{},H=new Set(d.unknownSet??[]);let L=0;y.forEach(z=>{(N[me(z)]??0)>1&&(L+=1)});const U=H.size,$=S.map(z=>({id:me(z),value:H.has(me(z))?0:Math.max(0,Math.min(1,N[me(z)]??0))}));return{knownCount:L,unknownCount:U,dots:$}},[la,b]),st=i.useMemo(()=>{if(!ba)return 0;const d=la;return K.concat(d.active??[]).concat(d.pool??[]).filter((S,N,H)=>H.findIndex(L=>me(L)===me(S))===N).filter(S=>S.cardType==="info"&&!fa.has(me(S))).length},[ba,la,K,fa]);i.useEffect(()=>{if(!ba||ve!=="ready")return;const d=la,S=K.concat(d.active??[]).concat(d.pool??[]).filter((L,U,$)=>$.findIndex(z=>me(z)===me(L))===U).filter(L=>L.cardType!=="info"||fa.has(me(L))).length,N=_e.current;if(_e.current=S,N===null||S<=N)return;const H=S-N;He(`New card available (+${H})`),ea.current&&window.clearTimeout(ea.current),ea.current=window.setTimeout(()=>He(null),2200)},[ba,ve,la,K,fa]),i.useEffect(()=>()=>{ea.current&&window.clearTimeout(ea.current)},[]);const ya=(d,y)=>{const S=b.applyOutcome({queue:K,meta:la},be,q,f,{correct:d,correctness:y,createdUtc:new Date().toISOString()});O(S.queue),ga(S.meta);const N=S.queue[ie+1];N&&xt(N,ie+1)};i.useEffect(()=>{Wt(l,C).then(d=>ne(d.name)).catch(()=>ne(a.cogita.library.collections.defaultName))},[l,C]),i.useEffect(()=>{Hr({libraryId:l,type:"language"}).then(d=>pe(d)).catch(()=>pe([]))},[l]),i.useEffect(()=>{zr({libraryId:l}).then(d=>Ta(d.items??[])).catch(()=>Ta([]))},[l]),i.useEffect(()=>{or(l,A)},[l,A]),i.useEffect(()=>{lt(K)},[K,Na,ba,ca,C]),i.useEffect(()=>{if(!be||!ba){Je(!1);return}if(be.cardType!=="info"||fa.has(me(be))){Je(!1);return}const d=Xt(ie+1);if(d>=0){Je(!1),re(d);return}if(b.id==="temporal"||b.id==="levels"){const y=K.slice(0,ie+1),S=K.slice(ie+1).filter(Ca),N=y.concat(S),H=new Set(N.map(me)),L=ot(H);if(L){const $=me(L);H.has($)||(N.push(L),H.add($),ga(z=>{const ue=z,he=new Set(ue.queued??[]);return he.add($),{...ue,queued:he}}))}const U=N.findIndex(($,z)=>z!==ie&&Ca($));if(U>=0){O(N),re(U),Je(!1);return}}Je(!0)},[be,fa,ba,ie,K,la,b.id]),i.useEffect(()=>{let d=!0;return(async()=>{F("loading"),c({current:0,total:b.id==="levels"?0:b.getFetchLimit(q,f)});try{const S=[];let N=null,H=null;do{const ye=await At({libraryId:l,collectionId:C,limit:300,cursor:N});if(S.push(...ye.items),(b.id==="levels"||b.id==="temporal")&&ye.total&&(H=ye.total),c(xe=>({current:S.length,total:xe.total||ye.total||b.getFetchLimit(q,f)})),N=ye.nextCursor??null,H!==null&&S.length>=H||b.id!=="levels"&&b.id!=="temporal"&&S.length>=b.getFetchLimit(q,f))break}while(N);if(!d)return;const L=pr(S);let U;if(b.id==="levels"){const ye=Math.max(1,Number(f.levels??1)),Ie=(await Ka()).reduce((Pe,Ye)=>{const Xe=Ba(Ye.itemType,Ye.itemId,Ye.checkType,Ye.direction);return Pe[Xe]||(Pe[Xe]=[]),Pe[Xe].push(Ye),Pe},{});U={},L.forEach(Pe=>{const Ye=me(Pe),Xe=Ie[Ye]??[],ua=Xe.length>0?Da(Xe).score:0,Ga=Math.max(1,Math.min(ye,Math.ceil(ua/100*ye)));U[Ye]=Ga})}let $=null,z=null,ue=null;if(b.id==="temporal"){const ye=await Ka(),xe=new Set(L.map(Ye=>me(Ye))),Ie=ye.reduce((Ye,Xe)=>{const ua=Ba(Xe.itemType,Xe.itemId,Xe.checkType,Xe.direction);return xe.has(ua)&&(Ye[ua]||(Ye[ua]=[]),Ye[ua].push(Xe)),Ye},{});$={},z=new Set,ue={};const Pe=Date.now();L.forEach(Ye=>{const Xe=me(Ye),ua=Ie[Xe]??[];if(ua.length===0){$[Xe]=0,z.add(Xe),ue[Xe]=[];return}const Ga=wr(ua);ue[Xe]=Ga;const di=zt(Ga,Pe);$[Xe]=di.knowness})}const he=b.id==="levels"?Tr(L,q,f,U):b.id==="temporal"?kr(L,q,f,$??{},z??new Set,ue??{}):b.prepare(L,q,f);O(he.queue),ga(he.meta),re(0),F("ready"),c(ye=>({current:Math.min(ye.current,ye.total),total:ye.total}))}catch{d&&F("error")}})(),()=>{d=!1}},[l,C,q,f,b,A]),i.useEffect(()=>{if(Me(""),le(null),oa(null),Ce(0),Ee([]),sa({}),W({}),fe(null),qe(null),Oe(null),se(!1),Ue(!1),ae(null),k(null),t({}),!be){Te(null),Be(null),Ke(null),aa(null);return}be.cardType==="info"&&be.infoType==="computed"&&Te(a.cogita.library.revision.loadingComputed);let d=!0;return xt(be,ie).then(y=>{!d||!y||(Te(y.prompt),Be(y.expectedAnswer),Ee(y.computedExpected),sa(y.computedAnswers),Ke(y.computedValues),fe(y.answerTemplate),qe(y.outputVariables),Oe(y.variableValues))}),()=>{d=!1}},[be,a]),i.useEffect(()=>{if(!be||be.cardType!=="info"||be.infoType!=="quote"){ia.current=null,La.current=new Set,Qe(null);return}const d=be.description??"",y=(be.label??"").trim(),S=y.replace(/\s+/g," ").trim(),N=d.replace(/\s+/g," ").trim(),H=S&&S!==N?y:a.cogita.library.infoTypes.quote;if(!d){Qe(null),Be(null);return}const L=bt(d);ia.current=L,Te(H);let U=!0;return nt().then(({fragmentKnowness:$})=>{if(!U)return;const z=getQuoteMode(be.direction),ue=new Set,he={};$.forEach((Ie,Pe)=>{const[Ye,Xe]=Pe.split(":",2);if(Ye!==be.cardId)return;const ua=wa(Xe);if(!ua||ua.mode!==z)return;const Ga=ua.fragmentId;he[Ga]=Ie,Ie>=ca&&ue.add(Ga)}),La.current=ue,Aa.current=he;const ye=wa(be.direction);if(ye!=null&&ye.fragmentId&&L.nodes[ye.fragmentId]){Fa(L,ye.fragmentId,H);return}const xe=gt(L,ue,he,ca,ba,be.direction);Fa(L,(xe==null?void 0:xe.id)??null,H)}).catch(()=>{La.current=new Set,Aa.current={};const $=wa(be.direction);if($!=null&&$.fragmentId&&L.nodes[$.fragmentId]){Fa(L,$.fragmentId,H);return}const z=gt(L,La.current,{},ca,ba,be.direction);Fa(L,(z==null?void 0:z.id)??null,H)}),()=>{U=!1}},[be,a,ba,ca]),i.useEffect(()=>{if(!be||be.cardType!=="vocab"||be.checkType!=="translation-match"){k(null),t({});return}const S=(la.pool??la.active??K).filter($=>$.cardType==="vocab"&&$.checkType==="translation-match").filter(($,z,ue)=>ue.findIndex(he=>he.cardId===$.cardId)===z);S.some($=>$.cardId===be.cardId)||S.unshift(be);const H=Ia(S).slice(0,6).map($=>{const z=$.label.split("↔").map(ye=>ye.trim()).filter(Boolean);if(z.length<2)return null;const ue=`${$.cardId}:L`,he=`${$.cardId}:R`;return{cardId:$.cardId,leftId:ue,rightId:he,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),L=H.map($=>$.leftId),U=Ia(H.map($=>$.rightId));k({pairs:H,leftOrder:L,rightOrder:U,selection:{},activeLeft:null,activeRight:null,locked:{}})},[be,K,la]),i.useEffect(()=>()=>{D.current&&window.clearTimeout(D.current),Z.current&&window.clearTimeout(Z.current)},[]);const Ha=i.useRef(null);i.useEffect(()=>{if(!be)return;const d=me(be),y=typeof document<"u"?document.activeElement:null;if(Ha.current===d&&y&&(y.tagName==="INPUT"||y.tagName==="TEXTAREA"))return;let S=0;const N=()=>{if(be){if(be.cardType==="info"&&be.infoType==="computed"){if(Ve.length>0){const L=Ut(Le,Ve,$e),U=L?ta.current[L]:null;if(U&&(U.focus(),document.activeElement===U)){Ha.current=d;return}}if(De.current&&(De.current.focus(),document.activeElement===De.current)){Ha.current=d;return}}else if(be.cardType==="vocab"&&De.current&&(De.current.focus(),document.activeElement===De.current)){Ha.current=d;return}S<6&&(S+=1,window.setTimeout(N,40))}},H=window.setTimeout(N,40);return()=>window.clearTimeout(H)},[be,Ve,Le,$e]),i.useEffect(()=>{if(!na)return;const d=y=>{y.key==="Enter"&&(y.preventDefault(),dt())};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[na]);const Ja=d=>{Ze(d),aa(Da(d))};i.useEffect(()=>{if(!be){aa(null),Ze([]);return}const d=be.cardType==="info"?"info":"connection";if(be.cardType==="info"&&be.infoType==="quote"){Ka().then(y=>{const S=y.filter(N=>N.itemType==="info"&&N.itemId===be.cardId&&N.checkType==="quote-fragment"&&qt(N.direction,be.direction));Ja(S)}).catch(()=>{aa(null),Ze([])});return}Ot(d,be.cardId,be.checkType,be.direction).then(y=>Ja(y)).catch(()=>{aa(null),Ze([])})},[l,be,A]);const Nt=(d,y,S,N)=>{if(d==="info"&&S==="quote-fragment"){Ka().then(H=>{const L=H.filter(U=>U.itemType==="info"&&U.itemId===y&&U.checkType==="quote-fragment"&&qt(U.direction,N));Ja(L)}).catch(()=>{aa(null),Ze([])});return}Ot(d,y,S,N).then(H=>Ja(H)).catch(()=>{aa(null),Ze([])})},Lt=(d,y,S)=>{var U;const N=((U=S.pairs.find($=>$.leftId===d))==null?void 0:U.rightId)??null;if(!N)return S;const H=N===y;t($=>({...$,[d]:H?"correct":"incorrect"})),D.current&&window.clearTimeout(D.current),Z.current&&window.clearTimeout(Z.current),r.current+=1;const L={kind:H?"correct":"incorrect",tick:r.current};if(T(null),D.current=window.setTimeout(()=>T(L),0),Z.current=window.setTimeout(()=>T(null),420),H){const $={...S.locked,[d]:!0};return Object.keys($).length>=S.pairs.length?(le("correct"),Ue(!0)):le("correct"),{...S,selection:{...S.selection,[d]:y},activeLeft:null,activeRight:null,locked:$}}return le("incorrect"),{...S,activeLeft:null,activeRight:null}},ct=d=>{k(y=>!y||y.locked[d]?y:y.activeRight?Lt(d,y.activeRight,y):{...y,activeLeft:y.activeLeft===d?null:d})},Ea=d=>{k(y=>y&&(y.activeLeft?Lt(y.activeLeft,d,y):{...y,activeRight:y.activeRight===d?null:d}))},dt=()=>{var d;if(be&&be.cardType==="info"&&be.infoType==="quote"&&ia.current&&Se&&!((d=wa(be.direction))!=null&&d.fragmentId)){const y=gt(ia.current,La.current,Aa.current,ca,ba,be.direction,Se.fragmentId);if(y){le(null),Me(""),se(!1),W({}),Ue(!1),oa(null),Ce(0),Fa(ia.current,y.id,Se.title);return}}le(null),Me(""),se(!1),W({}),Ue(!1),oa(null),Ce(0),re(y=>Math.min(y+1,K.length))},Ma=d=>{if(!be)return;const y=d.expected??null,S=d.answer??"";let N=y??"",H=S;if(!y&&d.expectedMap&&d.answerMap){const ye=Object.keys(d.expectedMap).sort((xe,Ie)=>xe.localeCompare(Ie));N=ye.map(xe=>{var Ie;return((Ie=d.expectedMap)==null?void 0:Ie[xe])??""}).join("|"),H=ye.map(xe=>{var Ie;return((Ie=d.answerMap)==null?void 0:Ie[xe])??""}).join("|")}const L=N?ht(N,H,ja):new Uint8Array,U={revisionType:b.id,evalType:d.evalType,direction:d.direction,prompt:ke??"",expected:y,answer:S,expectedAnswers:d.expectedMap??null,answers:d.answerMap??null,correct:d.correct,maskBase64:L.length?Wa(L):null,values:ee??null,checkMode:Q,compareMode:ja,minCorrectness:qa},$=new TextEncoder().encode(JSON.stringify(U)),z=be.cardType==="info"?"info":"connection",ue=d.overrideCheckType??be.checkType??null,he=d.overrideDirection??be.direction??null;Kt({itemType:z,itemId:be.cardId,checkType:ue,direction:he,revisionType:b.id,evalType:d.evalType,correct:d.correct,maskBase64:L.length?Wa(L):null,payloadBase64:Wa($),personRoleId:A??null}).then(()=>{Nt(z,be.cardId,ue,he),lt(K),or(l,A)}).catch(()=>{})},Ya=(d,y)=>{const S=et.current.get(y);if(S)return Promise.resolve(S);const N=Va.current.get(y);if(N)return N;const H=Za({libraryId:l,infoId:d}).then(L=>{var ye,xe;const U=L.payload,$=((ye=U.definition)==null?void 0:ye.graph)??null,z="",ue=((xe=U.definition)==null?void 0:xe.answerTemplate)??"",he=jr($,z,ue);if(he){const Pe={sample:Xr(he),answerTemplate:ue||null};return et.current.set(y,Pe),Pe}return hr({libraryId:l,infoId:d}).then(Ie=>{const Pe={sample:Ie,answerTemplate:null};return et.current.set(y,Pe),Pe})}).catch(()=>hr({libraryId:l,infoId:d}).then(L=>{const U={sample:L,answerTemplate:null};return et.current.set(y,U),U}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Va.current.delete(y)});return Va.current.set(y,H),H},xt=(d,y)=>{var $;const S=`${me(d)}:${y}`,N=at.current.get(S);if(N)return Promise.resolve(N);const H=tt.current.get(S);if(H)return H;const L=z=>(at.current.set(S,z),z);let U;if(d.cardType==="vocab"){if(d.checkType==="translation-match")return U=Promise.resolve(L({prompt:d.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),U;const z=d.label.split("↔").map(ue=>ue.trim()).filter(Boolean);if(z.length>=2){const he=(d.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ye=he?z[0]:z[1],xe=he?z[1]:z[0];U=Promise.resolve(L({prompt:ye,expectedAnswer:xe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else U=Promise.resolve(L({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(d.cardType==="info"&&d.infoType==="word"){const z=($=d.description)!=null&&$.startsWith("Language: ")?d.description.replace("Language: ",""):null;U=Promise.resolve(L({prompt:d.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else d.cardType==="info"&&d.infoType==="computed"?U=Ya(d.cardId,S).then(z=>{var Ie,Pe;if(!z.sample)return L({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ue=z.sample,he=ue.expectedAnswers?Object.entries(ue.expectedAnswers).map(([Ye,Xe])=>({key:Ye,expected:Xe})):[],ye=he.reduce((Ye,Xe)=>(Ye[Xe.key]="",Ye),{}),xe=ue.expectedAnswerIsSentence&&((Ie=ue.expectedAnswer)==null?void 0:Ie.trim())||null;return L({prompt:ue.prompt,expectedAnswer:he.length>0?xe:((Pe=ue.expectedAnswer)==null?void 0:Pe.trim())||null,computedExpected:he,computedAnswers:ye,computedValues:ue.values??null,answerTemplate:z.answerTemplate,outputVariables:ue.outputVariables??null,variableValues:ue.variableValues??null})}).catch(()=>L({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{tt.current.delete(S)}):U=Promise.resolve(L({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return tt.current.set(S,U),U},Fa=(d,y,S)=>{const N=Object.keys(d.nodes).length,H=La.current.size;if(!y){Qe({title:S,before:d.text,after:"",fragmentId:null,total:N,completed:H}),Be(null),Ue(!0);return}const L=d.nodes[y];if(!L)return;const U=Zr(d.text,L);Qe({title:S,before:U.before,after:U.after,fragmentId:L.id,total:N,completed:H}),Be(U.fragment),Ue(!1)},Ct=()=>{const d=ia.current;d&&Qe(y=>y&&{...y,total:Object.keys(d.nodes).length,completed:La.current.size})},ut=()=>{const d=K[ie+1];d&&xt(d,ie+1)},Mt=()=>{if(ut(),be&&be.cardType==="vocab"&&be.checkType==="translation-match"&&v){if(v.pairs.length===0){le("incorrect"),Ue(!0);return}const L=v.pairs.reduce((xe,Ie)=>(xe[Ie.rightId]=Ie.rightLabel,xe),{});let U=0;const $={};v.pairs.forEach(xe=>{const Pe=v.selection[xe.leftId]===xe.rightId;$[xe.leftId]=Pe?"correct":"incorrect",Pe&&(U+=1)});const z=v.pairs.length||1,ue=U/z,he=U===v.pairs.length;t(xe=>({...xe,...$})),he?(le("correct"),Ue(!0),Ce(0)):(le("incorrect"),Ue(!1),Ce(xe=>{const Ie=xe+1;return Ie>=Ra&&(se(!0),Ue(!0),k(Pe=>{if(!Pe)return Pe;const Ye=Pe.pairs.reduce((Xe,ua)=>(Xe[ua.leftId]=ua.rightId,Xe),{});return{...Pe,selection:Ye}})),Ie})),ya(he,ue);const ye="connection";Promise.all(v.pairs.map(xe=>{const Ie=v.selection[xe.leftId]??null,Pe=Ie?L[Ie]:"",Ye={left:xe.leftLabel,expected:xe.rightLabel,answer:Pe,checkType:"translation-match"},Xe=new TextEncoder().encode(JSON.stringify(Ye));return Kt({itemType:ye,itemId:xe.cardId,checkType:"translation-match",direction:null,revisionType:b.id,evalType:"translation-match",correct:Ie===xe.rightId,maskBase64:null,payloadBase64:Wa(Xe),personRoleId:A??null})})).then(()=>{Nt(ye,be.cardId,be.checkType,be.direction),or(l,A)}).catch(()=>{});return}if(Ve.length>0){const L=Ve.reduce(($,z)=>{const ue=ze[z.key]??"";return $[z.key]=va(ue)===va(z.expected)?"correct":"incorrect",$},{});Ve.every(({key:$,expected:z})=>{const ue=ze[$]??"";return Q==="exact"&&va(ue)===va(z)})?(le("correct"),W(L),Ue(!0),Ce(0),ya(!0,1),Ma({correct:!0,direction:ke?`${ke} -> computed`:"computed",expectedMap:Ve.reduce(($,z)=>($[z.key]=z.expected,$),{}),answerMap:ze,evalType:"computed"})):(le("incorrect"),W(L),Ue(!1),Ce($=>{const z=$+1;return z>=Ra&&X&&(se(!0),Ue(!0)),z}),ya(!1,0),window.setTimeout(()=>{var z;const $=Ut(Le,Ve,$e);$&&ta.current[$]&&((z=ta.current[$])==null||z.focus())},40),Ma({correct:!1,direction:ke?`${ke} -> computed`:"computed",expectedMap:Ve.reduce(($,z)=>($[z.key]=z.expected,$),{}),answerMap:ze,evalType:"computed"}));return}if(be&&be.cardType==="info"&&be.infoType==="quote"&&(Se!=null&&Se.fragmentId)){if(!Ne)return;const L=wa(be.direction),U=(L==null?void 0:L.mode)??getQuoteMode(be.direction),$=L!=null&&L.fragmentId&&be.direction?be.direction:kt(U,Se.fragmentId),z=oi(Ne,B,ja),ue=Q==="exact"&&mt(B)===mt(Ne),he=_a(z),ye=ue||he,xe=za(z);ye?(Aa.current[Se.fragmentId]=Math.max(Aa.current[Se.fragmentId]??0,xe),(Aa.current[Se.fragmentId]??0)>=ca&&La.current.add(Se.fragmentId),Ct(),le("correct"),W({}),Ue(!0),oa(z),Ce(0),xe<100&&Ra<=1&&se(!0),ya(!0,xe/100),Ma({correct:!0,direction:`quote:${Se.fragmentId}`,expected:Ne,answer:B,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:$})):(le("incorrect"),W({}),Ue(!1),oa(z),Ce(Ie=>{const Pe=Ie+1;return Pe>=Ra&&X&&(se(!0),Ue(!0)),Pe}),ya(!1,xe/100),window.setTimeout(()=>{var Ie;return(Ie=De.current)==null?void 0:Ie.focus()},40),Ma({correct:!1,direction:`quote:${Se.fragmentId}`,expected:Ne,answer:B,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:$}));return}if(!Ne)return;const d=ht(Ne,B,ja),y=Q==="exact"&&va(B)===va(Ne),S=_a(d),N=y||S,H=za(d);N?(le("correct"),W({}),Ue(!0),oa(d),Ce(0),H<100&&Ra<=1&&se(!0),ya(!0,H/100),Ma({correct:!0,direction:ke?`${ke} -> ${Ne}`:null,expected:Ne,answer:B,evalType:"text"})):(le("incorrect"),W({}),Ue(!1),oa(d),Ce(L=>{const U=L+1;return U>=Ra&&X&&(se(!0),Ue(!0)),U}),ya(!1,H/100),window.setTimeout(()=>{var L;return(L=De.current)==null?void 0:L.focus()},40),Ma({correct:!1,direction:ke?`${ke} -> ${Ne}`:null,expected:Ne,answer:B,evalType:"text"}))},Zt=d=>{if(ut(),!Ne)return;const y=ht(Ne,d,ja),S=va(d)===va(Ne),N=_a(y),H=S||N,L=za(y);H?(le("correct"),W({}),Ue(!0),oa(y),Ce(0),L<100&&Ra<=1&&se(!0),ya(!0,L/100),Ma({correct:!0,direction:"word->language",expected:Ne,answer:d,evalType:"language-select"})):(le("incorrect"),W({}),Ue(!1),oa(y),Ce(U=>{const $=U+1;return $>=Ra&&X&&(se(!0),Ue(!0)),$}),ya(!1,L/100),Ma({correct:!1,direction:"word->language",expected:Ne,answer:d,evalType:"language-select"}))},er=()=>{ut(),le("correct"),Ue(!0),Ce(0),ya(!0,1),Ne&&Ma({correct:!0,direction:"manual",expected:Ne,answer:B,evalType:"manual"})},ar=()=>{if(ya(!1,0),be&&be.cardType==="info"&&be.infoType==="quote"){le(null),Me(""),se(!1),W({}),Ue(!1),oa(null),Ce(0),re(d=>Math.min(d+1,K.length));return}dt()};i.useEffect(()=>{ut()},[ie,K]);const Qa=d=>{var S;if(d.key!=="Enter")return;if(d.preventDefault(),d.stopPropagation(),na){dt();return}const y=Ve.find(N=>!(ze[N.key]??"").trim());if(y){(S=ta.current[y.key])==null||S.focus();return}Mt()},R=a.cogita.library.revision.revealModeAfterIncorrect,X=Ve.length>0||!!Ne;return e.jsxs(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:[ve==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ce.total?Math.min(100,Math.max(0,ce.current/ce.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ce.total?`${Math.min(ce.current,ce.total)} / ${ce.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:P}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",j).replace("{check}",G)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:V,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${V}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${V}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:we?`${we.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[$a?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",$a.currentLevel??"-"," / ",$a.levelsCount]}):null,we?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(we.correct)).replace("{total}",String(we.total))}),we.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(we.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:Ge})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Fe?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Fe})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":h?`${h.kind}-${h.tick}`:je?"idle":oe??"idle",children:be?e.jsx(e.Fragment,{children:pa?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:be,currentTypeLabel:pt,prompt:ke,languages:ge,answer:B,onAnswerChange:d=>Me(y=>_t(y,d,te)),computedExpected:Ve,computedAnswers:ze,onComputedAnswerChange:(d,y)=>sa(S=>({...S,[d]:_t(S[d]??"",y,te)})),answerTemplate:Le,outputVariables:$e,variableValues:Ae,computedFieldFeedback:Re,feedback:oe,canAdvance:na,quoteContext:Se,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:ar,onLanguageSelect:Zt,onMarkReviewed:er,onAdvance:dt,showCorrectAnswer:de,setShowCorrectAnswer:se,onRevealCorrect:()=>Ue(!0),answerMask:Pa,expectedAnswer:Ne,hasExpectedAnswer:X,handleComputedKeyDown:Qa,answerInputRef:De,computedInputRefs:ta,scriptMode:te,setScriptMode:ae,matchPairs:v==null?void 0:v.pairs,matchLeftOrder:v==null?void 0:v.leftOrder,matchRightOrder:v==null?void 0:v.rightOrder,matchSelection:v==null?void 0:v.selection,matchActiveLeft:v==null?void 0:v.activeLeft,matchActiveRight:v==null?void 0:v.activeRight,matchFeedback:Y,onMatchLeftSelect:ct,onMatchRightSelect:Ea})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${V}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:rt?`${it} / ${rt}`:a.cogita.library.revision.progressUnlimited}),ve==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ve==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ve==="ready"&&K.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:R}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ra]})]})]}),$a?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",$a.activeCount," / ",$a.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:$a.counts.map((d,y)=>{const S=y+1,N=$a.currentLevel===S,H=$a.percentages[y]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":N,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:S}),e.jsx("strong",{children:d})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,H))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[H.toFixed(1),"%"]})]},`level-${S}`)})})]}):null,xa?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:xa.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:xa.dots.map(d=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,d.value*100))}%`,background:`rgba(${Math.round(255*(1-d.value))}, ${Math.round(200*d.value)}, 80, 0.9)`}},d.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:xa.knownCount})]})]}):null,ba?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:st})]})}):null]})]})]})})})]})]})}const sr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],An={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Fn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Bn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Dn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C}){const[m,x]=i.useState(""),[V,J,q]=Or([]),[s,b,f]=Vr([]),[Q,A]=i.useState(null),[j,G]=i.useState(null),[P,ne]=i.useState(null),K=`/#/cogita/library/${l}`;i.useEffect(()=>{Wt(l,C).then(c=>x(c.name)).catch(()=>x(a.cogita.library.collections.defaultName))},[l,C,a]),i.useEffect(()=>{Si({libraryId:l,collectionId:C}).then(c=>{if(!c.graphId||c.graphId==="00000000-0000-0000-0000-000000000000"){J([]),b([]);return}const ie=c.nodes.map(B=>{var ke;const Me=B.payload??{},oe=Me.position??{x:120,y:120},le=Me.params??{};return{id:B.nodeId,type:"default",position:oe,data:{nodeType:B.nodeType,label:((ke=sr.find(Te=>Te.type===B.nodeType))==null?void 0:ke.label)??B.nodeType,params:le}}}),re=c.edges.map(B=>({id:B.edgeId,source:B.fromNodeId,target:B.toNodeId,sourceHandle:B.fromPort??void 0,targetHandle:B.toPort??void 0}));J(ie),b(re)}).catch(()=>{J([]),b([])})},[l,C,b,J]);const O=i.useMemo(()=>V.find(c=>c.id===Q)??null,[V,Q]),ge=c=>{var Me;const ie=crypto.randomUUID(),re=((Me=sr.find(oe=>oe.type===c))==null?void 0:Me.label)??c,B={...An[c]};J(oe=>[...oe,{id:ie,type:"default",position:{x:120+oe.length*40,y:120+oe.length*40},data:{nodeType:c,label:re,params:B}}]),A(ie)},pe=i.useCallback(c=>{b(ie=>Rt({...c,id:crypto.randomUUID()},ie))},[b]),ve=async()=>{G(null);try{await Pi({libraryId:l,collectionId:C,nodes:V.map(c=>({nodeId:c.id,nodeType:c.data.nodeType,payload:{position:c.position,params:c.data.params}})),edges:s.map(c=>({edgeId:c.id,fromNodeId:c.source,fromPort:c.sourceHandle??null,toNodeId:c.target,toPort:c.targetHandle??null}))}),G(a.cogita.library.graph.saveSuccess)}catch{G(a.cogita.library.graph.saveFail)}},F=async()=>{try{const c=await Ii({libraryId:l,collectionId:C});ne(c)}catch{ne(null)}},ce=c=>{O&&J(ie=>ie.map(re=>re.id===O.id?{...re,data:{...re.data,params:c}}:re))};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${K}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:F,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ve,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:sr.map(c=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ge(c.type),children:c.label},c.type))}),j?e.jsx("p",{className:"cogita-help",children:j}):null,P&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(P.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(P.connections)).replace("{infos}",String(P.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(fr,{nodes:V,edges:s,onNodesChange:q,onEdgesChange:f,onConnect:pe,onNodeClick:(c,ie)=>A(ie.id),fitView:!0,children:[e.jsx(xr,{color:"rgba(120,160,200,0.2)"}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),O?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:O.data.label}),O.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:O.data.params.tagId?{id:O.data.params.tagId,label:O.data.params.tagLabel??"",infoType:"topic"}:null,onChange:c=>ce({...O.data.params,tagId:(c==null?void 0:c.id)??null,tagLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:O.data.params.scope??"any",onChange:c=>ce({...O.data.params,scope:c.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),O.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:O.data.params.languageId?{id:O.data.params.languageId,label:O.data.params.languageLabel??"",infoType:"language"}:null,onChange:c=>ce({...O.data.params,languageId:(c==null?void 0:c.id)??null,languageLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:O.data.params.scope??"any",onChange:c=>ce({...O.data.params,scope:c.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),O.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:O.data.params.infoType??"word",onChange:c=>ce({...O.data.params,infoType:c.target.value}),children:Bn.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsx(We,{libraryId:l,infoType:O.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:O.data.params.infoId?{id:O.data.params.infoId,label:O.data.params.infoLabel??"",infoType:O.data.params.infoType??"word"}:null,onChange:c=>ce({...O.data.params,infoId:(c==null?void 0:c.id)??null,infoLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),O.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:O.data.params.connectionType??"translation",onChange:c=>ce({...O.data.params,connectionType:c.target.value}),children:Fn.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:O.data.params.connectionId??"",onChange:c=>ce({...O.data.params,connectionId:c.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(O.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const cr="cogita.preferences",ci=["library_overview","all_cards","new_card","all_collections","new_collection","storyboards","new_storyboard","texts","new_text","dependencies","transfer"],dr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ur=["settings","run","shared"];function Kn(a,n=""){const o=a.split("/").filter(Boolean);if(o[0]!=="cogita"||o[1]!=="library")return{};const u=o[2];if(!u)return{};if(!o[3])return{libraryId:u,target:"library_overview"};const g=new URLSearchParams(n),w=g.get("revisionId")??void 0,p=g.get("collectionAction"),I=g.get("libraryAction");if(o[3]==="list")return{libraryId:u,target:I==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:w,libraryAction:I==="new-info"?"new-info":void 0};if(o[3]==="detail"||o[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:o[3],revisionId:w};if(o[3]==="new"||o[3]==="add")return{libraryId:u,target:"new_card",revisionId:w,libraryAction:"new-info"};if(o[3]==="edit")return{libraryId:u,target:"new_card",revisionId:w,infoId:o[4]};if(o[3]==="shared-revisions")return{libraryId:u,target:"all_collections",revisionId:w};if(o[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(o[3]==="transfer")return{libraryId:u,target:"transfer"};if(o[3]==="storyboards")return o[4]==="new"?{libraryId:u,target:"new_storyboard"}:{libraryId:u,target:"storyboards"};if(o[3]==="texts")return o[4]==="new"?{libraryId:u,target:"new_text"}:{libraryId:u,target:"texts"};if(o[3]!=="collections")return{libraryId:u,target:"library_overview"};if(o[4]==="new")return{libraryId:u,target:"new_collection",revisionId:w};const M=o[4];return M?o[5]==="graph"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"graph"}:o[5]==="shared-revisions"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"shared"}:o[5]==="revision"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:o[6]==="run"?"run":"settings"}:p==="new-revision"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"new"}:{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"detail"}:p==="new-collection"?{libraryId:u,target:"new_collection",collectionAction:"new-collection"}:{libraryId:u,target:"all_collections"}}function gr(a,n="library_overview",o,u,g,w){const p=(I,M)=>{const E=new URLSearchParams;M!=null&&M.revisionId&&E.set("revisionId",M.revisionId),M!=null&&M.collectionAction&&E.set("collectionAction",M.collectionAction),M!=null&&M.libraryAction&&E.set("libraryAction",M.libraryAction);const l=E.toString();return l?`${I}?${l}`:I};return a?n==="library_overview"?p(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?p(`/cogita/library/${a}/list`,{revisionId:g}):n==="new_card"?w?p(`/cogita/library/${a}/edit/${w}`,{revisionId:g}):p(`/cogita/library/${a}/list`,{revisionId:g,libraryAction:"new-info"}):n==="all_collections"?o?u==="graph"?p(`/cogita/library/${a}/collections/${o}/graph`,{revisionId:g}):u==="settings"?p(`/cogita/library/${a}/collections/${o}/revision`,{revisionId:g}):u==="run"?p(`/cogita/library/${a}/collections/${o}/revision/run`,{revisionId:g}):u==="shared"?p(`/cogita/library/${a}/collections/${o}/shared-revisions`,{revisionId:g}):u==="new"?p(`/cogita/library/${a}/collections/${o}`,{revisionId:g,collectionAction:"new-revision"}):p(`/cogita/library/${a}/collections/${o}`,{revisionId:g}):p(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?p(`/cogita/library/${a}/collections`,{revisionId:g,collectionAction:"new-collection"}):n==="transfer"?p(`/cogita/library/${a}/transfer`,{revisionId:g}):n==="storyboards"?p(`/cogita/library/${a}/storyboards`,{revisionId:g}):n==="new_storyboard"?p(`/cogita/library/${a}/storyboards/new`,{revisionId:g}):n==="texts"?p(`/cogita/library/${a}/texts`,{revisionId:g}):n==="new_text"?p(`/cogita/library/${a}/texts/new`,{revisionId:g}):n==="dependencies"?p(`/cogita/library/${a}/dependencies`,{revisionId:g}):p(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function It(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function On(a){return typeof a=="string"&&ci.includes(a)}function Vn(a,n){var I;if(!a.length)return null;const o=a.filter(M=>n.has(M.roleId)),u=o.length>0?o:a,g=u.map(M=>{var l,C;const E=((C=(l=M.fields.find(m=>m.fieldType==="role_kind"))==null?void 0:l.plainValue)==null?void 0:C.toLowerCase())??"";return{roleId:M.roleId,roleKind:E}}),w=g.find(M=>M.roleKind.includes("master"));if(w)return w.roleId;const p=g.find(M=>M.roleKind.includes("account")||M.roleKind.includes("user"));return p?p.roleId:((I=u[0])==null?void 0:I.roleId)??null}function qn(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function _n({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E}){const l=hi(),C=vr(),m=i.useMemo(()=>Kn(C.pathname,C.search),[C.pathname,C.search]),x=a.cogita.workspace,[V,J]=i.useState([]),[q,s]=i.useState([]),[b,f]=i.useState([]),[Q,A]=i.useState(void 0),[j,G]=i.useState("library_overview"),[P,ne]=i.useState(void 0),[K,O]=i.useState(void 0),[ge,pe]=i.useState("detail"),[ve,F]=i.useState(void 0),[ce,c]=i.useState(!1),[ie,re]=i.useState(!0),[B,Me]=i.useState(!1),[oe,le]=i.useState(!1),[ke,Te]=i.useState(null),[Ne,Be]=i.useState(""),[Se,Qe]=i.useState(""),[Ve,Ee]=i.useState(""),[ze,sa]=i.useState(""),[Re,W]=i.useState(null),[ee,Ke]=i.useState(null),Le=i.useRef({version:1,byLibrary:{}}),fe=i.useRef(!1),$e=i.useRef(!1),qe=i.useRef(null),Ae=i.useMemo(()=>V.find(_=>_.libraryId===Q)??null,[V,Q]),Oe=i.useMemo(()=>q.find(_=>_.collectionId===P)??null,[q,P]),v=i.useMemo(()=>b.find(_=>_.revisionId===K)??null,[b,K]),k=i.useMemo(()=>({detail:x.revisions.detail,graph:x.revisions.graph,settings:x.revisions.settings,run:x.revisions.run,shared:x.targets.sharedRevisions,new:x.revisionForm.createAction}),[x.revisions.detail,x.revisions.graph,x.revisions.run,x.revisions.settings,x.targets.sharedRevisions,x.revisionForm.createAction]),Y=i.useMemo(()=>[{value:"detail",label:k.detail},{value:"graph",label:k.graph},{value:"settings",label:x.targets.allRevisions},{value:"new",label:k.new},{value:"run",label:k.run},{value:"shared",label:k.shared}],[k.detail,k.graph,k.new,k.run,k.shared,x.targets.allRevisions]),t=i.useMemo(()=>({library_overview:x.targets.libraryOverview,all_cards:x.targets.allCards,new_card:x.targets.newCard,all_collections:x.targets.allCollections,new_collection:x.targets.newCollection,transfer:x.targets.transfer,storyboards:x.targets.storyboards,new_storyboard:x.targets.newStoryboard,texts:x.targets.texts,new_text:x.targets.newText,dependencies:x.targets.dependencies}),[x.targets]),r=i.useMemo(()=>t[j]??j,[j,t]),h=k[ge],T=!!Q,D=!!P,Z=T&&j==="all_collections",te=D&&j==="all_collections",ae=D&&j==="all_collections"&&ur.includes(ge),de=i.useCallback(_=>{const Ce=!!_.libraryId;let De=_.target,ta=_.collectionId,na=_.revisionId,Ue=_.revisionView,la=_.infoId;Ce?dr[De].requiresCollection&&!ta?(De="all_collections",na=void 0,Ue="detail"):De!=="all_collections"?(ta=void 0,na=void 0,De!=="new_card"&&(la=void 0)):dr[De].allowsRevision?ur.includes(Ue)||(na=void 0):Ue="detail":(De="library_overview",ta=void 0,na=void 0,Ue="detail",la=void 0),A(_.libraryId),G(De),ne(ta),O(na),pe(Ue),c(!1);const ga=It(gr(_.libraryId,De,ta,Ue,na,la));It(`${C.pathname}${C.search}`)!==ga&&(qe.current=ga,l(ga))},[C.pathname,C.search,l]),se=_=>{de({libraryId:Q,target:"all_collections",collectionId:P,revisionId:ur.includes(_)?K:void 0,revisionView:_})},we=i.useMemo(()=>[{key:"library",label:x.layers.library,visible:!0,value:Q??"",selectedLabel:(Ae==null?void 0:Ae.name)??x.path.noLibrarySelected,disabled:ie||V.length===0,options:V.map(_=>({value:_.libraryId,label:_.name})),emptyOption:x.noLibraryOption,onSelect:_=>{const Ce=_||void 0;de({libraryId:Ce,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:x.layers.target,visible:T,value:j,selectedLabel:r,disabled:!T,options:ci.map(_=>({value:_,label:t[_]})),onSelect:_=>{const Ce=_;de({libraryId:Q,target:Ce,collectionId:P,revisionId:K,revisionView:ge,infoId:Ce==="new_card"?m.infoId:void 0})}},{key:"collection",label:x.layers.collection,visible:Z,value:P??"",selectedLabel:(Oe==null?void 0:Oe.name)??x.path.noCollectionSelected,disabled:!T||B||q.length===0,options:q.map(_=>({value:_.collectionId,label:_.name})),emptyOption:x.selectCollectionOption,onSelect:_=>{de({libraryId:Q,target:"all_collections",collectionId:_||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:x.layers.revision,visible:te,value:ge,selectedLabel:h,disabled:!P,options:Y.map(_=>({value:_.value,label:_.label})),onSelect:_=>{se(_)}},{key:"revision_entry",label:x.layers.revision,visible:ae,value:K??"",selectedLabel:(v==null?void 0:v.name)??x.status.noRevisions,disabled:!D||oe||b.length===0,options:b.map(_=>({value:_.revisionId,label:_.name})),emptyOption:x.status.noRevisions,onSelect:_=>{de({libraryId:Q,target:"all_collections",collectionId:P,revisionId:_||void 0,revisionView:ge})}},{key:"selected_info",label:a.cogita.library.list.selectedTitle,visible:!!m.infoId,value:m.infoId??"",selectedLabel:ve??m.infoId??"",disabled:!0,options:[],onSelect:_=>{}}],[Y,q,B,V,ie,de,b,oe,Oe,P,v,K,ve,D,T,Ae,Q,h,ge,j,r,Z,te,ae,t,a.cogita.library.list.selectedTitle,m.infoId,x.layers.collection,x.layers.library,x.layers.revision,x.layers.target,x.noLibraryOption,x.path.noCollectionSelected,x.path.noLibrarySelected,x.selectCollectionOption]),aa=i.useMemo(()=>we.filter(_=>_.visible),[we]),Ge=i.useMemo(()=>aa.filter(_=>_.key!=="library"&&_.key!=="collection"&&_.key!=="revision_entry"&&_.key!=="selected_info"),[aa]),Ze=i.useMemo(()=>Ge.find(_=>_.key==="target")??null,[Ge]),Fe=i.useMemo(()=>Ge.find(_=>_.key==="collection_action")??null,[Ge]),He=i.useMemo(()=>{const _=m.libraryId;if(!_||!C.pathname.startsWith("/cogita/library/"))return null;const Ce={copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:_};if(m.target==="library_overview")return e.jsx(Qi,{...Ce});if(m.target==="all_cards")return e.jsx($r,{...Ce,mode:m.cardMode??"list"});if(m.target==="new_card")return m.infoId?e.jsx(nn,{...Ce,editInfoId:m.infoId}):e.jsx($r,{...Ce,mode:"list"});if(m.target==="dependencies")return e.jsx(on,{...Ce});if(m.target==="transfer")return e.jsx(cn,{...Ce});if(m.target==="storyboards"||m.target==="new_storyboard")return e.jsx(dn,{...Ce});if(m.target==="texts"||m.target==="new_text")return e.jsx(un,{...Ce});if(m.target==="all_collections"){if(m.collectionId){const De={...Ce,collectionId:m.collectionId};return m.revisionView==="graph"?e.jsx(Dn,{...De}):m.revisionView==="shared"?e.jsx(sn,{...Ce,collectionId:m.collectionId}):m.revisionView==="settings"?e.jsx(jn,{...De,revisionId:m.revisionId}):m.revisionView==="run"?e.jsx(En,{...De,revisionId:m.revisionId}):e.jsx(gn,{...De})}return e.jsx(Dr,{...Ce})}return m.target==="new_collection"?e.jsx(Dr,{...Ce}):null},[n,a,M,C.pathname,l,E,w,I,u,g,m.cardMode,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,p,o]);i.useEffect(()=>{let _=!1;return(async()=>{var De,ta,na,Ue,la,ga,Na;re(!0);try{await Ri();const[Ta,ma,fa]=await Promise.all([Ur(),$i(),Ei()]);if(_)return;J(Ta);const Sa=new Set(fa.nodes.filter(be=>be.nodeType==="role"&&be.canLink).map(be=>be.roleId??"")),pa=Vn(ma,Sa);if(W(pa),pa){const be=fa.nodes.find(je=>je.nodeType==="data"&&je.roleId===pa&&(je.fieldType===cr||je.label===cr));Ke((be==null?void 0:be.dataKeyId)??null),Le.current=qn(be==null?void 0:be.value)}const Je=Le.current.lastLibraryId,ia=((De=Ta.find(be=>be.libraryId===m.libraryId))==null?void 0:De.libraryId)??(Ta.length===1?Ta[0].libraryId:void 0)??((ta=Ta.find(be=>be.libraryId===Je))==null?void 0:ta.libraryId)??((na=Ta[0])==null?void 0:na.libraryId),La=ia?(la=(Ue=Le.current.byLibrary)==null?void 0:Ue[ia])==null?void 0:la.lastTarget:void 0,Aa=On(La)?La:"library_overview";A(ia),G(m.target??Aa),O(m.revisionId??(ia?(Na=(ga=Le.current.byLibrary)==null?void 0:ga[ia])==null?void 0:Na.lastRevisionId:void 0)),pe(m.revisionView??"detail"),fe.current=!0}catch{_||Te(x.status.loadFailed)}finally{_||re(!1)}})(),()=>{_=!0}},[x.status.loadFailed]),i.useLayoutEffect(()=>{fe.current&&(m.libraryId&&V.some(_=>_.libraryId===m.libraryId)&&A(m.libraryId),m.target&&G(m.target),ne(m.collectionId),O(m.revisionId),m.revisionView&&pe(m.revisionView))},[V,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target]),i.useEffect(()=>{if(!Q){s([]),ne(void 0),f([]),O(void 0);return}let _=!1;return Me(!0),jt({libraryId:Q,limit:200}).then(Ce=>{var na;if(_)return;const De=Ce.items;s(De);const ta=(na=De.find(Ue=>Ue.collectionId===m.collectionId))==null?void 0:na.collectionId;ne(ta)}).catch(()=>{_||(s([]),ne(void 0))}).finally(()=>{_||Me(!1)}),()=>{_=!0}},[m.collectionId,Q]),i.useEffect(()=>{if(!Q||!P){f([]),O(void 0);return}let _=!1;return le(!0),Wr({libraryId:Q,collectionId:P}).then(Ce=>{var na,Ue,la,ga;if(_)return;f(Ce);const De=(Ue=(na=Le.current.byLibrary)==null?void 0:na[Q])==null?void 0:Ue.lastRevisionId,ta=((la=Ce.find(Na=>Na.revisionId===m.revisionId))==null?void 0:la.revisionId)??((ga=Ce.find(Na=>Na.revisionId===De))==null?void 0:ga.revisionId);O(ta)}).catch(()=>{_||(f([]),O(void 0))}).finally(()=>{_||le(!1)}),()=>{_=!0}},[m.revisionId,P,Q]),i.useEffect(()=>{const _=m.infoId;if(!Q||!_){F(void 0);return}let Ce=!1;return Za({libraryId:Q,infoId:_}).then(De=>{if(Ce)return;const ta=De.payload;F((ta==null?void 0:ta.label)??(ta==null?void 0:ta.name)??(ta==null?void 0:ta.title)??De.infoId)}).catch(()=>{Ce||F(_)}),()=>{Ce=!0}},[m.infoId,Q]),i.useEffect(()=>{if(!fe.current||m.libraryId&&V.some(De=>De.libraryId===m.libraryId)&&m.libraryId!==Q||m.target&&m.target!==j||m.revisionView&&m.revisionView!==ge||m.revisionId&&m.revisionId!==K||dr[j].requiresCollection&&!P&&m.target==="all_collections"&&m.collectionId)return;const _=It(`${C.pathname}${C.search}`),Ce=It(gr(Q,j,P,ge,K,m.infoId));if(_===Ce){qe.current=null;return}qe.current!==Ce&&(qe.current=Ce,l(Ce,{replace:!0}))},[V,C.pathname,C.search,l,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,P,Q,K,ge,j]),i.useEffect(()=>{if(typeof window>"u")return;const _=()=>{window.innerWidth>920&&c(!1)};return window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[]),i.useEffect(()=>{if(!fe.current||!Re||!Q||$e.current)return;const _=Le.current,Ce={..._.byLibrary??{}},De={...Ce[Q]??{},lastCollectionId:P,lastRevisionId:K,lastRevisionView:ge,lastTarget:j},ta={version:1,lastLibraryId:Q,byLibrary:{...Ce,[Q]:De}},na=JSON.stringify(_),Ue=JSON.stringify(ta);if(na===Ue)return;Le.current=ta,$e.current=!0,(async()=>{try{if(ee)await Ai(ee,{plainValue:Ue});else{const ga=await Fi(Re,{itemName:cr,itemType:"data",plainValue:Ue});Ke(ga.dataItemId)}}catch{Te(x.status.savePrefsFailed)}finally{$e.current=!1}})()},[ee,Re,P,Q,K,ge,j,x.status.savePrefsFailed]);const _e=async()=>{const _=Ne.trim();if(!_){Te(a.cogita.user.libraryNameRequired);return}Te(null);try{const Ce=await Ki({name:_});J(De=>[Ce,...De]),A(Ce.libraryId),G("library_overview"),ne(void 0),Be("")}catch{Te(a.cogita.user.libraryCreateFailed)}},ea=async()=>{if(!Q){Te(x.status.selectLibraryFirst);return}const _=Se.trim();if(!_){Te(a.cogita.library.collections.saveRequiredName);return}Te(null);try{const Ce=await Bi({libraryId:Q,name:_,items:[]}),De=await jt({libraryId:Q,limit:200});s(De.items),ne(Ce.collectionId),O(void 0),G("all_collections"),pe("detail"),Qe("")}catch{Te(a.cogita.library.collections.saveFail)}},Pa=async()=>{if(!Q){Te(x.status.selectLibraryFirst);return}const _=Ve.trim();if(!_){Te(a.cogita.library.add.info.labelLabel);return}Te(null);try{await Ua({libraryId:Q,infoType:"topic",payload:{label:_,notes:""}}),Ee(""),de({libraryId:Q,target:"all_cards",collectionId:P,revisionId:K,revisionView:ge})}catch{Te(a.cogita.library.add.info.messages.failed)}},oa=async()=>{if(!Q||!P){Te(x.status.selectLibraryFirst);return}const _=ze.trim();if(!_){Te(x.revisionForm.nameLabel);return}Te(null);try{const Ce=await Di({libraryId:Q,collectionId:P,name:_,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});f(De=>[Ce,...De]),O(Ce.revisionId),G("all_collections"),pe("settings"),sa("")}catch{Te(x.status.loadFailed)}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${ce?"open":""}`,"aria-label":x.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Ae==null?void 0:Ae.name)??x.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Ae?x.sidebar.libraryActionsHint:x.status.selectLibraryFirst}),Ze?e.jsx("div",{className:"cogita-sidebar-actions",children:Ze.options.map(_=>e.jsx("button",{type:"button",className:`ghost ${String(Ze.value)===_.value?"active":""}`,onClick:()=>Ze.onSelect(_.value),disabled:Ze.disabled,children:_.label},`sidebar:target:${_.value}`))}):null]}),Oe?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:Oe.name}),e.jsx("p",{className:"cogita-sidebar-note",children:x.sidebar.collectionActionsHint}),Fe?e.jsx("div",{className:"cogita-sidebar-actions",children:Fe.options.map(_=>e.jsx("button",{type:"button",className:`ghost ${String(Fe.value)===_.value?"active":""}`,onClick:()=>Fe.onSelect(_.value),disabled:Fe.disabled,children:_.label},`sidebar:revision:${_.value}`))}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:x.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:u,children:x.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{I("cogita"),c(!1)},children:x.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:p?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),ce?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":x.sidebar.closeMenu,onClick:()=>c(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":x.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>c(_=>!_),"aria-label":ce?x.sidebar.closeMenu:x.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),aa.map((_,Ce)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Ce>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,_.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":_.label,children:_.selectedLabel}):e.jsxs("select",{"aria-label":_.label,value:_.value,onChange:De=>_.onSelect(De.target.value),disabled:_.disabled,children:[_.emptyOption?e.jsx("option",{value:"",children:_.emptyOption}):null,_.options.map(De=>e.jsx("option",{value:De.value,children:De.label},`${_.key}:${De.value}`))]})]},`menu:${_.key}`))]}),He?e.jsxs(e.Fragment,{children:[j==="new_card"&&!m.infoId?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.actions.addInfo}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:Ve,onChange:_=>Ee(_.target.value),placeholder:a.cogita.library.add.info.labelPlaceholder,disabled:!Q})]}),e.jsx("button",{type:"button",className:"cta",onClick:Pa,disabled:!Q,children:a.cogita.library.actions.addInfo}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,j==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.collections.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Se,onChange:_=>Qe(_.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!Q})]}),e.jsx("button",{type:"button",className:"cta",onClick:ea,disabled:!Q,children:a.cogita.library.collections.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,j==="all_collections"&&P&&ge==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:ze,onChange:_=>sa(_.target.value),placeholder:x.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:oa,children:x.revisionForm.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Qr.Provider,{value:!0,children:He})})]}):null,He?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[aa.map((_,Ce)=>e.jsxs("span",{children:[Ce>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:_.selectedLabel})]},`path:${_.key}`)),Z?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:x.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[x.path.currentRoute," ",e.jsx("code",{children:gr(Q,j,P,ge,K,m.infoId)})]}),Q?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${Q}`,children:x.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${Q}/list`,children:x.links.allCards}),P?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${Q}/collections/${P}/shared-revisions`,children:x.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ne,onChange:_=>Be(_.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:_e,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Se,onChange:_=>Qe(_.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!Q})]}),e.jsx("button",{type:"button",className:"cta",onClick:ea,disabled:!Q,children:a.cogita.library.collections.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:ze,onChange:_=>sa(_.target.value),placeholder:x.revisionForm.namePlaceholder,disabled:!P})]}),e.jsx("button",{type:"button",className:"cta",onClick:oa,disabled:!P,children:x.revisionForm.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:x.panels.collections}),B?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.loadingCollections}):null,!B&&q.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.noCollections}):null,q.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:q.map(_=>e.jsxs("button",{type:"button",className:`cogita-card-item ${_.collectionId===P?"active":""}`,onClick:()=>{ne(_.collectionId),O(void 0),pe("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:x.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:_.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[_.itemCount," ",x.cards.itemsSuffix]})]},_.collectionId))}):null]})]})]})]})})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:_n},Symbol.toStringTag,{value:"Module"}));function Un({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,shareId:l}){const[C,m]=i.useState(null),[x,V]=i.useState("loading"),[J,q]=i.useState(a.cogita.library.collections.defaultName),[s,b]=i.useState("Cogita Library"),[f,Q]=i.useState([]),[A,j]=i.useState([]),[G,P]=i.useState("idle"),[ne,K]=i.useState({current:0,total:0}),[O,ge]=i.useState(0),[pe,ve]=i.useState(""),[F,ce]=i.useState(null),[c,ie]=i.useState(null),[re,B]=i.useState(null),[Me,oe]=i.useState(null),[le,ke]=i.useState([]),[Te,Ne]=i.useState({}),[Be,Se]=i.useState({}),[Qe,Ve]=i.useState(null),[Ee,ze]=i.useState(null),[sa,Re]=i.useState(null),[W,ee]=i.useState(null),[Ke,Le]=i.useState({}),fe=i.useRef(0),[$e,qe]=i.useState(null),Ae=i.useRef(null),Oe=i.useRef(null),[v,k]=i.useState(null),[Y,t]=i.useState(!1),[r,h]=i.useState(null),[T,D]=i.useState([]),[Z,te]=i.useState(null),ae=i.useRef(null),de=i.useRef(null),[se,we]=i.useState(null),[aa,Ge]=i.useState(0),Ze=i.useRef(null),Fe=i.useRef({}),[He,_e]=i.useState(!1),[ea,Pa]=i.useState({}),oa=i.useRef(null),_=i.useRef(new Set),Ce=i.useRef({}),[De,ta]=i.useState([]),[na,Ue]=i.useState(new Set),[la,ga]=i.useState(!1),Na=vr(),Ta=i.useMemo(()=>new URLSearchParams(Na.search),[Na.search]),ma=i.useMemo(()=>Ta.get("key")??"",[Ta]),fa=(C==null?void 0:C.mode)??"random",Sa=(C==null?void 0:C.check)??"exact",pa=(C==null?void 0:C.limit)??20,Je=i.useMemo(()=>Nr((C==null?void 0:C.revisionType)??fa),[C,fa]),ia=i.useMemo(()=>{const R=C==null?void 0:C.revisionSettings,X=ti(Je,Ta);return Jt(Je,R??X)},[C,Ta,Je]),La=i.useMemo(()=>a.cogita.library.revision[Je.labelKey]??fa,[a,fa,Je]),Aa=i.useMemo(()=>Sa==="exact"?a.cogita.library.revision.checkValue:Sa,[a,Sa]),je=x==="ready"?f[O]??null:null,et=(je==null?void 0:je.checkType)==="translation-match"&&W,Va=i.useRef(new Map),at=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useRef(new Map),Yt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?ra(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),rt=i.useMemo(()=>{var X;return Je.id!=="levels"?f.length:((X=ea.pool)==null?void 0:X.length)??Je.getFetchLimit(pa,ia)},[ea,ia,Je,f.length,pa]),it=Je.getProgressTotal?Je.getProgressTotal(f,ea,pa,ia):Je.id==="levels"?Math.min(pa,rt):f.length,Ra=it?Math.min(O+1,it):0,ja=Math.max(1,Number(ia.tries??1)),qa=ia.compare??"anchors",ba=Math.max(0,Math.min(100,Number(ia.minCorrectness??0))),ca=(ia.considerDependencies??"on")==="on",Ia=Math.max(0,Math.min(100,Number(ia.dependencyThreshold??85))),za=R=>{const X=R.slice();for(let d=X.length-1;d>0;d-=1){const y=Math.floor(Math.random()*(d+1));[X[d],X[y]]=[X[y],X[d]]}return X},_a=R=>R.length?R.reduce((d,y)=>d+y,0)/R.length/255*100:0,nt=R=>_a(R)>=ba,Qt=async()=>{const R=await Ka(),X=new Map,d=new Map;R.forEach(N=>{const H=`${N.itemType}:${N.itemId}`,L=Ba(N.itemType,N.itemId,N.checkType,N.direction);X.has(H)||X.set(H,[]),X.get(H).push(N),d.has(L)||d.set(L,[]),d.get(L).push(N)});const y=new Map,S=new Map;return X.forEach((N,H)=>y.set(H,Da(N).score)),d.forEach((N,H)=>S.set(H,Da(N).score)),{itemKnowness:y,cardKnowness:S}},ft=async R=>{const X=ea,d=R.concat(X.active??[]).concat(X.pool??[]).filter((z,ue,he)=>he.findIndex(ye=>me(ye)===me(z))===ue);if(!ca){Ue(new Set(d.map(me)));return}const{itemKnowness:y,cardKnowness:S}=await Qt(),N=z=>{if(z.cardType!=="info"||z.infoType!=="quote"||z.checkType!=="quote-fragment")return!0;const ue=wa(z.direction);if(!(ue!=null&&ue.fragmentId))return!0;const he=z.description??"";if(!he.trim())return!0;const xe=bt(he).nodes[ue.fragmentId];if(!xe||!xe.leftId&&!xe.rightId)return!0;const Ie=[xe.leftId,xe.rightId].filter(Xe=>!!Xe);if(Ie.length===0)return!0;const Pe=Ie.map(Xe=>{const ua=Ba("info",z.cardId,"quote-fragment",kt(ue.mode,Xe));return S.get(ua)??0});return Pe.reduce((Xe,ua)=>Xe+ua,0)/Pe.length>=Ia},H=(C==null?void 0:C.collectionId)??null,L=H?De.filter(z=>ha(z.childItemType)==="collection"&&z.childItemId===H&&!ha(z.childCheckType)&&!ha(z.childDirection)):[],U=H&&d.length>0?d.reduce((z,ue)=>z+(S.get(me(ue))??0),0)/d.length:0,$=new Set;for(const z of d){if(z.cardType!=="info"){$.add(me(z));continue}if(!N(z))continue;const ue=De.filter(xe=>si(xe,z)).concat(L);if(ue.length===0){$.add(me(z));continue}let he=0;for(const xe of ue)if(ha(xe.parentItemType)==="collection")he+=xe.parentItemId===H?U:0;else if(ha(xe.parentCheckType)||ha(xe.parentDirection)){const Ie=ha(xe.parentCheckType),Pe=ha(xe.parentDirection),Ye=Ba(xe.parentItemType,xe.parentItemId,Ie,Pe);he+=S.get(Ye)??0}else{const Ie=`${xe.parentItemType}:${xe.parentItemId}`;he+=y.get(Ie)??0}he/ue.length>=Ia&&$.add(me(z))}Ue($)},Gt=R=>{for(let X=R;X<f.length;X+=1){const d=f[X];if(d&&(!ca||d.cardType!=="info"||na.has(me(d))))return X}return-1},lt=R=>!ca||R.cardType!=="info"||na.has(me(R)),Xt=R=>{if(Je.id!=="temporal"&&Je.id!=="levels")return null;const X=ea,d=(X.active??[]).concat(X.pool??[]),y=new Set;for(const S of d){const N=me(S);if(!(y.has(N)||R.has(N))&&(y.add(N),lt(S)))return S}return null},Ca=i.useMemo(()=>{if(Je.id!=="levels")return null;const R=ea,X=R.pool??[],d=R.active??[],y=R.levelMap??{},S=Math.max(1,Number(ia.levels??1)),N=Array.from({length:S},()=>0),H=new Set(d.map(z=>me(z)));X.forEach(z=>{const ue=Math.min(S,Math.max(1,y[me(z)]??1));N[ue-1]+=1});const L=X.length||1,U=N.map(z=>z/L*100),$=je?y[me(je)]??1:null;return{counts:N,percentages:U,currentLevel:$,levelsCount:S,activeCount:d.length,poolCount:X.length,activeSet:H}},[ea,ia,Je,je]),ot=i.useMemo(()=>{if(Je.id!=="temporal")return null;const R=ea,X=R.pool??[],d=R.active??[],y=R.knownessMap??{},S=new Set(R.unknownSet??[]);let N=0;X.forEach(U=>{(y[me(U)]??0)>1&&(N+=1)});const H=S.size,L=d.map(U=>({id:me(U),value:S.has(me(U))?0:Math.max(0,Math.min(1,y[me(U)]??0))}));return{knownCount:N,unknownCount:H,dots:L}},[ea,Je]),$a=i.useMemo(()=>{if(!ca)return 0;const R=ea;return f.concat(R.active??[]).concat(R.pool??[]).filter((d,y,S)=>S.findIndex(N=>me(N)===me(d))===y).filter(d=>d.cardType==="info"&&!na.has(me(d))).length},[ca,ea,f,na]);i.useEffect(()=>{if(!ca||G!=="ready")return;const R=ea,d=f.concat(R.active??[]).concat(R.pool??[]).filter((N,H,L)=>L.findIndex(U=>me(U)===me(N))===H).filter(N=>N.cardType!=="info"||na.has(me(N))).length,y=ae.current;if(ae.current=d,y===null||d<=y)return;const S=d-y;te(`New card available (+${S})`),de.current&&window.clearTimeout(de.current),de.current=window.setTimeout(()=>te(null),2200)},[ca,G,ea,f,na]),i.useEffect(()=>()=>{de.current&&window.clearTimeout(de.current)},[]);const xa=(R,X)=>{const d=Je.applyOutcome({queue:f,meta:ea},je,pa,ia,{correct:R,correctness:X,createdUtc:new Date().toISOString()});Q(d.queue),Pa(d.meta);const y=d.queue[O+1];y&&Ma(y,O+1)};i.useEffect(()=>{if(!l){V("error");return}V("loading"),Oi({shareId:l,key:ma}).then(R=>{m(R),q(R.collectionName),b(R.libraryName),V("ready")}).catch(()=>{V("error")})},[l,ma]),i.useEffect(()=>{l&&Vi({shareId:l,key:ma,type:"language"}).then(R=>j(R)).catch(()=>j([]))},[l,ma]),i.useEffect(()=>{!l||x!=="ready"||qi({shareId:l,key:ma}).then(R=>ta(R.items??[])).catch(()=>ta([]))},[l,ma,x]),i.useEffect(()=>{if(!l||x!=="ready")return;let R=!0;return(async()=>{P("loading"),K({current:0,total:Je.id==="levels"?0:Je.getFetchLimit(pa,ia)});try{const d=[];let y=null,S=null;do{const ue=await _i({shareId:l,key:ma,limit:300,cursor:y});if(d.push(...ue.items),(Je.id==="levels"||Je.id==="temporal")&&ue.total&&(S=ue.total),K(he=>({current:d.length,total:he.total||ue.total||Je.getFetchLimit(pa,ia)})),y=ue.nextCursor??null,S!==null&&d.length>=S||Je.id!=="levels"&&Je.id!=="temporal"&&d.length>=Je.getFetchLimit(pa,ia))break}while(y);if(!R)return;const N=pr(d);let H;if(Je.id==="levels"){const ue=Math.max(1,Number(ia.levels??1));H={},N.forEach(he=>{const ye=me(he);H[ye]=Math.max(1,Math.min(ue,1))})}let L=null,U=null,$=null;if(Je.id==="temporal"){const ue=await Ka(),he=new Set(N.map(Ie=>me(Ie))),ye=ue.reduce((Ie,Pe)=>{const Ye=Ba(Pe.itemType,Pe.itemId,Pe.checkType,Pe.direction);return he.has(Ye)&&(Ie[Ye]||(Ie[Ye]=[]),Ie[Ye].push(Pe)),Ie},{});L={},U=new Set,$={};const xe=Date.now();N.forEach(Ie=>{const Pe=me(Ie),Ye=ye[Pe]??[];if(Ye.length===0){L[Pe]=0,U.add(Pe),$[Pe]=[];return}const Xe=wr(Ye);$[Pe]=Xe;const ua=zt(Xe,xe);L[Pe]=ua.knowness})}const z=Je.id==="levels"?Tr(N,pa,ia,H):Je.id==="temporal"?kr(N,pa,ia,L??{},U??new Set,$??{}):Je.prepare(N,pa,ia);Q(z.queue),Pa(z.meta),ge(0),P("ready"),K(ue=>({current:Math.min(ue.current,ue.total),total:ue.total}))}catch{R&&P("error")}})(),()=>{R=!1}},[l,ma,pa,Je,ia,x]),i.useEffect(()=>{ft(f)},[f,De,ca,Ia,C==null?void 0:C.collectionId]),i.useEffect(()=>{if(!je||!ca){ga(!1);return}if(je.cardType!=="info"||na.has(me(je))){ga(!1);return}const R=Gt(O+1);if(R>=0){ga(!1),ge(R);return}if(Je.id==="temporal"||Je.id==="levels"){const X=f.slice(0,O+1),d=f.slice(O+1).filter(lt),y=X.concat(d),S=new Set(y.map(me)),N=Xt(S);if(N){const L=me(N);S.has(L)||(y.push(N),S.add(L),Pa(U=>{const $=U,z=new Set($.queued??[]);return z.add(L),{...$,queued:z}}))}const H=y.findIndex((L,U)=>U!==O&&lt(L));if(H>=0){Q(y),ge(H),ga(!1);return}}ga(!0)},[je,na,ca,O,f,ea,Je.id]),i.useEffect(()=>{if(ve(""),ce(null),we(null),Ge(0),ke([]),Ne({}),Se({}),Ve(null),ze(null),Re(null),t(!1),_e(!1),k(null),ee(null),Le({}),!je){ie(null),B(null);return}je.cardType==="info"&&je.infoType==="computed"&&ie(a.cogita.library.revision.loadingComputed);let R=!0;return Ma(je,O).then(X=>{!R||!X||(ie(X.prompt),B(X.expectedAnswer),ke(X.computedExpected),Ne(X.computedAnswers),Ve(X.answerTemplate),ze(X.outputVariables),Re(X.variableValues))}),()=>{R=!1}},[je,l,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){oa.current=null,_.current=new Set,oe(null);return}const R=je.description??"",X=(je.label??"").trim(),d=X.replace(/\s+/g," ").trim(),y=R.replace(/\s+/g," ").trim(),S=d&&d!==y?X:a.cogita.library.infoTypes.quote;if(!R){oe(null),B(null);return}const N=bt(R);oa.current=N,ie(S);let H=!0;return Ka().then(L=>{if(!H)return;const U=getQuoteMode(je.direction),$=new Map;L.forEach(xe=>{if(xe.itemType!=="info"||xe.checkType!=="quote-fragment"||!xe.direction)return;const Ie=wa(xe.direction);if(!Ie||Ie.mode!==U)return;const Pe=`${xe.itemId}:${Ie.fragmentId}`;$.has(Pe)||$.set(Pe,[]),$.get(Pe).push(xe)});const z={},ue=new Set;$.forEach((xe,Ie)=>{const[Pe,Ye]=Ie.split(":",2);if(Pe!==je.cardId)return;const Xe=Da(xe).score;z[Ye]=Xe,Xe>=Ia&&ue.add(Ye)}),_.current=ue,Ce.current=z;const he=wa(je.direction);if(he!=null&&he.fragmentId&&N.nodes[he.fragmentId]){Ya(N,he.fragmentId,S);return}const ye=gt(N,ue,z,Ia,ca,je.direction);Ya(N,(ye==null?void 0:ye.id)??null,S)}).catch(()=>{_.current=new Set,Ce.current={};const L=wa(je.direction);if(L!=null&&L.fragmentId&&N.nodes[L.fragmentId]){Ya(N,L.fragmentId,S);return}const U=gt(N,_.current,{},Ia,ca,je.direction);Ya(N,(U==null?void 0:U.id)??null,S)}),()=>{H=!1}},[je,a,ca,Ia]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){ee(null),Le({});return}const d=(ea.pool??ea.active??f).filter(L=>L.cardType==="vocab"&&L.checkType==="translation-match").filter((L,U,$)=>$.findIndex(z=>z.cardId===L.cardId)===U);d.some(L=>L.cardId===je.cardId)||d.unshift(je);const S=za(d).slice(0,6).map(L=>{const U=L.label.split("↔").map(ue=>ue.trim()).filter(Boolean);if(U.length<2)return null;const $=`${L.cardId}:L`,z=`${L.cardId}:R`;return{cardId:L.cardId,leftId:$,rightId:z,leftLabel:U[0],rightLabel:U[1]}}).filter(Boolean),N=S.map(L=>L.leftId),H=za(S.map(L=>L.rightId));ee({pairs:S,leftOrder:N,rightOrder:H,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,f,ea]),i.useEffect(()=>()=>{Ae.current&&window.clearTimeout(Ae.current),Oe.current&&window.clearTimeout(Oe.current)},[]);const st=i.useRef(null);i.useEffect(()=>{if(!je)return;const R=me(je),X=typeof document<"u"?document.activeElement:null;if(st.current===R&&X&&(X.tagName==="INPUT"||X.tagName==="TEXTAREA"))return;let d=0;const y=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(le.length>0){const N=Ut(Qe,le,Ee),H=N?Fe.current[N]:null;if(H&&(H.focus(),document.activeElement===H)){st.current=R;return}}if(Ze.current&&(Ze.current.focus(),document.activeElement===Ze.current)){st.current=R;return}}else if(je.cardType==="vocab"&&Ze.current&&(Ze.current.focus(),document.activeElement===Ze.current)){st.current=R;return}d<6&&(d+=1,window.setTimeout(y,40))}},S=window.setTimeout(y,40);return()=>window.clearTimeout(S)},[je,le,Qe,Ee]),i.useEffect(()=>{if(!He)return;const R=X=>{X.key==="Enter"&&(X.preventDefault(),ct())};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[He]);const ya=R=>{D(R),h(Da(R))};i.useEffect(()=>{if(!je){h(null),D([]);return}const R=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Ka().then(X=>{const d=X.filter(y=>y.itemType==="info"&&y.itemId===je.cardId&&y.checkType==="quote-fragment"&&qt(y.direction,je.direction));ya(d)}).catch(()=>{h(null),D([])});return}Ot(R,je.cardId,je.checkType,je.direction).then(X=>ya(X)).catch(()=>{h(null),D([])})},[je]);const Ha=(R,X,d,y)=>{if(R==="info"&&d==="quote-fragment"){Ka().then(S=>{const N=S.filter(H=>H.itemType==="info"&&H.itemId===X&&H.checkType==="quote-fragment"&&qt(H.direction,y));ya(N)}).catch(()=>{h(null),D([])});return}Ot(R,X,d,y).then(S=>ya(S)).catch(()=>{h(null),D([])})},Ja=(R,X,d)=>{var H;const y=((H=d.pairs.find(L=>L.leftId===R))==null?void 0:H.rightId)??null;if(!y)return d;const S=y===X;Le(L=>({...L,[R]:S?"correct":"incorrect"})),Ae.current&&window.clearTimeout(Ae.current),Oe.current&&window.clearTimeout(Oe.current),fe.current+=1;const N={kind:S?"correct":"incorrect",tick:fe.current};if(qe(null),Ae.current=window.setTimeout(()=>qe(N),0),Oe.current=window.setTimeout(()=>qe(null),420),S){const L={...d.locked,[R]:!0};return Object.keys(L).length>=d.pairs.length?(ce("correct"),_e(!0)):ce("correct"),{...d,selection:{...d.selection,[R]:X},activeLeft:null,activeRight:null,locked:L}}return ce("incorrect"),{...d,activeLeft:null,activeRight:null}},Nt=R=>{ee(X=>!X||X.locked[R]?X:X.activeRight?Ja(R,X.activeRight,X):{...X,activeLeft:X.activeLeft===R?null:R})},Lt=R=>{ee(X=>X&&(X.activeLeft?Ja(X.activeLeft,R,X):{...X,activeRight:X.activeRight===R?null:R}))},ct=()=>{var R;if(je&&je.cardType==="info"&&je.infoType==="quote"&&oa.current&&Me&&!((R=wa(je.direction))!=null&&R.fragmentId)){const X=gt(oa.current,_.current,Ce.current,Ia,ca,je.direction,Me.fragmentId);if(X){ce(null),ve(""),t(!1),Se({}),_e(!1),we(null),Ge(0),Ya(oa.current,X.id,Me.title);return}}ce(null),ve(""),t(!1),Se({}),_e(!1),we(null),Ge(0),ge(X=>Math.min(X+1,f.length))},Ea=R=>{if(!je)return;const X=R.expected??null,d=R.answer??"";let y=X??"",S=d;if(!X&&R.expectedMap&&R.answerMap){const ue=Object.keys(R.expectedMap).sort((he,ye)=>he.localeCompare(ye));y=ue.map(he=>{var ye;return((ye=R.expectedMap)==null?void 0:ye[he])??""}).join("|"),S=ue.map(he=>{var ye;return((ye=R.answerMap)==null?void 0:ye[he])??""}).join("|")}const N=y?ht(y,S,qa):new Uint8Array,H={revisionType:Je.id,evalType:R.evalType,direction:R.direction,prompt:c??"",expected:X,answer:d,expectedAnswers:R.expectedMap??null,answers:R.answerMap??null,correct:R.correct,maskBase64:N.length?Wa(N):null,checkMode:Sa,compareMode:qa,minCorrectness:ba},L=new TextEncoder().encode(JSON.stringify(H)),U=je.cardType==="info"?"info":"connection",$=R.overrideCheckType??je.checkType??null,z=R.overrideDirection??je.direction??null;Kt({itemType:U,itemId:je.cardId,checkType:$,direction:z,revisionType:Je.id,evalType:R.evalType,correct:R.correct,maskBase64:N.length?Wa(N):null,payloadBase64:Wa(L)}).then(()=>{Ha(U,je.cardId,$,z),ft(f)}).catch(()=>{})},dt=(R,X)=>{const d=Va.current.get(X);if(d)return Promise.resolve(d);const y=at.current.get(X);if(y)return y;const S=Ui({shareCode:l,infoId:R,key:ma}).then(N=>{var ue,he;const H=N.payload,L=((ue=H.definition)==null?void 0:ue.graph)??null,U="",$=((he=H.definition)==null?void 0:he.answerTemplate)??"",z=jr(L,U,$);if(z){const xe={sample:Xr(z),answerTemplate:$||null};return Va.current.set(X,xe),xe}return Mr({shareId:l,infoId:R,key:ma}).then(ye=>{const xe={sample:ye,answerTemplate:null};return Va.current.set(X,xe),xe})}).catch(()=>Mr({shareId:l,infoId:R,key:ma}).then(N=>{const H={sample:N,answerTemplate:null};return Va.current.set(X,H),H}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{at.current.delete(X)});return at.current.set(X,S),S},Ma=(R,X)=>{var L;const d=`${me(R)}:${X}`,y=tt.current.get(d);if(y)return Promise.resolve(y);const S=pt.current.get(d);if(S)return S;const N=U=>(tt.current.set(d,U),U);let H;if(R.cardType==="vocab"){if(R.checkType==="translation-match")return H=Promise.resolve(N({prompt:R.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),H;const U=R.label.split("↔").map($=>$.trim()).filter(Boolean);if(U.length>=2){const z=(R.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ue=z?U[0]:U[1],he=z?U[1]:U[0];H=Promise.resolve(N({prompt:ue,expectedAnswer:he,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else H=Promise.resolve(N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(R.cardType==="info"&&R.infoType==="word"){const U=(L=R.description)!=null&&L.startsWith("Language: ")?R.description.replace("Language: ",""):null;H=Promise.resolve(N({prompt:R.label,expectedAnswer:U,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else R.cardType==="info"&&R.infoType==="computed"?H=dt(R.cardId,d).then(U=>{var ye,xe;if(!U.sample)return N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const $=U.sample,z=$.expectedAnswers?Object.entries($.expectedAnswers).map(([Ie,Pe])=>({key:Ie,expected:Pe})):[],ue=z.reduce((Ie,Pe)=>(Ie[Pe.key]="",Ie),{}),he=$.expectedAnswerIsSentence&&((ye=$.expectedAnswer)==null?void 0:ye.trim())||null;return N({prompt:$.prompt,expectedAnswer:z.length>0?he:((xe=$.expectedAnswer)==null?void 0:xe.trim())||null,computedExpected:z,computedAnswers:ue,answerTemplate:U.answerTemplate,outputVariables:$.outputVariables??null,variableValues:$.variableValues??null})}).catch(()=>N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{pt.current.delete(d)}):H=Promise.resolve(N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return pt.current.set(d,H),H},Ya=(R,X,d)=>{const y=Object.keys(R.nodes).length,S=_.current.size;if(!X){oe({title:d,before:R.text,after:"",fragmentId:null,total:y,completed:S}),B(null),_e(!0);return}const N=R.nodes[X];if(!N)return;const H=Zr(R.text,N);oe({title:d,before:H.before,after:H.after,fragmentId:N.id,total:y,completed:S}),B(H.fragment),_e(!1)},xt=()=>{const R=oa.current;R&&oe(X=>X&&{...X,total:Object.keys(R.nodes).length,completed:_.current.size})},Fa=()=>{const R=f[O+1];R&&Ma(R,O+1)},Ct=()=>{if(Fa(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&W){if(W.pairs.length===0){ce("incorrect"),_e(!0);return}const N=W.pairs.reduce((he,ye)=>(he[ye.rightId]=ye.rightLabel,he),{});let H=0;const L={};W.pairs.forEach(he=>{const xe=W.selection[he.leftId]===he.rightId;L[he.leftId]=xe?"correct":"incorrect",xe&&(H+=1)});const U=W.pairs.length||1,$=H/U,z=H===W.pairs.length;Le(he=>({...he,...L})),z?(ce("correct"),_e(!0),Ge(0)):(ce("incorrect"),_e(!1),Ge(he=>{const ye=he+1;return ye>=ja&&(t(!0),_e(!0),ee(xe=>{if(!xe)return xe;const Ie=xe.pairs.reduce((Pe,Ye)=>(Pe[Ye.leftId]=Ye.rightId,Pe),{});return{...xe,selection:Ie}})),ye})),xa(z,$);const ue="connection";Promise.all(W.pairs.map(he=>{const ye=W.selection[he.leftId]??null,xe=ye?N[ye]:"",Ie={left:he.leftLabel,expected:he.rightLabel,answer:xe,checkType:"translation-match"},Pe=new TextEncoder().encode(JSON.stringify(Ie));return Kt({itemType:ue,itemId:he.cardId,checkType:"translation-match",direction:null,revisionType:Je.id,evalType:"translation-match",correct:ye===he.rightId,maskBase64:null,payloadBase64:Wa(Pe)})})).then(()=>{Ha(ue,je.cardId,je.checkType,je.direction),ft(f)}).catch(()=>{});return}if(le.length>0){const N=le.reduce((L,U)=>{const $=Te[U.key]??"";return L[U.key]=va($)===va(U.expected)?"correct":"incorrect",L},{});le.every(({key:L,expected:U})=>{const $=Te[L]??"";return Sa==="exact"&&va($)===va(U)})?(ce("correct"),Se(N),_e(!0),Ge(0),xa(!0,1),Ea({correct:!0,direction:c?`${c} -> computed`:"computed",expectedMap:le.reduce((L,U)=>(L[U.key]=U.expected,L),{}),answerMap:Te,evalType:"computed"})):(ce("incorrect"),Se(N),_e(!1),Ge(L=>{const U=L+1;return U>=ja&&Qa&&(t(!0),_e(!0)),U}),xa(!1,0),window.setTimeout(()=>{var U;const L=Ut(Qe,le,Ee);L&&Fe.current[L]&&((U=Fe.current[L])==null||U.focus())},40),Ea({correct:!1,direction:c?`${c} -> computed`:"computed",expectedMap:le.reduce((L,U)=>(L[U.key]=U.expected,L),{}),answerMap:Te,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Me!=null&&Me.fragmentId)){if(!re)return;const N=wa(je.direction),H=(N==null?void 0:N.mode)??getQuoteMode(je.direction),L=N!=null&&N.fragmentId&&je.direction?je.direction:kt(H,Me.fragmentId),U=oi(re,pe,qa),$=Sa==="exact"&&mt(pe)===mt(re),z=nt(U),ue=$||z,he=_a(U);ue?(Ce.current[Me.fragmentId]=Math.max(Ce.current[Me.fragmentId]??0,he),(Ce.current[Me.fragmentId]??0)>=Ia&&_.current.add(Me.fragmentId),xt(),ce("correct"),Se({}),_e(!0),we(U),Ge(0),he<100&&ja<=1&&t(!0),xa(!0,he/100),Ea({correct:!0,direction:`quote:${Me.fragmentId}`,expected:re,answer:pe,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L})):(ce("incorrect"),Se({}),_e(!1),we(U),Ge(ye=>{const xe=ye+1;return xe>=ja&&Qa&&(t(!0),_e(!0)),xe}),xa(!1,he/100),window.setTimeout(()=>{var ye;return(ye=Ze.current)==null?void 0:ye.focus()},40),Ea({correct:!1,direction:`quote:${Me.fragmentId}`,expected:re,answer:pe,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L}));return}if(!re)return;const R=ht(re,pe,qa),X=Sa==="exact"&&va(pe)===va(re),d=nt(R),y=X||d,S=_a(R);y?(ce("correct"),Se({}),_e(!0),we(R),Ge(0),S<100&&ja<=1&&t(!0),xa(!0,S/100),Ea({correct:!0,direction:c?`${c} -> ${re}`:null,expected:re,answer:pe,evalType:"text"})):(ce("incorrect"),Se({}),_e(!1),we(R),Ge(N=>{const H=N+1;return H>=ja&&Qa&&(t(!0),_e(!0)),H}),xa(!1,S/100),window.setTimeout(()=>{var N;return(N=Ze.current)==null?void 0:N.focus()},40),Ea({correct:!1,direction:c?`${c} -> ${re}`:null,expected:re,answer:pe,evalType:"text"}))},ut=R=>{if(Fa(),!re)return;const X=ht(re,R,qa),d=va(R)===va(re),y=nt(X),S=d||y,N=_a(X);S?(ce("correct"),Se({}),_e(!0),we(X),Ge(0),N<100&&ja<=1&&t(!0),xa(!0,N/100),Ea({correct:!0,direction:"word->language",expected:re,answer:R,evalType:"language-select"})):(ce("incorrect"),Se({}),_e(!1),we(X),Ge(H=>{const L=H+1;return L>=ja&&Qa&&(t(!0),_e(!0)),L}),xa(!1,N/100),Ea({correct:!1,direction:"word->language",expected:re,answer:R,evalType:"language-select"}))},Mt=R=>{var d;if(R.key!=="Enter")return;if(R.preventDefault(),R.stopPropagation(),He){ct();return}const X=le.find(y=>!(Te[y.key]??"").trim());if(X){(d=Fe.current[X.key])==null||d.focus();return}Ct()},Zt=()=>{Fa(),ce("correct"),_e(!0),Ge(0),xa(!0,1),re&&Ea({correct:!0,direction:"manual",expected:re,answer:pe,evalType:"manual"})},er=()=>{if(xa(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){ce(null),ve(""),t(!1),Se({}),_e(!1),we(null),Ge(0),ge(R=>Math.min(R+1,f.length));return}ct()};i.useEffect(()=>{Fa()},[O,f]);const ar=a.cogita.library.revision.revealModeAfterIncorrect,Qa=le.length>0||!!re;return e.jsxs(ka,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:[(x==="loading"||G==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ne.total?Math.min(100,Math.max(0,ne.current/ne.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ne.total?`${Math.min(ne.current,ne.total)} / ${ne.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:J}),e.jsx("p",{className:"cogita-library-subtitle",children:s}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",La).replace("{check}",Aa)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ca?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Ca.currentLevel??"-"," / ",Ca.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Z?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Z})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":$e?`${$e.kind}-${$e.tick}`:et?"idle":F??"idle",children:x!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):je?e.jsx(e.Fragment,{children:la?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:je,currentTypeLabel:Yt,prompt:c,languages:A,answer:pe,onAnswerChange:R=>ve(X=>_t(X,R,v)),computedExpected:le,computedAnswers:Te,onComputedAnswerChange:(R,X)=>Ne(d=>({...d,[R]:_t(d[R]??"",X,v)})),answerTemplate:Qe,outputVariables:Ee,variableValues:sa,computedFieldFeedback:Be,feedback:F,canAdvance:He,quoteContext:Me,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ct,onSkip:er,onLanguageSelect:ut,onMarkReviewed:Zt,onAdvance:ct,showCorrectAnswer:Y,setShowCorrectAnswer:t,onRevealCorrect:()=>_e(!0),answerMask:se,expectedAnswer:re,hasExpectedAnswer:Qa,handleComputedKeyDown:Mt,answerInputRef:Ze,computedInputRefs:Fe,scriptMode:v,setScriptMode:k,matchPairs:W==null?void 0:W.pairs,matchLeftOrder:W==null?void 0:W.leftOrder,matchRightOrder:W==null?void 0:W.rightOrder,matchSelection:W==null?void 0:W.selection,matchActiveLeft:W==null?void 0:W.activeLeft,matchActiveRight:W==null?void 0:W.activeRight,matchFeedback:Ke,onMatchLeftSelect:Nt,onMatchRightSelect:Lt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:it?`${Ra} / ${it}`:a.cogita.library.revision.progressUnlimited}),x==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),x==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),x==="ready"&&G==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),x==="ready"&&G==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),x==="ready"&&G==="ready"&&f.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:ar}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",ja]})]})]}),Ca?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Ca.activeCount," / ",Ca.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ca.counts.map((R,X)=>{const d=X+1,y=Ca.currentLevel===d,S=Ca.percentages[X]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":y,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:d}),e.jsx("strong",{children:R})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,S))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[S.toFixed(1),"%"]})]},`level-${d}`)})})]}):null,ot?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ot.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ot.dots.map(R=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-R.value))}, ${Math.round(200*R.value)}, 80, 0.9)`}},R.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ot.knownCount})]})]}):null,ca?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:$a})]})}):null]})]})]})})})]})]})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Un},Symbol.toStringTag,{value:"Module"}));export{Jn as C,Yn as a,Qn as b};
