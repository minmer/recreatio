import{r,j as e,u as Vr,R as fr,B as xr,C as yr,H as Cr,P as Mr,a as $t,b as ui,c as gi,d as Or,e as _r,f as vr}from"./vendor-SpL5bUHi.js";import{L as qr,A as Ur,g as Wr,a as hi,b as wt,c as zr,s as Et,d as Hr,e as jr,f as rt,h as hr,i as At,j as br,k as bi,l as tr,m as it,u as mi,n as ga,o as pi,p as fi,q as xi,r as Jr,t as Yr,v as yi,w as vi,x as ji,y as zt,z as Ft,B as wi,C as ki,D as Ti,E as Ni,F as Li,G as Ci,H as Ya,I as Mi,J as Si,K as Ii,M as Pi,N as Ri,O as $i,P as Ei,Q as Ai,R as Fi,S as Bi,T as Di,U as Ki,V as Vi,W as Oi,X as _i,Y as qi,Z as Sr}from"./recreatio-core-78cRTeMQ.js";import"./vendor-cogita-ui-BgsFclds.js";const jt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},vt={moveMs:900,pauseMs:220,errorMs:900},Ui=(a=11)=>{let n=a;const l=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:u,height:g,paddingX:w,paddingY:x,levels:N}=jt,A=(g-x*2)/(N.length-1),L=[],o=[],C=[];N.forEach((m,f)=>{const he=g-x-f*A,V=u-w*2,v=[];for(let D=0;D<m;D+=1){const F=w+(D+1)*V/(m+1),ne=(l()-.5)*18,P=Math.max(w,Math.min(u-w,F+ne)),U=f===0?3:f<2?2.1:1.4,ue=f===0?"root":`l${f}-${D}`;v.push({id:ue,x:f===0?u/2:P,y:he,r:U,level:f,role:f===0?"root":void 0})}C.push(v),L.push(...v)});const b=C[C.length-1];if(b!=null&&b.length){const m=b[Math.floor(b.length/2)];m.role="goal",m.r=2}for(let m=1;m<C.length;m+=1){const f=C[m-1];C[m].forEach(V=>{const v=[...f].sort((P,U)=>Math.abs(P.x-V.x)-Math.abs(U.x-V.x)),D=v[0],F=v[1]&&l()<.45?v[1]:null;(F?[D,F]:[D]).forEach(P=>{o.push({from:P.id,to:V.id,key:`${P.id}-${V.id}`})}),l()<.2&&v[2]&&o.push({from:v[2].id,to:V.id,key:`${v[2].id}-${V.id}`})})}const p=new Map;o.forEach(m=>{const f=p.get(m.to)??[];f.push(m.from),p.set(m.to,f)});const W=new Map,_=new Map,z=new Map;o.forEach(m=>{const f=W.get(m.from)??[];f.push(m.key),W.set(m.from,f);const he=_.get(m.from)??[];he.push(m.to),_.set(m.from,he);const V=z.get(m.from)??[];V.push(m.to),z.set(m.from,V);const v=z.get(m.to)??[];v.push(m.from),z.set(m.to,v)});const s=new Map;return L.forEach(m=>{s.set(m.id,m)}),{nodes:L,links:o,parentsById:p,linksByFrom:W,childrenByFrom:_,neighborsById:z,nodesById:s}};function Wi({slides:a,activeIndex:n,introOpen:l,prefersReducedMotion:u,onNext:g,onPrev:w,onSelect:x,onExit:N,onOpen:A,onRegister:L}){const o=n===a.length-1,C=l&&n===0?"entry":"docked",b=a[a.length-1],[p,W]=r.useState(!1),_=r.useMemo(()=>Array.from({length:20},(j,k)=>({src:`/cogita/logo/Cogita${String(k).padStart(2,"0")}.png`,kind:k<=11?"bubble":k<=17?"text":"recreatio"})),[]),z=l&&n===0;r.useEffect(()=>{if(!l){W(!1);return}n>0&&!p&&W(!0)},[n,l,p]);const s=r.useRef(0),m=r.useRef(null),f=r.useMemo(()=>{const j={x:40,y:160},k={x:260,y:48},Q=6,t=k.x-j.x,i=j.y-k.y,h=t/Q,T=[.3,.45,.6,.65,1.4,2.2],O=T.reduce((oe,je)=>oe+je,0),ae=T.map(oe=>i*oe/O),te=[j];let G=j.x,de=j.y;for(let oe=1;oe<=Q;oe+=1){const je=(Math.random()-.5)*14,ea=(Math.random()-.5)*28;G=Math.max(j.x+oe*14,Math.min(k.x-(Q-oe)*14,G+h+je));const qe=ae[oe-1]??ae[ae.length-1];de=de-qe+ea;const ia=Math.max(k.y,Math.min(j.y-4,de));te.push({x:Math.round(G),y:Math.round(ia)})}return te[te.length-1]=k,te},[]),he=r.useMemo(()=>{const i=(O,ae,te)=>Math.min(te,Math.max(ae,O)),h=f.map(O=>{const ae=10+Math.random()*36;return{x:i(O.x,40,260),y:i(O.y-ae,40,140)}}),T=f.map((O,ae)=>{var de;const te=12+Math.random()*40,G=((de=h[ae])==null?void 0:de.y)??O.y;return{x:i(O.x,40,260),y:i(Math.max(G+10,O.y+te),60,170)}});return{upper:h,lower:T}},[f]),V=r.useMemo(()=>{var k;const j=((k=f[4])==null?void 0:k.x)??260;return Math.max(0,Math.min(240,j-40))},[f]),v=r.useMemo(()=>{var ae,te;const j=(G,de,oe)=>Math.min(oe,Math.max(de,G)),k=(G,de,oe)=>f.map((je,ea)=>{var Sa,la;const qe=((Sa=he.upper[ea])==null?void 0:Sa.y)??je.y,ia=((la=he.lower[ea])==null?void 0:la.y)??je.y,Ve=(Math.random()-.5)*70,We=je.y+G+Ve,Fe=j(je.y+de,qe+6,ia-6),Ge=j(je.y+oe,qe+6,ia-6);return{x:je.x,y:j(We,Math.min(Fe,Ge),Math.max(Fe,Ge))}}),Q=-14+Math.random()*28,t=14+Math.random()*28,i=k(Q,-80,12),h=k(t,-12,80);for(let G=4;G<f.length;G+=1){const de=f[G],oe=((ae=he.upper[G])==null?void 0:ae.y)??de.y,je=((te=he.lower[G])==null?void 0:te.y)??de.y;i[G]={x:de.x,y:j(de.y-12,oe+6,je-6)},h[G]={x:de.x,y:j(de.y+12,oe+6,je-6)}}const T=he.upper.length?he.upper[he.upper.length-1].y:40,O=he.lower.length?he.lower[he.lower.length-1].y:170;return i[i.length-1]={x:f[f.length-1].x,y:j(f[f.length-1].y-14,T,O)},h[h.length-1]={x:f[f.length-1].x,y:j(f[f.length-1].y+12,T,O)},{higher:i,lower:h}},[f,he]),D=1e4,F=r.useMemo(()=>{let j=17;const k=()=>(j=(j*1664525+1013904223)%4294967296,j/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,i)=>{const h=(k()-.5)*240,T=(k()-.5)*180,O=(k()-.5)*24;return{id:`card-${i+1}`,throw:{x:`${h.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${O.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${i*.12}s`}})},[]),ne=r.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[P,U]=r.useState([]),ue=r.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),me=r.useMemo(()=>{const k=[],t=(h,T)=>h+Math.random()*(T-h);for(let h=0;h<6;h+=1){let T=!1;for(let O=0;O<80;O+=1){const ae=t(14,86),te=t(10,34);if(k.every(de=>{const oe=de.x-ae,je=de.y-te;return Math.hypot(oe,je)>=12})){k.push({x:ae,y:te}),T=!0;break}}T||k.push({x:t(16,84),y:t(12,32)})}return k.map((h,T)=>({id:`p${T+1}`,x:`${h.x.toFixed(1)}%`,y:`${h.y.toFixed(1)}%`,xNum:h.x,yNum:h.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ge,K]=r.useState(0),[le,d]=r.useState(0),[re,ee]=r.useState([]),q=1e4,Ne=r.useMemo(()=>{if(me.length<2)return[];const j=T=>{let O=T+1831565813;return O=Math.imul(O^O>>>15,O|1),O^=O+Math.imul(O^O>>>7,O|61),((O^O>>>14)>>>0)/4294967296},k=(T,O)=>Math.floor(j(T)*O),Q=new Set,t=[],i=Math.min(3,me.length);let h=0;for(;t.length<i&&h<30;){h+=1;const T=k(ge*13+h*5,me.length),O=k(ge*29+h*7,me.length);if(T===O)continue;const ae=T<O?`${T}-${O}`:`${O}-${T}`;Q.has(ae)||(Q.add(ae),t.push({id:`link-${ae}`,from:me[T],to:me[O],delay:`${(h*.35).toFixed(2)}s`}))}return t},[ge,me]);r.useEffect(()=>{if(!l||n!==2)return;const j=()=>{const Q=F.map(t=>t.id);for(let t=Q.length-1;t>0;t-=1){const i=Math.floor(Math.random()*(t+1));[Q[t],Q[i]]=[Q[i],Q[t]]}return Q.slice(0,4)};U(j());const k=window.setInterval(()=>{U(j())},D);return()=>window.clearInterval(k)},[n,l,F,D]),r.useEffect(()=>{if(!l||n!==3)return;const j=()=>{d(Math.floor(Math.random()*ue.length)),ee(me.map(()=>Math.random()<.6?"good":"bad")),K(Q=>Q+1)};j();const k=window.setInterval(j,q);return()=>window.clearInterval(k)},[n,l,ue.length,me,q]);const se=r.useMemo(()=>Ui(11),[]),[ie,Le]=r.useState(new Set(["root"])),[Ie,Ce]=r.useState(new Set),[Pe,ke]=r.useState(new Set),[Ye,Oe]=r.useState({fromId:"root",toId:"root",key:0}),Ee=r.useRef(ie),He=r.useRef("root"),sa=r.useRef(0),ra=r.useRef(null),R=r.useRef(null),X=r.useRef([]);r.useEffect(()=>{Ee.current=ie},[ie]);const Ae=r.useMemo(()=>{const j=new Set;return ie.forEach(k=>{const Q=se.linksByFrom.get(k);Q&&Q.forEach(t=>j.add(t))}),j},[ie,se]),Te=se.nodesById.get(Ye.toId)??se.nodesById.get("root"),pe=Te?`${Te.x/jt.width*100}%`:"50%",$e=Te?`${Te.y/jt.height*100}%`:"90%";r.useEffect(()=>{if(!l||n!==1||u)return;(()=>{Le(new Set(["root"])),Ce(new Set),ke(new Set),Oe({fromId:"root",toId:"root",key:0}),R.current=null,sa.current=0,He.current="root",X.current=[]})();const k=()=>{const t=He.current,i=Ee.current,T=(se.childrenByFrom.get(t)??[]).filter(je=>!i.has(je));if(T.length)return T[Math.floor(Math.random()*T.length)];if(i.size>=se.nodes.length){const je=se.neighborsById.get(t)??[];return je.length?je[Math.floor(Math.random()*je.length)]:null}const O=je=>(se.childrenByFrom.get(je)??[]).some(qe=>!i.has(qe)),ae=[t],te=new Set([t]),G=new Map;let de=null;for(;ae.length;){const je=ae.shift();if(!je)break;if(je!==t&&O(je)){de=je;break}(se.neighborsById.get(je)??[]).forEach(qe=>{te.has(qe)||(te.add(qe),G.set(qe,je),ae.push(qe))})}if(!de)return null;let oe=de;for(;G.get(oe)&&G.get(oe)!==t;)oe=G.get(oe)??oe;return oe},Q=(t,i)=>{if(t===i){const h=k();h&&Q(t,h);return}sa.current+=1,Oe({fromId:t,toId:i,key:sa.current}),He.current=i,ra.current=window.setTimeout(()=>{const h=se.parentsById.get(i)??[],T=Ee.current,O=h.filter(de=>!T.has(de));if(!O.length){const de=new Set(T);de.add(i),Le(de),ra.current=window.setTimeout(()=>{for(;X.current.length;){const je=X.current[X.current.length-1];if(!de.has(je)){if(je!==i){Q(i,je);return}break}X.current.pop()}const oe=k();oe&&Q(i,oe)},vt.pauseMs);return}const ae=new Set([i,...O]),te=new Set(O.map(de=>`${de}-${i}`));Ce(ae),ke(te),X.current.includes(i)||X.current.push(i);const G=O[Math.floor(Math.random()*O.length)];R.current={fromId:i,toId:G},ra.current=window.setTimeout(()=>{Ce(new Set),ke(new Set);const de=R.current;de&&Q(de.fromId,de.toId)},vt.errorMs)},vt.moveMs)};return ra.current=window.setTimeout(()=>{const t=k();t&&Q(He.current,t)},vt.pauseMs),()=>{ra.current&&window.clearTimeout(ra.current)}},[n,l,se,u]);const Ue=j=>{if(!l)return;const k=Date.now();k-s.current<520||Math.abs(j.deltaY)<10||(s.current=k,j.deltaY>0?g():w(),j.preventDefault())},Be=j=>{if(!l)return;const k=j.touches[0];k&&(m.current={x:k.clientX,y:k.clientY})},_e=j=>{if(!l)return;const k=m.current;if(m.current=null,!k)return;const Q=j.changedTouches[0];if(!Q)return;const t=Q.clientX-k.x,i=Q.clientY-k.y;Math.abs(i)<40||Math.abs(i)<Math.abs(t)||(i<0?g():w())};return e.jsxs("div",{className:`cogita-intro ${l?"is-open":"is-closed"} ${u?"is-reduced":""} ${o?"is-final":""}`,"data-slide":n+1,onWheel:Ue,onTouchStart:Be,onTouchEnd:_e,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":C,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${z&&!p?"is-entry":""}`,children:_.map((j,k)=>e.jsx("img",{src:j.src,alt:"",className:`cogita-logo-layer ${k===0?"is-base":""} ${j.kind==="text"?"is-text":j.kind==="recreatio"?"is-recreatio":""} ${j.kind==="bubble"?"is-bubble":""}`},j.src))})}),l&&a.map((j,k)=>{const Q=k===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${k+1} ${Q?"is-active":""}`,"aria-hidden":!Q,children:[e.jsxs("div",{className:"cogita-intro-text",children:[j.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:j.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:j.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:j.title}),j.body&&e.jsx("p",{children:j.body.split(`
`).map((t,i)=>e.jsxs("span",{children:[t,i===0&&e.jsx("br",{})]},String(i)))})]}),j.micro&&e.jsx("p",{className:"cogita-intro-micro",children:j.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:o?L:g,children:j.cta}),o&&j.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>x(0),children:j.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[k===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${jt.width} ${jt.height}`,preserveAspectRatio:"none",children:[se.links.map(t=>{const i=se.nodesById.get(t.from),h=se.nodesById.get(t.to);if(!i||!h)return null;const T=Ae.has(t.key),O=Pe.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${O?"is-error":""}`,x1:i.x,y1:i.y,x2:h.x,y2:h.y},t.key)}),se.nodes.map(t=>{const i=ie.has(t.id),h=Ie.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${i?"is-active":""} ${h?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Te&&e.jsx("span",{className:"map-explorer-dot",style:{left:pe,top:$e,"--move":`${vt.moveMs}ms`}})]}),k===2&&e.jsx("div",{className:"cogita-index-cards",children:F.map(t=>{const i=P.indexOf(t.id),h=i>=0?ne[i]:null,T=(h==null?void 0:h.x)??"140px",O=(h==null?void 0:h.y)??"140px",ae=i>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":O,"--stack-opacity":ae,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),k===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ue.map((t,i)=>e.jsxs("div",{className:`round-card ${i===le?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),ue[le]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ue[le].x,"--card-y":`calc(${ue[le].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:me.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Ne.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:me.map((t,i)=>{const h=re[i]??"good",T=ue[le];if(!T)return null;const O=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":O,"--delay":`${i*.12}s`}}),e.jsx("span",{className:`return-dot is-${h}`,style:{"--from-x":T.x,"--from-y":O,"--to-x":t.x,"--to-y":t.y,"--delay":`${i*.12}s`}}),e.jsx("span",{className:`result-pop is-${h}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${i*.12}s`}})]},`${t.id}-${ge}`)})})]},`round-${ge}`),k===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${f[0].x} ${f[0].y} L${f[1].x} ${f[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${f[1].x} ${f[1].y} L${f[2].x} ${f[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${f[2].x} ${f[2].y} L${f[3].x} ${f[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${f[3].x} ${f[3].y} L${f[4].x} ${f[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${f[4].x} ${f[4].y} L${f[5].x} ${f[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${f[5].x} ${f[5].y} L${f[6].x} ${f[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${V};${V};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${he.upper.map((t,i)=>`${i===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${he.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${he.upper.map((t,i)=>`${i===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${he.lower.map((t,i)=>`${i===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[v.higher.slice(0,6).map((t,i)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${i+1}`,d:`M${t.x} ${t.y} L${v.higher[i+1].x} ${v.higher[i+1].y}`,pathLength:"100"},`peer-1-${i}`)),v.lower.slice(0,6).map((t,i)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${i+1}`,d:`M${t.x} ${t.y} L${v.lower[i+1].x} ${v.lower[i+1].y}`,pathLength:"100"},`peer-2-${i}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${f[0].x/300*100}%`,"--p0y":`${f[0].y/200*100}%`,"--p1x":`${f[1].x/300*100}%`,"--p1y":`${f[1].y/200*100}%`,"--p2x":`${f[2].x/300*100}%`,"--p2y":`${f[2].y/200*100}%`,"--p3x":`${f[3].x/300*100}%`,"--p3y":`${f[3].y/200*100}%`,"--p4x":`${f[4].x/300*100}%`,"--p4y":`${f[4].y/200*100}%`,"--p5x":`${f[5].x/300*100}%`,"--p5y":`${f[5].y/200*100}%`,"--p6x":`${f[6].x/300*100}%`,"--p6y":`${f[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${v.higher[0].x/300*100}%`,"--q0y":`${v.higher[0].y/200*100}%`,"--q1x":`${v.higher[1].x/300*100}%`,"--q1y":`${v.higher[1].y/200*100}%`,"--q2x":`${v.higher[2].x/300*100}%`,"--q2y":`${v.higher[2].y/200*100}%`,"--q3x":`${v.higher[3].x/300*100}%`,"--q3y":`${v.higher[3].y/200*100}%`,"--q4x":`${v.higher[4].x/300*100}%`,"--q4y":`${v.higher[4].y/200*100}%`,"--q5x":`${v.higher[5].x/300*100}%`,"--q5y":`${v.higher[5].y/200*100}%`,"--q6x":`${v.higher[6].x/300*100}%`,"--q6y":`${v.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${v.lower[0].x/300*100}%`,"--q0y":`${v.lower[0].y/200*100}%`,"--q1x":`${v.lower[1].x/300*100}%`,"--q1y":`${v.lower[1].y/200*100}%`,"--q2x":`${v.lower[2].x/300*100}%`,"--q2y":`${v.lower[2].y/200*100}%`,"--q3x":`${v.lower[3].x/300*100}%`,"--q3y":`${v.lower[3].y/200*100}%`,"--q4x":`${v.lower[4].x/300*100}%`,"--q4y":`${v.lower[4].y/200*100}%`,"--q5x":`${v.lower[5].x/300*100}%`,"--q5y":`${v.lower[5].y/200*100}%`,"--q6x":`${v.lower[6].x/300*100}%`,"--q6y":`${v.lower[6].y/200*100}%`}})]})})}),k===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),k===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},j.id)}),!l&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:b.title}),b.body&&e.jsx("p",{children:b.body}),b.micro&&e.jsx("p",{className:"cogita-intro-micro",children:b.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:L,children:b.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:A,children:"Otwórz pokaz"})]})]})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((j,k)=>e.jsx("button",{type:"button",className:`dot ${n===k?"active":""}`,"aria-label":j.title,onClick:()=>x(k)},j.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:N,children:"Pomiń"})]})]})}const zi=6,Hi=4;function Ji({copy:a,onAuthAction:n,authLabel:l,showProfileMenu:u,onProfileNavigate:g,onToggleSecureMode:w,onLogout:x,secureMode:N,onNavigate:A,language:L,onLanguageChange:o}){const C=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}A("home")},b=r.useRef(null),p=r.useRef([]),W=r.useMemo(()=>{let ee=Date.now()%2147483647;const q=()=>(ee=ee*48271%2147483647,ee/2147483647);return Array.from({length:zi},(Ne,se)=>{const ie=6+q()*8,Le=7+q()*10,Ie=6+q()*9,Ce=-q()*ie,Pe=-q()*Le,ke=-q()*Ie,Ye=.18+q()*.28,Oe=12+q()*18,Ee=4+q()*8,He=(q()-.5)*3.2,sa=(q()-.5)*3.8,ra=q()>.5?"alternate":"alternate-reverse",R=q()>.5?"alternate":"alternate-reverse",X=q()>.5?"alternate":"alternate-reverse",Ae=.18+q()*.42,Te=30+q()*60,pe=-45-q()*38,$e=188+q()*32,Ue=.1+q()*.2;return{id:`wave-${se+1}`,style:{"--wave-sway-duration":`${ie}s`,"--wave-scale-duration":`${Le}s`,"--wave-drift-duration":`${Ie}s`,"--wave-sway-delay":`${Ce}s`,"--wave-scale-delay":`${Pe}s`,"--wave-drift-delay":`${ke}s`,"--wave-sway-dir":ra,"--wave-scale-dir":R,"--wave-drift-dir":X,"--wave-scale":`${Ye}`,"--wave-shift":`${Oe}%`,"--wave-xshift":`${Ee}%`,"--wave-x0":`${He}%`,"--wave-y0":`${sa}%`,"--wave-opacity":`${Ae}`,"--wave-blur":`${Te}px`,"--wave-bottom":`${pe}%`,"--wave-hue":`${$e}`,"--wave-glow":`${Ue}`}}})},[]),_=r.useMemo(()=>{let ee=Date.now()*3%2147483647;const q=()=>(ee=ee*48271%2147483647,ee/2147483647);return Array.from({length:Hi},(Ne,se)=>{const ie=180+q()*220,Le=220+q()*280,Ie=-q()*ie,Ce=-q()*Le,Pe=.12+q()*.22,ke=3+q()*7,Ye=1+q()*3,Oe=(q()-.5)*2.8,Ee=(q()-.5)*2.2;return{id:`mesh-${se+1}`,seed:1e3+se*991+Math.floor(q()*999),style:{"--mesh-sway-duration":`${ie}s`,"--mesh-drift-duration":`${Le}s`,"--mesh-sway-delay":`${Ie}s`,"--mesh-drift-delay":`${Ce}s`,"--mesh-scale":`${Pe}`,"--mesh-shift":`${ke}%`,"--mesh-xshift":`${Ye}%`,"--mesh-x0":`${Ee}%`,"--mesh-y0":`${Oe}%`}}})},[]),z=r.useMemo(()=>{const ee=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],q=a.cogita.introSlides,Ne=new Map(q.map(se=>[se.id,se]));return ee.map(se=>{var Le;const ie=Ne.get(se.id);return{...se,...ie,title:(ie==null?void 0:ie.title)??"Cogita",cta:(ie==null?void 0:ie.cta)??((Le=a.cogita.introSlides[0])==null?void 0:Le.cta)??a.cogita.loginCta,secondary:ie==null?void 0:ie.secondary}})},[a.cogita.introSlides]),[s,m]=r.useState(0),[f,he]=r.useState(!0),[V,v]=r.useState(!1),D=z.length-1,F=r.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ne=r.useCallback(()=>{F(),n()},[F,n]),P=r.useCallback(()=>{he(!0),m(0)},[]),U=r.useCallback(()=>{he(!1),m(D)},[D]),ue=r.useCallback(ee=>{m(Math.max(0,Math.min(D,ee)))},[D]),me=r.useCallback(()=>{s>=D?ne():ue(s+1)},[s,ue,ne,D]),ge=r.useCallback(()=>{ue(s-1)},[s,ue]);r.useEffect(()=>{var Ne;const ee=(Ne=window.matchMedia)==null?void 0:Ne.call(window,"(prefers-reduced-motion: reduce)");if(!ee)return;const q=()=>v(ee.matches);return q(),ee.addEventListener?(ee.addEventListener("change",q),()=>ee.removeEventListener("change",q)):(ee.addListener(q),()=>ee.removeListener(q))},[]),r.useEffect(()=>{if(!f)return;const ee=q=>{const Ne=q.target;if(!Ne)return;const se=Ne.tagName;if(!(Ne.isContentEditable||se==="INPUT"||se==="TEXTAREA"||se==="SELECT"||se==="BUTTON"||se==="A"||Ne.closest('button, a, [role="button"], [role="link"]'))){if(q.key==="Escape"){U();return}if(q.key==="ArrowLeft"||q.key==="ArrowUp"){ge();return}(q.key==="ArrowRight"||q.key==="ArrowDown"||q.code==="Space"||q.key===" ")&&(q.preventDefault(),me())}};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[U,me,ge,f]),r.useEffect(()=>{f&&s===D&&F()},[s,f,D,F]),r.useEffect(()=>{const ee=b.current;if(!ee)return;const q=p.current.filter(pe=>!!pe);if(!q.length)return;const Ne=1,se=.6,ie=.6,Le=Math.max(1,Math.min(Ne,window.devicePixelRatio||1));let Ie=0,Ce=0,Pe=se,ke=0,Ye=0;const Oe=pe=>{let $e=pe%2147483647;return $e<=0&&($e+=2147483646),(Ue,Be)=>{$e=$e*48271%2147483647;const _e=$e/2147483647;return Ue+_e*(Be-Ue)}},Ee={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},He=pe=>{const $e=Math.sin(pe*12.9898)*43758.5453;return $e-Math.floor($e)},sa=pe=>{const $e=He(pe+.1)||1e-4,Ue=He(pe+.7)||1e-4;return Math.sqrt(-2*Math.log($e))*Math.cos(2*Math.PI*Ue)},ra=(pe,$e)=>{const Ue=Math.floor(pe),Be=Ue+1,_e=pe-Ue,j=_e*_e*(3-2*_e),k=He(Ue*12.9898+$e*78.233),Q=He(Be*12.9898+$e*78.233);return k+(Q-k)*j},R=pe=>{const $e=Oe(pe),Ue=Math.min(4,Math.max(4,Math.floor(Ie/1200*Ee.filamentCount)));return Array.from({length:Ue},(Be,_e)=>{const j=Math.max(-1,Math.min(1,sa(pe+_e*.37))),k=Math.min(1,Math.max(0,He(pe+_e*1.31))),Q=Math.min(Ee.depthLayers-1,Math.floor(k*Ee.depthLayers));return{seed:$e(0,Math.PI*2)+pe*.01,offset:j,freqA:Ee.freq1*(.75+$e(0,.5)),freqB:Ee.freq2*(.75+$e(0,.5)),ampA:Ee.amp1*(.6+$e(0,.7)),ampB:Ee.amp2*(.6+$e(0,.7)),width:2+_e%5*.32,depth:k,layer:Q}})},X=(pe,$e,Ue)=>{const Be=Math.max(30,Math.floor(Ie*Ce/14e4));pe.save(),pe.globalAlpha=.6;for(let _e=0;_e<Be;_e+=1){const j=He(_e*9.1+Ie*.11)*$e+Ue,k=He(_e*3.7+Ce*.23)*Ce,Q=1.2+He(_e*5.9)*2.4,t=pe.createRadialGradient(j,k,0,j,k,Q*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),pe.fillStyle=t,pe.beginPath(),pe.arc(j,k,Q*2,0,Math.PI*2),pe.fill()}pe.restore()},Ae=(pe,$e)=>{pe.clearRect(0,0,Ie,Ce);const Ue=Ce*Ee.waveCenter,Be=Ee.waveBandPx,_e=Ee.segments,j=Ee.colors.filaments,k=ke||Ie,Q=0;X(pe,k,Q),pe.strokeStyle=j,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<$e.length;t+=1){const i=$e[t],h=i.offset*Be*(.85+He(i.seed)*.4),T=1-Math.min(1,Math.abs(h)/Be),O=Math.exp(-Math.pow(h/Ee.crestThickness,2)),ae=i.layer===0?1.1:i.layer===1?.85:.6,te=.35+(1-i.depth)*.65,G=T*te*ae*(.34+O*.45);pe.globalAlpha=G,pe.lineWidth=i.width*(1+(1-i.depth)*.8);const de=[];for(let je=0;je<=_e;je+=1){const ea=je/_e*k+Q,qe=(ra(ea*.012,i.seed)-.5)*Ee.xJitter,ia=ea+qe,Ve=(ra(ia*i.freqA,i.seed)-.5)*Ee.jitterA,We=(ra(ia*i.freqB,i.seed*1.7)-.5)*Ee.jitterB,Fe=Ue+Math.sin(ia*i.freqA+i.seed)*i.ampA+Math.sin(ia*i.freqB+i.seed*1.3)*i.ampB+h+Ve+We;de.push({x:ia,y:Fe})}pe.beginPath(),pe.moveTo(de[0].x,de[0].y);for(let je=1;je<de.length-1;je+=1){const ea=(de[je].x+de[je+1].x)/2,qe=(de[je].y+de[je+1].y)/2;pe.quadraticCurveTo(de[je].x,de[je].y,ea,qe)}const oe=de[de.length-1];pe.quadraticCurveTo(oe.x,oe.y,oe.x,oe.y),pe.stroke()}pe.save(),pe.globalCompositeOperation="lighter",pe.strokeStyle=Ee.colors.glow,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<$e.length;t+=1){const i=$e[t];if(Math.abs(i.offset)*Be>Ee.crestThickness)continue;const h=Ee.glowAlpha*(.7+(1-i.depth)*.6);pe.globalAlpha=h,pe.lineWidth=1.6+(1-i.depth)*1.2;const T=[];for(let ae=0;ae<=_e;ae+=1){const te=ae/_e*k+Q,G=Math.sin(te*.02+i.seed)*3,de=Ue+Math.sin(te*i.freqA+i.seed)*i.ampA+Math.sin(te*i.freqB+i.seed*1.3)*i.ampB+i.offset*Be*.35+G;T.push({x:te,y:de})}pe.beginPath(),pe.moveTo(T[0].x,T[0].y);for(let ae=1;ae<T.length-1;ae+=1){const te=(T[ae].x+T[ae+1].x)/2,G=(T[ae].y+T[ae+1].y)/2;pe.quadraticCurveTo(T[ae].x,T[ae].y,te,G)}const O=T[T.length-1];pe.quadraticCurveTo(O.x,O.y,O.x,O.y),pe.stroke()}pe.restore()},Te=()=>{Ie=Math.floor(ee.clientWidth),Ce=Math.floor(ee.clientHeight),ke=Math.floor(Ie*1.8),Ye=Ce,Pe=Ie<820?ie:se,q.forEach(pe=>{const $e=pe.getContext("2d");if(!$e)return;pe.width=Math.floor(ke*Le*Pe),pe.height=Math.floor(Ye*Le*Pe),pe.style.width=`${ke}px`,pe.style.height=`${Ye}px`,pe.style.left=`${-(ke-Ie)/2}px`,$e.setTransform(Le*Pe,0,0,Le*Pe,0,0);const Ue=Number(pe.dataset.seed||1),Be=R(Ue);Ae($e,Be)})};return Te(),window.addEventListener("resize",Te,{passive:!0}),()=>window.removeEventListener("resize",Te)},[_]);const K=z[Math.min(s,z.length-1)],le=f?K:z[z.length-1],d=(le==null?void 0:le.theme)??z[0].theme,re={"--cogita-bg0":d.bg0,"--cogita-bg1":d.bg1,"--cogita-bg2":d.bg2,"--cogita-bloom":d.bloom,"--cogita-sat":d.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:C,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:L,onChange:o}),e.jsx(Ur,{copy:a,label:l,isAuthenticated:u,secureMode:N,onLogin:n,onProfileNavigate:g,onToggleSecureMode:w,onLogout:x,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:b,className:"cogita-section cogita-home",style:re,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[_.map((ee,q)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:ee.style,"data-seed":ee.seed,ref:Ne=>{p.current[q]=Ne}},ee.id)),W.map(ee=>e.jsx("div",{className:"cogita-home-wave",style:ee.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},ee.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Wi,{slides:z,activeIndex:s,introOpen:f,prefersReducedMotion:V,onNext:me,onPrev:ge,onSelect:ue,onExit:U,onOpen:P,onRegister:ne})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Ji},Symbol.toStringTag,{value:"Module"})),Qr=r.createContext(!1);function Na({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:o}){if(r.useContext(Qr))return e.jsx(e.Fragment,{children:o});const b=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}N("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:b,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:A,onChange:L}),e.jsx(Ur,{copy:a,label:n,isAuthenticated:l,secureMode:x,onLogin:()=>N("home"),onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:o}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function _a(a){const[n,l]=r.useState("Cogita library"),[u,g]=r.useState(null);return r.useEffect(()=>{let w=!1;return Wr().then(x=>{if(w)return;const N=x.find(A=>A.libraryId===a);N&&l(N.name)}).catch(()=>{w||l("Cogita library")}),()=>{w=!0}},[a]),r.useEffect(()=>{let w=!1;return hi(a).then(x=>{w||g(x)}).catch(()=>{w||g(null)}),()=>{w=!0}},[a]),{libraryName:n,stats:u}}function Ir({slices:a}){const n=a.reduce((u,g)=>u+Math.max(0,g.value),0),l=r.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let u=0;return`conic-gradient(${a.map(w=>{const N=Math.max(0,w.value)/n*360,A=u,L=u+N;return u=L,`${w.color} ${A}deg ${L}deg`}).join(",")})`},[a,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:l}}),e.jsx("div",{className:"cogita-overview-legend",children:a.map(u=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:u.color}}),e.jsx("strong",{children:u.value}),e.jsx("small",{children:u.label})]},u.label))})]})}function Yi({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:C,stats:b}=_a(o),[p,W]=r.useState("infos"),[_,z]=r.useState(0),[s,m]=r.useState(0),[f,he]=r.useState(0),V=(b==null?void 0:b.totalInfos)??0,v=(b==null?void 0:b.totalCollections)??0,D=0,F=0,ne=0,P=Math.max(0,V-ne-s),U=Math.max(0,V-s-f);r.useEffect(()=>{let me=!1;return(async()=>{try{const K=await wt({libraryId:o,limit:200}),le=await Promise.all(K.items.map(d=>zr({libraryId:o,collectionId:d.collectionId}).catch(()=>[])));if(me)return;z(le.reduce((d,re)=>d+re.length,0))}catch{me||z(0)}})(),()=>{me=!0}},[o]),r.useEffect(()=>{let me=!1;return(async()=>{try{const[K,le,d]=await Promise.all([Et({libraryId:o,type:"computed",limit:1}).catch(()=>({total:0})),Et({libraryId:o,type:"source",limit:1}).catch(()=>({total:0})),Hr({libraryId:o}).catch(()=>({items:[]}))]);if(me)return;m((K.total??0)+(le.total??0));const re=new Set(d.items.filter(ee=>ee.childItemType.toLowerCase()==="info").map(ee=>ee.childItemId).filter(Boolean));he(re.size)}catch{me||(m(0),he(0))}})(),()=>{me=!0}},[o]);const ue=[{key:"infos",label:a.cogita.library.overview.stats.totalInfos,value:V},{key:"collections",label:a.cogita.library.overview.stats.collections,value:v},{key:"revisions",label:a.cogita.library.overview.stats.revisions,value:_},{key:"storyboards",label:a.cogita.library.overview.stats.storyboards,value:D},{key:"texts",label:a.cogita.library.overview.stats.texts,value:F}];return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:C})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ue.map(me=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${p===me.key?"active":""}`,onClick:()=>W(me.key),children:[e.jsx("span",{children:me.label}),e.jsx("strong",{children:me.value})]},me.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:a.cogita.library.overview.statsCardTitle})}),p==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.knownChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.known,value:ne,color:"#75d79a"},{label:a.cogita.library.overview.unknown,value:P,color:"#85b9ff"},{label:a.cogita.library.overview.excluded,value:s,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.checksChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.availableChecks,value:f,color:"#75d79a"},{label:a.cogita.library.overview.unavailableChecks,value:U,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:a.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]})]})})]})})}const fe=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ka=(a,n,l,u)=>`${a}:${n}:${l??""}:${u??""}`,Ze=(a,n)=>{const l=a.cogita.library.infoTypes;return{any:l.any,vocab:l.vocab,language:l.language,word:l.word,sentence:l.sentence,topic:l.topic,collection:l.collection,person:l.person,institution:l.institution,collective:l.collective,orcid:l.orcid,address:l.address,email:l.email,phone:l.phone,media:l.media,work:l.work,geo:l.geo,music_piece:l.musicPiece,music_fragment:l.musicFragment,source:l.source,quote:l.quote,computed:l.computed}[n]??String(n)},Gr=a=>[{value:"any",label:Ze(a,"any")},{value:"language",label:Ze(a,"language")},{value:"word",label:Ze(a,"word")},{value:"sentence",label:Ze(a,"sentence")},{value:"topic",label:Ze(a,"topic")},{value:"collection",label:Ze(a,"collection")},{value:"person",label:Ze(a,"person")},{value:"institution",label:Ze(a,"institution")},{value:"collective",label:Ze(a,"collective")},{value:"orcid",label:Ze(a,"orcid")},{value:"address",label:Ze(a,"address")},{value:"email",label:Ze(a,"email")},{value:"phone",label:Ze(a,"phone")},{value:"media",label:Ze(a,"media")},{value:"work",label:Ze(a,"work")},{value:"geo",label:Ze(a,"geo")},{value:"music_piece",label:Ze(a,"music_piece")},{value:"music_fragment",label:Ze(a,"music_fragment")},{value:"source",label:Ze(a,"source")},{value:"quote",label:Ze(a,"quote")},{value:"computed",label:Ze(a,"computed")}],Qi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Gi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],Xi=a=>[{value:"any",label:Ze(a,"any")},{value:"vocab",label:Ze(a,"vocab")},...Gr(a).filter(n=>n.value!=="any")],tt=5,Pr=50,Rr=2,$r=[];function ze({libraryId:a,infoType:n,label:l,placeholder:u,value:g,onChange:w,values:x,onChangeMultiple:N,helperText:A,searchFailedText:L,createFailedText:o,createLabel:C,savingLabel:b,loadMoreLabel:p,inputRef:W,autoAdvance:_,onCommit:z,multiple:s}){const m=s?x??$r:$r,[f,he]=r.useState(s?"":(g==null?void 0:g.label)??""),[V,v]=r.useState([]),[D,F]=r.useState(tt),[ne,P]=r.useState(-1),[U,ue]=r.useState(!1),[me,ge]=r.useState(!1),[K,le]=r.useState(null),d=r.useRef(0),re=r.useRef(new Map),ee=r.useMemo(()=>s?f.trim().length>0:f.trim().length>0&&!g,[f,g,s]);r.useEffect(()=>{s||he((g==null?void 0:g.label)??"")},[g,s]),r.useEffect(()=>{const se=f.trim();if(!se||se.length<Rr){v([]),ue(!1),F(tt),P(-1),ge(!1),le(null);return}const ie=se.toLowerCase(),Le=`${a}:${n}:${ie}`,Ie=re.current.get(Le);if(Ie){if(s&&m.length>0){const Pe=new Set(m.map(ke=>ke.id));v(Ie.filter(ke=>!Pe.has(ke.id)))}else v(Ie);F(tt),P(-1),ue(Ie.length>0),ge(!1),le(null);return}const Ce=window.setTimeout(async()=>{const Pe=Date.now();d.current=Pe,ge(!0),le(null);try{const ke=await jr({libraryId:a,type:n,query:se,limit:Pr});if(d.current!==Pe)return;const Ye=ke.slice(0,Pr).map(Oe=>({id:Oe.infoId,label:Oe.label,infoType:Oe.infoType}));if(re.current.set(Le,Ye),s&&m.length>0){const Oe=new Set(m.map(Ee=>Ee.id));v(Ye.filter(Ee=>!Oe.has(Ee.id)))}else v(Ye);F(tt),P(-1),ue(!0)}catch{if(d.current!==Pe)return;le(L??"Search failed.")}finally{d.current===Pe&&ge(!1)}},250);return()=>window.clearTimeout(Ce)},[a,n,f,m]);const q=se=>{if(s){const ie=m.some(Le=>Le.id===se.id)?m:[...m,se];N==null||N(ie),he(""),ue(!1),P(-1);return}w==null||w(se),he(se.label),ue(!1),P(-1),_&&(z==null||z())},Ne=async()=>{const se=f.trim();if(se){ge(!0),le(null);try{const ie=await rt({libraryId:a,infoType:n,payload:{label:se}}),Le={id:ie.infoId,label:se,infoType:ie.infoType};if(se.length>=Rr){const Ie=`${a}:${n}:${se.toLowerCase()}`,Ce=re.current.get(Ie)??[];re.current.set(Ie,[Le,...Ce])}if(s){N==null||N([...m,Le]),he(""),ue(!1),P(-1);return}w==null||w(Le),ue(!1),P(-1),_&&(z==null||z())}catch{le(o??"Create failed.")}finally{ge(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:l}),e.jsx("input",{value:f,placeholder:u,onChange:se=>{he(se.target.value),!s&&g&&(w==null||w(null))},onKeyDown:se=>{if(se.key==="ArrowDown"){if(se.preventDefault(),!V.length)return;ue(!0),P(ie=>{const Le=Math.min(V.length,D)-1,Ie=ie<0?0:Math.min(ie+1,Le);return Ie===Le&&V.length>D?(F(Ce=>Math.min(Ce+tt,V.length)),Math.min(ie+1,Math.min(V.length,D+tt)-1)):Ie});return}if(se.key==="ArrowUp"){if(se.preventDefault(),!V.length)return;ue(!0),P(ie=>ie<=0?0:ie-1);return}if(se.key==="Enter"){if(se.preventDefault(),ne>=0&&V[ne]){q(V[ne]);return}if(ee){Ne();return}}},onFocus:()=>{V.length>0&&ue(!0)},autoComplete:"off",ref:W})]}),s&&m.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:m.map(se=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>N==null?void 0:N(m.filter(ie=>ie.id!==se.id)),children:[se.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},se.id))}),A&&e.jsx("p",{className:"cogita-help",children:A}),K&&e.jsx("p",{className:"cogita-error",children:K}),U&&V.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[V.slice(0,D).map((se,ie)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":ie===ne,onClick:()=>q(se),children:[e.jsx("strong",{children:se.label}),e.jsx("span",{children:se.infoType})]},se.id)),D<V.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>F(se=>Math.min(se+tt,V.length)),children:p??"Load more"})]}),ee&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Ne,disabled:me,children:me?b??"Saving...":C??`Create new ${n}`})]})}function Zi({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,mode:C}){const b=Vr(),{libraryName:p}=_a(o),W=`/#/cogita/library/${o}`,[_,z]=r.useState("any"),[s,m]=r.useState(""),[f,he]=r.useState([]),[V,v]=r.useState("idle"),[D,F]=r.useState(null),[ne,P]=r.useState(null),[U,ue]=r.useState("idle"),[me,ge]=r.useState(0),[K,le]=r.useState(null),[d,re]=r.useState("idle"),[ee,q]=r.useState(null),[Ne,se]=r.useState(null),[ie,Le]=r.useState(null),[Ie,Ce]=r.useState(null),Pe=r.useMemo(()=>({languageAId:(ee==null?void 0:ee.id)??void 0,languageBId:(Ne==null?void 0:Ne.id)??void 0,topicId:(ie==null?void 0:ie.id)??void 0,levelId:(Ie==null?void 0:Ie.id)??void 0}),[ee,Ne,ie,Ie]),ke=r.useMemo(()=>_==="vocab"||_==="any",[_]);r.useEffect(()=>{v("loading");const R=window.setTimeout(()=>{Et({libraryId:o,type:_==="any"?void 0:_,query:s.trim()||void 0,limit:30,languageAId:ke?Pe.languageAId:void 0,languageBId:ke?Pe.languageBId:void 0,topicId:ke?Pe.topicId:void 0,levelId:ke?Pe.levelId:void 0}).then(X=>{he(X.items),ge(X.total),le(X.nextCursor??null),v("ready"),F(X.items[0]??null)}).catch(()=>{he([]),ge(0),le(null),v("ready")})},240);return()=>window.clearTimeout(R)},[o,s,_,ke,Pe]),r.useEffect(()=>{if(!D||D.cardType!=="info"||D.infoType!=="computed"){P(null),ue("idle"),re("idle");return}ue("loading"),hr({libraryId:o,infoId:D.cardId}).then(R=>{P(R),ue("ready")}).catch(()=>{P(null),ue("ready")})},[o,D]);const Ye=async()=>{if(K){v("loading");try{const R=await Et({libraryId:o,type:_==="any"?void 0:_,query:s.trim()||void 0,limit:30,cursor:K,languageAId:ke?Pe.languageAId:void 0,languageBId:ke?Pe.languageBId:void 0,topicId:ke?Pe.topicId:void 0,levelId:ke?Pe.levelId:void 0});he(X=>[...X,...R.items]),le(R.nextCursor??null),ge(R.total),v("ready")}catch{v("ready")}}},Oe=async()=>{if(!(!D||D.cardType!=="connection"&&D.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){re("loading");try{await bi({libraryId:o,connectionId:D.cardId});let X=null;he(Ae=>{const Te=Ae.filter(pe=>pe.cardId!==D.cardId);return X=Te[0]??null,Te}),ge(Ae=>Math.max(0,Ae-(D.cardType==="vocab"?3:1))),F(Ae=>Ae&&Ae.cardId===D.cardId?X:Ae),re("idle")}catch{re("error")}}},Ee=r.useMemo(()=>C==="collection"?"grid":C==="list"?"list":"detail",[C]),He=D?fe(D):null,sa=r.useMemo(()=>Xi(a),[a]),ra=r.useMemo(()=>{const R=me||f.length;return a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(R))},[a,f.length,me]);return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Ee,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:p}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:W,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${W}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${W}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(R=>e.jsx("a",{className:"ghost","data-active":C===R,href:`${W}/${R}`,children:R==="detail"?a.cogita.library.list.modes.detail:R==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},R))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:_,onChange:R=>z(R.target.value),children:sa.map(R=>e.jsx("option",{value:R.value,children:R.label},R.value))}),e.jsx("input",{type:"text",value:s,onChange:R=>m(R.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(_==="vocab"||_==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:ee,onChange:q,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:Ne,onChange:se,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:ie,onChange:Le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:Ie,onChange:Ce,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(ee||Ne||ie||Ie)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{q(null),se(null),Le(null),Ce(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ra}),e.jsx("span",{children:V==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":C==="collection"?"grid":"list",children:f.length?f.map(R=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":He===fe(R),onClick:()=>{F(R),R.cardType==="info"&&b(`/cogita/library/${o}/list?infoId=${encodeURIComponent(R.cardId)}&infoView=overview`)},children:[e.jsx("div",{className:"cogita-card-type",children:R.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:R.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:R.label}),e.jsx("p",{className:"cogita-card-subtitle",children:R.description})]},fe(R))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${W}/new`,children:a.cogita.library.list.addInfo})]})}),K?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Ye,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(D==null?void 0:D.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(D==null?void 0:D.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${W}/edit/${D.cardId}`,children:a.cogita.library.list.editInfo}):null,(D==null?void 0:D.cardType)==="connection"||(D==null?void 0:D.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:Oe,disabled:d==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${W}/new`,children:a.cogita.library.actions.addInfo})]})]}),D?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:D.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:D.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),d==="error"&&(D.cardType==="connection"||D.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,D.cardType==="info"&&D.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),U==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),U!=="loading"&&ne?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(At,{value:ne.prompt,mode:"auto"}),ne.expectedAnswers&&Object.keys(ne.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(ne.expectedAnswers).map(([R,X])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:R}),e.jsx(br,{value:X,mode:"auto"})]},R))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(br,{value:ne.expectedAnswer,mode:"auto"})]})]}):U!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Bt=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Er=8;function Ar({libraryId:a,copy:n,language:l,sourceKindOptions:u,value:g,onChange:w,labels:x}){const[N,A]=r.useState(!1),[L,o]=r.useState(-1),C=r.useMemo(()=>{const _=l;return Bt.map(z=>{var f;const s=(z==null?void 0:z[_])??(z==null?void 0:z.en)??(z==null?void 0:z.la);return{label:`${s.abbr} — ${s.name}`,latin:((f=z==null?void 0:z.la)==null?void 0:f.abbr)??s.abbr}})},[l]),b=(_,z=!1)=>{const s=_.trim().toLowerCase();return s?C.filter(m=>m.label.toLowerCase().includes(s)).slice(0,Er):z?C.slice(0,Er):[]},p=(_,z)=>{const s=_.trim().toLowerCase();if(!s)return null;const m=Bt;for(const f of m){const he=f==null?void 0:f.la,V=(f==null?void 0:f[z])??(f==null?void 0:f.en)??he,v=(V==null?void 0:V.abbr)??"",D=(V==null?void 0:V.name)??"";if(v.toLowerCase()===s||D.toLowerCase()===s||`${v} — ${D}`.toLowerCase()===s)return{book:f,entry:V,la:he}}return null};r.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!N){const _=p(g.locatorValue,l);if(_){const z=`${_.entry.abbr} — ${_.entry.name}`;z!==g.bibleBookDisplay&&w({...g,bibleBookDisplay:z})}}},[l,g,N,w]);const W=_=>w({...g,..._});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:_=>W({sourceKind:_.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:u.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:_=>{const z=_.target.value;W({bibleBookDisplay:z,locatorValue:""}),A(!0),o(-1)},onKeyDown:_=>{var s;const z=b(g.bibleBookDisplay);if(z.length){if(_.key==="ArrowDown")_.preventDefault(),o(m=>Math.min(m+1,z.length-1));else if(_.key==="ArrowUp")_.preventDefault(),o(m=>Math.max(m-1,0));else if((_.key==="Enter"||_.key==="Tab")&&L>=0&&z[L]){const m=z[L],f=p(m.label,l);if(!f)return;W({bibleBookDisplay:m.label,locatorValue:((s=f.la)==null?void 0:s.abbr)??g.locatorValue}),A(!1)}}},onFocus:()=>A(!0),onBlur:()=>window.setTimeout(()=>A(!1),100),placeholder:x.bibleBookPlaceholder})]}),N&&b(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:b(g.bibleBookDisplay,!0).map((_,z)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":z===L,tabIndex:-1,onMouseDown:()=>{var m;const s=p(_.label,l);s&&W({bibleBookDisplay:_.label,locatorValue:((m=s.la)==null?void 0:m.abbr)??g.locatorValue})},children:e.jsx("strong",{children:_.label})},_.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:_=>W({locatorAux:_.target.value}),placeholder:x.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:_=>W({sourceUrl:_.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:_=>W({sourceAccessedDate:_.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:a,infoType:"work",label:x.churchDocumentLabel,placeholder:x.churchDocumentPlaceholder,value:g.churchDocument,onChange:_=>W({churchDocument:_}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:_=>W({locatorValue:_.target.value}),placeholder:x.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(ze,{libraryId:a,infoType:"work",label:x.workLabel,placeholder:x.workPlaceholder,value:g.work,onChange:_=>W({work:_}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:a,infoType:"media",label:x.bookLabel,placeholder:x.bookPlaceholder,value:g.bookMedia,onChange:_=>W({bookMedia:_}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:_=>W({locatorValue:_.target.value}),placeholder:x.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:_=>W({locatorValue:_.target.value}),placeholder:x.locatorPlaceholder})]})]})}const en=[],an=[];function tn({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),l=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),u=a.handles.length,g=u>1?(u-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),l?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((w,x)=>e.jsx(Cr,{type:"target",id:w.id,position:Mr.Left,style:{top:46+x*28},children:w.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:w.label}):null},w.id)),a.output!==!1?e.jsx(Cr,{type:"source",id:"out",position:Mr.Right}):null]})}function rn({copy:a,value:n,onChange:l}){var Oe,Ee,He,sa,ra,R,X,Ae,Te,pe,$e,Ue,Be,_e;const u=r.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=j=>!j||j.nodes.length===0?en:j.nodes.map((k,Q)=>{var t,i,h,T;return{id:k.id,type:"computed",position:k.position??{x:40+Q*160,y:60+Q%3*80},data:{title:k.name||((t=u[k.type])==null?void 0:t.label)||k.type,subtitle:((i=u[k.type])==null?void 0:i.label)||k.type,type:k.type,name:k.name,outputLabel:k.outputLabel,min:k.min,max:k.max,value:k.type==="input.const"?k.value:void 0,list:k.list,handles:((h=u[k.type])==null?void 0:h.handles)??[],output:((T=u[k.type])==null?void 0:T.output)??!0}}}),w=j=>{if(!j||j.nodes.length===0)return an;const k=new Set(j.nodes.map(i=>i.id)),Q=[];let t=0;return j.nodes.forEach(i=>{const h=i.inputsByHandle??(i.inputs?{in:i.inputs}:{});Object.entries(h).forEach(([T,O])=>{O.forEach(ae=>{k.has(ae)&&Q.push({id:`${i.id}-${T}-${ae}-${t++}`,source:ae,target:i.id,targetHandle:T==="in"?void 0:T})})})}),Q},x=r.useMemo(()=>g(n),[n,u]),N=r.useMemo(()=>w(n),[n]),A=(j,k)=>{if(!j)return"null";const Q=j.nodes.map(i=>{const h=(i.list??[]).join(","),T=i.inputs?i.inputs.join(","):"",O=i.inputsByHandle?Object.entries(i.inputsByHandle).map(([te,G])=>`${te}:${[...G].sort().join(",")}`).sort().join("|"):"",ae=k&&i.position?`${i.position.x},${i.position.y}`:"";return[i.id,i.type,i.name??"",i.outputLabel??"",i.min??"",i.max??"",h,T,O,ae].join(":")}).sort().join("||"),t=j.outputs?[...j.outputs].sort().join(","):j.output??"";return`${Q}::${t}`},L=r.useMemo(()=>{var k;const j=!!((k=n==null?void 0:n.nodes)!=null&&k.some(Q=>!!Q.position));return A(n,j)},[n]),[o,C]=r.useState(x),[b,p]=r.useState(N),[W,_]=r.useState(null),[z,s]=r.useState([]),[m,f]=r.useState(null),[he,V]=r.useState(null),[v,D]=r.useState({}),[F,ne]=r.useState(0),P=r.useRef(l),U=r.useRef(L),ue=r.useRef(L),me=r.useRef(A(n,!1)),ge=r.useMemo(()=>W?o.find(j=>j.id===W)??null:null,[o,W]),K=r.useMemo(()=>{const j=["in1","in2","in3","in4","in5","in6"],k=new Map;return b.forEach(Q=>{if(!Q.target)return;const t=Q.targetHandle??"in1";k.has(Q.target)||k.set(Q.target,new Set),k.get(Q.target).add(t)}),o.map(Q=>{var t;if(((t=Q.data)==null?void 0:t.type)==="compute.concat"){const i=k.get(Q.id)??new Set,h=[];let T=!1;return j.forEach(O=>{var ae,te;if(i.has(O)||!T){const G=(te=(ae=u["compute.concat"])==null?void 0:ae.handles)==null?void 0:te.find(de=>de.id===O);G&&h.push(G),i.has(O)||(T=!0)}}),{...Q,selected:Q.id===W,data:{...Q.data,handles:h}}}return{...Q,selected:Q.id===W}})},[o,W,b,u]);r.useEffect(()=>{f(null),V(null)},[W]),r.useEffect(()=>{if(z.length===0)return;const j=k=>{if(k.key!=="Delete"&&k.key!=="Backspace")return;const Q=k.target;Q&&(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"||Q.isContentEditable)||(k.preventDefault(),p(t=>t.filter(i=>!z.includes(i.id))),s([]))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[z,p]),r.useEffect(()=>{P.current=l},[l]),r.useEffect(()=>{if(U.current!==L){if(ue.current===L||me.current===L){U.current=L;return}U.current=L,C(x),p(N),_(null),f(null),V(null),D({}),ne(j=>j+1)}},[x,N,p,C,L]),r.useEffect(()=>{const j=o.filter(h=>{var T;return((T=h.data)==null?void 0:T.type)==="output"}).map(h=>h.id).sort(),k=new Map;b.forEach(h=>{let T=k.get(h.target);T||(T={},k.set(h.target,T));const O=h.targetHandle||"in";T[O]||(T[O]=[]),T[O].push(h.source)}),k.forEach(h=>{Object.values(h).forEach(T=>T.sort())});const Q={nodes:o.map(h=>{var T,O,ae,te,G,de,oe,je,ea;return{id:h.id,type:((T=h.data)==null?void 0:T.type)??"compute.add",position:h.position,name:(O=h.data)==null?void 0:O.name,outputLabel:(ae=h.data)==null?void 0:ae.outputLabel,min:(te=h.data)==null?void 0:te.min,max:(G=h.data)==null?void 0:G.max,value:((de=h.data)==null?void 0:de.type)==="input.const"?(oe=h.data)==null?void 0:oe.value:void 0,list:(je=h.data)==null?void 0:je.list,inputs:(ea=k.get(h.id))==null?void 0:ea.in,inputsByHandle:k.get(h.id)}}),output:j[0]??null,outputs:j},t=A(Q,!0),i=A(Q,!1);t===ue.current||i===me.current||(ue.current=t,me.current=i,P.current(Q))},[o,b]),r.useEffect(()=>{const j={};let k=!1;o.forEach(Q=>{var O,ae,te,G,de;if(((O=Q.data)==null?void 0:O.type)!=="input.random")return;if(v[Q.id]!==void 0){j[Q.id]=v[Q.id];return}const t=Number.isFinite((ae=Q.data)==null?void 0:ae.min)?Number((te=Q.data)==null?void 0:te.min):0,i=Number.isFinite((G=Q.data)==null?void 0:G.max)?Number((de=Q.data)==null?void 0:de.max):t+10,h=Math.min(t,i),T=Math.max(t,i);j[Q.id]=Math.floor(Math.random()*(T-h+1))+h,k=!0}),(k||Object.keys(j).length!==Object.keys(v).length)&&D(j)},[o,v,F]);const le=r.useMemo(()=>o.map(k=>{var t,i,h,T,O;const Q=(((t=k.data)==null?void 0:t.list)??[]).join(",");return[k.id,((i=k.data)==null?void 0:i.type)??"",((h=k.data)==null?void 0:h.name)??"",((T=k.data)==null?void 0:T.min)??"",((O=k.data)==null?void 0:O.max)??"",Q].join(":")}).sort().join("|"),[o]),d=r.useMemo(()=>b.map(k=>`${k.source}:${k.target}:${k.targetHandle??""}`).sort().join("|"),[b]),re=r.useMemo(()=>{const j=new Map(o.map(te=>[te.id,te])),k=new Map;b.forEach(te=>{let G=k.get(te.target);G||(G={},k.set(te.target,G));const de=te.targetHandle||"in";G[de]||(G[de]=[]),G[de].push(te.source)});const Q=new Map,t=new Set,i=te=>{if(typeof te=="number")return te;if(typeof te=="string"){const G=Number(te);return Number.isFinite(G)?G:0}return 0},h=(te,G)=>{var de,oe;return G?((de=k.get(te.id))==null?void 0:de[G])??[]:((oe=k.get(te.id))==null?void 0:oe.in)??[]},T=(te,G)=>h(te,G).map(de=>i(ae(de))),O=(te,G)=>h(te,G).map(de=>ae(de)),ae=te=>{var je,ea,qe,ia;if(Q.has(te))return Q.get(te);if(t.has(te))return 0;const G=j.get(te);if(!G)return 0;t.add(te);const de=((je=G.data)==null?void 0:je.type)??"";let oe=0;switch(de){case"input.random":{oe=v[te]??0;break}case"input.const":{oe=Number.isFinite((ea=G.data)==null?void 0:ea.value)?Number((qe=G.data)==null?void 0:qe.value):0;break}case"input.list":{const Ve=(((ia=G.data)==null?void 0:ia.list)??[]).filter(Boolean),We=Math.round(T(G,"index")[0]??0);oe=(Ve.length?Ve[Math.max(0,Math.min(Ve.length-1,We))]:"")||String(We);break}case"compute.add":{oe=T(G,"in").reduce((Ve,We)=>Ve+We,0);break}case"compute.sub":{oe=T(G,"add").reduce((Ve,We)=>Ve+We,0)-T(G,"sub").reduce((Ve,We)=>Ve+We,0);break}case"compute.mul":{const Ve=T(G,"in");oe=Ve.length?Ve.reduce((We,Fe)=>We*Fe,1):0;break}case"compute.div":{const Ve=T(G,"num")[0]??0,We=T(G,"den").reduce((Fe,Ge)=>Fe+Ge,0);oe=Math.abs(We)<Number.EPSILON?0:Ve/We;break}case"compute.pow":{const Ve=T(G,"base")[0]??0,We=T(G,"exp")[0]??0;oe=Math.pow(Ve,We);break}case"compute.exp":{const Ve=T(G,"base")[0]??0,We=T(G,"exp")[0]??0;oe=Math.pow(Ve,We);break}case"compute.log":{const Ve=T(G,"value")[0]??0,We=T(G,"base")[0]??0,Fe=Math.max(Ve,Number.EPSILON);oe=Math.abs(We)<Number.EPSILON?Math.log(Fe):Math.log(Fe)/Math.log(We);break}case"compute.abs":{oe=Math.abs(T(G,"in")[0]??0);break}case"compute.min":{const Ve=T(G,"in");oe=Ve.length?Math.min(...Ve):0;break}case"compute.max":{const Ve=T(G,"in");oe=Ve.length?Math.max(...Ve):0;break}case"compute.floor":{oe=Math.floor(T(G,"in")[0]??0);break}case"compute.ceil":{oe=Math.ceil(T(G,"in")[0]??0);break}case"compute.round":{oe=Math.round(T(G,"in")[0]??0);break}case"compute.mod":{const Ve=T(G,"a")[0]??0,We=T(G,"b")[0]??0;oe=Math.abs(We)<Number.EPSILON?0:Ve%We;break}case"compute.concat":{const We=["in1","in2","in3","in4","in5","in6"].flatMap(la=>O(G,la)),Fe=We.length?We:O(G,"in");oe=(Fe.length?Fe:O(G)).map(la=>la==null?"":String(la)).join("");break}case"compute.trim":{const Ve=O(G,"text")[0]??O(G,"in")[0]??"",We=Ve==null?"":String(Ve),Fe=Math.max(0,Math.round(T(G,"start")[0]??0)),Ge=Math.max(0,Math.round(T(G,"end")[0]??0));oe=Fe+Ge>=We.length?"":We.substring(Fe,We.length-Ge);break}case"output":{const Ve=h(G,"in")[0];oe=Ve?ae(Ve):0;break}default:oe=0}return t.delete(te),Q.set(te,oe),oe};return o.forEach(te=>ae(te.id)),Q},[le,d,v]),ee=r.useRef(re);r.useEffect(()=>{ee.current=re},[re]);const q=r.useCallback(j=>{const k=ee.current.get(j.id);return e.jsx(tn,{data:{...j.data,value:k}})},[]),Ne=r.useMemo(()=>({computed:q}),[q]),se=j=>{var i;if(!j.target||!j.targetHandle){p(h=>$t(j,h));return}const k=o.find(h=>h.id===j.target),Q=k?u[((i=k.data)==null?void 0:i.type)??""]:null,t=Q==null?void 0:Q.handles.find(h=>h.id===j.targetHandle);p(h=>{let T=h;return t!=null&&t.limitOne&&(T=h.filter(O=>!(O.target===j.target&&O.targetHandle===j.targetHandle))),$t(j,T)})},ie=j=>{const k=crypto.randomUUID(),Q=u[j]??{label:j,handles:[]},t=Q.label;C(i=>[...i,{id:k,type:"computed",position:{x:80+i.length*40,y:80+i.length*30},data:{title:t,subtitle:Q.label,type:j,name:"",handles:Q.handles,list:j==="input.list"?[]:void 0,output:Q.output??!0}}])},Le=j=>{if(W){if(j.name!==void 0){const k=j.name.trim(),Q=k===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(k);if(V(Q?null:a.cogita.library.graph.invalidName),!k)f(null);else{const t=o.find(i=>{var h;return i.id!==W&&((h=i.data)==null?void 0:h.name)&&i.data.name.trim().toLowerCase()===k.toLowerCase()});f(t?a.cogita.library.graph.duplicateName:null)}}C(k=>k.map(Q=>{var t,i,h,T;return Q.id===W?{...Q,data:{...Q.data,...j,title:j.name?j.name:(t=Q.data)==null?void 0:t.title,subtitle:((h=u[j.type??((i=Q.data)==null?void 0:i.type)??""])==null?void 0:h.label)??((T=Q.data)==null?void 0:T.subtitle)}}:Q}))}},Ie=()=>{W&&(C(j=>j.filter(k=>k.id!==W)),p(j=>j.filter(k=>k.source!==W&&k.target!==W)),D(j=>{const k={...j};return delete k[W],k}),_(null),f(null))},Ce=r.useRef({nodeId:null,edgeIds:[]}),Pe=j=>{var T;const k=((T=j.nodes[0])==null?void 0:T.id)??null,Q=j.edges.map(O=>O.id),t=Ce.current,i=t.nodeId===k,h=t.edgeIds.length===Q.length&&t.edgeIds.every((O,ae)=>O===Q[ae]);i&&h||(Ce.current={nodeId:k,edgeIds:Q},_(k),s(Q))},ke=j=>{const k=j.filter(Q=>Q.type!=="select"&&Q.type!=="dimensions");k.length!==0&&C(Q=>gi(k,Q))},Ye=j=>{const k=j.filter(Q=>Q.type!=="select");k.length!==0&&p(Q=>ui(k,Q))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodeTypes:Ne,nodes:K,edges:b,onNodesChange:ke,onEdgesChange:Ye,onConnect:se,onNodeClick:(j,k)=>_(k.id),onSelectionChange:Pe,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>ie("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>ie("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>ie("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>ie("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>ie("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>ie("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>ie("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>ie("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>ie("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>ie("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>ie("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>ie("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>ie("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>ie("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>ie("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>ie("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>ie("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>ie("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>ie("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>ie("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),ge?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Oe=ge.data)==null?void 0:Oe.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:j=>Le({name:j.target.value})}),m?e.jsx("em",{className:"cogita-help",children:m}):null,he?e.jsx("em",{className:"cogita-help",children:he}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((He=u[((Ee=ge.data)==null?void 0:Ee.type)??""])==null?void 0:He.label)??((sa=ge.data)==null?void 0:sa.type)]}),((ra=ge.data)==null?void 0:ra.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((R=ge.data)==null?void 0:R.outputLabel)??"",onChange:j=>Le({outputLabel:j.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((X=ge.data)==null?void 0:X.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Ae=ge.data)==null?void 0:Ae.min)??0,onChange:j=>Le({min:Number(j.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Te=ge.data)==null?void 0:Te.max)??10,onChange:j=>Le({max:Number(j.target.value)})})]})]}),((pe=ge.data)==null?void 0:pe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:(($e=ge.data)==null?void 0:$e.value)??0,onChange:j=>Le({value:Number(j.target.value)})})]}),((Ue=ge.data)==null?void 0:Ue.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Be=ge.data)==null?void 0:Be.list)??[]).join(`
`),onChange:j=>Le({list:j.target.value.split(`
`).map(k=>k.replace(/\r$/,"")).filter(k=>k.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((_e=ge.data)==null?void 0:_e.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{W&&(D(j=>{var h,T,O,ae;const k=Number.isFinite((h=ge.data)==null?void 0:h.min)?Number((T=ge.data)==null?void 0:T.min):0,Q=Number.isFinite((O=ge.data)==null?void 0:O.max)?Number((ae=ge.data)==null?void 0:ae.max):k+10,t=Math.min(k,Q),i=Math.max(k,Q);return{...j,[W]:Math.floor(Math.random()*(i-t+1))+t}}),ne(j=>j+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Ie,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const rr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function wr(a,n,l){if(!a)return null;const u=new Map(a.nodes.map(V=>[V.id,V])),g=new Map,w=new Set,x=V=>{if(typeof V=="number")return V;if(typeof V=="string"){const v=Number(V);return Number.isFinite(v)?v:0}return 0},N=V=>{if(g.has(V))return g.get(V);if(w.has(V))return 0;const v=u.get(V);if(!v)return 0;w.add(V);const D=ne=>{var U,ue;return(ne?((U=v.inputsByHandle)==null?void 0:U[ne])??[]:v.inputs??((ue=v.inputsByHandle)==null?void 0:ue.in)??[]).map(me=>N(me))};let F=0;switch(v.type){case"input.random":{const ne=v.min??0,P=v.max??ne+10,U=Math.min(ne,P),ue=Math.max(ne,P);F=Math.floor(Math.random()*(ue-U+1))+U;break}case"input.const":{F=v.value??0;break}case"input.list":{const ne=(v.list??[]).filter(Boolean),P=Math.round(x(D("index")[0]));F=ne.length?ne[Math.max(0,Math.min(ne.length-1,P))]:String(P);break}case"compute.add":{F=D("in").map(P=>x(P)).reduce((P,U)=>P+U,0);break}case"compute.sub":{const ne=D("add").map(U=>x(U)),P=D("sub").map(U=>x(U));F=ne.reduce((U,ue)=>U+ue,0)-P.reduce((U,ue)=>U+ue,0);break}case"compute.mul":{const ne=D("in").map(P=>x(P));F=ne.length?ne.reduce((P,U)=>P*U,1):0;break}case"compute.div":{const ne=x(D("num")[0]),P=D("den").map(U=>x(U)).reduce((U,ue)=>U+ue,0);F=Math.abs(P)<Number.EPSILON?0:ne/P;break}case"compute.pow":{const ne=x(D("base")[0]),P=x(D("exp")[0]);F=Math.pow(ne,P);break}case"compute.exp":{const ne=x(D("base")[0]),P=x(D("exp")[0]);F=Math.pow(ne,P);break}case"compute.log":{const ne=x(D("value")[0]),P=x(D("base")[0]),U=Math.max(ne,Number.EPSILON);F=Math.abs(P)<Number.EPSILON?Math.log(U):Math.log(U)/Math.log(P);break}case"compute.abs":{F=Math.abs(x(D("in")[0]));break}case"compute.min":{const ne=D("in").map(P=>x(P));F=ne.length?Math.min(...ne):0;break}case"compute.max":{const ne=D("in").map(P=>x(P));F=ne.length?Math.max(...ne):0;break}case"compute.floor":{F=Math.floor(x(D("in")[0]));break}case"compute.ceil":{F=Math.ceil(x(D("in")[0]));break}case"compute.round":{F=Math.round(x(D("in")[0]));break}case"compute.mod":{const ne=x(D("a")[0]),P=x(D("b")[0]);F=Math.abs(P)<Number.EPSILON?0:ne%P;break}case"compute.concat":{const P=["in1","in2","in3","in4","in5","in6"].flatMap(ge=>D(ge)),U=P.length?P:D("in");F=(U.length?U:D()).map(ge=>ge==null?"":String(ge)).join("");break}case"compute.trim":{const ne=D("text")[0]??D("in")[0]??"",P=ne==null?"":String(ne),U=Math.max(0,Math.round(x(D("start")[0]))),ue=Math.max(0,Math.round(x(D("end")[0])));U+ue>=P.length?F="":F=P.substring(U,P.length-ue);break}case"output":{F=D("in")[0]??0;break}default:F=0}return w.delete(V),g.set(V,F),F},A=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(V=>V.type==="output").map(V=>V.id);a.nodes.forEach(V=>N(V.id)),A.forEach(V=>N(V));const L=V=>Math.abs(V%1)<1e-5?String(Math.round(V)):V.toFixed(3).replace(/\.?0+$/,""),o=V=>typeof V=="number"?L(V):V??"",C=new Map;A.forEach(V=>{var P,U,ue,me;const v=u.get(V);if(!v)return;const D=(U=(P=v.inputsByHandle)==null?void 0:P.name)==null?void 0:U[0],F=D?o(g.get(D)):"",ne=(F==null?void 0:F.toString().trim())||((ue=v.outputLabel)==null?void 0:ue.trim())||((me=v.name)==null?void 0:me.trim())||V;C.set(V,ne)});const b={},p={},W={};A.forEach(V=>{var F,ne;const v=u.get(V);if(!v)return;const D=C.get(V)??(((F=v.outputLabel)==null?void 0:F.trim())||((ne=v.name)==null?void 0:ne.trim())||V);b[D]=o(g.get(V)),v.name&&(p[v.name.trim()]=D),p[V]=D});const _=(V,v)=>{let D=V;return a.nodes.forEach(F=>{var me,ge;const ne=o(g.get(F.id)),P=A.includes(F.id),U=P?C.get(F.id)??((me=F.outputLabel)==null?void 0:me.trim())??((ge=F.name)==null?void 0:ge.trim())??F.id:"",ue=P&&v?U:ne;D=D.replace(new RegExp(`\\{\\s*${rr(F.id)}\\s*\\}`,"gi"),ue),F.name&&(D=D.replace(new RegExp(`\\{\\s*${rr(F.name)}\\s*\\}`,"gi"),ue)),P&&F.outputLabel&&(D=D.replace(new RegExp(`\\{\\s*${rr(F.outputLabel)}\\s*\\}`,"gi"),U))}),D},z=n;let s=z.trim().length>0?z:"";s||(s=A.length?`Compute ${A.join(", ")}`:"Compute"),s=_(s,!0);const m=(l==null?void 0:l.trim())??"",f=m?_(m,!1):"",he={};return g.forEach((V,v)=>{he[v]=V,W[v]=o(V);const D=u.get(v);D!=null&&D.name&&(W[D.name.trim()]=o(V))}),{prompt:s,answers:b,values:he,answerText:f,outputVariables:p,variableValues:W}}function Xr(a){var l;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((l=n[0])==null?void 0:l[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function nn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,editInfoId:C}){const{libraryName:b}=_a(o),p=!!C,W=`/#/cogita/library/${o}`,[_,z]=r.useState("info"),[s,m]=r.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[f,he]=r.useState(""),[V,v]=r.useState(null),[D,F]=r.useState(null),[ne,P]=r.useState("idle"),[U,ue]=r.useState(null),[me,ge]=r.useState(-1),[K,le]=r.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[d,re]=r.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[ee,q]=r.useState(null),[Ne,se]=r.useState("idle"),[ie,Le]=r.useState(null),[Ie,Ce]=r.useState(null),[Pe,ke]=r.useState(null),Ye=r.useRef(null),Oe=r.useRef(null),Ee=r.useRef(null),He=r.useMemo(()=>Gr(a),[a]),sa=r.useMemo(()=>Qi(a),[a]),ra=r.useMemo(()=>Gi(a),[a]),R=r.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),X=r.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Ae=r.useMemo(()=>He.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[He]),Te=r.useMemo(()=>{const t=A;return Bt.map(i=>{var O;const h=(i==null?void 0:i[t])??(i==null?void 0:i.en)??(i==null?void 0:i.la);return{label:`${h.abbr} — ${h.name}`,latin:((O=i==null?void 0:i.la)==null?void 0:O.abbr)??h.abbr}})},[A]),pe=(t,i=!1)=>{const h=t.trim().toLowerCase();return h?Te.filter(T=>T.label.toLowerCase().includes(h)).slice(0,8):i?Te.slice(0,8):[]},$e=(t,i)=>{const h=t.trim().toLowerCase();if(!h)return null;const T=Bt;for(const O of T){const ae=O==null?void 0:O.la,te=(O==null?void 0:O[i])??(O==null?void 0:O.en)??ae;if([te==null?void 0:te.abbr,te==null?void 0:te.name,ae==null?void 0:ae.abbr,ae==null?void 0:ae.name,`${te==null?void 0:te.abbr} — ${te==null?void 0:te.name}`].filter(Boolean).map(de=>de.toLowerCase()).some(de=>de===h))return{book:O,entry:te,la:ae}}return null};r.useEffect(()=>{if(!K.language||!K.word){Le(null);return}const t=window.setTimeout(()=>{tr({libraryId:o,languageId:K.language.id,wordId:K.word.id}).then(i=>{Le(i.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{Le(null)})},200);return()=>window.clearTimeout(t)},[o,K.language,K.word]),r.useEffect(()=>{if(!d.languageA||!d.wordA){Ce(null);return}const t=window.setTimeout(()=>{tr({libraryId:o,languageId:d.languageA.id,wordId:d.wordA.id}).then(i=>{Ce(i.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Ce(null)})},200);return()=>window.clearTimeout(t)},[o,d.languageA,d.wordA]),r.useEffect(()=>{if(!d.languageB||!d.wordB){ke(null);return}const t=window.setTimeout(()=>{tr({libraryId:o,languageId:d.languageB.id,wordId:d.wordB.id}).then(i=>{ke(i.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{ke(null)})},200);return()=>window.clearTimeout(t)},[o,d.languageB,d.wordB]),r.useEffect(()=>{if(!p||!C)return;let t=!1;return se("loading"),q(null),it({libraryId:o,infoId:C}).then(async i=>{var T,O;if(t)return;const h=i.payload??{};if(m(ae=>({...ae,infoType:i.infoType,label:h.label??"",notes:h.notes??"",language:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,sourceKind:h.sourceKind??"string",sourceResourceType:ae.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:h.text??"",workLanguage:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,workOriginalLanguage:h.originalLanguageId?{id:h.originalLanguageId,label:h.originalLanguageId,infoType:"language"}:null,workDoi:h.doi??"",mediaType:h.mediaType??"book",mediaPublisher:h.publisher??"",mediaPublicationPlace:h.publicationPlace??"",mediaPublicationYear:h.publicationYear??"",mediaPages:h.pages??"",mediaIsbn:h.isbn??"",mediaCover:h.cover??"",mediaHeight:h.height??"",mediaLength:h.length??"",mediaWidth:h.width??"",mediaWeight:h.weight??"",mediaCollection:h.collection??"",mediaLocation:h.location??"",sourceUrl:"",sourceAccessedDate:""})),i.infoType==="source"&&h.locator&&typeof h.locator=="object"){const ae=h.locator;if(h.sourceKind==="website")m(te=>({...te,sourceUrl:typeof ae.url=="string"?ae.url:"",sourceAccessedDate:typeof ae.date=="string"?ae.date:""}));else if(h.sourceKind==="bible"){const te=typeof ae.book=="string"?ae.book:"",G=te?$e(te,A):null,de=G?`${G.entry.abbr} — ${G.entry.name}`:te;m(oe=>({...oe,sourceLocatorValue:te,sourceLocatorAux:typeof ae.rest=="string"?ae.rest:"",sourceBibleBookDisplay:de}))}else h.sourceKind==="book"?m(te=>({...te,sourceLocatorValue:typeof ae.page=="string"?ae.page:""})):h.sourceKind==="number_document"?m(te=>({...te,sourceLocatorValue:typeof ae.number=="string"?ae.number:""})):typeof ae.text=="string"&&m(te=>({...te,sourceLocatorValue:ae.text}))}if(h.languageId&&i.infoType!=="work")try{const ae=await it({libraryId:o,infoId:h.languageId});if(t)return;m(te=>{var G;return{...te,language:{id:h.languageId,label:((G=ae.payload)==null?void 0:G.label)??h.languageId,infoType:"language"}}})}catch{}if(h.languageId&&i.infoType==="work")try{const ae=await it({libraryId:o,infoId:h.languageId});if(t)return;m(te=>{var G;return{...te,workLanguage:{id:h.languageId,label:((G=ae.payload)==null?void 0:G.label)??h.languageId,infoType:"language"}}})}catch{}if(h.originalLanguageId)try{const ae=await it({libraryId:o,infoId:h.originalLanguageId});if(t)return;m(te=>{var G;return{...te,workOriginalLanguage:{id:h.originalLanguageId,label:((G=ae.payload)==null?void 0:G.label)??h.originalLanguageId,infoType:"language"}}})}catch{}i.infoType==="computed"?(he(((T=h.definition)==null?void 0:T.answerTemplate)??""),v(((O=h.definition)==null?void 0:O.graph)??null),F(null),P("idle")):(he(""),v(null),F(null),P("idle")),z("info")}).catch(()=>{t||q(a.cogita.library.add.info.failed)}).finally(()=>{t||se("idle")}),()=>{t=!0}},[a,C,p,o]),r.useEffect(()=>{if(s.sourceKind==="bible"&&s.sourceLocatorValue&&U!=="source"){const t=$e(s.sourceLocatorValue,A);if(t){const i=`${t.entry.abbr} — ${t.entry.name}`;i!==s.sourceBibleBookDisplay&&m(h=>({...h,sourceBibleBookDisplay:i}))}}},[A,s.sourceKind,s.sourceLocatorValue,s.sourceBibleBookDisplay]);const Ue=async()=>{var t,i;q(null);try{const h={label:s.infoType==="quote"||s.infoType==="source"?"":s.label,notes:s.infoType==="computed"?"":s.notes};if(s.language&&(s.infoType==="word"||s.infoType==="sentence")&&(h.languageId=s.language.id),s.infoType==="source"&&(h.sourceKind=s.sourceKind,s.sourceKind==="website"?h.locator={url:s.sourceUrl.trim(),date:s.sourceAccessedDate.trim()}:s.sourceKind==="bible"?h.locator={book:s.sourceLocatorValue.trim(),rest:s.sourceLocatorAux.trim()}:s.sourceKind==="book"?h.locator={page:s.sourceLocatorValue.trim()}:s.sourceKind==="number_document"?h.locator={number:s.sourceLocatorValue.trim()}:h.locator={text:s.sourceLocatorValue.trim()}),s.infoType==="quote"&&(h.text=s.quoteText),s.infoType==="work"&&(h.languageId=((t=s.workLanguage)==null?void 0:t.id)??null,h.originalLanguageId=((i=s.workOriginalLanguage)==null?void 0:i.id)??null,h.doi=s.workDoi.trim()),s.infoType==="media"&&(h.mediaType=s.mediaType,h.publisher=s.mediaPublisher.trim(),h.publicationPlace=s.mediaPublicationPlace.trim(),h.publicationYear=s.mediaPublicationYear.trim(),h.pages=s.mediaPages.trim(),h.isbn=s.mediaIsbn.trim(),h.cover=s.mediaCover.trim(),h.height=s.mediaHeight.trim(),h.length=s.mediaLength.trim(),h.width=s.mediaWidth.trim(),h.weight=s.mediaWeight.trim(),h.collection=s.mediaCollection.trim(),h.location=s.mediaLocation.trim()),s.infoType==="computed"){if(!V){q(a.cogita.library.add.info.computedRequired);return}if(!f.trim()){q(a.cogita.library.add.info.computedAnswerRequired);return}if(V.nodes.find(oe=>oe.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(oe.name))){q(a.cogita.library.add.info.computedInvalidName);return}const O=V.nodes.map(oe=>{var je;return(je=oe.name)==null?void 0:je.trim()}).filter(Boolean),ae=new Set;for(const oe of O){const je=oe.toLowerCase();if(ae.has(je)){q(a.cogita.library.add.info.computedDuplicateName);return}ae.add(je)}const te=V.nodes.filter(oe=>oe.type==="output"),G=te.map(oe=>{var je;return(je=oe.name)==null?void 0:je.trim()}).filter(Boolean);if(G.length!==te.length){q(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!G.every(oe=>new RegExp(`\\{\\s*${oe}\\s*\\}`,"i").test(f))){q(a.cogita.library.add.info.computedAnswerMissingOutput);return}h.definition={answerTemplate:f,graph:V}}if(p&&C)se("saving"),await mi({libraryId:o,infoId:C,payload:h}),q(a.cogita.library.add.info.updated),se("idle");else{let T=null;if(s.referenceEnabled){const oe={sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},{payload:je,resourceInfoId:ea,error:qe}=Be(oe);if(qe){q(a.cogita.library.add.info.referenceMissingSource);return}T={payload:je,resourceInfoId:ea}}const O=await rt({libraryId:o,infoType:s.infoType,payload:h});if(s.infoType==="source"&&s.sourceResource&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[O.infoId,s.sourceResource.id]}),s.infoType==="quote"&&s.language&&await ga({libraryId:o,connectionType:"quote-language",infoIds:[O.infoId,s.language.id]}),T){const oe=await rt({libraryId:o,infoType:"source",payload:T.payload});T.resourceInfoId&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[oe.infoId,T.resourceInfoId]}),await ga({libraryId:o,connectionType:"reference",infoIds:[O.infoId,oe.infoId]})}q(a.cogita.library.add.info.saved);const ae=s.infoType==="word"||s.infoType==="sentence",te=s.referenceEnabled,G=s.referenceSourceKind,de={referenceEnabled:te,referenceSourceKind:te?G:"string",referenceSourceUrl:te&&G==="website"?s.referenceSourceUrl:"",referenceSourceAccessedDate:te&&G==="website"?s.referenceSourceAccessedDate:"",referenceChurchDocument:te&&G==="number_document"?s.referenceChurchDocument:null,referenceBookMedia:te&&G==="book"?s.referenceBookMedia:null,referenceWork:te&&G==="work"?s.referenceWork:null,referenceLocatorValue:te&&G==="bible"?s.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:te&&G==="bible"?s.referenceBibleBookDisplay:""};m({infoType:s.infoType,label:"",language:ae?s.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:s.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...de}),s.infoType==="computed"&&(he(""),v(null),F(null),P("idle"))}}catch{q(a.cogita.library.add.info.failed)}},Be=t=>{let i=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:i,error:!0};i=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:i,error:!0};i=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:i,error:!0};i=t.work.id}const h={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(h.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:h,resourceInfoId:i}):{payload:{},resourceInfoId:i,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:i,error:!0}:(h.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:h,resourceInfoId:i}):(t.sourceKind==="book"?h.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?h.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(h.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:i,error:!0}:{payload:h,resourceInfoId:i})},_e=()=>{if(P("idle"),!V){F(null),P("error");return}const t=wr(V,"",f);if(!t){F(null),P("error");return}F({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),P("ready")},j=async()=>{q(null);try{if(K.connectionType==="reference"){if(!K.referencedInfo||!K.source){q(a.cogita.library.add.connection.selectReference);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.referencedInfo.id,K.source.id]})}else if(K.connectionType==="source-resource"){if(!K.source||!K.sourceResource){q(a.cogita.library.add.connection.selectSourceResource);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.source.id,K.sourceResource.id]})}else if(K.connectionType==="quote-language"){if(!K.quote||!K.language){q(a.cogita.library.add.connection.selectQuoteLanguage);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.quote.id,K.language.id]})}else if(K.connectionType==="work-contributor"){if(!K.work||!K.contributor||!K.contributorRole.trim()){q(a.cogita.library.add.connection.selectWorkContributor);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.work.id,K.contributor.id],payload:{role:K.contributorRole.trim()}})}else if(K.connectionType==="work-medium"){if(!K.work||!K.medium){q(a.cogita.library.add.connection.selectWorkMedium);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.work.id,K.medium.id]})}else if(K.connectionType==="orcid-link"){if(!K.orcidEntity||!K.orcid){q(a.cogita.library.add.connection.selectOrcidLink);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.orcidEntity.id,K.orcid.id]})}else if(K.connectionType==="word-language"){if(!K.language||!K.word){q(a.cogita.library.add.connection.selectWordLanguage);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.language.id,K.word.id],payload:{note:K.note}})}else if(K.connectionType==="word-topic"){if(!K.word||!K.topic){q(a.cogita.library.add.connection.selectWordTopic);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.word.id,K.topic.id],payload:{note:K.note}})}else if(K.connectionType==="translation"){if(!K.wordA||!K.wordB){q(a.cogita.library.add.connection.selectTwoWords);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.wordA.id,K.wordB.id],payload:{note:K.note}})}else if(K.connectionType==="language-sentence"){if(!K.language||!K.sentence){q(a.cogita.library.add.connection.selectLanguageSentence);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.language.id,K.sentence.id],payload:{note:K.note}})}q(a.cogita.library.add.connection.saved),le(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{q(a.cogita.library.add.connection.failed)}},k=async()=>{var t,i;q(null);try{if(d.groupType==="citation"){const T=d.citationTitle.trim(),O=d.citationQuoteText.trim();if(!O){q(a.cogita.library.add.group.citationMissingQuote);return}let ae=null;if(d.citationReferenceEnabled){const de={sourceKind:d.citationSourceKind,locatorValue:d.citationLocatorValue,locatorAux:d.citationLocatorAux,bibleBookDisplay:d.citationBibleBookDisplay,sourceUrl:d.citationSourceUrl,sourceAccessedDate:d.citationSourceAccessedDate,churchDocument:d.citationChurchDocument,bookMedia:d.citationBookMedia,work:d.citationWork},{payload:oe,resourceInfoId:je,error:ea}=Be(de);if(ea){q(a.cogita.library.add.info.referenceMissingSource);return}ae={payload:oe,resourceInfoId:je}}const te={text:O};T&&(te.title=T);const G=await rt({libraryId:o,infoType:"quote",payload:te});if(d.citationLanguage&&await ga({libraryId:o,connectionType:"quote-language",infoIds:[G.infoId,d.citationLanguage.id]}),ae){const de=await rt({libraryId:o,infoType:"source",payload:ae.payload});ae.resourceInfoId&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[de.infoId,ae.resourceInfoId]}),await ga({libraryId:o,connectionType:"reference",infoIds:[G.infoId,de.infoId]})}q(a.cogita.library.add.group.savedCitation),re(de=>({...de,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:de.citationReferenceEnabled,citationSourceKind:de.citationReferenceEnabled?de.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:de.citationReferenceEnabled?de.citationChurchDocument:null,citationBookMedia:de.citationReferenceEnabled?de.citationBookMedia:null,citationWork:de.citationReferenceEnabled?de.citationWork:null}));return}if(d.groupType==="book"){const T=d.bookTitle.trim();if(!T){q(a.cogita.library.add.group.bookMissingTitle);return}const O=d.bookWorkTitle.trim();if(!O){q(a.cogita.library.add.group.bookMissingWork);return}if(d.bookContributors.find(oe=>oe.contributor&&!oe.role.trim()||!oe.contributor&&oe.role.trim())){q(a.cogita.library.add.group.bookMissingContributor);return}const te=await rt({libraryId:o,infoType:"media",payload:{label:T,mediaType:"book",publisher:d.bookPublisher.trim(),publicationPlace:d.bookPublicationPlace.trim(),publicationYear:d.bookPublicationYear.trim(),pages:d.bookPages.trim(),isbn:d.bookIsbn.trim(),cover:d.bookCover.trim(),height:d.bookHeight.trim(),length:d.bookLength.trim(),width:d.bookWidth.trim(),weight:d.bookWeight.trim(),collection:d.bookCollection.trim(),location:d.bookLocation.trim()}}),G=await rt({libraryId:o,infoType:"work",payload:{label:O,languageId:((t=d.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((i=d.bookWorkOriginalLanguage)==null?void 0:i.id)??null,doi:d.bookWorkDoi.trim()}});await ga({libraryId:o,connectionType:"work-medium",infoIds:[G.infoId,te.infoId]});const de=d.bookContributors.filter(oe=>oe.contributor&&oe.role.trim());for(const oe of de)await ga({libraryId:o,connectionType:"work-contributor",infoIds:[G.infoId,oe.contributor.id],payload:{role:oe.role.trim()}});q(a.cogita.library.add.group.savedBook),re(oe=>({...oe,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!d.languageA||!d.wordA||!d.languageB||!d.wordB){q(a.cogita.library.add.group.selectBoth);return}const h=T=>Array.from(new Map(T.map(O=>[O.id,O])).values());Ie||await ga({libraryId:o,connectionType:"word-language",infoIds:[d.languageA.id,d.wordA.id]}),Pe||await ga({libraryId:o,connectionType:"word-language",infoIds:[d.languageB.id,d.wordB.id]});for(const T of h(d.wordATags))await ga({libraryId:o,connectionType:"word-topic",infoIds:[d.wordA.id,T.id]});for(const T of h(d.wordBTags))await ga({libraryId:o,connectionType:"word-topic",infoIds:[d.wordB.id,T.id]});await ga({libraryId:o,connectionType:"translation",infoIds:[d.wordA.id,d.wordB.id],payload:{tagIds:h(d.translationTags).map(T=>T.id)}}),q(a.cogita.library.add.group.savedVocab),re(T=>({...T,groupType:d.groupType,languageA:d.languageA,wordA:null,languageB:d.languageB,wordB:null,wordATags:d.wordATags,wordBTags:d.wordBTags,translationTags:d.translationTags})),requestAnimationFrame(()=>{var T;return(T=Ye.current)==null?void 0:T.focus()})}catch{q(a.cogita.library.add.group.failed)}},Q=d.groupType==="citation"?a.cogita.library.add.group.saveCitation:d.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:W,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${W}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":_===t,onClick:()=>{p||z(t)},disabled:p&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[_==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:s.infoType,onChange:t=>{p||m(i=>({...i,infoType:t.target.value}))},disabled:p,children:He.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.infoType!=="quote"&&s.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:s.label,onChange:t=>m(i=>({...i,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(s.infoType==="word"||s.infoType==="sentence"||s.infoType==="quote")&&e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:s.language,onChange:t=>m(i=>({...i,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),s.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:s.workLanguage,onChange:t=>m(i=>({...i,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:s.workOriginalLanguage,onChange:t=>m(i=>({...i,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:s.workDoi,onChange:t=>m(i=>({...i,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),s.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:s.mediaType,onChange:t=>m(i=>({...i,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:s.mediaPublisher,onChange:t=>m(i=>({...i,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationPlace,onChange:t=>m(i=>({...i,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationYear,onChange:t=>m(i=>({...i,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:s.mediaPages,onChange:t=>m(i=>({...i,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:s.mediaIsbn,onChange:t=>m(i=>({...i,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:s.mediaCover,onChange:t=>m(i=>({...i,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:s.mediaHeight,onChange:t=>m(i=>({...i,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:s.mediaLength,onChange:t=>m(i=>({...i,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:s.mediaWidth,onChange:t=>m(i=>({...i,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:s.mediaWeight,onChange:t=>m(i=>({...i,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:s.mediaCollection,onChange:t=>m(i=>({...i,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:s.mediaLocation,onChange:t=>m(i=>({...i,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),s.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:s.quoteText,onChange:t=>m(i=>({...i,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),s.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:s.sourceKind,onChange:t=>{const i=t.target.value,h=i==="book"||i==="media"?"media":i==="bible"||i==="number_document"||i==="work"?"work":s.sourceResourceType;m(T=>({...T,sourceKind:i,sourceResourceType:h,sourceResource:null,sourceLocatorValue:i==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:i==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:i==="bible"?T.sourceBibleBookDisplay:""}))},children:R.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:s.sourceBibleBookDisplay,onChange:t=>{const i=t.target.value;m(h=>({...h,sourceBibleBookDisplay:i,sourceLocatorValue:""})),ue("source"),ge(-1)},onKeyDown:t=>{const i=pe(s.sourceBibleBookDisplay);if(i.length){if(t.key==="ArrowDown")t.preventDefault(),ge(h=>Math.min(h+1,i.length-1));else if(t.key==="ArrowUp")t.preventDefault(),ge(h=>Math.max(h-1,0));else if((t.key==="Enter"||t.key==="Tab")&&me>=0&&i[me]){const h=i[me],T=$e(h.label,A);if(!T)return;m(O=>{var ae;return{...O,sourceBibleBookDisplay:h.label,sourceLocatorValue:((ae=T.la)==null?void 0:ae.abbr)??O.sourceLocatorValue}}),ue(null)}}},onFocus:()=>ue("source"),onBlur:()=>window.setTimeout(()=>ue(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),U==="source"&&pe(s.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:pe(s.sourceBibleBookDisplay,!0).map((t,i)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":i===me,tabIndex:-1,onMouseDown:()=>{const h=$e(t.label,A);h&&m(T=>{var O;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((O=h.la)==null?void 0:O.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorAux,onChange:t=>m(i=>({...i,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),s.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:s.sourceUrl,onChange:t=>m(i=>({...i,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:s.sourceAccessedDate,onChange:t=>m(i=>({...i,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorValue,onChange:t=>m(i=>({...i,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),s.sourceKind!=="string"&&s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:s.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(s.sourceKind),onChange:t=>m(i=>({...i,sourceResourceType:t.target.value,sourceResource:null})),children:Ae.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:o,infoType:s.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:s.sourceResource,onChange:t=>m(i=>({...i,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,s.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),s.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:s.notes,onChange:t=>m(i=>({...i,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,s.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:f,onChange:t=>he(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(rn,{copy:a,value:V,onChange:t=>v(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:_e,children:a.cogita.library.add.info.computedPreview})}),D&&ne==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(At,{value:D.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(D.answers).map(([t,i])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(br,{value:i,mode:"auto"})]},t))}),D.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(At,{value:D.answerText,mode:"auto"})]}):null]}):ne==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.referenceEnabled,onChange:t=>m(i=>({...i,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),s.referenceEnabled&&e.jsx(Ar,{libraryId:o,copy:a,language:A,sourceKindOptions:R,labels:X,value:{sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},onChange:t=>m(i=>({...i,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:Ue,disabled:Ne==="saving"||Ne==="loading",children:p?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,_==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:K.connectionType,onChange:t=>le(i=>({...i,connectionType:t.target.value})),children:sa.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),K.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>le(i=>({...i,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:K.word,onChange:t=>le(i=>({...i,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),ie&&e.jsx("p",{className:"cogita-help",children:ie})]}),K.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:K.word,onChange:t=>le(i=>({...i,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:K.topic,onChange:t=>le(i=>({...i,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:K.wordA,onChange:t=>le(i=>({...i,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:K.wordB,onChange:t=>le(i=>({...i,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:K.quote,onChange:t=>le(i=>({...i,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>le(i=>({...i,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>le(i=>({...i,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:K.sentence,onChange:t=>le(i=>({...i,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:K.referencedInfoType,onChange:t=>le(i=>({...i,referencedInfoType:t.target.value,referencedInfo:null})),children:He.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:o,infoType:K.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:K.referencedInfo,onChange:t=>le(i=>({...i,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:K.source,onChange:t=>le(i=>({...i,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:K.source,onChange:t=>le(i=>({...i,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:K.sourceResourceType,onChange:t=>le(i=>({...i,sourceResourceType:t.target.value,sourceResource:null})),children:Ae.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:o,infoType:K.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:K.sourceResource,onChange:t=>le(i=>({...i,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:K.work,onChange:t=>le(i=>({...i,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:K.contributorType,onChange:t=>le(i=>({...i,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ze(a,t)},t))})]}),e.jsx(ze,{libraryId:o,infoType:K.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:K.contributor,onChange:t=>le(i=>({...i,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:K.contributorRole,onChange:t=>le(i=>({...i,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),K.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:K.work,onChange:t=>le(i=>({...i,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:K.medium,onChange:t=>le(i=>({...i,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:K.orcidEntityType,onChange:t=>le(i=>({...i,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ze(a,t)},t))})]}),e.jsx(ze,{libraryId:o,infoType:K.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:K.orcidEntity,onChange:t=>le(i=>({...i,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(ze,{libraryId:o,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:K.orcid,onChange:t=>le(i=>({...i,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:K.note,onChange:t=>le(i=>({...i,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:j,children:a.cogita.library.add.connection.save})})]}):null,_==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:d.groupType,onChange:t=>re(i=>({...i,groupType:t.target.value})),children:ra.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:d.citationLanguage,onChange:t=>re(i=>({...i,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:d.citationTitle,onChange:t=>re(i=>({...i,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:d.citationQuoteText,onChange:t=>re(i=>({...i,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:d.citationReferenceEnabled,onChange:t=>re(i=>({...i,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),d.citationReferenceEnabled&&e.jsx(Ar,{libraryId:o,copy:a,language:A,sourceKindOptions:R,labels:X,value:{sourceKind:d.citationSourceKind,locatorValue:d.citationLocatorValue,locatorAux:d.citationLocatorAux,bibleBookDisplay:d.citationBibleBookDisplay,sourceUrl:d.citationSourceUrl,sourceAccessedDate:d.citationSourceAccessedDate,churchDocument:d.citationChurchDocument,bookMedia:d.citationBookMedia,work:d.citationWork},onChange:t=>re(i=>({...i,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),d.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:d.bookTitle,onChange:t=>re(i=>({...i,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:d.bookPublisher,onChange:t=>re(i=>({...i,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:d.bookPublicationPlace,onChange:t=>re(i=>({...i,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:d.bookPublicationYear,onChange:t=>re(i=>({...i,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:d.bookPages,onChange:t=>re(i=>({...i,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:d.bookIsbn,onChange:t=>re(i=>({...i,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:d.bookCover,onChange:t=>re(i=>({...i,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:d.bookHeight,onChange:t=>re(i=>({...i,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:d.bookLength,onChange:t=>re(i=>({...i,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:d.bookWidth,onChange:t=>re(i=>({...i,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:d.bookWeight,onChange:t=>re(i=>({...i,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:d.bookCollection,onChange:t=>re(i=>({...i,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:d.bookLocation,onChange:t=>re(i=>({...i,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:d.bookWorkTitle,onChange:t=>re(i=>({...i,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:d.bookWorkLanguage,onChange:t=>re(i=>({...i,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:d.bookWorkOriginalLanguage,onChange:t=>re(i=>({...i,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:d.bookWorkDoi,onChange:t=>re(i=>({...i,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>re(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),d.bookContributors.map((t,i)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((O,ae)=>ae===i?{...O,contributorType:h.target.value,contributor:null}:O)})),children:["person","institution","collective"].map(h=>e.jsx("option",{value:h,children:Ze(a,h)},h))})]}),e.jsx(ze,{libraryId:o,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((O,ae)=>ae===i?{...O,contributor:h}:O)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((O,ae)=>ae===i?{...O,role:h.target.value}:O)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>re(h=>{const T=h.bookContributors.filter((O,ae)=>ae!==i);return T.length===0?{...h,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...h,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${i}`))]}),d.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:d.languageA,onChange:t=>re(i=>({...i,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:d.languageB,onChange:t=>re(i=>({...i,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:d.wordA,onChange:t=>re(i=>({...i,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Ye,autoAdvance:!0,onCommit:()=>{var t;return(t=Oe.current)==null?void 0:t.focus()}}),e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:d.wordB,onChange:t=>re(i=>({...i,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Oe,autoAdvance:!0,onCommit:()=>{var t;return(t=Ee.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:d.translationTags,onChangeMultiple:t=>re(i=>({...i,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:d.wordATags,onChangeMultiple:t=>re(i=>({...i,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:d.wordBTags,onChangeMultiple:t=>re(i=>({...i,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),d.groupType==="vocab"&&Ie&&e.jsx("p",{className:"cogita-help",children:Ie}),d.groupType==="vocab"&&Pe&&e.jsx("p",{className:"cogita-help",children:Pe}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:k,ref:Ee,children:Q})})]}):null,ee?e.jsx("p",{className:"cogita-form-error",children:ee}):null]})})})})})]})})}const Fr=a=>/\s/.test(a),Dt=a=>/[\p{L}\p{N}]/u.test(a),Br=(a,n)=>{const l=n>0?a[n-1]:"",u=n<a.length?a[n]:"";if(!l||!u)return 0;const g=Fr(l),w=Fr(u);if(g||w)return 3;const x=Dt(l),N=Dt(u);return x!==N?2:!x&&!N?1:0},ir=(a,n,l,u,g)=>{const w=Math.max(u-n,l-u);for(let x=0;x<=w;x+=1){const N=u-x;if(N>=n&&N<=l&&Br(a,N)>=g)return N;const A=u+x;if(A>=n&&A<=l&&Br(a,A)>=g)return A}return null},nr=(a,n)=>{const l=n>0?a[n-1]:"",u=n<a.length?a[n]:"";return!l||!u?!0:Dt(l)!==Dt(u)},on=(a,n,l,u)=>{const g=l-n,w=n+u,x=l-u;if(g<=u*2||x<=w)return null;const N=Math.floor((n+l)/2),A=ir(a,w,x,N,3);if(A!==null&&nr(a,A))return A;const L=ir(a,w,x,N,2);if(L!==null&&nr(a,L))return L;const o=ir(a,w,x,N,1);return o!==null&&nr(a,o)?o:null},pt=(a,n)=>{const l=Math.max(1,7),u=Math.max(l,13),g={},w=(A,L,o,C,b)=>{const p=String(C),W={id:p,start:A,end:L,text:a.slice(A,L),depth:o,index:C,parentId:b};if(g[p]=W,L-A>u){let z=on(a,A,L,l);if(z!==null&&z>A&&z<L){const s=w(A,z,o+1,C*2+1,p),m=w(z,L,o+1,C*2+2,p);W.leftId=s.id,W.rightId=m.id}}return W},x=w(0,a.length,0,0),N=Object.values(g).sort((A,L)=>L.depth-A.depth||A.start-L.start).map(A=>A.id);return{text:a,rootId:x.id,nodes:g,order:N}},bt=(a,n,l,u,g,w,x)=>{const N=w==="reverse"?a.order.slice().sort((A,L)=>a.nodes[L].start-a.nodes[A].start||a.nodes[L].depth-a.nodes[A].depth):a.order;for(const A of N){if(x&&A===x||n.has(A))continue;const L=a.nodes[A];if(L){if(g&&(L.leftId||L.rightId)){const o=L.leftId?l[L.leftId]??0:u,C=L.rightId?l[L.rightId]??0:u;if((o+C)/2<u)continue}return L}}return null},Zr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function ln({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const C=`/#/cogita/library/${o}`,[b,p,W]=Or([]),[_,z,s]=_r([]),[m,f]=r.useState(null),[he,V]=r.useState(null),[v,D]=r.useState(null),[F,ne]=r.useState(null),P=r.useMemo(()=>b.find(d=>d.id===m)??null,[b,m]);r.useEffect(()=>{let d=!0;return pi({libraryId:o}).then(re=>{if(!d)return;const ee=re.nodes.map(q=>{var Ne,se,ie;return{id:q.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:q.payload&&typeof q.payload=="object"&&"label"in q.payload?String(q.payload.label):"Item",nodeType:q.nodeType,itemType:((Ne=q.payload)==null?void 0:Ne.itemType)??"info",itemId:((se=q.payload)==null?void 0:se.itemId)??null,infoType:((ie=q.payload)==null?void 0:ie.infoType)??null}}});p(ee),z(re.edges.map(q=>({id:q.edgeId,source:q.fromNodeId,target:q.toNodeId})))}).catch(()=>{d&&(p([]),z([]))}),()=>{d=!1}},[o]),r.useEffect(()=>{fi({libraryId:o}).then(V).catch(()=>V(null))},[o,b,_]);const U=r.useCallback(d=>{z(re=>$t(d,re))},[]),ue=()=>{const d=crypto.randomUUID();p(re=>[...re,{id:d,type:"default",position:{x:140+re.length*40,y:120+re.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},me=()=>{const d=crypto.randomUUID();p(re=>[...re,{id:d,type:"default",position:{x:180+re.length*40,y:160+re.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ge=async()=>{D(null);try{const d=b.map(ee=>({nodeId:ee.id,nodeType:ee.data.nodeType,payload:{itemType:ee.data.itemType,itemId:ee.data.itemId??null,label:ee.data.label,infoType:ee.data.infoType??null}})),re=_.map(ee=>({edgeId:ee.id,fromNodeId:ee.source,toNodeId:ee.target}));await xi({libraryId:o,nodes:d,edges:re}),D(a.cogita.library.graph.saveSuccess)}catch{D(a.cogita.library.graph.saveFail)}},K=d=>{P&&p(re=>re.map(ee=>ee.id===P.id?{...ee,data:{...ee.data,itemId:(d==null?void 0:d.infoId)??null,itemType:"collection",infoType:"collection",label:(d==null?void 0:d.label)??a.cogita.library.infoTypes.collection}}:ee))},le=d=>{P&&p(re=>re.map(ee=>ee.id===P.id?{...ee,data:{...ee.data,itemId:(d==null?void 0:d.infoId)??null,itemType:"info",infoType:(d==null?void 0:d.infoType)??null,label:(d==null?void 0:d.label)??a.cogita.library.infoTypes.any}}:ee))};return r.useEffect(()=>{if(!P||P.data.nodeType!=="info"||P.data.infoType!=="quote"||!P.data.itemId){ne(null);return}let d=!0;return it({libraryId:o,infoId:P.data.itemId}).then(re=>{if(!d)return;const ee=re.payload,q=(ee==null?void 0:ee.text)??"";if(!q){ne(null);return}const Ne=pt(q),se=Object.values(Ne.nodes).sort((ie,Le)=>ie.depth-Le.depth||ie.start-Le.start).map(ie=>({id:ie.id,text:ie.text,depth:ie.depth}));ne({title:(ee==null?void 0:ee.title)??P.data.label,fragments:se})}).catch(()=>ne(null)),()=>{d=!1}},[o,P]),e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:C,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ge,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ue,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:me,children:a.cogita.library.actions.addInfo}),he?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(he.totalCollections))})}):null,v?e.jsx("p",{className:"cogita-help",children:v}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodes:b,edges:_,onNodesChange:W,onEdgesChange:s,onConnect:U,onNodeClick:(d,re)=>f(re.id),fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),P?e.jsxs("div",{className:"cogita-graph-inspector",children:[P.data.nodeType==="collection"?e.jsx(ze,{libraryId:o,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:P.data.itemId?{id:P.data.itemId,label:P.data.label,infoType:"collection"}:null,onChange:K,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(ze,{libraryId:o,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:P.data.itemId?{id:P.data.itemId,label:P.data.label,infoType:P.data.infoType??void 0}:null,onChange:le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),F?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:F.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:F.fragments.map(d=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:d.id}),e.jsx("span",{children:d.text})]},d.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function sn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:C}){const{libraryName:b}=_a(o),[p,W]=r.useState([]),[_,z]=r.useState("loading"),[s,m]=r.useState("idle"),f=r.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),he=`/#/cogita/library/${o}`,V=()=>{z("loading"),Jr({libraryId:o}).then(F=>{W(F),z("idle")}).catch(()=>{W([]),z("error")})};r.useEffect(()=>{V()},[o]);const v=async F=>{try{await Yr({libraryId:o,shareId:F}),V()}catch{V()}},D=async F=>{const ne=`${f}/${F}`;try{await navigator.clipboard.writeText(ne),m("copied")}catch{m("failed")}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:he,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${he}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[_==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):_==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):p.filter(F=>!C||F.collectionId===C).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:p.filter(F=>!C||F.collectionId===C).map(F=>e.jsxs("div",{className:"cogita-share-row","data-state":F.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:F.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(F.createdUtc).toLocaleString(),F.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),F.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${f}/${F.shareCode}`}):null]}),F.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[F.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>D(F.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>v(F.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},F.shareId))}),s==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):s==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function cn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:C}=_a(o),[b,p]=r.useState(null),[W,_]=r.useState(null),[z,s]=r.useState(null),[m,f]=r.useState(null),[he,V]=r.useState(null),[v,D]=r.useState(null),F=r.useRef(null),ne=ue=>{if(!Number.isFinite(ue))return"0 B";if(ue<1024)return`${ue} B`;const me=ue/1024;if(me<1024)return`${me.toFixed(1)} KB`;const ge=me/1024;return ge<1024?`${ge.toFixed(1)} MB`:`${(ge/1024).toFixed(1)} GB`},P=async()=>{p(null),V({loadedBytes:0,totalBytes:null,percent:null});try{p(a.cogita.library.overview.exporting);const ue=await yi(o,V),me=URL.createObjectURL(ue),ge=document.createElement("a");ge.href=me,ge.download=`cogita-library-${C||o}.json`,ge.click(),URL.revokeObjectURL(me),p(a.cogita.library.overview.exportReady)}catch{p(a.cogita.library.overview.exportFail)}finally{V(ue=>ue??{loadedBytes:0,totalBytes:null,percent:null})}},U=async ue=>{var ge;_(null),s(null),f(null);const me=(ge=ue.target.files)==null?void 0:ge[0];if(me)try{_(a.cogita.library.overview.importing),D({loadedBytes:0,totalBytes:me.size,percent:0});const K=await vi(o,me,D,le=>{const d=le.stage==="infos"?a.cogita.library.overview.importStageInfos:le.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;f(a.cogita.library.overview.importLiveProgress.replace("{stage}",d).replace("{done}",String(le.processed)).replace("{total}",String(le.total)).replace("{infos}",String(le.infos)).replace("{connections}",String(le.connections)).replace("{collections}",String(le.collections)))});s({infos:K.infosImported,connections:K.connectionsImported,collections:K.collectionsImported}),_(a.cogita.library.overview.importDone)}catch(K){const le=K instanceof ji&&K.message?` ${K.message}`:"";_(`${a.cogita.library.overview.importFail}${le}`)}finally{F.current&&(F.current.value="")}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:P,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:F,type:"file",accept:"application/json",onChange:U})]})]}),he?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:he.percent??void 0,max:he.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ne(he.loadedBytes)).replace("{total}",he.totalBytes?ne(he.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,v?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:v.percent??void 0,max:v.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ne(v.loadedBytes)).replace("{total}",v.totalBytes?ne(v.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null,W?e.jsx("p",{className:"cogita-help",children:W}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null,z?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(z.infos)).replace("{connections}",String(z.connections)).replace("{collections}",String(z.collections))}):null]})]})})})]})})}function dn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:C}=_a(o),[b,p]=r.useState(""),[W,_]=r.useState([]),z=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:b,onChange:s=>p(s.target.value),placeholder:a.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=b.trim();s&&(_(m=>[{id:z(),name:s},...m]),p(""))},children:a.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[W.length===0?e.jsx("p",{children:a.cogita.library.modules.storyboardsEmpty}):null,W.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function un({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:C}=_a(o),[b,p]=r.useState(""),[W,_]=r.useState([]),z=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:b,onChange:s=>p(s.target.value),placeholder:a.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=b.trim();s&&(_(m=>[{id:z(),name:s},...m]),p(""))},children:a.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[W.length===0?e.jsx("p",{children:a.cogita.library.modules.textsEmpty}):null,W.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function Dr({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:C}=_a(o),b=`/#/cogita/library/${o}`,[p,W]=r.useState(""),[_,z]=r.useState([]),[s,m]=r.useState("idle"),[f,he]=r.useState(0),[V,v]=r.useState(null);r.useEffect(()=>{m("loading");const F=window.setTimeout(()=>{wt({libraryId:o,query:p.trim()||void 0,limit:30}).then(ne=>{z(ne.items),he(ne.total),v(ne.nextCursor??null),m("ready")}).catch(()=>{z([]),he(0),v(null),m("ready")})},240);return()=>window.clearTimeout(F)},[o,p]);const D=async()=>{if(V){m("loading");try{const F=await wt({libraryId:o,query:p.trim()||void 0,limit:30,cursor:V});z(ne=>[...ne,...F.items]),v(F.nextCursor??null),he(F.total),m("ready")}catch{m("ready")}}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:b,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${b}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:p,onChange:F=>W(F.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(_.length)).replace("{total}",String(f||_.length))}),e.jsx("span",{children:s==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:_.length?_.map(F=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${b}/collections/${F.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:F.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(F.itemCount))," ·"," ",F.notes||a.cogita.library.collections.noNotes]})]})},F.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${b}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),V?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:D,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}function gn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:C}){_a(o);const b=`/#/cogita/library/${o}`,[p,W]=r.useState(a.cogita.library.collections.defaultName),[_,z]=r.useState(null),[s,m]=r.useState(0),[f,he]=r.useState([]),[V,v]=r.useState("idle"),[D,F]=r.useState(null),ne=r.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(s||f.length)),[a,f.length,s]);r.useEffect(()=>{zt(o,C).then(U=>{W(U.name),z(U.notes??null),m(U.itemCount)}).catch(()=>{W(a.cogita.library.collections.defaultName),z(null)})},[o,C]),r.useEffect(()=>{v("loading"),Ft({libraryId:o,collectionId:C,limit:40}).then(U=>{he(U.items),F(U.nextCursor??null),m(U.total),v("ready")}).catch(()=>{he([]),F(null),v("ready")})},[o,C]);const P=async()=>{if(D){v("loading");try{const U=await Ft({libraryId:o,collectionId:C,limit:40,cursor:D});he(ue=>[...ue,...U.items]),F(U.nextCursor??null),m(U.total),v("ready")}catch{v("ready")}}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:p}),e.jsx("p",{className:"cogita-library-subtitle",children:_||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:b,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${b}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${b}/collections/${C}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${b}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ne}),e.jsx("span",{children:V==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:f.length?f.map(U=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:U.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:U.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:U.label}),e.jsx("p",{className:"cogita-card-subtitle",children:U.description})]})},fe(U))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),D?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:P,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${b}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Va=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,l=a.filter(w=>w.correct).length,u=Ht(kr(a));return{score:Math.round(Math.max(0,Math.min(100,u.knowness*100))*100)/100,total:n,correct:l,lastReviewedUtc:u.lastReviewedUtc??null}},hn=a=>{if(a.maskBase64)try{const n=wi(a.maskBase64);if(!n.length)return a.correct?1:0;const l=n.reduce((u,g)=>u+g,0);return Math.max(0,Math.min(1,l/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},kr=a=>a.map(n=>({correctness:hn(n),createdUtc:n.createdUtc})),Ht=(a,n=Date.now())=>{var s;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const u=a.slice().sort((m,f)=>m.createdUtc.localeCompare(f.createdUtc)).slice(-5),g=u.reduce((m,f)=>m+f.correctness,0)/u.length,w=5,x=2,N=.15;let A=0,L=0;for(let m=0;m<u.length;m+=1){const f=new Date(u[m].createdUtc).getTime(),he=m===u.length-1?n:new Date(u[m+1].createdUtc).getTime(),V=Math.max(0,(he-f)/(1e3*60)),v=1-Math.exp(-V/w);A+=v,u[m].correctness>.5&&(L+=N)}let o=g*A*x+L;const C=((s=u[u.length-1])==null?void 0:s.createdUtc)??null,b=C?Math.max(0,(n-new Date(C).getTime())/(1e3*60)):0,W=1/(1+Math.log1p(b/60));return o*=W,u.length===1&&u[0].correctness>.5&&(o+=5.44*Math.exp(-b/2)),{knowness:o,avgCorrectness:g,lastReviewedUtc:C}},kt=a=>{const n=a.slice();for(let l=n.length-1;l>0;l-=1){const u=Math.floor(Math.random()*(l+1));[n[l],n[u]]=[n[u],n[l]]}return n},Rt=a=>a[Math.floor(Math.random()*a.length)],bn=(a,n)=>{const l=new Map;return a.forEach(u=>l.set(u,Math.random())),a.sort((u,g)=>{const w=n(u)-n(g);return w!==0?w:(l.get(u)??0)-(l.get(g)??0)})},Jt=(a,n,l,u,g)=>{if(!a.length)return null;const w=a.filter(N=>!(g!=null&&g.has(fe(N))));if(w.length===0)return null;const x=w.filter(N=>fe(N)!==l);return Rt(x.length?x:w)},mn=(a,n,l,u,g)=>{if(!a.length)return null;let w=Number.POSITIVE_INFINITY;for(const L of a){const o=fe(L);if(l.has(o))continue;const C=n[o]??1;C<w&&(w=C)}if(!Number.isFinite(w))return null;const x=a.filter(L=>{const o=fe(L);return!l.has(o)&&(n[o]??1)===w}),N=x.filter(L=>!g||fe(L)!==g),A=u?N.filter(L=>!u.has(fe(L))):N;return A.length>0?Rt(A):N.length>0?Rt(N):g&&x.some(L=>fe(L)===g)?x.find(L=>fe(L)===g)??null:x.length?Rt(x):null},ei=(a,n,l,u,g)=>{const w=[],x=a.filter(A=>!g.has(fe(A))&&!l.has(fe(A))&&(n[fe(A)]??0)<1),N=bn(x,A=>n[fe(A)]??0);for(const A of N){if(w.length>=u)break;w.push(A),g.add(fe(A))}if(w.length<u){const A=kt(a.filter(L=>!g.has(fe(L))&&l.has(fe(L))));for(const L of A){if(w.length>=u)break;w.push(L),g.add(fe(L))}}return w},pn=(a,n,l,u)=>ei(a,n,l,u,new Set),Tr=(a,n,l,u,g,w)=>{const x=Math.max(1,l.stackSize??n),A=kt(a).filter((W,_,z)=>z.findIndex(s=>fe(s)===fe(W))===_),L=pn(A,u,g,x),o=new Set,C=new Set,b=Jt(L,{},null,o,C),p=b?[b]:[];return b&&C.add(fe(b)),{queue:p,meta:{pool:A,active:L,knownessMap:u,unknownSet:g,outcomesById:w,asked:o,queued:C}}},mr={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const u=kt(a).filter((g,w,x)=>x.findIndex(N=>fe(N)===fe(g))===w);return{queue:u.slice(0,Math.min(n,u.length)),meta:{}}},applyOutcome:a=>a},Nr=(a,n,l,u)=>{const g=Math.max(1,l.stackSize??n),x=kt(a).filter((_,z,s)=>s.findIndex(m=>fe(m)===fe(_))===z),N={},A=new Set,L=new Set,o=new Set,C=Math.max(1,l.levels??1);x.forEach(_=>{const z=fe(_),s=u==null?void 0:u[z],m=typeof s=="number"&&Number.isFinite(s)?s:1;N[z]=Math.min(C,Math.max(1,Math.round(m)))});const b=[];if(x.length>0){const _=new Map;x.forEach(s=>{var f;const m=N[fe(s)]??1;_.has(m)||_.set(m,[]),(f=_.get(m))==null||f.push(s)});const z=Array.from(_.keys()).sort((s,m)=>s-m);for(const s of z){if(b.length>=g)break;const m=kt(_.get(s)??[]);for(const f of m){if(b.length>=g)break;b.push(f)}}}const p=Jt(b,N,null,A,L),W=p?[p]:[];return p&&L.add(fe(p)),{queue:W,meta:{pool:x,active:b,levelMap:N,asked:A,queued:L,wrongSinceCorrect:o}}},fn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,l)=>Nr(a,n,l),applyOutcome:(a,n,l,u,g)=>{if(!n)return a;const w=Math.max(1,u.levels??1),x=a.meta.pool??[],N=a.meta.active??[],A={...a.meta.levelMap??{}},L=new Set(a.meta.asked??[]),o=new Set(a.meta.queued??[]),C=new Set(a.meta.wrongSinceCorrect??[]),b=fe(n);o.delete(b),L.add(b);const p=A[b]??1;g.correct?(A[b]=C.has(b)?1:Math.min(p+1,w),C.delete(b)):(A[b]=1,C.add(b));const W=g.correct?N.filter(s=>fe(s)!==b):N.slice();if(g.correct&&W.length<Math.max(1,u.stackSize??1)){const s=new Set(W.map(f=>fe(f))),m=mn(x,A,s,L,b);m&&W.push(m)}const _=a.queue.slice(),z=Jt(W,A,b,L,o);return z&&(_.push(z),o.add(fe(z))),{queue:_,meta:{pool:x,active:W,levelMap:A,asked:L,queued:o,wrongSinceCorrect:C}}}},xn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,l)=>Tr(a,n,l,{},new Set,{}),applyOutcome:(a,n,l,u,g)=>{if(!n)return a;const w=a.meta.pool??[],x=a.meta.active??[],N={...a.meta.knownessMap??{}},A=new Set(a.meta.unknownSet??[]),L={...a.meta.outcomesById??{}},o=new Set(a.meta.asked??[]),C=new Set(a.meta.queued??[]),b=fe(n);C.delete(b),o.add(b);const p={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},_=(L[b]??[]).concat(p).sort((V,v)=>V.createdUtc.localeCompare(v.createdUtc)).slice(-5);L[b]=_,A.delete(b);const z=Date.now();w.forEach(V=>{const v=fe(V),D=L[v]??[];if(D.length===0){N[v]=0,A.add(v);return}const F=Ht(D,z);N[v]=F.knowness});const s=x.slice();if((N[b]??0)>=1){const V=s.filter(v=>fe(v)!==b);s.length=0,s.push(...V)}const f=Math.max(1,u.stackSize??l);if(s.length<f){const V=new Set(s.map(D=>fe(D))),v=ei(w,N,A,f-s.length,V);s.push(...v)}const he=a.queue.slice();if(he.length===0||fe(he[he.length-1])===b){const V=Jt(s,{},b,o,C);V&&(he.push(V),C.add(fe(V)))}return{queue:he,meta:{pool:w,active:s,knownessMap:N,unknownSet:A,outcomesById:L,asked:o,queued:C}}}},ai={random:mr,levels:fn,temporal:xn},yn=Object.values(ai),Lr=a=>{if(!a)return mr;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?ai[n]:mr},Yt=(a,n)=>{const l={...a.defaultSettings};return n&&Object.entries(n).forEach(([u,g])=>{typeof g=="number"&&Number.isFinite(g)&&(l[u]=g),typeof g=="string"&&(l[u]=g)}),a.settingsFields.forEach(u=>{var w;const g=l[u.key];if(u.type==="number"){if(typeof g!="number"||Number.isNaN(g)){l[u.key]=a.defaultSettings[u.key]??0;return}u.min!==void 0&&(l[u.key]=Math.max(u.min,l[u.key])),u.max!==void 0&&(l[u.key]=Math.min(u.max,l[u.key]));return}if(u.type==="select"){const x=((w=u.options)==null?void 0:w.map(N=>N.value))??[];(typeof g!="string"||x.length>0&&!x.includes(g))&&(l[u.key]=a.defaultSettings[u.key]??x[0]??"")}}),l},ti=(a,n)=>{const l={};return a.settingsFields.forEach(u=>{const g=n.get(u.key);if(g){if(u.type==="number"){const w=Number(g);Number.isNaN(w)||(l[u.key]=w);return}l[u.key]=g}}),Yt(a,l)},vn=(a,n)=>{const l=new URLSearchParams;return a.settingsFields.forEach(u=>{const g=n[u.key];(typeof g=="number"||typeof g=="string")&&l.set(u.key,String(g))}),l};function jn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:C,revisionId:b}){const{libraryName:p}=_a(o),W=`/#/cogita/library/${o}`,[_,z]=r.useState(a.cogita.library.collections.defaultName),[s,m]=r.useState(""),[f,he]=r.useState(20),[V,v]=r.useState("random"),[D,F]=r.useState({}),[ne,P]=r.useState("exact"),[U,ue]=r.useState([]),[me,ge]=r.useState(null),[K,le]=r.useState([]),[d,re]=r.useState("idle"),[ee,q]=r.useState(null),[Ne,se]=r.useState("idle"),[ie,Le]=r.useState("idle"),[Ie,Ce]=r.useState("idle"),Pe=r.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ke=r.useMemo(()=>Lr(V),[V]),Ye=r.useMemo(()=>Yt(ke,D),[ke,D]),Oe=r.useMemo(()=>vn(ke,Ye).toString(),[ke,Ye]);r.useEffect(()=>{zt(o,C).then(X=>z(X.name)).catch(()=>z(a.cogita.library.collections.defaultName))},[o,C]),r.useEffect(()=>{b&&ki({libraryId:o,collectionId:C,revisionId:b}).then(X=>{m(X.name),v(X.mode||"random"),P(X.check||"exact"),he(X.limit||20),F(X.revisionSettings??{})}).catch(()=>{m("")})},[C,o,b]),r.useEffect(()=>{Ti({libraryId:o}).then(X=>{ue(X),!me&&X.length>0&&ge(X[0].roleId)}).catch(()=>{ue([])})},[o]);const Ee=()=>{Le("loading"),Jr({libraryId:o}).then(X=>{le(X),Le("idle")}).catch(()=>{le([]),Le("error")})};r.useEffect(()=>{Ee()},[o]);const He=async()=>{re("working"),se("idle");try{const X=await Li({libraryId:o,collectionId:C,revisionType:ke.id,revisionSettings:Ye,mode:V,check:ne,limit:f});q(`${Pe}/${X.shareCode}${Oe?`?${Oe}`:""}`),re("ready"),Ee()}catch{re("error")}},sa=async()=>{if(b){Ce("saving");try{await Ni({libraryId:o,collectionId:C,revisionId:b,name:s||_,revisionType:ke.id,revisionSettings:Ye,mode:V,check:ne,limit:f}),Ce("saved")}catch{Ce("error")}}},ra=async()=>{if(ee)try{await navigator.clipboard.writeText(ee),se("copied")}catch{se("failed")}},R=async X=>{try{await Yr({libraryId:o,shareId:X}),Ee()}catch{Ee()}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:_}),e.jsx("p",{className:"cogita-library-subtitle",children:p})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:W,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${W}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${W}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${W}/collections/${C}/revision/run?mode=${encodeURIComponent(V)}&check=${encodeURIComponent(ne)}&limit=${f}${Oe?`&${Oe}`:""}${me?`&reviewer=${encodeURIComponent(me)}`:""}${b?`&revisionId=${encodeURIComponent(b)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:s,onChange:X=>m(X.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:V,onChange:X=>v(X.target.value),children:yn.map(X=>e.jsx("option",{value:X.id,children:a.cogita.library.revision[X.labelKey]},X.id))})]}),ke.settingsFields.map(X=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[X.labelKey]}),X.type==="select"?e.jsx("select",{value:String(Ye[X.key]??""),onChange:Ae=>F(Te=>({...Te,[X.key]:Ae.target.value})),children:(X.options??[]).map(Ae=>e.jsx("option",{value:Ae.value,children:a.cogita.library.revision[Ae.labelKey]},Ae.value))}):e.jsx("input",{type:"number",min:X.min,max:X.max,step:X.step,value:Ye[X.key]??0,onChange:Ae=>F(Te=>({...Te,[X.key]:Number(Ae.target.value||0)}))})]},X.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),ke.id!=="levels"&&ke.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:f,onChange:X=>he(Number(X.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:me??"",onChange:X=>ge(X.target.value||null),children:U.map(X=>e.jsx("option",{value:X.roleId,children:X.label},X.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[b?e.jsx("button",{type:"button",className:"cta ghost",onClick:sa,disabled:Ie==="saving",children:Ie==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${W}/collections/${C}/revision/run?mode=${encodeURIComponent(V)}&check=${encodeURIComponent(ne)}&limit=${f}${Oe?`&${Oe}`:""}${me?`&reviewer=${encodeURIComponent(me)}`:""}${b?`&revisionId=${encodeURIComponent(b)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Ie==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),ee?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:ee,readOnly:!0})]}):null,d==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,Ne==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):Ne==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:He,disabled:d==="working",children:d==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),ee?e.jsx("button",{type:"button",className:"cta ghost",onClick:ra,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),ie==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):K.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:K.map(X=>e.jsxs("div",{className:"cogita-share-row","data-state":X.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:X.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(X.createdUtc).toLocaleString(),X.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),X.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>R(X.shareId),children:a.cogita.library.revision.shareRevokeAction})]},X.shareId))})]})]})]})]})})})]})})}function ri({copy:a,currentCard:n,currentTypeLabel:l,prompt:u,languages:g,answer:w,onAnswerChange:x,computedExpected:N,computedAnswers:A,onComputedAnswerChange:L,answerTemplate:o,outputVariables:C,variableValues:b,computedFieldFeedback:p,feedback:W,canAdvance:_,quoteContext:z,quotePlaceholder:s,onCheckAnswer:m,onSkip:f,onLanguageSelect:he,onMarkReviewed:V,onAdvance:v,showCorrectAnswer:D,setShowCorrectAnswer:F,onRevealCorrect:ne,answerMask:P,expectedAnswer:U,hasExpectedAnswer:ue,handleComputedKeyDown:me,answerInputRef:ge,computedInputRefs:K,scriptMode:le,setScriptMode:d,matchPairs:re,matchLeftOrder:ee,matchRightOrder:q,matchSelection:Ne,matchActiveLeft:se,matchActiveRight:ie,matchFeedback:Le,onMatchLeftSelect:Ie,onMatchRightSelect:Ce}){const Pe=r.useMemo(()=>{var Q;const R=!o&&N.length===2?`The {${N[0].key}} is of type {${N[1].key}}`:null,X=o??R;if(!X)return null;const Ae=new Map(N.map(t=>[t.key,t.expected])),Te=new Set,pe=[],$e=/\{([^}]+)\}/g;let Ue=0,Be,_e=null;for(;(Be=$e.exec(X))!==null;){const t=X.slice(Ue,Be.index);t&&pe.push({type:"text",value:t});const i=((Q=Be[1])==null?void 0:Q.trim())??"",h=i&&Ae.has(i)?i:i&&C&&C[i]?C[i]:null;i&&Te.add(i),h&&Te.add(h),h&&Ae.has(h)?(pe.push({type:"input",value:h}),_e||(_e=h)):i&&b&&b[i]!==void 0?pe.push({type:"text",value:b[i]}):pe.push({type:"text",value:Be[0]}),Ue=Be.index+Be[0].length}const j=X.slice(Ue);return j&&pe.push({type:"text",value:j}),N.filter(t=>!Te.has(t.key)).length>0?null:{parts:pe,expectedByKey:Ae,firstInputKey:_e}},[o,N,C,b]),ke=()=>{if(!Pe)return null;const{parts:R,expectedByKey:X,firstInputKey:Ae}=Pe;return e.jsx("div",{className:"cogita-revision-inline-answer",children:R.map((Te,pe)=>{var $e,Ue;return Te.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Te.value},`text-${pe}`):e.jsx("input",{ref:Be=>{K.current[Te.value]=Be},autoFocus:Te.value===Ae,value:A[Te.value]??"",onChange:Be=>L(Te.value,Be.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":p[Te.value]??(W==="correct"?"correct":W==="incorrect"?"incorrect":void 0),onKeyDown:Be=>He(Be)||me(Be),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,(($e=A[Te.value])==null?void 0:$e.length)??0,((Ue=X.get(Te.value))==null?void 0:Ue.length)??6)}ch`}},`input-${Te.value}-${pe}`)})})},Ye=r.useMemo(()=>{const R=new Map;return(re??[]).forEach(X=>R.set(X.leftId,X)),R},[re]),Oe=r.useMemo(()=>{const R=new Map;return(re??[]).forEach(X=>R.set(X.rightId,X)),R},[re]);r.useEffect(()=>{var pe;if(n.cardType!=="info"||n.infoType!=="computed"||N.length===0)return;const R=typeof document<"u"?document.activeElement:null;if(R&&(R.tagName==="INPUT"||R.tagName==="TEXTAREA"))return;const X=(Pe==null?void 0:Pe.firstInputKey)??((pe=N[0])==null?void 0:pe.key);if(!X)return;const Ae=K.current[X];if(!Ae)return;const Te=requestAnimationFrame(()=>{Ae.focus()});return()=>cancelAnimationFrame(Te)},[n,N,Pe]);const Ee=(()=>{const R=[U??"",...N.map(Te=>Te.expected??"")].join(""),X=[w,...Object.values(A)].join(""),Ae=`${R}${X}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Ae)})(),He=R=>R.ctrlKey&&(R.key==="^"||R.key==="6")?(R.preventDefault(),d(X=>X==="super"?null:"super"),!0):R.ctrlKey&&(R.key==="_"||R.key==="-")?(R.preventDefault(),d(X=>X==="sub"?null:"sub"),!0):!1,sa=()=>{if(!U||!P)return U??"";const R=U.split(""),X=Array.from(P),Ae=X.length>0?X.reduce((Te,pe)=>Te+pe,0)/X.length:127;return R.map((Te,pe)=>{const $e=X[pe]??Ae,Ue=Math.max(0,Math.min(255,Math.round($e)));let Be=255,_e=0;return Ue<=127?_e=Math.round(Ue/127*255):(_e=255,Be=Math.round(255*(1-(Ue-127)/128))),e.jsx("span",{style:{color:`rgb(${Be}, ${_e}, 0)`},children:Te},`mask-${pe}`)})},ra=n.cardType==="info"&&n.infoType==="quote"?(z==null?void 0:z.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:l}),e.jsx("strong",{children:ra})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&re?e.jsxs("div",{className:"cogita-revision-body",children:[u?e.jsx("h2",{children:u}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(ee??[]).map(R=>{const X=Ye.get(R);if(!X)return null;const Ae=(Ne==null?void 0:Ne[R])??null,Te=(Le==null?void 0:Le[R])??null,pe=se===R;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":pe,"data-state":Te??void 0,"data-locked":Ae?"true":void 0,onClick:()=>Ie==null?void 0:Ie(R),children:[e.jsx("span",{children:X.leftLabel}),Ae&&D?e.jsx("em",{children:"✓"}):null]},R)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(q??[]).map(R=>{const X=Oe.get(R);if(!X)return null;const Ae=Object.values(Ne??{}).includes(R),Te=ie===R;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Ae||Te,"data-locked":Ae?"true":void 0,onClick:()=>Ce==null?void 0:Ce(R),children:e.jsx("span",{children:X.rightLabel})},R)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ge,value:w,onChange:R=>x(R.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":W==="correct"?"correct":W==="incorrect"?"incorrect":void 0,onKeyDown:R=>{R.key==="Enter"&&(R.preventDefault(),R.stopPropagation(),_?v():m())}})]}),Ee?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":le==="super",onClick:()=>d(R=>R==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":le==="sub",onClick:()=>d(R=>R==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,o?null:e.jsx(At,{value:u??"",mode:"auto"}),N.length>0?(()=>{const R=ke();return R?e.jsx("div",{className:"cogita-inline-answer-wrap",children:R}):e.jsx("div",{className:"cogita-form-grid",children:N.map((X,Ae)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:X.key}),e.jsx("textarea",{ref:Te=>{K.current[X.key]=Te},autoFocus:Ae===0,value:A[X.key]??"",onChange:Te=>L(X.key,Te.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":p[X.key]??(W==="correct"?"correct":W==="incorrect"?"incorrect":void 0),onKeyDown:Te=>He(Te)||me(Te)})]},X.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ge,value:w,onChange:R=>x(R.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":W==="correct"?"correct":W==="incorrect"?"incorrect":void 0,onKeyDown:R=>{He(R)||R.key==="Enter"&&(R.preventDefault(),R.stopPropagation(),_?v():m())}})]})}),Ee?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":le==="super",onClick:()=>d(R=>R==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":le==="sub",onClick:()=>d(R=>R==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&z?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(z.completed)).replace("{total}",String(z.total))}),e.jsx("p",{className:"cogita-quote-text",children:z.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ge,value:w,onChange:R=>x(R.target.value),placeholder:s??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":W==="correct"?"correct":W==="incorrect"?"incorrect":void 0,onKeyDown:R=>{R.key==="Enter"&&(R.preventDefault(),R.stopPropagation(),_?v():m())}})]}),e.jsx("p",{className:"cogita-quote-text",children:z.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(R=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>he(R.label),children:R.label},R.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:V,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}),W&&e.jsx("div",{className:"cogita-revision-feedback","data-state":W,children:W==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),W==="incorrect"&&ue?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>F(R=>{const X=!R;return X&&ne(),X}),children:a.cogita.library.revision.showAnswer}),D?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),N.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[N.map(R=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:R.key}),e.jsx("span",{children:R.expected})]},R.key)),U?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:U})]}):null]}):e.jsx("p",{children:P?sa():U})]}):null]}):null,_?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:v,children:a.cogita.library.revision.nextQuestion})}):null]})}const or=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ii({outcomes:a}){const[n,l]=r.useState("day"),u=r.useMemo(()=>{const g=or.find(N=>N.id===n)??or[1],w=Date.now()-g.ms,x=a.filter(N=>new Date(N.createdUtc).getTime()>=w);return Va(x)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:or.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>l(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[u.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[u.correct," / ",u.total]})]})}const wn="cogita-revision",kn=1,Kt="outcomes",Tn=()=>new Promise((a,n)=>{const l=indexedDB.open(wn,kn);l.onupgradeneeded=()=>{const u=l.result;if(!u.objectStoreNames.contains(Kt)){const g=u.createObjectStore(Kt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},l.onerror=()=>n(l.error),l.onsuccess=()=>a(l.result)}),Nt=async(a,n)=>{const l=await Tn();return new Promise((u,g)=>{const w=l.transaction(Kt,a),x=w.objectStore(Kt);n(x).then(u).catch(g),w.onerror=()=>g(w.error)})},ni=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(l=>l.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Nn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const l=ni();return localStorage.setItem(a,l),l},Ln=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),l=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(l)),l},oi=(a,n,l,u)=>Ka(a,n,l,u),Vt=async a=>{const n=Nn(),l=Ln(),u=new Date().toISOString(),g={...a,clientId:n,clientSequence:l,createdUtc:u,id:ni(),pending:!0};return await Nt("readwrite",w=>new Promise((x,N)=>{const A={...g,itemKey:oi(g.itemType,g.itemId,g.checkType,g.direction)},L=w.add(A);L.onsuccess=()=>x(),L.onerror=()=>N(L.error)})),g},Ot=async(a,n,l,u)=>{if(!n)return[];try{const g=oi(a,n,l,u);return await Nt("readonly",w=>new Promise((x,N)=>{const L=w.index("byItem").getAll(g);L.onsuccess=()=>{const C=(L.result??[]).map(b=>({itemType:b.itemType,itemId:b.itemId,checkType:b.checkType??null,direction:b.direction??null,revisionType:b.revisionType,evalType:b.evalType,correct:b.correct,createdUtc:b.createdUtc,maskBase64:b.maskBase64,payloadBase64:b.payloadBase64,payloadHashBase64:b.payloadHashBase64,clientId:b.clientId,clientSequence:b.clientSequence,personRoleId:b.personRoleId??null})).sort((b,p)=>b.createdUtc.localeCompare(p.createdUtc));x(C)},L.onerror=()=>N(L.error)}))}catch{return[]}},Oa=async()=>{try{return await Nt("readonly",a=>new Promise((n,l)=>{const u=a.getAll();u.onsuccess=()=>{const w=(u.result??[]).map(x=>({itemType:x.itemType,itemId:x.itemId,checkType:x.checkType??null,direction:x.direction??null,revisionType:x.revisionType,evalType:x.evalType,correct:x.correct,createdUtc:x.createdUtc,maskBase64:x.maskBase64,payloadBase64:x.payloadBase64,payloadHashBase64:x.payloadHashBase64,clientId:x.clientId,clientSequence:x.clientSequence,personRoleId:x.personRoleId??null}));n(w)},u.onerror=()=>l(u.error)}))}catch{return[]}},Cn=async(a=100)=>{try{return await Nt("readonly",n=>new Promise((l,u)=>{const w=n.index("byPending").getAll(!0);w.onsuccess=()=>{const x=w.result??[];l(x.slice(0,a))},w.onerror=()=>u(w.error)}))}catch{return[]}},Mn=async a=>{if(a.length!==0)try{await Nt("readwrite",n=>new Promise((l,u)=>{let g=a.length;a.forEach(w=>{const x=n.get(w);x.onsuccess=()=>{const N=x.result;if(N){N.pending=!1;const A=n.put(N);A.onsuccess=()=>{g-=1,g===0&&l()},A.onerror=()=>u(A.error)}else g-=1,g===0&&l()},x.onerror=()=>u(x.error)})}))}catch{}},lr=async(a,n)=>{const l=await Cn(200);if(l.length===0)return;const u=new Map;l.forEach(g=>{var x;const w=g.personRoleId??n??"";u.has(w)||u.set(w,[]),(x=u.get(w))==null||x.push(g)});for(const[g,w]of u.entries()){const x=w.map(N=>({itemType:N.itemType,itemId:N.itemId,checkType:N.checkType??null,direction:N.direction??null,revisionType:N.revisionType,evalType:N.evalType,correct:N.correct,clientId:N.clientId,clientSequence:N.clientSequence,maskBase64:N.maskBase64??null,payloadHashBase64:N.payloadHashBase64??null,payloadBase64:N.payloadBase64??null,personRoleId:g||null}));try{await Ci({libraryId:a,outcomes:x}),await Mn(w.map(N=>N.id))}catch{}}},Kr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Sn=(a,n)=>{const l=Math.max(a.length,n.length,1),u=Math.abs(a.length-n.length);return Math.max(0,1-u/l)},In=(a,n)=>{const l=new Uint8Array(a.length),u=Sn(a,n);for(let g=0;g<a.length;g+=1){const w=a[g]===(n[g]??"")?128:0,x=a.length-1-g,N=n.length-1-g,A=a[x]===(n[N]??"")?127:0,L=Math.round((w+A)*u);l[g]=Math.max(0,Math.min(255,L))}return l},It=(a,n)=>a===n||(Kr[a]??[]).includes(n)?!0:(Kr[n]??[]).includes(a),_t=(a,n)=>{const l=new Uint8Array(a.length);if(!a.length)return l;const u=[];for(let w=0;w<=a.length-3;w+=1)u.push({index:w,text:a.slice(w,w+3)});let g=!1;return u.forEach(w=>{for(let x=0;x<=n.length-3;x+=1){const N=n.slice(x,x+3);let A=0;for(let p=0;p<3;p+=1)It(w.text[p],N[p])&&(A+=1);if(A<2)continue;let L=w.index-1,o=x-1;for(;L>=0&&o>=0;){const p=a[L],W=n[o];if(p===W){l[L]=Math.max(l[L],255),L-=1,o-=1,g=!0;continue}if(It(p,W)){l[L]=Math.max(l[L],127),L-=1,o-=1,g=!0;continue}if(L>0&&a[L-1]===W){l[L]=Math.max(l[L],0),L-=1,g=!0;continue}if(o>0&&a[L]===n[o-1]){o-=1,g=!0;continue}break}for(let p=0;p<3;p+=1){const W=w.index+p,_=w.text[p],z=N[p],s=_===z?255:It(_,z)?127:0;l[W]=Math.max(l[W],s),g=!0}let C=w.index+3,b=x+3;for(;C<a.length&&b<n.length;){const p=a[C],W=n[b];if(p===W){l[C]=Math.max(l[C],255),C+=1,b+=1,g=!0;continue}if(It(p,W)){l[C]=Math.max(l[C],127),C+=1,b+=1,g=!0;continue}if(C+1<a.length&&a[C+1]===W){l[C]=Math.max(l[C],0),C+=1,g=!0;continue}if(b+1<n.length&&a[C]===n[b+1]){b+=1,g=!0;continue}break}}}),g?l:In(a,n)},mt=(a,n,l)=>{const u=a.trim().toLowerCase(),g=n.trim().toLowerCase();return _t(u,g)},ft=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),li=(a,n,l)=>{const u=ft(a),g=ft(n);return _t(u,g)},wa=a=>a.trim().toLowerCase(),Pn=a=>a==="reverse"?"reverse":"forward",Tt=(a,n)=>`${a}|${n}`,Ta=a=>{if(!a)return null;const[n,l]=a.split("|",2);return(n==="forward"||n==="reverse")&&l?{mode:n,fragmentId:l}:{mode:"forward",fragmentId:a}},qt=(a,n)=>{var u;const l=Ta(n);return l?l.fragmentId&&n?(a??null)===n:(((u=Ta(a))==null?void 0:u.mode)??"forward")===l.mode:!0},pa=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},si=(a,n)=>{if((pa(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const u=pa(a.childCheckType),g=pa(a.childDirection),w=pa(n.checkType),x=pa(n.direction);return!(u&&u!==w||g&&g!==x)},Rn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},$n={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},Ut=(a,n,l)=>{if(!l||!n.startsWith(a))return n;const u=n.slice(a.length);if(!u)return n;const g=l==="super"?Rn:$n,w=u.split("").map(x=>g[x]??x).join("");return a+w},Wt=(a,n,l)=>{var x,N,A;if(!a)return((x=n[0])==null?void 0:x.key)??null;const u=new Set(n.map(L=>L.key)),g=/\{([^}]+)\}/g;let w;for(;(w=g.exec(a))!==null;){const L=((N=w[1])==null?void 0:N.trim())??"";if(!L)continue;if(u.has(L))return L;const o=l==null?void 0:l[L];if(o&&u.has(o))return o}return((A=n[0])==null?void 0:A.key)??null},pr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const l=n.description??"";if(!l.trim())return[n];const u=Ta(n.direction),g=(u==null?void 0:u.mode)??Pn(n.direction),w=pt(l),x=Object.keys(w.nodes);return x.length===0?[n]:x.map(N=>({...n,checkType:"quote-fragment",direction:Tt(g,N)}))});function En({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:C,revisionId:b}){const p=vr(),W=`/#/cogita/library/${o}`,_=r.useMemo(()=>new URLSearchParams(p.search),[p.search]),z=Math.max(1,Number(_.get("limit")??20)),s=_.get("mode")??"random",m=r.useMemo(()=>Lr(s),[s]),f=r.useMemo(()=>Yt(m,ti(m,_)),[m,_]),he=_.get("check")??"exact",V=_.get("reviewer"),v=r.useMemo(()=>a.cogita.library.revision[m.labelKey]??s,[a,s,m]),D=r.useMemo(()=>he==="exact"?a.cogita.library.revision.checkValue:he,[a,he]),[F,ne]=r.useState(a.cogita.library.collections.defaultName),[P,U]=r.useState([]),[ue,me]=r.useState([]),[ge,K]=r.useState("idle"),[le,d]=r.useState({current:0,total:0}),[re,ee]=r.useState(0),[q,Ne]=r.useState(""),[se,ie]=r.useState(null),[Le,Ie]=r.useState(null),[Ce,Pe]=r.useState(null),[ke,Ye]=r.useState(null),[Oe,Ee]=r.useState([]),[He,sa]=r.useState({}),[ra,R]=r.useState({}),[X,Ae]=r.useState(null),[Te,pe]=r.useState(null),[$e,Ue]=r.useState(null),[Be,_e]=r.useState(null),[j,k]=r.useState(null),[Q,t]=r.useState({}),i=r.useRef(0),[h,T]=r.useState(null),O=r.useRef(null),ae=r.useRef(null),[te,G]=r.useState(null),[de,oe]=r.useState(!1),[je,ea]=r.useState(null),[qe,ia]=r.useState([]),[Ve,We]=r.useState(null),Fe=r.useRef(null),Ge=r.useRef(null),[Sa,la]=r.useState(null),[Ra,ca]=r.useState(0),xa=r.useRef(null),Ba=r.useRef({}),[ya,oa]=r.useState(!1),[E,Re]=r.useState({}),[Ke,aa]=r.useState([]),Xe=r.useRef(new Map),[na,ba]=r.useState(new Set),[da,De]=r.useState(!1),ta=r.useRef(null),Ia=r.useRef(new Set),$a=r.useRef({}),we=P[re]??null,ve=(we==null?void 0:we.checkType)==="translation-match"&&j,Ua=r.useRef(new Map),La=r.useRef(new Map),qa=r.useRef(new Map),Wa=r.useRef(new Map),ma=r.useMemo(()=>we?we.cardType==="vocab"?a.cogita.library.revision.vocabLabel:we.infoType?Ze(a,we.infoType):a.cogita.library.revision.infoLabel:"",[a,we]),za=r.useMemo(()=>{var y;return m.id!=="levels"?P.length:((y=E.pool)==null?void 0:y.length)??m.getFetchLimit(z,f)},[E,f,m,P.length,z]),nt=m.getProgressTotal?m.getProgressTotal(P,E,z,f):m.id==="levels"?Math.min(z,za):P.length,ot=nt?Math.min(re+1,nt):0,Ea=Math.max(1,Number(f.tries??1)),ka=f.compare??"anchors",Ha=Math.max(0,Math.min(100,Number(f.minCorrectness??0))),fa=(f.considerDependencies??"on")==="on",ua=Math.max(0,Math.min(100,Number(f.dependencyThreshold??85))),Pa=c=>{const y=c.slice();for(let I=y.length-1;I>0;I-=1){const M=Math.floor(Math.random()*(I+1));[y[I],y[M]]=[y[M],y[I]]}return y},Qa=c=>c.length?c.reduce((I,M)=>I+M,0)/c.length/255*100:0,Ja=c=>Qa(c)>=Ha,lt=async()=>{const c=await Oa(),y=new Map,I=new Map,M=new Map;c.forEach(B=>{const J=`${B.itemType}:${B.itemId}`,ce=Ka(B.itemType,B.itemId,B.checkType,B.direction);if(y.has(J)||y.set(J,[]),y.get(J).push(B),I.has(ce)||I.set(ce,[]),I.get(ce).push(B),B.itemType==="info"&&B.checkType==="quote-fragment"&&B.direction){const be=`${B.itemId}:${B.direction}`;M.has(be)||M.set(be,[]),M.get(be).push(B)}});const Y=new Map,S=new Map,H=new Map;return y.forEach((B,J)=>Y.set(J,Va(B).score)),I.forEach((B,J)=>S.set(J,Va(B).score)),M.forEach((B,J)=>H.set(J,Va(B).score)),{itemKnowness:Y,cardKnowness:S,fragmentKnowness:H}},Qt=async c=>{const y=[];let I=null;for(;;){const M=await Ft({libraryId:o,collectionId:c,limit:200,cursor:I});if(y.push(...M.items),!M.nextCursor)break;I=M.nextCursor}return pr(y)},xt=async(c,y)=>{if(Xe.current.has(c))return Xe.current.get(c)??0;const I=await Qt(c);if(I.length===0)return Xe.current.set(c,0),0;const Y=I.reduce((S,H)=>{const B=fe(H);return S+(y.get(B)??0)},0)/I.length;return Xe.current.set(c,Y),Y},Gt=(c,y)=>{if(!fa||c.cardType!=="info"||c.infoType!=="quote"||c.checkType!=="quote-fragment")return!0;const I=Ta(c.direction);if(!(I!=null&&I.fragmentId))return!0;const M=c.description??"";if(!M.trim())return!0;const S=pt(M).nodes[I.fragmentId];if(!S||!S.leftId&&!S.rightId)return!0;const H=[S.leftId,S.rightId].filter(ce=>!!ce);if(H.length===0)return!0;const B=H.map(ce=>{const be=Ka("info",c.cardId,"quote-fragment",Tt(I.mode,ce));return y.get(be)??0});return B.reduce((ce,be)=>ce+be,0)/B.length>=ua},st=async c=>{const y=E,I=c.concat(y.active??[]).concat(y.pool??[]).filter((B,J,ce)=>ce.findIndex(be=>fe(be)===fe(B))===J);if(!fa){ba(new Set(I.map(fe)));return}const{itemKnowness:M,cardKnowness:Y}=await lt(),S=Ke.filter(B=>pa(B.childItemType)==="collection"&&B.childItemId===C&&!pa(B.childCheckType)&&!pa(B.childDirection)),H=new Set;for(const B of I){if(B.cardType!=="info"){H.add(fe(B));continue}if(!Gt(B,Y))continue;const J=Ke.filter(ye=>si(ye,B)).concat(S);if(J.length===0){H.add(fe(B));continue}let ce=0;for(const ye of J)if(pa(ye.parentItemType)==="collection")ce+=await xt(ye.parentItemId,Y);else if(pa(ye.parentCheckType)||pa(ye.parentDirection)){const xe=pa(ye.parentCheckType),Me=pa(ye.parentDirection),Se=Ka(ye.parentItemType,ye.parentItemId,xe,Me);ce+=Y.get(Se)??0}else{const xe=`${ye.parentItemType}:${ye.parentItemId}`;ce+=M.get(xe)??0}ce/J.length>=ua&&H.add(fe(B))}ba(H)},Xt=c=>{for(let y=c;y<P.length;y+=1){const I=P[y];if(I&&(!fa||I.cardType!=="info"||na.has(fe(I))))return y}return-1},Ca=c=>!fa||c.cardType!=="info"||na.has(fe(c)),ct=c=>{if(m.id!=="temporal"&&m.id!=="levels")return null;const y=E,I=(y.active??[]).concat(y.pool??[]),M=new Set;for(const Y of I){const S=fe(Y);if(!(M.has(S)||c.has(S))&&(M.add(S),Ca(Y)))return Y}return null},Aa=r.useMemo(()=>{if(m.id!=="levels")return null;const c=E,y=c.pool??[],I=c.active??[],M=c.levelMap??{},Y=Math.max(1,Number(f.levels??1)),S=Array.from({length:Y},()=>0),H=new Set(I.map(be=>fe(be)));y.forEach(be=>{const ye=Math.min(Y,Math.max(1,M[fe(be)]??1));S[ye-1]+=1});const B=y.length||1,J=S.map(be=>be/B*100),ce=we?M[fe(we)]??1:null;return{counts:S,percentages:J,currentLevel:ce,levelsCount:Y,activeCount:I.length,poolCount:y.length,activeSet:H}},[E,f,m,we]),va=r.useMemo(()=>{if(m.id!=="temporal")return null;const c=E,y=c.pool??[],I=c.active??[],M=c.knownessMap??{},Y=new Set(c.unknownSet??[]);let S=0;y.forEach(J=>{(M[fe(J)]??0)>1&&(S+=1)});const H=Y.size,B=I.map(J=>({id:fe(J),value:Y.has(fe(J))?0:Math.max(0,Math.min(1,M[fe(J)]??0))}));return{knownCount:S,unknownCount:H,dots:B}},[E,m]),dt=r.useMemo(()=>{if(!fa)return 0;const c=E;return P.concat(c.active??[]).concat(c.pool??[]).filter((I,M,Y)=>Y.findIndex(S=>fe(S)===fe(I))===M).filter(I=>I.cardType==="info"&&!na.has(fe(I))).length},[fa,E,P,na]);r.useEffect(()=>{if(!fa||ge!=="ready")return;const c=E,I=P.concat(c.active??[]).concat(c.pool??[]).filter((S,H,B)=>B.findIndex(J=>fe(J)===fe(S))===H).filter(S=>S.cardType!=="info"||na.has(fe(S))).length,M=Fe.current;if(Fe.current=I,M===null||I<=M)return;const Y=I-M;We(`New card available (+${Y})`),Ge.current&&window.clearTimeout(Ge.current),Ge.current=window.setTimeout(()=>We(null),2200)},[fa,ge,E,P,na]),r.useEffect(()=>()=>{Ge.current&&window.clearTimeout(Ge.current)},[]);const ja=(c,y)=>{const I=m.applyOutcome({queue:P,meta:E},we,z,f,{correct:c,correctness:y,createdUtc:new Date().toISOString()});U(I.queue),Re(I.meta);const M=I.queue[re+1];M&&yt(M,re+1)};r.useEffect(()=>{zt(o,C).then(c=>ne(c.name)).catch(()=>ne(a.cogita.library.collections.defaultName))},[o,C]),r.useEffect(()=>{jr({libraryId:o,type:"language"}).then(c=>me(c)).catch(()=>me([]))},[o]),r.useEffect(()=>{Hr({libraryId:o}).then(c=>aa(c.items??[])).catch(()=>aa([]))},[o]),r.useEffect(()=>{lr(o,V)},[o,V]),r.useEffect(()=>{st(P)},[P,Ke,fa,ua,C]),r.useEffect(()=>{if(!we||!fa){De(!1);return}if(we.cardType!=="info"||na.has(fe(we))){De(!1);return}const c=Xt(re+1);if(c>=0){De(!1),ee(c);return}if(m.id==="temporal"||m.id==="levels"){const y=P.slice(0,re+1),I=P.slice(re+1).filter(Ca),M=y.concat(I),Y=new Set(M.map(fe)),S=ct(Y);if(S){const B=fe(S);Y.has(B)||(M.push(S),Y.add(B),Re(J=>{const ce=J,be=new Set(ce.queued??[]);return be.add(B),{...ce,queued:be}}))}const H=M.findIndex((B,J)=>J!==re&&Ca(B));if(H>=0){U(M),ee(H),De(!1);return}}De(!0)},[we,na,fa,re,P,E,m.id]),r.useEffect(()=>{let c=!0;return(async()=>{K("loading"),d({current:0,total:m.id==="levels"?0:m.getFetchLimit(z,f)});try{const I=[];let M=null,Y=null;do{const ye=await Ft({libraryId:o,collectionId:C,limit:300,cursor:M});if(I.push(...ye.items),(m.id==="levels"||m.id==="temporal")&&ye.total&&(Y=ye.total),d(xe=>({current:I.length,total:xe.total||ye.total||m.getFetchLimit(z,f)})),M=ye.nextCursor??null,Y!==null&&I.length>=Y||m.id!=="levels"&&m.id!=="temporal"&&I.length>=m.getFetchLimit(z,f))break}while(M);if(!c)return;const S=pr(I);let H;if(m.id==="levels"){const ye=Math.max(1,Number(f.levels??1)),Me=(await Oa()).reduce((Se,Je)=>{const Qe=Ka(Je.itemType,Je.itemId,Je.checkType,Je.direction);return Se[Qe]||(Se[Qe]=[]),Se[Qe].push(Je),Se},{});H={},S.forEach(Se=>{const Je=fe(Se),Qe=Me[Je]??[],ha=Qe.length>0?Va(Qe).score:0,at=Math.max(1,Math.min(ye,Math.ceil(ha/100*ye)));H[Je]=at})}let B=null,J=null,ce=null;if(m.id==="temporal"){const ye=await Oa(),xe=new Set(S.map(Je=>fe(Je))),Me=ye.reduce((Je,Qe)=>{const ha=Ka(Qe.itemType,Qe.itemId,Qe.checkType,Qe.direction);return xe.has(ha)&&(Je[ha]||(Je[ha]=[]),Je[ha].push(Qe)),Je},{});B={},J=new Set,ce={};const Se=Date.now();S.forEach(Je=>{const Qe=fe(Je),ha=Me[Qe]??[];if(ha.length===0){B[Qe]=0,J.add(Qe),ce[Qe]=[];return}const at=kr(ha);ce[Qe]=at;const di=Ht(at,Se);B[Qe]=di.knowness})}const be=m.id==="levels"?Nr(S,z,f,H):m.id==="temporal"?Tr(S,z,f,B??{},J??new Set,ce??{}):m.prepare(S,z,f);U(be.queue),Re(be.meta),ee(0),K("ready"),d(ye=>({current:Math.min(ye.current,ye.total),total:ye.total}))}catch{c&&K("error")}})(),()=>{c=!1}},[o,C,z,f,m,V]),r.useEffect(()=>{if(Ne(""),ie(null),la(null),ca(0),Ee([]),sa({}),R({}),pe(null),Ue(null),_e(null),oe(!1),oa(!1),G(null),k(null),t({}),!we){Ie(null),Pe(null),Ae(null),ea(null);return}we.cardType==="info"&&we.infoType==="computed"&&Ie(a.cogita.library.revision.loadingComputed);let c=!0;return yt(we,re).then(y=>{!c||!y||(Ie(y.prompt),Pe(y.expectedAnswer),Ee(y.computedExpected),sa(y.computedAnswers),Ae(y.computedValues),pe(y.answerTemplate),Ue(y.outputVariables),_e(y.variableValues))}),()=>{c=!1}},[we,a]),r.useEffect(()=>{if(!we||we.cardType!=="info"||we.infoType!=="quote"){ta.current=null,Ia.current=new Set,Ye(null);return}const c=we.description??"",y=(we.label??"").trim(),I=y.replace(/\s+/g," ").trim(),M=c.replace(/\s+/g," ").trim(),Y=I&&I!==M?y:a.cogita.library.infoTypes.quote;if(!c){Ye(null),Pe(null);return}const S=pt(c);ta.current=S,Ie(Y);let H=!0;return lt().then(({fragmentKnowness:B})=>{if(!H)return;const J=getQuoteMode(we.direction),ce=new Set,be={};B.forEach((Me,Se)=>{const[Je,Qe]=Se.split(":",2);if(Je!==we.cardId)return;const ha=Ta(Qe);if(!ha||ha.mode!==J)return;const at=ha.fragmentId;be[at]=Me,Me>=ua&&ce.add(at)}),Ia.current=ce,$a.current=be;const ye=Ta(we.direction);if(ye!=null&&ye.fragmentId&&S.nodes[ye.fragmentId]){Da(S,ye.fragmentId,Y);return}const xe=bt(S,ce,be,ua,fa,we.direction);Da(S,(xe==null?void 0:xe.id)??null,Y)}).catch(()=>{Ia.current=new Set,$a.current={};const B=Ta(we.direction);if(B!=null&&B.fragmentId&&S.nodes[B.fragmentId]){Da(S,B.fragmentId,Y);return}const J=bt(S,Ia.current,{},ua,fa,we.direction);Da(S,(J==null?void 0:J.id)??null,Y)}),()=>{H=!1}},[we,a,fa,ua]),r.useEffect(()=>{if(!we||we.cardType!=="vocab"||we.checkType!=="translation-match"){k(null),t({});return}const I=(E.pool??E.active??P).filter(B=>B.cardType==="vocab"&&B.checkType==="translation-match").filter((B,J,ce)=>ce.findIndex(be=>be.cardId===B.cardId)===J);I.some(B=>B.cardId===we.cardId)||I.unshift(we);const Y=Pa(I).slice(0,6).map(B=>{const J=B.label.split("↔").map(ye=>ye.trim()).filter(Boolean);if(J.length<2)return null;const ce=`${B.cardId}:L`,be=`${B.cardId}:R`;return{cardId:B.cardId,leftId:ce,rightId:be,leftLabel:J[0],rightLabel:J[1]}}).filter(Boolean),S=Y.map(B=>B.leftId),H=Pa(Y.map(B=>B.rightId));k({pairs:Y,leftOrder:S,rightOrder:H,selection:{},activeLeft:null,activeRight:null,locked:{}})},[we,P,E]),r.useEffect(()=>()=>{O.current&&window.clearTimeout(O.current),ae.current&&window.clearTimeout(ae.current)},[]);const Ga=r.useRef(null);r.useEffect(()=>{if(!we)return;const c=fe(we),y=typeof document<"u"?document.activeElement:null;if(Ga.current===c&&y&&(y.tagName==="INPUT"||y.tagName==="TEXTAREA"))return;let I=0;const M=()=>{if(we){if(we.cardType==="info"&&we.infoType==="computed"){if(Oe.length>0){const S=Wt(Te,Oe,$e),H=S?Ba.current[S]:null;if(H&&(H.focus(),document.activeElement===H)){Ga.current=c;return}}if(xa.current&&(xa.current.focus(),document.activeElement===xa.current)){Ga.current=c;return}}else if(we.cardType==="vocab"&&xa.current&&(xa.current.focus(),document.activeElement===xa.current)){Ga.current=c;return}I<6&&(I+=1,window.setTimeout(M,40))}},Y=window.setTimeout(M,40);return()=>window.clearTimeout(Y)},[we,Oe,Te,$e]),r.useEffect(()=>{if(!ya)return;const c=y=>{y.key==="Enter"&&(y.preventDefault(),gt())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[ya]);const Xa=c=>{ia(c),ea(Va(c))};r.useEffect(()=>{if(!we){ea(null),ia([]);return}const c=we.cardType==="info"?"info":"connection";if(we.cardType==="info"&&we.infoType==="quote"){Oa().then(y=>{const I=y.filter(M=>M.itemType==="info"&&M.itemId===we.cardId&&M.checkType==="quote-fragment"&&qt(M.direction,we.direction));Xa(I)}).catch(()=>{ea(null),ia([])});return}Ot(c,we.cardId,we.checkType,we.direction).then(y=>Xa(y)).catch(()=>{ea(null),ia([])})},[o,we,V]);const Lt=(c,y,I,M)=>{if(c==="info"&&I==="quote-fragment"){Oa().then(Y=>{const S=Y.filter(H=>H.itemType==="info"&&H.itemId===y&&H.checkType==="quote-fragment"&&qt(H.direction,M));Xa(S)}).catch(()=>{ea(null),ia([])});return}Ot(c,y,I,M).then(Y=>Xa(Y)).catch(()=>{ea(null),ia([])})},Ct=(c,y,I)=>{var H;const M=((H=I.pairs.find(B=>B.leftId===c))==null?void 0:H.rightId)??null;if(!M)return I;const Y=M===y;t(B=>({...B,[c]:Y?"correct":"incorrect"})),O.current&&window.clearTimeout(O.current),ae.current&&window.clearTimeout(ae.current),i.current+=1;const S={kind:Y?"correct":"incorrect",tick:i.current};if(T(null),O.current=window.setTimeout(()=>T(S),0),ae.current=window.setTimeout(()=>T(null),420),Y){const B={...I.locked,[c]:!0};return Object.keys(B).length>=I.pairs.length?(ie("correct"),oa(!0)):ie("correct"),{...I,selection:{...I.selection,[c]:y},activeLeft:null,activeRight:null,locked:B}}return ie("incorrect"),{...I,activeLeft:null,activeRight:null}},ut=c=>{k(y=>!y||y.locked[c]?y:y.activeRight?Ct(c,y.activeRight,y):{...y,activeLeft:y.activeLeft===c?null:c})},Fa=c=>{k(y=>y&&(y.activeLeft?Ct(y.activeLeft,c,y):{...y,activeRight:y.activeRight===c?null:c}))},gt=()=>{var c;if(we&&we.cardType==="info"&&we.infoType==="quote"&&ta.current&&ke&&!((c=Ta(we.direction))!=null&&c.fragmentId)){const y=bt(ta.current,Ia.current,$a.current,ua,fa,we.direction,ke.fragmentId);if(y){ie(null),Ne(""),oe(!1),R({}),oa(!1),la(null),ca(0),Da(ta.current,y.id,ke.title);return}}ie(null),Ne(""),oe(!1),R({}),oa(!1),la(null),ca(0),ee(y=>Math.min(y+1,P.length))},Ma=c=>{if(!we)return;const y=c.expected??null,I=c.answer??"";let M=y??"",Y=I;if(!y&&c.expectedMap&&c.answerMap){const ye=Object.keys(c.expectedMap).sort((xe,Me)=>xe.localeCompare(Me));M=ye.map(xe=>{var Me;return((Me=c.expectedMap)==null?void 0:Me[xe])??""}).join("|"),Y=ye.map(xe=>{var Me;return((Me=c.answerMap)==null?void 0:Me[xe])??""}).join("|")}const S=M?mt(M,Y,ka):new Uint8Array,H={revisionType:m.id,evalType:c.evalType,direction:c.direction,prompt:Le??"",expected:y,answer:I,expectedAnswers:c.expectedMap??null,answers:c.answerMap??null,correct:c.correct,maskBase64:S.length?Ya(S):null,values:X??null,checkMode:he,compareMode:ka,minCorrectness:Ha},B=new TextEncoder().encode(JSON.stringify(H)),J=we.cardType==="info"?"info":"connection",ce=c.overrideCheckType??we.checkType??null,be=c.overrideDirection??we.direction??null;Vt({itemType:J,itemId:we.cardId,checkType:ce,direction:be,revisionType:m.id,evalType:c.evalType,correct:c.correct,maskBase64:S.length?Ya(S):null,payloadBase64:Ya(B),personRoleId:V??null}).then(()=>{Lt(J,we.cardId,ce,be),st(P),lr(o,V)}).catch(()=>{})},Za=(c,y)=>{const I=Ua.current.get(y);if(I)return Promise.resolve(I);const M=La.current.get(y);if(M)return M;const Y=it({libraryId:o,infoId:c}).then(S=>{var ye,xe;const H=S.payload,B=((ye=H.definition)==null?void 0:ye.graph)??null,J="",ce=((xe=H.definition)==null?void 0:xe.answerTemplate)??"",be=wr(B,J,ce);if(be){const Se={sample:Xr(be),answerTemplate:ce||null};return Ua.current.set(y,Se),Se}return hr({libraryId:o,infoId:c}).then(Me=>{const Se={sample:Me,answerTemplate:null};return Ua.current.set(y,Se),Se})}).catch(()=>hr({libraryId:o,infoId:c}).then(S=>{const H={sample:S,answerTemplate:null};return Ua.current.set(y,H),H}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{La.current.delete(y)});return La.current.set(y,Y),Y},yt=(c,y)=>{var B;const I=`${fe(c)}:${y}`,M=qa.current.get(I);if(M)return Promise.resolve(M);const Y=Wa.current.get(I);if(Y)return Y;const S=J=>(qa.current.set(I,J),J);let H;if(c.cardType==="vocab"){if(c.checkType==="translation-match")return H=Promise.resolve(S({prompt:c.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),H;const J=c.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(J.length>=2){const be=(c.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ye=be?J[0]:J[1],xe=be?J[1]:J[0];H=Promise.resolve(S({prompt:ye,expectedAnswer:xe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else H=Promise.resolve(S({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(c.cardType==="info"&&c.infoType==="word"){const J=(B=c.description)!=null&&B.startsWith("Language: ")?c.description.replace("Language: ",""):null;H=Promise.resolve(S({prompt:c.label,expectedAnswer:J,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else c.cardType==="info"&&c.infoType==="computed"?H=Za(c.cardId,I).then(J=>{var Me,Se;if(!J.sample)return S({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ce=J.sample,be=ce.expectedAnswers?Object.entries(ce.expectedAnswers).map(([Je,Qe])=>({key:Je,expected:Qe})):[],ye=be.reduce((Je,Qe)=>(Je[Qe.key]="",Je),{}),xe=ce.expectedAnswerIsSentence&&((Me=ce.expectedAnswer)==null?void 0:Me.trim())||null;return S({prompt:ce.prompt,expectedAnswer:be.length>0?xe:((Se=ce.expectedAnswer)==null?void 0:Se.trim())||null,computedExpected:be,computedAnswers:ye,computedValues:ce.values??null,answerTemplate:J.answerTemplate,outputVariables:ce.outputVariables??null,variableValues:ce.variableValues??null})}).catch(()=>S({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Wa.current.delete(I)}):H=Promise.resolve(S({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return Wa.current.set(I,H),H},Da=(c,y,I)=>{const M=Object.keys(c.nodes).length,Y=Ia.current.size;if(!y){Ye({title:I,before:c.text,after:"",fragmentId:null,total:M,completed:Y}),Pe(null),oa(!0);return}const S=c.nodes[y];if(!S)return;const H=Zr(c.text,S);Ye({title:I,before:H.before,after:H.after,fragmentId:S.id,total:M,completed:Y}),Pe(H.fragment),oa(!1)},Mt=()=>{const c=ta.current;c&&Ye(y=>y&&{...y,total:Object.keys(c.nodes).length,completed:Ia.current.size})},ht=()=>{const c=P[re+1];c&&yt(c,re+1)},St=()=>{if(ht(),we&&we.cardType==="vocab"&&we.checkType==="translation-match"&&j){if(j.pairs.length===0){ie("incorrect"),oa(!0);return}const S=j.pairs.reduce((xe,Me)=>(xe[Me.rightId]=Me.rightLabel,xe),{});let H=0;const B={};j.pairs.forEach(xe=>{const Se=j.selection[xe.leftId]===xe.rightId;B[xe.leftId]=Se?"correct":"incorrect",Se&&(H+=1)});const J=j.pairs.length||1,ce=H/J,be=H===j.pairs.length;t(xe=>({...xe,...B})),be?(ie("correct"),oa(!0),ca(0)):(ie("incorrect"),oa(!1),ca(xe=>{const Me=xe+1;return Me>=Ea&&(oe(!0),oa(!0),k(Se=>{if(!Se)return Se;const Je=Se.pairs.reduce((Qe,ha)=>(Qe[ha.leftId]=ha.rightId,Qe),{});return{...Se,selection:Je}})),Me})),ja(be,ce);const ye="connection";Promise.all(j.pairs.map(xe=>{const Me=j.selection[xe.leftId]??null,Se=Me?S[Me]:"",Je={left:xe.leftLabel,expected:xe.rightLabel,answer:Se,checkType:"translation-match"},Qe=new TextEncoder().encode(JSON.stringify(Je));return Vt({itemType:ye,itemId:xe.cardId,checkType:"translation-match",direction:null,revisionType:m.id,evalType:"translation-match",correct:Me===xe.rightId,maskBase64:null,payloadBase64:Ya(Qe),personRoleId:V??null})})).then(()=>{Lt(ye,we.cardId,we.checkType,we.direction),lr(o,V)}).catch(()=>{});return}if(Oe.length>0){const S=Oe.reduce((B,J)=>{const ce=He[J.key]??"";return B[J.key]=wa(ce)===wa(J.expected)?"correct":"incorrect",B},{});Oe.every(({key:B,expected:J})=>{const ce=He[B]??"";return he==="exact"&&wa(ce)===wa(J)})?(ie("correct"),R(S),oa(!0),ca(0),ja(!0,1),Ma({correct:!0,direction:Le?`${Le} -> computed`:"computed",expectedMap:Oe.reduce((B,J)=>(B[J.key]=J.expected,B),{}),answerMap:He,evalType:"computed"})):(ie("incorrect"),R(S),oa(!1),ca(B=>{const J=B+1;return J>=Ea&&Z&&(oe(!0),oa(!0)),J}),ja(!1,0),window.setTimeout(()=>{var J;const B=Wt(Te,Oe,$e);B&&Ba.current[B]&&((J=Ba.current[B])==null||J.focus())},40),Ma({correct:!1,direction:Le?`${Le} -> computed`:"computed",expectedMap:Oe.reduce((B,J)=>(B[J.key]=J.expected,B),{}),answerMap:He,evalType:"computed"}));return}if(we&&we.cardType==="info"&&we.infoType==="quote"&&(ke!=null&&ke.fragmentId)){if(!Ce)return;const S=Ta(we.direction),H=(S==null?void 0:S.mode)??getQuoteMode(we.direction),B=S!=null&&S.fragmentId&&we.direction?we.direction:Tt(H,ke.fragmentId),J=li(Ce,q,ka),ce=he==="exact"&&ft(q)===ft(Ce),be=Ja(J),ye=ce||be,xe=Qa(J);ye?($a.current[ke.fragmentId]=Math.max($a.current[ke.fragmentId]??0,xe),($a.current[ke.fragmentId]??0)>=ua&&Ia.current.add(ke.fragmentId),Mt(),ie("correct"),R({}),oa(!0),la(J),ca(0),xe<100&&Ea<=1&&oe(!0),ja(!0,xe/100),Ma({correct:!0,direction:`quote:${ke.fragmentId}`,expected:Ce,answer:q,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:B})):(ie("incorrect"),R({}),oa(!1),la(J),ca(Me=>{const Se=Me+1;return Se>=Ea&&Z&&(oe(!0),oa(!0)),Se}),ja(!1,xe/100),window.setTimeout(()=>{var Me;return(Me=xa.current)==null?void 0:Me.focus()},40),Ma({correct:!1,direction:`quote:${ke.fragmentId}`,expected:Ce,answer:q,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:B}));return}if(!Ce)return;const c=mt(Ce,q,ka),y=he==="exact"&&wa(q)===wa(Ce),I=Ja(c),M=y||I,Y=Qa(c);M?(ie("correct"),R({}),oa(!0),la(c),ca(0),Y<100&&Ea<=1&&oe(!0),ja(!0,Y/100),Ma({correct:!0,direction:Le?`${Le} -> ${Ce}`:null,expected:Ce,answer:q,evalType:"text"})):(ie("incorrect"),R({}),oa(!1),la(c),ca(S=>{const H=S+1;return H>=Ea&&Z&&(oe(!0),oa(!0)),H}),ja(!1,Y/100),window.setTimeout(()=>{var S;return(S=xa.current)==null?void 0:S.focus()},40),Ma({correct:!1,direction:Le?`${Le} -> ${Ce}`:null,expected:Ce,answer:q,evalType:"text"}))},Zt=c=>{if(ht(),!Ce)return;const y=mt(Ce,c,ka),I=wa(c)===wa(Ce),M=Ja(y),Y=I||M,S=Qa(y);Y?(ie("correct"),R({}),oa(!0),la(y),ca(0),S<100&&Ea<=1&&oe(!0),ja(!0,S/100),Ma({correct:!0,direction:"word->language",expected:Ce,answer:c,evalType:"language-select"})):(ie("incorrect"),R({}),oa(!1),la(y),ca(H=>{const B=H+1;return B>=Ea&&Z&&(oe(!0),oa(!0)),B}),ja(!1,S/100),Ma({correct:!1,direction:"word->language",expected:Ce,answer:c,evalType:"language-select"}))},er=()=>{ht(),ie("correct"),oa(!0),ca(0),ja(!0,1),Ce&&Ma({correct:!0,direction:"manual",expected:Ce,answer:q,evalType:"manual"})},ar=()=>{if(ja(!1,0),we&&we.cardType==="info"&&we.infoType==="quote"){ie(null),Ne(""),oe(!1),R({}),oa(!1),la(null),ca(0),ee(c=>Math.min(c+1,P.length));return}gt()};r.useEffect(()=>{ht()},[re,P]);const et=c=>{var I;if(c.key!=="Enter")return;if(c.preventDefault(),c.stopPropagation(),ya){gt();return}const y=Oe.find(M=>!(He[M.key]??"").trim());if(y){(I=Ba.current[y.key])==null||I.focus();return}St()},$=a.cogita.library.revision.revealModeAfterIncorrect,Z=Oe.length>0||!!Ce;return e.jsxs(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:[ge==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${le.total?Math.min(100,Math.max(0,le.current/le.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:le.total?`${Math.min(le.current,le.total)} / ${le.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:F}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",v).replace("{check}",D)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:W,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${W}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${W}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:je?`${je.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Aa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Aa.currentLevel??"-"," / ",Aa.levelsCount]}):null,je?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(je.correct)).replace("{total}",String(je.total))}),je.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(je.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Ve?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Ve})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":h?`${h.kind}-${h.tick}`:ve?"idle":se??"idle",children:we?e.jsx(e.Fragment,{children:da?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:we,currentTypeLabel:ma,prompt:Le,languages:ue,answer:q,onAnswerChange:c=>Ne(y=>Ut(y,c,te)),computedExpected:Oe,computedAnswers:He,onComputedAnswerChange:(c,y)=>sa(I=>({...I,[c]:Ut(I[c]??"",y,te)})),answerTemplate:Te,outputVariables:$e,variableValues:Be,computedFieldFeedback:ra,feedback:se,canAdvance:ya,quoteContext:ke,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:St,onSkip:ar,onLanguageSelect:Zt,onMarkReviewed:er,onAdvance:gt,showCorrectAnswer:de,setShowCorrectAnswer:oe,onRevealCorrect:()=>oa(!0),answerMask:Sa,expectedAnswer:Ce,hasExpectedAnswer:Z,handleComputedKeyDown:et,answerInputRef:xa,computedInputRefs:Ba,scriptMode:te,setScriptMode:G,matchPairs:j==null?void 0:j.pairs,matchLeftOrder:j==null?void 0:j.leftOrder,matchRightOrder:j==null?void 0:j.rightOrder,matchSelection:j==null?void 0:j.selection,matchActiveLeft:j==null?void 0:j.activeLeft,matchActiveRight:j==null?void 0:j.activeRight,matchFeedback:Q,onMatchLeftSelect:ut,onMatchRightSelect:Fa})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${W}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:nt?`${ot} / ${nt}`:a.cogita.library.revision.progressUnlimited}),ge==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ge==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ge==="ready"&&P.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:$}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ea]})]})]}),Aa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Aa.activeCount," / ",Aa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Aa.counts.map((c,y)=>{const I=y+1,M=Aa.currentLevel===I,Y=Aa.percentages[y]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":M,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:I}),e.jsx("strong",{children:c})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,Y))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[Y.toFixed(1),"%"]})]},`level-${I}`)})})]}):null,va?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:va.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:va.dots.map(c=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,c.value*100))}%`,background:`rgba(${Math.round(255*(1-c.value))}, ${Math.round(200*c.value)}, 80, 0.9)`}},c.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:va.knownCount})]})]}):null,fa?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:dt})]})}):null]})]})]})})})]})]})}const sr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],An={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Fn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Bn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Dn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:C}){const[b,p]=r.useState(""),[W,_,z]=Or([]),[s,m,f]=_r([]),[he,V]=r.useState(null),[v,D]=r.useState(null),[F,ne]=r.useState(null),P=`/#/cogita/library/${o}`;r.useEffect(()=>{zt(o,C).then(d=>p(d.name)).catch(()=>p(a.cogita.library.collections.defaultName))},[o,C,a]),r.useEffect(()=>{Mi({libraryId:o,collectionId:C}).then(d=>{if(!d.graphId||d.graphId==="00000000-0000-0000-0000-000000000000"){_([]),m([]);return}const re=d.nodes.map(q=>{var Le;const Ne=q.payload??{},se=Ne.position??{x:120,y:120},ie=Ne.params??{};return{id:q.nodeId,type:"default",position:se,data:{nodeType:q.nodeType,label:((Le=sr.find(Ie=>Ie.type===q.nodeType))==null?void 0:Le.label)??q.nodeType,params:ie}}}),ee=d.edges.map(q=>({id:q.edgeId,source:q.fromNodeId,target:q.toNodeId,sourceHandle:q.fromPort??void 0,targetHandle:q.toPort??void 0}));_(re),m(ee)}).catch(()=>{_([]),m([])})},[o,C,m,_]);const U=r.useMemo(()=>W.find(d=>d.id===he)??null,[W,he]),ue=d=>{var Ne;const re=crypto.randomUUID(),ee=((Ne=sr.find(se=>se.type===d))==null?void 0:Ne.label)??d,q={...An[d]};_(se=>[...se,{id:re,type:"default",position:{x:120+se.length*40,y:120+se.length*40},data:{nodeType:d,label:ee,params:q}}]),V(re)},me=r.useCallback(d=>{m(re=>$t({...d,id:crypto.randomUUID()},re))},[m]),ge=async()=>{D(null);try{await Ii({libraryId:o,collectionId:C,nodes:W.map(d=>({nodeId:d.id,nodeType:d.data.nodeType,payload:{position:d.position,params:d.data.params}})),edges:s.map(d=>({edgeId:d.id,fromNodeId:d.source,fromPort:d.sourceHandle??null,toNodeId:d.target,toPort:d.targetHandle??null}))}),D(a.cogita.library.graph.saveSuccess)}catch{D(a.cogita.library.graph.saveFail)}},K=async()=>{try{const d=await Si({libraryId:o,collectionId:C});ne(d)}catch{ne(null)}},le=d=>{U&&_(re=>re.map(ee=>ee.id===U.id?{...ee,data:{...ee.data,params:d}}:ee))};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${P}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:K,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ge,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:sr.map(d=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ue(d.type),children:d.label},d.type))}),v?e.jsx("p",{className:"cogita-help",children:v}):null,F&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(F.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(F.connections)).replace("{infos}",String(F.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(fr,{nodes:W,edges:s,onNodesChange:z,onEdgesChange:f,onConnect:me,onNodeClick:(d,re)=>V(re.id),fitView:!0,children:[e.jsx(xr,{color:"rgba(120,160,200,0.2)"}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),U?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:U.data.label}),U.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:U.data.params.tagId?{id:U.data.params.tagId,label:U.data.params.tagLabel??"",infoType:"topic"}:null,onChange:d=>le({...U.data.params,tagId:(d==null?void 0:d.id)??null,tagLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:U.data.params.scope??"any",onChange:d=>le({...U.data.params,scope:d.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),U.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:U.data.params.languageId?{id:U.data.params.languageId,label:U.data.params.languageLabel??"",infoType:"language"}:null,onChange:d=>le({...U.data.params,languageId:(d==null?void 0:d.id)??null,languageLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:U.data.params.scope??"any",onChange:d=>le({...U.data.params,scope:d.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),U.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:U.data.params.infoType??"word",onChange:d=>le({...U.data.params,infoType:d.target.value}),children:Bn.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsx(ze,{libraryId:o,infoType:U.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:U.data.params.infoId?{id:U.data.params.infoId,label:U.data.params.infoLabel??"",infoType:U.data.params.infoType??"word"}:null,onChange:d=>le({...U.data.params,infoId:(d==null?void 0:d.id)??null,infoLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),U.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:U.data.params.connectionType??"translation",onChange:d=>le({...U.data.params,connectionType:d.target.value}),children:Fn.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:U.data.params.connectionId??"",onChange:d=>le({...U.data.params,connectionId:d.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(U.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const cr="cogita.preferences",ci=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],dr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ur=["settings","run","shared"];function Kn(a,n=""){const l=a.split("/").filter(Boolean);if(l[0]!=="cogita"||l[1]!=="library")return{};const u=l[2];if(!u)return{};if(!l[3])return{libraryId:u,target:"library_overview"};const g=new URLSearchParams(n),w=g.get("revisionId")??void 0,x=g.get("infoId")??void 0,N=g.get("infoView")==="cards"?"cards":"overview",A=g.get("collectionAction"),L=g.get("libraryAction");if(l[3]==="list")return{libraryId:u,target:L==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:w,infoId:x,infoView:N,libraryAction:L==="new-info"?"new-info":void 0};if(l[3]==="detail"||l[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:l[3],revisionId:w,infoId:x,infoView:N};if(l[3]==="new"||l[3]==="add")return{libraryId:u,target:"new_card",revisionId:w,libraryAction:"new-info"};if(l[3]==="edit")return{libraryId:u,target:"new_card",revisionId:w,infoId:l[4]};if(l[3]==="shared-revisions")return{libraryId:u,target:"all_collections",revisionId:w};if(l[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(l[3]==="transfer")return{libraryId:u,target:"transfer"};if(l[3]==="storyboards")return l[4]==="new"?{libraryId:u,target:"new_storyboard"}:{libraryId:u,target:"storyboards"};if(l[3]==="texts")return l[4]==="new"?{libraryId:u,target:"new_text"}:{libraryId:u,target:"texts"};if(l[3]!=="collections")return{libraryId:u,target:"library_overview"};if(l[4]==="new")return{libraryId:u,target:"new_collection",revisionId:w};const o=l[4];return o?l[5]==="graph"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:"graph"}:l[5]==="shared-revisions"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:"shared"}:l[5]==="revision"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:l[6]==="run"?"run":"settings"}:A==="new-revision"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:"new"}:{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:"detail"}:A==="new-collection"?{libraryId:u,target:"new_collection",collectionAction:"new-collection"}:{libraryId:u,target:"all_collections"}}function gr(a,n="library_overview",l,u,g,w,x="overview"){const N=(A,L)=>{const o=new URLSearchParams;L!=null&&L.revisionId&&o.set("revisionId",L.revisionId),L!=null&&L.collectionAction&&o.set("collectionAction",L.collectionAction),L!=null&&L.libraryAction&&o.set("libraryAction",L.libraryAction),L!=null&&L.infoId&&o.set("infoId",L.infoId),L!=null&&L.infoView&&(L!=null&&L.infoId)&&o.set("infoView",L.infoView);const C=o.toString();return C?`${A}?${C}`:A};return a?n==="library_overview"?N(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?N(`/cogita/library/${a}/list`,{revisionId:g,infoId:w,infoView:x}):n==="new_card"?w?N(`/cogita/library/${a}/edit/${w}`,{revisionId:g}):N(`/cogita/library/${a}/list`,{revisionId:g,libraryAction:"new-info"}):n==="all_collections"?l?u==="graph"?N(`/cogita/library/${a}/collections/${l}/graph`,{revisionId:g}):u==="settings"?N(`/cogita/library/${a}/collections/${l}/revision`,{revisionId:g}):u==="run"?N(`/cogita/library/${a}/collections/${l}/revision/run`,{revisionId:g}):u==="shared"?N(`/cogita/library/${a}/collections/${l}/shared-revisions`,{revisionId:g}):u==="new"?N(`/cogita/library/${a}/collections/${l}`,{revisionId:g,collectionAction:"new-revision"}):N(`/cogita/library/${a}/collections/${l}`,{revisionId:g}):N(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?N(`/cogita/library/${a}/collections`,{revisionId:g,collectionAction:"new-collection"}):n==="transfer"?N(`/cogita/library/${a}/transfer`,{revisionId:g}):n==="storyboards"?N(`/cogita/library/${a}/storyboards`,{revisionId:g}):n==="new_storyboard"?N(`/cogita/library/${a}/storyboards/new`,{revisionId:g}):n==="texts"?N(`/cogita/library/${a}/texts`,{revisionId:g}):n==="new_text"?N(`/cogita/library/${a}/texts/new`,{revisionId:g}):n==="dependencies"?N(`/cogita/library/${a}/dependencies`,{revisionId:g}):N(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function Pt(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function Vn(a){return typeof a=="string"&&ci.includes(a)}function On(a,n){var N;if(!a.length)return null;const l=a.filter(A=>n.has(A.roleId)),u=l.length>0?l:a,g=u.map(A=>{var o,C;const L=((C=(o=A.fields.find(b=>b.fieldType==="role_kind"))==null?void 0:o.plainValue)==null?void 0:C.toLowerCase())??"";return{roleId:A.roleId,roleKind:L}}),w=g.find(A=>A.roleKind.includes("master"));if(w)return w.roleId;const x=g.find(A=>A.roleKind.includes("account")||A.roleKind.includes("user"));return x?x.roleId:((N=u[0])==null?void 0:N.roleId)??null}function _n(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function qn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L}){const o=Vr(),C=vr(),b=r.useMemo(()=>Kn(C.pathname,C.search),[C.pathname,C.search]),p=a.cogita.workspace,[W,_]=r.useState([]),[z,s]=r.useState([]),[m,f]=r.useState([]),[he,V]=r.useState([]),[v,D]=r.useState(void 0),[F,ne]=r.useState("library_overview"),[P,U]=r.useState(void 0),[ue,me]=r.useState(void 0),[ge,K]=r.useState("detail"),[le,d]=r.useState(void 0),[re,ee]=r.useState(!1),[q,Ne]=r.useState(!0),[se,ie]=r.useState(!1),[Le,Ie]=r.useState(!1),[Ce,Pe]=r.useState(null),[ke,Ye]=r.useState(""),[Oe,Ee]=r.useState(""),[He,sa]=r.useState(""),[ra,R]=r.useState(null),[X,Ae]=r.useState(null),Te=r.useRef({version:1,byLibrary:{}}),pe=r.useRef(!1),$e=r.useRef(!1),Ue=r.useRef(null),Be=r.useMemo(()=>W.find(E=>E.libraryId===v)??null,[W,v]),_e=r.useMemo(()=>z.find(E=>E.collectionId===P)??null,[z,P]),j=r.useMemo(()=>he.find(E=>E.revisionId===ue)??null,[he,ue]),k=r.useMemo(()=>({detail:p.revisions.detail,graph:p.revisions.graph,settings:p.revisions.settings,run:p.revisions.run,shared:p.targets.sharedRevisions,new:p.revisionForm.createAction}),[p.revisions.detail,p.revisions.graph,p.revisions.run,p.revisions.settings,p.targets.sharedRevisions,p.revisionForm.createAction]),Q=r.useMemo(()=>[{value:"detail",label:k.detail},{value:"graph",label:k.graph},{value:"settings",label:p.targets.allRevisions},{value:"run",label:k.run},{value:"shared",label:k.shared}],[k.detail,k.graph,k.run,k.shared,p.targets.allRevisions]),t=r.useMemo(()=>F==="new_card"?"all_cards":F==="new_collection"?"all_collections":F==="new_storyboard"?"storyboards":F==="new_text"?"texts":F,[F]),i=r.useMemo(()=>ge==="new"?"settings":ge,[ge]),h=r.useMemo(()=>b.infoId?"selected":F==="new_card"?"create":"search",[b.infoId,F]),T=r.useMemo(()=>m.find(E=>E.infoId===b.infoId)??null,[m,b.infoId]),O=r.useMemo(()=>({library_overview:p.targets.libraryOverview,all_cards:p.targets.allCards,new_card:p.targets.newCard,all_collections:p.targets.allCollections,new_collection:p.targets.newCollection,transfer:p.targets.transfer,storyboards:p.targets.storyboards,new_storyboard:p.targets.newStoryboard,texts:p.targets.texts,new_text:p.targets.newText,dependencies:p.targets.dependencies}),[p.targets]),ae=r.useMemo(()=>O[t]??t,[t,O]),te=k[i],G=!!v,de=!!P,oe=G&&F==="all_collections",je=de&&F==="all_collections",ea=de&&F==="all_collections"&&ur.includes(ge),qe=r.useCallback(E=>{const Re=!!E.libraryId;let Ke=E.target,aa=E.collectionId,Xe=E.revisionId,na=E.revisionView,ba=E.infoId,da=E.infoView??b.infoView??"overview";Re?dr[Ke].requiresCollection&&!aa?(Ke="all_collections",Xe=void 0,na="detail"):Ke!=="all_collections"?(aa=void 0,Xe=void 0,Ke!=="new_card"&&Ke!=="all_cards"&&(ba=void 0,da="overview")):dr[Ke].allowsRevision?ur.includes(na)||(Xe=void 0):na="detail":(Ke="library_overview",aa=void 0,Xe=void 0,na="detail",ba=void 0,da="overview"),D(E.libraryId),ne(Ke),U(aa),me(Xe),K(na),ee(!1);const De=Pt(gr(E.libraryId,Ke,aa,na,Xe,ba,da));Pt(`${C.pathname}${C.search}`)!==De&&(Ue.current=De,o(De))},[C.pathname,C.search,o,b.infoView]),ia=E=>{qe({libraryId:v,target:"all_collections",collectionId:P,revisionId:ur.includes(E)?ue:void 0,revisionView:E})},Ve=r.useMemo(()=>[{key:"library",label:p.layers.library,visible:!0,value:v??"",selectedLabel:(Be==null?void 0:Be.name)??p.path.noLibrarySelected,disabled:q||W.length===0,options:W.map(E=>({value:E.libraryId,label:E.name})),emptyOption:p.noLibraryOption,onSelect:E=>{const Re=E||void 0;qe({libraryId:Re,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:p.layers.target,visible:G,value:t,selectedLabel:ae,disabled:!G,options:ci.map(E=>({value:E,label:O[E]})),onSelect:E=>{const Re=E;qe({libraryId:v,target:Re,collectionId:P,revisionId:ue,revisionView:ge,infoId:Re==="new_card"?b.infoId:void 0})}},{key:"info_mode",label:p.layers.target,visible:t==="all_cards",value:h,selectedLabel:h==="create"?p.infoMode.create:h==="selected"?(T==null?void 0:T.label)??le??a.cogita.library.list.selectedEmpty:p.infoMode.search,disabled:!G,options:[{value:"search",label:p.infoMode.search},{value:"create",label:p.infoMode.create},...b.infoId?[{value:"selected",label:(T==null?void 0:T.label)??le??a.cogita.library.list.selectedEmpty}]:[]],onSelect:E=>{if(E!=="selected"){if(E==="create"){qe({libraryId:v,target:"new_card",collectionId:P,revisionId:ue,revisionView:ge,infoId:void 0});return}qe({libraryId:v,target:"all_cards",collectionId:P,revisionId:ue,revisionView:ge,infoId:void 0,infoView:"overview"})}}},{key:"info_selected_action",label:p.layers.target,visible:t==="all_cards"&&!!b.infoId,value:F==="new_card"&&b.infoId?"edit":b.infoView==="cards"?"cards":"overview",selectedLabel:F==="new_card"&&b.infoId?p.infoActions.edit:b.infoView==="cards"?p.infoActions.seeCards:p.infoActions.overview,disabled:!G||!b.infoId,options:[{value:"overview",label:p.infoActions.overview},{value:"edit",label:p.infoActions.edit},{value:"cards",label:p.infoActions.seeCards}],onSelect:E=>{if(b.infoId){if(E==="edit"){qe({libraryId:v,target:"new_card",collectionId:P,revisionId:ue,revisionView:ge,infoId:b.infoId});return}if(E==="cards"){qe({libraryId:v,target:"all_cards",collectionId:P,revisionId:ue,revisionView:ge,infoId:b.infoId,infoView:"cards"});return}qe({libraryId:v,target:"all_cards",collectionId:P,revisionId:ue,revisionView:ge,infoId:b.infoId,infoView:"overview"})}}},{key:"collection",label:p.layers.collection,visible:oe,value:P??"",selectedLabel:(_e==null?void 0:_e.name)??p.path.noCollectionSelected,disabled:!G||se||z.length===0,options:z.map(E=>({value:E.collectionId,label:E.name})),emptyOption:p.selectCollectionOption,onSelect:E=>{qe({libraryId:v,target:"all_collections",collectionId:E||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:p.layers.revision,visible:je,value:i,selectedLabel:te,disabled:!P,options:Q.map(E=>({value:E.value,label:E.label})),onSelect:E=>{ia(E)}},{key:"revision_entry",label:p.layers.revision,visible:ea,value:ue??"",selectedLabel:(j==null?void 0:j.name)??p.status.noRevisions,disabled:!de||Le||he.length===0,options:he.map(E=>({value:E.revisionId,label:E.name})),emptyOption:p.status.noRevisions,onSelect:E=>{qe({libraryId:v,target:"all_collections",collectionId:P,revisionId:E||void 0,revisionView:ge})}}],[Q,z,se,h,m,W,q,qe,he,Le,_e,P,T,j,ue,le,de,G,Be,v,te,ge,F,i,t,ae,oe,je,ea,O,a.cogita.library.list.selectedEmpty,b.infoId,b.infoView,p.infoActions.edit,p.infoActions.overview,p.infoActions.seeCards,p.layers.collection,p.layers.library,p.layers.revision,p.layers.target,p.noLibraryOption,p.path.noCollectionSelected,p.path.noLibrarySelected,p.selectCollectionOption]),We=r.useMemo(()=>Ve.filter(E=>E.visible),[Ve]),Fe=r.useMemo(()=>We.filter(E=>E.key!=="library"&&E.key!=="collection"&&E.key!=="revision_entry"),[We]),Ge=r.useMemo(()=>Fe.find(E=>E.key==="target")??null,[Fe]),Sa=r.useMemo(()=>Fe.find(E=>E.key==="info_mode")??null,[Fe]),la=r.useMemo(()=>Fe.find(E=>E.key==="info_selected_action")??null,[Fe]),Ra=r.useMemo(()=>Fe.find(E=>E.key==="collection_action")??null,[Fe]),ca=r.useCallback((E,Re)=>E?e.jsx("div",{className:"cogita-sidebar-actions",children:E.options.map(Ke=>e.jsx("button",{type:"button",className:`ghost ${String(E.value)===Ke.value?"active":""}`,onClick:()=>E.onSelect(Ke.value),disabled:E.disabled,children:Ke.label},`${Re}:${E.key}:${Ke.value}`))}):null,[]),xa=r.useMemo(()=>{const E=b.libraryId;if(!E||!C.pathname.startsWith("/cogita/library/"))return null;const Re={copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:E};if(b.target==="library_overview")return e.jsx(Yi,{...Re});if(b.target==="all_cards")return e.jsx(Zi,{...Re,mode:b.cardMode??"list"});if(b.target==="new_card")return e.jsx(nn,{...Re,editInfoId:b.infoId});if(b.target==="dependencies")return e.jsx(ln,{...Re});if(b.target==="transfer")return e.jsx(cn,{...Re});if(b.target==="storyboards"||b.target==="new_storyboard")return e.jsx(dn,{...Re});if(b.target==="texts"||b.target==="new_text")return e.jsx(un,{...Re});if(b.target==="all_collections"){if(b.collectionId){const Ke={...Re,collectionId:b.collectionId};return b.revisionView==="graph"?e.jsx(Dn,{...Ke}):b.revisionView==="shared"?e.jsx(sn,{...Re,collectionId:b.collectionId}):b.revisionView==="settings"?e.jsx(jn,{...Ke,revisionId:b.revisionId}):b.revisionView==="run"?e.jsx(En,{...Ke,revisionId:b.revisionId}):e.jsx(gn,{...Ke})}return e.jsx(Dr,{...Re})}return b.target==="new_collection"?e.jsx(Dr,{...Re}):null},[n,a,A,C.pathname,o,L,w,N,u,g,b.cardMode,b.collectionId,b.infoId,b.libraryId,b.revisionId,b.revisionView,b.target,x,l]);r.useEffect(()=>{let E=!1;return(async()=>{var Ke,aa,Xe,na,ba,da,De;Ne(!0);try{await Pi();const[ta,Ia,$a]=await Promise.all([Wr(),Ri(),$i()]);if(E)return;_(ta);const we=new Set($a.nodes.filter(ma=>ma.nodeType==="role"&&ma.canLink).map(ma=>ma.roleId??"")),ve=On(Ia,we);if(R(ve),ve){const ma=$a.nodes.find(za=>za.nodeType==="data"&&za.roleId===ve&&(za.fieldType===cr||za.label===cr));Ae((ma==null?void 0:ma.dataKeyId)??null),Te.current=_n(ma==null?void 0:ma.value)}const Ua=Te.current.lastLibraryId,La=((Ke=ta.find(ma=>ma.libraryId===b.libraryId))==null?void 0:Ke.libraryId)??(ta.length===1?ta[0].libraryId:void 0)??((aa=ta.find(ma=>ma.libraryId===Ua))==null?void 0:aa.libraryId)??((Xe=ta[0])==null?void 0:Xe.libraryId),qa=La?(ba=(na=Te.current.byLibrary)==null?void 0:na[La])==null?void 0:ba.lastTarget:void 0,Wa=Vn(qa)?qa:"library_overview";D(La),ne(b.target??Wa),me(b.revisionId??(La?(De=(da=Te.current.byLibrary)==null?void 0:da[La])==null?void 0:De.lastRevisionId:void 0)),K(b.revisionView??"detail"),pe.current=!0}catch{E||Pe(p.status.loadFailed)}finally{E||Ne(!1)}})(),()=>{E=!0}},[p.status.loadFailed]),r.useLayoutEffect(()=>{pe.current&&(b.libraryId&&W.some(E=>E.libraryId===b.libraryId)&&D(b.libraryId),b.target&&ne(b.target),U(b.collectionId),me(b.revisionId),b.revisionView&&K(b.revisionView))},[W,b.collectionId,b.libraryId,b.revisionId,b.revisionView,b.target]),r.useEffect(()=>{if(!v){s([]),U(void 0),f([]),V([]),me(void 0);return}let E=!1;return ie(!0),wt({libraryId:v,limit:200}).then(Re=>{var Xe;if(E)return;const Ke=Re.items;s(Ke);const aa=(Xe=Ke.find(na=>na.collectionId===b.collectionId))==null?void 0:Xe.collectionId;U(aa)}).catch(()=>{E||(s([]),U(void 0))}).finally(()=>{E||ie(!1)}),()=>{E=!0}},[b.collectionId,v]),r.useEffect(()=>{if(!v||t!=="all_cards"&&F!=="new_card"){f([]);return}let E=!1;return jr({libraryId:v,limit:200}).then(Re=>{E||f(Re)}).catch(()=>{E||f([])}),()=>{E=!0}},[t,v,F]),r.useEffect(()=>{if(!v||!P){V([]),me(void 0);return}let E=!1;return Ie(!0),zr({libraryId:v,collectionId:P}).then(Re=>{var Xe,na,ba,da;if(E)return;V(Re);const Ke=(na=(Xe=Te.current.byLibrary)==null?void 0:Xe[v])==null?void 0:na.lastRevisionId,aa=((ba=Re.find(De=>De.revisionId===b.revisionId))==null?void 0:ba.revisionId)??((da=Re.find(De=>De.revisionId===Ke))==null?void 0:da.revisionId);me(aa)}).catch(()=>{E||(V([]),me(void 0))}).finally(()=>{E||Ie(!1)}),()=>{E=!0}},[b.revisionId,P,v]),r.useEffect(()=>{const E=b.infoId;if(!v||!E){d(void 0);return}let Re=!1;return it({libraryId:v,infoId:E}).then(Ke=>{if(Re)return;const aa=Ke.payload;d((aa==null?void 0:aa.label)??(aa==null?void 0:aa.name)??(aa==null?void 0:aa.title)??Ke.infoId)}).catch(()=>{Re||d(E)}),()=>{Re=!0}},[b.infoId,v]),r.useEffect(()=>{if(!pe.current||b.libraryId&&W.some(Ke=>Ke.libraryId===b.libraryId)&&b.libraryId!==v||b.target&&b.target!==F||b.revisionView&&b.revisionView!==ge||b.revisionId&&b.revisionId!==ue||dr[F].requiresCollection&&!P&&b.target==="all_collections"&&b.collectionId)return;const E=Pt(`${C.pathname}${C.search}`),Re=Pt(gr(v,F,P,ge,ue,b.infoId,b.infoView??"overview"));if(E===Re){Ue.current=null;return}Ue.current!==Re&&(Ue.current=Re,o(Re,{replace:!0}))},[W,C.pathname,C.search,o,b.collectionId,b.infoId,b.infoView,b.libraryId,b.revisionId,b.revisionView,b.target,P,v,ue,ge,F]),r.useEffect(()=>{if(typeof window>"u")return;const E=()=>{window.innerWidth>920&&ee(!1)};return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]),r.useEffect(()=>{if(!pe.current||!ra||!v||$e.current)return;const E=Te.current,Re={...E.byLibrary??{}},Ke={...Re[v]??{},lastCollectionId:P,lastRevisionId:ue,lastRevisionView:ge,lastTarget:F},aa={version:1,lastLibraryId:v,byLibrary:{...Re,[v]:Ke}},Xe=JSON.stringify(E),na=JSON.stringify(aa);if(Xe===na)return;Te.current=aa,$e.current=!0,(async()=>{try{if(X)await Ei(X,{plainValue:na});else{const da=await Ai(ra,{itemName:cr,itemType:"data",plainValue:na});Ae(da.dataItemId)}}catch{Pe(p.status.savePrefsFailed)}finally{$e.current=!1}})()},[X,ra,P,v,ue,ge,F,p.status.savePrefsFailed]);const Ba=async()=>{const E=ke.trim();if(!E){Pe(a.cogita.user.libraryNameRequired);return}Pe(null);try{const Re=await Di({name:E});_(Ke=>[Re,...Ke]),D(Re.libraryId),ne("library_overview"),U(void 0),Ye("")}catch{Pe(a.cogita.user.libraryCreateFailed)}},ya=async()=>{if(!v){Pe(p.status.selectLibraryFirst);return}const E=Oe.trim();if(!E){Pe(a.cogita.library.collections.saveRequiredName);return}Pe(null);try{const Re=await Fi({libraryId:v,name:E,items:[]}),Ke=await wt({libraryId:v,limit:200});s(Ke.items),U(Re.collectionId),me(void 0),ne("all_collections"),K("detail"),Ee("")}catch{Pe(a.cogita.library.collections.saveFail)}},oa=async()=>{if(!v||!P){Pe(p.status.selectLibraryFirst);return}const E=He.trim();if(!E){Pe(p.revisionForm.nameLabel);return}Pe(null);try{const Re=await Bi({libraryId:v,collectionId:P,name:E,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});V(Ke=>[Re,...Ke]),me(Re.revisionId),ne("all_collections"),K("settings"),sa("")}catch{Pe(p.status.loadFailed)}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${re?"open":""}`,"aria-label":p.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Be==null?void 0:Be.name)??p.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Be?p.sidebar.libraryActionsHint:p.status.selectLibraryFirst}),ca(Ge,"sidebar")]}),Sa?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:p.sidebar.infoActionsHint}),ca(Sa,"sidebar"),la?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(T==null?void 0:T.label)??le??a.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:p.sidebar.selectedInfoActionsHint}),ca(la,"sidebar")]}):null]}):null,_e?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:_e.name}),e.jsx("p",{className:"cogita-sidebar-note",children:p.sidebar.collectionActionsHint}),ca(Ra,"sidebar")]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:p.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:u,children:p.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{N("cogita"),ee(!1)},children:p.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:x?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),re?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":p.sidebar.closeMenu,onClick:()=>ee(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":p.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>ee(E=>!E),"aria-label":re?p.sidebar.closeMenu:p.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),We.map((E,Re)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Re>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,E.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":E.label,children:E.selectedLabel}):e.jsxs("select",{"aria-label":E.label,value:E.value,onChange:Ke=>E.onSelect(Ke.target.value),disabled:E.disabled,children:[E.emptyOption?e.jsx("option",{value:"",children:E.emptyOption}):null,E.options.map(Ke=>e.jsx("option",{value:Ke.value,children:Ke.label},`${E.key}:${Ke.value}`))]})]},`menu:${E.key}`))]}),xa?e.jsxs(e.Fragment,{children:[F==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Oe,onChange:E=>Ee(E.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!v})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,disabled:!v,children:a.cogita.library.actions.createCollection}),Ce?e.jsx("p",{className:"cogita-form-error",children:Ce}):null]}):null,F==="all_collections"&&P&&ge==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:p.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:E=>sa(E.target.value),placeholder:p.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:oa,children:p.revisionForm.createAction}),Ce?e.jsx("p",{className:"cogita-form-error",children:Ce}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Qr.Provider,{value:!0,children:xa})})]}):null,xa?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:p.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[We.map((E,Re)=>e.jsxs("span",{children:[Re>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:E.selectedLabel})]},`path:${E.key}`)),oe?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:p.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[p.path.currentRoute," ",e.jsx("code",{children:gr(v,F,P,ge,ue,b.infoId,b.infoView??"overview")})]}),v?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${v}`,children:p.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${v}/list`,children:p.links.allCards}),P?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${v}/collections/${P}/shared-revisions`,children:p.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:p.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:ke,onChange:E=>Ye(E.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ba,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Oe,onChange:E=>Ee(E.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!v})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,disabled:!v,children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:E=>sa(E.target.value),placeholder:p.revisionForm.namePlaceholder,disabled:!P})]}),e.jsx("button",{type:"button",className:"cta",onClick:oa,disabled:!P,children:p.revisionForm.createAction}),Ce?e.jsx("p",{className:"cogita-form-error",children:Ce}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:p.panels.collections}),se?e.jsx("p",{className:"cogita-library-subtitle",children:p.status.loadingCollections}):null,!se&&z.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:p.status.noCollections}):null,z.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:z.map(E=>e.jsxs("button",{type:"button",className:`cogita-card-item ${E.collectionId===P?"active":""}`,onClick:()=>{U(E.collectionId),me(void 0),K("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:p.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:E.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[E.itemCount," ",p.cards.itemsSuffix]})]},E.collectionId))}):null]})]})]})]})})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:qn},Symbol.toStringTag,{value:"Module"}));function Un({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,shareId:o}){const[C,b]=r.useState(null),[p,W]=r.useState("loading"),[_,z]=r.useState(a.cogita.library.collections.defaultName),[s,m]=r.useState("Cogita Library"),[f,he]=r.useState([]),[V,v]=r.useState([]),[D,F]=r.useState("idle"),[ne,P]=r.useState({current:0,total:0}),[U,ue]=r.useState(0),[me,ge]=r.useState(""),[K,le]=r.useState(null),[d,re]=r.useState(null),[ee,q]=r.useState(null),[Ne,se]=r.useState(null),[ie,Le]=r.useState([]),[Ie,Ce]=r.useState({}),[Pe,ke]=r.useState({}),[Ye,Oe]=r.useState(null),[Ee,He]=r.useState(null),[sa,ra]=r.useState(null),[R,X]=r.useState(null),[Ae,Te]=r.useState({}),pe=r.useRef(0),[$e,Ue]=r.useState(null),Be=r.useRef(null),_e=r.useRef(null),[j,k]=r.useState(null),[Q,t]=r.useState(!1),[i,h]=r.useState(null),[T,O]=r.useState([]),[ae,te]=r.useState(null),G=r.useRef(null),de=r.useRef(null),[oe,je]=r.useState(null),[ea,qe]=r.useState(0),ia=r.useRef(null),Ve=r.useRef({}),[We,Fe]=r.useState(!1),[Ge,Sa]=r.useState({}),la=r.useRef(null),Ra=r.useRef(new Set),ca=r.useRef({}),[xa,Ba]=r.useState([]),[ya,oa]=r.useState(new Set),[E,Re]=r.useState(!1),Ke=vr(),aa=r.useMemo(()=>new URLSearchParams(Ke.search),[Ke.search]),Xe=r.useMemo(()=>aa.get("key")??"",[aa]),na=(C==null?void 0:C.mode)??"random",ba=(C==null?void 0:C.check)??"exact",da=(C==null?void 0:C.limit)??20,De=r.useMemo(()=>Lr((C==null?void 0:C.revisionType)??na),[C,na]),ta=r.useMemo(()=>{const $=C==null?void 0:C.revisionSettings,Z=ti(De,aa);return Yt(De,$??Z)},[C,aa,De]),Ia=r.useMemo(()=>a.cogita.library.revision[De.labelKey]??na,[a,na,De]),$a=r.useMemo(()=>ba==="exact"?a.cogita.library.revision.checkValue:ba,[a,ba]),ve=p==="ready"?f[U]??null:null,Ua=(ve==null?void 0:ve.checkType)==="translation-match"&&R,La=r.useRef(new Map),qa=r.useRef(new Map),Wa=r.useRef(new Map),ma=r.useRef(new Map),za=r.useMemo(()=>ve?ve.cardType==="vocab"?a.cogita.library.revision.vocabLabel:ve.infoType?Ze(a,ve.infoType):a.cogita.library.revision.infoLabel:"",[a,ve]),nt=r.useMemo(()=>{var Z;return De.id!=="levels"?f.length:((Z=Ge.pool)==null?void 0:Z.length)??De.getFetchLimit(da,ta)},[Ge,ta,De,f.length,da]),ot=De.getProgressTotal?De.getProgressTotal(f,Ge,da,ta):De.id==="levels"?Math.min(da,nt):f.length,Ea=ot?Math.min(U+1,ot):0,ka=Math.max(1,Number(ta.tries??1)),Ha=ta.compare??"anchors",fa=Math.max(0,Math.min(100,Number(ta.minCorrectness??0))),ua=(ta.considerDependencies??"on")==="on",Pa=Math.max(0,Math.min(100,Number(ta.dependencyThreshold??85))),Qa=$=>{const Z=$.slice();for(let c=Z.length-1;c>0;c-=1){const y=Math.floor(Math.random()*(c+1));[Z[c],Z[y]]=[Z[y],Z[c]]}return Z},Ja=$=>$.length?$.reduce((c,y)=>c+y,0)/$.length/255*100:0,lt=$=>Ja($)>=fa,Qt=async()=>{const $=await Oa(),Z=new Map,c=new Map;$.forEach(M=>{const Y=`${M.itemType}:${M.itemId}`,S=Ka(M.itemType,M.itemId,M.checkType,M.direction);Z.has(Y)||Z.set(Y,[]),Z.get(Y).push(M),c.has(S)||c.set(S,[]),c.get(S).push(M)});const y=new Map,I=new Map;return Z.forEach((M,Y)=>y.set(Y,Va(M).score)),c.forEach((M,Y)=>I.set(Y,Va(M).score)),{itemKnowness:y,cardKnowness:I}},xt=async $=>{const Z=Ge,c=$.concat(Z.active??[]).concat(Z.pool??[]).filter((J,ce,be)=>be.findIndex(ye=>fe(ye)===fe(J))===ce);if(!ua){oa(new Set(c.map(fe)));return}const{itemKnowness:y,cardKnowness:I}=await Qt(),M=J=>{if(J.cardType!=="info"||J.infoType!=="quote"||J.checkType!=="quote-fragment")return!0;const ce=Ta(J.direction);if(!(ce!=null&&ce.fragmentId))return!0;const be=J.description??"";if(!be.trim())return!0;const xe=pt(be).nodes[ce.fragmentId];if(!xe||!xe.leftId&&!xe.rightId)return!0;const Me=[xe.leftId,xe.rightId].filter(Qe=>!!Qe);if(Me.length===0)return!0;const Se=Me.map(Qe=>{const ha=Ka("info",J.cardId,"quote-fragment",Tt(ce.mode,Qe));return I.get(ha)??0});return Se.reduce((Qe,ha)=>Qe+ha,0)/Se.length>=Pa},Y=(C==null?void 0:C.collectionId)??null,S=Y?xa.filter(J=>pa(J.childItemType)==="collection"&&J.childItemId===Y&&!pa(J.childCheckType)&&!pa(J.childDirection)):[],H=Y&&c.length>0?c.reduce((J,ce)=>J+(I.get(fe(ce))??0),0)/c.length:0,B=new Set;for(const J of c){if(J.cardType!=="info"){B.add(fe(J));continue}if(!M(J))continue;const ce=xa.filter(xe=>si(xe,J)).concat(S);if(ce.length===0){B.add(fe(J));continue}let be=0;for(const xe of ce)if(pa(xe.parentItemType)==="collection")be+=xe.parentItemId===Y?H:0;else if(pa(xe.parentCheckType)||pa(xe.parentDirection)){const Me=pa(xe.parentCheckType),Se=pa(xe.parentDirection),Je=Ka(xe.parentItemType,xe.parentItemId,Me,Se);be+=I.get(Je)??0}else{const Me=`${xe.parentItemType}:${xe.parentItemId}`;be+=y.get(Me)??0}be/ce.length>=Pa&&B.add(fe(J))}oa(B)},Gt=$=>{for(let Z=$;Z<f.length;Z+=1){const c=f[Z];if(c&&(!ua||c.cardType!=="info"||ya.has(fe(c))))return Z}return-1},st=$=>!ua||$.cardType!=="info"||ya.has(fe($)),Xt=$=>{if(De.id!=="temporal"&&De.id!=="levels")return null;const Z=Ge,c=(Z.active??[]).concat(Z.pool??[]),y=new Set;for(const I of c){const M=fe(I);if(!(y.has(M)||$.has(M))&&(y.add(M),st(I)))return I}return null},Ca=r.useMemo(()=>{if(De.id!=="levels")return null;const $=Ge,Z=$.pool??[],c=$.active??[],y=$.levelMap??{},I=Math.max(1,Number(ta.levels??1)),M=Array.from({length:I},()=>0),Y=new Set(c.map(J=>fe(J)));Z.forEach(J=>{const ce=Math.min(I,Math.max(1,y[fe(J)]??1));M[ce-1]+=1});const S=Z.length||1,H=M.map(J=>J/S*100),B=ve?y[fe(ve)]??1:null;return{counts:M,percentages:H,currentLevel:B,levelsCount:I,activeCount:c.length,poolCount:Z.length,activeSet:Y}},[Ge,ta,De,ve]),ct=r.useMemo(()=>{if(De.id!=="temporal")return null;const $=Ge,Z=$.pool??[],c=$.active??[],y=$.knownessMap??{},I=new Set($.unknownSet??[]);let M=0;Z.forEach(H=>{(y[fe(H)]??0)>1&&(M+=1)});const Y=I.size,S=c.map(H=>({id:fe(H),value:I.has(fe(H))?0:Math.max(0,Math.min(1,y[fe(H)]??0))}));return{knownCount:M,unknownCount:Y,dots:S}},[Ge,De]),Aa=r.useMemo(()=>{if(!ua)return 0;const $=Ge;return f.concat($.active??[]).concat($.pool??[]).filter((c,y,I)=>I.findIndex(M=>fe(M)===fe(c))===y).filter(c=>c.cardType==="info"&&!ya.has(fe(c))).length},[ua,Ge,f,ya]);r.useEffect(()=>{if(!ua||D!=="ready")return;const $=Ge,c=f.concat($.active??[]).concat($.pool??[]).filter((M,Y,S)=>S.findIndex(H=>fe(H)===fe(M))===Y).filter(M=>M.cardType!=="info"||ya.has(fe(M))).length,y=G.current;if(G.current=c,y===null||c<=y)return;const I=c-y;te(`New card available (+${I})`),de.current&&window.clearTimeout(de.current),de.current=window.setTimeout(()=>te(null),2200)},[ua,D,Ge,f,ya]),r.useEffect(()=>()=>{de.current&&window.clearTimeout(de.current)},[]);const va=($,Z)=>{const c=De.applyOutcome({queue:f,meta:Ge},ve,da,ta,{correct:$,correctness:Z,createdUtc:new Date().toISOString()});he(c.queue),Sa(c.meta);const y=c.queue[U+1];y&&Ma(y,U+1)};r.useEffect(()=>{if(!o){W("error");return}W("loading"),Ki({shareId:o,key:Xe}).then($=>{b($),z($.collectionName),m($.libraryName),W("ready")}).catch(()=>{W("error")})},[o,Xe]),r.useEffect(()=>{o&&Vi({shareId:o,key:Xe,type:"language"}).then($=>v($)).catch(()=>v([]))},[o,Xe]),r.useEffect(()=>{!o||p!=="ready"||Oi({shareId:o,key:Xe}).then($=>Ba($.items??[])).catch(()=>Ba([]))},[o,Xe,p]),r.useEffect(()=>{if(!o||p!=="ready")return;let $=!0;return(async()=>{F("loading"),P({current:0,total:De.id==="levels"?0:De.getFetchLimit(da,ta)});try{const c=[];let y=null,I=null;do{const ce=await _i({shareId:o,key:Xe,limit:300,cursor:y});if(c.push(...ce.items),(De.id==="levels"||De.id==="temporal")&&ce.total&&(I=ce.total),P(be=>({current:c.length,total:be.total||ce.total||De.getFetchLimit(da,ta)})),y=ce.nextCursor??null,I!==null&&c.length>=I||De.id!=="levels"&&De.id!=="temporal"&&c.length>=De.getFetchLimit(da,ta))break}while(y);if(!$)return;const M=pr(c);let Y;if(De.id==="levels"){const ce=Math.max(1,Number(ta.levels??1));Y={},M.forEach(be=>{const ye=fe(be);Y[ye]=Math.max(1,Math.min(ce,1))})}let S=null,H=null,B=null;if(De.id==="temporal"){const ce=await Oa(),be=new Set(M.map(Me=>fe(Me))),ye=ce.reduce((Me,Se)=>{const Je=Ka(Se.itemType,Se.itemId,Se.checkType,Se.direction);return be.has(Je)&&(Me[Je]||(Me[Je]=[]),Me[Je].push(Se)),Me},{});S={},H=new Set,B={};const xe=Date.now();M.forEach(Me=>{const Se=fe(Me),Je=ye[Se]??[];if(Je.length===0){S[Se]=0,H.add(Se),B[Se]=[];return}const Qe=kr(Je);B[Se]=Qe;const ha=Ht(Qe,xe);S[Se]=ha.knowness})}const J=De.id==="levels"?Nr(M,da,ta,Y):De.id==="temporal"?Tr(M,da,ta,S??{},H??new Set,B??{}):De.prepare(M,da,ta);he(J.queue),Sa(J.meta),ue(0),F("ready"),P(ce=>({current:Math.min(ce.current,ce.total),total:ce.total}))}catch{$&&F("error")}})(),()=>{$=!1}},[o,Xe,da,De,ta,p]),r.useEffect(()=>{xt(f)},[f,xa,ua,Pa,C==null?void 0:C.collectionId]),r.useEffect(()=>{if(!ve||!ua){Re(!1);return}if(ve.cardType!=="info"||ya.has(fe(ve))){Re(!1);return}const $=Gt(U+1);if($>=0){Re(!1),ue($);return}if(De.id==="temporal"||De.id==="levels"){const Z=f.slice(0,U+1),c=f.slice(U+1).filter(st),y=Z.concat(c),I=new Set(y.map(fe)),M=Xt(I);if(M){const S=fe(M);I.has(S)||(y.push(M),I.add(S),Sa(H=>{const B=H,J=new Set(B.queued??[]);return J.add(S),{...B,queued:J}}))}const Y=y.findIndex((S,H)=>H!==U&&st(S));if(Y>=0){he(y),ue(Y),Re(!1);return}}Re(!0)},[ve,ya,ua,U,f,Ge,De.id]),r.useEffect(()=>{if(ge(""),le(null),je(null),qe(0),Le([]),Ce({}),ke({}),Oe(null),He(null),ra(null),t(!1),Fe(!1),k(null),X(null),Te({}),!ve){re(null),q(null);return}ve.cardType==="info"&&ve.infoType==="computed"&&re(a.cogita.library.revision.loadingComputed);let $=!0;return Ma(ve,U).then(Z=>{!$||!Z||(re(Z.prompt),q(Z.expectedAnswer),Le(Z.computedExpected),Ce(Z.computedAnswers),Oe(Z.answerTemplate),He(Z.outputVariables),ra(Z.variableValues))}),()=>{$=!1}},[ve,o,a]),r.useEffect(()=>{if(!ve||ve.cardType!=="info"||ve.infoType!=="quote"){la.current=null,Ra.current=new Set,se(null);return}const $=ve.description??"",Z=(ve.label??"").trim(),c=Z.replace(/\s+/g," ").trim(),y=$.replace(/\s+/g," ").trim(),I=c&&c!==y?Z:a.cogita.library.infoTypes.quote;if(!$){se(null),q(null);return}const M=pt($);la.current=M,re(I);let Y=!0;return Oa().then(S=>{if(!Y)return;const H=getQuoteMode(ve.direction),B=new Map;S.forEach(xe=>{if(xe.itemType!=="info"||xe.checkType!=="quote-fragment"||!xe.direction)return;const Me=Ta(xe.direction);if(!Me||Me.mode!==H)return;const Se=`${xe.itemId}:${Me.fragmentId}`;B.has(Se)||B.set(Se,[]),B.get(Se).push(xe)});const J={},ce=new Set;B.forEach((xe,Me)=>{const[Se,Je]=Me.split(":",2);if(Se!==ve.cardId)return;const Qe=Va(xe).score;J[Je]=Qe,Qe>=Pa&&ce.add(Je)}),Ra.current=ce,ca.current=J;const be=Ta(ve.direction);if(be!=null&&be.fragmentId&&M.nodes[be.fragmentId]){Za(M,be.fragmentId,I);return}const ye=bt(M,ce,J,Pa,ua,ve.direction);Za(M,(ye==null?void 0:ye.id)??null,I)}).catch(()=>{Ra.current=new Set,ca.current={};const S=Ta(ve.direction);if(S!=null&&S.fragmentId&&M.nodes[S.fragmentId]){Za(M,S.fragmentId,I);return}const H=bt(M,Ra.current,{},Pa,ua,ve.direction);Za(M,(H==null?void 0:H.id)??null,I)}),()=>{Y=!1}},[ve,a,ua,Pa]),r.useEffect(()=>{if(!ve||ve.cardType!=="vocab"||ve.checkType!=="translation-match"){X(null),Te({});return}const c=(Ge.pool??Ge.active??f).filter(S=>S.cardType==="vocab"&&S.checkType==="translation-match").filter((S,H,B)=>B.findIndex(J=>J.cardId===S.cardId)===H);c.some(S=>S.cardId===ve.cardId)||c.unshift(ve);const I=Qa(c).slice(0,6).map(S=>{const H=S.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(H.length<2)return null;const B=`${S.cardId}:L`,J=`${S.cardId}:R`;return{cardId:S.cardId,leftId:B,rightId:J,leftLabel:H[0],rightLabel:H[1]}}).filter(Boolean),M=I.map(S=>S.leftId),Y=Qa(I.map(S=>S.rightId));X({pairs:I,leftOrder:M,rightOrder:Y,selection:{},activeLeft:null,activeRight:null,locked:{}})},[ve,f,Ge]),r.useEffect(()=>()=>{Be.current&&window.clearTimeout(Be.current),_e.current&&window.clearTimeout(_e.current)},[]);const dt=r.useRef(null);r.useEffect(()=>{if(!ve)return;const $=fe(ve),Z=typeof document<"u"?document.activeElement:null;if(dt.current===$&&Z&&(Z.tagName==="INPUT"||Z.tagName==="TEXTAREA"))return;let c=0;const y=()=>{if(ve){if(ve.cardType==="info"&&ve.infoType==="computed"){if(ie.length>0){const M=Wt(Ye,ie,Ee),Y=M?Ve.current[M]:null;if(Y&&(Y.focus(),document.activeElement===Y)){dt.current=$;return}}if(ia.current&&(ia.current.focus(),document.activeElement===ia.current)){dt.current=$;return}}else if(ve.cardType==="vocab"&&ia.current&&(ia.current.focus(),document.activeElement===ia.current)){dt.current=$;return}c<6&&(c+=1,window.setTimeout(y,40))}},I=window.setTimeout(y,40);return()=>window.clearTimeout(I)},[ve,ie,Ye,Ee]),r.useEffect(()=>{if(!We)return;const $=Z=>{Z.key==="Enter"&&(Z.preventDefault(),ut())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[We]);const ja=$=>{O($),h(Va($))};r.useEffect(()=>{if(!ve){h(null),O([]);return}const $=ve.cardType==="info"?"info":"connection";if(ve.cardType==="info"&&ve.infoType==="quote"){Oa().then(Z=>{const c=Z.filter(y=>y.itemType==="info"&&y.itemId===ve.cardId&&y.checkType==="quote-fragment"&&qt(y.direction,ve.direction));ja(c)}).catch(()=>{h(null),O([])});return}Ot($,ve.cardId,ve.checkType,ve.direction).then(Z=>ja(Z)).catch(()=>{h(null),O([])})},[ve]);const Ga=($,Z,c,y)=>{if($==="info"&&c==="quote-fragment"){Oa().then(I=>{const M=I.filter(Y=>Y.itemType==="info"&&Y.itemId===Z&&Y.checkType==="quote-fragment"&&qt(Y.direction,y));ja(M)}).catch(()=>{h(null),O([])});return}Ot($,Z,c,y).then(I=>ja(I)).catch(()=>{h(null),O([])})},Xa=($,Z,c)=>{var Y;const y=((Y=c.pairs.find(S=>S.leftId===$))==null?void 0:Y.rightId)??null;if(!y)return c;const I=y===Z;Te(S=>({...S,[$]:I?"correct":"incorrect"})),Be.current&&window.clearTimeout(Be.current),_e.current&&window.clearTimeout(_e.current),pe.current+=1;const M={kind:I?"correct":"incorrect",tick:pe.current};if(Ue(null),Be.current=window.setTimeout(()=>Ue(M),0),_e.current=window.setTimeout(()=>Ue(null),420),I){const S={...c.locked,[$]:!0};return Object.keys(S).length>=c.pairs.length?(le("correct"),Fe(!0)):le("correct"),{...c,selection:{...c.selection,[$]:Z},activeLeft:null,activeRight:null,locked:S}}return le("incorrect"),{...c,activeLeft:null,activeRight:null}},Lt=$=>{X(Z=>!Z||Z.locked[$]?Z:Z.activeRight?Xa($,Z.activeRight,Z):{...Z,activeLeft:Z.activeLeft===$?null:$})},Ct=$=>{X(Z=>Z&&(Z.activeLeft?Xa(Z.activeLeft,$,Z):{...Z,activeRight:Z.activeRight===$?null:$}))},ut=()=>{var $;if(ve&&ve.cardType==="info"&&ve.infoType==="quote"&&la.current&&Ne&&!(($=Ta(ve.direction))!=null&&$.fragmentId)){const Z=bt(la.current,Ra.current,ca.current,Pa,ua,ve.direction,Ne.fragmentId);if(Z){le(null),ge(""),t(!1),ke({}),Fe(!1),je(null),qe(0),Za(la.current,Z.id,Ne.title);return}}le(null),ge(""),t(!1),ke({}),Fe(!1),je(null),qe(0),ue(Z=>Math.min(Z+1,f.length))},Fa=$=>{if(!ve)return;const Z=$.expected??null,c=$.answer??"";let y=Z??"",I=c;if(!Z&&$.expectedMap&&$.answerMap){const ce=Object.keys($.expectedMap).sort((be,ye)=>be.localeCompare(ye));y=ce.map(be=>{var ye;return((ye=$.expectedMap)==null?void 0:ye[be])??""}).join("|"),I=ce.map(be=>{var ye;return((ye=$.answerMap)==null?void 0:ye[be])??""}).join("|")}const M=y?mt(y,I,Ha):new Uint8Array,Y={revisionType:De.id,evalType:$.evalType,direction:$.direction,prompt:d??"",expected:Z,answer:c,expectedAnswers:$.expectedMap??null,answers:$.answerMap??null,correct:$.correct,maskBase64:M.length?Ya(M):null,checkMode:ba,compareMode:Ha,minCorrectness:fa},S=new TextEncoder().encode(JSON.stringify(Y)),H=ve.cardType==="info"?"info":"connection",B=$.overrideCheckType??ve.checkType??null,J=$.overrideDirection??ve.direction??null;Vt({itemType:H,itemId:ve.cardId,checkType:B,direction:J,revisionType:De.id,evalType:$.evalType,correct:$.correct,maskBase64:M.length?Ya(M):null,payloadBase64:Ya(S)}).then(()=>{Ga(H,ve.cardId,B,J),xt(f)}).catch(()=>{})},gt=($,Z)=>{const c=La.current.get(Z);if(c)return Promise.resolve(c);const y=qa.current.get(Z);if(y)return y;const I=qi({shareCode:o,infoId:$,key:Xe}).then(M=>{var ce,be;const Y=M.payload,S=((ce=Y.definition)==null?void 0:ce.graph)??null,H="",B=((be=Y.definition)==null?void 0:be.answerTemplate)??"",J=wr(S,H,B);if(J){const xe={sample:Xr(J),answerTemplate:B||null};return La.current.set(Z,xe),xe}return Sr({shareId:o,infoId:$,key:Xe}).then(ye=>{const xe={sample:ye,answerTemplate:null};return La.current.set(Z,xe),xe})}).catch(()=>Sr({shareId:o,infoId:$,key:Xe}).then(M=>{const Y={sample:M,answerTemplate:null};return La.current.set(Z,Y),Y}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{qa.current.delete(Z)});return qa.current.set(Z,I),I},Ma=($,Z)=>{var S;const c=`${fe($)}:${Z}`,y=Wa.current.get(c);if(y)return Promise.resolve(y);const I=ma.current.get(c);if(I)return I;const M=H=>(Wa.current.set(c,H),H);let Y;if($.cardType==="vocab"){if($.checkType==="translation-match")return Y=Promise.resolve(M({prompt:$.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),Y;const H=$.label.split("↔").map(B=>B.trim()).filter(Boolean);if(H.length>=2){const J=($.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ce=J?H[0]:H[1],be=J?H[1]:H[0];Y=Promise.resolve(M({prompt:ce,expectedAnswer:be,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else Y=Promise.resolve(M({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if($.cardType==="info"&&$.infoType==="word"){const H=(S=$.description)!=null&&S.startsWith("Language: ")?$.description.replace("Language: ",""):null;Y=Promise.resolve(M({prompt:$.label,expectedAnswer:H,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else $.cardType==="info"&&$.infoType==="computed"?Y=gt($.cardId,c).then(H=>{var ye,xe;if(!H.sample)return M({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const B=H.sample,J=B.expectedAnswers?Object.entries(B.expectedAnswers).map(([Me,Se])=>({key:Me,expected:Se})):[],ce=J.reduce((Me,Se)=>(Me[Se.key]="",Me),{}),be=B.expectedAnswerIsSentence&&((ye=B.expectedAnswer)==null?void 0:ye.trim())||null;return M({prompt:B.prompt,expectedAnswer:J.length>0?be:((xe=B.expectedAnswer)==null?void 0:xe.trim())||null,computedExpected:J,computedAnswers:ce,answerTemplate:H.answerTemplate,outputVariables:B.outputVariables??null,variableValues:B.variableValues??null})}).catch(()=>M({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{ma.current.delete(c)}):Y=Promise.resolve(M({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return ma.current.set(c,Y),Y},Za=($,Z,c)=>{const y=Object.keys($.nodes).length,I=Ra.current.size;if(!Z){se({title:c,before:$.text,after:"",fragmentId:null,total:y,completed:I}),q(null),Fe(!0);return}const M=$.nodes[Z];if(!M)return;const Y=Zr($.text,M);se({title:c,before:Y.before,after:Y.after,fragmentId:M.id,total:y,completed:I}),q(Y.fragment),Fe(!1)},yt=()=>{const $=la.current;$&&se(Z=>Z&&{...Z,total:Object.keys($.nodes).length,completed:Ra.current.size})},Da=()=>{const $=f[U+1];$&&Ma($,U+1)},Mt=()=>{if(Da(),ve&&ve.cardType==="vocab"&&ve.checkType==="translation-match"&&R){if(R.pairs.length===0){le("incorrect"),Fe(!0);return}const M=R.pairs.reduce((be,ye)=>(be[ye.rightId]=ye.rightLabel,be),{});let Y=0;const S={};R.pairs.forEach(be=>{const xe=R.selection[be.leftId]===be.rightId;S[be.leftId]=xe?"correct":"incorrect",xe&&(Y+=1)});const H=R.pairs.length||1,B=Y/H,J=Y===R.pairs.length;Te(be=>({...be,...S})),J?(le("correct"),Fe(!0),qe(0)):(le("incorrect"),Fe(!1),qe(be=>{const ye=be+1;return ye>=ka&&(t(!0),Fe(!0),X(xe=>{if(!xe)return xe;const Me=xe.pairs.reduce((Se,Je)=>(Se[Je.leftId]=Je.rightId,Se),{});return{...xe,selection:Me}})),ye})),va(J,B);const ce="connection";Promise.all(R.pairs.map(be=>{const ye=R.selection[be.leftId]??null,xe=ye?M[ye]:"",Me={left:be.leftLabel,expected:be.rightLabel,answer:xe,checkType:"translation-match"},Se=new TextEncoder().encode(JSON.stringify(Me));return Vt({itemType:ce,itemId:be.cardId,checkType:"translation-match",direction:null,revisionType:De.id,evalType:"translation-match",correct:ye===be.rightId,maskBase64:null,payloadBase64:Ya(Se)})})).then(()=>{Ga(ce,ve.cardId,ve.checkType,ve.direction),xt(f)}).catch(()=>{});return}if(ie.length>0){const M=ie.reduce((S,H)=>{const B=Ie[H.key]??"";return S[H.key]=wa(B)===wa(H.expected)?"correct":"incorrect",S},{});ie.every(({key:S,expected:H})=>{const B=Ie[S]??"";return ba==="exact"&&wa(B)===wa(H)})?(le("correct"),ke(M),Fe(!0),qe(0),va(!0,1),Fa({correct:!0,direction:d?`${d} -> computed`:"computed",expectedMap:ie.reduce((S,H)=>(S[H.key]=H.expected,S),{}),answerMap:Ie,evalType:"computed"})):(le("incorrect"),ke(M),Fe(!1),qe(S=>{const H=S+1;return H>=ka&&et&&(t(!0),Fe(!0)),H}),va(!1,0),window.setTimeout(()=>{var H;const S=Wt(Ye,ie,Ee);S&&Ve.current[S]&&((H=Ve.current[S])==null||H.focus())},40),Fa({correct:!1,direction:d?`${d} -> computed`:"computed",expectedMap:ie.reduce((S,H)=>(S[H.key]=H.expected,S),{}),answerMap:Ie,evalType:"computed"}));return}if(ve&&ve.cardType==="info"&&ve.infoType==="quote"&&(Ne!=null&&Ne.fragmentId)){if(!ee)return;const M=Ta(ve.direction),Y=(M==null?void 0:M.mode)??getQuoteMode(ve.direction),S=M!=null&&M.fragmentId&&ve.direction?ve.direction:Tt(Y,Ne.fragmentId),H=li(ee,me,Ha),B=ba==="exact"&&ft(me)===ft(ee),J=lt(H),ce=B||J,be=Ja(H);ce?(ca.current[Ne.fragmentId]=Math.max(ca.current[Ne.fragmentId]??0,be),(ca.current[Ne.fragmentId]??0)>=Pa&&Ra.current.add(Ne.fragmentId),yt(),le("correct"),ke({}),Fe(!0),je(H),qe(0),be<100&&ka<=1&&t(!0),va(!0,be/100),Fa({correct:!0,direction:`quote:${Ne.fragmentId}`,expected:ee,answer:me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:S})):(le("incorrect"),ke({}),Fe(!1),je(H),qe(ye=>{const xe=ye+1;return xe>=ka&&et&&(t(!0),Fe(!0)),xe}),va(!1,be/100),window.setTimeout(()=>{var ye;return(ye=ia.current)==null?void 0:ye.focus()},40),Fa({correct:!1,direction:`quote:${Ne.fragmentId}`,expected:ee,answer:me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:S}));return}if(!ee)return;const $=mt(ee,me,Ha),Z=ba==="exact"&&wa(me)===wa(ee),c=lt($),y=Z||c,I=Ja($);y?(le("correct"),ke({}),Fe(!0),je($),qe(0),I<100&&ka<=1&&t(!0),va(!0,I/100),Fa({correct:!0,direction:d?`${d} -> ${ee}`:null,expected:ee,answer:me,evalType:"text"})):(le("incorrect"),ke({}),Fe(!1),je($),qe(M=>{const Y=M+1;return Y>=ka&&et&&(t(!0),Fe(!0)),Y}),va(!1,I/100),window.setTimeout(()=>{var M;return(M=ia.current)==null?void 0:M.focus()},40),Fa({correct:!1,direction:d?`${d} -> ${ee}`:null,expected:ee,answer:me,evalType:"text"}))},ht=$=>{if(Da(),!ee)return;const Z=mt(ee,$,Ha),c=wa($)===wa(ee),y=lt(Z),I=c||y,M=Ja(Z);I?(le("correct"),ke({}),Fe(!0),je(Z),qe(0),M<100&&ka<=1&&t(!0),va(!0,M/100),Fa({correct:!0,direction:"word->language",expected:ee,answer:$,evalType:"language-select"})):(le("incorrect"),ke({}),Fe(!1),je(Z),qe(Y=>{const S=Y+1;return S>=ka&&et&&(t(!0),Fe(!0)),S}),va(!1,M/100),Fa({correct:!1,direction:"word->language",expected:ee,answer:$,evalType:"language-select"}))},St=$=>{var c;if($.key!=="Enter")return;if($.preventDefault(),$.stopPropagation(),We){ut();return}const Z=ie.find(y=>!(Ie[y.key]??"").trim());if(Z){(c=Ve.current[Z.key])==null||c.focus();return}Mt()},Zt=()=>{Da(),le("correct"),Fe(!0),qe(0),va(!0,1),ee&&Fa({correct:!0,direction:"manual",expected:ee,answer:me,evalType:"manual"})},er=()=>{if(va(!1,0),ve&&ve.cardType==="info"&&ve.infoType==="quote"){le(null),ge(""),t(!1),ke({}),Fe(!1),je(null),qe(0),ue($=>Math.min($+1,f.length));return}ut()};r.useEffect(()=>{Da()},[U,f]);const ar=a.cogita.library.revision.revealModeAfterIncorrect,et=ie.length>0||!!ee;return e.jsxs(Na,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:[(p==="loading"||D==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:p==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ne.total?Math.min(100,Math.max(0,ne.current/ne.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ne.total?`${Math.min(ne.current,ne.total)} / ${ne.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:_}),e.jsx("p",{className:"cogita-library-subtitle",children:s}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",Ia).replace("{check}",$a)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:i?`${i.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ca?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Ca.currentLevel??"-"," / ",Ca.levelsCount]}):null,i?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(i.correct)).replace("{total}",String(i.total))}),i.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(i.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[ae?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:ae})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":$e?`${$e.kind}-${$e.tick}`:Ua?"idle":K??"idle",children:p!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:p==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):ve?e.jsx(e.Fragment,{children:E?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:ve,currentTypeLabel:za,prompt:d,languages:V,answer:me,onAnswerChange:$=>ge(Z=>Ut(Z,$,j)),computedExpected:ie,computedAnswers:Ie,onComputedAnswerChange:($,Z)=>Ce(c=>({...c,[$]:Ut(c[$]??"",Z,j)})),answerTemplate:Ye,outputVariables:Ee,variableValues:sa,computedFieldFeedback:Pe,feedback:K,canAdvance:We,quoteContext:Ne,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:er,onLanguageSelect:ht,onMarkReviewed:Zt,onAdvance:ut,showCorrectAnswer:Q,setShowCorrectAnswer:t,onRevealCorrect:()=>Fe(!0),answerMask:oe,expectedAnswer:ee,hasExpectedAnswer:et,handleComputedKeyDown:St,answerInputRef:ia,computedInputRefs:Ve,scriptMode:j,setScriptMode:k,matchPairs:R==null?void 0:R.pairs,matchLeftOrder:R==null?void 0:R.leftOrder,matchRightOrder:R==null?void 0:R.rightOrder,matchSelection:R==null?void 0:R.selection,matchActiveLeft:R==null?void 0:R.activeLeft,matchActiveRight:R==null?void 0:R.activeRight,matchFeedback:Ae,onMatchLeftSelect:Lt,onMatchRightSelect:Ct})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ot?`${Ea} / ${ot}`:a.cogita.library.revision.progressUnlimited}),p==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),p==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),p==="ready"&&D==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),p==="ready"&&D==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),p==="ready"&&D==="ready"&&f.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:ar}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",ka]})]})]}),Ca?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Ca.activeCount," / ",Ca.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ca.counts.map(($,Z)=>{const c=Z+1,y=Ca.currentLevel===c,I=Ca.percentages[Z]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":y,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:c}),e.jsx("strong",{children:$})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,I))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[I.toFixed(1),"%"]})]},`level-${c}`)})})]}):null,ct?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ct.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ct.dots.map($=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-$.value))}, ${Math.round(200*$.value)}, 80, 0.9)`}},$.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ct.knownCount})]})]}):null,ua?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Aa})]})}):null]})]})]})})})]})]})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Un},Symbol.toStringTag,{value:"Module"}));export{Jn as C,Yn as a,Qn as b};
