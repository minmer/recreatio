import{r as i,j as e,R as Wt,B as zt,C as Ht,H as Mr,P as Sr,a as jt,b as gi,c as hi,u as vr,d as jr,e as wr,f as bi}from"./vendor-DrCXrCXJ.js";import{L as Vr,A as qr,g as _r,a as mi,b as wt,c as Ur,s as Rt,d as Wr,e as zr,f as Xa,h as pr,i as Et,j as fr,k as pi,l as nr,m as Za,u as fi,n as da,o as xi,p as yi,q as vi,r as Hr,t as Jr,v as ji,w as wi,x as ki,y as Yr,z as Qr,B as Jt,C as Ft,D as Ti,E as Ni,F as Li,G as Ci,H as Mi,I as Si,J as Ua,K as Ii,M as Pi,N as $i,O as Ri,P as Ei,Q as Fi,R as Ai,S as Bi,T as Di,U as Ki,V as Oi,W as Vi,X as qi,Y as _i,Z as Ir}from"./recreatio-core-xHpCEmaC.js";import"./vendor-cogita-ui-DLgJCpO3.js";const vt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},yt={moveMs:900,pauseMs:220,errorMs:900},Ui=(a=11)=>{let n=a;const o=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:u,height:g,paddingX:w,paddingY:p,levels:S}=vt,R=(g-p*2)/(S.length-1),B=[],l=[],L=[];S.forEach((b,f)=>{const X=g-p-f*R,F=u-w*2,v=[];for(let G=0;G<b;G+=1){const P=w+(G+1)*F/(b+1),se=(o()-.5)*18,O=Math.max(w,Math.min(u-w,P+se)),V=f===0?3:f<2?2.1:1.4,he=f===0?"root":`l${f}-${G}`;v.push({id:he,x:f===0?u/2:O,y:X,r:V,level:f,role:f===0?"root":void 0})}L.push(v),B.push(...v)});const m=L[L.length-1];if(m!=null&&m.length){const b=m[Math.floor(m.length/2)];b.role="goal",b.r=2}for(let b=1;b<L.length;b+=1){const f=L[b-1];L[b].forEach(F=>{const v=[...f].sort((O,V)=>Math.abs(O.x-F.x)-Math.abs(V.x-F.x)),G=v[0],P=v[1]&&o()<.45?v[1]:null;(P?[G,P]:[G]).forEach(O=>{l.push({from:O.id,to:F.id,key:`${O.id}-${F.id}`})}),o()<.2&&v[2]&&l.push({from:v[2].id,to:F.id,key:`${v[2].id}-${F.id}`})})}const x=new Map;l.forEach(b=>{const f=x.get(b.to)??[];f.push(b.from),x.set(b.to,f)});const _=new Map,H=new Map,U=new Map;l.forEach(b=>{const f=_.get(b.from)??[];f.push(b.key),_.set(b.from,f);const X=H.get(b.from)??[];X.push(b.to),H.set(b.from,X);const F=U.get(b.from)??[];F.push(b.to),U.set(b.from,F);const v=U.get(b.to)??[];v.push(b.from),U.set(b.to,v)});const c=new Map;return B.forEach(b=>{c.set(b.id,b)}),{nodes:B,links:l,parentsById:x,linksByFrom:_,childrenByFrom:H,neighborsById:U,nodesById:c}};function Wi({slides:a,activeIndex:n,introOpen:o,prefersReducedMotion:u,onNext:g,onPrev:w,onSelect:p,onExit:S,onOpen:R,onRegister:B}){const l=n===a.length-1,L=o&&n===0?"entry":"docked",m=a[a.length-1],[x,_]=i.useState(!1),H=i.useMemo(()=>Array.from({length:20},(j,k)=>({src:`/cogita/logo/Cogita${String(k).padStart(2,"0")}.png`,kind:k<=11?"bubble":k<=17?"text":"recreatio"})),[]),U=o&&n===0;i.useEffect(()=>{if(!o){_(!1);return}n>0&&!x&&_(!0)},[n,o,x]);const c=i.useRef(0),b=i.useRef(null),f=i.useMemo(()=>{const j={x:40,y:160},k={x:260,y:48},Q=6,t=k.x-j.x,r=j.y-k.y,h=t/Q,T=[.3,.45,.6,.65,1.4,2.2],q=T.reduce((ce,ve)=>ce+ve,0),ae=T.map(ce=>r*ce/q),te=[j];let re=j.x,ge=j.y;for(let ce=1;ce<=Q;ce+=1){const ve=(Math.random()-.5)*14,ea=(Math.random()-.5)*28;re=Math.max(j.x+ce*14,Math.min(k.x-(Q-ce)*14,re+h+ve));const Je=ae[ce-1]??ae[ae.length-1];ge=ge-Je+ea;const ra=Math.max(k.y,Math.min(j.y-4,ge));te.push({x:Math.round(re),y:Math.round(ra)})}return te[te.length-1]=k,te},[]),X=i.useMemo(()=>{const r=(q,ae,te)=>Math.min(te,Math.max(ae,q)),h=f.map(q=>{const ae=10+Math.random()*36;return{x:r(q.x,40,260),y:r(q.y-ae,40,140)}}),T=f.map((q,ae)=>{var ge;const te=12+Math.random()*40,re=((ge=h[ae])==null?void 0:ge.y)??q.y;return{x:r(q.x,40,260),y:r(Math.max(re+10,q.y+te),60,170)}});return{upper:h,lower:T}},[f]),F=i.useMemo(()=>{var k;const j=((k=f[4])==null?void 0:k.x)??260;return Math.max(0,Math.min(240,j-40))},[f]),v=i.useMemo(()=>{var ae,te;const j=(re,ge,ce)=>Math.min(ce,Math.max(ge,re)),k=(re,ge,ce)=>f.map((ve,ea)=>{var Ee,Ie;const Je=((Ee=X.upper[ea])==null?void 0:Ee.y)??ve.y,ra=((Ie=X.lower[ea])==null?void 0:Ie.y)??ve.y,qe=(Math.random()-.5)*70,Ye=ve.y+re+qe,_e=j(ve.y+ge,Je+6,ra-6),A=j(ve.y+ce,Je+6,ra-6);return{x:ve.x,y:j(Ye,Math.min(_e,A),Math.max(_e,A))}}),Q=-14+Math.random()*28,t=14+Math.random()*28,r=k(Q,-80,12),h=k(t,-12,80);for(let re=4;re<f.length;re+=1){const ge=f[re],ce=((ae=X.upper[re])==null?void 0:ae.y)??ge.y,ve=((te=X.lower[re])==null?void 0:te.y)??ge.y;r[re]={x:ge.x,y:j(ge.y-12,ce+6,ve-6)},h[re]={x:ge.x,y:j(ge.y+12,ce+6,ve-6)}}const T=X.upper.length?X.upper[X.upper.length-1].y:40,q=X.lower.length?X.lower[X.lower.length-1].y:170;return r[r.length-1]={x:f[f.length-1].x,y:j(f[f.length-1].y-14,T,q)},h[h.length-1]={x:f[f.length-1].x,y:j(f[f.length-1].y+12,T,q)},{higher:r,lower:h}},[f,X]),G=1e4,P=i.useMemo(()=>{let j=17;const k=()=>(j=(j*1664525+1013904223)%4294967296,j/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const h=(k()-.5)*240,T=(k()-.5)*180,q=(k()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${h.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${q.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),se=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[O,V]=i.useState([]),he=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),be=i.useMemo(()=>{const k=[],t=(h,T)=>h+Math.random()*(T-h);for(let h=0;h<6;h+=1){let T=!1;for(let q=0;q<80;q+=1){const ae=t(14,86),te=t(10,34);if(k.every(ge=>{const ce=ge.x-ae,ve=ge.y-te;return Math.hypot(ce,ve)>=12})){k.push({x:ae,y:te}),T=!0;break}}T||k.push({x:t(16,84),y:t(12,32)})}return k.map((h,T)=>({id:`p${T+1}`,x:`${h.x.toFixed(1)}%`,y:`${h.y.toFixed(1)}%`,xNum:h.x,yNum:h.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[le,K]=i.useState(0),[de,s]=i.useState(0),[ne,N]=i.useState([]),$=1e4,Te=i.useMemo(()=>{if(be.length<2)return[];const j=T=>{let q=T+1831565813;return q=Math.imul(q^q>>>15,q|1),q^=q+Math.imul(q^q>>>7,q|61),((q^q>>>14)>>>0)/4294967296},k=(T,q)=>Math.floor(j(T)*q),Q=new Set,t=[],r=Math.min(3,be.length);let h=0;for(;t.length<r&&h<30;){h+=1;const T=k(le*13+h*5,be.length),q=k(le*29+h*7,be.length);if(T===q)continue;const ae=T<q?`${T}-${q}`:`${q}-${T}`;Q.has(ae)||(Q.add(ae),t.push({id:`link-${ae}`,from:be[T],to:be[q],delay:`${(h*.35).toFixed(2)}s`}))}return t},[le,be]);i.useEffect(()=>{if(!o||n!==2)return;const j=()=>{const Q=P.map(t=>t.id);for(let t=Q.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[Q[t],Q[r]]=[Q[r],Q[t]]}return Q.slice(0,4)};V(j());const k=window.setInterval(()=>{V(j())},G);return()=>window.clearInterval(k)},[n,o,P,G]),i.useEffect(()=>{if(!o||n!==3)return;const j=()=>{s(Math.floor(Math.random()*he.length)),N(be.map(()=>Math.random()<.6?"good":"bad")),K(Q=>Q+1)};j();const k=window.setInterval(j,$);return()=>window.clearInterval(k)},[n,o,he.length,be,$]);const ie=i.useMemo(()=>Ui(11),[]),[oe,we]=i.useState(new Set(["root"])),[Le,Ne]=i.useState(new Set),[Be,Me]=i.useState(new Set),[Qe,Ke]=i.useState({fromId:"root",toId:"root",key:0}),Fe=i.useRef(oe),We=i.useRef("root"),oa=i.useRef(0),Re=i.useRef(null),W=i.useRef(null),Z=i.useRef([]);i.useEffect(()=>{Fe.current=oe},[oe]);const De=i.useMemo(()=>{const j=new Set;return oe.forEach(k=>{const Q=ie.linksByFrom.get(k);Q&&Q.forEach(t=>j.add(t))}),j},[oe,ie]),Ce=ie.nodesById.get(Qe.toId)??ie.nodesById.get("root"),fe=Ce?`${Ce.x/vt.width*100}%`:"50%",Pe=Ce?`${Ce.y/vt.height*100}%`:"90%";i.useEffect(()=>{if(!o||n!==1||u)return;(()=>{we(new Set(["root"])),Ne(new Set),Me(new Set),Ke({fromId:"root",toId:"root",key:0}),W.current=null,oa.current=0,We.current="root",Z.current=[]})();const k=()=>{const t=We.current,r=Fe.current,T=(ie.childrenByFrom.get(t)??[]).filter(ve=>!r.has(ve));if(T.length)return T[Math.floor(Math.random()*T.length)];if(r.size>=ie.nodes.length){const ve=ie.neighborsById.get(t)??[];return ve.length?ve[Math.floor(Math.random()*ve.length)]:null}const q=ve=>(ie.childrenByFrom.get(ve)??[]).some(Je=>!r.has(Je)),ae=[t],te=new Set([t]),re=new Map;let ge=null;for(;ae.length;){const ve=ae.shift();if(!ve)break;if(ve!==t&&q(ve)){ge=ve;break}(ie.neighborsById.get(ve)??[]).forEach(Je=>{te.has(Je)||(te.add(Je),re.set(Je,ve),ae.push(Je))})}if(!ge)return null;let ce=ge;for(;re.get(ce)&&re.get(ce)!==t;)ce=re.get(ce)??ce;return ce},Q=(t,r)=>{if(t===r){const h=k();h&&Q(t,h);return}oa.current+=1,Ke({fromId:t,toId:r,key:oa.current}),We.current=r,Re.current=window.setTimeout(()=>{const h=ie.parentsById.get(r)??[],T=Fe.current,q=h.filter(ge=>!T.has(ge));if(!q.length){const ge=new Set(T);ge.add(r),we(ge),Re.current=window.setTimeout(()=>{for(;Z.current.length;){const ve=Z.current[Z.current.length-1];if(!ge.has(ve)){if(ve!==r){Q(r,ve);return}break}Z.current.pop()}const ce=k();ce&&Q(r,ce)},yt.pauseMs);return}const ae=new Set([r,...q]),te=new Set(q.map(ge=>`${ge}-${r}`));Ne(ae),Me(te),Z.current.includes(r)||Z.current.push(r);const re=q[Math.floor(Math.random()*q.length)];W.current={fromId:r,toId:re},Re.current=window.setTimeout(()=>{Ne(new Set),Me(new Set);const ge=W.current;ge&&Q(ge.fromId,ge.toId)},yt.errorMs)},yt.moveMs)};return Re.current=window.setTimeout(()=>{const t=k();t&&Q(We.current,t)},yt.pauseMs),()=>{Re.current&&window.clearTimeout(Re.current)}},[n,o,ie,u]);const Oe=j=>{if(!o)return;const k=Date.now();k-c.current<520||Math.abs(j.deltaY)<10||(c.current=k,j.deltaY>0?g():w(),j.preventDefault())},Ve=j=>{if(!o)return;const k=j.touches[0];k&&(b.current={x:k.clientX,y:k.clientY})},Ae=j=>{if(!o)return;const k=b.current;if(b.current=null,!k)return;const Q=j.changedTouches[0];if(!Q)return;const t=Q.clientX-k.x,r=Q.clientY-k.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?g():w())};return e.jsxs("div",{className:`cogita-intro ${o?"is-open":"is-closed"} ${u?"is-reduced":""} ${l?"is-final":""}`,"data-slide":n+1,onWheel:Oe,onTouchStart:Ve,onTouchEnd:Ae,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":L,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${U&&!x?"is-entry":""}`,children:H.map((j,k)=>e.jsx("img",{src:j.src,alt:"",className:`cogita-logo-layer ${k===0?"is-base":""} ${j.kind==="text"?"is-text":j.kind==="recreatio"?"is-recreatio":""} ${j.kind==="bubble"?"is-bubble":""}`},j.src))})}),o&&a.map((j,k)=>{const Q=k===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${k+1} ${Q?"is-active":""}`,"aria-hidden":!Q,children:[e.jsxs("div",{className:"cogita-intro-text",children:[j.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:j.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:j.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:j.title}),j.body&&e.jsx("p",{children:j.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),j.micro&&e.jsx("p",{className:"cogita-intro-micro",children:j.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:l?B:g,children:j.cta}),l&&j.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>p(0),children:j.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[k===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${vt.width} ${vt.height}`,preserveAspectRatio:"none",children:[ie.links.map(t=>{const r=ie.nodesById.get(t.from),h=ie.nodesById.get(t.to);if(!r||!h)return null;const T=De.has(t.key),q=Be.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${q?"is-error":""}`,x1:r.x,y1:r.y,x2:h.x,y2:h.y},t.key)}),ie.nodes.map(t=>{const r=oe.has(t.id),h=Le.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${h?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Ce&&e.jsx("span",{className:"map-explorer-dot",style:{left:fe,top:Pe,"--move":`${yt.moveMs}ms`}})]}),k===2&&e.jsx("div",{className:"cogita-index-cards",children:P.map(t=>{const r=O.indexOf(t.id),h=r>=0?se[r]:null,T=(h==null?void 0:h.x)??"140px",q=(h==null?void 0:h.y)??"140px",ae=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":q,"--stack-opacity":ae,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),k===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[he.map((t,r)=>e.jsxs("div",{className:`round-card ${r===de?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),he[de]&&e.jsx("span",{className:"round-ring",style:{"--card-x":he[de].x,"--card-y":`calc(${he[de].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:be.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Te.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:be.map((t,r)=>{const h=ne[r]??"good",T=he[de];if(!T)return null;const q=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":q,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${h}`,style:{"--from-x":T.x,"--from-y":q,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${h}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${le}`)})})]},`round-${le}`),k===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${f[0].x} ${f[0].y} L${f[1].x} ${f[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${f[1].x} ${f[1].y} L${f[2].x} ${f[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${f[2].x} ${f[2].y} L${f[3].x} ${f[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${f[3].x} ${f[3].y} L${f[4].x} ${f[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${f[4].x} ${f[4].y} L${f[5].x} ${f[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${f[5].x} ${f[5].y} L${f[6].x} ${f[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${F};${F};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${X.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${X.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${X.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${X.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[v.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${v.higher[r+1].x} ${v.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),v.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${v.lower[r+1].x} ${v.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${f[0].x/300*100}%`,"--p0y":`${f[0].y/200*100}%`,"--p1x":`${f[1].x/300*100}%`,"--p1y":`${f[1].y/200*100}%`,"--p2x":`${f[2].x/300*100}%`,"--p2y":`${f[2].y/200*100}%`,"--p3x":`${f[3].x/300*100}%`,"--p3y":`${f[3].y/200*100}%`,"--p4x":`${f[4].x/300*100}%`,"--p4y":`${f[4].y/200*100}%`,"--p5x":`${f[5].x/300*100}%`,"--p5y":`${f[5].y/200*100}%`,"--p6x":`${f[6].x/300*100}%`,"--p6y":`${f[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${v.higher[0].x/300*100}%`,"--q0y":`${v.higher[0].y/200*100}%`,"--q1x":`${v.higher[1].x/300*100}%`,"--q1y":`${v.higher[1].y/200*100}%`,"--q2x":`${v.higher[2].x/300*100}%`,"--q2y":`${v.higher[2].y/200*100}%`,"--q3x":`${v.higher[3].x/300*100}%`,"--q3y":`${v.higher[3].y/200*100}%`,"--q4x":`${v.higher[4].x/300*100}%`,"--q4y":`${v.higher[4].y/200*100}%`,"--q5x":`${v.higher[5].x/300*100}%`,"--q5y":`${v.higher[5].y/200*100}%`,"--q6x":`${v.higher[6].x/300*100}%`,"--q6y":`${v.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${v.lower[0].x/300*100}%`,"--q0y":`${v.lower[0].y/200*100}%`,"--q1x":`${v.lower[1].x/300*100}%`,"--q1y":`${v.lower[1].y/200*100}%`,"--q2x":`${v.lower[2].x/300*100}%`,"--q2y":`${v.lower[2].y/200*100}%`,"--q3x":`${v.lower[3].x/300*100}%`,"--q3y":`${v.lower[3].y/200*100}%`,"--q4x":`${v.lower[4].x/300*100}%`,"--q4y":`${v.lower[4].y/200*100}%`,"--q5x":`${v.lower[5].x/300*100}%`,"--q5y":`${v.lower[5].y/200*100}%`,"--q6x":`${v.lower[6].x/300*100}%`,"--q6y":`${v.lower[6].y/200*100}%`}})]})})}),k===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),k===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},j.id)}),!o&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:m.title}),m.body&&e.jsx("p",{children:m.body}),m.micro&&e.jsx("p",{className:"cogita-intro-micro",children:m.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:B,children:m.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:R,children:"Otwórz pokaz"})]})]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((j,k)=>e.jsx("button",{type:"button",className:`dot ${n===k?"active":""}`,"aria-label":j.title,onClick:()=>p(k)},j.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:S,children:"Pomiń"})]})]})}const zi=6,Hi=4;function Ji({copy:a,onAuthAction:n,authLabel:o,showProfileMenu:u,onProfileNavigate:g,onToggleSecureMode:w,onLogout:p,secureMode:S,onNavigate:R,language:B,onLanguageChange:l}){const L=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}R("home")},m=i.useRef(null),x=i.useRef([]),_=i.useMemo(()=>{let N=Date.now()%2147483647;const $=()=>(N=N*48271%2147483647,N/2147483647);return Array.from({length:zi},(Te,ie)=>{const oe=6+$()*8,we=7+$()*10,Le=6+$()*9,Ne=-$()*oe,Be=-$()*we,Me=-$()*Le,Qe=.18+$()*.28,Ke=12+$()*18,Fe=4+$()*8,We=($()-.5)*3.2,oa=($()-.5)*3.8,Re=$()>.5?"alternate":"alternate-reverse",W=$()>.5?"alternate":"alternate-reverse",Z=$()>.5?"alternate":"alternate-reverse",De=.18+$()*.42,Ce=30+$()*60,fe=-45-$()*38,Pe=188+$()*32,Oe=.1+$()*.2;return{id:`wave-${ie+1}`,style:{"--wave-sway-duration":`${oe}s`,"--wave-scale-duration":`${we}s`,"--wave-drift-duration":`${Le}s`,"--wave-sway-delay":`${Ne}s`,"--wave-scale-delay":`${Be}s`,"--wave-drift-delay":`${Me}s`,"--wave-sway-dir":Re,"--wave-scale-dir":W,"--wave-drift-dir":Z,"--wave-scale":`${Qe}`,"--wave-shift":`${Ke}%`,"--wave-xshift":`${Fe}%`,"--wave-x0":`${We}%`,"--wave-y0":`${oa}%`,"--wave-opacity":`${De}`,"--wave-blur":`${Ce}px`,"--wave-bottom":`${fe}%`,"--wave-hue":`${Pe}`,"--wave-glow":`${Oe}`}}})},[]),H=i.useMemo(()=>{let N=Date.now()*3%2147483647;const $=()=>(N=N*48271%2147483647,N/2147483647);return Array.from({length:Hi},(Te,ie)=>{const oe=180+$()*220,we=220+$()*280,Le=-$()*oe,Ne=-$()*we,Be=.12+$()*.22,Me=3+$()*7,Qe=1+$()*3,Ke=($()-.5)*2.8,Fe=($()-.5)*2.2;return{id:`mesh-${ie+1}`,seed:1e3+ie*991+Math.floor($()*999),style:{"--mesh-sway-duration":`${oe}s`,"--mesh-drift-duration":`${we}s`,"--mesh-sway-delay":`${Le}s`,"--mesh-drift-delay":`${Ne}s`,"--mesh-scale":`${Be}`,"--mesh-shift":`${Me}%`,"--mesh-xshift":`${Qe}%`,"--mesh-x0":`${Fe}%`,"--mesh-y0":`${Ke}%`}}})},[]),U=i.useMemo(()=>{const N=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],$=a.cogita.introSlides,Te=new Map($.map(ie=>[ie.id,ie]));return N.map(ie=>{var we;const oe=Te.get(ie.id);return{...ie,...oe,title:(oe==null?void 0:oe.title)??"Cogita",cta:(oe==null?void 0:oe.cta)??((we=a.cogita.introSlides[0])==null?void 0:we.cta)??a.cogita.loginCta,secondary:oe==null?void 0:oe.secondary}})},[a.cogita.introSlides]),[c,b]=i.useState(0),[f,X]=i.useState(!0),[F,v]=i.useState(!1),G=U.length-1,P=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),se=i.useCallback(()=>{P(),n()},[P,n]),O=i.useCallback(()=>{X(!0),b(0)},[]),V=i.useCallback(()=>{X(!1),b(G)},[G]),he=i.useCallback(N=>{b(Math.max(0,Math.min(G,N)))},[G]),be=i.useCallback(()=>{c>=G?se():he(c+1)},[c,he,se,G]),le=i.useCallback(()=>{he(c-1)},[c,he]);i.useEffect(()=>{var Te;const N=(Te=window.matchMedia)==null?void 0:Te.call(window,"(prefers-reduced-motion: reduce)");if(!N)return;const $=()=>v(N.matches);return $(),N.addEventListener?(N.addEventListener("change",$),()=>N.removeEventListener("change",$)):(N.addListener($),()=>N.removeListener($))},[]),i.useEffect(()=>{if(!f)return;const N=$=>{const Te=$.target;if(!Te)return;const ie=Te.tagName;if(!(Te.isContentEditable||ie==="INPUT"||ie==="TEXTAREA"||ie==="SELECT"||ie==="BUTTON"||ie==="A"||Te.closest('button, a, [role="button"], [role="link"]'))){if($.key==="Escape"){V();return}if($.key==="ArrowLeft"||$.key==="ArrowUp"){le();return}($.key==="ArrowRight"||$.key==="ArrowDown"||$.code==="Space"||$.key===" ")&&($.preventDefault(),be())}};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[V,be,le,f]),i.useEffect(()=>{f&&c===G&&P()},[c,f,G,P]),i.useEffect(()=>{const N=m.current;if(!N)return;const $=x.current.filter(fe=>!!fe);if(!$.length)return;const Te=1,ie=.6,oe=.6,we=Math.max(1,Math.min(Te,window.devicePixelRatio||1));let Le=0,Ne=0,Be=ie,Me=0,Qe=0;const Ke=fe=>{let Pe=fe%2147483647;return Pe<=0&&(Pe+=2147483646),(Oe,Ve)=>{Pe=Pe*48271%2147483647;const Ae=Pe/2147483647;return Oe+Ae*(Ve-Oe)}},Fe={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},We=fe=>{const Pe=Math.sin(fe*12.9898)*43758.5453;return Pe-Math.floor(Pe)},oa=fe=>{const Pe=We(fe+.1)||1e-4,Oe=We(fe+.7)||1e-4;return Math.sqrt(-2*Math.log(Pe))*Math.cos(2*Math.PI*Oe)},Re=(fe,Pe)=>{const Oe=Math.floor(fe),Ve=Oe+1,Ae=fe-Oe,j=Ae*Ae*(3-2*Ae),k=We(Oe*12.9898+Pe*78.233),Q=We(Ve*12.9898+Pe*78.233);return k+(Q-k)*j},W=fe=>{const Pe=Ke(fe),Oe=Math.min(4,Math.max(4,Math.floor(Le/1200*Fe.filamentCount)));return Array.from({length:Oe},(Ve,Ae)=>{const j=Math.max(-1,Math.min(1,oa(fe+Ae*.37))),k=Math.min(1,Math.max(0,We(fe+Ae*1.31))),Q=Math.min(Fe.depthLayers-1,Math.floor(k*Fe.depthLayers));return{seed:Pe(0,Math.PI*2)+fe*.01,offset:j,freqA:Fe.freq1*(.75+Pe(0,.5)),freqB:Fe.freq2*(.75+Pe(0,.5)),ampA:Fe.amp1*(.6+Pe(0,.7)),ampB:Fe.amp2*(.6+Pe(0,.7)),width:2+Ae%5*.32,depth:k,layer:Q}})},Z=(fe,Pe,Oe)=>{const Ve=Math.max(30,Math.floor(Le*Ne/14e4));fe.save(),fe.globalAlpha=.6;for(let Ae=0;Ae<Ve;Ae+=1){const j=We(Ae*9.1+Le*.11)*Pe+Oe,k=We(Ae*3.7+Ne*.23)*Ne,Q=1.2+We(Ae*5.9)*2.4,t=fe.createRadialGradient(j,k,0,j,k,Q*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),fe.fillStyle=t,fe.beginPath(),fe.arc(j,k,Q*2,0,Math.PI*2),fe.fill()}fe.restore()},De=(fe,Pe)=>{fe.clearRect(0,0,Le,Ne);const Oe=Ne*Fe.waveCenter,Ve=Fe.waveBandPx,Ae=Fe.segments,j=Fe.colors.filaments,k=Me||Le,Q=0;Z(fe,k,Q),fe.strokeStyle=j,fe.lineCap="round",fe.lineJoin="round";for(let t=0;t<Pe.length;t+=1){const r=Pe[t],h=r.offset*Ve*(.85+We(r.seed)*.4),T=1-Math.min(1,Math.abs(h)/Ve),q=Math.exp(-Math.pow(h/Fe.crestThickness,2)),ae=r.layer===0?1.1:r.layer===1?.85:.6,te=.35+(1-r.depth)*.65,re=T*te*ae*(.34+q*.45);fe.globalAlpha=re,fe.lineWidth=r.width*(1+(1-r.depth)*.8);const ge=[];for(let ve=0;ve<=Ae;ve+=1){const ea=ve/Ae*k+Q,Je=(Re(ea*.012,r.seed)-.5)*Fe.xJitter,ra=ea+Je,qe=(Re(ra*r.freqA,r.seed)-.5)*Fe.jitterA,Ye=(Re(ra*r.freqB,r.seed*1.7)-.5)*Fe.jitterB,_e=Oe+Math.sin(ra*r.freqA+r.seed)*r.ampA+Math.sin(ra*r.freqB+r.seed*1.3)*r.ampB+h+qe+Ye;ge.push({x:ra,y:_e})}fe.beginPath(),fe.moveTo(ge[0].x,ge[0].y);for(let ve=1;ve<ge.length-1;ve+=1){const ea=(ge[ve].x+ge[ve+1].x)/2,Je=(ge[ve].y+ge[ve+1].y)/2;fe.quadraticCurveTo(ge[ve].x,ge[ve].y,ea,Je)}const ce=ge[ge.length-1];fe.quadraticCurveTo(ce.x,ce.y,ce.x,ce.y),fe.stroke()}fe.save(),fe.globalCompositeOperation="lighter",fe.strokeStyle=Fe.colors.glow,fe.lineCap="round",fe.lineJoin="round";for(let t=0;t<Pe.length;t+=1){const r=Pe[t];if(Math.abs(r.offset)*Ve>Fe.crestThickness)continue;const h=Fe.glowAlpha*(.7+(1-r.depth)*.6);fe.globalAlpha=h,fe.lineWidth=1.6+(1-r.depth)*1.2;const T=[];for(let ae=0;ae<=Ae;ae+=1){const te=ae/Ae*k+Q,re=Math.sin(te*.02+r.seed)*3,ge=Oe+Math.sin(te*r.freqA+r.seed)*r.ampA+Math.sin(te*r.freqB+r.seed*1.3)*r.ampB+r.offset*Ve*.35+re;T.push({x:te,y:ge})}fe.beginPath(),fe.moveTo(T[0].x,T[0].y);for(let ae=1;ae<T.length-1;ae+=1){const te=(T[ae].x+T[ae+1].x)/2,re=(T[ae].y+T[ae+1].y)/2;fe.quadraticCurveTo(T[ae].x,T[ae].y,te,re)}const q=T[T.length-1];fe.quadraticCurveTo(q.x,q.y,q.x,q.y),fe.stroke()}fe.restore()},Ce=()=>{Le=Math.floor(N.clientWidth),Ne=Math.floor(N.clientHeight),Me=Math.floor(Le*1.8),Qe=Ne,Be=Le<820?oe:ie,$.forEach(fe=>{const Pe=fe.getContext("2d");if(!Pe)return;fe.width=Math.floor(Me*we*Be),fe.height=Math.floor(Qe*we*Be),fe.style.width=`${Me}px`,fe.style.height=`${Qe}px`,fe.style.left=`${-(Me-Le)/2}px`,Pe.setTransform(we*Be,0,0,we*Be,0,0);const Oe=Number(fe.dataset.seed||1),Ve=W(Oe);De(Pe,Ve)})};return Ce(),window.addEventListener("resize",Ce,{passive:!0}),()=>window.removeEventListener("resize",Ce)},[H]);const K=U[Math.min(c,U.length-1)],de=f?K:U[U.length-1],s=(de==null?void 0:de.theme)??U[0].theme,ne={"--cogita-bg0":s.bg0,"--cogita-bg1":s.bg1,"--cogita-bg2":s.bg2,"--cogita-bloom":s.bloom,"--cogita-sat":s.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:L,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Vr,{value:B,onChange:l}),e.jsx(qr,{copy:a,label:o,isAuthenticated:u,secureMode:S,onLogin:n,onProfileNavigate:g,onToggleSecureMode:w,onLogout:p,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:m,className:"cogita-section cogita-home",style:ne,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[H.map((N,$)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:N.style,"data-seed":N.seed,ref:Te=>{x.current[$]=Te}},N.id)),_.map(N=>e.jsx("div",{className:"cogita-home-wave",style:N.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},N.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Wi,{slides:U,activeIndex:c,introOpen:f,prefersReducedMotion:F,onNext:be,onPrev:le,onSelect:he,onExit:V,onOpen:O,onRegister:se})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Zn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Ji},Symbol.toStringTag,{value:"Module"})),Gr=i.createContext(!1);function ja({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:l}){if(i.useContext(Gr))return e.jsx(e.Fragment,{children:l});const m=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}S("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:m,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Vr,{value:R,onChange:B}),e.jsx(qr,{copy:a,label:n,isAuthenticated:o,secureMode:p,onLogin:()=>S("home"),onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:l}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function Ra(a){const[n,o]=i.useState("Cogita library"),[u,g]=i.useState(null);return i.useEffect(()=>{let w=!1;return _r().then(p=>{if(w)return;const S=p.find(R=>R.libraryId===a);S&&o(S.name)}).catch(()=>{w||o("Cogita library")}),()=>{w=!0}},[a]),i.useEffect(()=>{let w=!1;return mi(a).then(p=>{w||g(p)}).catch(()=>{w||g(null)}),()=>{w=!0}},[a]),{libraryName:n,stats:u}}function Pr({slices:a}){const n=a.reduce((u,g)=>u+Math.max(0,g.value),0),o=i.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let u=0;return`conic-gradient(${a.map(w=>{const S=Math.max(0,w.value)/n*360,R=u,B=u+S;return u=B,`${w.color} ${R}deg ${B}deg`}).join(",")})`},[a,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:o}}),e.jsx("div",{className:"cogita-overview-legend",children:a.map(u=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:u.color}}),e.jsx("strong",{children:u.value}),e.jsx("small",{children:u.label})]},u.label))})]})}function Yi({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l}){const{libraryName:L,stats:m}=Ra(l),[x,_]=i.useState("infos"),[H,U]=i.useState(0),[c,b]=i.useState(0),[f,X]=i.useState(0),F=(m==null?void 0:m.totalInfos)??0,v=(m==null?void 0:m.totalCollections)??0,G=0,P=0,se=0,O=Math.max(0,F-se-c),V=Math.max(0,F-c-f);i.useEffect(()=>{let be=!1;return(async()=>{try{const K=await wt({libraryId:l,limit:200}),de=await Promise.all(K.items.map(s=>Ur({libraryId:l,collectionId:s.collectionId}).catch(()=>[])));if(be)return;U(de.reduce((s,ne)=>s+ne.length,0))}catch{be||U(0)}})(),()=>{be=!0}},[l]),i.useEffect(()=>{let be=!1;return(async()=>{try{const[K,de,s]=await Promise.all([Rt({libraryId:l,type:"computed",limit:1}).catch(()=>({total:0})),Rt({libraryId:l,type:"source",limit:1}).catch(()=>({total:0})),Wr({libraryId:l}).catch(()=>({items:[]}))]);if(be)return;b((K.total??0)+(de.total??0));const ne=new Set(s.items.filter(N=>N.childItemType.toLowerCase()==="info").map(N=>N.childItemId).filter(Boolean));X(ne.size)}catch{be||(b(0),X(0))}})(),()=>{be=!0}},[l]);const he=[{key:"infos",label:a.cogita.library.overview.stats.totalInfos,value:F},{key:"collections",label:a.cogita.library.overview.stats.collections,value:v},{key:"revisions",label:a.cogita.library.overview.stats.revisions,value:H},{key:"storyboards",label:a.cogita.library.overview.stats.storyboards,value:G},{key:"texts",label:a.cogita.library.overview.stats.texts,value:P}];return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:L})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:he.map(be=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${x===be.key?"active":""}`,onClick:()=>_(be.key),children:[e.jsx("span",{children:be.label}),e.jsx("strong",{children:be.value})]},be.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:a.cogita.library.overview.statsCardTitle})}),x==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.knownChartTitle}),e.jsx(Pr,{slices:[{label:a.cogita.library.overview.known,value:se,color:"#75d79a"},{label:a.cogita.library.overview.unknown,value:O,color:"#85b9ff"},{label:a.cogita.library.overview.excluded,value:c,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.checksChartTitle}),e.jsx(Pr,{slices:[{label:a.cogita.library.overview.availableChecks,value:f,color:"#75d79a"},{label:a.cogita.library.overview.unavailableChecks,value:V,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:a.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]})]})})]})})}const pe=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Fa=(a,n,o,u)=>`${a}:${n}:${o??""}:${u??""}`,ia=(a,n)=>{const o=a.cogita.library.infoTypes;return{any:o.any,vocab:o.vocab,language:o.language,word:o.word,sentence:o.sentence,topic:o.topic,collection:o.collection,person:o.person,institution:o.institution,collective:o.collective,orcid:o.orcid,address:o.address,email:o.email,phone:o.phone,media:o.media,work:o.work,geo:o.geo,music_piece:o.musicPiece,music_fragment:o.musicFragment,source:o.source,quote:o.quote,computed:o.computed}[n]??String(n)},Xr=a=>[{value:"any",label:ia(a,"any")},{value:"language",label:ia(a,"language")},{value:"word",label:ia(a,"word")},{value:"sentence",label:ia(a,"sentence")},{value:"topic",label:ia(a,"topic")},{value:"collection",label:ia(a,"collection")},{value:"person",label:ia(a,"person")},{value:"institution",label:ia(a,"institution")},{value:"collective",label:ia(a,"collective")},{value:"orcid",label:ia(a,"orcid")},{value:"address",label:ia(a,"address")},{value:"email",label:ia(a,"email")},{value:"phone",label:ia(a,"phone")},{value:"media",label:ia(a,"media")},{value:"work",label:ia(a,"work")},{value:"geo",label:ia(a,"geo")},{value:"music_piece",label:ia(a,"music_piece")},{value:"music_fragment",label:ia(a,"music_fragment")},{value:"source",label:ia(a,"source")},{value:"quote",label:ia(a,"quote")},{value:"computed",label:ia(a,"computed")}],Qi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Gi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],Xi=a=>[{value:"any",label:ia(a,"any")},{value:"vocab",label:ia(a,"vocab")},...Xr(a).filter(n=>n.value!=="any")],Ga=5,$r=50,Rr=2,Er=[];function Ue({libraryId:a,infoType:n,label:o,placeholder:u,value:g,onChange:w,values:p,onChangeMultiple:S,helperText:R,searchFailedText:B,createFailedText:l,createLabel:L,savingLabel:m,loadMoreLabel:x,inputRef:_,autoAdvance:H,onCommit:U,multiple:c}){const b=c?p??Er:Er,[f,X]=i.useState(c?"":(g==null?void 0:g.label)??""),[F,v]=i.useState([]),[G,P]=i.useState(Ga),[se,O]=i.useState(-1),[V,he]=i.useState(!1),[be,le]=i.useState(!1),[K,de]=i.useState(null),s=i.useRef(0),ne=i.useRef(new Map),N=i.useMemo(()=>c?f.trim().length>0:f.trim().length>0&&!g,[f,g,c]);i.useEffect(()=>{c||X((g==null?void 0:g.label)??"")},[g,c]),i.useEffect(()=>{const ie=f.trim();if(!ie||ie.length<Rr){v([]),he(!1),P(Ga),O(-1),le(!1),de(null);return}const oe=ie.toLowerCase(),we=`${a}:${n}:${oe}`,Le=ne.current.get(we);if(Le){if(c&&b.length>0){const Be=new Set(b.map(Me=>Me.id));v(Le.filter(Me=>!Be.has(Me.id)))}else v(Le);P(Ga),O(-1),he(Le.length>0),le(!1),de(null);return}const Ne=window.setTimeout(async()=>{const Be=Date.now();s.current=Be,le(!0),de(null);try{const Me=await zr({libraryId:a,type:n,query:ie,limit:$r});if(s.current!==Be)return;const Qe=Me.slice(0,$r).map(Ke=>({id:Ke.infoId,label:Ke.label,infoType:Ke.infoType}));if(ne.current.set(we,Qe),c&&b.length>0){const Ke=new Set(b.map(Fe=>Fe.id));v(Qe.filter(Fe=>!Ke.has(Fe.id)))}else v(Qe);P(Ga),O(-1),he(!0)}catch{if(s.current!==Be)return;de(B??"Search failed.")}finally{s.current===Be&&le(!1)}},250);return()=>window.clearTimeout(Ne)},[a,n,f,b]);const $=ie=>{if(c){const oe=b.some(we=>we.id===ie.id)?b:[...b,ie];S==null||S(oe),X(""),he(!1),O(-1);return}w==null||w(ie),X(ie.label),he(!1),O(-1),H&&(U==null||U())},Te=async()=>{const ie=f.trim();if(ie){le(!0),de(null);try{const oe=await Xa({libraryId:a,infoType:n,payload:{label:ie}}),we={id:oe.infoId,label:ie,infoType:oe.infoType};if(ie.length>=Rr){const Le=`${a}:${n}:${ie.toLowerCase()}`,Ne=ne.current.get(Le)??[];ne.current.set(Le,[we,...Ne])}if(c){S==null||S([...b,we]),X(""),he(!1),O(-1);return}w==null||w(we),he(!1),O(-1),H&&(U==null||U())}catch{de(l??"Create failed.")}finally{le(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:o}),e.jsx("input",{value:f,placeholder:u,onChange:ie=>{X(ie.target.value),!c&&g&&(w==null||w(null))},onKeyDown:ie=>{if(ie.key==="ArrowDown"){if(ie.preventDefault(),!F.length)return;he(!0),O(oe=>{const we=Math.min(F.length,G)-1,Le=oe<0?0:Math.min(oe+1,we);return Le===we&&F.length>G?(P(Ne=>Math.min(Ne+Ga,F.length)),Math.min(oe+1,Math.min(F.length,G+Ga)-1)):Le});return}if(ie.key==="ArrowUp"){if(ie.preventDefault(),!F.length)return;he(!0),O(oe=>oe<=0?0:oe-1);return}if(ie.key==="Enter"){if(ie.preventDefault(),se>=0&&F[se]){$(F[se]);return}if(N){Te();return}}},onFocus:()=>{F.length>0&&he(!0)},autoComplete:"off",ref:_})]}),c&&b.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:b.map(ie=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>S==null?void 0:S(b.filter(oe=>oe.id!==ie.id)),children:[ie.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},ie.id))}),R&&e.jsx("p",{className:"cogita-help",children:R}),K&&e.jsx("p",{className:"cogita-error",children:K}),V&&F.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[F.slice(0,G).map((ie,oe)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":oe===se,onClick:()=>$(ie),children:[e.jsx("strong",{children:ie.label}),e.jsx("span",{children:ie.infoType})]},ie.id)),G<F.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>P(ie=>Math.min(ie+Ga,F.length)),children:x??"Load more"})]}),N&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Te,disabled:be,children:be?m??"Saving...":L??`Create new ${n}`})]})}function Zi({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l,mode:L}){const{libraryName:m}=Ra(l),x=`/#/cogita/library/${l}`,[_,H]=i.useState("any"),[U,c]=i.useState(""),[b,f]=i.useState([]),[X,F]=i.useState("idle"),[v,G]=i.useState(null),[P,se]=i.useState(null),[O,V]=i.useState("idle"),[he,be]=i.useState(0),[le,K]=i.useState(null),[de,s]=i.useState("idle"),[ne,N]=i.useState(null),[$,Te]=i.useState(null),[ie,oe]=i.useState(null),[we,Le]=i.useState(null),Ne=i.useMemo(()=>({languageAId:(ne==null?void 0:ne.id)??void 0,languageBId:($==null?void 0:$.id)??void 0,topicId:(ie==null?void 0:ie.id)??void 0,levelId:(we==null?void 0:we.id)??void 0}),[ne,$,ie,we]),Be=i.useMemo(()=>_==="vocab"||_==="any",[_]);i.useEffect(()=>{F("loading");const Re=window.setTimeout(()=>{Rt({libraryId:l,type:_==="any"?void 0:_,query:U.trim()||void 0,limit:30,languageAId:Be?Ne.languageAId:void 0,languageBId:Be?Ne.languageBId:void 0,topicId:Be?Ne.topicId:void 0,levelId:Be?Ne.levelId:void 0}).then(W=>{f(W.items),be(W.total),K(W.nextCursor??null),F("ready"),G(W.items[0]??null)}).catch(()=>{f([]),be(0),K(null),F("ready")})},240);return()=>window.clearTimeout(Re)},[l,U,_,Be,Ne]),i.useEffect(()=>{if(!v||v.cardType!=="info"||v.infoType!=="computed"){se(null),V("idle"),s("idle");return}V("loading"),pr({libraryId:l,infoId:v.cardId}).then(Re=>{se(Re),V("ready")}).catch(()=>{se(null),V("ready")})},[l,v]);const Me=async()=>{if(le){F("loading");try{const Re=await Rt({libraryId:l,type:_==="any"?void 0:_,query:U.trim()||void 0,limit:30,cursor:le,languageAId:Be?Ne.languageAId:void 0,languageBId:Be?Ne.languageBId:void 0,topicId:Be?Ne.topicId:void 0,levelId:Be?Ne.levelId:void 0});f(W=>[...W,...Re.items]),K(Re.nextCursor??null),be(Re.total),F("ready")}catch{F("ready")}}},Qe=async()=>{if(!(!v||v.cardType!=="connection"&&v.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){s("loading");try{await pi({libraryId:l,connectionId:v.cardId});let W=null;f(Z=>{const De=Z.filter(Ce=>Ce.cardId!==v.cardId);return W=De[0]??null,De}),be(Z=>Math.max(0,Z-(v.cardType==="vocab"?3:1))),G(Z=>Z&&Z.cardId===v.cardId?W:Z),s("idle")}catch{s("error")}}},Ke=i.useMemo(()=>L==="collection"?"grid":L==="list"?"list":"detail",[L]),Fe=v?pe(v):null,We=i.useMemo(()=>Xi(a),[a]),oa=i.useMemo(()=>{const Re=he||b.length;return a.cogita.library.list.cardCount.replace("{shown}",String(b.length)).replace("{total}",String(Re))},[a,b.length,he]);return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Ke,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:x,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${x}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${x}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(Re=>e.jsx("a",{className:"ghost","data-active":L===Re,href:`${x}/${Re}`,children:Re==="detail"?a.cogita.library.list.modes.detail:Re==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},Re))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:_,onChange:Re=>H(Re.target.value),children:We.map(Re=>e.jsx("option",{value:Re.value,children:Re.label},Re.value))}),e.jsx("input",{type:"text",value:U,onChange:Re=>c(Re.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(_==="vocab"||_==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:ne,onChange:N,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:$,onChange:Te,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:ie,onChange:oe,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:we,onChange:Le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(ne||$||ie||we)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{N(null),Te(null),oe(null),Le(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:oa}),e.jsx("span",{children:X==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":L==="collection"?"grid":"list",children:b.length?b.map(Re=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":Fe===pe(Re),onClick:()=>G(Re),children:[e.jsx("div",{className:"cogita-card-type",children:Re.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:Re.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:Re.label}),e.jsx("p",{className:"cogita-card-subtitle",children:Re.description})]},pe(Re))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${x}/new`,children:a.cogita.library.list.addInfo})]})}),le?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Me,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(v==null?void 0:v.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(v==null?void 0:v.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${x}/edit/${v.cardId}`,children:a.cogita.library.list.editInfo}):null,(v==null?void 0:v.cardType)==="connection"||(v==null?void 0:v.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:Qe,disabled:de==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${x}/new`,children:a.cogita.library.actions.addInfo})]})]}),v?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:v.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:v.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),de==="error"&&(v.cardType==="connection"||v.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,v.cardType==="info"&&v.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),O==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),O!=="loading"&&P?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(Et,{value:P.prompt,mode:"auto"}),P.expectedAnswers&&Object.keys(P.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(P.expectedAnswers).map(([Re,W])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Re}),e.jsx(fr,{value:W,mode:"auto"})]},Re))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(fr,{value:P.expectedAnswer,mode:"auto"})]})]}):O!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const At=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Fr=8;function Ar({libraryId:a,copy:n,language:o,sourceKindOptions:u,value:g,onChange:w,labels:p}){const[S,R]=i.useState(!1),[B,l]=i.useState(-1),L=i.useMemo(()=>{const H=o;return At.map(U=>{var f;const c=(U==null?void 0:U[H])??(U==null?void 0:U.en)??(U==null?void 0:U.la);return{label:`${c.abbr} — ${c.name}`,latin:((f=U==null?void 0:U.la)==null?void 0:f.abbr)??c.abbr}})},[o]),m=(H,U=!1)=>{const c=H.trim().toLowerCase();return c?L.filter(b=>b.label.toLowerCase().includes(c)).slice(0,Fr):U?L.slice(0,Fr):[]},x=(H,U)=>{const c=H.trim().toLowerCase();if(!c)return null;const b=At;for(const f of b){const X=f==null?void 0:f.la,F=(f==null?void 0:f[U])??(f==null?void 0:f.en)??X,v=(F==null?void 0:F.abbr)??"",G=(F==null?void 0:F.name)??"";if(v.toLowerCase()===c||G.toLowerCase()===c||`${v} — ${G}`.toLowerCase()===c)return{book:f,entry:F,la:X}}return null};i.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!S){const H=x(g.locatorValue,o);if(H){const U=`${H.entry.abbr} — ${H.entry.name}`;U!==g.bibleBookDisplay&&w({...g,bibleBookDisplay:U})}}},[o,g,S,w]);const _=H=>w({...g,...H});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:H=>_({sourceKind:H.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:u.map(H=>e.jsx("option",{value:H.value,children:H.label},H.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:H=>{const U=H.target.value;_({bibleBookDisplay:U,locatorValue:""}),R(!0),l(-1)},onKeyDown:H=>{var c;const U=m(g.bibleBookDisplay);if(U.length){if(H.key==="ArrowDown")H.preventDefault(),l(b=>Math.min(b+1,U.length-1));else if(H.key==="ArrowUp")H.preventDefault(),l(b=>Math.max(b-1,0));else if((H.key==="Enter"||H.key==="Tab")&&B>=0&&U[B]){const b=U[B],f=x(b.label,o);if(!f)return;_({bibleBookDisplay:b.label,locatorValue:((c=f.la)==null?void 0:c.abbr)??g.locatorValue}),R(!1)}}},onFocus:()=>R(!0),onBlur:()=>window.setTimeout(()=>R(!1),100),placeholder:p.bibleBookPlaceholder})]}),S&&m(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:m(g.bibleBookDisplay,!0).map((H,U)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":U===B,tabIndex:-1,onMouseDown:()=>{var b;const c=x(H.label,o);c&&_({bibleBookDisplay:H.label,locatorValue:((b=c.la)==null?void 0:b.abbr)??g.locatorValue})},children:e.jsx("strong",{children:H.label})},H.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:H=>_({locatorAux:H.target.value}),placeholder:p.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:H=>_({sourceUrl:H.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:H=>_({sourceAccessedDate:H.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:a,infoType:"work",label:p.churchDocumentLabel,placeholder:p.churchDocumentPlaceholder,value:g.churchDocument,onChange:H=>_({churchDocument:H}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:H=>_({locatorValue:H.target.value}),placeholder:p.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(Ue,{libraryId:a,infoType:"work",label:p.workLabel,placeholder:p.workPlaceholder,value:g.work,onChange:H=>_({work:H}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:a,infoType:"media",label:p.bookLabel,placeholder:p.bookPlaceholder,value:g.bookMedia,onChange:H=>_({bookMedia:H}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:H=>_({locatorValue:H.target.value}),placeholder:p.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:H=>_({locatorValue:H.target.value}),placeholder:p.locatorPlaceholder})]})]})}const en=[],an=[];function tn({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),o=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),u=a.handles.length,g=u>1?(u-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),o?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((w,p)=>e.jsx(Mr,{type:"target",id:w.id,position:Sr.Left,style:{top:46+p*28},children:w.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:w.label}):null},w.id)),a.output!==!1?e.jsx(Mr,{type:"source",id:"out",position:Sr.Right}):null]})}function rn({copy:a,value:n,onChange:o}){var Ke,Fe,We,oa,Re,W,Z,De,Ce,fe,Pe,Oe,Ve,Ae;const u=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=j=>!j||j.nodes.length===0?en:j.nodes.map((k,Q)=>{var t,r,h,T;return{id:k.id,type:"computed",position:k.position??{x:40+Q*160,y:60+Q%3*80},data:{title:k.name||((t=u[k.type])==null?void 0:t.label)||k.type,subtitle:((r=u[k.type])==null?void 0:r.label)||k.type,type:k.type,name:k.name,outputLabel:k.outputLabel,min:k.min,max:k.max,value:k.type==="input.const"?k.value:void 0,list:k.list,handles:((h=u[k.type])==null?void 0:h.handles)??[],output:((T=u[k.type])==null?void 0:T.output)??!0}}}),w=j=>{if(!j||j.nodes.length===0)return an;const k=new Set(j.nodes.map(r=>r.id)),Q=[];let t=0;return j.nodes.forEach(r=>{const h=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(h).forEach(([T,q])=>{q.forEach(ae=>{k.has(ae)&&Q.push({id:`${r.id}-${T}-${ae}-${t++}`,source:ae,target:r.id,targetHandle:T==="in"?void 0:T})})})}),Q},p=i.useMemo(()=>g(n),[n,u]),S=i.useMemo(()=>w(n),[n]),R=(j,k)=>{if(!j)return"null";const Q=j.nodes.map(r=>{const h=(r.list??[]).join(","),T=r.inputs?r.inputs.join(","):"",q=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([te,re])=>`${te}:${[...re].sort().join(",")}`).sort().join("|"):"",ae=k&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",h,T,q,ae].join(":")}).sort().join("||"),t=j.outputs?[...j.outputs].sort().join(","):j.output??"";return`${Q}::${t}`},B=i.useMemo(()=>{var k;const j=!!((k=n==null?void 0:n.nodes)!=null&&k.some(Q=>!!Q.position));return R(n,j)},[n]),[l,L]=i.useState(p),[m,x]=i.useState(S),[_,H]=i.useState(null),[U,c]=i.useState([]),[b,f]=i.useState(null),[X,F]=i.useState(null),[v,G]=i.useState({}),[P,se]=i.useState(0),O=i.useRef(o),V=i.useRef(B),he=i.useRef(B),be=i.useRef(R(n,!1)),le=i.useMemo(()=>_?l.find(j=>j.id===_)??null:null,[l,_]),K=i.useMemo(()=>{const j=["in1","in2","in3","in4","in5","in6"],k=new Map;return m.forEach(Q=>{if(!Q.target)return;const t=Q.targetHandle??"in1";k.has(Q.target)||k.set(Q.target,new Set),k.get(Q.target).add(t)}),l.map(Q=>{var t;if(((t=Q.data)==null?void 0:t.type)==="compute.concat"){const r=k.get(Q.id)??new Set,h=[];let T=!1;return j.forEach(q=>{var ae,te;if(r.has(q)||!T){const re=(te=(ae=u["compute.concat"])==null?void 0:ae.handles)==null?void 0:te.find(ge=>ge.id===q);re&&h.push(re),r.has(q)||(T=!0)}}),{...Q,selected:Q.id===_,data:{...Q.data,handles:h}}}return{...Q,selected:Q.id===_}})},[l,_,m,u]);i.useEffect(()=>{f(null),F(null)},[_]),i.useEffect(()=>{if(U.length===0)return;const j=k=>{if(k.key!=="Delete"&&k.key!=="Backspace")return;const Q=k.target;Q&&(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"||Q.isContentEditable)||(k.preventDefault(),x(t=>t.filter(r=>!U.includes(r.id))),c([]))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[U,x]),i.useEffect(()=>{O.current=o},[o]),i.useEffect(()=>{if(V.current!==B){if(he.current===B||be.current===B){V.current=B;return}V.current=B,L(p),x(S),H(null),f(null),F(null),G({}),se(j=>j+1)}},[p,S,x,L,B]),i.useEffect(()=>{const j=l.filter(h=>{var T;return((T=h.data)==null?void 0:T.type)==="output"}).map(h=>h.id).sort(),k=new Map;m.forEach(h=>{let T=k.get(h.target);T||(T={},k.set(h.target,T));const q=h.targetHandle||"in";T[q]||(T[q]=[]),T[q].push(h.source)}),k.forEach(h=>{Object.values(h).forEach(T=>T.sort())});const Q={nodes:l.map(h=>{var T,q,ae,te,re,ge,ce,ve,ea;return{id:h.id,type:((T=h.data)==null?void 0:T.type)??"compute.add",position:h.position,name:(q=h.data)==null?void 0:q.name,outputLabel:(ae=h.data)==null?void 0:ae.outputLabel,min:(te=h.data)==null?void 0:te.min,max:(re=h.data)==null?void 0:re.max,value:((ge=h.data)==null?void 0:ge.type)==="input.const"?(ce=h.data)==null?void 0:ce.value:void 0,list:(ve=h.data)==null?void 0:ve.list,inputs:(ea=k.get(h.id))==null?void 0:ea.in,inputsByHandle:k.get(h.id)}}),output:j[0]??null,outputs:j},t=R(Q,!0),r=R(Q,!1);t===he.current||r===be.current||(he.current=t,be.current=r,O.current(Q))},[l,m]),i.useEffect(()=>{const j={};let k=!1;l.forEach(Q=>{var q,ae,te,re,ge;if(((q=Q.data)==null?void 0:q.type)!=="input.random")return;if(v[Q.id]!==void 0){j[Q.id]=v[Q.id];return}const t=Number.isFinite((ae=Q.data)==null?void 0:ae.min)?Number((te=Q.data)==null?void 0:te.min):0,r=Number.isFinite((re=Q.data)==null?void 0:re.max)?Number((ge=Q.data)==null?void 0:ge.max):t+10,h=Math.min(t,r),T=Math.max(t,r);j[Q.id]=Math.floor(Math.random()*(T-h+1))+h,k=!0}),(k||Object.keys(j).length!==Object.keys(v).length)&&G(j)},[l,v,P]);const de=i.useMemo(()=>l.map(k=>{var t,r,h,T,q;const Q=(((t=k.data)==null?void 0:t.list)??[]).join(",");return[k.id,((r=k.data)==null?void 0:r.type)??"",((h=k.data)==null?void 0:h.name)??"",((T=k.data)==null?void 0:T.min)??"",((q=k.data)==null?void 0:q.max)??"",Q].join(":")}).sort().join("|"),[l]),s=i.useMemo(()=>m.map(k=>`${k.source}:${k.target}:${k.targetHandle??""}`).sort().join("|"),[m]),ne=i.useMemo(()=>{const j=new Map(l.map(te=>[te.id,te])),k=new Map;m.forEach(te=>{let re=k.get(te.target);re||(re={},k.set(te.target,re));const ge=te.targetHandle||"in";re[ge]||(re[ge]=[]),re[ge].push(te.source)});const Q=new Map,t=new Set,r=te=>{if(typeof te=="number")return te;if(typeof te=="string"){const re=Number(te);return Number.isFinite(re)?re:0}return 0},h=(te,re)=>{var ge,ce;return re?((ge=k.get(te.id))==null?void 0:ge[re])??[]:((ce=k.get(te.id))==null?void 0:ce.in)??[]},T=(te,re)=>h(te,re).map(ge=>r(ae(ge))),q=(te,re)=>h(te,re).map(ge=>ae(ge)),ae=te=>{var ve,ea,Je,ra;if(Q.has(te))return Q.get(te);if(t.has(te))return 0;const re=j.get(te);if(!re)return 0;t.add(te);const ge=((ve=re.data)==null?void 0:ve.type)??"";let ce=0;switch(ge){case"input.random":{ce=v[te]??0;break}case"input.const":{ce=Number.isFinite((ea=re.data)==null?void 0:ea.value)?Number((Je=re.data)==null?void 0:Je.value):0;break}case"input.list":{const qe=(((ra=re.data)==null?void 0:ra.list)??[]).filter(Boolean),Ye=Math.round(T(re,"index")[0]??0);ce=(qe.length?qe[Math.max(0,Math.min(qe.length-1,Ye))]:"")||String(Ye);break}case"compute.add":{ce=T(re,"in").reduce((qe,Ye)=>qe+Ye,0);break}case"compute.sub":{ce=T(re,"add").reduce((qe,Ye)=>qe+Ye,0)-T(re,"sub").reduce((qe,Ye)=>qe+Ye,0);break}case"compute.mul":{const qe=T(re,"in");ce=qe.length?qe.reduce((Ye,_e)=>Ye*_e,1):0;break}case"compute.div":{const qe=T(re,"num")[0]??0,Ye=T(re,"den").reduce((_e,A)=>_e+A,0);ce=Math.abs(Ye)<Number.EPSILON?0:qe/Ye;break}case"compute.pow":{const qe=T(re,"base")[0]??0,Ye=T(re,"exp")[0]??0;ce=Math.pow(qe,Ye);break}case"compute.exp":{const qe=T(re,"base")[0]??0,Ye=T(re,"exp")[0]??0;ce=Math.pow(qe,Ye);break}case"compute.log":{const qe=T(re,"value")[0]??0,Ye=T(re,"base")[0]??0,_e=Math.max(qe,Number.EPSILON);ce=Math.abs(Ye)<Number.EPSILON?Math.log(_e):Math.log(_e)/Math.log(Ye);break}case"compute.abs":{ce=Math.abs(T(re,"in")[0]??0);break}case"compute.min":{const qe=T(re,"in");ce=qe.length?Math.min(...qe):0;break}case"compute.max":{const qe=T(re,"in");ce=qe.length?Math.max(...qe):0;break}case"compute.floor":{ce=Math.floor(T(re,"in")[0]??0);break}case"compute.ceil":{ce=Math.ceil(T(re,"in")[0]??0);break}case"compute.round":{ce=Math.round(T(re,"in")[0]??0);break}case"compute.mod":{const qe=T(re,"a")[0]??0,Ye=T(re,"b")[0]??0;ce=Math.abs(Ye)<Number.EPSILON?0:qe%Ye;break}case"compute.concat":{const Ye=["in1","in2","in3","in4","in5","in6"].flatMap(Ie=>q(re,Ie)),_e=Ye.length?Ye:q(re,"in");ce=(_e.length?_e:q(re)).map(Ie=>Ie==null?"":String(Ie)).join("");break}case"compute.trim":{const qe=q(re,"text")[0]??q(re,"in")[0]??"",Ye=qe==null?"":String(qe),_e=Math.max(0,Math.round(T(re,"start")[0]??0)),A=Math.max(0,Math.round(T(re,"end")[0]??0));ce=_e+A>=Ye.length?"":Ye.substring(_e,Ye.length-A);break}case"output":{const qe=h(re,"in")[0];ce=qe?ae(qe):0;break}default:ce=0}return t.delete(te),Q.set(te,ce),ce};return l.forEach(te=>ae(te.id)),Q},[de,s,v]),N=i.useRef(ne);i.useEffect(()=>{N.current=ne},[ne]);const $=i.useCallback(j=>{const k=N.current.get(j.id);return e.jsx(tn,{data:{...j.data,value:k}})},[]),Te=i.useMemo(()=>({computed:$}),[$]),ie=j=>{var r;if(!j.target||!j.targetHandle){x(h=>jt(j,h));return}const k=l.find(h=>h.id===j.target),Q=k?u[((r=k.data)==null?void 0:r.type)??""]:null,t=Q==null?void 0:Q.handles.find(h=>h.id===j.targetHandle);x(h=>{let T=h;return t!=null&&t.limitOne&&(T=h.filter(q=>!(q.target===j.target&&q.targetHandle===j.targetHandle))),jt(j,T)})},oe=j=>{const k=crypto.randomUUID(),Q=u[j]??{label:j,handles:[]},t=Q.label;L(r=>[...r,{id:k,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:Q.label,type:j,name:"",handles:Q.handles,list:j==="input.list"?[]:void 0,output:Q.output??!0}}])},we=j=>{if(_){if(j.name!==void 0){const k=j.name.trim(),Q=k===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(k);if(F(Q?null:a.cogita.library.graph.invalidName),!k)f(null);else{const t=l.find(r=>{var h;return r.id!==_&&((h=r.data)==null?void 0:h.name)&&r.data.name.trim().toLowerCase()===k.toLowerCase()});f(t?a.cogita.library.graph.duplicateName:null)}}L(k=>k.map(Q=>{var t,r,h,T;return Q.id===_?{...Q,data:{...Q.data,...j,title:j.name?j.name:(t=Q.data)==null?void 0:t.title,subtitle:((h=u[j.type??((r=Q.data)==null?void 0:r.type)??""])==null?void 0:h.label)??((T=Q.data)==null?void 0:T.subtitle)}}:Q}))}},Le=()=>{_&&(L(j=>j.filter(k=>k.id!==_)),x(j=>j.filter(k=>k.source!==_&&k.target!==_)),G(j=>{const k={...j};return delete k[_],k}),H(null),f(null))},Ne=i.useRef({nodeId:null,edgeIds:[]}),Be=j=>{var T;const k=((T=j.nodes[0])==null?void 0:T.id)??null,Q=j.edges.map(q=>q.id),t=Ne.current,r=t.nodeId===k,h=t.edgeIds.length===Q.length&&t.edgeIds.every((q,ae)=>q===Q[ae]);r&&h||(Ne.current={nodeId:k,edgeIds:Q},H(k),c(Q))},Me=j=>{const k=j.filter(Q=>Q.type!=="select"&&Q.type!=="dimensions");k.length!==0&&L(Q=>hi(k,Q))},Qe=j=>{const k=j.filter(Q=>Q.type!=="select");k.length!==0&&x(Q=>gi(k,Q))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Wt,{nodeTypes:Te,nodes:K,edges:m,onNodesChange:Me,onEdgesChange:Qe,onConnect:ie,onNodeClick:(j,k)=>H(k.id),onSelectionChange:Be,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(zt,{gap:18,size:1}),e.jsx(Ht,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>oe("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>oe("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>oe("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>oe("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>oe("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>oe("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>oe("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>oe("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>oe("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>oe("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>oe("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>oe("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>oe("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>oe("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>oe("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>oe("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>oe("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>oe("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>oe("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>oe("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),le?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Ke=le.data)==null?void 0:Ke.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:j=>we({name:j.target.value})}),b?e.jsx("em",{className:"cogita-help",children:b}):null,X?e.jsx("em",{className:"cogita-help",children:X}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((We=u[((Fe=le.data)==null?void 0:Fe.type)??""])==null?void 0:We.label)??((oa=le.data)==null?void 0:oa.type)]}),((Re=le.data)==null?void 0:Re.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((W=le.data)==null?void 0:W.outputLabel)??"",onChange:j=>we({outputLabel:j.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((Z=le.data)==null?void 0:Z.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((De=le.data)==null?void 0:De.min)??0,onChange:j=>we({min:Number(j.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Ce=le.data)==null?void 0:Ce.max)??10,onChange:j=>we({max:Number(j.target.value)})})]})]}),((fe=le.data)==null?void 0:fe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:((Pe=le.data)==null?void 0:Pe.value)??0,onChange:j=>we({value:Number(j.target.value)})})]}),((Oe=le.data)==null?void 0:Oe.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Ve=le.data)==null?void 0:Ve.list)??[]).join(`
`),onChange:j=>we({list:j.target.value.split(`
`).map(k=>k.replace(/\r$/,"")).filter(k=>k.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((Ae=le.data)==null?void 0:Ae.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{_&&(G(j=>{var h,T,q,ae;const k=Number.isFinite((h=le.data)==null?void 0:h.min)?Number((T=le.data)==null?void 0:T.min):0,Q=Number.isFinite((q=le.data)==null?void 0:q.max)?Number((ae=le.data)==null?void 0:ae.max):k+10,t=Math.min(k,Q),r=Math.max(k,Q);return{...j,[_]:Math.floor(Math.random()*(r-t+1))+t}}),se(j=>j+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Le,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const lr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function kr(a,n,o){if(!a)return null;const u=new Map(a.nodes.map(F=>[F.id,F])),g=new Map,w=new Set,p=F=>{if(typeof F=="number")return F;if(typeof F=="string"){const v=Number(F);return Number.isFinite(v)?v:0}return 0},S=F=>{if(g.has(F))return g.get(F);if(w.has(F))return 0;const v=u.get(F);if(!v)return 0;w.add(F);const G=se=>{var V,he;return(se?((V=v.inputsByHandle)==null?void 0:V[se])??[]:v.inputs??((he=v.inputsByHandle)==null?void 0:he.in)??[]).map(be=>S(be))};let P=0;switch(v.type){case"input.random":{const se=v.min??0,O=v.max??se+10,V=Math.min(se,O),he=Math.max(se,O);P=Math.floor(Math.random()*(he-V+1))+V;break}case"input.const":{P=v.value??0;break}case"input.list":{const se=(v.list??[]).filter(Boolean),O=Math.round(p(G("index")[0]));P=se.length?se[Math.max(0,Math.min(se.length-1,O))]:String(O);break}case"compute.add":{P=G("in").map(O=>p(O)).reduce((O,V)=>O+V,0);break}case"compute.sub":{const se=G("add").map(V=>p(V)),O=G("sub").map(V=>p(V));P=se.reduce((V,he)=>V+he,0)-O.reduce((V,he)=>V+he,0);break}case"compute.mul":{const se=G("in").map(O=>p(O));P=se.length?se.reduce((O,V)=>O*V,1):0;break}case"compute.div":{const se=p(G("num")[0]),O=G("den").map(V=>p(V)).reduce((V,he)=>V+he,0);P=Math.abs(O)<Number.EPSILON?0:se/O;break}case"compute.pow":{const se=p(G("base")[0]),O=p(G("exp")[0]);P=Math.pow(se,O);break}case"compute.exp":{const se=p(G("base")[0]),O=p(G("exp")[0]);P=Math.pow(se,O);break}case"compute.log":{const se=p(G("value")[0]),O=p(G("base")[0]),V=Math.max(se,Number.EPSILON);P=Math.abs(O)<Number.EPSILON?Math.log(V):Math.log(V)/Math.log(O);break}case"compute.abs":{P=Math.abs(p(G("in")[0]));break}case"compute.min":{const se=G("in").map(O=>p(O));P=se.length?Math.min(...se):0;break}case"compute.max":{const se=G("in").map(O=>p(O));P=se.length?Math.max(...se):0;break}case"compute.floor":{P=Math.floor(p(G("in")[0]));break}case"compute.ceil":{P=Math.ceil(p(G("in")[0]));break}case"compute.round":{P=Math.round(p(G("in")[0]));break}case"compute.mod":{const se=p(G("a")[0]),O=p(G("b")[0]);P=Math.abs(O)<Number.EPSILON?0:se%O;break}case"compute.concat":{const O=["in1","in2","in3","in4","in5","in6"].flatMap(le=>G(le)),V=O.length?O:G("in");P=(V.length?V:G()).map(le=>le==null?"":String(le)).join("");break}case"compute.trim":{const se=G("text")[0]??G("in")[0]??"",O=se==null?"":String(se),V=Math.max(0,Math.round(p(G("start")[0]))),he=Math.max(0,Math.round(p(G("end")[0])));V+he>=O.length?P="":P=O.substring(V,O.length-he);break}case"output":{P=G("in")[0]??0;break}default:P=0}return w.delete(F),g.set(F,P),P},R=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(F=>F.type==="output").map(F=>F.id);a.nodes.forEach(F=>S(F.id)),R.forEach(F=>S(F));const B=F=>Math.abs(F%1)<1e-5?String(Math.round(F)):F.toFixed(3).replace(/\.?0+$/,""),l=F=>typeof F=="number"?B(F):F??"",L=new Map;R.forEach(F=>{var O,V,he,be;const v=u.get(F);if(!v)return;const G=(V=(O=v.inputsByHandle)==null?void 0:O.name)==null?void 0:V[0],P=G?l(g.get(G)):"",se=(P==null?void 0:P.toString().trim())||((he=v.outputLabel)==null?void 0:he.trim())||((be=v.name)==null?void 0:be.trim())||F;L.set(F,se)});const m={},x={},_={};R.forEach(F=>{var P,se;const v=u.get(F);if(!v)return;const G=L.get(F)??(((P=v.outputLabel)==null?void 0:P.trim())||((se=v.name)==null?void 0:se.trim())||F);m[G]=l(g.get(F)),v.name&&(x[v.name.trim()]=G),x[F]=G});const H=(F,v)=>{let G=F;return a.nodes.forEach(P=>{var be,le;const se=l(g.get(P.id)),O=R.includes(P.id),V=O?L.get(P.id)??((be=P.outputLabel)==null?void 0:be.trim())??((le=P.name)==null?void 0:le.trim())??P.id:"",he=O&&v?V:se;G=G.replace(new RegExp(`\\{\\s*${lr(P.id)}\\s*\\}`,"gi"),he),P.name&&(G=G.replace(new RegExp(`\\{\\s*${lr(P.name)}\\s*\\}`,"gi"),he)),O&&P.outputLabel&&(G=G.replace(new RegExp(`\\{\\s*${lr(P.outputLabel)}\\s*\\}`,"gi"),V))}),G},U=n;let c=U.trim().length>0?U:"";c||(c=R.length?`Compute ${R.join(", ")}`:"Compute"),c=H(c,!0);const b=(o==null?void 0:o.trim())??"",f=b?H(b,!1):"",X={};return g.forEach((F,v)=>{X[v]=F,_[v]=l(F);const G=u.get(v);G!=null&&G.name&&(_[G.name.trim()]=l(F))}),{prompt:c,answers:m,values:X,answerText:f,outputVariables:x,variableValues:_}}function Zr(a){var o;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((o=n[0])==null?void 0:o[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function nn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l,editInfoId:L}){const{libraryName:m}=Ra(l),x=!!L,_=`/#/cogita/library/${l}`,[H,U]=i.useState("info"),[c,b]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[f,X]=i.useState(""),[F,v]=i.useState(null),[G,P]=i.useState(null),[se,O]=i.useState("idle"),[V,he]=i.useState(null),[be,le]=i.useState(-1),[K,de]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[s,ne]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[N,$]=i.useState(null),[Te,ie]=i.useState("idle"),[oe,we]=i.useState(null),[Le,Ne]=i.useState(null),[Be,Me]=i.useState(null),Qe=i.useRef(null),Ke=i.useRef(null),Fe=i.useRef(null),We=i.useMemo(()=>Xr(a),[a]),oa=i.useMemo(()=>Qi(a),[a]),Re=i.useMemo(()=>Gi(a),[a]),W=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),Z=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),De=i.useMemo(()=>We.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[We]),Ce=i.useMemo(()=>{const t=R;return At.map(r=>{var q;const h=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${h.abbr} — ${h.name}`,latin:((q=r==null?void 0:r.la)==null?void 0:q.abbr)??h.abbr}})},[R]),fe=(t,r=!1)=>{const h=t.trim().toLowerCase();return h?Ce.filter(T=>T.label.toLowerCase().includes(h)).slice(0,8):r?Ce.slice(0,8):[]},Pe=(t,r)=>{const h=t.trim().toLowerCase();if(!h)return null;const T=At;for(const q of T){const ae=q==null?void 0:q.la,te=(q==null?void 0:q[r])??(q==null?void 0:q.en)??ae;if([te==null?void 0:te.abbr,te==null?void 0:te.name,ae==null?void 0:ae.abbr,ae==null?void 0:ae.name,`${te==null?void 0:te.abbr} — ${te==null?void 0:te.name}`].filter(Boolean).map(ge=>ge.toLowerCase()).some(ge=>ge===h))return{book:q,entry:te,la:ae}}return null};i.useEffect(()=>{if(!K.language||!K.word){we(null);return}const t=window.setTimeout(()=>{nr({libraryId:l,languageId:K.language.id,wordId:K.word.id}).then(r=>{we(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{we(null)})},200);return()=>window.clearTimeout(t)},[l,K.language,K.word]),i.useEffect(()=>{if(!s.languageA||!s.wordA){Ne(null);return}const t=window.setTimeout(()=>{nr({libraryId:l,languageId:s.languageA.id,wordId:s.wordA.id}).then(r=>{Ne(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Ne(null)})},200);return()=>window.clearTimeout(t)},[l,s.languageA,s.wordA]),i.useEffect(()=>{if(!s.languageB||!s.wordB){Me(null);return}const t=window.setTimeout(()=>{nr({libraryId:l,languageId:s.languageB.id,wordId:s.wordB.id}).then(r=>{Me(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Me(null)})},200);return()=>window.clearTimeout(t)},[l,s.languageB,s.wordB]),i.useEffect(()=>{if(!x||!L)return;let t=!1;return ie("loading"),$(null),Za({libraryId:l,infoId:L}).then(async r=>{var T,q;if(t)return;const h=r.payload??{};if(b(ae=>({...ae,infoType:r.infoType,label:h.label??"",notes:h.notes??"",language:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,sourceKind:h.sourceKind??"string",sourceResourceType:ae.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:h.text??"",workLanguage:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,workOriginalLanguage:h.originalLanguageId?{id:h.originalLanguageId,label:h.originalLanguageId,infoType:"language"}:null,workDoi:h.doi??"",mediaType:h.mediaType??"book",mediaPublisher:h.publisher??"",mediaPublicationPlace:h.publicationPlace??"",mediaPublicationYear:h.publicationYear??"",mediaPages:h.pages??"",mediaIsbn:h.isbn??"",mediaCover:h.cover??"",mediaHeight:h.height??"",mediaLength:h.length??"",mediaWidth:h.width??"",mediaWeight:h.weight??"",mediaCollection:h.collection??"",mediaLocation:h.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&h.locator&&typeof h.locator=="object"){const ae=h.locator;if(h.sourceKind==="website")b(te=>({...te,sourceUrl:typeof ae.url=="string"?ae.url:"",sourceAccessedDate:typeof ae.date=="string"?ae.date:""}));else if(h.sourceKind==="bible"){const te=typeof ae.book=="string"?ae.book:"",re=te?Pe(te,R):null,ge=re?`${re.entry.abbr} — ${re.entry.name}`:te;b(ce=>({...ce,sourceLocatorValue:te,sourceLocatorAux:typeof ae.rest=="string"?ae.rest:"",sourceBibleBookDisplay:ge}))}else h.sourceKind==="book"?b(te=>({...te,sourceLocatorValue:typeof ae.page=="string"?ae.page:""})):h.sourceKind==="number_document"?b(te=>({...te,sourceLocatorValue:typeof ae.number=="string"?ae.number:""})):typeof ae.text=="string"&&b(te=>({...te,sourceLocatorValue:ae.text}))}if(h.languageId&&r.infoType!=="work")try{const ae=await Za({libraryId:l,infoId:h.languageId});if(t)return;b(te=>{var re;return{...te,language:{id:h.languageId,label:((re=ae.payload)==null?void 0:re.label)??h.languageId,infoType:"language"}}})}catch{}if(h.languageId&&r.infoType==="work")try{const ae=await Za({libraryId:l,infoId:h.languageId});if(t)return;b(te=>{var re;return{...te,workLanguage:{id:h.languageId,label:((re=ae.payload)==null?void 0:re.label)??h.languageId,infoType:"language"}}})}catch{}if(h.originalLanguageId)try{const ae=await Za({libraryId:l,infoId:h.originalLanguageId});if(t)return;b(te=>{var re;return{...te,workOriginalLanguage:{id:h.originalLanguageId,label:((re=ae.payload)==null?void 0:re.label)??h.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(X(((T=h.definition)==null?void 0:T.answerTemplate)??""),v(((q=h.definition)==null?void 0:q.graph)??null),P(null),O("idle")):(X(""),v(null),P(null),O("idle")),U("info")}).catch(()=>{t||$(a.cogita.library.add.info.failed)}).finally(()=>{t||ie("idle")}),()=>{t=!0}},[a,L,x,l]),i.useEffect(()=>{if(c.sourceKind==="bible"&&c.sourceLocatorValue&&V!=="source"){const t=Pe(c.sourceLocatorValue,R);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==c.sourceBibleBookDisplay&&b(h=>({...h,sourceBibleBookDisplay:r}))}}},[R,c.sourceKind,c.sourceLocatorValue,c.sourceBibleBookDisplay]);const Oe=async()=>{var t,r;$(null);try{const h={label:c.infoType==="quote"||c.infoType==="source"?"":c.label,notes:c.infoType==="computed"?"":c.notes};if(c.language&&(c.infoType==="word"||c.infoType==="sentence")&&(h.languageId=c.language.id),c.infoType==="source"&&(h.sourceKind=c.sourceKind,c.sourceKind==="website"?h.locator={url:c.sourceUrl.trim(),date:c.sourceAccessedDate.trim()}:c.sourceKind==="bible"?h.locator={book:c.sourceLocatorValue.trim(),rest:c.sourceLocatorAux.trim()}:c.sourceKind==="book"?h.locator={page:c.sourceLocatorValue.trim()}:c.sourceKind==="number_document"?h.locator={number:c.sourceLocatorValue.trim()}:h.locator={text:c.sourceLocatorValue.trim()}),c.infoType==="quote"&&(h.text=c.quoteText),c.infoType==="work"&&(h.languageId=((t=c.workLanguage)==null?void 0:t.id)??null,h.originalLanguageId=((r=c.workOriginalLanguage)==null?void 0:r.id)??null,h.doi=c.workDoi.trim()),c.infoType==="media"&&(h.mediaType=c.mediaType,h.publisher=c.mediaPublisher.trim(),h.publicationPlace=c.mediaPublicationPlace.trim(),h.publicationYear=c.mediaPublicationYear.trim(),h.pages=c.mediaPages.trim(),h.isbn=c.mediaIsbn.trim(),h.cover=c.mediaCover.trim(),h.height=c.mediaHeight.trim(),h.length=c.mediaLength.trim(),h.width=c.mediaWidth.trim(),h.weight=c.mediaWeight.trim(),h.collection=c.mediaCollection.trim(),h.location=c.mediaLocation.trim()),c.infoType==="computed"){if(!F){$(a.cogita.library.add.info.computedRequired);return}if(!f.trim()){$(a.cogita.library.add.info.computedAnswerRequired);return}if(F.nodes.find(ce=>ce.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(ce.name))){$(a.cogita.library.add.info.computedInvalidName);return}const q=F.nodes.map(ce=>{var ve;return(ve=ce.name)==null?void 0:ve.trim()}).filter(Boolean),ae=new Set;for(const ce of q){const ve=ce.toLowerCase();if(ae.has(ve)){$(a.cogita.library.add.info.computedDuplicateName);return}ae.add(ve)}const te=F.nodes.filter(ce=>ce.type==="output"),re=te.map(ce=>{var ve;return(ve=ce.name)==null?void 0:ve.trim()}).filter(Boolean);if(re.length!==te.length){$(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!re.every(ce=>new RegExp(`\\{\\s*${ce}\\s*\\}`,"i").test(f))){$(a.cogita.library.add.info.computedAnswerMissingOutput);return}h.definition={answerTemplate:f,graph:F}}if(x&&L)ie("saving"),await fi({libraryId:l,infoId:L,payload:h}),$(a.cogita.library.add.info.updated),ie("idle");else{let T=null;if(c.referenceEnabled){const ce={sourceKind:c.referenceSourceKind,locatorValue:c.referenceLocatorValue,locatorAux:c.referenceLocatorAux,bibleBookDisplay:c.referenceBibleBookDisplay,sourceUrl:c.referenceSourceUrl,sourceAccessedDate:c.referenceSourceAccessedDate,churchDocument:c.referenceChurchDocument,bookMedia:c.referenceBookMedia,work:c.referenceWork},{payload:ve,resourceInfoId:ea,error:Je}=Ve(ce);if(Je){$(a.cogita.library.add.info.referenceMissingSource);return}T={payload:ve,resourceInfoId:ea}}const q=await Xa({libraryId:l,infoType:c.infoType,payload:h});if(c.infoType==="source"&&c.sourceResource&&await da({libraryId:l,connectionType:"source-resource",infoIds:[q.infoId,c.sourceResource.id]}),c.infoType==="quote"&&c.language&&await da({libraryId:l,connectionType:"quote-language",infoIds:[q.infoId,c.language.id]}),T){const ce=await Xa({libraryId:l,infoType:"source",payload:T.payload});T.resourceInfoId&&await da({libraryId:l,connectionType:"source-resource",infoIds:[ce.infoId,T.resourceInfoId]}),await da({libraryId:l,connectionType:"reference",infoIds:[q.infoId,ce.infoId]})}$(a.cogita.library.add.info.saved);const ae=c.infoType==="word"||c.infoType==="sentence",te=c.referenceEnabled,re=c.referenceSourceKind,ge={referenceEnabled:te,referenceSourceKind:te?re:"string",referenceSourceUrl:te&&re==="website"?c.referenceSourceUrl:"",referenceSourceAccessedDate:te&&re==="website"?c.referenceSourceAccessedDate:"",referenceChurchDocument:te&&re==="number_document"?c.referenceChurchDocument:null,referenceBookMedia:te&&re==="book"?c.referenceBookMedia:null,referenceWork:te&&re==="work"?c.referenceWork:null,referenceLocatorValue:te&&re==="bible"?c.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:te&&re==="bible"?c.referenceBibleBookDisplay:""};b({infoType:c.infoType,label:"",language:ae?c.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:c.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...ge}),c.infoType==="computed"&&(X(""),v(null),P(null),O("idle"))}}catch{$(a.cogita.library.add.info.failed)}},Ve=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const h={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(h.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:h,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(h.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:h,resourceInfoId:r}):(t.sourceKind==="book"?h.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?h.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(h.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:h,resourceInfoId:r})},Ae=()=>{if(O("idle"),!F){P(null),O("error");return}const t=kr(F,"",f);if(!t){P(null),O("error");return}P({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),O("ready")},j=async()=>{$(null);try{if(K.connectionType==="reference"){if(!K.referencedInfo||!K.source){$(a.cogita.library.add.connection.selectReference);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.referencedInfo.id,K.source.id]})}else if(K.connectionType==="source-resource"){if(!K.source||!K.sourceResource){$(a.cogita.library.add.connection.selectSourceResource);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.source.id,K.sourceResource.id]})}else if(K.connectionType==="quote-language"){if(!K.quote||!K.language){$(a.cogita.library.add.connection.selectQuoteLanguage);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.quote.id,K.language.id]})}else if(K.connectionType==="work-contributor"){if(!K.work||!K.contributor||!K.contributorRole.trim()){$(a.cogita.library.add.connection.selectWorkContributor);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.work.id,K.contributor.id],payload:{role:K.contributorRole.trim()}})}else if(K.connectionType==="work-medium"){if(!K.work||!K.medium){$(a.cogita.library.add.connection.selectWorkMedium);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.work.id,K.medium.id]})}else if(K.connectionType==="orcid-link"){if(!K.orcidEntity||!K.orcid){$(a.cogita.library.add.connection.selectOrcidLink);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.orcidEntity.id,K.orcid.id]})}else if(K.connectionType==="word-language"){if(!K.language||!K.word){$(a.cogita.library.add.connection.selectWordLanguage);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.language.id,K.word.id],payload:{note:K.note}})}else if(K.connectionType==="word-topic"){if(!K.word||!K.topic){$(a.cogita.library.add.connection.selectWordTopic);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.word.id,K.topic.id],payload:{note:K.note}})}else if(K.connectionType==="translation"){if(!K.wordA||!K.wordB){$(a.cogita.library.add.connection.selectTwoWords);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.wordA.id,K.wordB.id],payload:{note:K.note}})}else if(K.connectionType==="language-sentence"){if(!K.language||!K.sentence){$(a.cogita.library.add.connection.selectLanguageSentence);return}await da({libraryId:l,connectionType:K.connectionType,infoIds:[K.language.id,K.sentence.id],payload:{note:K.note}})}$(a.cogita.library.add.connection.saved),de(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{$(a.cogita.library.add.connection.failed)}},k=async()=>{var t,r;$(null);try{if(s.groupType==="citation"){const T=s.citationTitle.trim(),q=s.citationQuoteText.trim();if(!q){$(a.cogita.library.add.group.citationMissingQuote);return}let ae=null;if(s.citationReferenceEnabled){const ge={sourceKind:s.citationSourceKind,locatorValue:s.citationLocatorValue,locatorAux:s.citationLocatorAux,bibleBookDisplay:s.citationBibleBookDisplay,sourceUrl:s.citationSourceUrl,sourceAccessedDate:s.citationSourceAccessedDate,churchDocument:s.citationChurchDocument,bookMedia:s.citationBookMedia,work:s.citationWork},{payload:ce,resourceInfoId:ve,error:ea}=Ve(ge);if(ea){$(a.cogita.library.add.info.referenceMissingSource);return}ae={payload:ce,resourceInfoId:ve}}const te={text:q};T&&(te.title=T);const re=await Xa({libraryId:l,infoType:"quote",payload:te});if(s.citationLanguage&&await da({libraryId:l,connectionType:"quote-language",infoIds:[re.infoId,s.citationLanguage.id]}),ae){const ge=await Xa({libraryId:l,infoType:"source",payload:ae.payload});ae.resourceInfoId&&await da({libraryId:l,connectionType:"source-resource",infoIds:[ge.infoId,ae.resourceInfoId]}),await da({libraryId:l,connectionType:"reference",infoIds:[re.infoId,ge.infoId]})}$(a.cogita.library.add.group.savedCitation),ne(ge=>({...ge,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:ge.citationReferenceEnabled,citationSourceKind:ge.citationReferenceEnabled?ge.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:ge.citationReferenceEnabled?ge.citationChurchDocument:null,citationBookMedia:ge.citationReferenceEnabled?ge.citationBookMedia:null,citationWork:ge.citationReferenceEnabled?ge.citationWork:null}));return}if(s.groupType==="book"){const T=s.bookTitle.trim();if(!T){$(a.cogita.library.add.group.bookMissingTitle);return}const q=s.bookWorkTitle.trim();if(!q){$(a.cogita.library.add.group.bookMissingWork);return}if(s.bookContributors.find(ce=>ce.contributor&&!ce.role.trim()||!ce.contributor&&ce.role.trim())){$(a.cogita.library.add.group.bookMissingContributor);return}const te=await Xa({libraryId:l,infoType:"media",payload:{label:T,mediaType:"book",publisher:s.bookPublisher.trim(),publicationPlace:s.bookPublicationPlace.trim(),publicationYear:s.bookPublicationYear.trim(),pages:s.bookPages.trim(),isbn:s.bookIsbn.trim(),cover:s.bookCover.trim(),height:s.bookHeight.trim(),length:s.bookLength.trim(),width:s.bookWidth.trim(),weight:s.bookWeight.trim(),collection:s.bookCollection.trim(),location:s.bookLocation.trim()}}),re=await Xa({libraryId:l,infoType:"work",payload:{label:q,languageId:((t=s.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=s.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:s.bookWorkDoi.trim()}});await da({libraryId:l,connectionType:"work-medium",infoIds:[re.infoId,te.infoId]});const ge=s.bookContributors.filter(ce=>ce.contributor&&ce.role.trim());for(const ce of ge)await da({libraryId:l,connectionType:"work-contributor",infoIds:[re.infoId,ce.contributor.id],payload:{role:ce.role.trim()}});$(a.cogita.library.add.group.savedBook),ne(ce=>({...ce,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!s.languageA||!s.wordA||!s.languageB||!s.wordB){$(a.cogita.library.add.group.selectBoth);return}const h=T=>Array.from(new Map(T.map(q=>[q.id,q])).values());Le||await da({libraryId:l,connectionType:"word-language",infoIds:[s.languageA.id,s.wordA.id]}),Be||await da({libraryId:l,connectionType:"word-language",infoIds:[s.languageB.id,s.wordB.id]});for(const T of h(s.wordATags))await da({libraryId:l,connectionType:"word-topic",infoIds:[s.wordA.id,T.id]});for(const T of h(s.wordBTags))await da({libraryId:l,connectionType:"word-topic",infoIds:[s.wordB.id,T.id]});await da({libraryId:l,connectionType:"translation",infoIds:[s.wordA.id,s.wordB.id],payload:{tagIds:h(s.translationTags).map(T=>T.id)}}),$(a.cogita.library.add.group.savedVocab),ne(T=>({...T,groupType:s.groupType,languageA:s.languageA,wordA:null,languageB:s.languageB,wordB:null,wordATags:s.wordATags,wordBTags:s.wordBTags,translationTags:s.translationTags})),requestAnimationFrame(()=>{var T;return(T=Qe.current)==null?void 0:T.focus()})}catch{$(a.cogita.library.add.group.failed)}},Q=s.groupType==="citation"?a.cogita.library.add.group.saveCitation:s.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:_,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${_}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":H===t,onClick:()=>{x||U(t)},disabled:x&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[H==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:c.infoType,onChange:t=>{x||b(r=>({...r,infoType:t.target.value}))},disabled:x,children:We.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),c.infoType!=="quote"&&c.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:c.label,onChange:t=>b(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(c.infoType==="word"||c.infoType==="sentence"||c.infoType==="quote")&&e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:c.language,onChange:t=>b(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),c.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:c.workLanguage,onChange:t=>b(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:c.workOriginalLanguage,onChange:t=>b(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:c.workDoi,onChange:t=>b(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),c.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:c.mediaType,onChange:t=>b(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:c.mediaPublisher,onChange:t=>b(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:c.mediaPublicationPlace,onChange:t=>b(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:c.mediaPublicationYear,onChange:t=>b(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:c.mediaPages,onChange:t=>b(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:c.mediaIsbn,onChange:t=>b(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:c.mediaCover,onChange:t=>b(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:c.mediaHeight,onChange:t=>b(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:c.mediaLength,onChange:t=>b(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:c.mediaWidth,onChange:t=>b(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:c.mediaWeight,onChange:t=>b(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:c.mediaCollection,onChange:t=>b(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:c.mediaLocation,onChange:t=>b(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),c.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:c.quoteText,onChange:t=>b(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),c.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:c.sourceKind,onChange:t=>{const r=t.target.value,h=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":c.sourceResourceType;b(T=>({...T,sourceKind:r,sourceResourceType:h,sourceResource:null,sourceLocatorValue:r==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?T.sourceBibleBookDisplay:""}))},children:W.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),c.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:c.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;b(h=>({...h,sourceBibleBookDisplay:r,sourceLocatorValue:""})),he("source"),le(-1)},onKeyDown:t=>{const r=fe(c.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),le(h=>Math.min(h+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),le(h=>Math.max(h-1,0));else if((t.key==="Enter"||t.key==="Tab")&&be>=0&&r[be]){const h=r[be],T=Pe(h.label,R);if(!T)return;b(q=>{var ae;return{...q,sourceBibleBookDisplay:h.label,sourceLocatorValue:((ae=T.la)==null?void 0:ae.abbr)??q.sourceLocatorValue}}),he(null)}}},onFocus:()=>he("source"),onBlur:()=>window.setTimeout(()=>he(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),V==="source"&&fe(c.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:fe(c.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===be,tabIndex:-1,onMouseDown:()=>{const h=Pe(t.label,R);h&&b(T=>{var q;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((q=h.la)==null?void 0:q.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:c.sourceLocatorAux,onChange:t=>b(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),c.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:c.sourceUrl,onChange:t=>b(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:c.sourceAccessedDate,onChange:t=>b(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),c.sourceKind!=="website"&&c.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:c.sourceLocatorValue,onChange:t=>b(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),c.sourceKind!=="string"&&c.sourceKind!=="website"&&c.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:c.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(c.sourceKind),onChange:t=>b(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:De.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ue,{libraryId:l,infoType:c.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:c.sourceResource,onChange:t=>b(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ia(a,c.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),c.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:c.notes,onChange:t=>b(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,c.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:f,onChange:t=>X(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(rn,{copy:a,value:F,onChange:t=>v(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Ae,children:a.cogita.library.add.info.computedPreview})}),G&&se==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(Et,{value:G.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(G.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(fr,{value:r,mode:"auto"})]},t))}),G.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(Et,{value:G.answerText,mode:"auto"})]}):null]}):se==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:c.referenceEnabled,onChange:t=>b(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),c.referenceEnabled&&e.jsx(Ar,{libraryId:l,copy:a,language:R,sourceKindOptions:W,labels:Z,value:{sourceKind:c.referenceSourceKind,locatorValue:c.referenceLocatorValue,locatorAux:c.referenceLocatorAux,bibleBookDisplay:c.referenceBibleBookDisplay,sourceUrl:c.referenceSourceUrl,sourceAccessedDate:c.referenceSourceAccessedDate,churchDocument:c.referenceChurchDocument,bookMedia:c.referenceBookMedia,work:c.referenceWork},onChange:t=>b(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:Oe,disabled:Te==="saving"||Te==="loading",children:x?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,H==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:K.connectionType,onChange:t=>de(r=>({...r,connectionType:t.target.value})),children:oa.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),K.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>de(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:K.word,onChange:t=>de(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),oe&&e.jsx("p",{className:"cogita-help",children:oe})]}),K.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:K.word,onChange:t=>de(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:K.topic,onChange:t=>de(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:K.wordA,onChange:t=>de(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:K.wordB,onChange:t=>de(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:K.quote,onChange:t=>de(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>de(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>de(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:K.sentence,onChange:t=>de(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:K.referencedInfoType,onChange:t=>de(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:We.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ue,{libraryId:l,infoType:K.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:K.referencedInfo,onChange:t=>de(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ia(a,K.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:K.source,onChange:t=>de(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:K.source,onChange:t=>de(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:K.sourceResourceType,onChange:t=>de(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:De.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ue,{libraryId:l,infoType:K.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:K.sourceResource,onChange:t=>de(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ia(a,K.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:K.work,onChange:t=>de(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:K.contributorType,onChange:t=>de(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ia(a,t)},t))})]}),e.jsx(Ue,{libraryId:l,infoType:K.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:K.contributor,onChange:t=>de(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ia(a,K.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:K.contributorRole,onChange:t=>de(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),K.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:K.work,onChange:t=>de(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:K.medium,onChange:t=>de(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:K.orcidEntityType,onChange:t=>de(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ia(a,t)},t))})]}),e.jsx(Ue,{libraryId:l,infoType:K.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:K.orcidEntity,onChange:t=>de(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ia(a,K.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(Ue,{libraryId:l,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:K.orcid,onChange:t=>de(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:K.note,onChange:t=>de(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:j,children:a.cogita.library.add.connection.save})})]}):null,H==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:s.groupType,onChange:t=>ne(r=>({...r,groupType:t.target.value})),children:Re.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:s.citationLanguage,onChange:t=>ne(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:s.citationTitle,onChange:t=>ne(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:s.citationQuoteText,onChange:t=>ne(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.citationReferenceEnabled,onChange:t=>ne(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),s.citationReferenceEnabled&&e.jsx(Ar,{libraryId:l,copy:a,language:R,sourceKindOptions:W,labels:Z,value:{sourceKind:s.citationSourceKind,locatorValue:s.citationLocatorValue,locatorAux:s.citationLocatorAux,bibleBookDisplay:s.citationBibleBookDisplay,sourceUrl:s.citationSourceUrl,sourceAccessedDate:s.citationSourceAccessedDate,churchDocument:s.citationChurchDocument,bookMedia:s.citationBookMedia,work:s.citationWork},onChange:t=>ne(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),s.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:s.bookTitle,onChange:t=>ne(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:s.bookPublisher,onChange:t=>ne(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:s.bookPublicationPlace,onChange:t=>ne(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:s.bookPublicationYear,onChange:t=>ne(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:s.bookPages,onChange:t=>ne(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:s.bookIsbn,onChange:t=>ne(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:s.bookCover,onChange:t=>ne(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:s.bookHeight,onChange:t=>ne(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:s.bookLength,onChange:t=>ne(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:s.bookWidth,onChange:t=>ne(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:s.bookWeight,onChange:t=>ne(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:s.bookCollection,onChange:t=>ne(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:s.bookLocation,onChange:t=>ne(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:s.bookWorkTitle,onChange:t=>ne(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:s.bookWorkLanguage,onChange:t=>ne(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:s.bookWorkOriginalLanguage,onChange:t=>ne(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:s.bookWorkDoi,onChange:t=>ne(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>ne(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),s.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:h=>ne(T=>({...T,bookContributors:T.bookContributors.map((q,ae)=>ae===r?{...q,contributorType:h.target.value,contributor:null}:q)})),children:["person","institution","collective"].map(h=>e.jsx("option",{value:h,children:ia(a,h)},h))})]}),e.jsx(Ue,{libraryId:l,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:h=>ne(T=>({...T,bookContributors:T.bookContributors.map((q,ae)=>ae===r?{...q,contributor:h}:q)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ia(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:h=>ne(T=>({...T,bookContributors:T.bookContributors.map((q,ae)=>ae===r?{...q,role:h.target.value}:q)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>ne(h=>{const T=h.bookContributors.filter((q,ae)=>ae!==r);return T.length===0?{...h,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...h,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),s.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:s.languageA,onChange:t=>ne(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:s.languageB,onChange:t=>ne(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:s.wordA,onChange:t=>ne(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Qe,autoAdvance:!0,onCommit:()=>{var t;return(t=Ke.current)==null?void 0:t.focus()}}),e.jsx(Ue,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:s.wordB,onChange:t=>ne(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Ke,autoAdvance:!0,onCommit:()=>{var t;return(t=Fe.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(Ue,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:s.translationTags,onChangeMultiple:t=>ne(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(Ue,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:s.wordATags,onChangeMultiple:t=>ne(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ue,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:s.wordBTags,onChangeMultiple:t=>ne(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),s.groupType==="vocab"&&Le&&e.jsx("p",{className:"cogita-help",children:Le}),s.groupType==="vocab"&&Be&&e.jsx("p",{className:"cogita-help",children:Be}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:k,ref:Fe,children:Q})})]}):null,N?e.jsx("p",{className:"cogita-form-error",children:N}):null]})})})})})]})})}const Br=a=>/\s/.test(a),Bt=a=>/[\p{L}\p{N}]/u.test(a),Dr=(a,n)=>{const o=n>0?a[n-1]:"",u=n<a.length?a[n]:"";if(!o||!u)return 0;const g=Br(o),w=Br(u);if(g||w)return 3;const p=Bt(o),S=Bt(u);return p!==S?2:!p&&!S?1:0},or=(a,n,o,u,g)=>{const w=Math.max(u-n,o-u);for(let p=0;p<=w;p+=1){const S=u-p;if(S>=n&&S<=o&&Dr(a,S)>=g)return S;const R=u+p;if(R>=n&&R<=o&&Dr(a,R)>=g)return R}return null},sr=(a,n)=>{const o=n>0?a[n-1]:"",u=n<a.length?a[n]:"";return!o||!u?!0:Bt(o)!==Bt(u)},ln=(a,n,o,u)=>{const g=o-n,w=n+u,p=o-u;if(g<=u*2||p<=w)return null;const S=Math.floor((n+o)/2),R=or(a,w,p,S,3);if(R!==null&&sr(a,R))return R;const B=or(a,w,p,S,2);if(B!==null&&sr(a,B))return B;const l=or(a,w,p,S,1);return l!==null&&sr(a,l)?l:null},bt=(a,n)=>{const o=Math.max(1,7),u=Math.max(o,13),g={},w=(R,B,l,L,m)=>{const x=String(L),_={id:x,start:R,end:B,text:a.slice(R,B),depth:l,index:L,parentId:m};if(g[x]=_,B-R>u){let U=ln(a,R,B,o);if(U!==null&&U>R&&U<B){const c=w(R,U,l+1,L*2+1,x),b=w(U,B,l+1,L*2+2,x);_.leftId=c.id,_.rightId=b.id}}return _},p=w(0,a.length,0,0),S=Object.values(g).sort((R,B)=>B.depth-R.depth||R.start-B.start).map(R=>R.id);return{text:a,rootId:p.id,nodes:g,order:S}},gt=(a,n,o,u,g,w,p)=>{const S=w==="reverse"?a.order.slice().sort((R,B)=>a.nodes[B].start-a.nodes[R].start||a.nodes[B].depth-a.nodes[R].depth):a.order;for(const R of S){if(p&&R===p||n.has(R))continue;const B=a.nodes[R];if(B){if(g&&(B.leftId||B.rightId)){const l=B.leftId?o[B.leftId]??0:u,L=B.rightId?o[B.rightId]??0:u;if((l+L)/2<u)continue}return B}}return null},ei=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function on({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l}){const L=`/#/cogita/library/${l}`,[m,x,_]=vr([]),[H,U,c]=jr([]),[b,f]=i.useState(null),[X,F]=i.useState(null),[v,G]=i.useState(null),[P,se]=i.useState(null),O=i.useMemo(()=>m.find(s=>s.id===b)??null,[m,b]);i.useEffect(()=>{let s=!0;return xi({libraryId:l}).then(ne=>{if(!s)return;const N=ne.nodes.map($=>{var Te,ie,oe;return{id:$.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:$.payload&&typeof $.payload=="object"&&"label"in $.payload?String($.payload.label):"Item",nodeType:$.nodeType,itemType:((Te=$.payload)==null?void 0:Te.itemType)??"info",itemId:((ie=$.payload)==null?void 0:ie.itemId)??null,infoType:((oe=$.payload)==null?void 0:oe.infoType)??null}}});x(N),U(ne.edges.map($=>({id:$.edgeId,source:$.fromNodeId,target:$.toNodeId})))}).catch(()=>{s&&(x([]),U([]))}),()=>{s=!1}},[l]),i.useEffect(()=>{yi({libraryId:l}).then(F).catch(()=>F(null))},[l,m,H]);const V=i.useCallback(s=>{U(ne=>jt(s,ne))},[]),he=()=>{const s=crypto.randomUUID();x(ne=>[...ne,{id:s,type:"default",position:{x:140+ne.length*40,y:120+ne.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},be=()=>{const s=crypto.randomUUID();x(ne=>[...ne,{id:s,type:"default",position:{x:180+ne.length*40,y:160+ne.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},le=async()=>{G(null);try{const s=m.map(N=>({nodeId:N.id,nodeType:N.data.nodeType,payload:{itemType:N.data.itemType,itemId:N.data.itemId??null,label:N.data.label,infoType:N.data.infoType??null}})),ne=H.map(N=>({edgeId:N.id,fromNodeId:N.source,toNodeId:N.target}));await vi({libraryId:l,nodes:s,edges:ne}),G(a.cogita.library.graph.saveSuccess)}catch{G(a.cogita.library.graph.saveFail)}},K=s=>{O&&x(ne=>ne.map(N=>N.id===O.id?{...N,data:{...N.data,itemId:(s==null?void 0:s.infoId)??null,itemType:"collection",infoType:"collection",label:(s==null?void 0:s.label)??a.cogita.library.infoTypes.collection}}:N))},de=s=>{O&&x(ne=>ne.map(N=>N.id===O.id?{...N,data:{...N.data,itemId:(s==null?void 0:s.infoId)??null,itemType:"info",infoType:(s==null?void 0:s.infoType)??null,label:(s==null?void 0:s.label)??a.cogita.library.infoTypes.any}}:N))};return i.useEffect(()=>{if(!O||O.data.nodeType!=="info"||O.data.infoType!=="quote"||!O.data.itemId){se(null);return}let s=!0;return Za({libraryId:l,infoId:O.data.itemId}).then(ne=>{if(!s)return;const N=ne.payload,$=(N==null?void 0:N.text)??"";if(!$){se(null);return}const Te=bt($),ie=Object.values(Te.nodes).sort((oe,we)=>oe.depth-we.depth||oe.start-we.start).map(oe=>({id:oe.id,text:oe.text,depth:oe.depth}));se({title:(N==null?void 0:N.title)??O.data.label,fragments:ie})}).catch(()=>se(null)),()=>{s=!1}},[l,O]),e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:L,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:le,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:he,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:be,children:a.cogita.library.actions.addInfo}),X?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(X.totalCollections))})}):null,v?e.jsx("p",{className:"cogita-help",children:v}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Wt,{nodes:m,edges:H,onNodesChange:_,onEdgesChange:c,onConnect:V,onNodeClick:(s,ne)=>f(ne.id),fitView:!0,children:[e.jsx(zt,{gap:18,size:1}),e.jsx(Ht,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),O?e.jsxs("div",{className:"cogita-graph-inspector",children:[O.data.nodeType==="collection"?e.jsx(Ue,{libraryId:l,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:O.data.itemId?{id:O.data.itemId,label:O.data.label,infoType:"collection"}:null,onChange:K,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(Ue,{libraryId:l,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:O.data.itemId?{id:O.data.itemId,label:O.data.label,infoType:O.data.infoType??void 0}:null,onChange:de,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),P?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:P.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:P.fragments.map(s=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:s.id}),e.jsx("span",{children:s.text})]},s.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function sn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l,collectionId:L}){const{libraryName:m}=Ra(l),[x,_]=i.useState([]),[H,U]=i.useState("loading"),[c,b]=i.useState("idle"),f=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),X=`/#/cogita/library/${l}`,F=()=>{U("loading"),Hr({libraryId:l}).then(P=>{_(P),U("idle")}).catch(()=>{_([]),U("error")})};i.useEffect(()=>{F()},[l]);const v=async P=>{try{await Jr({libraryId:l,shareId:P}),F()}catch{F()}},G=async P=>{const se=`${f}/${P}`;try{await navigator.clipboard.writeText(se),b("copied")}catch{b("failed")}};return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:X,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${X}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[H==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):H==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):x.filter(P=>!L||P.collectionId===L).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:x.filter(P=>!L||P.collectionId===L).map(P=>e.jsxs("div",{className:"cogita-share-row","data-state":P.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:P.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(P.createdUtc).toLocaleString(),P.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),P.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${f}/${P.shareCode}`}):null]}),P.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[P.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>G(P.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>v(P.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},P.shareId))}),c==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):c==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function cn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l}){const{libraryName:L}=Ra(l),[m,x]=i.useState(null),[_,H]=i.useState(null),[U,c]=i.useState(null),[b,f]=i.useState(null),[X,F]=i.useState(null),[v,G]=i.useState(null),P=i.useRef(null),se=he=>{if(!Number.isFinite(he))return"0 B";if(he<1024)return`${he} B`;const be=he/1024;if(be<1024)return`${be.toFixed(1)} KB`;const le=be/1024;return le<1024?`${le.toFixed(1)} MB`:`${(le/1024).toFixed(1)} GB`},O=async()=>{x(null),F({loadedBytes:0,totalBytes:null,percent:null});try{x(a.cogita.library.overview.exporting);const he=await ji(l,F),be=URL.createObjectURL(he),le=document.createElement("a");le.href=be,le.download=`cogita-library-${L||l}.json`,le.click(),URL.revokeObjectURL(be),x(a.cogita.library.overview.exportReady)}catch{x(a.cogita.library.overview.exportFail)}finally{F(he=>he??{loadedBytes:0,totalBytes:null,percent:null})}},V=async he=>{var le;H(null),c(null),f(null);const be=(le=he.target.files)==null?void 0:le[0];if(be)try{H(a.cogita.library.overview.importing),G({loadedBytes:0,totalBytes:be.size,percent:0});const K=await wi(l,be,G,de=>{const s=de.stage==="infos"?a.cogita.library.overview.importStageInfos:de.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;f(a.cogita.library.overview.importLiveProgress.replace("{stage}",s).replace("{done}",String(de.processed)).replace("{total}",String(de.total)).replace("{infos}",String(de.infos)).replace("{connections}",String(de.connections)).replace("{collections}",String(de.collections)))});c({infos:K.infosImported,connections:K.connectionsImported,collections:K.collectionsImported}),H(a.cogita.library.overview.importDone)}catch(K){const de=K instanceof ki&&K.message?` ${K.message}`:"";H(`${a.cogita.library.overview.importFail}${de}`)}finally{P.current&&(P.current.value="")}};return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:L}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:O,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:P,type:"file",accept:"application/json",onChange:V})]})]}),X?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:X.percent??void 0,max:X.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",se(X.loadedBytes)).replace("{total}",X.totalBytes?se(X.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,v?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:v.percent??void 0,max:v.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",se(v.loadedBytes)).replace("{total}",v.totalBytes?se(v.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null,_?e.jsx("p",{className:"cogita-help",children:_}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null,U?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(U.infos)).replace("{connections}",String(U.connections)).replace("{collections}",String(U.collections))}):null]})]})})})]})})}function dn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l}){const{libraryName:L}=Ra(l),[m,x]=i.useState(""),[_,H]=i.useState([]),U=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:L}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:c=>x(c.target.value),placeholder:a.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const c=m.trim();c&&(H(b=>[{id:U(),name:c},...b]),x(""))},children:a.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[_.length===0?e.jsx("p",{children:a.cogita.library.modules.storyboardsEmpty}):null,_.map(c=>e.jsx("button",{type:"button",className:"ghost",children:c.name},c.id))]})]})]})})})]})})}function un({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l}){const{libraryName:L}=Ra(l),[m,x]=i.useState(""),[_,H]=i.useState([]),U=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:L}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:c=>x(c.target.value),placeholder:a.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const c=m.trim();c&&(H(b=>[{id:U(),name:c},...b]),x(""))},children:a.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[_.length===0?e.jsx("p",{children:a.cogita.library.modules.textsEmpty}):null,_.map(c=>e.jsx("button",{type:"button",className:"ghost",children:c.name},c.id))]})]})]})})})]})})}function gn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l}){const{libraryName:L}=Ra(l),m=`/#/cogita/library/${l}`,[x,_]=i.useState(""),[H,U]=i.useState([]),[c,b]=i.useState("idle"),[f,X]=i.useState(0),[F,v]=i.useState(null);i.useEffect(()=>{b("loading");const P=window.setTimeout(()=>{wt({libraryId:l,query:x.trim()||void 0,limit:30}).then(se=>{U(se.items),X(se.total),v(se.nextCursor??null),b("ready")}).catch(()=>{U([]),X(0),v(null),b("ready")})},240);return()=>window.clearTimeout(P)},[l,x]);const G=async()=>{if(F){b("loading");try{const P=await wt({libraryId:l,query:x.trim()||void 0,limit:30,cursor:F});U(se=>[...se,...P.items]),v(P.nextCursor??null),X(P.total),b("ready")}catch{b("ready")}}};return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:L}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${m}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:x,onChange:P=>_(P.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(H.length)).replace("{total}",String(f||H.length))}),e.jsx("span",{children:c==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:H.length?H.map(P=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${m}/collections/${P.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:P.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(P.itemCount))," ·"," ",P.notes||a.cogita.library.collections.noNotes]})]})},P.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${m}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),F?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:G,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const Kr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],hn={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},bn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],mn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function pn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l,onCreated:L}){const{libraryName:m}=Ra(l),x=`/#/cogita/library/${l}`,[_,H]=i.useState(null),[U,c]=i.useState(""),[b,f]=i.useState(""),[X,F,v]=vr([]),[G,P,se]=jr([]),[O,V]=i.useState(null),[he,be]=i.useState(null),le=i.useMemo(()=>X.find(N=>N.id===O)??null,[X,O]),K=N=>{var oe;const $=crypto.randomUUID(),Te=((oe=Kr.find(we=>we.type===N))==null?void 0:oe.label)??N,ie={...hn[N]};F(we=>[...we,{id:$,type:"default",position:{x:120+we.length*40,y:120+we.length*40},data:{nodeType:N,label:Te,params:ie}}]),V($)},de=i.useCallback(N=>{P($=>jt({...N,id:crypto.randomUUID()},$))},[P]),s=N=>{le&&F($=>$.map(Te=>Te.id===le.id?{...Te,data:{...Te.data,params:N}}:Te))},ne=async()=>{if(be(null),!U.trim()){be(a.cogita.library.collections.saveRequiredName);return}try{const N={nodes:X.map(ie=>({nodeId:ie.id,nodeType:ie.data.nodeType,payload:{position:ie.position,params:ie.data.params}})),edges:G.map(ie=>({edgeId:ie.id,fromNodeId:ie.source,fromPort:ie.sourceHandle??null,toNodeId:ie.target,toPort:ie.targetHandle??null}))};let $=_,Te=!1;if($)await Qr({libraryId:l,collectionId:$,nodes:N.nodes,edges:N.edges});else{const ie=await Yr({libraryId:l,name:U.trim(),notes:b.trim()||void 0,items:[],graph:N});$=ie.collectionId,Te=!0,H(ie.collectionId)}be(Te?a.cogita.library.collections.saveSuccess:a.cogita.library.graph.saveSuccess),L($)}catch{be(_?a.cogita.library.graph.saveFail:a.cogita.library.collections.saveFail)}};return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.createKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.createSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:x,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${x}/collections`,children:a.cogita.library.actions.collections}),e.jsx("button",{type:"button",className:"cta",onClick:ne,children:a.cogita.library.actions.saveCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.collectionInfoTitle}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{value:U,onChange:N=>c(N.target.value),placeholder:a.cogita.library.collections.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.notesLabel}),e.jsx("textarea",{value:b,onChange:N=>f(N.target.value),placeholder:a.cogita.library.collections.notesPlaceholder})]}),he?e.jsx("p",{className:"cogita-help",children:he}):null,e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:Kr.map(N=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>K(N.type),children:N.label},N.type))})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Wt,{nodes:X,edges:G,onNodesChange:v,onEdgesChange:se,onConnect:de,onNodeClick:(N,$)=>V($.id),fitView:!0,children:[e.jsx(zt,{color:"rgba(120,160,200,0.2)"}),e.jsx(Ht,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),le?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:le.data.label}),le.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:le.data.params.tagId?{id:le.data.params.tagId,label:le.data.params.tagLabel??"",infoType:"topic"}:null,onChange:N=>s({...le.data.params,tagId:(N==null?void 0:N.id)??null,tagLabel:(N==null?void 0:N.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:le.data.params.scope??"any",onChange:N=>s({...le.data.params,scope:N.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),le.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:le.data.params.languageId?{id:le.data.params.languageId,label:le.data.params.languageLabel??"",infoType:"language"}:null,onChange:N=>s({...le.data.params,languageId:(N==null?void 0:N.id)??null,languageLabel:(N==null?void 0:N.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:le.data.params.scope??"any",onChange:N=>s({...le.data.params,scope:N.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),le.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:le.data.params.infoType??"word",onChange:N=>s({...le.data.params,infoType:N.target.value}),children:mn.map(N=>e.jsx("option",{value:N.value,children:N.label},N.value))})]}),e.jsx(Ue,{libraryId:l,infoType:le.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:le.data.params.infoId?{id:le.data.params.infoId,label:le.data.params.infoLabel??"",infoType:le.data.params.infoType??"word"}:null,onChange:N=>s({...le.data.params,infoId:(N==null?void 0:N.id)??null,infoLabel:(N==null?void 0:N.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),le.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:le.data.params.connectionType??"translation",onChange:N=>s({...le.data.params,connectionType:N.target.value}),children:bn.map(N=>e.jsx("option",{value:N.value,children:N.label},N.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:le.data.params.connectionId??"",onChange:N=>s({...le.data.params,connectionId:N.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(le.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function fn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l,collectionId:L}){Ra(l);const m=`/#/cogita/library/${l}`,[x,_]=i.useState(a.cogita.library.collections.defaultName),[H,U]=i.useState(null),[c,b]=i.useState(0),[f,X]=i.useState([]),[F,v]=i.useState("idle"),[G,P]=i.useState(null),se=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(c||f.length)),[a,f.length,c]);i.useEffect(()=>{Jt(l,L).then(V=>{_(V.name),U(V.notes??null),b(V.itemCount)}).catch(()=>{_(a.cogita.library.collections.defaultName),U(null)})},[l,L]),i.useEffect(()=>{v("loading"),Ft({libraryId:l,collectionId:L,limit:40}).then(V=>{X(V.items),P(V.nextCursor??null),b(V.total),v("ready")}).catch(()=>{X([]),P(null),v("ready")})},[l,L]);const O=async()=>{if(G){v("loading");try{const V=await Ft({libraryId:l,collectionId:L,limit:40,cursor:G});X(he=>[...he,...V.items]),P(V.nextCursor??null),b(V.total),v("ready")}catch{v("ready")}}};return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:H||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${m}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${m}/collections/${L}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${m}/collections/${L}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:se}),e.jsx("span",{children:F==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:f.length?f.map(V=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:V.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:V.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:V.label}),e.jsx("p",{className:"cogita-card-subtitle",children:V.description})]})},pe(V))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),G?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:O,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${m}/collections/${L}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Aa=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,o=a.filter(w=>w.correct).length,u=Yt(Tr(a));return{score:Math.round(Math.max(0,Math.min(100,u.knowness*100))*100)/100,total:n,correct:o,lastReviewedUtc:u.lastReviewedUtc??null}},xn=a=>{if(a.maskBase64)try{const n=Ti(a.maskBase64);if(!n.length)return a.correct?1:0;const o=n.reduce((u,g)=>u+g,0);return Math.max(0,Math.min(1,o/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},Tr=a=>a.map(n=>({correctness:xn(n),createdUtc:n.createdUtc})),Yt=(a,n=Date.now())=>{var c;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const u=a.slice().sort((b,f)=>b.createdUtc.localeCompare(f.createdUtc)).slice(-5),g=u.reduce((b,f)=>b+f.correctness,0)/u.length,w=5,p=2,S=.15;let R=0,B=0;for(let b=0;b<u.length;b+=1){const f=new Date(u[b].createdUtc).getTime(),X=b===u.length-1?n:new Date(u[b+1].createdUtc).getTime(),F=Math.max(0,(X-f)/(1e3*60)),v=1-Math.exp(-F/w);R+=v,u[b].correctness>.5&&(B+=S)}let l=g*R*p+B;const L=((c=u[u.length-1])==null?void 0:c.createdUtc)??null,m=L?Math.max(0,(n-new Date(L).getTime())/(1e3*60)):0,_=1/(1+Math.log1p(m/60));return l*=_,u.length===1&&u[0].correctness>.5&&(l+=5.44*Math.exp(-m/2)),{knowness:l,avgCorrectness:g,lastReviewedUtc:L}},kt=a=>{const n=a.slice();for(let o=n.length-1;o>0;o-=1){const u=Math.floor(Math.random()*(o+1));[n[o],n[u]]=[n[u],n[o]]}return n},$t=a=>a[Math.floor(Math.random()*a.length)],yn=(a,n)=>{const o=new Map;return a.forEach(u=>o.set(u,Math.random())),a.sort((u,g)=>{const w=n(u)-n(g);return w!==0?w:(o.get(u)??0)-(o.get(g)??0)})},Qt=(a,n,o,u,g)=>{if(!a.length)return null;const w=a.filter(S=>!(g!=null&&g.has(pe(S))));if(w.length===0)return null;const p=w.filter(S=>pe(S)!==o);return $t(p.length?p:w)},vn=(a,n,o,u,g)=>{if(!a.length)return null;let w=Number.POSITIVE_INFINITY;for(const B of a){const l=pe(B);if(o.has(l))continue;const L=n[l]??1;L<w&&(w=L)}if(!Number.isFinite(w))return null;const p=a.filter(B=>{const l=pe(B);return!o.has(l)&&(n[l]??1)===w}),S=p.filter(B=>!g||pe(B)!==g),R=u?S.filter(B=>!u.has(pe(B))):S;return R.length>0?$t(R):S.length>0?$t(S):g&&p.some(B=>pe(B)===g)?p.find(B=>pe(B)===g)??null:p.length?$t(p):null},ai=(a,n,o,u,g)=>{const w=[],p=a.filter(R=>!g.has(pe(R))&&!o.has(pe(R))&&(n[pe(R)]??0)<1),S=yn(p,R=>n[pe(R)]??0);for(const R of S){if(w.length>=u)break;w.push(R),g.add(pe(R))}if(w.length<u){const R=kt(a.filter(B=>!g.has(pe(B))&&o.has(pe(B))));for(const B of R){if(w.length>=u)break;w.push(B),g.add(pe(B))}}return w},jn=(a,n,o,u)=>ai(a,n,o,u,new Set),Nr=(a,n,o,u,g,w)=>{const p=Math.max(1,o.stackSize??n),R=kt(a).filter((_,H,U)=>U.findIndex(c=>pe(c)===pe(_))===H),B=jn(R,u,g,p),l=new Set,L=new Set,m=Qt(B,{},null,l,L),x=m?[m]:[];return m&&L.add(pe(m)),{queue:x,meta:{pool:R,active:B,knownessMap:u,unknownSet:g,outcomesById:w,asked:l,queued:L}}},xr={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const u=kt(a).filter((g,w,p)=>p.findIndex(S=>pe(S)===pe(g))===w);return{queue:u.slice(0,Math.min(n,u.length)),meta:{}}},applyOutcome:a=>a},Lr=(a,n,o,u)=>{const g=Math.max(1,o.stackSize??n),p=kt(a).filter((H,U,c)=>c.findIndex(b=>pe(b)===pe(H))===U),S={},R=new Set,B=new Set,l=new Set,L=Math.max(1,o.levels??1);p.forEach(H=>{const U=pe(H),c=u==null?void 0:u[U],b=typeof c=="number"&&Number.isFinite(c)?c:1;S[U]=Math.min(L,Math.max(1,Math.round(b)))});const m=[];if(p.length>0){const H=new Map;p.forEach(c=>{var f;const b=S[pe(c)]??1;H.has(b)||H.set(b,[]),(f=H.get(b))==null||f.push(c)});const U=Array.from(H.keys()).sort((c,b)=>c-b);for(const c of U){if(m.length>=g)break;const b=kt(H.get(c)??[]);for(const f of b){if(m.length>=g)break;m.push(f)}}}const x=Qt(m,S,null,R,B),_=x?[x]:[];return x&&B.add(pe(x)),{queue:_,meta:{pool:p,active:m,levelMap:S,asked:R,queued:B,wrongSinceCorrect:l}}},wn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,o)=>Lr(a,n,o),applyOutcome:(a,n,o,u,g)=>{if(!n)return a;const w=Math.max(1,u.levels??1),p=a.meta.pool??[],S=a.meta.active??[],R={...a.meta.levelMap??{}},B=new Set(a.meta.asked??[]),l=new Set(a.meta.queued??[]),L=new Set(a.meta.wrongSinceCorrect??[]),m=pe(n);l.delete(m),B.add(m);const x=R[m]??1;g.correct?(R[m]=L.has(m)?1:Math.min(x+1,w),L.delete(m)):(R[m]=1,L.add(m));const _=g.correct?S.filter(c=>pe(c)!==m):S.slice();if(g.correct&&_.length<Math.max(1,u.stackSize??1)){const c=new Set(_.map(f=>pe(f))),b=vn(p,R,c,B,m);b&&_.push(b)}const H=a.queue.slice(),U=Qt(_,R,m,B,l);return U&&(H.push(U),l.add(pe(U))),{queue:H,meta:{pool:p,active:_,levelMap:R,asked:B,queued:l,wrongSinceCorrect:L}}}},kn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,o)=>Nr(a,n,o,{},new Set,{}),applyOutcome:(a,n,o,u,g)=>{if(!n)return a;const w=a.meta.pool??[],p=a.meta.active??[],S={...a.meta.knownessMap??{}},R=new Set(a.meta.unknownSet??[]),B={...a.meta.outcomesById??{}},l=new Set(a.meta.asked??[]),L=new Set(a.meta.queued??[]),m=pe(n);L.delete(m),l.add(m);const x={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},H=(B[m]??[]).concat(x).sort((F,v)=>F.createdUtc.localeCompare(v.createdUtc)).slice(-5);B[m]=H,R.delete(m);const U=Date.now();w.forEach(F=>{const v=pe(F),G=B[v]??[];if(G.length===0){S[v]=0,R.add(v);return}const P=Yt(G,U);S[v]=P.knowness});const c=p.slice();if((S[m]??0)>=1){const F=c.filter(v=>pe(v)!==m);c.length=0,c.push(...F)}const f=Math.max(1,u.stackSize??o);if(c.length<f){const F=new Set(c.map(G=>pe(G))),v=ai(w,S,R,f-c.length,F);c.push(...v)}const X=a.queue.slice();if(X.length===0||pe(X[X.length-1])===m){const F=Qt(c,{},m,l,L);F&&(X.push(F),L.add(pe(F)))}return{queue:X,meta:{pool:w,active:c,knownessMap:S,unknownSet:R,outcomesById:B,asked:l,queued:L}}}},ti={random:xr,levels:wn,temporal:kn},Tn=Object.values(ti),Cr=a=>{if(!a)return xr;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?ti[n]:xr},Gt=(a,n)=>{const o={...a.defaultSettings};return n&&Object.entries(n).forEach(([u,g])=>{typeof g=="number"&&Number.isFinite(g)&&(o[u]=g),typeof g=="string"&&(o[u]=g)}),a.settingsFields.forEach(u=>{var w;const g=o[u.key];if(u.type==="number"){if(typeof g!="number"||Number.isNaN(g)){o[u.key]=a.defaultSettings[u.key]??0;return}u.min!==void 0&&(o[u.key]=Math.max(u.min,o[u.key])),u.max!==void 0&&(o[u.key]=Math.min(u.max,o[u.key]));return}if(u.type==="select"){const p=((w=u.options)==null?void 0:w.map(S=>S.value))??[];(typeof g!="string"||p.length>0&&!p.includes(g))&&(o[u.key]=a.defaultSettings[u.key]??p[0]??"")}}),o},ri=(a,n)=>{const o={};return a.settingsFields.forEach(u=>{const g=n.get(u.key);if(g){if(u.type==="number"){const w=Number(g);Number.isNaN(w)||(o[u.key]=w);return}o[u.key]=g}}),Gt(a,o)},Nn=(a,n)=>{const o=new URLSearchParams;return a.settingsFields.forEach(u=>{const g=n[u.key];(typeof g=="number"||typeof g=="string")&&o.set(u.key,String(g))}),o};function Ln({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l,collectionId:L,revisionId:m}){const{libraryName:x}=Ra(l),_=`/#/cogita/library/${l}`,[H,U]=i.useState(a.cogita.library.collections.defaultName),[c,b]=i.useState(""),[f,X]=i.useState(20),[F,v]=i.useState("random"),[G,P]=i.useState({}),[se,O]=i.useState("exact"),[V,he]=i.useState([]),[be,le]=i.useState(null),[K,de]=i.useState([]),[s,ne]=i.useState("idle"),[N,$]=i.useState(null),[Te,ie]=i.useState("idle"),[oe,we]=i.useState("idle"),[Le,Ne]=i.useState("idle"),Be=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Me=i.useMemo(()=>Cr(F),[F]),Qe=i.useMemo(()=>Gt(Me,G),[Me,G]),Ke=i.useMemo(()=>Nn(Me,Qe).toString(),[Me,Qe]);i.useEffect(()=>{Jt(l,L).then(Z=>U(Z.name)).catch(()=>U(a.cogita.library.collections.defaultName))},[l,L]),i.useEffect(()=>{m&&Ni({libraryId:l,collectionId:L,revisionId:m}).then(Z=>{b(Z.name),v(Z.mode||"random"),O(Z.check||"exact"),X(Z.limit||20),P(Z.revisionSettings??{})}).catch(()=>{b("")})},[L,l,m]),i.useEffect(()=>{Li({libraryId:l}).then(Z=>{he(Z),!be&&Z.length>0&&le(Z[0].roleId)}).catch(()=>{he([])})},[l]);const Fe=()=>{we("loading"),Hr({libraryId:l}).then(Z=>{de(Z),we("idle")}).catch(()=>{de([]),we("error")})};i.useEffect(()=>{Fe()},[l]);const We=async()=>{ne("working"),ie("idle");try{const Z=await Mi({libraryId:l,collectionId:L,revisionType:Me.id,revisionSettings:Qe,mode:F,check:se,limit:f});$(`${Be}/${Z.shareCode}${Ke?`?${Ke}`:""}`),ne("ready"),Fe()}catch{ne("error")}},oa=async()=>{if(m){Ne("saving");try{await Ci({libraryId:l,collectionId:L,revisionId:m,name:c||H,revisionType:Me.id,revisionSettings:Qe,mode:F,check:se,limit:f}),Ne("saved")}catch{Ne("error")}}},Re=async()=>{if(N)try{await navigator.clipboard.writeText(N),ie("copied")}catch{ie("failed")}},W=async Z=>{try{await Jr({libraryId:l,shareId:Z}),Fe()}catch{Fe()}};return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:H}),e.jsx("p",{className:"cogita-library-subtitle",children:x})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:_,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${_}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${_}/collections/${L}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${_}/collections/${L}/revision/run?mode=${encodeURIComponent(F)}&check=${encodeURIComponent(se)}&limit=${f}${Ke?`&${Ke}`:""}${be?`&reviewer=${encodeURIComponent(be)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:c,onChange:Z=>b(Z.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:F,onChange:Z=>v(Z.target.value),children:Tn.map(Z=>e.jsx("option",{value:Z.id,children:a.cogita.library.revision[Z.labelKey]},Z.id))})]}),Me.settingsFields.map(Z=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[Z.labelKey]}),Z.type==="select"?e.jsx("select",{value:String(Qe[Z.key]??""),onChange:De=>P(Ce=>({...Ce,[Z.key]:De.target.value})),children:(Z.options??[]).map(De=>e.jsx("option",{value:De.value,children:a.cogita.library.revision[De.labelKey]},De.value))}):e.jsx("input",{type:"number",min:Z.min,max:Z.max,step:Z.step,value:Qe[Z.key]??0,onChange:De=>P(Ce=>({...Ce,[Z.key]:Number(De.target.value||0)}))})]},Z.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),Me.id!=="levels"&&Me.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:f,onChange:Z=>X(Number(Z.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:be??"",onChange:Z=>le(Z.target.value||null),children:V.map(Z=>e.jsx("option",{value:Z.roleId,children:Z.label},Z.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[m?e.jsx("button",{type:"button",className:"cta ghost",onClick:oa,disabled:Le==="saving",children:Le==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${_}/collections/${L}/revision/run?mode=${encodeURIComponent(F)}&check=${encodeURIComponent(se)}&limit=${f}${Ke?`&${Ke}`:""}${be?`&reviewer=${encodeURIComponent(be)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Le==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),N?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:N,readOnly:!0})]}):null,s==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,Te==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):Te==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:We,disabled:s==="working",children:s==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),N?e.jsx("button",{type:"button",className:"cta ghost",onClick:Re,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),oe==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):K.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:K.map(Z=>e.jsxs("div",{className:"cogita-share-row","data-state":Z.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:Z.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(Z.createdUtc).toLocaleString(),Z.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),Z.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>W(Z.shareId),children:a.cogita.library.revision.shareRevokeAction})]},Z.shareId))})]})]})]})]})})})]})})}function ii({copy:a,currentCard:n,currentTypeLabel:o,prompt:u,languages:g,answer:w,onAnswerChange:p,computedExpected:S,computedAnswers:R,onComputedAnswerChange:B,answerTemplate:l,outputVariables:L,variableValues:m,computedFieldFeedback:x,feedback:_,canAdvance:H,quoteContext:U,quotePlaceholder:c,onCheckAnswer:b,onSkip:f,onLanguageSelect:X,onMarkReviewed:F,onAdvance:v,showCorrectAnswer:G,setShowCorrectAnswer:P,onRevealCorrect:se,answerMask:O,expectedAnswer:V,hasExpectedAnswer:he,handleComputedKeyDown:be,answerInputRef:le,computedInputRefs:K,scriptMode:de,setScriptMode:s,matchPairs:ne,matchLeftOrder:N,matchRightOrder:$,matchSelection:Te,matchActiveLeft:ie,matchActiveRight:oe,matchFeedback:we,onMatchLeftSelect:Le,onMatchRightSelect:Ne}){const Be=i.useMemo(()=>{var Q;const W=!l&&S.length===2?`The {${S[0].key}} is of type {${S[1].key}}`:null,Z=l??W;if(!Z)return null;const De=new Map(S.map(t=>[t.key,t.expected])),Ce=new Set,fe=[],Pe=/\{([^}]+)\}/g;let Oe=0,Ve,Ae=null;for(;(Ve=Pe.exec(Z))!==null;){const t=Z.slice(Oe,Ve.index);t&&fe.push({type:"text",value:t});const r=((Q=Ve[1])==null?void 0:Q.trim())??"",h=r&&De.has(r)?r:r&&L&&L[r]?L[r]:null;r&&Ce.add(r),h&&Ce.add(h),h&&De.has(h)?(fe.push({type:"input",value:h}),Ae||(Ae=h)):r&&m&&m[r]!==void 0?fe.push({type:"text",value:m[r]}):fe.push({type:"text",value:Ve[0]}),Oe=Ve.index+Ve[0].length}const j=Z.slice(Oe);return j&&fe.push({type:"text",value:j}),S.filter(t=>!Ce.has(t.key)).length>0?null:{parts:fe,expectedByKey:De,firstInputKey:Ae}},[l,S,L,m]),Me=()=>{if(!Be)return null;const{parts:W,expectedByKey:Z,firstInputKey:De}=Be;return e.jsx("div",{className:"cogita-revision-inline-answer",children:W.map((Ce,fe)=>{var Pe,Oe;return Ce.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Ce.value},`text-${fe}`):e.jsx("input",{ref:Ve=>{K.current[Ce.value]=Ve},autoFocus:Ce.value===De,value:R[Ce.value]??"",onChange:Ve=>B(Ce.value,Ve.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[Ce.value]??(_==="correct"?"correct":_==="incorrect"?"incorrect":void 0),onKeyDown:Ve=>We(Ve)||be(Ve),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Pe=R[Ce.value])==null?void 0:Pe.length)??0,((Oe=Z.get(Ce.value))==null?void 0:Oe.length)??6)}ch`}},`input-${Ce.value}-${fe}`)})})},Qe=i.useMemo(()=>{const W=new Map;return(ne??[]).forEach(Z=>W.set(Z.leftId,Z)),W},[ne]),Ke=i.useMemo(()=>{const W=new Map;return(ne??[]).forEach(Z=>W.set(Z.rightId,Z)),W},[ne]);i.useEffect(()=>{var fe;if(n.cardType!=="info"||n.infoType!=="computed"||S.length===0)return;const W=typeof document<"u"?document.activeElement:null;if(W&&(W.tagName==="INPUT"||W.tagName==="TEXTAREA"))return;const Z=(Be==null?void 0:Be.firstInputKey)??((fe=S[0])==null?void 0:fe.key);if(!Z)return;const De=K.current[Z];if(!De)return;const Ce=requestAnimationFrame(()=>{De.focus()});return()=>cancelAnimationFrame(Ce)},[n,S,Be]);const Fe=(()=>{const W=[V??"",...S.map(Ce=>Ce.expected??"")].join(""),Z=[w,...Object.values(R)].join(""),De=`${W}${Z}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(De)})(),We=W=>W.ctrlKey&&(W.key==="^"||W.key==="6")?(W.preventDefault(),s(Z=>Z==="super"?null:"super"),!0):W.ctrlKey&&(W.key==="_"||W.key==="-")?(W.preventDefault(),s(Z=>Z==="sub"?null:"sub"),!0):!1,oa=()=>{if(!V||!O)return V??"";const W=V.split(""),Z=Array.from(O),De=Z.length>0?Z.reduce((Ce,fe)=>Ce+fe,0)/Z.length:127;return W.map((Ce,fe)=>{const Pe=Z[fe]??De,Oe=Math.max(0,Math.min(255,Math.round(Pe)));let Ve=255,Ae=0;return Oe<=127?Ae=Math.round(Oe/127*255):(Ae=255,Ve=Math.round(255*(1-(Oe-127)/128))),e.jsx("span",{style:{color:`rgb(${Ve}, ${Ae}, 0)`},children:Ce},`mask-${fe}`)})},Re=n.cardType==="info"&&n.infoType==="quote"?(U==null?void 0:U.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:o}),e.jsx("strong",{children:Re})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&ne?e.jsxs("div",{className:"cogita-revision-body",children:[u?e.jsx("h2",{children:u}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(N??[]).map(W=>{const Z=Qe.get(W);if(!Z)return null;const De=(Te==null?void 0:Te[W])??null,Ce=(we==null?void 0:we[W])??null,fe=ie===W;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":fe,"data-state":Ce??void 0,"data-locked":De?"true":void 0,onClick:()=>Le==null?void 0:Le(W),children:[e.jsx("span",{children:Z.leftLabel}),De&&G?e.jsx("em",{children:"✓"}):null]},W)})}),e.jsx("div",{className:"cogita-revision-match-column",children:($??[]).map(W=>{const Z=Ke.get(W);if(!Z)return null;const De=Object.values(Te??{}).includes(W),Ce=oe===W;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":De||Ce,"data-locked":De?"true":void 0,onClick:()=>Ne==null?void 0:Ne(W),children:e.jsx("span",{children:Z.rightLabel})},W)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:le,value:w,onChange:W=>p(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":_==="correct"?"correct":_==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),H?v():b())}})]}),Fe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":de==="super",onClick:()=>s(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":de==="sub",onClick:()=>s(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,l?null:e.jsx(Et,{value:u??"",mode:"auto"}),S.length>0?(()=>{const W=Me();return W?e.jsx("div",{className:"cogita-inline-answer-wrap",children:W}):e.jsx("div",{className:"cogita-form-grid",children:S.map((Z,De)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:Z.key}),e.jsx("textarea",{ref:Ce=>{K.current[Z.key]=Ce},autoFocus:De===0,value:R[Z.key]??"",onChange:Ce=>B(Z.key,Ce.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[Z.key]??(_==="correct"?"correct":_==="incorrect"?"incorrect":void 0),onKeyDown:Ce=>We(Ce)||be(Ce)})]},Z.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:le,value:w,onChange:W=>p(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":_==="correct"?"correct":_==="incorrect"?"incorrect":void 0,onKeyDown:W=>{We(W)||W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),H?v():b())}})]})}),Fe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":de==="super",onClick:()=>s(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":de==="sub",onClick:()=>s(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&U?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(U.completed)).replace("{total}",String(U.total))}),e.jsx("p",{className:"cogita-quote-text",children:U.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:le,value:w,onChange:W=>p(W.target.value),placeholder:c??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":_==="correct"?"correct":_==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),H?v():b())}})]}),e.jsx("p",{className:"cogita-quote-text",children:U.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(W=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>X(W.label),children:W.label},W.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:F,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}),_&&e.jsx("div",{className:"cogita-revision-feedback","data-state":_,children:_==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),_==="incorrect"&&he?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>P(W=>{const Z=!W;return Z&&se(),Z}),children:a.cogita.library.revision.showAnswer}),G?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),S.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[S.map(W=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:W.key}),e.jsx("span",{children:W.expected})]},W.key)),V?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:V})]}):null]}):e.jsx("p",{children:O?oa():V})]}):null]}):null,H?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:v,children:a.cogita.library.revision.nextQuestion})}):null]})}const cr=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ni({outcomes:a}){const[n,o]=i.useState("day"),u=i.useMemo(()=>{const g=cr.find(S=>S.id===n)??cr[1],w=Date.now()-g.ms,p=a.filter(S=>new Date(S.createdUtc).getTime()>=w);return Aa(p)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:cr.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>o(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[u.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[u.correct," / ",u.total]})]})}const Cn="cogita-revision",Mn=1,Dt="outcomes",Sn=()=>new Promise((a,n)=>{const o=indexedDB.open(Cn,Mn);o.onupgradeneeded=()=>{const u=o.result;if(!u.objectStoreNames.contains(Dt)){const g=u.createObjectStore(Dt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},o.onerror=()=>n(o.error),o.onsuccess=()=>a(o.result)}),Nt=async(a,n)=>{const o=await Sn();return new Promise((u,g)=>{const w=o.transaction(Dt,a),p=w.objectStore(Dt);n(p).then(u).catch(g),w.onerror=()=>g(w.error)})},li=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(o=>o.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},In=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const o=li();return localStorage.setItem(a,o),o},Pn=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),o=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(o)),o},oi=(a,n,o,u)=>Fa(a,n,o,u),Kt=async a=>{const n=In(),o=Pn(),u=new Date().toISOString(),g={...a,clientId:n,clientSequence:o,createdUtc:u,id:li(),pending:!0};return await Nt("readwrite",w=>new Promise((p,S)=>{const R={...g,itemKey:oi(g.itemType,g.itemId,g.checkType,g.direction)},B=w.add(R);B.onsuccess=()=>p(),B.onerror=()=>S(B.error)})),g},Ot=async(a,n,o,u)=>{if(!n)return[];try{const g=oi(a,n,o,u);return await Nt("readonly",w=>new Promise((p,S)=>{const B=w.index("byItem").getAll(g);B.onsuccess=()=>{const L=(B.result??[]).map(m=>({itemType:m.itemType,itemId:m.itemId,checkType:m.checkType??null,direction:m.direction??null,revisionType:m.revisionType,evalType:m.evalType,correct:m.correct,createdUtc:m.createdUtc,maskBase64:m.maskBase64,payloadBase64:m.payloadBase64,payloadHashBase64:m.payloadHashBase64,clientId:m.clientId,clientSequence:m.clientSequence,personRoleId:m.personRoleId??null})).sort((m,x)=>m.createdUtc.localeCompare(x.createdUtc));p(L)},B.onerror=()=>S(B.error)}))}catch{return[]}},Ba=async()=>{try{return await Nt("readonly",a=>new Promise((n,o)=>{const u=a.getAll();u.onsuccess=()=>{const w=(u.result??[]).map(p=>({itemType:p.itemType,itemId:p.itemId,checkType:p.checkType??null,direction:p.direction??null,revisionType:p.revisionType,evalType:p.evalType,correct:p.correct,createdUtc:p.createdUtc,maskBase64:p.maskBase64,payloadBase64:p.payloadBase64,payloadHashBase64:p.payloadHashBase64,clientId:p.clientId,clientSequence:p.clientSequence,personRoleId:p.personRoleId??null}));n(w)},u.onerror=()=>o(u.error)}))}catch{return[]}},$n=async(a=100)=>{try{return await Nt("readonly",n=>new Promise((o,u)=>{const w=n.index("byPending").getAll(!0);w.onsuccess=()=>{const p=w.result??[];o(p.slice(0,a))},w.onerror=()=>u(w.error)}))}catch{return[]}},Rn=async a=>{if(a.length!==0)try{await Nt("readwrite",n=>new Promise((o,u)=>{let g=a.length;a.forEach(w=>{const p=n.get(w);p.onsuccess=()=>{const S=p.result;if(S){S.pending=!1;const R=n.put(S);R.onsuccess=()=>{g-=1,g===0&&o()},R.onerror=()=>u(R.error)}else g-=1,g===0&&o()},p.onerror=()=>u(p.error)})}))}catch{}},dr=async(a,n)=>{const o=await $n(200);if(o.length===0)return;const u=new Map;o.forEach(g=>{var p;const w=g.personRoleId??n??"";u.has(w)||u.set(w,[]),(p=u.get(w))==null||p.push(g)});for(const[g,w]of u.entries()){const p=w.map(S=>({itemType:S.itemType,itemId:S.itemId,checkType:S.checkType??null,direction:S.direction??null,revisionType:S.revisionType,evalType:S.evalType,correct:S.correct,clientId:S.clientId,clientSequence:S.clientSequence,maskBase64:S.maskBase64??null,payloadHashBase64:S.payloadHashBase64??null,payloadBase64:S.payloadBase64??null,personRoleId:g||null}));try{await Si({libraryId:a,outcomes:p}),await Rn(w.map(S=>S.id))}catch{}}},Or={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},En=(a,n)=>{const o=Math.max(a.length,n.length,1),u=Math.abs(a.length-n.length);return Math.max(0,1-u/o)},Fn=(a,n)=>{const o=new Uint8Array(a.length),u=En(a,n);for(let g=0;g<a.length;g+=1){const w=a[g]===(n[g]??"")?128:0,p=a.length-1-g,S=n.length-1-g,R=a[p]===(n[S]??"")?127:0,B=Math.round((w+R)*u);o[g]=Math.max(0,Math.min(255,B))}return o},It=(a,n)=>a===n||(Or[a]??[]).includes(n)?!0:(Or[n]??[]).includes(a),Vt=(a,n)=>{const o=new Uint8Array(a.length);if(!a.length)return o;const u=[];for(let w=0;w<=a.length-3;w+=1)u.push({index:w,text:a.slice(w,w+3)});let g=!1;return u.forEach(w=>{for(let p=0;p<=n.length-3;p+=1){const S=n.slice(p,p+3);let R=0;for(let x=0;x<3;x+=1)It(w.text[x],S[x])&&(R+=1);if(R<2)continue;let B=w.index-1,l=p-1;for(;B>=0&&l>=0;){const x=a[B],_=n[l];if(x===_){o[B]=Math.max(o[B],255),B-=1,l-=1,g=!0;continue}if(It(x,_)){o[B]=Math.max(o[B],127),B-=1,l-=1,g=!0;continue}if(B>0&&a[B-1]===_){o[B]=Math.max(o[B],0),B-=1,g=!0;continue}if(l>0&&a[B]===n[l-1]){l-=1,g=!0;continue}break}for(let x=0;x<3;x+=1){const _=w.index+x,H=w.text[x],U=S[x],c=H===U?255:It(H,U)?127:0;o[_]=Math.max(o[_],c),g=!0}let L=w.index+3,m=p+3;for(;L<a.length&&m<n.length;){const x=a[L],_=n[m];if(x===_){o[L]=Math.max(o[L],255),L+=1,m+=1,g=!0;continue}if(It(x,_)){o[L]=Math.max(o[L],127),L+=1,m+=1,g=!0;continue}if(L+1<a.length&&a[L+1]===_){o[L]=Math.max(o[L],0),L+=1,g=!0;continue}if(m+1<n.length&&a[L]===n[m+1]){m+=1,g=!0;continue}break}}}),g?o:Fn(a,n)},ht=(a,n,o)=>{const u=a.trim().toLowerCase(),g=n.trim().toLowerCase();return Vt(u,g)},mt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),si=(a,n,o)=>{const u=mt(a),g=mt(n);return Vt(u,g)},va=a=>a.trim().toLowerCase(),An=a=>a==="reverse"?"reverse":"forward",Tt=(a,n)=>`${a}|${n}`,Na=a=>{if(!a)return null;const[n,o]=a.split("|",2);return(n==="forward"||n==="reverse")&&o?{mode:n,fragmentId:o}:{mode:"forward",fragmentId:a}},qt=(a,n)=>{var u;const o=Na(n);return o?o.fragmentId&&n?(a??null)===n:(((u=Na(a))==null?void 0:u.mode)??"forward")===o.mode:!0},ga=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},ci=(a,n)=>{if((ga(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const u=ga(a.childCheckType),g=ga(a.childDirection),w=ga(n.checkType),p=ga(n.direction);return!(u&&u!==w||g&&g!==p)},Bn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Dn={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},_t=(a,n,o)=>{if(!o||!n.startsWith(a))return n;const u=n.slice(a.length);if(!u)return n;const g=o==="super"?Bn:Dn,w=u.split("").map(p=>g[p]??p).join("");return a+w},Ut=(a,n,o)=>{var p,S,R;if(!a)return((p=n[0])==null?void 0:p.key)??null;const u=new Set(n.map(B=>B.key)),g=/\{([^}]+)\}/g;let w;for(;(w=g.exec(a))!==null;){const B=((S=w[1])==null?void 0:S.trim())??"";if(!B)continue;if(u.has(B))return B;const l=o==null?void 0:o[B];if(l&&u.has(l))return l}return((R=n[0])==null?void 0:R.key)??null},yr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const o=n.description??"";if(!o.trim())return[n];const u=Na(n.direction),g=(u==null?void 0:u.mode)??An(n.direction),w=bt(o),p=Object.keys(w.nodes);return p.length===0?[n]:p.map(S=>({...n,checkType:"quote-fragment",direction:Tt(g,S)}))});function Kn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l,collectionId:L,revisionId:m}){const x=wr(),_=`/#/cogita/library/${l}`,H=i.useMemo(()=>new URLSearchParams(x.search),[x.search]),U=Math.max(1,Number(H.get("limit")??20)),c=H.get("mode")??"random",b=i.useMemo(()=>Cr(c),[c]),f=i.useMemo(()=>Gt(b,ri(b,H)),[b,H]),X=H.get("check")??"exact",F=H.get("reviewer"),v=i.useMemo(()=>a.cogita.library.revision[b.labelKey]??c,[a,c,b]),G=i.useMemo(()=>X==="exact"?a.cogita.library.revision.checkValue:X,[a,X]),[P,se]=i.useState(a.cogita.library.collections.defaultName),[O,V]=i.useState([]),[he,be]=i.useState([]),[le,K]=i.useState("idle"),[de,s]=i.useState({current:0,total:0}),[ne,N]=i.useState(0),[$,Te]=i.useState(""),[ie,oe]=i.useState(null),[we,Le]=i.useState(null),[Ne,Be]=i.useState(null),[Me,Qe]=i.useState(null),[Ke,Fe]=i.useState([]),[We,oa]=i.useState({}),[Re,W]=i.useState({}),[Z,De]=i.useState(null),[Ce,fe]=i.useState(null),[Pe,Oe]=i.useState(null),[Ve,Ae]=i.useState(null),[j,k]=i.useState(null),[Q,t]=i.useState({}),r=i.useRef(0),[h,T]=i.useState(null),q=i.useRef(null),ae=i.useRef(null),[te,re]=i.useState(null),[ge,ce]=i.useState(!1),[ve,ea]=i.useState(null),[Je,ra]=i.useState([]),[qe,Ye]=i.useState(null),_e=i.useRef(null),A=i.useRef(null),[Ee,Ie]=i.useState(null),[aa,Ze]=i.useState(0),na=i.useRef(null),ba=i.useRef({}),[sa,ta]=i.useState(!1),[la,Sa]=i.useState({}),[Da,Ka]=i.useState([]),ha=i.useRef(new Map),[wa,fa]=i.useState(new Set),[pa,ze]=i.useState(!1),Ge=i.useRef(null),ka=i.useRef(new Set),Oa=i.useRef({}),ke=O[ne]??null,je=(ke==null?void 0:ke.checkType)==="translation-match"&&j,et=i.useRef(new Map),Va=i.useRef(new Map),at=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useMemo(()=>ke?ke.cardType==="vocab"?a.cogita.library.revision.vocabLabel:ke.infoType?ia(a,ke.infoType):a.cogita.library.revision.infoLabel:"",[a,ke]),Xt=i.useMemo(()=>{var y;return b.id!=="levels"?O.length:((y=la.pool)==null?void 0:y.length)??b.getFetchLimit(U,f)},[la,f,b,O.length,U]),rt=b.getProgressTotal?b.getProgressTotal(O,la,U,f):b.id==="levels"?Math.min(U,Xt):O.length,it=rt?Math.min(ne+1,rt):0,Ia=Math.max(1,Number(f.tries??1)),Ta=f.compare??"anchors",qa=Math.max(0,Math.min(100,Number(f.minCorrectness??0))),ma=(f.considerDependencies??"on")==="on",ca=Math.max(0,Math.min(100,Number(f.dependencyThreshold??85))),Ma=d=>{const y=d.slice();for(let I=y.length-1;I>0;I-=1){const C=Math.floor(Math.random()*(I+1));[y[I],y[C]]=[y[C],y[I]]}return y},Wa=d=>d.length?d.reduce((I,C)=>I+C,0)/d.length/255*100:0,_a=d=>Wa(d)>=qa,nt=async()=>{const d=await Ba(),y=new Map,I=new Map,C=new Map;d.forEach(D=>{const J=`${D.itemType}:${D.itemId}`,ue=Fa(D.itemType,D.itemId,D.checkType,D.direction);if(y.has(J)||y.set(J,[]),y.get(J).push(D),I.has(ue)||I.set(ue,[]),I.get(ue).push(D),D.itemType==="info"&&D.checkType==="quote-fragment"&&D.direction){const me=`${D.itemId}:${D.direction}`;C.has(me)||C.set(me,[]),C.get(me).push(D)}});const Y=new Map,M=new Map,z=new Map;return y.forEach((D,J)=>Y.set(J,Aa(D).score)),I.forEach((D,J)=>M.set(J,Aa(D).score)),C.forEach((D,J)=>z.set(J,Aa(D).score)),{itemKnowness:Y,cardKnowness:M,fragmentKnowness:z}},Zt=async d=>{const y=[];let I=null;for(;;){const C=await Ft({libraryId:l,collectionId:d,limit:200,cursor:I});if(y.push(...C.items),!C.nextCursor)break;I=C.nextCursor}return yr(y)},ft=async(d,y)=>{if(ha.current.has(d))return ha.current.get(d)??0;const I=await Zt(d);if(I.length===0)return ha.current.set(d,0),0;const Y=I.reduce((M,z)=>{const D=pe(z);return M+(y.get(D)??0)},0)/I.length;return ha.current.set(d,Y),Y},er=(d,y)=>{if(!ma||d.cardType!=="info"||d.infoType!=="quote"||d.checkType!=="quote-fragment")return!0;const I=Na(d.direction);if(!(I!=null&&I.fragmentId))return!0;const C=d.description??"";if(!C.trim())return!0;const M=bt(C).nodes[I.fragmentId];if(!M||!M.leftId&&!M.rightId)return!0;const z=[M.leftId,M.rightId].filter(ue=>!!ue);if(z.length===0)return!0;const D=z.map(ue=>{const me=Fa("info",d.cardId,"quote-fragment",Tt(I.mode,ue));return y.get(me)??0});return D.reduce((ue,me)=>ue+me,0)/D.length>=ca},lt=async d=>{const y=la,I=d.concat(y.active??[]).concat(y.pool??[]).filter((D,J,ue)=>ue.findIndex(me=>pe(me)===pe(D))===J);if(!ma){fa(new Set(I.map(pe)));return}const{itemKnowness:C,cardKnowness:Y}=await nt(),M=Da.filter(D=>ga(D.childItemType)==="collection"&&D.childItemId===L&&!ga(D.childCheckType)&&!ga(D.childDirection)),z=new Set;for(const D of I){if(D.cardType!=="info"){z.add(pe(D));continue}if(!er(D,Y))continue;const J=Da.filter(ye=>ci(ye,D)).concat(M);if(J.length===0){z.add(pe(D));continue}let ue=0;for(const ye of J)if(ga(ye.parentItemType)==="collection")ue+=await ft(ye.parentItemId,Y);else if(ga(ye.parentCheckType)||ga(ye.parentDirection)){const xe=ga(ye.parentCheckType),Se=ga(ye.parentDirection),$e=Fa(ye.parentItemType,ye.parentItemId,xe,Se);ue+=Y.get($e)??0}else{const xe=`${ye.parentItemType}:${ye.parentItemId}`;ue+=C.get(xe)??0}ue/J.length>=ca&&z.add(pe(D))}fa(z)},ar=d=>{for(let y=d;y<O.length;y+=1){const I=O[y];if(I&&(!ma||I.cardType!=="info"||wa.has(pe(I))))return y}return-1},La=d=>!ma||d.cardType!=="info"||wa.has(pe(d)),ot=d=>{if(b.id!=="temporal"&&b.id!=="levels")return null;const y=la,I=(y.active??[]).concat(y.pool??[]),C=new Set;for(const Y of I){const M=pe(Y);if(!(C.has(M)||d.has(M))&&(C.add(M),La(Y)))return Y}return null},Pa=i.useMemo(()=>{if(b.id!=="levels")return null;const d=la,y=d.pool??[],I=d.active??[],C=d.levelMap??{},Y=Math.max(1,Number(f.levels??1)),M=Array.from({length:Y},()=>0),z=new Set(I.map(me=>pe(me)));y.forEach(me=>{const ye=Math.min(Y,Math.max(1,C[pe(me)]??1));M[ye-1]+=1});const D=y.length||1,J=M.map(me=>me/D*100),ue=ke?C[pe(ke)]??1:null;return{counts:M,percentages:J,currentLevel:ue,levelsCount:Y,activeCount:I.length,poolCount:y.length,activeSet:z}},[la,f,b,ke]),xa=i.useMemo(()=>{if(b.id!=="temporal")return null;const d=la,y=d.pool??[],I=d.active??[],C=d.knownessMap??{},Y=new Set(d.unknownSet??[]);let M=0;y.forEach(J=>{(C[pe(J)]??0)>1&&(M+=1)});const z=Y.size,D=I.map(J=>({id:pe(J),value:Y.has(pe(J))?0:Math.max(0,Math.min(1,C[pe(J)]??0))}));return{knownCount:M,unknownCount:z,dots:D}},[la,b]),st=i.useMemo(()=>{if(!ma)return 0;const d=la;return O.concat(d.active??[]).concat(d.pool??[]).filter((I,C,Y)=>Y.findIndex(M=>pe(M)===pe(I))===C).filter(I=>I.cardType==="info"&&!wa.has(pe(I))).length},[ma,la,O,wa]);i.useEffect(()=>{if(!ma||le!=="ready")return;const d=la,I=O.concat(d.active??[]).concat(d.pool??[]).filter((M,z,D)=>D.findIndex(J=>pe(J)===pe(M))===z).filter(M=>M.cardType!=="info"||wa.has(pe(M))).length,C=_e.current;if(_e.current=I,C===null||I<=C)return;const Y=I-C;Ye(`New card available (+${Y})`),A.current&&window.clearTimeout(A.current),A.current=window.setTimeout(()=>Ye(null),2200)},[ma,le,la,O,wa]),i.useEffect(()=>()=>{A.current&&window.clearTimeout(A.current)},[]);const ya=(d,y)=>{const I=b.applyOutcome({queue:O,meta:la},ke,U,f,{correct:d,correctness:y,createdUtc:new Date().toISOString()});V(I.queue),Sa(I.meta);const C=I.queue[ne+1];C&&xt(C,ne+1)};i.useEffect(()=>{Jt(l,L).then(d=>se(d.name)).catch(()=>se(a.cogita.library.collections.defaultName))},[l,L]),i.useEffect(()=>{zr({libraryId:l,type:"language"}).then(d=>be(d)).catch(()=>be([]))},[l]),i.useEffect(()=>{Wr({libraryId:l}).then(d=>Ka(d.items??[])).catch(()=>Ka([]))},[l]),i.useEffect(()=>{dr(l,F)},[l,F]),i.useEffect(()=>{lt(O)},[O,Da,ma,ca,L]),i.useEffect(()=>{if(!ke||!ma){ze(!1);return}if(ke.cardType!=="info"||wa.has(pe(ke))){ze(!1);return}const d=ar(ne+1);if(d>=0){ze(!1),N(d);return}if(b.id==="temporal"||b.id==="levels"){const y=O.slice(0,ne+1),I=O.slice(ne+1).filter(La),C=y.concat(I),Y=new Set(C.map(pe)),M=ot(Y);if(M){const D=pe(M);Y.has(D)||(C.push(M),Y.add(D),Sa(J=>{const ue=J,me=new Set(ue.queued??[]);return me.add(D),{...ue,queued:me}}))}const z=C.findIndex((D,J)=>J!==ne&&La(D));if(z>=0){V(C),N(z),ze(!1);return}}ze(!0)},[ke,wa,ma,ne,O,la,b.id]),i.useEffect(()=>{let d=!0;return(async()=>{K("loading"),s({current:0,total:b.id==="levels"?0:b.getFetchLimit(U,f)});try{const I=[];let C=null,Y=null;do{const ye=await Ft({libraryId:l,collectionId:L,limit:300,cursor:C});if(I.push(...ye.items),(b.id==="levels"||b.id==="temporal")&&ye.total&&(Y=ye.total),s(xe=>({current:I.length,total:xe.total||ye.total||b.getFetchLimit(U,f)})),C=ye.nextCursor??null,Y!==null&&I.length>=Y||b.id!=="levels"&&b.id!=="temporal"&&I.length>=b.getFetchLimit(U,f))break}while(C);if(!d)return;const M=yr(I);let z;if(b.id==="levels"){const ye=Math.max(1,Number(f.levels??1)),Se=(await Ba()).reduce(($e,He)=>{const Xe=Fa(He.itemType,He.itemId,He.checkType,He.direction);return $e[Xe]||($e[Xe]=[]),$e[Xe].push(He),$e},{});z={},M.forEach($e=>{const He=pe($e),Xe=Se[He]??[],ua=Xe.length>0?Aa(Xe).score:0,Qa=Math.max(1,Math.min(ye,Math.ceil(ua/100*ye)));z[He]=Qa})}let D=null,J=null,ue=null;if(b.id==="temporal"){const ye=await Ba(),xe=new Set(M.map(He=>pe(He))),Se=ye.reduce((He,Xe)=>{const ua=Fa(Xe.itemType,Xe.itemId,Xe.checkType,Xe.direction);return xe.has(ua)&&(He[ua]||(He[ua]=[]),He[ua].push(Xe)),He},{});D={},J=new Set,ue={};const $e=Date.now();M.forEach(He=>{const Xe=pe(He),ua=Se[Xe]??[];if(ua.length===0){D[Xe]=0,J.add(Xe),ue[Xe]=[];return}const Qa=Tr(ua);ue[Xe]=Qa;const ui=Yt(Qa,$e);D[Xe]=ui.knowness})}const me=b.id==="levels"?Lr(M,U,f,z):b.id==="temporal"?Nr(M,U,f,D??{},J??new Set,ue??{}):b.prepare(M,U,f);V(me.queue),Sa(me.meta),N(0),K("ready"),s(ye=>({current:Math.min(ye.current,ye.total),total:ye.total}))}catch{d&&K("error")}})(),()=>{d=!1}},[l,L,U,f,b,F]),i.useEffect(()=>{if(Te(""),oe(null),Ie(null),Ze(0),Fe([]),oa({}),W({}),fe(null),Oe(null),Ae(null),ce(!1),ta(!1),re(null),k(null),t({}),!ke){Le(null),Be(null),De(null),ea(null);return}ke.cardType==="info"&&ke.infoType==="computed"&&Le(a.cogita.library.revision.loadingComputed);let d=!0;return xt(ke,ne).then(y=>{!d||!y||(Le(y.prompt),Be(y.expectedAnswer),Fe(y.computedExpected),oa(y.computedAnswers),De(y.computedValues),fe(y.answerTemplate),Oe(y.outputVariables),Ae(y.variableValues))}),()=>{d=!1}},[ke,a]),i.useEffect(()=>{if(!ke||ke.cardType!=="info"||ke.infoType!=="quote"){Ge.current=null,ka.current=new Set,Qe(null);return}const d=ke.description??"",y=(ke.label??"").trim(),I=y.replace(/\s+/g," ").trim(),C=d.replace(/\s+/g," ").trim(),Y=I&&I!==C?y:a.cogita.library.infoTypes.quote;if(!d){Qe(null),Be(null);return}const M=bt(d);Ge.current=M,Le(Y);let z=!0;return nt().then(({fragmentKnowness:D})=>{if(!z)return;const J=getQuoteMode(ke.direction),ue=new Set,me={};D.forEach((Se,$e)=>{const[He,Xe]=$e.split(":",2);if(He!==ke.cardId)return;const ua=Na(Xe);if(!ua||ua.mode!==J)return;const Qa=ua.fragmentId;me[Qa]=Se,Se>=ca&&ue.add(Qa)}),ka.current=ue,Oa.current=me;const ye=Na(ke.direction);if(ye!=null&&ye.fragmentId&&M.nodes[ye.fragmentId]){Ea(M,ye.fragmentId,Y);return}const xe=gt(M,ue,me,ca,ma,ke.direction);Ea(M,(xe==null?void 0:xe.id)??null,Y)}).catch(()=>{ka.current=new Set,Oa.current={};const D=Na(ke.direction);if(D!=null&&D.fragmentId&&M.nodes[D.fragmentId]){Ea(M,D.fragmentId,Y);return}const J=gt(M,ka.current,{},ca,ma,ke.direction);Ea(M,(J==null?void 0:J.id)??null,Y)}),()=>{z=!1}},[ke,a,ma,ca]),i.useEffect(()=>{if(!ke||ke.cardType!=="vocab"||ke.checkType!=="translation-match"){k(null),t({});return}const I=(la.pool??la.active??O).filter(D=>D.cardType==="vocab"&&D.checkType==="translation-match").filter((D,J,ue)=>ue.findIndex(me=>me.cardId===D.cardId)===J);I.some(D=>D.cardId===ke.cardId)||I.unshift(ke);const Y=Ma(I).slice(0,6).map(D=>{const J=D.label.split("↔").map(ye=>ye.trim()).filter(Boolean);if(J.length<2)return null;const ue=`${D.cardId}:L`,me=`${D.cardId}:R`;return{cardId:D.cardId,leftId:ue,rightId:me,leftLabel:J[0],rightLabel:J[1]}}).filter(Boolean),M=Y.map(D=>D.leftId),z=Ma(Y.map(D=>D.rightId));k({pairs:Y,leftOrder:M,rightOrder:z,selection:{},activeLeft:null,activeRight:null,locked:{}})},[ke,O,la]),i.useEffect(()=>()=>{q.current&&window.clearTimeout(q.current),ae.current&&window.clearTimeout(ae.current)},[]);const za=i.useRef(null);i.useEffect(()=>{if(!ke)return;const d=pe(ke),y=typeof document<"u"?document.activeElement:null;if(za.current===d&&y&&(y.tagName==="INPUT"||y.tagName==="TEXTAREA"))return;let I=0;const C=()=>{if(ke){if(ke.cardType==="info"&&ke.infoType==="computed"){if(Ke.length>0){const M=Ut(Ce,Ke,Pe),z=M?ba.current[M]:null;if(z&&(z.focus(),document.activeElement===z)){za.current=d;return}}if(na.current&&(na.current.focus(),document.activeElement===na.current)){za.current=d;return}}else if(ke.cardType==="vocab"&&na.current&&(na.current.focus(),document.activeElement===na.current)){za.current=d;return}I<6&&(I+=1,window.setTimeout(C,40))}},Y=window.setTimeout(C,40);return()=>window.clearTimeout(Y)},[ke,Ke,Ce,Pe]),i.useEffect(()=>{if(!sa)return;const d=y=>{y.key==="Enter"&&(y.preventDefault(),dt())};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[sa]);const Ha=d=>{ra(d),ea(Aa(d))};i.useEffect(()=>{if(!ke){ea(null),ra([]);return}const d=ke.cardType==="info"?"info":"connection";if(ke.cardType==="info"&&ke.infoType==="quote"){Ba().then(y=>{const I=y.filter(C=>C.itemType==="info"&&C.itemId===ke.cardId&&C.checkType==="quote-fragment"&&qt(C.direction,ke.direction));Ha(I)}).catch(()=>{ea(null),ra([])});return}Ot(d,ke.cardId,ke.checkType,ke.direction).then(y=>Ha(y)).catch(()=>{ea(null),ra([])})},[l,ke,F]);const Lt=(d,y,I,C)=>{if(d==="info"&&I==="quote-fragment"){Ba().then(Y=>{const M=Y.filter(z=>z.itemType==="info"&&z.itemId===y&&z.checkType==="quote-fragment"&&qt(z.direction,C));Ha(M)}).catch(()=>{ea(null),ra([])});return}Ot(d,y,I,C).then(Y=>Ha(Y)).catch(()=>{ea(null),ra([])})},Ct=(d,y,I)=>{var z;const C=((z=I.pairs.find(D=>D.leftId===d))==null?void 0:z.rightId)??null;if(!C)return I;const Y=C===y;t(D=>({...D,[d]:Y?"correct":"incorrect"})),q.current&&window.clearTimeout(q.current),ae.current&&window.clearTimeout(ae.current),r.current+=1;const M={kind:Y?"correct":"incorrect",tick:r.current};if(T(null),q.current=window.setTimeout(()=>T(M),0),ae.current=window.setTimeout(()=>T(null),420),Y){const D={...I.locked,[d]:!0};return Object.keys(D).length>=I.pairs.length?(oe("correct"),ta(!0)):oe("correct"),{...I,selection:{...I.selection,[d]:y},activeLeft:null,activeRight:null,locked:D}}return oe("incorrect"),{...I,activeLeft:null,activeRight:null}},ct=d=>{k(y=>!y||y.locked[d]?y:y.activeRight?Ct(d,y.activeRight,y):{...y,activeLeft:y.activeLeft===d?null:d})},$a=d=>{k(y=>y&&(y.activeLeft?Ct(y.activeLeft,d,y):{...y,activeRight:y.activeRight===d?null:d}))},dt=()=>{var d;if(ke&&ke.cardType==="info"&&ke.infoType==="quote"&&Ge.current&&Me&&!((d=Na(ke.direction))!=null&&d.fragmentId)){const y=gt(Ge.current,ka.current,Oa.current,ca,ma,ke.direction,Me.fragmentId);if(y){oe(null),Te(""),ce(!1),W({}),ta(!1),Ie(null),Ze(0),Ea(Ge.current,y.id,Me.title);return}}oe(null),Te(""),ce(!1),W({}),ta(!1),Ie(null),Ze(0),N(y=>Math.min(y+1,O.length))},Ca=d=>{if(!ke)return;const y=d.expected??null,I=d.answer??"";let C=y??"",Y=I;if(!y&&d.expectedMap&&d.answerMap){const ye=Object.keys(d.expectedMap).sort((xe,Se)=>xe.localeCompare(Se));C=ye.map(xe=>{var Se;return((Se=d.expectedMap)==null?void 0:Se[xe])??""}).join("|"),Y=ye.map(xe=>{var Se;return((Se=d.answerMap)==null?void 0:Se[xe])??""}).join("|")}const M=C?ht(C,Y,Ta):new Uint8Array,z={revisionType:b.id,evalType:d.evalType,direction:d.direction,prompt:we??"",expected:y,answer:I,expectedAnswers:d.expectedMap??null,answers:d.answerMap??null,correct:d.correct,maskBase64:M.length?Ua(M):null,values:Z??null,checkMode:X,compareMode:Ta,minCorrectness:qa},D=new TextEncoder().encode(JSON.stringify(z)),J=ke.cardType==="info"?"info":"connection",ue=d.overrideCheckType??ke.checkType??null,me=d.overrideDirection??ke.direction??null;Kt({itemType:J,itemId:ke.cardId,checkType:ue,direction:me,revisionType:b.id,evalType:d.evalType,correct:d.correct,maskBase64:M.length?Ua(M):null,payloadBase64:Ua(D),personRoleId:F??null}).then(()=>{Lt(J,ke.cardId,ue,me),lt(O),dr(l,F)}).catch(()=>{})},Ja=(d,y)=>{const I=et.current.get(y);if(I)return Promise.resolve(I);const C=Va.current.get(y);if(C)return C;const Y=Za({libraryId:l,infoId:d}).then(M=>{var ye,xe;const z=M.payload,D=((ye=z.definition)==null?void 0:ye.graph)??null,J="",ue=((xe=z.definition)==null?void 0:xe.answerTemplate)??"",me=kr(D,J,ue);if(me){const $e={sample:Zr(me),answerTemplate:ue||null};return et.current.set(y,$e),$e}return pr({libraryId:l,infoId:d}).then(Se=>{const $e={sample:Se,answerTemplate:null};return et.current.set(y,$e),$e})}).catch(()=>pr({libraryId:l,infoId:d}).then(M=>{const z={sample:M,answerTemplate:null};return et.current.set(y,z),z}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Va.current.delete(y)});return Va.current.set(y,Y),Y},xt=(d,y)=>{var D;const I=`${pe(d)}:${y}`,C=at.current.get(I);if(C)return Promise.resolve(C);const Y=tt.current.get(I);if(Y)return Y;const M=J=>(at.current.set(I,J),J);let z;if(d.cardType==="vocab"){if(d.checkType==="translation-match")return z=Promise.resolve(M({prompt:d.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),z;const J=d.label.split("↔").map(ue=>ue.trim()).filter(Boolean);if(J.length>=2){const me=(d.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ye=me?J[0]:J[1],xe=me?J[1]:J[0];z=Promise.resolve(M({prompt:ye,expectedAnswer:xe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else z=Promise.resolve(M({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(d.cardType==="info"&&d.infoType==="word"){const J=(D=d.description)!=null&&D.startsWith("Language: ")?d.description.replace("Language: ",""):null;z=Promise.resolve(M({prompt:d.label,expectedAnswer:J,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else d.cardType==="info"&&d.infoType==="computed"?z=Ja(d.cardId,I).then(J=>{var Se,$e;if(!J.sample)return M({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ue=J.sample,me=ue.expectedAnswers?Object.entries(ue.expectedAnswers).map(([He,Xe])=>({key:He,expected:Xe})):[],ye=me.reduce((He,Xe)=>(He[Xe.key]="",He),{}),xe=ue.expectedAnswerIsSentence&&((Se=ue.expectedAnswer)==null?void 0:Se.trim())||null;return M({prompt:ue.prompt,expectedAnswer:me.length>0?xe:(($e=ue.expectedAnswer)==null?void 0:$e.trim())||null,computedExpected:me,computedAnswers:ye,computedValues:ue.values??null,answerTemplate:J.answerTemplate,outputVariables:ue.outputVariables??null,variableValues:ue.variableValues??null})}).catch(()=>M({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{tt.current.delete(I)}):z=Promise.resolve(M({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return tt.current.set(I,z),z},Ea=(d,y,I)=>{const C=Object.keys(d.nodes).length,Y=ka.current.size;if(!y){Qe({title:I,before:d.text,after:"",fragmentId:null,total:C,completed:Y}),Be(null),ta(!0);return}const M=d.nodes[y];if(!M)return;const z=ei(d.text,M);Qe({title:I,before:z.before,after:z.after,fragmentId:M.id,total:C,completed:Y}),Be(z.fragment),ta(!1)},Mt=()=>{const d=Ge.current;d&&Qe(y=>y&&{...y,total:Object.keys(d.nodes).length,completed:ka.current.size})},ut=()=>{const d=O[ne+1];d&&xt(d,ne+1)},St=()=>{if(ut(),ke&&ke.cardType==="vocab"&&ke.checkType==="translation-match"&&j){if(j.pairs.length===0){oe("incorrect"),ta(!0);return}const M=j.pairs.reduce((xe,Se)=>(xe[Se.rightId]=Se.rightLabel,xe),{});let z=0;const D={};j.pairs.forEach(xe=>{const $e=j.selection[xe.leftId]===xe.rightId;D[xe.leftId]=$e?"correct":"incorrect",$e&&(z+=1)});const J=j.pairs.length||1,ue=z/J,me=z===j.pairs.length;t(xe=>({...xe,...D})),me?(oe("correct"),ta(!0),Ze(0)):(oe("incorrect"),ta(!1),Ze(xe=>{const Se=xe+1;return Se>=Ia&&(ce(!0),ta(!0),k($e=>{if(!$e)return $e;const He=$e.pairs.reduce((Xe,ua)=>(Xe[ua.leftId]=ua.rightId,Xe),{});return{...$e,selection:He}})),Se})),ya(me,ue);const ye="connection";Promise.all(j.pairs.map(xe=>{const Se=j.selection[xe.leftId]??null,$e=Se?M[Se]:"",He={left:xe.leftLabel,expected:xe.rightLabel,answer:$e,checkType:"translation-match"},Xe=new TextEncoder().encode(JSON.stringify(He));return Kt({itemType:ye,itemId:xe.cardId,checkType:"translation-match",direction:null,revisionType:b.id,evalType:"translation-match",correct:Se===xe.rightId,maskBase64:null,payloadBase64:Ua(Xe),personRoleId:F??null})})).then(()=>{Lt(ye,ke.cardId,ke.checkType,ke.direction),dr(l,F)}).catch(()=>{});return}if(Ke.length>0){const M=Ke.reduce((D,J)=>{const ue=We[J.key]??"";return D[J.key]=va(ue)===va(J.expected)?"correct":"incorrect",D},{});Ke.every(({key:D,expected:J})=>{const ue=We[D]??"";return X==="exact"&&va(ue)===va(J)})?(oe("correct"),W(M),ta(!0),Ze(0),ya(!0,1),Ca({correct:!0,direction:we?`${we} -> computed`:"computed",expectedMap:Ke.reduce((D,J)=>(D[J.key]=J.expected,D),{}),answerMap:We,evalType:"computed"})):(oe("incorrect"),W(M),ta(!1),Ze(D=>{const J=D+1;return J>=Ia&&ee&&(ce(!0),ta(!0)),J}),ya(!1,0),window.setTimeout(()=>{var J;const D=Ut(Ce,Ke,Pe);D&&ba.current[D]&&((J=ba.current[D])==null||J.focus())},40),Ca({correct:!1,direction:we?`${we} -> computed`:"computed",expectedMap:Ke.reduce((D,J)=>(D[J.key]=J.expected,D),{}),answerMap:We,evalType:"computed"}));return}if(ke&&ke.cardType==="info"&&ke.infoType==="quote"&&(Me!=null&&Me.fragmentId)){if(!Ne)return;const M=Na(ke.direction),z=(M==null?void 0:M.mode)??getQuoteMode(ke.direction),D=M!=null&&M.fragmentId&&ke.direction?ke.direction:Tt(z,Me.fragmentId),J=si(Ne,$,Ta),ue=X==="exact"&&mt($)===mt(Ne),me=_a(J),ye=ue||me,xe=Wa(J);ye?(Oa.current[Me.fragmentId]=Math.max(Oa.current[Me.fragmentId]??0,xe),(Oa.current[Me.fragmentId]??0)>=ca&&ka.current.add(Me.fragmentId),Mt(),oe("correct"),W({}),ta(!0),Ie(J),Ze(0),xe<100&&Ia<=1&&ce(!0),ya(!0,xe/100),Ca({correct:!0,direction:`quote:${Me.fragmentId}`,expected:Ne,answer:$,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:D})):(oe("incorrect"),W({}),ta(!1),Ie(J),Ze(Se=>{const $e=Se+1;return $e>=Ia&&ee&&(ce(!0),ta(!0)),$e}),ya(!1,xe/100),window.setTimeout(()=>{var Se;return(Se=na.current)==null?void 0:Se.focus()},40),Ca({correct:!1,direction:`quote:${Me.fragmentId}`,expected:Ne,answer:$,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:D}));return}if(!Ne)return;const d=ht(Ne,$,Ta),y=X==="exact"&&va($)===va(Ne),I=_a(d),C=y||I,Y=Wa(d);C?(oe("correct"),W({}),ta(!0),Ie(d),Ze(0),Y<100&&Ia<=1&&ce(!0),ya(!0,Y/100),Ca({correct:!0,direction:we?`${we} -> ${Ne}`:null,expected:Ne,answer:$,evalType:"text"})):(oe("incorrect"),W({}),ta(!1),Ie(d),Ze(M=>{const z=M+1;return z>=Ia&&ee&&(ce(!0),ta(!0)),z}),ya(!1,Y/100),window.setTimeout(()=>{var M;return(M=na.current)==null?void 0:M.focus()},40),Ca({correct:!1,direction:we?`${we} -> ${Ne}`:null,expected:Ne,answer:$,evalType:"text"}))},tr=d=>{if(ut(),!Ne)return;const y=ht(Ne,d,Ta),I=va(d)===va(Ne),C=_a(y),Y=I||C,M=Wa(y);Y?(oe("correct"),W({}),ta(!0),Ie(y),Ze(0),M<100&&Ia<=1&&ce(!0),ya(!0,M/100),Ca({correct:!0,direction:"word->language",expected:Ne,answer:d,evalType:"language-select"})):(oe("incorrect"),W({}),ta(!1),Ie(y),Ze(z=>{const D=z+1;return D>=Ia&&ee&&(ce(!0),ta(!0)),D}),ya(!1,M/100),Ca({correct:!1,direction:"word->language",expected:Ne,answer:d,evalType:"language-select"}))},rr=()=>{ut(),oe("correct"),ta(!0),Ze(0),ya(!0,1),Ne&&Ca({correct:!0,direction:"manual",expected:Ne,answer:$,evalType:"manual"})},ir=()=>{if(ya(!1,0),ke&&ke.cardType==="info"&&ke.infoType==="quote"){oe(null),Te(""),ce(!1),W({}),ta(!1),Ie(null),Ze(0),N(d=>Math.min(d+1,O.length));return}dt()};i.useEffect(()=>{ut()},[ne,O]);const Ya=d=>{var I;if(d.key!=="Enter")return;if(d.preventDefault(),d.stopPropagation(),sa){dt();return}const y=Ke.find(C=>!(We[C.key]??"").trim());if(y){(I=ba.current[y.key])==null||I.focus();return}St()},E=a.cogita.library.revision.revealModeAfterIncorrect,ee=Ke.length>0||!!Ne;return e.jsxs(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:[le==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${de.total?Math.min(100,Math.max(0,de.current/de.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:de.total?`${Math.min(de.current,de.total)} / ${de.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:P}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",v).replace("{check}",G)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:_,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${_}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${_}/collections/${L}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ve?`${ve.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Pa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Pa.currentLevel??"-"," / ",Pa.levelsCount]}):null,ve?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(ve.correct)).replace("{total}",String(ve.total))}),ve.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(ve.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ni,{outcomes:Je})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[qe?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:qe})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":h?`${h.kind}-${h.tick}`:je?"idle":ie??"idle",children:ke?e.jsx(e.Fragment,{children:pa?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ii,{copy:a,currentCard:ke,currentTypeLabel:pt,prompt:we,languages:he,answer:$,onAnswerChange:d=>Te(y=>_t(y,d,te)),computedExpected:Ke,computedAnswers:We,onComputedAnswerChange:(d,y)=>oa(I=>({...I,[d]:_t(I[d]??"",y,te)})),answerTemplate:Ce,outputVariables:Pe,variableValues:Ve,computedFieldFeedback:Re,feedback:ie,canAdvance:sa,quoteContext:Me,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:St,onSkip:ir,onLanguageSelect:tr,onMarkReviewed:rr,onAdvance:dt,showCorrectAnswer:ge,setShowCorrectAnswer:ce,onRevealCorrect:()=>ta(!0),answerMask:Ee,expectedAnswer:Ne,hasExpectedAnswer:ee,handleComputedKeyDown:Ya,answerInputRef:na,computedInputRefs:ba,scriptMode:te,setScriptMode:re,matchPairs:j==null?void 0:j.pairs,matchLeftOrder:j==null?void 0:j.leftOrder,matchRightOrder:j==null?void 0:j.rightOrder,matchSelection:j==null?void 0:j.selection,matchActiveLeft:j==null?void 0:j.activeLeft,matchActiveRight:j==null?void 0:j.activeRight,matchFeedback:Q,onMatchLeftSelect:ct,onMatchRightSelect:$a})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${_}/collections/${L}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:rt?`${it} / ${rt}`:a.cogita.library.revision.progressUnlimited}),le==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),le==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),le==="ready"&&O.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:E}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ia]})]})]}),Pa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Pa.activeCount," / ",Pa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Pa.counts.map((d,y)=>{const I=y+1,C=Pa.currentLevel===I,Y=Pa.percentages[y]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":C,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:I}),e.jsx("strong",{children:d})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,Y))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[Y.toFixed(1),"%"]})]},`level-${I}`)})})]}):null,xa?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:xa.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:xa.dots.map(d=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,d.value*100))}%`,background:`rgba(${Math.round(255*(1-d.value))}, ${Math.round(200*d.value)}, 80, 0.9)`}},d.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:xa.knownCount})]})]}):null,ma?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:st})]})}):null]})]})]})})})]})]})}const ur=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],On={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Vn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],qn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function _n({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:l,collectionId:L}){const[m,x]=i.useState(""),[_,H,U]=vr([]),[c,b,f]=jr([]),[X,F]=i.useState(null),[v,G]=i.useState(null),[P,se]=i.useState(null),O=`/#/cogita/library/${l}`;i.useEffect(()=>{Jt(l,L).then(s=>x(s.name)).catch(()=>x(a.cogita.library.collections.defaultName))},[l,L,a]),i.useEffect(()=>{Ii({libraryId:l,collectionId:L}).then(s=>{if(!s.graphId||s.graphId==="00000000-0000-0000-0000-000000000000"){H([]),b([]);return}const ne=s.nodes.map($=>{var we;const Te=$.payload??{},ie=Te.position??{x:120,y:120},oe=Te.params??{};return{id:$.nodeId,type:"default",position:ie,data:{nodeType:$.nodeType,label:((we=ur.find(Le=>Le.type===$.nodeType))==null?void 0:we.label)??$.nodeType,params:oe}}}),N=s.edges.map($=>({id:$.edgeId,source:$.fromNodeId,target:$.toNodeId,sourceHandle:$.fromPort??void 0,targetHandle:$.toPort??void 0}));H(ne),b(N)}).catch(()=>{H([]),b([])})},[l,L,b,H]);const V=i.useMemo(()=>_.find(s=>s.id===X)??null,[_,X]),he=s=>{var Te;const ne=crypto.randomUUID(),N=((Te=ur.find(ie=>ie.type===s))==null?void 0:Te.label)??s,$={...On[s]};H(ie=>[...ie,{id:ne,type:"default",position:{x:120+ie.length*40,y:120+ie.length*40},data:{nodeType:s,label:N,params:$}}]),F(ne)},be=i.useCallback(s=>{b(ne=>jt({...s,id:crypto.randomUUID()},ne))},[b]),le=async()=>{G(null);try{await Qr({libraryId:l,collectionId:L,nodes:_.map(s=>({nodeId:s.id,nodeType:s.data.nodeType,payload:{position:s.position,params:s.data.params}})),edges:c.map(s=>({edgeId:s.id,fromNodeId:s.source,fromPort:s.sourceHandle??null,toNodeId:s.target,toPort:s.targetHandle??null}))}),G(a.cogita.library.graph.saveSuccess)}catch{G(a.cogita.library.graph.saveFail)}},K=async()=>{try{const s=await Pi({libraryId:l,collectionId:L});se(s)}catch{se(null)}},de=s=>{V&&H(ne=>ne.map(N=>N.id===V.id?{...N,data:{...N.data,params:s}}:N))};return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${O}/collections/${L}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:K,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:le,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:ur.map(s=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>he(s.type),children:s.label},s.type))}),v?e.jsx("p",{className:"cogita-help",children:v}):null,P&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(P.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(P.connections)).replace("{infos}",String(P.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Wt,{nodes:_,edges:c,onNodesChange:U,onEdgesChange:f,onConnect:be,onNodeClick:(s,ne)=>F(ne.id),fitView:!0,children:[e.jsx(zt,{color:"rgba(120,160,200,0.2)"}),e.jsx(Ht,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),V?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:V.data.label}),V.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:V.data.params.tagId?{id:V.data.params.tagId,label:V.data.params.tagLabel??"",infoType:"topic"}:null,onChange:s=>de({...V.data.params,tagId:(s==null?void 0:s.id)??null,tagLabel:(s==null?void 0:s.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:V.data.params.scope??"any",onChange:s=>de({...V.data.params,scope:s.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),V.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:V.data.params.languageId?{id:V.data.params.languageId,label:V.data.params.languageLabel??"",infoType:"language"}:null,onChange:s=>de({...V.data.params,languageId:(s==null?void 0:s.id)??null,languageLabel:(s==null?void 0:s.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:V.data.params.scope??"any",onChange:s=>de({...V.data.params,scope:s.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),V.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:V.data.params.infoType??"word",onChange:s=>de({...V.data.params,infoType:s.target.value}),children:qn.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsx(Ue,{libraryId:l,infoType:V.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:V.data.params.infoId?{id:V.data.params.infoId,label:V.data.params.infoLabel??"",infoType:V.data.params.infoType??"word"}:null,onChange:s=>de({...V.data.params,infoId:(s==null?void 0:s.id)??null,infoLabel:(s==null?void 0:s.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:V.data.params.connectionType??"translation",onChange:s=>de({...V.data.params,connectionType:s.target.value}),children:Vn.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:V.data.params.connectionId??"",onChange:s=>de({...V.data.params,connectionId:s.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(V.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const gr="cogita.preferences",di=["library_overview","all_cards","new_card","all_collections","new_collection","storyboards","new_storyboard","texts","new_text","dependencies","transfer"],hr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},br=["settings","run","shared"];function Un(a,n=""){const o=a.split("/").filter(Boolean);if(o[0]!=="cogita"||o[1]!=="library")return{};const u=o[2];if(!u)return{};if(!o[3])return{libraryId:u,target:"library_overview"};const g=new URLSearchParams(n),w=g.get("revisionId")??void 0,p=g.get("collectionAction");if(o[3]==="list")return{libraryId:u,target:"all_cards",cardMode:"list",revisionId:w};if(o[3]==="detail"||o[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:o[3],revisionId:w};if(o[3]==="new"||o[3]==="add")return{libraryId:u,target:"new_card",revisionId:w};if(o[3]==="edit")return{libraryId:u,target:"new_card",revisionId:w,infoId:o[4]};if(o[3]==="shared-revisions")return{libraryId:u,target:"all_collections",revisionId:w};if(o[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(o[3]==="transfer")return{libraryId:u,target:"transfer"};if(o[3]==="storyboards")return o[4]==="new"?{libraryId:u,target:"new_storyboard"}:{libraryId:u,target:"storyboards"};if(o[3]==="texts")return o[4]==="new"?{libraryId:u,target:"new_text"}:{libraryId:u,target:"texts"};if(o[3]!=="collections")return{libraryId:u,target:"library_overview"};if(o[4]==="new")return{libraryId:u,target:"new_collection",revisionId:w};const S=o[4];return S?o[5]==="graph"?{libraryId:u,target:"all_collections",collectionId:S,revisionId:w,revisionView:"graph"}:o[5]==="shared-revisions"?{libraryId:u,target:"all_collections",collectionId:S,revisionId:w,revisionView:"shared"}:o[5]==="revision"?{libraryId:u,target:"all_collections",collectionId:S,revisionId:w,revisionView:o[6]==="run"?"run":"settings"}:p==="new-revision"?{libraryId:u,target:"all_collections",collectionId:S,revisionId:w,revisionView:"new"}:{libraryId:u,target:"all_collections",collectionId:S,revisionId:w,revisionView:"detail"}:{libraryId:u,target:"all_collections"}}function mr(a,n="library_overview",o,u,g,w){const p=(S,R)=>{const B=new URLSearchParams;R!=null&&R.revisionId&&B.set("revisionId",R.revisionId),R!=null&&R.collectionAction&&B.set("collectionAction",R.collectionAction);const l=B.toString();return l?`${S}?${l}`:S};return a?n==="library_overview"?p(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?p(`/cogita/library/${a}/list`,{revisionId:g}):n==="new_card"?w?p(`/cogita/library/${a}/edit/${w}`,{revisionId:g}):p(`/cogita/library/${a}/add`,{revisionId:g}):n==="all_collections"?o?u==="graph"?p(`/cogita/library/${a}/collections/${o}/graph`,{revisionId:g}):u==="settings"?p(`/cogita/library/${a}/collections/${o}/revision`,{revisionId:g}):u==="run"?p(`/cogita/library/${a}/collections/${o}/revision/run`,{revisionId:g}):u==="shared"?p(`/cogita/library/${a}/collections/${o}/shared-revisions`,{revisionId:g}):u==="new"?p(`/cogita/library/${a}/collections/${o}`,{revisionId:g,collectionAction:"new-revision"}):p(`/cogita/library/${a}/collections/${o}`,{revisionId:g}):p(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?p(`/cogita/library/${a}/collections/new`,{revisionId:g}):n==="transfer"?p(`/cogita/library/${a}/transfer`,{revisionId:g}):n==="storyboards"?p(`/cogita/library/${a}/storyboards`,{revisionId:g}):n==="new_storyboard"?p(`/cogita/library/${a}/storyboards/new`,{revisionId:g}):n==="texts"?p(`/cogita/library/${a}/texts`,{revisionId:g}):n==="new_text"?p(`/cogita/library/${a}/texts/new`,{revisionId:g}):n==="dependencies"?p(`/cogita/library/${a}/dependencies`,{revisionId:g}):p(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function Pt(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function Wn(a){return typeof a=="string"&&di.includes(a)}function zn(a,n){var S;if(!a.length)return null;const o=a.filter(R=>n.has(R.roleId)),u=o.length>0?o:a,g=u.map(R=>{var l,L;const B=((L=(l=R.fields.find(m=>m.fieldType==="role_kind"))==null?void 0:l.plainValue)==null?void 0:L.toLowerCase())??"";return{roleId:R.roleId,roleKind:B}}),w=g.find(R=>R.roleKind.includes("master"));if(w)return w.roleId;const p=g.find(R=>R.roleKind.includes("account")||R.roleKind.includes("user"));return p?p.roleId:((S=u[0])==null?void 0:S.roleId)??null}function Hn(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Jn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B}){const l=bi(),L=wr(),m=i.useMemo(()=>Un(L.pathname,L.search),[L.pathname,L.search]),x=a.cogita.workspace,[_,H]=i.useState([]),[U,c]=i.useState([]),[b,f]=i.useState([]),[X,F]=i.useState(void 0),[v,G]=i.useState("library_overview"),[P,se]=i.useState(void 0),[O,V]=i.useState(void 0),[he,be]=i.useState("detail"),[le,K]=i.useState(void 0),[de,s]=i.useState(!1),[ne,N]=i.useState(!0),[$,Te]=i.useState(!1),[ie,oe]=i.useState(!1),[we,Le]=i.useState(null),[Ne,Be]=i.useState(""),[Me,Qe]=i.useState(""),[Ke,Fe]=i.useState(""),[We,oa]=i.useState(null),[Re,W]=i.useState(null),Z=i.useRef({version:1,byLibrary:{}}),De=i.useRef(!1),Ce=i.useRef(!1),fe=i.useRef(null),Pe=i.useMemo(()=>_.find(A=>A.libraryId===X)??null,[_,X]),Oe=i.useMemo(()=>U.find(A=>A.collectionId===P)??null,[U,P]),Ve=i.useMemo(()=>b.find(A=>A.revisionId===O)??null,[b,O]),Ae=i.useMemo(()=>({detail:x.revisions.detail,graph:x.revisions.graph,settings:x.revisions.settings,run:x.revisions.run,shared:x.targets.sharedRevisions,new:x.revisionForm.createAction}),[x.revisions.detail,x.revisions.graph,x.revisions.run,x.revisions.settings,x.targets.sharedRevisions,x.revisionForm.createAction]),j=i.useMemo(()=>[{value:"detail",label:Ae.detail},{value:"graph",label:Ae.graph},{value:"settings",label:x.targets.allRevisions},{value:"new",label:Ae.new},{value:"run",label:Ae.run},{value:"shared",label:Ae.shared}],[Ae.detail,Ae.graph,Ae.new,Ae.run,Ae.shared,x.targets.allRevisions]),k=i.useMemo(()=>({library_overview:x.targets.libraryOverview,all_cards:x.targets.allCards,new_card:x.targets.newCard,all_collections:x.targets.allCollections,new_collection:x.targets.newCollection,transfer:x.targets.transfer,storyboards:x.targets.storyboards,new_storyboard:x.targets.newStoryboard,texts:x.targets.texts,new_text:x.targets.newText,dependencies:x.targets.dependencies}),[x.targets]),Q=i.useMemo(()=>k[v]??v,[v,k]),t=Ae[he],r=!!X,h=!!P,T=r&&v==="all_collections",q=h&&v==="all_collections",ae=h&&v==="all_collections"&&br.includes(he),te=i.useCallback(A=>{const Ee=!!A.libraryId;let Ie=A.target,aa=A.collectionId,Ze=A.revisionId,na=A.revisionView,ba=A.infoId;Ee?hr[Ie].requiresCollection&&!aa?(Ie="all_collections",Ze=void 0,na="detail"):Ie!=="all_collections"?(aa=void 0,Ze=void 0,Ie!=="new_card"&&(ba=void 0)):hr[Ie].allowsRevision?br.includes(na)||(Ze=void 0):na="detail":(Ie="library_overview",aa=void 0,Ze=void 0,na="detail",ba=void 0),F(A.libraryId),G(Ie),se(aa),V(Ze),be(na),s(!1);const sa=Pt(mr(A.libraryId,Ie,aa,na,Ze,ba));Pt(`${L.pathname}${L.search}`)!==sa&&(fe.current=sa,l(sa))},[L.pathname,L.search,l]),re=A=>{te({libraryId:X,target:"all_collections",collectionId:P,revisionId:br.includes(A)?O:void 0,revisionView:A})},ge=i.useMemo(()=>[{key:"library",label:x.layers.library,visible:!0,value:X??"",selectedLabel:(Pe==null?void 0:Pe.name)??x.path.noLibrarySelected,disabled:ne||_.length===0,options:_.map(A=>({value:A.libraryId,label:A.name})),emptyOption:x.noLibraryOption,onSelect:A=>{const Ee=A||void 0;te({libraryId:Ee,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:x.layers.target,visible:r,value:v,selectedLabel:Q,disabled:!r,options:di.map(A=>({value:A,label:k[A]})),onSelect:A=>{const Ee=A;te({libraryId:X,target:Ee,collectionId:P,revisionId:O,revisionView:he,infoId:Ee==="new_card"?m.infoId:void 0})}},{key:"collection",label:x.layers.collection,visible:T,value:P??"",selectedLabel:(Oe==null?void 0:Oe.name)??x.path.noCollectionSelected,disabled:!r||$||U.length===0,options:U.map(A=>({value:A.collectionId,label:A.name})),emptyOption:x.selectCollectionOption,onSelect:A=>{te({libraryId:X,target:"all_collections",collectionId:A||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:x.layers.revision,visible:q,value:he,selectedLabel:t,disabled:!P,options:j.map(A=>({value:A.value,label:A.label})),onSelect:A=>{re(A)}},{key:"revision_entry",label:x.layers.revision,visible:ae,value:O??"",selectedLabel:(Ve==null?void 0:Ve.name)??x.status.noRevisions,disabled:!h||ie||b.length===0,options:b.map(A=>({value:A.revisionId,label:A.name})),emptyOption:x.status.noRevisions,onSelect:A=>{te({libraryId:X,target:"all_collections",collectionId:P,revisionId:A||void 0,revisionView:he})}},{key:"selected_info",label:a.cogita.library.list.selectedTitle,visible:!!m.infoId,value:m.infoId??"",selectedLabel:le??m.infoId??"",disabled:!0,options:[],onSelect:A=>{}}],[j,U,$,_,ne,te,b,ie,Oe,P,Ve,O,le,h,r,Pe,X,t,he,v,Q,T,q,ae,k,a.cogita.library.list.selectedTitle,m.infoId,x.layers.collection,x.layers.library,x.layers.revision,x.layers.target,x.noLibraryOption,x.path.noCollectionSelected,x.path.noLibrarySelected,x.selectCollectionOption]),ce=i.useMemo(()=>ge.filter(A=>A.visible),[ge]),ve=i.useMemo(()=>ce.filter(A=>A.key!=="library"&&A.key!=="collection"&&A.key!=="revision_entry"&&A.key!=="selected_info"),[ce]),ea=i.useMemo(()=>ve.find(A=>A.key==="target")??null,[ve]),Je=i.useMemo(()=>ve.find(A=>A.key==="collection_action")??null,[ve]),ra=i.useMemo(()=>{const A=m.libraryId;if(!A||!L.pathname.startsWith("/cogita/library/"))return null;const Ee={copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,libraryId:A};if(m.target==="library_overview")return e.jsx(Yi,{...Ee});if(m.target==="all_cards")return e.jsx(Zi,{...Ee,mode:m.cardMode??"list"});if(m.target==="new_card")return e.jsx(nn,{...Ee,editInfoId:m.infoId});if(m.target==="dependencies")return e.jsx(on,{...Ee});if(m.target==="transfer")return e.jsx(cn,{...Ee});if(m.target==="storyboards"||m.target==="new_storyboard")return e.jsx(dn,{...Ee});if(m.target==="texts"||m.target==="new_text")return e.jsx(un,{...Ee});if(m.target==="all_collections"){if(m.collectionId){const Ie={...Ee,collectionId:m.collectionId};return m.revisionView==="graph"?e.jsx(_n,{...Ie}):m.revisionView==="shared"?e.jsx(sn,{...Ee,collectionId:m.collectionId}):m.revisionView==="settings"?e.jsx(Ln,{...Ie,revisionId:m.revisionId}):m.revisionView==="run"?e.jsx(Kn,{...Ie,revisionId:m.revisionId}):e.jsx(fn,{...Ie})}return e.jsx(gn,{...Ee})}return m.target==="new_collection"?e.jsx(pn,{...Ee,onCreated:Ie=>l(`/cogita/library/${A}/collections/${Ie}/graph`)}):null},[n,a,R,L.pathname,l,B,w,S,u,g,m.cardMode,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,p,o]);i.useEffect(()=>{let A=!1;return(async()=>{var Ie,aa,Ze,na,ba,sa,ta;N(!0);try{await $i();const[la,Sa,Da]=await Promise.all([_r(),Ri(),Ei()]);if(A)return;H(la);const Ka=new Set(Da.nodes.filter(Ge=>Ge.nodeType==="role"&&Ge.canLink).map(Ge=>Ge.roleId??"")),ha=zn(Sa,Ka);if(oa(ha),ha){const Ge=Da.nodes.find(ka=>ka.nodeType==="data"&&ka.roleId===ha&&(ka.fieldType===gr||ka.label===gr));W((Ge==null?void 0:Ge.dataKeyId)??null),Z.current=Hn(Ge==null?void 0:Ge.value)}const wa=Z.current.lastLibraryId,fa=((Ie=la.find(Ge=>Ge.libraryId===m.libraryId))==null?void 0:Ie.libraryId)??(la.length===1?la[0].libraryId:void 0)??((aa=la.find(Ge=>Ge.libraryId===wa))==null?void 0:aa.libraryId)??((Ze=la[0])==null?void 0:Ze.libraryId),pa=fa?(ba=(na=Z.current.byLibrary)==null?void 0:na[fa])==null?void 0:ba.lastTarget:void 0,ze=Wn(pa)?pa:"library_overview";F(fa),G(m.target??ze),V(m.revisionId??(fa?(ta=(sa=Z.current.byLibrary)==null?void 0:sa[fa])==null?void 0:ta.lastRevisionId:void 0)),be(m.revisionView??"detail"),De.current=!0}catch{A||Le(x.status.loadFailed)}finally{A||N(!1)}})(),()=>{A=!0}},[x.status.loadFailed]),i.useLayoutEffect(()=>{De.current&&(m.libraryId&&_.some(A=>A.libraryId===m.libraryId)&&F(m.libraryId),m.target&&G(m.target),se(m.collectionId),V(m.revisionId),m.revisionView&&be(m.revisionView))},[_,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target]),i.useEffect(()=>{if(!X){c([]),se(void 0),f([]),V(void 0);return}let A=!1;return Te(!0),wt({libraryId:X,limit:200}).then(Ee=>{var Ze;if(A)return;const Ie=Ee.items;c(Ie);const aa=(Ze=Ie.find(na=>na.collectionId===m.collectionId))==null?void 0:Ze.collectionId;se(aa)}).catch(()=>{A||(c([]),se(void 0))}).finally(()=>{A||Te(!1)}),()=>{A=!0}},[m.collectionId,X]),i.useEffect(()=>{if(!X||!P){f([]),V(void 0);return}let A=!1;return oe(!0),Ur({libraryId:X,collectionId:P}).then(Ee=>{var Ze,na,ba,sa;if(A)return;f(Ee);const Ie=(na=(Ze=Z.current.byLibrary)==null?void 0:Ze[X])==null?void 0:na.lastRevisionId,aa=((ba=Ee.find(ta=>ta.revisionId===m.revisionId))==null?void 0:ba.revisionId)??((sa=Ee.find(ta=>ta.revisionId===Ie))==null?void 0:sa.revisionId);V(aa)}).catch(()=>{A||(f([]),V(void 0))}).finally(()=>{A||oe(!1)}),()=>{A=!0}},[m.revisionId,P,X]),i.useEffect(()=>{const A=m.infoId;if(!X||!A){K(void 0);return}let Ee=!1;return Za({libraryId:X,infoId:A}).then(Ie=>{if(Ee)return;const aa=Ie.payload;K((aa==null?void 0:aa.label)??(aa==null?void 0:aa.name)??(aa==null?void 0:aa.title)??Ie.infoId)}).catch(()=>{Ee||K(A)}),()=>{Ee=!0}},[m.infoId,X]),i.useEffect(()=>{if(!De.current||m.libraryId&&_.some(Ie=>Ie.libraryId===m.libraryId)&&m.libraryId!==X||m.target&&m.target!==v||m.revisionView&&m.revisionView!==he||m.revisionId&&m.revisionId!==O||hr[v].requiresCollection&&!P&&m.target==="all_collections"&&m.collectionId)return;const A=Pt(`${L.pathname}${L.search}`),Ee=Pt(mr(X,v,P,he,O,m.infoId));if(A===Ee){fe.current=null;return}fe.current!==Ee&&(fe.current=Ee,l(Ee,{replace:!0}))},[_,L.pathname,L.search,l,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,P,X,O,he,v]),i.useEffect(()=>{if(typeof window>"u")return;const A=()=>{window.innerWidth>920&&s(!1)};return window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),i.useEffect(()=>{if(!De.current||!We||!X||Ce.current)return;const A=Z.current,Ee={...A.byLibrary??{}},Ie={...Ee[X]??{},lastCollectionId:P,lastRevisionId:O,lastRevisionView:he,lastTarget:v},aa={version:1,lastLibraryId:X,byLibrary:{...Ee,[X]:Ie}},Ze=JSON.stringify(A),na=JSON.stringify(aa);if(Ze===na)return;Z.current=aa,Ce.current=!0,(async()=>{try{if(Re)await Fi(Re,{plainValue:na});else{const sa=await Ai(We,{itemName:gr,itemType:"data",plainValue:na});W(sa.dataItemId)}}catch{Le(x.status.savePrefsFailed)}finally{Ce.current=!1}})()},[Re,We,P,X,O,he,v,x.status.savePrefsFailed]);const qe=async()=>{const A=Ne.trim();if(!A){Le(a.cogita.user.libraryNameRequired);return}Le(null);try{const Ee=await Di({name:A});H(Ie=>[Ee,...Ie]),F(Ee.libraryId),G("library_overview"),se(void 0),Be("")}catch{Le(a.cogita.user.libraryCreateFailed)}},Ye=async()=>{if(!X){Le(x.status.selectLibraryFirst);return}const A=Me.trim();if(!A){Le(a.cogita.library.collections.saveRequiredName);return}Le(null);try{const Ee=await Yr({libraryId:X,name:A,items:[]}),Ie=await wt({libraryId:X,limit:200});c(Ie.items),se(Ee.collectionId),V(void 0),G("all_collections"),be("detail"),Qe("")}catch{Le(a.cogita.library.collections.saveFail)}},_e=async()=>{if(!X||!P){Le(x.status.selectLibraryFirst);return}const A=Ke.trim();if(!A){Le(x.revisionForm.nameLabel);return}Le(null);try{const Ee=await Bi({libraryId:X,collectionId:P,name:A,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});f(Ie=>[Ee,...Ie]),V(Ee.revisionId),G("all_collections"),be("settings"),Fe("")}catch{Le(x.status.loadFailed)}};return e.jsx(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${de?"open":""}`,"aria-label":x.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Pe==null?void 0:Pe.name)??x.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Pe?x.sidebar.libraryActionsHint:x.status.selectLibraryFirst}),ea?e.jsx("div",{className:"cogita-sidebar-actions",children:ea.options.map(A=>e.jsx("button",{type:"button",className:`ghost ${String(ea.value)===A.value?"active":""}`,onClick:()=>ea.onSelect(A.value),disabled:ea.disabled,children:A.label},`sidebar:target:${A.value}`))}):null]}),Oe?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:Oe.name}),e.jsx("p",{className:"cogita-sidebar-note",children:x.sidebar.collectionActionsHint}),Je?e.jsx("div",{className:"cogita-sidebar-actions",children:Je.options.map(A=>e.jsx("button",{type:"button",className:`ghost ${String(Je.value)===A.value?"active":""}`,onClick:()=>Je.onSelect(A.value),disabled:Je.disabled,children:A.label},`sidebar:revision:${A.value}`))}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:x.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:u,children:x.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{S("cogita"),s(!1)},children:x.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:p?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),de?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":x.sidebar.closeMenu,onClick:()=>s(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":x.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>s(A=>!A),"aria-label":de?x.sidebar.closeMenu:x.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),ce.map((A,Ee)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Ee>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,A.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":A.label,children:A.selectedLabel}):e.jsxs("select",{"aria-label":A.label,value:A.value,onChange:Ie=>A.onSelect(Ie.target.value),disabled:A.disabled,children:[A.emptyOption?e.jsx("option",{value:"",children:A.emptyOption}):null,A.options.map(Ie=>e.jsx("option",{value:Ie.value,children:Ie.label},`${A.key}:${Ie.value}`))]})]},`menu:${A.key}`))]}),ra?e.jsxs(e.Fragment,{children:[v==="all_collections"&&P&&he==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:A=>Fe(A.target.value),placeholder:x.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:_e,children:x.revisionForm.createAction}),we?e.jsx("p",{className:"cogita-form-error",children:we}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Gr.Provider,{value:!0,children:ra})})]}):null,ra?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[ce.map((A,Ee)=>e.jsxs("span",{children:[Ee>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:A.selectedLabel})]},`path:${A.key}`)),T?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:x.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[x.path.currentRoute," ",e.jsx("code",{children:mr(X,v,P,he,O,m.infoId)})]}),X?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${X}`,children:x.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${X}/list`,children:x.links.allCards}),P?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${X}/collections/${P}/shared-revisions`,children:x.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ne,onChange:A=>Be(A.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:qe,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Me,onChange:A=>Qe(A.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!X})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ye,disabled:!X,children:a.cogita.library.collections.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:A=>Fe(A.target.value),placeholder:x.revisionForm.namePlaceholder,disabled:!P})]}),e.jsx("button",{type:"button",className:"cta",onClick:_e,disabled:!P,children:x.revisionForm.createAction}),we?e.jsx("p",{className:"cogita-form-error",children:we}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:x.panels.collections}),$?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.loadingCollections}):null,!$&&U.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.noCollections}):null,U.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:U.map(A=>e.jsxs("button",{type:"button",className:`cogita-card-item ${A.collectionId===P?"active":""}`,onClick:()=>{se(A.collectionId),V(void 0),be("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:x.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:A.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[A.itemCount," ",x.cards.itemsSuffix]})]},A.collectionId))}):null]})]})]})]})})}const el=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Jn},Symbol.toStringTag,{value:"Module"}));function Yn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,shareId:l}){const[L,m]=i.useState(null),[x,_]=i.useState("loading"),[H,U]=i.useState(a.cogita.library.collections.defaultName),[c,b]=i.useState("Cogita Library"),[f,X]=i.useState([]),[F,v]=i.useState([]),[G,P]=i.useState("idle"),[se,O]=i.useState({current:0,total:0}),[V,he]=i.useState(0),[be,le]=i.useState(""),[K,de]=i.useState(null),[s,ne]=i.useState(null),[N,$]=i.useState(null),[Te,ie]=i.useState(null),[oe,we]=i.useState([]),[Le,Ne]=i.useState({}),[Be,Me]=i.useState({}),[Qe,Ke]=i.useState(null),[Fe,We]=i.useState(null),[oa,Re]=i.useState(null),[W,Z]=i.useState(null),[De,Ce]=i.useState({}),fe=i.useRef(0),[Pe,Oe]=i.useState(null),Ve=i.useRef(null),Ae=i.useRef(null),[j,k]=i.useState(null),[Q,t]=i.useState(!1),[r,h]=i.useState(null),[T,q]=i.useState([]),[ae,te]=i.useState(null),re=i.useRef(null),ge=i.useRef(null),[ce,ve]=i.useState(null),[ea,Je]=i.useState(0),ra=i.useRef(null),qe=i.useRef({}),[Ye,_e]=i.useState(!1),[A,Ee]=i.useState({}),Ie=i.useRef(null),aa=i.useRef(new Set),Ze=i.useRef({}),[na,ba]=i.useState([]),[sa,ta]=i.useState(new Set),[la,Sa]=i.useState(!1),Da=wr(),Ka=i.useMemo(()=>new URLSearchParams(Da.search),[Da.search]),ha=i.useMemo(()=>Ka.get("key")??"",[Ka]),wa=(L==null?void 0:L.mode)??"random",fa=(L==null?void 0:L.check)??"exact",pa=(L==null?void 0:L.limit)??20,ze=i.useMemo(()=>Cr((L==null?void 0:L.revisionType)??wa),[L,wa]),Ge=i.useMemo(()=>{const E=L==null?void 0:L.revisionSettings,ee=ri(ze,Ka);return Gt(ze,E??ee)},[L,Ka,ze]),ka=i.useMemo(()=>a.cogita.library.revision[ze.labelKey]??wa,[a,wa,ze]),Oa=i.useMemo(()=>fa==="exact"?a.cogita.library.revision.checkValue:fa,[a,fa]),je=x==="ready"?f[V]??null:null,et=(je==null?void 0:je.checkType)==="translation-match"&&W,Va=i.useRef(new Map),at=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useRef(new Map),Xt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?ia(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),rt=i.useMemo(()=>{var ee;return ze.id!=="levels"?f.length:((ee=A.pool)==null?void 0:ee.length)??ze.getFetchLimit(pa,Ge)},[A,Ge,ze,f.length,pa]),it=ze.getProgressTotal?ze.getProgressTotal(f,A,pa,Ge):ze.id==="levels"?Math.min(pa,rt):f.length,Ia=it?Math.min(V+1,it):0,Ta=Math.max(1,Number(Ge.tries??1)),qa=Ge.compare??"anchors",ma=Math.max(0,Math.min(100,Number(Ge.minCorrectness??0))),ca=(Ge.considerDependencies??"on")==="on",Ma=Math.max(0,Math.min(100,Number(Ge.dependencyThreshold??85))),Wa=E=>{const ee=E.slice();for(let d=ee.length-1;d>0;d-=1){const y=Math.floor(Math.random()*(d+1));[ee[d],ee[y]]=[ee[y],ee[d]]}return ee},_a=E=>E.length?E.reduce((d,y)=>d+y,0)/E.length/255*100:0,nt=E=>_a(E)>=ma,Zt=async()=>{const E=await Ba(),ee=new Map,d=new Map;E.forEach(C=>{const Y=`${C.itemType}:${C.itemId}`,M=Fa(C.itemType,C.itemId,C.checkType,C.direction);ee.has(Y)||ee.set(Y,[]),ee.get(Y).push(C),d.has(M)||d.set(M,[]),d.get(M).push(C)});const y=new Map,I=new Map;return ee.forEach((C,Y)=>y.set(Y,Aa(C).score)),d.forEach((C,Y)=>I.set(Y,Aa(C).score)),{itemKnowness:y,cardKnowness:I}},ft=async E=>{const ee=A,d=E.concat(ee.active??[]).concat(ee.pool??[]).filter((J,ue,me)=>me.findIndex(ye=>pe(ye)===pe(J))===ue);if(!ca){ta(new Set(d.map(pe)));return}const{itemKnowness:y,cardKnowness:I}=await Zt(),C=J=>{if(J.cardType!=="info"||J.infoType!=="quote"||J.checkType!=="quote-fragment")return!0;const ue=Na(J.direction);if(!(ue!=null&&ue.fragmentId))return!0;const me=J.description??"";if(!me.trim())return!0;const xe=bt(me).nodes[ue.fragmentId];if(!xe||!xe.leftId&&!xe.rightId)return!0;const Se=[xe.leftId,xe.rightId].filter(Xe=>!!Xe);if(Se.length===0)return!0;const $e=Se.map(Xe=>{const ua=Fa("info",J.cardId,"quote-fragment",Tt(ue.mode,Xe));return I.get(ua)??0});return $e.reduce((Xe,ua)=>Xe+ua,0)/$e.length>=Ma},Y=(L==null?void 0:L.collectionId)??null,M=Y?na.filter(J=>ga(J.childItemType)==="collection"&&J.childItemId===Y&&!ga(J.childCheckType)&&!ga(J.childDirection)):[],z=Y&&d.length>0?d.reduce((J,ue)=>J+(I.get(pe(ue))??0),0)/d.length:0,D=new Set;for(const J of d){if(J.cardType!=="info"){D.add(pe(J));continue}if(!C(J))continue;const ue=na.filter(xe=>ci(xe,J)).concat(M);if(ue.length===0){D.add(pe(J));continue}let me=0;for(const xe of ue)if(ga(xe.parentItemType)==="collection")me+=xe.parentItemId===Y?z:0;else if(ga(xe.parentCheckType)||ga(xe.parentDirection)){const Se=ga(xe.parentCheckType),$e=ga(xe.parentDirection),He=Fa(xe.parentItemType,xe.parentItemId,Se,$e);me+=I.get(He)??0}else{const Se=`${xe.parentItemType}:${xe.parentItemId}`;me+=y.get(Se)??0}me/ue.length>=Ma&&D.add(pe(J))}ta(D)},er=E=>{for(let ee=E;ee<f.length;ee+=1){const d=f[ee];if(d&&(!ca||d.cardType!=="info"||sa.has(pe(d))))return ee}return-1},lt=E=>!ca||E.cardType!=="info"||sa.has(pe(E)),ar=E=>{if(ze.id!=="temporal"&&ze.id!=="levels")return null;const ee=A,d=(ee.active??[]).concat(ee.pool??[]),y=new Set;for(const I of d){const C=pe(I);if(!(y.has(C)||E.has(C))&&(y.add(C),lt(I)))return I}return null},La=i.useMemo(()=>{if(ze.id!=="levels")return null;const E=A,ee=E.pool??[],d=E.active??[],y=E.levelMap??{},I=Math.max(1,Number(Ge.levels??1)),C=Array.from({length:I},()=>0),Y=new Set(d.map(J=>pe(J)));ee.forEach(J=>{const ue=Math.min(I,Math.max(1,y[pe(J)]??1));C[ue-1]+=1});const M=ee.length||1,z=C.map(J=>J/M*100),D=je?y[pe(je)]??1:null;return{counts:C,percentages:z,currentLevel:D,levelsCount:I,activeCount:d.length,poolCount:ee.length,activeSet:Y}},[A,Ge,ze,je]),ot=i.useMemo(()=>{if(ze.id!=="temporal")return null;const E=A,ee=E.pool??[],d=E.active??[],y=E.knownessMap??{},I=new Set(E.unknownSet??[]);let C=0;ee.forEach(z=>{(y[pe(z)]??0)>1&&(C+=1)});const Y=I.size,M=d.map(z=>({id:pe(z),value:I.has(pe(z))?0:Math.max(0,Math.min(1,y[pe(z)]??0))}));return{knownCount:C,unknownCount:Y,dots:M}},[A,ze]),Pa=i.useMemo(()=>{if(!ca)return 0;const E=A;return f.concat(E.active??[]).concat(E.pool??[]).filter((d,y,I)=>I.findIndex(C=>pe(C)===pe(d))===y).filter(d=>d.cardType==="info"&&!sa.has(pe(d))).length},[ca,A,f,sa]);i.useEffect(()=>{if(!ca||G!=="ready")return;const E=A,d=f.concat(E.active??[]).concat(E.pool??[]).filter((C,Y,M)=>M.findIndex(z=>pe(z)===pe(C))===Y).filter(C=>C.cardType!=="info"||sa.has(pe(C))).length,y=re.current;if(re.current=d,y===null||d<=y)return;const I=d-y;te(`New card available (+${I})`),ge.current&&window.clearTimeout(ge.current),ge.current=window.setTimeout(()=>te(null),2200)},[ca,G,A,f,sa]),i.useEffect(()=>()=>{ge.current&&window.clearTimeout(ge.current)},[]);const xa=(E,ee)=>{const d=ze.applyOutcome({queue:f,meta:A},je,pa,Ge,{correct:E,correctness:ee,createdUtc:new Date().toISOString()});X(d.queue),Ee(d.meta);const y=d.queue[V+1];y&&Ca(y,V+1)};i.useEffect(()=>{if(!l){_("error");return}_("loading"),Ki({shareId:l,key:ha}).then(E=>{m(E),U(E.collectionName),b(E.libraryName),_("ready")}).catch(()=>{_("error")})},[l,ha]),i.useEffect(()=>{l&&Oi({shareId:l,key:ha,type:"language"}).then(E=>v(E)).catch(()=>v([]))},[l,ha]),i.useEffect(()=>{!l||x!=="ready"||Vi({shareId:l,key:ha}).then(E=>ba(E.items??[])).catch(()=>ba([]))},[l,ha,x]),i.useEffect(()=>{if(!l||x!=="ready")return;let E=!0;return(async()=>{P("loading"),O({current:0,total:ze.id==="levels"?0:ze.getFetchLimit(pa,Ge)});try{const d=[];let y=null,I=null;do{const ue=await qi({shareId:l,key:ha,limit:300,cursor:y});if(d.push(...ue.items),(ze.id==="levels"||ze.id==="temporal")&&ue.total&&(I=ue.total),O(me=>({current:d.length,total:me.total||ue.total||ze.getFetchLimit(pa,Ge)})),y=ue.nextCursor??null,I!==null&&d.length>=I||ze.id!=="levels"&&ze.id!=="temporal"&&d.length>=ze.getFetchLimit(pa,Ge))break}while(y);if(!E)return;const C=yr(d);let Y;if(ze.id==="levels"){const ue=Math.max(1,Number(Ge.levels??1));Y={},C.forEach(me=>{const ye=pe(me);Y[ye]=Math.max(1,Math.min(ue,1))})}let M=null,z=null,D=null;if(ze.id==="temporal"){const ue=await Ba(),me=new Set(C.map(Se=>pe(Se))),ye=ue.reduce((Se,$e)=>{const He=Fa($e.itemType,$e.itemId,$e.checkType,$e.direction);return me.has(He)&&(Se[He]||(Se[He]=[]),Se[He].push($e)),Se},{});M={},z=new Set,D={};const xe=Date.now();C.forEach(Se=>{const $e=pe(Se),He=ye[$e]??[];if(He.length===0){M[$e]=0,z.add($e),D[$e]=[];return}const Xe=Tr(He);D[$e]=Xe;const ua=Yt(Xe,xe);M[$e]=ua.knowness})}const J=ze.id==="levels"?Lr(C,pa,Ge,Y):ze.id==="temporal"?Nr(C,pa,Ge,M??{},z??new Set,D??{}):ze.prepare(C,pa,Ge);X(J.queue),Ee(J.meta),he(0),P("ready"),O(ue=>({current:Math.min(ue.current,ue.total),total:ue.total}))}catch{E&&P("error")}})(),()=>{E=!1}},[l,ha,pa,ze,Ge,x]),i.useEffect(()=>{ft(f)},[f,na,ca,Ma,L==null?void 0:L.collectionId]),i.useEffect(()=>{if(!je||!ca){Sa(!1);return}if(je.cardType!=="info"||sa.has(pe(je))){Sa(!1);return}const E=er(V+1);if(E>=0){Sa(!1),he(E);return}if(ze.id==="temporal"||ze.id==="levels"){const ee=f.slice(0,V+1),d=f.slice(V+1).filter(lt),y=ee.concat(d),I=new Set(y.map(pe)),C=ar(I);if(C){const M=pe(C);I.has(M)||(y.push(C),I.add(M),Ee(z=>{const D=z,J=new Set(D.queued??[]);return J.add(M),{...D,queued:J}}))}const Y=y.findIndex((M,z)=>z!==V&&lt(M));if(Y>=0){X(y),he(Y),Sa(!1);return}}Sa(!0)},[je,sa,ca,V,f,A,ze.id]),i.useEffect(()=>{if(le(""),de(null),ve(null),Je(0),we([]),Ne({}),Me({}),Ke(null),We(null),Re(null),t(!1),_e(!1),k(null),Z(null),Ce({}),!je){ne(null),$(null);return}je.cardType==="info"&&je.infoType==="computed"&&ne(a.cogita.library.revision.loadingComputed);let E=!0;return Ca(je,V).then(ee=>{!E||!ee||(ne(ee.prompt),$(ee.expectedAnswer),we(ee.computedExpected),Ne(ee.computedAnswers),Ke(ee.answerTemplate),We(ee.outputVariables),Re(ee.variableValues))}),()=>{E=!1}},[je,l,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){Ie.current=null,aa.current=new Set,ie(null);return}const E=je.description??"",ee=(je.label??"").trim(),d=ee.replace(/\s+/g," ").trim(),y=E.replace(/\s+/g," ").trim(),I=d&&d!==y?ee:a.cogita.library.infoTypes.quote;if(!E){ie(null),$(null);return}const C=bt(E);Ie.current=C,ne(I);let Y=!0;return Ba().then(M=>{if(!Y)return;const z=getQuoteMode(je.direction),D=new Map;M.forEach(xe=>{if(xe.itemType!=="info"||xe.checkType!=="quote-fragment"||!xe.direction)return;const Se=Na(xe.direction);if(!Se||Se.mode!==z)return;const $e=`${xe.itemId}:${Se.fragmentId}`;D.has($e)||D.set($e,[]),D.get($e).push(xe)});const J={},ue=new Set;D.forEach((xe,Se)=>{const[$e,He]=Se.split(":",2);if($e!==je.cardId)return;const Xe=Aa(xe).score;J[He]=Xe,Xe>=Ma&&ue.add(He)}),aa.current=ue,Ze.current=J;const me=Na(je.direction);if(me!=null&&me.fragmentId&&C.nodes[me.fragmentId]){Ja(C,me.fragmentId,I);return}const ye=gt(C,ue,J,Ma,ca,je.direction);Ja(C,(ye==null?void 0:ye.id)??null,I)}).catch(()=>{aa.current=new Set,Ze.current={};const M=Na(je.direction);if(M!=null&&M.fragmentId&&C.nodes[M.fragmentId]){Ja(C,M.fragmentId,I);return}const z=gt(C,aa.current,{},Ma,ca,je.direction);Ja(C,(z==null?void 0:z.id)??null,I)}),()=>{Y=!1}},[je,a,ca,Ma]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){Z(null),Ce({});return}const d=(A.pool??A.active??f).filter(M=>M.cardType==="vocab"&&M.checkType==="translation-match").filter((M,z,D)=>D.findIndex(J=>J.cardId===M.cardId)===z);d.some(M=>M.cardId===je.cardId)||d.unshift(je);const I=Wa(d).slice(0,6).map(M=>{const z=M.label.split("↔").map(ue=>ue.trim()).filter(Boolean);if(z.length<2)return null;const D=`${M.cardId}:L`,J=`${M.cardId}:R`;return{cardId:M.cardId,leftId:D,rightId:J,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),C=I.map(M=>M.leftId),Y=Wa(I.map(M=>M.rightId));Z({pairs:I,leftOrder:C,rightOrder:Y,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,f,A]),i.useEffect(()=>()=>{Ve.current&&window.clearTimeout(Ve.current),Ae.current&&window.clearTimeout(Ae.current)},[]);const st=i.useRef(null);i.useEffect(()=>{if(!je)return;const E=pe(je),ee=typeof document<"u"?document.activeElement:null;if(st.current===E&&ee&&(ee.tagName==="INPUT"||ee.tagName==="TEXTAREA"))return;let d=0;const y=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(oe.length>0){const C=Ut(Qe,oe,Fe),Y=C?qe.current[C]:null;if(Y&&(Y.focus(),document.activeElement===Y)){st.current=E;return}}if(ra.current&&(ra.current.focus(),document.activeElement===ra.current)){st.current=E;return}}else if(je.cardType==="vocab"&&ra.current&&(ra.current.focus(),document.activeElement===ra.current)){st.current=E;return}d<6&&(d+=1,window.setTimeout(y,40))}},I=window.setTimeout(y,40);return()=>window.clearTimeout(I)},[je,oe,Qe,Fe]),i.useEffect(()=>{if(!Ye)return;const E=ee=>{ee.key==="Enter"&&(ee.preventDefault(),ct())};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[Ye]);const ya=E=>{q(E),h(Aa(E))};i.useEffect(()=>{if(!je){h(null),q([]);return}const E=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Ba().then(ee=>{const d=ee.filter(y=>y.itemType==="info"&&y.itemId===je.cardId&&y.checkType==="quote-fragment"&&qt(y.direction,je.direction));ya(d)}).catch(()=>{h(null),q([])});return}Ot(E,je.cardId,je.checkType,je.direction).then(ee=>ya(ee)).catch(()=>{h(null),q([])})},[je]);const za=(E,ee,d,y)=>{if(E==="info"&&d==="quote-fragment"){Ba().then(I=>{const C=I.filter(Y=>Y.itemType==="info"&&Y.itemId===ee&&Y.checkType==="quote-fragment"&&qt(Y.direction,y));ya(C)}).catch(()=>{h(null),q([])});return}Ot(E,ee,d,y).then(I=>ya(I)).catch(()=>{h(null),q([])})},Ha=(E,ee,d)=>{var Y;const y=((Y=d.pairs.find(M=>M.leftId===E))==null?void 0:Y.rightId)??null;if(!y)return d;const I=y===ee;Ce(M=>({...M,[E]:I?"correct":"incorrect"})),Ve.current&&window.clearTimeout(Ve.current),Ae.current&&window.clearTimeout(Ae.current),fe.current+=1;const C={kind:I?"correct":"incorrect",tick:fe.current};if(Oe(null),Ve.current=window.setTimeout(()=>Oe(C),0),Ae.current=window.setTimeout(()=>Oe(null),420),I){const M={...d.locked,[E]:!0};return Object.keys(M).length>=d.pairs.length?(de("correct"),_e(!0)):de("correct"),{...d,selection:{...d.selection,[E]:ee},activeLeft:null,activeRight:null,locked:M}}return de("incorrect"),{...d,activeLeft:null,activeRight:null}},Lt=E=>{Z(ee=>!ee||ee.locked[E]?ee:ee.activeRight?Ha(E,ee.activeRight,ee):{...ee,activeLeft:ee.activeLeft===E?null:E})},Ct=E=>{Z(ee=>ee&&(ee.activeLeft?Ha(ee.activeLeft,E,ee):{...ee,activeRight:ee.activeRight===E?null:E}))},ct=()=>{var E;if(je&&je.cardType==="info"&&je.infoType==="quote"&&Ie.current&&Te&&!((E=Na(je.direction))!=null&&E.fragmentId)){const ee=gt(Ie.current,aa.current,Ze.current,Ma,ca,je.direction,Te.fragmentId);if(ee){de(null),le(""),t(!1),Me({}),_e(!1),ve(null),Je(0),Ja(Ie.current,ee.id,Te.title);return}}de(null),le(""),t(!1),Me({}),_e(!1),ve(null),Je(0),he(ee=>Math.min(ee+1,f.length))},$a=E=>{if(!je)return;const ee=E.expected??null,d=E.answer??"";let y=ee??"",I=d;if(!ee&&E.expectedMap&&E.answerMap){const ue=Object.keys(E.expectedMap).sort((me,ye)=>me.localeCompare(ye));y=ue.map(me=>{var ye;return((ye=E.expectedMap)==null?void 0:ye[me])??""}).join("|"),I=ue.map(me=>{var ye;return((ye=E.answerMap)==null?void 0:ye[me])??""}).join("|")}const C=y?ht(y,I,qa):new Uint8Array,Y={revisionType:ze.id,evalType:E.evalType,direction:E.direction,prompt:s??"",expected:ee,answer:d,expectedAnswers:E.expectedMap??null,answers:E.answerMap??null,correct:E.correct,maskBase64:C.length?Ua(C):null,checkMode:fa,compareMode:qa,minCorrectness:ma},M=new TextEncoder().encode(JSON.stringify(Y)),z=je.cardType==="info"?"info":"connection",D=E.overrideCheckType??je.checkType??null,J=E.overrideDirection??je.direction??null;Kt({itemType:z,itemId:je.cardId,checkType:D,direction:J,revisionType:ze.id,evalType:E.evalType,correct:E.correct,maskBase64:C.length?Ua(C):null,payloadBase64:Ua(M)}).then(()=>{za(z,je.cardId,D,J),ft(f)}).catch(()=>{})},dt=(E,ee)=>{const d=Va.current.get(ee);if(d)return Promise.resolve(d);const y=at.current.get(ee);if(y)return y;const I=_i({shareCode:l,infoId:E,key:ha}).then(C=>{var ue,me;const Y=C.payload,M=((ue=Y.definition)==null?void 0:ue.graph)??null,z="",D=((me=Y.definition)==null?void 0:me.answerTemplate)??"",J=kr(M,z,D);if(J){const xe={sample:Zr(J),answerTemplate:D||null};return Va.current.set(ee,xe),xe}return Ir({shareId:l,infoId:E,key:ha}).then(ye=>{const xe={sample:ye,answerTemplate:null};return Va.current.set(ee,xe),xe})}).catch(()=>Ir({shareId:l,infoId:E,key:ha}).then(C=>{const Y={sample:C,answerTemplate:null};return Va.current.set(ee,Y),Y}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{at.current.delete(ee)});return at.current.set(ee,I),I},Ca=(E,ee)=>{var M;const d=`${pe(E)}:${ee}`,y=tt.current.get(d);if(y)return Promise.resolve(y);const I=pt.current.get(d);if(I)return I;const C=z=>(tt.current.set(d,z),z);let Y;if(E.cardType==="vocab"){if(E.checkType==="translation-match")return Y=Promise.resolve(C({prompt:E.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),Y;const z=E.label.split("↔").map(D=>D.trim()).filter(Boolean);if(z.length>=2){const J=(E.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ue=J?z[0]:z[1],me=J?z[1]:z[0];Y=Promise.resolve(C({prompt:ue,expectedAnswer:me,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else Y=Promise.resolve(C({prompt:E.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(E.cardType==="info"&&E.infoType==="word"){const z=(M=E.description)!=null&&M.startsWith("Language: ")?E.description.replace("Language: ",""):null;Y=Promise.resolve(C({prompt:E.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else E.cardType==="info"&&E.infoType==="computed"?Y=dt(E.cardId,d).then(z=>{var ye,xe;if(!z.sample)return C({prompt:E.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const D=z.sample,J=D.expectedAnswers?Object.entries(D.expectedAnswers).map(([Se,$e])=>({key:Se,expected:$e})):[],ue=J.reduce((Se,$e)=>(Se[$e.key]="",Se),{}),me=D.expectedAnswerIsSentence&&((ye=D.expectedAnswer)==null?void 0:ye.trim())||null;return C({prompt:D.prompt,expectedAnswer:J.length>0?me:((xe=D.expectedAnswer)==null?void 0:xe.trim())||null,computedExpected:J,computedAnswers:ue,answerTemplate:z.answerTemplate,outputVariables:D.outputVariables??null,variableValues:D.variableValues??null})}).catch(()=>C({prompt:E.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{pt.current.delete(d)}):Y=Promise.resolve(C({prompt:E.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return pt.current.set(d,Y),Y},Ja=(E,ee,d)=>{const y=Object.keys(E.nodes).length,I=aa.current.size;if(!ee){ie({title:d,before:E.text,after:"",fragmentId:null,total:y,completed:I}),$(null),_e(!0);return}const C=E.nodes[ee];if(!C)return;const Y=ei(E.text,C);ie({title:d,before:Y.before,after:Y.after,fragmentId:C.id,total:y,completed:I}),$(Y.fragment),_e(!1)},xt=()=>{const E=Ie.current;E&&ie(ee=>ee&&{...ee,total:Object.keys(E.nodes).length,completed:aa.current.size})},Ea=()=>{const E=f[V+1];E&&Ca(E,V+1)},Mt=()=>{if(Ea(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&W){if(W.pairs.length===0){de("incorrect"),_e(!0);return}const C=W.pairs.reduce((me,ye)=>(me[ye.rightId]=ye.rightLabel,me),{});let Y=0;const M={};W.pairs.forEach(me=>{const xe=W.selection[me.leftId]===me.rightId;M[me.leftId]=xe?"correct":"incorrect",xe&&(Y+=1)});const z=W.pairs.length||1,D=Y/z,J=Y===W.pairs.length;Ce(me=>({...me,...M})),J?(de("correct"),_e(!0),Je(0)):(de("incorrect"),_e(!1),Je(me=>{const ye=me+1;return ye>=Ta&&(t(!0),_e(!0),Z(xe=>{if(!xe)return xe;const Se=xe.pairs.reduce(($e,He)=>($e[He.leftId]=He.rightId,$e),{});return{...xe,selection:Se}})),ye})),xa(J,D);const ue="connection";Promise.all(W.pairs.map(me=>{const ye=W.selection[me.leftId]??null,xe=ye?C[ye]:"",Se={left:me.leftLabel,expected:me.rightLabel,answer:xe,checkType:"translation-match"},$e=new TextEncoder().encode(JSON.stringify(Se));return Kt({itemType:ue,itemId:me.cardId,checkType:"translation-match",direction:null,revisionType:ze.id,evalType:"translation-match",correct:ye===me.rightId,maskBase64:null,payloadBase64:Ua($e)})})).then(()=>{za(ue,je.cardId,je.checkType,je.direction),ft(f)}).catch(()=>{});return}if(oe.length>0){const C=oe.reduce((M,z)=>{const D=Le[z.key]??"";return M[z.key]=va(D)===va(z.expected)?"correct":"incorrect",M},{});oe.every(({key:M,expected:z})=>{const D=Le[M]??"";return fa==="exact"&&va(D)===va(z)})?(de("correct"),Me(C),_e(!0),Je(0),xa(!0,1),$a({correct:!0,direction:s?`${s} -> computed`:"computed",expectedMap:oe.reduce((M,z)=>(M[z.key]=z.expected,M),{}),answerMap:Le,evalType:"computed"})):(de("incorrect"),Me(C),_e(!1),Je(M=>{const z=M+1;return z>=Ta&&Ya&&(t(!0),_e(!0)),z}),xa(!1,0),window.setTimeout(()=>{var z;const M=Ut(Qe,oe,Fe);M&&qe.current[M]&&((z=qe.current[M])==null||z.focus())},40),$a({correct:!1,direction:s?`${s} -> computed`:"computed",expectedMap:oe.reduce((M,z)=>(M[z.key]=z.expected,M),{}),answerMap:Le,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Te!=null&&Te.fragmentId)){if(!N)return;const C=Na(je.direction),Y=(C==null?void 0:C.mode)??getQuoteMode(je.direction),M=C!=null&&C.fragmentId&&je.direction?je.direction:Tt(Y,Te.fragmentId),z=si(N,be,qa),D=fa==="exact"&&mt(be)===mt(N),J=nt(z),ue=D||J,me=_a(z);ue?(Ze.current[Te.fragmentId]=Math.max(Ze.current[Te.fragmentId]??0,me),(Ze.current[Te.fragmentId]??0)>=Ma&&aa.current.add(Te.fragmentId),xt(),de("correct"),Me({}),_e(!0),ve(z),Je(0),me<100&&Ta<=1&&t(!0),xa(!0,me/100),$a({correct:!0,direction:`quote:${Te.fragmentId}`,expected:N,answer:be,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:M})):(de("incorrect"),Me({}),_e(!1),ve(z),Je(ye=>{const xe=ye+1;return xe>=Ta&&Ya&&(t(!0),_e(!0)),xe}),xa(!1,me/100),window.setTimeout(()=>{var ye;return(ye=ra.current)==null?void 0:ye.focus()},40),$a({correct:!1,direction:`quote:${Te.fragmentId}`,expected:N,answer:be,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:M}));return}if(!N)return;const E=ht(N,be,qa),ee=fa==="exact"&&va(be)===va(N),d=nt(E),y=ee||d,I=_a(E);y?(de("correct"),Me({}),_e(!0),ve(E),Je(0),I<100&&Ta<=1&&t(!0),xa(!0,I/100),$a({correct:!0,direction:s?`${s} -> ${N}`:null,expected:N,answer:be,evalType:"text"})):(de("incorrect"),Me({}),_e(!1),ve(E),Je(C=>{const Y=C+1;return Y>=Ta&&Ya&&(t(!0),_e(!0)),Y}),xa(!1,I/100),window.setTimeout(()=>{var C;return(C=ra.current)==null?void 0:C.focus()},40),$a({correct:!1,direction:s?`${s} -> ${N}`:null,expected:N,answer:be,evalType:"text"}))},ut=E=>{if(Ea(),!N)return;const ee=ht(N,E,qa),d=va(E)===va(N),y=nt(ee),I=d||y,C=_a(ee);I?(de("correct"),Me({}),_e(!0),ve(ee),Je(0),C<100&&Ta<=1&&t(!0),xa(!0,C/100),$a({correct:!0,direction:"word->language",expected:N,answer:E,evalType:"language-select"})):(de("incorrect"),Me({}),_e(!1),ve(ee),Je(Y=>{const M=Y+1;return M>=Ta&&Ya&&(t(!0),_e(!0)),M}),xa(!1,C/100),$a({correct:!1,direction:"word->language",expected:N,answer:E,evalType:"language-select"}))},St=E=>{var d;if(E.key!=="Enter")return;if(E.preventDefault(),E.stopPropagation(),Ye){ct();return}const ee=oe.find(y=>!(Le[y.key]??"").trim());if(ee){(d=qe.current[ee.key])==null||d.focus();return}Mt()},tr=()=>{Ea(),de("correct"),_e(!0),Je(0),xa(!0,1),N&&$a({correct:!0,direction:"manual",expected:N,answer:be,evalType:"manual"})},rr=()=>{if(xa(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){de(null),le(""),t(!1),Me({}),_e(!1),ve(null),Je(0),he(E=>Math.min(E+1,f.length));return}ct()};i.useEffect(()=>{Ea()},[V,f]);const ir=a.cogita.library.revision.revealModeAfterIncorrect,Ya=oe.length>0||!!N;return e.jsxs(ja,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:S,language:R,onLanguageChange:B,children:[(x==="loading"||G==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${se.total?Math.min(100,Math.max(0,se.current/se.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:se.total?`${Math.min(se.current,se.total)} / ${se.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:H}),e.jsx("p",{className:"cogita-library-subtitle",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",ka).replace("{check}",Oa)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[La?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",La.currentLevel??"-"," / ",La.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ni,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[ae?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:ae})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Pe?`${Pe.kind}-${Pe.tick}`:et?"idle":K??"idle",children:x!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):je?e.jsx(e.Fragment,{children:la?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ii,{copy:a,currentCard:je,currentTypeLabel:Xt,prompt:s,languages:F,answer:be,onAnswerChange:E=>le(ee=>_t(ee,E,j)),computedExpected:oe,computedAnswers:Le,onComputedAnswerChange:(E,ee)=>Ne(d=>({...d,[E]:_t(d[E]??"",ee,j)})),answerTemplate:Qe,outputVariables:Fe,variableValues:oa,computedFieldFeedback:Be,feedback:K,canAdvance:Ye,quoteContext:Te,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:rr,onLanguageSelect:ut,onMarkReviewed:tr,onAdvance:ct,showCorrectAnswer:Q,setShowCorrectAnswer:t,onRevealCorrect:()=>_e(!0),answerMask:ce,expectedAnswer:N,hasExpectedAnswer:Ya,handleComputedKeyDown:St,answerInputRef:ra,computedInputRefs:qe,scriptMode:j,setScriptMode:k,matchPairs:W==null?void 0:W.pairs,matchLeftOrder:W==null?void 0:W.leftOrder,matchRightOrder:W==null?void 0:W.rightOrder,matchSelection:W==null?void 0:W.selection,matchActiveLeft:W==null?void 0:W.activeLeft,matchActiveRight:W==null?void 0:W.activeRight,matchFeedback:De,onMatchLeftSelect:Lt,onMatchRightSelect:Ct})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:it?`${Ia} / ${it}`:a.cogita.library.revision.progressUnlimited}),x==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),x==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),x==="ready"&&G==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),x==="ready"&&G==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),x==="ready"&&G==="ready"&&f.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:ir}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ta]})]})]}),La?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",La.activeCount," / ",La.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:La.counts.map((E,ee)=>{const d=ee+1,y=La.currentLevel===d,I=La.percentages[ee]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":y,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:d}),e.jsx("strong",{children:E})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,I))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[I.toFixed(1),"%"]})]},`level-${d}`)})})]}):null,ot?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ot.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ot.dots.map(E=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-E.value))}, ${Math.round(200*E.value)}, 80, 0.9)`}},E.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ot.knownCount})]})]}):null,ca?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Pa})]})}):null]})]})]})})})]})]})}const al=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Yn},Symbol.toStringTag,{value:"Module"}));export{Zn as C,el as a,al as b};
