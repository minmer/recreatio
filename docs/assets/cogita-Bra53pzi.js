import{r as i,j as e,R as _t,B as Ut,C as Wt,H as Nr,P as Lr,a as yt,b as oi,c as si,u as pr,d as fr,e as xr,f as ci}from"./vendor-DrCXrCXJ.js";import{L as Kr,A as Or,g as qr,a as di,c as ui,e as gi,i as hi,b as bi,s as Vr,d as Qa,f as Cr,h as gr,j as Pt,k as hr,l as mi,m as rr,n as tt,u as pi,o as ra,p as fi,q as xi,r as yi,t as _r,v as Ur,w as $t,x as Wr,y as zr,z as zt,B as Rt,C as vi,D as ji,E as ki,F as wi,G as Ti,H as Ba,I as Ni,J as Li,K as Ci,M as Mi,N as Si,O as Ii,P as Pi,Q as $i,R as Ri,S as Ei,T as Fi,U as Ai,V as Bi,W as Mr}from"./recreatio-core-B7OfFf8b.js";import"./vendor-cogita-ui-DLgJCpO3.js";const xt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},ft={moveMs:900,pauseMs:220,errorMs:900},Di=(a=11)=>{let n=a;const d=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:b,height:m,paddingX:M,paddingY:v,levels:F}=xt,O=(m-v*2)/(F.length-1),q=[],c=[],R=[];F.forEach((h,x)=>{const se=m-v-x*O,V=b-M*2,y=[];for(let Q=0;Q<h;Q+=1){const K=M+(Q+1)*V/(h+1),G=(d()-.5)*18,ae=Math.max(M,Math.min(b-M,K+G)),U=x===0?3:x<2?2.1:1.4,be=x===0?"root":`l${x}-${Q}`;y.push({id:be,x:x===0?b/2:ae,y:se,r:U,level:x,role:x===0?"root":void 0})}R.push(y),q.push(...y)});const f=R[R.length-1];if(f!=null&&f.length){const h=f[Math.floor(f.length/2)];h.role="goal",h.r=2}for(let h=1;h<R.length;h+=1){const x=R[h-1];R[h].forEach(V=>{const y=[...x].sort((ae,U)=>Math.abs(ae.x-V.x)-Math.abs(U.x-V.x)),Q=y[0],K=y[1]&&d()<.45?y[1]:null;(K?[Q,K]:[Q]).forEach(ae=>{c.push({from:ae.id,to:V.id,key:`${ae.id}-${V.id}`})}),d()<.2&&y[2]&&c.push({from:y[2].id,to:V.id,key:`${y[2].id}-${V.id}`})})}const j=new Map;c.forEach(h=>{const x=j.get(h.to)??[];x.push(h.from),j.set(h.to,x)});const H=new Map,J=new Map,Y=new Map;c.forEach(h=>{const x=H.get(h.from)??[];x.push(h.key),H.set(h.from,x);const se=J.get(h.from)??[];se.push(h.to),J.set(h.from,se);const V=Y.get(h.from)??[];V.push(h.to),Y.set(h.from,V);const y=Y.get(h.to)??[];y.push(h.from),Y.set(h.to,y)});const s=new Map;return q.forEach(h=>{s.set(h.id,h)}),{nodes:q,links:c,parentsById:j,linksByFrom:H,childrenByFrom:J,neighborsById:Y,nodesById:s}};function Ki({slides:a,activeIndex:n,introOpen:d,prefersReducedMotion:b,onNext:m,onPrev:M,onSelect:v,onExit:F,onOpen:O,onRegister:q}){const c=n===a.length-1,R=d&&n===0?"entry":"docked",f=a[a.length-1],[j,H]=i.useState(!1),J=i.useMemo(()=>Array.from({length:20},(L,N)=>({src:`/cogita/logo/Cogita${String(N).padStart(2,"0")}.png`,kind:N<=11?"bubble":N<=17?"text":"recreatio"})),[]),Y=d&&n===0;i.useEffect(()=>{if(!d){H(!1);return}n>0&&!j&&H(!0)},[n,d,j]);const s=i.useRef(0),h=i.useRef(null),x=i.useMemo(()=>{const L={x:40,y:160},N={x:260,y:48},z=6,t=N.x-L.x,r=L.y-N.y,u=t/z,T=[.3,.45,.6,.65,1.4,2.2],g=T.reduce((ne,xe)=>ne+xe,0),E=T.map(ne=>r*ne/g),D=[L];let X=L.x,te=L.y;for(let ne=1;ne<=z;ne+=1){const xe=(Math.random()-.5)*14,Qe=(Math.random()-.5)*28;X=Math.max(L.x+ne*14,Math.min(N.x-(z-ne)*14,X+u+xe));const ze=E[ne-1]??E[E.length-1];te=te-ze+Qe;const Ze=Math.max(N.y,Math.min(L.y-4,te));D.push({x:Math.round(X),y:Math.round(Ze)})}return D[D.length-1]=N,D},[]),se=i.useMemo(()=>{const r=(g,E,D)=>Math.min(D,Math.max(E,g)),u=x.map(g=>{const E=10+Math.random()*36;return{x:r(g.x,40,260),y:r(g.y-E,40,140)}}),T=x.map((g,E)=>{var te;const D=12+Math.random()*40,X=((te=u[E])==null?void 0:te.y)??g.y;return{x:r(g.x,40,260),y:r(Math.max(X+10,g.y+D),60,170)}});return{upper:u,lower:T}},[x]),V=i.useMemo(()=>{var N;const L=((N=x[4])==null?void 0:N.x)??260;return Math.max(0,Math.min(240,L-40))},[x]),y=i.useMemo(()=>{var E,D;const L=(X,te,ne)=>Math.min(ne,Math.max(te,X)),N=(X,te,ne)=>x.map((xe,Qe)=>{var sa,Xe;const ze=((sa=se.upper[Qe])==null?void 0:sa.y)??xe.y,Ze=((Xe=se.lower[Qe])==null?void 0:Xe.y)??xe.y,Be=(Math.random()-.5)*70,Ue=xe.y+X+Be,Ae=L(xe.y+te,ze+6,Ze-6),Ge=L(xe.y+ne,ze+6,Ze-6);return{x:xe.x,y:L(Ue,Math.min(Ae,Ge),Math.max(Ae,Ge))}}),z=-14+Math.random()*28,t=14+Math.random()*28,r=N(z,-80,12),u=N(t,-12,80);for(let X=4;X<x.length;X+=1){const te=x[X],ne=((E=se.upper[X])==null?void 0:E.y)??te.y,xe=((D=se.lower[X])==null?void 0:D.y)??te.y;r[X]={x:te.x,y:L(te.y-12,ne+6,xe-6)},u[X]={x:te.x,y:L(te.y+12,ne+6,xe-6)}}const T=se.upper.length?se.upper[se.upper.length-1].y:40,g=se.lower.length?se.lower[se.lower.length-1].y:170;return r[r.length-1]={x:x[x.length-1].x,y:L(x[x.length-1].y-14,T,g)},u[u.length-1]={x:x[x.length-1].x,y:L(x[x.length-1].y+12,T,g)},{higher:r,lower:u}},[x,se]),Q=1e4,K=i.useMemo(()=>{let L=17;const N=()=>(L=(L*1664525+1013904223)%4294967296,L/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const u=(N()-.5)*240,T=(N()-.5)*180,g=(N()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${u.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${g.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),G=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[ae,U]=i.useState([]),be=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),ke=i.useMemo(()=>{const N=[],t=(u,T)=>u+Math.random()*(T-u);for(let u=0;u<6;u+=1){let T=!1;for(let g=0;g<80;g+=1){const E=t(14,86),D=t(10,34);if(N.every(te=>{const ne=te.x-E,xe=te.y-D;return Math.hypot(ne,xe)>=12})){N.push({x:E,y:D}),T=!0;break}}T||N.push({x:t(16,84),y:t(12,32)})}return N.map((u,T)=>({id:`p${T+1}`,x:`${u.x.toFixed(1)}%`,y:`${u.y.toFixed(1)}%`,xNum:u.x,yNum:u.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[oe,B]=i.useState(0),[ge,l]=i.useState(0),[re,k]=i.useState([]),S=1e4,ve=i.useMemo(()=>{if(ke.length<2)return[];const L=T=>{let g=T+1831565813;return g=Math.imul(g^g>>>15,g|1),g^=g+Math.imul(g^g>>>7,g|61),((g^g>>>14)>>>0)/4294967296},N=(T,g)=>Math.floor(L(T)*g),z=new Set,t=[],r=Math.min(3,ke.length);let u=0;for(;t.length<r&&u<30;){u+=1;const T=N(oe*13+u*5,ke.length),g=N(oe*29+u*7,ke.length);if(T===g)continue;const E=T<g?`${T}-${g}`:`${g}-${T}`;z.has(E)||(z.add(E),t.push({id:`link-${E}`,from:ke[T],to:ke[g],delay:`${(u*.35).toFixed(2)}s`}))}return t},[oe,ke]);i.useEffect(()=>{if(!d||n!==2)return;const L=()=>{const z=K.map(t=>t.id);for(let t=z.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[z[t],z[r]]=[z[r],z[t]]}return z.slice(0,4)};U(L());const N=window.setInterval(()=>{U(L())},Q);return()=>window.clearInterval(N)},[n,d,K,Q]),i.useEffect(()=>{if(!d||n!==3)return;const L=()=>{l(Math.floor(Math.random()*be.length)),k(ke.map(()=>Math.random()<.6?"good":"bad")),B(z=>z+1)};L();const N=window.setInterval(L,S);return()=>window.clearInterval(N)},[n,d,be.length,ke,S]);const _=i.useMemo(()=>Di(11),[]),[le,we]=i.useState(new Set(["root"])),[Ne,Re]=i.useState(new Set),[Se,Fe]=i.useState(new Set),[me,Ve]=i.useState({fromId:"root",toId:"root",key:0}),Ie=i.useRef(le),We=i.useRef("root"),ia=i.useRef(0),Le=i.useRef(null),ee=i.useRef(null),Te=i.useRef([]);i.useEffect(()=>{Ie.current=le},[le]);const qe=i.useMemo(()=>{const L=new Set;return le.forEach(N=>{const z=_.linksByFrom.get(N);z&&z.forEach(t=>L.add(t))}),L},[le,_]),Pe=_.nodesById.get(me.toId)??_.nodesById.get("root"),de=Pe?`${Pe.x/xt.width*100}%`:"50%",Ee=Pe?`${Pe.y/xt.height*100}%`:"90%";i.useEffect(()=>{if(!d||n!==1||b)return;(()=>{we(new Set(["root"])),Re(new Set),Fe(new Set),Ve({fromId:"root",toId:"root",key:0}),ee.current=null,ia.current=0,We.current="root",Te.current=[]})();const N=()=>{const t=We.current,r=Ie.current,T=(_.childrenByFrom.get(t)??[]).filter(xe=>!r.has(xe));if(T.length)return T[Math.floor(Math.random()*T.length)];if(r.size>=_.nodes.length){const xe=_.neighborsById.get(t)??[];return xe.length?xe[Math.floor(Math.random()*xe.length)]:null}const g=xe=>(_.childrenByFrom.get(xe)??[]).some(ze=>!r.has(ze)),E=[t],D=new Set([t]),X=new Map;let te=null;for(;E.length;){const xe=E.shift();if(!xe)break;if(xe!==t&&g(xe)){te=xe;break}(_.neighborsById.get(xe)??[]).forEach(ze=>{D.has(ze)||(D.add(ze),X.set(ze,xe),E.push(ze))})}if(!te)return null;let ne=te;for(;X.get(ne)&&X.get(ne)!==t;)ne=X.get(ne)??ne;return ne},z=(t,r)=>{if(t===r){const u=N();u&&z(t,u);return}ia.current+=1,Ve({fromId:t,toId:r,key:ia.current}),We.current=r,Le.current=window.setTimeout(()=>{const u=_.parentsById.get(r)??[],T=Ie.current,g=u.filter(te=>!T.has(te));if(!g.length){const te=new Set(T);te.add(r),we(te),Le.current=window.setTimeout(()=>{for(;Te.current.length;){const xe=Te.current[Te.current.length-1];if(!te.has(xe)){if(xe!==r){z(r,xe);return}break}Te.current.pop()}const ne=N();ne&&z(r,ne)},ft.pauseMs);return}const E=new Set([r,...g]),D=new Set(g.map(te=>`${te}-${r}`));Re(E),Fe(D),Te.current.includes(r)||Te.current.push(r);const X=g[Math.floor(Math.random()*g.length)];ee.current={fromId:r,toId:X},Le.current=window.setTimeout(()=>{Re(new Set),Fe(new Set);const te=ee.current;te&&z(te.fromId,te.toId)},ft.errorMs)},ft.moveMs)};return Le.current=window.setTimeout(()=>{const t=N();t&&z(We.current,t)},ft.pauseMs),()=>{Le.current&&window.clearTimeout(Le.current)}},[n,d,_,b]);const Ke=L=>{if(!d)return;const N=Date.now();N-s.current<520||Math.abs(L.deltaY)<10||(s.current=N,L.deltaY>0?m():M(),L.preventDefault())},Oe=L=>{if(!d)return;const N=L.touches[0];N&&(h.current={x:N.clientX,y:N.clientY})},Ce=L=>{if(!d)return;const N=h.current;if(h.current=null,!N)return;const z=L.changedTouches[0];if(!z)return;const t=z.clientX-N.x,r=z.clientY-N.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?m():M())};return e.jsxs("div",{className:`cogita-intro ${d?"is-open":"is-closed"} ${b?"is-reduced":""} ${c?"is-final":""}`,"data-slide":n+1,onWheel:Ke,onTouchStart:Oe,onTouchEnd:Ce,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":R,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${Y&&!j?"is-entry":""}`,children:J.map((L,N)=>e.jsx("img",{src:L.src,alt:"",className:`cogita-logo-layer ${N===0?"is-base":""} ${L.kind==="text"?"is-text":L.kind==="recreatio"?"is-recreatio":""} ${L.kind==="bubble"?"is-bubble":""}`},L.src))})}),d&&a.map((L,N)=>{const z=N===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${N+1} ${z?"is-active":""}`,"aria-hidden":!z,children:[e.jsxs("div",{className:"cogita-intro-text",children:[L.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:L.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:L.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:L.title}),L.body&&e.jsx("p",{children:L.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),L.micro&&e.jsx("p",{className:"cogita-intro-micro",children:L.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:c?q:m,children:L.cta}),c&&L.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>v(0),children:L.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[N===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${xt.width} ${xt.height}`,preserveAspectRatio:"none",children:[_.links.map(t=>{const r=_.nodesById.get(t.from),u=_.nodesById.get(t.to);if(!r||!u)return null;const T=qe.has(t.key),g=Se.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${g?"is-error":""}`,x1:r.x,y1:r.y,x2:u.x,y2:u.y},t.key)}),_.nodes.map(t=>{const r=le.has(t.id),u=Ne.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${u?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Pe&&e.jsx("span",{className:"map-explorer-dot",style:{left:de,top:Ee,"--move":`${ft.moveMs}ms`}})]}),N===2&&e.jsx("div",{className:"cogita-index-cards",children:K.map(t=>{const r=ae.indexOf(t.id),u=r>=0?G[r]:null,T=(u==null?void 0:u.x)??"140px",g=(u==null?void 0:u.y)??"140px",E=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":g,"--stack-opacity":E,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),N===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[be.map((t,r)=>e.jsxs("div",{className:`round-card ${r===ge?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),be[ge]&&e.jsx("span",{className:"round-ring",style:{"--card-x":be[ge].x,"--card-y":`calc(${be[ge].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:ke.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:ve.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:ke.map((t,r)=>{const u=re[r]??"good",T=be[ge];if(!T)return null;const g=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":g,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${u}`,style:{"--from-x":T.x,"--from-y":g,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${u}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${oe}`)})})]},`round-${oe}`),N===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${x[0].x} ${x[0].y} L${x[1].x} ${x[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${x[1].x} ${x[1].y} L${x[2].x} ${x[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${x[2].x} ${x[2].y} L${x[3].x} ${x[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${x[3].x} ${x[3].y} L${x[4].x} ${x[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${x[4].x} ${x[4].y} L${x[5].x} ${x[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${x[5].x} ${x[5].y} L${x[6].x} ${x[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${V};${V};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${se.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${se.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${se.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${se.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[y.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${y.higher[r+1].x} ${y.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),y.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${y.lower[r+1].x} ${y.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${x[0].x/300*100}%`,"--p0y":`${x[0].y/200*100}%`,"--p1x":`${x[1].x/300*100}%`,"--p1y":`${x[1].y/200*100}%`,"--p2x":`${x[2].x/300*100}%`,"--p2y":`${x[2].y/200*100}%`,"--p3x":`${x[3].x/300*100}%`,"--p3y":`${x[3].y/200*100}%`,"--p4x":`${x[4].x/300*100}%`,"--p4y":`${x[4].y/200*100}%`,"--p5x":`${x[5].x/300*100}%`,"--p5y":`${x[5].y/200*100}%`,"--p6x":`${x[6].x/300*100}%`,"--p6y":`${x[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${y.higher[0].x/300*100}%`,"--q0y":`${y.higher[0].y/200*100}%`,"--q1x":`${y.higher[1].x/300*100}%`,"--q1y":`${y.higher[1].y/200*100}%`,"--q2x":`${y.higher[2].x/300*100}%`,"--q2y":`${y.higher[2].y/200*100}%`,"--q3x":`${y.higher[3].x/300*100}%`,"--q3y":`${y.higher[3].y/200*100}%`,"--q4x":`${y.higher[4].x/300*100}%`,"--q4y":`${y.higher[4].y/200*100}%`,"--q5x":`${y.higher[5].x/300*100}%`,"--q5y":`${y.higher[5].y/200*100}%`,"--q6x":`${y.higher[6].x/300*100}%`,"--q6y":`${y.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${y.lower[0].x/300*100}%`,"--q0y":`${y.lower[0].y/200*100}%`,"--q1x":`${y.lower[1].x/300*100}%`,"--q1y":`${y.lower[1].y/200*100}%`,"--q2x":`${y.lower[2].x/300*100}%`,"--q2y":`${y.lower[2].y/200*100}%`,"--q3x":`${y.lower[3].x/300*100}%`,"--q3y":`${y.lower[3].y/200*100}%`,"--q4x":`${y.lower[4].x/300*100}%`,"--q4y":`${y.lower[4].y/200*100}%`,"--q5x":`${y.lower[5].x/300*100}%`,"--q5y":`${y.lower[5].y/200*100}%`,"--q6x":`${y.lower[6].x/300*100}%`,"--q6y":`${y.lower[6].y/200*100}%`}})]})})}),N===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),N===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},L.id)}),!d&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:f.title}),f.body&&e.jsx("p",{children:f.body}),f.micro&&e.jsx("p",{className:"cogita-intro-micro",children:f.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:q,children:f.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:O,children:"Otwórz pokaz"})]})]})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((L,N)=>e.jsx("button",{type:"button",className:`dot ${n===N?"active":""}`,"aria-label":L.title,onClick:()=>v(N)},L.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:F,children:"Pomiń"})]})]})}const Oi=6,qi=4;function Vi({copy:a,onAuthAction:n,authLabel:d,showProfileMenu:b,onProfileNavigate:m,onToggleSecureMode:M,onLogout:v,secureMode:F,onNavigate:O,language:q,onLanguageChange:c}){const R=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}O("home")},f=i.useRef(null),j=i.useRef([]),H=i.useMemo(()=>{let k=Date.now()%2147483647;const S=()=>(k=k*48271%2147483647,k/2147483647);return Array.from({length:Oi},(ve,_)=>{const le=6+S()*8,we=7+S()*10,Ne=6+S()*9,Re=-S()*le,Se=-S()*we,Fe=-S()*Ne,me=.18+S()*.28,Ve=12+S()*18,Ie=4+S()*8,We=(S()-.5)*3.2,ia=(S()-.5)*3.8,Le=S()>.5?"alternate":"alternate-reverse",ee=S()>.5?"alternate":"alternate-reverse",Te=S()>.5?"alternate":"alternate-reverse",qe=.18+S()*.42,Pe=30+S()*60,de=-45-S()*38,Ee=188+S()*32,Ke=.1+S()*.2;return{id:`wave-${_+1}`,style:{"--wave-sway-duration":`${le}s`,"--wave-scale-duration":`${we}s`,"--wave-drift-duration":`${Ne}s`,"--wave-sway-delay":`${Re}s`,"--wave-scale-delay":`${Se}s`,"--wave-drift-delay":`${Fe}s`,"--wave-sway-dir":Le,"--wave-scale-dir":ee,"--wave-drift-dir":Te,"--wave-scale":`${me}`,"--wave-shift":`${Ve}%`,"--wave-xshift":`${Ie}%`,"--wave-x0":`${We}%`,"--wave-y0":`${ia}%`,"--wave-opacity":`${qe}`,"--wave-blur":`${Pe}px`,"--wave-bottom":`${de}%`,"--wave-hue":`${Ee}`,"--wave-glow":`${Ke}`}}})},[]),J=i.useMemo(()=>{let k=Date.now()*3%2147483647;const S=()=>(k=k*48271%2147483647,k/2147483647);return Array.from({length:qi},(ve,_)=>{const le=180+S()*220,we=220+S()*280,Ne=-S()*le,Re=-S()*we,Se=.12+S()*.22,Fe=3+S()*7,me=1+S()*3,Ve=(S()-.5)*2.8,Ie=(S()-.5)*2.2;return{id:`mesh-${_+1}`,seed:1e3+_*991+Math.floor(S()*999),style:{"--mesh-sway-duration":`${le}s`,"--mesh-drift-duration":`${we}s`,"--mesh-sway-delay":`${Ne}s`,"--mesh-drift-delay":`${Re}s`,"--mesh-scale":`${Se}`,"--mesh-shift":`${Fe}%`,"--mesh-xshift":`${me}%`,"--mesh-x0":`${Ie}%`,"--mesh-y0":`${Ve}%`}}})},[]),Y=i.useMemo(()=>{const k=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],S=a.cogita.introSlides,ve=new Map(S.map(_=>[_.id,_]));return k.map(_=>{var we;const le=ve.get(_.id);return{..._,...le,title:(le==null?void 0:le.title)??"Cogita",cta:(le==null?void 0:le.cta)??((we=a.cogita.introSlides[0])==null?void 0:we.cta)??a.cogita.loginCta,secondary:le==null?void 0:le.secondary}})},[a.cogita.introSlides]),[s,h]=i.useState(0),[x,se]=i.useState(!0),[V,y]=i.useState(!1),Q=Y.length-1,K=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),G=i.useCallback(()=>{K(),n()},[K,n]),ae=i.useCallback(()=>{se(!0),h(0)},[]),U=i.useCallback(()=>{se(!1),h(Q)},[Q]),be=i.useCallback(k=>{h(Math.max(0,Math.min(Q,k)))},[Q]),ke=i.useCallback(()=>{s>=Q?G():be(s+1)},[s,be,G,Q]),oe=i.useCallback(()=>{be(s-1)},[s,be]);i.useEffect(()=>{var ve;const k=(ve=window.matchMedia)==null?void 0:ve.call(window,"(prefers-reduced-motion: reduce)");if(!k)return;const S=()=>y(k.matches);return S(),k.addEventListener?(k.addEventListener("change",S),()=>k.removeEventListener("change",S)):(k.addListener(S),()=>k.removeListener(S))},[]),i.useEffect(()=>{if(!x)return;const k=S=>{const ve=S.target;if(!ve)return;const _=ve.tagName;if(!(ve.isContentEditable||_==="INPUT"||_==="TEXTAREA"||_==="SELECT"||_==="BUTTON"||_==="A"||ve.closest('button, a, [role="button"], [role="link"]'))){if(S.key==="Escape"){U();return}if(S.key==="ArrowLeft"||S.key==="ArrowUp"){oe();return}(S.key==="ArrowRight"||S.key==="ArrowDown"||S.code==="Space"||S.key===" ")&&(S.preventDefault(),ke())}};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[U,ke,oe,x]),i.useEffect(()=>{x&&s===Q&&K()},[s,x,Q,K]),i.useEffect(()=>{const k=f.current;if(!k)return;const S=j.current.filter(de=>!!de);if(!S.length)return;const ve=1,_=.6,le=.6,we=Math.max(1,Math.min(ve,window.devicePixelRatio||1));let Ne=0,Re=0,Se=_,Fe=0,me=0;const Ve=de=>{let Ee=de%2147483647;return Ee<=0&&(Ee+=2147483646),(Ke,Oe)=>{Ee=Ee*48271%2147483647;const Ce=Ee/2147483647;return Ke+Ce*(Oe-Ke)}},Ie={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},We=de=>{const Ee=Math.sin(de*12.9898)*43758.5453;return Ee-Math.floor(Ee)},ia=de=>{const Ee=We(de+.1)||1e-4,Ke=We(de+.7)||1e-4;return Math.sqrt(-2*Math.log(Ee))*Math.cos(2*Math.PI*Ke)},Le=(de,Ee)=>{const Ke=Math.floor(de),Oe=Ke+1,Ce=de-Ke,L=Ce*Ce*(3-2*Ce),N=We(Ke*12.9898+Ee*78.233),z=We(Oe*12.9898+Ee*78.233);return N+(z-N)*L},ee=de=>{const Ee=Ve(de),Ke=Math.min(4,Math.max(4,Math.floor(Ne/1200*Ie.filamentCount)));return Array.from({length:Ke},(Oe,Ce)=>{const L=Math.max(-1,Math.min(1,ia(de+Ce*.37))),N=Math.min(1,Math.max(0,We(de+Ce*1.31))),z=Math.min(Ie.depthLayers-1,Math.floor(N*Ie.depthLayers));return{seed:Ee(0,Math.PI*2)+de*.01,offset:L,freqA:Ie.freq1*(.75+Ee(0,.5)),freqB:Ie.freq2*(.75+Ee(0,.5)),ampA:Ie.amp1*(.6+Ee(0,.7)),ampB:Ie.amp2*(.6+Ee(0,.7)),width:2+Ce%5*.32,depth:N,layer:z}})},Te=(de,Ee,Ke)=>{const Oe=Math.max(30,Math.floor(Ne*Re/14e4));de.save(),de.globalAlpha=.6;for(let Ce=0;Ce<Oe;Ce+=1){const L=We(Ce*9.1+Ne*.11)*Ee+Ke,N=We(Ce*3.7+Re*.23)*Re,z=1.2+We(Ce*5.9)*2.4,t=de.createRadialGradient(L,N,0,L,N,z*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),de.fillStyle=t,de.beginPath(),de.arc(L,N,z*2,0,Math.PI*2),de.fill()}de.restore()},qe=(de,Ee)=>{de.clearRect(0,0,Ne,Re);const Ke=Re*Ie.waveCenter,Oe=Ie.waveBandPx,Ce=Ie.segments,L=Ie.colors.filaments,N=Fe||Ne,z=0;Te(de,N,z),de.strokeStyle=L,de.lineCap="round",de.lineJoin="round";for(let t=0;t<Ee.length;t+=1){const r=Ee[t],u=r.offset*Oe*(.85+We(r.seed)*.4),T=1-Math.min(1,Math.abs(u)/Oe),g=Math.exp(-Math.pow(u/Ie.crestThickness,2)),E=r.layer===0?1.1:r.layer===1?.85:.6,D=.35+(1-r.depth)*.65,X=T*D*E*(.34+g*.45);de.globalAlpha=X,de.lineWidth=r.width*(1+(1-r.depth)*.8);const te=[];for(let xe=0;xe<=Ce;xe+=1){const Qe=xe/Ce*N+z,ze=(Le(Qe*.012,r.seed)-.5)*Ie.xJitter,Ze=Qe+ze,Be=(Le(Ze*r.freqA,r.seed)-.5)*Ie.jitterA,Ue=(Le(Ze*r.freqB,r.seed*1.7)-.5)*Ie.jitterB,Ae=Ke+Math.sin(Ze*r.freqA+r.seed)*r.ampA+Math.sin(Ze*r.freqB+r.seed*1.3)*r.ampB+u+Be+Ue;te.push({x:Ze,y:Ae})}de.beginPath(),de.moveTo(te[0].x,te[0].y);for(let xe=1;xe<te.length-1;xe+=1){const Qe=(te[xe].x+te[xe+1].x)/2,ze=(te[xe].y+te[xe+1].y)/2;de.quadraticCurveTo(te[xe].x,te[xe].y,Qe,ze)}const ne=te[te.length-1];de.quadraticCurveTo(ne.x,ne.y,ne.x,ne.y),de.stroke()}de.save(),de.globalCompositeOperation="lighter",de.strokeStyle=Ie.colors.glow,de.lineCap="round",de.lineJoin="round";for(let t=0;t<Ee.length;t+=1){const r=Ee[t];if(Math.abs(r.offset)*Oe>Ie.crestThickness)continue;const u=Ie.glowAlpha*(.7+(1-r.depth)*.6);de.globalAlpha=u,de.lineWidth=1.6+(1-r.depth)*1.2;const T=[];for(let E=0;E<=Ce;E+=1){const D=E/Ce*N+z,X=Math.sin(D*.02+r.seed)*3,te=Ke+Math.sin(D*r.freqA+r.seed)*r.ampA+Math.sin(D*r.freqB+r.seed*1.3)*r.ampB+r.offset*Oe*.35+X;T.push({x:D,y:te})}de.beginPath(),de.moveTo(T[0].x,T[0].y);for(let E=1;E<T.length-1;E+=1){const D=(T[E].x+T[E+1].x)/2,X=(T[E].y+T[E+1].y)/2;de.quadraticCurveTo(T[E].x,T[E].y,D,X)}const g=T[T.length-1];de.quadraticCurveTo(g.x,g.y,g.x,g.y),de.stroke()}de.restore()},Pe=()=>{Ne=Math.floor(k.clientWidth),Re=Math.floor(k.clientHeight),Fe=Math.floor(Ne*1.8),me=Re,Se=Ne<820?le:_,S.forEach(de=>{const Ee=de.getContext("2d");if(!Ee)return;de.width=Math.floor(Fe*we*Se),de.height=Math.floor(me*we*Se),de.style.width=`${Fe}px`,de.style.height=`${me}px`,de.style.left=`${-(Fe-Ne)/2}px`,Ee.setTransform(we*Se,0,0,we*Se,0,0);const Ke=Number(de.dataset.seed||1),Oe=ee(Ke);qe(Ee,Oe)})};return Pe(),window.addEventListener("resize",Pe,{passive:!0}),()=>window.removeEventListener("resize",Pe)},[J]);const B=Y[Math.min(s,Y.length-1)],ge=x?B:Y[Y.length-1],l=(ge==null?void 0:ge.theme)??Y[0].theme,re={"--cogita-bg0":l.bg0,"--cogita-bg1":l.bg1,"--cogita-bg2":l.bg2,"--cogita-bloom":l.bloom,"--cogita-sat":l.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:R,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Kr,{value:q,onChange:c}),e.jsx(Or,{copy:a,label:d,isAuthenticated:b,secureMode:F,onLogin:n,onProfileNavigate:m,onToggleSecureMode:M,onLogout:v,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:f,className:"cogita-section cogita-home",style:re,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[J.map((k,S)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:k.style,"data-seed":k.seed,ref:ve=>{j.current[S]=ve}},k.id)),H.map(k=>e.jsx("div",{className:"cogita-home-wave",style:k.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},k.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Ki,{slides:Y,activeIndex:s,introOpen:x,prefersReducedMotion:V,onNext:ke,onPrev:oe,onSelect:be,onExit:U,onOpen:ae,onRegister:G})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Un=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Vi},Symbol.toStringTag,{value:"Module"})),Hr=i.createContext(!1);function ka({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:c}){if(i.useContext(Hr))return e.jsx(e.Fragment,{children:c});const f=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}F("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:f,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Kr,{value:O,onChange:q}),e.jsx(Or,{copy:a,label:n,isAuthenticated:d,secureMode:v,onLogin:()=>F("home"),onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:c}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function Da(a){const[n,d]=i.useState("Cogita library"),[b,m]=i.useState(null);return i.useEffect(()=>{let M=!1;return qr().then(v=>{if(M)return;const F=v.find(O=>O.libraryId===a);F&&d(F.name)}).catch(()=>{M||d("Cogita library")}),()=>{M=!0}},[a]),i.useEffect(()=>{let M=!1;return di(a).then(v=>{M||m(v)}).catch(()=>{M||m(null)}),()=>{M=!0}},[a]),{libraryName:n,stats:b}}function _i({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c}){const{libraryName:R,stats:f}=Da(c),[j,H]=i.useState(null),[J,Y]=i.useState(null),[s,h]=i.useState(null),[x,se]=i.useState(null),[V,y]=i.useState(null),[Q,K]=i.useState(null),[G,ae]=i.useState(null),U=i.useRef(null),be=`/#/cogita/library/${c}`,ke=l=>{if(!Number.isFinite(l))return"0 B";if(l<1024)return`${l} B`;const re=l/1024;if(re<1024)return`${re.toFixed(1)} KB`;const k=re/1024;return k<1024?`${k.toFixed(1)} MB`:`${(k/1024).toFixed(1)} GB`},oe=async()=>{H(null);try{const l=await ui(c);H(a.cogita.library.overview.seedSuccess.replace("{languages}",String(l.languages)).replace("{translations}",String(l.translations)))}catch{H(a.cogita.library.overview.seedFail)}},B=async()=>{Y(null),K({loadedBytes:0,totalBytes:null,percent:null});try{Y(a.cogita.library.overview.exporting);const l=await gi(c,K),re=URL.createObjectURL(l),k=document.createElement("a");k.href=re,k.download=`cogita-library-${R||c}.json`,k.click(),URL.revokeObjectURL(re),Y(a.cogita.library.overview.exportReady)}catch{Y(a.cogita.library.overview.exportFail)}finally{K(l=>l??{loadedBytes:0,totalBytes:null,percent:null})}},ge=async l=>{var k;h(null),se(null),y(null);const re=(k=l.target.files)==null?void 0:k[0];if(re)try{h(a.cogita.library.overview.importing),ae({loadedBytes:0,totalBytes:re.size,percent:0});const S=await hi(c,re,ae,ve=>{const _=ve.stage==="infos"?a.cogita.library.overview.importStageInfos:ve.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;y(a.cogita.library.overview.importLiveProgress.replace("{stage}",_).replace("{done}",String(ve.processed)).replace("{total}",String(ve.total)).replace("{infos}",String(ve.infos)).replace("{connections}",String(ve.connections)).replace("{collections}",String(ve.collections)))});se({infos:S.infosImported,connections:S.connectionsImported,collections:S.collectionsImported}),h(a.cogita.library.overview.importDone)}catch(S){const ve=S instanceof bi&&S.message?` ${S.message}`:"";h(`${a.cogita.library.overview.importFail}${ve}`)}finally{U.current&&(U.current.value="")}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h1",{className:"cogita-library-title",children:R}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${be}/list`,children:a.cogita.library.actions.openList}),e.jsx("a",{className:"cta ghost",href:`${be}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${be}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsxs("div",{className:"cogita-library-stats",children:[e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.totalInfos}),e.jsx("strong",{children:(f==null?void 0:f.totalInfos)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.connections}),e.jsx("strong",{children:(f==null?void 0:f.totalConnections)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.words}),e.jsx("strong",{children:(f==null?void 0:f.totalWords)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.sentences}),e.jsx("strong",{children:(f==null?void 0:f.totalSentences)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.languages}),e.jsx("strong",{children:(f==null?void 0:f.totalLanguages)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.collections}),e.jsx("strong",{children:(f==null?void 0:f.totalCollections)??0})]})]}),e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.quickActionsTitle}),e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.overview.quickActionsText}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("a",{className:"cta ghost",href:`${be}/list`,children:a.cogita.library.overview.browseList}),e.jsx("a",{className:"cta ghost",href:`${be}/collections`,children:a.cogita.library.overview.viewCollections}),e.jsx("a",{className:"cta",href:`${be}/new`,children:a.cogita.library.overview.addInfo})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta ghost",onClick:oe,children:a.cogita.library.overview.seedMock}),j?e.jsx("p",{className:"cogita-help",children:j}):null]})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.focusTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.focusBody1}),e.jsx("p",{children:a.cogita.library.overview.focusBody2})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:B,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:U,type:"file",accept:"application/json",onChange:ge})]})]}),Q?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:Q.percent??void 0,max:Q.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ke(Q.loadedBytes)).replace("{total}",Q.totalBytes?ke(Q.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,G?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:G.percent??void 0,max:G.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ke(G.loadedBytes)).replace("{total}",G.totalBytes?ke(G.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,J?e.jsx("p",{className:"cogita-help",children:J}):null,s?e.jsx("p",{className:"cogita-help",children:s}):null,V?e.jsx("p",{className:"cogita-help",children:V}):null,x?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(x.infos)).replace("{connections}",String(x.connections)).replace("{collections}",String(x.collections))}):null]})]})]})]})]})})]})})}const ue=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ca=(a,n,d,b)=>`${a}:${n}:${d??""}:${b??""}`,Ye=(a,n)=>{const d=a.cogita.library.infoTypes;return{any:d.any,vocab:d.vocab,language:d.language,word:d.word,sentence:d.sentence,topic:d.topic,collection:d.collection,person:d.person,institution:d.institution,collective:d.collective,orcid:d.orcid,address:d.address,email:d.email,phone:d.phone,media:d.media,work:d.work,geo:d.geo,music_piece:d.musicPiece,music_fragment:d.musicFragment,source:d.source,quote:d.quote,computed:d.computed}[n]??String(n)},Jr=a=>[{value:"any",label:Ye(a,"any")},{value:"language",label:Ye(a,"language")},{value:"word",label:Ye(a,"word")},{value:"sentence",label:Ye(a,"sentence")},{value:"topic",label:Ye(a,"topic")},{value:"collection",label:Ye(a,"collection")},{value:"person",label:Ye(a,"person")},{value:"institution",label:Ye(a,"institution")},{value:"collective",label:Ye(a,"collective")},{value:"orcid",label:Ye(a,"orcid")},{value:"address",label:Ye(a,"address")},{value:"email",label:Ye(a,"email")},{value:"phone",label:Ye(a,"phone")},{value:"media",label:Ye(a,"media")},{value:"work",label:Ye(a,"work")},{value:"geo",label:Ye(a,"geo")},{value:"music_piece",label:Ye(a,"music_piece")},{value:"music_fragment",label:Ye(a,"music_fragment")},{value:"source",label:Ye(a,"source")},{value:"quote",label:Ye(a,"quote")},{value:"computed",label:Ye(a,"computed")}],Ui=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Wi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],zi=a=>[{value:"any",label:Ye(a,"any")},{value:"vocab",label:Ye(a,"vocab")},...Jr(a).filter(n=>n.value!=="any")],Ya=5,Sr=50,Ir=2,Pr=[];function De({libraryId:a,infoType:n,label:d,placeholder:b,value:m,onChange:M,values:v,onChangeMultiple:F,helperText:O,searchFailedText:q,createFailedText:c,createLabel:R,savingLabel:f,loadMoreLabel:j,inputRef:H,autoAdvance:J,onCommit:Y,multiple:s}){const h=s?v??Pr:Pr,[x,se]=i.useState(s?"":(m==null?void 0:m.label)??""),[V,y]=i.useState([]),[Q,K]=i.useState(Ya),[G,ae]=i.useState(-1),[U,be]=i.useState(!1),[ke,oe]=i.useState(!1),[B,ge]=i.useState(null),l=i.useRef(0),re=i.useRef(new Map),k=i.useMemo(()=>s?x.trim().length>0:x.trim().length>0&&!m,[x,m,s]);i.useEffect(()=>{s||se((m==null?void 0:m.label)??"")},[m,s]),i.useEffect(()=>{const _=x.trim();if(!_||_.length<Ir){y([]),be(!1),K(Ya),ae(-1),oe(!1),ge(null);return}const le=_.toLowerCase(),we=`${a}:${n}:${le}`,Ne=re.current.get(we);if(Ne){if(s&&h.length>0){const Se=new Set(h.map(Fe=>Fe.id));y(Ne.filter(Fe=>!Se.has(Fe.id)))}else y(Ne);K(Ya),ae(-1),be(Ne.length>0),oe(!1),ge(null);return}const Re=window.setTimeout(async()=>{const Se=Date.now();l.current=Se,oe(!0),ge(null);try{const Fe=await Vr({libraryId:a,type:n,query:_,limit:Sr});if(l.current!==Se)return;const me=Fe.slice(0,Sr).map(Ve=>({id:Ve.infoId,label:Ve.label,infoType:Ve.infoType}));if(re.current.set(we,me),s&&h.length>0){const Ve=new Set(h.map(Ie=>Ie.id));y(me.filter(Ie=>!Ve.has(Ie.id)))}else y(me);K(Ya),ae(-1),be(!0)}catch{if(l.current!==Se)return;ge(q??"Search failed.")}finally{l.current===Se&&oe(!1)}},250);return()=>window.clearTimeout(Re)},[a,n,x,h]);const S=_=>{if(s){const le=h.some(we=>we.id===_.id)?h:[...h,_];F==null||F(le),se(""),be(!1),ae(-1);return}M==null||M(_),se(_.label),be(!1),ae(-1),J&&(Y==null||Y())},ve=async()=>{const _=x.trim();if(_){oe(!0),ge(null);try{const le=await Qa({libraryId:a,infoType:n,payload:{label:_}}),we={id:le.infoId,label:_,infoType:le.infoType};if(_.length>=Ir){const Ne=`${a}:${n}:${_.toLowerCase()}`,Re=re.current.get(Ne)??[];re.current.set(Ne,[we,...Re])}if(s){F==null||F([...h,we]),se(""),be(!1),ae(-1);return}M==null||M(we),be(!1),ae(-1),J&&(Y==null||Y())}catch{ge(c??"Create failed.")}finally{oe(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:d}),e.jsx("input",{value:x,placeholder:b,onChange:_=>{se(_.target.value),!s&&m&&(M==null||M(null))},onKeyDown:_=>{if(_.key==="ArrowDown"){if(_.preventDefault(),!V.length)return;be(!0),ae(le=>{const we=Math.min(V.length,Q)-1,Ne=le<0?0:Math.min(le+1,we);return Ne===we&&V.length>Q?(K(Re=>Math.min(Re+Ya,V.length)),Math.min(le+1,Math.min(V.length,Q+Ya)-1)):Ne});return}if(_.key==="ArrowUp"){if(_.preventDefault(),!V.length)return;be(!0),ae(le=>le<=0?0:le-1);return}if(_.key==="Enter"){if(_.preventDefault(),G>=0&&V[G]){S(V[G]);return}if(k){ve();return}}},onFocus:()=>{V.length>0&&be(!0)},autoComplete:"off",ref:H})]}),s&&h.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:h.map(_=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>F==null?void 0:F(h.filter(le=>le.id!==_.id)),children:[_.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},_.id))}),O&&e.jsx("p",{className:"cogita-help",children:O}),B&&e.jsx("p",{className:"cogita-error",children:B}),U&&V.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[V.slice(0,Q).map((_,le)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":le===G,onClick:()=>S(_),children:[e.jsx("strong",{children:_.label}),e.jsx("span",{children:_.infoType})]},_.id)),Q<V.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>K(_=>Math.min(_+Ya,V.length)),children:j??"Load more"})]}),k&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:ve,disabled:ke,children:ke?f??"Saving...":R??`Create new ${n}`})]})}function Hi({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c,mode:R}){const{libraryName:f}=Da(c),j=`/#/cogita/library/${c}`,[H,J]=i.useState("any"),[Y,s]=i.useState(""),[h,x]=i.useState([]),[se,V]=i.useState("idle"),[y,Q]=i.useState(null),[K,G]=i.useState(null),[ae,U]=i.useState("idle"),[be,ke]=i.useState(0),[oe,B]=i.useState(null),[ge,l]=i.useState("idle"),[re,k]=i.useState(null),[S,ve]=i.useState(null),[_,le]=i.useState(null),[we,Ne]=i.useState(null),Re=i.useMemo(()=>({languageAId:(re==null?void 0:re.id)??void 0,languageBId:(S==null?void 0:S.id)??void 0,topicId:(_==null?void 0:_.id)??void 0,levelId:(we==null?void 0:we.id)??void 0}),[re,S,_,we]),Se=i.useMemo(()=>H==="vocab"||H==="any",[H]);i.useEffect(()=>{V("loading");const Le=window.setTimeout(()=>{Cr({libraryId:c,type:H==="any"?void 0:H,query:Y.trim()||void 0,limit:30,languageAId:Se?Re.languageAId:void 0,languageBId:Se?Re.languageBId:void 0,topicId:Se?Re.topicId:void 0,levelId:Se?Re.levelId:void 0}).then(ee=>{x(ee.items),ke(ee.total),B(ee.nextCursor??null),V("ready"),Q(ee.items[0]??null)}).catch(()=>{x([]),ke(0),B(null),V("ready")})},240);return()=>window.clearTimeout(Le)},[c,Y,H,Se,Re]),i.useEffect(()=>{if(!y||y.cardType!=="info"||y.infoType!=="computed"){G(null),U("idle"),l("idle");return}U("loading"),gr({libraryId:c,infoId:y.cardId}).then(Le=>{G(Le),U("ready")}).catch(()=>{G(null),U("ready")})},[c,y]);const Fe=async()=>{if(oe){V("loading");try{const Le=await Cr({libraryId:c,type:H==="any"?void 0:H,query:Y.trim()||void 0,limit:30,cursor:oe,languageAId:Se?Re.languageAId:void 0,languageBId:Se?Re.languageBId:void 0,topicId:Se?Re.topicId:void 0,levelId:Se?Re.levelId:void 0});x(ee=>[...ee,...Le.items]),B(Le.nextCursor??null),ke(Le.total),V("ready")}catch{V("ready")}}},me=async()=>{if(!(!y||y.cardType!=="connection"&&y.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){l("loading");try{await mi({libraryId:c,connectionId:y.cardId});let ee=null;x(Te=>{const qe=Te.filter(Pe=>Pe.cardId!==y.cardId);return ee=qe[0]??null,qe}),ke(Te=>Math.max(0,Te-(y.cardType==="vocab"?3:1))),Q(Te=>Te&&Te.cardId===y.cardId?ee:Te),l("idle")}catch{l("error")}}},Ve=i.useMemo(()=>R==="collection"?"grid":R==="list"?"list":"detail",[R]),Ie=y?ue(y):null,We=i.useMemo(()=>zi(a),[a]),ia=i.useMemo(()=>{const Le=be||h.length;return a.cogita.library.list.cardCount.replace("{shown}",String(h.length)).replace("{total}",String(Le))},[a,h.length,be]);return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Ve,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${j}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(Le=>e.jsx("a",{className:"ghost","data-active":R===Le,href:`${j}/${Le}`,children:Le==="detail"?a.cogita.library.list.modes.detail:Le==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},Le))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:H,onChange:Le=>J(Le.target.value),children:We.map(Le=>e.jsx("option",{value:Le.value,children:Le.label},Le.value))}),e.jsx("input",{type:"text",value:Y,onChange:Le=>s(Le.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(H==="vocab"||H==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:re,onChange:k,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:S,onChange:ve,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:_,onChange:le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:we,onChange:Ne,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(re||S||_||we)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{k(null),ve(null),le(null),Ne(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ia}),e.jsx("span",{children:se==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":R==="collection"?"grid":"list",children:h.length?h.map(Le=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":Ie===ue(Le),onClick:()=>Q(Le),children:[e.jsx("div",{className:"cogita-card-type",children:Le.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:Le.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:Le.label}),e.jsx("p",{className:"cogita-card-subtitle",children:Le.description})]},ue(Le))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${j}/new`,children:a.cogita.library.list.addInfo})]})}),oe?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Fe,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(y==null?void 0:y.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(y==null?void 0:y.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${j}/edit/${y.cardId}`,children:a.cogita.library.list.editInfo}):null,(y==null?void 0:y.cardType)==="connection"||(y==null?void 0:y.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:me,disabled:ge==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${j}/new`,children:a.cogita.library.actions.addInfo})]})]}),y?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:y.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:y.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),ge==="error"&&(y.cardType==="connection"||y.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,y.cardType==="info"&&y.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),ae==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),ae!=="loading"&&K?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(Pt,{value:K.prompt,mode:"auto"}),K.expectedAnswers&&Object.keys(K.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(K.expectedAnswers).map(([Le,ee])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Le}),e.jsx(hr,{value:ee,mode:"auto"})]},Le))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(hr,{value:K.expectedAnswer,mode:"auto"})]})]}):ae!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Et=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],$r=8;function Rr({libraryId:a,copy:n,language:d,sourceKindOptions:b,value:m,onChange:M,labels:v}){const[F,O]=i.useState(!1),[q,c]=i.useState(-1),R=i.useMemo(()=>{const J=d;return Et.map(Y=>{var x;const s=(Y==null?void 0:Y[J])??(Y==null?void 0:Y.en)??(Y==null?void 0:Y.la);return{label:`${s.abbr} — ${s.name}`,latin:((x=Y==null?void 0:Y.la)==null?void 0:x.abbr)??s.abbr}})},[d]),f=(J,Y=!1)=>{const s=J.trim().toLowerCase();return s?R.filter(h=>h.label.toLowerCase().includes(s)).slice(0,$r):Y?R.slice(0,$r):[]},j=(J,Y)=>{const s=J.trim().toLowerCase();if(!s)return null;const h=Et;for(const x of h){const se=x==null?void 0:x.la,V=(x==null?void 0:x[Y])??(x==null?void 0:x.en)??se,y=(V==null?void 0:V.abbr)??"",Q=(V==null?void 0:V.name)??"";if(y.toLowerCase()===s||Q.toLowerCase()===s||`${y} — ${Q}`.toLowerCase()===s)return{book:x,entry:V,la:se}}return null};i.useEffect(()=>{if(m.sourceKind==="bible"&&m.locatorValue&&!F){const J=j(m.locatorValue,d);if(J){const Y=`${J.entry.abbr} — ${J.entry.name}`;Y!==m.bibleBookDisplay&&M({...m,bibleBookDisplay:Y})}}},[d,m,F,M]);const H=J=>M({...m,...J});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.sourceKindLabel}),e.jsx("select",{value:m.sourceKind,onChange:J=>H({sourceKind:J.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:b.map(J=>e.jsx("option",{value:J.value,children:J.label},J.value))})]}),m.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.bibleBookLabel}),e.jsx("input",{type:"text",value:m.bibleBookDisplay,onChange:J=>{const Y=J.target.value;H({bibleBookDisplay:Y,locatorValue:""}),O(!0),c(-1)},onKeyDown:J=>{var s;const Y=f(m.bibleBookDisplay);if(Y.length){if(J.key==="ArrowDown")J.preventDefault(),c(h=>Math.min(h+1,Y.length-1));else if(J.key==="ArrowUp")J.preventDefault(),c(h=>Math.max(h-1,0));else if((J.key==="Enter"||J.key==="Tab")&&q>=0&&Y[q]){const h=Y[q],x=j(h.label,d);if(!x)return;H({bibleBookDisplay:h.label,locatorValue:((s=x.la)==null?void 0:s.abbr)??m.locatorValue}),O(!1)}}},onFocus:()=>O(!0),onBlur:()=>window.setTimeout(()=>O(!1),100),placeholder:v.bibleBookPlaceholder})]}),F&&f(m.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:f(m.bibleBookDisplay,!0).map((J,Y)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":Y===q,tabIndex:-1,onMouseDown:()=>{var h;const s=j(J.label,d);s&&H({bibleBookDisplay:J.label,locatorValue:((h=s.la)==null?void 0:h.abbr)??m.locatorValue})},children:e.jsx("strong",{children:J.label})},J.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.bibleRestLabel}),e.jsx("input",{type:"text",value:m.locatorAux,onChange:J=>H({locatorAux:J.target.value}),placeholder:v.bibleRestPlaceholder})]})]}),m.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:m.sourceUrl,onChange:J=>H({sourceUrl:J.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:m.sourceAccessedDate,onChange:J=>H({sourceAccessedDate:J.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),m.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:a,infoType:"work",label:v.churchDocumentLabel,placeholder:v.churchDocumentPlaceholder,value:m.churchDocument,onChange:J=>H({churchDocument:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.locatorLabel}),e.jsx("input",{type:"text",value:m.locatorValue,onChange:J=>H({locatorValue:J.target.value}),placeholder:v.locatorPlaceholder})]})]}),m.sourceKind==="work"&&e.jsx(De,{libraryId:a,infoType:"work",label:v.workLabel,placeholder:v.workPlaceholder,value:m.work,onChange:J=>H({work:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),m.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:a,infoType:"media",label:v.bookLabel,placeholder:v.bookPlaceholder,value:m.bookMedia,onChange:J=>H({bookMedia:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.locatorLabel}),e.jsx("input",{type:"text",value:m.locatorValue,onChange:J=>H({locatorValue:J.target.value}),placeholder:v.locatorPlaceholder})]})]}),m.sourceKind!=="website"&&m.sourceKind!=="bible"&&m.sourceKind!=="book"&&m.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.locatorLabel}),e.jsx("input",{type:"text",value:m.locatorValue,onChange:J=>H({locatorValue:J.target.value}),placeholder:v.locatorPlaceholder})]})]})}const Ji=[],Yi=[];function Qi({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),d=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),b=a.handles.length,m=b>1?(b-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+m,paddingBottom:12+m*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),d?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((M,v)=>e.jsx(Nr,{type:"target",id:M.id,position:Lr.Left,style:{top:46+v*28},children:M.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:M.label}):null},M.id)),a.output!==!1?e.jsx(Nr,{type:"source",id:"out",position:Lr.Right}):null]})}function Gi({copy:a,value:n,onChange:d}){var Ve,Ie,We,ia,Le,ee,Te,qe,Pe,de,Ee,Ke,Oe,Ce;const b=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),m=L=>!L||L.nodes.length===0?Ji:L.nodes.map((N,z)=>{var t,r,u,T;return{id:N.id,type:"computed",position:N.position??{x:40+z*160,y:60+z%3*80},data:{title:N.name||((t=b[N.type])==null?void 0:t.label)||N.type,subtitle:((r=b[N.type])==null?void 0:r.label)||N.type,type:N.type,name:N.name,outputLabel:N.outputLabel,min:N.min,max:N.max,value:N.type==="input.const"?N.value:void 0,list:N.list,handles:((u=b[N.type])==null?void 0:u.handles)??[],output:((T=b[N.type])==null?void 0:T.output)??!0}}}),M=L=>{if(!L||L.nodes.length===0)return Yi;const N=new Set(L.nodes.map(r=>r.id)),z=[];let t=0;return L.nodes.forEach(r=>{const u=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(u).forEach(([T,g])=>{g.forEach(E=>{N.has(E)&&z.push({id:`${r.id}-${T}-${E}-${t++}`,source:E,target:r.id,targetHandle:T==="in"?void 0:T})})})}),z},v=i.useMemo(()=>m(n),[n,b]),F=i.useMemo(()=>M(n),[n]),O=(L,N)=>{if(!L)return"null";const z=L.nodes.map(r=>{const u=(r.list??[]).join(","),T=r.inputs?r.inputs.join(","):"",g=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([D,X])=>`${D}:${[...X].sort().join(",")}`).sort().join("|"):"",E=N&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",u,T,g,E].join(":")}).sort().join("||"),t=L.outputs?[...L.outputs].sort().join(","):L.output??"";return`${z}::${t}`},q=i.useMemo(()=>{var N;const L=!!((N=n==null?void 0:n.nodes)!=null&&N.some(z=>!!z.position));return O(n,L)},[n]),[c,R]=i.useState(v),[f,j]=i.useState(F),[H,J]=i.useState(null),[Y,s]=i.useState([]),[h,x]=i.useState(null),[se,V]=i.useState(null),[y,Q]=i.useState({}),[K,G]=i.useState(0),ae=i.useRef(d),U=i.useRef(q),be=i.useRef(q),ke=i.useRef(O(n,!1)),oe=i.useMemo(()=>H?c.find(L=>L.id===H)??null:null,[c,H]),B=i.useMemo(()=>{const L=["in1","in2","in3","in4","in5","in6"],N=new Map;return f.forEach(z=>{if(!z.target)return;const t=z.targetHandle??"in1";N.has(z.target)||N.set(z.target,new Set),N.get(z.target).add(t)}),c.map(z=>{var t;if(((t=z.data)==null?void 0:t.type)==="compute.concat"){const r=N.get(z.id)??new Set,u=[];let T=!1;return L.forEach(g=>{var E,D;if(r.has(g)||!T){const X=(D=(E=b["compute.concat"])==null?void 0:E.handles)==null?void 0:D.find(te=>te.id===g);X&&u.push(X),r.has(g)||(T=!0)}}),{...z,selected:z.id===H,data:{...z.data,handles:u}}}return{...z,selected:z.id===H}})},[c,H,f,b]);i.useEffect(()=>{x(null),V(null)},[H]),i.useEffect(()=>{if(Y.length===0)return;const L=N=>{if(N.key!=="Delete"&&N.key!=="Backspace")return;const z=N.target;z&&(z.tagName==="INPUT"||z.tagName==="TEXTAREA"||z.isContentEditable)||(N.preventDefault(),j(t=>t.filter(r=>!Y.includes(r.id))),s([]))};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[Y,j]),i.useEffect(()=>{ae.current=d},[d]),i.useEffect(()=>{if(U.current!==q){if(be.current===q||ke.current===q){U.current=q;return}U.current=q,R(v),j(F),J(null),x(null),V(null),Q({}),G(L=>L+1)}},[v,F,j,R,q]),i.useEffect(()=>{const L=c.filter(u=>{var T;return((T=u.data)==null?void 0:T.type)==="output"}).map(u=>u.id).sort(),N=new Map;f.forEach(u=>{let T=N.get(u.target);T||(T={},N.set(u.target,T));const g=u.targetHandle||"in";T[g]||(T[g]=[]),T[g].push(u.source)}),N.forEach(u=>{Object.values(u).forEach(T=>T.sort())});const z={nodes:c.map(u=>{var T,g,E,D,X,te,ne,xe,Qe;return{id:u.id,type:((T=u.data)==null?void 0:T.type)??"compute.add",position:u.position,name:(g=u.data)==null?void 0:g.name,outputLabel:(E=u.data)==null?void 0:E.outputLabel,min:(D=u.data)==null?void 0:D.min,max:(X=u.data)==null?void 0:X.max,value:((te=u.data)==null?void 0:te.type)==="input.const"?(ne=u.data)==null?void 0:ne.value:void 0,list:(xe=u.data)==null?void 0:xe.list,inputs:(Qe=N.get(u.id))==null?void 0:Qe.in,inputsByHandle:N.get(u.id)}}),output:L[0]??null,outputs:L},t=O(z,!0),r=O(z,!1);t===be.current||r===ke.current||(be.current=t,ke.current=r,ae.current(z))},[c,f]),i.useEffect(()=>{const L={};let N=!1;c.forEach(z=>{var g,E,D,X,te;if(((g=z.data)==null?void 0:g.type)!=="input.random")return;if(y[z.id]!==void 0){L[z.id]=y[z.id];return}const t=Number.isFinite((E=z.data)==null?void 0:E.min)?Number((D=z.data)==null?void 0:D.min):0,r=Number.isFinite((X=z.data)==null?void 0:X.max)?Number((te=z.data)==null?void 0:te.max):t+10,u=Math.min(t,r),T=Math.max(t,r);L[z.id]=Math.floor(Math.random()*(T-u+1))+u,N=!0}),(N||Object.keys(L).length!==Object.keys(y).length)&&Q(L)},[c,y,K]);const ge=i.useMemo(()=>c.map(N=>{var t,r,u,T,g;const z=(((t=N.data)==null?void 0:t.list)??[]).join(",");return[N.id,((r=N.data)==null?void 0:r.type)??"",((u=N.data)==null?void 0:u.name)??"",((T=N.data)==null?void 0:T.min)??"",((g=N.data)==null?void 0:g.max)??"",z].join(":")}).sort().join("|"),[c]),l=i.useMemo(()=>f.map(N=>`${N.source}:${N.target}:${N.targetHandle??""}`).sort().join("|"),[f]),re=i.useMemo(()=>{const L=new Map(c.map(D=>[D.id,D])),N=new Map;f.forEach(D=>{let X=N.get(D.target);X||(X={},N.set(D.target,X));const te=D.targetHandle||"in";X[te]||(X[te]=[]),X[te].push(D.source)});const z=new Map,t=new Set,r=D=>{if(typeof D=="number")return D;if(typeof D=="string"){const X=Number(D);return Number.isFinite(X)?X:0}return 0},u=(D,X)=>{var te,ne;return X?((te=N.get(D.id))==null?void 0:te[X])??[]:((ne=N.get(D.id))==null?void 0:ne.in)??[]},T=(D,X)=>u(D,X).map(te=>r(E(te))),g=(D,X)=>u(D,X).map(te=>E(te)),E=D=>{var xe,Qe,ze,Ze;if(z.has(D))return z.get(D);if(t.has(D))return 0;const X=L.get(D);if(!X)return 0;t.add(D);const te=((xe=X.data)==null?void 0:xe.type)??"";let ne=0;switch(te){case"input.random":{ne=y[D]??0;break}case"input.const":{ne=Number.isFinite((Qe=X.data)==null?void 0:Qe.value)?Number((ze=X.data)==null?void 0:ze.value):0;break}case"input.list":{const Be=(((Ze=X.data)==null?void 0:Ze.list)??[]).filter(Boolean),Ue=Math.round(T(X,"index")[0]??0);ne=(Be.length?Be[Math.max(0,Math.min(Be.length-1,Ue))]:"")||String(Ue);break}case"compute.add":{ne=T(X,"in").reduce((Be,Ue)=>Be+Ue,0);break}case"compute.sub":{ne=T(X,"add").reduce((Be,Ue)=>Be+Ue,0)-T(X,"sub").reduce((Be,Ue)=>Be+Ue,0);break}case"compute.mul":{const Be=T(X,"in");ne=Be.length?Be.reduce((Ue,Ae)=>Ue*Ae,1):0;break}case"compute.div":{const Be=T(X,"num")[0]??0,Ue=T(X,"den").reduce((Ae,Ge)=>Ae+Ge,0);ne=Math.abs(Ue)<Number.EPSILON?0:Be/Ue;break}case"compute.pow":{const Be=T(X,"base")[0]??0,Ue=T(X,"exp")[0]??0;ne=Math.pow(Be,Ue);break}case"compute.exp":{const Be=T(X,"base")[0]??0,Ue=T(X,"exp")[0]??0;ne=Math.pow(Be,Ue);break}case"compute.log":{const Be=T(X,"value")[0]??0,Ue=T(X,"base")[0]??0,Ae=Math.max(Be,Number.EPSILON);ne=Math.abs(Ue)<Number.EPSILON?Math.log(Ae):Math.log(Ae)/Math.log(Ue);break}case"compute.abs":{ne=Math.abs(T(X,"in")[0]??0);break}case"compute.min":{const Be=T(X,"in");ne=Be.length?Math.min(...Be):0;break}case"compute.max":{const Be=T(X,"in");ne=Be.length?Math.max(...Be):0;break}case"compute.floor":{ne=Math.floor(T(X,"in")[0]??0);break}case"compute.ceil":{ne=Math.ceil(T(X,"in")[0]??0);break}case"compute.round":{ne=Math.round(T(X,"in")[0]??0);break}case"compute.mod":{const Be=T(X,"a")[0]??0,Ue=T(X,"b")[0]??0;ne=Math.abs(Ue)<Number.EPSILON?0:Be%Ue;break}case"compute.concat":{const Ue=["in1","in2","in3","in4","in5","in6"].flatMap(Xe=>g(X,Xe)),Ae=Ue.length?Ue:g(X,"in");ne=(Ae.length?Ae:g(X)).map(Xe=>Xe==null?"":String(Xe)).join("");break}case"compute.trim":{const Be=g(X,"text")[0]??g(X,"in")[0]??"",Ue=Be==null?"":String(Be),Ae=Math.max(0,Math.round(T(X,"start")[0]??0)),Ge=Math.max(0,Math.round(T(X,"end")[0]??0));ne=Ae+Ge>=Ue.length?"":Ue.substring(Ae,Ue.length-Ge);break}case"output":{const Be=u(X,"in")[0];ne=Be?E(Be):0;break}default:ne=0}return t.delete(D),z.set(D,ne),ne};return c.forEach(D=>E(D.id)),z},[ge,l,y]),k=i.useRef(re);i.useEffect(()=>{k.current=re},[re]);const S=i.useCallback(L=>{const N=k.current.get(L.id);return e.jsx(Qi,{data:{...L.data,value:N}})},[]),ve=i.useMemo(()=>({computed:S}),[S]),_=L=>{var r;if(!L.target||!L.targetHandle){j(u=>yt(L,u));return}const N=c.find(u=>u.id===L.target),z=N?b[((r=N.data)==null?void 0:r.type)??""]:null,t=z==null?void 0:z.handles.find(u=>u.id===L.targetHandle);j(u=>{let T=u;return t!=null&&t.limitOne&&(T=u.filter(g=>!(g.target===L.target&&g.targetHandle===L.targetHandle))),yt(L,T)})},le=L=>{const N=crypto.randomUUID(),z=b[L]??{label:L,handles:[]},t=z.label;R(r=>[...r,{id:N,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:z.label,type:L,name:"",handles:z.handles,list:L==="input.list"?[]:void 0,output:z.output??!0}}])},we=L=>{if(H){if(L.name!==void 0){const N=L.name.trim(),z=N===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(N);if(V(z?null:a.cogita.library.graph.invalidName),!N)x(null);else{const t=c.find(r=>{var u;return r.id!==H&&((u=r.data)==null?void 0:u.name)&&r.data.name.trim().toLowerCase()===N.toLowerCase()});x(t?a.cogita.library.graph.duplicateName:null)}}R(N=>N.map(z=>{var t,r,u,T;return z.id===H?{...z,data:{...z.data,...L,title:L.name?L.name:(t=z.data)==null?void 0:t.title,subtitle:((u=b[L.type??((r=z.data)==null?void 0:r.type)??""])==null?void 0:u.label)??((T=z.data)==null?void 0:T.subtitle)}}:z}))}},Ne=()=>{H&&(R(L=>L.filter(N=>N.id!==H)),j(L=>L.filter(N=>N.source!==H&&N.target!==H)),Q(L=>{const N={...L};return delete N[H],N}),J(null),x(null))},Re=i.useRef({nodeId:null,edgeIds:[]}),Se=L=>{var T;const N=((T=L.nodes[0])==null?void 0:T.id)??null,z=L.edges.map(g=>g.id),t=Re.current,r=t.nodeId===N,u=t.edgeIds.length===z.length&&t.edgeIds.every((g,E)=>g===z[E]);r&&u||(Re.current={nodeId:N,edgeIds:z},J(N),s(z))},Fe=L=>{const N=L.filter(z=>z.type!=="select"&&z.type!=="dimensions");N.length!==0&&R(z=>si(N,z))},me=L=>{const N=L.filter(z=>z.type!=="select");N.length!==0&&j(z=>oi(N,z))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(_t,{nodeTypes:ve,nodes:B,edges:f,onNodesChange:Fe,onEdgesChange:me,onConnect:_,onNodeClick:(L,N)=>J(N.id),onSelectionChange:Se,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(Ut,{gap:18,size:1}),e.jsx(Wt,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>le("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>le("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>le("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>le("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>le("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>le("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>le("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>le("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>le("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>le("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>le("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>le("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>le("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>le("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>le("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>le("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>le("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>le("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>le("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>le("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),oe?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Ve=oe.data)==null?void 0:Ve.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:L=>we({name:L.target.value})}),h?e.jsx("em",{className:"cogita-help",children:h}):null,se?e.jsx("em",{className:"cogita-help",children:se}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((We=b[((Ie=oe.data)==null?void 0:Ie.type)??""])==null?void 0:We.label)??((ia=oe.data)==null?void 0:ia.type)]}),((Le=oe.data)==null?void 0:Le.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((ee=oe.data)==null?void 0:ee.outputLabel)??"",onChange:L=>we({outputLabel:L.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((Te=oe.data)==null?void 0:Te.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((qe=oe.data)==null?void 0:qe.min)??0,onChange:L=>we({min:Number(L.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Pe=oe.data)==null?void 0:Pe.max)??10,onChange:L=>we({max:Number(L.target.value)})})]})]}),((de=oe.data)==null?void 0:de.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:((Ee=oe.data)==null?void 0:Ee.value)??0,onChange:L=>we({value:Number(L.target.value)})})]}),((Ke=oe.data)==null?void 0:Ke.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Oe=oe.data)==null?void 0:Oe.list)??[]).join(`
`),onChange:L=>we({list:L.target.value.split(`
`).map(N=>N.replace(/\r$/,"")).filter(N=>N.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((Ce=oe.data)==null?void 0:Ce.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{H&&(Q(L=>{var u,T,g,E;const N=Number.isFinite((u=oe.data)==null?void 0:u.min)?Number((T=oe.data)==null?void 0:T.min):0,z=Number.isFinite((g=oe.data)==null?void 0:g.max)?Number((E=oe.data)==null?void 0:E.max):N+10,t=Math.min(N,z),r=Math.max(N,z);return{...L,[H]:Math.floor(Math.random()*(r-t+1))+t}}),G(L=>L+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Ne,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const ir=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function yr(a,n,d){if(!a)return null;const b=new Map(a.nodes.map(V=>[V.id,V])),m=new Map,M=new Set,v=V=>{if(typeof V=="number")return V;if(typeof V=="string"){const y=Number(V);return Number.isFinite(y)?y:0}return 0},F=V=>{if(m.has(V))return m.get(V);if(M.has(V))return 0;const y=b.get(V);if(!y)return 0;M.add(V);const Q=G=>{var U,be;return(G?((U=y.inputsByHandle)==null?void 0:U[G])??[]:y.inputs??((be=y.inputsByHandle)==null?void 0:be.in)??[]).map(ke=>F(ke))};let K=0;switch(y.type){case"input.random":{const G=y.min??0,ae=y.max??G+10,U=Math.min(G,ae),be=Math.max(G,ae);K=Math.floor(Math.random()*(be-U+1))+U;break}case"input.const":{K=y.value??0;break}case"input.list":{const G=(y.list??[]).filter(Boolean),ae=Math.round(v(Q("index")[0]));K=G.length?G[Math.max(0,Math.min(G.length-1,ae))]:String(ae);break}case"compute.add":{K=Q("in").map(ae=>v(ae)).reduce((ae,U)=>ae+U,0);break}case"compute.sub":{const G=Q("add").map(U=>v(U)),ae=Q("sub").map(U=>v(U));K=G.reduce((U,be)=>U+be,0)-ae.reduce((U,be)=>U+be,0);break}case"compute.mul":{const G=Q("in").map(ae=>v(ae));K=G.length?G.reduce((ae,U)=>ae*U,1):0;break}case"compute.div":{const G=v(Q("num")[0]),ae=Q("den").map(U=>v(U)).reduce((U,be)=>U+be,0);K=Math.abs(ae)<Number.EPSILON?0:G/ae;break}case"compute.pow":{const G=v(Q("base")[0]),ae=v(Q("exp")[0]);K=Math.pow(G,ae);break}case"compute.exp":{const G=v(Q("base")[0]),ae=v(Q("exp")[0]);K=Math.pow(G,ae);break}case"compute.log":{const G=v(Q("value")[0]),ae=v(Q("base")[0]),U=Math.max(G,Number.EPSILON);K=Math.abs(ae)<Number.EPSILON?Math.log(U):Math.log(U)/Math.log(ae);break}case"compute.abs":{K=Math.abs(v(Q("in")[0]));break}case"compute.min":{const G=Q("in").map(ae=>v(ae));K=G.length?Math.min(...G):0;break}case"compute.max":{const G=Q("in").map(ae=>v(ae));K=G.length?Math.max(...G):0;break}case"compute.floor":{K=Math.floor(v(Q("in")[0]));break}case"compute.ceil":{K=Math.ceil(v(Q("in")[0]));break}case"compute.round":{K=Math.round(v(Q("in")[0]));break}case"compute.mod":{const G=v(Q("a")[0]),ae=v(Q("b")[0]);K=Math.abs(ae)<Number.EPSILON?0:G%ae;break}case"compute.concat":{const ae=["in1","in2","in3","in4","in5","in6"].flatMap(oe=>Q(oe)),U=ae.length?ae:Q("in");K=(U.length?U:Q()).map(oe=>oe==null?"":String(oe)).join("");break}case"compute.trim":{const G=Q("text")[0]??Q("in")[0]??"",ae=G==null?"":String(G),U=Math.max(0,Math.round(v(Q("start")[0]))),be=Math.max(0,Math.round(v(Q("end")[0])));U+be>=ae.length?K="":K=ae.substring(U,ae.length-be);break}case"output":{K=Q("in")[0]??0;break}default:K=0}return M.delete(V),m.set(V,K),K},O=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(V=>V.type==="output").map(V=>V.id);a.nodes.forEach(V=>F(V.id)),O.forEach(V=>F(V));const q=V=>Math.abs(V%1)<1e-5?String(Math.round(V)):V.toFixed(3).replace(/\.?0+$/,""),c=V=>typeof V=="number"?q(V):V??"",R=new Map;O.forEach(V=>{var ae,U,be,ke;const y=b.get(V);if(!y)return;const Q=(U=(ae=y.inputsByHandle)==null?void 0:ae.name)==null?void 0:U[0],K=Q?c(m.get(Q)):"",G=(K==null?void 0:K.toString().trim())||((be=y.outputLabel)==null?void 0:be.trim())||((ke=y.name)==null?void 0:ke.trim())||V;R.set(V,G)});const f={},j={},H={};O.forEach(V=>{var K,G;const y=b.get(V);if(!y)return;const Q=R.get(V)??(((K=y.outputLabel)==null?void 0:K.trim())||((G=y.name)==null?void 0:G.trim())||V);f[Q]=c(m.get(V)),y.name&&(j[y.name.trim()]=Q),j[V]=Q});const J=(V,y)=>{let Q=V;return a.nodes.forEach(K=>{var ke,oe;const G=c(m.get(K.id)),ae=O.includes(K.id),U=ae?R.get(K.id)??((ke=K.outputLabel)==null?void 0:ke.trim())??((oe=K.name)==null?void 0:oe.trim())??K.id:"",be=ae&&y?U:G;Q=Q.replace(new RegExp(`\\{\\s*${ir(K.id)}\\s*\\}`,"gi"),be),K.name&&(Q=Q.replace(new RegExp(`\\{\\s*${ir(K.name)}\\s*\\}`,"gi"),be)),ae&&K.outputLabel&&(Q=Q.replace(new RegExp(`\\{\\s*${ir(K.outputLabel)}\\s*\\}`,"gi"),U))}),Q},Y=n;let s=Y.trim().length>0?Y:"";s||(s=O.length?`Compute ${O.join(", ")}`:"Compute"),s=J(s,!0);const h=(d==null?void 0:d.trim())??"",x=h?J(h,!1):"",se={};return m.forEach((V,y)=>{se[y]=V,H[y]=c(V);const Q=b.get(y);Q!=null&&Q.name&&(H[Q.name.trim()]=c(V))}),{prompt:s,answers:f,values:se,answerText:x,outputVariables:j,variableValues:H}}function Yr(a){var d;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((d=n[0])==null?void 0:d[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function Xi({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c,editInfoId:R}){const{libraryName:f}=Da(c),j=!!R,H=`/#/cogita/library/${c}`,[J,Y]=i.useState("info"),[s,h]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[x,se]=i.useState(""),[V,y]=i.useState(null),[Q,K]=i.useState(null),[G,ae]=i.useState("idle"),[U,be]=i.useState(null),[ke,oe]=i.useState(-1),[B,ge]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[l,re]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[k,S]=i.useState(null),[ve,_]=i.useState("idle"),[le,we]=i.useState(null),[Ne,Re]=i.useState(null),[Se,Fe]=i.useState(null),me=i.useRef(null),Ve=i.useRef(null),Ie=i.useRef(null),We=i.useMemo(()=>Jr(a),[a]),ia=i.useMemo(()=>Ui(a),[a]),Le=i.useMemo(()=>Wi(a),[a]),ee=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),Te=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),qe=i.useMemo(()=>We.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[We]),Pe=i.useMemo(()=>{const t=O;return Et.map(r=>{var g;const u=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${u.abbr} — ${u.name}`,latin:((g=r==null?void 0:r.la)==null?void 0:g.abbr)??u.abbr}})},[O]),de=(t,r=!1)=>{const u=t.trim().toLowerCase();return u?Pe.filter(T=>T.label.toLowerCase().includes(u)).slice(0,8):r?Pe.slice(0,8):[]},Ee=(t,r)=>{const u=t.trim().toLowerCase();if(!u)return null;const T=Et;for(const g of T){const E=g==null?void 0:g.la,D=(g==null?void 0:g[r])??(g==null?void 0:g.en)??E;if([D==null?void 0:D.abbr,D==null?void 0:D.name,E==null?void 0:E.abbr,E==null?void 0:E.name,`${D==null?void 0:D.abbr} — ${D==null?void 0:D.name}`].filter(Boolean).map(te=>te.toLowerCase()).some(te=>te===u))return{book:g,entry:D,la:E}}return null};i.useEffect(()=>{if(!B.language||!B.word){we(null);return}const t=window.setTimeout(()=>{rr({libraryId:c,languageId:B.language.id,wordId:B.word.id}).then(r=>{we(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{we(null)})},200);return()=>window.clearTimeout(t)},[c,B.language,B.word]),i.useEffect(()=>{if(!l.languageA||!l.wordA){Re(null);return}const t=window.setTimeout(()=>{rr({libraryId:c,languageId:l.languageA.id,wordId:l.wordA.id}).then(r=>{Re(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Re(null)})},200);return()=>window.clearTimeout(t)},[c,l.languageA,l.wordA]),i.useEffect(()=>{if(!l.languageB||!l.wordB){Fe(null);return}const t=window.setTimeout(()=>{rr({libraryId:c,languageId:l.languageB.id,wordId:l.wordB.id}).then(r=>{Fe(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Fe(null)})},200);return()=>window.clearTimeout(t)},[c,l.languageB,l.wordB]),i.useEffect(()=>{if(!j||!R)return;let t=!1;return _("loading"),S(null),tt({libraryId:c,infoId:R}).then(async r=>{var T,g;if(t)return;const u=r.payload??{};if(h(E=>({...E,infoType:r.infoType,label:u.label??"",notes:u.notes??"",language:u.languageId?{id:u.languageId,label:u.languageId,infoType:"language"}:null,sourceKind:u.sourceKind??"string",sourceResourceType:E.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:u.text??"",workLanguage:u.languageId?{id:u.languageId,label:u.languageId,infoType:"language"}:null,workOriginalLanguage:u.originalLanguageId?{id:u.originalLanguageId,label:u.originalLanguageId,infoType:"language"}:null,workDoi:u.doi??"",mediaType:u.mediaType??"book",mediaPublisher:u.publisher??"",mediaPublicationPlace:u.publicationPlace??"",mediaPublicationYear:u.publicationYear??"",mediaPages:u.pages??"",mediaIsbn:u.isbn??"",mediaCover:u.cover??"",mediaHeight:u.height??"",mediaLength:u.length??"",mediaWidth:u.width??"",mediaWeight:u.weight??"",mediaCollection:u.collection??"",mediaLocation:u.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&u.locator&&typeof u.locator=="object"){const E=u.locator;if(u.sourceKind==="website")h(D=>({...D,sourceUrl:typeof E.url=="string"?E.url:"",sourceAccessedDate:typeof E.date=="string"?E.date:""}));else if(u.sourceKind==="bible"){const D=typeof E.book=="string"?E.book:"",X=D?Ee(D,O):null,te=X?`${X.entry.abbr} — ${X.entry.name}`:D;h(ne=>({...ne,sourceLocatorValue:D,sourceLocatorAux:typeof E.rest=="string"?E.rest:"",sourceBibleBookDisplay:te}))}else u.sourceKind==="book"?h(D=>({...D,sourceLocatorValue:typeof E.page=="string"?E.page:""})):u.sourceKind==="number_document"?h(D=>({...D,sourceLocatorValue:typeof E.number=="string"?E.number:""})):typeof E.text=="string"&&h(D=>({...D,sourceLocatorValue:E.text}))}if(u.languageId&&r.infoType!=="work")try{const E=await tt({libraryId:c,infoId:u.languageId});if(t)return;h(D=>{var X;return{...D,language:{id:u.languageId,label:((X=E.payload)==null?void 0:X.label)??u.languageId,infoType:"language"}}})}catch{}if(u.languageId&&r.infoType==="work")try{const E=await tt({libraryId:c,infoId:u.languageId});if(t)return;h(D=>{var X;return{...D,workLanguage:{id:u.languageId,label:((X=E.payload)==null?void 0:X.label)??u.languageId,infoType:"language"}}})}catch{}if(u.originalLanguageId)try{const E=await tt({libraryId:c,infoId:u.originalLanguageId});if(t)return;h(D=>{var X;return{...D,workOriginalLanguage:{id:u.originalLanguageId,label:((X=E.payload)==null?void 0:X.label)??u.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(se(((T=u.definition)==null?void 0:T.answerTemplate)??""),y(((g=u.definition)==null?void 0:g.graph)??null),K(null),ae("idle")):(se(""),y(null),K(null),ae("idle")),Y("info")}).catch(()=>{t||S(a.cogita.library.add.info.failed)}).finally(()=>{t||_("idle")}),()=>{t=!0}},[a,R,j,c]),i.useEffect(()=>{if(s.sourceKind==="bible"&&s.sourceLocatorValue&&U!=="source"){const t=Ee(s.sourceLocatorValue,O);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==s.sourceBibleBookDisplay&&h(u=>({...u,sourceBibleBookDisplay:r}))}}},[O,s.sourceKind,s.sourceLocatorValue,s.sourceBibleBookDisplay]);const Ke=async()=>{var t,r;S(null);try{const u={label:s.infoType==="quote"||s.infoType==="source"?"":s.label,notes:s.infoType==="computed"?"":s.notes};if(s.language&&(s.infoType==="word"||s.infoType==="sentence")&&(u.languageId=s.language.id),s.infoType==="source"&&(u.sourceKind=s.sourceKind,s.sourceKind==="website"?u.locator={url:s.sourceUrl.trim(),date:s.sourceAccessedDate.trim()}:s.sourceKind==="bible"?u.locator={book:s.sourceLocatorValue.trim(),rest:s.sourceLocatorAux.trim()}:s.sourceKind==="book"?u.locator={page:s.sourceLocatorValue.trim()}:s.sourceKind==="number_document"?u.locator={number:s.sourceLocatorValue.trim()}:u.locator={text:s.sourceLocatorValue.trim()}),s.infoType==="quote"&&(u.text=s.quoteText),s.infoType==="work"&&(u.languageId=((t=s.workLanguage)==null?void 0:t.id)??null,u.originalLanguageId=((r=s.workOriginalLanguage)==null?void 0:r.id)??null,u.doi=s.workDoi.trim()),s.infoType==="media"&&(u.mediaType=s.mediaType,u.publisher=s.mediaPublisher.trim(),u.publicationPlace=s.mediaPublicationPlace.trim(),u.publicationYear=s.mediaPublicationYear.trim(),u.pages=s.mediaPages.trim(),u.isbn=s.mediaIsbn.trim(),u.cover=s.mediaCover.trim(),u.height=s.mediaHeight.trim(),u.length=s.mediaLength.trim(),u.width=s.mediaWidth.trim(),u.weight=s.mediaWeight.trim(),u.collection=s.mediaCollection.trim(),u.location=s.mediaLocation.trim()),s.infoType==="computed"){if(!V){S(a.cogita.library.add.info.computedRequired);return}if(!x.trim()){S(a.cogita.library.add.info.computedAnswerRequired);return}if(V.nodes.find(ne=>ne.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(ne.name))){S(a.cogita.library.add.info.computedInvalidName);return}const g=V.nodes.map(ne=>{var xe;return(xe=ne.name)==null?void 0:xe.trim()}).filter(Boolean),E=new Set;for(const ne of g){const xe=ne.toLowerCase();if(E.has(xe)){S(a.cogita.library.add.info.computedDuplicateName);return}E.add(xe)}const D=V.nodes.filter(ne=>ne.type==="output"),X=D.map(ne=>{var xe;return(xe=ne.name)==null?void 0:xe.trim()}).filter(Boolean);if(X.length!==D.length){S(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!X.every(ne=>new RegExp(`\\{\\s*${ne}\\s*\\}`,"i").test(x))){S(a.cogita.library.add.info.computedAnswerMissingOutput);return}u.definition={answerTemplate:x,graph:V}}if(j&&R)_("saving"),await pi({libraryId:c,infoId:R,payload:u}),S(a.cogita.library.add.info.updated),_("idle");else{let T=null;if(s.referenceEnabled){const ne={sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},{payload:xe,resourceInfoId:Qe,error:ze}=Oe(ne);if(ze){S(a.cogita.library.add.info.referenceMissingSource);return}T={payload:xe,resourceInfoId:Qe}}const g=await Qa({libraryId:c,infoType:s.infoType,payload:u});if(s.infoType==="source"&&s.sourceResource&&await ra({libraryId:c,connectionType:"source-resource",infoIds:[g.infoId,s.sourceResource.id]}),s.infoType==="quote"&&s.language&&await ra({libraryId:c,connectionType:"quote-language",infoIds:[g.infoId,s.language.id]}),T){const ne=await Qa({libraryId:c,infoType:"source",payload:T.payload});T.resourceInfoId&&await ra({libraryId:c,connectionType:"source-resource",infoIds:[ne.infoId,T.resourceInfoId]}),await ra({libraryId:c,connectionType:"reference",infoIds:[g.infoId,ne.infoId]})}S(a.cogita.library.add.info.saved);const E=s.infoType==="word"||s.infoType==="sentence",D=s.referenceEnabled,X=s.referenceSourceKind,te={referenceEnabled:D,referenceSourceKind:D?X:"string",referenceSourceUrl:D&&X==="website"?s.referenceSourceUrl:"",referenceSourceAccessedDate:D&&X==="website"?s.referenceSourceAccessedDate:"",referenceChurchDocument:D&&X==="number_document"?s.referenceChurchDocument:null,referenceBookMedia:D&&X==="book"?s.referenceBookMedia:null,referenceWork:D&&X==="work"?s.referenceWork:null,referenceLocatorValue:D&&X==="bible"?s.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:D&&X==="bible"?s.referenceBibleBookDisplay:""};h({infoType:s.infoType,label:"",language:E?s.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:s.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...te}),s.infoType==="computed"&&(se(""),y(null),K(null),ae("idle"))}}catch{S(a.cogita.library.add.info.failed)}},Oe=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const u={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(u.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:u,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(u.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:u,resourceInfoId:r}):(t.sourceKind==="book"?u.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?u.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(u.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:u,resourceInfoId:r})},Ce=()=>{if(ae("idle"),!V){K(null),ae("error");return}const t=yr(V,"",x);if(!t){K(null),ae("error");return}K({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),ae("ready")},L=async()=>{S(null);try{if(B.connectionType==="reference"){if(!B.referencedInfo||!B.source){S(a.cogita.library.add.connection.selectReference);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.referencedInfo.id,B.source.id]})}else if(B.connectionType==="source-resource"){if(!B.source||!B.sourceResource){S(a.cogita.library.add.connection.selectSourceResource);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.source.id,B.sourceResource.id]})}else if(B.connectionType==="quote-language"){if(!B.quote||!B.language){S(a.cogita.library.add.connection.selectQuoteLanguage);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.quote.id,B.language.id]})}else if(B.connectionType==="work-contributor"){if(!B.work||!B.contributor||!B.contributorRole.trim()){S(a.cogita.library.add.connection.selectWorkContributor);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.work.id,B.contributor.id],payload:{role:B.contributorRole.trim()}})}else if(B.connectionType==="work-medium"){if(!B.work||!B.medium){S(a.cogita.library.add.connection.selectWorkMedium);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.work.id,B.medium.id]})}else if(B.connectionType==="orcid-link"){if(!B.orcidEntity||!B.orcid){S(a.cogita.library.add.connection.selectOrcidLink);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.orcidEntity.id,B.orcid.id]})}else if(B.connectionType==="word-language"){if(!B.language||!B.word){S(a.cogita.library.add.connection.selectWordLanguage);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.language.id,B.word.id],payload:{note:B.note}})}else if(B.connectionType==="word-topic"){if(!B.word||!B.topic){S(a.cogita.library.add.connection.selectWordTopic);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.word.id,B.topic.id],payload:{note:B.note}})}else if(B.connectionType==="translation"){if(!B.wordA||!B.wordB){S(a.cogita.library.add.connection.selectTwoWords);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.wordA.id,B.wordB.id],payload:{note:B.note}})}else if(B.connectionType==="language-sentence"){if(!B.language||!B.sentence){S(a.cogita.library.add.connection.selectLanguageSentence);return}await ra({libraryId:c,connectionType:B.connectionType,infoIds:[B.language.id,B.sentence.id],payload:{note:B.note}})}S(a.cogita.library.add.connection.saved),ge(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{S(a.cogita.library.add.connection.failed)}},N=async()=>{var t,r;S(null);try{if(l.groupType==="citation"){const T=l.citationTitle.trim(),g=l.citationQuoteText.trim();if(!g){S(a.cogita.library.add.group.citationMissingQuote);return}let E=null;if(l.citationReferenceEnabled){const te={sourceKind:l.citationSourceKind,locatorValue:l.citationLocatorValue,locatorAux:l.citationLocatorAux,bibleBookDisplay:l.citationBibleBookDisplay,sourceUrl:l.citationSourceUrl,sourceAccessedDate:l.citationSourceAccessedDate,churchDocument:l.citationChurchDocument,bookMedia:l.citationBookMedia,work:l.citationWork},{payload:ne,resourceInfoId:xe,error:Qe}=Oe(te);if(Qe){S(a.cogita.library.add.info.referenceMissingSource);return}E={payload:ne,resourceInfoId:xe}}const D={text:g};T&&(D.title=T);const X=await Qa({libraryId:c,infoType:"quote",payload:D});if(l.citationLanguage&&await ra({libraryId:c,connectionType:"quote-language",infoIds:[X.infoId,l.citationLanguage.id]}),E){const te=await Qa({libraryId:c,infoType:"source",payload:E.payload});E.resourceInfoId&&await ra({libraryId:c,connectionType:"source-resource",infoIds:[te.infoId,E.resourceInfoId]}),await ra({libraryId:c,connectionType:"reference",infoIds:[X.infoId,te.infoId]})}S(a.cogita.library.add.group.savedCitation),re(te=>({...te,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:te.citationReferenceEnabled,citationSourceKind:te.citationReferenceEnabled?te.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:te.citationReferenceEnabled?te.citationChurchDocument:null,citationBookMedia:te.citationReferenceEnabled?te.citationBookMedia:null,citationWork:te.citationReferenceEnabled?te.citationWork:null}));return}if(l.groupType==="book"){const T=l.bookTitle.trim();if(!T){S(a.cogita.library.add.group.bookMissingTitle);return}const g=l.bookWorkTitle.trim();if(!g){S(a.cogita.library.add.group.bookMissingWork);return}if(l.bookContributors.find(ne=>ne.contributor&&!ne.role.trim()||!ne.contributor&&ne.role.trim())){S(a.cogita.library.add.group.bookMissingContributor);return}const D=await Qa({libraryId:c,infoType:"media",payload:{label:T,mediaType:"book",publisher:l.bookPublisher.trim(),publicationPlace:l.bookPublicationPlace.trim(),publicationYear:l.bookPublicationYear.trim(),pages:l.bookPages.trim(),isbn:l.bookIsbn.trim(),cover:l.bookCover.trim(),height:l.bookHeight.trim(),length:l.bookLength.trim(),width:l.bookWidth.trim(),weight:l.bookWeight.trim(),collection:l.bookCollection.trim(),location:l.bookLocation.trim()}}),X=await Qa({libraryId:c,infoType:"work",payload:{label:g,languageId:((t=l.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=l.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:l.bookWorkDoi.trim()}});await ra({libraryId:c,connectionType:"work-medium",infoIds:[X.infoId,D.infoId]});const te=l.bookContributors.filter(ne=>ne.contributor&&ne.role.trim());for(const ne of te)await ra({libraryId:c,connectionType:"work-contributor",infoIds:[X.infoId,ne.contributor.id],payload:{role:ne.role.trim()}});S(a.cogita.library.add.group.savedBook),re(ne=>({...ne,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!l.languageA||!l.wordA||!l.languageB||!l.wordB){S(a.cogita.library.add.group.selectBoth);return}const u=T=>Array.from(new Map(T.map(g=>[g.id,g])).values());Ne||await ra({libraryId:c,connectionType:"word-language",infoIds:[l.languageA.id,l.wordA.id]}),Se||await ra({libraryId:c,connectionType:"word-language",infoIds:[l.languageB.id,l.wordB.id]});for(const T of u(l.wordATags))await ra({libraryId:c,connectionType:"word-topic",infoIds:[l.wordA.id,T.id]});for(const T of u(l.wordBTags))await ra({libraryId:c,connectionType:"word-topic",infoIds:[l.wordB.id,T.id]});await ra({libraryId:c,connectionType:"translation",infoIds:[l.wordA.id,l.wordB.id],payload:{tagIds:u(l.translationTags).map(T=>T.id)}}),S(a.cogita.library.add.group.savedVocab),re(T=>({...T,groupType:l.groupType,languageA:l.languageA,wordA:null,languageB:l.languageB,wordB:null,wordATags:l.wordATags,wordBTags:l.wordBTags,translationTags:l.translationTags})),requestAnimationFrame(()=>{var T;return(T=me.current)==null?void 0:T.focus()})}catch{S(a.cogita.library.add.group.failed)}},z=l.groupType==="citation"?a.cogita.library.add.group.saveCitation:l.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:H,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${H}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":J===t,onClick:()=>{j||Y(t)},disabled:j&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[J==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:s.infoType,onChange:t=>{j||h(r=>({...r,infoType:t.target.value}))},disabled:j,children:We.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.infoType!=="quote"&&s.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:s.label,onChange:t=>h(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(s.infoType==="word"||s.infoType==="sentence"||s.infoType==="quote")&&e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:s.language,onChange:t=>h(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),s.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:s.workLanguage,onChange:t=>h(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:s.workOriginalLanguage,onChange:t=>h(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:s.workDoi,onChange:t=>h(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),s.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:s.mediaType,onChange:t=>h(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:s.mediaPublisher,onChange:t=>h(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationPlace,onChange:t=>h(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationYear,onChange:t=>h(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:s.mediaPages,onChange:t=>h(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:s.mediaIsbn,onChange:t=>h(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:s.mediaCover,onChange:t=>h(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:s.mediaHeight,onChange:t=>h(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:s.mediaLength,onChange:t=>h(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:s.mediaWidth,onChange:t=>h(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:s.mediaWeight,onChange:t=>h(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:s.mediaCollection,onChange:t=>h(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:s.mediaLocation,onChange:t=>h(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),s.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:s.quoteText,onChange:t=>h(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),s.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:s.sourceKind,onChange:t=>{const r=t.target.value,u=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":s.sourceResourceType;h(T=>({...T,sourceKind:r,sourceResourceType:u,sourceResource:null,sourceLocatorValue:r==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?T.sourceBibleBookDisplay:""}))},children:ee.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:s.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;h(u=>({...u,sourceBibleBookDisplay:r,sourceLocatorValue:""})),be("source"),oe(-1)},onKeyDown:t=>{const r=de(s.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),oe(u=>Math.min(u+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),oe(u=>Math.max(u-1,0));else if((t.key==="Enter"||t.key==="Tab")&&ke>=0&&r[ke]){const u=r[ke],T=Ee(u.label,O);if(!T)return;h(g=>{var E;return{...g,sourceBibleBookDisplay:u.label,sourceLocatorValue:((E=T.la)==null?void 0:E.abbr)??g.sourceLocatorValue}}),be(null)}}},onFocus:()=>be("source"),onBlur:()=>window.setTimeout(()=>be(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),U==="source"&&de(s.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:de(s.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===ke,tabIndex:-1,onMouseDown:()=>{const u=Ee(t.label,O);u&&h(T=>{var g;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((g=u.la)==null?void 0:g.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorAux,onChange:t=>h(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),s.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:s.sourceUrl,onChange:t=>h(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:s.sourceAccessedDate,onChange:t=>h(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorValue,onChange:t=>h(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),s.sourceKind!=="string"&&s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:s.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(s.sourceKind),onChange:t=>h(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:qe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(De,{libraryId:c,infoType:s.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:s.sourceResource,onChange:t=>h(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ye(a,s.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),s.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:s.notes,onChange:t=>h(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,s.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:x,onChange:t=>se(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(Gi,{copy:a,value:V,onChange:t=>y(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Ce,children:a.cogita.library.add.info.computedPreview})}),Q&&G==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(Pt,{value:Q.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(Q.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(hr,{value:r,mode:"auto"})]},t))}),Q.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(Pt,{value:Q.answerText,mode:"auto"})]}):null]}):G==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.referenceEnabled,onChange:t=>h(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),s.referenceEnabled&&e.jsx(Rr,{libraryId:c,copy:a,language:O,sourceKindOptions:ee,labels:Te,value:{sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},onChange:t=>h(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:Ke,disabled:ve==="saving"||ve==="loading",children:j?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,J==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:B.connectionType,onChange:t=>ge(r=>({...r,connectionType:t.target.value})),children:ia.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),B.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:B.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:B.word,onChange:t=>ge(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),le&&e.jsx("p",{className:"cogita-help",children:le})]}),B.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:B.word,onChange:t=>ge(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:B.topic,onChange:t=>ge(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:B.wordA,onChange:t=>ge(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:B.wordB,onChange:t=>ge(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:B.quote,onChange:t=>ge(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:B.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:B.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:B.sentence,onChange:t=>ge(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:B.referencedInfoType,onChange:t=>ge(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:We.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(De,{libraryId:c,infoType:B.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:B.referencedInfo,onChange:t=>ge(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ye(a,B.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:B.source,onChange:t=>ge(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:B.source,onChange:t=>ge(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:B.sourceResourceType,onChange:t=>ge(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:qe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(De,{libraryId:c,infoType:B.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:B.sourceResource,onChange:t=>ge(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ye(a,B.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:B.work,onChange:t=>ge(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:B.contributorType,onChange:t=>ge(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ye(a,t)},t))})]}),e.jsx(De,{libraryId:c,infoType:B.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:B.contributor,onChange:t=>ge(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ye(a,B.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:B.contributorRole,onChange:t=>ge(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),B.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:B.work,onChange:t=>ge(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:B.medium,onChange:t=>ge(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:B.orcidEntityType,onChange:t=>ge(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ye(a,t)},t))})]}),e.jsx(De,{libraryId:c,infoType:B.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:B.orcidEntity,onChange:t=>ge(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ye(a,B.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(De,{libraryId:c,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:B.orcid,onChange:t=>ge(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:B.note,onChange:t=>ge(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:L,children:a.cogita.library.add.connection.save})})]}):null,J==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:l.groupType,onChange:t=>re(r=>({...r,groupType:t.target.value})),children:Le.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),l.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:l.citationLanguage,onChange:t=>re(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:l.citationTitle,onChange:t=>re(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:l.citationQuoteText,onChange:t=>re(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:l.citationReferenceEnabled,onChange:t=>re(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),l.citationReferenceEnabled&&e.jsx(Rr,{libraryId:c,copy:a,language:O,sourceKindOptions:ee,labels:Te,value:{sourceKind:l.citationSourceKind,locatorValue:l.citationLocatorValue,locatorAux:l.citationLocatorAux,bibleBookDisplay:l.citationBibleBookDisplay,sourceUrl:l.citationSourceUrl,sourceAccessedDate:l.citationSourceAccessedDate,churchDocument:l.citationChurchDocument,bookMedia:l.citationBookMedia,work:l.citationWork},onChange:t=>re(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),l.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:l.bookTitle,onChange:t=>re(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:l.bookPublisher,onChange:t=>re(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:l.bookPublicationPlace,onChange:t=>re(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:l.bookPublicationYear,onChange:t=>re(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:l.bookPages,onChange:t=>re(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:l.bookIsbn,onChange:t=>re(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:l.bookCover,onChange:t=>re(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:l.bookHeight,onChange:t=>re(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:l.bookLength,onChange:t=>re(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:l.bookWidth,onChange:t=>re(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:l.bookWeight,onChange:t=>re(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:l.bookCollection,onChange:t=>re(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:l.bookLocation,onChange:t=>re(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:l.bookWorkTitle,onChange:t=>re(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:l.bookWorkLanguage,onChange:t=>re(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:l.bookWorkOriginalLanguage,onChange:t=>re(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:l.bookWorkDoi,onChange:t=>re(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>re(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),l.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:u=>re(T=>({...T,bookContributors:T.bookContributors.map((g,E)=>E===r?{...g,contributorType:u.target.value,contributor:null}:g)})),children:["person","institution","collective"].map(u=>e.jsx("option",{value:u,children:Ye(a,u)},u))})]}),e.jsx(De,{libraryId:c,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:u=>re(T=>({...T,bookContributors:T.bookContributors.map((g,E)=>E===r?{...g,contributor:u}:g)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ye(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:u=>re(T=>({...T,bookContributors:T.bookContributors.map((g,E)=>E===r?{...g,role:u.target.value}:g)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>re(u=>{const T=u.bookContributors.filter((g,E)=>E!==r);return T.length===0?{...u,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...u,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),l.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:l.languageA,onChange:t=>re(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:l.languageB,onChange:t=>re(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:l.wordA,onChange:t=>re(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:me,autoAdvance:!0,onCommit:()=>{var t;return(t=Ve.current)==null?void 0:t.focus()}}),e.jsx(De,{libraryId:c,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:l.wordB,onChange:t=>re(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Ve,autoAdvance:!0,onCommit:()=>{var t;return(t=Ie.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(De,{libraryId:c,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:l.translationTags,onChangeMultiple:t=>re(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(De,{libraryId:c,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:l.wordATags,onChangeMultiple:t=>re(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:c,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:l.wordBTags,onChangeMultiple:t=>re(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),l.groupType==="vocab"&&Ne&&e.jsx("p",{className:"cogita-help",children:Ne}),l.groupType==="vocab"&&Se&&e.jsx("p",{className:"cogita-help",children:Se}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:N,ref:Ie,children:z})})]}):null,k?e.jsx("p",{className:"cogita-form-error",children:k}):null]})})})})})]})})}const Er=a=>/\s/.test(a),Ft=a=>/[\p{L}\p{N}]/u.test(a),Fr=(a,n)=>{const d=n>0?a[n-1]:"",b=n<a.length?a[n]:"";if(!d||!b)return 0;const m=Er(d),M=Er(b);if(m||M)return 3;const v=Ft(d),F=Ft(b);return v!==F?2:!v&&!F?1:0},nr=(a,n,d,b,m)=>{const M=Math.max(b-n,d-b);for(let v=0;v<=M;v+=1){const F=b-v;if(F>=n&&F<=d&&Fr(a,F)>=m)return F;const O=b+v;if(O>=n&&O<=d&&Fr(a,O)>=m)return O}return null},lr=(a,n)=>{const d=n>0?a[n-1]:"",b=n<a.length?a[n]:"";return!d||!b?!0:Ft(d)!==Ft(b)},Zi=(a,n,d,b)=>{const m=d-n,M=n+b,v=d-b;if(m<=b*2||v<=M)return null;const F=Math.floor((n+d)/2),O=nr(a,M,v,F,3);if(O!==null&&lr(a,O))return O;const q=nr(a,M,v,F,2);if(q!==null&&lr(a,q))return q;const c=nr(a,M,v,F,1);return c!==null&&lr(a,c)?c:null},nt=(a,n)=>{const d=Math.max(1,7),b=Math.max(d,13),m={},M=(O,q,c,R,f)=>{const j=String(R),H={id:j,start:O,end:q,text:a.slice(O,q),depth:c,index:R,parentId:f};if(m[j]=H,q-O>b){let Y=Zi(a,O,q,d);if(Y!==null&&Y>O&&Y<q){const s=M(O,Y,c+1,R*2+1,j),h=M(Y,q,c+1,R*2+2,j);H.leftId=s.id,H.rightId=h.id}}return H},v=M(0,a.length,0,0),F=Object.values(m).sort((O,q)=>q.depth-O.depth||O.start-q.start).map(O=>O.id);return{text:a,rootId:v.id,nodes:m,order:F}},rt=(a,n,d,b,m,M,v)=>{const F=M==="reverse"?a.order.slice().sort((O,q)=>a.nodes[q].start-a.nodes[O].start||a.nodes[q].depth-a.nodes[O].depth):a.order;for(const O of F){if(v&&O===v||n.has(O))continue;const q=a.nodes[O];if(q){if(m&&(q.leftId||q.rightId)){const c=q.leftId?d[q.leftId]??0:b,R=q.rightId?d[q.rightId]??0:b;if((c+R)/2<b)continue}return q}}return null},Qr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function en({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c}){const R=`/#/cogita/library/${c}`,[f,j,H]=pr([]),[J,Y,s]=fr([]),[h,x]=i.useState(null),[se,V]=i.useState(null),[y,Q]=i.useState(null),[K,G]=i.useState(null),ae=i.useMemo(()=>f.find(l=>l.id===h)??null,[f,h]);i.useEffect(()=>{let l=!0;return fi({libraryId:c}).then(re=>{if(!l)return;const k=re.nodes.map(S=>{var ve,_,le;return{id:S.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:S.payload&&typeof S.payload=="object"&&"label"in S.payload?String(S.payload.label):"Item",nodeType:S.nodeType,itemType:((ve=S.payload)==null?void 0:ve.itemType)??"info",itemId:((_=S.payload)==null?void 0:_.itemId)??null,infoType:((le=S.payload)==null?void 0:le.infoType)??null}}});j(k),Y(re.edges.map(S=>({id:S.edgeId,source:S.fromNodeId,target:S.toNodeId})))}).catch(()=>{l&&(j([]),Y([]))}),()=>{l=!1}},[c]),i.useEffect(()=>{xi({libraryId:c}).then(V).catch(()=>V(null))},[c,f,J]);const U=i.useCallback(l=>{Y(re=>yt(l,re))},[]),be=()=>{const l=crypto.randomUUID();j(re=>[...re,{id:l,type:"default",position:{x:140+re.length*40,y:120+re.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},ke=()=>{const l=crypto.randomUUID();j(re=>[...re,{id:l,type:"default",position:{x:180+re.length*40,y:160+re.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},oe=async()=>{Q(null);try{const l=f.map(k=>({nodeId:k.id,nodeType:k.data.nodeType,payload:{itemType:k.data.itemType,itemId:k.data.itemId??null,label:k.data.label,infoType:k.data.infoType??null}})),re=J.map(k=>({edgeId:k.id,fromNodeId:k.source,toNodeId:k.target}));await yi({libraryId:c,nodes:l,edges:re}),Q(a.cogita.library.graph.saveSuccess)}catch{Q(a.cogita.library.graph.saveFail)}},B=l=>{ae&&j(re=>re.map(k=>k.id===ae.id?{...k,data:{...k.data,itemId:(l==null?void 0:l.infoId)??null,itemType:"collection",infoType:"collection",label:(l==null?void 0:l.label)??a.cogita.library.infoTypes.collection}}:k))},ge=l=>{ae&&j(re=>re.map(k=>k.id===ae.id?{...k,data:{...k.data,itemId:(l==null?void 0:l.infoId)??null,itemType:"info",infoType:(l==null?void 0:l.infoType)??null,label:(l==null?void 0:l.label)??a.cogita.library.infoTypes.any}}:k))};return i.useEffect(()=>{if(!ae||ae.data.nodeType!=="info"||ae.data.infoType!=="quote"||!ae.data.itemId){G(null);return}let l=!0;return tt({libraryId:c,infoId:ae.data.itemId}).then(re=>{if(!l)return;const k=re.payload,S=(k==null?void 0:k.text)??"";if(!S){G(null);return}const ve=nt(S),_=Object.values(ve.nodes).sort((le,we)=>le.depth-we.depth||le.start-we.start).map(le=>({id:le.id,text:le.text,depth:le.depth}));G({title:(k==null?void 0:k.title)??ae.data.label,fragments:_})}).catch(()=>G(null)),()=>{l=!1}},[c,ae]),e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:R,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:oe,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:be,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ke,children:a.cogita.library.actions.addInfo}),se?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(se.totalCollections))})}):null,y?e.jsx("p",{className:"cogita-help",children:y}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(_t,{nodes:f,edges:J,onNodesChange:H,onEdgesChange:s,onConnect:U,onNodeClick:(l,re)=>x(re.id),fitView:!0,children:[e.jsx(Ut,{gap:18,size:1}),e.jsx(Wt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),ae?e.jsxs("div",{className:"cogita-graph-inspector",children:[ae.data.nodeType==="collection"?e.jsx(De,{libraryId:c,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:ae.data.itemId?{id:ae.data.itemId,label:ae.data.label,infoType:"collection"}:null,onChange:B,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(De,{libraryId:c,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:ae.data.itemId?{id:ae.data.itemId,label:ae.data.label,infoType:ae.data.infoType??void 0}:null,onChange:ge,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),K?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:K.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:K.fragments.map(l=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:l.id}),e.jsx("span",{children:l.text})]},l.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function Ar({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c,collectionId:R}){const{libraryName:f}=Da(c),[j,H]=i.useState([]),[J,Y]=i.useState("loading"),[s,h]=i.useState("idle"),x=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),se=`/#/cogita/library/${c}`,V=()=>{Y("loading"),_r({libraryId:c}).then(K=>{H(K),Y("idle")}).catch(()=>{H([]),Y("error")})};i.useEffect(()=>{V()},[c]);const y=async K=>{try{await Ur({libraryId:c,shareId:K}),V()}catch{V()}},Q=async K=>{const G=`${x}/${K}`;try{await navigator.clipboard.writeText(G),h("copied")}catch{h("failed")}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:se,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${se}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[J==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):J==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):j.filter(K=>!R||K.collectionId===R).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:j.filter(K=>!R||K.collectionId===R).map(K=>e.jsxs("div",{className:"cogita-share-row","data-state":K.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:K.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(K.createdUtc).toLocaleString(),K.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),K.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${x}/${K.shareCode}`}):null]}),K.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[K.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>Q(K.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>y(K.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},K.shareId))}),s==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):s==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function an({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c}){const{libraryName:R}=Da(c),f=`/#/cogita/library/${c}`,[j,H]=i.useState(""),[J,Y]=i.useState([]),[s,h]=i.useState("idle"),[x,se]=i.useState(0),[V,y]=i.useState(null);i.useEffect(()=>{h("loading");const K=window.setTimeout(()=>{$t({libraryId:c,query:j.trim()||void 0,limit:30}).then(G=>{Y(G.items),se(G.total),y(G.nextCursor??null),h("ready")}).catch(()=>{Y([]),se(0),y(null),h("ready")})},240);return()=>window.clearTimeout(K)},[c,j]);const Q=async()=>{if(V){h("loading");try{const K=await $t({libraryId:c,query:j.trim()||void 0,limit:30,cursor:V});Y(G=>[...G,...K.items]),y(K.nextCursor??null),se(K.total),h("ready")}catch{h("ready")}}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:R}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:f,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${f}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:j,onChange:K=>H(K.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(J.length)).replace("{total}",String(x||J.length))}),e.jsx("span",{children:s==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:J.length?J.map(K=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${f}/collections/${K.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:K.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(K.itemCount))," ·"," ",K.notes||a.cogita.library.collections.noNotes]})]})},K.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${f}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),V?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Q,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const Br=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],tn={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},rn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],nn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function ln({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c,onCreated:R}){const{libraryName:f}=Da(c),j=`/#/cogita/library/${c}`,[H,J]=i.useState(null),[Y,s]=i.useState(""),[h,x]=i.useState(""),[se,V,y]=pr([]),[Q,K,G]=fr([]),[ae,U]=i.useState(null),[be,ke]=i.useState(null),oe=i.useMemo(()=>se.find(k=>k.id===ae)??null,[se,ae]),B=k=>{var le;const S=crypto.randomUUID(),ve=((le=Br.find(we=>we.type===k))==null?void 0:le.label)??k,_={...tn[k]};V(we=>[...we,{id:S,type:"default",position:{x:120+we.length*40,y:120+we.length*40},data:{nodeType:k,label:ve,params:_}}]),U(S)},ge=i.useCallback(k=>{K(S=>yt({...k,id:crypto.randomUUID()},S))},[K]),l=k=>{oe&&V(S=>S.map(ve=>ve.id===oe.id?{...ve,data:{...ve.data,params:k}}:ve))},re=async()=>{if(ke(null),!Y.trim()){ke(a.cogita.library.collections.saveRequiredName);return}try{const k={nodes:se.map(_=>({nodeId:_.id,nodeType:_.data.nodeType,payload:{position:_.position,params:_.data.params}})),edges:Q.map(_=>({edgeId:_.id,fromNodeId:_.source,fromPort:_.sourceHandle??null,toNodeId:_.target,toPort:_.targetHandle??null}))};let S=H,ve=!1;if(S)await zr({libraryId:c,collectionId:S,nodes:k.nodes,edges:k.edges});else{const _=await Wr({libraryId:c,name:Y.trim(),notes:h.trim()||void 0,items:[],graph:k});S=_.collectionId,ve=!0,J(_.collectionId)}ke(ve?a.cogita.library.collections.saveSuccess:a.cogita.library.graph.saveSuccess),R(S)}catch{ke(H?a.cogita.library.graph.saveFail:a.cogita.library.collections.saveFail)}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.createKicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.createSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("button",{type:"button",className:"cta",onClick:re,children:a.cogita.library.actions.saveCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.collectionInfoTitle}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{value:Y,onChange:k=>s(k.target.value),placeholder:a.cogita.library.collections.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.notesLabel}),e.jsx("textarea",{value:h,onChange:k=>x(k.target.value),placeholder:a.cogita.library.collections.notesPlaceholder})]}),be?e.jsx("p",{className:"cogita-help",children:be}):null,e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:Br.map(k=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>B(k.type),children:k.label},k.type))})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(_t,{nodes:se,edges:Q,onNodesChange:y,onEdgesChange:G,onConnect:ge,onNodeClick:(k,S)=>U(S.id),fitView:!0,children:[e.jsx(Ut,{color:"rgba(120,160,200,0.2)"}),e.jsx(Wt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),oe?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:oe.data.label}),oe.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:oe.data.params.tagId?{id:oe.data.params.tagId,label:oe.data.params.tagLabel??"",infoType:"topic"}:null,onChange:k=>l({...oe.data.params,tagId:(k==null?void 0:k.id)??null,tagLabel:(k==null?void 0:k.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:oe.data.params.scope??"any",onChange:k=>l({...oe.data.params,scope:k.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),oe.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:oe.data.params.languageId?{id:oe.data.params.languageId,label:oe.data.params.languageLabel??"",infoType:"language"}:null,onChange:k=>l({...oe.data.params,languageId:(k==null?void 0:k.id)??null,languageLabel:(k==null?void 0:k.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:oe.data.params.scope??"any",onChange:k=>l({...oe.data.params,scope:k.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),oe.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:oe.data.params.infoType??"word",onChange:k=>l({...oe.data.params,infoType:k.target.value}),children:nn.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsx(De,{libraryId:c,infoType:oe.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:oe.data.params.infoId?{id:oe.data.params.infoId,label:oe.data.params.infoLabel??"",infoType:oe.data.params.infoType??"word"}:null,onChange:k=>l({...oe.data.params,infoId:(k==null?void 0:k.id)??null,infoLabel:(k==null?void 0:k.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),oe.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:oe.data.params.connectionType??"translation",onChange:k=>l({...oe.data.params,connectionType:k.target.value}),children:rn.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:oe.data.params.connectionId??"",onChange:k=>l({...oe.data.params,connectionId:k.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(oe.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function on({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c,collectionId:R}){Da(c);const f=`/#/cogita/library/${c}`,[j,H]=i.useState(a.cogita.library.collections.defaultName),[J,Y]=i.useState(null),[s,h]=i.useState(0),[x,se]=i.useState([]),[V,y]=i.useState("idle"),[Q,K]=i.useState(null),G=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(x.length)).replace("{total}",String(s||x.length)),[a,x.length,s]);i.useEffect(()=>{zt(c,R).then(U=>{H(U.name),Y(U.notes??null),h(U.itemCount)}).catch(()=>{H(a.cogita.library.collections.defaultName),Y(null)})},[c,R]),i.useEffect(()=>{y("loading"),Rt({libraryId:c,collectionId:R,limit:40}).then(U=>{se(U.items),K(U.nextCursor??null),h(U.total),y("ready")}).catch(()=>{se([]),K(null),y("ready")})},[c,R]);const ae=async()=>{if(Q){y("loading");try{const U=await Rt({libraryId:c,collectionId:R,limit:40,cursor:Q});se(be=>[...be,...U.items]),K(U.nextCursor??null),h(U.total),y("ready")}catch{y("ready")}}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:j}),e.jsx("p",{className:"cogita-library-subtitle",children:J||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:f,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${f}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${f}/collections/${R}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${f}/collections/${R}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:G}),e.jsx("span",{children:V==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:x.length?x.map(U=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:U.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:U.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:U.label}),e.jsx("p",{className:"cogita-card-subtitle",children:U.description})]})},ue(U))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),Q?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:ae,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${f}/collections/${R}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Ma=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,d=a.filter(M=>M.correct).length,b=Ht(vr(a));return{score:Math.round(Math.max(0,Math.min(100,b.knowness*100))*100)/100,total:n,correct:d,lastReviewedUtc:b.lastReviewedUtc??null}},sn=a=>{if(a.maskBase64)try{const n=vi(a.maskBase64);if(!n.length)return a.correct?1:0;const d=n.reduce((b,m)=>b+m,0);return Math.max(0,Math.min(1,d/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},vr=a=>a.map(n=>({correctness:sn(n),createdUtc:n.createdUtc})),Ht=(a,n=Date.now())=>{var s;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const b=a.slice().sort((h,x)=>h.createdUtc.localeCompare(x.createdUtc)).slice(-5),m=b.reduce((h,x)=>h+x.correctness,0)/b.length,M=5,v=2,F=.15;let O=0,q=0;for(let h=0;h<b.length;h+=1){const x=new Date(b[h].createdUtc).getTime(),se=h===b.length-1?n:new Date(b[h+1].createdUtc).getTime(),V=Math.max(0,(se-x)/(1e3*60)),y=1-Math.exp(-V/M);O+=y,b[h].correctness>.5&&(q+=F)}let c=m*O*v+q;const R=((s=b[b.length-1])==null?void 0:s.createdUtc)??null,f=R?Math.max(0,(n-new Date(R).getTime())/(1e3*60)):0,H=1/(1+Math.log1p(f/60));return c*=H,b.length===1&&b[0].correctness>.5&&(c+=5.44*Math.exp(-f/2)),{knowness:c,avgCorrectness:m,lastReviewedUtc:R}},vt=a=>{const n=a.slice();for(let d=n.length-1;d>0;d-=1){const b=Math.floor(Math.random()*(d+1));[n[d],n[b]]=[n[b],n[d]]}return n},It=a=>a[Math.floor(Math.random()*a.length)],cn=(a,n)=>{const d=new Map;return a.forEach(b=>d.set(b,Math.random())),a.sort((b,m)=>{const M=n(b)-n(m);return M!==0?M:(d.get(b)??0)-(d.get(m)??0)})},Jt=(a,n,d,b,m)=>{if(!a.length)return null;const M=a.filter(F=>!(m!=null&&m.has(ue(F))));if(M.length===0)return null;const v=M.filter(F=>ue(F)!==d);return It(v.length?v:M)},dn=(a,n,d,b,m)=>{if(!a.length)return null;let M=Number.POSITIVE_INFINITY;for(const q of a){const c=ue(q);if(d.has(c))continue;const R=n[c]??1;R<M&&(M=R)}if(!Number.isFinite(M))return null;const v=a.filter(q=>{const c=ue(q);return!d.has(c)&&(n[c]??1)===M}),F=v.filter(q=>!m||ue(q)!==m),O=b?F.filter(q=>!b.has(ue(q))):F;return O.length>0?It(O):F.length>0?It(F):m&&v.some(q=>ue(q)===m)?v.find(q=>ue(q)===m)??null:v.length?It(v):null},Gr=(a,n,d,b,m)=>{const M=[],v=a.filter(O=>!m.has(ue(O))&&!d.has(ue(O))&&(n[ue(O)]??0)<1),F=cn(v,O=>n[ue(O)]??0);for(const O of F){if(M.length>=b)break;M.push(O),m.add(ue(O))}if(M.length<b){const O=vt(a.filter(q=>!m.has(ue(q))&&d.has(ue(q))));for(const q of O){if(M.length>=b)break;M.push(q),m.add(ue(q))}}return M},un=(a,n,d,b)=>Gr(a,n,d,b,new Set),jr=(a,n,d,b,m,M)=>{const v=Math.max(1,d.stackSize??n),O=vt(a).filter((H,J,Y)=>Y.findIndex(s=>ue(s)===ue(H))===J),q=un(O,b,m,v),c=new Set,R=new Set,f=Jt(q,{},null,c,R),j=f?[f]:[];return f&&R.add(ue(f)),{queue:j,meta:{pool:O,active:q,knownessMap:b,unknownSet:m,outcomesById:M,asked:c,queued:R}}},br={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const b=vt(a).filter((m,M,v)=>v.findIndex(F=>ue(F)===ue(m))===M);return{queue:b.slice(0,Math.min(n,b.length)),meta:{}}},applyOutcome:a=>a},kr=(a,n,d,b)=>{const m=Math.max(1,d.stackSize??n),v=vt(a).filter((J,Y,s)=>s.findIndex(h=>ue(h)===ue(J))===Y),F={},O=new Set,q=new Set,c=new Set,R=Math.max(1,d.levels??1);v.forEach(J=>{const Y=ue(J),s=b==null?void 0:b[Y],h=typeof s=="number"&&Number.isFinite(s)?s:1;F[Y]=Math.min(R,Math.max(1,Math.round(h)))});const f=[];if(v.length>0){const J=new Map;v.forEach(s=>{var x;const h=F[ue(s)]??1;J.has(h)||J.set(h,[]),(x=J.get(h))==null||x.push(s)});const Y=Array.from(J.keys()).sort((s,h)=>s-h);for(const s of Y){if(f.length>=m)break;const h=vt(J.get(s)??[]);for(const x of h){if(f.length>=m)break;f.push(x)}}}const j=Jt(f,F,null,O,q),H=j?[j]:[];return j&&q.add(ue(j)),{queue:H,meta:{pool:v,active:f,levelMap:F,asked:O,queued:q,wrongSinceCorrect:c}}},gn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,d)=>kr(a,n,d),applyOutcome:(a,n,d,b,m)=>{if(!n)return a;const M=Math.max(1,b.levels??1),v=a.meta.pool??[],F=a.meta.active??[],O={...a.meta.levelMap??{}},q=new Set(a.meta.asked??[]),c=new Set(a.meta.queued??[]),R=new Set(a.meta.wrongSinceCorrect??[]),f=ue(n);c.delete(f),q.add(f);const j=O[f]??1;m.correct?(O[f]=R.has(f)?1:Math.min(j+1,M),R.delete(f)):(O[f]=1,R.add(f));const H=m.correct?F.filter(s=>ue(s)!==f):F.slice();if(m.correct&&H.length<Math.max(1,b.stackSize??1)){const s=new Set(H.map(x=>ue(x))),h=dn(v,O,s,q,f);h&&H.push(h)}const J=a.queue.slice(),Y=Jt(H,O,f,q,c);return Y&&(J.push(Y),c.add(ue(Y))),{queue:J,meta:{pool:v,active:H,levelMap:O,asked:q,queued:c,wrongSinceCorrect:R}}}},hn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,d)=>jr(a,n,d,{},new Set,{}),applyOutcome:(a,n,d,b,m)=>{if(!n)return a;const M=a.meta.pool??[],v=a.meta.active??[],F={...a.meta.knownessMap??{}},O=new Set(a.meta.unknownSet??[]),q={...a.meta.outcomesById??{}},c=new Set(a.meta.asked??[]),R=new Set(a.meta.queued??[]),f=ue(n);R.delete(f),c.add(f);const j={correctness:Math.max(0,Math.min(1,m.correctness??(m.correct?1:0))),createdUtc:m.createdUtc??new Date().toISOString()},J=(q[f]??[]).concat(j).sort((V,y)=>V.createdUtc.localeCompare(y.createdUtc)).slice(-5);q[f]=J,O.delete(f);const Y=Date.now();M.forEach(V=>{const y=ue(V),Q=q[y]??[];if(Q.length===0){F[y]=0,O.add(y);return}const K=Ht(Q,Y);F[y]=K.knowness});const s=v.slice();if((F[f]??0)>=1){const V=s.filter(y=>ue(y)!==f);s.length=0,s.push(...V)}const x=Math.max(1,b.stackSize??d);if(s.length<x){const V=new Set(s.map(Q=>ue(Q))),y=Gr(M,F,O,x-s.length,V);s.push(...y)}const se=a.queue.slice();if(se.length===0||ue(se[se.length-1])===f){const V=Jt(s,{},f,c,R);V&&(se.push(V),R.add(ue(V)))}return{queue:se,meta:{pool:M,active:s,knownessMap:F,unknownSet:O,outcomesById:q,asked:c,queued:R}}}},Xr={random:br,levels:gn,temporal:hn},bn=Object.values(Xr),wr=a=>{if(!a)return br;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?Xr[n]:br},Yt=(a,n)=>{const d={...a.defaultSettings};return n&&Object.entries(n).forEach(([b,m])=>{typeof m=="number"&&Number.isFinite(m)&&(d[b]=m),typeof m=="string"&&(d[b]=m)}),a.settingsFields.forEach(b=>{var M;const m=d[b.key];if(b.type==="number"){if(typeof m!="number"||Number.isNaN(m)){d[b.key]=a.defaultSettings[b.key]??0;return}b.min!==void 0&&(d[b.key]=Math.max(b.min,d[b.key])),b.max!==void 0&&(d[b.key]=Math.min(b.max,d[b.key]));return}if(b.type==="select"){const v=((M=b.options)==null?void 0:M.map(F=>F.value))??[];(typeof m!="string"||v.length>0&&!v.includes(m))&&(d[b.key]=a.defaultSettings[b.key]??v[0]??"")}}),d},Zr=(a,n)=>{const d={};return a.settingsFields.forEach(b=>{const m=n.get(b.key);if(m){if(b.type==="number"){const M=Number(m);Number.isNaN(M)||(d[b.key]=M);return}d[b.key]=m}}),Yt(a,d)},mn=(a,n)=>{const d=new URLSearchParams;return a.settingsFields.forEach(b=>{const m=n[b.key];(typeof m=="number"||typeof m=="string")&&d.set(b.key,String(m))}),d};function pn({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c,collectionId:R}){const{libraryName:f}=Da(c),j=`/#/cogita/library/${c}`,[H,J]=i.useState(a.cogita.library.collections.defaultName),[Y,s]=i.useState(20),[h,x]=i.useState("random"),[se,V]=i.useState({}),[y]=i.useState("exact"),[Q,K]=i.useState([]),[G,ae]=i.useState(null),[U,be]=i.useState([]),[ke,oe]=i.useState("idle"),[B,ge]=i.useState(null),[l,re]=i.useState("idle"),[k,S]=i.useState("idle"),ve=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),_=i.useMemo(()=>wr(h),[h]),le=i.useMemo(()=>Yt(_,se),[_,se]),we=i.useMemo(()=>mn(_,le).toString(),[_,le]);i.useEffect(()=>{zt(c,R).then(me=>J(me.name)).catch(()=>J(a.cogita.library.collections.defaultName))},[c,R]),i.useEffect(()=>{ji({libraryId:c}).then(me=>{K(me),!G&&me.length>0&&ae(me[0].roleId)}).catch(()=>{K([])})},[c]);const Ne=()=>{S("loading"),_r({libraryId:c}).then(me=>{be(me),S("idle")}).catch(()=>{be([]),S("error")})};i.useEffect(()=>{Ne()},[c]);const Re=async()=>{oe("working"),re("idle");try{const me=await ki({libraryId:c,collectionId:R,revisionType:_.id,revisionSettings:le,mode:h,check:y,limit:Y});ge(`${ve}/${me.shareCode}${we?`?${we}`:""}`),oe("ready"),Ne()}catch{oe("error")}},Se=async()=>{if(B)try{await navigator.clipboard.writeText(B),re("copied")}catch{re("failed")}},Fe=async me=>{try{await Ur({libraryId:c,shareId:me}),Ne()}catch{Ne()}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:H}),e.jsx("p",{className:"cogita-library-subtitle",children:f})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${j}/collections/${R}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${j}/collections/${R}/revision/run?mode=${encodeURIComponent(h)}&check=${encodeURIComponent(y)}&limit=${Y}${we?`&${we}`:""}${G?`&reviewer=${encodeURIComponent(G)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:h,onChange:me=>x(me.target.value),children:bn.map(me=>e.jsx("option",{value:me.id,children:a.cogita.library.revision[me.labelKey]},me.id))})]}),_.settingsFields.map(me=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[me.labelKey]}),me.type==="select"?e.jsx("select",{value:String(le[me.key]??""),onChange:Ve=>V(Ie=>({...Ie,[me.key]:Ve.target.value})),children:(me.options??[]).map(Ve=>e.jsx("option",{value:Ve.value,children:a.cogita.library.revision[Ve.labelKey]},Ve.value))}):e.jsx("input",{type:"number",min:me.min,max:me.max,step:me.step,value:le[me.key]??0,onChange:Ve=>V(Ie=>({...Ie,[me.key]:Number(Ve.target.value||0)}))})]},me.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),_.id!=="levels"&&_.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:Y,onChange:me=>s(Number(me.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:G??"",onChange:me=>ae(me.target.value||null),children:Q.map(me=>e.jsx("option",{value:me.roleId,children:me.label},me.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${j}/collections/${R}/revision/run?mode=${encodeURIComponent(h)}&check=${encodeURIComponent(y)}&limit=${Y}${we?`&${we}`:""}${G?`&reviewer=${encodeURIComponent(G)}`:""}`,children:a.cogita.library.actions.startRevision})})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),B?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:B,readOnly:!0})]}):null,ke==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,l==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):l==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:Re,disabled:ke==="working",children:ke==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),B?e.jsx("button",{type:"button",className:"cta ghost",onClick:Se,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),k==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):U.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:U.map(me=>e.jsxs("div",{className:"cogita-share-row","data-state":me.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:me.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(me.createdUtc).toLocaleString(),me.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),me.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>Fe(me.shareId),children:a.cogita.library.revision.shareRevokeAction})]},me.shareId))})]})]})]})]})})})]})})}function ei({copy:a,currentCard:n,currentTypeLabel:d,prompt:b,languages:m,answer:M,onAnswerChange:v,computedExpected:F,computedAnswers:O,onComputedAnswerChange:q,answerTemplate:c,outputVariables:R,variableValues:f,computedFieldFeedback:j,feedback:H,canAdvance:J,quoteContext:Y,quotePlaceholder:s,onCheckAnswer:h,onSkip:x,onLanguageSelect:se,onMarkReviewed:V,onAdvance:y,showCorrectAnswer:Q,setShowCorrectAnswer:K,onRevealCorrect:G,answerMask:ae,expectedAnswer:U,hasExpectedAnswer:be,handleComputedKeyDown:ke,answerInputRef:oe,computedInputRefs:B,scriptMode:ge,setScriptMode:l,matchPairs:re,matchLeftOrder:k,matchRightOrder:S,matchSelection:ve,matchActiveLeft:_,matchActiveRight:le,matchFeedback:we,onMatchLeftSelect:Ne,onMatchRightSelect:Re}){const Se=i.useMemo(()=>{var z;const ee=!c&&F.length===2?`The {${F[0].key}} is of type {${F[1].key}}`:null,Te=c??ee;if(!Te)return null;const qe=new Map(F.map(t=>[t.key,t.expected])),Pe=new Set,de=[],Ee=/\{([^}]+)\}/g;let Ke=0,Oe,Ce=null;for(;(Oe=Ee.exec(Te))!==null;){const t=Te.slice(Ke,Oe.index);t&&de.push({type:"text",value:t});const r=((z=Oe[1])==null?void 0:z.trim())??"",u=r&&qe.has(r)?r:r&&R&&R[r]?R[r]:null;r&&Pe.add(r),u&&Pe.add(u),u&&qe.has(u)?(de.push({type:"input",value:u}),Ce||(Ce=u)):r&&f&&f[r]!==void 0?de.push({type:"text",value:f[r]}):de.push({type:"text",value:Oe[0]}),Ke=Oe.index+Oe[0].length}const L=Te.slice(Ke);return L&&de.push({type:"text",value:L}),F.filter(t=>!Pe.has(t.key)).length>0?null:{parts:de,expectedByKey:qe,firstInputKey:Ce}},[c,F,R,f]),Fe=()=>{if(!Se)return null;const{parts:ee,expectedByKey:Te,firstInputKey:qe}=Se;return e.jsx("div",{className:"cogita-revision-inline-answer",children:ee.map((Pe,de)=>{var Ee,Ke;return Pe.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Pe.value},`text-${de}`):e.jsx("input",{ref:Oe=>{B.current[Pe.value]=Oe},autoFocus:Pe.value===qe,value:O[Pe.value]??"",onChange:Oe=>q(Pe.value,Oe.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":j[Pe.value]??(H==="correct"?"correct":H==="incorrect"?"incorrect":void 0),onKeyDown:Oe=>We(Oe)||ke(Oe),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Ee=O[Pe.value])==null?void 0:Ee.length)??0,((Ke=Te.get(Pe.value))==null?void 0:Ke.length)??6)}ch`}},`input-${Pe.value}-${de}`)})})},me=i.useMemo(()=>{const ee=new Map;return(re??[]).forEach(Te=>ee.set(Te.leftId,Te)),ee},[re]),Ve=i.useMemo(()=>{const ee=new Map;return(re??[]).forEach(Te=>ee.set(Te.rightId,Te)),ee},[re]);i.useEffect(()=>{var de;if(n.cardType!=="info"||n.infoType!=="computed"||F.length===0)return;const ee=typeof document<"u"?document.activeElement:null;if(ee&&(ee.tagName==="INPUT"||ee.tagName==="TEXTAREA"))return;const Te=(Se==null?void 0:Se.firstInputKey)??((de=F[0])==null?void 0:de.key);if(!Te)return;const qe=B.current[Te];if(!qe)return;const Pe=requestAnimationFrame(()=>{qe.focus()});return()=>cancelAnimationFrame(Pe)},[n,F,Se]);const Ie=(()=>{const ee=[U??"",...F.map(Pe=>Pe.expected??"")].join(""),Te=[M,...Object.values(O)].join(""),qe=`${ee}${Te}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(qe)})(),We=ee=>ee.ctrlKey&&(ee.key==="^"||ee.key==="6")?(ee.preventDefault(),l(Te=>Te==="super"?null:"super"),!0):ee.ctrlKey&&(ee.key==="_"||ee.key==="-")?(ee.preventDefault(),l(Te=>Te==="sub"?null:"sub"),!0):!1,ia=()=>{if(!U||!ae)return U??"";const ee=U.split(""),Te=Array.from(ae),qe=Te.length>0?Te.reduce((Pe,de)=>Pe+de,0)/Te.length:127;return ee.map((Pe,de)=>{const Ee=Te[de]??qe,Ke=Math.max(0,Math.min(255,Math.round(Ee)));let Oe=255,Ce=0;return Ke<=127?Ce=Math.round(Ke/127*255):(Ce=255,Oe=Math.round(255*(1-(Ke-127)/128))),e.jsx("span",{style:{color:`rgb(${Oe}, ${Ce}, 0)`},children:Pe},`mask-${de}`)})},Le=n.cardType==="info"&&n.infoType==="quote"?(Y==null?void 0:Y.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:d}),e.jsx("strong",{children:Le})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&re?e.jsxs("div",{className:"cogita-revision-body",children:[b?e.jsx("h2",{children:b}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(k??[]).map(ee=>{const Te=me.get(ee);if(!Te)return null;const qe=(ve==null?void 0:ve[ee])??null,Pe=(we==null?void 0:we[ee])??null,de=_===ee;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":de,"data-state":Pe??void 0,"data-locked":qe?"true":void 0,onClick:()=>Ne==null?void 0:Ne(ee),children:[e.jsx("span",{children:Te.leftLabel}),qe&&Q?e.jsx("em",{children:"✓"}):null]},ee)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(S??[]).map(ee=>{const Te=Ve.get(ee);if(!Te)return null;const qe=Object.values(ve??{}).includes(ee),Pe=le===ee;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":qe||Pe,"data-locked":qe?"true":void 0,onClick:()=>Re==null?void 0:Re(ee),children:e.jsx("span",{children:Te.rightLabel})},ee)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:h,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:b}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:oe,value:M,onChange:ee=>v(ee.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":H==="correct"?"correct":H==="incorrect"?"incorrect":void 0,onKeyDown:ee=>{ee.key==="Enter"&&(ee.preventDefault(),ee.stopPropagation(),J?y():h())}})]}),Ie?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>l(ee=>ee==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>l(ee=>ee==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:h,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,c?null:e.jsx(Pt,{value:b??"",mode:"auto"}),F.length>0?(()=>{const ee=Fe();return ee?e.jsx("div",{className:"cogita-inline-answer-wrap",children:ee}):e.jsx("div",{className:"cogita-form-grid",children:F.map((Te,qe)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:Te.key}),e.jsx("textarea",{ref:Pe=>{B.current[Te.key]=Pe},autoFocus:qe===0,value:O[Te.key]??"",onChange:Pe=>q(Te.key,Pe.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":j[Te.key]??(H==="correct"?"correct":H==="incorrect"?"incorrect":void 0),onKeyDown:Pe=>We(Pe)||ke(Pe)})]},Te.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:oe,value:M,onChange:ee=>v(ee.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":H==="correct"?"correct":H==="incorrect"?"incorrect":void 0,onKeyDown:ee=>{We(ee)||ee.key==="Enter"&&(ee.preventDefault(),ee.stopPropagation(),J?y():h())}})]})}),Ie?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>l(ee=>ee==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>l(ee=>ee==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:h,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&Y?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(Y.completed)).replace("{total}",String(Y.total))}),e.jsx("p",{className:"cogita-quote-text",children:Y.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:oe,value:M,onChange:ee=>v(ee.target.value),placeholder:s??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":H==="correct"?"correct":H==="incorrect"?"incorrect":void 0,onKeyDown:ee=>{ee.key==="Enter"&&(ee.preventDefault(),ee.stopPropagation(),J?y():h())}})]}),e.jsx("p",{className:"cogita-quote-text",children:Y.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:h,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:b}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:m.length?m.map(ee=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>se(ee.label),children:ee.label},ee.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:b}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:V,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}),H&&e.jsx("div",{className:"cogita-revision-feedback","data-state":H,children:H==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),H==="incorrect"&&be?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>K(ee=>{const Te=!ee;return Te&&G(),Te}),children:a.cogita.library.revision.showAnswer}),Q?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),F.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[F.map(ee=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:ee.key}),e.jsx("span",{children:ee.expected})]},ee.key)),U?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:U})]}):null]}):e.jsx("p",{children:ae?ia():U})]}):null]}):null,J?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:y,children:a.cogita.library.revision.nextQuestion})}):null]})}const or=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ai({outcomes:a}){const[n,d]=i.useState("day"),b=i.useMemo(()=>{const m=or.find(F=>F.id===n)??or[1],M=Date.now()-m.ms,v=a.filter(F=>new Date(F.createdUtc).getTime()>=M);return Ma(v)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:or.map(m=>e.jsx("button",{type:"button",className:"ghost","data-active":n===m.id,onClick:()=>d(m.id),children:m.label},m.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[b.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[b.correct," / ",b.total]})]})}const fn="cogita-revision",xn=1,At="outcomes",yn=()=>new Promise((a,n)=>{const d=indexedDB.open(fn,xn);d.onupgradeneeded=()=>{const b=d.result;if(!b.objectStoreNames.contains(At)){const m=b.createObjectStore(At,{keyPath:"id"});m.createIndex("byItem","itemKey",{unique:!1}),m.createIndex("byPending","pending",{unique:!1})}},d.onerror=()=>n(d.error),d.onsuccess=()=>a(d.result)}),kt=async(a,n)=>{const d=await yn();return new Promise((b,m)=>{const M=d.transaction(At,a),v=M.objectStore(At);n(v).then(b).catch(m),M.onerror=()=>m(M.error)})},ti=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(d=>d.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},vn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const d=ti();return localStorage.setItem(a,d),d},jn=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),d=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(d)),d},ri=(a,n,d,b)=>Ca(a,n,d,b),Bt=async a=>{const n=vn(),d=jn(),b=new Date().toISOString(),m={...a,clientId:n,clientSequence:d,createdUtc:b,id:ti(),pending:!0};return await kt("readwrite",M=>new Promise((v,F)=>{const O={...m,itemKey:ri(m.itemType,m.itemId,m.checkType,m.direction)},q=M.add(O);q.onsuccess=()=>v(),q.onerror=()=>F(q.error)})),m},Dt=async(a,n,d,b)=>{if(!n)return[];try{const m=ri(a,n,d,b);return await kt("readonly",M=>new Promise((v,F)=>{const q=M.index("byItem").getAll(m);q.onsuccess=()=>{const R=(q.result??[]).map(f=>({itemType:f.itemType,itemId:f.itemId,checkType:f.checkType??null,direction:f.direction??null,revisionType:f.revisionType,evalType:f.evalType,correct:f.correct,createdUtc:f.createdUtc,maskBase64:f.maskBase64,payloadBase64:f.payloadBase64,payloadHashBase64:f.payloadHashBase64,clientId:f.clientId,clientSequence:f.clientSequence,personRoleId:f.personRoleId??null})).sort((f,j)=>f.createdUtc.localeCompare(j.createdUtc));v(R)},q.onerror=()=>F(q.error)}))}catch{return[]}},Sa=async()=>{try{return await kt("readonly",a=>new Promise((n,d)=>{const b=a.getAll();b.onsuccess=()=>{const M=(b.result??[]).map(v=>({itemType:v.itemType,itemId:v.itemId,checkType:v.checkType??null,direction:v.direction??null,revisionType:v.revisionType,evalType:v.evalType,correct:v.correct,createdUtc:v.createdUtc,maskBase64:v.maskBase64,payloadBase64:v.payloadBase64,payloadHashBase64:v.payloadHashBase64,clientId:v.clientId,clientSequence:v.clientSequence,personRoleId:v.personRoleId??null}));n(M)},b.onerror=()=>d(b.error)}))}catch{return[]}},kn=async(a=100)=>{try{return await kt("readonly",n=>new Promise((d,b)=>{const M=n.index("byPending").getAll(!0);M.onsuccess=()=>{const v=M.result??[];d(v.slice(0,a))},M.onerror=()=>b(M.error)}))}catch{return[]}},wn=async a=>{if(a.length!==0)try{await kt("readwrite",n=>new Promise((d,b)=>{let m=a.length;a.forEach(M=>{const v=n.get(M);v.onsuccess=()=>{const F=v.result;if(F){F.pending=!1;const O=n.put(F);O.onsuccess=()=>{m-=1,m===0&&d()},O.onerror=()=>b(O.error)}else m-=1,m===0&&d()},v.onerror=()=>b(v.error)})}))}catch{}},sr=async(a,n)=>{const d=await kn(200);if(d.length===0)return;const b=new Map;d.forEach(m=>{var v;const M=m.personRoleId??n??"";b.has(M)||b.set(M,[]),(v=b.get(M))==null||v.push(m)});for(const[m,M]of b.entries()){const v=M.map(F=>({itemType:F.itemType,itemId:F.itemId,checkType:F.checkType??null,direction:F.direction??null,revisionType:F.revisionType,evalType:F.evalType,correct:F.correct,clientId:F.clientId,clientSequence:F.clientSequence,maskBase64:F.maskBase64??null,payloadHashBase64:F.payloadHashBase64??null,payloadBase64:F.payloadBase64??null,personRoleId:m||null}));try{await wi({libraryId:a,outcomes:v}),await wn(M.map(F=>F.id))}catch{}}},Dr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Tn=(a,n)=>{const d=Math.max(a.length,n.length,1),b=Math.abs(a.length-n.length);return Math.max(0,1-b/d)},Nn=(a,n)=>{const d=new Uint8Array(a.length),b=Tn(a,n);for(let m=0;m<a.length;m+=1){const M=a[m]===(n[m]??"")?128:0,v=a.length-1-m,F=n.length-1-m,O=a[v]===(n[F]??"")?127:0,q=Math.round((M+O)*b);d[m]=Math.max(0,Math.min(255,q))}return d},Ct=(a,n)=>a===n||(Dr[a]??[]).includes(n)?!0:(Dr[n]??[]).includes(a),Kt=(a,n)=>{const d=new Uint8Array(a.length);if(!a.length)return d;const b=[];for(let M=0;M<=a.length-3;M+=1)b.push({index:M,text:a.slice(M,M+3)});let m=!1;return b.forEach(M=>{for(let v=0;v<=n.length-3;v+=1){const F=n.slice(v,v+3);let O=0;for(let j=0;j<3;j+=1)Ct(M.text[j],F[j])&&(O+=1);if(O<2)continue;let q=M.index-1,c=v-1;for(;q>=0&&c>=0;){const j=a[q],H=n[c];if(j===H){d[q]=Math.max(d[q],255),q-=1,c-=1,m=!0;continue}if(Ct(j,H)){d[q]=Math.max(d[q],127),q-=1,c-=1,m=!0;continue}if(q>0&&a[q-1]===H){d[q]=Math.max(d[q],0),q-=1,m=!0;continue}if(c>0&&a[q]===n[c-1]){c-=1,m=!0;continue}break}for(let j=0;j<3;j+=1){const H=M.index+j,J=M.text[j],Y=F[j],s=J===Y?255:Ct(J,Y)?127:0;d[H]=Math.max(d[H],s),m=!0}let R=M.index+3,f=v+3;for(;R<a.length&&f<n.length;){const j=a[R],H=n[f];if(j===H){d[R]=Math.max(d[R],255),R+=1,f+=1,m=!0;continue}if(Ct(j,H)){d[R]=Math.max(d[R],127),R+=1,f+=1,m=!0;continue}if(R+1<a.length&&a[R+1]===H){d[R]=Math.max(d[R],0),R+=1,m=!0;continue}if(f+1<n.length&&a[R]===n[f+1]){f+=1,m=!0;continue}break}}}),m?d:Nn(a,n)},it=(a,n,d)=>{const b=a.trim().toLowerCase(),m=n.trim().toLowerCase();return Kt(b,m)},lt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),ii=(a,n,d)=>{const b=lt(a),m=lt(n);return Kt(b,m)},ba=a=>a.trim().toLowerCase(),Ln=a=>a==="reverse"?"reverse":"forward",jt=(a,n)=>`${a}|${n}`,ma=a=>{if(!a)return null;const[n,d]=a.split("|",2);return(n==="forward"||n==="reverse")&&d?{mode:n,fragmentId:d}:{mode:"forward",fragmentId:a}},Ot=(a,n)=>{var b;const d=ma(n);return d?d.fragmentId&&n?(a??null)===n:(((b=ma(a))==null?void 0:b.mode)??"forward")===d.mode:!0},oa=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},ni=(a,n)=>{if((oa(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const b=oa(a.childCheckType),m=oa(a.childDirection),M=oa(n.checkType),v=oa(n.direction);return!(b&&b!==M||m&&m!==v)},Cn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Mn={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},qt=(a,n,d)=>{if(!d||!n.startsWith(a))return n;const b=n.slice(a.length);if(!b)return n;const m=d==="super"?Cn:Mn,M=b.split("").map(v=>m[v]??v).join("");return a+M},Vt=(a,n,d)=>{var v,F,O;if(!a)return((v=n[0])==null?void 0:v.key)??null;const b=new Set(n.map(q=>q.key)),m=/\{([^}]+)\}/g;let M;for(;(M=m.exec(a))!==null;){const q=((F=M[1])==null?void 0:F.trim())??"";if(!q)continue;if(b.has(q))return q;const c=d==null?void 0:d[q];if(c&&b.has(c))return c}return((O=n[0])==null?void 0:O.key)??null},mr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const d=n.description??"";if(!d.trim())return[n];const b=ma(n.direction),m=(b==null?void 0:b.mode)??Ln(n.direction),M=nt(d),v=Object.keys(M.nodes);return v.length===0?[n]:v.map(F=>({...n,checkType:"quote-fragment",direction:jt(m,F)}))});function Sn({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c,collectionId:R}){const f=xr(),j=`/#/cogita/library/${c}`,H=i.useMemo(()=>new URLSearchParams(f.search),[f.search]),J=Math.max(1,Number(H.get("limit")??20)),Y=H.get("mode")??"random",s=i.useMemo(()=>wr(Y),[Y]),h=i.useMemo(()=>Yt(s,Zr(s,H)),[s,H]),x=H.get("check")??"exact",se=H.get("reviewer"),V=i.useMemo(()=>a.cogita.library.revision[s.labelKey]??Y,[a,Y,s]),y=i.useMemo(()=>x==="exact"?a.cogita.library.revision.checkValue:x,[a,x]),[Q,K]=i.useState(a.cogita.library.collections.defaultName),[G,ae]=i.useState([]),[U,be]=i.useState([]),[ke,oe]=i.useState("idle"),[B,ge]=i.useState({current:0,total:0}),[l,re]=i.useState(0),[k,S]=i.useState(""),[ve,_]=i.useState(null),[le,we]=i.useState(null),[Ne,Re]=i.useState(null),[Se,Fe]=i.useState(null),[me,Ve]=i.useState([]),[Ie,We]=i.useState({}),[ia,Le]=i.useState({}),[ee,Te]=i.useState(null),[qe,Pe]=i.useState(null),[de,Ee]=i.useState(null),[Ke,Oe]=i.useState(null),[Ce,L]=i.useState(null),[N,z]=i.useState({}),t=i.useRef(0),[r,u]=i.useState(null),T=i.useRef(null),g=i.useRef(null),[E,D]=i.useState(null),[X,te]=i.useState(!1),[ne,xe]=i.useState(null),[Qe,ze]=i.useState([]),[Ze,Be]=i.useState(null),Ue=i.useRef(null),Ae=i.useRef(null),[Ge,sa]=i.useState(null),[Xe,ea]=i.useState(0),ga=i.useRef(null),Ia=i.useRef({}),[Ka,Je]=i.useState(!1),[la,ot]=i.useState({}),[Pa,st]=i.useState([]),$a=i.useRef(new Map),[ca,Oa]=i.useState(new Set),[Ra,da]=i.useState(!1),He=i.useRef(null),aa=i.useRef(new Set),Aa=i.useRef({}),je=G[l]??null,Tr=(je==null?void 0:je.checkType)==="translation-match"&&Ce,pe=i.useRef(new Map),ct=i.useRef(new Map),qa=i.useRef(new Map),Va=i.useRef(new Map),wt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?Ye(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),dt=i.useMemo(()=>{var p;return s.id!=="levels"?G.length:((p=la.pool)==null?void 0:p.length)??s.getFetchLimit(J,h)},[la,h,s,G.length,J]),Ga=s.getProgressTotal?s.getProgressTotal(G,la,J,h):s.id==="levels"?Math.min(J,dt):G.length,Qt=Ga?Math.min(l+1,Ga):0,pa=Math.max(1,Number(h.tries??1)),_a=h.compare??"anchors",wa=Math.max(0,Math.min(100,Number(h.minCorrectness??0))),na=(h.considerDependencies??"on")==="on",Ta=Math.max(0,Math.min(100,Number(h.dependencyThreshold??85))),ua=o=>{const p=o.slice();for(let C=p.length-1;C>0;C-=1){const W=Math.floor(Math.random()*(C+1));[p[C],p[W]]=[p[W],p[C]]}return p},fa=o=>o.length?o.reduce((C,W)=>C+W,0)/o.length/255*100:0,Xa=o=>fa(o)>=wa,Ua=async()=>{const o=await Sa(),p=new Map,C=new Map,W=new Map;o.forEach(w=>{const Z=`${w.itemType}:${w.itemId}`,ie=Ca(w.itemType,w.itemId,w.checkType,w.direction);if(p.has(Z)||p.set(Z,[]),p.get(Z).push(w),C.has(ie)||C.set(ie,[]),C.get(ie).push(w),w.itemType==="info"&&w.checkType==="quote-fragment"&&w.direction){const he=`${w.itemId}:${w.direction}`;W.has(he)||W.set(he,[]),W.get(he).push(w)}});const I=new Map,P=new Map,A=new Map;return p.forEach((w,Z)=>I.set(Z,Ma(w).score)),C.forEach((w,Z)=>P.set(Z,Ma(w).score)),W.forEach((w,Z)=>A.set(Z,Ma(w).score)),{itemKnowness:I,cardKnowness:P,fragmentKnowness:A}},ut=async o=>{const p=[];let C=null;for(;;){const W=await Rt({libraryId:c,collectionId:o,limit:200,cursor:C});if(p.push(...W.items),!W.nextCursor)break;C=W.nextCursor}return mr(p)},Gt=async(o,p)=>{if($a.current.has(o))return $a.current.get(o)??0;const C=await ut(o);if(C.length===0)return $a.current.set(o,0),0;const I=C.reduce((P,A)=>{const w=ue(A);return P+(p.get(w)??0)},0)/C.length;return $a.current.set(o,I),I},gt=(o,p)=>{if(!na||o.cardType!=="info"||o.infoType!=="quote"||o.checkType!=="quote-fragment")return!0;const C=ma(o.direction);if(!(C!=null&&C.fragmentId))return!0;const W=o.description??"";if(!W.trim())return!0;const P=nt(W).nodes[C.fragmentId];if(!P||!P.leftId&&!P.rightId)return!0;const A=[P.leftId,P.rightId].filter(ie=>!!ie);if(A.length===0)return!0;const w=A.map(ie=>{const he=Ca("info",o.cardId,"quote-fragment",jt(C.mode,ie));return p.get(he)??0});return w.reduce((ie,he)=>ie+he,0)/w.length>=Ta},Tt=async o=>{const p=la,C=o.concat(p.active??[]).concat(p.pool??[]).filter((w,Z,ie)=>ie.findIndex(he=>ue(he)===ue(w))===Z);if(!na){Oa(new Set(C.map(ue)));return}const{itemKnowness:W,cardKnowness:I}=await Ua(),P=Pa.filter(w=>oa(w.childItemType)==="collection"&&w.childItemId===R&&!oa(w.childCheckType)&&!oa(w.childDirection)),A=new Set;for(const w of C){if(w.cardType!=="info"){A.add(ue(w));continue}if(!gt(w,I))continue;const Z=Pa.filter(ce=>ni(ce,w)).concat(P);if(Z.length===0){A.add(ue(w));continue}let ie=0;for(const ce of Z)if(oa(ce.parentItemType)==="collection")ie+=await Gt(ce.parentItemId,I);else if(oa(ce.parentCheckType)||oa(ce.parentDirection)){const ye=oa(ce.parentCheckType),fe=oa(ce.parentDirection),Me=Ca(ce.parentItemType,ce.parentItemId,ye,fe);ie+=I.get(Me)??0}else{const ye=`${ce.parentItemType}:${ce.parentItemId}`;ie+=W.get(ye)??0}ie/Z.length>=Ta&&A.add(ue(w))}Oa(A)},ht=o=>{for(let p=o;p<G.length;p+=1){const C=G[p];if(C&&(!na||C.cardType!=="info"||ca.has(ue(C))))return p}return-1},bt=o=>!na||o.cardType!=="info"||ca.has(ue(o)),Na=o=>{if(s.id!=="temporal"&&s.id!=="levels")return null;const p=la,C=(p.active??[]).concat(p.pool??[]),W=new Set;for(const I of C){const P=ue(I);if(!(W.has(P)||o.has(P))&&(W.add(P),bt(I)))return I}return null},xa=i.useMemo(()=>{if(s.id!=="levels")return null;const o=la,p=o.pool??[],C=o.active??[],W=o.levelMap??{},I=Math.max(1,Number(h.levels??1)),P=Array.from({length:I},()=>0),A=new Set(C.map(he=>ue(he)));p.forEach(he=>{const ce=Math.min(I,Math.max(1,W[ue(he)]??1));P[ce-1]+=1});const w=p.length||1,Z=P.map(he=>he/w*100),ie=je?W[ue(je)]??1:null;return{counts:P,percentages:Z,currentLevel:ie,levelsCount:I,activeCount:C.length,poolCount:p.length,activeSet:A}},[la,h,s,je]),Za=i.useMemo(()=>{if(s.id!=="temporal")return null;const o=la,p=o.pool??[],C=o.active??[],W=o.knownessMap??{},I=new Set(o.unknownSet??[]);let P=0;p.forEach(Z=>{(W[ue(Z)]??0)>1&&(P+=1)});const A=I.size,w=C.map(Z=>({id:ue(Z),value:I.has(ue(Z))?0:Math.max(0,Math.min(1,W[ue(Z)]??0))}));return{knownCount:P,unknownCount:A,dots:w}},[la,s]),va=i.useMemo(()=>{if(!na)return 0;const o=la;return G.concat(o.active??[]).concat(o.pool??[]).filter((C,W,I)=>I.findIndex(P=>ue(P)===ue(C))===W).filter(C=>C.cardType==="info"&&!ca.has(ue(C))).length},[na,la,G,ca]);i.useEffect(()=>{if(!na||ke!=="ready")return;const o=la,C=G.concat(o.active??[]).concat(o.pool??[]).filter((P,A,w)=>w.findIndex(Z=>ue(Z)===ue(P))===A).filter(P=>P.cardType!=="info"||ca.has(ue(P))).length,W=Ue.current;if(Ue.current=C,W===null||C<=W)return;const I=C-W;Be(`New card available (+${I})`),Ae.current&&window.clearTimeout(Ae.current),Ae.current=window.setTimeout(()=>Be(null),2200)},[na,ke,la,G,ca]),i.useEffect(()=>()=>{Ae.current&&window.clearTimeout(Ae.current)},[]);const ha=(o,p)=>{const C=s.applyOutcome({queue:G,meta:la},je,J,h,{correct:o,correctness:p,createdUtc:new Date().toISOString()});ae(C.queue),ot(C.meta);const W=C.queue[l+1];W&&Fa(W,l+1)};i.useEffect(()=>{zt(c,R).then(o=>K(o.name)).catch(()=>K(a.cogita.library.collections.defaultName))},[c,R]),i.useEffect(()=>{Vr({libraryId:c,type:"language"}).then(o=>be(o)).catch(()=>be([]))},[c]),i.useEffect(()=>{Ti({libraryId:c}).then(o=>st(o.items??[])).catch(()=>st([]))},[c]),i.useEffect(()=>{sr(c,se)},[c,se]),i.useEffect(()=>{Tt(G)},[G,Pa,na,Ta,R]),i.useEffect(()=>{if(!je||!na){da(!1);return}if(je.cardType!=="info"||ca.has(ue(je))){da(!1);return}const o=ht(l+1);if(o>=0){da(!1),re(o);return}if(s.id==="temporal"||s.id==="levels"){const p=G.slice(0,l+1),C=G.slice(l+1).filter(bt),W=p.concat(C),I=new Set(W.map(ue)),P=Na(I);if(P){const w=ue(P);I.has(w)||(W.push(P),I.add(w),ot(Z=>{const ie=Z,he=new Set(ie.queued??[]);return he.add(w),{...ie,queued:he}}))}const A=W.findIndex((w,Z)=>Z!==l&&bt(w));if(A>=0){ae(W),re(A),da(!1);return}}da(!0)},[je,ca,na,l,G,la,s.id]),i.useEffect(()=>{let o=!0;return(async()=>{oe("loading"),ge({current:0,total:s.id==="levels"?0:s.getFetchLimit(J,h)});try{const C=[];let W=null,I=null;do{const ce=await Rt({libraryId:c,collectionId:R,limit:300,cursor:W});if(C.push(...ce.items),(s.id==="levels"||s.id==="temporal")&&ce.total&&(I=ce.total),ge(ye=>({current:C.length,total:ye.total||ce.total||s.getFetchLimit(J,h)})),W=ce.nextCursor??null,I!==null&&C.length>=I||s.id!=="levels"&&s.id!=="temporal"&&C.length>=s.getFetchLimit(J,h))break}while(W);if(!o)return;const P=mr(C);let A;if(s.id==="levels"){const ce=Math.max(1,Number(h.levels??1)),fe=(await Sa()).reduce((Me,$e)=>{const _e=Ca($e.itemType,$e.itemId,$e.checkType,$e.direction);return Me[_e]||(Me[_e]=[]),Me[_e].push($e),Me},{});A={},P.forEach(Me=>{const $e=ue(Me),_e=fe[$e]??[],ta=_e.length>0?Ma(_e).score:0,ja=Math.max(1,Math.min(ce,Math.ceil(ta/100*ce)));A[$e]=ja})}let w=null,Z=null,ie=null;if(s.id==="temporal"){const ce=await Sa(),ye=new Set(P.map($e=>ue($e))),fe=ce.reduce(($e,_e)=>{const ta=Ca(_e.itemType,_e.itemId,_e.checkType,_e.direction);return ye.has(ta)&&($e[ta]||($e[ta]=[]),$e[ta].push(_e)),$e},{});w={},Z=new Set,ie={};const Me=Date.now();P.forEach($e=>{const _e=ue($e),ta=fe[_e]??[];if(ta.length===0){w[_e]=0,Z.add(_e),ie[_e]=[];return}const ja=vr(ta);ie[_e]=ja;const li=Ht(ja,Me);w[_e]=li.knowness})}const he=s.id==="levels"?kr(P,J,h,A):s.id==="temporal"?jr(P,J,h,w??{},Z??new Set,ie??{}):s.prepare(P,J,h);ae(he.queue),ot(he.meta),re(0),oe("ready"),ge(ce=>({current:Math.min(ce.current,ce.total),total:ce.total}))}catch{o&&oe("error")}})(),()=>{o=!1}},[c,R,J,h,s,se]),i.useEffect(()=>{if(S(""),_(null),sa(null),ea(0),Ve([]),We({}),Le({}),Pe(null),Ee(null),Oe(null),te(!1),Je(!1),D(null),L(null),z({}),!je){we(null),Re(null),Te(null),xe(null);return}je.cardType==="info"&&je.infoType==="computed"&&we(a.cogita.library.revision.loadingComputed);let o=!0;return Fa(je,l).then(p=>{!o||!p||(we(p.prompt),Re(p.expectedAnswer),Ve(p.computedExpected),We(p.computedAnswers),Te(p.computedValues),Pe(p.answerTemplate),Ee(p.outputVariables),Oe(p.variableValues))}),()=>{o=!1}},[je,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){He.current=null,aa.current=new Set,Fe(null);return}const o=je.description??"",p=(je.label??"").trim(),C=p.replace(/\s+/g," ").trim(),W=o.replace(/\s+/g," ").trim(),I=C&&C!==W?p:a.cogita.library.infoTypes.quote;if(!o){Fe(null),Re(null);return}const P=nt(o);He.current=P,we(I);let A=!0;return Ua().then(({fragmentKnowness:w})=>{if(!A)return;const Z=getQuoteMode(je.direction),ie=new Set,he={};w.forEach((fe,Me)=>{const[$e,_e]=Me.split(":",2);if($e!==je.cardId)return;const ta=ma(_e);if(!ta||ta.mode!==Z)return;const ja=ta.fragmentId;he[ja]=fe,fe>=Ta&&ie.add(ja)}),aa.current=ie,Aa.current=he;const ce=ma(je.direction);if(ce!=null&&ce.fragmentId&&P.nodes[ce.fragmentId]){za(P,ce.fragmentId,I);return}const ye=rt(P,ie,he,Ta,na,je.direction);za(P,(ye==null?void 0:ye.id)??null,I)}).catch(()=>{aa.current=new Set,Aa.current={};const w=ma(je.direction);if(w!=null&&w.fragmentId&&P.nodes[w.fragmentId]){za(P,w.fragmentId,I);return}const Z=rt(P,aa.current,{},Ta,na,je.direction);za(P,(Z==null?void 0:Z.id)??null,I)}),()=>{A=!1}},[je,a,na,Ta]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){L(null),z({});return}const C=(la.pool??la.active??G).filter(w=>w.cardType==="vocab"&&w.checkType==="translation-match").filter((w,Z,ie)=>ie.findIndex(he=>he.cardId===w.cardId)===Z);C.some(w=>w.cardId===je.cardId)||C.unshift(je);const I=ua(C).slice(0,6).map(w=>{const Z=w.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(Z.length<2)return null;const ie=`${w.cardId}:L`,he=`${w.cardId}:R`;return{cardId:w.cardId,leftId:ie,rightId:he,leftLabel:Z[0],rightLabel:Z[1]}}).filter(Boolean),P=I.map(w=>w.leftId),A=ua(I.map(w=>w.rightId));L({pairs:I,leftOrder:P,rightOrder:A,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,G,la]),i.useEffect(()=>()=>{T.current&&window.clearTimeout(T.current),g.current&&window.clearTimeout(g.current)},[]);const Ea=i.useRef(null);i.useEffect(()=>{if(!je)return;const o=ue(je),p=typeof document<"u"?document.activeElement:null;if(Ea.current===o&&p&&(p.tagName==="INPUT"||p.tagName==="TEXTAREA"))return;let C=0;const W=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(me.length>0){const P=Vt(qe,me,de),A=P?Ia.current[P]:null;if(A&&(A.focus(),document.activeElement===A)){Ea.current=o;return}}if(ga.current&&(ga.current.focus(),document.activeElement===ga.current)){Ea.current=o;return}}else if(je.cardType==="vocab"&&ga.current&&(ga.current.focus(),document.activeElement===ga.current)){Ea.current=o;return}C<6&&(C+=1,window.setTimeout(W,40))}},I=window.setTimeout(W,40);return()=>window.clearTimeout(I)},[je,me,qe,de]),i.useEffect(()=>{if(!Ka)return;const o=p=>{p.key==="Enter"&&(p.preventDefault(),ya())};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[Ka]);const Wa=o=>{ze(o),xe(Ma(o))};i.useEffect(()=>{if(!je){xe(null),ze([]);return}const o=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Sa().then(p=>{const C=p.filter(W=>W.itemType==="info"&&W.itemId===je.cardId&&W.checkType==="quote-fragment"&&Ot(W.direction,je.direction));Wa(C)}).catch(()=>{xe(null),ze([])});return}Dt(o,je.cardId,je.checkType,je.direction).then(p=>Wa(p)).catch(()=>{xe(null),ze([])})},[c,je,se]);const mt=(o,p,C,W)=>{if(o==="info"&&C==="quote-fragment"){Sa().then(I=>{const P=I.filter(A=>A.itemType==="info"&&A.itemId===p&&A.checkType==="quote-fragment"&&Ot(A.direction,W));Wa(P)}).catch(()=>{xe(null),ze([])});return}Dt(o,p,C,W).then(I=>Wa(I)).catch(()=>{xe(null),ze([])})},Nt=(o,p,C)=>{var A;const W=((A=C.pairs.find(w=>w.leftId===o))==null?void 0:A.rightId)??null;if(!W)return C;const I=W===p;z(w=>({...w,[o]:I?"correct":"incorrect"})),T.current&&window.clearTimeout(T.current),g.current&&window.clearTimeout(g.current),t.current+=1;const P={kind:I?"correct":"incorrect",tick:t.current};if(u(null),T.current=window.setTimeout(()=>u(P),0),g.current=window.setTimeout(()=>u(null),420),I){const w={...C.locked,[o]:!0};return Object.keys(w).length>=C.pairs.length?(_("correct"),Je(!0)):_("correct"),{...C,selection:{...C.selection,[o]:p},activeLeft:null,activeRight:null,locked:w}}return _("incorrect"),{...C,activeLeft:null,activeRight:null}},Xt=o=>{L(p=>!p||p.locked[o]?p:p.activeRight?Nt(o,p.activeRight,p):{...p,activeLeft:p.activeLeft===o?null:o})},et=o=>{L(p=>p&&(p.activeLeft?Nt(p.activeLeft,o,p):{...p,activeRight:p.activeRight===o?null:o}))},ya=()=>{var o;if(je&&je.cardType==="info"&&je.infoType==="quote"&&He.current&&Se&&!((o=ma(je.direction))!=null&&o.fragmentId)){const p=rt(He.current,aa.current,Aa.current,Ta,na,je.direction,Se.fragmentId);if(p){_(null),S(""),te(!1),Le({}),Je(!1),sa(null),ea(0),za(He.current,p.id,Se.title);return}}_(null),S(""),te(!1),Le({}),Je(!1),sa(null),ea(0),re(p=>Math.min(p+1,G.length))},La=o=>{if(!je)return;const p=o.expected??null,C=o.answer??"";let W=p??"",I=C;if(!p&&o.expectedMap&&o.answerMap){const ce=Object.keys(o.expectedMap).sort((ye,fe)=>ye.localeCompare(fe));W=ce.map(ye=>{var fe;return((fe=o.expectedMap)==null?void 0:fe[ye])??""}).join("|"),I=ce.map(ye=>{var fe;return((fe=o.answerMap)==null?void 0:fe[ye])??""}).join("|")}const P=W?it(W,I,_a):new Uint8Array,A={revisionType:s.id,evalType:o.evalType,direction:o.direction,prompt:le??"",expected:p,answer:C,expectedAnswers:o.expectedMap??null,answers:o.answerMap??null,correct:o.correct,maskBase64:P.length?Ba(P):null,values:ee??null,checkMode:x,compareMode:_a,minCorrectness:wa},w=new TextEncoder().encode(JSON.stringify(A)),Z=je.cardType==="info"?"info":"connection",ie=o.overrideCheckType??je.checkType??null,he=o.overrideDirection??je.direction??null;Bt({itemType:Z,itemId:je.cardId,checkType:ie,direction:he,revisionType:s.id,evalType:o.evalType,correct:o.correct,maskBase64:P.length?Ba(P):null,payloadBase64:Ba(w),personRoleId:se??null}).then(()=>{mt(Z,je.cardId,ie,he),Tt(G),sr(c,se)}).catch(()=>{})},pt=(o,p)=>{const C=pe.current.get(p);if(C)return Promise.resolve(C);const W=ct.current.get(p);if(W)return W;const I=tt({libraryId:c,infoId:o}).then(P=>{var ce,ye;const A=P.payload,w=((ce=A.definition)==null?void 0:ce.graph)??null,Z="",ie=((ye=A.definition)==null?void 0:ye.answerTemplate)??"",he=yr(w,Z,ie);if(he){const Me={sample:Yr(he),answerTemplate:ie||null};return pe.current.set(p,Me),Me}return gr({libraryId:c,infoId:o}).then(fe=>{const Me={sample:fe,answerTemplate:null};return pe.current.set(p,Me),Me})}).catch(()=>gr({libraryId:c,infoId:o}).then(P=>{const A={sample:P,answerTemplate:null};return pe.current.set(p,A),A}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{ct.current.delete(p)});return ct.current.set(p,I),I},Fa=(o,p)=>{var w;const C=`${ue(o)}:${p}`,W=qa.current.get(C);if(W)return Promise.resolve(W);const I=Va.current.get(C);if(I)return I;const P=Z=>(qa.current.set(C,Z),Z);let A;if(o.cardType==="vocab"){if(o.checkType==="translation-match")return A=Promise.resolve(P({prompt:o.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),A;const Z=o.label.split("↔").map(ie=>ie.trim()).filter(Boolean);if(Z.length>=2){const he=(o.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ce=he?Z[0]:Z[1],ye=he?Z[1]:Z[0];A=Promise.resolve(P({prompt:ce,expectedAnswer:ye,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else A=Promise.resolve(P({prompt:o.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(o.cardType==="info"&&o.infoType==="word"){const Z=(w=o.description)!=null&&w.startsWith("Language: ")?o.description.replace("Language: ",""):null;A=Promise.resolve(P({prompt:o.label,expectedAnswer:Z,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else o.cardType==="info"&&o.infoType==="computed"?A=pt(o.cardId,C).then(Z=>{var fe,Me;if(!Z.sample)return P({prompt:o.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ie=Z.sample,he=ie.expectedAnswers?Object.entries(ie.expectedAnswers).map(([$e,_e])=>({key:$e,expected:_e})):[],ce=he.reduce(($e,_e)=>($e[_e.key]="",$e),{}),ye=ie.expectedAnswerIsSentence&&((fe=ie.expectedAnswer)==null?void 0:fe.trim())||null;return P({prompt:ie.prompt,expectedAnswer:he.length>0?ye:((Me=ie.expectedAnswer)==null?void 0:Me.trim())||null,computedExpected:he,computedAnswers:ce,computedValues:ie.values??null,answerTemplate:Z.answerTemplate,outputVariables:ie.outputVariables??null,variableValues:ie.variableValues??null})}).catch(()=>P({prompt:o.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Va.current.delete(C)}):A=Promise.resolve(P({prompt:o.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return Va.current.set(C,A),A},za=(o,p,C)=>{const W=Object.keys(o.nodes).length,I=aa.current.size;if(!p){Fe({title:C,before:o.text,after:"",fragmentId:null,total:W,completed:I}),Re(null),Je(!0);return}const P=o.nodes[p];if(!P)return;const A=Qr(o.text,P);Fe({title:C,before:A.before,after:A.after,fragmentId:P.id,total:W,completed:I}),Re(A.fragment),Je(!1)},at=()=>{const o=He.current;o&&Fe(p=>p&&{...p,total:Object.keys(o.nodes).length,completed:aa.current.size})},Ha=()=>{const o=G[l+1];o&&Fa(o,l+1)},Lt=()=>{if(Ha(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&Ce){if(Ce.pairs.length===0){_("incorrect"),Je(!0);return}const P=Ce.pairs.reduce((ye,fe)=>(ye[fe.rightId]=fe.rightLabel,ye),{});let A=0;const w={};Ce.pairs.forEach(ye=>{const Me=Ce.selection[ye.leftId]===ye.rightId;w[ye.leftId]=Me?"correct":"incorrect",Me&&(A+=1)});const Z=Ce.pairs.length||1,ie=A/Z,he=A===Ce.pairs.length;z(ye=>({...ye,...w})),he?(_("correct"),Je(!0),ea(0)):(_("incorrect"),Je(!1),ea(ye=>{const fe=ye+1;return fe>=pa&&(te(!0),Je(!0),L(Me=>{if(!Me)return Me;const $e=Me.pairs.reduce((_e,ta)=>(_e[ta.leftId]=ta.rightId,_e),{});return{...Me,selection:$e}})),fe})),ha(he,ie);const ce="connection";Promise.all(Ce.pairs.map(ye=>{const fe=Ce.selection[ye.leftId]??null,Me=fe?P[fe]:"",$e={left:ye.leftLabel,expected:ye.rightLabel,answer:Me,checkType:"translation-match"},_e=new TextEncoder().encode(JSON.stringify($e));return Bt({itemType:ce,itemId:ye.cardId,checkType:"translation-match",direction:null,revisionType:s.id,evalType:"translation-match",correct:fe===ye.rightId,maskBase64:null,payloadBase64:Ba(_e),personRoleId:se??null})})).then(()=>{mt(ce,je.cardId,je.checkType,je.direction),sr(c,se)}).catch(()=>{});return}if(me.length>0){const P=me.reduce((w,Z)=>{const ie=Ie[Z.key]??"";return w[Z.key]=ba(ie)===ba(Z.expected)?"correct":"incorrect",w},{});me.every(({key:w,expected:Z})=>{const ie=Ie[w]??"";return x==="exact"&&ba(ie)===ba(Z)})?(_("correct"),Le(P),Je(!0),ea(0),ha(!0,1),La({correct:!0,direction:le?`${le} -> computed`:"computed",expectedMap:me.reduce((w,Z)=>(w[Z.key]=Z.expected,w),{}),answerMap:Ie,evalType:"computed"})):(_("incorrect"),Le(P),Je(!1),ea(w=>{const Z=w+1;return Z>=pa&&$&&(te(!0),Je(!0)),Z}),ha(!1,0),window.setTimeout(()=>{var Z;const w=Vt(qe,me,de);w&&Ia.current[w]&&((Z=Ia.current[w])==null||Z.focus())},40),La({correct:!1,direction:le?`${le} -> computed`:"computed",expectedMap:me.reduce((w,Z)=>(w[Z.key]=Z.expected,w),{}),answerMap:Ie,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Se!=null&&Se.fragmentId)){if(!Ne)return;const P=ma(je.direction),A=(P==null?void 0:P.mode)??getQuoteMode(je.direction),w=P!=null&&P.fragmentId&&je.direction?je.direction:jt(A,Se.fragmentId),Z=ii(Ne,k,_a),ie=x==="exact"&&lt(k)===lt(Ne),he=Xa(Z),ce=ie||he,ye=fa(Z);ce?(Aa.current[Se.fragmentId]=Math.max(Aa.current[Se.fragmentId]??0,ye),(Aa.current[Se.fragmentId]??0)>=Ta&&aa.current.add(Se.fragmentId),at(),_("correct"),Le({}),Je(!0),sa(Z),ea(0),ye<100&&pa<=1&&te(!0),ha(!0,ye/100),La({correct:!0,direction:`quote:${Se.fragmentId}`,expected:Ne,answer:k,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:w})):(_("incorrect"),Le({}),Je(!1),sa(Z),ea(fe=>{const Me=fe+1;return Me>=pa&&$&&(te(!0),Je(!0)),Me}),ha(!1,ye/100),window.setTimeout(()=>{var fe;return(fe=ga.current)==null?void 0:fe.focus()},40),La({correct:!1,direction:`quote:${Se.fragmentId}`,expected:Ne,answer:k,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:w}));return}if(!Ne)return;const o=it(Ne,k,_a),p=x==="exact"&&ba(k)===ba(Ne),C=Xa(o),W=p||C,I=fa(o);W?(_("correct"),Le({}),Je(!0),sa(o),ea(0),I<100&&pa<=1&&te(!0),ha(!0,I/100),La({correct:!0,direction:le?`${le} -> ${Ne}`:null,expected:Ne,answer:k,evalType:"text"})):(_("incorrect"),Le({}),Je(!1),sa(o),ea(P=>{const A=P+1;return A>=pa&&$&&(te(!0),Je(!0)),A}),ha(!1,I/100),window.setTimeout(()=>{var P;return(P=ga.current)==null?void 0:P.focus()},40),La({correct:!1,direction:le?`${le} -> ${Ne}`:null,expected:Ne,answer:k,evalType:"text"}))},Zt=o=>{if(Ha(),!Ne)return;const p=it(Ne,o,_a),C=ba(o)===ba(Ne),W=Xa(p),I=C||W,P=fa(p);I?(_("correct"),Le({}),Je(!0),sa(p),ea(0),P<100&&pa<=1&&te(!0),ha(!0,P/100),La({correct:!0,direction:"word->language",expected:Ne,answer:o,evalType:"language-select"})):(_("incorrect"),Le({}),Je(!1),sa(p),ea(A=>{const w=A+1;return w>=pa&&$&&(te(!0),Je(!0)),w}),ha(!1,P/100),La({correct:!1,direction:"word->language",expected:Ne,answer:o,evalType:"language-select"}))},er=()=>{Ha(),_("correct"),Je(!0),ea(0),ha(!0,1),Ne&&La({correct:!0,direction:"manual",expected:Ne,answer:k,evalType:"manual"})},ar=()=>{if(ha(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){_(null),S(""),te(!1),Le({}),Je(!1),sa(null),ea(0),re(o=>Math.min(o+1,G.length));return}ya()};i.useEffect(()=>{Ha()},[l,G]);const tr=o=>{var C;if(o.key!=="Enter")return;if(o.preventDefault(),o.stopPropagation(),Ka){ya();return}const p=me.find(W=>!(Ie[W.key]??"").trim());if(p){(C=Ia.current[p.key])==null||C.focus();return}Lt()},Ja=a.cogita.library.revision.revealModeAfterIncorrect,$=me.length>0||!!Ne;return e.jsxs(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:[ke==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${B.total?Math.min(100,Math.max(0,B.current/B.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:B.total?`${Math.min(B.current,B.total)} / ${B.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:Q}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",V).replace("{check}",y)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${j}/collections/${R}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ne?`${ne.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[xa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",xa.currentLevel??"-"," / ",xa.levelsCount]}):null,ne?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(ne.correct)).replace("{total}",String(ne.total))}),ne.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(ne.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ai,{outcomes:Qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Ze?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Ze})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":r?`${r.kind}-${r.tick}`:Tr?"idle":ve??"idle",children:je?e.jsx(e.Fragment,{children:Ra?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ei,{copy:a,currentCard:je,currentTypeLabel:wt,prompt:le,languages:U,answer:k,onAnswerChange:o=>S(p=>qt(p,o,E)),computedExpected:me,computedAnswers:Ie,onComputedAnswerChange:(o,p)=>We(C=>({...C,[o]:qt(C[o]??"",p,E)})),answerTemplate:qe,outputVariables:de,variableValues:Ke,computedFieldFeedback:ia,feedback:ve,canAdvance:Ka,quoteContext:Se,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Lt,onSkip:ar,onLanguageSelect:Zt,onMarkReviewed:er,onAdvance:ya,showCorrectAnswer:X,setShowCorrectAnswer:te,onRevealCorrect:()=>Je(!0),answerMask:Ge,expectedAnswer:Ne,hasExpectedAnswer:$,handleComputedKeyDown:tr,answerInputRef:ga,computedInputRefs:Ia,scriptMode:E,setScriptMode:D,matchPairs:Ce==null?void 0:Ce.pairs,matchLeftOrder:Ce==null?void 0:Ce.leftOrder,matchRightOrder:Ce==null?void 0:Ce.rightOrder,matchSelection:Ce==null?void 0:Ce.selection,matchActiveLeft:Ce==null?void 0:Ce.activeLeft,matchActiveRight:Ce==null?void 0:Ce.activeRight,matchFeedback:N,onMatchLeftSelect:Xt,onMatchRightSelect:et})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${j}/collections/${R}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Ga?`${Qt} / ${Ga}`:a.cogita.library.revision.progressUnlimited}),ke==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ke==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ke==="ready"&&G.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Ja}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",pa]})]})]}),xa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",xa.activeCount," / ",xa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:xa.counts.map((o,p)=>{const C=p+1,W=xa.currentLevel===C,I=xa.percentages[p]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":W,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:C}),e.jsx("strong",{children:o})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,I))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[I.toFixed(1),"%"]})]},`level-${C}`)})})]}):null,Za?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:Za.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:Za.dots.map(o=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,o.value*100))}%`,background:`rgba(${Math.round(255*(1-o.value))}, ${Math.round(200*o.value)}, 80, 0.9)`}},o.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:Za.knownCount})]})]}):null,na?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:va})]})}):null]})]})]})})})]})]})}const cr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],In={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Pn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],$n=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Rn({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:c,collectionId:R}){const[f,j]=i.useState(""),[H,J,Y]=pr([]),[s,h,x]=fr([]),[se,V]=i.useState(null),[y,Q]=i.useState(null),[K,G]=i.useState(null),ae=`/#/cogita/library/${c}`;i.useEffect(()=>{zt(c,R).then(l=>j(l.name)).catch(()=>j(a.cogita.library.collections.defaultName))},[c,R,a]),i.useEffect(()=>{Ni({libraryId:c,collectionId:R}).then(l=>{if(!l.graphId||l.graphId==="00000000-0000-0000-0000-000000000000"){J([]),h([]);return}const re=l.nodes.map(S=>{var we;const ve=S.payload??{},_=ve.position??{x:120,y:120},le=ve.params??{};return{id:S.nodeId,type:"default",position:_,data:{nodeType:S.nodeType,label:((we=cr.find(Ne=>Ne.type===S.nodeType))==null?void 0:we.label)??S.nodeType,params:le}}}),k=l.edges.map(S=>({id:S.edgeId,source:S.fromNodeId,target:S.toNodeId,sourceHandle:S.fromPort??void 0,targetHandle:S.toPort??void 0}));J(re),h(k)}).catch(()=>{J([]),h([])})},[c,R,h,J]);const U=i.useMemo(()=>H.find(l=>l.id===se)??null,[H,se]),be=l=>{var ve;const re=crypto.randomUUID(),k=((ve=cr.find(_=>_.type===l))==null?void 0:ve.label)??l,S={...In[l]};J(_=>[..._,{id:re,type:"default",position:{x:120+_.length*40,y:120+_.length*40},data:{nodeType:l,label:k,params:S}}]),V(re)},ke=i.useCallback(l=>{h(re=>yt({...l,id:crypto.randomUUID()},re))},[h]),oe=async()=>{Q(null);try{await zr({libraryId:c,collectionId:R,nodes:H.map(l=>({nodeId:l.id,nodeType:l.data.nodeType,payload:{position:l.position,params:l.data.params}})),edges:s.map(l=>({edgeId:l.id,fromNodeId:l.source,fromPort:l.sourceHandle??null,toNodeId:l.target,toPort:l.targetHandle??null}))}),Q(a.cogita.library.graph.saveSuccess)}catch{Q(a.cogita.library.graph.saveFail)}},B=async()=>{try{const l=await Li({libraryId:c,collectionId:R});G(l)}catch{G(null)}},ge=l=>{U&&J(re=>re.map(k=>k.id===U.id?{...k,data:{...k.data,params:l}}:k))};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${ae}/collections/${R}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:B,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:oe,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:cr.map(l=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>be(l.type),children:l.label},l.type))}),y?e.jsx("p",{className:"cogita-help",children:y}):null,K&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(K.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(K.connections)).replace("{infos}",String(K.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(_t,{nodes:H,edges:s,onNodesChange:Y,onEdgesChange:x,onConnect:ke,onNodeClick:(l,re)=>V(re.id),fitView:!0,children:[e.jsx(Ut,{color:"rgba(120,160,200,0.2)"}),e.jsx(Wt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),U?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:U.data.label}),U.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:U.data.params.tagId?{id:U.data.params.tagId,label:U.data.params.tagLabel??"",infoType:"topic"}:null,onChange:l=>ge({...U.data.params,tagId:(l==null?void 0:l.id)??null,tagLabel:(l==null?void 0:l.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:U.data.params.scope??"any",onChange:l=>ge({...U.data.params,scope:l.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),U.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:c,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:U.data.params.languageId?{id:U.data.params.languageId,label:U.data.params.languageLabel??"",infoType:"language"}:null,onChange:l=>ge({...U.data.params,languageId:(l==null?void 0:l.id)??null,languageLabel:(l==null?void 0:l.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:U.data.params.scope??"any",onChange:l=>ge({...U.data.params,scope:l.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),U.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:U.data.params.infoType??"word",onChange:l=>ge({...U.data.params,infoType:l.target.value}),children:$n.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsx(De,{libraryId:c,infoType:U.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:U.data.params.infoId?{id:U.data.params.infoId,label:U.data.params.infoLabel??"",infoType:U.data.params.infoType??"word"}:null,onChange:l=>ge({...U.data.params,infoId:(l==null?void 0:l.id)??null,infoLabel:(l==null?void 0:l.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),U.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:U.data.params.connectionType??"translation",onChange:l=>ge({...U.data.params,connectionType:l.target.value}),children:Pn.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:U.data.params.connectionId??"",onChange:l=>ge({...U.data.params,connectionId:l.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(U.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const dr="cogita.preferences",En=["library_overview","all_cards","new_card","all_collections","new_collection","dependencies"],Mt={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!1,allowsRevision:!1},new_collection:{requiresCollection:!1,allowsRevision:!1},collection_revision:{requiresCollection:!0,allowsRevision:!0},shared_revisions:{requiresCollection:!0,allowsRevision:!0},dependencies:{requiresCollection:!1,allowsRevision:!1}},Fn=["detail","graph","settings","run","shared"];function An(a){const n=a.split("/").filter(Boolean);if(n[0]!=="cogita"||n[1]!=="library")return{};const d=n[2];if(!d)return{};if(!n[3])return{libraryId:d,target:"library_overview"};if(n[3]==="list")return{libraryId:d,target:"all_cards",cardMode:"list"};if(n[3]==="detail"||n[3]==="collection")return{libraryId:d,target:"all_cards",cardMode:n[3]};if(n[3]==="new"||n[3]==="add")return{libraryId:d,target:"new_card"};if(n[3]==="shared-revisions")return{libraryId:d,target:"all_collections"};if(n[3]==="dependencies")return{libraryId:d,target:"dependencies"};if(n[3]!=="collections")return{libraryId:d,target:"library_overview"};if(n[4]==="new")return{libraryId:d,target:"new_collection"};const b=n[4];return b?n[5]==="graph"?{libraryId:d,target:"collection_revision",collectionId:b,revisionView:"graph"}:n[5]==="shared-revisions"?{libraryId:d,target:"collection_revision",collectionId:b,revisionView:"shared"}:n[5]==="revision"?{libraryId:d,target:"collection_revision",collectionId:b,revisionView:n[6]==="run"?"run":"settings"}:{libraryId:d,target:"collection_revision",collectionId:b,revisionView:"detail"}:{libraryId:d,target:"all_collections"}}function ur(a,n="library_overview",d,b){return a?n==="library_overview"?`/cogita/library/${a}`:n==="all_cards"?`/cogita/library/${a}/list`:n==="new_card"?`/cogita/library/${a}/add`:n==="all_collections"?`/cogita/library/${a}/collections`:n==="new_collection"?`/cogita/library/${a}/collections/new`:n==="shared_revisions"?d?`/cogita/library/${a}/collections/${d}/shared-revisions`:`/cogita/library/${a}/collections`:n==="dependencies"?`/cogita/library/${a}/dependencies`:d?b==="graph"?`/cogita/library/${a}/collections/${d}/graph`:b==="settings"?`/cogita/library/${a}/collections/${d}/revision`:b==="run"?`/cogita/library/${a}/collections/${d}/revision/run`:b==="shared"?`/cogita/library/${a}/collections/${d}/shared-revisions`:`/cogita/library/${a}/collections/${d}`:`/cogita/library/${a}/collections`:"/cogita"}function St(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function Bn(a,n){var F;if(!a.length)return null;const d=a.filter(O=>n.has(O.roleId)),b=d.length>0?d:a,m=b.map(O=>{var c,R;const q=((R=(c=O.fields.find(f=>f.fieldType==="role_kind"))==null?void 0:c.plainValue)==null?void 0:R.toLowerCase())??"";return{roleId:O.roleId,roleKind:q}}),M=m.find(O=>O.roleKind.includes("master"));if(M)return M.roleId;const v=m.find(O=>O.roleKind.includes("account")||O.roleKind.includes("user"));return v?v.roleId:((F=b[0])==null?void 0:F.roleId)??null}function Dn(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Kn({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q}){const c=ci(),R=xr(),f=i.useMemo(()=>An(R.pathname),[R.pathname]),j=a.cogita.workspace,[H,J]=i.useState([]),[Y,s]=i.useState([]),[h,x]=i.useState(void 0),[se,V]=i.useState("library_overview"),[y,Q]=i.useState(void 0),[K,G]=i.useState("detail"),[ae,U]=i.useState(!1),[be,ke]=i.useState(!0),[oe,B]=i.useState(!1),[ge,l]=i.useState(null),[re,k]=i.useState(""),[S,ve]=i.useState(""),[_,le]=i.useState(null),[we,Ne]=i.useState(null),Re=i.useRef({version:1,byLibrary:{}}),Se=i.useRef(!1),Fe=i.useRef(!1),me=i.useRef(null),Ve=i.useMemo(()=>H.find(g=>g.libraryId===h)??null,[H,h]),Ie=i.useMemo(()=>Y.find(g=>g.collectionId===y)??null,[Y,y]),We=i.useMemo(()=>({detail:j.revisions.detail,graph:j.revisions.graph,settings:j.revisions.settings,run:j.revisions.run,shared:j.targets.sharedRevisions}),[j.revisions.detail,j.revisions.graph,j.revisions.run,j.revisions.settings,j.targets.sharedRevisions]),ia=i.useMemo(()=>Fn.map(g=>({value:g,label:We[g]})),[We.detail,We.graph,We.run,We.settings,We.shared]),Le=i.useMemo(()=>({library_overview:j.targets.libraryOverview,all_cards:j.targets.allCards,new_card:j.targets.newCard,all_collections:j.targets.allCollections,new_collection:j.targets.newCollection,collection_revision:j.targets.collectionRevision,shared_revisions:j.targets.sharedRevisions,dependencies:j.targets.dependencies}),[j.targets]),ee=i.useMemo(()=>Le[se]??se,[se,Le]),Te=We[K],qe=!!h,Pe=!!y,de=qe,Ee=Pe,Ke=i.useCallback(g=>{const E=!!g.libraryId;let D=g.target,X=g.collectionId,te=g.revisionView;E?Mt[D].requiresCollection&&!X?(D="all_collections",te="detail"):Mt[D].requiresCollection?Mt[D].allowsRevision||(te="detail"):X=void 0:(D="library_overview",X=void 0,te="detail"),x(g.libraryId),V(D),Q(X),G(te),U(!1);const ne=St(ur(g.libraryId,D,X,te));St(R.pathname)!==ne&&(me.current=ne,c(ne))},[R.pathname,c]),Oe=g=>{Ke({libraryId:h,target:"collection_revision",collectionId:y,revisionView:g})},Ce=i.useMemo(()=>[{key:"library",label:j.layers.library,visible:!0,value:h??"",selectedLabel:(Ve==null?void 0:Ve.name)??j.path.noLibrarySelected,disabled:be||H.length===0,options:H.map(g=>({value:g.libraryId,label:g.name})),emptyOption:j.noLibraryOption,onSelect:g=>{const E=g||void 0;Ke({libraryId:E,target:"library_overview",collectionId:void 0,revisionView:"detail"})}},{key:"target",label:j.layers.target,visible:qe,value:se,selectedLabel:ee,disabled:!qe,options:En.map(g=>({value:g,label:Le[g]})),onSelect:g=>{Ke({libraryId:h,target:g,collectionId:y,revisionView:K})}},{key:"collection",label:j.layers.collection,visible:de,value:y??"",selectedLabel:(Ie==null?void 0:Ie.name)??j.path.noCollectionSelected,disabled:!qe||oe||Y.length===0,options:Y.map(g=>({value:g.collectionId,label:g.name})),emptyOption:j.selectCollectionOption,onSelect:g=>{const E=g||void 0;Ke({libraryId:h,target:E?"collection_revision":se,collectionId:E,revisionView:K})}},{key:"revision",label:j.layers.revision,visible:Ee,value:K,selectedLabel:Te,disabled:!y,options:ia.map(g=>({value:g.value,label:g.label})),onSelect:g=>{Oe(g)}}],[Y,oe,H,be,Ke,ia,Ie,y,Pe,qe,Ve,h,Te,K,se,ee,de,Ee,Le,j.layers.collection,j.layers.library,j.layers.revision,j.layers.target,j.noLibraryOption,j.path.noCollectionSelected,j.path.noLibrarySelected,j.selectCollectionOption]),L=i.useMemo(()=>Ce.filter(g=>g.visible),[Ce]),N=i.useMemo(()=>L.filter(g=>g.key!=="library"&&g.key!=="collection"),[L]),z=i.useMemo(()=>N.find(g=>g.key==="target")??null,[N]),t=i.useMemo(()=>N.find(g=>g.key==="revision")??null,[N]),r=i.useMemo(()=>{const g=f.libraryId;if(!g||!R.pathname.startsWith("/cogita/library/"))return null;const E={copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,libraryId:g};if(f.target==="library_overview")return e.jsx(_i,{...E});if(f.target==="all_cards")return e.jsx(Hi,{...E,mode:f.cardMode??"list"});if(f.target==="new_card")return e.jsx(Xi,{...E});if(f.target==="dependencies")return e.jsx(en,{...E});if(f.target==="shared_revisions")return e.jsx(Ar,{...E});if(f.target==="all_collections")return e.jsx(an,{...E});if(f.target==="new_collection")return e.jsx(ln,{...E,onCreated:D=>c(`/cogita/library/${g}/collections/${D}/graph`)});if(f.target==="collection_revision"&&f.collectionId){const D={...E,collectionId:f.collectionId};return f.revisionView==="graph"?e.jsx(Rn,{...D}):f.revisionView==="shared"?e.jsx(Ar,{...E,collectionId:f.collectionId}):f.revisionView==="settings"?e.jsx(pn,{...D}):f.revisionView==="run"?e.jsx(Sn,{...D}):e.jsx(on,{...D})}return null},[n,a,O,R.pathname,c,q,M,F,b,m,f.cardMode,f.collectionId,f.libraryId,f.revisionView,f.target,v,d]);i.useEffect(()=>{let g=!1;return(async()=>{var D,X,te,ne,xe;ke(!0);try{await Ci();const[Qe,ze,Ze]=await Promise.all([qr(),Mi(),Si()]);if(g)return;J(Qe);const Be=new Set(Ze.nodes.filter(Xe=>Xe.nodeType==="role"&&Xe.canLink).map(Xe=>Xe.roleId??"")),Ue=Bn(ze,Be);if(le(Ue),Ue){const Xe=Ze.nodes.find(ea=>ea.nodeType==="data"&&ea.roleId===Ue&&(ea.fieldType===dr||ea.label===dr));Ne((Xe==null?void 0:Xe.dataKeyId)??null),Re.current=Dn(Xe==null?void 0:Xe.value)}const Ae=Re.current.lastLibraryId,Ge=((D=Qe.find(Xe=>Xe.libraryId===f.libraryId))==null?void 0:D.libraryId)??(Qe.length===1?Qe[0].libraryId:void 0)??((X=Qe.find(Xe=>Xe.libraryId===Ae))==null?void 0:X.libraryId)??((te=Qe[0])==null?void 0:te.libraryId),sa=(Ge&&((xe=(ne=Re.current.byLibrary)==null?void 0:ne[Ge])==null?void 0:xe.lastTarget))??"library_overview";x(Ge),V(f.target??sa),G(f.revisionView??"detail"),Se.current=!0}catch{g||l(j.status.loadFailed)}finally{g||ke(!1)}})(),()=>{g=!0}},[j.status.loadFailed]),i.useLayoutEffect(()=>{Se.current&&(f.libraryId&&H.some(g=>g.libraryId===f.libraryId)&&x(f.libraryId),f.target&&V(f.target),Q(f.collectionId),f.revisionView&&G(f.revisionView))},[H,f.collectionId,f.libraryId,f.revisionView,f.target]),i.useEffect(()=>{if(!h){s([]),Q(void 0);return}let g=!1;return B(!0),$t({libraryId:h,limit:200}).then(E=>{var te;if(g)return;const D=E.items;s(D);const X=(te=D.find(ne=>ne.collectionId===f.collectionId))==null?void 0:te.collectionId;Q(X)}).catch(()=>{g||(s([]),Q(void 0))}).finally(()=>{g||B(!1)}),()=>{g=!0}},[f.collectionId,h]),i.useEffect(()=>{if(!Se.current||f.libraryId&&H.some(D=>D.libraryId===f.libraryId)&&f.libraryId!==h||f.target&&f.target!==se||f.revisionView&&f.revisionView!==K||Mt[se].requiresCollection&&!y&&f.target==="collection_revision"&&f.collectionId)return;const g=St(R.pathname),E=St(ur(h,se,y,K));if(g===E){me.current=null;return}me.current!==E&&(me.current=E,c(E,{replace:!0}))},[H,R.pathname,c,f.collectionId,f.libraryId,f.revisionView,f.target,y,h,K,se]),i.useEffect(()=>{if(typeof window>"u")return;const g=()=>{window.innerWidth>920&&U(!1)};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),i.useEffect(()=>{if(!Se.current||!_||!h||Fe.current)return;const g=Re.current,E={...g.byLibrary??{}},D={...E[h]??{},lastCollectionId:y,lastRevisionView:K,lastTarget:se},X={version:1,lastLibraryId:h,byLibrary:{...E,[h]:D}},te=JSON.stringify(g),ne=JSON.stringify(X);if(te===ne)return;Re.current=X,Fe.current=!0,(async()=>{try{if(we)await Ii(we,{plainValue:ne});else{const Qe=await Pi(_,{itemName:dr,itemType:"data",plainValue:ne});Ne(Qe.dataItemId)}}catch{l(j.status.savePrefsFailed)}finally{Fe.current=!1}})()},[we,_,y,h,K,se,j.status.savePrefsFailed]);const u=async()=>{const g=re.trim();if(!g){l(a.cogita.user.libraryNameRequired);return}l(null);try{const E=await $i({name:g});J(D=>[E,...D]),x(E.libraryId),V("library_overview"),Q(void 0),k("")}catch{l(a.cogita.user.libraryCreateFailed)}},T=async()=>{if(!h){l(j.status.selectLibraryFirst);return}const g=S.trim();if(!g){l(a.cogita.library.collections.saveRequiredName);return}l(null);try{const E=await Wr({libraryId:h,name:g,items:[]}),D=await $t({libraryId:h,limit:200});s(D.items),Q(E.collectionId),V("collection_revision"),G("detail"),ve("")}catch{l(a.cogita.library.collections.saveFail)}};return e.jsx(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${ae?"open":""}`,"aria-label":j.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Ve==null?void 0:Ve.name)??j.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Ve?j.sidebar.libraryActionsHint:j.status.selectLibraryFirst}),z?e.jsx("div",{className:"cogita-sidebar-actions",children:z.options.map(g=>e.jsx("button",{type:"button",className:`ghost ${String(z.value)===g.value?"active":""}`,onClick:()=>z.onSelect(g.value),disabled:z.disabled,children:g.label},`sidebar:target:${g.value}`))}):null]}),Ie?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:Ie.name}),e.jsx("p",{className:"cogita-sidebar-note",children:j.sidebar.collectionActionsHint}),t?e.jsx("div",{className:"cogita-sidebar-actions",children:t.options.map(g=>e.jsx("button",{type:"button",className:`ghost ${String(t.value)===g.value?"active":""}`,onClick:()=>t.onSelect(g.value),disabled:t.disabled,children:g.label},`sidebar:revision:${g.value}`))}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:j.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:b,children:j.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{F("cogita"),U(!1)},children:j.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:m,children:v?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),ae?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":j.sidebar.closeMenu,onClick:()=>U(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":j.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>U(g=>!g),"aria-label":ae?j.sidebar.closeMenu:j.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),L.map((g,E)=>e.jsxs("div",{className:"cogita-browser-segment",children:[E>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,e.jsxs("select",{"aria-label":g.label,value:g.value,onChange:D=>g.onSelect(D.target.value),disabled:g.disabled,children:[g.emptyOption?e.jsx("option",{value:"",children:g.emptyOption}):null,g.options.map(D=>e.jsx("option",{value:D.value,children:D.label},`${g.key}:${D.value}`))]})]},`menu:${g.key}`))]}),r?e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Hr.Provider,{value:!0,children:r})}):null,r?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:j.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[L.map((g,E)=>e.jsxs("span",{children:[E>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:g.selectedLabel})]},`path:${g.key}`)),de?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:j.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[j.path.currentRoute," ",e.jsx("code",{children:ur(h,se,y,K)})]}),h?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${h}`,children:j.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${h}/list`,children:j.links.allCards}),y?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${h}/collections/${y}/shared-revisions`,children:j.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:j.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:re,onChange:g=>k(g.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:u,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:S,onChange:g=>ve(g.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!h})]}),e.jsx("button",{type:"button",className:"cta",onClick:T,disabled:!h,children:a.cogita.library.collections.createAction}),ge?e.jsx("p",{className:"cogita-form-error",children:ge}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:j.panels.collections}),oe?e.jsx("p",{className:"cogita-library-subtitle",children:j.status.loadingCollections}):null,!oe&&Y.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:j.status.noCollections}):null,Y.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:Y.map(g=>e.jsxs("button",{type:"button",className:`cogita-card-item ${g.collectionId===y?"active":""}`,onClick:()=>{Q(g.collectionId),G("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:j.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:g.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[g.itemCount," ",j.cards.itemsSuffix]})]},g.collectionId))}):null]})]})]})]})})}const Wn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Kn},Symbol.toStringTag,{value:"Module"}));function On({copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,shareId:c}){const[R,f]=i.useState(null),[j,H]=i.useState("loading"),[J,Y]=i.useState(a.cogita.library.collections.defaultName),[s,h]=i.useState("Cogita Library"),[x,se]=i.useState([]),[V,y]=i.useState([]),[Q,K]=i.useState("idle"),[G,ae]=i.useState({current:0,total:0}),[U,be]=i.useState(0),[ke,oe]=i.useState(""),[B,ge]=i.useState(null),[l,re]=i.useState(null),[k,S]=i.useState(null),[ve,_]=i.useState(null),[le,we]=i.useState([]),[Ne,Re]=i.useState({}),[Se,Fe]=i.useState({}),[me,Ve]=i.useState(null),[Ie,We]=i.useState(null),[ia,Le]=i.useState(null),[ee,Te]=i.useState(null),[qe,Pe]=i.useState({}),de=i.useRef(0),[Ee,Ke]=i.useState(null),Oe=i.useRef(null),Ce=i.useRef(null),[L,N]=i.useState(null),[z,t]=i.useState(!1),[r,u]=i.useState(null),[T,g]=i.useState([]),[E,D]=i.useState(null),X=i.useRef(null),te=i.useRef(null),[ne,xe]=i.useState(null),[Qe,ze]=i.useState(0),Ze=i.useRef(null),Be=i.useRef({}),[Ue,Ae]=i.useState(!1),[Ge,sa]=i.useState({}),Xe=i.useRef(null),ea=i.useRef(new Set),ga=i.useRef({}),[Ia,Ka]=i.useState([]),[Je,la]=i.useState(new Set),[ot,Pa]=i.useState(!1),st=xr(),$a=i.useMemo(()=>new URLSearchParams(st.search),[st.search]),ca=i.useMemo(()=>$a.get("key")??"",[$a]),Oa=(R==null?void 0:R.mode)??"random",Ra=(R==null?void 0:R.check)??"exact",da=(R==null?void 0:R.limit)??20,He=i.useMemo(()=>wr((R==null?void 0:R.revisionType)??Oa),[R,Oa]),aa=i.useMemo(()=>{const $=R==null?void 0:R.revisionSettings,o=Zr(He,$a);return Yt(He,$??o)},[R,$a,He]),Aa=i.useMemo(()=>a.cogita.library.revision[He.labelKey]??Oa,[a,Oa,He]),je=i.useMemo(()=>Ra==="exact"?a.cogita.library.revision.checkValue:Ra,[a,Ra]),pe=j==="ready"?x[U]??null:null,ct=(pe==null?void 0:pe.checkType)==="translation-match"&&ee,qa=i.useRef(new Map),Va=i.useRef(new Map),wt=i.useRef(new Map),dt=i.useRef(new Map),Ga=i.useMemo(()=>pe?pe.cardType==="vocab"?a.cogita.library.revision.vocabLabel:pe.infoType?Ye(a,pe.infoType):a.cogita.library.revision.infoLabel:"",[a,pe]),Qt=i.useMemo(()=>{var o;return He.id!=="levels"?x.length:((o=Ge.pool)==null?void 0:o.length)??He.getFetchLimit(da,aa)},[Ge,aa,He,x.length,da]),pa=He.getProgressTotal?He.getProgressTotal(x,Ge,da,aa):He.id==="levels"?Math.min(da,Qt):x.length,_a=pa?Math.min(U+1,pa):0,wa=Math.max(1,Number(aa.tries??1)),na=aa.compare??"anchors",Ta=Math.max(0,Math.min(100,Number(aa.minCorrectness??0))),ua=(aa.considerDependencies??"on")==="on",fa=Math.max(0,Math.min(100,Number(aa.dependencyThreshold??85))),Xa=$=>{const o=$.slice();for(let p=o.length-1;p>0;p-=1){const C=Math.floor(Math.random()*(p+1));[o[p],o[C]]=[o[C],o[p]]}return o},Ua=$=>$.length?$.reduce((p,C)=>p+C,0)/$.length/255*100:0,ut=$=>Ua($)>=Ta,Gt=async()=>{const $=await Sa(),o=new Map,p=new Map;$.forEach(I=>{const P=`${I.itemType}:${I.itemId}`,A=Ca(I.itemType,I.itemId,I.checkType,I.direction);o.has(P)||o.set(P,[]),o.get(P).push(I),p.has(A)||p.set(A,[]),p.get(A).push(I)});const C=new Map,W=new Map;return o.forEach((I,P)=>C.set(P,Ma(I).score)),p.forEach((I,P)=>W.set(P,Ma(I).score)),{itemKnowness:C,cardKnowness:W}},gt=async $=>{const o=Ge,p=$.concat(o.active??[]).concat(o.pool??[]).filter((ie,he,ce)=>ce.findIndex(ye=>ue(ye)===ue(ie))===he);if(!ua){la(new Set(p.map(ue)));return}const{itemKnowness:C,cardKnowness:W}=await Gt(),I=ie=>{if(ie.cardType!=="info"||ie.infoType!=="quote"||ie.checkType!=="quote-fragment")return!0;const he=ma(ie.direction);if(!(he!=null&&he.fragmentId))return!0;const ce=ie.description??"";if(!ce.trim())return!0;const fe=nt(ce).nodes[he.fragmentId];if(!fe||!fe.leftId&&!fe.rightId)return!0;const Me=[fe.leftId,fe.rightId].filter(ta=>!!ta);if(Me.length===0)return!0;const $e=Me.map(ta=>{const ja=Ca("info",ie.cardId,"quote-fragment",jt(he.mode,ta));return W.get(ja)??0});return $e.reduce((ta,ja)=>ta+ja,0)/$e.length>=fa},P=(R==null?void 0:R.collectionId)??null,A=P?Ia.filter(ie=>oa(ie.childItemType)==="collection"&&ie.childItemId===P&&!oa(ie.childCheckType)&&!oa(ie.childDirection)):[],w=P&&p.length>0?p.reduce((ie,he)=>ie+(W.get(ue(he))??0),0)/p.length:0,Z=new Set;for(const ie of p){if(ie.cardType!=="info"){Z.add(ue(ie));continue}if(!I(ie))continue;const he=Ia.filter(fe=>ni(fe,ie)).concat(A);if(he.length===0){Z.add(ue(ie));continue}let ce=0;for(const fe of he)if(oa(fe.parentItemType)==="collection")ce+=fe.parentItemId===P?w:0;else if(oa(fe.parentCheckType)||oa(fe.parentDirection)){const Me=oa(fe.parentCheckType),$e=oa(fe.parentDirection),_e=Ca(fe.parentItemType,fe.parentItemId,Me,$e);ce+=W.get(_e)??0}else{const Me=`${fe.parentItemType}:${fe.parentItemId}`;ce+=C.get(Me)??0}ce/he.length>=fa&&Z.add(ue(ie))}la(Z)},Tt=$=>{for(let o=$;o<x.length;o+=1){const p=x[o];if(p&&(!ua||p.cardType!=="info"||Je.has(ue(p))))return o}return-1},ht=$=>!ua||$.cardType!=="info"||Je.has(ue($)),bt=$=>{if(He.id!=="temporal"&&He.id!=="levels")return null;const o=Ge,p=(o.active??[]).concat(o.pool??[]),C=new Set;for(const W of p){const I=ue(W);if(!(C.has(I)||$.has(I))&&(C.add(I),ht(W)))return W}return null},Na=i.useMemo(()=>{if(He.id!=="levels")return null;const $=Ge,o=$.pool??[],p=$.active??[],C=$.levelMap??{},W=Math.max(1,Number(aa.levels??1)),I=Array.from({length:W},()=>0),P=new Set(p.map(ie=>ue(ie)));o.forEach(ie=>{const he=Math.min(W,Math.max(1,C[ue(ie)]??1));I[he-1]+=1});const A=o.length||1,w=I.map(ie=>ie/A*100),Z=pe?C[ue(pe)]??1:null;return{counts:I,percentages:w,currentLevel:Z,levelsCount:W,activeCount:p.length,poolCount:o.length,activeSet:P}},[Ge,aa,He,pe]),xa=i.useMemo(()=>{if(He.id!=="temporal")return null;const $=Ge,o=$.pool??[],p=$.active??[],C=$.knownessMap??{},W=new Set($.unknownSet??[]);let I=0;o.forEach(w=>{(C[ue(w)]??0)>1&&(I+=1)});const P=W.size,A=p.map(w=>({id:ue(w),value:W.has(ue(w))?0:Math.max(0,Math.min(1,C[ue(w)]??0))}));return{knownCount:I,unknownCount:P,dots:A}},[Ge,He]),Za=i.useMemo(()=>{if(!ua)return 0;const $=Ge;return x.concat($.active??[]).concat($.pool??[]).filter((p,C,W)=>W.findIndex(I=>ue(I)===ue(p))===C).filter(p=>p.cardType==="info"&&!Je.has(ue(p))).length},[ua,Ge,x,Je]);i.useEffect(()=>{if(!ua||Q!=="ready")return;const $=Ge,p=x.concat($.active??[]).concat($.pool??[]).filter((I,P,A)=>A.findIndex(w=>ue(w)===ue(I))===P).filter(I=>I.cardType!=="info"||Je.has(ue(I))).length,C=X.current;if(X.current=p,C===null||p<=C)return;const W=p-C;D(`New card available (+${W})`),te.current&&window.clearTimeout(te.current),te.current=window.setTimeout(()=>D(null),2200)},[ua,Q,Ge,x,Je]),i.useEffect(()=>()=>{te.current&&window.clearTimeout(te.current)},[]);const va=($,o)=>{const p=He.applyOutcome({queue:x,meta:Ge},pe,da,aa,{correct:$,correctness:o,createdUtc:new Date().toISOString()});se(p.queue),sa(p.meta);const C=p.queue[U+1];C&&pt(C,U+1)};i.useEffect(()=>{if(!c){H("error");return}H("loading"),Ri({shareId:c,key:ca}).then($=>{f($),Y($.collectionName),h($.libraryName),H("ready")}).catch(()=>{H("error")})},[c,ca]),i.useEffect(()=>{c&&Ei({shareId:c,key:ca,type:"language"}).then($=>y($)).catch(()=>y([]))},[c,ca]),i.useEffect(()=>{!c||j!=="ready"||Fi({shareId:c,key:ca}).then($=>Ka($.items??[])).catch(()=>Ka([]))},[c,ca,j]),i.useEffect(()=>{if(!c||j!=="ready")return;let $=!0;return(async()=>{K("loading"),ae({current:0,total:He.id==="levels"?0:He.getFetchLimit(da,aa)});try{const p=[];let C=null,W=null;do{const he=await Ai({shareId:c,key:ca,limit:300,cursor:C});if(p.push(...he.items),(He.id==="levels"||He.id==="temporal")&&he.total&&(W=he.total),ae(ce=>({current:p.length,total:ce.total||he.total||He.getFetchLimit(da,aa)})),C=he.nextCursor??null,W!==null&&p.length>=W||He.id!=="levels"&&He.id!=="temporal"&&p.length>=He.getFetchLimit(da,aa))break}while(C);if(!$)return;const I=mr(p);let P;if(He.id==="levels"){const he=Math.max(1,Number(aa.levels??1));P={},I.forEach(ce=>{const ye=ue(ce);P[ye]=Math.max(1,Math.min(he,1))})}let A=null,w=null,Z=null;if(He.id==="temporal"){const he=await Sa(),ce=new Set(I.map(Me=>ue(Me))),ye=he.reduce((Me,$e)=>{const _e=Ca($e.itemType,$e.itemId,$e.checkType,$e.direction);return ce.has(_e)&&(Me[_e]||(Me[_e]=[]),Me[_e].push($e)),Me},{});A={},w=new Set,Z={};const fe=Date.now();I.forEach(Me=>{const $e=ue(Me),_e=ye[$e]??[];if(_e.length===0){A[$e]=0,w.add($e),Z[$e]=[];return}const ta=vr(_e);Z[$e]=ta;const ja=Ht(ta,fe);A[$e]=ja.knowness})}const ie=He.id==="levels"?kr(I,da,aa,P):He.id==="temporal"?jr(I,da,aa,A??{},w??new Set,Z??{}):He.prepare(I,da,aa);se(ie.queue),sa(ie.meta),be(0),K("ready"),ae(he=>({current:Math.min(he.current,he.total),total:he.total}))}catch{$&&K("error")}})(),()=>{$=!1}},[c,ca,da,He,aa,j]),i.useEffect(()=>{gt(x)},[x,Ia,ua,fa,R==null?void 0:R.collectionId]),i.useEffect(()=>{if(!pe||!ua){Pa(!1);return}if(pe.cardType!=="info"||Je.has(ue(pe))){Pa(!1);return}const $=Tt(U+1);if($>=0){Pa(!1),be($);return}if(He.id==="temporal"||He.id==="levels"){const o=x.slice(0,U+1),p=x.slice(U+1).filter(ht),C=o.concat(p),W=new Set(C.map(ue)),I=bt(W);if(I){const A=ue(I);W.has(A)||(C.push(I),W.add(A),sa(w=>{const Z=w,ie=new Set(Z.queued??[]);return ie.add(A),{...Z,queued:ie}}))}const P=C.findIndex((A,w)=>w!==U&&ht(A));if(P>=0){se(C),be(P),Pa(!1);return}}Pa(!0)},[pe,Je,ua,U,x,Ge,He.id]),i.useEffect(()=>{if(oe(""),ge(null),xe(null),ze(0),we([]),Re({}),Fe({}),Ve(null),We(null),Le(null),t(!1),Ae(!1),N(null),Te(null),Pe({}),!pe){re(null),S(null);return}pe.cardType==="info"&&pe.infoType==="computed"&&re(a.cogita.library.revision.loadingComputed);let $=!0;return pt(pe,U).then(o=>{!$||!o||(re(o.prompt),S(o.expectedAnswer),we(o.computedExpected),Re(o.computedAnswers),Ve(o.answerTemplate),We(o.outputVariables),Le(o.variableValues))}),()=>{$=!1}},[pe,c,a]),i.useEffect(()=>{if(!pe||pe.cardType!=="info"||pe.infoType!=="quote"){Xe.current=null,ea.current=new Set,_(null);return}const $=pe.description??"",o=(pe.label??"").trim(),p=o.replace(/\s+/g," ").trim(),C=$.replace(/\s+/g," ").trim(),W=p&&p!==C?o:a.cogita.library.infoTypes.quote;if(!$){_(null),S(null);return}const I=nt($);Xe.current=I,re(W);let P=!0;return Sa().then(A=>{if(!P)return;const w=getQuoteMode(pe.direction),Z=new Map;A.forEach(fe=>{if(fe.itemType!=="info"||fe.checkType!=="quote-fragment"||!fe.direction)return;const Me=ma(fe.direction);if(!Me||Me.mode!==w)return;const $e=`${fe.itemId}:${Me.fragmentId}`;Z.has($e)||Z.set($e,[]),Z.get($e).push(fe)});const ie={},he=new Set;Z.forEach((fe,Me)=>{const[$e,_e]=Me.split(":",2);if($e!==pe.cardId)return;const ta=Ma(fe).score;ie[_e]=ta,ta>=fa&&he.add(_e)}),ea.current=he,ga.current=ie;const ce=ma(pe.direction);if(ce!=null&&ce.fragmentId&&I.nodes[ce.fragmentId]){Fa(I,ce.fragmentId,W);return}const ye=rt(I,he,ie,fa,ua,pe.direction);Fa(I,(ye==null?void 0:ye.id)??null,W)}).catch(()=>{ea.current=new Set,ga.current={};const A=ma(pe.direction);if(A!=null&&A.fragmentId&&I.nodes[A.fragmentId]){Fa(I,A.fragmentId,W);return}const w=rt(I,ea.current,{},fa,ua,pe.direction);Fa(I,(w==null?void 0:w.id)??null,W)}),()=>{P=!1}},[pe,a,ua,fa]),i.useEffect(()=>{if(!pe||pe.cardType!=="vocab"||pe.checkType!=="translation-match"){Te(null),Pe({});return}const p=(Ge.pool??Ge.active??x).filter(A=>A.cardType==="vocab"&&A.checkType==="translation-match").filter((A,w,Z)=>Z.findIndex(ie=>ie.cardId===A.cardId)===w);p.some(A=>A.cardId===pe.cardId)||p.unshift(pe);const W=Xa(p).slice(0,6).map(A=>{const w=A.label.split("↔").map(he=>he.trim()).filter(Boolean);if(w.length<2)return null;const Z=`${A.cardId}:L`,ie=`${A.cardId}:R`;return{cardId:A.cardId,leftId:Z,rightId:ie,leftLabel:w[0],rightLabel:w[1]}}).filter(Boolean),I=W.map(A=>A.leftId),P=Xa(W.map(A=>A.rightId));Te({pairs:W,leftOrder:I,rightOrder:P,selection:{},activeLeft:null,activeRight:null,locked:{}})},[pe,x,Ge]),i.useEffect(()=>()=>{Oe.current&&window.clearTimeout(Oe.current),Ce.current&&window.clearTimeout(Ce.current)},[]);const ha=i.useRef(null);i.useEffect(()=>{if(!pe)return;const $=ue(pe),o=typeof document<"u"?document.activeElement:null;if(ha.current===$&&o&&(o.tagName==="INPUT"||o.tagName==="TEXTAREA"))return;let p=0;const C=()=>{if(pe){if(pe.cardType==="info"&&pe.infoType==="computed"){if(le.length>0){const I=Vt(me,le,Ie),P=I?Be.current[I]:null;if(P&&(P.focus(),document.activeElement===P)){ha.current=$;return}}if(Ze.current&&(Ze.current.focus(),document.activeElement===Ze.current)){ha.current=$;return}}else if(pe.cardType==="vocab"&&Ze.current&&(Ze.current.focus(),document.activeElement===Ze.current)){ha.current=$;return}p<6&&(p+=1,window.setTimeout(C,40))}},W=window.setTimeout(C,40);return()=>window.clearTimeout(W)},[pe,le,me,Ie]),i.useEffect(()=>{if(!Ue)return;const $=o=>{o.key==="Enter"&&(o.preventDefault(),et())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[Ue]);const Ea=$=>{g($),u(Ma($))};i.useEffect(()=>{if(!pe){u(null),g([]);return}const $=pe.cardType==="info"?"info":"connection";if(pe.cardType==="info"&&pe.infoType==="quote"){Sa().then(o=>{const p=o.filter(C=>C.itemType==="info"&&C.itemId===pe.cardId&&C.checkType==="quote-fragment"&&Ot(C.direction,pe.direction));Ea(p)}).catch(()=>{u(null),g([])});return}Dt($,pe.cardId,pe.checkType,pe.direction).then(o=>Ea(o)).catch(()=>{u(null),g([])})},[pe]);const Wa=($,o,p,C)=>{if($==="info"&&p==="quote-fragment"){Sa().then(W=>{const I=W.filter(P=>P.itemType==="info"&&P.itemId===o&&P.checkType==="quote-fragment"&&Ot(P.direction,C));Ea(I)}).catch(()=>{u(null),g([])});return}Dt($,o,p,C).then(W=>Ea(W)).catch(()=>{u(null),g([])})},mt=($,o,p)=>{var P;const C=((P=p.pairs.find(A=>A.leftId===$))==null?void 0:P.rightId)??null;if(!C)return p;const W=C===o;Pe(A=>({...A,[$]:W?"correct":"incorrect"})),Oe.current&&window.clearTimeout(Oe.current),Ce.current&&window.clearTimeout(Ce.current),de.current+=1;const I={kind:W?"correct":"incorrect",tick:de.current};if(Ke(null),Oe.current=window.setTimeout(()=>Ke(I),0),Ce.current=window.setTimeout(()=>Ke(null),420),W){const A={...p.locked,[$]:!0};return Object.keys(A).length>=p.pairs.length?(ge("correct"),Ae(!0)):ge("correct"),{...p,selection:{...p.selection,[$]:o},activeLeft:null,activeRight:null,locked:A}}return ge("incorrect"),{...p,activeLeft:null,activeRight:null}},Nt=$=>{Te(o=>!o||o.locked[$]?o:o.activeRight?mt($,o.activeRight,o):{...o,activeLeft:o.activeLeft===$?null:$})},Xt=$=>{Te(o=>o&&(o.activeLeft?mt(o.activeLeft,$,o):{...o,activeRight:o.activeRight===$?null:$}))},et=()=>{var $;if(pe&&pe.cardType==="info"&&pe.infoType==="quote"&&Xe.current&&ve&&!(($=ma(pe.direction))!=null&&$.fragmentId)){const o=rt(Xe.current,ea.current,ga.current,fa,ua,pe.direction,ve.fragmentId);if(o){ge(null),oe(""),t(!1),Fe({}),Ae(!1),xe(null),ze(0),Fa(Xe.current,o.id,ve.title);return}}ge(null),oe(""),t(!1),Fe({}),Ae(!1),xe(null),ze(0),be(o=>Math.min(o+1,x.length))},ya=$=>{if(!pe)return;const o=$.expected??null,p=$.answer??"";let C=o??"",W=p;if(!o&&$.expectedMap&&$.answerMap){const he=Object.keys($.expectedMap).sort((ce,ye)=>ce.localeCompare(ye));C=he.map(ce=>{var ye;return((ye=$.expectedMap)==null?void 0:ye[ce])??""}).join("|"),W=he.map(ce=>{var ye;return((ye=$.answerMap)==null?void 0:ye[ce])??""}).join("|")}const I=C?it(C,W,na):new Uint8Array,P={revisionType:He.id,evalType:$.evalType,direction:$.direction,prompt:l??"",expected:o,answer:p,expectedAnswers:$.expectedMap??null,answers:$.answerMap??null,correct:$.correct,maskBase64:I.length?Ba(I):null,checkMode:Ra,compareMode:na,minCorrectness:Ta},A=new TextEncoder().encode(JSON.stringify(P)),w=pe.cardType==="info"?"info":"connection",Z=$.overrideCheckType??pe.checkType??null,ie=$.overrideDirection??pe.direction??null;Bt({itemType:w,itemId:pe.cardId,checkType:Z,direction:ie,revisionType:He.id,evalType:$.evalType,correct:$.correct,maskBase64:I.length?Ba(I):null,payloadBase64:Ba(A)}).then(()=>{Wa(w,pe.cardId,Z,ie),gt(x)}).catch(()=>{})},La=($,o)=>{const p=qa.current.get(o);if(p)return Promise.resolve(p);const C=Va.current.get(o);if(C)return C;const W=Bi({shareCode:c,infoId:$,key:ca}).then(I=>{var he,ce;const P=I.payload,A=((he=P.definition)==null?void 0:he.graph)??null,w="",Z=((ce=P.definition)==null?void 0:ce.answerTemplate)??"",ie=yr(A,w,Z);if(ie){const fe={sample:Yr(ie),answerTemplate:Z||null};return qa.current.set(o,fe),fe}return Mr({shareId:c,infoId:$,key:ca}).then(ye=>{const fe={sample:ye,answerTemplate:null};return qa.current.set(o,fe),fe})}).catch(()=>Mr({shareId:c,infoId:$,key:ca}).then(I=>{const P={sample:I,answerTemplate:null};return qa.current.set(o,P),P}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Va.current.delete(o)});return Va.current.set(o,W),W},pt=($,o)=>{var A;const p=`${ue($)}:${o}`,C=wt.current.get(p);if(C)return Promise.resolve(C);const W=dt.current.get(p);if(W)return W;const I=w=>(wt.current.set(p,w),w);let P;if($.cardType==="vocab"){if($.checkType==="translation-match")return P=Promise.resolve(I({prompt:$.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),P;const w=$.label.split("↔").map(Z=>Z.trim()).filter(Boolean);if(w.length>=2){const ie=($.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",he=ie?w[0]:w[1],ce=ie?w[1]:w[0];P=Promise.resolve(I({prompt:he,expectedAnswer:ce,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else P=Promise.resolve(I({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if($.cardType==="info"&&$.infoType==="word"){const w=(A=$.description)!=null&&A.startsWith("Language: ")?$.description.replace("Language: ",""):null;P=Promise.resolve(I({prompt:$.label,expectedAnswer:w,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else $.cardType==="info"&&$.infoType==="computed"?P=La($.cardId,p).then(w=>{var ye,fe;if(!w.sample)return I({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const Z=w.sample,ie=Z.expectedAnswers?Object.entries(Z.expectedAnswers).map(([Me,$e])=>({key:Me,expected:$e})):[],he=ie.reduce((Me,$e)=>(Me[$e.key]="",Me),{}),ce=Z.expectedAnswerIsSentence&&((ye=Z.expectedAnswer)==null?void 0:ye.trim())||null;return I({prompt:Z.prompt,expectedAnswer:ie.length>0?ce:((fe=Z.expectedAnswer)==null?void 0:fe.trim())||null,computedExpected:ie,computedAnswers:he,answerTemplate:w.answerTemplate,outputVariables:Z.outputVariables??null,variableValues:Z.variableValues??null})}).catch(()=>I({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{dt.current.delete(p)}):P=Promise.resolve(I({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return dt.current.set(p,P),P},Fa=($,o,p)=>{const C=Object.keys($.nodes).length,W=ea.current.size;if(!o){_({title:p,before:$.text,after:"",fragmentId:null,total:C,completed:W}),S(null),Ae(!0);return}const I=$.nodes[o];if(!I)return;const P=Qr($.text,I);_({title:p,before:P.before,after:P.after,fragmentId:I.id,total:C,completed:W}),S(P.fragment),Ae(!1)},za=()=>{const $=Xe.current;$&&_(o=>o&&{...o,total:Object.keys($.nodes).length,completed:ea.current.size})},at=()=>{const $=x[U+1];$&&pt($,U+1)},Ha=()=>{if(at(),pe&&pe.cardType==="vocab"&&pe.checkType==="translation-match"&&ee){if(ee.pairs.length===0){ge("incorrect"),Ae(!0);return}const I=ee.pairs.reduce((ce,ye)=>(ce[ye.rightId]=ye.rightLabel,ce),{});let P=0;const A={};ee.pairs.forEach(ce=>{const fe=ee.selection[ce.leftId]===ce.rightId;A[ce.leftId]=fe?"correct":"incorrect",fe&&(P+=1)});const w=ee.pairs.length||1,Z=P/w,ie=P===ee.pairs.length;Pe(ce=>({...ce,...A})),ie?(ge("correct"),Ae(!0),ze(0)):(ge("incorrect"),Ae(!1),ze(ce=>{const ye=ce+1;return ye>=wa&&(t(!0),Ae(!0),Te(fe=>{if(!fe)return fe;const Me=fe.pairs.reduce(($e,_e)=>($e[_e.leftId]=_e.rightId,$e),{});return{...fe,selection:Me}})),ye})),va(ie,Z);const he="connection";Promise.all(ee.pairs.map(ce=>{const ye=ee.selection[ce.leftId]??null,fe=ye?I[ye]:"",Me={left:ce.leftLabel,expected:ce.rightLabel,answer:fe,checkType:"translation-match"},$e=new TextEncoder().encode(JSON.stringify(Me));return Bt({itemType:he,itemId:ce.cardId,checkType:"translation-match",direction:null,revisionType:He.id,evalType:"translation-match",correct:ye===ce.rightId,maskBase64:null,payloadBase64:Ba($e)})})).then(()=>{Wa(he,pe.cardId,pe.checkType,pe.direction),gt(x)}).catch(()=>{});return}if(le.length>0){const I=le.reduce((A,w)=>{const Z=Ne[w.key]??"";return A[w.key]=ba(Z)===ba(w.expected)?"correct":"incorrect",A},{});le.every(({key:A,expected:w})=>{const Z=Ne[A]??"";return Ra==="exact"&&ba(Z)===ba(w)})?(ge("correct"),Fe(I),Ae(!0),ze(0),va(!0,1),ya({correct:!0,direction:l?`${l} -> computed`:"computed",expectedMap:le.reduce((A,w)=>(A[w.key]=w.expected,A),{}),answerMap:Ne,evalType:"computed"})):(ge("incorrect"),Fe(I),Ae(!1),ze(A=>{const w=A+1;return w>=wa&&Ja&&(t(!0),Ae(!0)),w}),va(!1,0),window.setTimeout(()=>{var w;const A=Vt(me,le,Ie);A&&Be.current[A]&&((w=Be.current[A])==null||w.focus())},40),ya({correct:!1,direction:l?`${l} -> computed`:"computed",expectedMap:le.reduce((A,w)=>(A[w.key]=w.expected,A),{}),answerMap:Ne,evalType:"computed"}));return}if(pe&&pe.cardType==="info"&&pe.infoType==="quote"&&(ve!=null&&ve.fragmentId)){if(!k)return;const I=ma(pe.direction),P=(I==null?void 0:I.mode)??getQuoteMode(pe.direction),A=I!=null&&I.fragmentId&&pe.direction?pe.direction:jt(P,ve.fragmentId),w=ii(k,ke,na),Z=Ra==="exact"&&lt(ke)===lt(k),ie=ut(w),he=Z||ie,ce=Ua(w);he?(ga.current[ve.fragmentId]=Math.max(ga.current[ve.fragmentId]??0,ce),(ga.current[ve.fragmentId]??0)>=fa&&ea.current.add(ve.fragmentId),za(),ge("correct"),Fe({}),Ae(!0),xe(w),ze(0),ce<100&&wa<=1&&t(!0),va(!0,ce/100),ya({correct:!0,direction:`quote:${ve.fragmentId}`,expected:k,answer:ke,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:A})):(ge("incorrect"),Fe({}),Ae(!1),xe(w),ze(ye=>{const fe=ye+1;return fe>=wa&&Ja&&(t(!0),Ae(!0)),fe}),va(!1,ce/100),window.setTimeout(()=>{var ye;return(ye=Ze.current)==null?void 0:ye.focus()},40),ya({correct:!1,direction:`quote:${ve.fragmentId}`,expected:k,answer:ke,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:A}));return}if(!k)return;const $=it(k,ke,na),o=Ra==="exact"&&ba(ke)===ba(k),p=ut($),C=o||p,W=Ua($);C?(ge("correct"),Fe({}),Ae(!0),xe($),ze(0),W<100&&wa<=1&&t(!0),va(!0,W/100),ya({correct:!0,direction:l?`${l} -> ${k}`:null,expected:k,answer:ke,evalType:"text"})):(ge("incorrect"),Fe({}),Ae(!1),xe($),ze(I=>{const P=I+1;return P>=wa&&Ja&&(t(!0),Ae(!0)),P}),va(!1,W/100),window.setTimeout(()=>{var I;return(I=Ze.current)==null?void 0:I.focus()},40),ya({correct:!1,direction:l?`${l} -> ${k}`:null,expected:k,answer:ke,evalType:"text"}))},Lt=$=>{if(at(),!k)return;const o=it(k,$,na),p=ba($)===ba(k),C=ut(o),W=p||C,I=Ua(o);W?(ge("correct"),Fe({}),Ae(!0),xe(o),ze(0),I<100&&wa<=1&&t(!0),va(!0,I/100),ya({correct:!0,direction:"word->language",expected:k,answer:$,evalType:"language-select"})):(ge("incorrect"),Fe({}),Ae(!1),xe(o),ze(P=>{const A=P+1;return A>=wa&&Ja&&(t(!0),Ae(!0)),A}),va(!1,I/100),ya({correct:!1,direction:"word->language",expected:k,answer:$,evalType:"language-select"}))},Zt=$=>{var p;if($.key!=="Enter")return;if($.preventDefault(),$.stopPropagation(),Ue){et();return}const o=le.find(C=>!(Ne[C.key]??"").trim());if(o){(p=Be.current[o.key])==null||p.focus();return}Ha()},er=()=>{at(),ge("correct"),Ae(!0),ze(0),va(!0,1),k&&ya({correct:!0,direction:"manual",expected:k,answer:ke,evalType:"manual"})},ar=()=>{if(va(!1,0),pe&&pe.cardType==="info"&&pe.infoType==="quote"){ge(null),oe(""),t(!1),Fe({}),Ae(!1),xe(null),ze(0),be($=>Math.min($+1,x.length));return}et()};i.useEffect(()=>{at()},[U,x]);const tr=a.cogita.library.revision.revealModeAfterIncorrect,Ja=le.length>0||!!k;return e.jsxs(ka,{copy:a,authLabel:n,showProfileMenu:d,onProfileNavigate:b,onToggleSecureMode:m,onLogout:M,secureMode:v,onNavigate:F,language:O,onLanguageChange:q,children:[(j==="loading"||Q==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:j==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${G.total?Math.min(100,Math.max(0,G.current/G.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:G.total?`${Math.min(G.current,G.total)} / ${G.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:J}),e.jsx("p",{className:"cogita-library-subtitle",children:s}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",Aa).replace("{check}",je)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Na?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Na.currentLevel??"-"," / ",Na.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ai,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[E?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:E})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Ee?`${Ee.kind}-${Ee.tick}`:ct?"idle":B??"idle",children:j!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:j==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):pe?e.jsx(e.Fragment,{children:ot?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ei,{copy:a,currentCard:pe,currentTypeLabel:Ga,prompt:l,languages:V,answer:ke,onAnswerChange:$=>oe(o=>qt(o,$,L)),computedExpected:le,computedAnswers:Ne,onComputedAnswerChange:($,o)=>Re(p=>({...p,[$]:qt(p[$]??"",o,L)})),answerTemplate:me,outputVariables:Ie,variableValues:ia,computedFieldFeedback:Se,feedback:B,canAdvance:Ue,quoteContext:ve,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ha,onSkip:ar,onLanguageSelect:Lt,onMarkReviewed:er,onAdvance:et,showCorrectAnswer:z,setShowCorrectAnswer:t,onRevealCorrect:()=>Ae(!0),answerMask:ne,expectedAnswer:k,hasExpectedAnswer:Ja,handleComputedKeyDown:Zt,answerInputRef:Ze,computedInputRefs:Be,scriptMode:L,setScriptMode:N,matchPairs:ee==null?void 0:ee.pairs,matchLeftOrder:ee==null?void 0:ee.leftOrder,matchRightOrder:ee==null?void 0:ee.rightOrder,matchSelection:ee==null?void 0:ee.selection,matchActiveLeft:ee==null?void 0:ee.activeLeft,matchActiveRight:ee==null?void 0:ee.activeRight,matchFeedback:qe,onMatchLeftSelect:Nt,onMatchRightSelect:Xt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:pa?`${_a} / ${pa}`:a.cogita.library.revision.progressUnlimited}),j==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),j==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),j==="ready"&&Q==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),j==="ready"&&Q==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),j==="ready"&&Q==="ready"&&x.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:tr}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",wa]})]})]}),Na?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Na.activeCount," / ",Na.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Na.counts.map(($,o)=>{const p=o+1,C=Na.currentLevel===p,W=Na.percentages[o]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":C,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:p}),e.jsx("strong",{children:$})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,W))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[W.toFixed(1),"%"]})]},`level-${p}`)})})]}):null,xa?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:xa.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:xa.dots.map($=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-$.value))}, ${Math.round(200*$.value)}, 80, 0.9)`}},$.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:xa.knownCount})]})]}):null,ua?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Za})]})}):null]})]})]})})})]})]})}const zn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:On},Symbol.toStringTag,{value:"Module"}));export{Un as C,Wn as a,zn as b};
