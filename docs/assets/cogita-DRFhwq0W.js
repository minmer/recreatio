import{r as i,j as e,u as Vr,R as pr,B as fr,C as xr,H as Nr,P as Lr,a as $t,b as ui,c as gi,d as Or,e as _r,f as yr}from"./vendor-SpL5bUHi.js";import{L as qr,A as Ur,g as Wr,a as hi,b as wt,c as zr,s as Cr,d as Hr,e as Ut,f as rt,h as ar,i as it,j as hr,k as bi,u as mi,l as ga,m as pi,p as fi,n as xi,o as Jr,r as Yr,q as yi,t as vi,v as ji,w as Wt,x as Et,y as wi,z as ki,B as Ti,C as Ni,D as Li,E as Ci,F as Mr,G as Ya,H as Mi,I as Si,J as Ii,K as Pi,M as Ri,N as $i,O as Ei,P as Ai,Q as Fi,R as Bi,S as Di,T as Ki,U as Vi,V as Oi,W as _i,X as qi,Y as Sr}from"./recreatio-core-CzuC6moy.js";import"./vendor-cogita-ui-BgsFclds.js";const jt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},vt={moveMs:900,pauseMs:220,errorMs:900},Ui=(a=11)=>{let n=a;const s=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:u,height:g,paddingX:w,paddingY:x,levels:N}=jt,A=(g-x*2)/(N.length-1),L=[],o=[],S=[];N.forEach((m,f)=>{const be=g-x-f*A,D=u-w*2,j=[];for(let Y=0;Y<m;Y+=1){const B=w+(Y+1)*D/(m+1),ne=(s()-.5)*18,P=Math.max(w,Math.min(u-w,B+ne)),O=f===0?3:f<2?2.1:1.4,ue=f===0?"root":`l${f}-${Y}`;j.push({id:ue,x:f===0?u/2:P,y:be,r:O,level:f,role:f===0?"root":void 0})}S.push(j),L.push(...j)});const b=S[S.length-1];if(b!=null&&b.length){const m=b[Math.floor(b.length/2)];m.role="goal",m.r=2}for(let m=1;m<S.length;m+=1){const f=S[m-1];S[m].forEach(D=>{const j=[...f].sort((P,O)=>Math.abs(P.x-D.x)-Math.abs(O.x-D.x)),Y=j[0],B=j[1]&&s()<.45?j[1]:null;(B?[Y,B]:[Y]).forEach(P=>{o.push({from:P.id,to:D.id,key:`${P.id}-${D.id}`})}),s()<.2&&j[2]&&o.push({from:j[2].id,to:D.id,key:`${j[2].id}-${D.id}`})})}const p=new Map;o.forEach(m=>{const f=p.get(m.to)??[];f.push(m.from),p.set(m.to,f)});const R=new Map,q=new Map,U=new Map;o.forEach(m=>{const f=R.get(m.from)??[];f.push(m.key),R.set(m.from,f);const be=q.get(m.from)??[];be.push(m.to),q.set(m.from,be);const D=U.get(m.from)??[];D.push(m.to),U.set(m.from,D);const j=U.get(m.to)??[];j.push(m.from),U.set(m.to,j)});const l=new Map;return L.forEach(m=>{l.set(m.id,m)}),{nodes:L,links:o,parentsById:p,linksByFrom:R,childrenByFrom:q,neighborsById:U,nodesById:l}};function Wi({slides:a,activeIndex:n,introOpen:s,prefersReducedMotion:u,onNext:g,onPrev:w,onSelect:x,onExit:N,onOpen:A,onRegister:L}){const o=n===a.length-1,S=s&&n===0?"entry":"docked",b=a[a.length-1],[p,R]=i.useState(!1),q=i.useMemo(()=>Array.from({length:20},(v,k)=>({src:`/cogita/logo/Cogita${String(k).padStart(2,"0")}.png`,kind:k<=11?"bubble":k<=17?"text":"recreatio"})),[]),U=s&&n===0;i.useEffect(()=>{if(!s){R(!1);return}n>0&&!p&&R(!0)},[n,s,p]);const l=i.useRef(0),m=i.useRef(null),f=i.useMemo(()=>{const v={x:40,y:160},k={x:260,y:48},J=6,t=k.x-v.x,r=v.y-k.y,h=t/J,T=[.3,.45,.6,.65,1.4,2.2],V=T.reduce((oe,ke)=>oe+ke,0),Z=T.map(oe=>r*oe/V),ae=[v];let G=v.x,de=v.y;for(let oe=1;oe<=J;oe+=1){const ke=(Math.random()-.5)*14,ea=(Math.random()-.5)*28;G=Math.max(v.x+oe*14,Math.min(k.x-(J-oe)*14,G+h+ke));const Oe=Z[oe-1]??Z[Z.length-1];de=de-Oe+ea;const ra=Math.max(k.y,Math.min(v.y-4,de));ae.push({x:Math.round(G),y:Math.round(ra)})}return ae[ae.length-1]=k,ae},[]),be=i.useMemo(()=>{const r=(V,Z,ae)=>Math.min(ae,Math.max(Z,V)),h=f.map(V=>{const Z=10+Math.random()*36;return{x:r(V.x,40,260),y:r(V.y-Z,40,140)}}),T=f.map((V,Z)=>{var de;const ae=12+Math.random()*40,G=((de=h[Z])==null?void 0:de.y)??V.y;return{x:r(V.x,40,260),y:r(Math.max(G+10,V.y+ae),60,170)}});return{upper:h,lower:T}},[f]),D=i.useMemo(()=>{var k;const v=((k=f[4])==null?void 0:k.x)??260;return Math.max(0,Math.min(240,v-40))},[f]),j=i.useMemo(()=>{var Z,ae;const v=(G,de,oe)=>Math.min(oe,Math.max(de,G)),k=(G,de,oe)=>f.map((ke,ea)=>{var Sa,sa;const Oe=((Sa=be.upper[ea])==null?void 0:Sa.y)??ke.y,ra=((sa=be.lower[ea])==null?void 0:sa.y)??ke.y,Ke=(Math.random()-.5)*70,We=ke.y+G+Ke,Ae=v(ke.y+de,Oe+6,ra-6),Ge=v(ke.y+oe,Oe+6,ra-6);return{x:ke.x,y:v(We,Math.min(Ae,Ge),Math.max(Ae,Ge))}}),J=-14+Math.random()*28,t=14+Math.random()*28,r=k(J,-80,12),h=k(t,-12,80);for(let G=4;G<f.length;G+=1){const de=f[G],oe=((Z=be.upper[G])==null?void 0:Z.y)??de.y,ke=((ae=be.lower[G])==null?void 0:ae.y)??de.y;r[G]={x:de.x,y:v(de.y-12,oe+6,ke-6)},h[G]={x:de.x,y:v(de.y+12,oe+6,ke-6)}}const T=be.upper.length?be.upper[be.upper.length-1].y:40,V=be.lower.length?be.lower[be.lower.length-1].y:170;return r[r.length-1]={x:f[f.length-1].x,y:v(f[f.length-1].y-14,T,V)},h[h.length-1]={x:f[f.length-1].x,y:v(f[f.length-1].y+12,T,V)},{higher:r,lower:h}},[f,be]),Y=1e4,B=i.useMemo(()=>{let v=17;const k=()=>(v=(v*1664525+1013904223)%4294967296,v/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const h=(k()-.5)*240,T=(k()-.5)*180,V=(k()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${h.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${V.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),ne=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[P,O]=i.useState([]),ue=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),pe=i.useMemo(()=>{const k=[],t=(h,T)=>h+Math.random()*(T-h);for(let h=0;h<6;h+=1){let T=!1;for(let V=0;V<80;V+=1){const Z=t(14,86),ae=t(10,34);if(k.every(de=>{const oe=de.x-Z,ke=de.y-ae;return Math.hypot(oe,ke)>=12})){k.push({x:Z,y:ae}),T=!0;break}}T||k.push({x:t(16,84),y:t(12,32)})}return k.map((h,T)=>({id:`p${T+1}`,x:`${h.x.toFixed(1)}%`,y:`${h.y.toFixed(1)}%`,xNum:h.x,yNum:h.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ge,K]=i.useState(0),[se,d]=i.useState(0),[te,ee]=i.useState([]),_=1e4,Se=i.useMemo(()=>{if(pe.length<2)return[];const v=T=>{let V=T+1831565813;return V=Math.imul(V^V>>>15,V|1),V^=V+Math.imul(V^V>>>7,V|61),((V^V>>>14)>>>0)/4294967296},k=(T,V)=>Math.floor(v(T)*V),J=new Set,t=[],r=Math.min(3,pe.length);let h=0;for(;t.length<r&&h<30;){h+=1;const T=k(ge*13+h*5,pe.length),V=k(ge*29+h*7,pe.length);if(T===V)continue;const Z=T<V?`${T}-${V}`:`${V}-${T}`;J.has(Z)||(J.add(Z),t.push({id:`link-${Z}`,from:pe[T],to:pe[V],delay:`${(h*.35).toFixed(2)}s`}))}return t},[ge,pe]);i.useEffect(()=>{if(!s||n!==2)return;const v=()=>{const J=B.map(t=>t.id);for(let t=J.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[J[t],J[r]]=[J[r],J[t]]}return J.slice(0,4)};O(v());const k=window.setInterval(()=>{O(v())},Y);return()=>window.clearInterval(k)},[n,s,B,Y]),i.useEffect(()=>{if(!s||n!==3)return;const v=()=>{d(Math.floor(Math.random()*ue.length)),ee(pe.map(()=>Math.random()<.6?"good":"bad")),K(J=>J+1)};v();const k=window.setInterval(v,_);return()=>window.clearInterval(k)},[n,s,ue.length,pe,_]);const le=i.useMemo(()=>Ui(11),[]),[ie,Ce]=i.useState(new Set(["root"])),[me,we]=i.useState(new Set),[Le,Ne]=i.useState(new Set),[Je,_e]=i.useState({fromId:"root",toId:"root",key:0}),Ee=i.useRef(ie),He=i.useRef("root"),ca=i.useRef(0),oa=i.useRef(null),Q=i.useRef(null),re=i.useRef([]);i.useEffect(()=>{Ee.current=ie},[ie]);const Ue=i.useMemo(()=>{const v=new Set;return ie.forEach(k=>{const J=le.linksByFrom.get(k);J&&J.forEach(t=>v.add(t))}),v},[ie,le]),Me=le.nodesById.get(Je.toId)??le.nodesById.get("root"),fe=Me?`${Me.x/jt.width*100}%`:"50%",$e=Me?`${Me.y/jt.height*100}%`:"90%";i.useEffect(()=>{if(!s||n!==1||u)return;(()=>{Ce(new Set(["root"])),we(new Set),Ne(new Set),_e({fromId:"root",toId:"root",key:0}),Q.current=null,ca.current=0,He.current="root",re.current=[]})();const k=()=>{const t=He.current,r=Ee.current,T=(le.childrenByFrom.get(t)??[]).filter(ke=>!r.has(ke));if(T.length)return T[Math.floor(Math.random()*T.length)];if(r.size>=le.nodes.length){const ke=le.neighborsById.get(t)??[];return ke.length?ke[Math.floor(Math.random()*ke.length)]:null}const V=ke=>(le.childrenByFrom.get(ke)??[]).some(Oe=>!r.has(Oe)),Z=[t],ae=new Set([t]),G=new Map;let de=null;for(;Z.length;){const ke=Z.shift();if(!ke)break;if(ke!==t&&V(ke)){de=ke;break}(le.neighborsById.get(ke)??[]).forEach(Oe=>{ae.has(Oe)||(ae.add(Oe),G.set(Oe,ke),Z.push(Oe))})}if(!de)return null;let oe=de;for(;G.get(oe)&&G.get(oe)!==t;)oe=G.get(oe)??oe;return oe},J=(t,r)=>{if(t===r){const h=k();h&&J(t,h);return}ca.current+=1,_e({fromId:t,toId:r,key:ca.current}),He.current=r,oa.current=window.setTimeout(()=>{const h=le.parentsById.get(r)??[],T=Ee.current,V=h.filter(de=>!T.has(de));if(!V.length){const de=new Set(T);de.add(r),Ce(de),oa.current=window.setTimeout(()=>{for(;re.current.length;){const ke=re.current[re.current.length-1];if(!de.has(ke)){if(ke!==r){J(r,ke);return}break}re.current.pop()}const oe=k();oe&&J(r,oe)},vt.pauseMs);return}const Z=new Set([r,...V]),ae=new Set(V.map(de=>`${de}-${r}`));we(Z),Ne(ae),re.current.includes(r)||re.current.push(r);const G=V[Math.floor(Math.random()*V.length)];Q.current={fromId:r,toId:G},oa.current=window.setTimeout(()=>{we(new Set),Ne(new Set);const de=Q.current;de&&J(de.fromId,de.toId)},vt.errorMs)},vt.moveMs)};return oa.current=window.setTimeout(()=>{const t=k();t&&J(He.current,t)},vt.pauseMs),()=>{oa.current&&window.clearTimeout(oa.current)}},[n,s,le,u]);const qe=v=>{if(!s)return;const k=Date.now();k-l.current<520||Math.abs(v.deltaY)<10||(l.current=k,v.deltaY>0?g():w(),v.preventDefault())},Fe=v=>{if(!s)return;const k=v.touches[0];k&&(m.current={x:k.clientX,y:k.clientY})},Ve=v=>{if(!s)return;const k=m.current;if(m.current=null,!k)return;const J=v.changedTouches[0];if(!J)return;const t=J.clientX-k.x,r=J.clientY-k.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?g():w())};return e.jsxs("div",{className:`cogita-intro ${s?"is-open":"is-closed"} ${u?"is-reduced":""} ${o?"is-final":""}`,"data-slide":n+1,onWheel:qe,onTouchStart:Fe,onTouchEnd:Ve,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":S,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${U&&!p?"is-entry":""}`,children:q.map((v,k)=>e.jsx("img",{src:v.src,alt:"",className:`cogita-logo-layer ${k===0?"is-base":""} ${v.kind==="text"?"is-text":v.kind==="recreatio"?"is-recreatio":""} ${v.kind==="bubble"?"is-bubble":""}`},v.src))})}),s&&a.map((v,k)=>{const J=k===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${k+1} ${J?"is-active":""}`,"aria-hidden":!J,children:[e.jsxs("div",{className:"cogita-intro-text",children:[v.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:v.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:v.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:v.title}),v.body&&e.jsx("p",{children:v.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),v.micro&&e.jsx("p",{className:"cogita-intro-micro",children:v.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:o?L:g,children:v.cta}),o&&v.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>x(0),children:v.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[k===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${jt.width} ${jt.height}`,preserveAspectRatio:"none",children:[le.links.map(t=>{const r=le.nodesById.get(t.from),h=le.nodesById.get(t.to);if(!r||!h)return null;const T=Ue.has(t.key),V=Le.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${V?"is-error":""}`,x1:r.x,y1:r.y,x2:h.x,y2:h.y},t.key)}),le.nodes.map(t=>{const r=ie.has(t.id),h=me.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${h?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Me&&e.jsx("span",{className:"map-explorer-dot",style:{left:fe,top:$e,"--move":`${vt.moveMs}ms`}})]}),k===2&&e.jsx("div",{className:"cogita-index-cards",children:B.map(t=>{const r=P.indexOf(t.id),h=r>=0?ne[r]:null,T=(h==null?void 0:h.x)??"140px",V=(h==null?void 0:h.y)??"140px",Z=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":V,"--stack-opacity":Z,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),k===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ue.map((t,r)=>e.jsxs("div",{className:`round-card ${r===se?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),ue[se]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ue[se].x,"--card-y":`calc(${ue[se].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:pe.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Se.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:pe.map((t,r)=>{const h=te[r]??"good",T=ue[se];if(!T)return null;const V=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":V,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${h}`,style:{"--from-x":T.x,"--from-y":V,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${h}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${ge}`)})})]},`round-${ge}`),k===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${f[0].x} ${f[0].y} L${f[1].x} ${f[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${f[1].x} ${f[1].y} L${f[2].x} ${f[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${f[2].x} ${f[2].y} L${f[3].x} ${f[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${f[3].x} ${f[3].y} L${f[4].x} ${f[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${f[4].x} ${f[4].y} L${f[5].x} ${f[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${f[5].x} ${f[5].y} L${f[6].x} ${f[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${D};${D};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${be.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${be.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${be.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${be.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[j.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${j.higher[r+1].x} ${j.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),j.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${j.lower[r+1].x} ${j.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${f[0].x/300*100}%`,"--p0y":`${f[0].y/200*100}%`,"--p1x":`${f[1].x/300*100}%`,"--p1y":`${f[1].y/200*100}%`,"--p2x":`${f[2].x/300*100}%`,"--p2y":`${f[2].y/200*100}%`,"--p3x":`${f[3].x/300*100}%`,"--p3y":`${f[3].y/200*100}%`,"--p4x":`${f[4].x/300*100}%`,"--p4y":`${f[4].y/200*100}%`,"--p5x":`${f[5].x/300*100}%`,"--p5y":`${f[5].y/200*100}%`,"--p6x":`${f[6].x/300*100}%`,"--p6y":`${f[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${j.higher[0].x/300*100}%`,"--q0y":`${j.higher[0].y/200*100}%`,"--q1x":`${j.higher[1].x/300*100}%`,"--q1y":`${j.higher[1].y/200*100}%`,"--q2x":`${j.higher[2].x/300*100}%`,"--q2y":`${j.higher[2].y/200*100}%`,"--q3x":`${j.higher[3].x/300*100}%`,"--q3y":`${j.higher[3].y/200*100}%`,"--q4x":`${j.higher[4].x/300*100}%`,"--q4y":`${j.higher[4].y/200*100}%`,"--q5x":`${j.higher[5].x/300*100}%`,"--q5y":`${j.higher[5].y/200*100}%`,"--q6x":`${j.higher[6].x/300*100}%`,"--q6y":`${j.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${j.lower[0].x/300*100}%`,"--q0y":`${j.lower[0].y/200*100}%`,"--q1x":`${j.lower[1].x/300*100}%`,"--q1y":`${j.lower[1].y/200*100}%`,"--q2x":`${j.lower[2].x/300*100}%`,"--q2y":`${j.lower[2].y/200*100}%`,"--q3x":`${j.lower[3].x/300*100}%`,"--q3y":`${j.lower[3].y/200*100}%`,"--q4x":`${j.lower[4].x/300*100}%`,"--q4y":`${j.lower[4].y/200*100}%`,"--q5x":`${j.lower[5].x/300*100}%`,"--q5y":`${j.lower[5].y/200*100}%`,"--q6x":`${j.lower[6].x/300*100}%`,"--q6y":`${j.lower[6].y/200*100}%`}})]})})}),k===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),k===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},v.id)}),!s&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:b.title}),b.body&&e.jsx("p",{children:b.body}),b.micro&&e.jsx("p",{className:"cogita-intro-micro",children:b.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:L,children:b.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:A,children:"Otwórz pokaz"})]})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((v,k)=>e.jsx("button",{type:"button",className:`dot ${n===k?"active":""}`,"aria-label":v.title,onClick:()=>x(k)},v.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:N,children:"Pomiń"})]})]})}const zi=6,Hi=4;function Ji({copy:a,onAuthAction:n,authLabel:s,showProfileMenu:u,onProfileNavigate:g,onToggleSecureMode:w,onLogout:x,secureMode:N,onNavigate:A,language:L,onLanguageChange:o}){const S=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}A("home")},b=i.useRef(null),p=i.useRef([]),R=i.useMemo(()=>{let ee=Date.now()%2147483647;const _=()=>(ee=ee*48271%2147483647,ee/2147483647);return Array.from({length:zi},(Se,le)=>{const ie=6+_()*8,Ce=7+_()*10,me=6+_()*9,we=-_()*ie,Le=-_()*Ce,Ne=-_()*me,Je=.18+_()*.28,_e=12+_()*18,Ee=4+_()*8,He=(_()-.5)*3.2,ca=(_()-.5)*3.8,oa=_()>.5?"alternate":"alternate-reverse",Q=_()>.5?"alternate":"alternate-reverse",re=_()>.5?"alternate":"alternate-reverse",Ue=.18+_()*.42,Me=30+_()*60,fe=-45-_()*38,$e=188+_()*32,qe=.1+_()*.2;return{id:`wave-${le+1}`,style:{"--wave-sway-duration":`${ie}s`,"--wave-scale-duration":`${Ce}s`,"--wave-drift-duration":`${me}s`,"--wave-sway-delay":`${we}s`,"--wave-scale-delay":`${Le}s`,"--wave-drift-delay":`${Ne}s`,"--wave-sway-dir":oa,"--wave-scale-dir":Q,"--wave-drift-dir":re,"--wave-scale":`${Je}`,"--wave-shift":`${_e}%`,"--wave-xshift":`${Ee}%`,"--wave-x0":`${He}%`,"--wave-y0":`${ca}%`,"--wave-opacity":`${Ue}`,"--wave-blur":`${Me}px`,"--wave-bottom":`${fe}%`,"--wave-hue":`${$e}`,"--wave-glow":`${qe}`}}})},[]),q=i.useMemo(()=>{let ee=Date.now()*3%2147483647;const _=()=>(ee=ee*48271%2147483647,ee/2147483647);return Array.from({length:Hi},(Se,le)=>{const ie=180+_()*220,Ce=220+_()*280,me=-_()*ie,we=-_()*Ce,Le=.12+_()*.22,Ne=3+_()*7,Je=1+_()*3,_e=(_()-.5)*2.8,Ee=(_()-.5)*2.2;return{id:`mesh-${le+1}`,seed:1e3+le*991+Math.floor(_()*999),style:{"--mesh-sway-duration":`${ie}s`,"--mesh-drift-duration":`${Ce}s`,"--mesh-sway-delay":`${me}s`,"--mesh-drift-delay":`${we}s`,"--mesh-scale":`${Le}`,"--mesh-shift":`${Ne}%`,"--mesh-xshift":`${Je}%`,"--mesh-x0":`${Ee}%`,"--mesh-y0":`${_e}%`}}})},[]),U=i.useMemo(()=>{const ee=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],_=a.cogita.introSlides,Se=new Map(_.map(le=>[le.id,le]));return ee.map(le=>{var Ce;const ie=Se.get(le.id);return{...le,...ie,title:(ie==null?void 0:ie.title)??"Cogita",cta:(ie==null?void 0:ie.cta)??((Ce=a.cogita.introSlides[0])==null?void 0:Ce.cta)??a.cogita.loginCta,secondary:ie==null?void 0:ie.secondary}})},[a.cogita.introSlides]),[l,m]=i.useState(0),[f,be]=i.useState(!0),[D,j]=i.useState(!1),Y=U.length-1,B=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ne=i.useCallback(()=>{B(),n()},[B,n]),P=i.useCallback(()=>{be(!0),m(0)},[]),O=i.useCallback(()=>{be(!1),m(Y)},[Y]),ue=i.useCallback(ee=>{m(Math.max(0,Math.min(Y,ee)))},[Y]),pe=i.useCallback(()=>{l>=Y?ne():ue(l+1)},[l,ue,ne,Y]),ge=i.useCallback(()=>{ue(l-1)},[l,ue]);i.useEffect(()=>{var Se;const ee=(Se=window.matchMedia)==null?void 0:Se.call(window,"(prefers-reduced-motion: reduce)");if(!ee)return;const _=()=>j(ee.matches);return _(),ee.addEventListener?(ee.addEventListener("change",_),()=>ee.removeEventListener("change",_)):(ee.addListener(_),()=>ee.removeListener(_))},[]),i.useEffect(()=>{if(!f)return;const ee=_=>{const Se=_.target;if(!Se)return;const le=Se.tagName;if(!(Se.isContentEditable||le==="INPUT"||le==="TEXTAREA"||le==="SELECT"||le==="BUTTON"||le==="A"||Se.closest('button, a, [role="button"], [role="link"]'))){if(_.key==="Escape"){O();return}if(_.key==="ArrowLeft"||_.key==="ArrowUp"){ge();return}(_.key==="ArrowRight"||_.key==="ArrowDown"||_.code==="Space"||_.key===" ")&&(_.preventDefault(),pe())}};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[O,pe,ge,f]),i.useEffect(()=>{f&&l===Y&&B()},[l,f,Y,B]),i.useEffect(()=>{const ee=b.current;if(!ee)return;const _=p.current.filter(fe=>!!fe);if(!_.length)return;const Se=1,le=.6,ie=.6,Ce=Math.max(1,Math.min(Se,window.devicePixelRatio||1));let me=0,we=0,Le=le,Ne=0,Je=0;const _e=fe=>{let $e=fe%2147483647;return $e<=0&&($e+=2147483646),(qe,Fe)=>{$e=$e*48271%2147483647;const Ve=$e/2147483647;return qe+Ve*(Fe-qe)}},Ee={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},He=fe=>{const $e=Math.sin(fe*12.9898)*43758.5453;return $e-Math.floor($e)},ca=fe=>{const $e=He(fe+.1)||1e-4,qe=He(fe+.7)||1e-4;return Math.sqrt(-2*Math.log($e))*Math.cos(2*Math.PI*qe)},oa=(fe,$e)=>{const qe=Math.floor(fe),Fe=qe+1,Ve=fe-qe,v=Ve*Ve*(3-2*Ve),k=He(qe*12.9898+$e*78.233),J=He(Fe*12.9898+$e*78.233);return k+(J-k)*v},Q=fe=>{const $e=_e(fe),qe=Math.min(4,Math.max(4,Math.floor(me/1200*Ee.filamentCount)));return Array.from({length:qe},(Fe,Ve)=>{const v=Math.max(-1,Math.min(1,ca(fe+Ve*.37))),k=Math.min(1,Math.max(0,He(fe+Ve*1.31))),J=Math.min(Ee.depthLayers-1,Math.floor(k*Ee.depthLayers));return{seed:$e(0,Math.PI*2)+fe*.01,offset:v,freqA:Ee.freq1*(.75+$e(0,.5)),freqB:Ee.freq2*(.75+$e(0,.5)),ampA:Ee.amp1*(.6+$e(0,.7)),ampB:Ee.amp2*(.6+$e(0,.7)),width:2+Ve%5*.32,depth:k,layer:J}})},re=(fe,$e,qe)=>{const Fe=Math.max(30,Math.floor(me*we/14e4));fe.save(),fe.globalAlpha=.6;for(let Ve=0;Ve<Fe;Ve+=1){const v=He(Ve*9.1+me*.11)*$e+qe,k=He(Ve*3.7+we*.23)*we,J=1.2+He(Ve*5.9)*2.4,t=fe.createRadialGradient(v,k,0,v,k,J*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),fe.fillStyle=t,fe.beginPath(),fe.arc(v,k,J*2,0,Math.PI*2),fe.fill()}fe.restore()},Ue=(fe,$e)=>{fe.clearRect(0,0,me,we);const qe=we*Ee.waveCenter,Fe=Ee.waveBandPx,Ve=Ee.segments,v=Ee.colors.filaments,k=Ne||me,J=0;re(fe,k,J),fe.strokeStyle=v,fe.lineCap="round",fe.lineJoin="round";for(let t=0;t<$e.length;t+=1){const r=$e[t],h=r.offset*Fe*(.85+He(r.seed)*.4),T=1-Math.min(1,Math.abs(h)/Fe),V=Math.exp(-Math.pow(h/Ee.crestThickness,2)),Z=r.layer===0?1.1:r.layer===1?.85:.6,ae=.35+(1-r.depth)*.65,G=T*ae*Z*(.34+V*.45);fe.globalAlpha=G,fe.lineWidth=r.width*(1+(1-r.depth)*.8);const de=[];for(let ke=0;ke<=Ve;ke+=1){const ea=ke/Ve*k+J,Oe=(oa(ea*.012,r.seed)-.5)*Ee.xJitter,ra=ea+Oe,Ke=(oa(ra*r.freqA,r.seed)-.5)*Ee.jitterA,We=(oa(ra*r.freqB,r.seed*1.7)-.5)*Ee.jitterB,Ae=qe+Math.sin(ra*r.freqA+r.seed)*r.ampA+Math.sin(ra*r.freqB+r.seed*1.3)*r.ampB+h+Ke+We;de.push({x:ra,y:Ae})}fe.beginPath(),fe.moveTo(de[0].x,de[0].y);for(let ke=1;ke<de.length-1;ke+=1){const ea=(de[ke].x+de[ke+1].x)/2,Oe=(de[ke].y+de[ke+1].y)/2;fe.quadraticCurveTo(de[ke].x,de[ke].y,ea,Oe)}const oe=de[de.length-1];fe.quadraticCurveTo(oe.x,oe.y,oe.x,oe.y),fe.stroke()}fe.save(),fe.globalCompositeOperation="lighter",fe.strokeStyle=Ee.colors.glow,fe.lineCap="round",fe.lineJoin="round";for(let t=0;t<$e.length;t+=1){const r=$e[t];if(Math.abs(r.offset)*Fe>Ee.crestThickness)continue;const h=Ee.glowAlpha*(.7+(1-r.depth)*.6);fe.globalAlpha=h,fe.lineWidth=1.6+(1-r.depth)*1.2;const T=[];for(let Z=0;Z<=Ve;Z+=1){const ae=Z/Ve*k+J,G=Math.sin(ae*.02+r.seed)*3,de=qe+Math.sin(ae*r.freqA+r.seed)*r.ampA+Math.sin(ae*r.freqB+r.seed*1.3)*r.ampB+r.offset*Fe*.35+G;T.push({x:ae,y:de})}fe.beginPath(),fe.moveTo(T[0].x,T[0].y);for(let Z=1;Z<T.length-1;Z+=1){const ae=(T[Z].x+T[Z+1].x)/2,G=(T[Z].y+T[Z+1].y)/2;fe.quadraticCurveTo(T[Z].x,T[Z].y,ae,G)}const V=T[T.length-1];fe.quadraticCurveTo(V.x,V.y,V.x,V.y),fe.stroke()}fe.restore()},Me=()=>{me=Math.floor(ee.clientWidth),we=Math.floor(ee.clientHeight),Ne=Math.floor(me*1.8),Je=we,Le=me<820?ie:le,_.forEach(fe=>{const $e=fe.getContext("2d");if(!$e)return;fe.width=Math.floor(Ne*Ce*Le),fe.height=Math.floor(Je*Ce*Le),fe.style.width=`${Ne}px`,fe.style.height=`${Je}px`,fe.style.left=`${-(Ne-me)/2}px`,$e.setTransform(Ce*Le,0,0,Ce*Le,0,0);const qe=Number(fe.dataset.seed||1),Fe=Q(qe);Ue($e,Fe)})};return Me(),window.addEventListener("resize",Me,{passive:!0}),()=>window.removeEventListener("resize",Me)},[q]);const K=U[Math.min(l,U.length-1)],se=f?K:U[U.length-1],d=(se==null?void 0:se.theme)??U[0].theme,te={"--cogita-bg0":d.bg0,"--cogita-bg1":d.bg1,"--cogita-bg2":d.bg2,"--cogita-bloom":d.bloom,"--cogita-sat":d.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:S,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:L,onChange:o}),e.jsx(Ur,{copy:a,label:s,isAuthenticated:u,secureMode:N,onLogin:n,onProfileNavigate:g,onToggleSecureMode:w,onLogout:x,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:b,className:"cogita-section cogita-home",style:te,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[q.map((ee,_)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:ee.style,"data-seed":ee.seed,ref:Se=>{p.current[_]=Se}},ee.id)),R.map(ee=>e.jsx("div",{className:"cogita-home-wave",style:ee.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},ee.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Wi,{slides:U,activeIndex:l,introOpen:f,prefersReducedMotion:D,onNext:pe,onPrev:ge,onSelect:ue,onExit:O,onOpen:P,onRegister:ne})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Ji},Symbol.toStringTag,{value:"Module"})),Qr=i.createContext(!1);function Na({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:o}){if(i.useContext(Qr))return e.jsx(e.Fragment,{children:o});const b=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}N("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:b,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:A,onChange:L}),e.jsx(Ur,{copy:a,label:n,isAuthenticated:s,secureMode:x,onLogin:()=>N("home"),onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:o}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function _a(a){const[n,s]=i.useState("Cogita library"),[u,g]=i.useState(null);return i.useEffect(()=>{let w=!1;return Wr().then(x=>{if(w)return;const N=x.find(A=>A.libraryId===a);N&&s(N.name)}).catch(()=>{w||s("Cogita library")}),()=>{w=!0}},[a]),i.useEffect(()=>{let w=!1;return hi(a).then(x=>{w||g(x)}).catch(()=>{w||g(null)}),()=>{w=!0}},[a]),{libraryName:n,stats:u}}function Ir({slices:a}){const n=a.reduce((u,g)=>u+Math.max(0,g.value),0),s=i.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let u=0;return`conic-gradient(${a.map(w=>{const N=Math.max(0,w.value)/n*360,A=u,L=u+N;return u=L,`${w.color} ${A}deg ${L}deg`}).join(",")})`},[a,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:s}}),e.jsx("div",{className:"cogita-overview-legend",children:a.map(u=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:u.color}}),e.jsx("strong",{children:u.value}),e.jsx("small",{children:u.label})]},u.label))})]})}function Yi({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:S,stats:b}=_a(o),[p,R]=i.useState("infos"),[q,U]=i.useState(0),[l,m]=i.useState(0),[f,be]=i.useState(0),D=(b==null?void 0:b.totalInfos)??0,j=(b==null?void 0:b.totalCollections)??0,Y=0,B=0,ne=0,P=Math.max(0,D-ne-l),O=Math.max(0,D-l-f);i.useEffect(()=>{let pe=!1;return(async()=>{try{const K=await wt({libraryId:o,limit:200}),se=await Promise.all(K.items.map(d=>zr({libraryId:o,collectionId:d.collectionId}).catch(()=>[])));if(pe)return;U(se.reduce((d,te)=>d+te.length,0))}catch{pe||U(0)}})(),()=>{pe=!0}},[o]),i.useEffect(()=>{let pe=!1;return(async()=>{try{const[K,se,d]=await Promise.all([Cr({libraryId:o,type:"computed",limit:1}).catch(()=>({total:0})),Cr({libraryId:o,type:"source",limit:1}).catch(()=>({total:0})),Hr({libraryId:o}).catch(()=>({items:[]}))]);if(pe)return;m((K.total??0)+(se.total??0));const te=new Set(d.items.filter(ee=>ee.childItemType.toLowerCase()==="info").map(ee=>ee.childItemId).filter(Boolean));be(te.size)}catch{pe||(m(0),be(0))}})(),()=>{pe=!0}},[o]);const ue=[{key:"infos",label:a.cogita.library.overview.stats.totalInfos,value:D},{key:"collections",label:a.cogita.library.overview.stats.collections,value:j},{key:"revisions",label:a.cogita.library.overview.stats.revisions,value:q},{key:"storyboards",label:a.cogita.library.overview.stats.storyboards,value:Y},{key:"texts",label:a.cogita.library.overview.stats.texts,value:B}];return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:S})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ue.map(pe=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${p===pe.key?"active":""}`,onClick:()=>R(pe.key),children:[e.jsx("span",{children:pe.label}),e.jsx("strong",{children:pe.value})]},pe.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:a.cogita.library.overview.statsCardTitle})}),p==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.knownChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.known,value:ne,color:"#75d79a"},{label:a.cogita.library.overview.unknown,value:P,color:"#85b9ff"},{label:a.cogita.library.overview.excluded,value:l,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.checksChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.availableChecks,value:f,color:"#75d79a"},{label:a.cogita.library.overview.unavailableChecks,value:O,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:a.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]})]})})]})})}const Ze=(a,n)=>{const s=a.cogita.library.infoTypes;return{any:s.any,vocab:s.vocab,language:s.language,word:s.word,sentence:s.sentence,topic:s.topic,collection:s.collection,person:s.person,institution:s.institution,collective:s.collective,orcid:s.orcid,address:s.address,email:s.email,phone:s.phone,media:s.media,work:s.work,geo:s.geo,music_piece:s.musicPiece,music_fragment:s.musicFragment,source:s.source,quote:s.quote,computed:s.computed}[n]??String(n)},Gr=a=>[{value:"any",label:Ze(a,"any")},{value:"language",label:Ze(a,"language")},{value:"word",label:Ze(a,"word")},{value:"sentence",label:Ze(a,"sentence")},{value:"topic",label:Ze(a,"topic")},{value:"collection",label:Ze(a,"collection")},{value:"person",label:Ze(a,"person")},{value:"institution",label:Ze(a,"institution")},{value:"collective",label:Ze(a,"collective")},{value:"orcid",label:Ze(a,"orcid")},{value:"address",label:Ze(a,"address")},{value:"email",label:Ze(a,"email")},{value:"phone",label:Ze(a,"phone")},{value:"media",label:Ze(a,"media")},{value:"work",label:Ze(a,"work")},{value:"geo",label:Ze(a,"geo")},{value:"music_piece",label:Ze(a,"music_piece")},{value:"music_fragment",label:Ze(a,"music_fragment")},{value:"source",label:Ze(a,"source")},{value:"quote",label:Ze(a,"quote")},{value:"computed",label:Ze(a,"computed")}],Qi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Gi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],tr=60,Xi=500;function Zi({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,mode:S}){const b=Vr(),{libraryName:p}=_a(o),R=a.cogita.library.list,[q,U]=i.useState("any"),[l,m]=i.useState(""),[f,be]=i.useState("relevance"),[D,j]=i.useState("idle"),[Y,B]=i.useState([]),[ne,P]=i.useState(tr),[O,ue]=i.useState([]),[pe,ge]=i.useState(null),K=i.useMemo(()=>Gr(a),[a]),se=i.useMemo(()=>[{value:"relevance",label:R.sortRelevance},{value:"label_asc",label:R.sortLabelAsc},{value:"label_desc",label:R.sortLabelDesc},{value:"type_asc",label:R.sortTypeAsc},{value:"type_desc",label:R.sortTypeDesc}],[R.sortLabelAsc,R.sortLabelDesc,R.sortRelevance,R.sortTypeAsc,R.sortTypeDesc]);i.useEffect(()=>{j("loading");const me=window.setTimeout(()=>{Ut({libraryId:o,type:q==="any"?void 0:q,query:l.trim()||void 0,limit:Xi}).then(we=>{B(we),j("ready")}).catch(()=>{B([]),j("ready")})},240);return()=>window.clearTimeout(me)},[o,l,q]);const d=i.useMemo(()=>{const me=Y.slice(),we=Le=>Ze(a,Le);return f==="relevance"?me:f==="label_asc"?me.sort((Le,Ne)=>Le.label.localeCompare(Ne.label)):f==="label_desc"?me.sort((Le,Ne)=>Ne.label.localeCompare(Le.label)):f==="type_asc"?me.sort((Le,Ne)=>Le.infoType===Ne.infoType?Le.label.localeCompare(Ne.label):we(Le.infoType).localeCompare(we(Ne.infoType))):me.sort((Le,Ne)=>Le.infoType===Ne.infoType?Le.label.localeCompare(Ne.label):we(Ne.infoType).localeCompare(we(Le.infoType)))},[a,Y,f]),te=i.useMemo(()=>d.slice(0,ne),[d,ne]),ee=te.length<d.length,_=i.useMemo(()=>new Set(O),[O]);i.useEffect(()=>{P(tr);const me=new Set(Y.map(we=>we.infoId));ue(we=>we.filter(Le=>me.has(Le))),ge(we=>we&&me.has(we)?we:null)},[Y]);const Se=(me,we)=>{ue(Le=>we?Le.includes(me)?Le:[...Le,me]:Le.filter(Ne=>Ne!==me))},le=me=>{b(`/cogita/library/${o}/list?infoId=${encodeURIComponent(me)}&infoView=overview`,{replace:!0})},ie=O.length===1?O[0]:null,Ce=R.selectionCount.replace("{count}",String(O.length));return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":S==="collection"?"grid":"list",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:R.kicker}),e.jsx("h1",{className:"cogita-library-title",children:p}),e.jsx("p",{className:"cogita-library-subtitle",children:R.subtitle}),e.jsx("p",{className:"cogita-library-hint",children:R.searchOnlyHint})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:R.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":R.typeLabel,value:q,onChange:me=>U(me.target.value),children:K.map(me=>e.jsx("option",{value:me.value,children:me.label},me.value))}),e.jsx("input",{type:"text",value:l,onChange:me=>m(me.target.value),placeholder:R.searchPlaceholder}),e.jsx("select",{"aria-label":R.sortLabel,value:f,onChange:me=>be(me.target.value),children:se.map(me=>e.jsx("option",{value:me.value,children:me.label},me.value))})]})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:R.cardCount.replace("{shown}",String(te.length)).replace("{total}",String(d.length))}),e.jsx("span",{children:D==="loading"?R.loading:R.ready})]}),e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:Ce}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>ue(te.map(me=>me.infoId)),disabled:te.length===0,children:R.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>ue([]),disabled:O.length===0,children:R.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>ie&&le(ie),disabled:!ie,title:ie?void 0:R.openSelectedDisabled,children:R.openSelected})]})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:te.length?te.map(me=>{const we=Ze(a,me.infoType),Le=_.has(me.infoId),Ne=pe===me.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":Ne||Le,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:Le,onChange:Je=>Se(me.infoId,Je.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>ge(me.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:we}),e.jsx("h3",{className:"cogita-card-title",children:me.label}),e.jsx("p",{className:"cogita-card-subtitle",children:me.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>le(me.infoId),children:R.editInfo})]})},me.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:R.noMatch})})}),ee?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>P(me=>me+tr),children:R.loadMore})}):null]})})})})]})})}const tt=5,Pr=50,Rr=2,$r=[];function Ye({libraryId:a,infoType:n,label:s,placeholder:u,value:g,onChange:w,values:x,onChangeMultiple:N,helperText:A,searchFailedText:L,createFailedText:o,createLabel:S,savingLabel:b,loadMoreLabel:p,inputRef:R,autoAdvance:q,onCommit:U,multiple:l}){const m=l?x??$r:$r,[f,be]=i.useState(l?"":(g==null?void 0:g.label)??""),[D,j]=i.useState([]),[Y,B]=i.useState(tt),[ne,P]=i.useState(-1),[O,ue]=i.useState(!1),[pe,ge]=i.useState(!1),[K,se]=i.useState(null),d=i.useRef(0),te=i.useRef(new Map),ee=i.useMemo(()=>l?f.trim().length>0:f.trim().length>0&&!g,[f,g,l]);i.useEffect(()=>{l||be((g==null?void 0:g.label)??"")},[g,l]),i.useEffect(()=>{const le=f.trim();if(!le||le.length<Rr){j([]),ue(!1),B(tt),P(-1),ge(!1),se(null);return}const ie=le.toLowerCase(),Ce=`${a}:${n}:${ie}`,me=te.current.get(Ce);if(me){if(l&&m.length>0){const Le=new Set(m.map(Ne=>Ne.id));j(me.filter(Ne=>!Le.has(Ne.id)))}else j(me);B(tt),P(-1),ue(me.length>0),ge(!1),se(null);return}const we=window.setTimeout(async()=>{const Le=Date.now();d.current=Le,ge(!0),se(null);try{const Ne=await Ut({libraryId:a,type:n,query:le,limit:Pr});if(d.current!==Le)return;const Je=Ne.slice(0,Pr).map(_e=>({id:_e.infoId,label:_e.label,infoType:_e.infoType}));if(te.current.set(Ce,Je),l&&m.length>0){const _e=new Set(m.map(Ee=>Ee.id));j(Je.filter(Ee=>!_e.has(Ee.id)))}else j(Je);B(tt),P(-1),ue(!0)}catch{if(d.current!==Le)return;se(L??"Search failed.")}finally{d.current===Le&&ge(!1)}},250);return()=>window.clearTimeout(we)},[a,n,f,m]);const _=le=>{if(l){const ie=m.some(Ce=>Ce.id===le.id)?m:[...m,le];N==null||N(ie),be(""),ue(!1),P(-1);return}w==null||w(le),be(le.label),ue(!1),P(-1),q&&(U==null||U())},Se=async()=>{const le=f.trim();if(le){ge(!0),se(null);try{const ie=await rt({libraryId:a,infoType:n,payload:{label:le}}),Ce={id:ie.infoId,label:le,infoType:ie.infoType};if(le.length>=Rr){const me=`${a}:${n}:${le.toLowerCase()}`,we=te.current.get(me)??[];te.current.set(me,[Ce,...we])}if(l){N==null||N([...m,Ce]),be(""),ue(!1),P(-1);return}w==null||w(Ce),ue(!1),P(-1),q&&(U==null||U())}catch{se(o??"Create failed.")}finally{ge(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:s}),e.jsx("input",{value:f,placeholder:u,onChange:le=>{be(le.target.value),!l&&g&&(w==null||w(null))},onKeyDown:le=>{if(le.key==="ArrowDown"){if(le.preventDefault(),!D.length)return;ue(!0),P(ie=>{const Ce=Math.min(D.length,Y)-1,me=ie<0?0:Math.min(ie+1,Ce);return me===Ce&&D.length>Y?(B(we=>Math.min(we+tt,D.length)),Math.min(ie+1,Math.min(D.length,Y+tt)-1)):me});return}if(le.key==="ArrowUp"){if(le.preventDefault(),!D.length)return;ue(!0),P(ie=>ie<=0?0:ie-1);return}if(le.key==="Enter"){if(le.preventDefault(),ne>=0&&D[ne]){_(D[ne]);return}if(ee){Se();return}}},onFocus:()=>{D.length>0&&ue(!0)},autoComplete:"off",ref:R})]}),l&&m.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:m.map(le=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>N==null?void 0:N(m.filter(ie=>ie.id!==le.id)),children:[le.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},le.id))}),A&&e.jsx("p",{className:"cogita-help",children:A}),K&&e.jsx("p",{className:"cogita-error",children:K}),O&&D.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[D.slice(0,Y).map((le,ie)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":ie===ne,onClick:()=>_(le),children:[e.jsx("strong",{children:le.label}),e.jsx("span",{children:le.infoType})]},le.id)),Y<D.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>B(le=>Math.min(le+tt,D.length)),children:p??"Load more"})]}),ee&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Se,disabled:pe,children:pe?b??"Saving...":S??`Create new ${n}`})]})}const At=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Er=8;function Ar({libraryId:a,copy:n,language:s,sourceKindOptions:u,value:g,onChange:w,labels:x}){const[N,A]=i.useState(!1),[L,o]=i.useState(-1),S=i.useMemo(()=>{const q=s;return At.map(U=>{var f;const l=(U==null?void 0:U[q])??(U==null?void 0:U.en)??(U==null?void 0:U.la);return{label:`${l.abbr} — ${l.name}`,latin:((f=U==null?void 0:U.la)==null?void 0:f.abbr)??l.abbr}})},[s]),b=(q,U=!1)=>{const l=q.trim().toLowerCase();return l?S.filter(m=>m.label.toLowerCase().includes(l)).slice(0,Er):U?S.slice(0,Er):[]},p=(q,U)=>{const l=q.trim().toLowerCase();if(!l)return null;const m=At;for(const f of m){const be=f==null?void 0:f.la,D=(f==null?void 0:f[U])??(f==null?void 0:f.en)??be,j=(D==null?void 0:D.abbr)??"",Y=(D==null?void 0:D.name)??"";if(j.toLowerCase()===l||Y.toLowerCase()===l||`${j} — ${Y}`.toLowerCase()===l)return{book:f,entry:D,la:be}}return null};i.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!N){const q=p(g.locatorValue,s);if(q){const U=`${q.entry.abbr} — ${q.entry.name}`;U!==g.bibleBookDisplay&&w({...g,bibleBookDisplay:U})}}},[s,g,N,w]);const R=q=>w({...g,...q});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:q=>R({sourceKind:q.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:u.map(q=>e.jsx("option",{value:q.value,children:q.label},q.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:q=>{const U=q.target.value;R({bibleBookDisplay:U,locatorValue:""}),A(!0),o(-1)},onKeyDown:q=>{var l;const U=b(g.bibleBookDisplay);if(U.length){if(q.key==="ArrowDown")q.preventDefault(),o(m=>Math.min(m+1,U.length-1));else if(q.key==="ArrowUp")q.preventDefault(),o(m=>Math.max(m-1,0));else if((q.key==="Enter"||q.key==="Tab")&&L>=0&&U[L]){const m=U[L],f=p(m.label,s);if(!f)return;R({bibleBookDisplay:m.label,locatorValue:((l=f.la)==null?void 0:l.abbr)??g.locatorValue}),A(!1)}}},onFocus:()=>A(!0),onBlur:()=>window.setTimeout(()=>A(!1),100),placeholder:x.bibleBookPlaceholder})]}),N&&b(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:b(g.bibleBookDisplay,!0).map((q,U)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":U===L,tabIndex:-1,onMouseDown:()=>{var m;const l=p(q.label,s);l&&R({bibleBookDisplay:q.label,locatorValue:((m=l.la)==null?void 0:m.abbr)??g.locatorValue})},children:e.jsx("strong",{children:q.label})},q.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:q=>R({locatorAux:q.target.value}),placeholder:x.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:q=>R({sourceUrl:q.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:q=>R({sourceAccessedDate:q.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:a,infoType:"work",label:x.churchDocumentLabel,placeholder:x.churchDocumentPlaceholder,value:g.churchDocument,onChange:q=>R({churchDocument:q}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:q=>R({locatorValue:q.target.value}),placeholder:x.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(Ye,{libraryId:a,infoType:"work",label:x.workLabel,placeholder:x.workPlaceholder,value:g.work,onChange:q=>R({work:q}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:a,infoType:"media",label:x.bookLabel,placeholder:x.bookPlaceholder,value:g.bookMedia,onChange:q=>R({bookMedia:q}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:q=>R({locatorValue:q.target.value}),placeholder:x.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:q=>R({locatorValue:q.target.value}),placeholder:x.locatorPlaceholder})]})]})}const en=[],an=[];function tn({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),s=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),u=a.handles.length,g=u>1?(u-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),s?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((w,x)=>e.jsx(Nr,{type:"target",id:w.id,position:Lr.Left,style:{top:46+x*28},children:w.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:w.label}):null},w.id)),a.output!==!1?e.jsx(Nr,{type:"source",id:"out",position:Lr.Right}):null]})}function rn({copy:a,value:n,onChange:s}){var _e,Ee,He,ca,oa,Q,re,Ue,Me,fe,$e,qe,Fe,Ve;const u=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=v=>!v||v.nodes.length===0?en:v.nodes.map((k,J)=>{var t,r,h,T;return{id:k.id,type:"computed",position:k.position??{x:40+J*160,y:60+J%3*80},data:{title:k.name||((t=u[k.type])==null?void 0:t.label)||k.type,subtitle:((r=u[k.type])==null?void 0:r.label)||k.type,type:k.type,name:k.name,outputLabel:k.outputLabel,min:k.min,max:k.max,value:k.type==="input.const"?k.value:void 0,list:k.list,handles:((h=u[k.type])==null?void 0:h.handles)??[],output:((T=u[k.type])==null?void 0:T.output)??!0}}}),w=v=>{if(!v||v.nodes.length===0)return an;const k=new Set(v.nodes.map(r=>r.id)),J=[];let t=0;return v.nodes.forEach(r=>{const h=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(h).forEach(([T,V])=>{V.forEach(Z=>{k.has(Z)&&J.push({id:`${r.id}-${T}-${Z}-${t++}`,source:Z,target:r.id,targetHandle:T==="in"?void 0:T})})})}),J},x=i.useMemo(()=>g(n),[n,u]),N=i.useMemo(()=>w(n),[n]),A=(v,k)=>{if(!v)return"null";const J=v.nodes.map(r=>{const h=(r.list??[]).join(","),T=r.inputs?r.inputs.join(","):"",V=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([ae,G])=>`${ae}:${[...G].sort().join(",")}`).sort().join("|"):"",Z=k&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",h,T,V,Z].join(":")}).sort().join("||"),t=v.outputs?[...v.outputs].sort().join(","):v.output??"";return`${J}::${t}`},L=i.useMemo(()=>{var k;const v=!!((k=n==null?void 0:n.nodes)!=null&&k.some(J=>!!J.position));return A(n,v)},[n]),[o,S]=i.useState(x),[b,p]=i.useState(N),[R,q]=i.useState(null),[U,l]=i.useState([]),[m,f]=i.useState(null),[be,D]=i.useState(null),[j,Y]=i.useState({}),[B,ne]=i.useState(0),P=i.useRef(s),O=i.useRef(L),ue=i.useRef(L),pe=i.useRef(A(n,!1)),ge=i.useMemo(()=>R?o.find(v=>v.id===R)??null:null,[o,R]),K=i.useMemo(()=>{const v=["in1","in2","in3","in4","in5","in6"],k=new Map;return b.forEach(J=>{if(!J.target)return;const t=J.targetHandle??"in1";k.has(J.target)||k.set(J.target,new Set),k.get(J.target).add(t)}),o.map(J=>{var t;if(((t=J.data)==null?void 0:t.type)==="compute.concat"){const r=k.get(J.id)??new Set,h=[];let T=!1;return v.forEach(V=>{var Z,ae;if(r.has(V)||!T){const G=(ae=(Z=u["compute.concat"])==null?void 0:Z.handles)==null?void 0:ae.find(de=>de.id===V);G&&h.push(G),r.has(V)||(T=!0)}}),{...J,selected:J.id===R,data:{...J.data,handles:h}}}return{...J,selected:J.id===R}})},[o,R,b,u]);i.useEffect(()=>{f(null),D(null)},[R]),i.useEffect(()=>{if(U.length===0)return;const v=k=>{if(k.key!=="Delete"&&k.key!=="Backspace")return;const J=k.target;J&&(J.tagName==="INPUT"||J.tagName==="TEXTAREA"||J.isContentEditable)||(k.preventDefault(),p(t=>t.filter(r=>!U.includes(r.id))),l([]))};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[U,p]),i.useEffect(()=>{P.current=s},[s]),i.useEffect(()=>{if(O.current!==L){if(ue.current===L||pe.current===L){O.current=L;return}O.current=L,S(x),p(N),q(null),f(null),D(null),Y({}),ne(v=>v+1)}},[x,N,p,S,L]),i.useEffect(()=>{const v=o.filter(h=>{var T;return((T=h.data)==null?void 0:T.type)==="output"}).map(h=>h.id).sort(),k=new Map;b.forEach(h=>{let T=k.get(h.target);T||(T={},k.set(h.target,T));const V=h.targetHandle||"in";T[V]||(T[V]=[]),T[V].push(h.source)}),k.forEach(h=>{Object.values(h).forEach(T=>T.sort())});const J={nodes:o.map(h=>{var T,V,Z,ae,G,de,oe,ke,ea;return{id:h.id,type:((T=h.data)==null?void 0:T.type)??"compute.add",position:h.position,name:(V=h.data)==null?void 0:V.name,outputLabel:(Z=h.data)==null?void 0:Z.outputLabel,min:(ae=h.data)==null?void 0:ae.min,max:(G=h.data)==null?void 0:G.max,value:((de=h.data)==null?void 0:de.type)==="input.const"?(oe=h.data)==null?void 0:oe.value:void 0,list:(ke=h.data)==null?void 0:ke.list,inputs:(ea=k.get(h.id))==null?void 0:ea.in,inputsByHandle:k.get(h.id)}}),output:v[0]??null,outputs:v},t=A(J,!0),r=A(J,!1);t===ue.current||r===pe.current||(ue.current=t,pe.current=r,P.current(J))},[o,b]),i.useEffect(()=>{const v={};let k=!1;o.forEach(J=>{var V,Z,ae,G,de;if(((V=J.data)==null?void 0:V.type)!=="input.random")return;if(j[J.id]!==void 0){v[J.id]=j[J.id];return}const t=Number.isFinite((Z=J.data)==null?void 0:Z.min)?Number((ae=J.data)==null?void 0:ae.min):0,r=Number.isFinite((G=J.data)==null?void 0:G.max)?Number((de=J.data)==null?void 0:de.max):t+10,h=Math.min(t,r),T=Math.max(t,r);v[J.id]=Math.floor(Math.random()*(T-h+1))+h,k=!0}),(k||Object.keys(v).length!==Object.keys(j).length)&&Y(v)},[o,j,B]);const se=i.useMemo(()=>o.map(k=>{var t,r,h,T,V;const J=(((t=k.data)==null?void 0:t.list)??[]).join(",");return[k.id,((r=k.data)==null?void 0:r.type)??"",((h=k.data)==null?void 0:h.name)??"",((T=k.data)==null?void 0:T.min)??"",((V=k.data)==null?void 0:V.max)??"",J].join(":")}).sort().join("|"),[o]),d=i.useMemo(()=>b.map(k=>`${k.source}:${k.target}:${k.targetHandle??""}`).sort().join("|"),[b]),te=i.useMemo(()=>{const v=new Map(o.map(ae=>[ae.id,ae])),k=new Map;b.forEach(ae=>{let G=k.get(ae.target);G||(G={},k.set(ae.target,G));const de=ae.targetHandle||"in";G[de]||(G[de]=[]),G[de].push(ae.source)});const J=new Map,t=new Set,r=ae=>{if(typeof ae=="number")return ae;if(typeof ae=="string"){const G=Number(ae);return Number.isFinite(G)?G:0}return 0},h=(ae,G)=>{var de,oe;return G?((de=k.get(ae.id))==null?void 0:de[G])??[]:((oe=k.get(ae.id))==null?void 0:oe.in)??[]},T=(ae,G)=>h(ae,G).map(de=>r(Z(de))),V=(ae,G)=>h(ae,G).map(de=>Z(de)),Z=ae=>{var ke,ea,Oe,ra;if(J.has(ae))return J.get(ae);if(t.has(ae))return 0;const G=v.get(ae);if(!G)return 0;t.add(ae);const de=((ke=G.data)==null?void 0:ke.type)??"";let oe=0;switch(de){case"input.random":{oe=j[ae]??0;break}case"input.const":{oe=Number.isFinite((ea=G.data)==null?void 0:ea.value)?Number((Oe=G.data)==null?void 0:Oe.value):0;break}case"input.list":{const Ke=(((ra=G.data)==null?void 0:ra.list)??[]).filter(Boolean),We=Math.round(T(G,"index")[0]??0);oe=(Ke.length?Ke[Math.max(0,Math.min(Ke.length-1,We))]:"")||String(We);break}case"compute.add":{oe=T(G,"in").reduce((Ke,We)=>Ke+We,0);break}case"compute.sub":{oe=T(G,"add").reduce((Ke,We)=>Ke+We,0)-T(G,"sub").reduce((Ke,We)=>Ke+We,0);break}case"compute.mul":{const Ke=T(G,"in");oe=Ke.length?Ke.reduce((We,Ae)=>We*Ae,1):0;break}case"compute.div":{const Ke=T(G,"num")[0]??0,We=T(G,"den").reduce((Ae,Ge)=>Ae+Ge,0);oe=Math.abs(We)<Number.EPSILON?0:Ke/We;break}case"compute.pow":{const Ke=T(G,"base")[0]??0,We=T(G,"exp")[0]??0;oe=Math.pow(Ke,We);break}case"compute.exp":{const Ke=T(G,"base")[0]??0,We=T(G,"exp")[0]??0;oe=Math.pow(Ke,We);break}case"compute.log":{const Ke=T(G,"value")[0]??0,We=T(G,"base")[0]??0,Ae=Math.max(Ke,Number.EPSILON);oe=Math.abs(We)<Number.EPSILON?Math.log(Ae):Math.log(Ae)/Math.log(We);break}case"compute.abs":{oe=Math.abs(T(G,"in")[0]??0);break}case"compute.min":{const Ke=T(G,"in");oe=Ke.length?Math.min(...Ke):0;break}case"compute.max":{const Ke=T(G,"in");oe=Ke.length?Math.max(...Ke):0;break}case"compute.floor":{oe=Math.floor(T(G,"in")[0]??0);break}case"compute.ceil":{oe=Math.ceil(T(G,"in")[0]??0);break}case"compute.round":{oe=Math.round(T(G,"in")[0]??0);break}case"compute.mod":{const Ke=T(G,"a")[0]??0,We=T(G,"b")[0]??0;oe=Math.abs(We)<Number.EPSILON?0:Ke%We;break}case"compute.concat":{const We=["in1","in2","in3","in4","in5","in6"].flatMap(sa=>V(G,sa)),Ae=We.length?We:V(G,"in");oe=(Ae.length?Ae:V(G)).map(sa=>sa==null?"":String(sa)).join("");break}case"compute.trim":{const Ke=V(G,"text")[0]??V(G,"in")[0]??"",We=Ke==null?"":String(Ke),Ae=Math.max(0,Math.round(T(G,"start")[0]??0)),Ge=Math.max(0,Math.round(T(G,"end")[0]??0));oe=Ae+Ge>=We.length?"":We.substring(Ae,We.length-Ge);break}case"output":{const Ke=h(G,"in")[0];oe=Ke?Z(Ke):0;break}default:oe=0}return t.delete(ae),J.set(ae,oe),oe};return o.forEach(ae=>Z(ae.id)),J},[se,d,j]),ee=i.useRef(te);i.useEffect(()=>{ee.current=te},[te]);const _=i.useCallback(v=>{const k=ee.current.get(v.id);return e.jsx(tn,{data:{...v.data,value:k}})},[]),Se=i.useMemo(()=>({computed:_}),[_]),le=v=>{var r;if(!v.target||!v.targetHandle){p(h=>$t(v,h));return}const k=o.find(h=>h.id===v.target),J=k?u[((r=k.data)==null?void 0:r.type)??""]:null,t=J==null?void 0:J.handles.find(h=>h.id===v.targetHandle);p(h=>{let T=h;return t!=null&&t.limitOne&&(T=h.filter(V=>!(V.target===v.target&&V.targetHandle===v.targetHandle))),$t(v,T)})},ie=v=>{const k=crypto.randomUUID(),J=u[v]??{label:v,handles:[]},t=J.label;S(r=>[...r,{id:k,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:J.label,type:v,name:"",handles:J.handles,list:v==="input.list"?[]:void 0,output:J.output??!0}}])},Ce=v=>{if(R){if(v.name!==void 0){const k=v.name.trim(),J=k===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(k);if(D(J?null:a.cogita.library.graph.invalidName),!k)f(null);else{const t=o.find(r=>{var h;return r.id!==R&&((h=r.data)==null?void 0:h.name)&&r.data.name.trim().toLowerCase()===k.toLowerCase()});f(t?a.cogita.library.graph.duplicateName:null)}}S(k=>k.map(J=>{var t,r,h,T;return J.id===R?{...J,data:{...J.data,...v,title:v.name?v.name:(t=J.data)==null?void 0:t.title,subtitle:((h=u[v.type??((r=J.data)==null?void 0:r.type)??""])==null?void 0:h.label)??((T=J.data)==null?void 0:T.subtitle)}}:J}))}},me=()=>{R&&(S(v=>v.filter(k=>k.id!==R)),p(v=>v.filter(k=>k.source!==R&&k.target!==R)),Y(v=>{const k={...v};return delete k[R],k}),q(null),f(null))},we=i.useRef({nodeId:null,edgeIds:[]}),Le=v=>{var T;const k=((T=v.nodes[0])==null?void 0:T.id)??null,J=v.edges.map(V=>V.id),t=we.current,r=t.nodeId===k,h=t.edgeIds.length===J.length&&t.edgeIds.every((V,Z)=>V===J[Z]);r&&h||(we.current={nodeId:k,edgeIds:J},q(k),l(J))},Ne=v=>{const k=v.filter(J=>J.type!=="select"&&J.type!=="dimensions");k.length!==0&&S(J=>gi(k,J))},Je=v=>{const k=v.filter(J=>J.type!=="select");k.length!==0&&p(J=>ui(k,J))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(pr,{nodeTypes:Se,nodes:K,edges:b,onNodesChange:Ne,onEdgesChange:Je,onConnect:le,onNodeClick:(v,k)=>q(k.id),onSelectionChange:Le,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(fr,{gap:18,size:1}),e.jsx(xr,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>ie("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>ie("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>ie("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>ie("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>ie("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>ie("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>ie("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>ie("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>ie("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>ie("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>ie("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>ie("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>ie("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>ie("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>ie("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>ie("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>ie("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>ie("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>ie("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>ie("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),ge?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((_e=ge.data)==null?void 0:_e.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:v=>Ce({name:v.target.value})}),m?e.jsx("em",{className:"cogita-help",children:m}):null,be?e.jsx("em",{className:"cogita-help",children:be}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((He=u[((Ee=ge.data)==null?void 0:Ee.type)??""])==null?void 0:He.label)??((ca=ge.data)==null?void 0:ca.type)]}),((oa=ge.data)==null?void 0:oa.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((Q=ge.data)==null?void 0:Q.outputLabel)??"",onChange:v=>Ce({outputLabel:v.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((re=ge.data)==null?void 0:re.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Ue=ge.data)==null?void 0:Ue.min)??0,onChange:v=>Ce({min:Number(v.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Me=ge.data)==null?void 0:Me.max)??10,onChange:v=>Ce({max:Number(v.target.value)})})]})]}),((fe=ge.data)==null?void 0:fe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:(($e=ge.data)==null?void 0:$e.value)??0,onChange:v=>Ce({value:Number(v.target.value)})})]}),((qe=ge.data)==null?void 0:qe.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Fe=ge.data)==null?void 0:Fe.list)??[]).join(`
`),onChange:v=>Ce({list:v.target.value.split(`
`).map(k=>k.replace(/\r$/,"")).filter(k=>k.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((Ve=ge.data)==null?void 0:Ve.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{R&&(Y(v=>{var h,T,V,Z;const k=Number.isFinite((h=ge.data)==null?void 0:h.min)?Number((T=ge.data)==null?void 0:T.min):0,J=Number.isFinite((V=ge.data)==null?void 0:V.max)?Number((Z=ge.data)==null?void 0:Z.max):k+10,t=Math.min(k,J),r=Math.max(k,J);return{...v,[R]:Math.floor(Math.random()*(r-t+1))+t}}),ne(v=>v+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:me,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const rr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function vr(a,n,s){if(!a)return null;const u=new Map(a.nodes.map(D=>[D.id,D])),g=new Map,w=new Set,x=D=>{if(typeof D=="number")return D;if(typeof D=="string"){const j=Number(D);return Number.isFinite(j)?j:0}return 0},N=D=>{if(g.has(D))return g.get(D);if(w.has(D))return 0;const j=u.get(D);if(!j)return 0;w.add(D);const Y=ne=>{var O,ue;return(ne?((O=j.inputsByHandle)==null?void 0:O[ne])??[]:j.inputs??((ue=j.inputsByHandle)==null?void 0:ue.in)??[]).map(pe=>N(pe))};let B=0;switch(j.type){case"input.random":{const ne=j.min??0,P=j.max??ne+10,O=Math.min(ne,P),ue=Math.max(ne,P);B=Math.floor(Math.random()*(ue-O+1))+O;break}case"input.const":{B=j.value??0;break}case"input.list":{const ne=(j.list??[]).filter(Boolean),P=Math.round(x(Y("index")[0]));B=ne.length?ne[Math.max(0,Math.min(ne.length-1,P))]:String(P);break}case"compute.add":{B=Y("in").map(P=>x(P)).reduce((P,O)=>P+O,0);break}case"compute.sub":{const ne=Y("add").map(O=>x(O)),P=Y("sub").map(O=>x(O));B=ne.reduce((O,ue)=>O+ue,0)-P.reduce((O,ue)=>O+ue,0);break}case"compute.mul":{const ne=Y("in").map(P=>x(P));B=ne.length?ne.reduce((P,O)=>P*O,1):0;break}case"compute.div":{const ne=x(Y("num")[0]),P=Y("den").map(O=>x(O)).reduce((O,ue)=>O+ue,0);B=Math.abs(P)<Number.EPSILON?0:ne/P;break}case"compute.pow":{const ne=x(Y("base")[0]),P=x(Y("exp")[0]);B=Math.pow(ne,P);break}case"compute.exp":{const ne=x(Y("base")[0]),P=x(Y("exp")[0]);B=Math.pow(ne,P);break}case"compute.log":{const ne=x(Y("value")[0]),P=x(Y("base")[0]),O=Math.max(ne,Number.EPSILON);B=Math.abs(P)<Number.EPSILON?Math.log(O):Math.log(O)/Math.log(P);break}case"compute.abs":{B=Math.abs(x(Y("in")[0]));break}case"compute.min":{const ne=Y("in").map(P=>x(P));B=ne.length?Math.min(...ne):0;break}case"compute.max":{const ne=Y("in").map(P=>x(P));B=ne.length?Math.max(...ne):0;break}case"compute.floor":{B=Math.floor(x(Y("in")[0]));break}case"compute.ceil":{B=Math.ceil(x(Y("in")[0]));break}case"compute.round":{B=Math.round(x(Y("in")[0]));break}case"compute.mod":{const ne=x(Y("a")[0]),P=x(Y("b")[0]);B=Math.abs(P)<Number.EPSILON?0:ne%P;break}case"compute.concat":{const P=["in1","in2","in3","in4","in5","in6"].flatMap(ge=>Y(ge)),O=P.length?P:Y("in");B=(O.length?O:Y()).map(ge=>ge==null?"":String(ge)).join("");break}case"compute.trim":{const ne=Y("text")[0]??Y("in")[0]??"",P=ne==null?"":String(ne),O=Math.max(0,Math.round(x(Y("start")[0]))),ue=Math.max(0,Math.round(x(Y("end")[0])));O+ue>=P.length?B="":B=P.substring(O,P.length-ue);break}case"output":{B=Y("in")[0]??0;break}default:B=0}return w.delete(D),g.set(D,B),B},A=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(D=>D.type==="output").map(D=>D.id);a.nodes.forEach(D=>N(D.id)),A.forEach(D=>N(D));const L=D=>Math.abs(D%1)<1e-5?String(Math.round(D)):D.toFixed(3).replace(/\.?0+$/,""),o=D=>typeof D=="number"?L(D):D??"",S=new Map;A.forEach(D=>{var P,O,ue,pe;const j=u.get(D);if(!j)return;const Y=(O=(P=j.inputsByHandle)==null?void 0:P.name)==null?void 0:O[0],B=Y?o(g.get(Y)):"",ne=(B==null?void 0:B.toString().trim())||((ue=j.outputLabel)==null?void 0:ue.trim())||((pe=j.name)==null?void 0:pe.trim())||D;S.set(D,ne)});const b={},p={},R={};A.forEach(D=>{var B,ne;const j=u.get(D);if(!j)return;const Y=S.get(D)??(((B=j.outputLabel)==null?void 0:B.trim())||((ne=j.name)==null?void 0:ne.trim())||D);b[Y]=o(g.get(D)),j.name&&(p[j.name.trim()]=Y),p[D]=Y});const q=(D,j)=>{let Y=D;return a.nodes.forEach(B=>{var pe,ge;const ne=o(g.get(B.id)),P=A.includes(B.id),O=P?S.get(B.id)??((pe=B.outputLabel)==null?void 0:pe.trim())??((ge=B.name)==null?void 0:ge.trim())??B.id:"",ue=P&&j?O:ne;Y=Y.replace(new RegExp(`\\{\\s*${rr(B.id)}\\s*\\}`,"gi"),ue),B.name&&(Y=Y.replace(new RegExp(`\\{\\s*${rr(B.name)}\\s*\\}`,"gi"),ue)),P&&B.outputLabel&&(Y=Y.replace(new RegExp(`\\{\\s*${rr(B.outputLabel)}\\s*\\}`,"gi"),O))}),Y},U=n;let l=U.trim().length>0?U:"";l||(l=A.length?`Compute ${A.join(", ")}`:"Compute"),l=q(l,!0);const m=(s==null?void 0:s.trim())??"",f=m?q(m,!1):"",be={};return g.forEach((D,j)=>{be[j]=D,R[j]=o(D);const Y=u.get(j);Y!=null&&Y.name&&(R[Y.name.trim()]=o(D))}),{prompt:l,answers:b,values:be,answerText:f,outputVariables:p,variableValues:R}}function Xr(a){var s;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((s=n[0])==null?void 0:s[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function nn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,editInfoId:S}){const{libraryName:b}=_a(o),p=!!S,R=`/#/cogita/library/${o}`,[q,U]=i.useState("info"),[l,m]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[f,be]=i.useState(""),[D,j]=i.useState(null),[Y,B]=i.useState(null),[ne,P]=i.useState("idle"),[O,ue]=i.useState(null),[pe,ge]=i.useState(-1),[K,se]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[d,te]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[ee,_]=i.useState(null),[Se,le]=i.useState("idle"),[ie,Ce]=i.useState(null),[me,we]=i.useState(null),[Le,Ne]=i.useState(null),Je=i.useRef(null),_e=i.useRef(null),Ee=i.useRef(null),He=i.useMemo(()=>Gr(a),[a]),ca=i.useMemo(()=>Qi(a),[a]),oa=i.useMemo(()=>Gi(a),[a]),Q=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),re=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Ue=i.useMemo(()=>He.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[He]),Me=i.useMemo(()=>{const t=A;return At.map(r=>{var V;const h=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${h.abbr} — ${h.name}`,latin:((V=r==null?void 0:r.la)==null?void 0:V.abbr)??h.abbr}})},[A]),fe=(t,r=!1)=>{const h=t.trim().toLowerCase();return h?Me.filter(T=>T.label.toLowerCase().includes(h)).slice(0,8):r?Me.slice(0,8):[]},$e=(t,r)=>{const h=t.trim().toLowerCase();if(!h)return null;const T=At;for(const V of T){const Z=V==null?void 0:V.la,ae=(V==null?void 0:V[r])??(V==null?void 0:V.en)??Z;if([ae==null?void 0:ae.abbr,ae==null?void 0:ae.name,Z==null?void 0:Z.abbr,Z==null?void 0:Z.name,`${ae==null?void 0:ae.abbr} — ${ae==null?void 0:ae.name}`].filter(Boolean).map(de=>de.toLowerCase()).some(de=>de===h))return{book:V,entry:ae,la:Z}}return null};i.useEffect(()=>{if(!K.language||!K.word){Ce(null);return}const t=window.setTimeout(()=>{ar({libraryId:o,languageId:K.language.id,wordId:K.word.id}).then(r=>{Ce(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{Ce(null)})},200);return()=>window.clearTimeout(t)},[o,K.language,K.word]),i.useEffect(()=>{if(!d.languageA||!d.wordA){we(null);return}const t=window.setTimeout(()=>{ar({libraryId:o,languageId:d.languageA.id,wordId:d.wordA.id}).then(r=>{we(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{we(null)})},200);return()=>window.clearTimeout(t)},[o,d.languageA,d.wordA]),i.useEffect(()=>{if(!d.languageB||!d.wordB){Ne(null);return}const t=window.setTimeout(()=>{ar({libraryId:o,languageId:d.languageB.id,wordId:d.wordB.id}).then(r=>{Ne(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Ne(null)})},200);return()=>window.clearTimeout(t)},[o,d.languageB,d.wordB]),i.useEffect(()=>{if(!p||!S)return;let t=!1;return le("loading"),_(null),it({libraryId:o,infoId:S}).then(async r=>{var T,V;if(t)return;const h=r.payload??{};if(m(Z=>({...Z,infoType:r.infoType,label:h.label??"",notes:h.notes??"",language:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,sourceKind:h.sourceKind??"string",sourceResourceType:Z.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:h.text??"",workLanguage:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,workOriginalLanguage:h.originalLanguageId?{id:h.originalLanguageId,label:h.originalLanguageId,infoType:"language"}:null,workDoi:h.doi??"",mediaType:h.mediaType??"book",mediaPublisher:h.publisher??"",mediaPublicationPlace:h.publicationPlace??"",mediaPublicationYear:h.publicationYear??"",mediaPages:h.pages??"",mediaIsbn:h.isbn??"",mediaCover:h.cover??"",mediaHeight:h.height??"",mediaLength:h.length??"",mediaWidth:h.width??"",mediaWeight:h.weight??"",mediaCollection:h.collection??"",mediaLocation:h.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&h.locator&&typeof h.locator=="object"){const Z=h.locator;if(h.sourceKind==="website")m(ae=>({...ae,sourceUrl:typeof Z.url=="string"?Z.url:"",sourceAccessedDate:typeof Z.date=="string"?Z.date:""}));else if(h.sourceKind==="bible"){const ae=typeof Z.book=="string"?Z.book:"",G=ae?$e(ae,A):null,de=G?`${G.entry.abbr} — ${G.entry.name}`:ae;m(oe=>({...oe,sourceLocatorValue:ae,sourceLocatorAux:typeof Z.rest=="string"?Z.rest:"",sourceBibleBookDisplay:de}))}else h.sourceKind==="book"?m(ae=>({...ae,sourceLocatorValue:typeof Z.page=="string"?Z.page:""})):h.sourceKind==="number_document"?m(ae=>({...ae,sourceLocatorValue:typeof Z.number=="string"?Z.number:""})):typeof Z.text=="string"&&m(ae=>({...ae,sourceLocatorValue:Z.text}))}if(h.languageId&&r.infoType!=="work")try{const Z=await it({libraryId:o,infoId:h.languageId});if(t)return;m(ae=>{var G;return{...ae,language:{id:h.languageId,label:((G=Z.payload)==null?void 0:G.label)??h.languageId,infoType:"language"}}})}catch{}if(h.languageId&&r.infoType==="work")try{const Z=await it({libraryId:o,infoId:h.languageId});if(t)return;m(ae=>{var G;return{...ae,workLanguage:{id:h.languageId,label:((G=Z.payload)==null?void 0:G.label)??h.languageId,infoType:"language"}}})}catch{}if(h.originalLanguageId)try{const Z=await it({libraryId:o,infoId:h.originalLanguageId});if(t)return;m(ae=>{var G;return{...ae,workOriginalLanguage:{id:h.originalLanguageId,label:((G=Z.payload)==null?void 0:G.label)??h.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(be(((T=h.definition)==null?void 0:T.answerTemplate)??""),j(((V=h.definition)==null?void 0:V.graph)??null),B(null),P("idle")):(be(""),j(null),B(null),P("idle")),U("info")}).catch(()=>{t||_(a.cogita.library.add.info.failed)}).finally(()=>{t||le("idle")}),()=>{t=!0}},[a,S,p,o]),i.useEffect(()=>{if(l.sourceKind==="bible"&&l.sourceLocatorValue&&O!=="source"){const t=$e(l.sourceLocatorValue,A);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==l.sourceBibleBookDisplay&&m(h=>({...h,sourceBibleBookDisplay:r}))}}},[A,l.sourceKind,l.sourceLocatorValue,l.sourceBibleBookDisplay]);const qe=async()=>{var t,r;_(null);try{const h={label:l.infoType==="quote"||l.infoType==="source"?"":l.label,notes:l.infoType==="computed"?"":l.notes};if(l.language&&(l.infoType==="word"||l.infoType==="sentence")&&(h.languageId=l.language.id),l.infoType==="source"&&(h.sourceKind=l.sourceKind,l.sourceKind==="website"?h.locator={url:l.sourceUrl.trim(),date:l.sourceAccessedDate.trim()}:l.sourceKind==="bible"?h.locator={book:l.sourceLocatorValue.trim(),rest:l.sourceLocatorAux.trim()}:l.sourceKind==="book"?h.locator={page:l.sourceLocatorValue.trim()}:l.sourceKind==="number_document"?h.locator={number:l.sourceLocatorValue.trim()}:h.locator={text:l.sourceLocatorValue.trim()}),l.infoType==="quote"&&(h.text=l.quoteText),l.infoType==="work"&&(h.languageId=((t=l.workLanguage)==null?void 0:t.id)??null,h.originalLanguageId=((r=l.workOriginalLanguage)==null?void 0:r.id)??null,h.doi=l.workDoi.trim()),l.infoType==="media"&&(h.mediaType=l.mediaType,h.publisher=l.mediaPublisher.trim(),h.publicationPlace=l.mediaPublicationPlace.trim(),h.publicationYear=l.mediaPublicationYear.trim(),h.pages=l.mediaPages.trim(),h.isbn=l.mediaIsbn.trim(),h.cover=l.mediaCover.trim(),h.height=l.mediaHeight.trim(),h.length=l.mediaLength.trim(),h.width=l.mediaWidth.trim(),h.weight=l.mediaWeight.trim(),h.collection=l.mediaCollection.trim(),h.location=l.mediaLocation.trim()),l.infoType==="computed"){if(!D){_(a.cogita.library.add.info.computedRequired);return}if(!f.trim()){_(a.cogita.library.add.info.computedAnswerRequired);return}if(D.nodes.find(oe=>oe.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(oe.name))){_(a.cogita.library.add.info.computedInvalidName);return}const V=D.nodes.map(oe=>{var ke;return(ke=oe.name)==null?void 0:ke.trim()}).filter(Boolean),Z=new Set;for(const oe of V){const ke=oe.toLowerCase();if(Z.has(ke)){_(a.cogita.library.add.info.computedDuplicateName);return}Z.add(ke)}const ae=D.nodes.filter(oe=>oe.type==="output"),G=ae.map(oe=>{var ke;return(ke=oe.name)==null?void 0:ke.trim()}).filter(Boolean);if(G.length!==ae.length){_(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!G.every(oe=>new RegExp(`\\{\\s*${oe}\\s*\\}`,"i").test(f))){_(a.cogita.library.add.info.computedAnswerMissingOutput);return}h.definition={answerTemplate:f,graph:D}}if(p&&S)le("saving"),await mi({libraryId:o,infoId:S,payload:h}),_(a.cogita.library.add.info.updated),le("idle");else{let T=null;if(l.referenceEnabled){const oe={sourceKind:l.referenceSourceKind,locatorValue:l.referenceLocatorValue,locatorAux:l.referenceLocatorAux,bibleBookDisplay:l.referenceBibleBookDisplay,sourceUrl:l.referenceSourceUrl,sourceAccessedDate:l.referenceSourceAccessedDate,churchDocument:l.referenceChurchDocument,bookMedia:l.referenceBookMedia,work:l.referenceWork},{payload:ke,resourceInfoId:ea,error:Oe}=Fe(oe);if(Oe){_(a.cogita.library.add.info.referenceMissingSource);return}T={payload:ke,resourceInfoId:ea}}const V=await rt({libraryId:o,infoType:l.infoType,payload:h});if(l.infoType==="source"&&l.sourceResource&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[V.infoId,l.sourceResource.id]}),l.infoType==="quote"&&l.language&&await ga({libraryId:o,connectionType:"quote-language",infoIds:[V.infoId,l.language.id]}),T){const oe=await rt({libraryId:o,infoType:"source",payload:T.payload});T.resourceInfoId&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[oe.infoId,T.resourceInfoId]}),await ga({libraryId:o,connectionType:"reference",infoIds:[V.infoId,oe.infoId]})}_(a.cogita.library.add.info.saved);const Z=l.infoType==="word"||l.infoType==="sentence",ae=l.referenceEnabled,G=l.referenceSourceKind,de={referenceEnabled:ae,referenceSourceKind:ae?G:"string",referenceSourceUrl:ae&&G==="website"?l.referenceSourceUrl:"",referenceSourceAccessedDate:ae&&G==="website"?l.referenceSourceAccessedDate:"",referenceChurchDocument:ae&&G==="number_document"?l.referenceChurchDocument:null,referenceBookMedia:ae&&G==="book"?l.referenceBookMedia:null,referenceWork:ae&&G==="work"?l.referenceWork:null,referenceLocatorValue:ae&&G==="bible"?l.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:ae&&G==="bible"?l.referenceBibleBookDisplay:""};m({infoType:l.infoType,label:"",language:Z?l.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:l.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...de}),l.infoType==="computed"&&(be(""),j(null),B(null),P("idle"))}}catch{_(a.cogita.library.add.info.failed)}},Fe=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const h={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(h.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:h,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(h.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:h,resourceInfoId:r}):(t.sourceKind==="book"?h.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?h.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(h.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:h,resourceInfoId:r})},Ve=()=>{if(P("idle"),!D){B(null),P("error");return}const t=vr(D,"",f);if(!t){B(null),P("error");return}B({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),P("ready")},v=async()=>{_(null);try{if(K.connectionType==="reference"){if(!K.referencedInfo||!K.source){_(a.cogita.library.add.connection.selectReference);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.referencedInfo.id,K.source.id]})}else if(K.connectionType==="source-resource"){if(!K.source||!K.sourceResource){_(a.cogita.library.add.connection.selectSourceResource);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.source.id,K.sourceResource.id]})}else if(K.connectionType==="quote-language"){if(!K.quote||!K.language){_(a.cogita.library.add.connection.selectQuoteLanguage);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.quote.id,K.language.id]})}else if(K.connectionType==="work-contributor"){if(!K.work||!K.contributor||!K.contributorRole.trim()){_(a.cogita.library.add.connection.selectWorkContributor);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.work.id,K.contributor.id],payload:{role:K.contributorRole.trim()}})}else if(K.connectionType==="work-medium"){if(!K.work||!K.medium){_(a.cogita.library.add.connection.selectWorkMedium);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.work.id,K.medium.id]})}else if(K.connectionType==="orcid-link"){if(!K.orcidEntity||!K.orcid){_(a.cogita.library.add.connection.selectOrcidLink);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.orcidEntity.id,K.orcid.id]})}else if(K.connectionType==="word-language"){if(!K.language||!K.word){_(a.cogita.library.add.connection.selectWordLanguage);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.language.id,K.word.id],payload:{note:K.note}})}else if(K.connectionType==="word-topic"){if(!K.word||!K.topic){_(a.cogita.library.add.connection.selectWordTopic);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.word.id,K.topic.id],payload:{note:K.note}})}else if(K.connectionType==="translation"){if(!K.wordA||!K.wordB){_(a.cogita.library.add.connection.selectTwoWords);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.wordA.id,K.wordB.id],payload:{note:K.note}})}else if(K.connectionType==="language-sentence"){if(!K.language||!K.sentence){_(a.cogita.library.add.connection.selectLanguageSentence);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.language.id,K.sentence.id],payload:{note:K.note}})}_(a.cogita.library.add.connection.saved),se(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{_(a.cogita.library.add.connection.failed)}},k=async()=>{var t,r;_(null);try{if(d.groupType==="citation"){const T=d.citationTitle.trim(),V=d.citationQuoteText.trim();if(!V){_(a.cogita.library.add.group.citationMissingQuote);return}let Z=null;if(d.citationReferenceEnabled){const de={sourceKind:d.citationSourceKind,locatorValue:d.citationLocatorValue,locatorAux:d.citationLocatorAux,bibleBookDisplay:d.citationBibleBookDisplay,sourceUrl:d.citationSourceUrl,sourceAccessedDate:d.citationSourceAccessedDate,churchDocument:d.citationChurchDocument,bookMedia:d.citationBookMedia,work:d.citationWork},{payload:oe,resourceInfoId:ke,error:ea}=Fe(de);if(ea){_(a.cogita.library.add.info.referenceMissingSource);return}Z={payload:oe,resourceInfoId:ke}}const ae={text:V};T&&(ae.title=T);const G=await rt({libraryId:o,infoType:"quote",payload:ae});if(d.citationLanguage&&await ga({libraryId:o,connectionType:"quote-language",infoIds:[G.infoId,d.citationLanguage.id]}),Z){const de=await rt({libraryId:o,infoType:"source",payload:Z.payload});Z.resourceInfoId&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[de.infoId,Z.resourceInfoId]}),await ga({libraryId:o,connectionType:"reference",infoIds:[G.infoId,de.infoId]})}_(a.cogita.library.add.group.savedCitation),te(de=>({...de,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:de.citationReferenceEnabled,citationSourceKind:de.citationReferenceEnabled?de.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:de.citationReferenceEnabled?de.citationChurchDocument:null,citationBookMedia:de.citationReferenceEnabled?de.citationBookMedia:null,citationWork:de.citationReferenceEnabled?de.citationWork:null}));return}if(d.groupType==="book"){const T=d.bookTitle.trim();if(!T){_(a.cogita.library.add.group.bookMissingTitle);return}const V=d.bookWorkTitle.trim();if(!V){_(a.cogita.library.add.group.bookMissingWork);return}if(d.bookContributors.find(oe=>oe.contributor&&!oe.role.trim()||!oe.contributor&&oe.role.trim())){_(a.cogita.library.add.group.bookMissingContributor);return}const ae=await rt({libraryId:o,infoType:"media",payload:{label:T,mediaType:"book",publisher:d.bookPublisher.trim(),publicationPlace:d.bookPublicationPlace.trim(),publicationYear:d.bookPublicationYear.trim(),pages:d.bookPages.trim(),isbn:d.bookIsbn.trim(),cover:d.bookCover.trim(),height:d.bookHeight.trim(),length:d.bookLength.trim(),width:d.bookWidth.trim(),weight:d.bookWeight.trim(),collection:d.bookCollection.trim(),location:d.bookLocation.trim()}}),G=await rt({libraryId:o,infoType:"work",payload:{label:V,languageId:((t=d.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=d.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:d.bookWorkDoi.trim()}});await ga({libraryId:o,connectionType:"work-medium",infoIds:[G.infoId,ae.infoId]});const de=d.bookContributors.filter(oe=>oe.contributor&&oe.role.trim());for(const oe of de)await ga({libraryId:o,connectionType:"work-contributor",infoIds:[G.infoId,oe.contributor.id],payload:{role:oe.role.trim()}});_(a.cogita.library.add.group.savedBook),te(oe=>({...oe,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!d.languageA||!d.wordA||!d.languageB||!d.wordB){_(a.cogita.library.add.group.selectBoth);return}const h=T=>Array.from(new Map(T.map(V=>[V.id,V])).values());me||await ga({libraryId:o,connectionType:"word-language",infoIds:[d.languageA.id,d.wordA.id]}),Le||await ga({libraryId:o,connectionType:"word-language",infoIds:[d.languageB.id,d.wordB.id]});for(const T of h(d.wordATags))await ga({libraryId:o,connectionType:"word-topic",infoIds:[d.wordA.id,T.id]});for(const T of h(d.wordBTags))await ga({libraryId:o,connectionType:"word-topic",infoIds:[d.wordB.id,T.id]});await ga({libraryId:o,connectionType:"translation",infoIds:[d.wordA.id,d.wordB.id],payload:{tagIds:h(d.translationTags).map(T=>T.id)}}),_(a.cogita.library.add.group.savedVocab),te(T=>({...T,groupType:d.groupType,languageA:d.languageA,wordA:null,languageB:d.languageB,wordB:null,wordATags:d.wordATags,wordBTags:d.wordBTags,translationTags:d.translationTags})),requestAnimationFrame(()=>{var T;return(T=Je.current)==null?void 0:T.focus()})}catch{_(a.cogita.library.add.group.failed)}},J=d.groupType==="citation"?a.cogita.library.add.group.saveCitation:d.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:R,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${R}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":q===t,onClick:()=>{p||U(t)},disabled:p&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[q==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:l.infoType,onChange:t=>{p||m(r=>({...r,infoType:t.target.value}))},disabled:p,children:He.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),l.infoType!=="quote"&&l.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:l.label,onChange:t=>m(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(l.infoType==="word"||l.infoType==="sentence"||l.infoType==="quote")&&e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:l.language,onChange:t=>m(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),l.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:l.workLanguage,onChange:t=>m(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:l.workOriginalLanguage,onChange:t=>m(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:l.workDoi,onChange:t=>m(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),l.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:l.mediaType,onChange:t=>m(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:l.mediaPublisher,onChange:t=>m(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:l.mediaPublicationPlace,onChange:t=>m(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:l.mediaPublicationYear,onChange:t=>m(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:l.mediaPages,onChange:t=>m(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:l.mediaIsbn,onChange:t=>m(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:l.mediaCover,onChange:t=>m(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:l.mediaHeight,onChange:t=>m(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:l.mediaLength,onChange:t=>m(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:l.mediaWidth,onChange:t=>m(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:l.mediaWeight,onChange:t=>m(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:l.mediaCollection,onChange:t=>m(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:l.mediaLocation,onChange:t=>m(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),l.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:l.quoteText,onChange:t=>m(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),l.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:l.sourceKind,onChange:t=>{const r=t.target.value,h=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":l.sourceResourceType;m(T=>({...T,sourceKind:r,sourceResourceType:h,sourceResource:null,sourceLocatorValue:r==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?T.sourceBibleBookDisplay:""}))},children:Q.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),l.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:l.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;m(h=>({...h,sourceBibleBookDisplay:r,sourceLocatorValue:""})),ue("source"),ge(-1)},onKeyDown:t=>{const r=fe(l.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),ge(h=>Math.min(h+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),ge(h=>Math.max(h-1,0));else if((t.key==="Enter"||t.key==="Tab")&&pe>=0&&r[pe]){const h=r[pe],T=$e(h.label,A);if(!T)return;m(V=>{var Z;return{...V,sourceBibleBookDisplay:h.label,sourceLocatorValue:((Z=T.la)==null?void 0:Z.abbr)??V.sourceLocatorValue}}),ue(null)}}},onFocus:()=>ue("source"),onBlur:()=>window.setTimeout(()=>ue(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),O==="source"&&fe(l.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:fe(l.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===pe,tabIndex:-1,onMouseDown:()=>{const h=$e(t.label,A);h&&m(T=>{var V;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((V=h.la)==null?void 0:V.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:l.sourceLocatorAux,onChange:t=>m(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),l.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:l.sourceUrl,onChange:t=>m(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:l.sourceAccessedDate,onChange:t=>m(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),l.sourceKind!=="website"&&l.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:l.sourceLocatorValue,onChange:t=>m(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),l.sourceKind!=="string"&&l.sourceKind!=="website"&&l.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:l.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(l.sourceKind),onChange:t=>m(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ue.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ye,{libraryId:o,infoType:l.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:l.sourceResource,onChange:t=>m(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,l.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),l.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:l.notes,onChange:t=>m(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,l.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:f,onChange:t=>be(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(rn,{copy:a,value:D,onChange:t=>j(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Ve,children:a.cogita.library.add.info.computedPreview})}),Y&&ne==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(hr,{value:Y.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(Y.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(bi,{value:r,mode:"auto"})]},t))}),Y.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(hr,{value:Y.answerText,mode:"auto"})]}):null]}):ne==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:l.referenceEnabled,onChange:t=>m(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),l.referenceEnabled&&e.jsx(Ar,{libraryId:o,copy:a,language:A,sourceKindOptions:Q,labels:re,value:{sourceKind:l.referenceSourceKind,locatorValue:l.referenceLocatorValue,locatorAux:l.referenceLocatorAux,bibleBookDisplay:l.referenceBibleBookDisplay,sourceUrl:l.referenceSourceUrl,sourceAccessedDate:l.referenceSourceAccessedDate,churchDocument:l.referenceChurchDocument,bookMedia:l.referenceBookMedia,work:l.referenceWork},onChange:t=>m(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:qe,disabled:Se==="saving"||Se==="loading",children:p?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,q==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:K.connectionType,onChange:t=>se(r=>({...r,connectionType:t.target.value})),children:ca.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),K.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>se(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:K.word,onChange:t=>se(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),ie&&e.jsx("p",{className:"cogita-help",children:ie})]}),K.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:K.word,onChange:t=>se(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:K.topic,onChange:t=>se(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:K.wordA,onChange:t=>se(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:K.wordB,onChange:t=>se(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:K.quote,onChange:t=>se(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>se(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>se(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:K.sentence,onChange:t=>se(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:K.referencedInfoType,onChange:t=>se(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:He.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ye,{libraryId:o,infoType:K.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:K.referencedInfo,onChange:t=>se(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:K.source,onChange:t=>se(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:K.source,onChange:t=>se(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:K.sourceResourceType,onChange:t=>se(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ue.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ye,{libraryId:o,infoType:K.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:K.sourceResource,onChange:t=>se(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:K.work,onChange:t=>se(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:K.contributorType,onChange:t=>se(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ze(a,t)},t))})]}),e.jsx(Ye,{libraryId:o,infoType:K.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:K.contributor,onChange:t=>se(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:K.contributorRole,onChange:t=>se(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),K.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:K.work,onChange:t=>se(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:K.medium,onChange:t=>se(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:K.orcidEntityType,onChange:t=>se(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ze(a,t)},t))})]}),e.jsx(Ye,{libraryId:o,infoType:K.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:K.orcidEntity,onChange:t=>se(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(Ye,{libraryId:o,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:K.orcid,onChange:t=>se(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:K.note,onChange:t=>se(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:v,children:a.cogita.library.add.connection.save})})]}):null,q==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:d.groupType,onChange:t=>te(r=>({...r,groupType:t.target.value})),children:oa.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:d.citationLanguage,onChange:t=>te(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:d.citationTitle,onChange:t=>te(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:d.citationQuoteText,onChange:t=>te(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:d.citationReferenceEnabled,onChange:t=>te(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),d.citationReferenceEnabled&&e.jsx(Ar,{libraryId:o,copy:a,language:A,sourceKindOptions:Q,labels:re,value:{sourceKind:d.citationSourceKind,locatorValue:d.citationLocatorValue,locatorAux:d.citationLocatorAux,bibleBookDisplay:d.citationBibleBookDisplay,sourceUrl:d.citationSourceUrl,sourceAccessedDate:d.citationSourceAccessedDate,churchDocument:d.citationChurchDocument,bookMedia:d.citationBookMedia,work:d.citationWork},onChange:t=>te(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),d.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:d.bookTitle,onChange:t=>te(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:d.bookPublisher,onChange:t=>te(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:d.bookPublicationPlace,onChange:t=>te(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:d.bookPublicationYear,onChange:t=>te(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:d.bookPages,onChange:t=>te(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:d.bookIsbn,onChange:t=>te(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:d.bookCover,onChange:t=>te(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:d.bookHeight,onChange:t=>te(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:d.bookLength,onChange:t=>te(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:d.bookWidth,onChange:t=>te(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:d.bookWeight,onChange:t=>te(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:d.bookCollection,onChange:t=>te(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:d.bookLocation,onChange:t=>te(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:d.bookWorkTitle,onChange:t=>te(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:d.bookWorkLanguage,onChange:t=>te(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:d.bookWorkOriginalLanguage,onChange:t=>te(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:d.bookWorkDoi,onChange:t=>te(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>te(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),d.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:h=>te(T=>({...T,bookContributors:T.bookContributors.map((V,Z)=>Z===r?{...V,contributorType:h.target.value,contributor:null}:V)})),children:["person","institution","collective"].map(h=>e.jsx("option",{value:h,children:Ze(a,h)},h))})]}),e.jsx(Ye,{libraryId:o,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:h=>te(T=>({...T,bookContributors:T.bookContributors.map((V,Z)=>Z===r?{...V,contributor:h}:V)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:h=>te(T=>({...T,bookContributors:T.bookContributors.map((V,Z)=>Z===r?{...V,role:h.target.value}:V)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>te(h=>{const T=h.bookContributors.filter((V,Z)=>Z!==r);return T.length===0?{...h,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...h,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),d.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:d.languageA,onChange:t=>te(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:d.languageB,onChange:t=>te(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:d.wordA,onChange:t=>te(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Je,autoAdvance:!0,onCommit:()=>{var t;return(t=_e.current)==null?void 0:t.focus()}}),e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:d.wordB,onChange:t=>te(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:_e,autoAdvance:!0,onCommit:()=>{var t;return(t=Ee.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:d.translationTags,onChangeMultiple:t=>te(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:d.wordATags,onChangeMultiple:t=>te(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:d.wordBTags,onChangeMultiple:t=>te(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),d.groupType==="vocab"&&me&&e.jsx("p",{className:"cogita-help",children:me}),d.groupType==="vocab"&&Le&&e.jsx("p",{className:"cogita-help",children:Le}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:k,ref:Ee,children:J})})]}):null,ee?e.jsx("p",{className:"cogita-form-error",children:ee}):null]})})})})})]})})}const Fr=a=>/\s/.test(a),Ft=a=>/[\p{L}\p{N}]/u.test(a),Br=(a,n)=>{const s=n>0?a[n-1]:"",u=n<a.length?a[n]:"";if(!s||!u)return 0;const g=Fr(s),w=Fr(u);if(g||w)return 3;const x=Ft(s),N=Ft(u);return x!==N?2:!x&&!N?1:0},ir=(a,n,s,u,g)=>{const w=Math.max(u-n,s-u);for(let x=0;x<=w;x+=1){const N=u-x;if(N>=n&&N<=s&&Br(a,N)>=g)return N;const A=u+x;if(A>=n&&A<=s&&Br(a,A)>=g)return A}return null},nr=(a,n)=>{const s=n>0?a[n-1]:"",u=n<a.length?a[n]:"";return!s||!u?!0:Ft(s)!==Ft(u)},on=(a,n,s,u)=>{const g=s-n,w=n+u,x=s-u;if(g<=u*2||x<=w)return null;const N=Math.floor((n+s)/2),A=ir(a,w,x,N,3);if(A!==null&&nr(a,A))return A;const L=ir(a,w,x,N,2);if(L!==null&&nr(a,L))return L;const o=ir(a,w,x,N,1);return o!==null&&nr(a,o)?o:null},pt=(a,n)=>{const s=Math.max(1,7),u=Math.max(s,13),g={},w=(A,L,o,S,b)=>{const p=String(S),R={id:p,start:A,end:L,text:a.slice(A,L),depth:o,index:S,parentId:b};if(g[p]=R,L-A>u){let U=on(a,A,L,s);if(U!==null&&U>A&&U<L){const l=w(A,U,o+1,S*2+1,p),m=w(U,L,o+1,S*2+2,p);R.leftId=l.id,R.rightId=m.id}}return R},x=w(0,a.length,0,0),N=Object.values(g).sort((A,L)=>L.depth-A.depth||A.start-L.start).map(A=>A.id);return{text:a,rootId:x.id,nodes:g,order:N}},bt=(a,n,s,u,g,w,x)=>{const N=w==="reverse"?a.order.slice().sort((A,L)=>a.nodes[L].start-a.nodes[A].start||a.nodes[L].depth-a.nodes[A].depth):a.order;for(const A of N){if(x&&A===x||n.has(A))continue;const L=a.nodes[A];if(L){if(g&&(L.leftId||L.rightId)){const o=L.leftId?s[L.leftId]??0:u,S=L.rightId?s[L.rightId]??0:u;if((o+S)/2<u)continue}return L}}return null},Zr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function sn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const S=`/#/cogita/library/${o}`,[b,p,R]=Or([]),[q,U,l]=_r([]),[m,f]=i.useState(null),[be,D]=i.useState(null),[j,Y]=i.useState(null),[B,ne]=i.useState(null),P=i.useMemo(()=>b.find(d=>d.id===m)??null,[b,m]);i.useEffect(()=>{let d=!0;return pi({libraryId:o}).then(te=>{if(!d)return;const ee=te.nodes.map(_=>{var Se,le,ie;return{id:_.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:_.payload&&typeof _.payload=="object"&&"label"in _.payload?String(_.payload.label):"Item",nodeType:_.nodeType,itemType:((Se=_.payload)==null?void 0:Se.itemType)??"info",itemId:((le=_.payload)==null?void 0:le.itemId)??null,infoType:((ie=_.payload)==null?void 0:ie.infoType)??null}}});p(ee),U(te.edges.map(_=>({id:_.edgeId,source:_.fromNodeId,target:_.toNodeId})))}).catch(()=>{d&&(p([]),U([]))}),()=>{d=!1}},[o]),i.useEffect(()=>{fi({libraryId:o}).then(D).catch(()=>D(null))},[o,b,q]);const O=i.useCallback(d=>{U(te=>$t(d,te))},[]),ue=()=>{const d=crypto.randomUUID();p(te=>[...te,{id:d,type:"default",position:{x:140+te.length*40,y:120+te.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},pe=()=>{const d=crypto.randomUUID();p(te=>[...te,{id:d,type:"default",position:{x:180+te.length*40,y:160+te.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ge=async()=>{Y(null);try{const d=b.map(ee=>({nodeId:ee.id,nodeType:ee.data.nodeType,payload:{itemType:ee.data.itemType,itemId:ee.data.itemId??null,label:ee.data.label,infoType:ee.data.infoType??null}})),te=q.map(ee=>({edgeId:ee.id,fromNodeId:ee.source,toNodeId:ee.target}));await xi({libraryId:o,nodes:d,edges:te}),Y(a.cogita.library.graph.saveSuccess)}catch{Y(a.cogita.library.graph.saveFail)}},K=d=>{P&&p(te=>te.map(ee=>ee.id===P.id?{...ee,data:{...ee.data,itemId:(d==null?void 0:d.infoId)??null,itemType:"collection",infoType:"collection",label:(d==null?void 0:d.label)??a.cogita.library.infoTypes.collection}}:ee))},se=d=>{P&&p(te=>te.map(ee=>ee.id===P.id?{...ee,data:{...ee.data,itemId:(d==null?void 0:d.infoId)??null,itemType:"info",infoType:(d==null?void 0:d.infoType)??null,label:(d==null?void 0:d.label)??a.cogita.library.infoTypes.any}}:ee))};return i.useEffect(()=>{if(!P||P.data.nodeType!=="info"||P.data.infoType!=="quote"||!P.data.itemId){ne(null);return}let d=!0;return it({libraryId:o,infoId:P.data.itemId}).then(te=>{if(!d)return;const ee=te.payload,_=(ee==null?void 0:ee.text)??"";if(!_){ne(null);return}const Se=pt(_),le=Object.values(Se.nodes).sort((ie,Ce)=>ie.depth-Ce.depth||ie.start-Ce.start).map(ie=>({id:ie.id,text:ie.text,depth:ie.depth}));ne({title:(ee==null?void 0:ee.title)??P.data.label,fragments:le})}).catch(()=>ne(null)),()=>{d=!1}},[o,P]),e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:S,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ge,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ue,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:pe,children:a.cogita.library.actions.addInfo}),be?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(be.totalCollections))})}):null,j?e.jsx("p",{className:"cogita-help",children:j}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(pr,{nodes:b,edges:q,onNodesChange:R,onEdgesChange:l,onConnect:O,onNodeClick:(d,te)=>f(te.id),fitView:!0,children:[e.jsx(fr,{gap:18,size:1}),e.jsx(xr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),P?e.jsxs("div",{className:"cogita-graph-inspector",children:[P.data.nodeType==="collection"?e.jsx(Ye,{libraryId:o,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:P.data.itemId?{id:P.data.itemId,label:P.data.label,infoType:"collection"}:null,onChange:K,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(Ye,{libraryId:o,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:P.data.itemId?{id:P.data.itemId,label:P.data.label,infoType:P.data.infoType??void 0}:null,onChange:se,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),B?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:B.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:B.fragments.map(d=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:d.id}),e.jsx("span",{children:d.text})]},d.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function ln({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:S}){const{libraryName:b}=_a(o),[p,R]=i.useState([]),[q,U]=i.useState("loading"),[l,m]=i.useState("idle"),f=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),be=`/#/cogita/library/${o}`,D=()=>{U("loading"),Jr({libraryId:o}).then(B=>{R(B),U("idle")}).catch(()=>{R([]),U("error")})};i.useEffect(()=>{D()},[o]);const j=async B=>{try{await Yr({libraryId:o,shareId:B}),D()}catch{D()}},Y=async B=>{const ne=`${f}/${B}`;try{await navigator.clipboard.writeText(ne),m("copied")}catch{m("failed")}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:be,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${be}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[q==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):q==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):p.filter(B=>!S||B.collectionId===S).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:p.filter(B=>!S||B.collectionId===S).map(B=>e.jsxs("div",{className:"cogita-share-row","data-state":B.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:B.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(B.createdUtc).toLocaleString(),B.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),B.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${f}/${B.shareCode}`}):null]}),B.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[B.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>Y(B.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>j(B.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},B.shareId))}),l==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):l==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function cn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:S}=_a(o),[b,p]=i.useState(null),[R,q]=i.useState(null),[U,l]=i.useState(null),[m,f]=i.useState(null),[be,D]=i.useState(null),[j,Y]=i.useState(null),B=i.useRef(null),ne=ue=>{if(!Number.isFinite(ue))return"0 B";if(ue<1024)return`${ue} B`;const pe=ue/1024;if(pe<1024)return`${pe.toFixed(1)} KB`;const ge=pe/1024;return ge<1024?`${ge.toFixed(1)} MB`:`${(ge/1024).toFixed(1)} GB`},P=async()=>{p(null),D({loadedBytes:0,totalBytes:null,percent:null});try{p(a.cogita.library.overview.exporting);const ue=await yi(o,D),pe=URL.createObjectURL(ue),ge=document.createElement("a");ge.href=pe,ge.download=`cogita-library-${S||o}.json`,ge.click(),URL.revokeObjectURL(pe),p(a.cogita.library.overview.exportReady)}catch{p(a.cogita.library.overview.exportFail)}finally{D(ue=>ue??{loadedBytes:0,totalBytes:null,percent:null})}},O=async ue=>{var ge;q(null),l(null),f(null);const pe=(ge=ue.target.files)==null?void 0:ge[0];if(pe)try{q(a.cogita.library.overview.importing),Y({loadedBytes:0,totalBytes:pe.size,percent:0});const K=await vi(o,pe,Y,se=>{const d=se.stage==="infos"?a.cogita.library.overview.importStageInfos:se.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;f(a.cogita.library.overview.importLiveProgress.replace("{stage}",d).replace("{done}",String(se.processed)).replace("{total}",String(se.total)).replace("{infos}",String(se.infos)).replace("{connections}",String(se.connections)).replace("{collections}",String(se.collections)))});l({infos:K.infosImported,connections:K.connectionsImported,collections:K.collectionsImported}),q(a.cogita.library.overview.importDone)}catch(K){const se=K instanceof ji&&K.message?` ${K.message}`:"";q(`${a.cogita.library.overview.importFail}${se}`)}finally{B.current&&(B.current.value="")}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:S}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:P,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:B,type:"file",accept:"application/json",onChange:O})]})]}),be?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:be.percent??void 0,max:be.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ne(be.loadedBytes)).replace("{total}",be.totalBytes?ne(be.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,j?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:j.percent??void 0,max:j.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ne(j.loadedBytes)).replace("{total}",j.totalBytes?ne(j.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null,R?e.jsx("p",{className:"cogita-help",children:R}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null,U?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(U.infos)).replace("{connections}",String(U.connections)).replace("{collections}",String(U.collections))}):null]})]})})})]})})}function dn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:S}=_a(o),[b,p]=i.useState(""),[R,q]=i.useState([]),U=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:S}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:b,onChange:l=>p(l.target.value),placeholder:a.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const l=b.trim();l&&(q(m=>[{id:U(),name:l},...m]),p(""))},children:a.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[R.length===0?e.jsx("p",{children:a.cogita.library.modules.storyboardsEmpty}):null,R.map(l=>e.jsx("button",{type:"button",className:"ghost",children:l.name},l.id))]})]})]})})})]})})}function un({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:S}=_a(o),[b,p]=i.useState(""),[R,q]=i.useState([]),U=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:S}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:b,onChange:l=>p(l.target.value),placeholder:a.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const l=b.trim();l&&(q(m=>[{id:U(),name:l},...m]),p(""))},children:a.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[R.length===0?e.jsx("p",{children:a.cogita.library.modules.textsEmpty}):null,R.map(l=>e.jsx("button",{type:"button",className:"ghost",children:l.name},l.id))]})]})]})})})]})})}function Dr({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o}){const{libraryName:S}=_a(o),b=`/#/cogita/library/${o}`,[p,R]=i.useState(""),[q,U]=i.useState([]),[l,m]=i.useState("idle"),[f,be]=i.useState(0),[D,j]=i.useState(null);i.useEffect(()=>{m("loading");const B=window.setTimeout(()=>{wt({libraryId:o,query:p.trim()||void 0,limit:30}).then(ne=>{U(ne.items),be(ne.total),j(ne.nextCursor??null),m("ready")}).catch(()=>{U([]),be(0),j(null),m("ready")})},240);return()=>window.clearTimeout(B)},[o,p]);const Y=async()=>{if(D){m("loading");try{const B=await wt({libraryId:o,query:p.trim()||void 0,limit:30,cursor:D});U(ne=>[...ne,...B.items]),j(B.nextCursor??null),be(B.total),m("ready")}catch{m("ready")}}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:S}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:b,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${b}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:p,onChange:B=>R(B.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(q.length)).replace("{total}",String(f||q.length))}),e.jsx("span",{children:l==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:q.length?q.map(B=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${b}/collections/${B.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:B.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(B.itemCount))," ·"," ",B.notes||a.cogita.library.collections.noNotes]})]})},B.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${b}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),D?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Y,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const ye=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ka=(a,n,s,u)=>`${a}:${n}:${s??""}:${u??""}`;function gn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:S}){_a(o);const b=`/#/cogita/library/${o}`,[p,R]=i.useState(a.cogita.library.collections.defaultName),[q,U]=i.useState(null),[l,m]=i.useState(0),[f,be]=i.useState([]),[D,j]=i.useState("idle"),[Y,B]=i.useState(null),ne=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(l||f.length)),[a,f.length,l]);i.useEffect(()=>{Wt(o,S).then(O=>{R(O.name),U(O.notes??null),m(O.itemCount)}).catch(()=>{R(a.cogita.library.collections.defaultName),U(null)})},[o,S]),i.useEffect(()=>{j("loading"),Et({libraryId:o,collectionId:S,limit:40}).then(O=>{be(O.items),B(O.nextCursor??null),m(O.total),j("ready")}).catch(()=>{be([]),B(null),j("ready")})},[o,S]);const P=async()=>{if(Y){j("loading");try{const O=await Et({libraryId:o,collectionId:S,limit:40,cursor:Y});be(ue=>[...ue,...O.items]),B(O.nextCursor??null),m(O.total),j("ready")}catch{j("ready")}}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:p}),e.jsx("p",{className:"cogita-library-subtitle",children:q||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:b,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${b}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${b}/collections/${S}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${b}/collections/${S}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ne}),e.jsx("span",{children:D==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:f.length?f.map(O=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:O.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:O.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:O.label}),e.jsx("p",{className:"cogita-card-subtitle",children:O.description})]})},ye(O))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),Y?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:P,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${b}/collections/${S}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Va=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,s=a.filter(w=>w.correct).length,u=zt(jr(a));return{score:Math.round(Math.max(0,Math.min(100,u.knowness*100))*100)/100,total:n,correct:s,lastReviewedUtc:u.lastReviewedUtc??null}},hn=a=>{if(a.maskBase64)try{const n=wi(a.maskBase64);if(!n.length)return a.correct?1:0;const s=n.reduce((u,g)=>u+g,0);return Math.max(0,Math.min(1,s/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},jr=a=>a.map(n=>({correctness:hn(n),createdUtc:n.createdUtc})),zt=(a,n=Date.now())=>{var l;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const u=a.slice().sort((m,f)=>m.createdUtc.localeCompare(f.createdUtc)).slice(-5),g=u.reduce((m,f)=>m+f.correctness,0)/u.length,w=5,x=2,N=.15;let A=0,L=0;for(let m=0;m<u.length;m+=1){const f=new Date(u[m].createdUtc).getTime(),be=m===u.length-1?n:new Date(u[m+1].createdUtc).getTime(),D=Math.max(0,(be-f)/(1e3*60)),j=1-Math.exp(-D/w);A+=j,u[m].correctness>.5&&(L+=N)}let o=g*A*x+L;const S=((l=u[u.length-1])==null?void 0:l.createdUtc)??null,b=S?Math.max(0,(n-new Date(S).getTime())/(1e3*60)):0,R=1/(1+Math.log1p(b/60));return o*=R,u.length===1&&u[0].correctness>.5&&(o+=5.44*Math.exp(-b/2)),{knowness:o,avgCorrectness:g,lastReviewedUtc:S}},kt=a=>{const n=a.slice();for(let s=n.length-1;s>0;s-=1){const u=Math.floor(Math.random()*(s+1));[n[s],n[u]]=[n[u],n[s]]}return n},Rt=a=>a[Math.floor(Math.random()*a.length)],bn=(a,n)=>{const s=new Map;return a.forEach(u=>s.set(u,Math.random())),a.sort((u,g)=>{const w=n(u)-n(g);return w!==0?w:(s.get(u)??0)-(s.get(g)??0)})},Ht=(a,n,s,u,g)=>{if(!a.length)return null;const w=a.filter(N=>!(g!=null&&g.has(ye(N))));if(w.length===0)return null;const x=w.filter(N=>ye(N)!==s);return Rt(x.length?x:w)},mn=(a,n,s,u,g)=>{if(!a.length)return null;let w=Number.POSITIVE_INFINITY;for(const L of a){const o=ye(L);if(s.has(o))continue;const S=n[o]??1;S<w&&(w=S)}if(!Number.isFinite(w))return null;const x=a.filter(L=>{const o=ye(L);return!s.has(o)&&(n[o]??1)===w}),N=x.filter(L=>!g||ye(L)!==g),A=u?N.filter(L=>!u.has(ye(L))):N;return A.length>0?Rt(A):N.length>0?Rt(N):g&&x.some(L=>ye(L)===g)?x.find(L=>ye(L)===g)??null:x.length?Rt(x):null},ei=(a,n,s,u,g)=>{const w=[],x=a.filter(A=>!g.has(ye(A))&&!s.has(ye(A))&&(n[ye(A)]??0)<1),N=bn(x,A=>n[ye(A)]??0);for(const A of N){if(w.length>=u)break;w.push(A),g.add(ye(A))}if(w.length<u){const A=kt(a.filter(L=>!g.has(ye(L))&&s.has(ye(L))));for(const L of A){if(w.length>=u)break;w.push(L),g.add(ye(L))}}return w},pn=(a,n,s,u)=>ei(a,n,s,u,new Set),wr=(a,n,s,u,g,w)=>{const x=Math.max(1,s.stackSize??n),A=kt(a).filter((R,q,U)=>U.findIndex(l=>ye(l)===ye(R))===q),L=pn(A,u,g,x),o=new Set,S=new Set,b=Ht(L,{},null,o,S),p=b?[b]:[];return b&&S.add(ye(b)),{queue:p,meta:{pool:A,active:L,knownessMap:u,unknownSet:g,outcomesById:w,asked:o,queued:S}}},br={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const u=kt(a).filter((g,w,x)=>x.findIndex(N=>ye(N)===ye(g))===w);return{queue:u.slice(0,Math.min(n,u.length)),meta:{}}},applyOutcome:a=>a},kr=(a,n,s,u)=>{const g=Math.max(1,s.stackSize??n),x=kt(a).filter((q,U,l)=>l.findIndex(m=>ye(m)===ye(q))===U),N={},A=new Set,L=new Set,o=new Set,S=Math.max(1,s.levels??1);x.forEach(q=>{const U=ye(q),l=u==null?void 0:u[U],m=typeof l=="number"&&Number.isFinite(l)?l:1;N[U]=Math.min(S,Math.max(1,Math.round(m)))});const b=[];if(x.length>0){const q=new Map;x.forEach(l=>{var f;const m=N[ye(l)]??1;q.has(m)||q.set(m,[]),(f=q.get(m))==null||f.push(l)});const U=Array.from(q.keys()).sort((l,m)=>l-m);for(const l of U){if(b.length>=g)break;const m=kt(q.get(l)??[]);for(const f of m){if(b.length>=g)break;b.push(f)}}}const p=Ht(b,N,null,A,L),R=p?[p]:[];return p&&L.add(ye(p)),{queue:R,meta:{pool:x,active:b,levelMap:N,asked:A,queued:L,wrongSinceCorrect:o}}},fn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,s)=>kr(a,n,s),applyOutcome:(a,n,s,u,g)=>{if(!n)return a;const w=Math.max(1,u.levels??1),x=a.meta.pool??[],N=a.meta.active??[],A={...a.meta.levelMap??{}},L=new Set(a.meta.asked??[]),o=new Set(a.meta.queued??[]),S=new Set(a.meta.wrongSinceCorrect??[]),b=ye(n);o.delete(b),L.add(b);const p=A[b]??1;g.correct?(A[b]=S.has(b)?1:Math.min(p+1,w),S.delete(b)):(A[b]=1,S.add(b));const R=g.correct?N.filter(l=>ye(l)!==b):N.slice();if(g.correct&&R.length<Math.max(1,u.stackSize??1)){const l=new Set(R.map(f=>ye(f))),m=mn(x,A,l,L,b);m&&R.push(m)}const q=a.queue.slice(),U=Ht(R,A,b,L,o);return U&&(q.push(U),o.add(ye(U))),{queue:q,meta:{pool:x,active:R,levelMap:A,asked:L,queued:o,wrongSinceCorrect:S}}}},xn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,s)=>wr(a,n,s,{},new Set,{}),applyOutcome:(a,n,s,u,g)=>{if(!n)return a;const w=a.meta.pool??[],x=a.meta.active??[],N={...a.meta.knownessMap??{}},A=new Set(a.meta.unknownSet??[]),L={...a.meta.outcomesById??{}},o=new Set(a.meta.asked??[]),S=new Set(a.meta.queued??[]),b=ye(n);S.delete(b),o.add(b);const p={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},q=(L[b]??[]).concat(p).sort((D,j)=>D.createdUtc.localeCompare(j.createdUtc)).slice(-5);L[b]=q,A.delete(b);const U=Date.now();w.forEach(D=>{const j=ye(D),Y=L[j]??[];if(Y.length===0){N[j]=0,A.add(j);return}const B=zt(Y,U);N[j]=B.knowness});const l=x.slice();if((N[b]??0)>=1){const D=l.filter(j=>ye(j)!==b);l.length=0,l.push(...D)}const f=Math.max(1,u.stackSize??s);if(l.length<f){const D=new Set(l.map(Y=>ye(Y))),j=ei(w,N,A,f-l.length,D);l.push(...j)}const be=a.queue.slice();if(be.length===0||ye(be[be.length-1])===b){const D=Ht(l,{},b,o,S);D&&(be.push(D),S.add(ye(D)))}return{queue:be,meta:{pool:w,active:l,knownessMap:N,unknownSet:A,outcomesById:L,asked:o,queued:S}}}},ai={random:br,levels:fn,temporal:xn},yn=Object.values(ai),Tr=a=>{if(!a)return br;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?ai[n]:br},Jt=(a,n)=>{const s={...a.defaultSettings};return n&&Object.entries(n).forEach(([u,g])=>{typeof g=="number"&&Number.isFinite(g)&&(s[u]=g),typeof g=="string"&&(s[u]=g)}),a.settingsFields.forEach(u=>{var w;const g=s[u.key];if(u.type==="number"){if(typeof g!="number"||Number.isNaN(g)){s[u.key]=a.defaultSettings[u.key]??0;return}u.min!==void 0&&(s[u.key]=Math.max(u.min,s[u.key])),u.max!==void 0&&(s[u.key]=Math.min(u.max,s[u.key]));return}if(u.type==="select"){const x=((w=u.options)==null?void 0:w.map(N=>N.value))??[];(typeof g!="string"||x.length>0&&!x.includes(g))&&(s[u.key]=a.defaultSettings[u.key]??x[0]??"")}}),s},ti=(a,n)=>{const s={};return a.settingsFields.forEach(u=>{const g=n.get(u.key);if(g){if(u.type==="number"){const w=Number(g);Number.isNaN(w)||(s[u.key]=w);return}s[u.key]=g}}),Jt(a,s)},vn=(a,n)=>{const s=new URLSearchParams;return a.settingsFields.forEach(u=>{const g=n[u.key];(typeof g=="number"||typeof g=="string")&&s.set(u.key,String(g))}),s};function jn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:S,revisionId:b}){const{libraryName:p}=_a(o),R=`/#/cogita/library/${o}`,[q,U]=i.useState(a.cogita.library.collections.defaultName),[l,m]=i.useState(""),[f,be]=i.useState(20),[D,j]=i.useState("random"),[Y,B]=i.useState({}),[ne,P]=i.useState("exact"),[O,ue]=i.useState([]),[pe,ge]=i.useState(null),[K,se]=i.useState([]),[d,te]=i.useState("idle"),[ee,_]=i.useState(null),[Se,le]=i.useState("idle"),[ie,Ce]=i.useState("idle"),[me,we]=i.useState("idle"),Le=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Ne=i.useMemo(()=>Tr(D),[D]),Je=i.useMemo(()=>Jt(Ne,Y),[Ne,Y]),_e=i.useMemo(()=>vn(Ne,Je).toString(),[Ne,Je]);i.useEffect(()=>{Wt(o,S).then(re=>U(re.name)).catch(()=>U(a.cogita.library.collections.defaultName))},[o,S]),i.useEffect(()=>{b&&ki({libraryId:o,collectionId:S,revisionId:b}).then(re=>{m(re.name),j(re.mode||"random"),P(re.check||"exact"),be(re.limit||20),B(re.revisionSettings??{})}).catch(()=>{m("")})},[S,o,b]),i.useEffect(()=>{Ti({libraryId:o}).then(re=>{ue(re),!pe&&re.length>0&&ge(re[0].roleId)}).catch(()=>{ue([])})},[o]);const Ee=()=>{Ce("loading"),Jr({libraryId:o}).then(re=>{se(re),Ce("idle")}).catch(()=>{se([]),Ce("error")})};i.useEffect(()=>{Ee()},[o]);const He=async()=>{te("working"),le("idle");try{const re=await Li({libraryId:o,collectionId:S,revisionType:Ne.id,revisionSettings:Je,mode:D,check:ne,limit:f});_(`${Le}/${re.shareCode}${_e?`?${_e}`:""}`),te("ready"),Ee()}catch{te("error")}},ca=async()=>{if(b){we("saving");try{await Ni({libraryId:o,collectionId:S,revisionId:b,name:l||q,revisionType:Ne.id,revisionSettings:Je,mode:D,check:ne,limit:f}),we("saved")}catch{we("error")}}},oa=async()=>{if(ee)try{await navigator.clipboard.writeText(ee),le("copied")}catch{le("failed")}},Q=async re=>{try{await Yr({libraryId:o,shareId:re}),Ee()}catch{Ee()}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:q}),e.jsx("p",{className:"cogita-library-subtitle",children:p})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:R,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${R}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${R}/collections/${S}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${R}/collections/${S}/revision/run?mode=${encodeURIComponent(D)}&check=${encodeURIComponent(ne)}&limit=${f}${_e?`&${_e}`:""}${pe?`&reviewer=${encodeURIComponent(pe)}`:""}${b?`&revisionId=${encodeURIComponent(b)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:l,onChange:re=>m(re.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:D,onChange:re=>j(re.target.value),children:yn.map(re=>e.jsx("option",{value:re.id,children:a.cogita.library.revision[re.labelKey]},re.id))})]}),Ne.settingsFields.map(re=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[re.labelKey]}),re.type==="select"?e.jsx("select",{value:String(Je[re.key]??""),onChange:Ue=>B(Me=>({...Me,[re.key]:Ue.target.value})),children:(re.options??[]).map(Ue=>e.jsx("option",{value:Ue.value,children:a.cogita.library.revision[Ue.labelKey]},Ue.value))}):e.jsx("input",{type:"number",min:re.min,max:re.max,step:re.step,value:Je[re.key]??0,onChange:Ue=>B(Me=>({...Me,[re.key]:Number(Ue.target.value||0)}))})]},re.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),Ne.id!=="levels"&&Ne.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:f,onChange:re=>be(Number(re.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:pe??"",onChange:re=>ge(re.target.value||null),children:O.map(re=>e.jsx("option",{value:re.roleId,children:re.label},re.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[b?e.jsx("button",{type:"button",className:"cta ghost",onClick:ca,disabled:me==="saving",children:me==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${R}/collections/${S}/revision/run?mode=${encodeURIComponent(D)}&check=${encodeURIComponent(ne)}&limit=${f}${_e?`&${_e}`:""}${pe?`&reviewer=${encodeURIComponent(pe)}`:""}${b?`&revisionId=${encodeURIComponent(b)}`:""}`,children:a.cogita.library.actions.startRevision})]}),me==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),ee?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:ee,readOnly:!0})]}):null,d==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,Se==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):Se==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:He,disabled:d==="working",children:d==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),ee?e.jsx("button",{type:"button",className:"cta ghost",onClick:oa,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),ie==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):K.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:K.map(re=>e.jsxs("div",{className:"cogita-share-row","data-state":re.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:re.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(re.createdUtc).toLocaleString(),re.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),re.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>Q(re.shareId),children:a.cogita.library.revision.shareRevokeAction})]},re.shareId))})]})]})]})]})})})]})})}function ri({copy:a,currentCard:n,currentTypeLabel:s,prompt:u,languages:g,answer:w,onAnswerChange:x,computedExpected:N,computedAnswers:A,onComputedAnswerChange:L,answerTemplate:o,outputVariables:S,variableValues:b,computedFieldFeedback:p,feedback:R,canAdvance:q,quoteContext:U,quotePlaceholder:l,onCheckAnswer:m,onSkip:f,onLanguageSelect:be,onMarkReviewed:D,onAdvance:j,showCorrectAnswer:Y,setShowCorrectAnswer:B,onRevealCorrect:ne,answerMask:P,expectedAnswer:O,hasExpectedAnswer:ue,handleComputedKeyDown:pe,answerInputRef:ge,computedInputRefs:K,scriptMode:se,setScriptMode:d,matchPairs:te,matchLeftOrder:ee,matchRightOrder:_,matchSelection:Se,matchActiveLeft:le,matchActiveRight:ie,matchFeedback:Ce,onMatchLeftSelect:me,onMatchRightSelect:we}){const Le=i.useMemo(()=>{var J;const Q=!o&&N.length===2?`The {${N[0].key}} is of type {${N[1].key}}`:null,re=o??Q;if(!re)return null;const Ue=new Map(N.map(t=>[t.key,t.expected])),Me=new Set,fe=[],$e=/\{([^}]+)\}/g;let qe=0,Fe,Ve=null;for(;(Fe=$e.exec(re))!==null;){const t=re.slice(qe,Fe.index);t&&fe.push({type:"text",value:t});const r=((J=Fe[1])==null?void 0:J.trim())??"",h=r&&Ue.has(r)?r:r&&S&&S[r]?S[r]:null;r&&Me.add(r),h&&Me.add(h),h&&Ue.has(h)?(fe.push({type:"input",value:h}),Ve||(Ve=h)):r&&b&&b[r]!==void 0?fe.push({type:"text",value:b[r]}):fe.push({type:"text",value:Fe[0]}),qe=Fe.index+Fe[0].length}const v=re.slice(qe);return v&&fe.push({type:"text",value:v}),N.filter(t=>!Me.has(t.key)).length>0?null:{parts:fe,expectedByKey:Ue,firstInputKey:Ve}},[o,N,S,b]),Ne=()=>{if(!Le)return null;const{parts:Q,expectedByKey:re,firstInputKey:Ue}=Le;return e.jsx("div",{className:"cogita-revision-inline-answer",children:Q.map((Me,fe)=>{var $e,qe;return Me.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Me.value},`text-${fe}`):e.jsx("input",{ref:Fe=>{K.current[Me.value]=Fe},autoFocus:Me.value===Ue,value:A[Me.value]??"",onChange:Fe=>L(Me.value,Fe.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":p[Me.value]??(R==="correct"?"correct":R==="incorrect"?"incorrect":void 0),onKeyDown:Fe=>He(Fe)||pe(Fe),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,(($e=A[Me.value])==null?void 0:$e.length)??0,((qe=re.get(Me.value))==null?void 0:qe.length)??6)}ch`}},`input-${Me.value}-${fe}`)})})},Je=i.useMemo(()=>{const Q=new Map;return(te??[]).forEach(re=>Q.set(re.leftId,re)),Q},[te]),_e=i.useMemo(()=>{const Q=new Map;return(te??[]).forEach(re=>Q.set(re.rightId,re)),Q},[te]);i.useEffect(()=>{var fe;if(n.cardType!=="info"||n.infoType!=="computed"||N.length===0)return;const Q=typeof document<"u"?document.activeElement:null;if(Q&&(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"))return;const re=(Le==null?void 0:Le.firstInputKey)??((fe=N[0])==null?void 0:fe.key);if(!re)return;const Ue=K.current[re];if(!Ue)return;const Me=requestAnimationFrame(()=>{Ue.focus()});return()=>cancelAnimationFrame(Me)},[n,N,Le]);const Ee=(()=>{const Q=[O??"",...N.map(Me=>Me.expected??"")].join(""),re=[w,...Object.values(A)].join(""),Ue=`${Q}${re}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Ue)})(),He=Q=>Q.ctrlKey&&(Q.key==="^"||Q.key==="6")?(Q.preventDefault(),d(re=>re==="super"?null:"super"),!0):Q.ctrlKey&&(Q.key==="_"||Q.key==="-")?(Q.preventDefault(),d(re=>re==="sub"?null:"sub"),!0):!1,ca=()=>{if(!O||!P)return O??"";const Q=O.split(""),re=Array.from(P),Ue=re.length>0?re.reduce((Me,fe)=>Me+fe,0)/re.length:127;return Q.map((Me,fe)=>{const $e=re[fe]??Ue,qe=Math.max(0,Math.min(255,Math.round($e)));let Fe=255,Ve=0;return qe<=127?Ve=Math.round(qe/127*255):(Ve=255,Fe=Math.round(255*(1-(qe-127)/128))),e.jsx("span",{style:{color:`rgb(${Fe}, ${Ve}, 0)`},children:Me},`mask-${fe}`)})},oa=n.cardType==="info"&&n.infoType==="quote"?(U==null?void 0:U.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:s}),e.jsx("strong",{children:oa})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&te?e.jsxs("div",{className:"cogita-revision-body",children:[u?e.jsx("h2",{children:u}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(ee??[]).map(Q=>{const re=Je.get(Q);if(!re)return null;const Ue=(Se==null?void 0:Se[Q])??null,Me=(Ce==null?void 0:Ce[Q])??null,fe=le===Q;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":fe,"data-state":Me??void 0,"data-locked":Ue?"true":void 0,onClick:()=>me==null?void 0:me(Q),children:[e.jsx("span",{children:re.leftLabel}),Ue&&Y?e.jsx("em",{children:"✓"}):null]},Q)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(_??[]).map(Q=>{const re=_e.get(Q);if(!re)return null;const Ue=Object.values(Se??{}).includes(Q),Me=ie===Q;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Ue||Me,"data-locked":Ue?"true":void 0,onClick:()=>we==null?void 0:we(Q),children:e.jsx("span",{children:re.rightLabel})},Q)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ge,value:w,onChange:Q=>x(Q.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":R==="correct"?"correct":R==="incorrect"?"incorrect":void 0,onKeyDown:Q=>{Q.key==="Enter"&&(Q.preventDefault(),Q.stopPropagation(),q?j():m())}})]}),Ee?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":se==="super",onClick:()=>d(Q=>Q==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":se==="sub",onClick:()=>d(Q=>Q==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,o?null:e.jsx(hr,{value:u??"",mode:"auto"}),N.length>0?(()=>{const Q=Ne();return Q?e.jsx("div",{className:"cogita-inline-answer-wrap",children:Q}):e.jsx("div",{className:"cogita-form-grid",children:N.map((re,Ue)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:re.key}),e.jsx("textarea",{ref:Me=>{K.current[re.key]=Me},autoFocus:Ue===0,value:A[re.key]??"",onChange:Me=>L(re.key,Me.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":p[re.key]??(R==="correct"?"correct":R==="incorrect"?"incorrect":void 0),onKeyDown:Me=>He(Me)||pe(Me)})]},re.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ge,value:w,onChange:Q=>x(Q.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":R==="correct"?"correct":R==="incorrect"?"incorrect":void 0,onKeyDown:Q=>{He(Q)||Q.key==="Enter"&&(Q.preventDefault(),Q.stopPropagation(),q?j():m())}})]})}),Ee?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":se==="super",onClick:()=>d(Q=>Q==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":se==="sub",onClick:()=>d(Q=>Q==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&U?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(U.completed)).replace("{total}",String(U.total))}),e.jsx("p",{className:"cogita-quote-text",children:U.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ge,value:w,onChange:Q=>x(Q.target.value),placeholder:l??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":R==="correct"?"correct":R==="incorrect"?"incorrect":void 0,onKeyDown:Q=>{Q.key==="Enter"&&(Q.preventDefault(),Q.stopPropagation(),q?j():m())}})]}),e.jsx("p",{className:"cogita-quote-text",children:U.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(Q=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>be(Q.label),children:Q.label},Q.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:D,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}),R&&e.jsx("div",{className:"cogita-revision-feedback","data-state":R,children:R==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),R==="incorrect"&&ue?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>B(Q=>{const re=!Q;return re&&ne(),re}),children:a.cogita.library.revision.showAnswer}),Y?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),N.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[N.map(Q=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Q.key}),e.jsx("span",{children:Q.expected})]},Q.key)),O?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:O})]}):null]}):e.jsx("p",{children:P?ca():O})]}):null]}):null,q?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:j,children:a.cogita.library.revision.nextQuestion})}):null]})}const or=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ii({outcomes:a}){const[n,s]=i.useState("day"),u=i.useMemo(()=>{const g=or.find(N=>N.id===n)??or[1],w=Date.now()-g.ms,x=a.filter(N=>new Date(N.createdUtc).getTime()>=w);return Va(x)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:or.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>s(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[u.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[u.correct," / ",u.total]})]})}const wn="cogita-revision",kn=1,Bt="outcomes",Tn=()=>new Promise((a,n)=>{const s=indexedDB.open(wn,kn);s.onupgradeneeded=()=>{const u=s.result;if(!u.objectStoreNames.contains(Bt)){const g=u.createObjectStore(Bt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},s.onerror=()=>n(s.error),s.onsuccess=()=>a(s.result)}),Nt=async(a,n)=>{const s=await Tn();return new Promise((u,g)=>{const w=s.transaction(Bt,a),x=w.objectStore(Bt);n(x).then(u).catch(g),w.onerror=()=>g(w.error)})},ni=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(s=>s.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Nn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const s=ni();return localStorage.setItem(a,s),s},Ln=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),s=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(s)),s},oi=(a,n,s,u)=>Ka(a,n,s,u),Dt=async a=>{const n=Nn(),s=Ln(),u=new Date().toISOString(),g={...a,clientId:n,clientSequence:s,createdUtc:u,id:ni(),pending:!0};return await Nt("readwrite",w=>new Promise((x,N)=>{const A={...g,itemKey:oi(g.itemType,g.itemId,g.checkType,g.direction)},L=w.add(A);L.onsuccess=()=>x(),L.onerror=()=>N(L.error)})),g},Kt=async(a,n,s,u)=>{if(!n)return[];try{const g=oi(a,n,s,u);return await Nt("readonly",w=>new Promise((x,N)=>{const L=w.index("byItem").getAll(g);L.onsuccess=()=>{const S=(L.result??[]).map(b=>({itemType:b.itemType,itemId:b.itemId,checkType:b.checkType??null,direction:b.direction??null,revisionType:b.revisionType,evalType:b.evalType,correct:b.correct,createdUtc:b.createdUtc,maskBase64:b.maskBase64,payloadBase64:b.payloadBase64,payloadHashBase64:b.payloadHashBase64,clientId:b.clientId,clientSequence:b.clientSequence,personRoleId:b.personRoleId??null})).sort((b,p)=>b.createdUtc.localeCompare(p.createdUtc));x(S)},L.onerror=()=>N(L.error)}))}catch{return[]}},Oa=async()=>{try{return await Nt("readonly",a=>new Promise((n,s)=>{const u=a.getAll();u.onsuccess=()=>{const w=(u.result??[]).map(x=>({itemType:x.itemType,itemId:x.itemId,checkType:x.checkType??null,direction:x.direction??null,revisionType:x.revisionType,evalType:x.evalType,correct:x.correct,createdUtc:x.createdUtc,maskBase64:x.maskBase64,payloadBase64:x.payloadBase64,payloadHashBase64:x.payloadHashBase64,clientId:x.clientId,clientSequence:x.clientSequence,personRoleId:x.personRoleId??null}));n(w)},u.onerror=()=>s(u.error)}))}catch{return[]}},Cn=async(a=100)=>{try{return await Nt("readonly",n=>new Promise((s,u)=>{const w=n.index("byPending").getAll(!0);w.onsuccess=()=>{const x=w.result??[];s(x.slice(0,a))},w.onerror=()=>u(w.error)}))}catch{return[]}},Mn=async a=>{if(a.length!==0)try{await Nt("readwrite",n=>new Promise((s,u)=>{let g=a.length;a.forEach(w=>{const x=n.get(w);x.onsuccess=()=>{const N=x.result;if(N){N.pending=!1;const A=n.put(N);A.onsuccess=()=>{g-=1,g===0&&s()},A.onerror=()=>u(A.error)}else g-=1,g===0&&s()},x.onerror=()=>u(x.error)})}))}catch{}},sr=async(a,n)=>{const s=await Cn(200);if(s.length===0)return;const u=new Map;s.forEach(g=>{var x;const w=g.personRoleId??n??"";u.has(w)||u.set(w,[]),(x=u.get(w))==null||x.push(g)});for(const[g,w]of u.entries()){const x=w.map(N=>({itemType:N.itemType,itemId:N.itemId,checkType:N.checkType??null,direction:N.direction??null,revisionType:N.revisionType,evalType:N.evalType,correct:N.correct,clientId:N.clientId,clientSequence:N.clientSequence,maskBase64:N.maskBase64??null,payloadHashBase64:N.payloadHashBase64??null,payloadBase64:N.payloadBase64??null,personRoleId:g||null}));try{await Ci({libraryId:a,outcomes:x}),await Mn(w.map(N=>N.id))}catch{}}},Kr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Sn=(a,n)=>{const s=Math.max(a.length,n.length,1),u=Math.abs(a.length-n.length);return Math.max(0,1-u/s)},In=(a,n)=>{const s=new Uint8Array(a.length),u=Sn(a,n);for(let g=0;g<a.length;g+=1){const w=a[g]===(n[g]??"")?128:0,x=a.length-1-g,N=n.length-1-g,A=a[x]===(n[N]??"")?127:0,L=Math.round((w+A)*u);s[g]=Math.max(0,Math.min(255,L))}return s},It=(a,n)=>a===n||(Kr[a]??[]).includes(n)?!0:(Kr[n]??[]).includes(a),Vt=(a,n)=>{const s=new Uint8Array(a.length);if(!a.length)return s;const u=[];for(let w=0;w<=a.length-3;w+=1)u.push({index:w,text:a.slice(w,w+3)});let g=!1;return u.forEach(w=>{for(let x=0;x<=n.length-3;x+=1){const N=n.slice(x,x+3);let A=0;for(let p=0;p<3;p+=1)It(w.text[p],N[p])&&(A+=1);if(A<2)continue;let L=w.index-1,o=x-1;for(;L>=0&&o>=0;){const p=a[L],R=n[o];if(p===R){s[L]=Math.max(s[L],255),L-=1,o-=1,g=!0;continue}if(It(p,R)){s[L]=Math.max(s[L],127),L-=1,o-=1,g=!0;continue}if(L>0&&a[L-1]===R){s[L]=Math.max(s[L],0),L-=1,g=!0;continue}if(o>0&&a[L]===n[o-1]){o-=1,g=!0;continue}break}for(let p=0;p<3;p+=1){const R=w.index+p,q=w.text[p],U=N[p],l=q===U?255:It(q,U)?127:0;s[R]=Math.max(s[R],l),g=!0}let S=w.index+3,b=x+3;for(;S<a.length&&b<n.length;){const p=a[S],R=n[b];if(p===R){s[S]=Math.max(s[S],255),S+=1,b+=1,g=!0;continue}if(It(p,R)){s[S]=Math.max(s[S],127),S+=1,b+=1,g=!0;continue}if(S+1<a.length&&a[S+1]===R){s[S]=Math.max(s[S],0),S+=1,g=!0;continue}if(b+1<n.length&&a[S]===n[b+1]){b+=1,g=!0;continue}break}}}),g?s:In(a,n)},mt=(a,n,s)=>{const u=a.trim().toLowerCase(),g=n.trim().toLowerCase();return Vt(u,g)},ft=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),si=(a,n,s)=>{const u=ft(a),g=ft(n);return Vt(u,g)},wa=a=>a.trim().toLowerCase(),Pn=a=>a==="reverse"?"reverse":"forward",Tt=(a,n)=>`${a}|${n}`,Ta=a=>{if(!a)return null;const[n,s]=a.split("|",2);return(n==="forward"||n==="reverse")&&s?{mode:n,fragmentId:s}:{mode:"forward",fragmentId:a}},Ot=(a,n)=>{var u;const s=Ta(n);return s?s.fragmentId&&n?(a??null)===n:(((u=Ta(a))==null?void 0:u.mode)??"forward")===s.mode:!0},pa=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},li=(a,n)=>{if((pa(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const u=pa(a.childCheckType),g=pa(a.childDirection),w=pa(n.checkType),x=pa(n.direction);return!(u&&u!==w||g&&g!==x)},Rn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},$n={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},_t=(a,n,s)=>{if(!s||!n.startsWith(a))return n;const u=n.slice(a.length);if(!u)return n;const g=s==="super"?Rn:$n,w=u.split("").map(x=>g[x]??x).join("");return a+w},qt=(a,n,s)=>{var x,N,A;if(!a)return((x=n[0])==null?void 0:x.key)??null;const u=new Set(n.map(L=>L.key)),g=/\{([^}]+)\}/g;let w;for(;(w=g.exec(a))!==null;){const L=((N=w[1])==null?void 0:N.trim())??"";if(!L)continue;if(u.has(L))return L;const o=s==null?void 0:s[L];if(o&&u.has(o))return o}return((A=n[0])==null?void 0:A.key)??null},mr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const s=n.description??"";if(!s.trim())return[n];const u=Ta(n.direction),g=(u==null?void 0:u.mode)??Pn(n.direction),w=pt(s),x=Object.keys(w.nodes);return x.length===0?[n]:x.map(N=>({...n,checkType:"quote-fragment",direction:Tt(g,N)}))});function En({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:S,revisionId:b}){const p=yr(),R=`/#/cogita/library/${o}`,q=i.useMemo(()=>new URLSearchParams(p.search),[p.search]),U=Math.max(1,Number(q.get("limit")??20)),l=q.get("mode")??"random",m=i.useMemo(()=>Tr(l),[l]),f=i.useMemo(()=>Jt(m,ti(m,q)),[m,q]),be=q.get("check")??"exact",D=q.get("reviewer"),j=i.useMemo(()=>a.cogita.library.revision[m.labelKey]??l,[a,l,m]),Y=i.useMemo(()=>be==="exact"?a.cogita.library.revision.checkValue:be,[a,be]),[B,ne]=i.useState(a.cogita.library.collections.defaultName),[P,O]=i.useState([]),[ue,pe]=i.useState([]),[ge,K]=i.useState("idle"),[se,d]=i.useState({current:0,total:0}),[te,ee]=i.useState(0),[_,Se]=i.useState(""),[le,ie]=i.useState(null),[Ce,me]=i.useState(null),[we,Le]=i.useState(null),[Ne,Je]=i.useState(null),[_e,Ee]=i.useState([]),[He,ca]=i.useState({}),[oa,Q]=i.useState({}),[re,Ue]=i.useState(null),[Me,fe]=i.useState(null),[$e,qe]=i.useState(null),[Fe,Ve]=i.useState(null),[v,k]=i.useState(null),[J,t]=i.useState({}),r=i.useRef(0),[h,T]=i.useState(null),V=i.useRef(null),Z=i.useRef(null),[ae,G]=i.useState(null),[de,oe]=i.useState(!1),[ke,ea]=i.useState(null),[Oe,ra]=i.useState([]),[Ke,We]=i.useState(null),Ae=i.useRef(null),Ge=i.useRef(null),[Sa,sa]=i.useState(null),[Ra,la]=i.useState(0),xa=i.useRef(null),Ba=i.useRef({}),[ya,na]=i.useState(!1),[E,Re]=i.useState({}),[De,aa]=i.useState([]),Xe=i.useRef(new Map),[ia,ba]=i.useState(new Set),[da,Be]=i.useState(!1),ta=i.useRef(null),Ia=i.useRef(new Set),$a=i.useRef({}),Te=P[te]??null,je=(Te==null?void 0:Te.checkType)==="translation-match"&&v,Ua=i.useRef(new Map),La=i.useRef(new Map),qa=i.useRef(new Map),Wa=i.useRef(new Map),ma=i.useMemo(()=>Te?Te.cardType==="vocab"?a.cogita.library.revision.vocabLabel:Te.infoType?Ze(a,Te.infoType):a.cogita.library.revision.infoLabel:"",[a,Te]),za=i.useMemo(()=>{var y;return m.id!=="levels"?P.length:((y=E.pool)==null?void 0:y.length)??m.getFetchLimit(U,f)},[E,f,m,P.length,U]),nt=m.getProgressTotal?m.getProgressTotal(P,E,U,f):m.id==="levels"?Math.min(U,za):P.length,ot=nt?Math.min(te+1,nt):0,Ea=Math.max(1,Number(f.tries??1)),ka=f.compare??"anchors",Ha=Math.max(0,Math.min(100,Number(f.minCorrectness??0))),fa=(f.considerDependencies??"on")==="on",ua=Math.max(0,Math.min(100,Number(f.dependencyThreshold??85))),Pa=c=>{const y=c.slice();for(let I=y.length-1;I>0;I-=1){const C=Math.floor(Math.random()*(I+1));[y[I],y[C]]=[y[C],y[I]]}return y},Qa=c=>c.length?c.reduce((I,C)=>I+C,0)/c.length/255*100:0,Ja=c=>Qa(c)>=Ha,st=async()=>{const c=await Oa(),y=new Map,I=new Map,C=new Map;c.forEach(F=>{const z=`${F.itemType}:${F.itemId}`,ce=Ka(F.itemType,F.itemId,F.checkType,F.direction);if(y.has(z)||y.set(z,[]),y.get(z).push(F),I.has(ce)||I.set(ce,[]),I.get(ce).push(F),F.itemType==="info"&&F.checkType==="quote-fragment"&&F.direction){const he=`${F.itemId}:${F.direction}`;C.has(he)||C.set(he,[]),C.get(he).push(F)}});const H=new Map,M=new Map,W=new Map;return y.forEach((F,z)=>H.set(z,Va(F).score)),I.forEach((F,z)=>M.set(z,Va(F).score)),C.forEach((F,z)=>W.set(z,Va(F).score)),{itemKnowness:H,cardKnowness:M,fragmentKnowness:W}},Yt=async c=>{const y=[];let I=null;for(;;){const C=await Et({libraryId:o,collectionId:c,limit:200,cursor:I});if(y.push(...C.items),!C.nextCursor)break;I=C.nextCursor}return mr(y)},xt=async(c,y)=>{if(Xe.current.has(c))return Xe.current.get(c)??0;const I=await Yt(c);if(I.length===0)return Xe.current.set(c,0),0;const H=I.reduce((M,W)=>{const F=ye(W);return M+(y.get(F)??0)},0)/I.length;return Xe.current.set(c,H),H},Qt=(c,y)=>{if(!fa||c.cardType!=="info"||c.infoType!=="quote"||c.checkType!=="quote-fragment")return!0;const I=Ta(c.direction);if(!(I!=null&&I.fragmentId))return!0;const C=c.description??"";if(!C.trim())return!0;const M=pt(C).nodes[I.fragmentId];if(!M||!M.leftId&&!M.rightId)return!0;const W=[M.leftId,M.rightId].filter(ce=>!!ce);if(W.length===0)return!0;const F=W.map(ce=>{const he=Ka("info",c.cardId,"quote-fragment",Tt(I.mode,ce));return y.get(he)??0});return F.reduce((ce,he)=>ce+he,0)/F.length>=ua},lt=async c=>{const y=E,I=c.concat(y.active??[]).concat(y.pool??[]).filter((F,z,ce)=>ce.findIndex(he=>ye(he)===ye(F))===z);if(!fa){ba(new Set(I.map(ye)));return}const{itemKnowness:C,cardKnowness:H}=await st(),M=De.filter(F=>pa(F.childItemType)==="collection"&&F.childItemId===S&&!pa(F.childCheckType)&&!pa(F.childDirection)),W=new Set;for(const F of I){if(F.cardType!=="info"){W.add(ye(F));continue}if(!Qt(F,H))continue;const z=De.filter(ve=>li(ve,F)).concat(M);if(z.length===0){W.add(ye(F));continue}let ce=0;for(const ve of z)if(pa(ve.parentItemType)==="collection")ce+=await xt(ve.parentItemId,H);else if(pa(ve.parentCheckType)||pa(ve.parentDirection)){const xe=pa(ve.parentCheckType),Ie=pa(ve.parentDirection),Pe=Ka(ve.parentItemType,ve.parentItemId,xe,Ie);ce+=H.get(Pe)??0}else{const xe=`${ve.parentItemType}:${ve.parentItemId}`;ce+=C.get(xe)??0}ce/z.length>=ua&&W.add(ye(F))}ba(W)},Gt=c=>{for(let y=c;y<P.length;y+=1){const I=P[y];if(I&&(!fa||I.cardType!=="info"||ia.has(ye(I))))return y}return-1},Ca=c=>!fa||c.cardType!=="info"||ia.has(ye(c)),ct=c=>{if(m.id!=="temporal"&&m.id!=="levels")return null;const y=E,I=(y.active??[]).concat(y.pool??[]),C=new Set;for(const H of I){const M=ye(H);if(!(C.has(M)||c.has(M))&&(C.add(M),Ca(H)))return H}return null},Aa=i.useMemo(()=>{if(m.id!=="levels")return null;const c=E,y=c.pool??[],I=c.active??[],C=c.levelMap??{},H=Math.max(1,Number(f.levels??1)),M=Array.from({length:H},()=>0),W=new Set(I.map(he=>ye(he)));y.forEach(he=>{const ve=Math.min(H,Math.max(1,C[ye(he)]??1));M[ve-1]+=1});const F=y.length||1,z=M.map(he=>he/F*100),ce=Te?C[ye(Te)]??1:null;return{counts:M,percentages:z,currentLevel:ce,levelsCount:H,activeCount:I.length,poolCount:y.length,activeSet:W}},[E,f,m,Te]),va=i.useMemo(()=>{if(m.id!=="temporal")return null;const c=E,y=c.pool??[],I=c.active??[],C=c.knownessMap??{},H=new Set(c.unknownSet??[]);let M=0;y.forEach(z=>{(C[ye(z)]??0)>1&&(M+=1)});const W=H.size,F=I.map(z=>({id:ye(z),value:H.has(ye(z))?0:Math.max(0,Math.min(1,C[ye(z)]??0))}));return{knownCount:M,unknownCount:W,dots:F}},[E,m]),dt=i.useMemo(()=>{if(!fa)return 0;const c=E;return P.concat(c.active??[]).concat(c.pool??[]).filter((I,C,H)=>H.findIndex(M=>ye(M)===ye(I))===C).filter(I=>I.cardType==="info"&&!ia.has(ye(I))).length},[fa,E,P,ia]);i.useEffect(()=>{if(!fa||ge!=="ready")return;const c=E,I=P.concat(c.active??[]).concat(c.pool??[]).filter((M,W,F)=>F.findIndex(z=>ye(z)===ye(M))===W).filter(M=>M.cardType!=="info"||ia.has(ye(M))).length,C=Ae.current;if(Ae.current=I,C===null||I<=C)return;const H=I-C;We(`New card available (+${H})`),Ge.current&&window.clearTimeout(Ge.current),Ge.current=window.setTimeout(()=>We(null),2200)},[fa,ge,E,P,ia]),i.useEffect(()=>()=>{Ge.current&&window.clearTimeout(Ge.current)},[]);const ja=(c,y)=>{const I=m.applyOutcome({queue:P,meta:E},Te,U,f,{correct:c,correctness:y,createdUtc:new Date().toISOString()});O(I.queue),Re(I.meta);const C=I.queue[te+1];C&&yt(C,te+1)};i.useEffect(()=>{Wt(o,S).then(c=>ne(c.name)).catch(()=>ne(a.cogita.library.collections.defaultName))},[o,S]),i.useEffect(()=>{Ut({libraryId:o,type:"language"}).then(c=>pe(c)).catch(()=>pe([]))},[o]),i.useEffect(()=>{Hr({libraryId:o}).then(c=>aa(c.items??[])).catch(()=>aa([]))},[o]),i.useEffect(()=>{sr(o,D)},[o,D]),i.useEffect(()=>{lt(P)},[P,De,fa,ua,S]),i.useEffect(()=>{if(!Te||!fa){Be(!1);return}if(Te.cardType!=="info"||ia.has(ye(Te))){Be(!1);return}const c=Gt(te+1);if(c>=0){Be(!1),ee(c);return}if(m.id==="temporal"||m.id==="levels"){const y=P.slice(0,te+1),I=P.slice(te+1).filter(Ca),C=y.concat(I),H=new Set(C.map(ye)),M=ct(H);if(M){const F=ye(M);H.has(F)||(C.push(M),H.add(F),Re(z=>{const ce=z,he=new Set(ce.queued??[]);return he.add(F),{...ce,queued:he}}))}const W=C.findIndex((F,z)=>z!==te&&Ca(F));if(W>=0){O(C),ee(W),Be(!1);return}}Be(!0)},[Te,ia,fa,te,P,E,m.id]),i.useEffect(()=>{let c=!0;return(async()=>{K("loading"),d({current:0,total:m.id==="levels"?0:m.getFetchLimit(U,f)});try{const I=[];let C=null,H=null;do{const ve=await Et({libraryId:o,collectionId:S,limit:300,cursor:C});if(I.push(...ve.items),(m.id==="levels"||m.id==="temporal")&&ve.total&&(H=ve.total),d(xe=>({current:I.length,total:xe.total||ve.total||m.getFetchLimit(U,f)})),C=ve.nextCursor??null,H!==null&&I.length>=H||m.id!=="levels"&&m.id!=="temporal"&&I.length>=m.getFetchLimit(U,f))break}while(C);if(!c)return;const M=mr(I);let W;if(m.id==="levels"){const ve=Math.max(1,Number(f.levels??1)),Ie=(await Oa()).reduce((Pe,ze)=>{const Qe=Ka(ze.itemType,ze.itemId,ze.checkType,ze.direction);return Pe[Qe]||(Pe[Qe]=[]),Pe[Qe].push(ze),Pe},{});W={},M.forEach(Pe=>{const ze=ye(Pe),Qe=Ie[ze]??[],ha=Qe.length>0?Va(Qe).score:0,at=Math.max(1,Math.min(ve,Math.ceil(ha/100*ve)));W[ze]=at})}let F=null,z=null,ce=null;if(m.id==="temporal"){const ve=await Oa(),xe=new Set(M.map(ze=>ye(ze))),Ie=ve.reduce((ze,Qe)=>{const ha=Ka(Qe.itemType,Qe.itemId,Qe.checkType,Qe.direction);return xe.has(ha)&&(ze[ha]||(ze[ha]=[]),ze[ha].push(Qe)),ze},{});F={},z=new Set,ce={};const Pe=Date.now();M.forEach(ze=>{const Qe=ye(ze),ha=Ie[Qe]??[];if(ha.length===0){F[Qe]=0,z.add(Qe),ce[Qe]=[];return}const at=jr(ha);ce[Qe]=at;const di=zt(at,Pe);F[Qe]=di.knowness})}const he=m.id==="levels"?kr(M,U,f,W):m.id==="temporal"?wr(M,U,f,F??{},z??new Set,ce??{}):m.prepare(M,U,f);O(he.queue),Re(he.meta),ee(0),K("ready"),d(ve=>({current:Math.min(ve.current,ve.total),total:ve.total}))}catch{c&&K("error")}})(),()=>{c=!1}},[o,S,U,f,m,D]),i.useEffect(()=>{if(Se(""),ie(null),sa(null),la(0),Ee([]),ca({}),Q({}),fe(null),qe(null),Ve(null),oe(!1),na(!1),G(null),k(null),t({}),!Te){me(null),Le(null),Ue(null),ea(null);return}Te.cardType==="info"&&Te.infoType==="computed"&&me(a.cogita.library.revision.loadingComputed);let c=!0;return yt(Te,te).then(y=>{!c||!y||(me(y.prompt),Le(y.expectedAnswer),Ee(y.computedExpected),ca(y.computedAnswers),Ue(y.computedValues),fe(y.answerTemplate),qe(y.outputVariables),Ve(y.variableValues))}),()=>{c=!1}},[Te,a]),i.useEffect(()=>{if(!Te||Te.cardType!=="info"||Te.infoType!=="quote"){ta.current=null,Ia.current=new Set,Je(null);return}const c=Te.description??"",y=(Te.label??"").trim(),I=y.replace(/\s+/g," ").trim(),C=c.replace(/\s+/g," ").trim(),H=I&&I!==C?y:a.cogita.library.infoTypes.quote;if(!c){Je(null),Le(null);return}const M=pt(c);ta.current=M,me(H);let W=!0;return st().then(({fragmentKnowness:F})=>{if(!W)return;const z=getQuoteMode(Te.direction),ce=new Set,he={};F.forEach((Ie,Pe)=>{const[ze,Qe]=Pe.split(":",2);if(ze!==Te.cardId)return;const ha=Ta(Qe);if(!ha||ha.mode!==z)return;const at=ha.fragmentId;he[at]=Ie,Ie>=ua&&ce.add(at)}),Ia.current=ce,$a.current=he;const ve=Ta(Te.direction);if(ve!=null&&ve.fragmentId&&M.nodes[ve.fragmentId]){Da(M,ve.fragmentId,H);return}const xe=bt(M,ce,he,ua,fa,Te.direction);Da(M,(xe==null?void 0:xe.id)??null,H)}).catch(()=>{Ia.current=new Set,$a.current={};const F=Ta(Te.direction);if(F!=null&&F.fragmentId&&M.nodes[F.fragmentId]){Da(M,F.fragmentId,H);return}const z=bt(M,Ia.current,{},ua,fa,Te.direction);Da(M,(z==null?void 0:z.id)??null,H)}),()=>{W=!1}},[Te,a,fa,ua]),i.useEffect(()=>{if(!Te||Te.cardType!=="vocab"||Te.checkType!=="translation-match"){k(null),t({});return}const I=(E.pool??E.active??P).filter(F=>F.cardType==="vocab"&&F.checkType==="translation-match").filter((F,z,ce)=>ce.findIndex(he=>he.cardId===F.cardId)===z);I.some(F=>F.cardId===Te.cardId)||I.unshift(Te);const H=Pa(I).slice(0,6).map(F=>{const z=F.label.split("↔").map(ve=>ve.trim()).filter(Boolean);if(z.length<2)return null;const ce=`${F.cardId}:L`,he=`${F.cardId}:R`;return{cardId:F.cardId,leftId:ce,rightId:he,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),M=H.map(F=>F.leftId),W=Pa(H.map(F=>F.rightId));k({pairs:H,leftOrder:M,rightOrder:W,selection:{},activeLeft:null,activeRight:null,locked:{}})},[Te,P,E]),i.useEffect(()=>()=>{V.current&&window.clearTimeout(V.current),Z.current&&window.clearTimeout(Z.current)},[]);const Ga=i.useRef(null);i.useEffect(()=>{if(!Te)return;const c=ye(Te),y=typeof document<"u"?document.activeElement:null;if(Ga.current===c&&y&&(y.tagName==="INPUT"||y.tagName==="TEXTAREA"))return;let I=0;const C=()=>{if(Te){if(Te.cardType==="info"&&Te.infoType==="computed"){if(_e.length>0){const M=qt(Me,_e,$e),W=M?Ba.current[M]:null;if(W&&(W.focus(),document.activeElement===W)){Ga.current=c;return}}if(xa.current&&(xa.current.focus(),document.activeElement===xa.current)){Ga.current=c;return}}else if(Te.cardType==="vocab"&&xa.current&&(xa.current.focus(),document.activeElement===xa.current)){Ga.current=c;return}I<6&&(I+=1,window.setTimeout(C,40))}},H=window.setTimeout(C,40);return()=>window.clearTimeout(H)},[Te,_e,Me,$e]),i.useEffect(()=>{if(!ya)return;const c=y=>{y.key==="Enter"&&(y.preventDefault(),gt())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[ya]);const Xa=c=>{ra(c),ea(Va(c))};i.useEffect(()=>{if(!Te){ea(null),ra([]);return}const c=Te.cardType==="info"?"info":"connection";if(Te.cardType==="info"&&Te.infoType==="quote"){Oa().then(y=>{const I=y.filter(C=>C.itemType==="info"&&C.itemId===Te.cardId&&C.checkType==="quote-fragment"&&Ot(C.direction,Te.direction));Xa(I)}).catch(()=>{ea(null),ra([])});return}Kt(c,Te.cardId,Te.checkType,Te.direction).then(y=>Xa(y)).catch(()=>{ea(null),ra([])})},[o,Te,D]);const Lt=(c,y,I,C)=>{if(c==="info"&&I==="quote-fragment"){Oa().then(H=>{const M=H.filter(W=>W.itemType==="info"&&W.itemId===y&&W.checkType==="quote-fragment"&&Ot(W.direction,C));Xa(M)}).catch(()=>{ea(null),ra([])});return}Kt(c,y,I,C).then(H=>Xa(H)).catch(()=>{ea(null),ra([])})},Ct=(c,y,I)=>{var W;const C=((W=I.pairs.find(F=>F.leftId===c))==null?void 0:W.rightId)??null;if(!C)return I;const H=C===y;t(F=>({...F,[c]:H?"correct":"incorrect"})),V.current&&window.clearTimeout(V.current),Z.current&&window.clearTimeout(Z.current),r.current+=1;const M={kind:H?"correct":"incorrect",tick:r.current};if(T(null),V.current=window.setTimeout(()=>T(M),0),Z.current=window.setTimeout(()=>T(null),420),H){const F={...I.locked,[c]:!0};return Object.keys(F).length>=I.pairs.length?(ie("correct"),na(!0)):ie("correct"),{...I,selection:{...I.selection,[c]:y},activeLeft:null,activeRight:null,locked:F}}return ie("incorrect"),{...I,activeLeft:null,activeRight:null}},ut=c=>{k(y=>!y||y.locked[c]?y:y.activeRight?Ct(c,y.activeRight,y):{...y,activeLeft:y.activeLeft===c?null:c})},Fa=c=>{k(y=>y&&(y.activeLeft?Ct(y.activeLeft,c,y):{...y,activeRight:y.activeRight===c?null:c}))},gt=()=>{var c;if(Te&&Te.cardType==="info"&&Te.infoType==="quote"&&ta.current&&Ne&&!((c=Ta(Te.direction))!=null&&c.fragmentId)){const y=bt(ta.current,Ia.current,$a.current,ua,fa,Te.direction,Ne.fragmentId);if(y){ie(null),Se(""),oe(!1),Q({}),na(!1),sa(null),la(0),Da(ta.current,y.id,Ne.title);return}}ie(null),Se(""),oe(!1),Q({}),na(!1),sa(null),la(0),ee(y=>Math.min(y+1,P.length))},Ma=c=>{if(!Te)return;const y=c.expected??null,I=c.answer??"";let C=y??"",H=I;if(!y&&c.expectedMap&&c.answerMap){const ve=Object.keys(c.expectedMap).sort((xe,Ie)=>xe.localeCompare(Ie));C=ve.map(xe=>{var Ie;return((Ie=c.expectedMap)==null?void 0:Ie[xe])??""}).join("|"),H=ve.map(xe=>{var Ie;return((Ie=c.answerMap)==null?void 0:Ie[xe])??""}).join("|")}const M=C?mt(C,H,ka):new Uint8Array,W={revisionType:m.id,evalType:c.evalType,direction:c.direction,prompt:Ce??"",expected:y,answer:I,expectedAnswers:c.expectedMap??null,answers:c.answerMap??null,correct:c.correct,maskBase64:M.length?Ya(M):null,values:re??null,checkMode:be,compareMode:ka,minCorrectness:Ha},F=new TextEncoder().encode(JSON.stringify(W)),z=Te.cardType==="info"?"info":"connection",ce=c.overrideCheckType??Te.checkType??null,he=c.overrideDirection??Te.direction??null;Dt({itemType:z,itemId:Te.cardId,checkType:ce,direction:he,revisionType:m.id,evalType:c.evalType,correct:c.correct,maskBase64:M.length?Ya(M):null,payloadBase64:Ya(F),personRoleId:D??null}).then(()=>{Lt(z,Te.cardId,ce,he),lt(P),sr(o,D)}).catch(()=>{})},Za=(c,y)=>{const I=Ua.current.get(y);if(I)return Promise.resolve(I);const C=La.current.get(y);if(C)return C;const H=it({libraryId:o,infoId:c}).then(M=>{var ve,xe;const W=M.payload,F=((ve=W.definition)==null?void 0:ve.graph)??null,z="",ce=((xe=W.definition)==null?void 0:xe.answerTemplate)??"",he=vr(F,z,ce);if(he){const Pe={sample:Xr(he),answerTemplate:ce||null};return Ua.current.set(y,Pe),Pe}return Mr({libraryId:o,infoId:c}).then(Ie=>{const Pe={sample:Ie,answerTemplate:null};return Ua.current.set(y,Pe),Pe})}).catch(()=>Mr({libraryId:o,infoId:c}).then(M=>{const W={sample:M,answerTemplate:null};return Ua.current.set(y,W),W}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{La.current.delete(y)});return La.current.set(y,H),H},yt=(c,y)=>{var F;const I=`${ye(c)}:${y}`,C=qa.current.get(I);if(C)return Promise.resolve(C);const H=Wa.current.get(I);if(H)return H;const M=z=>(qa.current.set(I,z),z);let W;if(c.cardType==="vocab"){if(c.checkType==="translation-match")return W=Promise.resolve(M({prompt:c.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),W;const z=c.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(z.length>=2){const he=(c.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ve=he?z[0]:z[1],xe=he?z[1]:z[0];W=Promise.resolve(M({prompt:ve,expectedAnswer:xe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else W=Promise.resolve(M({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(c.cardType==="info"&&c.infoType==="word"){const z=(F=c.description)!=null&&F.startsWith("Language: ")?c.description.replace("Language: ",""):null;W=Promise.resolve(M({prompt:c.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else c.cardType==="info"&&c.infoType==="computed"?W=Za(c.cardId,I).then(z=>{var Ie,Pe;if(!z.sample)return M({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ce=z.sample,he=ce.expectedAnswers?Object.entries(ce.expectedAnswers).map(([ze,Qe])=>({key:ze,expected:Qe})):[],ve=he.reduce((ze,Qe)=>(ze[Qe.key]="",ze),{}),xe=ce.expectedAnswerIsSentence&&((Ie=ce.expectedAnswer)==null?void 0:Ie.trim())||null;return M({prompt:ce.prompt,expectedAnswer:he.length>0?xe:((Pe=ce.expectedAnswer)==null?void 0:Pe.trim())||null,computedExpected:he,computedAnswers:ve,computedValues:ce.values??null,answerTemplate:z.answerTemplate,outputVariables:ce.outputVariables??null,variableValues:ce.variableValues??null})}).catch(()=>M({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Wa.current.delete(I)}):W=Promise.resolve(M({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return Wa.current.set(I,W),W},Da=(c,y,I)=>{const C=Object.keys(c.nodes).length,H=Ia.current.size;if(!y){Je({title:I,before:c.text,after:"",fragmentId:null,total:C,completed:H}),Le(null),na(!0);return}const M=c.nodes[y];if(!M)return;const W=Zr(c.text,M);Je({title:I,before:W.before,after:W.after,fragmentId:M.id,total:C,completed:H}),Le(W.fragment),na(!1)},Mt=()=>{const c=ta.current;c&&Je(y=>y&&{...y,total:Object.keys(c.nodes).length,completed:Ia.current.size})},ht=()=>{const c=P[te+1];c&&yt(c,te+1)},St=()=>{if(ht(),Te&&Te.cardType==="vocab"&&Te.checkType==="translation-match"&&v){if(v.pairs.length===0){ie("incorrect"),na(!0);return}const M=v.pairs.reduce((xe,Ie)=>(xe[Ie.rightId]=Ie.rightLabel,xe),{});let W=0;const F={};v.pairs.forEach(xe=>{const Pe=v.selection[xe.leftId]===xe.rightId;F[xe.leftId]=Pe?"correct":"incorrect",Pe&&(W+=1)});const z=v.pairs.length||1,ce=W/z,he=W===v.pairs.length;t(xe=>({...xe,...F})),he?(ie("correct"),na(!0),la(0)):(ie("incorrect"),na(!1),la(xe=>{const Ie=xe+1;return Ie>=Ea&&(oe(!0),na(!0),k(Pe=>{if(!Pe)return Pe;const ze=Pe.pairs.reduce((Qe,ha)=>(Qe[ha.leftId]=ha.rightId,Qe),{});return{...Pe,selection:ze}})),Ie})),ja(he,ce);const ve="connection";Promise.all(v.pairs.map(xe=>{const Ie=v.selection[xe.leftId]??null,Pe=Ie?M[Ie]:"",ze={left:xe.leftLabel,expected:xe.rightLabel,answer:Pe,checkType:"translation-match"},Qe=new TextEncoder().encode(JSON.stringify(ze));return Dt({itemType:ve,itemId:xe.cardId,checkType:"translation-match",direction:null,revisionType:m.id,evalType:"translation-match",correct:Ie===xe.rightId,maskBase64:null,payloadBase64:Ya(Qe),personRoleId:D??null})})).then(()=>{Lt(ve,Te.cardId,Te.checkType,Te.direction),sr(o,D)}).catch(()=>{});return}if(_e.length>0){const M=_e.reduce((F,z)=>{const ce=He[z.key]??"";return F[z.key]=wa(ce)===wa(z.expected)?"correct":"incorrect",F},{});_e.every(({key:F,expected:z})=>{const ce=He[F]??"";return be==="exact"&&wa(ce)===wa(z)})?(ie("correct"),Q(M),na(!0),la(0),ja(!0,1),Ma({correct:!0,direction:Ce?`${Ce} -> computed`:"computed",expectedMap:_e.reduce((F,z)=>(F[z.key]=z.expected,F),{}),answerMap:He,evalType:"computed"})):(ie("incorrect"),Q(M),na(!1),la(F=>{const z=F+1;return z>=Ea&&X&&(oe(!0),na(!0)),z}),ja(!1,0),window.setTimeout(()=>{var z;const F=qt(Me,_e,$e);F&&Ba.current[F]&&((z=Ba.current[F])==null||z.focus())},40),Ma({correct:!1,direction:Ce?`${Ce} -> computed`:"computed",expectedMap:_e.reduce((F,z)=>(F[z.key]=z.expected,F),{}),answerMap:He,evalType:"computed"}));return}if(Te&&Te.cardType==="info"&&Te.infoType==="quote"&&(Ne!=null&&Ne.fragmentId)){if(!we)return;const M=Ta(Te.direction),W=(M==null?void 0:M.mode)??getQuoteMode(Te.direction),F=M!=null&&M.fragmentId&&Te.direction?Te.direction:Tt(W,Ne.fragmentId),z=si(we,_,ka),ce=be==="exact"&&ft(_)===ft(we),he=Ja(z),ve=ce||he,xe=Qa(z);ve?($a.current[Ne.fragmentId]=Math.max($a.current[Ne.fragmentId]??0,xe),($a.current[Ne.fragmentId]??0)>=ua&&Ia.current.add(Ne.fragmentId),Mt(),ie("correct"),Q({}),na(!0),sa(z),la(0),xe<100&&Ea<=1&&oe(!0),ja(!0,xe/100),Ma({correct:!0,direction:`quote:${Ne.fragmentId}`,expected:we,answer:_,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:F})):(ie("incorrect"),Q({}),na(!1),sa(z),la(Ie=>{const Pe=Ie+1;return Pe>=Ea&&X&&(oe(!0),na(!0)),Pe}),ja(!1,xe/100),window.setTimeout(()=>{var Ie;return(Ie=xa.current)==null?void 0:Ie.focus()},40),Ma({correct:!1,direction:`quote:${Ne.fragmentId}`,expected:we,answer:_,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:F}));return}if(!we)return;const c=mt(we,_,ka),y=be==="exact"&&wa(_)===wa(we),I=Ja(c),C=y||I,H=Qa(c);C?(ie("correct"),Q({}),na(!0),sa(c),la(0),H<100&&Ea<=1&&oe(!0),ja(!0,H/100),Ma({correct:!0,direction:Ce?`${Ce} -> ${we}`:null,expected:we,answer:_,evalType:"text"})):(ie("incorrect"),Q({}),na(!1),sa(c),la(M=>{const W=M+1;return W>=Ea&&X&&(oe(!0),na(!0)),W}),ja(!1,H/100),window.setTimeout(()=>{var M;return(M=xa.current)==null?void 0:M.focus()},40),Ma({correct:!1,direction:Ce?`${Ce} -> ${we}`:null,expected:we,answer:_,evalType:"text"}))},Xt=c=>{if(ht(),!we)return;const y=mt(we,c,ka),I=wa(c)===wa(we),C=Ja(y),H=I||C,M=Qa(y);H?(ie("correct"),Q({}),na(!0),sa(y),la(0),M<100&&Ea<=1&&oe(!0),ja(!0,M/100),Ma({correct:!0,direction:"word->language",expected:we,answer:c,evalType:"language-select"})):(ie("incorrect"),Q({}),na(!1),sa(y),la(W=>{const F=W+1;return F>=Ea&&X&&(oe(!0),na(!0)),F}),ja(!1,M/100),Ma({correct:!1,direction:"word->language",expected:we,answer:c,evalType:"language-select"}))},Zt=()=>{ht(),ie("correct"),na(!0),la(0),ja(!0,1),we&&Ma({correct:!0,direction:"manual",expected:we,answer:_,evalType:"manual"})},er=()=>{if(ja(!1,0),Te&&Te.cardType==="info"&&Te.infoType==="quote"){ie(null),Se(""),oe(!1),Q({}),na(!1),sa(null),la(0),ee(c=>Math.min(c+1,P.length));return}gt()};i.useEffect(()=>{ht()},[te,P]);const et=c=>{var I;if(c.key!=="Enter")return;if(c.preventDefault(),c.stopPropagation(),ya){gt();return}const y=_e.find(C=>!(He[C.key]??"").trim());if(y){(I=Ba.current[y.key])==null||I.focus();return}St()},$=a.cogita.library.revision.revealModeAfterIncorrect,X=_e.length>0||!!we;return e.jsxs(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:[ge==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${se.total?Math.min(100,Math.max(0,se.current/se.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:se.total?`${Math.min(se.current,se.total)} / ${se.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:B}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",j).replace("{check}",Y)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:R,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${R}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${R}/collections/${S}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ke?`${ke.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Aa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Aa.currentLevel??"-"," / ",Aa.levelsCount]}):null,ke?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(ke.correct)).replace("{total}",String(ke.total))}),ke.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(ke.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:Oe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Ke?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Ke})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":h?`${h.kind}-${h.tick}`:je?"idle":le??"idle",children:Te?e.jsx(e.Fragment,{children:da?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:Te,currentTypeLabel:ma,prompt:Ce,languages:ue,answer:_,onAnswerChange:c=>Se(y=>_t(y,c,ae)),computedExpected:_e,computedAnswers:He,onComputedAnswerChange:(c,y)=>ca(I=>({...I,[c]:_t(I[c]??"",y,ae)})),answerTemplate:Me,outputVariables:$e,variableValues:Fe,computedFieldFeedback:oa,feedback:le,canAdvance:ya,quoteContext:Ne,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:St,onSkip:er,onLanguageSelect:Xt,onMarkReviewed:Zt,onAdvance:gt,showCorrectAnswer:de,setShowCorrectAnswer:oe,onRevealCorrect:()=>na(!0),answerMask:Sa,expectedAnswer:we,hasExpectedAnswer:X,handleComputedKeyDown:et,answerInputRef:xa,computedInputRefs:Ba,scriptMode:ae,setScriptMode:G,matchPairs:v==null?void 0:v.pairs,matchLeftOrder:v==null?void 0:v.leftOrder,matchRightOrder:v==null?void 0:v.rightOrder,matchSelection:v==null?void 0:v.selection,matchActiveLeft:v==null?void 0:v.activeLeft,matchActiveRight:v==null?void 0:v.activeRight,matchFeedback:J,onMatchLeftSelect:ut,onMatchRightSelect:Fa})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${R}/collections/${S}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:nt?`${ot} / ${nt}`:a.cogita.library.revision.progressUnlimited}),ge==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ge==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ge==="ready"&&P.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:$}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ea]})]})]}),Aa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Aa.activeCount," / ",Aa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Aa.counts.map((c,y)=>{const I=y+1,C=Aa.currentLevel===I,H=Aa.percentages[y]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":C,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:I}),e.jsx("strong",{children:c})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,H))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[H.toFixed(1),"%"]})]},`level-${I}`)})})]}):null,va?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:va.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:va.dots.map(c=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,c.value*100))}%`,background:`rgba(${Math.round(255*(1-c.value))}, ${Math.round(200*c.value)}, 80, 0.9)`}},c.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:va.knownCount})]})]}):null,fa?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:dt})]})}):null]})]})]})})})]})]})}const lr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],An={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Fn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Bn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Dn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:o,collectionId:S}){const[b,p]=i.useState(""),[R,q,U]=Or([]),[l,m,f]=_r([]),[be,D]=i.useState(null),[j,Y]=i.useState(null),[B,ne]=i.useState(null),P=`/#/cogita/library/${o}`;i.useEffect(()=>{Wt(o,S).then(d=>p(d.name)).catch(()=>p(a.cogita.library.collections.defaultName))},[o,S,a]),i.useEffect(()=>{Mi({libraryId:o,collectionId:S}).then(d=>{if(!d.graphId||d.graphId==="00000000-0000-0000-0000-000000000000"){q([]),m([]);return}const te=d.nodes.map(_=>{var Ce;const Se=_.payload??{},le=Se.position??{x:120,y:120},ie=Se.params??{};return{id:_.nodeId,type:"default",position:le,data:{nodeType:_.nodeType,label:((Ce=lr.find(me=>me.type===_.nodeType))==null?void 0:Ce.label)??_.nodeType,params:ie}}}),ee=d.edges.map(_=>({id:_.edgeId,source:_.fromNodeId,target:_.toNodeId,sourceHandle:_.fromPort??void 0,targetHandle:_.toPort??void 0}));q(te),m(ee)}).catch(()=>{q([]),m([])})},[o,S,m,q]);const O=i.useMemo(()=>R.find(d=>d.id===be)??null,[R,be]),ue=d=>{var Se;const te=crypto.randomUUID(),ee=((Se=lr.find(le=>le.type===d))==null?void 0:Se.label)??d,_={...An[d]};q(le=>[...le,{id:te,type:"default",position:{x:120+le.length*40,y:120+le.length*40},data:{nodeType:d,label:ee,params:_}}]),D(te)},pe=i.useCallback(d=>{m(te=>$t({...d,id:crypto.randomUUID()},te))},[m]),ge=async()=>{Y(null);try{await Ii({libraryId:o,collectionId:S,nodes:R.map(d=>({nodeId:d.id,nodeType:d.data.nodeType,payload:{position:d.position,params:d.data.params}})),edges:l.map(d=>({edgeId:d.id,fromNodeId:d.source,fromPort:d.sourceHandle??null,toNodeId:d.target,toPort:d.targetHandle??null}))}),Y(a.cogita.library.graph.saveSuccess)}catch{Y(a.cogita.library.graph.saveFail)}},K=async()=>{try{const d=await Si({libraryId:o,collectionId:S});ne(d)}catch{ne(null)}},se=d=>{O&&q(te=>te.map(ee=>ee.id===O.id?{...ee,data:{...ee.data,params:d}}:ee))};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${P}/collections/${S}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:K,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ge,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:lr.map(d=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ue(d.type),children:d.label},d.type))}),j?e.jsx("p",{className:"cogita-help",children:j}):null,B&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(B.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(B.connections)).replace("{infos}",String(B.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(pr,{nodes:R,edges:l,onNodesChange:U,onEdgesChange:f,onConnect:pe,onNodeClick:(d,te)=>D(te.id),fitView:!0,children:[e.jsx(fr,{color:"rgba(120,160,200,0.2)"}),e.jsx(xr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),O?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:O.data.label}),O.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:O.data.params.tagId?{id:O.data.params.tagId,label:O.data.params.tagLabel??"",infoType:"topic"}:null,onChange:d=>se({...O.data.params,tagId:(d==null?void 0:d.id)??null,tagLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:O.data.params.scope??"any",onChange:d=>se({...O.data.params,scope:d.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),O.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:O.data.params.languageId?{id:O.data.params.languageId,label:O.data.params.languageLabel??"",infoType:"language"}:null,onChange:d=>se({...O.data.params,languageId:(d==null?void 0:d.id)??null,languageLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:O.data.params.scope??"any",onChange:d=>se({...O.data.params,scope:d.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),O.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:O.data.params.infoType??"word",onChange:d=>se({...O.data.params,infoType:d.target.value}),children:Bn.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsx(Ye,{libraryId:o,infoType:O.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:O.data.params.infoId?{id:O.data.params.infoId,label:O.data.params.infoLabel??"",infoType:O.data.params.infoType??"word"}:null,onChange:d=>se({...O.data.params,infoId:(d==null?void 0:d.id)??null,infoLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),O.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:O.data.params.connectionType??"translation",onChange:d=>se({...O.data.params,connectionType:d.target.value}),children:Fn.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:O.data.params.connectionId??"",onChange:d=>se({...O.data.params,connectionId:d.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(O.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const cr="cogita.preferences",ci=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],dr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ur=["settings","run","shared"];function Kn(a,n=""){const s=a.split("/").filter(Boolean);if(s[0]!=="cogita"||s[1]!=="library")return{};const u=s[2];if(!u)return{};if(!s[3])return{libraryId:u,target:"library_overview"};const g=new URLSearchParams(n),w=g.get("revisionId")??void 0,x=g.get("infoId")??void 0,N=g.get("infoView")==="cards"?"cards":"overview",A=g.get("collectionAction"),L=g.get("libraryAction");if(s[3]==="list")return{libraryId:u,target:L==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:w,infoId:x,infoView:N,libraryAction:L==="new-info"?"new-info":void 0};if(s[3]==="detail"||s[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:s[3],revisionId:w,infoId:x,infoView:N};if(s[3]==="new"||s[3]==="add")return{libraryId:u,target:"new_card",revisionId:w,libraryAction:"new-info"};if(s[3]==="edit")return{libraryId:u,target:"new_card",revisionId:w,infoId:s[4]};if(s[3]==="shared-revisions")return{libraryId:u,target:"all_collections",revisionId:w};if(s[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(s[3]==="transfer")return{libraryId:u,target:"transfer"};if(s[3]==="storyboards")return s[4]==="new"?{libraryId:u,target:"new_storyboard"}:{libraryId:u,target:"storyboards"};if(s[3]==="texts")return s[4]==="new"?{libraryId:u,target:"new_text"}:{libraryId:u,target:"texts"};if(s[3]!=="collections")return{libraryId:u,target:"library_overview"};if(s[4]==="new")return{libraryId:u,target:"new_collection",revisionId:w};const o=s[4];return o?s[5]==="graph"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:"graph"}:s[5]==="shared-revisions"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:"shared"}:s[5]==="revision"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:s[6]==="run"?"run":"settings"}:A==="new-revision"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:"new"}:{libraryId:u,target:"all_collections",collectionId:o,revisionId:w,revisionView:"detail"}:A==="new-collection"?{libraryId:u,target:"new_collection",collectionAction:"new-collection"}:{libraryId:u,target:"all_collections"}}function gr(a,n="library_overview",s,u,g,w,x="overview"){const N=(A,L)=>{const o=new URLSearchParams;L!=null&&L.revisionId&&o.set("revisionId",L.revisionId),L!=null&&L.collectionAction&&o.set("collectionAction",L.collectionAction),L!=null&&L.libraryAction&&o.set("libraryAction",L.libraryAction),L!=null&&L.infoId&&o.set("infoId",L.infoId),L!=null&&L.infoView&&(L!=null&&L.infoId)&&o.set("infoView",L.infoView);const S=o.toString();return S?`${A}?${S}`:A};return a?n==="library_overview"?N(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?N(`/cogita/library/${a}/list`,{revisionId:g,infoId:w,infoView:x}):n==="new_card"?w?N(`/cogita/library/${a}/edit/${w}`,{revisionId:g}):N(`/cogita/library/${a}/list`,{revisionId:g,libraryAction:"new-info"}):n==="all_collections"?s?u==="graph"?N(`/cogita/library/${a}/collections/${s}/graph`,{revisionId:g}):u==="settings"?N(`/cogita/library/${a}/collections/${s}/revision`,{revisionId:g}):u==="run"?N(`/cogita/library/${a}/collections/${s}/revision/run`,{revisionId:g}):u==="shared"?N(`/cogita/library/${a}/collections/${s}/shared-revisions`,{revisionId:g}):u==="new"?N(`/cogita/library/${a}/collections/${s}`,{revisionId:g,collectionAction:"new-revision"}):N(`/cogita/library/${a}/collections/${s}`,{revisionId:g}):N(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?N(`/cogita/library/${a}/collections`,{revisionId:g,collectionAction:"new-collection"}):n==="transfer"?N(`/cogita/library/${a}/transfer`,{revisionId:g}):n==="storyboards"?N(`/cogita/library/${a}/storyboards`,{revisionId:g}):n==="new_storyboard"?N(`/cogita/library/${a}/storyboards/new`,{revisionId:g}):n==="texts"?N(`/cogita/library/${a}/texts`,{revisionId:g}):n==="new_text"?N(`/cogita/library/${a}/texts/new`,{revisionId:g}):n==="dependencies"?N(`/cogita/library/${a}/dependencies`,{revisionId:g}):N(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function Pt(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function Vn(a){return typeof a=="string"&&ci.includes(a)}function On(a,n){var N;if(!a.length)return null;const s=a.filter(A=>n.has(A.roleId)),u=s.length>0?s:a,g=u.map(A=>{var o,S;const L=((S=(o=A.fields.find(b=>b.fieldType==="role_kind"))==null?void 0:o.plainValue)==null?void 0:S.toLowerCase())??"";return{roleId:A.roleId,roleKind:L}}),w=g.find(A=>A.roleKind.includes("master"));if(w)return w.roleId;const x=g.find(A=>A.roleKind.includes("account")||A.roleKind.includes("user"));return x?x.roleId:((N=u[0])==null?void 0:N.roleId)??null}function _n(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function qn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L}){const o=Vr(),S=yr(),b=i.useMemo(()=>Kn(S.pathname,S.search),[S.pathname,S.search]),p=a.cogita.workspace,[R,q]=i.useState([]),[U,l]=i.useState([]),[m,f]=i.useState([]),[be,D]=i.useState([]),[j,Y]=i.useState(void 0),[B,ne]=i.useState("library_overview"),[P,O]=i.useState(void 0),[ue,pe]=i.useState(void 0),[ge,K]=i.useState("detail"),[se,d]=i.useState(void 0),[te,ee]=i.useState(!1),[_,Se]=i.useState(!0),[le,ie]=i.useState(!1),[Ce,me]=i.useState(!1),[we,Le]=i.useState(null),[Ne,Je]=i.useState(""),[_e,Ee]=i.useState(""),[He,ca]=i.useState(""),[oa,Q]=i.useState(null),[re,Ue]=i.useState(null),Me=i.useRef({version:1,byLibrary:{}}),fe=i.useRef(!1),$e=i.useRef(!1),qe=i.useRef(null),Fe=i.useMemo(()=>R.find(E=>E.libraryId===j)??null,[R,j]),Ve=i.useMemo(()=>U.find(E=>E.collectionId===P)??null,[U,P]),v=i.useMemo(()=>be.find(E=>E.revisionId===ue)??null,[be,ue]),k=i.useMemo(()=>({detail:p.revisions.detail,graph:p.revisions.graph,settings:p.revisions.settings,run:p.revisions.run,shared:p.targets.sharedRevisions,new:p.revisionForm.createAction}),[p.revisions.detail,p.revisions.graph,p.revisions.run,p.revisions.settings,p.targets.sharedRevisions,p.revisionForm.createAction]),J=i.useMemo(()=>[{value:"detail",label:k.detail},{value:"graph",label:k.graph},{value:"settings",label:p.targets.allRevisions},{value:"run",label:k.run},{value:"shared",label:k.shared}],[k.detail,k.graph,k.run,k.shared,p.targets.allRevisions]),t=i.useMemo(()=>B==="new_card"?"all_cards":B==="new_collection"?"all_collections":B==="new_storyboard"?"storyboards":B==="new_text"?"texts":B,[B]),r=i.useMemo(()=>ge==="new"?"settings":ge,[ge]),h=i.useMemo(()=>b.infoId?"selected":B==="new_card"?"create":"search",[b.infoId,B]),T=i.useMemo(()=>m.find(E=>E.infoId===b.infoId)??null,[m,b.infoId]),V=i.useMemo(()=>({library_overview:p.targets.libraryOverview,all_cards:p.targets.allCards,new_card:p.targets.newCard,all_collections:p.targets.allCollections,new_collection:p.targets.newCollection,transfer:p.targets.transfer,storyboards:p.targets.storyboards,new_storyboard:p.targets.newStoryboard,texts:p.targets.texts,new_text:p.targets.newText,dependencies:p.targets.dependencies}),[p.targets]),Z=i.useMemo(()=>V[t]??t,[t,V]),ae=k[r],G=!!j,de=!!P,oe=G&&B==="all_collections",ke=de&&B==="all_collections",ea=de&&B==="all_collections"&&ur.includes(ge),Oe=i.useCallback(E=>{const Re=!!E.libraryId;let De=E.target,aa=E.collectionId,Xe=E.revisionId,ia=E.revisionView,ba=E.infoId,da=E.infoView??b.infoView??"overview";Re?dr[De].requiresCollection&&!aa?(De="all_collections",Xe=void 0,ia="detail"):De!=="all_collections"?(aa=void 0,Xe=void 0,De!=="new_card"&&De!=="all_cards"&&(ba=void 0,da="overview")):dr[De].allowsRevision?ur.includes(ia)||(Xe=void 0):ia="detail":(De="library_overview",aa=void 0,Xe=void 0,ia="detail",ba=void 0,da="overview"),Y(E.libraryId),ne(De),O(aa),pe(Xe),K(ia),ee(!1);const Be=Pt(gr(E.libraryId,De,aa,ia,Xe,ba,da));Pt(`${S.pathname}${S.search}`)!==Be&&(qe.current=Be,o(Be))},[S.pathname,S.search,o,b.infoView]),ra=E=>{Oe({libraryId:j,target:"all_collections",collectionId:P,revisionId:ur.includes(E)?ue:void 0,revisionView:E})},Ke=i.useMemo(()=>[{key:"library",label:p.layers.library,visible:!0,value:j??"",selectedLabel:(Fe==null?void 0:Fe.name)??p.path.noLibrarySelected,disabled:_||R.length===0,options:R.map(E=>({value:E.libraryId,label:E.name})),emptyOption:p.noLibraryOption,onSelect:E=>{const Re=E||void 0;Oe({libraryId:Re,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:p.layers.target,visible:G,value:t,selectedLabel:Z,disabled:!G,options:ci.map(E=>({value:E,label:V[E]})),onSelect:E=>{const Re=E;Oe({libraryId:j,target:Re,collectionId:P,revisionId:ue,revisionView:ge,infoId:Re==="new_card"?b.infoId:void 0})}},{key:"info_mode",label:p.layers.target,visible:t==="all_cards",value:h,selectedLabel:h==="create"?p.infoMode.create:h==="selected"?(T==null?void 0:T.label)??se??a.cogita.library.list.selectedEmpty:p.infoMode.search,disabled:!G,options:[{value:"search",label:p.infoMode.search},{value:"create",label:p.infoMode.create},...b.infoId?[{value:"selected",label:(T==null?void 0:T.label)??se??a.cogita.library.list.selectedEmpty}]:[]],onSelect:E=>{if(E!=="selected"){if(E==="create"){Oe({libraryId:j,target:"new_card",collectionId:P,revisionId:ue,revisionView:ge,infoId:void 0});return}Oe({libraryId:j,target:"all_cards",collectionId:P,revisionId:ue,revisionView:ge,infoId:void 0,infoView:"overview"})}}},{key:"info_selected_action",label:p.layers.target,visible:t==="all_cards"&&!!b.infoId,value:B==="new_card"&&b.infoId?"edit":b.infoView==="cards"?"cards":"overview",selectedLabel:B==="new_card"&&b.infoId?p.infoActions.edit:b.infoView==="cards"?p.infoActions.seeCards:p.infoActions.overview,disabled:!G||!b.infoId,options:[{value:"overview",label:p.infoActions.overview},{value:"edit",label:p.infoActions.edit},{value:"cards",label:p.infoActions.seeCards}],onSelect:E=>{if(b.infoId){if(E==="edit"){Oe({libraryId:j,target:"new_card",collectionId:P,revisionId:ue,revisionView:ge,infoId:b.infoId});return}if(E==="cards"){Oe({libraryId:j,target:"all_cards",collectionId:P,revisionId:ue,revisionView:ge,infoId:b.infoId,infoView:"cards"});return}Oe({libraryId:j,target:"all_cards",collectionId:P,revisionId:ue,revisionView:ge,infoId:b.infoId,infoView:"overview"})}}},{key:"collection",label:p.layers.collection,visible:oe,value:P??"",selectedLabel:(Ve==null?void 0:Ve.name)??p.path.noCollectionSelected,disabled:!G||le||U.length===0,options:U.map(E=>({value:E.collectionId,label:E.name})),emptyOption:p.selectCollectionOption,onSelect:E=>{Oe({libraryId:j,target:"all_collections",collectionId:E||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:p.layers.revision,visible:ke,value:r,selectedLabel:ae,disabled:!P,options:J.map(E=>({value:E.value,label:E.label})),onSelect:E=>{ra(E)}},{key:"revision_entry",label:p.layers.revision,visible:ea,value:ue??"",selectedLabel:(v==null?void 0:v.name)??p.status.noRevisions,disabled:!de||Ce||be.length===0,options:be.map(E=>({value:E.revisionId,label:E.name})),emptyOption:p.status.noRevisions,onSelect:E=>{Oe({libraryId:j,target:"all_collections",collectionId:P,revisionId:E||void 0,revisionView:ge})}}],[J,U,le,h,m,R,_,Oe,be,Ce,Ve,P,T,v,ue,se,de,G,Fe,j,ae,ge,B,r,t,Z,oe,ke,ea,V,a.cogita.library.list.selectedEmpty,b.infoId,b.infoView,p.infoActions.edit,p.infoActions.overview,p.infoActions.seeCards,p.layers.collection,p.layers.library,p.layers.revision,p.layers.target,p.noLibraryOption,p.path.noCollectionSelected,p.path.noLibrarySelected,p.selectCollectionOption]),We=i.useMemo(()=>Ke.filter(E=>E.visible),[Ke]),Ae=i.useMemo(()=>We.filter(E=>E.key!=="library"&&E.key!=="collection"&&E.key!=="revision_entry"),[We]),Ge=i.useMemo(()=>Ae.find(E=>E.key==="target")??null,[Ae]),Sa=i.useMemo(()=>Ae.find(E=>E.key==="info_mode")??null,[Ae]),sa=i.useMemo(()=>Ae.find(E=>E.key==="info_selected_action")??null,[Ae]),Ra=i.useMemo(()=>Ae.find(E=>E.key==="collection_action")??null,[Ae]),la=i.useCallback((E,Re)=>E?e.jsx("div",{className:"cogita-sidebar-actions",children:E.options.map(De=>e.jsx("button",{type:"button",className:`ghost ${String(E.value)===De.value?"active":""}`,onClick:()=>E.onSelect(De.value),disabled:E.disabled,children:De.label},`${Re}:${E.key}:${De.value}`))}):null,[]),xa=i.useMemo(()=>{const E=b.libraryId;if(!E||!S.pathname.startsWith("/cogita/library/"))return null;const Re={copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,libraryId:E};if(b.target==="library_overview")return e.jsx(Yi,{...Re});if(b.target==="all_cards")return e.jsx(Zi,{...Re,mode:b.cardMode??"list"});if(b.target==="new_card")return e.jsx(nn,{...Re,editInfoId:b.infoId});if(b.target==="dependencies")return e.jsx(sn,{...Re});if(b.target==="transfer")return e.jsx(cn,{...Re});if(b.target==="storyboards"||b.target==="new_storyboard")return e.jsx(dn,{...Re});if(b.target==="texts"||b.target==="new_text")return e.jsx(un,{...Re});if(b.target==="all_collections"){if(b.collectionId){const De={...Re,collectionId:b.collectionId};return b.revisionView==="graph"?e.jsx(Dn,{...De}):b.revisionView==="shared"?e.jsx(ln,{...Re,collectionId:b.collectionId}):b.revisionView==="settings"?e.jsx(jn,{...De,revisionId:b.revisionId}):b.revisionView==="run"?e.jsx(En,{...De,revisionId:b.revisionId}):e.jsx(gn,{...De})}return e.jsx(Dr,{...Re})}return b.target==="new_collection"?e.jsx(Dr,{...Re}):null},[n,a,A,S.pathname,o,L,w,N,u,g,b.cardMode,b.collectionId,b.infoId,b.libraryId,b.revisionId,b.revisionView,b.target,x,s]);i.useEffect(()=>{let E=!1;return(async()=>{var De,aa,Xe,ia,ba,da,Be;Se(!0);try{await Pi();const[ta,Ia,$a]=await Promise.all([Wr(),Ri(),$i()]);if(E)return;q(ta);const Te=new Set($a.nodes.filter(ma=>ma.nodeType==="role"&&ma.canLink).map(ma=>ma.roleId??"")),je=On(Ia,Te);if(Q(je),je){const ma=$a.nodes.find(za=>za.nodeType==="data"&&za.roleId===je&&(za.fieldType===cr||za.label===cr));Ue((ma==null?void 0:ma.dataKeyId)??null),Me.current=_n(ma==null?void 0:ma.value)}const Ua=Me.current.lastLibraryId,La=((De=ta.find(ma=>ma.libraryId===b.libraryId))==null?void 0:De.libraryId)??(ta.length===1?ta[0].libraryId:void 0)??((aa=ta.find(ma=>ma.libraryId===Ua))==null?void 0:aa.libraryId)??((Xe=ta[0])==null?void 0:Xe.libraryId),qa=La?(ba=(ia=Me.current.byLibrary)==null?void 0:ia[La])==null?void 0:ba.lastTarget:void 0,Wa=Vn(qa)?qa:"library_overview";Y(La),ne(b.target??Wa),pe(b.revisionId??(La?(Be=(da=Me.current.byLibrary)==null?void 0:da[La])==null?void 0:Be.lastRevisionId:void 0)),K(b.revisionView??"detail"),fe.current=!0}catch{E||Le(p.status.loadFailed)}finally{E||Se(!1)}})(),()=>{E=!0}},[p.status.loadFailed]),i.useLayoutEffect(()=>{fe.current&&(b.libraryId&&R.some(E=>E.libraryId===b.libraryId)&&Y(b.libraryId),b.target&&ne(b.target),O(b.collectionId),pe(b.revisionId),b.revisionView&&K(b.revisionView))},[R,b.collectionId,b.libraryId,b.revisionId,b.revisionView,b.target]),i.useEffect(()=>{if(!j){l([]),O(void 0),f([]),D([]),pe(void 0);return}let E=!1;return ie(!0),wt({libraryId:j,limit:200}).then(Re=>{var Xe;if(E)return;const De=Re.items;l(De);const aa=(Xe=De.find(ia=>ia.collectionId===b.collectionId))==null?void 0:Xe.collectionId;O(aa)}).catch(()=>{E||(l([]),O(void 0))}).finally(()=>{E||ie(!1)}),()=>{E=!0}},[b.collectionId,j]),i.useEffect(()=>{if(!j||t!=="all_cards"&&B!=="new_card"){f([]);return}let E=!1;return Ut({libraryId:j,limit:200}).then(Re=>{E||f(Re)}).catch(()=>{E||f([])}),()=>{E=!0}},[t,j,B]),i.useEffect(()=>{if(!j||!P){D([]),pe(void 0);return}let E=!1;return me(!0),zr({libraryId:j,collectionId:P}).then(Re=>{var Xe,ia,ba,da;if(E)return;D(Re);const De=(ia=(Xe=Me.current.byLibrary)==null?void 0:Xe[j])==null?void 0:ia.lastRevisionId,aa=((ba=Re.find(Be=>Be.revisionId===b.revisionId))==null?void 0:ba.revisionId)??((da=Re.find(Be=>Be.revisionId===De))==null?void 0:da.revisionId);pe(aa)}).catch(()=>{E||(D([]),pe(void 0))}).finally(()=>{E||me(!1)}),()=>{E=!0}},[b.revisionId,P,j]),i.useEffect(()=>{const E=b.infoId;if(!j||!E){d(void 0);return}let Re=!1;return it({libraryId:j,infoId:E}).then(De=>{if(Re)return;const aa=De.payload;d((aa==null?void 0:aa.label)??(aa==null?void 0:aa.name)??(aa==null?void 0:aa.title)??De.infoId)}).catch(()=>{Re||d(E)}),()=>{Re=!0}},[b.infoId,j]),i.useEffect(()=>{if(!fe.current||b.libraryId&&R.some(De=>De.libraryId===b.libraryId)&&b.libraryId!==j||b.target&&b.target!==B||b.revisionView&&b.revisionView!==ge||b.revisionId&&b.revisionId!==ue||dr[B].requiresCollection&&!P&&b.target==="all_collections"&&b.collectionId)return;const E=Pt(`${S.pathname}${S.search}`),Re=Pt(gr(j,B,P,ge,ue,b.infoId,b.infoView??"overview"));if(E===Re){qe.current=null;return}qe.current!==Re&&(qe.current=Re,o(Re,{replace:!0}))},[R,S.pathname,S.search,o,b.collectionId,b.infoId,b.infoView,b.libraryId,b.revisionId,b.revisionView,b.target,P,j,ue,ge,B]),i.useEffect(()=>{if(typeof window>"u")return;const E=()=>{window.innerWidth>920&&ee(!1)};return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]),i.useEffect(()=>{if(!fe.current||!oa||!j||$e.current)return;const E=Me.current,Re={...E.byLibrary??{}},De={...Re[j]??{},lastCollectionId:P,lastRevisionId:ue,lastRevisionView:ge,lastTarget:B},aa={version:1,lastLibraryId:j,byLibrary:{...Re,[j]:De}},Xe=JSON.stringify(E),ia=JSON.stringify(aa);if(Xe===ia)return;Me.current=aa,$e.current=!0,(async()=>{try{if(re)await Ei(re,{plainValue:ia});else{const da=await Ai(oa,{itemName:cr,itemType:"data",plainValue:ia});Ue(da.dataItemId)}}catch{Le(p.status.savePrefsFailed)}finally{$e.current=!1}})()},[re,oa,P,j,ue,ge,B,p.status.savePrefsFailed]);const Ba=async()=>{const E=Ne.trim();if(!E){Le(a.cogita.user.libraryNameRequired);return}Le(null);try{const Re=await Di({name:E});q(De=>[Re,...De]),Y(Re.libraryId),ne("library_overview"),O(void 0),Je("")}catch{Le(a.cogita.user.libraryCreateFailed)}},ya=async()=>{if(!j){Le(p.status.selectLibraryFirst);return}const E=_e.trim();if(!E){Le(a.cogita.library.collections.saveRequiredName);return}Le(null);try{const Re=await Fi({libraryId:j,name:E,items:[]}),De=await wt({libraryId:j,limit:200});l(De.items),O(Re.collectionId),pe(void 0),ne("all_collections"),K("detail"),Ee("")}catch{Le(a.cogita.library.collections.saveFail)}},na=async()=>{if(!j||!P){Le(p.status.selectLibraryFirst);return}const E=He.trim();if(!E){Le(p.revisionForm.nameLabel);return}Le(null);try{const Re=await Bi({libraryId:j,collectionId:P,name:E,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});D(De=>[Re,...De]),pe(Re.revisionId),ne("all_collections"),K("settings"),ca("")}catch{Le(p.status.loadFailed)}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${te?"open":""}`,"aria-label":p.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Fe==null?void 0:Fe.name)??p.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Fe?p.sidebar.libraryActionsHint:p.status.selectLibraryFirst}),la(Ge,"sidebar")]}),Sa?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:p.sidebar.infoActionsHint}),la(Sa,"sidebar"),sa?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(T==null?void 0:T.label)??se??a.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:p.sidebar.selectedInfoActionsHint}),la(sa,"sidebar")]}):null]}):null,Ve?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:Ve.name}),e.jsx("p",{className:"cogita-sidebar-note",children:p.sidebar.collectionActionsHint}),la(Ra,"sidebar")]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:p.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:u,children:p.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{N("cogita"),ee(!1)},children:p.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:x?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),te?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":p.sidebar.closeMenu,onClick:()=>ee(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":p.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>ee(E=>!E),"aria-label":te?p.sidebar.closeMenu:p.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),We.map((E,Re)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Re>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,E.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":E.label,children:E.selectedLabel}):e.jsxs("select",{"aria-label":E.label,value:E.value,onChange:De=>E.onSelect(De.target.value),disabled:E.disabled,children:[E.emptyOption?e.jsx("option",{value:"",children:E.emptyOption}):null,E.options.map(De=>e.jsx("option",{value:De.value,children:De.label},`${E.key}:${De.value}`))]})]},`menu:${E.key}`))]}),xa?e.jsxs(e.Fragment,{children:[B==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:_e,onChange:E=>Ee(E.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!j})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,disabled:!j,children:a.cogita.library.actions.createCollection}),we?e.jsx("p",{className:"cogita-form-error",children:we}):null]}):null,B==="all_collections"&&P&&ge==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:p.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:E=>ca(E.target.value),placeholder:p.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:na,children:p.revisionForm.createAction}),we?e.jsx("p",{className:"cogita-form-error",children:we}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Qr.Provider,{value:!0,children:xa})})]}):null,xa?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:p.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[We.map((E,Re)=>e.jsxs("span",{children:[Re>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:E.selectedLabel})]},`path:${E.key}`)),oe?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:p.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[p.path.currentRoute," ",e.jsx("code",{children:gr(j,B,P,ge,ue,b.infoId,b.infoView??"overview")})]}),j?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${j}`,children:p.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${j}/list`,children:p.links.allCards}),P?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${j}/collections/${P}/shared-revisions`,children:p.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:p.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ne,onChange:E=>Je(E.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ba,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:_e,onChange:E=>Ee(E.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!j})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,disabled:!j,children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:E=>ca(E.target.value),placeholder:p.revisionForm.namePlaceholder,disabled:!P})]}),e.jsx("button",{type:"button",className:"cta",onClick:na,disabled:!P,children:p.revisionForm.createAction}),we?e.jsx("p",{className:"cogita-form-error",children:we}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:p.panels.collections}),le?e.jsx("p",{className:"cogita-library-subtitle",children:p.status.loadingCollections}):null,!le&&U.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:p.status.noCollections}):null,U.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:U.map(E=>e.jsxs("button",{type:"button",className:`cogita-card-item ${E.collectionId===P?"active":""}`,onClick:()=>{O(E.collectionId),pe(void 0),K("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:p.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:E.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[E.itemCount," ",p.cards.itemsSuffix]})]},E.collectionId))}):null]})]})]})]})})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:qn},Symbol.toStringTag,{value:"Module"}));function Un({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,shareId:o}){const[S,b]=i.useState(null),[p,R]=i.useState("loading"),[q,U]=i.useState(a.cogita.library.collections.defaultName),[l,m]=i.useState("Cogita Library"),[f,be]=i.useState([]),[D,j]=i.useState([]),[Y,B]=i.useState("idle"),[ne,P]=i.useState({current:0,total:0}),[O,ue]=i.useState(0),[pe,ge]=i.useState(""),[K,se]=i.useState(null),[d,te]=i.useState(null),[ee,_]=i.useState(null),[Se,le]=i.useState(null),[ie,Ce]=i.useState([]),[me,we]=i.useState({}),[Le,Ne]=i.useState({}),[Je,_e]=i.useState(null),[Ee,He]=i.useState(null),[ca,oa]=i.useState(null),[Q,re]=i.useState(null),[Ue,Me]=i.useState({}),fe=i.useRef(0),[$e,qe]=i.useState(null),Fe=i.useRef(null),Ve=i.useRef(null),[v,k]=i.useState(null),[J,t]=i.useState(!1),[r,h]=i.useState(null),[T,V]=i.useState([]),[Z,ae]=i.useState(null),G=i.useRef(null),de=i.useRef(null),[oe,ke]=i.useState(null),[ea,Oe]=i.useState(0),ra=i.useRef(null),Ke=i.useRef({}),[We,Ae]=i.useState(!1),[Ge,Sa]=i.useState({}),sa=i.useRef(null),Ra=i.useRef(new Set),la=i.useRef({}),[xa,Ba]=i.useState([]),[ya,na]=i.useState(new Set),[E,Re]=i.useState(!1),De=yr(),aa=i.useMemo(()=>new URLSearchParams(De.search),[De.search]),Xe=i.useMemo(()=>aa.get("key")??"",[aa]),ia=(S==null?void 0:S.mode)??"random",ba=(S==null?void 0:S.check)??"exact",da=(S==null?void 0:S.limit)??20,Be=i.useMemo(()=>Tr((S==null?void 0:S.revisionType)??ia),[S,ia]),ta=i.useMemo(()=>{const $=S==null?void 0:S.revisionSettings,X=ti(Be,aa);return Jt(Be,$??X)},[S,aa,Be]),Ia=i.useMemo(()=>a.cogita.library.revision[Be.labelKey]??ia,[a,ia,Be]),$a=i.useMemo(()=>ba==="exact"?a.cogita.library.revision.checkValue:ba,[a,ba]),je=p==="ready"?f[O]??null:null,Ua=(je==null?void 0:je.checkType)==="translation-match"&&Q,La=i.useRef(new Map),qa=i.useRef(new Map),Wa=i.useRef(new Map),ma=i.useRef(new Map),za=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?Ze(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),nt=i.useMemo(()=>{var X;return Be.id!=="levels"?f.length:((X=Ge.pool)==null?void 0:X.length)??Be.getFetchLimit(da,ta)},[Ge,ta,Be,f.length,da]),ot=Be.getProgressTotal?Be.getProgressTotal(f,Ge,da,ta):Be.id==="levels"?Math.min(da,nt):f.length,Ea=ot?Math.min(O+1,ot):0,ka=Math.max(1,Number(ta.tries??1)),Ha=ta.compare??"anchors",fa=Math.max(0,Math.min(100,Number(ta.minCorrectness??0))),ua=(ta.considerDependencies??"on")==="on",Pa=Math.max(0,Math.min(100,Number(ta.dependencyThreshold??85))),Qa=$=>{const X=$.slice();for(let c=X.length-1;c>0;c-=1){const y=Math.floor(Math.random()*(c+1));[X[c],X[y]]=[X[y],X[c]]}return X},Ja=$=>$.length?$.reduce((c,y)=>c+y,0)/$.length/255*100:0,st=$=>Ja($)>=fa,Yt=async()=>{const $=await Oa(),X=new Map,c=new Map;$.forEach(C=>{const H=`${C.itemType}:${C.itemId}`,M=Ka(C.itemType,C.itemId,C.checkType,C.direction);X.has(H)||X.set(H,[]),X.get(H).push(C),c.has(M)||c.set(M,[]),c.get(M).push(C)});const y=new Map,I=new Map;return X.forEach((C,H)=>y.set(H,Va(C).score)),c.forEach((C,H)=>I.set(H,Va(C).score)),{itemKnowness:y,cardKnowness:I}},xt=async $=>{const X=Ge,c=$.concat(X.active??[]).concat(X.pool??[]).filter((z,ce,he)=>he.findIndex(ve=>ye(ve)===ye(z))===ce);if(!ua){na(new Set(c.map(ye)));return}const{itemKnowness:y,cardKnowness:I}=await Yt(),C=z=>{if(z.cardType!=="info"||z.infoType!=="quote"||z.checkType!=="quote-fragment")return!0;const ce=Ta(z.direction);if(!(ce!=null&&ce.fragmentId))return!0;const he=z.description??"";if(!he.trim())return!0;const xe=pt(he).nodes[ce.fragmentId];if(!xe||!xe.leftId&&!xe.rightId)return!0;const Ie=[xe.leftId,xe.rightId].filter(Qe=>!!Qe);if(Ie.length===0)return!0;const Pe=Ie.map(Qe=>{const ha=Ka("info",z.cardId,"quote-fragment",Tt(ce.mode,Qe));return I.get(ha)??0});return Pe.reduce((Qe,ha)=>Qe+ha,0)/Pe.length>=Pa},H=(S==null?void 0:S.collectionId)??null,M=H?xa.filter(z=>pa(z.childItemType)==="collection"&&z.childItemId===H&&!pa(z.childCheckType)&&!pa(z.childDirection)):[],W=H&&c.length>0?c.reduce((z,ce)=>z+(I.get(ye(ce))??0),0)/c.length:0,F=new Set;for(const z of c){if(z.cardType!=="info"){F.add(ye(z));continue}if(!C(z))continue;const ce=xa.filter(xe=>li(xe,z)).concat(M);if(ce.length===0){F.add(ye(z));continue}let he=0;for(const xe of ce)if(pa(xe.parentItemType)==="collection")he+=xe.parentItemId===H?W:0;else if(pa(xe.parentCheckType)||pa(xe.parentDirection)){const Ie=pa(xe.parentCheckType),Pe=pa(xe.parentDirection),ze=Ka(xe.parentItemType,xe.parentItemId,Ie,Pe);he+=I.get(ze)??0}else{const Ie=`${xe.parentItemType}:${xe.parentItemId}`;he+=y.get(Ie)??0}he/ce.length>=Pa&&F.add(ye(z))}na(F)},Qt=$=>{for(let X=$;X<f.length;X+=1){const c=f[X];if(c&&(!ua||c.cardType!=="info"||ya.has(ye(c))))return X}return-1},lt=$=>!ua||$.cardType!=="info"||ya.has(ye($)),Gt=$=>{if(Be.id!=="temporal"&&Be.id!=="levels")return null;const X=Ge,c=(X.active??[]).concat(X.pool??[]),y=new Set;for(const I of c){const C=ye(I);if(!(y.has(C)||$.has(C))&&(y.add(C),lt(I)))return I}return null},Ca=i.useMemo(()=>{if(Be.id!=="levels")return null;const $=Ge,X=$.pool??[],c=$.active??[],y=$.levelMap??{},I=Math.max(1,Number(ta.levels??1)),C=Array.from({length:I},()=>0),H=new Set(c.map(z=>ye(z)));X.forEach(z=>{const ce=Math.min(I,Math.max(1,y[ye(z)]??1));C[ce-1]+=1});const M=X.length||1,W=C.map(z=>z/M*100),F=je?y[ye(je)]??1:null;return{counts:C,percentages:W,currentLevel:F,levelsCount:I,activeCount:c.length,poolCount:X.length,activeSet:H}},[Ge,ta,Be,je]),ct=i.useMemo(()=>{if(Be.id!=="temporal")return null;const $=Ge,X=$.pool??[],c=$.active??[],y=$.knownessMap??{},I=new Set($.unknownSet??[]);let C=0;X.forEach(W=>{(y[ye(W)]??0)>1&&(C+=1)});const H=I.size,M=c.map(W=>({id:ye(W),value:I.has(ye(W))?0:Math.max(0,Math.min(1,y[ye(W)]??0))}));return{knownCount:C,unknownCount:H,dots:M}},[Ge,Be]),Aa=i.useMemo(()=>{if(!ua)return 0;const $=Ge;return f.concat($.active??[]).concat($.pool??[]).filter((c,y,I)=>I.findIndex(C=>ye(C)===ye(c))===y).filter(c=>c.cardType==="info"&&!ya.has(ye(c))).length},[ua,Ge,f,ya]);i.useEffect(()=>{if(!ua||Y!=="ready")return;const $=Ge,c=f.concat($.active??[]).concat($.pool??[]).filter((C,H,M)=>M.findIndex(W=>ye(W)===ye(C))===H).filter(C=>C.cardType!=="info"||ya.has(ye(C))).length,y=G.current;if(G.current=c,y===null||c<=y)return;const I=c-y;ae(`New card available (+${I})`),de.current&&window.clearTimeout(de.current),de.current=window.setTimeout(()=>ae(null),2200)},[ua,Y,Ge,f,ya]),i.useEffect(()=>()=>{de.current&&window.clearTimeout(de.current)},[]);const va=($,X)=>{const c=Be.applyOutcome({queue:f,meta:Ge},je,da,ta,{correct:$,correctness:X,createdUtc:new Date().toISOString()});be(c.queue),Sa(c.meta);const y=c.queue[O+1];y&&Ma(y,O+1)};i.useEffect(()=>{if(!o){R("error");return}R("loading"),Ki({shareId:o,key:Xe}).then($=>{b($),U($.collectionName),m($.libraryName),R("ready")}).catch(()=>{R("error")})},[o,Xe]),i.useEffect(()=>{o&&Vi({shareId:o,key:Xe,type:"language"}).then($=>j($)).catch(()=>j([]))},[o,Xe]),i.useEffect(()=>{!o||p!=="ready"||Oi({shareId:o,key:Xe}).then($=>Ba($.items??[])).catch(()=>Ba([]))},[o,Xe,p]),i.useEffect(()=>{if(!o||p!=="ready")return;let $=!0;return(async()=>{B("loading"),P({current:0,total:Be.id==="levels"?0:Be.getFetchLimit(da,ta)});try{const c=[];let y=null,I=null;do{const ce=await _i({shareId:o,key:Xe,limit:300,cursor:y});if(c.push(...ce.items),(Be.id==="levels"||Be.id==="temporal")&&ce.total&&(I=ce.total),P(he=>({current:c.length,total:he.total||ce.total||Be.getFetchLimit(da,ta)})),y=ce.nextCursor??null,I!==null&&c.length>=I||Be.id!=="levels"&&Be.id!=="temporal"&&c.length>=Be.getFetchLimit(da,ta))break}while(y);if(!$)return;const C=mr(c);let H;if(Be.id==="levels"){const ce=Math.max(1,Number(ta.levels??1));H={},C.forEach(he=>{const ve=ye(he);H[ve]=Math.max(1,Math.min(ce,1))})}let M=null,W=null,F=null;if(Be.id==="temporal"){const ce=await Oa(),he=new Set(C.map(Ie=>ye(Ie))),ve=ce.reduce((Ie,Pe)=>{const ze=Ka(Pe.itemType,Pe.itemId,Pe.checkType,Pe.direction);return he.has(ze)&&(Ie[ze]||(Ie[ze]=[]),Ie[ze].push(Pe)),Ie},{});M={},W=new Set,F={};const xe=Date.now();C.forEach(Ie=>{const Pe=ye(Ie),ze=ve[Pe]??[];if(ze.length===0){M[Pe]=0,W.add(Pe),F[Pe]=[];return}const Qe=jr(ze);F[Pe]=Qe;const ha=zt(Qe,xe);M[Pe]=ha.knowness})}const z=Be.id==="levels"?kr(C,da,ta,H):Be.id==="temporal"?wr(C,da,ta,M??{},W??new Set,F??{}):Be.prepare(C,da,ta);be(z.queue),Sa(z.meta),ue(0),B("ready"),P(ce=>({current:Math.min(ce.current,ce.total),total:ce.total}))}catch{$&&B("error")}})(),()=>{$=!1}},[o,Xe,da,Be,ta,p]),i.useEffect(()=>{xt(f)},[f,xa,ua,Pa,S==null?void 0:S.collectionId]),i.useEffect(()=>{if(!je||!ua){Re(!1);return}if(je.cardType!=="info"||ya.has(ye(je))){Re(!1);return}const $=Qt(O+1);if($>=0){Re(!1),ue($);return}if(Be.id==="temporal"||Be.id==="levels"){const X=f.slice(0,O+1),c=f.slice(O+1).filter(lt),y=X.concat(c),I=new Set(y.map(ye)),C=Gt(I);if(C){const M=ye(C);I.has(M)||(y.push(C),I.add(M),Sa(W=>{const F=W,z=new Set(F.queued??[]);return z.add(M),{...F,queued:z}}))}const H=y.findIndex((M,W)=>W!==O&&lt(M));if(H>=0){be(y),ue(H),Re(!1);return}}Re(!0)},[je,ya,ua,O,f,Ge,Be.id]),i.useEffect(()=>{if(ge(""),se(null),ke(null),Oe(0),Ce([]),we({}),Ne({}),_e(null),He(null),oa(null),t(!1),Ae(!1),k(null),re(null),Me({}),!je){te(null),_(null);return}je.cardType==="info"&&je.infoType==="computed"&&te(a.cogita.library.revision.loadingComputed);let $=!0;return Ma(je,O).then(X=>{!$||!X||(te(X.prompt),_(X.expectedAnswer),Ce(X.computedExpected),we(X.computedAnswers),_e(X.answerTemplate),He(X.outputVariables),oa(X.variableValues))}),()=>{$=!1}},[je,o,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){sa.current=null,Ra.current=new Set,le(null);return}const $=je.description??"",X=(je.label??"").trim(),c=X.replace(/\s+/g," ").trim(),y=$.replace(/\s+/g," ").trim(),I=c&&c!==y?X:a.cogita.library.infoTypes.quote;if(!$){le(null),_(null);return}const C=pt($);sa.current=C,te(I);let H=!0;return Oa().then(M=>{if(!H)return;const W=getQuoteMode(je.direction),F=new Map;M.forEach(xe=>{if(xe.itemType!=="info"||xe.checkType!=="quote-fragment"||!xe.direction)return;const Ie=Ta(xe.direction);if(!Ie||Ie.mode!==W)return;const Pe=`${xe.itemId}:${Ie.fragmentId}`;F.has(Pe)||F.set(Pe,[]),F.get(Pe).push(xe)});const z={},ce=new Set;F.forEach((xe,Ie)=>{const[Pe,ze]=Ie.split(":",2);if(Pe!==je.cardId)return;const Qe=Va(xe).score;z[ze]=Qe,Qe>=Pa&&ce.add(ze)}),Ra.current=ce,la.current=z;const he=Ta(je.direction);if(he!=null&&he.fragmentId&&C.nodes[he.fragmentId]){Za(C,he.fragmentId,I);return}const ve=bt(C,ce,z,Pa,ua,je.direction);Za(C,(ve==null?void 0:ve.id)??null,I)}).catch(()=>{Ra.current=new Set,la.current={};const M=Ta(je.direction);if(M!=null&&M.fragmentId&&C.nodes[M.fragmentId]){Za(C,M.fragmentId,I);return}const W=bt(C,Ra.current,{},Pa,ua,je.direction);Za(C,(W==null?void 0:W.id)??null,I)}),()=>{H=!1}},[je,a,ua,Pa]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){re(null),Me({});return}const c=(Ge.pool??Ge.active??f).filter(M=>M.cardType==="vocab"&&M.checkType==="translation-match").filter((M,W,F)=>F.findIndex(z=>z.cardId===M.cardId)===W);c.some(M=>M.cardId===je.cardId)||c.unshift(je);const I=Qa(c).slice(0,6).map(M=>{const W=M.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(W.length<2)return null;const F=`${M.cardId}:L`,z=`${M.cardId}:R`;return{cardId:M.cardId,leftId:F,rightId:z,leftLabel:W[0],rightLabel:W[1]}}).filter(Boolean),C=I.map(M=>M.leftId),H=Qa(I.map(M=>M.rightId));re({pairs:I,leftOrder:C,rightOrder:H,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,f,Ge]),i.useEffect(()=>()=>{Fe.current&&window.clearTimeout(Fe.current),Ve.current&&window.clearTimeout(Ve.current)},[]);const dt=i.useRef(null);i.useEffect(()=>{if(!je)return;const $=ye(je),X=typeof document<"u"?document.activeElement:null;if(dt.current===$&&X&&(X.tagName==="INPUT"||X.tagName==="TEXTAREA"))return;let c=0;const y=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(ie.length>0){const C=qt(Je,ie,Ee),H=C?Ke.current[C]:null;if(H&&(H.focus(),document.activeElement===H)){dt.current=$;return}}if(ra.current&&(ra.current.focus(),document.activeElement===ra.current)){dt.current=$;return}}else if(je.cardType==="vocab"&&ra.current&&(ra.current.focus(),document.activeElement===ra.current)){dt.current=$;return}c<6&&(c+=1,window.setTimeout(y,40))}},I=window.setTimeout(y,40);return()=>window.clearTimeout(I)},[je,ie,Je,Ee]),i.useEffect(()=>{if(!We)return;const $=X=>{X.key==="Enter"&&(X.preventDefault(),ut())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[We]);const ja=$=>{V($),h(Va($))};i.useEffect(()=>{if(!je){h(null),V([]);return}const $=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Oa().then(X=>{const c=X.filter(y=>y.itemType==="info"&&y.itemId===je.cardId&&y.checkType==="quote-fragment"&&Ot(y.direction,je.direction));ja(c)}).catch(()=>{h(null),V([])});return}Kt($,je.cardId,je.checkType,je.direction).then(X=>ja(X)).catch(()=>{h(null),V([])})},[je]);const Ga=($,X,c,y)=>{if($==="info"&&c==="quote-fragment"){Oa().then(I=>{const C=I.filter(H=>H.itemType==="info"&&H.itemId===X&&H.checkType==="quote-fragment"&&Ot(H.direction,y));ja(C)}).catch(()=>{h(null),V([])});return}Kt($,X,c,y).then(I=>ja(I)).catch(()=>{h(null),V([])})},Xa=($,X,c)=>{var H;const y=((H=c.pairs.find(M=>M.leftId===$))==null?void 0:H.rightId)??null;if(!y)return c;const I=y===X;Me(M=>({...M,[$]:I?"correct":"incorrect"})),Fe.current&&window.clearTimeout(Fe.current),Ve.current&&window.clearTimeout(Ve.current),fe.current+=1;const C={kind:I?"correct":"incorrect",tick:fe.current};if(qe(null),Fe.current=window.setTimeout(()=>qe(C),0),Ve.current=window.setTimeout(()=>qe(null),420),I){const M={...c.locked,[$]:!0};return Object.keys(M).length>=c.pairs.length?(se("correct"),Ae(!0)):se("correct"),{...c,selection:{...c.selection,[$]:X},activeLeft:null,activeRight:null,locked:M}}return se("incorrect"),{...c,activeLeft:null,activeRight:null}},Lt=$=>{re(X=>!X||X.locked[$]?X:X.activeRight?Xa($,X.activeRight,X):{...X,activeLeft:X.activeLeft===$?null:$})},Ct=$=>{re(X=>X&&(X.activeLeft?Xa(X.activeLeft,$,X):{...X,activeRight:X.activeRight===$?null:$}))},ut=()=>{var $;if(je&&je.cardType==="info"&&je.infoType==="quote"&&sa.current&&Se&&!(($=Ta(je.direction))!=null&&$.fragmentId)){const X=bt(sa.current,Ra.current,la.current,Pa,ua,je.direction,Se.fragmentId);if(X){se(null),ge(""),t(!1),Ne({}),Ae(!1),ke(null),Oe(0),Za(sa.current,X.id,Se.title);return}}se(null),ge(""),t(!1),Ne({}),Ae(!1),ke(null),Oe(0),ue(X=>Math.min(X+1,f.length))},Fa=$=>{if(!je)return;const X=$.expected??null,c=$.answer??"";let y=X??"",I=c;if(!X&&$.expectedMap&&$.answerMap){const ce=Object.keys($.expectedMap).sort((he,ve)=>he.localeCompare(ve));y=ce.map(he=>{var ve;return((ve=$.expectedMap)==null?void 0:ve[he])??""}).join("|"),I=ce.map(he=>{var ve;return((ve=$.answerMap)==null?void 0:ve[he])??""}).join("|")}const C=y?mt(y,I,Ha):new Uint8Array,H={revisionType:Be.id,evalType:$.evalType,direction:$.direction,prompt:d??"",expected:X,answer:c,expectedAnswers:$.expectedMap??null,answers:$.answerMap??null,correct:$.correct,maskBase64:C.length?Ya(C):null,checkMode:ba,compareMode:Ha,minCorrectness:fa},M=new TextEncoder().encode(JSON.stringify(H)),W=je.cardType==="info"?"info":"connection",F=$.overrideCheckType??je.checkType??null,z=$.overrideDirection??je.direction??null;Dt({itemType:W,itemId:je.cardId,checkType:F,direction:z,revisionType:Be.id,evalType:$.evalType,correct:$.correct,maskBase64:C.length?Ya(C):null,payloadBase64:Ya(M)}).then(()=>{Ga(W,je.cardId,F,z),xt(f)}).catch(()=>{})},gt=($,X)=>{const c=La.current.get(X);if(c)return Promise.resolve(c);const y=qa.current.get(X);if(y)return y;const I=qi({shareCode:o,infoId:$,key:Xe}).then(C=>{var ce,he;const H=C.payload,M=((ce=H.definition)==null?void 0:ce.graph)??null,W="",F=((he=H.definition)==null?void 0:he.answerTemplate)??"",z=vr(M,W,F);if(z){const xe={sample:Xr(z),answerTemplate:F||null};return La.current.set(X,xe),xe}return Sr({shareId:o,infoId:$,key:Xe}).then(ve=>{const xe={sample:ve,answerTemplate:null};return La.current.set(X,xe),xe})}).catch(()=>Sr({shareId:o,infoId:$,key:Xe}).then(C=>{const H={sample:C,answerTemplate:null};return La.current.set(X,H),H}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{qa.current.delete(X)});return qa.current.set(X,I),I},Ma=($,X)=>{var M;const c=`${ye($)}:${X}`,y=Wa.current.get(c);if(y)return Promise.resolve(y);const I=ma.current.get(c);if(I)return I;const C=W=>(Wa.current.set(c,W),W);let H;if($.cardType==="vocab"){if($.checkType==="translation-match")return H=Promise.resolve(C({prompt:$.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),H;const W=$.label.split("↔").map(F=>F.trim()).filter(Boolean);if(W.length>=2){const z=($.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ce=z?W[0]:W[1],he=z?W[1]:W[0];H=Promise.resolve(C({prompt:ce,expectedAnswer:he,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else H=Promise.resolve(C({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if($.cardType==="info"&&$.infoType==="word"){const W=(M=$.description)!=null&&M.startsWith("Language: ")?$.description.replace("Language: ",""):null;H=Promise.resolve(C({prompt:$.label,expectedAnswer:W,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else $.cardType==="info"&&$.infoType==="computed"?H=gt($.cardId,c).then(W=>{var ve,xe;if(!W.sample)return C({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const F=W.sample,z=F.expectedAnswers?Object.entries(F.expectedAnswers).map(([Ie,Pe])=>({key:Ie,expected:Pe})):[],ce=z.reduce((Ie,Pe)=>(Ie[Pe.key]="",Ie),{}),he=F.expectedAnswerIsSentence&&((ve=F.expectedAnswer)==null?void 0:ve.trim())||null;return C({prompt:F.prompt,expectedAnswer:z.length>0?he:((xe=F.expectedAnswer)==null?void 0:xe.trim())||null,computedExpected:z,computedAnswers:ce,answerTemplate:W.answerTemplate,outputVariables:F.outputVariables??null,variableValues:F.variableValues??null})}).catch(()=>C({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{ma.current.delete(c)}):H=Promise.resolve(C({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return ma.current.set(c,H),H},Za=($,X,c)=>{const y=Object.keys($.nodes).length,I=Ra.current.size;if(!X){le({title:c,before:$.text,after:"",fragmentId:null,total:y,completed:I}),_(null),Ae(!0);return}const C=$.nodes[X];if(!C)return;const H=Zr($.text,C);le({title:c,before:H.before,after:H.after,fragmentId:C.id,total:y,completed:I}),_(H.fragment),Ae(!1)},yt=()=>{const $=sa.current;$&&le(X=>X&&{...X,total:Object.keys($.nodes).length,completed:Ra.current.size})},Da=()=>{const $=f[O+1];$&&Ma($,O+1)},Mt=()=>{if(Da(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&Q){if(Q.pairs.length===0){se("incorrect"),Ae(!0);return}const C=Q.pairs.reduce((he,ve)=>(he[ve.rightId]=ve.rightLabel,he),{});let H=0;const M={};Q.pairs.forEach(he=>{const xe=Q.selection[he.leftId]===he.rightId;M[he.leftId]=xe?"correct":"incorrect",xe&&(H+=1)});const W=Q.pairs.length||1,F=H/W,z=H===Q.pairs.length;Me(he=>({...he,...M})),z?(se("correct"),Ae(!0),Oe(0)):(se("incorrect"),Ae(!1),Oe(he=>{const ve=he+1;return ve>=ka&&(t(!0),Ae(!0),re(xe=>{if(!xe)return xe;const Ie=xe.pairs.reduce((Pe,ze)=>(Pe[ze.leftId]=ze.rightId,Pe),{});return{...xe,selection:Ie}})),ve})),va(z,F);const ce="connection";Promise.all(Q.pairs.map(he=>{const ve=Q.selection[he.leftId]??null,xe=ve?C[ve]:"",Ie={left:he.leftLabel,expected:he.rightLabel,answer:xe,checkType:"translation-match"},Pe=new TextEncoder().encode(JSON.stringify(Ie));return Dt({itemType:ce,itemId:he.cardId,checkType:"translation-match",direction:null,revisionType:Be.id,evalType:"translation-match",correct:ve===he.rightId,maskBase64:null,payloadBase64:Ya(Pe)})})).then(()=>{Ga(ce,je.cardId,je.checkType,je.direction),xt(f)}).catch(()=>{});return}if(ie.length>0){const C=ie.reduce((M,W)=>{const F=me[W.key]??"";return M[W.key]=wa(F)===wa(W.expected)?"correct":"incorrect",M},{});ie.every(({key:M,expected:W})=>{const F=me[M]??"";return ba==="exact"&&wa(F)===wa(W)})?(se("correct"),Ne(C),Ae(!0),Oe(0),va(!0,1),Fa({correct:!0,direction:d?`${d} -> computed`:"computed",expectedMap:ie.reduce((M,W)=>(M[W.key]=W.expected,M),{}),answerMap:me,evalType:"computed"})):(se("incorrect"),Ne(C),Ae(!1),Oe(M=>{const W=M+1;return W>=ka&&et&&(t(!0),Ae(!0)),W}),va(!1,0),window.setTimeout(()=>{var W;const M=qt(Je,ie,Ee);M&&Ke.current[M]&&((W=Ke.current[M])==null||W.focus())},40),Fa({correct:!1,direction:d?`${d} -> computed`:"computed",expectedMap:ie.reduce((M,W)=>(M[W.key]=W.expected,M),{}),answerMap:me,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Se!=null&&Se.fragmentId)){if(!ee)return;const C=Ta(je.direction),H=(C==null?void 0:C.mode)??getQuoteMode(je.direction),M=C!=null&&C.fragmentId&&je.direction?je.direction:Tt(H,Se.fragmentId),W=si(ee,pe,Ha),F=ba==="exact"&&ft(pe)===ft(ee),z=st(W),ce=F||z,he=Ja(W);ce?(la.current[Se.fragmentId]=Math.max(la.current[Se.fragmentId]??0,he),(la.current[Se.fragmentId]??0)>=Pa&&Ra.current.add(Se.fragmentId),yt(),se("correct"),Ne({}),Ae(!0),ke(W),Oe(0),he<100&&ka<=1&&t(!0),va(!0,he/100),Fa({correct:!0,direction:`quote:${Se.fragmentId}`,expected:ee,answer:pe,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:M})):(se("incorrect"),Ne({}),Ae(!1),ke(W),Oe(ve=>{const xe=ve+1;return xe>=ka&&et&&(t(!0),Ae(!0)),xe}),va(!1,he/100),window.setTimeout(()=>{var ve;return(ve=ra.current)==null?void 0:ve.focus()},40),Fa({correct:!1,direction:`quote:${Se.fragmentId}`,expected:ee,answer:pe,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:M}));return}if(!ee)return;const $=mt(ee,pe,Ha),X=ba==="exact"&&wa(pe)===wa(ee),c=st($),y=X||c,I=Ja($);y?(se("correct"),Ne({}),Ae(!0),ke($),Oe(0),I<100&&ka<=1&&t(!0),va(!0,I/100),Fa({correct:!0,direction:d?`${d} -> ${ee}`:null,expected:ee,answer:pe,evalType:"text"})):(se("incorrect"),Ne({}),Ae(!1),ke($),Oe(C=>{const H=C+1;return H>=ka&&et&&(t(!0),Ae(!0)),H}),va(!1,I/100),window.setTimeout(()=>{var C;return(C=ra.current)==null?void 0:C.focus()},40),Fa({correct:!1,direction:d?`${d} -> ${ee}`:null,expected:ee,answer:pe,evalType:"text"}))},ht=$=>{if(Da(),!ee)return;const X=mt(ee,$,Ha),c=wa($)===wa(ee),y=st(X),I=c||y,C=Ja(X);I?(se("correct"),Ne({}),Ae(!0),ke(X),Oe(0),C<100&&ka<=1&&t(!0),va(!0,C/100),Fa({correct:!0,direction:"word->language",expected:ee,answer:$,evalType:"language-select"})):(se("incorrect"),Ne({}),Ae(!1),ke(X),Oe(H=>{const M=H+1;return M>=ka&&et&&(t(!0),Ae(!0)),M}),va(!1,C/100),Fa({correct:!1,direction:"word->language",expected:ee,answer:$,evalType:"language-select"}))},St=$=>{var c;if($.key!=="Enter")return;if($.preventDefault(),$.stopPropagation(),We){ut();return}const X=ie.find(y=>!(me[y.key]??"").trim());if(X){(c=Ke.current[X.key])==null||c.focus();return}Mt()},Xt=()=>{Da(),se("correct"),Ae(!0),Oe(0),va(!0,1),ee&&Fa({correct:!0,direction:"manual",expected:ee,answer:pe,evalType:"manual"})},Zt=()=>{if(va(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){se(null),ge(""),t(!1),Ne({}),Ae(!1),ke(null),Oe(0),ue($=>Math.min($+1,f.length));return}ut()};i.useEffect(()=>{Da()},[O,f]);const er=a.cogita.library.revision.revealModeAfterIncorrect,et=ie.length>0||!!ee;return e.jsxs(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:x,onNavigate:N,language:A,onLanguageChange:L,children:[(p==="loading"||Y==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:p==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ne.total?Math.min(100,Math.max(0,ne.current/ne.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ne.total?`${Math.min(ne.current,ne.total)} / ${ne.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:q}),e.jsx("p",{className:"cogita-library-subtitle",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",Ia).replace("{check}",$a)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ca?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Ca.currentLevel??"-"," / ",Ca.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Z?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Z})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":$e?`${$e.kind}-${$e.tick}`:Ua?"idle":K??"idle",children:p!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:p==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):je?e.jsx(e.Fragment,{children:E?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:je,currentTypeLabel:za,prompt:d,languages:D,answer:pe,onAnswerChange:$=>ge(X=>_t(X,$,v)),computedExpected:ie,computedAnswers:me,onComputedAnswerChange:($,X)=>we(c=>({...c,[$]:_t(c[$]??"",X,v)})),answerTemplate:Je,outputVariables:Ee,variableValues:ca,computedFieldFeedback:Le,feedback:K,canAdvance:We,quoteContext:Se,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:Zt,onLanguageSelect:ht,onMarkReviewed:Xt,onAdvance:ut,showCorrectAnswer:J,setShowCorrectAnswer:t,onRevealCorrect:()=>Ae(!0),answerMask:oe,expectedAnswer:ee,hasExpectedAnswer:et,handleComputedKeyDown:St,answerInputRef:ra,computedInputRefs:Ke,scriptMode:v,setScriptMode:k,matchPairs:Q==null?void 0:Q.pairs,matchLeftOrder:Q==null?void 0:Q.leftOrder,matchRightOrder:Q==null?void 0:Q.rightOrder,matchSelection:Q==null?void 0:Q.selection,matchActiveLeft:Q==null?void 0:Q.activeLeft,matchActiveRight:Q==null?void 0:Q.activeRight,matchFeedback:Ue,onMatchLeftSelect:Lt,onMatchRightSelect:Ct})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ot?`${Ea} / ${ot}`:a.cogita.library.revision.progressUnlimited}),p==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),p==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),p==="ready"&&Y==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),p==="ready"&&Y==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),p==="ready"&&Y==="ready"&&f.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:er}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",ka]})]})]}),Ca?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Ca.activeCount," / ",Ca.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ca.counts.map(($,X)=>{const c=X+1,y=Ca.currentLevel===c,I=Ca.percentages[X]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":y,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:c}),e.jsx("strong",{children:$})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,I))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[I.toFixed(1),"%"]})]},`level-${c}`)})})]}):null,ct?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ct.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ct.dots.map($=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-$.value))}, ${Math.round(200*$.value)}, 80, 0.9)`}},$.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ct.knownCount})]})]}):null,ua?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Aa})]})}):null]})]})]})})})]})]})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Un},Symbol.toStringTag,{value:"Module"}));export{Jn as C,Yn as a,Qn as b};
