import{r as i,j as e,u as Or,R as fr,B as xr,C as yr,H as Cr,P as Mr,a as Rt,b as ui,c as gi,d as Vr,e as qr,f as vr}from"./vendor-SpL5bUHi.js";import{L as _r,A as Ur,g as Wr,a as hi,b as jt,c as zr,s as $t,d as Hr,e as jr,f as et,h as hr,i as Et,j as br,k as bi,l as tr,m as at,u as mi,n as ga,o as pi,p as fi,q as xi,r as Jr,t as Yr,v as yi,w as vi,x as ji,y as Wt,z as At,B as wi,C as ki,D as Ti,E as Ni,F as Li,G as Ci,H as za,I as Mi,J as Si,K as Ii,M as Pi,N as Ri,O as $i,P as Ei,Q as Ai,R as Fi,S as Bi,T as Di,U as Ki,V as Oi,W as Vi,X as qi,Y as _i,Z as Sr}from"./recreatio-core-78cRTeMQ.js";import"./vendor-cogita-ui-BgsFclds.js";const vt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},yt={moveMs:900,pauseMs:220,errorMs:900},Ui=(a=11)=>{let n=a;const l=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:u,height:g,paddingX:w,paddingY:p,levels:P}=vt,M=(g-p*2)/(P.length-1),F=[],o=[],C=[];P.forEach((m,f)=>{const he=g-p-f*M,O=u-w*2,y=[];for(let B=0;B<m;B+=1){const E=w+(B+1)*O/(m+1),ne=(l()-.5)*18,I=Math.max(w,Math.min(u-w,E+ne)),U=f===0?3:f<2?2.1:1.4,de=f===0?"root":`l${f}-${B}`;y.push({id:de,x:f===0?u/2:I,y:he,r:U,level:f,role:f===0?"root":void 0})}C.push(y),F.push(...y)});const b=C[C.length-1];if(b!=null&&b.length){const m=b[Math.floor(b.length/2)];m.role="goal",m.r=2}for(let m=1;m<C.length;m+=1){const f=C[m-1];C[m].forEach(O=>{const y=[...f].sort((I,U)=>Math.abs(I.x-O.x)-Math.abs(U.x-O.x)),B=y[0],E=y[1]&&l()<.45?y[1]:null;(E?[B,E]:[B]).forEach(I=>{o.push({from:I.id,to:O.id,key:`${I.id}-${O.id}`})}),l()<.2&&y[2]&&o.push({from:y[2].id,to:O.id,key:`${y[2].id}-${O.id}`})})}const x=new Map;o.forEach(m=>{const f=x.get(m.to)??[];f.push(m.from),x.set(m.to,f)});const W=new Map,q=new Map,z=new Map;o.forEach(m=>{const f=W.get(m.from)??[];f.push(m.key),W.set(m.from,f);const he=q.get(m.from)??[];he.push(m.to),q.set(m.from,he);const O=z.get(m.from)??[];O.push(m.to),z.set(m.from,O);const y=z.get(m.to)??[];y.push(m.from),z.set(m.to,y)});const s=new Map;return F.forEach(m=>{s.set(m.id,m)}),{nodes:F,links:o,parentsById:x,linksByFrom:W,childrenByFrom:q,neighborsById:z,nodesById:s}};function Wi({slides:a,activeIndex:n,introOpen:l,prefersReducedMotion:u,onNext:g,onPrev:w,onSelect:p,onExit:P,onOpen:M,onRegister:F}){const o=n===a.length-1,C=l&&n===0?"entry":"docked",b=a[a.length-1],[x,W]=i.useState(!1),q=i.useMemo(()=>Array.from({length:20},(j,k)=>({src:`/cogita/logo/Cogita${String(k).padStart(2,"0")}.png`,kind:k<=11?"bubble":k<=17?"text":"recreatio"})),[]),z=l&&n===0;i.useEffect(()=>{if(!l){W(!1);return}n>0&&!x&&W(!0)},[n,l,x]);const s=i.useRef(0),m=i.useRef(null),f=i.useMemo(()=>{const j={x:40,y:160},k={x:260,y:48},Q=6,t=k.x-j.x,r=j.y-k.y,h=t/Q,T=[.3,.45,.6,.65,1.4,2.2],D=T.reduce((oe,we)=>oe+we,0),ae=T.map(oe=>r*oe/D),te=[j];let G=j.x,ue=j.y;for(let oe=1;oe<=Q;oe+=1){const we=(Math.random()-.5)*14,ea=(Math.random()-.5)*28;G=Math.max(j.x+oe*14,Math.min(k.x-(Q-oe)*14,G+h+we));const qe=ae[oe-1]??ae[ae.length-1];ue=ue-qe+ea;const ta=Math.max(k.y,Math.min(j.y-4,ue));te.push({x:Math.round(G),y:Math.round(ta)})}return te[te.length-1]=k,te},[]),he=i.useMemo(()=>{const r=(D,ae,te)=>Math.min(te,Math.max(ae,D)),h=f.map(D=>{const ae=10+Math.random()*36;return{x:r(D.x,40,260),y:r(D.y-ae,40,140)}}),T=f.map((D,ae)=>{var ue;const te=12+Math.random()*40,G=((ue=h[ae])==null?void 0:ue.y)??D.y;return{x:r(D.x,40,260),y:r(Math.max(G+10,D.y+te),60,170)}});return{upper:h,lower:T}},[f]),O=i.useMemo(()=>{var k;const j=((k=f[4])==null?void 0:k.x)??260;return Math.max(0,Math.min(240,j-40))},[f]),y=i.useMemo(()=>{var ae,te;const j=(G,ue,oe)=>Math.min(oe,Math.max(ue,G)),k=(G,ue,oe)=>f.map((we,ea)=>{var Ta,ra;const qe=((Ta=he.upper[ea])==null?void 0:Ta.y)??we.y,ta=((ra=he.lower[ea])==null?void 0:ra.y)??we.y,De=(Math.random()-.5)*70,Ue=we.y+G+De,Ke=j(we.y+ue,qe+6,ta-6),Xe=j(we.y+oe,qe+6,ta-6);return{x:we.x,y:j(Ue,Math.min(Ke,Xe),Math.max(Ke,Xe))}}),Q=-14+Math.random()*28,t=14+Math.random()*28,r=k(Q,-80,12),h=k(t,-12,80);for(let G=4;G<f.length;G+=1){const ue=f[G],oe=((ae=he.upper[G])==null?void 0:ae.y)??ue.y,we=((te=he.lower[G])==null?void 0:te.y)??ue.y;r[G]={x:ue.x,y:j(ue.y-12,oe+6,we-6)},h[G]={x:ue.x,y:j(ue.y+12,oe+6,we-6)}}const T=he.upper.length?he.upper[he.upper.length-1].y:40,D=he.lower.length?he.lower[he.lower.length-1].y:170;return r[r.length-1]={x:f[f.length-1].x,y:j(f[f.length-1].y-14,T,D)},h[h.length-1]={x:f[f.length-1].x,y:j(f[f.length-1].y+12,T,D)},{higher:r,lower:h}},[f,he]),B=1e4,E=i.useMemo(()=>{let j=17;const k=()=>(j=(j*1664525+1013904223)%4294967296,j/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const h=(k()-.5)*240,T=(k()-.5)*180,D=(k()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${h.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${D.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),ne=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[I,U]=i.useState([]),de=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),me=i.useMemo(()=>{const k=[],t=(h,T)=>h+Math.random()*(T-h);for(let h=0;h<6;h+=1){let T=!1;for(let D=0;D<80;D+=1){const ae=t(14,86),te=t(10,34);if(k.every(ue=>{const oe=ue.x-ae,we=ue.y-te;return Math.hypot(oe,we)>=12})){k.push({x:ae,y:te}),T=!0;break}}T||k.push({x:t(16,84),y:t(12,32)})}return k.map((h,T)=>({id:`p${T+1}`,x:`${h.x.toFixed(1)}%`,y:`${h.y.toFixed(1)}%`,xNum:h.x,yNum:h.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ge,K]=i.useState(0),[le,d]=i.useState(0),[re,ee]=i.useState([]),_=1e4,Ne=i.useMemo(()=>{if(me.length<2)return[];const j=T=>{let D=T+1831565813;return D=Math.imul(D^D>>>15,D|1),D^=D+Math.imul(D^D>>>7,D|61),((D^D>>>14)>>>0)/4294967296},k=(T,D)=>Math.floor(j(T)*D),Q=new Set,t=[],r=Math.min(3,me.length);let h=0;for(;t.length<r&&h<30;){h+=1;const T=k(ge*13+h*5,me.length),D=k(ge*29+h*7,me.length);if(T===D)continue;const ae=T<D?`${T}-${D}`:`${D}-${T}`;Q.has(ae)||(Q.add(ae),t.push({id:`link-${ae}`,from:me[T],to:me[D],delay:`${(h*.35).toFixed(2)}s`}))}return t},[ge,me]);i.useEffect(()=>{if(!l||n!==2)return;const j=()=>{const Q=E.map(t=>t.id);for(let t=Q.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[Q[t],Q[r]]=[Q[r],Q[t]]}return Q.slice(0,4)};U(j());const k=window.setInterval(()=>{U(j())},B);return()=>window.clearInterval(k)},[n,l,E,B]),i.useEffect(()=>{if(!l||n!==3)return;const j=()=>{d(Math.floor(Math.random()*de.length)),ee(me.map(()=>Math.random()<.6?"good":"bad")),K(Q=>Q+1)};j();const k=window.setInterval(j,_);return()=>window.clearInterval(k)},[n,l,de.length,me,_]);const se=i.useMemo(()=>Ui(11),[]),[ie,Le]=i.useState(new Set(["root"])),[Re,Ce]=i.useState(new Set),[$e,ke]=i.useState(new Set),[Qe,Oe]=i.useState({fromId:"root",toId:"root",key:0}),Ae=i.useRef(ie),He=i.useRef("root"),ia=i.useRef(0),aa=i.useRef(null),R=i.useRef(null),X=i.useRef([]);i.useEffect(()=>{Ae.current=ie},[ie]);const Fe=i.useMemo(()=>{const j=new Set;return ie.forEach(k=>{const Q=se.linksByFrom.get(k);Q&&Q.forEach(t=>j.add(t))}),j},[ie,se]),Te=se.nodesById.get(Qe.toId)??se.nodesById.get("root"),pe=Te?`${Te.x/vt.width*100}%`:"50%",Ee=Te?`${Te.y/vt.height*100}%`:"90%";i.useEffect(()=>{if(!l||n!==1||u)return;(()=>{Le(new Set(["root"])),Ce(new Set),ke(new Set),Oe({fromId:"root",toId:"root",key:0}),R.current=null,ia.current=0,He.current="root",X.current=[]})();const k=()=>{const t=He.current,r=Ae.current,T=(se.childrenByFrom.get(t)??[]).filter(we=>!r.has(we));if(T.length)return T[Math.floor(Math.random()*T.length)];if(r.size>=se.nodes.length){const we=se.neighborsById.get(t)??[];return we.length?we[Math.floor(Math.random()*we.length)]:null}const D=we=>(se.childrenByFrom.get(we)??[]).some(qe=>!r.has(qe)),ae=[t],te=new Set([t]),G=new Map;let ue=null;for(;ae.length;){const we=ae.shift();if(!we)break;if(we!==t&&D(we)){ue=we;break}(se.neighborsById.get(we)??[]).forEach(qe=>{te.has(qe)||(te.add(qe),G.set(qe,we),ae.push(qe))})}if(!ue)return null;let oe=ue;for(;G.get(oe)&&G.get(oe)!==t;)oe=G.get(oe)??oe;return oe},Q=(t,r)=>{if(t===r){const h=k();h&&Q(t,h);return}ia.current+=1,Oe({fromId:t,toId:r,key:ia.current}),He.current=r,aa.current=window.setTimeout(()=>{const h=se.parentsById.get(r)??[],T=Ae.current,D=h.filter(ue=>!T.has(ue));if(!D.length){const ue=new Set(T);ue.add(r),Le(ue),aa.current=window.setTimeout(()=>{for(;X.current.length;){const we=X.current[X.current.length-1];if(!ue.has(we)){if(we!==r){Q(r,we);return}break}X.current.pop()}const oe=k();oe&&Q(r,oe)},yt.pauseMs);return}const ae=new Set([r,...D]),te=new Set(D.map(ue=>`${ue}-${r}`));Ce(ae),ke(te),X.current.includes(r)||X.current.push(r);const G=D[Math.floor(Math.random()*D.length)];R.current={fromId:r,toId:G},aa.current=window.setTimeout(()=>{Ce(new Set),ke(new Set);const ue=R.current;ue&&Q(ue.fromId,ue.toId)},yt.errorMs)},yt.moveMs)};return aa.current=window.setTimeout(()=>{const t=k();t&&Q(He.current,t)},yt.pauseMs),()=>{aa.current&&window.clearTimeout(aa.current)}},[n,l,se,u]);const _e=j=>{if(!l)return;const k=Date.now();k-s.current<520||Math.abs(j.deltaY)<10||(s.current=k,j.deltaY>0?g():w(),j.preventDefault())},Be=j=>{if(!l)return;const k=j.touches[0];k&&(m.current={x:k.clientX,y:k.clientY})},Ve=j=>{if(!l)return;const k=m.current;if(m.current=null,!k)return;const Q=j.changedTouches[0];if(!Q)return;const t=Q.clientX-k.x,r=Q.clientY-k.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?g():w())};return e.jsxs("div",{className:`cogita-intro ${l?"is-open":"is-closed"} ${u?"is-reduced":""} ${o?"is-final":""}`,"data-slide":n+1,onWheel:_e,onTouchStart:Be,onTouchEnd:Ve,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":C,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${z&&!x?"is-entry":""}`,children:q.map((j,k)=>e.jsx("img",{src:j.src,alt:"",className:`cogita-logo-layer ${k===0?"is-base":""} ${j.kind==="text"?"is-text":j.kind==="recreatio"?"is-recreatio":""} ${j.kind==="bubble"?"is-bubble":""}`},j.src))})}),l&&a.map((j,k)=>{const Q=k===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${k+1} ${Q?"is-active":""}`,"aria-hidden":!Q,children:[e.jsxs("div",{className:"cogita-intro-text",children:[j.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:j.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:j.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:j.title}),j.body&&e.jsx("p",{children:j.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),j.micro&&e.jsx("p",{className:"cogita-intro-micro",children:j.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:o?F:g,children:j.cta}),o&&j.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>p(0),children:j.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[k===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${vt.width} ${vt.height}`,preserveAspectRatio:"none",children:[se.links.map(t=>{const r=se.nodesById.get(t.from),h=se.nodesById.get(t.to);if(!r||!h)return null;const T=Fe.has(t.key),D=$e.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${D?"is-error":""}`,x1:r.x,y1:r.y,x2:h.x,y2:h.y},t.key)}),se.nodes.map(t=>{const r=ie.has(t.id),h=Re.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${h?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Te&&e.jsx("span",{className:"map-explorer-dot",style:{left:pe,top:Ee,"--move":`${yt.moveMs}ms`}})]}),k===2&&e.jsx("div",{className:"cogita-index-cards",children:E.map(t=>{const r=I.indexOf(t.id),h=r>=0?ne[r]:null,T=(h==null?void 0:h.x)??"140px",D=(h==null?void 0:h.y)??"140px",ae=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":D,"--stack-opacity":ae,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),k===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[de.map((t,r)=>e.jsxs("div",{className:`round-card ${r===le?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),de[le]&&e.jsx("span",{className:"round-ring",style:{"--card-x":de[le].x,"--card-y":`calc(${de[le].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:me.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Ne.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:me.map((t,r)=>{const h=re[r]??"good",T=de[le];if(!T)return null;const D=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":D,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${h}`,style:{"--from-x":T.x,"--from-y":D,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${h}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${ge}`)})})]},`round-${ge}`),k===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${f[0].x} ${f[0].y} L${f[1].x} ${f[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${f[1].x} ${f[1].y} L${f[2].x} ${f[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${f[2].x} ${f[2].y} L${f[3].x} ${f[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${f[3].x} ${f[3].y} L${f[4].x} ${f[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${f[4].x} ${f[4].y} L${f[5].x} ${f[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${f[5].x} ${f[5].y} L${f[6].x} ${f[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${O};${O};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${he.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${he.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${he.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${he.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[y.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${y.higher[r+1].x} ${y.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),y.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${y.lower[r+1].x} ${y.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${f[0].x/300*100}%`,"--p0y":`${f[0].y/200*100}%`,"--p1x":`${f[1].x/300*100}%`,"--p1y":`${f[1].y/200*100}%`,"--p2x":`${f[2].x/300*100}%`,"--p2y":`${f[2].y/200*100}%`,"--p3x":`${f[3].x/300*100}%`,"--p3y":`${f[3].y/200*100}%`,"--p4x":`${f[4].x/300*100}%`,"--p4y":`${f[4].y/200*100}%`,"--p5x":`${f[5].x/300*100}%`,"--p5y":`${f[5].y/200*100}%`,"--p6x":`${f[6].x/300*100}%`,"--p6y":`${f[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${y.higher[0].x/300*100}%`,"--q0y":`${y.higher[0].y/200*100}%`,"--q1x":`${y.higher[1].x/300*100}%`,"--q1y":`${y.higher[1].y/200*100}%`,"--q2x":`${y.higher[2].x/300*100}%`,"--q2y":`${y.higher[2].y/200*100}%`,"--q3x":`${y.higher[3].x/300*100}%`,"--q3y":`${y.higher[3].y/200*100}%`,"--q4x":`${y.higher[4].x/300*100}%`,"--q4y":`${y.higher[4].y/200*100}%`,"--q5x":`${y.higher[5].x/300*100}%`,"--q5y":`${y.higher[5].y/200*100}%`,"--q6x":`${y.higher[6].x/300*100}%`,"--q6y":`${y.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${y.lower[0].x/300*100}%`,"--q0y":`${y.lower[0].y/200*100}%`,"--q1x":`${y.lower[1].x/300*100}%`,"--q1y":`${y.lower[1].y/200*100}%`,"--q2x":`${y.lower[2].x/300*100}%`,"--q2y":`${y.lower[2].y/200*100}%`,"--q3x":`${y.lower[3].x/300*100}%`,"--q3y":`${y.lower[3].y/200*100}%`,"--q4x":`${y.lower[4].x/300*100}%`,"--q4y":`${y.lower[4].y/200*100}%`,"--q5x":`${y.lower[5].x/300*100}%`,"--q5y":`${y.lower[5].y/200*100}%`,"--q6x":`${y.lower[6].x/300*100}%`,"--q6y":`${y.lower[6].y/200*100}%`}})]})})}),k===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),k===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},j.id)}),!l&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:b.title}),b.body&&e.jsx("p",{children:b.body}),b.micro&&e.jsx("p",{className:"cogita-intro-micro",children:b.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:F,children:b.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:M,children:"Otwórz pokaz"})]})]})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((j,k)=>e.jsx("button",{type:"button",className:`dot ${n===k?"active":""}`,"aria-label":j.title,onClick:()=>p(k)},j.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:P,children:"Pomiń"})]})]})}const zi=6,Hi=4;function Ji({copy:a,onAuthAction:n,authLabel:l,showProfileMenu:u,onProfileNavigate:g,onToggleSecureMode:w,onLogout:p,secureMode:P,onNavigate:M,language:F,onLanguageChange:o}){const C=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}M("home")},b=i.useRef(null),x=i.useRef([]),W=i.useMemo(()=>{let ee=Date.now()%2147483647;const _=()=>(ee=ee*48271%2147483647,ee/2147483647);return Array.from({length:zi},(Ne,se)=>{const ie=6+_()*8,Le=7+_()*10,Re=6+_()*9,Ce=-_()*ie,$e=-_()*Le,ke=-_()*Re,Qe=.18+_()*.28,Oe=12+_()*18,Ae=4+_()*8,He=(_()-.5)*3.2,ia=(_()-.5)*3.8,aa=_()>.5?"alternate":"alternate-reverse",R=_()>.5?"alternate":"alternate-reverse",X=_()>.5?"alternate":"alternate-reverse",Fe=.18+_()*.42,Te=30+_()*60,pe=-45-_()*38,Ee=188+_()*32,_e=.1+_()*.2;return{id:`wave-${se+1}`,style:{"--wave-sway-duration":`${ie}s`,"--wave-scale-duration":`${Le}s`,"--wave-drift-duration":`${Re}s`,"--wave-sway-delay":`${Ce}s`,"--wave-scale-delay":`${$e}s`,"--wave-drift-delay":`${ke}s`,"--wave-sway-dir":aa,"--wave-scale-dir":R,"--wave-drift-dir":X,"--wave-scale":`${Qe}`,"--wave-shift":`${Oe}%`,"--wave-xshift":`${Ae}%`,"--wave-x0":`${He}%`,"--wave-y0":`${ia}%`,"--wave-opacity":`${Fe}`,"--wave-blur":`${Te}px`,"--wave-bottom":`${pe}%`,"--wave-hue":`${Ee}`,"--wave-glow":`${_e}`}}})},[]),q=i.useMemo(()=>{let ee=Date.now()*3%2147483647;const _=()=>(ee=ee*48271%2147483647,ee/2147483647);return Array.from({length:Hi},(Ne,se)=>{const ie=180+_()*220,Le=220+_()*280,Re=-_()*ie,Ce=-_()*Le,$e=.12+_()*.22,ke=3+_()*7,Qe=1+_()*3,Oe=(_()-.5)*2.8,Ae=(_()-.5)*2.2;return{id:`mesh-${se+1}`,seed:1e3+se*991+Math.floor(_()*999),style:{"--mesh-sway-duration":`${ie}s`,"--mesh-drift-duration":`${Le}s`,"--mesh-sway-delay":`${Re}s`,"--mesh-drift-delay":`${Ce}s`,"--mesh-scale":`${$e}`,"--mesh-shift":`${ke}%`,"--mesh-xshift":`${Qe}%`,"--mesh-x0":`${Ae}%`,"--mesh-y0":`${Oe}%`}}})},[]),z=i.useMemo(()=>{const ee=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],_=a.cogita.introSlides,Ne=new Map(_.map(se=>[se.id,se]));return ee.map(se=>{var Le;const ie=Ne.get(se.id);return{...se,...ie,title:(ie==null?void 0:ie.title)??"Cogita",cta:(ie==null?void 0:ie.cta)??((Le=a.cogita.introSlides[0])==null?void 0:Le.cta)??a.cogita.loginCta,secondary:ie==null?void 0:ie.secondary}})},[a.cogita.introSlides]),[s,m]=i.useState(0),[f,he]=i.useState(!0),[O,y]=i.useState(!1),B=z.length-1,E=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ne=i.useCallback(()=>{E(),n()},[E,n]),I=i.useCallback(()=>{he(!0),m(0)},[]),U=i.useCallback(()=>{he(!1),m(B)},[B]),de=i.useCallback(ee=>{m(Math.max(0,Math.min(B,ee)))},[B]),me=i.useCallback(()=>{s>=B?ne():de(s+1)},[s,de,ne,B]),ge=i.useCallback(()=>{de(s-1)},[s,de]);i.useEffect(()=>{var Ne;const ee=(Ne=window.matchMedia)==null?void 0:Ne.call(window,"(prefers-reduced-motion: reduce)");if(!ee)return;const _=()=>y(ee.matches);return _(),ee.addEventListener?(ee.addEventListener("change",_),()=>ee.removeEventListener("change",_)):(ee.addListener(_),()=>ee.removeListener(_))},[]),i.useEffect(()=>{if(!f)return;const ee=_=>{const Ne=_.target;if(!Ne)return;const se=Ne.tagName;if(!(Ne.isContentEditable||se==="INPUT"||se==="TEXTAREA"||se==="SELECT"||se==="BUTTON"||se==="A"||Ne.closest('button, a, [role="button"], [role="link"]'))){if(_.key==="Escape"){U();return}if(_.key==="ArrowLeft"||_.key==="ArrowUp"){ge();return}(_.key==="ArrowRight"||_.key==="ArrowDown"||_.code==="Space"||_.key===" ")&&(_.preventDefault(),me())}};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[U,me,ge,f]),i.useEffect(()=>{f&&s===B&&E()},[s,f,B,E]),i.useEffect(()=>{const ee=b.current;if(!ee)return;const _=x.current.filter(pe=>!!pe);if(!_.length)return;const Ne=1,se=.6,ie=.6,Le=Math.max(1,Math.min(Ne,window.devicePixelRatio||1));let Re=0,Ce=0,$e=se,ke=0,Qe=0;const Oe=pe=>{let Ee=pe%2147483647;return Ee<=0&&(Ee+=2147483646),(_e,Be)=>{Ee=Ee*48271%2147483647;const Ve=Ee/2147483647;return _e+Ve*(Be-_e)}},Ae={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},He=pe=>{const Ee=Math.sin(pe*12.9898)*43758.5453;return Ee-Math.floor(Ee)},ia=pe=>{const Ee=He(pe+.1)||1e-4,_e=He(pe+.7)||1e-4;return Math.sqrt(-2*Math.log(Ee))*Math.cos(2*Math.PI*_e)},aa=(pe,Ee)=>{const _e=Math.floor(pe),Be=_e+1,Ve=pe-_e,j=Ve*Ve*(3-2*Ve),k=He(_e*12.9898+Ee*78.233),Q=He(Be*12.9898+Ee*78.233);return k+(Q-k)*j},R=pe=>{const Ee=Oe(pe),_e=Math.min(4,Math.max(4,Math.floor(Re/1200*Ae.filamentCount)));return Array.from({length:_e},(Be,Ve)=>{const j=Math.max(-1,Math.min(1,ia(pe+Ve*.37))),k=Math.min(1,Math.max(0,He(pe+Ve*1.31))),Q=Math.min(Ae.depthLayers-1,Math.floor(k*Ae.depthLayers));return{seed:Ee(0,Math.PI*2)+pe*.01,offset:j,freqA:Ae.freq1*(.75+Ee(0,.5)),freqB:Ae.freq2*(.75+Ee(0,.5)),ampA:Ae.amp1*(.6+Ee(0,.7)),ampB:Ae.amp2*(.6+Ee(0,.7)),width:2+Ve%5*.32,depth:k,layer:Q}})},X=(pe,Ee,_e)=>{const Be=Math.max(30,Math.floor(Re*Ce/14e4));pe.save(),pe.globalAlpha=.6;for(let Ve=0;Ve<Be;Ve+=1){const j=He(Ve*9.1+Re*.11)*Ee+_e,k=He(Ve*3.7+Ce*.23)*Ce,Q=1.2+He(Ve*5.9)*2.4,t=pe.createRadialGradient(j,k,0,j,k,Q*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),pe.fillStyle=t,pe.beginPath(),pe.arc(j,k,Q*2,0,Math.PI*2),pe.fill()}pe.restore()},Fe=(pe,Ee)=>{pe.clearRect(0,0,Re,Ce);const _e=Ce*Ae.waveCenter,Be=Ae.waveBandPx,Ve=Ae.segments,j=Ae.colors.filaments,k=ke||Re,Q=0;X(pe,k,Q),pe.strokeStyle=j,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<Ee.length;t+=1){const r=Ee[t],h=r.offset*Be*(.85+He(r.seed)*.4),T=1-Math.min(1,Math.abs(h)/Be),D=Math.exp(-Math.pow(h/Ae.crestThickness,2)),ae=r.layer===0?1.1:r.layer===1?.85:.6,te=.35+(1-r.depth)*.65,G=T*te*ae*(.34+D*.45);pe.globalAlpha=G,pe.lineWidth=r.width*(1+(1-r.depth)*.8);const ue=[];for(let we=0;we<=Ve;we+=1){const ea=we/Ve*k+Q,qe=(aa(ea*.012,r.seed)-.5)*Ae.xJitter,ta=ea+qe,De=(aa(ta*r.freqA,r.seed)-.5)*Ae.jitterA,Ue=(aa(ta*r.freqB,r.seed*1.7)-.5)*Ae.jitterB,Ke=_e+Math.sin(ta*r.freqA+r.seed)*r.ampA+Math.sin(ta*r.freqB+r.seed*1.3)*r.ampB+h+De+Ue;ue.push({x:ta,y:Ke})}pe.beginPath(),pe.moveTo(ue[0].x,ue[0].y);for(let we=1;we<ue.length-1;we+=1){const ea=(ue[we].x+ue[we+1].x)/2,qe=(ue[we].y+ue[we+1].y)/2;pe.quadraticCurveTo(ue[we].x,ue[we].y,ea,qe)}const oe=ue[ue.length-1];pe.quadraticCurveTo(oe.x,oe.y,oe.x,oe.y),pe.stroke()}pe.save(),pe.globalCompositeOperation="lighter",pe.strokeStyle=Ae.colors.glow,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<Ee.length;t+=1){const r=Ee[t];if(Math.abs(r.offset)*Be>Ae.crestThickness)continue;const h=Ae.glowAlpha*(.7+(1-r.depth)*.6);pe.globalAlpha=h,pe.lineWidth=1.6+(1-r.depth)*1.2;const T=[];for(let ae=0;ae<=Ve;ae+=1){const te=ae/Ve*k+Q,G=Math.sin(te*.02+r.seed)*3,ue=_e+Math.sin(te*r.freqA+r.seed)*r.ampA+Math.sin(te*r.freqB+r.seed*1.3)*r.ampB+r.offset*Be*.35+G;T.push({x:te,y:ue})}pe.beginPath(),pe.moveTo(T[0].x,T[0].y);for(let ae=1;ae<T.length-1;ae+=1){const te=(T[ae].x+T[ae+1].x)/2,G=(T[ae].y+T[ae+1].y)/2;pe.quadraticCurveTo(T[ae].x,T[ae].y,te,G)}const D=T[T.length-1];pe.quadraticCurveTo(D.x,D.y,D.x,D.y),pe.stroke()}pe.restore()},Te=()=>{Re=Math.floor(ee.clientWidth),Ce=Math.floor(ee.clientHeight),ke=Math.floor(Re*1.8),Qe=Ce,$e=Re<820?ie:se,_.forEach(pe=>{const Ee=pe.getContext("2d");if(!Ee)return;pe.width=Math.floor(ke*Le*$e),pe.height=Math.floor(Qe*Le*$e),pe.style.width=`${ke}px`,pe.style.height=`${Qe}px`,pe.style.left=`${-(ke-Re)/2}px`,Ee.setTransform(Le*$e,0,0,Le*$e,0,0);const _e=Number(pe.dataset.seed||1),Be=R(_e);Fe(Ee,Be)})};return Te(),window.addEventListener("resize",Te,{passive:!0}),()=>window.removeEventListener("resize",Te)},[q]);const K=z[Math.min(s,z.length-1)],le=f?K:z[z.length-1],d=(le==null?void 0:le.theme)??z[0].theme,re={"--cogita-bg0":d.bg0,"--cogita-bg1":d.bg1,"--cogita-bg2":d.bg2,"--cogita-bloom":d.bloom,"--cogita-sat":d.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:C,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(_r,{value:F,onChange:o}),e.jsx(Ur,{copy:a,label:l,isAuthenticated:u,secureMode:P,onLogin:n,onProfileNavigate:g,onToggleSecureMode:w,onLogout:p,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:b,className:"cogita-section cogita-home",style:re,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[q.map((ee,_)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:ee.style,"data-seed":ee.seed,ref:Ne=>{x.current[_]=Ne}},ee.id)),W.map(ee=>e.jsx("div",{className:"cogita-home-wave",style:ee.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},ee.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Wi,{slides:z,activeIndex:s,introOpen:f,prefersReducedMotion:O,onNext:me,onPrev:ge,onSelect:de,onExit:U,onOpen:I,onRegister:ne})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Ji},Symbol.toStringTag,{value:"Module"})),Qr=i.createContext(!1);function Ca({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:o}){if(i.useContext(Qr))return e.jsx(e.Fragment,{children:o});const b=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}P("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:b,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(_r,{value:M,onChange:F}),e.jsx(Ur,{copy:a,label:n,isAuthenticated:l,secureMode:p,onLogin:()=>P("home"),onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:o}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function qa(a){const[n,l]=i.useState("Cogita library"),[u,g]=i.useState(null);return i.useEffect(()=>{let w=!1;return Wr().then(p=>{if(w)return;const P=p.find(M=>M.libraryId===a);P&&l(P.name)}).catch(()=>{w||l("Cogita library")}),()=>{w=!0}},[a]),i.useEffect(()=>{let w=!1;return hi(a).then(p=>{w||g(p)}).catch(()=>{w||g(null)}),()=>{w=!0}},[a]),{libraryName:n,stats:u}}function Ir({slices:a}){const n=a.reduce((u,g)=>u+Math.max(0,g.value),0),l=i.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let u=0;return`conic-gradient(${a.map(w=>{const P=Math.max(0,w.value)/n*360,M=u,F=u+P;return u=F,`${w.color} ${M}deg ${F}deg`}).join(",")})`},[a,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:l}}),e.jsx("div",{className:"cogita-overview-legend",children:a.map(u=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:u.color}}),e.jsx("strong",{children:u.value}),e.jsx("small",{children:u.label})]},u.label))})]})}function Yi({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o}){const{libraryName:C,stats:b}=qa(o),[x,W]=i.useState("infos"),[q,z]=i.useState(0),[s,m]=i.useState(0),[f,he]=i.useState(0),O=(b==null?void 0:b.totalInfos)??0,y=(b==null?void 0:b.totalCollections)??0,B=0,E=0,ne=0,I=Math.max(0,O-ne-s),U=Math.max(0,O-s-f);i.useEffect(()=>{let me=!1;return(async()=>{try{const K=await jt({libraryId:o,limit:200}),le=await Promise.all(K.items.map(d=>zr({libraryId:o,collectionId:d.collectionId}).catch(()=>[])));if(me)return;z(le.reduce((d,re)=>d+re.length,0))}catch{me||z(0)}})(),()=>{me=!0}},[o]),i.useEffect(()=>{let me=!1;return(async()=>{try{const[K,le,d]=await Promise.all([$t({libraryId:o,type:"computed",limit:1}).catch(()=>({total:0})),$t({libraryId:o,type:"source",limit:1}).catch(()=>({total:0})),Hr({libraryId:o}).catch(()=>({items:[]}))]);if(me)return;m((K.total??0)+(le.total??0));const re=new Set(d.items.filter(ee=>ee.childItemType.toLowerCase()==="info").map(ee=>ee.childItemId).filter(Boolean));he(re.size)}catch{me||(m(0),he(0))}})(),()=>{me=!0}},[o]);const de=[{key:"infos",label:a.cogita.library.overview.stats.totalInfos,value:O},{key:"collections",label:a.cogita.library.overview.stats.collections,value:y},{key:"revisions",label:a.cogita.library.overview.stats.revisions,value:q},{key:"storyboards",label:a.cogita.library.overview.stats.storyboards,value:B},{key:"texts",label:a.cogita.library.overview.stats.texts,value:E}];return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:C})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:de.map(me=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${x===me.key?"active":""}`,onClick:()=>W(me.key),children:[e.jsx("span",{children:me.label}),e.jsx("strong",{children:me.value})]},me.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:a.cogita.library.overview.statsCardTitle})}),x==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.knownChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.known,value:ne,color:"#75d79a"},{label:a.cogita.library.overview.unknown,value:I,color:"#85b9ff"},{label:a.cogita.library.overview.excluded,value:s,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.checksChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.availableChecks,value:f,color:"#75d79a"},{label:a.cogita.library.overview.unavailableChecks,value:U,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:a.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]})]})})]})})}const fe=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ka=(a,n,l,u)=>`${a}:${n}:${l??""}:${u??""}`,Ze=(a,n)=>{const l=a.cogita.library.infoTypes;return{any:l.any,vocab:l.vocab,language:l.language,word:l.word,sentence:l.sentence,topic:l.topic,collection:l.collection,person:l.person,institution:l.institution,collective:l.collective,orcid:l.orcid,address:l.address,email:l.email,phone:l.phone,media:l.media,work:l.work,geo:l.geo,music_piece:l.musicPiece,music_fragment:l.musicFragment,source:l.source,quote:l.quote,computed:l.computed}[n]??String(n)},Gr=a=>[{value:"any",label:Ze(a,"any")},{value:"language",label:Ze(a,"language")},{value:"word",label:Ze(a,"word")},{value:"sentence",label:Ze(a,"sentence")},{value:"topic",label:Ze(a,"topic")},{value:"collection",label:Ze(a,"collection")},{value:"person",label:Ze(a,"person")},{value:"institution",label:Ze(a,"institution")},{value:"collective",label:Ze(a,"collective")},{value:"orcid",label:Ze(a,"orcid")},{value:"address",label:Ze(a,"address")},{value:"email",label:Ze(a,"email")},{value:"phone",label:Ze(a,"phone")},{value:"media",label:Ze(a,"media")},{value:"work",label:Ze(a,"work")},{value:"geo",label:Ze(a,"geo")},{value:"music_piece",label:Ze(a,"music_piece")},{value:"music_fragment",label:Ze(a,"music_fragment")},{value:"source",label:Ze(a,"source")},{value:"quote",label:Ze(a,"quote")},{value:"computed",label:Ze(a,"computed")}],Qi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Gi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],Xi=a=>[{value:"any",label:Ze(a,"any")},{value:"vocab",label:Ze(a,"vocab")},...Gr(a).filter(n=>n.value!=="any")],Za=5,Pr=50,Rr=2,$r=[];function ze({libraryId:a,infoType:n,label:l,placeholder:u,value:g,onChange:w,values:p,onChangeMultiple:P,helperText:M,searchFailedText:F,createFailedText:o,createLabel:C,savingLabel:b,loadMoreLabel:x,inputRef:W,autoAdvance:q,onCommit:z,multiple:s}){const m=s?p??$r:$r,[f,he]=i.useState(s?"":(g==null?void 0:g.label)??""),[O,y]=i.useState([]),[B,E]=i.useState(Za),[ne,I]=i.useState(-1),[U,de]=i.useState(!1),[me,ge]=i.useState(!1),[K,le]=i.useState(null),d=i.useRef(0),re=i.useRef(new Map),ee=i.useMemo(()=>s?f.trim().length>0:f.trim().length>0&&!g,[f,g,s]);i.useEffect(()=>{s||he((g==null?void 0:g.label)??"")},[g,s]),i.useEffect(()=>{const se=f.trim();if(!se||se.length<Rr){y([]),de(!1),E(Za),I(-1),ge(!1),le(null);return}const ie=se.toLowerCase(),Le=`${a}:${n}:${ie}`,Re=re.current.get(Le);if(Re){if(s&&m.length>0){const $e=new Set(m.map(ke=>ke.id));y(Re.filter(ke=>!$e.has(ke.id)))}else y(Re);E(Za),I(-1),de(Re.length>0),ge(!1),le(null);return}const Ce=window.setTimeout(async()=>{const $e=Date.now();d.current=$e,ge(!0),le(null);try{const ke=await jr({libraryId:a,type:n,query:se,limit:Pr});if(d.current!==$e)return;const Qe=ke.slice(0,Pr).map(Oe=>({id:Oe.infoId,label:Oe.label,infoType:Oe.infoType}));if(re.current.set(Le,Qe),s&&m.length>0){const Oe=new Set(m.map(Ae=>Ae.id));y(Qe.filter(Ae=>!Oe.has(Ae.id)))}else y(Qe);E(Za),I(-1),de(!0)}catch{if(d.current!==$e)return;le(F??"Search failed.")}finally{d.current===$e&&ge(!1)}},250);return()=>window.clearTimeout(Ce)},[a,n,f,m]);const _=se=>{if(s){const ie=m.some(Le=>Le.id===se.id)?m:[...m,se];P==null||P(ie),he(""),de(!1),I(-1);return}w==null||w(se),he(se.label),de(!1),I(-1),q&&(z==null||z())},Ne=async()=>{const se=f.trim();if(se){ge(!0),le(null);try{const ie=await et({libraryId:a,infoType:n,payload:{label:se}}),Le={id:ie.infoId,label:se,infoType:ie.infoType};if(se.length>=Rr){const Re=`${a}:${n}:${se.toLowerCase()}`,Ce=re.current.get(Re)??[];re.current.set(Re,[Le,...Ce])}if(s){P==null||P([...m,Le]),he(""),de(!1),I(-1);return}w==null||w(Le),de(!1),I(-1),q&&(z==null||z())}catch{le(o??"Create failed.")}finally{ge(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:l}),e.jsx("input",{value:f,placeholder:u,onChange:se=>{he(se.target.value),!s&&g&&(w==null||w(null))},onKeyDown:se=>{if(se.key==="ArrowDown"){if(se.preventDefault(),!O.length)return;de(!0),I(ie=>{const Le=Math.min(O.length,B)-1,Re=ie<0?0:Math.min(ie+1,Le);return Re===Le&&O.length>B?(E(Ce=>Math.min(Ce+Za,O.length)),Math.min(ie+1,Math.min(O.length,B+Za)-1)):Re});return}if(se.key==="ArrowUp"){if(se.preventDefault(),!O.length)return;de(!0),I(ie=>ie<=0?0:ie-1);return}if(se.key==="Enter"){if(se.preventDefault(),ne>=0&&O[ne]){_(O[ne]);return}if(ee){Ne();return}}},onFocus:()=>{O.length>0&&de(!0)},autoComplete:"off",ref:W})]}),s&&m.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:m.map(se=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>P==null?void 0:P(m.filter(ie=>ie.id!==se.id)),children:[se.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},se.id))}),M&&e.jsx("p",{className:"cogita-help",children:M}),K&&e.jsx("p",{className:"cogita-error",children:K}),U&&O.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[O.slice(0,B).map((se,ie)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":ie===ne,onClick:()=>_(se),children:[e.jsx("strong",{children:se.label}),e.jsx("span",{children:se.infoType})]},se.id)),B<O.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>E(se=>Math.min(se+Za,O.length)),children:x??"Load more"})]}),ee&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Ne,disabled:me,children:me?b??"Saving...":C??`Create new ${n}`})]})}function Zi({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o,mode:C}){const b=Or(),{libraryName:x}=qa(o),W=`/#/cogita/library/${o}`,[q,z]=i.useState("any"),[s,m]=i.useState(""),[f,he]=i.useState([]),[O,y]=i.useState("idle"),[B,E]=i.useState(null),[ne,I]=i.useState(null),[U,de]=i.useState("idle"),[me,ge]=i.useState(0),[K,le]=i.useState(null),[d,re]=i.useState("idle"),[ee,_]=i.useState(null),[Ne,se]=i.useState(null),[ie,Le]=i.useState(null),[Re,Ce]=i.useState(null),$e=i.useMemo(()=>({languageAId:(ee==null?void 0:ee.id)??void 0,languageBId:(Ne==null?void 0:Ne.id)??void 0,topicId:(ie==null?void 0:ie.id)??void 0,levelId:(Re==null?void 0:Re.id)??void 0}),[ee,Ne,ie,Re]),ke=i.useMemo(()=>q==="vocab"||q==="any",[q]);i.useEffect(()=>{y("loading");const R=window.setTimeout(()=>{$t({libraryId:o,type:q==="any"?void 0:q,query:s.trim()||void 0,limit:30,languageAId:ke?$e.languageAId:void 0,languageBId:ke?$e.languageBId:void 0,topicId:ke?$e.topicId:void 0,levelId:ke?$e.levelId:void 0}).then(X=>{he(X.items),ge(X.total),le(X.nextCursor??null),y("ready"),E(X.items[0]??null)}).catch(()=>{he([]),ge(0),le(null),y("ready")})},240);return()=>window.clearTimeout(R)},[o,s,q,ke,$e]),i.useEffect(()=>{if(!B||B.cardType!=="info"||B.infoType!=="computed"){I(null),de("idle"),re("idle");return}de("loading"),hr({libraryId:o,infoId:B.cardId}).then(R=>{I(R),de("ready")}).catch(()=>{I(null),de("ready")})},[o,B]);const Qe=async()=>{if(K){y("loading");try{const R=await $t({libraryId:o,type:q==="any"?void 0:q,query:s.trim()||void 0,limit:30,cursor:K,languageAId:ke?$e.languageAId:void 0,languageBId:ke?$e.languageBId:void 0,topicId:ke?$e.topicId:void 0,levelId:ke?$e.levelId:void 0});he(X=>[...X,...R.items]),le(R.nextCursor??null),ge(R.total),y("ready")}catch{y("ready")}}},Oe=async()=>{if(!(!B||B.cardType!=="connection"&&B.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){re("loading");try{await bi({libraryId:o,connectionId:B.cardId});let X=null;he(Fe=>{const Te=Fe.filter(pe=>pe.cardId!==B.cardId);return X=Te[0]??null,Te}),ge(Fe=>Math.max(0,Fe-(B.cardType==="vocab"?3:1))),E(Fe=>Fe&&Fe.cardId===B.cardId?X:Fe),re("idle")}catch{re("error")}}},Ae=i.useMemo(()=>C==="collection"?"grid":C==="list"?"list":"detail",[C]),He=B?fe(B):null,ia=i.useMemo(()=>Xi(a),[a]),aa=i.useMemo(()=>{const R=me||f.length;return a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(R))},[a,f.length,me]);return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Ae,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:W,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${W}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${W}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(R=>e.jsx("a",{className:"ghost","data-active":C===R,href:`${W}/${R}`,children:R==="detail"?a.cogita.library.list.modes.detail:R==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},R))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:q,onChange:R=>z(R.target.value),children:ia.map(R=>e.jsx("option",{value:R.value,children:R.label},R.value))}),e.jsx("input",{type:"text",value:s,onChange:R=>m(R.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(q==="vocab"||q==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:ee,onChange:_,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:Ne,onChange:se,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:ie,onChange:Le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:Re,onChange:Ce,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(ee||Ne||ie||Re)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{_(null),se(null),Le(null),Ce(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:aa}),e.jsx("span",{children:O==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":C==="collection"?"grid":"list",children:f.length?f.map(R=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":He===fe(R),onClick:()=>{E(R),R.cardType==="info"&&b(`/cogita/library/${o}/edit/${R.cardId}`)},children:[e.jsx("div",{className:"cogita-card-type",children:R.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:R.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:R.label}),e.jsx("p",{className:"cogita-card-subtitle",children:R.description})]},fe(R))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${W}/new`,children:a.cogita.library.list.addInfo})]})}),K?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Qe,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(B==null?void 0:B.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(B==null?void 0:B.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${W}/edit/${B.cardId}`,children:a.cogita.library.list.editInfo}):null,(B==null?void 0:B.cardType)==="connection"||(B==null?void 0:B.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:Oe,disabled:d==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${W}/new`,children:a.cogita.library.actions.addInfo})]})]}),B?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:B.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:B.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),d==="error"&&(B.cardType==="connection"||B.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,B.cardType==="info"&&B.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),U==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),U!=="loading"&&ne?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(Et,{value:ne.prompt,mode:"auto"}),ne.expectedAnswers&&Object.keys(ne.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(ne.expectedAnswers).map(([R,X])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:R}),e.jsx(br,{value:X,mode:"auto"})]},R))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(br,{value:ne.expectedAnswer,mode:"auto"})]})]}):U!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Ft=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Er=8;function Ar({libraryId:a,copy:n,language:l,sourceKindOptions:u,value:g,onChange:w,labels:p}){const[P,M]=i.useState(!1),[F,o]=i.useState(-1),C=i.useMemo(()=>{const q=l;return Ft.map(z=>{var f;const s=(z==null?void 0:z[q])??(z==null?void 0:z.en)??(z==null?void 0:z.la);return{label:`${s.abbr} — ${s.name}`,latin:((f=z==null?void 0:z.la)==null?void 0:f.abbr)??s.abbr}})},[l]),b=(q,z=!1)=>{const s=q.trim().toLowerCase();return s?C.filter(m=>m.label.toLowerCase().includes(s)).slice(0,Er):z?C.slice(0,Er):[]},x=(q,z)=>{const s=q.trim().toLowerCase();if(!s)return null;const m=Ft;for(const f of m){const he=f==null?void 0:f.la,O=(f==null?void 0:f[z])??(f==null?void 0:f.en)??he,y=(O==null?void 0:O.abbr)??"",B=(O==null?void 0:O.name)??"";if(y.toLowerCase()===s||B.toLowerCase()===s||`${y} — ${B}`.toLowerCase()===s)return{book:f,entry:O,la:he}}return null};i.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!P){const q=x(g.locatorValue,l);if(q){const z=`${q.entry.abbr} — ${q.entry.name}`;z!==g.bibleBookDisplay&&w({...g,bibleBookDisplay:z})}}},[l,g,P,w]);const W=q=>w({...g,...q});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:q=>W({sourceKind:q.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:u.map(q=>e.jsx("option",{value:q.value,children:q.label},q.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:q=>{const z=q.target.value;W({bibleBookDisplay:z,locatorValue:""}),M(!0),o(-1)},onKeyDown:q=>{var s;const z=b(g.bibleBookDisplay);if(z.length){if(q.key==="ArrowDown")q.preventDefault(),o(m=>Math.min(m+1,z.length-1));else if(q.key==="ArrowUp")q.preventDefault(),o(m=>Math.max(m-1,0));else if((q.key==="Enter"||q.key==="Tab")&&F>=0&&z[F]){const m=z[F],f=x(m.label,l);if(!f)return;W({bibleBookDisplay:m.label,locatorValue:((s=f.la)==null?void 0:s.abbr)??g.locatorValue}),M(!1)}}},onFocus:()=>M(!0),onBlur:()=>window.setTimeout(()=>M(!1),100),placeholder:p.bibleBookPlaceholder})]}),P&&b(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:b(g.bibleBookDisplay,!0).map((q,z)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":z===F,tabIndex:-1,onMouseDown:()=>{var m;const s=x(q.label,l);s&&W({bibleBookDisplay:q.label,locatorValue:((m=s.la)==null?void 0:m.abbr)??g.locatorValue})},children:e.jsx("strong",{children:q.label})},q.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:q=>W({locatorAux:q.target.value}),placeholder:p.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:q=>W({sourceUrl:q.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:q=>W({sourceAccessedDate:q.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:a,infoType:"work",label:p.churchDocumentLabel,placeholder:p.churchDocumentPlaceholder,value:g.churchDocument,onChange:q=>W({churchDocument:q}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:q=>W({locatorValue:q.target.value}),placeholder:p.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(ze,{libraryId:a,infoType:"work",label:p.workLabel,placeholder:p.workPlaceholder,value:g.work,onChange:q=>W({work:q}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:a,infoType:"media",label:p.bookLabel,placeholder:p.bookPlaceholder,value:g.bookMedia,onChange:q=>W({bookMedia:q}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:q=>W({locatorValue:q.target.value}),placeholder:p.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:q=>W({locatorValue:q.target.value}),placeholder:p.locatorPlaceholder})]})]})}const en=[],an=[];function tn({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),l=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),u=a.handles.length,g=u>1?(u-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),l?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((w,p)=>e.jsx(Cr,{type:"target",id:w.id,position:Mr.Left,style:{top:46+p*28},children:w.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:w.label}):null},w.id)),a.output!==!1?e.jsx(Cr,{type:"source",id:"out",position:Mr.Right}):null]})}function rn({copy:a,value:n,onChange:l}){var Oe,Ae,He,ia,aa,R,X,Fe,Te,pe,Ee,_e,Be,Ve;const u=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=j=>!j||j.nodes.length===0?en:j.nodes.map((k,Q)=>{var t,r,h,T;return{id:k.id,type:"computed",position:k.position??{x:40+Q*160,y:60+Q%3*80},data:{title:k.name||((t=u[k.type])==null?void 0:t.label)||k.type,subtitle:((r=u[k.type])==null?void 0:r.label)||k.type,type:k.type,name:k.name,outputLabel:k.outputLabel,min:k.min,max:k.max,value:k.type==="input.const"?k.value:void 0,list:k.list,handles:((h=u[k.type])==null?void 0:h.handles)??[],output:((T=u[k.type])==null?void 0:T.output)??!0}}}),w=j=>{if(!j||j.nodes.length===0)return an;const k=new Set(j.nodes.map(r=>r.id)),Q=[];let t=0;return j.nodes.forEach(r=>{const h=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(h).forEach(([T,D])=>{D.forEach(ae=>{k.has(ae)&&Q.push({id:`${r.id}-${T}-${ae}-${t++}`,source:ae,target:r.id,targetHandle:T==="in"?void 0:T})})})}),Q},p=i.useMemo(()=>g(n),[n,u]),P=i.useMemo(()=>w(n),[n]),M=(j,k)=>{if(!j)return"null";const Q=j.nodes.map(r=>{const h=(r.list??[]).join(","),T=r.inputs?r.inputs.join(","):"",D=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([te,G])=>`${te}:${[...G].sort().join(",")}`).sort().join("|"):"",ae=k&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",h,T,D,ae].join(":")}).sort().join("||"),t=j.outputs?[...j.outputs].sort().join(","):j.output??"";return`${Q}::${t}`},F=i.useMemo(()=>{var k;const j=!!((k=n==null?void 0:n.nodes)!=null&&k.some(Q=>!!Q.position));return M(n,j)},[n]),[o,C]=i.useState(p),[b,x]=i.useState(P),[W,q]=i.useState(null),[z,s]=i.useState([]),[m,f]=i.useState(null),[he,O]=i.useState(null),[y,B]=i.useState({}),[E,ne]=i.useState(0),I=i.useRef(l),U=i.useRef(F),de=i.useRef(F),me=i.useRef(M(n,!1)),ge=i.useMemo(()=>W?o.find(j=>j.id===W)??null:null,[o,W]),K=i.useMemo(()=>{const j=["in1","in2","in3","in4","in5","in6"],k=new Map;return b.forEach(Q=>{if(!Q.target)return;const t=Q.targetHandle??"in1";k.has(Q.target)||k.set(Q.target,new Set),k.get(Q.target).add(t)}),o.map(Q=>{var t;if(((t=Q.data)==null?void 0:t.type)==="compute.concat"){const r=k.get(Q.id)??new Set,h=[];let T=!1;return j.forEach(D=>{var ae,te;if(r.has(D)||!T){const G=(te=(ae=u["compute.concat"])==null?void 0:ae.handles)==null?void 0:te.find(ue=>ue.id===D);G&&h.push(G),r.has(D)||(T=!0)}}),{...Q,selected:Q.id===W,data:{...Q.data,handles:h}}}return{...Q,selected:Q.id===W}})},[o,W,b,u]);i.useEffect(()=>{f(null),O(null)},[W]),i.useEffect(()=>{if(z.length===0)return;const j=k=>{if(k.key!=="Delete"&&k.key!=="Backspace")return;const Q=k.target;Q&&(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"||Q.isContentEditable)||(k.preventDefault(),x(t=>t.filter(r=>!z.includes(r.id))),s([]))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[z,x]),i.useEffect(()=>{I.current=l},[l]),i.useEffect(()=>{if(U.current!==F){if(de.current===F||me.current===F){U.current=F;return}U.current=F,C(p),x(P),q(null),f(null),O(null),B({}),ne(j=>j+1)}},[p,P,x,C,F]),i.useEffect(()=>{const j=o.filter(h=>{var T;return((T=h.data)==null?void 0:T.type)==="output"}).map(h=>h.id).sort(),k=new Map;b.forEach(h=>{let T=k.get(h.target);T||(T={},k.set(h.target,T));const D=h.targetHandle||"in";T[D]||(T[D]=[]),T[D].push(h.source)}),k.forEach(h=>{Object.values(h).forEach(T=>T.sort())});const Q={nodes:o.map(h=>{var T,D,ae,te,G,ue,oe,we,ea;return{id:h.id,type:((T=h.data)==null?void 0:T.type)??"compute.add",position:h.position,name:(D=h.data)==null?void 0:D.name,outputLabel:(ae=h.data)==null?void 0:ae.outputLabel,min:(te=h.data)==null?void 0:te.min,max:(G=h.data)==null?void 0:G.max,value:((ue=h.data)==null?void 0:ue.type)==="input.const"?(oe=h.data)==null?void 0:oe.value:void 0,list:(we=h.data)==null?void 0:we.list,inputs:(ea=k.get(h.id))==null?void 0:ea.in,inputsByHandle:k.get(h.id)}}),output:j[0]??null,outputs:j},t=M(Q,!0),r=M(Q,!1);t===de.current||r===me.current||(de.current=t,me.current=r,I.current(Q))},[o,b]),i.useEffect(()=>{const j={};let k=!1;o.forEach(Q=>{var D,ae,te,G,ue;if(((D=Q.data)==null?void 0:D.type)!=="input.random")return;if(y[Q.id]!==void 0){j[Q.id]=y[Q.id];return}const t=Number.isFinite((ae=Q.data)==null?void 0:ae.min)?Number((te=Q.data)==null?void 0:te.min):0,r=Number.isFinite((G=Q.data)==null?void 0:G.max)?Number((ue=Q.data)==null?void 0:ue.max):t+10,h=Math.min(t,r),T=Math.max(t,r);j[Q.id]=Math.floor(Math.random()*(T-h+1))+h,k=!0}),(k||Object.keys(j).length!==Object.keys(y).length)&&B(j)},[o,y,E]);const le=i.useMemo(()=>o.map(k=>{var t,r,h,T,D;const Q=(((t=k.data)==null?void 0:t.list)??[]).join(",");return[k.id,((r=k.data)==null?void 0:r.type)??"",((h=k.data)==null?void 0:h.name)??"",((T=k.data)==null?void 0:T.min)??"",((D=k.data)==null?void 0:D.max)??"",Q].join(":")}).sort().join("|"),[o]),d=i.useMemo(()=>b.map(k=>`${k.source}:${k.target}:${k.targetHandle??""}`).sort().join("|"),[b]),re=i.useMemo(()=>{const j=new Map(o.map(te=>[te.id,te])),k=new Map;b.forEach(te=>{let G=k.get(te.target);G||(G={},k.set(te.target,G));const ue=te.targetHandle||"in";G[ue]||(G[ue]=[]),G[ue].push(te.source)});const Q=new Map,t=new Set,r=te=>{if(typeof te=="number")return te;if(typeof te=="string"){const G=Number(te);return Number.isFinite(G)?G:0}return 0},h=(te,G)=>{var ue,oe;return G?((ue=k.get(te.id))==null?void 0:ue[G])??[]:((oe=k.get(te.id))==null?void 0:oe.in)??[]},T=(te,G)=>h(te,G).map(ue=>r(ae(ue))),D=(te,G)=>h(te,G).map(ue=>ae(ue)),ae=te=>{var we,ea,qe,ta;if(Q.has(te))return Q.get(te);if(t.has(te))return 0;const G=j.get(te);if(!G)return 0;t.add(te);const ue=((we=G.data)==null?void 0:we.type)??"";let oe=0;switch(ue){case"input.random":{oe=y[te]??0;break}case"input.const":{oe=Number.isFinite((ea=G.data)==null?void 0:ea.value)?Number((qe=G.data)==null?void 0:qe.value):0;break}case"input.list":{const De=(((ta=G.data)==null?void 0:ta.list)??[]).filter(Boolean),Ue=Math.round(T(G,"index")[0]??0);oe=(De.length?De[Math.max(0,Math.min(De.length-1,Ue))]:"")||String(Ue);break}case"compute.add":{oe=T(G,"in").reduce((De,Ue)=>De+Ue,0);break}case"compute.sub":{oe=T(G,"add").reduce((De,Ue)=>De+Ue,0)-T(G,"sub").reduce((De,Ue)=>De+Ue,0);break}case"compute.mul":{const De=T(G,"in");oe=De.length?De.reduce((Ue,Ke)=>Ue*Ke,1):0;break}case"compute.div":{const De=T(G,"num")[0]??0,Ue=T(G,"den").reduce((Ke,Xe)=>Ke+Xe,0);oe=Math.abs(Ue)<Number.EPSILON?0:De/Ue;break}case"compute.pow":{const De=T(G,"base")[0]??0,Ue=T(G,"exp")[0]??0;oe=Math.pow(De,Ue);break}case"compute.exp":{const De=T(G,"base")[0]??0,Ue=T(G,"exp")[0]??0;oe=Math.pow(De,Ue);break}case"compute.log":{const De=T(G,"value")[0]??0,Ue=T(G,"base")[0]??0,Ke=Math.max(De,Number.EPSILON);oe=Math.abs(Ue)<Number.EPSILON?Math.log(Ke):Math.log(Ke)/Math.log(Ue);break}case"compute.abs":{oe=Math.abs(T(G,"in")[0]??0);break}case"compute.min":{const De=T(G,"in");oe=De.length?Math.min(...De):0;break}case"compute.max":{const De=T(G,"in");oe=De.length?Math.max(...De):0;break}case"compute.floor":{oe=Math.floor(T(G,"in")[0]??0);break}case"compute.ceil":{oe=Math.ceil(T(G,"in")[0]??0);break}case"compute.round":{oe=Math.round(T(G,"in")[0]??0);break}case"compute.mod":{const De=T(G,"a")[0]??0,Ue=T(G,"b")[0]??0;oe=Math.abs(Ue)<Number.EPSILON?0:De%Ue;break}case"compute.concat":{const Ue=["in1","in2","in3","in4","in5","in6"].flatMap(ra=>D(G,ra)),Ke=Ue.length?Ue:D(G,"in");oe=(Ke.length?Ke:D(G)).map(ra=>ra==null?"":String(ra)).join("");break}case"compute.trim":{const De=D(G,"text")[0]??D(G,"in")[0]??"",Ue=De==null?"":String(De),Ke=Math.max(0,Math.round(T(G,"start")[0]??0)),Xe=Math.max(0,Math.round(T(G,"end")[0]??0));oe=Ke+Xe>=Ue.length?"":Ue.substring(Ke,Ue.length-Xe);break}case"output":{const De=h(G,"in")[0];oe=De?ae(De):0;break}default:oe=0}return t.delete(te),Q.set(te,oe),oe};return o.forEach(te=>ae(te.id)),Q},[le,d,y]),ee=i.useRef(re);i.useEffect(()=>{ee.current=re},[re]);const _=i.useCallback(j=>{const k=ee.current.get(j.id);return e.jsx(tn,{data:{...j.data,value:k}})},[]),Ne=i.useMemo(()=>({computed:_}),[_]),se=j=>{var r;if(!j.target||!j.targetHandle){x(h=>Rt(j,h));return}const k=o.find(h=>h.id===j.target),Q=k?u[((r=k.data)==null?void 0:r.type)??""]:null,t=Q==null?void 0:Q.handles.find(h=>h.id===j.targetHandle);x(h=>{let T=h;return t!=null&&t.limitOne&&(T=h.filter(D=>!(D.target===j.target&&D.targetHandle===j.targetHandle))),Rt(j,T)})},ie=j=>{const k=crypto.randomUUID(),Q=u[j]??{label:j,handles:[]},t=Q.label;C(r=>[...r,{id:k,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:Q.label,type:j,name:"",handles:Q.handles,list:j==="input.list"?[]:void 0,output:Q.output??!0}}])},Le=j=>{if(W){if(j.name!==void 0){const k=j.name.trim(),Q=k===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(k);if(O(Q?null:a.cogita.library.graph.invalidName),!k)f(null);else{const t=o.find(r=>{var h;return r.id!==W&&((h=r.data)==null?void 0:h.name)&&r.data.name.trim().toLowerCase()===k.toLowerCase()});f(t?a.cogita.library.graph.duplicateName:null)}}C(k=>k.map(Q=>{var t,r,h,T;return Q.id===W?{...Q,data:{...Q.data,...j,title:j.name?j.name:(t=Q.data)==null?void 0:t.title,subtitle:((h=u[j.type??((r=Q.data)==null?void 0:r.type)??""])==null?void 0:h.label)??((T=Q.data)==null?void 0:T.subtitle)}}:Q}))}},Re=()=>{W&&(C(j=>j.filter(k=>k.id!==W)),x(j=>j.filter(k=>k.source!==W&&k.target!==W)),B(j=>{const k={...j};return delete k[W],k}),q(null),f(null))},Ce=i.useRef({nodeId:null,edgeIds:[]}),$e=j=>{var T;const k=((T=j.nodes[0])==null?void 0:T.id)??null,Q=j.edges.map(D=>D.id),t=Ce.current,r=t.nodeId===k,h=t.edgeIds.length===Q.length&&t.edgeIds.every((D,ae)=>D===Q[ae]);r&&h||(Ce.current={nodeId:k,edgeIds:Q},q(k),s(Q))},ke=j=>{const k=j.filter(Q=>Q.type!=="select"&&Q.type!=="dimensions");k.length!==0&&C(Q=>gi(k,Q))},Qe=j=>{const k=j.filter(Q=>Q.type!=="select");k.length!==0&&x(Q=>ui(k,Q))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodeTypes:Ne,nodes:K,edges:b,onNodesChange:ke,onEdgesChange:Qe,onConnect:se,onNodeClick:(j,k)=>q(k.id),onSelectionChange:$e,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>ie("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>ie("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>ie("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>ie("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>ie("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>ie("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>ie("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>ie("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>ie("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>ie("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>ie("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>ie("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>ie("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>ie("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>ie("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>ie("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>ie("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>ie("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>ie("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>ie("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),ge?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Oe=ge.data)==null?void 0:Oe.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:j=>Le({name:j.target.value})}),m?e.jsx("em",{className:"cogita-help",children:m}):null,he?e.jsx("em",{className:"cogita-help",children:he}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((He=u[((Ae=ge.data)==null?void 0:Ae.type)??""])==null?void 0:He.label)??((ia=ge.data)==null?void 0:ia.type)]}),((aa=ge.data)==null?void 0:aa.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((R=ge.data)==null?void 0:R.outputLabel)??"",onChange:j=>Le({outputLabel:j.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((X=ge.data)==null?void 0:X.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Fe=ge.data)==null?void 0:Fe.min)??0,onChange:j=>Le({min:Number(j.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Te=ge.data)==null?void 0:Te.max)??10,onChange:j=>Le({max:Number(j.target.value)})})]})]}),((pe=ge.data)==null?void 0:pe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:((Ee=ge.data)==null?void 0:Ee.value)??0,onChange:j=>Le({value:Number(j.target.value)})})]}),((_e=ge.data)==null?void 0:_e.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Be=ge.data)==null?void 0:Be.list)??[]).join(`
`),onChange:j=>Le({list:j.target.value.split(`
`).map(k=>k.replace(/\r$/,"")).filter(k=>k.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((Ve=ge.data)==null?void 0:Ve.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{W&&(B(j=>{var h,T,D,ae;const k=Number.isFinite((h=ge.data)==null?void 0:h.min)?Number((T=ge.data)==null?void 0:T.min):0,Q=Number.isFinite((D=ge.data)==null?void 0:D.max)?Number((ae=ge.data)==null?void 0:ae.max):k+10,t=Math.min(k,Q),r=Math.max(k,Q);return{...j,[W]:Math.floor(Math.random()*(r-t+1))+t}}),ne(j=>j+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Re,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const rr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function wr(a,n,l){if(!a)return null;const u=new Map(a.nodes.map(O=>[O.id,O])),g=new Map,w=new Set,p=O=>{if(typeof O=="number")return O;if(typeof O=="string"){const y=Number(O);return Number.isFinite(y)?y:0}return 0},P=O=>{if(g.has(O))return g.get(O);if(w.has(O))return 0;const y=u.get(O);if(!y)return 0;w.add(O);const B=ne=>{var U,de;return(ne?((U=y.inputsByHandle)==null?void 0:U[ne])??[]:y.inputs??((de=y.inputsByHandle)==null?void 0:de.in)??[]).map(me=>P(me))};let E=0;switch(y.type){case"input.random":{const ne=y.min??0,I=y.max??ne+10,U=Math.min(ne,I),de=Math.max(ne,I);E=Math.floor(Math.random()*(de-U+1))+U;break}case"input.const":{E=y.value??0;break}case"input.list":{const ne=(y.list??[]).filter(Boolean),I=Math.round(p(B("index")[0]));E=ne.length?ne[Math.max(0,Math.min(ne.length-1,I))]:String(I);break}case"compute.add":{E=B("in").map(I=>p(I)).reduce((I,U)=>I+U,0);break}case"compute.sub":{const ne=B("add").map(U=>p(U)),I=B("sub").map(U=>p(U));E=ne.reduce((U,de)=>U+de,0)-I.reduce((U,de)=>U+de,0);break}case"compute.mul":{const ne=B("in").map(I=>p(I));E=ne.length?ne.reduce((I,U)=>I*U,1):0;break}case"compute.div":{const ne=p(B("num")[0]),I=B("den").map(U=>p(U)).reduce((U,de)=>U+de,0);E=Math.abs(I)<Number.EPSILON?0:ne/I;break}case"compute.pow":{const ne=p(B("base")[0]),I=p(B("exp")[0]);E=Math.pow(ne,I);break}case"compute.exp":{const ne=p(B("base")[0]),I=p(B("exp")[0]);E=Math.pow(ne,I);break}case"compute.log":{const ne=p(B("value")[0]),I=p(B("base")[0]),U=Math.max(ne,Number.EPSILON);E=Math.abs(I)<Number.EPSILON?Math.log(U):Math.log(U)/Math.log(I);break}case"compute.abs":{E=Math.abs(p(B("in")[0]));break}case"compute.min":{const ne=B("in").map(I=>p(I));E=ne.length?Math.min(...ne):0;break}case"compute.max":{const ne=B("in").map(I=>p(I));E=ne.length?Math.max(...ne):0;break}case"compute.floor":{E=Math.floor(p(B("in")[0]));break}case"compute.ceil":{E=Math.ceil(p(B("in")[0]));break}case"compute.round":{E=Math.round(p(B("in")[0]));break}case"compute.mod":{const ne=p(B("a")[0]),I=p(B("b")[0]);E=Math.abs(I)<Number.EPSILON?0:ne%I;break}case"compute.concat":{const I=["in1","in2","in3","in4","in5","in6"].flatMap(ge=>B(ge)),U=I.length?I:B("in");E=(U.length?U:B()).map(ge=>ge==null?"":String(ge)).join("");break}case"compute.trim":{const ne=B("text")[0]??B("in")[0]??"",I=ne==null?"":String(ne),U=Math.max(0,Math.round(p(B("start")[0]))),de=Math.max(0,Math.round(p(B("end")[0])));U+de>=I.length?E="":E=I.substring(U,I.length-de);break}case"output":{E=B("in")[0]??0;break}default:E=0}return w.delete(O),g.set(O,E),E},M=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(O=>O.type==="output").map(O=>O.id);a.nodes.forEach(O=>P(O.id)),M.forEach(O=>P(O));const F=O=>Math.abs(O%1)<1e-5?String(Math.round(O)):O.toFixed(3).replace(/\.?0+$/,""),o=O=>typeof O=="number"?F(O):O??"",C=new Map;M.forEach(O=>{var I,U,de,me;const y=u.get(O);if(!y)return;const B=(U=(I=y.inputsByHandle)==null?void 0:I.name)==null?void 0:U[0],E=B?o(g.get(B)):"",ne=(E==null?void 0:E.toString().trim())||((de=y.outputLabel)==null?void 0:de.trim())||((me=y.name)==null?void 0:me.trim())||O;C.set(O,ne)});const b={},x={},W={};M.forEach(O=>{var E,ne;const y=u.get(O);if(!y)return;const B=C.get(O)??(((E=y.outputLabel)==null?void 0:E.trim())||((ne=y.name)==null?void 0:ne.trim())||O);b[B]=o(g.get(O)),y.name&&(x[y.name.trim()]=B),x[O]=B});const q=(O,y)=>{let B=O;return a.nodes.forEach(E=>{var me,ge;const ne=o(g.get(E.id)),I=M.includes(E.id),U=I?C.get(E.id)??((me=E.outputLabel)==null?void 0:me.trim())??((ge=E.name)==null?void 0:ge.trim())??E.id:"",de=I&&y?U:ne;B=B.replace(new RegExp(`\\{\\s*${rr(E.id)}\\s*\\}`,"gi"),de),E.name&&(B=B.replace(new RegExp(`\\{\\s*${rr(E.name)}\\s*\\}`,"gi"),de)),I&&E.outputLabel&&(B=B.replace(new RegExp(`\\{\\s*${rr(E.outputLabel)}\\s*\\}`,"gi"),U))}),B},z=n;let s=z.trim().length>0?z:"";s||(s=M.length?`Compute ${M.join(", ")}`:"Compute"),s=q(s,!0);const m=(l==null?void 0:l.trim())??"",f=m?q(m,!1):"",he={};return g.forEach((O,y)=>{he[y]=O,W[y]=o(O);const B=u.get(y);B!=null&&B.name&&(W[B.name.trim()]=o(O))}),{prompt:s,answers:b,values:he,answerText:f,outputVariables:x,variableValues:W}}function Xr(a){var l;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((l=n[0])==null?void 0:l[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function nn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o,editInfoId:C}){const{libraryName:b}=qa(o),x=!!C,W=`/#/cogita/library/${o}`,[q,z]=i.useState("info"),[s,m]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[f,he]=i.useState(""),[O,y]=i.useState(null),[B,E]=i.useState(null),[ne,I]=i.useState("idle"),[U,de]=i.useState(null),[me,ge]=i.useState(-1),[K,le]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[d,re]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[ee,_]=i.useState(null),[Ne,se]=i.useState("idle"),[ie,Le]=i.useState(null),[Re,Ce]=i.useState(null),[$e,ke]=i.useState(null),Qe=i.useRef(null),Oe=i.useRef(null),Ae=i.useRef(null),He=i.useMemo(()=>Gr(a),[a]),ia=i.useMemo(()=>Qi(a),[a]),aa=i.useMemo(()=>Gi(a),[a]),R=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),X=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Fe=i.useMemo(()=>He.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[He]),Te=i.useMemo(()=>{const t=M;return Ft.map(r=>{var D;const h=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${h.abbr} — ${h.name}`,latin:((D=r==null?void 0:r.la)==null?void 0:D.abbr)??h.abbr}})},[M]),pe=(t,r=!1)=>{const h=t.trim().toLowerCase();return h?Te.filter(T=>T.label.toLowerCase().includes(h)).slice(0,8):r?Te.slice(0,8):[]},Ee=(t,r)=>{const h=t.trim().toLowerCase();if(!h)return null;const T=Ft;for(const D of T){const ae=D==null?void 0:D.la,te=(D==null?void 0:D[r])??(D==null?void 0:D.en)??ae;if([te==null?void 0:te.abbr,te==null?void 0:te.name,ae==null?void 0:ae.abbr,ae==null?void 0:ae.name,`${te==null?void 0:te.abbr} — ${te==null?void 0:te.name}`].filter(Boolean).map(ue=>ue.toLowerCase()).some(ue=>ue===h))return{book:D,entry:te,la:ae}}return null};i.useEffect(()=>{if(!K.language||!K.word){Le(null);return}const t=window.setTimeout(()=>{tr({libraryId:o,languageId:K.language.id,wordId:K.word.id}).then(r=>{Le(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{Le(null)})},200);return()=>window.clearTimeout(t)},[o,K.language,K.word]),i.useEffect(()=>{if(!d.languageA||!d.wordA){Ce(null);return}const t=window.setTimeout(()=>{tr({libraryId:o,languageId:d.languageA.id,wordId:d.wordA.id}).then(r=>{Ce(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Ce(null)})},200);return()=>window.clearTimeout(t)},[o,d.languageA,d.wordA]),i.useEffect(()=>{if(!d.languageB||!d.wordB){ke(null);return}const t=window.setTimeout(()=>{tr({libraryId:o,languageId:d.languageB.id,wordId:d.wordB.id}).then(r=>{ke(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{ke(null)})},200);return()=>window.clearTimeout(t)},[o,d.languageB,d.wordB]),i.useEffect(()=>{if(!x||!C)return;let t=!1;return se("loading"),_(null),at({libraryId:o,infoId:C}).then(async r=>{var T,D;if(t)return;const h=r.payload??{};if(m(ae=>({...ae,infoType:r.infoType,label:h.label??"",notes:h.notes??"",language:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,sourceKind:h.sourceKind??"string",sourceResourceType:ae.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:h.text??"",workLanguage:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,workOriginalLanguage:h.originalLanguageId?{id:h.originalLanguageId,label:h.originalLanguageId,infoType:"language"}:null,workDoi:h.doi??"",mediaType:h.mediaType??"book",mediaPublisher:h.publisher??"",mediaPublicationPlace:h.publicationPlace??"",mediaPublicationYear:h.publicationYear??"",mediaPages:h.pages??"",mediaIsbn:h.isbn??"",mediaCover:h.cover??"",mediaHeight:h.height??"",mediaLength:h.length??"",mediaWidth:h.width??"",mediaWeight:h.weight??"",mediaCollection:h.collection??"",mediaLocation:h.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&h.locator&&typeof h.locator=="object"){const ae=h.locator;if(h.sourceKind==="website")m(te=>({...te,sourceUrl:typeof ae.url=="string"?ae.url:"",sourceAccessedDate:typeof ae.date=="string"?ae.date:""}));else if(h.sourceKind==="bible"){const te=typeof ae.book=="string"?ae.book:"",G=te?Ee(te,M):null,ue=G?`${G.entry.abbr} — ${G.entry.name}`:te;m(oe=>({...oe,sourceLocatorValue:te,sourceLocatorAux:typeof ae.rest=="string"?ae.rest:"",sourceBibleBookDisplay:ue}))}else h.sourceKind==="book"?m(te=>({...te,sourceLocatorValue:typeof ae.page=="string"?ae.page:""})):h.sourceKind==="number_document"?m(te=>({...te,sourceLocatorValue:typeof ae.number=="string"?ae.number:""})):typeof ae.text=="string"&&m(te=>({...te,sourceLocatorValue:ae.text}))}if(h.languageId&&r.infoType!=="work")try{const ae=await at({libraryId:o,infoId:h.languageId});if(t)return;m(te=>{var G;return{...te,language:{id:h.languageId,label:((G=ae.payload)==null?void 0:G.label)??h.languageId,infoType:"language"}}})}catch{}if(h.languageId&&r.infoType==="work")try{const ae=await at({libraryId:o,infoId:h.languageId});if(t)return;m(te=>{var G;return{...te,workLanguage:{id:h.languageId,label:((G=ae.payload)==null?void 0:G.label)??h.languageId,infoType:"language"}}})}catch{}if(h.originalLanguageId)try{const ae=await at({libraryId:o,infoId:h.originalLanguageId});if(t)return;m(te=>{var G;return{...te,workOriginalLanguage:{id:h.originalLanguageId,label:((G=ae.payload)==null?void 0:G.label)??h.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(he(((T=h.definition)==null?void 0:T.answerTemplate)??""),y(((D=h.definition)==null?void 0:D.graph)??null),E(null),I("idle")):(he(""),y(null),E(null),I("idle")),z("info")}).catch(()=>{t||_(a.cogita.library.add.info.failed)}).finally(()=>{t||se("idle")}),()=>{t=!0}},[a,C,x,o]),i.useEffect(()=>{if(s.sourceKind==="bible"&&s.sourceLocatorValue&&U!=="source"){const t=Ee(s.sourceLocatorValue,M);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==s.sourceBibleBookDisplay&&m(h=>({...h,sourceBibleBookDisplay:r}))}}},[M,s.sourceKind,s.sourceLocatorValue,s.sourceBibleBookDisplay]);const _e=async()=>{var t,r;_(null);try{const h={label:s.infoType==="quote"||s.infoType==="source"?"":s.label,notes:s.infoType==="computed"?"":s.notes};if(s.language&&(s.infoType==="word"||s.infoType==="sentence")&&(h.languageId=s.language.id),s.infoType==="source"&&(h.sourceKind=s.sourceKind,s.sourceKind==="website"?h.locator={url:s.sourceUrl.trim(),date:s.sourceAccessedDate.trim()}:s.sourceKind==="bible"?h.locator={book:s.sourceLocatorValue.trim(),rest:s.sourceLocatorAux.trim()}:s.sourceKind==="book"?h.locator={page:s.sourceLocatorValue.trim()}:s.sourceKind==="number_document"?h.locator={number:s.sourceLocatorValue.trim()}:h.locator={text:s.sourceLocatorValue.trim()}),s.infoType==="quote"&&(h.text=s.quoteText),s.infoType==="work"&&(h.languageId=((t=s.workLanguage)==null?void 0:t.id)??null,h.originalLanguageId=((r=s.workOriginalLanguage)==null?void 0:r.id)??null,h.doi=s.workDoi.trim()),s.infoType==="media"&&(h.mediaType=s.mediaType,h.publisher=s.mediaPublisher.trim(),h.publicationPlace=s.mediaPublicationPlace.trim(),h.publicationYear=s.mediaPublicationYear.trim(),h.pages=s.mediaPages.trim(),h.isbn=s.mediaIsbn.trim(),h.cover=s.mediaCover.trim(),h.height=s.mediaHeight.trim(),h.length=s.mediaLength.trim(),h.width=s.mediaWidth.trim(),h.weight=s.mediaWeight.trim(),h.collection=s.mediaCollection.trim(),h.location=s.mediaLocation.trim()),s.infoType==="computed"){if(!O){_(a.cogita.library.add.info.computedRequired);return}if(!f.trim()){_(a.cogita.library.add.info.computedAnswerRequired);return}if(O.nodes.find(oe=>oe.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(oe.name))){_(a.cogita.library.add.info.computedInvalidName);return}const D=O.nodes.map(oe=>{var we;return(we=oe.name)==null?void 0:we.trim()}).filter(Boolean),ae=new Set;for(const oe of D){const we=oe.toLowerCase();if(ae.has(we)){_(a.cogita.library.add.info.computedDuplicateName);return}ae.add(we)}const te=O.nodes.filter(oe=>oe.type==="output"),G=te.map(oe=>{var we;return(we=oe.name)==null?void 0:we.trim()}).filter(Boolean);if(G.length!==te.length){_(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!G.every(oe=>new RegExp(`\\{\\s*${oe}\\s*\\}`,"i").test(f))){_(a.cogita.library.add.info.computedAnswerMissingOutput);return}h.definition={answerTemplate:f,graph:O}}if(x&&C)se("saving"),await mi({libraryId:o,infoId:C,payload:h}),_(a.cogita.library.add.info.updated),se("idle");else{let T=null;if(s.referenceEnabled){const oe={sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},{payload:we,resourceInfoId:ea,error:qe}=Be(oe);if(qe){_(a.cogita.library.add.info.referenceMissingSource);return}T={payload:we,resourceInfoId:ea}}const D=await et({libraryId:o,infoType:s.infoType,payload:h});if(s.infoType==="source"&&s.sourceResource&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[D.infoId,s.sourceResource.id]}),s.infoType==="quote"&&s.language&&await ga({libraryId:o,connectionType:"quote-language",infoIds:[D.infoId,s.language.id]}),T){const oe=await et({libraryId:o,infoType:"source",payload:T.payload});T.resourceInfoId&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[oe.infoId,T.resourceInfoId]}),await ga({libraryId:o,connectionType:"reference",infoIds:[D.infoId,oe.infoId]})}_(a.cogita.library.add.info.saved);const ae=s.infoType==="word"||s.infoType==="sentence",te=s.referenceEnabled,G=s.referenceSourceKind,ue={referenceEnabled:te,referenceSourceKind:te?G:"string",referenceSourceUrl:te&&G==="website"?s.referenceSourceUrl:"",referenceSourceAccessedDate:te&&G==="website"?s.referenceSourceAccessedDate:"",referenceChurchDocument:te&&G==="number_document"?s.referenceChurchDocument:null,referenceBookMedia:te&&G==="book"?s.referenceBookMedia:null,referenceWork:te&&G==="work"?s.referenceWork:null,referenceLocatorValue:te&&G==="bible"?s.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:te&&G==="bible"?s.referenceBibleBookDisplay:""};m({infoType:s.infoType,label:"",language:ae?s.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:s.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...ue}),s.infoType==="computed"&&(he(""),y(null),E(null),I("idle"))}}catch{_(a.cogita.library.add.info.failed)}},Be=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const h={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(h.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:h,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(h.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:h,resourceInfoId:r}):(t.sourceKind==="book"?h.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?h.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(h.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:h,resourceInfoId:r})},Ve=()=>{if(I("idle"),!O){E(null),I("error");return}const t=wr(O,"",f);if(!t){E(null),I("error");return}E({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),I("ready")},j=async()=>{_(null);try{if(K.connectionType==="reference"){if(!K.referencedInfo||!K.source){_(a.cogita.library.add.connection.selectReference);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.referencedInfo.id,K.source.id]})}else if(K.connectionType==="source-resource"){if(!K.source||!K.sourceResource){_(a.cogita.library.add.connection.selectSourceResource);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.source.id,K.sourceResource.id]})}else if(K.connectionType==="quote-language"){if(!K.quote||!K.language){_(a.cogita.library.add.connection.selectQuoteLanguage);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.quote.id,K.language.id]})}else if(K.connectionType==="work-contributor"){if(!K.work||!K.contributor||!K.contributorRole.trim()){_(a.cogita.library.add.connection.selectWorkContributor);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.work.id,K.contributor.id],payload:{role:K.contributorRole.trim()}})}else if(K.connectionType==="work-medium"){if(!K.work||!K.medium){_(a.cogita.library.add.connection.selectWorkMedium);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.work.id,K.medium.id]})}else if(K.connectionType==="orcid-link"){if(!K.orcidEntity||!K.orcid){_(a.cogita.library.add.connection.selectOrcidLink);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.orcidEntity.id,K.orcid.id]})}else if(K.connectionType==="word-language"){if(!K.language||!K.word){_(a.cogita.library.add.connection.selectWordLanguage);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.language.id,K.word.id],payload:{note:K.note}})}else if(K.connectionType==="word-topic"){if(!K.word||!K.topic){_(a.cogita.library.add.connection.selectWordTopic);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.word.id,K.topic.id],payload:{note:K.note}})}else if(K.connectionType==="translation"){if(!K.wordA||!K.wordB){_(a.cogita.library.add.connection.selectTwoWords);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.wordA.id,K.wordB.id],payload:{note:K.note}})}else if(K.connectionType==="language-sentence"){if(!K.language||!K.sentence){_(a.cogita.library.add.connection.selectLanguageSentence);return}await ga({libraryId:o,connectionType:K.connectionType,infoIds:[K.language.id,K.sentence.id],payload:{note:K.note}})}_(a.cogita.library.add.connection.saved),le(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{_(a.cogita.library.add.connection.failed)}},k=async()=>{var t,r;_(null);try{if(d.groupType==="citation"){const T=d.citationTitle.trim(),D=d.citationQuoteText.trim();if(!D){_(a.cogita.library.add.group.citationMissingQuote);return}let ae=null;if(d.citationReferenceEnabled){const ue={sourceKind:d.citationSourceKind,locatorValue:d.citationLocatorValue,locatorAux:d.citationLocatorAux,bibleBookDisplay:d.citationBibleBookDisplay,sourceUrl:d.citationSourceUrl,sourceAccessedDate:d.citationSourceAccessedDate,churchDocument:d.citationChurchDocument,bookMedia:d.citationBookMedia,work:d.citationWork},{payload:oe,resourceInfoId:we,error:ea}=Be(ue);if(ea){_(a.cogita.library.add.info.referenceMissingSource);return}ae={payload:oe,resourceInfoId:we}}const te={text:D};T&&(te.title=T);const G=await et({libraryId:o,infoType:"quote",payload:te});if(d.citationLanguage&&await ga({libraryId:o,connectionType:"quote-language",infoIds:[G.infoId,d.citationLanguage.id]}),ae){const ue=await et({libraryId:o,infoType:"source",payload:ae.payload});ae.resourceInfoId&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[ue.infoId,ae.resourceInfoId]}),await ga({libraryId:o,connectionType:"reference",infoIds:[G.infoId,ue.infoId]})}_(a.cogita.library.add.group.savedCitation),re(ue=>({...ue,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:ue.citationReferenceEnabled,citationSourceKind:ue.citationReferenceEnabled?ue.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:ue.citationReferenceEnabled?ue.citationChurchDocument:null,citationBookMedia:ue.citationReferenceEnabled?ue.citationBookMedia:null,citationWork:ue.citationReferenceEnabled?ue.citationWork:null}));return}if(d.groupType==="book"){const T=d.bookTitle.trim();if(!T){_(a.cogita.library.add.group.bookMissingTitle);return}const D=d.bookWorkTitle.trim();if(!D){_(a.cogita.library.add.group.bookMissingWork);return}if(d.bookContributors.find(oe=>oe.contributor&&!oe.role.trim()||!oe.contributor&&oe.role.trim())){_(a.cogita.library.add.group.bookMissingContributor);return}const te=await et({libraryId:o,infoType:"media",payload:{label:T,mediaType:"book",publisher:d.bookPublisher.trim(),publicationPlace:d.bookPublicationPlace.trim(),publicationYear:d.bookPublicationYear.trim(),pages:d.bookPages.trim(),isbn:d.bookIsbn.trim(),cover:d.bookCover.trim(),height:d.bookHeight.trim(),length:d.bookLength.trim(),width:d.bookWidth.trim(),weight:d.bookWeight.trim(),collection:d.bookCollection.trim(),location:d.bookLocation.trim()}}),G=await et({libraryId:o,infoType:"work",payload:{label:D,languageId:((t=d.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=d.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:d.bookWorkDoi.trim()}});await ga({libraryId:o,connectionType:"work-medium",infoIds:[G.infoId,te.infoId]});const ue=d.bookContributors.filter(oe=>oe.contributor&&oe.role.trim());for(const oe of ue)await ga({libraryId:o,connectionType:"work-contributor",infoIds:[G.infoId,oe.contributor.id],payload:{role:oe.role.trim()}});_(a.cogita.library.add.group.savedBook),re(oe=>({...oe,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!d.languageA||!d.wordA||!d.languageB||!d.wordB){_(a.cogita.library.add.group.selectBoth);return}const h=T=>Array.from(new Map(T.map(D=>[D.id,D])).values());Re||await ga({libraryId:o,connectionType:"word-language",infoIds:[d.languageA.id,d.wordA.id]}),$e||await ga({libraryId:o,connectionType:"word-language",infoIds:[d.languageB.id,d.wordB.id]});for(const T of h(d.wordATags))await ga({libraryId:o,connectionType:"word-topic",infoIds:[d.wordA.id,T.id]});for(const T of h(d.wordBTags))await ga({libraryId:o,connectionType:"word-topic",infoIds:[d.wordB.id,T.id]});await ga({libraryId:o,connectionType:"translation",infoIds:[d.wordA.id,d.wordB.id],payload:{tagIds:h(d.translationTags).map(T=>T.id)}}),_(a.cogita.library.add.group.savedVocab),re(T=>({...T,groupType:d.groupType,languageA:d.languageA,wordA:null,languageB:d.languageB,wordB:null,wordATags:d.wordATags,wordBTags:d.wordBTags,translationTags:d.translationTags})),requestAnimationFrame(()=>{var T;return(T=Qe.current)==null?void 0:T.focus()})}catch{_(a.cogita.library.add.group.failed)}},Q=d.groupType==="citation"?a.cogita.library.add.group.saveCitation:d.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:W,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${W}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":q===t,onClick:()=>{x||z(t)},disabled:x&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[q==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:s.infoType,onChange:t=>{x||m(r=>({...r,infoType:t.target.value}))},disabled:x,children:He.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.infoType!=="quote"&&s.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:s.label,onChange:t=>m(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(s.infoType==="word"||s.infoType==="sentence"||s.infoType==="quote")&&e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:s.language,onChange:t=>m(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),s.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:s.workLanguage,onChange:t=>m(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:s.workOriginalLanguage,onChange:t=>m(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:s.workDoi,onChange:t=>m(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),s.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:s.mediaType,onChange:t=>m(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:s.mediaPublisher,onChange:t=>m(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationPlace,onChange:t=>m(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationYear,onChange:t=>m(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:s.mediaPages,onChange:t=>m(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:s.mediaIsbn,onChange:t=>m(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:s.mediaCover,onChange:t=>m(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:s.mediaHeight,onChange:t=>m(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:s.mediaLength,onChange:t=>m(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:s.mediaWidth,onChange:t=>m(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:s.mediaWeight,onChange:t=>m(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:s.mediaCollection,onChange:t=>m(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:s.mediaLocation,onChange:t=>m(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),s.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:s.quoteText,onChange:t=>m(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),s.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:s.sourceKind,onChange:t=>{const r=t.target.value,h=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":s.sourceResourceType;m(T=>({...T,sourceKind:r,sourceResourceType:h,sourceResource:null,sourceLocatorValue:r==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?T.sourceBibleBookDisplay:""}))},children:R.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:s.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;m(h=>({...h,sourceBibleBookDisplay:r,sourceLocatorValue:""})),de("source"),ge(-1)},onKeyDown:t=>{const r=pe(s.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),ge(h=>Math.min(h+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),ge(h=>Math.max(h-1,0));else if((t.key==="Enter"||t.key==="Tab")&&me>=0&&r[me]){const h=r[me],T=Ee(h.label,M);if(!T)return;m(D=>{var ae;return{...D,sourceBibleBookDisplay:h.label,sourceLocatorValue:((ae=T.la)==null?void 0:ae.abbr)??D.sourceLocatorValue}}),de(null)}}},onFocus:()=>de("source"),onBlur:()=>window.setTimeout(()=>de(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),U==="source"&&pe(s.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:pe(s.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===me,tabIndex:-1,onMouseDown:()=>{const h=Ee(t.label,M);h&&m(T=>{var D;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((D=h.la)==null?void 0:D.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorAux,onChange:t=>m(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),s.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:s.sourceUrl,onChange:t=>m(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:s.sourceAccessedDate,onChange:t=>m(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorValue,onChange:t=>m(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),s.sourceKind!=="string"&&s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:s.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(s.sourceKind),onChange:t=>m(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Fe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:o,infoType:s.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:s.sourceResource,onChange:t=>m(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,s.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),s.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:s.notes,onChange:t=>m(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,s.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:f,onChange:t=>he(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(rn,{copy:a,value:O,onChange:t=>y(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Ve,children:a.cogita.library.add.info.computedPreview})}),B&&ne==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(Et,{value:B.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(B.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(br,{value:r,mode:"auto"})]},t))}),B.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(Et,{value:B.answerText,mode:"auto"})]}):null]}):ne==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.referenceEnabled,onChange:t=>m(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),s.referenceEnabled&&e.jsx(Ar,{libraryId:o,copy:a,language:M,sourceKindOptions:R,labels:X,value:{sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},onChange:t=>m(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:_e,disabled:Ne==="saving"||Ne==="loading",children:x?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,q==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:K.connectionType,onChange:t=>le(r=>({...r,connectionType:t.target.value})),children:ia.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),K.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>le(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:K.word,onChange:t=>le(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),ie&&e.jsx("p",{className:"cogita-help",children:ie})]}),K.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:K.word,onChange:t=>le(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:K.topic,onChange:t=>le(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:K.wordA,onChange:t=>le(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:K.wordB,onChange:t=>le(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:K.quote,onChange:t=>le(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>le(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:K.language,onChange:t=>le(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:K.sentence,onChange:t=>le(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:K.referencedInfoType,onChange:t=>le(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:He.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:o,infoType:K.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:K.referencedInfo,onChange:t=>le(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:K.source,onChange:t=>le(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:K.source,onChange:t=>le(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:K.sourceResourceType,onChange:t=>le(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Fe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:o,infoType:K.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:K.sourceResource,onChange:t=>le(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:K.work,onChange:t=>le(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:K.contributorType,onChange:t=>le(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ze(a,t)},t))})]}),e.jsx(ze,{libraryId:o,infoType:K.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:K.contributor,onChange:t=>le(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:K.contributorRole,onChange:t=>le(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),K.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:K.work,onChange:t=>le(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:K.medium,onChange:t=>le(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),K.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:K.orcidEntityType,onChange:t=>le(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ze(a,t)},t))})]}),e.jsx(ze,{libraryId:o,infoType:K.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:K.orcidEntity,onChange:t=>le(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,K.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(ze,{libraryId:o,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:K.orcid,onChange:t=>le(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:K.note,onChange:t=>le(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:j,children:a.cogita.library.add.connection.save})})]}):null,q==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:d.groupType,onChange:t=>re(r=>({...r,groupType:t.target.value})),children:aa.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:d.citationLanguage,onChange:t=>re(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:d.citationTitle,onChange:t=>re(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:d.citationQuoteText,onChange:t=>re(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:d.citationReferenceEnabled,onChange:t=>re(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),d.citationReferenceEnabled&&e.jsx(Ar,{libraryId:o,copy:a,language:M,sourceKindOptions:R,labels:X,value:{sourceKind:d.citationSourceKind,locatorValue:d.citationLocatorValue,locatorAux:d.citationLocatorAux,bibleBookDisplay:d.citationBibleBookDisplay,sourceUrl:d.citationSourceUrl,sourceAccessedDate:d.citationSourceAccessedDate,churchDocument:d.citationChurchDocument,bookMedia:d.citationBookMedia,work:d.citationWork},onChange:t=>re(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),d.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:d.bookTitle,onChange:t=>re(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:d.bookPublisher,onChange:t=>re(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:d.bookPublicationPlace,onChange:t=>re(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:d.bookPublicationYear,onChange:t=>re(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:d.bookPages,onChange:t=>re(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:d.bookIsbn,onChange:t=>re(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:d.bookCover,onChange:t=>re(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:d.bookHeight,onChange:t=>re(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:d.bookLength,onChange:t=>re(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:d.bookWidth,onChange:t=>re(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:d.bookWeight,onChange:t=>re(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:d.bookCollection,onChange:t=>re(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:d.bookLocation,onChange:t=>re(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:d.bookWorkTitle,onChange:t=>re(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:d.bookWorkLanguage,onChange:t=>re(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:d.bookWorkOriginalLanguage,onChange:t=>re(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:d.bookWorkDoi,onChange:t=>re(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>re(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),d.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((D,ae)=>ae===r?{...D,contributorType:h.target.value,contributor:null}:D)})),children:["person","institution","collective"].map(h=>e.jsx("option",{value:h,children:Ze(a,h)},h))})]}),e.jsx(ze,{libraryId:o,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((D,ae)=>ae===r?{...D,contributor:h}:D)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ze(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((D,ae)=>ae===r?{...D,role:h.target.value}:D)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>re(h=>{const T=h.bookContributors.filter((D,ae)=>ae!==r);return T.length===0?{...h,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...h,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),d.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:d.languageA,onChange:t=>re(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:d.languageB,onChange:t=>re(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:d.wordA,onChange:t=>re(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Qe,autoAdvance:!0,onCommit:()=>{var t;return(t=Oe.current)==null?void 0:t.focus()}}),e.jsx(ze,{libraryId:o,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:d.wordB,onChange:t=>re(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Oe,autoAdvance:!0,onCommit:()=>{var t;return(t=Ae.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:d.translationTags,onChangeMultiple:t=>re(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:d.wordATags,onChangeMultiple:t=>re(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:d.wordBTags,onChangeMultiple:t=>re(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),d.groupType==="vocab"&&Re&&e.jsx("p",{className:"cogita-help",children:Re}),d.groupType==="vocab"&&$e&&e.jsx("p",{className:"cogita-help",children:$e}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:k,ref:Ae,children:Q})})]}):null,ee?e.jsx("p",{className:"cogita-form-error",children:ee}):null]})})})})})]})})}const Fr=a=>/\s/.test(a),Bt=a=>/[\p{L}\p{N}]/u.test(a),Br=(a,n)=>{const l=n>0?a[n-1]:"",u=n<a.length?a[n]:"";if(!l||!u)return 0;const g=Fr(l),w=Fr(u);if(g||w)return 3;const p=Bt(l),P=Bt(u);return p!==P?2:!p&&!P?1:0},ir=(a,n,l,u,g)=>{const w=Math.max(u-n,l-u);for(let p=0;p<=w;p+=1){const P=u-p;if(P>=n&&P<=l&&Br(a,P)>=g)return P;const M=u+p;if(M>=n&&M<=l&&Br(a,M)>=g)return M}return null},nr=(a,n)=>{const l=n>0?a[n-1]:"",u=n<a.length?a[n]:"";return!l||!u?!0:Bt(l)!==Bt(u)},on=(a,n,l,u)=>{const g=l-n,w=n+u,p=l-u;if(g<=u*2||p<=w)return null;const P=Math.floor((n+l)/2),M=ir(a,w,p,P,3);if(M!==null&&nr(a,M))return M;const F=ir(a,w,p,P,2);if(F!==null&&nr(a,F))return F;const o=ir(a,w,p,P,1);return o!==null&&nr(a,o)?o:null},bt=(a,n)=>{const l=Math.max(1,7),u=Math.max(l,13),g={},w=(M,F,o,C,b)=>{const x=String(C),W={id:x,start:M,end:F,text:a.slice(M,F),depth:o,index:C,parentId:b};if(g[x]=W,F-M>u){let z=on(a,M,F,l);if(z!==null&&z>M&&z<F){const s=w(M,z,o+1,C*2+1,x),m=w(z,F,o+1,C*2+2,x);W.leftId=s.id,W.rightId=m.id}}return W},p=w(0,a.length,0,0),P=Object.values(g).sort((M,F)=>F.depth-M.depth||M.start-F.start).map(M=>M.id);return{text:a,rootId:p.id,nodes:g,order:P}},gt=(a,n,l,u,g,w,p)=>{const P=w==="reverse"?a.order.slice().sort((M,F)=>a.nodes[F].start-a.nodes[M].start||a.nodes[F].depth-a.nodes[M].depth):a.order;for(const M of P){if(p&&M===p||n.has(M))continue;const F=a.nodes[M];if(F){if(g&&(F.leftId||F.rightId)){const o=F.leftId?l[F.leftId]??0:u,C=F.rightId?l[F.rightId]??0:u;if((o+C)/2<u)continue}return F}}return null},Zr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function ln({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o}){const C=`/#/cogita/library/${o}`,[b,x,W]=Vr([]),[q,z,s]=qr([]),[m,f]=i.useState(null),[he,O]=i.useState(null),[y,B]=i.useState(null),[E,ne]=i.useState(null),I=i.useMemo(()=>b.find(d=>d.id===m)??null,[b,m]);i.useEffect(()=>{let d=!0;return pi({libraryId:o}).then(re=>{if(!d)return;const ee=re.nodes.map(_=>{var Ne,se,ie;return{id:_.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:_.payload&&typeof _.payload=="object"&&"label"in _.payload?String(_.payload.label):"Item",nodeType:_.nodeType,itemType:((Ne=_.payload)==null?void 0:Ne.itemType)??"info",itemId:((se=_.payload)==null?void 0:se.itemId)??null,infoType:((ie=_.payload)==null?void 0:ie.infoType)??null}}});x(ee),z(re.edges.map(_=>({id:_.edgeId,source:_.fromNodeId,target:_.toNodeId})))}).catch(()=>{d&&(x([]),z([]))}),()=>{d=!1}},[o]),i.useEffect(()=>{fi({libraryId:o}).then(O).catch(()=>O(null))},[o,b,q]);const U=i.useCallback(d=>{z(re=>Rt(d,re))},[]),de=()=>{const d=crypto.randomUUID();x(re=>[...re,{id:d,type:"default",position:{x:140+re.length*40,y:120+re.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},me=()=>{const d=crypto.randomUUID();x(re=>[...re,{id:d,type:"default",position:{x:180+re.length*40,y:160+re.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ge=async()=>{B(null);try{const d=b.map(ee=>({nodeId:ee.id,nodeType:ee.data.nodeType,payload:{itemType:ee.data.itemType,itemId:ee.data.itemId??null,label:ee.data.label,infoType:ee.data.infoType??null}})),re=q.map(ee=>({edgeId:ee.id,fromNodeId:ee.source,toNodeId:ee.target}));await xi({libraryId:o,nodes:d,edges:re}),B(a.cogita.library.graph.saveSuccess)}catch{B(a.cogita.library.graph.saveFail)}},K=d=>{I&&x(re=>re.map(ee=>ee.id===I.id?{...ee,data:{...ee.data,itemId:(d==null?void 0:d.infoId)??null,itemType:"collection",infoType:"collection",label:(d==null?void 0:d.label)??a.cogita.library.infoTypes.collection}}:ee))},le=d=>{I&&x(re=>re.map(ee=>ee.id===I.id?{...ee,data:{...ee.data,itemId:(d==null?void 0:d.infoId)??null,itemType:"info",infoType:(d==null?void 0:d.infoType)??null,label:(d==null?void 0:d.label)??a.cogita.library.infoTypes.any}}:ee))};return i.useEffect(()=>{if(!I||I.data.nodeType!=="info"||I.data.infoType!=="quote"||!I.data.itemId){ne(null);return}let d=!0;return at({libraryId:o,infoId:I.data.itemId}).then(re=>{if(!d)return;const ee=re.payload,_=(ee==null?void 0:ee.text)??"";if(!_){ne(null);return}const Ne=bt(_),se=Object.values(Ne.nodes).sort((ie,Le)=>ie.depth-Le.depth||ie.start-Le.start).map(ie=>({id:ie.id,text:ie.text,depth:ie.depth}));ne({title:(ee==null?void 0:ee.title)??I.data.label,fragments:se})}).catch(()=>ne(null)),()=>{d=!1}},[o,I]),e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:C,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ge,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:de,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:me,children:a.cogita.library.actions.addInfo}),he?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(he.totalCollections))})}):null,y?e.jsx("p",{className:"cogita-help",children:y}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodes:b,edges:q,onNodesChange:W,onEdgesChange:s,onConnect:U,onNodeClick:(d,re)=>f(re.id),fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),I?e.jsxs("div",{className:"cogita-graph-inspector",children:[I.data.nodeType==="collection"?e.jsx(ze,{libraryId:o,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:I.data.itemId?{id:I.data.itemId,label:I.data.label,infoType:"collection"}:null,onChange:K,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(ze,{libraryId:o,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:I.data.itemId?{id:I.data.itemId,label:I.data.label,infoType:I.data.infoType??void 0}:null,onChange:le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),E?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:E.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:E.fragments.map(d=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:d.id}),e.jsx("span",{children:d.text})]},d.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function sn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o,collectionId:C}){const{libraryName:b}=qa(o),[x,W]=i.useState([]),[q,z]=i.useState("loading"),[s,m]=i.useState("idle"),f=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),he=`/#/cogita/library/${o}`,O=()=>{z("loading"),Jr({libraryId:o}).then(E=>{W(E),z("idle")}).catch(()=>{W([]),z("error")})};i.useEffect(()=>{O()},[o]);const y=async E=>{try{await Yr({libraryId:o,shareId:E}),O()}catch{O()}},B=async E=>{const ne=`${f}/${E}`;try{await navigator.clipboard.writeText(ne),m("copied")}catch{m("failed")}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:he,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${he}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[q==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):q==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):x.filter(E=>!C||E.collectionId===C).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:x.filter(E=>!C||E.collectionId===C).map(E=>e.jsxs("div",{className:"cogita-share-row","data-state":E.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:E.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(E.createdUtc).toLocaleString(),E.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),E.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${f}/${E.shareCode}`}):null]}),E.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[E.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>B(E.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>y(E.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},E.shareId))}),s==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):s==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function cn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o}){const{libraryName:C}=qa(o),[b,x]=i.useState(null),[W,q]=i.useState(null),[z,s]=i.useState(null),[m,f]=i.useState(null),[he,O]=i.useState(null),[y,B]=i.useState(null),E=i.useRef(null),ne=de=>{if(!Number.isFinite(de))return"0 B";if(de<1024)return`${de} B`;const me=de/1024;if(me<1024)return`${me.toFixed(1)} KB`;const ge=me/1024;return ge<1024?`${ge.toFixed(1)} MB`:`${(ge/1024).toFixed(1)} GB`},I=async()=>{x(null),O({loadedBytes:0,totalBytes:null,percent:null});try{x(a.cogita.library.overview.exporting);const de=await yi(o,O),me=URL.createObjectURL(de),ge=document.createElement("a");ge.href=me,ge.download=`cogita-library-${C||o}.json`,ge.click(),URL.revokeObjectURL(me),x(a.cogita.library.overview.exportReady)}catch{x(a.cogita.library.overview.exportFail)}finally{O(de=>de??{loadedBytes:0,totalBytes:null,percent:null})}},U=async de=>{var ge;q(null),s(null),f(null);const me=(ge=de.target.files)==null?void 0:ge[0];if(me)try{q(a.cogita.library.overview.importing),B({loadedBytes:0,totalBytes:me.size,percent:0});const K=await vi(o,me,B,le=>{const d=le.stage==="infos"?a.cogita.library.overview.importStageInfos:le.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;f(a.cogita.library.overview.importLiveProgress.replace("{stage}",d).replace("{done}",String(le.processed)).replace("{total}",String(le.total)).replace("{infos}",String(le.infos)).replace("{connections}",String(le.connections)).replace("{collections}",String(le.collections)))});s({infos:K.infosImported,connections:K.connectionsImported,collections:K.collectionsImported}),q(a.cogita.library.overview.importDone)}catch(K){const le=K instanceof ji&&K.message?` ${K.message}`:"";q(`${a.cogita.library.overview.importFail}${le}`)}finally{E.current&&(E.current.value="")}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:I,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:E,type:"file",accept:"application/json",onChange:U})]})]}),he?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:he.percent??void 0,max:he.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ne(he.loadedBytes)).replace("{total}",he.totalBytes?ne(he.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,y?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:y.percent??void 0,max:y.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ne(y.loadedBytes)).replace("{total}",y.totalBytes?ne(y.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null,W?e.jsx("p",{className:"cogita-help",children:W}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null,z?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(z.infos)).replace("{connections}",String(z.connections)).replace("{collections}",String(z.collections))}):null]})]})})})]})})}function dn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o}){const{libraryName:C}=qa(o),[b,x]=i.useState(""),[W,q]=i.useState([]),z=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:b,onChange:s=>x(s.target.value),placeholder:a.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=b.trim();s&&(q(m=>[{id:z(),name:s},...m]),x(""))},children:a.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[W.length===0?e.jsx("p",{children:a.cogita.library.modules.storyboardsEmpty}):null,W.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function un({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o}){const{libraryName:C}=qa(o),[b,x]=i.useState(""),[W,q]=i.useState([]),z=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:b,onChange:s=>x(s.target.value),placeholder:a.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=b.trim();s&&(q(m=>[{id:z(),name:s},...m]),x(""))},children:a.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[W.length===0?e.jsx("p",{children:a.cogita.library.modules.textsEmpty}):null,W.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function Dr({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o}){const{libraryName:C}=qa(o),b=`/#/cogita/library/${o}`,[x,W]=i.useState(""),[q,z]=i.useState([]),[s,m]=i.useState("idle"),[f,he]=i.useState(0),[O,y]=i.useState(null);i.useEffect(()=>{m("loading");const E=window.setTimeout(()=>{jt({libraryId:o,query:x.trim()||void 0,limit:30}).then(ne=>{z(ne.items),he(ne.total),y(ne.nextCursor??null),m("ready")}).catch(()=>{z([]),he(0),y(null),m("ready")})},240);return()=>window.clearTimeout(E)},[o,x]);const B=async()=>{if(O){m("loading");try{const E=await jt({libraryId:o,query:x.trim()||void 0,limit:30,cursor:O});z(ne=>[...ne,...E.items]),y(E.nextCursor??null),he(E.total),m("ready")}catch{m("ready")}}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:b,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${b}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:x,onChange:E=>W(E.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(q.length)).replace("{total}",String(f||q.length))}),e.jsx("span",{children:s==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:q.length?q.map(E=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${b}/collections/${E.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:E.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(E.itemCount))," ·"," ",E.notes||a.cogita.library.collections.noNotes]})]})},E.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${b}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),O?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:B,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}function gn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o,collectionId:C}){qa(o);const b=`/#/cogita/library/${o}`,[x,W]=i.useState(a.cogita.library.collections.defaultName),[q,z]=i.useState(null),[s,m]=i.useState(0),[f,he]=i.useState([]),[O,y]=i.useState("idle"),[B,E]=i.useState(null),ne=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(s||f.length)),[a,f.length,s]);i.useEffect(()=>{Wt(o,C).then(U=>{W(U.name),z(U.notes??null),m(U.itemCount)}).catch(()=>{W(a.cogita.library.collections.defaultName),z(null)})},[o,C]),i.useEffect(()=>{y("loading"),At({libraryId:o,collectionId:C,limit:40}).then(U=>{he(U.items),E(U.nextCursor??null),m(U.total),y("ready")}).catch(()=>{he([]),E(null),y("ready")})},[o,C]);const I=async()=>{if(B){y("loading");try{const U=await At({libraryId:o,collectionId:C,limit:40,cursor:B});he(de=>[...de,...U.items]),E(U.nextCursor??null),m(U.total),y("ready")}catch{y("ready")}}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:q||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:b,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${b}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${b}/collections/${C}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${b}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ne}),e.jsx("span",{children:O==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:f.length?f.map(U=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:U.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:U.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:U.label}),e.jsx("p",{className:"cogita-card-subtitle",children:U.description})]})},fe(U))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),B?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:I,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${b}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Oa=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,l=a.filter(w=>w.correct).length,u=zt(kr(a));return{score:Math.round(Math.max(0,Math.min(100,u.knowness*100))*100)/100,total:n,correct:l,lastReviewedUtc:u.lastReviewedUtc??null}},hn=a=>{if(a.maskBase64)try{const n=wi(a.maskBase64);if(!n.length)return a.correct?1:0;const l=n.reduce((u,g)=>u+g,0);return Math.max(0,Math.min(1,l/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},kr=a=>a.map(n=>({correctness:hn(n),createdUtc:n.createdUtc})),zt=(a,n=Date.now())=>{var s;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const u=a.slice().sort((m,f)=>m.createdUtc.localeCompare(f.createdUtc)).slice(-5),g=u.reduce((m,f)=>m+f.correctness,0)/u.length,w=5,p=2,P=.15;let M=0,F=0;for(let m=0;m<u.length;m+=1){const f=new Date(u[m].createdUtc).getTime(),he=m===u.length-1?n:new Date(u[m+1].createdUtc).getTime(),O=Math.max(0,(he-f)/(1e3*60)),y=1-Math.exp(-O/w);M+=y,u[m].correctness>.5&&(F+=P)}let o=g*M*p+F;const C=((s=u[u.length-1])==null?void 0:s.createdUtc)??null,b=C?Math.max(0,(n-new Date(C).getTime())/(1e3*60)):0,W=1/(1+Math.log1p(b/60));return o*=W,u.length===1&&u[0].correctness>.5&&(o+=5.44*Math.exp(-b/2)),{knowness:o,avgCorrectness:g,lastReviewedUtc:C}},wt=a=>{const n=a.slice();for(let l=n.length-1;l>0;l-=1){const u=Math.floor(Math.random()*(l+1));[n[l],n[u]]=[n[u],n[l]]}return n},Pt=a=>a[Math.floor(Math.random()*a.length)],bn=(a,n)=>{const l=new Map;return a.forEach(u=>l.set(u,Math.random())),a.sort((u,g)=>{const w=n(u)-n(g);return w!==0?w:(l.get(u)??0)-(l.get(g)??0)})},Ht=(a,n,l,u,g)=>{if(!a.length)return null;const w=a.filter(P=>!(g!=null&&g.has(fe(P))));if(w.length===0)return null;const p=w.filter(P=>fe(P)!==l);return Pt(p.length?p:w)},mn=(a,n,l,u,g)=>{if(!a.length)return null;let w=Number.POSITIVE_INFINITY;for(const F of a){const o=fe(F);if(l.has(o))continue;const C=n[o]??1;C<w&&(w=C)}if(!Number.isFinite(w))return null;const p=a.filter(F=>{const o=fe(F);return!l.has(o)&&(n[o]??1)===w}),P=p.filter(F=>!g||fe(F)!==g),M=u?P.filter(F=>!u.has(fe(F))):P;return M.length>0?Pt(M):P.length>0?Pt(P):g&&p.some(F=>fe(F)===g)?p.find(F=>fe(F)===g)??null:p.length?Pt(p):null},ei=(a,n,l,u,g)=>{const w=[],p=a.filter(M=>!g.has(fe(M))&&!l.has(fe(M))&&(n[fe(M)]??0)<1),P=bn(p,M=>n[fe(M)]??0);for(const M of P){if(w.length>=u)break;w.push(M),g.add(fe(M))}if(w.length<u){const M=wt(a.filter(F=>!g.has(fe(F))&&l.has(fe(F))));for(const F of M){if(w.length>=u)break;w.push(F),g.add(fe(F))}}return w},pn=(a,n,l,u)=>ei(a,n,l,u,new Set),Tr=(a,n,l,u,g,w)=>{const p=Math.max(1,l.stackSize??n),M=wt(a).filter((W,q,z)=>z.findIndex(s=>fe(s)===fe(W))===q),F=pn(M,u,g,p),o=new Set,C=new Set,b=Ht(F,{},null,o,C),x=b?[b]:[];return b&&C.add(fe(b)),{queue:x,meta:{pool:M,active:F,knownessMap:u,unknownSet:g,outcomesById:w,asked:o,queued:C}}},mr={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const u=wt(a).filter((g,w,p)=>p.findIndex(P=>fe(P)===fe(g))===w);return{queue:u.slice(0,Math.min(n,u.length)),meta:{}}},applyOutcome:a=>a},Nr=(a,n,l,u)=>{const g=Math.max(1,l.stackSize??n),p=wt(a).filter((q,z,s)=>s.findIndex(m=>fe(m)===fe(q))===z),P={},M=new Set,F=new Set,o=new Set,C=Math.max(1,l.levels??1);p.forEach(q=>{const z=fe(q),s=u==null?void 0:u[z],m=typeof s=="number"&&Number.isFinite(s)?s:1;P[z]=Math.min(C,Math.max(1,Math.round(m)))});const b=[];if(p.length>0){const q=new Map;p.forEach(s=>{var f;const m=P[fe(s)]??1;q.has(m)||q.set(m,[]),(f=q.get(m))==null||f.push(s)});const z=Array.from(q.keys()).sort((s,m)=>s-m);for(const s of z){if(b.length>=g)break;const m=wt(q.get(s)??[]);for(const f of m){if(b.length>=g)break;b.push(f)}}}const x=Ht(b,P,null,M,F),W=x?[x]:[];return x&&F.add(fe(x)),{queue:W,meta:{pool:p,active:b,levelMap:P,asked:M,queued:F,wrongSinceCorrect:o}}},fn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,l)=>Nr(a,n,l),applyOutcome:(a,n,l,u,g)=>{if(!n)return a;const w=Math.max(1,u.levels??1),p=a.meta.pool??[],P=a.meta.active??[],M={...a.meta.levelMap??{}},F=new Set(a.meta.asked??[]),o=new Set(a.meta.queued??[]),C=new Set(a.meta.wrongSinceCorrect??[]),b=fe(n);o.delete(b),F.add(b);const x=M[b]??1;g.correct?(M[b]=C.has(b)?1:Math.min(x+1,w),C.delete(b)):(M[b]=1,C.add(b));const W=g.correct?P.filter(s=>fe(s)!==b):P.slice();if(g.correct&&W.length<Math.max(1,u.stackSize??1)){const s=new Set(W.map(f=>fe(f))),m=mn(p,M,s,F,b);m&&W.push(m)}const q=a.queue.slice(),z=Ht(W,M,b,F,o);return z&&(q.push(z),o.add(fe(z))),{queue:q,meta:{pool:p,active:W,levelMap:M,asked:F,queued:o,wrongSinceCorrect:C}}}},xn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,l)=>Tr(a,n,l,{},new Set,{}),applyOutcome:(a,n,l,u,g)=>{if(!n)return a;const w=a.meta.pool??[],p=a.meta.active??[],P={...a.meta.knownessMap??{}},M=new Set(a.meta.unknownSet??[]),F={...a.meta.outcomesById??{}},o=new Set(a.meta.asked??[]),C=new Set(a.meta.queued??[]),b=fe(n);C.delete(b),o.add(b);const x={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},q=(F[b]??[]).concat(x).sort((O,y)=>O.createdUtc.localeCompare(y.createdUtc)).slice(-5);F[b]=q,M.delete(b);const z=Date.now();w.forEach(O=>{const y=fe(O),B=F[y]??[];if(B.length===0){P[y]=0,M.add(y);return}const E=zt(B,z);P[y]=E.knowness});const s=p.slice();if((P[b]??0)>=1){const O=s.filter(y=>fe(y)!==b);s.length=0,s.push(...O)}const f=Math.max(1,u.stackSize??l);if(s.length<f){const O=new Set(s.map(B=>fe(B))),y=ei(w,P,M,f-s.length,O);s.push(...y)}const he=a.queue.slice();if(he.length===0||fe(he[he.length-1])===b){const O=Ht(s,{},b,o,C);O&&(he.push(O),C.add(fe(O)))}return{queue:he,meta:{pool:w,active:s,knownessMap:P,unknownSet:M,outcomesById:F,asked:o,queued:C}}}},ai={random:mr,levels:fn,temporal:xn},yn=Object.values(ai),Lr=a=>{if(!a)return mr;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?ai[n]:mr},Jt=(a,n)=>{const l={...a.defaultSettings};return n&&Object.entries(n).forEach(([u,g])=>{typeof g=="number"&&Number.isFinite(g)&&(l[u]=g),typeof g=="string"&&(l[u]=g)}),a.settingsFields.forEach(u=>{var w;const g=l[u.key];if(u.type==="number"){if(typeof g!="number"||Number.isNaN(g)){l[u.key]=a.defaultSettings[u.key]??0;return}u.min!==void 0&&(l[u.key]=Math.max(u.min,l[u.key])),u.max!==void 0&&(l[u.key]=Math.min(u.max,l[u.key]));return}if(u.type==="select"){const p=((w=u.options)==null?void 0:w.map(P=>P.value))??[];(typeof g!="string"||p.length>0&&!p.includes(g))&&(l[u.key]=a.defaultSettings[u.key]??p[0]??"")}}),l},ti=(a,n)=>{const l={};return a.settingsFields.forEach(u=>{const g=n.get(u.key);if(g){if(u.type==="number"){const w=Number(g);Number.isNaN(w)||(l[u.key]=w);return}l[u.key]=g}}),Jt(a,l)},vn=(a,n)=>{const l=new URLSearchParams;return a.settingsFields.forEach(u=>{const g=n[u.key];(typeof g=="number"||typeof g=="string")&&l.set(u.key,String(g))}),l};function jn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o,collectionId:C,revisionId:b}){const{libraryName:x}=qa(o),W=`/#/cogita/library/${o}`,[q,z]=i.useState(a.cogita.library.collections.defaultName),[s,m]=i.useState(""),[f,he]=i.useState(20),[O,y]=i.useState("random"),[B,E]=i.useState({}),[ne,I]=i.useState("exact"),[U,de]=i.useState([]),[me,ge]=i.useState(null),[K,le]=i.useState([]),[d,re]=i.useState("idle"),[ee,_]=i.useState(null),[Ne,se]=i.useState("idle"),[ie,Le]=i.useState("idle"),[Re,Ce]=i.useState("idle"),$e=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ke=i.useMemo(()=>Lr(O),[O]),Qe=i.useMemo(()=>Jt(ke,B),[ke,B]),Oe=i.useMemo(()=>vn(ke,Qe).toString(),[ke,Qe]);i.useEffect(()=>{Wt(o,C).then(X=>z(X.name)).catch(()=>z(a.cogita.library.collections.defaultName))},[o,C]),i.useEffect(()=>{b&&ki({libraryId:o,collectionId:C,revisionId:b}).then(X=>{m(X.name),y(X.mode||"random"),I(X.check||"exact"),he(X.limit||20),E(X.revisionSettings??{})}).catch(()=>{m("")})},[C,o,b]),i.useEffect(()=>{Ti({libraryId:o}).then(X=>{de(X),!me&&X.length>0&&ge(X[0].roleId)}).catch(()=>{de([])})},[o]);const Ae=()=>{Le("loading"),Jr({libraryId:o}).then(X=>{le(X),Le("idle")}).catch(()=>{le([]),Le("error")})};i.useEffect(()=>{Ae()},[o]);const He=async()=>{re("working"),se("idle");try{const X=await Li({libraryId:o,collectionId:C,revisionType:ke.id,revisionSettings:Qe,mode:O,check:ne,limit:f});_(`${$e}/${X.shareCode}${Oe?`?${Oe}`:""}`),re("ready"),Ae()}catch{re("error")}},ia=async()=>{if(b){Ce("saving");try{await Ni({libraryId:o,collectionId:C,revisionId:b,name:s||q,revisionType:ke.id,revisionSettings:Qe,mode:O,check:ne,limit:f}),Ce("saved")}catch{Ce("error")}}},aa=async()=>{if(ee)try{await navigator.clipboard.writeText(ee),se("copied")}catch{se("failed")}},R=async X=>{try{await Yr({libraryId:o,shareId:X}),Ae()}catch{Ae()}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:q}),e.jsx("p",{className:"cogita-library-subtitle",children:x})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:W,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${W}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${W}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${W}/collections/${C}/revision/run?mode=${encodeURIComponent(O)}&check=${encodeURIComponent(ne)}&limit=${f}${Oe?`&${Oe}`:""}${me?`&reviewer=${encodeURIComponent(me)}`:""}${b?`&revisionId=${encodeURIComponent(b)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:s,onChange:X=>m(X.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:O,onChange:X=>y(X.target.value),children:yn.map(X=>e.jsx("option",{value:X.id,children:a.cogita.library.revision[X.labelKey]},X.id))})]}),ke.settingsFields.map(X=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[X.labelKey]}),X.type==="select"?e.jsx("select",{value:String(Qe[X.key]??""),onChange:Fe=>E(Te=>({...Te,[X.key]:Fe.target.value})),children:(X.options??[]).map(Fe=>e.jsx("option",{value:Fe.value,children:a.cogita.library.revision[Fe.labelKey]},Fe.value))}):e.jsx("input",{type:"number",min:X.min,max:X.max,step:X.step,value:Qe[X.key]??0,onChange:Fe=>E(Te=>({...Te,[X.key]:Number(Fe.target.value||0)}))})]},X.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),ke.id!=="levels"&&ke.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:f,onChange:X=>he(Number(X.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:me??"",onChange:X=>ge(X.target.value||null),children:U.map(X=>e.jsx("option",{value:X.roleId,children:X.label},X.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[b?e.jsx("button",{type:"button",className:"cta ghost",onClick:ia,disabled:Re==="saving",children:Re==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${W}/collections/${C}/revision/run?mode=${encodeURIComponent(O)}&check=${encodeURIComponent(ne)}&limit=${f}${Oe?`&${Oe}`:""}${me?`&reviewer=${encodeURIComponent(me)}`:""}${b?`&revisionId=${encodeURIComponent(b)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Re==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),ee?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:ee,readOnly:!0})]}):null,d==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,Ne==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):Ne==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:He,disabled:d==="working",children:d==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),ee?e.jsx("button",{type:"button",className:"cta ghost",onClick:aa,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),ie==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):K.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:K.map(X=>e.jsxs("div",{className:"cogita-share-row","data-state":X.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:X.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(X.createdUtc).toLocaleString(),X.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),X.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>R(X.shareId),children:a.cogita.library.revision.shareRevokeAction})]},X.shareId))})]})]})]})]})})})]})})}function ri({copy:a,currentCard:n,currentTypeLabel:l,prompt:u,languages:g,answer:w,onAnswerChange:p,computedExpected:P,computedAnswers:M,onComputedAnswerChange:F,answerTemplate:o,outputVariables:C,variableValues:b,computedFieldFeedback:x,feedback:W,canAdvance:q,quoteContext:z,quotePlaceholder:s,onCheckAnswer:m,onSkip:f,onLanguageSelect:he,onMarkReviewed:O,onAdvance:y,showCorrectAnswer:B,setShowCorrectAnswer:E,onRevealCorrect:ne,answerMask:I,expectedAnswer:U,hasExpectedAnswer:de,handleComputedKeyDown:me,answerInputRef:ge,computedInputRefs:K,scriptMode:le,setScriptMode:d,matchPairs:re,matchLeftOrder:ee,matchRightOrder:_,matchSelection:Ne,matchActiveLeft:se,matchActiveRight:ie,matchFeedback:Le,onMatchLeftSelect:Re,onMatchRightSelect:Ce}){const $e=i.useMemo(()=>{var Q;const R=!o&&P.length===2?`The {${P[0].key}} is of type {${P[1].key}}`:null,X=o??R;if(!X)return null;const Fe=new Map(P.map(t=>[t.key,t.expected])),Te=new Set,pe=[],Ee=/\{([^}]+)\}/g;let _e=0,Be,Ve=null;for(;(Be=Ee.exec(X))!==null;){const t=X.slice(_e,Be.index);t&&pe.push({type:"text",value:t});const r=((Q=Be[1])==null?void 0:Q.trim())??"",h=r&&Fe.has(r)?r:r&&C&&C[r]?C[r]:null;r&&Te.add(r),h&&Te.add(h),h&&Fe.has(h)?(pe.push({type:"input",value:h}),Ve||(Ve=h)):r&&b&&b[r]!==void 0?pe.push({type:"text",value:b[r]}):pe.push({type:"text",value:Be[0]}),_e=Be.index+Be[0].length}const j=X.slice(_e);return j&&pe.push({type:"text",value:j}),P.filter(t=>!Te.has(t.key)).length>0?null:{parts:pe,expectedByKey:Fe,firstInputKey:Ve}},[o,P,C,b]),ke=()=>{if(!$e)return null;const{parts:R,expectedByKey:X,firstInputKey:Fe}=$e;return e.jsx("div",{className:"cogita-revision-inline-answer",children:R.map((Te,pe)=>{var Ee,_e;return Te.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Te.value},`text-${pe}`):e.jsx("input",{ref:Be=>{K.current[Te.value]=Be},autoFocus:Te.value===Fe,value:M[Te.value]??"",onChange:Be=>F(Te.value,Be.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[Te.value]??(W==="correct"?"correct":W==="incorrect"?"incorrect":void 0),onKeyDown:Be=>He(Be)||me(Be),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Ee=M[Te.value])==null?void 0:Ee.length)??0,((_e=X.get(Te.value))==null?void 0:_e.length)??6)}ch`}},`input-${Te.value}-${pe}`)})})},Qe=i.useMemo(()=>{const R=new Map;return(re??[]).forEach(X=>R.set(X.leftId,X)),R},[re]),Oe=i.useMemo(()=>{const R=new Map;return(re??[]).forEach(X=>R.set(X.rightId,X)),R},[re]);i.useEffect(()=>{var pe;if(n.cardType!=="info"||n.infoType!=="computed"||P.length===0)return;const R=typeof document<"u"?document.activeElement:null;if(R&&(R.tagName==="INPUT"||R.tagName==="TEXTAREA"))return;const X=($e==null?void 0:$e.firstInputKey)??((pe=P[0])==null?void 0:pe.key);if(!X)return;const Fe=K.current[X];if(!Fe)return;const Te=requestAnimationFrame(()=>{Fe.focus()});return()=>cancelAnimationFrame(Te)},[n,P,$e]);const Ae=(()=>{const R=[U??"",...P.map(Te=>Te.expected??"")].join(""),X=[w,...Object.values(M)].join(""),Fe=`${R}${X}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Fe)})(),He=R=>R.ctrlKey&&(R.key==="^"||R.key==="6")?(R.preventDefault(),d(X=>X==="super"?null:"super"),!0):R.ctrlKey&&(R.key==="_"||R.key==="-")?(R.preventDefault(),d(X=>X==="sub"?null:"sub"),!0):!1,ia=()=>{if(!U||!I)return U??"";const R=U.split(""),X=Array.from(I),Fe=X.length>0?X.reduce((Te,pe)=>Te+pe,0)/X.length:127;return R.map((Te,pe)=>{const Ee=X[pe]??Fe,_e=Math.max(0,Math.min(255,Math.round(Ee)));let Be=255,Ve=0;return _e<=127?Ve=Math.round(_e/127*255):(Ve=255,Be=Math.round(255*(1-(_e-127)/128))),e.jsx("span",{style:{color:`rgb(${Be}, ${Ve}, 0)`},children:Te},`mask-${pe}`)})},aa=n.cardType==="info"&&n.infoType==="quote"?(z==null?void 0:z.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:l}),e.jsx("strong",{children:aa})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&re?e.jsxs("div",{className:"cogita-revision-body",children:[u?e.jsx("h2",{children:u}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(ee??[]).map(R=>{const X=Qe.get(R);if(!X)return null;const Fe=(Ne==null?void 0:Ne[R])??null,Te=(Le==null?void 0:Le[R])??null,pe=se===R;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":pe,"data-state":Te??void 0,"data-locked":Fe?"true":void 0,onClick:()=>Re==null?void 0:Re(R),children:[e.jsx("span",{children:X.leftLabel}),Fe&&B?e.jsx("em",{children:"✓"}):null]},R)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(_??[]).map(R=>{const X=Oe.get(R);if(!X)return null;const Fe=Object.values(Ne??{}).includes(R),Te=ie===R;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Fe||Te,"data-locked":Fe?"true":void 0,onClick:()=>Ce==null?void 0:Ce(R),children:e.jsx("span",{children:X.rightLabel})},R)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ge,value:w,onChange:R=>p(R.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":W==="correct"?"correct":W==="incorrect"?"incorrect":void 0,onKeyDown:R=>{R.key==="Enter"&&(R.preventDefault(),R.stopPropagation(),q?y():m())}})]}),Ae?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":le==="super",onClick:()=>d(R=>R==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":le==="sub",onClick:()=>d(R=>R==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,o?null:e.jsx(Et,{value:u??"",mode:"auto"}),P.length>0?(()=>{const R=ke();return R?e.jsx("div",{className:"cogita-inline-answer-wrap",children:R}):e.jsx("div",{className:"cogita-form-grid",children:P.map((X,Fe)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:X.key}),e.jsx("textarea",{ref:Te=>{K.current[X.key]=Te},autoFocus:Fe===0,value:M[X.key]??"",onChange:Te=>F(X.key,Te.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[X.key]??(W==="correct"?"correct":W==="incorrect"?"incorrect":void 0),onKeyDown:Te=>He(Te)||me(Te)})]},X.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ge,value:w,onChange:R=>p(R.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":W==="correct"?"correct":W==="incorrect"?"incorrect":void 0,onKeyDown:R=>{He(R)||R.key==="Enter"&&(R.preventDefault(),R.stopPropagation(),q?y():m())}})]})}),Ae?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":le==="super",onClick:()=>d(R=>R==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":le==="sub",onClick:()=>d(R=>R==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&z?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(z.completed)).replace("{total}",String(z.total))}),e.jsx("p",{className:"cogita-quote-text",children:z.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ge,value:w,onChange:R=>p(R.target.value),placeholder:s??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":W==="correct"?"correct":W==="incorrect"?"incorrect":void 0,onKeyDown:R=>{R.key==="Enter"&&(R.preventDefault(),R.stopPropagation(),q?y():m())}})]}),e.jsx("p",{className:"cogita-quote-text",children:z.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:m,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(R=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>he(R.label),children:R.label},R.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:O,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}),W&&e.jsx("div",{className:"cogita-revision-feedback","data-state":W,children:W==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),W==="incorrect"&&de?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>E(R=>{const X=!R;return X&&ne(),X}),children:a.cogita.library.revision.showAnswer}),B?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),P.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[P.map(R=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:R.key}),e.jsx("span",{children:R.expected})]},R.key)),U?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:U})]}):null]}):e.jsx("p",{children:I?ia():U})]}):null]}):null,q?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:y,children:a.cogita.library.revision.nextQuestion})}):null]})}const or=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ii({outcomes:a}){const[n,l]=i.useState("day"),u=i.useMemo(()=>{const g=or.find(P=>P.id===n)??or[1],w=Date.now()-g.ms,p=a.filter(P=>new Date(P.createdUtc).getTime()>=w);return Oa(p)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:or.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>l(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[u.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[u.correct," / ",u.total]})]})}const wn="cogita-revision",kn=1,Dt="outcomes",Tn=()=>new Promise((a,n)=>{const l=indexedDB.open(wn,kn);l.onupgradeneeded=()=>{const u=l.result;if(!u.objectStoreNames.contains(Dt)){const g=u.createObjectStore(Dt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},l.onerror=()=>n(l.error),l.onsuccess=()=>a(l.result)}),Tt=async(a,n)=>{const l=await Tn();return new Promise((u,g)=>{const w=l.transaction(Dt,a),p=w.objectStore(Dt);n(p).then(u).catch(g),w.onerror=()=>g(w.error)})},ni=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(l=>l.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Nn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const l=ni();return localStorage.setItem(a,l),l},Ln=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),l=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(l)),l},oi=(a,n,l,u)=>Ka(a,n,l,u),Kt=async a=>{const n=Nn(),l=Ln(),u=new Date().toISOString(),g={...a,clientId:n,clientSequence:l,createdUtc:u,id:ni(),pending:!0};return await Tt("readwrite",w=>new Promise((p,P)=>{const M={...g,itemKey:oi(g.itemType,g.itemId,g.checkType,g.direction)},F=w.add(M);F.onsuccess=()=>p(),F.onerror=()=>P(F.error)})),g},Ot=async(a,n,l,u)=>{if(!n)return[];try{const g=oi(a,n,l,u);return await Tt("readonly",w=>new Promise((p,P)=>{const F=w.index("byItem").getAll(g);F.onsuccess=()=>{const C=(F.result??[]).map(b=>({itemType:b.itemType,itemId:b.itemId,checkType:b.checkType??null,direction:b.direction??null,revisionType:b.revisionType,evalType:b.evalType,correct:b.correct,createdUtc:b.createdUtc,maskBase64:b.maskBase64,payloadBase64:b.payloadBase64,payloadHashBase64:b.payloadHashBase64,clientId:b.clientId,clientSequence:b.clientSequence,personRoleId:b.personRoleId??null})).sort((b,x)=>b.createdUtc.localeCompare(x.createdUtc));p(C)},F.onerror=()=>P(F.error)}))}catch{return[]}},Va=async()=>{try{return await Tt("readonly",a=>new Promise((n,l)=>{const u=a.getAll();u.onsuccess=()=>{const w=(u.result??[]).map(p=>({itemType:p.itemType,itemId:p.itemId,checkType:p.checkType??null,direction:p.direction??null,revisionType:p.revisionType,evalType:p.evalType,correct:p.correct,createdUtc:p.createdUtc,maskBase64:p.maskBase64,payloadBase64:p.payloadBase64,payloadHashBase64:p.payloadHashBase64,clientId:p.clientId,clientSequence:p.clientSequence,personRoleId:p.personRoleId??null}));n(w)},u.onerror=()=>l(u.error)}))}catch{return[]}},Cn=async(a=100)=>{try{return await Tt("readonly",n=>new Promise((l,u)=>{const w=n.index("byPending").getAll(!0);w.onsuccess=()=>{const p=w.result??[];l(p.slice(0,a))},w.onerror=()=>u(w.error)}))}catch{return[]}},Mn=async a=>{if(a.length!==0)try{await Tt("readwrite",n=>new Promise((l,u)=>{let g=a.length;a.forEach(w=>{const p=n.get(w);p.onsuccess=()=>{const P=p.result;if(P){P.pending=!1;const M=n.put(P);M.onsuccess=()=>{g-=1,g===0&&l()},M.onerror=()=>u(M.error)}else g-=1,g===0&&l()},p.onerror=()=>u(p.error)})}))}catch{}},lr=async(a,n)=>{const l=await Cn(200);if(l.length===0)return;const u=new Map;l.forEach(g=>{var p;const w=g.personRoleId??n??"";u.has(w)||u.set(w,[]),(p=u.get(w))==null||p.push(g)});for(const[g,w]of u.entries()){const p=w.map(P=>({itemType:P.itemType,itemId:P.itemId,checkType:P.checkType??null,direction:P.direction??null,revisionType:P.revisionType,evalType:P.evalType,correct:P.correct,clientId:P.clientId,clientSequence:P.clientSequence,maskBase64:P.maskBase64??null,payloadHashBase64:P.payloadHashBase64??null,payloadBase64:P.payloadBase64??null,personRoleId:g||null}));try{await Ci({libraryId:a,outcomes:p}),await Mn(w.map(P=>P.id))}catch{}}},Kr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Sn=(a,n)=>{const l=Math.max(a.length,n.length,1),u=Math.abs(a.length-n.length);return Math.max(0,1-u/l)},In=(a,n)=>{const l=new Uint8Array(a.length),u=Sn(a,n);for(let g=0;g<a.length;g+=1){const w=a[g]===(n[g]??"")?128:0,p=a.length-1-g,P=n.length-1-g,M=a[p]===(n[P]??"")?127:0,F=Math.round((w+M)*u);l[g]=Math.max(0,Math.min(255,F))}return l},St=(a,n)=>a===n||(Kr[a]??[]).includes(n)?!0:(Kr[n]??[]).includes(a),Vt=(a,n)=>{const l=new Uint8Array(a.length);if(!a.length)return l;const u=[];for(let w=0;w<=a.length-3;w+=1)u.push({index:w,text:a.slice(w,w+3)});let g=!1;return u.forEach(w=>{for(let p=0;p<=n.length-3;p+=1){const P=n.slice(p,p+3);let M=0;for(let x=0;x<3;x+=1)St(w.text[x],P[x])&&(M+=1);if(M<2)continue;let F=w.index-1,o=p-1;for(;F>=0&&o>=0;){const x=a[F],W=n[o];if(x===W){l[F]=Math.max(l[F],255),F-=1,o-=1,g=!0;continue}if(St(x,W)){l[F]=Math.max(l[F],127),F-=1,o-=1,g=!0;continue}if(F>0&&a[F-1]===W){l[F]=Math.max(l[F],0),F-=1,g=!0;continue}if(o>0&&a[F]===n[o-1]){o-=1,g=!0;continue}break}for(let x=0;x<3;x+=1){const W=w.index+x,q=w.text[x],z=P[x],s=q===z?255:St(q,z)?127:0;l[W]=Math.max(l[W],s),g=!0}let C=w.index+3,b=p+3;for(;C<a.length&&b<n.length;){const x=a[C],W=n[b];if(x===W){l[C]=Math.max(l[C],255),C+=1,b+=1,g=!0;continue}if(St(x,W)){l[C]=Math.max(l[C],127),C+=1,b+=1,g=!0;continue}if(C+1<a.length&&a[C+1]===W){l[C]=Math.max(l[C],0),C+=1,g=!0;continue}if(b+1<n.length&&a[C]===n[b+1]){b+=1,g=!0;continue}break}}}),g?l:In(a,n)},ht=(a,n,l)=>{const u=a.trim().toLowerCase(),g=n.trim().toLowerCase();return Vt(u,g)},mt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),li=(a,n,l)=>{const u=mt(a),g=mt(n);return Vt(u,g)},ka=a=>a.trim().toLowerCase(),Pn=a=>a==="reverse"?"reverse":"forward",kt=(a,n)=>`${a}|${n}`,La=a=>{if(!a)return null;const[n,l]=a.split("|",2);return(n==="forward"||n==="reverse")&&l?{mode:n,fragmentId:l}:{mode:"forward",fragmentId:a}},qt=(a,n)=>{var u;const l=La(n);return l?l.fragmentId&&n?(a??null)===n:(((u=La(a))==null?void 0:u.mode)??"forward")===l.mode:!0},ba=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},si=(a,n)=>{if((ba(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const u=ba(a.childCheckType),g=ba(a.childDirection),w=ba(n.checkType),p=ba(n.direction);return!(u&&u!==w||g&&g!==p)},Rn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},$n={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},_t=(a,n,l)=>{if(!l||!n.startsWith(a))return n;const u=n.slice(a.length);if(!u)return n;const g=l==="super"?Rn:$n,w=u.split("").map(p=>g[p]??p).join("");return a+w},Ut=(a,n,l)=>{var p,P,M;if(!a)return((p=n[0])==null?void 0:p.key)??null;const u=new Set(n.map(F=>F.key)),g=/\{([^}]+)\}/g;let w;for(;(w=g.exec(a))!==null;){const F=((P=w[1])==null?void 0:P.trim())??"";if(!F)continue;if(u.has(F))return F;const o=l==null?void 0:l[F];if(o&&u.has(o))return o}return((M=n[0])==null?void 0:M.key)??null},pr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const l=n.description??"";if(!l.trim())return[n];const u=La(n.direction),g=(u==null?void 0:u.mode)??Pn(n.direction),w=bt(l),p=Object.keys(w.nodes);return p.length===0?[n]:p.map(P=>({...n,checkType:"quote-fragment",direction:kt(g,P)}))});function En({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o,collectionId:C,revisionId:b}){const x=vr(),W=`/#/cogita/library/${o}`,q=i.useMemo(()=>new URLSearchParams(x.search),[x.search]),z=Math.max(1,Number(q.get("limit")??20)),s=q.get("mode")??"random",m=i.useMemo(()=>Lr(s),[s]),f=i.useMemo(()=>Jt(m,ti(m,q)),[m,q]),he=q.get("check")??"exact",O=q.get("reviewer"),y=i.useMemo(()=>a.cogita.library.revision[m.labelKey]??s,[a,s,m]),B=i.useMemo(()=>he==="exact"?a.cogita.library.revision.checkValue:he,[a,he]),[E,ne]=i.useState(a.cogita.library.collections.defaultName),[I,U]=i.useState([]),[de,me]=i.useState([]),[ge,K]=i.useState("idle"),[le,d]=i.useState({current:0,total:0}),[re,ee]=i.useState(0),[_,Ne]=i.useState(""),[se,ie]=i.useState(null),[Le,Re]=i.useState(null),[Ce,$e]=i.useState(null),[ke,Qe]=i.useState(null),[Oe,Ae]=i.useState([]),[He,ia]=i.useState({}),[aa,R]=i.useState({}),[X,Fe]=i.useState(null),[Te,pe]=i.useState(null),[Ee,_e]=i.useState(null),[Be,Ve]=i.useState(null),[j,k]=i.useState(null),[Q,t]=i.useState({}),r=i.useRef(0),[h,T]=i.useState(null),D=i.useRef(null),ae=i.useRef(null),[te,G]=i.useState(null),[ue,oe]=i.useState(!1),[we,ea]=i.useState(null),[qe,ta]=i.useState([]),[De,Ue]=i.useState(null),Ke=i.useRef(null),Xe=i.useRef(null),[Ta,ra]=i.useState(null),[Ra,sa]=i.useState(0),ya=i.useRef(null),V=i.useRef({}),[Me,Ie]=i.useState(!1),[Je,la]=i.useState({}),[ca,fa]=i.useState([]),na=i.useRef(new Map),[ma,xa]=i.useState(new Set),[va,We]=i.useState(!1),oa=i.useRef(null),Ma=i.useRef(new Set),Ba=i.useRef({}),ve=I[re]??null,je=(ve==null?void 0:ve.checkType)==="translation-match"&&j,_a=i.useRef(new Map),ua=i.useRef(new Map),$a=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useMemo(()=>ve?ve.cardType==="vocab"?a.cogita.library.revision.vocabLabel:ve.infoType?Ze(a,ve.infoType):a.cogita.library.revision.infoLabel:"",[a,ve]),Yt=i.useMemo(()=>{var v;return m.id!=="levels"?I.length:((v=Je.pool)==null?void 0:v.length)??m.getFetchLimit(z,f)},[Je,f,m,I.length,z]),rt=m.getProgressTotal?m.getProgressTotal(I,Je,z,f):m.id==="levels"?Math.min(z,Yt):I.length,it=rt?Math.min(re+1,rt):0,Ea=Math.max(1,Number(f.tries??1)),Na=f.compare??"anchors",Ua=Math.max(0,Math.min(100,Number(f.minCorrectness??0))),pa=(f.considerDependencies??"on")==="on",da=Math.max(0,Math.min(100,Number(f.dependencyThreshold??85))),Pa=c=>{const v=c.slice();for(let S=v.length-1;S>0;S-=1){const N=Math.floor(Math.random()*(S+1));[v[S],v[N]]=[v[N],v[S]]}return v},Ha=c=>c.length?c.reduce((S,N)=>S+N,0)/c.length/255*100:0,Wa=c=>Ha(c)>=Ua,nt=async()=>{const c=await Va(),v=new Map,S=new Map,N=new Map;c.forEach(A=>{const J=`${A.itemType}:${A.itemId}`,ce=Ka(A.itemType,A.itemId,A.checkType,A.direction);if(v.has(J)||v.set(J,[]),v.get(J).push(A),S.has(ce)||S.set(ce,[]),S.get(ce).push(A),A.itemType==="info"&&A.checkType==="quote-fragment"&&A.direction){const be=`${A.itemId}:${A.direction}`;N.has(be)||N.set(be,[]),N.get(be).push(A)}});const Y=new Map,L=new Map,H=new Map;return v.forEach((A,J)=>Y.set(J,Oa(A).score)),S.forEach((A,J)=>L.set(J,Oa(A).score)),N.forEach((A,J)=>H.set(J,Oa(A).score)),{itemKnowness:Y,cardKnowness:L,fragmentKnowness:H}},Qt=async c=>{const v=[];let S=null;for(;;){const N=await At({libraryId:o,collectionId:c,limit:200,cursor:S});if(v.push(...N.items),!N.nextCursor)break;S=N.nextCursor}return pr(v)},ft=async(c,v)=>{if(na.current.has(c))return na.current.get(c)??0;const S=await Qt(c);if(S.length===0)return na.current.set(c,0),0;const Y=S.reduce((L,H)=>{const A=fe(H);return L+(v.get(A)??0)},0)/S.length;return na.current.set(c,Y),Y},Gt=(c,v)=>{if(!pa||c.cardType!=="info"||c.infoType!=="quote"||c.checkType!=="quote-fragment")return!0;const S=La(c.direction);if(!(S!=null&&S.fragmentId))return!0;const N=c.description??"";if(!N.trim())return!0;const L=bt(N).nodes[S.fragmentId];if(!L||!L.leftId&&!L.rightId)return!0;const H=[L.leftId,L.rightId].filter(ce=>!!ce);if(H.length===0)return!0;const A=H.map(ce=>{const be=Ka("info",c.cardId,"quote-fragment",kt(S.mode,ce));return v.get(be)??0});return A.reduce((ce,be)=>ce+be,0)/A.length>=da},ot=async c=>{const v=Je,S=c.concat(v.active??[]).concat(v.pool??[]).filter((A,J,ce)=>ce.findIndex(be=>fe(be)===fe(A))===J);if(!pa){xa(new Set(S.map(fe)));return}const{itemKnowness:N,cardKnowness:Y}=await nt(),L=ca.filter(A=>ba(A.childItemType)==="collection"&&A.childItemId===C&&!ba(A.childCheckType)&&!ba(A.childDirection)),H=new Set;for(const A of S){if(A.cardType!=="info"){H.add(fe(A));continue}if(!Gt(A,Y))continue;const J=ca.filter(ye=>si(ye,A)).concat(L);if(J.length===0){H.add(fe(A));continue}let ce=0;for(const ye of J)if(ba(ye.parentItemType)==="collection")ce+=await ft(ye.parentItemId,Y);else if(ba(ye.parentCheckType)||ba(ye.parentDirection)){const xe=ba(ye.parentCheckType),Se=ba(ye.parentDirection),Pe=Ka(ye.parentItemType,ye.parentItemId,xe,Se);ce+=Y.get(Pe)??0}else{const xe=`${ye.parentItemType}:${ye.parentItemId}`;ce+=N.get(xe)??0}ce/J.length>=da&&H.add(fe(A))}xa(H)},Xt=c=>{for(let v=c;v<I.length;v+=1){const S=I[v];if(S&&(!pa||S.cardType!=="info"||ma.has(fe(S))))return v}return-1},Sa=c=>!pa||c.cardType!=="info"||ma.has(fe(c)),lt=c=>{if(m.id!=="temporal"&&m.id!=="levels")return null;const v=Je,S=(v.active??[]).concat(v.pool??[]),N=new Set;for(const Y of S){const L=fe(Y);if(!(N.has(L)||c.has(L))&&(N.add(L),Sa(Y)))return Y}return null},Aa=i.useMemo(()=>{if(m.id!=="levels")return null;const c=Je,v=c.pool??[],S=c.active??[],N=c.levelMap??{},Y=Math.max(1,Number(f.levels??1)),L=Array.from({length:Y},()=>0),H=new Set(S.map(be=>fe(be)));v.forEach(be=>{const ye=Math.min(Y,Math.max(1,N[fe(be)]??1));L[ye-1]+=1});const A=v.length||1,J=L.map(be=>be/A*100),ce=ve?N[fe(ve)]??1:null;return{counts:L,percentages:J,currentLevel:ce,levelsCount:Y,activeCount:S.length,poolCount:v.length,activeSet:H}},[Je,f,m,ve]),ja=i.useMemo(()=>{if(m.id!=="temporal")return null;const c=Je,v=c.pool??[],S=c.active??[],N=c.knownessMap??{},Y=new Set(c.unknownSet??[]);let L=0;v.forEach(J=>{(N[fe(J)]??0)>1&&(L+=1)});const H=Y.size,A=S.map(J=>({id:fe(J),value:Y.has(fe(J))?0:Math.max(0,Math.min(1,N[fe(J)]??0))}));return{knownCount:L,unknownCount:H,dots:A}},[Je,m]),st=i.useMemo(()=>{if(!pa)return 0;const c=Je;return I.concat(c.active??[]).concat(c.pool??[]).filter((S,N,Y)=>Y.findIndex(L=>fe(L)===fe(S))===N).filter(S=>S.cardType==="info"&&!ma.has(fe(S))).length},[pa,Je,I,ma]);i.useEffect(()=>{if(!pa||ge!=="ready")return;const c=Je,S=I.concat(c.active??[]).concat(c.pool??[]).filter((L,H,A)=>A.findIndex(J=>fe(J)===fe(L))===H).filter(L=>L.cardType!=="info"||ma.has(fe(L))).length,N=Ke.current;if(Ke.current=S,N===null||S<=N)return;const Y=S-N;Ue(`New card available (+${Y})`),Xe.current&&window.clearTimeout(Xe.current),Xe.current=window.setTimeout(()=>Ue(null),2200)},[pa,ge,Je,I,ma]),i.useEffect(()=>()=>{Xe.current&&window.clearTimeout(Xe.current)},[]);const wa=(c,v)=>{const S=m.applyOutcome({queue:I,meta:Je},ve,z,f,{correct:c,correctness:v,createdUtc:new Date().toISOString()});U(S.queue),la(S.meta);const N=S.queue[re+1];N&&xt(N,re+1)};i.useEffect(()=>{Wt(o,C).then(c=>ne(c.name)).catch(()=>ne(a.cogita.library.collections.defaultName))},[o,C]),i.useEffect(()=>{jr({libraryId:o,type:"language"}).then(c=>me(c)).catch(()=>me([]))},[o]),i.useEffect(()=>{Hr({libraryId:o}).then(c=>fa(c.items??[])).catch(()=>fa([]))},[o]),i.useEffect(()=>{lr(o,O)},[o,O]),i.useEffect(()=>{ot(I)},[I,ca,pa,da,C]),i.useEffect(()=>{if(!ve||!pa){We(!1);return}if(ve.cardType!=="info"||ma.has(fe(ve))){We(!1);return}const c=Xt(re+1);if(c>=0){We(!1),ee(c);return}if(m.id==="temporal"||m.id==="levels"){const v=I.slice(0,re+1),S=I.slice(re+1).filter(Sa),N=v.concat(S),Y=new Set(N.map(fe)),L=lt(Y);if(L){const A=fe(L);Y.has(A)||(N.push(L),Y.add(A),la(J=>{const ce=J,be=new Set(ce.queued??[]);return be.add(A),{...ce,queued:be}}))}const H=N.findIndex((A,J)=>J!==re&&Sa(A));if(H>=0){U(N),ee(H),We(!1);return}}We(!0)},[ve,ma,pa,re,I,Je,m.id]),i.useEffect(()=>{let c=!0;return(async()=>{K("loading"),d({current:0,total:m.id==="levels"?0:m.getFetchLimit(z,f)});try{const S=[];let N=null,Y=null;do{const ye=await At({libraryId:o,collectionId:C,limit:300,cursor:N});if(S.push(...ye.items),(m.id==="levels"||m.id==="temporal")&&ye.total&&(Y=ye.total),d(xe=>({current:S.length,total:xe.total||ye.total||m.getFetchLimit(z,f)})),N=ye.nextCursor??null,Y!==null&&S.length>=Y||m.id!=="levels"&&m.id!=="temporal"&&S.length>=m.getFetchLimit(z,f))break}while(N);if(!c)return;const L=pr(S);let H;if(m.id==="levels"){const ye=Math.max(1,Number(f.levels??1)),Se=(await Va()).reduce((Pe,Ye)=>{const Ge=Ka(Ye.itemType,Ye.itemId,Ye.checkType,Ye.direction);return Pe[Ge]||(Pe[Ge]=[]),Pe[Ge].push(Ye),Pe},{});H={},L.forEach(Pe=>{const Ye=fe(Pe),Ge=Se[Ye]??[],ha=Ge.length>0?Oa(Ge).score:0,Xa=Math.max(1,Math.min(ye,Math.ceil(ha/100*ye)));H[Ye]=Xa})}let A=null,J=null,ce=null;if(m.id==="temporal"){const ye=await Va(),xe=new Set(L.map(Ye=>fe(Ye))),Se=ye.reduce((Ye,Ge)=>{const ha=Ka(Ge.itemType,Ge.itemId,Ge.checkType,Ge.direction);return xe.has(ha)&&(Ye[ha]||(Ye[ha]=[]),Ye[ha].push(Ge)),Ye},{});A={},J=new Set,ce={};const Pe=Date.now();L.forEach(Ye=>{const Ge=fe(Ye),ha=Se[Ge]??[];if(ha.length===0){A[Ge]=0,J.add(Ge),ce[Ge]=[];return}const Xa=kr(ha);ce[Ge]=Xa;const di=zt(Xa,Pe);A[Ge]=di.knowness})}const be=m.id==="levels"?Nr(L,z,f,H):m.id==="temporal"?Tr(L,z,f,A??{},J??new Set,ce??{}):m.prepare(L,z,f);U(be.queue),la(be.meta),ee(0),K("ready"),d(ye=>({current:Math.min(ye.current,ye.total),total:ye.total}))}catch{c&&K("error")}})(),()=>{c=!1}},[o,C,z,f,m,O]),i.useEffect(()=>{if(Ne(""),ie(null),ra(null),sa(0),Ae([]),ia({}),R({}),pe(null),_e(null),Ve(null),oe(!1),Ie(!1),G(null),k(null),t({}),!ve){Re(null),$e(null),Fe(null),ea(null);return}ve.cardType==="info"&&ve.infoType==="computed"&&Re(a.cogita.library.revision.loadingComputed);let c=!0;return xt(ve,re).then(v=>{!c||!v||(Re(v.prompt),$e(v.expectedAnswer),Ae(v.computedExpected),ia(v.computedAnswers),Fe(v.computedValues),pe(v.answerTemplate),_e(v.outputVariables),Ve(v.variableValues))}),()=>{c=!1}},[ve,a]),i.useEffect(()=>{if(!ve||ve.cardType!=="info"||ve.infoType!=="quote"){oa.current=null,Ma.current=new Set,Qe(null);return}const c=ve.description??"",v=(ve.label??"").trim(),S=v.replace(/\s+/g," ").trim(),N=c.replace(/\s+/g," ").trim(),Y=S&&S!==N?v:a.cogita.library.infoTypes.quote;if(!c){Qe(null),$e(null);return}const L=bt(c);oa.current=L,Re(Y);let H=!0;return nt().then(({fragmentKnowness:A})=>{if(!H)return;const J=getQuoteMode(ve.direction),ce=new Set,be={};A.forEach((Se,Pe)=>{const[Ye,Ge]=Pe.split(":",2);if(Ye!==ve.cardId)return;const ha=La(Ge);if(!ha||ha.mode!==J)return;const Xa=ha.fragmentId;be[Xa]=Se,Se>=da&&ce.add(Xa)}),Ma.current=ce,Ba.current=be;const ye=La(ve.direction);if(ye!=null&&ye.fragmentId&&L.nodes[ye.fragmentId]){Da(L,ye.fragmentId,Y);return}const xe=gt(L,ce,be,da,pa,ve.direction);Da(L,(xe==null?void 0:xe.id)??null,Y)}).catch(()=>{Ma.current=new Set,Ba.current={};const A=La(ve.direction);if(A!=null&&A.fragmentId&&L.nodes[A.fragmentId]){Da(L,A.fragmentId,Y);return}const J=gt(L,Ma.current,{},da,pa,ve.direction);Da(L,(J==null?void 0:J.id)??null,Y)}),()=>{H=!1}},[ve,a,pa,da]),i.useEffect(()=>{if(!ve||ve.cardType!=="vocab"||ve.checkType!=="translation-match"){k(null),t({});return}const S=(Je.pool??Je.active??I).filter(A=>A.cardType==="vocab"&&A.checkType==="translation-match").filter((A,J,ce)=>ce.findIndex(be=>be.cardId===A.cardId)===J);S.some(A=>A.cardId===ve.cardId)||S.unshift(ve);const Y=Pa(S).slice(0,6).map(A=>{const J=A.label.split("↔").map(ye=>ye.trim()).filter(Boolean);if(J.length<2)return null;const ce=`${A.cardId}:L`,be=`${A.cardId}:R`;return{cardId:A.cardId,leftId:ce,rightId:be,leftLabel:J[0],rightLabel:J[1]}}).filter(Boolean),L=Y.map(A=>A.leftId),H=Pa(Y.map(A=>A.rightId));k({pairs:Y,leftOrder:L,rightOrder:H,selection:{},activeLeft:null,activeRight:null,locked:{}})},[ve,I,Je]),i.useEffect(()=>()=>{D.current&&window.clearTimeout(D.current),ae.current&&window.clearTimeout(ae.current)},[]);const Ja=i.useRef(null);i.useEffect(()=>{if(!ve)return;const c=fe(ve),v=typeof document<"u"?document.activeElement:null;if(Ja.current===c&&v&&(v.tagName==="INPUT"||v.tagName==="TEXTAREA"))return;let S=0;const N=()=>{if(ve){if(ve.cardType==="info"&&ve.infoType==="computed"){if(Oe.length>0){const L=Ut(Te,Oe,Ee),H=L?V.current[L]:null;if(H&&(H.focus(),document.activeElement===H)){Ja.current=c;return}}if(ya.current&&(ya.current.focus(),document.activeElement===ya.current)){Ja.current=c;return}}else if(ve.cardType==="vocab"&&ya.current&&(ya.current.focus(),document.activeElement===ya.current)){Ja.current=c;return}S<6&&(S+=1,window.setTimeout(N,40))}},Y=window.setTimeout(N,40);return()=>window.clearTimeout(Y)},[ve,Oe,Te,Ee]),i.useEffect(()=>{if(!Me)return;const c=v=>{v.key==="Enter"&&(v.preventDefault(),dt())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[Me]);const Ya=c=>{ta(c),ea(Oa(c))};i.useEffect(()=>{if(!ve){ea(null),ta([]);return}const c=ve.cardType==="info"?"info":"connection";if(ve.cardType==="info"&&ve.infoType==="quote"){Va().then(v=>{const S=v.filter(N=>N.itemType==="info"&&N.itemId===ve.cardId&&N.checkType==="quote-fragment"&&qt(N.direction,ve.direction));Ya(S)}).catch(()=>{ea(null),ta([])});return}Ot(c,ve.cardId,ve.checkType,ve.direction).then(v=>Ya(v)).catch(()=>{ea(null),ta([])})},[o,ve,O]);const Nt=(c,v,S,N)=>{if(c==="info"&&S==="quote-fragment"){Va().then(Y=>{const L=Y.filter(H=>H.itemType==="info"&&H.itemId===v&&H.checkType==="quote-fragment"&&qt(H.direction,N));Ya(L)}).catch(()=>{ea(null),ta([])});return}Ot(c,v,S,N).then(Y=>Ya(Y)).catch(()=>{ea(null),ta([])})},Lt=(c,v,S)=>{var H;const N=((H=S.pairs.find(A=>A.leftId===c))==null?void 0:H.rightId)??null;if(!N)return S;const Y=N===v;t(A=>({...A,[c]:Y?"correct":"incorrect"})),D.current&&window.clearTimeout(D.current),ae.current&&window.clearTimeout(ae.current),r.current+=1;const L={kind:Y?"correct":"incorrect",tick:r.current};if(T(null),D.current=window.setTimeout(()=>T(L),0),ae.current=window.setTimeout(()=>T(null),420),Y){const A={...S.locked,[c]:!0};return Object.keys(A).length>=S.pairs.length?(ie("correct"),Ie(!0)):ie("correct"),{...S,selection:{...S.selection,[c]:v},activeLeft:null,activeRight:null,locked:A}}return ie("incorrect"),{...S,activeLeft:null,activeRight:null}},ct=c=>{k(v=>!v||v.locked[c]?v:v.activeRight?Lt(c,v.activeRight,v):{...v,activeLeft:v.activeLeft===c?null:c})},Fa=c=>{k(v=>v&&(v.activeLeft?Lt(v.activeLeft,c,v):{...v,activeRight:v.activeRight===c?null:c}))},dt=()=>{var c;if(ve&&ve.cardType==="info"&&ve.infoType==="quote"&&oa.current&&ke&&!((c=La(ve.direction))!=null&&c.fragmentId)){const v=gt(oa.current,Ma.current,Ba.current,da,pa,ve.direction,ke.fragmentId);if(v){ie(null),Ne(""),oe(!1),R({}),Ie(!1),ra(null),sa(0),Da(oa.current,v.id,ke.title);return}}ie(null),Ne(""),oe(!1),R({}),Ie(!1),ra(null),sa(0),ee(v=>Math.min(v+1,I.length))},Ia=c=>{if(!ve)return;const v=c.expected??null,S=c.answer??"";let N=v??"",Y=S;if(!v&&c.expectedMap&&c.answerMap){const ye=Object.keys(c.expectedMap).sort((xe,Se)=>xe.localeCompare(Se));N=ye.map(xe=>{var Se;return((Se=c.expectedMap)==null?void 0:Se[xe])??""}).join("|"),Y=ye.map(xe=>{var Se;return((Se=c.answerMap)==null?void 0:Se[xe])??""}).join("|")}const L=N?ht(N,Y,Na):new Uint8Array,H={revisionType:m.id,evalType:c.evalType,direction:c.direction,prompt:Le??"",expected:v,answer:S,expectedAnswers:c.expectedMap??null,answers:c.answerMap??null,correct:c.correct,maskBase64:L.length?za(L):null,values:X??null,checkMode:he,compareMode:Na,minCorrectness:Ua},A=new TextEncoder().encode(JSON.stringify(H)),J=ve.cardType==="info"?"info":"connection",ce=c.overrideCheckType??ve.checkType??null,be=c.overrideDirection??ve.direction??null;Kt({itemType:J,itemId:ve.cardId,checkType:ce,direction:be,revisionType:m.id,evalType:c.evalType,correct:c.correct,maskBase64:L.length?za(L):null,payloadBase64:za(A),personRoleId:O??null}).then(()=>{Nt(J,ve.cardId,ce,be),ot(I),lr(o,O)}).catch(()=>{})},Qa=(c,v)=>{const S=_a.current.get(v);if(S)return Promise.resolve(S);const N=ua.current.get(v);if(N)return N;const Y=at({libraryId:o,infoId:c}).then(L=>{var ye,xe;const H=L.payload,A=((ye=H.definition)==null?void 0:ye.graph)??null,J="",ce=((xe=H.definition)==null?void 0:xe.answerTemplate)??"",be=wr(A,J,ce);if(be){const Pe={sample:Xr(be),answerTemplate:ce||null};return _a.current.set(v,Pe),Pe}return hr({libraryId:o,infoId:c}).then(Se=>{const Pe={sample:Se,answerTemplate:null};return _a.current.set(v,Pe),Pe})}).catch(()=>hr({libraryId:o,infoId:c}).then(L=>{const H={sample:L,answerTemplate:null};return _a.current.set(v,H),H}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{ua.current.delete(v)});return ua.current.set(v,Y),Y},xt=(c,v)=>{var A;const S=`${fe(c)}:${v}`,N=$a.current.get(S);if(N)return Promise.resolve(N);const Y=tt.current.get(S);if(Y)return Y;const L=J=>($a.current.set(S,J),J);let H;if(c.cardType==="vocab"){if(c.checkType==="translation-match")return H=Promise.resolve(L({prompt:c.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),H;const J=c.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(J.length>=2){const be=(c.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ye=be?J[0]:J[1],xe=be?J[1]:J[0];H=Promise.resolve(L({prompt:ye,expectedAnswer:xe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else H=Promise.resolve(L({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(c.cardType==="info"&&c.infoType==="word"){const J=(A=c.description)!=null&&A.startsWith("Language: ")?c.description.replace("Language: ",""):null;H=Promise.resolve(L({prompt:c.label,expectedAnswer:J,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else c.cardType==="info"&&c.infoType==="computed"?H=Qa(c.cardId,S).then(J=>{var Se,Pe;if(!J.sample)return L({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ce=J.sample,be=ce.expectedAnswers?Object.entries(ce.expectedAnswers).map(([Ye,Ge])=>({key:Ye,expected:Ge})):[],ye=be.reduce((Ye,Ge)=>(Ye[Ge.key]="",Ye),{}),xe=ce.expectedAnswerIsSentence&&((Se=ce.expectedAnswer)==null?void 0:Se.trim())||null;return L({prompt:ce.prompt,expectedAnswer:be.length>0?xe:((Pe=ce.expectedAnswer)==null?void 0:Pe.trim())||null,computedExpected:be,computedAnswers:ye,computedValues:ce.values??null,answerTemplate:J.answerTemplate,outputVariables:ce.outputVariables??null,variableValues:ce.variableValues??null})}).catch(()=>L({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{tt.current.delete(S)}):H=Promise.resolve(L({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return tt.current.set(S,H),H},Da=(c,v,S)=>{const N=Object.keys(c.nodes).length,Y=Ma.current.size;if(!v){Qe({title:S,before:c.text,after:"",fragmentId:null,total:N,completed:Y}),$e(null),Ie(!0);return}const L=c.nodes[v];if(!L)return;const H=Zr(c.text,L);Qe({title:S,before:H.before,after:H.after,fragmentId:L.id,total:N,completed:Y}),$e(H.fragment),Ie(!1)},Ct=()=>{const c=oa.current;c&&Qe(v=>v&&{...v,total:Object.keys(c.nodes).length,completed:Ma.current.size})},ut=()=>{const c=I[re+1];c&&xt(c,re+1)},Mt=()=>{if(ut(),ve&&ve.cardType==="vocab"&&ve.checkType==="translation-match"&&j){if(j.pairs.length===0){ie("incorrect"),Ie(!0);return}const L=j.pairs.reduce((xe,Se)=>(xe[Se.rightId]=Se.rightLabel,xe),{});let H=0;const A={};j.pairs.forEach(xe=>{const Pe=j.selection[xe.leftId]===xe.rightId;A[xe.leftId]=Pe?"correct":"incorrect",Pe&&(H+=1)});const J=j.pairs.length||1,ce=H/J,be=H===j.pairs.length;t(xe=>({...xe,...A})),be?(ie("correct"),Ie(!0),sa(0)):(ie("incorrect"),Ie(!1),sa(xe=>{const Se=xe+1;return Se>=Ea&&(oe(!0),Ie(!0),k(Pe=>{if(!Pe)return Pe;const Ye=Pe.pairs.reduce((Ge,ha)=>(Ge[ha.leftId]=ha.rightId,Ge),{});return{...Pe,selection:Ye}})),Se})),wa(be,ce);const ye="connection";Promise.all(j.pairs.map(xe=>{const Se=j.selection[xe.leftId]??null,Pe=Se?L[Se]:"",Ye={left:xe.leftLabel,expected:xe.rightLabel,answer:Pe,checkType:"translation-match"},Ge=new TextEncoder().encode(JSON.stringify(Ye));return Kt({itemType:ye,itemId:xe.cardId,checkType:"translation-match",direction:null,revisionType:m.id,evalType:"translation-match",correct:Se===xe.rightId,maskBase64:null,payloadBase64:za(Ge),personRoleId:O??null})})).then(()=>{Nt(ye,ve.cardId,ve.checkType,ve.direction),lr(o,O)}).catch(()=>{});return}if(Oe.length>0){const L=Oe.reduce((A,J)=>{const ce=He[J.key]??"";return A[J.key]=ka(ce)===ka(J.expected)?"correct":"incorrect",A},{});Oe.every(({key:A,expected:J})=>{const ce=He[A]??"";return he==="exact"&&ka(ce)===ka(J)})?(ie("correct"),R(L),Ie(!0),sa(0),wa(!0,1),Ia({correct:!0,direction:Le?`${Le} -> computed`:"computed",expectedMap:Oe.reduce((A,J)=>(A[J.key]=J.expected,A),{}),answerMap:He,evalType:"computed"})):(ie("incorrect"),R(L),Ie(!1),sa(A=>{const J=A+1;return J>=Ea&&Z&&(oe(!0),Ie(!0)),J}),wa(!1,0),window.setTimeout(()=>{var J;const A=Ut(Te,Oe,Ee);A&&V.current[A]&&((J=V.current[A])==null||J.focus())},40),Ia({correct:!1,direction:Le?`${Le} -> computed`:"computed",expectedMap:Oe.reduce((A,J)=>(A[J.key]=J.expected,A),{}),answerMap:He,evalType:"computed"}));return}if(ve&&ve.cardType==="info"&&ve.infoType==="quote"&&(ke!=null&&ke.fragmentId)){if(!Ce)return;const L=La(ve.direction),H=(L==null?void 0:L.mode)??getQuoteMode(ve.direction),A=L!=null&&L.fragmentId&&ve.direction?ve.direction:kt(H,ke.fragmentId),J=li(Ce,_,Na),ce=he==="exact"&&mt(_)===mt(Ce),be=Wa(J),ye=ce||be,xe=Ha(J);ye?(Ba.current[ke.fragmentId]=Math.max(Ba.current[ke.fragmentId]??0,xe),(Ba.current[ke.fragmentId]??0)>=da&&Ma.current.add(ke.fragmentId),Ct(),ie("correct"),R({}),Ie(!0),ra(J),sa(0),xe<100&&Ea<=1&&oe(!0),wa(!0,xe/100),Ia({correct:!0,direction:`quote:${ke.fragmentId}`,expected:Ce,answer:_,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:A})):(ie("incorrect"),R({}),Ie(!1),ra(J),sa(Se=>{const Pe=Se+1;return Pe>=Ea&&Z&&(oe(!0),Ie(!0)),Pe}),wa(!1,xe/100),window.setTimeout(()=>{var Se;return(Se=ya.current)==null?void 0:Se.focus()},40),Ia({correct:!1,direction:`quote:${ke.fragmentId}`,expected:Ce,answer:_,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:A}));return}if(!Ce)return;const c=ht(Ce,_,Na),v=he==="exact"&&ka(_)===ka(Ce),S=Wa(c),N=v||S,Y=Ha(c);N?(ie("correct"),R({}),Ie(!0),ra(c),sa(0),Y<100&&Ea<=1&&oe(!0),wa(!0,Y/100),Ia({correct:!0,direction:Le?`${Le} -> ${Ce}`:null,expected:Ce,answer:_,evalType:"text"})):(ie("incorrect"),R({}),Ie(!1),ra(c),sa(L=>{const H=L+1;return H>=Ea&&Z&&(oe(!0),Ie(!0)),H}),wa(!1,Y/100),window.setTimeout(()=>{var L;return(L=ya.current)==null?void 0:L.focus()},40),Ia({correct:!1,direction:Le?`${Le} -> ${Ce}`:null,expected:Ce,answer:_,evalType:"text"}))},Zt=c=>{if(ut(),!Ce)return;const v=ht(Ce,c,Na),S=ka(c)===ka(Ce),N=Wa(v),Y=S||N,L=Ha(v);Y?(ie("correct"),R({}),Ie(!0),ra(v),sa(0),L<100&&Ea<=1&&oe(!0),wa(!0,L/100),Ia({correct:!0,direction:"word->language",expected:Ce,answer:c,evalType:"language-select"})):(ie("incorrect"),R({}),Ie(!1),ra(v),sa(H=>{const A=H+1;return A>=Ea&&Z&&(oe(!0),Ie(!0)),A}),wa(!1,L/100),Ia({correct:!1,direction:"word->language",expected:Ce,answer:c,evalType:"language-select"}))},er=()=>{ut(),ie("correct"),Ie(!0),sa(0),wa(!0,1),Ce&&Ia({correct:!0,direction:"manual",expected:Ce,answer:_,evalType:"manual"})},ar=()=>{if(wa(!1,0),ve&&ve.cardType==="info"&&ve.infoType==="quote"){ie(null),Ne(""),oe(!1),R({}),Ie(!1),ra(null),sa(0),ee(c=>Math.min(c+1,I.length));return}dt()};i.useEffect(()=>{ut()},[re,I]);const Ga=c=>{var S;if(c.key!=="Enter")return;if(c.preventDefault(),c.stopPropagation(),Me){dt();return}const v=Oe.find(N=>!(He[N.key]??"").trim());if(v){(S=V.current[v.key])==null||S.focus();return}Mt()},$=a.cogita.library.revision.revealModeAfterIncorrect,Z=Oe.length>0||!!Ce;return e.jsxs(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:[ge==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${le.total?Math.min(100,Math.max(0,le.current/le.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:le.total?`${Math.min(le.current,le.total)} / ${le.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:E}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",y).replace("{check}",B)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:W,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${W}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${W}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:we?`${we.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Aa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Aa.currentLevel??"-"," / ",Aa.levelsCount]}):null,we?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(we.correct)).replace("{total}",String(we.total))}),we.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(we.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[De?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:De})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":h?`${h.kind}-${h.tick}`:je?"idle":se??"idle",children:ve?e.jsx(e.Fragment,{children:va?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:ve,currentTypeLabel:pt,prompt:Le,languages:de,answer:_,onAnswerChange:c=>Ne(v=>_t(v,c,te)),computedExpected:Oe,computedAnswers:He,onComputedAnswerChange:(c,v)=>ia(S=>({...S,[c]:_t(S[c]??"",v,te)})),answerTemplate:Te,outputVariables:Ee,variableValues:Be,computedFieldFeedback:aa,feedback:se,canAdvance:Me,quoteContext:ke,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:ar,onLanguageSelect:Zt,onMarkReviewed:er,onAdvance:dt,showCorrectAnswer:ue,setShowCorrectAnswer:oe,onRevealCorrect:()=>Ie(!0),answerMask:Ta,expectedAnswer:Ce,hasExpectedAnswer:Z,handleComputedKeyDown:Ga,answerInputRef:ya,computedInputRefs:V,scriptMode:te,setScriptMode:G,matchPairs:j==null?void 0:j.pairs,matchLeftOrder:j==null?void 0:j.leftOrder,matchRightOrder:j==null?void 0:j.rightOrder,matchSelection:j==null?void 0:j.selection,matchActiveLeft:j==null?void 0:j.activeLeft,matchActiveRight:j==null?void 0:j.activeRight,matchFeedback:Q,onMatchLeftSelect:ct,onMatchRightSelect:Fa})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${W}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:rt?`${it} / ${rt}`:a.cogita.library.revision.progressUnlimited}),ge==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ge==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ge==="ready"&&I.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:$}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ea]})]})]}),Aa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Aa.activeCount," / ",Aa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Aa.counts.map((c,v)=>{const S=v+1,N=Aa.currentLevel===S,Y=Aa.percentages[v]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":N,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:S}),e.jsx("strong",{children:c})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,Y))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[Y.toFixed(1),"%"]})]},`level-${S}`)})})]}):null,ja?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ja.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ja.dots.map(c=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,c.value*100))}%`,background:`rgba(${Math.round(255*(1-c.value))}, ${Math.round(200*c.value)}, 80, 0.9)`}},c.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ja.knownCount})]})]}):null,pa?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:st})]})}):null]})]})]})})})]})]})}const sr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],An={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Fn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Bn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Dn({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:o,collectionId:C}){const[b,x]=i.useState(""),[W,q,z]=Vr([]),[s,m,f]=qr([]),[he,O]=i.useState(null),[y,B]=i.useState(null),[E,ne]=i.useState(null),I=`/#/cogita/library/${o}`;i.useEffect(()=>{Wt(o,C).then(d=>x(d.name)).catch(()=>x(a.cogita.library.collections.defaultName))},[o,C,a]),i.useEffect(()=>{Mi({libraryId:o,collectionId:C}).then(d=>{if(!d.graphId||d.graphId==="00000000-0000-0000-0000-000000000000"){q([]),m([]);return}const re=d.nodes.map(_=>{var Le;const Ne=_.payload??{},se=Ne.position??{x:120,y:120},ie=Ne.params??{};return{id:_.nodeId,type:"default",position:se,data:{nodeType:_.nodeType,label:((Le=sr.find(Re=>Re.type===_.nodeType))==null?void 0:Le.label)??_.nodeType,params:ie}}}),ee=d.edges.map(_=>({id:_.edgeId,source:_.fromNodeId,target:_.toNodeId,sourceHandle:_.fromPort??void 0,targetHandle:_.toPort??void 0}));q(re),m(ee)}).catch(()=>{q([]),m([])})},[o,C,m,q]);const U=i.useMemo(()=>W.find(d=>d.id===he)??null,[W,he]),de=d=>{var Ne;const re=crypto.randomUUID(),ee=((Ne=sr.find(se=>se.type===d))==null?void 0:Ne.label)??d,_={...An[d]};q(se=>[...se,{id:re,type:"default",position:{x:120+se.length*40,y:120+se.length*40},data:{nodeType:d,label:ee,params:_}}]),O(re)},me=i.useCallback(d=>{m(re=>Rt({...d,id:crypto.randomUUID()},re))},[m]),ge=async()=>{B(null);try{await Ii({libraryId:o,collectionId:C,nodes:W.map(d=>({nodeId:d.id,nodeType:d.data.nodeType,payload:{position:d.position,params:d.data.params}})),edges:s.map(d=>({edgeId:d.id,fromNodeId:d.source,fromPort:d.sourceHandle??null,toNodeId:d.target,toPort:d.targetHandle??null}))}),B(a.cogita.library.graph.saveSuccess)}catch{B(a.cogita.library.graph.saveFail)}},K=async()=>{try{const d=await Si({libraryId:o,collectionId:C});ne(d)}catch{ne(null)}},le=d=>{U&&q(re=>re.map(ee=>ee.id===U.id?{...ee,data:{...ee.data,params:d}}:ee))};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${I}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:K,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ge,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:sr.map(d=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>de(d.type),children:d.label},d.type))}),y?e.jsx("p",{className:"cogita-help",children:y}):null,E&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(E.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(E.connections)).replace("{infos}",String(E.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(fr,{nodes:W,edges:s,onNodesChange:z,onEdgesChange:f,onConnect:me,onNodeClick:(d,re)=>O(re.id),fitView:!0,children:[e.jsx(xr,{color:"rgba(120,160,200,0.2)"}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),U?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:U.data.label}),U.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:U.data.params.tagId?{id:U.data.params.tagId,label:U.data.params.tagLabel??"",infoType:"topic"}:null,onChange:d=>le({...U.data.params,tagId:(d==null?void 0:d.id)??null,tagLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:U.data.params.scope??"any",onChange:d=>le({...U.data.params,scope:d.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),U.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:o,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:U.data.params.languageId?{id:U.data.params.languageId,label:U.data.params.languageLabel??"",infoType:"language"}:null,onChange:d=>le({...U.data.params,languageId:(d==null?void 0:d.id)??null,languageLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:U.data.params.scope??"any",onChange:d=>le({...U.data.params,scope:d.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),U.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:U.data.params.infoType??"word",onChange:d=>le({...U.data.params,infoType:d.target.value}),children:Bn.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsx(ze,{libraryId:o,infoType:U.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:U.data.params.infoId?{id:U.data.params.infoId,label:U.data.params.infoLabel??"",infoType:U.data.params.infoType??"word"}:null,onChange:d=>le({...U.data.params,infoId:(d==null?void 0:d.id)??null,infoLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),U.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:U.data.params.connectionType??"translation",onChange:d=>le({...U.data.params,connectionType:d.target.value}),children:Fn.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:U.data.params.connectionId??"",onChange:d=>le({...U.data.params,connectionId:d.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(U.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const cr="cogita.preferences",ci=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],dr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ur=["settings","run","shared"];function Kn(a,n=""){const l=a.split("/").filter(Boolean);if(l[0]!=="cogita"||l[1]!=="library")return{};const u=l[2];if(!u)return{};if(!l[3])return{libraryId:u,target:"library_overview"};const g=new URLSearchParams(n),w=g.get("revisionId")??void 0,p=g.get("collectionAction"),P=g.get("libraryAction");if(l[3]==="list")return{libraryId:u,target:P==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:w,libraryAction:P==="new-info"?"new-info":void 0};if(l[3]==="detail"||l[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:l[3],revisionId:w};if(l[3]==="new"||l[3]==="add")return{libraryId:u,target:"new_card",revisionId:w,libraryAction:"new-info"};if(l[3]==="edit")return{libraryId:u,target:"new_card",revisionId:w,infoId:l[4]};if(l[3]==="shared-revisions")return{libraryId:u,target:"all_collections",revisionId:w};if(l[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(l[3]==="transfer")return{libraryId:u,target:"transfer"};if(l[3]==="storyboards")return l[4]==="new"?{libraryId:u,target:"new_storyboard"}:{libraryId:u,target:"storyboards"};if(l[3]==="texts")return l[4]==="new"?{libraryId:u,target:"new_text"}:{libraryId:u,target:"texts"};if(l[3]!=="collections")return{libraryId:u,target:"library_overview"};if(l[4]==="new")return{libraryId:u,target:"new_collection",revisionId:w};const M=l[4];return M?l[5]==="graph"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"graph"}:l[5]==="shared-revisions"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"shared"}:l[5]==="revision"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:l[6]==="run"?"run":"settings"}:p==="new-revision"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"new"}:{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"detail"}:p==="new-collection"?{libraryId:u,target:"new_collection",collectionAction:"new-collection"}:{libraryId:u,target:"all_collections"}}function gr(a,n="library_overview",l,u,g,w){const p=(P,M)=>{const F=new URLSearchParams;M!=null&&M.revisionId&&F.set("revisionId",M.revisionId),M!=null&&M.collectionAction&&F.set("collectionAction",M.collectionAction),M!=null&&M.libraryAction&&F.set("libraryAction",M.libraryAction);const o=F.toString();return o?`${P}?${o}`:P};return a?n==="library_overview"?p(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?p(`/cogita/library/${a}/list`,{revisionId:g}):n==="new_card"?w?p(`/cogita/library/${a}/edit/${w}`,{revisionId:g}):p(`/cogita/library/${a}/list`,{revisionId:g,libraryAction:"new-info"}):n==="all_collections"?l?u==="graph"?p(`/cogita/library/${a}/collections/${l}/graph`,{revisionId:g}):u==="settings"?p(`/cogita/library/${a}/collections/${l}/revision`,{revisionId:g}):u==="run"?p(`/cogita/library/${a}/collections/${l}/revision/run`,{revisionId:g}):u==="shared"?p(`/cogita/library/${a}/collections/${l}/shared-revisions`,{revisionId:g}):u==="new"?p(`/cogita/library/${a}/collections/${l}`,{revisionId:g,collectionAction:"new-revision"}):p(`/cogita/library/${a}/collections/${l}`,{revisionId:g}):p(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?p(`/cogita/library/${a}/collections`,{revisionId:g,collectionAction:"new-collection"}):n==="transfer"?p(`/cogita/library/${a}/transfer`,{revisionId:g}):n==="storyboards"?p(`/cogita/library/${a}/storyboards`,{revisionId:g}):n==="new_storyboard"?p(`/cogita/library/${a}/storyboards/new`,{revisionId:g}):n==="texts"?p(`/cogita/library/${a}/texts`,{revisionId:g}):n==="new_text"?p(`/cogita/library/${a}/texts/new`,{revisionId:g}):n==="dependencies"?p(`/cogita/library/${a}/dependencies`,{revisionId:g}):p(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function It(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function On(a){return typeof a=="string"&&ci.includes(a)}function Vn(a,n){var P;if(!a.length)return null;const l=a.filter(M=>n.has(M.roleId)),u=l.length>0?l:a,g=u.map(M=>{var o,C;const F=((C=(o=M.fields.find(b=>b.fieldType==="role_kind"))==null?void 0:o.plainValue)==null?void 0:C.toLowerCase())??"";return{roleId:M.roleId,roleKind:F}}),w=g.find(M=>M.roleKind.includes("master"));if(w)return w.roleId;const p=g.find(M=>M.roleKind.includes("account")||M.roleKind.includes("user"));return p?p.roleId:((P=u[0])==null?void 0:P.roleId)??null}function qn(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function _n({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F}){const o=Or(),C=vr(),b=i.useMemo(()=>Kn(C.pathname,C.search),[C.pathname,C.search]),x=a.cogita.workspace,[W,q]=i.useState([]),[z,s]=i.useState([]),[m,f]=i.useState([]),[he,O]=i.useState([]),[y,B]=i.useState(void 0),[E,ne]=i.useState("library_overview"),[I,U]=i.useState(void 0),[de,me]=i.useState(void 0),[ge,K]=i.useState("detail"),[le,d]=i.useState(void 0),[re,ee]=i.useState(!1),[_,Ne]=i.useState(!0),[se,ie]=i.useState(!1),[Le,Re]=i.useState(!1),[Ce,$e]=i.useState(null),[ke,Qe]=i.useState(""),[Oe,Ae]=i.useState(""),[He,ia]=i.useState(""),[aa,R]=i.useState(null),[X,Fe]=i.useState(null),Te=i.useRef({version:1,byLibrary:{}}),pe=i.useRef(!1),Ee=i.useRef(!1),_e=i.useRef(null),Be=i.useMemo(()=>W.find(V=>V.libraryId===y)??null,[W,y]),Ve=i.useMemo(()=>z.find(V=>V.collectionId===I)??null,[z,I]),j=i.useMemo(()=>he.find(V=>V.revisionId===de)??null,[he,de]),k=i.useMemo(()=>({detail:x.revisions.detail,graph:x.revisions.graph,settings:x.revisions.settings,run:x.revisions.run,shared:x.targets.sharedRevisions,new:x.revisionForm.createAction}),[x.revisions.detail,x.revisions.graph,x.revisions.run,x.revisions.settings,x.targets.sharedRevisions,x.revisionForm.createAction]),Q=i.useMemo(()=>[{value:"detail",label:k.detail},{value:"graph",label:k.graph},{value:"settings",label:x.targets.allRevisions},{value:"run",label:k.run},{value:"shared",label:k.shared}],[k.detail,k.graph,k.run,k.shared,x.targets.allRevisions]),t=i.useMemo(()=>E==="new_card"?"all_cards":E==="new_collection"?"all_collections":E==="new_storyboard"?"storyboards":E==="new_text"?"texts":E,[E]),r=i.useMemo(()=>ge==="new"?"settings":ge,[ge]),h=i.useMemo(()=>E==="new_card"?"new":"search",[E]),T=i.useMemo(()=>m.find(V=>V.infoId===b.infoId)??null,[m,b.infoId]),D=i.useMemo(()=>({library_overview:x.targets.libraryOverview,all_cards:x.targets.allCards,new_card:x.targets.newCard,all_collections:x.targets.allCollections,new_collection:x.targets.newCollection,transfer:x.targets.transfer,storyboards:x.targets.storyboards,new_storyboard:x.targets.newStoryboard,texts:x.targets.texts,new_text:x.targets.newText,dependencies:x.targets.dependencies}),[x.targets]),ae=i.useMemo(()=>D[t]??t,[t,D]),te=k[r],G=!!y,ue=!!I,oe=G&&E==="all_collections",we=ue&&E==="all_collections",ea=ue&&E==="all_collections"&&ur.includes(ge),qe=i.useCallback(V=>{const Me=!!V.libraryId;let Ie=V.target,Je=V.collectionId,la=V.revisionId,ca=V.revisionView,fa=V.infoId;Me?dr[Ie].requiresCollection&&!Je?(Ie="all_collections",la=void 0,ca="detail"):Ie!=="all_collections"?(Je=void 0,la=void 0,Ie!=="new_card"&&(fa=void 0)):dr[Ie].allowsRevision?ur.includes(ca)||(la=void 0):ca="detail":(Ie="library_overview",Je=void 0,la=void 0,ca="detail",fa=void 0),B(V.libraryId),ne(Ie),U(Je),me(la),K(ca),ee(!1);const na=It(gr(V.libraryId,Ie,Je,ca,la,fa));It(`${C.pathname}${C.search}`)!==na&&(_e.current=na,o(na))},[C.pathname,C.search,o]),ta=V=>{qe({libraryId:y,target:"all_collections",collectionId:I,revisionId:ur.includes(V)?de:void 0,revisionView:V})},De=i.useMemo(()=>[{key:"library",label:x.layers.library,visible:!0,value:y??"",selectedLabel:(Be==null?void 0:Be.name)??x.path.noLibrarySelected,disabled:_||W.length===0,options:W.map(V=>({value:V.libraryId,label:V.name})),emptyOption:x.noLibraryOption,onSelect:V=>{const Me=V||void 0;qe({libraryId:Me,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:x.layers.target,visible:G,value:t,selectedLabel:ae,disabled:!G,options:ci.map(V=>({value:V,label:D[V]})),onSelect:V=>{const Me=V;qe({libraryId:y,target:Me,collectionId:I,revisionId:de,revisionView:ge,infoId:Me==="new_card"?b.infoId:void 0})}},{key:"info_mode",label:x.layers.target,visible:t==="all_cards",value:h,selectedLabel:h==="new"?D.new_card:D.all_cards,disabled:!G,options:[{value:"search",label:D.all_cards},{value:"new",label:D.new_card}],onSelect:V=>{if(V==="new"){qe({libraryId:y,target:"new_card",collectionId:I,revisionId:de,revisionView:ge,infoId:void 0});return}qe({libraryId:y,target:"all_cards",collectionId:I,revisionId:de,revisionView:ge,infoId:void 0})}},{key:"info_entry",label:a.cogita.library.list.selectedTitle,visible:t==="all_cards",value:b.infoId??"",selectedLabel:(T==null?void 0:T.label)??le??a.cogita.library.list.selectedEmpty,disabled:!G||m.length===0,options:m.map(V=>({value:V.infoId,label:V.label})),emptyOption:a.cogita.library.list.selectedEmpty,onSelect:V=>{if(!V){qe({libraryId:y,target:"all_cards",collectionId:I,revisionId:de,revisionView:ge,infoId:void 0});return}qe({libraryId:y,target:"new_card",collectionId:I,revisionId:de,revisionView:ge,infoId:V})}},{key:"info_selected_action",label:x.layers.target,visible:t==="all_cards"&&!!b.infoId,value:E==="new_card"&&b.infoId?"edit":"search",selectedLabel:E==="new_card"&&b.infoId?a.cogita.library.list.editInfo:D.all_cards,disabled:!G||!b.infoId,options:[{value:"edit",label:a.cogita.library.list.editInfo},{value:"search",label:D.all_cards}],onSelect:V=>{if(b.infoId){if(V==="edit"){qe({libraryId:y,target:"new_card",collectionId:I,revisionId:de,revisionView:ge,infoId:b.infoId});return}qe({libraryId:y,target:"all_cards",collectionId:I,revisionId:de,revisionView:ge,infoId:void 0})}}},{key:"collection",label:x.layers.collection,visible:oe,value:I??"",selectedLabel:(Ve==null?void 0:Ve.name)??x.path.noCollectionSelected,disabled:!G||se||z.length===0,options:z.map(V=>({value:V.collectionId,label:V.name})),emptyOption:x.selectCollectionOption,onSelect:V=>{qe({libraryId:y,target:"all_collections",collectionId:V||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:x.layers.revision,visible:we,value:r,selectedLabel:te,disabled:!I,options:Q.map(V=>({value:V.value,label:V.label})),onSelect:V=>{ta(V)}},{key:"revision_entry",label:x.layers.revision,visible:ea,value:de??"",selectedLabel:(j==null?void 0:j.name)??x.status.noRevisions,disabled:!ue||Le||he.length===0,options:he.map(V=>({value:V.revisionId,label:V.name})),emptyOption:x.status.noRevisions,onSelect:V=>{qe({libraryId:y,target:"all_collections",collectionId:I,revisionId:V||void 0,revisionView:ge})}}],[Q,z,se,h,m,W,_,qe,he,Le,Ve,I,T,j,de,le,ue,G,Be,y,te,ge,E,r,t,ae,oe,we,ea,D,a.cogita.library.list.selectedTitle,a.cogita.library.list.selectedEmpty,b.infoId,x.layers.collection,x.layers.library,x.layers.revision,x.layers.target,x.noLibraryOption,x.path.noCollectionSelected,x.path.noLibrarySelected,x.selectCollectionOption]),Ue=i.useMemo(()=>De.filter(V=>V.visible),[De]),Ke=i.useMemo(()=>Ue.filter(V=>V.key!=="library"&&V.key!=="collection"&&V.key!=="revision_entry"&&V.key!=="info_entry"),[Ue]),Xe=i.useMemo(()=>Ke.filter(V=>V.key==="target"||V.key==="info_mode"||V.key==="info_selected_action"),[Ke]),Ta=i.useMemo(()=>Ke.find(V=>V.key==="collection_action")??null,[Ke]),ra=i.useMemo(()=>{const V=b.libraryId;if(!V||!C.pathname.startsWith("/cogita/library/"))return null;const Me={copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,libraryId:V};if(b.target==="library_overview")return e.jsx(Yi,{...Me});if(b.target==="all_cards")return e.jsx(Zi,{...Me,mode:b.cardMode??"list"});if(b.target==="new_card")return e.jsx(nn,{...Me,editInfoId:b.infoId});if(b.target==="dependencies")return e.jsx(ln,{...Me});if(b.target==="transfer")return e.jsx(cn,{...Me});if(b.target==="storyboards"||b.target==="new_storyboard")return e.jsx(dn,{...Me});if(b.target==="texts"||b.target==="new_text")return e.jsx(un,{...Me});if(b.target==="all_collections"){if(b.collectionId){const Ie={...Me,collectionId:b.collectionId};return b.revisionView==="graph"?e.jsx(Dn,{...Ie}):b.revisionView==="shared"?e.jsx(sn,{...Me,collectionId:b.collectionId}):b.revisionView==="settings"?e.jsx(jn,{...Ie,revisionId:b.revisionId}):b.revisionView==="run"?e.jsx(En,{...Ie,revisionId:b.revisionId}):e.jsx(gn,{...Ie})}return e.jsx(Dr,{...Me})}return b.target==="new_collection"?e.jsx(Dr,{...Me}):null},[n,a,M,C.pathname,o,F,w,P,u,g,b.cardMode,b.collectionId,b.infoId,b.libraryId,b.revisionId,b.revisionView,b.target,p,l]);i.useEffect(()=>{let V=!1;return(async()=>{var Ie,Je,la,ca,fa,na,ma;Ne(!0);try{await Pi();const[xa,va,We]=await Promise.all([Wr(),Ri(),$i()]);if(V)return;q(xa);const oa=new Set(We.nodes.filter(ua=>ua.nodeType==="role"&&ua.canLink).map(ua=>ua.roleId??"")),Ma=Vn(va,oa);if(R(Ma),Ma){const ua=We.nodes.find($a=>$a.nodeType==="data"&&$a.roleId===Ma&&($a.fieldType===cr||$a.label===cr));Fe((ua==null?void 0:ua.dataKeyId)??null),Te.current=qn(ua==null?void 0:ua.value)}const Ba=Te.current.lastLibraryId,ve=((Ie=xa.find(ua=>ua.libraryId===b.libraryId))==null?void 0:Ie.libraryId)??(xa.length===1?xa[0].libraryId:void 0)??((Je=xa.find(ua=>ua.libraryId===Ba))==null?void 0:Je.libraryId)??((la=xa[0])==null?void 0:la.libraryId),je=ve?(fa=(ca=Te.current.byLibrary)==null?void 0:ca[ve])==null?void 0:fa.lastTarget:void 0,_a=On(je)?je:"library_overview";B(ve),ne(b.target??_a),me(b.revisionId??(ve?(ma=(na=Te.current.byLibrary)==null?void 0:na[ve])==null?void 0:ma.lastRevisionId:void 0)),K(b.revisionView??"detail"),pe.current=!0}catch{V||$e(x.status.loadFailed)}finally{V||Ne(!1)}})(),()=>{V=!0}},[x.status.loadFailed]),i.useLayoutEffect(()=>{pe.current&&(b.libraryId&&W.some(V=>V.libraryId===b.libraryId)&&B(b.libraryId),b.target&&ne(b.target),U(b.collectionId),me(b.revisionId),b.revisionView&&K(b.revisionView))},[W,b.collectionId,b.libraryId,b.revisionId,b.revisionView,b.target]),i.useEffect(()=>{if(!y){s([]),U(void 0),f([]),O([]),me(void 0);return}let V=!1;return ie(!0),jt({libraryId:y,limit:200}).then(Me=>{var la;if(V)return;const Ie=Me.items;s(Ie);const Je=(la=Ie.find(ca=>ca.collectionId===b.collectionId))==null?void 0:la.collectionId;U(Je)}).catch(()=>{V||(s([]),U(void 0))}).finally(()=>{V||ie(!1)}),()=>{V=!0}},[b.collectionId,y]),i.useEffect(()=>{if(!y||t!=="all_cards"&&E!=="new_card"){f([]);return}let V=!1;return jr({libraryId:y,limit:200}).then(Me=>{V||f(Me)}).catch(()=>{V||f([])}),()=>{V=!0}},[t,y,E]),i.useEffect(()=>{if(!y||!I){O([]),me(void 0);return}let V=!1;return Re(!0),zr({libraryId:y,collectionId:I}).then(Me=>{var la,ca,fa,na;if(V)return;O(Me);const Ie=(ca=(la=Te.current.byLibrary)==null?void 0:la[y])==null?void 0:ca.lastRevisionId,Je=((fa=Me.find(ma=>ma.revisionId===b.revisionId))==null?void 0:fa.revisionId)??((na=Me.find(ma=>ma.revisionId===Ie))==null?void 0:na.revisionId);me(Je)}).catch(()=>{V||(O([]),me(void 0))}).finally(()=>{V||Re(!1)}),()=>{V=!0}},[b.revisionId,I,y]),i.useEffect(()=>{const V=b.infoId;if(!y||!V){d(void 0);return}let Me=!1;return at({libraryId:y,infoId:V}).then(Ie=>{if(Me)return;const Je=Ie.payload;d((Je==null?void 0:Je.label)??(Je==null?void 0:Je.name)??(Je==null?void 0:Je.title)??Ie.infoId)}).catch(()=>{Me||d(V)}),()=>{Me=!0}},[b.infoId,y]),i.useEffect(()=>{if(!pe.current||b.libraryId&&W.some(Ie=>Ie.libraryId===b.libraryId)&&b.libraryId!==y||b.target&&b.target!==E||b.revisionView&&b.revisionView!==ge||b.revisionId&&b.revisionId!==de||dr[E].requiresCollection&&!I&&b.target==="all_collections"&&b.collectionId)return;const V=It(`${C.pathname}${C.search}`),Me=It(gr(y,E,I,ge,de,b.infoId));if(V===Me){_e.current=null;return}_e.current!==Me&&(_e.current=Me,o(Me,{replace:!0}))},[W,C.pathname,C.search,o,b.collectionId,b.infoId,b.libraryId,b.revisionId,b.revisionView,b.target,I,y,de,ge,E]),i.useEffect(()=>{if(typeof window>"u")return;const V=()=>{window.innerWidth>920&&ee(!1)};return window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[]),i.useEffect(()=>{if(!pe.current||!aa||!y||Ee.current)return;const V=Te.current,Me={...V.byLibrary??{}},Ie={...Me[y]??{},lastCollectionId:I,lastRevisionId:de,lastRevisionView:ge,lastTarget:E},Je={version:1,lastLibraryId:y,byLibrary:{...Me,[y]:Ie}},la=JSON.stringify(V),ca=JSON.stringify(Je);if(la===ca)return;Te.current=Je,Ee.current=!0,(async()=>{try{if(X)await Ei(X,{plainValue:ca});else{const na=await Ai(aa,{itemName:cr,itemType:"data",plainValue:ca});Fe(na.dataItemId)}}catch{$e(x.status.savePrefsFailed)}finally{Ee.current=!1}})()},[X,aa,I,y,de,ge,E,x.status.savePrefsFailed]);const Ra=async()=>{const V=ke.trim();if(!V){$e(a.cogita.user.libraryNameRequired);return}$e(null);try{const Me=await Di({name:V});q(Ie=>[Me,...Ie]),B(Me.libraryId),ne("library_overview"),U(void 0),Qe("")}catch{$e(a.cogita.user.libraryCreateFailed)}},sa=async()=>{if(!y){$e(x.status.selectLibraryFirst);return}const V=Oe.trim();if(!V){$e(a.cogita.library.collections.saveRequiredName);return}$e(null);try{const Me=await Fi({libraryId:y,name:V,items:[]}),Ie=await jt({libraryId:y,limit:200});s(Ie.items),U(Me.collectionId),me(void 0),ne("all_collections"),K("detail"),Ae("")}catch{$e(a.cogita.library.collections.saveFail)}},ya=async()=>{if(!y||!I){$e(x.status.selectLibraryFirst);return}const V=He.trim();if(!V){$e(x.revisionForm.nameLabel);return}$e(null);try{const Me=await Bi({libraryId:y,collectionId:I,name:V,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});O(Ie=>[Me,...Ie]),me(Me.revisionId),ne("all_collections"),K("settings"),ia("")}catch{$e(x.status.loadFailed)}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${re?"open":""}`,"aria-label":x.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Be==null?void 0:Be.name)??x.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Be?x.sidebar.libraryActionsHint:x.status.selectLibraryFirst}),Xe.length>0?e.jsx("div",{className:"cogita-sidebar-actions",children:Xe.map(V=>V.options.map(Me=>e.jsx("button",{type:"button",className:`ghost ${String(V.value)===Me.value?"active":""}`,onClick:()=>V.onSelect(Me.value),disabled:V.disabled,children:Me.label},`sidebar:${V.key}:${Me.value}`)))}):null]}),Ve?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:Ve.name}),e.jsx("p",{className:"cogita-sidebar-note",children:x.sidebar.collectionActionsHint}),Ta?e.jsx("div",{className:"cogita-sidebar-actions",children:Ta.options.map(V=>e.jsx("button",{type:"button",className:`ghost ${String(Ta.value)===V.value?"active":""}`,onClick:()=>Ta.onSelect(V.value),disabled:Ta.disabled,children:V.label},`sidebar:revision:${V.value}`))}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:x.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:u,children:x.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{P("cogita"),ee(!1)},children:x.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:p?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),re?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":x.sidebar.closeMenu,onClick:()=>ee(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":x.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>ee(V=>!V),"aria-label":re?x.sidebar.closeMenu:x.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),Ue.map((V,Me)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Me>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,V.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":V.label,children:V.selectedLabel}):e.jsxs("select",{"aria-label":V.label,value:V.value,onChange:Ie=>V.onSelect(Ie.target.value),disabled:V.disabled,children:[V.emptyOption?e.jsx("option",{value:"",children:V.emptyOption}):null,V.options.map(Ie=>e.jsx("option",{value:Ie.value,children:Ie.label},`${V.key}:${Ie.value}`))]})]},`menu:${V.key}`))]}),ra?e.jsxs(e.Fragment,{children:[E==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Oe,onChange:V=>Ae(V.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!y})]}),e.jsx("button",{type:"button",className:"cta",onClick:sa,disabled:!y,children:a.cogita.library.actions.createCollection}),Ce?e.jsx("p",{className:"cogita-form-error",children:Ce}):null]}):null,E==="all_collections"&&I&&ge==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:V=>ia(V.target.value),placeholder:x.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,children:x.revisionForm.createAction}),Ce?e.jsx("p",{className:"cogita-form-error",children:Ce}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Qr.Provider,{value:!0,children:ra})})]}):null,ra?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[Ue.map((V,Me)=>e.jsxs("span",{children:[Me>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:V.selectedLabel})]},`path:${V.key}`)),oe?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:x.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[x.path.currentRoute," ",e.jsx("code",{children:gr(y,E,I,ge,de,b.infoId)})]}),y?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${y}`,children:x.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${y}/list`,children:x.links.allCards}),I?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${y}/collections/${I}/shared-revisions`,children:x.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:ke,onChange:V=>Qe(V.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ra,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Oe,onChange:V=>Ae(V.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!y})]}),e.jsx("button",{type:"button",className:"cta",onClick:sa,disabled:!y,children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:V=>ia(V.target.value),placeholder:x.revisionForm.namePlaceholder,disabled:!I})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,disabled:!I,children:x.revisionForm.createAction}),Ce?e.jsx("p",{className:"cogita-form-error",children:Ce}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:x.panels.collections}),se?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.loadingCollections}):null,!se&&z.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.noCollections}):null,z.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:z.map(V=>e.jsxs("button",{type:"button",className:`cogita-card-item ${V.collectionId===I?"active":""}`,onClick:()=>{U(V.collectionId),me(void 0),K("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:x.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:V.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[V.itemCount," ",x.cards.itemsSuffix]})]},V.collectionId))}):null]})]})]})]})})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:_n},Symbol.toStringTag,{value:"Module"}));function Un({copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,shareId:o}){const[C,b]=i.useState(null),[x,W]=i.useState("loading"),[q,z]=i.useState(a.cogita.library.collections.defaultName),[s,m]=i.useState("Cogita Library"),[f,he]=i.useState([]),[O,y]=i.useState([]),[B,E]=i.useState("idle"),[ne,I]=i.useState({current:0,total:0}),[U,de]=i.useState(0),[me,ge]=i.useState(""),[K,le]=i.useState(null),[d,re]=i.useState(null),[ee,_]=i.useState(null),[Ne,se]=i.useState(null),[ie,Le]=i.useState([]),[Re,Ce]=i.useState({}),[$e,ke]=i.useState({}),[Qe,Oe]=i.useState(null),[Ae,He]=i.useState(null),[ia,aa]=i.useState(null),[R,X]=i.useState(null),[Fe,Te]=i.useState({}),pe=i.useRef(0),[Ee,_e]=i.useState(null),Be=i.useRef(null),Ve=i.useRef(null),[j,k]=i.useState(null),[Q,t]=i.useState(!1),[r,h]=i.useState(null),[T,D]=i.useState([]),[ae,te]=i.useState(null),G=i.useRef(null),ue=i.useRef(null),[oe,we]=i.useState(null),[ea,qe]=i.useState(0),ta=i.useRef(null),De=i.useRef({}),[Ue,Ke]=i.useState(!1),[Xe,Ta]=i.useState({}),ra=i.useRef(null),Ra=i.useRef(new Set),sa=i.useRef({}),[ya,V]=i.useState([]),[Me,Ie]=i.useState(new Set),[Je,la]=i.useState(!1),ca=vr(),fa=i.useMemo(()=>new URLSearchParams(ca.search),[ca.search]),na=i.useMemo(()=>fa.get("key")??"",[fa]),ma=(C==null?void 0:C.mode)??"random",xa=(C==null?void 0:C.check)??"exact",va=(C==null?void 0:C.limit)??20,We=i.useMemo(()=>Lr((C==null?void 0:C.revisionType)??ma),[C,ma]),oa=i.useMemo(()=>{const $=C==null?void 0:C.revisionSettings,Z=ti(We,fa);return Jt(We,$??Z)},[C,fa,We]),Ma=i.useMemo(()=>a.cogita.library.revision[We.labelKey]??ma,[a,ma,We]),Ba=i.useMemo(()=>xa==="exact"?a.cogita.library.revision.checkValue:xa,[a,xa]),je=x==="ready"?f[U]??null:null,_a=(je==null?void 0:je.checkType)==="translation-match"&&R,ua=i.useRef(new Map),$a=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useRef(new Map),Yt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?Ze(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),rt=i.useMemo(()=>{var Z;return We.id!=="levels"?f.length:((Z=Xe.pool)==null?void 0:Z.length)??We.getFetchLimit(va,oa)},[Xe,oa,We,f.length,va]),it=We.getProgressTotal?We.getProgressTotal(f,Xe,va,oa):We.id==="levels"?Math.min(va,rt):f.length,Ea=it?Math.min(U+1,it):0,Na=Math.max(1,Number(oa.tries??1)),Ua=oa.compare??"anchors",pa=Math.max(0,Math.min(100,Number(oa.minCorrectness??0))),da=(oa.considerDependencies??"on")==="on",Pa=Math.max(0,Math.min(100,Number(oa.dependencyThreshold??85))),Ha=$=>{const Z=$.slice();for(let c=Z.length-1;c>0;c-=1){const v=Math.floor(Math.random()*(c+1));[Z[c],Z[v]]=[Z[v],Z[c]]}return Z},Wa=$=>$.length?$.reduce((c,v)=>c+v,0)/$.length/255*100:0,nt=$=>Wa($)>=pa,Qt=async()=>{const $=await Va(),Z=new Map,c=new Map;$.forEach(N=>{const Y=`${N.itemType}:${N.itemId}`,L=Ka(N.itemType,N.itemId,N.checkType,N.direction);Z.has(Y)||Z.set(Y,[]),Z.get(Y).push(N),c.has(L)||c.set(L,[]),c.get(L).push(N)});const v=new Map,S=new Map;return Z.forEach((N,Y)=>v.set(Y,Oa(N).score)),c.forEach((N,Y)=>S.set(Y,Oa(N).score)),{itemKnowness:v,cardKnowness:S}},ft=async $=>{const Z=Xe,c=$.concat(Z.active??[]).concat(Z.pool??[]).filter((J,ce,be)=>be.findIndex(ye=>fe(ye)===fe(J))===ce);if(!da){Ie(new Set(c.map(fe)));return}const{itemKnowness:v,cardKnowness:S}=await Qt(),N=J=>{if(J.cardType!=="info"||J.infoType!=="quote"||J.checkType!=="quote-fragment")return!0;const ce=La(J.direction);if(!(ce!=null&&ce.fragmentId))return!0;const be=J.description??"";if(!be.trim())return!0;const xe=bt(be).nodes[ce.fragmentId];if(!xe||!xe.leftId&&!xe.rightId)return!0;const Se=[xe.leftId,xe.rightId].filter(Ge=>!!Ge);if(Se.length===0)return!0;const Pe=Se.map(Ge=>{const ha=Ka("info",J.cardId,"quote-fragment",kt(ce.mode,Ge));return S.get(ha)??0});return Pe.reduce((Ge,ha)=>Ge+ha,0)/Pe.length>=Pa},Y=(C==null?void 0:C.collectionId)??null,L=Y?ya.filter(J=>ba(J.childItemType)==="collection"&&J.childItemId===Y&&!ba(J.childCheckType)&&!ba(J.childDirection)):[],H=Y&&c.length>0?c.reduce((J,ce)=>J+(S.get(fe(ce))??0),0)/c.length:0,A=new Set;for(const J of c){if(J.cardType!=="info"){A.add(fe(J));continue}if(!N(J))continue;const ce=ya.filter(xe=>si(xe,J)).concat(L);if(ce.length===0){A.add(fe(J));continue}let be=0;for(const xe of ce)if(ba(xe.parentItemType)==="collection")be+=xe.parentItemId===Y?H:0;else if(ba(xe.parentCheckType)||ba(xe.parentDirection)){const Se=ba(xe.parentCheckType),Pe=ba(xe.parentDirection),Ye=Ka(xe.parentItemType,xe.parentItemId,Se,Pe);be+=S.get(Ye)??0}else{const Se=`${xe.parentItemType}:${xe.parentItemId}`;be+=v.get(Se)??0}be/ce.length>=Pa&&A.add(fe(J))}Ie(A)},Gt=$=>{for(let Z=$;Z<f.length;Z+=1){const c=f[Z];if(c&&(!da||c.cardType!=="info"||Me.has(fe(c))))return Z}return-1},ot=$=>!da||$.cardType!=="info"||Me.has(fe($)),Xt=$=>{if(We.id!=="temporal"&&We.id!=="levels")return null;const Z=Xe,c=(Z.active??[]).concat(Z.pool??[]),v=new Set;for(const S of c){const N=fe(S);if(!(v.has(N)||$.has(N))&&(v.add(N),ot(S)))return S}return null},Sa=i.useMemo(()=>{if(We.id!=="levels")return null;const $=Xe,Z=$.pool??[],c=$.active??[],v=$.levelMap??{},S=Math.max(1,Number(oa.levels??1)),N=Array.from({length:S},()=>0),Y=new Set(c.map(J=>fe(J)));Z.forEach(J=>{const ce=Math.min(S,Math.max(1,v[fe(J)]??1));N[ce-1]+=1});const L=Z.length||1,H=N.map(J=>J/L*100),A=je?v[fe(je)]??1:null;return{counts:N,percentages:H,currentLevel:A,levelsCount:S,activeCount:c.length,poolCount:Z.length,activeSet:Y}},[Xe,oa,We,je]),lt=i.useMemo(()=>{if(We.id!=="temporal")return null;const $=Xe,Z=$.pool??[],c=$.active??[],v=$.knownessMap??{},S=new Set($.unknownSet??[]);let N=0;Z.forEach(H=>{(v[fe(H)]??0)>1&&(N+=1)});const Y=S.size,L=c.map(H=>({id:fe(H),value:S.has(fe(H))?0:Math.max(0,Math.min(1,v[fe(H)]??0))}));return{knownCount:N,unknownCount:Y,dots:L}},[Xe,We]),Aa=i.useMemo(()=>{if(!da)return 0;const $=Xe;return f.concat($.active??[]).concat($.pool??[]).filter((c,v,S)=>S.findIndex(N=>fe(N)===fe(c))===v).filter(c=>c.cardType==="info"&&!Me.has(fe(c))).length},[da,Xe,f,Me]);i.useEffect(()=>{if(!da||B!=="ready")return;const $=Xe,c=f.concat($.active??[]).concat($.pool??[]).filter((N,Y,L)=>L.findIndex(H=>fe(H)===fe(N))===Y).filter(N=>N.cardType!=="info"||Me.has(fe(N))).length,v=G.current;if(G.current=c,v===null||c<=v)return;const S=c-v;te(`New card available (+${S})`),ue.current&&window.clearTimeout(ue.current),ue.current=window.setTimeout(()=>te(null),2200)},[da,B,Xe,f,Me]),i.useEffect(()=>()=>{ue.current&&window.clearTimeout(ue.current)},[]);const ja=($,Z)=>{const c=We.applyOutcome({queue:f,meta:Xe},je,va,oa,{correct:$,correctness:Z,createdUtc:new Date().toISOString()});he(c.queue),Ta(c.meta);const v=c.queue[U+1];v&&Ia(v,U+1)};i.useEffect(()=>{if(!o){W("error");return}W("loading"),Ki({shareId:o,key:na}).then($=>{b($),z($.collectionName),m($.libraryName),W("ready")}).catch(()=>{W("error")})},[o,na]),i.useEffect(()=>{o&&Oi({shareId:o,key:na,type:"language"}).then($=>y($)).catch(()=>y([]))},[o,na]),i.useEffect(()=>{!o||x!=="ready"||Vi({shareId:o,key:na}).then($=>V($.items??[])).catch(()=>V([]))},[o,na,x]),i.useEffect(()=>{if(!o||x!=="ready")return;let $=!0;return(async()=>{E("loading"),I({current:0,total:We.id==="levels"?0:We.getFetchLimit(va,oa)});try{const c=[];let v=null,S=null;do{const ce=await qi({shareId:o,key:na,limit:300,cursor:v});if(c.push(...ce.items),(We.id==="levels"||We.id==="temporal")&&ce.total&&(S=ce.total),I(be=>({current:c.length,total:be.total||ce.total||We.getFetchLimit(va,oa)})),v=ce.nextCursor??null,S!==null&&c.length>=S||We.id!=="levels"&&We.id!=="temporal"&&c.length>=We.getFetchLimit(va,oa))break}while(v);if(!$)return;const N=pr(c);let Y;if(We.id==="levels"){const ce=Math.max(1,Number(oa.levels??1));Y={},N.forEach(be=>{const ye=fe(be);Y[ye]=Math.max(1,Math.min(ce,1))})}let L=null,H=null,A=null;if(We.id==="temporal"){const ce=await Va(),be=new Set(N.map(Se=>fe(Se))),ye=ce.reduce((Se,Pe)=>{const Ye=Ka(Pe.itemType,Pe.itemId,Pe.checkType,Pe.direction);return be.has(Ye)&&(Se[Ye]||(Se[Ye]=[]),Se[Ye].push(Pe)),Se},{});L={},H=new Set,A={};const xe=Date.now();N.forEach(Se=>{const Pe=fe(Se),Ye=ye[Pe]??[];if(Ye.length===0){L[Pe]=0,H.add(Pe),A[Pe]=[];return}const Ge=kr(Ye);A[Pe]=Ge;const ha=zt(Ge,xe);L[Pe]=ha.knowness})}const J=We.id==="levels"?Nr(N,va,oa,Y):We.id==="temporal"?Tr(N,va,oa,L??{},H??new Set,A??{}):We.prepare(N,va,oa);he(J.queue),Ta(J.meta),de(0),E("ready"),I(ce=>({current:Math.min(ce.current,ce.total),total:ce.total}))}catch{$&&E("error")}})(),()=>{$=!1}},[o,na,va,We,oa,x]),i.useEffect(()=>{ft(f)},[f,ya,da,Pa,C==null?void 0:C.collectionId]),i.useEffect(()=>{if(!je||!da){la(!1);return}if(je.cardType!=="info"||Me.has(fe(je))){la(!1);return}const $=Gt(U+1);if($>=0){la(!1),de($);return}if(We.id==="temporal"||We.id==="levels"){const Z=f.slice(0,U+1),c=f.slice(U+1).filter(ot),v=Z.concat(c),S=new Set(v.map(fe)),N=Xt(S);if(N){const L=fe(N);S.has(L)||(v.push(N),S.add(L),Ta(H=>{const A=H,J=new Set(A.queued??[]);return J.add(L),{...A,queued:J}}))}const Y=v.findIndex((L,H)=>H!==U&&ot(L));if(Y>=0){he(v),de(Y),la(!1);return}}la(!0)},[je,Me,da,U,f,Xe,We.id]),i.useEffect(()=>{if(ge(""),le(null),we(null),qe(0),Le([]),Ce({}),ke({}),Oe(null),He(null),aa(null),t(!1),Ke(!1),k(null),X(null),Te({}),!je){re(null),_(null);return}je.cardType==="info"&&je.infoType==="computed"&&re(a.cogita.library.revision.loadingComputed);let $=!0;return Ia(je,U).then(Z=>{!$||!Z||(re(Z.prompt),_(Z.expectedAnswer),Le(Z.computedExpected),Ce(Z.computedAnswers),Oe(Z.answerTemplate),He(Z.outputVariables),aa(Z.variableValues))}),()=>{$=!1}},[je,o,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){ra.current=null,Ra.current=new Set,se(null);return}const $=je.description??"",Z=(je.label??"").trim(),c=Z.replace(/\s+/g," ").trim(),v=$.replace(/\s+/g," ").trim(),S=c&&c!==v?Z:a.cogita.library.infoTypes.quote;if(!$){se(null),_(null);return}const N=bt($);ra.current=N,re(S);let Y=!0;return Va().then(L=>{if(!Y)return;const H=getQuoteMode(je.direction),A=new Map;L.forEach(xe=>{if(xe.itemType!=="info"||xe.checkType!=="quote-fragment"||!xe.direction)return;const Se=La(xe.direction);if(!Se||Se.mode!==H)return;const Pe=`${xe.itemId}:${Se.fragmentId}`;A.has(Pe)||A.set(Pe,[]),A.get(Pe).push(xe)});const J={},ce=new Set;A.forEach((xe,Se)=>{const[Pe,Ye]=Se.split(":",2);if(Pe!==je.cardId)return;const Ge=Oa(xe).score;J[Ye]=Ge,Ge>=Pa&&ce.add(Ye)}),Ra.current=ce,sa.current=J;const be=La(je.direction);if(be!=null&&be.fragmentId&&N.nodes[be.fragmentId]){Qa(N,be.fragmentId,S);return}const ye=gt(N,ce,J,Pa,da,je.direction);Qa(N,(ye==null?void 0:ye.id)??null,S)}).catch(()=>{Ra.current=new Set,sa.current={};const L=La(je.direction);if(L!=null&&L.fragmentId&&N.nodes[L.fragmentId]){Qa(N,L.fragmentId,S);return}const H=gt(N,Ra.current,{},Pa,da,je.direction);Qa(N,(H==null?void 0:H.id)??null,S)}),()=>{Y=!1}},[je,a,da,Pa]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){X(null),Te({});return}const c=(Xe.pool??Xe.active??f).filter(L=>L.cardType==="vocab"&&L.checkType==="translation-match").filter((L,H,A)=>A.findIndex(J=>J.cardId===L.cardId)===H);c.some(L=>L.cardId===je.cardId)||c.unshift(je);const S=Ha(c).slice(0,6).map(L=>{const H=L.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(H.length<2)return null;const A=`${L.cardId}:L`,J=`${L.cardId}:R`;return{cardId:L.cardId,leftId:A,rightId:J,leftLabel:H[0],rightLabel:H[1]}}).filter(Boolean),N=S.map(L=>L.leftId),Y=Ha(S.map(L=>L.rightId));X({pairs:S,leftOrder:N,rightOrder:Y,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,f,Xe]),i.useEffect(()=>()=>{Be.current&&window.clearTimeout(Be.current),Ve.current&&window.clearTimeout(Ve.current)},[]);const st=i.useRef(null);i.useEffect(()=>{if(!je)return;const $=fe(je),Z=typeof document<"u"?document.activeElement:null;if(st.current===$&&Z&&(Z.tagName==="INPUT"||Z.tagName==="TEXTAREA"))return;let c=0;const v=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(ie.length>0){const N=Ut(Qe,ie,Ae),Y=N?De.current[N]:null;if(Y&&(Y.focus(),document.activeElement===Y)){st.current=$;return}}if(ta.current&&(ta.current.focus(),document.activeElement===ta.current)){st.current=$;return}}else if(je.cardType==="vocab"&&ta.current&&(ta.current.focus(),document.activeElement===ta.current)){st.current=$;return}c<6&&(c+=1,window.setTimeout(v,40))}},S=window.setTimeout(v,40);return()=>window.clearTimeout(S)},[je,ie,Qe,Ae]),i.useEffect(()=>{if(!Ue)return;const $=Z=>{Z.key==="Enter"&&(Z.preventDefault(),ct())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[Ue]);const wa=$=>{D($),h(Oa($))};i.useEffect(()=>{if(!je){h(null),D([]);return}const $=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Va().then(Z=>{const c=Z.filter(v=>v.itemType==="info"&&v.itemId===je.cardId&&v.checkType==="quote-fragment"&&qt(v.direction,je.direction));wa(c)}).catch(()=>{h(null),D([])});return}Ot($,je.cardId,je.checkType,je.direction).then(Z=>wa(Z)).catch(()=>{h(null),D([])})},[je]);const Ja=($,Z,c,v)=>{if($==="info"&&c==="quote-fragment"){Va().then(S=>{const N=S.filter(Y=>Y.itemType==="info"&&Y.itemId===Z&&Y.checkType==="quote-fragment"&&qt(Y.direction,v));wa(N)}).catch(()=>{h(null),D([])});return}Ot($,Z,c,v).then(S=>wa(S)).catch(()=>{h(null),D([])})},Ya=($,Z,c)=>{var Y;const v=((Y=c.pairs.find(L=>L.leftId===$))==null?void 0:Y.rightId)??null;if(!v)return c;const S=v===Z;Te(L=>({...L,[$]:S?"correct":"incorrect"})),Be.current&&window.clearTimeout(Be.current),Ve.current&&window.clearTimeout(Ve.current),pe.current+=1;const N={kind:S?"correct":"incorrect",tick:pe.current};if(_e(null),Be.current=window.setTimeout(()=>_e(N),0),Ve.current=window.setTimeout(()=>_e(null),420),S){const L={...c.locked,[$]:!0};return Object.keys(L).length>=c.pairs.length?(le("correct"),Ke(!0)):le("correct"),{...c,selection:{...c.selection,[$]:Z},activeLeft:null,activeRight:null,locked:L}}return le("incorrect"),{...c,activeLeft:null,activeRight:null}},Nt=$=>{X(Z=>!Z||Z.locked[$]?Z:Z.activeRight?Ya($,Z.activeRight,Z):{...Z,activeLeft:Z.activeLeft===$?null:$})},Lt=$=>{X(Z=>Z&&(Z.activeLeft?Ya(Z.activeLeft,$,Z):{...Z,activeRight:Z.activeRight===$?null:$}))},ct=()=>{var $;if(je&&je.cardType==="info"&&je.infoType==="quote"&&ra.current&&Ne&&!(($=La(je.direction))!=null&&$.fragmentId)){const Z=gt(ra.current,Ra.current,sa.current,Pa,da,je.direction,Ne.fragmentId);if(Z){le(null),ge(""),t(!1),ke({}),Ke(!1),we(null),qe(0),Qa(ra.current,Z.id,Ne.title);return}}le(null),ge(""),t(!1),ke({}),Ke(!1),we(null),qe(0),de(Z=>Math.min(Z+1,f.length))},Fa=$=>{if(!je)return;const Z=$.expected??null,c=$.answer??"";let v=Z??"",S=c;if(!Z&&$.expectedMap&&$.answerMap){const ce=Object.keys($.expectedMap).sort((be,ye)=>be.localeCompare(ye));v=ce.map(be=>{var ye;return((ye=$.expectedMap)==null?void 0:ye[be])??""}).join("|"),S=ce.map(be=>{var ye;return((ye=$.answerMap)==null?void 0:ye[be])??""}).join("|")}const N=v?ht(v,S,Ua):new Uint8Array,Y={revisionType:We.id,evalType:$.evalType,direction:$.direction,prompt:d??"",expected:Z,answer:c,expectedAnswers:$.expectedMap??null,answers:$.answerMap??null,correct:$.correct,maskBase64:N.length?za(N):null,checkMode:xa,compareMode:Ua,minCorrectness:pa},L=new TextEncoder().encode(JSON.stringify(Y)),H=je.cardType==="info"?"info":"connection",A=$.overrideCheckType??je.checkType??null,J=$.overrideDirection??je.direction??null;Kt({itemType:H,itemId:je.cardId,checkType:A,direction:J,revisionType:We.id,evalType:$.evalType,correct:$.correct,maskBase64:N.length?za(N):null,payloadBase64:za(L)}).then(()=>{Ja(H,je.cardId,A,J),ft(f)}).catch(()=>{})},dt=($,Z)=>{const c=ua.current.get(Z);if(c)return Promise.resolve(c);const v=$a.current.get(Z);if(v)return v;const S=_i({shareCode:o,infoId:$,key:na}).then(N=>{var ce,be;const Y=N.payload,L=((ce=Y.definition)==null?void 0:ce.graph)??null,H="",A=((be=Y.definition)==null?void 0:be.answerTemplate)??"",J=wr(L,H,A);if(J){const xe={sample:Xr(J),answerTemplate:A||null};return ua.current.set(Z,xe),xe}return Sr({shareId:o,infoId:$,key:na}).then(ye=>{const xe={sample:ye,answerTemplate:null};return ua.current.set(Z,xe),xe})}).catch(()=>Sr({shareId:o,infoId:$,key:na}).then(N=>{const Y={sample:N,answerTemplate:null};return ua.current.set(Z,Y),Y}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{$a.current.delete(Z)});return $a.current.set(Z,S),S},Ia=($,Z)=>{var L;const c=`${fe($)}:${Z}`,v=tt.current.get(c);if(v)return Promise.resolve(v);const S=pt.current.get(c);if(S)return S;const N=H=>(tt.current.set(c,H),H);let Y;if($.cardType==="vocab"){if($.checkType==="translation-match")return Y=Promise.resolve(N({prompt:$.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),Y;const H=$.label.split("↔").map(A=>A.trim()).filter(Boolean);if(H.length>=2){const J=($.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ce=J?H[0]:H[1],be=J?H[1]:H[0];Y=Promise.resolve(N({prompt:ce,expectedAnswer:be,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else Y=Promise.resolve(N({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if($.cardType==="info"&&$.infoType==="word"){const H=(L=$.description)!=null&&L.startsWith("Language: ")?$.description.replace("Language: ",""):null;Y=Promise.resolve(N({prompt:$.label,expectedAnswer:H,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else $.cardType==="info"&&$.infoType==="computed"?Y=dt($.cardId,c).then(H=>{var ye,xe;if(!H.sample)return N({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const A=H.sample,J=A.expectedAnswers?Object.entries(A.expectedAnswers).map(([Se,Pe])=>({key:Se,expected:Pe})):[],ce=J.reduce((Se,Pe)=>(Se[Pe.key]="",Se),{}),be=A.expectedAnswerIsSentence&&((ye=A.expectedAnswer)==null?void 0:ye.trim())||null;return N({prompt:A.prompt,expectedAnswer:J.length>0?be:((xe=A.expectedAnswer)==null?void 0:xe.trim())||null,computedExpected:J,computedAnswers:ce,answerTemplate:H.answerTemplate,outputVariables:A.outputVariables??null,variableValues:A.variableValues??null})}).catch(()=>N({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{pt.current.delete(c)}):Y=Promise.resolve(N({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return pt.current.set(c,Y),Y},Qa=($,Z,c)=>{const v=Object.keys($.nodes).length,S=Ra.current.size;if(!Z){se({title:c,before:$.text,after:"",fragmentId:null,total:v,completed:S}),_(null),Ke(!0);return}const N=$.nodes[Z];if(!N)return;const Y=Zr($.text,N);se({title:c,before:Y.before,after:Y.after,fragmentId:N.id,total:v,completed:S}),_(Y.fragment),Ke(!1)},xt=()=>{const $=ra.current;$&&se(Z=>Z&&{...Z,total:Object.keys($.nodes).length,completed:Ra.current.size})},Da=()=>{const $=f[U+1];$&&Ia($,U+1)},Ct=()=>{if(Da(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&R){if(R.pairs.length===0){le("incorrect"),Ke(!0);return}const N=R.pairs.reduce((be,ye)=>(be[ye.rightId]=ye.rightLabel,be),{});let Y=0;const L={};R.pairs.forEach(be=>{const xe=R.selection[be.leftId]===be.rightId;L[be.leftId]=xe?"correct":"incorrect",xe&&(Y+=1)});const H=R.pairs.length||1,A=Y/H,J=Y===R.pairs.length;Te(be=>({...be,...L})),J?(le("correct"),Ke(!0),qe(0)):(le("incorrect"),Ke(!1),qe(be=>{const ye=be+1;return ye>=Na&&(t(!0),Ke(!0),X(xe=>{if(!xe)return xe;const Se=xe.pairs.reduce((Pe,Ye)=>(Pe[Ye.leftId]=Ye.rightId,Pe),{});return{...xe,selection:Se}})),ye})),ja(J,A);const ce="connection";Promise.all(R.pairs.map(be=>{const ye=R.selection[be.leftId]??null,xe=ye?N[ye]:"",Se={left:be.leftLabel,expected:be.rightLabel,answer:xe,checkType:"translation-match"},Pe=new TextEncoder().encode(JSON.stringify(Se));return Kt({itemType:ce,itemId:be.cardId,checkType:"translation-match",direction:null,revisionType:We.id,evalType:"translation-match",correct:ye===be.rightId,maskBase64:null,payloadBase64:za(Pe)})})).then(()=>{Ja(ce,je.cardId,je.checkType,je.direction),ft(f)}).catch(()=>{});return}if(ie.length>0){const N=ie.reduce((L,H)=>{const A=Re[H.key]??"";return L[H.key]=ka(A)===ka(H.expected)?"correct":"incorrect",L},{});ie.every(({key:L,expected:H})=>{const A=Re[L]??"";return xa==="exact"&&ka(A)===ka(H)})?(le("correct"),ke(N),Ke(!0),qe(0),ja(!0,1),Fa({correct:!0,direction:d?`${d} -> computed`:"computed",expectedMap:ie.reduce((L,H)=>(L[H.key]=H.expected,L),{}),answerMap:Re,evalType:"computed"})):(le("incorrect"),ke(N),Ke(!1),qe(L=>{const H=L+1;return H>=Na&&Ga&&(t(!0),Ke(!0)),H}),ja(!1,0),window.setTimeout(()=>{var H;const L=Ut(Qe,ie,Ae);L&&De.current[L]&&((H=De.current[L])==null||H.focus())},40),Fa({correct:!1,direction:d?`${d} -> computed`:"computed",expectedMap:ie.reduce((L,H)=>(L[H.key]=H.expected,L),{}),answerMap:Re,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Ne!=null&&Ne.fragmentId)){if(!ee)return;const N=La(je.direction),Y=(N==null?void 0:N.mode)??getQuoteMode(je.direction),L=N!=null&&N.fragmentId&&je.direction?je.direction:kt(Y,Ne.fragmentId),H=li(ee,me,Ua),A=xa==="exact"&&mt(me)===mt(ee),J=nt(H),ce=A||J,be=Wa(H);ce?(sa.current[Ne.fragmentId]=Math.max(sa.current[Ne.fragmentId]??0,be),(sa.current[Ne.fragmentId]??0)>=Pa&&Ra.current.add(Ne.fragmentId),xt(),le("correct"),ke({}),Ke(!0),we(H),qe(0),be<100&&Na<=1&&t(!0),ja(!0,be/100),Fa({correct:!0,direction:`quote:${Ne.fragmentId}`,expected:ee,answer:me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L})):(le("incorrect"),ke({}),Ke(!1),we(H),qe(ye=>{const xe=ye+1;return xe>=Na&&Ga&&(t(!0),Ke(!0)),xe}),ja(!1,be/100),window.setTimeout(()=>{var ye;return(ye=ta.current)==null?void 0:ye.focus()},40),Fa({correct:!1,direction:`quote:${Ne.fragmentId}`,expected:ee,answer:me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L}));return}if(!ee)return;const $=ht(ee,me,Ua),Z=xa==="exact"&&ka(me)===ka(ee),c=nt($),v=Z||c,S=Wa($);v?(le("correct"),ke({}),Ke(!0),we($),qe(0),S<100&&Na<=1&&t(!0),ja(!0,S/100),Fa({correct:!0,direction:d?`${d} -> ${ee}`:null,expected:ee,answer:me,evalType:"text"})):(le("incorrect"),ke({}),Ke(!1),we($),qe(N=>{const Y=N+1;return Y>=Na&&Ga&&(t(!0),Ke(!0)),Y}),ja(!1,S/100),window.setTimeout(()=>{var N;return(N=ta.current)==null?void 0:N.focus()},40),Fa({correct:!1,direction:d?`${d} -> ${ee}`:null,expected:ee,answer:me,evalType:"text"}))},ut=$=>{if(Da(),!ee)return;const Z=ht(ee,$,Ua),c=ka($)===ka(ee),v=nt(Z),S=c||v,N=Wa(Z);S?(le("correct"),ke({}),Ke(!0),we(Z),qe(0),N<100&&Na<=1&&t(!0),ja(!0,N/100),Fa({correct:!0,direction:"word->language",expected:ee,answer:$,evalType:"language-select"})):(le("incorrect"),ke({}),Ke(!1),we(Z),qe(Y=>{const L=Y+1;return L>=Na&&Ga&&(t(!0),Ke(!0)),L}),ja(!1,N/100),Fa({correct:!1,direction:"word->language",expected:ee,answer:$,evalType:"language-select"}))},Mt=$=>{var c;if($.key!=="Enter")return;if($.preventDefault(),$.stopPropagation(),Ue){ct();return}const Z=ie.find(v=>!(Re[v.key]??"").trim());if(Z){(c=De.current[Z.key])==null||c.focus();return}Ct()},Zt=()=>{Da(),le("correct"),Ke(!0),qe(0),ja(!0,1),ee&&Fa({correct:!0,direction:"manual",expected:ee,answer:me,evalType:"manual"})},er=()=>{if(ja(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){le(null),ge(""),t(!1),ke({}),Ke(!1),we(null),qe(0),de($=>Math.min($+1,f.length));return}ct()};i.useEffect(()=>{Da()},[U,f]);const ar=a.cogita.library.revision.revealModeAfterIncorrect,Ga=ie.length>0||!!ee;return e.jsxs(Ca,{copy:a,authLabel:n,showProfileMenu:l,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:P,language:M,onLanguageChange:F,children:[(x==="loading"||B==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ne.total?Math.min(100,Math.max(0,ne.current/ne.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ne.total?`${Math.min(ne.current,ne.total)} / ${ne.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:q}),e.jsx("p",{className:"cogita-library-subtitle",children:s}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",Ma).replace("{check}",Ba)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Sa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Sa.currentLevel??"-"," / ",Sa.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[ae?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:ae})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Ee?`${Ee.kind}-${Ee.tick}`:_a?"idle":K??"idle",children:x!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):je?e.jsx(e.Fragment,{children:Je?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:je,currentTypeLabel:Yt,prompt:d,languages:O,answer:me,onAnswerChange:$=>ge(Z=>_t(Z,$,j)),computedExpected:ie,computedAnswers:Re,onComputedAnswerChange:($,Z)=>Ce(c=>({...c,[$]:_t(c[$]??"",Z,j)})),answerTemplate:Qe,outputVariables:Ae,variableValues:ia,computedFieldFeedback:$e,feedback:K,canAdvance:Ue,quoteContext:Ne,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ct,onSkip:er,onLanguageSelect:ut,onMarkReviewed:Zt,onAdvance:ct,showCorrectAnswer:Q,setShowCorrectAnswer:t,onRevealCorrect:()=>Ke(!0),answerMask:oe,expectedAnswer:ee,hasExpectedAnswer:Ga,handleComputedKeyDown:Mt,answerInputRef:ta,computedInputRefs:De,scriptMode:j,setScriptMode:k,matchPairs:R==null?void 0:R.pairs,matchLeftOrder:R==null?void 0:R.leftOrder,matchRightOrder:R==null?void 0:R.rightOrder,matchSelection:R==null?void 0:R.selection,matchActiveLeft:R==null?void 0:R.activeLeft,matchActiveRight:R==null?void 0:R.activeRight,matchFeedback:Fe,onMatchLeftSelect:Nt,onMatchRightSelect:Lt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:it?`${Ea} / ${it}`:a.cogita.library.revision.progressUnlimited}),x==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),x==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),x==="ready"&&B==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),x==="ready"&&B==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),x==="ready"&&B==="ready"&&f.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:ar}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Na]})]})]}),Sa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Sa.activeCount," / ",Sa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Sa.counts.map(($,Z)=>{const c=Z+1,v=Sa.currentLevel===c,S=Sa.percentages[Z]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":v,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:c}),e.jsx("strong",{children:$})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,S))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[S.toFixed(1),"%"]})]},`level-${c}`)})})]}):null,lt?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:lt.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:lt.dots.map($=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-$.value))}, ${Math.round(200*$.value)}, 80, 0.9)`}},$.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:lt.knownCount})]})]}):null,da?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Aa})]})}):null]})]})]})})})]})]})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Un},Symbol.toStringTag,{value:"Module"}));export{Jn as C,Yn as a,Qn as b};
