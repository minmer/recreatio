import{r as a,j as e,u as _s,a as Va,b as Vs,c as Os,d as qs,R as gs,B as ms,C as ps}from"./vendor-CL5v9b84.js";import{L as Us,A as Ws,g as Hs,a as yn,b as ja,c as Qs,s as ks,d as fs,e as xn,f as Ns,h as Yt,i as vn,j as Ys,k as Gs,l as Xs,m as bs,n as Js,o as wn,u as jn,p as kn,q as Nn,r as Sn,t as Zs,v as Tn,w as en,x as tn,y as Cn,z as Mn,B as In,C as Oa,D as Ra,E as Ln,F as $n,G as Rn,H as En,I as An,J as Pn,K as Ss,M as Qt,N as Fn,O as Kn,P as zn,Q as Bn,R as Dn,S as _n,T as Vn,U as On,V as qn,W as Un,X as Wn,Y as Hn,Z as Qn,_ as Yn,$ as Gn,a0 as Xn,a1 as Ts}from"./recreatio-core-C0WUwo_7.js";import"./vendor-cogita-ui-mbCyoqV0.js";const wa={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},xa={moveMs:900,pauseMs:220,errorMs:900},Jn=(t=11)=>{let s=t;const n=()=>(s=(s*1664525+1013904223)%4294967296,s/4294967296),{width:i,height:o,paddingX:m,paddingY:f,levels:v}=wa,A=(o-f*2)/(v.length-1),T=[],c=[],y=[];v.forEach((S,h)=>{const ce=o-f-h*A,K=i-m*2,b=[];for(let H=0;H<S;H+=1){const $=m+(H+1)*K/(S+1),X=(n()-.5)*18,I=Math.max(m,Math.min(i-m,$+X)),E=h===0?3:h<2?2.1:1.4,se=h===0?"root":`l${h}-${H}`;b.push({id:se,x:h===0?i/2:I,y:ce,r:E,level:h,role:h===0?"root":void 0})}y.push(b),T.push(...b)});const l=y[y.length-1];if(l!=null&&l.length){const S=l[Math.floor(l.length/2)];S.role="goal",S.r=2}for(let S=1;S<y.length;S+=1){const h=y[S-1];y[S].forEach(K=>{const b=[...h].sort((I,E)=>Math.abs(I.x-K.x)-Math.abs(E.x-K.x)),H=b[0],$=b[1]&&n()<.45?b[1]:null;($?[H,$]:[H]).forEach(I=>{c.push({from:I.id,to:K.id,key:`${I.id}-${K.id}`})}),n()<.2&&b[2]&&c.push({from:b[2].id,to:K.id,key:`${b[2].id}-${K.id}`})})}const u=new Map;c.forEach(S=>{const h=u.get(S.to)??[];h.push(S.from),u.set(S.to,h)});const k=new Map,oe=new Map,G=new Map;c.forEach(S=>{const h=k.get(S.from)??[];h.push(S.key),k.set(S.from,h);const ce=oe.get(S.from)??[];ce.push(S.to),oe.set(S.from,ce);const K=G.get(S.from)??[];K.push(S.to),G.set(S.from,K);const b=G.get(S.to)??[];b.push(S.from),G.set(S.to,b)});const W=new Map;return T.forEach(S=>{W.set(S.id,S)}),{nodes:T,links:c,parentsById:u,linksByFrom:k,childrenByFrom:oe,neighborsById:G,nodesById:W}};function Zn({slides:t,activeIndex:s,introOpen:n,prefersReducedMotion:i,onNext:o,onPrev:m,onSelect:f,onExit:v,onOpen:A,onRegister:T}){const c=s===t.length-1,y=n&&s===0?"entry":"docked",l=t[t.length-1],[u,k]=a.useState(!1),oe=a.useMemo(()=>Array.from({length:20},(Y,ge)=>({src:`/cogita/logo/Cogita${String(ge).padStart(2,"0")}.png`,kind:ge<=11?"bubble":ge<=17?"text":"recreatio"})),[]),G=n&&s===0;a.useEffect(()=>{if(!n){k(!1);return}s>0&&!u&&k(!0)},[s,n,u]);const W=a.useRef(0),S=a.useRef(null),h=a.useMemo(()=>{const Y={x:40,y:160},ge={x:260,y:48},Ee=6,R=ge.x-Y.x,O=Y.y-ge.y,ye=R/Ee,Me=[.3,.45,.6,.65,1.4,2.2],je=Me.reduce((Ae,Se)=>Ae+Se,0),Re=Me.map(Ae=>O*Ae/je),Fe=[Y];let We=Y.x,$e=Y.y;for(let Ae=1;Ae<=Ee;Ae+=1){const Se=(Math.random()-.5)*14,st=(Math.random()-.5)*28;We=Math.max(Y.x+Ae*14,Math.min(ge.x-(Ee-Ae)*14,We+ye+Se));const Qe=Re[Ae-1]??Re[Re.length-1];$e=$e-Qe+st;const Je=Math.max(ge.y,Math.min(Y.y-4,$e));Fe.push({x:Math.round(We),y:Math.round(Je)})}return Fe[Fe.length-1]=ge,Fe},[]),ce=a.useMemo(()=>{const O=(je,Re,Fe)=>Math.min(Fe,Math.max(Re,je)),ye=h.map(je=>{const Re=10+Math.random()*36;return{x:O(je.x,40,260),y:O(je.y-Re,40,140)}}),Me=h.map((je,Re)=>{var $e;const Fe=12+Math.random()*40,We=(($e=ye[Re])==null?void 0:$e.y)??je.y;return{x:O(je.x,40,260),y:O(Math.max(We+10,je.y+Fe),60,170)}});return{upper:ye,lower:Me}},[h]),K=a.useMemo(()=>{var ge;const Y=((ge=h[4])==null?void 0:ge.x)??260;return Math.max(0,Math.min(240,Y-40))},[h]),b=a.useMemo(()=>{var Re,Fe;const Y=(We,$e,Ae)=>Math.min(Ae,Math.max($e,We)),ge=(We,$e,Ae)=>h.map((Se,st)=>{var lt,dt;const Qe=((lt=ce.upper[st])==null?void 0:lt.y)??Se.y,Je=((dt=ce.lower[st])==null?void 0:dt.y)??Se.y,rt=(Math.random()-.5)*70,yt=Se.y+We+rt,Ze=Y(Se.y+$e,Qe+6,Je-6),tt=Y(Se.y+Ae,Qe+6,Je-6);return{x:Se.x,y:Y(yt,Math.min(Ze,tt),Math.max(Ze,tt))}}),Ee=-14+Math.random()*28,R=14+Math.random()*28,O=ge(Ee,-80,12),ye=ge(R,-12,80);for(let We=4;We<h.length;We+=1){const $e=h[We],Ae=((Re=ce.upper[We])==null?void 0:Re.y)??$e.y,Se=((Fe=ce.lower[We])==null?void 0:Fe.y)??$e.y;O[We]={x:$e.x,y:Y($e.y-12,Ae+6,Se-6)},ye[We]={x:$e.x,y:Y($e.y+12,Ae+6,Se-6)}}const Me=ce.upper.length?ce.upper[ce.upper.length-1].y:40,je=ce.lower.length?ce.lower[ce.lower.length-1].y:170;return O[O.length-1]={x:h[h.length-1].x,y:Y(h[h.length-1].y-14,Me,je)},ye[ye.length-1]={x:h[h.length-1].x,y:Y(h[h.length-1].y+12,Me,je)},{higher:O,lower:ye}},[h,ce]),H=1e4,$=a.useMemo(()=>{let Y=17;const ge=()=>(Y=(Y*1664525+1013904223)%4294967296,Y/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((R,O)=>{const ye=(ge()-.5)*240,Me=(ge()-.5)*180,je=(ge()-.5)*24;return{id:`card-${O+1}`,throw:{x:`${ye.toFixed(0)}px`,y:`${Me.toFixed(0)}px`,rot:`${je.toFixed(1)}deg`},grid:{x:`${R.x}px`,y:`${R.y}px`},delay:`${O*.12}s`}})},[]),X=a.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[I,E]=a.useState([]),se=a.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),ie=a.useMemo(()=>{const ge=[],R=(ye,Me)=>ye+Math.random()*(Me-ye);for(let ye=0;ye<6;ye+=1){let Me=!1;for(let je=0;je<80;je+=1){const Re=R(14,86),Fe=R(10,34);if(ge.every($e=>{const Ae=$e.x-Re,Se=$e.y-Fe;return Math.hypot(Ae,Se)>=12})){ge.push({x:Re,y:Fe}),Me=!0;break}}Me||ge.push({x:R(16,84),y:R(12,32)})}return ge.map((ye,Me)=>({id:`p${Me+1}`,x:`${ye.x.toFixed(1)}%`,y:`${ye.y.toFixed(1)}%`,xNum:ye.x,yNum:ye.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ee,_e]=a.useState(0),[fe,C]=a.useState(0),[be,x]=a.useState([]),V=1e4,he=a.useMemo(()=>{if(ie.length<2)return[];const Y=Me=>{let je=Me+1831565813;return je=Math.imul(je^je>>>15,je|1),je^=je+Math.imul(je^je>>>7,je|61),((je^je>>>14)>>>0)/4294967296},ge=(Me,je)=>Math.floor(Y(Me)*je),Ee=new Set,R=[],O=Math.min(3,ie.length);let ye=0;for(;R.length<O&&ye<30;){ye+=1;const Me=ge(ee*13+ye*5,ie.length),je=ge(ee*29+ye*7,ie.length);if(Me===je)continue;const Re=Me<je?`${Me}-${je}`:`${je}-${Me}`;Ee.has(Re)||(Ee.add(Re),R.push({id:`link-${Re}`,from:ie[Me],to:ie[je],delay:`${(ye*.35).toFixed(2)}s`}))}return R},[ee,ie]);a.useEffect(()=>{if(!n||s!==2)return;const Y=()=>{const Ee=$.map(R=>R.id);for(let R=Ee.length-1;R>0;R-=1){const O=Math.floor(Math.random()*(R+1));[Ee[R],Ee[O]]=[Ee[O],Ee[R]]}return Ee.slice(0,4)};E(Y());const ge=window.setInterval(()=>{E(Y())},H);return()=>window.clearInterval(ge)},[s,n,$,H]),a.useEffect(()=>{if(!n||s!==3)return;const Y=()=>{C(Math.floor(Math.random()*se.length)),x(ie.map(()=>Math.random()<.6?"good":"bad")),_e(Ee=>Ee+1)};Y();const ge=window.setInterval(Y,V);return()=>window.clearInterval(ge)},[s,n,se.length,ie,V]);const Q=a.useMemo(()=>Jn(11),[]),[z,ve]=a.useState(new Set(["root"])),[xe,ke]=a.useState(new Set),[Te,Ne]=a.useState(new Set),[qe,Ke]=a.useState({fromId:"root",toId:"root",key:0}),te=a.useRef(z),Ce=a.useRef("root"),Ve=a.useRef(0),ze=a.useRef(null),F=a.useRef(null),U=a.useRef([]);a.useEffect(()=>{te.current=z},[z]);const Be=a.useMemo(()=>{const Y=new Set;return z.forEach(ge=>{const Ee=Q.linksByFrom.get(ge);Ee&&Ee.forEach(R=>Y.add(R))}),Y},[z,Q]),re=Q.nodesById.get(qe.toId)??Q.nodesById.get("root"),J=re?`${re.x/wa.width*100}%`:"50%",we=re?`${re.y/wa.height*100}%`:"90%";a.useEffect(()=>{if(!n||s!==1||i)return;(()=>{ve(new Set(["root"])),ke(new Set),Ne(new Set),Ke({fromId:"root",toId:"root",key:0}),F.current=null,Ve.current=0,Ce.current="root",U.current=[]})();const ge=()=>{const R=Ce.current,O=te.current,Me=(Q.childrenByFrom.get(R)??[]).filter(Se=>!O.has(Se));if(Me.length)return Me[Math.floor(Math.random()*Me.length)];if(O.size>=Q.nodes.length){const Se=Q.neighborsById.get(R)??[];return Se.length?Se[Math.floor(Math.random()*Se.length)]:null}const je=Se=>(Q.childrenByFrom.get(Se)??[]).some(Qe=>!O.has(Qe)),Re=[R],Fe=new Set([R]),We=new Map;let $e=null;for(;Re.length;){const Se=Re.shift();if(!Se)break;if(Se!==R&&je(Se)){$e=Se;break}(Q.neighborsById.get(Se)??[]).forEach(Qe=>{Fe.has(Qe)||(Fe.add(Qe),We.set(Qe,Se),Re.push(Qe))})}if(!$e)return null;let Ae=$e;for(;We.get(Ae)&&We.get(Ae)!==R;)Ae=We.get(Ae)??Ae;return Ae},Ee=(R,O)=>{if(R===O){const ye=ge();ye&&Ee(R,ye);return}Ve.current+=1,Ke({fromId:R,toId:O,key:Ve.current}),Ce.current=O,ze.current=window.setTimeout(()=>{const ye=Q.parentsById.get(O)??[],Me=te.current,je=ye.filter($e=>!Me.has($e));if(!je.length){const $e=new Set(Me);$e.add(O),ve($e),ze.current=window.setTimeout(()=>{for(;U.current.length;){const Se=U.current[U.current.length-1];if(!$e.has(Se)){if(Se!==O){Ee(O,Se);return}break}U.current.pop()}const Ae=ge();Ae&&Ee(O,Ae)},xa.pauseMs);return}const Re=new Set([O,...je]),Fe=new Set(je.map($e=>`${$e}-${O}`));ke(Re),Ne(Fe),U.current.includes(O)||U.current.push(O);const We=je[Math.floor(Math.random()*je.length)];F.current={fromId:O,toId:We},ze.current=window.setTimeout(()=>{ke(new Set),Ne(new Set);const $e=F.current;$e&&Ee($e.fromId,$e.toId)},xa.errorMs)},xa.moveMs)};return ze.current=window.setTimeout(()=>{const R=ge();R&&Ee(Ce.current,R)},xa.pauseMs),()=>{ze.current&&window.clearTimeout(ze.current)}},[s,n,Q,i]);const Pe=Y=>{if(!n)return;const ge=Date.now();ge-W.current<520||Math.abs(Y.deltaY)<10||(W.current=ge,Y.deltaY>0?o():m(),Y.preventDefault())},De=Y=>{if(!n)return;const ge=Y.touches[0];ge&&(S.current={x:ge.clientX,y:ge.clientY})},Ue=Y=>{if(!n)return;const ge=S.current;if(S.current=null,!ge)return;const Ee=Y.changedTouches[0];if(!Ee)return;const R=Ee.clientX-ge.x,O=Ee.clientY-ge.y;Math.abs(O)<40||Math.abs(O)<Math.abs(R)||(O<0?o():m())};return e.jsxs("div",{className:`cogita-intro ${n?"is-open":"is-closed"} ${i?"is-reduced":""} ${c?"is-final":""}`,"data-slide":s+1,onWheel:Pe,onTouchStart:De,onTouchEnd:Ue,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":y,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${G&&!u?"is-entry":""}`,children:oe.map((Y,ge)=>e.jsx("img",{src:Y.src,alt:"",className:`cogita-logo-layer ${ge===0?"is-base":""} ${Y.kind==="text"?"is-text":Y.kind==="recreatio"?"is-recreatio":""} ${Y.kind==="bubble"?"is-bubble":""}`},Y.src))})}),n&&t.map((Y,ge)=>{const Ee=ge===s;return e.jsxs("section",{className:`cogita-intro-slide slide-${ge+1} ${Ee?"is-active":""}`,"aria-hidden":!Ee,children:[e.jsxs("div",{className:"cogita-intro-text",children:[Y.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:Y.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:Y.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:Y.title}),Y.body&&e.jsx("p",{children:Y.body.split(`
`).map((R,O)=>e.jsxs("span",{children:[R,O===0&&e.jsx("br",{})]},String(O)))})]}),Y.micro&&e.jsx("p",{className:"cogita-intro-micro",children:Y.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:c?T:o,children:Y.cta}),c&&Y.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>f(0),children:Y.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[ge===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${wa.width} ${wa.height}`,preserveAspectRatio:"none",children:[Q.links.map(R=>{const O=Q.nodesById.get(R.from),ye=Q.nodesById.get(R.to);if(!O||!ye)return null;const Me=Be.has(R.key),je=Te.has(R.key);return e.jsx("line",{className:`map-link ${Me?"is-active":""} ${je?"is-error":""}`,x1:O.x,y1:O.y,x2:ye.x,y2:ye.y},R.key)}),Q.nodes.map(R=>{const O=z.has(R.id),ye=xe.has(R.id);return e.jsx("circle",{className:`map-node ${R.role?`is-${R.role}`:""} ${O?"is-active":""} ${ye?"is-error":""}`,cx:R.x,cy:R.y,r:R.r},R.id)})]}),re&&e.jsx("span",{className:"map-explorer-dot",style:{left:J,top:we,"--move":`${xa.moveMs}ms`}})]}),ge===2&&e.jsx("div",{className:"cogita-index-cards",children:$.map(R=>{const O=I.indexOf(R.id),ye=O>=0?X[O]:null,Me=(ye==null?void 0:ye.x)??"140px",je=(ye==null?void 0:ye.y)??"140px",Re=O>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":R.throw.x,"--throw-y":R.throw.y,"--throw-rot":R.throw.rot,"--grid-x":R.grid.x,"--grid-y":R.grid.y,"--stack-x":Me,"--stack-y":je,"--stack-opacity":Re,"--delay":R.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},R.id)})}),ge===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[se.map((R,O)=>e.jsxs("div",{className:`round-card ${O===fe?"is-active":""}`,style:{"--card-x":R.x,"--card-y":R.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},R.id)),se[fe]&&e.jsx("span",{className:"round-ring",style:{"--card-x":se[fe].x,"--card-y":`calc(${se[fe].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:ie.map(R=>e.jsx("span",{className:"player-dot",style:{left:R.x,top:R.y,"--jitter-x":R.jitterX,"--jitter-y":R.jitterY,"--breath-delay":R.delay}},R.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:he.map(R=>e.jsx("line",{className:"round-link",x1:R.from.xNum,y1:R.from.yNum,x2:R.to.xNum,y2:R.to.yNum,style:{"--delay":R.delay}},R.id))}),e.jsx("div",{className:"round-flows",children:ie.map((R,O)=>{const ye=be[O]??"good",Me=se[fe];if(!Me)return null;const je=`calc(${Me.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":R.x,"--from-y":R.y,"--to-x":Me.x,"--to-y":je,"--delay":`${O*.12}s`}}),e.jsx("span",{className:`return-dot is-${ye}`,style:{"--from-x":Me.x,"--from-y":je,"--to-x":R.x,"--to-y":R.y,"--delay":`${O*.12}s`}}),e.jsx("span",{className:`result-pop is-${ye}`,style:{"--at-x":R.x,"--at-y":R.y,"--delay":`${O*.12}s`}})]},`${R.id}-${ee}`)})})]},`round-${ee}`),ge===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${h[0].x} ${h[0].y} L${h[1].x} ${h[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${h[1].x} ${h[1].y} L${h[2].x} ${h[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${h[2].x} ${h[2].y} L${h[3].x} ${h[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${h[3].x} ${h[3].y} L${h[4].x} ${h[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${h[4].x} ${h[4].y} L${h[5].x} ${h[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${h[5].x} ${h[5].y} L${h[6].x} ${h[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${K};${K};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${ce.upper.map((R,O)=>`${O===0?"M":"L"}${R.x} ${R.y}`).join(" ")} ${ce.lower.slice().reverse().map(R=>`L${R.x} ${R.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${ce.upper.map((R,O)=>`${O===0?"M":"L"}${R.x} ${R.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${ce.lower.map((R,O)=>`${O===0?"M":"L"}${R.x} ${R.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[b.higher.slice(0,6).map((R,O)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${O+1}`,d:`M${R.x} ${R.y} L${b.higher[O+1].x} ${b.higher[O+1].y}`,pathLength:"100"},`peer-1-${O}`)),b.lower.slice(0,6).map((R,O)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${O+1}`,d:`M${R.x} ${R.y} L${b.lower[O+1].x} ${b.lower[O+1].y}`,pathLength:"100"},`peer-2-${O}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${h[0].x/300*100}%`,"--p0y":`${h[0].y/200*100}%`,"--p1x":`${h[1].x/300*100}%`,"--p1y":`${h[1].y/200*100}%`,"--p2x":`${h[2].x/300*100}%`,"--p2y":`${h[2].y/200*100}%`,"--p3x":`${h[3].x/300*100}%`,"--p3y":`${h[3].y/200*100}%`,"--p4x":`${h[4].x/300*100}%`,"--p4y":`${h[4].y/200*100}%`,"--p5x":`${h[5].x/300*100}%`,"--p5y":`${h[5].y/200*100}%`,"--p6x":`${h[6].x/300*100}%`,"--p6y":`${h[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${b.higher[0].x/300*100}%`,"--q0y":`${b.higher[0].y/200*100}%`,"--q1x":`${b.higher[1].x/300*100}%`,"--q1y":`${b.higher[1].y/200*100}%`,"--q2x":`${b.higher[2].x/300*100}%`,"--q2y":`${b.higher[2].y/200*100}%`,"--q3x":`${b.higher[3].x/300*100}%`,"--q3y":`${b.higher[3].y/200*100}%`,"--q4x":`${b.higher[4].x/300*100}%`,"--q4y":`${b.higher[4].y/200*100}%`,"--q5x":`${b.higher[5].x/300*100}%`,"--q5y":`${b.higher[5].y/200*100}%`,"--q6x":`${b.higher[6].x/300*100}%`,"--q6y":`${b.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${b.lower[0].x/300*100}%`,"--q0y":`${b.lower[0].y/200*100}%`,"--q1x":`${b.lower[1].x/300*100}%`,"--q1y":`${b.lower[1].y/200*100}%`,"--q2x":`${b.lower[2].x/300*100}%`,"--q2y":`${b.lower[2].y/200*100}%`,"--q3x":`${b.lower[3].x/300*100}%`,"--q3y":`${b.lower[3].y/200*100}%`,"--q4x":`${b.lower[4].x/300*100}%`,"--q4y":`${b.lower[4].y/200*100}%`,"--q5x":`${b.lower[5].x/300*100}%`,"--q5y":`${b.lower[5].y/200*100}%`,"--q6x":`${b.lower[6].x/300*100}%`,"--q6y":`${b.lower[6].y/200*100}%`}})]})})}),ge===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),ge===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},Y.id)}),!n&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:l.title}),l.body&&e.jsx("p",{children:l.body}),l.micro&&e.jsx("p",{className:"cogita-intro-micro",children:l.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:T,children:l.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:A,children:"Otwórz pokaz"})]})]})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:t.map((Y,ge)=>e.jsx("button",{type:"button",className:`dot ${s===ge?"active":""}`,"aria-label":Y.title,onClick:()=>f(ge)},Y.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:v,children:"Pomiń"})]})]})}const ei=6,ti=4;function ai({copy:t,onAuthAction:s,authLabel:n,showProfileMenu:i,onProfileNavigate:o,onToggleSecureMode:m,onLogout:f,secureMode:v,onNavigate:A,language:T,onLanguageChange:c}){const y=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}A("home")},l=a.useRef(null),u=a.useRef([]),k=a.useMemo(()=>{let x=Date.now()%2147483647;const V=()=>(x=x*48271%2147483647,x/2147483647);return Array.from({length:ei},(he,Q)=>{const z=6+V()*8,ve=7+V()*10,xe=6+V()*9,ke=-V()*z,Te=-V()*ve,Ne=-V()*xe,qe=.18+V()*.28,Ke=12+V()*18,te=4+V()*8,Ce=(V()-.5)*3.2,Ve=(V()-.5)*3.8,ze=V()>.5?"alternate":"alternate-reverse",F=V()>.5?"alternate":"alternate-reverse",U=V()>.5?"alternate":"alternate-reverse",Be=.18+V()*.42,re=30+V()*60,J=-45-V()*38,we=188+V()*32,Pe=.1+V()*.2;return{id:`wave-${Q+1}`,style:{"--wave-sway-duration":`${z}s`,"--wave-scale-duration":`${ve}s`,"--wave-drift-duration":`${xe}s`,"--wave-sway-delay":`${ke}s`,"--wave-scale-delay":`${Te}s`,"--wave-drift-delay":`${Ne}s`,"--wave-sway-dir":ze,"--wave-scale-dir":F,"--wave-drift-dir":U,"--wave-scale":`${qe}`,"--wave-shift":`${Ke}%`,"--wave-xshift":`${te}%`,"--wave-x0":`${Ce}%`,"--wave-y0":`${Ve}%`,"--wave-opacity":`${Be}`,"--wave-blur":`${re}px`,"--wave-bottom":`${J}%`,"--wave-hue":`${we}`,"--wave-glow":`${Pe}`}}})},[]),oe=a.useMemo(()=>{let x=Date.now()*3%2147483647;const V=()=>(x=x*48271%2147483647,x/2147483647);return Array.from({length:ti},(he,Q)=>{const z=180+V()*220,ve=220+V()*280,xe=-V()*z,ke=-V()*ve,Te=.12+V()*.22,Ne=3+V()*7,qe=1+V()*3,Ke=(V()-.5)*2.8,te=(V()-.5)*2.2;return{id:`mesh-${Q+1}`,seed:1e3+Q*991+Math.floor(V()*999),style:{"--mesh-sway-duration":`${z}s`,"--mesh-drift-duration":`${ve}s`,"--mesh-sway-delay":`${xe}s`,"--mesh-drift-delay":`${ke}s`,"--mesh-scale":`${Te}`,"--mesh-shift":`${Ne}%`,"--mesh-xshift":`${qe}%`,"--mesh-x0":`${te}%`,"--mesh-y0":`${Ke}%`}}})},[]),G=a.useMemo(()=>{const x=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],V=t.cogita.introSlides,he=new Map(V.map(Q=>[Q.id,Q]));return x.map(Q=>{var ve;const z=he.get(Q.id);return{...Q,...z,title:(z==null?void 0:z.title)??"Cogita",cta:(z==null?void 0:z.cta)??((ve=t.cogita.introSlides[0])==null?void 0:ve.cta)??t.cogita.loginCta,secondary:z==null?void 0:z.secondary}})},[t.cogita.introSlides]),[W,S]=a.useState(0),[h,ce]=a.useState(!0),[K,b]=a.useState(!1),H=G.length-1,$=a.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),X=a.useCallback(()=>{$(),s()},[$,s]),I=a.useCallback(()=>{ce(!0),S(0)},[]),E=a.useCallback(()=>{ce(!1),S(H)},[H]),se=a.useCallback(x=>{S(Math.max(0,Math.min(H,x)))},[H]),ie=a.useCallback(()=>{W>=H?X():se(W+1)},[W,se,X,H]),ee=a.useCallback(()=>{se(W-1)},[W,se]);a.useEffect(()=>{var he;const x=(he=window.matchMedia)==null?void 0:he.call(window,"(prefers-reduced-motion: reduce)");if(!x)return;const V=()=>b(x.matches);return V(),x.addEventListener?(x.addEventListener("change",V),()=>x.removeEventListener("change",V)):(x.addListener(V),()=>x.removeListener(V))},[]),a.useEffect(()=>{if(!h)return;const x=V=>{const he=V.target;if(!he)return;const Q=he.tagName;if(!(he.isContentEditable||Q==="INPUT"||Q==="TEXTAREA"||Q==="SELECT"||Q==="BUTTON"||Q==="A"||he.closest('button, a, [role="button"], [role="link"]'))){if(V.key==="Escape"){E();return}if(V.key==="ArrowLeft"||V.key==="ArrowUp"){ee();return}(V.key==="ArrowRight"||V.key==="ArrowDown"||V.code==="Space"||V.key===" ")&&(V.preventDefault(),ie())}};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[E,ie,ee,h]),a.useEffect(()=>{h&&W===H&&$()},[W,h,H,$]),a.useEffect(()=>{const x=l.current;if(!x)return;const V=u.current.filter(J=>!!J);if(!V.length)return;const he=1,Q=.6,z=.6,ve=Math.max(1,Math.min(he,window.devicePixelRatio||1));let xe=0,ke=0,Te=Q,Ne=0,qe=0;const Ke=J=>{let we=J%2147483647;return we<=0&&(we+=2147483646),(Pe,De)=>{we=we*48271%2147483647;const Ue=we/2147483647;return Pe+Ue*(De-Pe)}},te={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},Ce=J=>{const we=Math.sin(J*12.9898)*43758.5453;return we-Math.floor(we)},Ve=J=>{const we=Ce(J+.1)||1e-4,Pe=Ce(J+.7)||1e-4;return Math.sqrt(-2*Math.log(we))*Math.cos(2*Math.PI*Pe)},ze=(J,we)=>{const Pe=Math.floor(J),De=Pe+1,Ue=J-Pe,Y=Ue*Ue*(3-2*Ue),ge=Ce(Pe*12.9898+we*78.233),Ee=Ce(De*12.9898+we*78.233);return ge+(Ee-ge)*Y},F=J=>{const we=Ke(J),Pe=Math.min(4,Math.max(4,Math.floor(xe/1200*te.filamentCount)));return Array.from({length:Pe},(De,Ue)=>{const Y=Math.max(-1,Math.min(1,Ve(J+Ue*.37))),ge=Math.min(1,Math.max(0,Ce(J+Ue*1.31))),Ee=Math.min(te.depthLayers-1,Math.floor(ge*te.depthLayers));return{seed:we(0,Math.PI*2)+J*.01,offset:Y,freqA:te.freq1*(.75+we(0,.5)),freqB:te.freq2*(.75+we(0,.5)),ampA:te.amp1*(.6+we(0,.7)),ampB:te.amp2*(.6+we(0,.7)),width:2+Ue%5*.32,depth:ge,layer:Ee}})},U=(J,we,Pe)=>{const De=Math.max(30,Math.floor(xe*ke/14e4));J.save(),J.globalAlpha=.6;for(let Ue=0;Ue<De;Ue+=1){const Y=Ce(Ue*9.1+xe*.11)*we+Pe,ge=Ce(Ue*3.7+ke*.23)*ke,Ee=1.2+Ce(Ue*5.9)*2.4,R=J.createRadialGradient(Y,ge,0,Y,ge,Ee*2);R.addColorStop(0,"rgba(10, 30, 60, 0.45)"),R.addColorStop(1,"rgba(10, 30, 60, 0)"),J.fillStyle=R,J.beginPath(),J.arc(Y,ge,Ee*2,0,Math.PI*2),J.fill()}J.restore()},Be=(J,we)=>{J.clearRect(0,0,xe,ke);const Pe=ke*te.waveCenter,De=te.waveBandPx,Ue=te.segments,Y=te.colors.filaments,ge=Ne||xe,Ee=0;U(J,ge,Ee),J.strokeStyle=Y,J.lineCap="round",J.lineJoin="round";for(let R=0;R<we.length;R+=1){const O=we[R],ye=O.offset*De*(.85+Ce(O.seed)*.4),Me=1-Math.min(1,Math.abs(ye)/De),je=Math.exp(-Math.pow(ye/te.crestThickness,2)),Re=O.layer===0?1.1:O.layer===1?.85:.6,Fe=.35+(1-O.depth)*.65,We=Me*Fe*Re*(.34+je*.45);J.globalAlpha=We,J.lineWidth=O.width*(1+(1-O.depth)*.8);const $e=[];for(let Se=0;Se<=Ue;Se+=1){const st=Se/Ue*ge+Ee,Qe=(ze(st*.012,O.seed)-.5)*te.xJitter,Je=st+Qe,rt=(ze(Je*O.freqA,O.seed)-.5)*te.jitterA,yt=(ze(Je*O.freqB,O.seed*1.7)-.5)*te.jitterB,Ze=Pe+Math.sin(Je*O.freqA+O.seed)*O.ampA+Math.sin(Je*O.freqB+O.seed*1.3)*O.ampB+ye+rt+yt;$e.push({x:Je,y:Ze})}J.beginPath(),J.moveTo($e[0].x,$e[0].y);for(let Se=1;Se<$e.length-1;Se+=1){const st=($e[Se].x+$e[Se+1].x)/2,Qe=($e[Se].y+$e[Se+1].y)/2;J.quadraticCurveTo($e[Se].x,$e[Se].y,st,Qe)}const Ae=$e[$e.length-1];J.quadraticCurveTo(Ae.x,Ae.y,Ae.x,Ae.y),J.stroke()}J.save(),J.globalCompositeOperation="lighter",J.strokeStyle=te.colors.glow,J.lineCap="round",J.lineJoin="round";for(let R=0;R<we.length;R+=1){const O=we[R];if(Math.abs(O.offset)*De>te.crestThickness)continue;const ye=te.glowAlpha*(.7+(1-O.depth)*.6);J.globalAlpha=ye,J.lineWidth=1.6+(1-O.depth)*1.2;const Me=[];for(let Re=0;Re<=Ue;Re+=1){const Fe=Re/Ue*ge+Ee,We=Math.sin(Fe*.02+O.seed)*3,$e=Pe+Math.sin(Fe*O.freqA+O.seed)*O.ampA+Math.sin(Fe*O.freqB+O.seed*1.3)*O.ampB+O.offset*De*.35+We;Me.push({x:Fe,y:$e})}J.beginPath(),J.moveTo(Me[0].x,Me[0].y);for(let Re=1;Re<Me.length-1;Re+=1){const Fe=(Me[Re].x+Me[Re+1].x)/2,We=(Me[Re].y+Me[Re+1].y)/2;J.quadraticCurveTo(Me[Re].x,Me[Re].y,Fe,We)}const je=Me[Me.length-1];J.quadraticCurveTo(je.x,je.y,je.x,je.y),J.stroke()}J.restore()},re=()=>{xe=Math.floor(x.clientWidth),ke=Math.floor(x.clientHeight),Ne=Math.floor(xe*1.8),qe=ke,Te=xe<820?z:Q,V.forEach(J=>{const we=J.getContext("2d");if(!we)return;J.width=Math.floor(Ne*ve*Te),J.height=Math.floor(qe*ve*Te),J.style.width=`${Ne}px`,J.style.height=`${qe}px`,J.style.left=`${-(Ne-xe)/2}px`,we.setTransform(ve*Te,0,0,ve*Te,0,0);const Pe=Number(J.dataset.seed||1),De=F(Pe);Be(we,De)})};return re(),window.addEventListener("resize",re,{passive:!0}),()=>window.removeEventListener("resize",re)},[oe]);const _e=G[Math.min(W,G.length-1)],fe=h?_e:G[G.length-1],C=(fe==null?void 0:fe.theme)??G[0].theme,be={"--cogita-bg0":C.bg0,"--cogita-bg1":C.bg1,"--cogita-bg2":C.bg2,"--cogita-bloom":C.bloom,"--cogita-sat":C.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:y,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Us,{value:T,onChange:c}),e.jsx(Ws,{copy:t,label:n,isAuthenticated:i,secureMode:v,onLogin:s,onProfileNavigate:o,onToggleSecureMode:m,onLogout:f,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:l,className:"cogita-section cogita-home",style:be,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[oe.map((x,V)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:x.style,"data-seed":x.seed,ref:he=>{u.current[V]=he}},x.id)),k.map(x=>e.jsx("div",{className:"cogita-home-wave",style:x.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},x.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Zn,{slides:G,activeIndex:W,introOpen:h,prefersReducedMotion:K,onNext:ie,onPrev:ee,onSelect:se,onExit:E,onOpen:I,onRegister:X})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const or=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:ai},Symbol.toStringTag,{value:"Module"})),an=a.createContext(!1);function St({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:c}){if(a.useContext(an))return e.jsx(e.Fragment,{children:c});const l=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}v("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:l,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Us,{value:A,onChange:T}),e.jsx(Ws,{copy:t,label:s,isAuthenticated:n,secureMode:f,onLogin:()=>v("home"),onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:c}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}function Ot(t){const[s,n]=a.useState("Cogita library"),[i,o]=a.useState(null);return a.useEffect(()=>{let m=!1;return Hs().then(f=>{if(m)return;const v=f.find(A=>A.libraryId===t);v&&n(v.name)}).catch(()=>{m||n("Cogita library")}),()=>{m=!0}},[t]),a.useEffect(()=>{let m=!1;return yn(t).then(f=>{m||o(f)}).catch(()=>{m||o(null)}),()=>{m=!0}},[t]),{libraryName:s,stats:i}}function Cs({slices:t}){const s=t.reduce((i,o)=>i+Math.max(0,o.value),0),n=a.useMemo(()=>{if(s<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let i=0;return`conic-gradient(${t.map(m=>{const v=Math.max(0,m.value)/s*360,A=i,T=i+v;return i=T,`${m.color} ${A}deg ${T}deg`}).join(",")})`},[t,s]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:n}}),e.jsx("div",{className:"cogita-overview-legend",children:t.map(i=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:i.color}}),e.jsx("strong",{children:i.value}),e.jsx("small",{children:i.label})]},i.label))})]})}function si({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c}){const{libraryName:y,stats:l}=Ot(c),[u,k]=a.useState("infos"),[oe,G]=a.useState(0),[W,S]=a.useState(0),[h,ce]=a.useState(0),K=(l==null?void 0:l.totalInfos)??0,b=(l==null?void 0:l.totalCollections)??0,H=0,$=0,X=0,I=Math.max(0,K-X-W),E=Math.max(0,K-W-h);a.useEffect(()=>{let ie=!1;return(async()=>{try{const _e=await ja({libraryId:c,limit:200}),fe=await Promise.all(_e.items.map(C=>Qs({libraryId:c,collectionId:C.collectionId}).catch(()=>[])));if(ie)return;G(fe.reduce((C,be)=>C+be.length,0))}catch{ie||G(0)}})(),()=>{ie=!0}},[c]),a.useEffect(()=>{let ie=!1;return(async()=>{try{const[_e,fe,C]=await Promise.all([ks({libraryId:c,type:"computed",limit:1}).catch(()=>({total:0})),ks({libraryId:c,type:"source",limit:1}).catch(()=>({total:0})),fs({libraryId:c}).catch(()=>({items:[]}))]);if(ie)return;S((_e.total??0)+(fe.total??0));const be=new Set(C.items.filter(x=>x.childItemType.toLowerCase()==="info").map(x=>x.childItemId).filter(Boolean));ce(be.size)}catch{ie||(S(0),ce(0))}})(),()=>{ie=!0}},[c]);const se=[{key:"infos",label:t.cogita.library.overview.stats.totalInfos,value:K},{key:"collections",label:t.cogita.library.overview.stats.collections,value:b},{key:"revisions",label:t.cogita.library.overview.stats.revisions,value:oe},{key:"storyboards",label:t.cogita.library.overview.stats.storyboards,value:H},{key:"texts",label:t.cogita.library.overview.stats.texts,value:$}];return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:y})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:se.map(ie=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${u===ie.key?"active":""}`,onClick:()=>k(ie.key),children:[e.jsx("span",{children:ie.label}),e.jsx("strong",{children:ie.value})]},ie.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:t.cogita.library.overview.statsCardTitle})}),u==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.knownChartTitle}),e.jsx(Cs,{slices:[{label:t.cogita.library.overview.known,value:X,color:"#75d79a"},{label:t.cogita.library.overview.unknown,value:I,color:"#85b9ff"},{label:t.cogita.library.overview.excluded,value:W,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.checksChartTitle}),e.jsx(Cs,{slices:[{label:t.cogita.library.overview.availableChecks,value:h,color:"#75d79a"},{label:t.cogita.library.overview.unavailableChecks,value:E,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:t.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]})]})})]})})}const Ge=(t,s)=>{const n=t.cogita.library.infoTypes,i=t.cogita.library.connectionTypes,o=t.cogita.library.groupTypes;return{any:n.any,vocab:n.vocab,book:o.book,citation:o.citation,language:n.language,word:n.word,sentence:n.sentence,topic:n.topic,collection:n.collection,person:n.person,institution:n.institution,collective:n.collective,orcid:n.orcid,address:n.address,email:n.email,phone:n.phone,media:n.media,work:n.work,geo:n.geo,music_piece:n.musicPiece,music_fragment:n.musicFragment,source:n.source,computed:n.computed,"word-language":i.wordLanguage,"quote-language":i.quoteLanguage,"language-sentence":i.languageSentence,translation:i.translation,"word-topic":i.wordTopic,reference:i.reference,"source-resource":i.sourceResource,"work-contributor":i.workContributor,"work-medium":i.workMedium,"orcid-link":i.orcidLink}[s]??String(s)},ni=t=>[{value:"any",label:Ge(t,"any")},{value:"language",label:Ge(t,"language")},{value:"word",label:Ge(t,"word")},{value:"sentence",label:Ge(t,"sentence")},{value:"topic",label:Ge(t,"topic")},{value:"collection",label:Ge(t,"collection")},{value:"person",label:Ge(t,"person")},{value:"institution",label:Ge(t,"institution")},{value:"collective",label:Ge(t,"collective")},{value:"orcid",label:Ge(t,"orcid")},{value:"address",label:Ge(t,"address")},{value:"email",label:Ge(t,"email")},{value:"phone",label:Ge(t,"phone")},{value:"media",label:Ge(t,"media")},{value:"work",label:Ge(t,"work")},{value:"geo",label:Ge(t,"geo")},{value:"music_piece",label:Ge(t,"music_piece")},{value:"music_fragment",label:Ge(t,"music_fragment")},{value:"source",label:Ge(t,"source")},{value:"citation",label:Ge(t,"citation")},{value:"computed",label:Ge(t,"computed")},{value:"vocab",label:Ge(t,"vocab")},{value:"book",label:Ge(t,"book")},{value:"word-language",label:Ge(t,"word-language")},{value:"quote-language",label:Ge(t,"quote-language")},{value:"language-sentence",label:Ge(t,"language-sentence")},{value:"translation",label:Ge(t,"translation")},{value:"word-topic",label:Ge(t,"word-topic")},{value:"reference",label:Ge(t,"reference")},{value:"source-resource",label:Ge(t,"source-resource")},{value:"work-contributor",label:Ge(t,"work-contributor")},{value:"work-medium",label:Ge(t,"work-medium")},{value:"orcid-link",label:Ge(t,"orcid-link")}],ii=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}],Za={key:"languageId",labelKey:"language",kind:"select",path:"languageId",optionsSource:"languages",matcher:"equals"},ri={language:{infoType:"language",entityKind:"single",structure:{payloadFields:["label","name","code","notes"]},filterFields:[]},word:{infoType:"word",entityKind:"single",structure:{payloadFields:["label","lemma","notes","languageId"],connections:[{relationType:"word-language",role:"language",targetType:"language"}]},filterFields:[Za]},sentence:{infoType:"sentence",entityKind:"single",structure:{payloadFields:["label","text","notes","languageId"],connections:[{relationType:"language-sentence",role:"language",targetType:"language"}]},filterFields:[Za]},topic:{infoType:"topic",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},collection:{infoType:"collection",entityKind:"complex",structure:{payloadFields:["label","name","notes"]},filterFields:[]},person:{infoType:"person",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},institution:{infoType:"institution",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},collective:{infoType:"collective",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},orcid:{infoType:"orcid",entityKind:"single",structure:{payloadFields:["label","orcid","notes"]},filterFields:[{key:"orcid",label:"ORCID",kind:"text",path:"orcid",matcher:"contains"}]},address:{infoType:"address",entityKind:"single",structure:{payloadFields:["label","street","city","postalCode","country","notes"]},filterFields:[]},email:{infoType:"email",entityKind:"single",structure:{payloadFields:["label","email","address","notes"]},filterFields:[]},phone:{infoType:"phone",entityKind:"single",structure:{payloadFields:["label","phone","number","notes"]},filterFields:[]},media:{infoType:"media",entityKind:"single",structure:{payloadFields:["label","name","url","kind","notes"]},filterFields:[]},work:{infoType:"work",entityKind:"single",structure:{payloadFields:["label","title","subtitle","doi","isbn","issn","languageId","originalLanguageId","notes"]},filterFields:[Za,{key:"originalLanguageId",labelKey:"originalLanguage",kind:"select",path:"originalLanguageId",optionsSource:"languages",matcher:"equals"},{key:"doi",labelKey:"doi",kind:"text",path:"doi",matcher:"contains"}]},geo:{infoType:"geo",entityKind:"single",structure:{payloadFields:["label","name","country","region","city","notes"]},filterFields:[]},music_piece:{infoType:"music_piece",entityKind:"single",structure:{payloadFields:["label","title","composer","notes"]},filterFields:[]},music_fragment:{infoType:"music_fragment",entityKind:"single",structure:{payloadFields:["label","title","text","notes"]},filterFields:[]},source:{infoType:"source",entityKind:"single",structure:{payloadFields:["label","title","sourceKind","locator","notes"],connections:[{relationType:"source-resource",role:"resource",targetType:"work"}]},filterFields:[{key:"sourceKind",labelKey:"sourceKind",kind:"select",path:"sourceKind",optionsSource:"sourceKinds",matcher:"equals"},{key:"locator",labelKey:"locator",kind:"text",path:"locator",matcher:"locator_contains"}]},citation:{infoType:"citation",entityKind:"single",structure:{payloadFields:["title","text","notes"],connections:[{relationType:"quote-language",role:"language",targetType:"language"},{relationType:"reference",role:"source",targetType:"source"}]},filterFields:[{key:"text",labelKey:"quote",kind:"text",path:"text",matcher:"contains"}]},computed:{infoType:"computed",entityKind:"complex",structure:{payloadFields:["label","title","definition","notes"]},filterFields:[]},translation:{infoType:"translation",entityKind:"connection",structure:{payloadFields:["note","tagIds"],connections:[{relationType:"translation",role:"wordA",targetType:"word"},{relationType:"translation",role:"wordB",targetType:"word"},{relationType:"word-language",role:"languageA",targetType:"language"},{relationType:"word-language",role:"languageB",targetType:"language"}]},filterFields:[{key:"languageAId",labelKey:"languageA",kind:"select",optionsSource:"languages",matcher:"equals"},{key:"languageBId",labelKey:"languageB",kind:"select",optionsSource:"languages",matcher:"equals"}]}},Ms={infoType:"default",entityKind:"single",structure:{payloadFields:["label","notes"]},filterFields:[]};function oi(t){return t?ri[t]??Ms:Ms}function ci(t,s){return t.optionsSource==="languages"?s.languages.map(n=>({value:n.infoId,label:n.label})):t.optionsSource==="sourceKinds"?ii:[]}const es=60,li=500;function sn(t){return`cogita.info-selection:${t}`}function Is(t){if(typeof window>"u")return{};const s=window.localStorage.getItem(sn(t));if(!s)return{};try{const n=JSON.parse(s);return!n||typeof n!="object"?{}:n}catch{return{}}}function di({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c,mode:y}){var g;const l=_s(),u=Va(),k=t.cogita.library.list,[oe,G]=a.useState("any"),[W,S]=a.useState(""),[h,ce]=a.useState("relevance"),[K,b]=a.useState("details"),[H,$]=a.useState(!1),[X,I]=a.useState("idle"),[E,se]=a.useState([]),[ie,ee]=a.useState(es),[_e,fe]=a.useState(null),[C,be]=a.useState(()=>Is(c)),[x,V]=a.useState({}),[he,Q]=a.useState([]),[z,ve]=a.useState(null),[xe,ke]=a.useState(null),[Te,Ne]=a.useState(null),[qe,Ke]=a.useState("idle"),[te,Ce]=a.useState([]),[Ve,ze]=a.useState(""),[F,U]=a.useState(null),[Be,re]=a.useState("idle"),[J,we]=a.useState(null),[Pe,De]=a.useState(null),[Ue,Y]=a.useState("idle"),ge=a.useMemo(()=>ni(t),[t]),Ee=a.useMemo(()=>[{value:"relevance",label:k.sortRelevance},{value:"label_asc",label:k.sortLabelAsc},{value:"label_desc",label:k.sortLabelDesc},{value:"type_asc",label:k.sortTypeAsc},{value:"type_desc",label:k.sortTypeDesc}],[k.sortLabelAsc,k.sortLabelDesc,k.sortRelevance,k.sortTypeAsc,k.sortTypeDesc]);a.useEffect(()=>{be(Is(c)),V({}),$(!1)},[c]),a.useEffect(()=>{fs({libraryId:c}).then(p=>Ne(p)).catch(()=>Ne({items:[]}))},[c]),a.useEffect(()=>{xn({libraryId:c}).then(p=>Ce(p)).catch(()=>Ce([]))},[c]),a.useEffect(()=>{Ns({libraryId:c,type:"language",filters:{sourceKind:"info"},limit:200}).then(p=>{const P=p.map(ae=>({infoId:ae.infoId??"",infoType:ae.entityType,label:ae.title})).filter(ae=>ae.infoId.length>0);Q(P)}).catch(()=>Q([]))},[c]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(sn(c),JSON.stringify(C))},[c,C]);const R=a.useMemo(()=>oi(oe==="any"?null:oe),[oe]),O=a.useMemo(()=>new URLSearchParams(u.search),[u.search]),ye=a.useMemo(()=>u.pathname.split("/").filter(Boolean),[u.pathname]),Me=ye.findIndex(p=>p==="infos"),je=Me>=0&&(ye[Me+1]??"").trim()||null,Re=Me>=0?(ye[Me+2]??"").trim()==="checkcards"?"cards":"overview":"",Fe=je??((O.get("infoId")??"").trim()||null),We=je?Re:(O.get("infoView")??"overview").trim(),$e=We==="overview"&&!!Fe,Ae=a.useMemo(()=>({language:k.typeFilterLanguage,languageA:k.typeFilterLanguageA,languageB:k.typeFilterLanguageB,originalLanguage:k.typeFilterOriginalLanguage,doi:k.typeFilterDoi,sourceKind:k.typeFilterSourceKind,locator:k.typeFilterLocator,quote:k.typeFilterQuote}),[k.typeFilterDoi,k.typeFilterLanguage,k.typeFilterLanguageA,k.typeFilterLanguageB,k.typeFilterLocator,k.typeFilterOriginalLanguage,k.typeFilterQuote,k.typeFilterSourceKind]),Se=a.useMemo(()=>R.filterFields.map(p=>({...p,label:p.labelKey?Ae[p.labelKey]:p.label??p.key,options:ci(p,{languages:he})})),[Ae,he,R.filterFields]),st=a.useMemo(()=>Se.some(p=>(x[p.key]??"").trim().length>0),[Se,x]);a.useEffect(()=>{V({})},[oe]),a.useEffect(()=>{const p={sourceKind:"info"};if(st)for(const ae of Se){const Oe=(x[ae.key]??"").trim();Oe&&(p[ae.path??ae.key]=Oe)}I("loading");const P=window.setTimeout(()=>{Ns({libraryId:c,type:oe==="any"?void 0:oe,query:W.trim()||void 0,filters:p,limit:li}).then(ae=>{const Oe=ae.map(Xe=>({infoId:Xe.infoId??"",infoType:Xe.entityType,label:Xe.title})).filter(Xe=>Xe.infoId.length>0);se(Oe),I("ready")}).catch(()=>{se([]),I("ready")})},240);return()=>window.clearTimeout(P)},[st,c,W,oe,Se,x]),a.useEffect(()=>{if(!Fe||We!=="overview"){ve(null),ke(null),Ke("idle");return}let p=!1;return Ke("loading"),Promise.all([Yt({libraryId:c,infoId:Fe}),vn({libraryId:c,itemType:"info",itemId:Fe}).catch(()=>null)]).then(([P,ae])=>{p||(ve(P),ke(ae),Ke("ready"))}).catch(()=>{p||(ve(null),ke(null),Ke("error"))}),()=>{p=!0}},[c,Fe,We]),a.useEffect(()=>{if(!Fe||We!=="overview"){we(null),De(null),Y("idle");return}let p=!1;return Y("loading"),Promise.all([Ys({libraryId:c,infoId:Fe}),Gs({libraryId:c,infoId:Fe})]).then(([P,ae])=>{p||(we(P),De(ae),Y("ready"))}).catch(()=>{p||(we(null),De(null),Y("error"))}),()=>{p=!0}},[c,Fe,We]);const Qe=a.useMemo(()=>z?te.filter(p=>p.sourceInfoTypes.some(P=>P.toLowerCase()===z.infoType.toLowerCase())):[],[te,z]);a.useEffect(()=>{if(!z){ze("");return}ze(p=>{var P;return p&&Qe.some(ae=>ae.approachKey===p)?p:((P=Qe[0])==null?void 0:P.approachKey)??""})},[Qe,z]),a.useEffect(()=>{if(!z||!Ve){U(null),re("idle");return}let p=!1;return re("loading"),Xs({libraryId:c,infoId:z.infoId,approachKey:Ve}).then(P=>{p||(U(P),re("ready"))}).catch(()=>{p||(U(null),re("error"))}),()=>{p=!0}},[c,Ve,z]);const Je=a.useMemo(()=>{const p=E.slice(),P=ae=>Ge(t,ae);return h==="relevance"?p:h==="label_asc"?p.sort((ae,Oe)=>ae.label.localeCompare(Oe.label)):h==="label_desc"?p.sort((ae,Oe)=>Oe.label.localeCompare(ae.label)):h==="type_asc"?p.sort((ae,Oe)=>ae.infoType===Oe.infoType?ae.label.localeCompare(Oe.label):P(ae.infoType).localeCompare(P(Oe.infoType))):p.sort((ae,Oe)=>ae.infoType===Oe.infoType?ae.label.localeCompare(Oe.label):P(Oe.infoType).localeCompare(P(ae.infoType)))},[t,E,h]),rt=a.useMemo(()=>Je.slice(0,ie),[Je,ie]),yt=rt.length<Je.length,Ze=a.useMemo(()=>new Set(Object.keys(C)),[C]),tt=a.useMemo(()=>Object.values(C),[C]),lt=a.useMemo(()=>{const p=new Map;for(const P of tt)p.set(P.infoType,(p.get(P.infoType)??0)+1);return Array.from(p.entries()).sort((P,ae)=>ae[1]-P[1]||P[0].localeCompare(ae[0]))},[tt]),dt=a.useMemo(()=>{if(!Fe||!Te)return 0;const p=new Set;for(const P of Te.items)P.childItemType!=="info"||P.childItemId!==Fe||p.add([P.parentItemType,P.parentItemId,P.parentCheckType??"",P.parentDirection??""].join("|"));return p.size},[Te,Fe]);a.useEffect(()=>{ee(es);const p=new Set(E.map(P=>P.infoId));fe(P=>P&&p.has(P)?P:null)},[E]);const It=p=>{be(P=>({...P,[p.infoId]:{infoId:p.infoId,infoType:p.infoType,label:p.label}}))},nt=p=>{be(P=>{if(!P[p])return P;const ae={...P};return delete ae[p],ae})},ot=(p,P)=>{if(P){It(p);return}nt(p.infoId)},Lt=p=>{l(`/cogita/library/${c}/infos/${encodeURIComponent(p)}`,{replace:!0})},ft=()=>{l(`/cogita/library/${c}/list`,{replace:!0})},at=()=>{Fe&&l(`/cogita/library/${c}/edit/${encodeURIComponent(Fe)}`,{replace:!0})},it=tt.length===1?((g=tt[0])==null?void 0:g.infoId)??null:null,xt=k.selectionCount.replace("{count}",String(tt.length)),Tt=y==="collection"?"grid":y==="detail"?"wide":K,et=gi(A),ht=xe?Math.max(0,Math.min(100,Math.round((xe.score??0)*100))):0,bt=xe?mi(xe,et):et.noKnownnessData;return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":Tt,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[$e?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:et.kicker}),e.jsx("h2",{className:"cogita-card-title",children:z?ui(z.payload,z.infoType,z.infoId):et.loading}),z?e.jsxs("p",{className:"cogita-card-subtitle",children:[Ge(t,z.infoType)," · ",z.infoId]}):null]}),e.jsxs("div",{className:"cogita-info-overview-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:ft,children:et.backToSearch}),e.jsx("button",{type:"button",className:"cta",onClick:at,disabled:!Fe||qe!=="ready",children:k.editInfo})]})]}),qe==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:et.loading})}):qe==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:et.loadError})}):z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-info-overview-metrics",children:[e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:et.knownness}),e.jsxs("div",{className:"cogita-info-metric-value",children:[ht,"%"]}),e.jsx("div",{className:"cogita-info-progress","aria-hidden":"true",children:e.jsx("span",{style:{width:`${ht}%`}})}),e.jsx("p",{className:"cogita-library-hint",children:bt})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:et.reviews}),e.jsx("div",{className:"cogita-info-metric-value",children:(xe==null?void 0:xe.totalReviews)??0}),e.jsx("p",{className:"cogita-library-hint",children:et.correct.replace("{correct}",String((xe==null?void 0:xe.correctReviews)??0)).replace("{total}",String((xe==null?void 0:xe.totalReviews)??0))}),e.jsx("p",{className:"cogita-library-hint",children:xe!=null&&xe.lastReviewedUtc?`${et.lastReview}: ${hi(xe.lastReviewedUtc,A)}`:et.noLastReview})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:et.linkedCards}),e.jsx("div",{className:"cogita-info-metric-value",children:dt}),e.jsx("p",{className:"cogita-library-hint",children:et.linkedCardsHint})]})]}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:et.checkcards}),Ue==="loading"?e.jsx("p",{className:"cogita-library-hint",children:et.loadingCheckcards}):Ue==="error"?e.jsx("p",{className:"cogita-library-hint",children:et.loadCheckcardsError}):e.jsxs("div",{className:"cogita-info-tree",children:[e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:et.checkcardCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(J==null?void 0:J.items.length)??0})]}),e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:et.dependencyCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(Pe==null?void 0:Pe.items.length)??0})]})]})]}),Qe.length>0?e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsxs("div",{className:"cogita-info-approach-header",children:[e.jsx("h3",{children:et.approach}),e.jsx("select",{value:Ve,onChange:p=>ze(p.target.value),"aria-label":et.approach,children:Qe.map(p=>e.jsx("option",{value:p.approachKey,children:p.label},p.approachKey))})]}),Be==="loading"?e.jsx("p",{className:"cogita-library-hint",children:et.loadingApproach}):Be==="error"?e.jsx("p",{className:"cogita-library-hint",children:et.loadApproachError}):F?e.jsx(Ea,{value:F.projection,emptyLabel:et.empty}):e.jsx("p",{className:"cogita-library-hint",children:et.noApproachData})]}):null,e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:et.payload}),e.jsx(Ea,{value:z.payload,emptyLabel:et.empty})]}),e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:et.links}),e.jsx(pi,{links:z.links,emptyLabel:et.noLinks})]})]})]}):null]})}):null,$e?null:e.jsxs("section",{className:"cogita-library-search-surface",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":k.typeLabel,value:oe,onChange:p=>G(p.target.value),children:ge.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),e.jsx("input",{type:"text",value:W,onChange:p=>S(p.target.value),placeholder:k.searchPlaceholder}),e.jsx("select",{"aria-label":k.sortLabel,value:h,onChange:p=>ce(p.target.value),children:Ee.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),e.jsxs("select",{"aria-label":k.viewLabel,value:K,onChange:p=>b(p.target.value),children:[e.jsx("option",{value:"details",children:k.viewDetails}),e.jsx("option",{value:"wide",children:k.viewWide}),e.jsx("option",{value:"grid",children:k.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:k.cardCount.replace("{shown}",String(rt.length)).replace("{total}",String(Je.length))}),e.jsx("span",{children:X==="loading"?k.loading:k.ready})]}),e.jsxs("div",{className:"cogita-filters-toggle-row",children:[e.jsx("button",{type:"button",className:"ghost cogita-filters-toggle",onClick:()=>$(p=>!p),children:H?k.hideFilters:k.showFilters}),e.jsx("span",{className:"cogita-sidebar-note",children:k.filtersOptionalHint})]}),H&&Se.length>0?e.jsx("section",{className:"cogita-library-filters cogita-library-filters--compact",children:e.jsx("div",{className:"cogita-filter-grid",children:Se.map(p=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:p.label}),p.kind==="select"?e.jsxs("select",{value:x[p.key]??"",onChange:P=>V(ae=>({...ae,[p.key]:P.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),(p.options??[]).map(P=>e.jsx("option",{value:P.value,children:P.label},`${p.key}:${P.value}`))]}):e.jsx("input",{type:"text",value:x[p.key]??"",onChange:P=>V(ae=>({...ae,[p.key]:P.target.value}))})]},`type-filter:${p.key}`))})}):null,e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:xt}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{be(p=>{const P={...p};for(const ae of rt)P[ae.infoId]={infoId:ae.infoId,infoType:ae.infoType,label:ae.label};return P})},disabled:rt.length===0,children:k.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>be({}),disabled:tt.length===0,children:k.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>it&&Lt(it),disabled:!it,title:it?void 0:k.openSelectedDisabled,children:k.openSelected})]})]}),tt.length>0?e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:k.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:k.selectedStackHint}),e.jsx("div",{className:"cogita-selection-overview",children:lt.map(([p,P])=>e.jsxs("span",{className:"cogita-tag-chip",children:[e.jsx("span",{children:Ge(t,p)}),e.jsx("span",{className:"cogita-tag-count",children:P})]},`stack:type:${p}`))})]}):null,Tt==="details"?e.jsxs("div",{className:"cogita-details-grid",role:"table","aria-label":k.searchTitle,children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:k.detailColumnName}),e.jsx("span",{children:k.detailColumnType}),e.jsx("span",{children:k.detailColumnId}),e.jsx("span",{})]}),rt.length?rt.map(p=>{const P=Ge(t,p.infoType),ae=Ze.has(p.infoId),Oe=_e===p.infoId;return e.jsxs("div",{className:`cogita-details-row ${Oe||ae?"active":""}`,role:"row",onClick:()=>fe(p.infoId),children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:Xe=>ot(p,Xe.target.checked),onClick:Xe=>Xe.stopPropagation()}),e.jsx("span",{})]}),e.jsx("span",{title:p.label,children:p.label}),e.jsx("span",{title:P,children:P}),e.jsx("span",{title:p.infoId,children:p.infoId}),e.jsx("button",{type:"button",className:"ghost cogita-details-open",onClick:Xe=>{Xe.stopPropagation(),Lt(p.infoId)},"aria-label":k.editInfo,children:">"})]},p.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:k.noMatch})})]}):e.jsx("div",{className:`cogita-card-list cogita-card-list--${Tt}`,"data-view":Tt,children:rt.length?rt.map(p=>{const P=Ge(t,p.infoType),ae=Ze.has(p.infoId),Oe=_e===p.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":Oe||ae,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:Xe=>ot(p,Xe.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>fe(p.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:P}),e.jsx("h3",{className:"cogita-card-title",children:p.label}),e.jsx("p",{className:"cogita-card-subtitle",children:p.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Lt(p.infoId),children:k.editInfo})]})},p.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:k.noMatch})})}),yt?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>ee(p=>p+es),children:k.loadMore})}):null]})]})})})})}function ui(t,s,n){if(t&&typeof t=="object"&&!Array.isArray(t)){const i=t,o=["title","name","label","value","text","quote","term"];for(const m of o){const f=i[m];if(typeof f=="string"&&f.trim())return f.trim()}}return`${s} · ${n}`}function hi(t,s){try{const n=s==="pl"?"pl-PL":s==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}catch{return t}}function gi(t){return t==="pl"?{kicker:"Informacja",backToSearch:"Wróć do wyszukiwania",loading:"Ładowanie informacji...",loadError:"Nie udało się wczytać informacji.",knownness:"Znajomość",reviews:"Sprawdzenia",correct:"Poprawne: {correct} / {total}",lastReview:"Ostatnie sprawdzenie",noLastReview:"Brak sprawdzeń",linkedCards:"Powiązane karty",linkedCardsHint:"Karty sprawdzające zależne od tej informacji",payload:"Treść informacji",links:"Powiązania",empty:"Brak danych",noLinks:"Brak powiązań",checkcards:"Karty sprawdzające",loadingCheckcards:"Ładowanie kart sprawdzających...",loadCheckcardsError:"Nie udało się wczytać kart sprawdzających.",noCheckcards:"Brak kart sprawdzających.",checkcardCount:"Liczba kart",dependencyCount:"Zależności (efektywne)",approach:"Podejście",loadingApproach:"Ładowanie widoku...",loadApproachError:"Nie udało się wczytać widoku.",noApproachData:"Brak danych widoku.",noKnownnessData:"Brak danych o znajomości",developmentStart:"Początek nauki",developmentGrowing:"Rozwój w toku",developmentStable:"Utrwalona wiedza",developmentStrong:"Bardzo dobra znajomość"}:t==="de"?{kicker:"Information",backToSearch:"Zur Suche",loading:"Information wird geladen...",loadError:"Information konnte nicht geladen werden.",knownness:"Kenntnisstand",reviews:"Abfragen",correct:"Richtig: {correct} / {total}",lastReview:"Letzte Abfrage",noLastReview:"Noch keine Abfragen",linkedCards:"Verknüpfte Karten",linkedCardsHint:"Prüfkarten, die von dieser Information abhängen",payload:"Inhalt",links:"Verknüpfungen",empty:"Keine Daten",noLinks:"Keine Verknüpfungen",checkcards:"Prüfkarten",loadingCheckcards:"Prüfkarten werden geladen...",loadCheckcardsError:"Prüfkarten konnten nicht geladen werden.",noCheckcards:"Keine Prüfkarten.",checkcardCount:"Anzahl Karten",dependencyCount:"Abhängigkeiten (effektiv)",approach:"Ansicht",loadingApproach:"Ansicht wird geladen...",loadApproachError:"Ansicht konnte nicht geladen werden.",noApproachData:"Keine Ansichtsdaten.",noKnownnessData:"Keine Kenntnisdaten",developmentStart:"Lernbeginn",developmentGrowing:"Aufbauphase",developmentStable:"Stabil",developmentStrong:"Sehr sicher"}:{kicker:"Info",backToSearch:"Back to search",loading:"Loading info...",loadError:"Failed to load info.",knownness:"Knownness",reviews:"Reviews",correct:"Correct: {correct} / {total}",lastReview:"Last review",noLastReview:"No reviews yet",linkedCards:"Linked checking cards",linkedCardsHint:"Checking cards depending on this info",payload:"Information",links:"Links",empty:"No data",noLinks:"No links",checkcards:"Checkcards",loadingCheckcards:"Loading checkcards...",loadCheckcardsError:"Failed to load checkcards.",noCheckcards:"No checkcards.",checkcardCount:"Checkcard count",dependencyCount:"Dependencies (effective)",approach:"Approach",loadingApproach:"Loading view...",loadApproachError:"Failed to load view.",noApproachData:"No view data.",noKnownnessData:"No knownness data",developmentStart:"Just started",developmentGrowing:"In progress",developmentStable:"Stable",developmentStrong:"Strong"}}function mi(t,s){return t.totalReviews<=0?s.noKnownnessData:t.totalReviews<3||t.score<.35?s.developmentStart:t.totalReviews<8||t.score<.65?s.developmentGrowing:t.score<.85?s.developmentStable:s.developmentStrong}function pi({links:t,emptyLabel:s}){return!t||Object.keys(t).length===0?e.jsx("p",{className:"cogita-library-hint",children:s}):e.jsx("div",{className:"cogita-info-tree",children:Object.entries(t).map(([n,i])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:n}),e.jsx("div",{className:"cogita-info-tree-value",children:Array.isArray(i)?i.length?e.jsx("div",{className:"cogita-selection-overview",children:i.map(o=>e.jsx("span",{className:"cogita-tag-chip",children:o},`${n}:${o}`))}):e.jsx("span",{className:"cogita-library-hint",children:"[]"}):i?e.jsx("span",{className:"cogita-tag-chip",children:i}):e.jsx("span",{className:"cogita-library-hint",children:"null"})})]},n))})}function Ea({value:t,emptyLabel:s}){if(t==null)return e.jsx("p",{className:"cogita-library-hint",children:s});if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)});if(Array.isArray(t))return t.length===0?e.jsx("p",{className:"cogita-library-hint",children:"[]"}):e.jsx("div",{className:"cogita-info-tree",children:t.map((n,i)=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:i+1}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(Ea,{value:n,emptyLabel:s})})]},i))});if(typeof t=="object"){const n=Object.entries(t);return n.length===0?e.jsx("p",{className:"cogita-library-hint",children:s}):e.jsx("div",{className:"cogita-info-tree",children:n.map(([i,o])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:i}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(Ea,{value:o,emptyLabel:s})})]},i))})}return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)})}const aa=5,Ls=50,$s=2,Rs=[];function na({libraryId:t,infoType:s,label:n,placeholder:i,value:o,onChange:m,values:f,onChangeMultiple:v,helperText:A,searchFailedText:T,createFailedText:c,createLabel:y,savingLabel:l,loadMoreLabel:u,inputRef:k,autoAdvance:oe,onCommit:G,multiple:W}){const S=W?f??Rs:Rs,[h,ce]=a.useState(W?"":(o==null?void 0:o.label)??""),[K,b]=a.useState([]),[H,$]=a.useState(aa),[X,I]=a.useState(-1),[E,se]=a.useState(!1),[ie,ee]=a.useState(!1),[_e,fe]=a.useState(null),C=a.useRef(0),be=a.useRef(new Map),x=a.useMemo(()=>W?h.trim().length>0:h.trim().length>0&&!o,[h,o,W]);a.useEffect(()=>{W||ce((o==null?void 0:o.label)??"")},[o,W]),a.useEffect(()=>{const Q=h.trim();if(!Q||Q.length<$s){b([]),se(!1),$(aa),I(-1),ee(!1),fe(null);return}const z=Q.toLowerCase(),ve=`${t}:${s}:${z}`,xe=be.current.get(ve);if(xe){if(W&&S.length>0){const Te=new Set(S.map(Ne=>Ne.id));b(xe.filter(Ne=>!Te.has(Ne.id)))}else b(xe);$(aa),I(-1),se(xe.length>0),ee(!1),fe(null);return}const ke=window.setTimeout(async()=>{const Te=Date.now();C.current=Te,ee(!0),fe(null);try{const Ne=await bs({libraryId:t,type:s,query:Q,limit:Ls});if(C.current!==Te)return;const qe=Ne.slice(0,Ls).map(Ke=>({id:Ke.infoId,label:Ke.label,infoType:Ke.infoType}));if(be.current.set(ve,qe),W&&S.length>0){const Ke=new Set(S.map(te=>te.id));b(qe.filter(te=>!Ke.has(te.id)))}else b(qe);$(aa),I(-1),se(!0)}catch{if(C.current!==Te)return;fe(T??"Search failed.")}finally{C.current===Te&&ee(!1)}},250);return()=>window.clearTimeout(ke)},[t,s,h,S]);const V=Q=>{if(W){const z=S.some(ve=>ve.id===Q.id)?S:[...S,Q];v==null||v(z),ce(""),se(!1),I(-1);return}m==null||m(Q),ce(Q.label),se(!1),I(-1),oe&&(G==null||G())},he=async()=>{const Q=h.trim();if(Q){ee(!0),fe(null);try{const z=await Js({libraryId:t,infoType:s,payload:{label:Q}}),ve={id:z.infoId,label:Q,infoType:z.infoType};if(Q.length>=$s){const xe=`${t}:${s}:${Q.toLowerCase()}`,ke=be.current.get(xe)??[];be.current.set(xe,[ve,...ke])}if(W){v==null||v([...S,ve]),ce(""),se(!1),I(-1);return}m==null||m(ve),se(!1),I(-1),oe&&(G==null||G())}catch{fe(c??"Create failed.")}finally{ee(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:n}),e.jsx("input",{value:h,placeholder:i,onChange:Q=>{ce(Q.target.value),!W&&o&&(m==null||m(null))},onKeyDown:Q=>{if(Q.key==="ArrowDown"){if(Q.preventDefault(),!K.length)return;se(!0),I(z=>{const ve=Math.min(K.length,H)-1,xe=z<0?0:Math.min(z+1,ve);return xe===ve&&K.length>H?($(ke=>Math.min(ke+aa,K.length)),Math.min(z+1,Math.min(K.length,H+aa)-1)):xe});return}if(Q.key==="ArrowUp"){if(Q.preventDefault(),!K.length)return;se(!0),I(z=>z<=0?0:z-1);return}if(Q.key==="Enter"){if(Q.preventDefault(),X>=0&&K[X]){V(K[X]);return}if(x){he();return}}},onFocus:()=>{K.length>0&&se(!0)},autoComplete:"off",ref:k})]}),W&&S.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:S.map(Q=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>v==null?void 0:v(S.filter(z=>z.id!==Q.id)),children:[Q.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},Q.id))}),A&&e.jsx("p",{className:"cogita-help",children:A}),_e&&e.jsx("p",{className:"cogita-error",children:_e}),E&&K.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[K.slice(0,H).map((Q,z)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":z===X,onClick:()=>V(Q),children:[e.jsx("strong",{children:Q.label}),e.jsx("span",{children:Q.infoType})]},Q.id)),H<K.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>$(Q=>Math.min(Q+aa,K.length)),children:u??"Load more"})]}),x&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:he,disabled:ie,children:ie?l??"Saving...":y??`Create new ${s}`})]})}function fi(t){return t==null?"":typeof t=="string"?t:JSON.stringify(t)}function Es(t,s){if(!t||typeof t!="object")return s;const n=t,i=[n.label,n.name,n.title,n.text,n.orcid,n.email,n.number];for(const o of i)if(typeof o=="string"&&o.trim())return o.trim();return s}function bi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c,editInfoId:y}){const{libraryName:l}=Ot(c),u=!!y,[k,oe]=a.useState([]),[G,W]=a.useState("word"),[S,h]=a.useState({}),[ce,K]=a.useState({}),[b,H]=a.useState({}),[$,X]=a.useState({}),[I,E]=a.useState(null),[se,ie]=a.useState("idle"),ee=a.useMemo(()=>k.find(x=>x.infoType===G),[G,k]),_e=a.useMemo(()=>k.map(x=>({value:x.infoType,label:Ge(t,x.infoType)})),[t,k]);a.useEffect(()=>{let x=!1;return wn({libraryId:c}).then(V=>{var he;if(!x&&(oe(V),!u)){const Q=(he=V[0])==null?void 0:he.infoType;Q&&W(Q)}}).catch(()=>{x||oe([])}),()=>{x=!0}},[u,c]),a.useEffect(()=>{if(!ee)return;const x={},V={},he={},Q={};for(const z of ee.payloadFields)x[z.key]="";for(const z of ee.linkFields)z.multiple?he[z.key]=[]:V[z.key]=null,z.targetTypes.length>0&&(Q[z.key]=z.targetTypes[0]);h(x),K(V),H(he),X(Q)},[ee==null?void 0:ee.infoType]),a.useEffect(()=>{if(!u||!y||k.length===0)return;let x=!1;return ie("loading"),E(null),(async()=>{const he=await Yt({libraryId:c,infoId:y});if(x)return;const Q=he.infoType;W(Q);const z=k.find(te=>te.infoType===Q);if(!z){ie("idle");return}const ve=he.payload??{},xe={};for(const te of z.payloadFields)xe[te.key]=fi(ve[te.key]);h(xe);const ke=he.links??{}??{},Te={},Ne={},qe={},Ke=[];for(const te of z.linkFields){te.targetTypes.length>0&&(qe[te.key]=te.targetTypes[0]);const Ce=ke[te.key];if(te.multiple){const Ve=Array.isArray(Ce)?Ce.filter(ze=>typeof ze=="string"):[];Ne[te.key]=[];for(const ze of Ve)Ke.push(Yt({libraryId:c,infoId:ze}).then(F=>{if(x)return;const U={id:ze,infoType:F.infoType,label:Es(F.payload,ze)};Ne[te.key]=[...Ne[te.key],U]}).catch(()=>{}))}else{const Ve=typeof Ce=="string"?Ce:null;Te[te.key]=null,Ve&&Ke.push(Yt({libraryId:c,infoId:Ve}).then(ze=>{x||(Te[te.key]={id:Ve,infoType:ze.infoType,label:Es(ze.payload,Ve)})}).catch(()=>{}))}}await Promise.all(Ke),!x&&(K(Te),H(Ne),X(te=>({...te,...qe})),ie("idle"))})().catch(()=>{x||(E("Failed to load info details."),ie("idle"))}),()=>{x=!0}},[y,u,c,k]);const fe=async()=>{var Q;if(!ee)return;const x={};for(const z of ee.payloadFields){const ve=(S[z.key]??"").trim();if(!ve){if(z.required){E(`Field '${z.label}' is required.`);return}continue}if(z.inputType==="json")try{x[z.key]=JSON.parse(ve)}catch{E(`Field '${z.label}' must be valid JSON.`);return}else x[z.key]=ve}const V={};for(const z of ee.linkFields)if(z.multiple){const ve=(b[z.key]??[]).map(xe=>xe.id);if(z.required&&ve.length===0){E(`Link '${z.label}' is required.`);return}ve.length>0&&(V[z.key]=ve)}else{const ve=((Q=ce[z.key])==null?void 0:Q.id)??null;if(z.required&&!ve){E(`Link '${z.label}' is required.`);return}ve&&(V[z.key]=ve)}const he=Object.keys(V).length>0;ie("saving"),E(null);try{if(u&&y)await jn({libraryId:c,infoId:y,payload:x,links:he?V:void 0}),E("Info updated.");else{await Js({libraryId:c,infoType:G,payload:x,links:he?V:void 0}),E("Info saved.");const z={};for(const ke of ee.payloadFields)z[ke.key]="";h(z);const ve={},xe={};for(const ke of ee.linkFields)ke.multiple?xe[ke.key]=[]:ve[ke.key]=null;K(ke=>({...ke,...ve})),H(ke=>({...ke,...xe}))}}catch{E("Failed to save info.")}finally{ie("idle")}},C=x=>{const V=S[x.key]??"",he=x.inputType==="textarea"||x.inputType==="json";return e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.label}),he?e.jsx("textarea",{rows:x.inputType==="json"?8:4,value:V,onChange:Q=>h(z=>({...z,[x.key]:Q.target.value})),placeholder:x.key}):e.jsx("input",{type:"text",value:V,onChange:Q=>h(z=>({...z,[x.key]:Q.target.value})),placeholder:x.key})]},`payload:${x.key}`)},be=x=>{const V=$[x.key]??x.targetTypes[0];return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:x.label}),x.targetTypes.length>1?e.jsx("select",{value:V,onChange:he=>X(Q=>({...Q,[x.key]:he.target.value})),children:x.targetTypes.map(he=>e.jsx("option",{value:he,children:Ge(t,he)},`${x.key}:${he}`))}):null,x.multiple?e.jsx(na,{libraryId:c,infoType:V,label:x.label,placeholder:x.key,multiple:!0,values:b[x.key]??[],onChangeMultiple:he=>H(Q=>({...Q,[x.key]:he})),searchFailedText:"Search failed",createFailedText:"Create failed"}):e.jsx(na,{libraryId:c,infoType:V,label:x.label,placeholder:x.key,value:ce[x.key]??null,onChange:he=>K(Q=>({...Q,[x.key]:he})),searchFailedText:"Search failed",createFailedText:"Create failed"})]},`link:${x.key}`)};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:u?"Edit info":"Create info"}),e.jsx("h1",{className:"cogita-library-title",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:"Specification-driven editor"})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:`/#/cogita/library/${c}/list`,children:"Back to list"})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-panel",children:[u?null:e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Info type"}),e.jsx("select",{value:G,onChange:x=>W(x.target.value),children:_e.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]}),se==="loading"?e.jsx("p",{children:"Loading..."}):null,ee?e.jsxs("div",{className:"cogita-form-grid",children:[ee.payloadFields.map(C),ee.linkFields.map(be)]}):e.jsx("p",{children:"No specification found for this info type."}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:fe,disabled:se==="saving"||!ee,children:se==="saving"?"Saving...":u?"Update info":"Create info"})}),I?e.jsx("p",{className:"cogita-library-subtitle",children:I}):null]})})})]})})}const As=t=>/\s/.test(t),Aa=t=>/[\p{L}\p{N}]/u.test(t),Ps=(t,s)=>{const n=s>0?t[s-1]:"",i=s<t.length?t[s]:"";if(!n||!i)return 0;const o=As(n),m=As(i);if(o||m)return 3;const f=Aa(n),v=Aa(i);return f!==v?2:!f&&!v?1:0},ts=(t,s,n,i,o)=>{const m=Math.max(i-s,n-i);for(let f=0;f<=m;f+=1){const v=i-f;if(v>=s&&v<=n&&Ps(t,v)>=o)return v;const A=i+f;if(A>=s&&A<=n&&Ps(t,A)>=o)return A}return null},as=(t,s)=>{const n=s>0?t[s-1]:"",i=s<t.length?t[s]:"";return!n||!i?!0:Aa(n)!==Aa(i)},yi=(t,s,n,i)=>{const o=n-s,m=s+i,f=n-i;if(o<=i*2||f<=m)return null;const v=Math.floor((s+n)/2),A=ts(t,m,f,v,3);if(A!==null&&as(t,A))return A;const T=ts(t,m,f,v,2);if(T!==null&&as(t,T))return T;const c=ts(t,m,f,v,1);return c!==null&&as(t,c)?c:null},ia=(t,s)=>{const n=Math.max(1,7),i=Math.max(n,13),o={},m=(A,T,c,y,l)=>{const u=String(y),k={id:u,start:A,end:T,text:t.slice(A,T),depth:c,index:y,parentId:l};if(o[u]=k,T-A>i){let G=yi(t,A,T,n);if(G!==null&&G>A&&G<T){const W=m(A,G,c+1,y*2+1,u),S=m(G,T,c+1,y*2+2,u);k.leftId=W.id,k.rightId=S.id}}return k},f=m(0,t.length,0,0),v=Object.values(o).sort((A,T)=>T.depth-A.depth||A.start-T.start).map(A=>A.id);return{text:t,rootId:f.id,nodes:o,order:v}},ma=(t,s,n,i,o,m,f)=>{const v=m==="reverse"?t.order.slice().sort((A,T)=>t.nodes[T].start-t.nodes[A].start||t.nodes[T].depth-t.nodes[A].depth):t.order;for(const A of v){if(f&&A===f||s.has(A))continue;const T=t.nodes[A];if(T){if(o&&(T.leftId||T.rightId)){const c=T.leftId?n[T.leftId]??0:i,y=T.rightId?n[T.rightId]??0:i;if((c+y)/2<i)continue}return T}}return null},ys=(t,s)=>({before:t.slice(0,s.start),fragment:t.slice(s.start,s.end),after:t.slice(s.end)});function xi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c}){const y=`/#/cogita/library/${c}`,[l,u,k]=Vs([]),[oe,G,W]=Os([]),[S,h]=a.useState(null),[ce,K]=a.useState(null),[b,H]=a.useState(null),[$,X]=a.useState(null),I=a.useMemo(()=>l.find(C=>C.id===S)??null,[l,S]);a.useEffect(()=>{let C=!0;return kn({libraryId:c}).then(be=>{if(!C)return;const x=be.nodes.map(V=>{var he,Q,z;return{id:V.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:V.payload&&typeof V.payload=="object"&&"label"in V.payload?String(V.payload.label):"Item",nodeType:V.nodeType,itemType:((he=V.payload)==null?void 0:he.itemType)??"info",itemId:((Q=V.payload)==null?void 0:Q.itemId)??null,infoType:((z=V.payload)==null?void 0:z.infoType)??null}}});u(x),G(be.edges.map(V=>({id:V.edgeId,source:V.fromNodeId,target:V.toNodeId})))}).catch(()=>{C&&(u([]),G([]))}),()=>{C=!1}},[c]),a.useEffect(()=>{Nn({libraryId:c}).then(K).catch(()=>K(null))},[c,l,oe]);const E=a.useCallback(C=>{G(be=>qs(C,be))},[]),se=()=>{const C=crypto.randomUUID();u(be=>[...be,{id:C,type:"default",position:{x:140+be.length*40,y:120+be.length*30},data:{label:t.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},ie=()=>{const C=crypto.randomUUID();u(be=>[...be,{id:C,type:"default",position:{x:180+be.length*40,y:160+be.length*30},data:{label:t.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ee=async()=>{H(null);try{const C=l.map(x=>({nodeId:x.id,nodeType:x.data.nodeType,payload:{itemType:x.data.itemType,itemId:x.data.itemId??null,label:x.data.label,infoType:x.data.infoType??null}})),be=oe.map(x=>({edgeId:x.id,fromNodeId:x.source,toNodeId:x.target}));await Sn({libraryId:c,nodes:C,edges:be}),H(t.cogita.library.graph.saveSuccess)}catch{H(t.cogita.library.graph.saveFail)}},_e=C=>{I&&u(be=>be.map(x=>x.id===I.id?{...x,data:{...x.data,itemId:(C==null?void 0:C.infoId)??null,itemType:"collection",infoType:"collection",label:(C==null?void 0:C.label)??t.cogita.library.infoTypes.collection}}:x))},fe=C=>{I&&u(be=>be.map(x=>x.id===I.id?{...x,data:{...x.data,itemId:(C==null?void 0:C.infoId)??null,itemType:"info",infoType:(C==null?void 0:C.infoType)??null,label:(C==null?void 0:C.label)??t.cogita.library.infoTypes.any}}:x))};return a.useEffect(()=>{if(!I||I.data.nodeType!=="info"||I.data.infoType!=="citation"||!I.data.itemId){X(null);return}let C=!0;return Yt({libraryId:c,infoId:I.data.itemId}).then(be=>{if(!C)return;const x=be.payload,V=(x==null?void 0:x.text)??"";if(!V){X(null);return}const he=ia(V),Q=Object.values(he.nodes).sort((z,ve)=>z.depth-ve.depth||z.start-ve.start).map(z=>({id:z.id,text:z.text,depth:z.depth}));X({title:(x==null?void 0:x.title)??I.data.label,fragments:Q})}).catch(()=>X(null)),()=>{C=!1}},[c,I]),e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:t.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:y,children:t.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ee,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:se,children:t.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ie,children:t.cogita.library.actions.addInfo}),ce?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(ce.totalCollections))})}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(gs,{nodes:l,edges:oe,onNodesChange:k,onEdgesChange:W,onConnect:E,onNodeClick:(C,be)=>h(be.id),fitView:!0,children:[e.jsx(ms,{gap:18,size:1}),e.jsx(ps,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),I?e.jsxs("div",{className:"cogita-graph-inspector",children:[I.data.nodeType==="collection"?e.jsx(na,{libraryId:c,infoType:"collection",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:I.data.itemId?{id:I.data.itemId,label:I.data.label,infoType:"collection"}:null,onChange:_e,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.collection),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}):e.jsx(na,{libraryId:c,infoType:"any",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:I.data.itemId?{id:I.data.itemId,label:I.data.label,infoType:I.data.infoType??void 0}:null,onChange:fe,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.any),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),$?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:$.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:$.fragments.map(C=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:C.id}),e.jsx("span",{children:C.text})]},C.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}function sa(t){return[t.cardId,t.checkType??"",t.direction??""].join("|")}function Fs(t){return[t.parentItemId,t.parentCheckType??"",t.parentDirection??""].join("|")}function ss(t){const s=t.checkType??"info";return t.direction?`${s} / ${t.direction}`:s}function Ks(t){return t.trim().replace(/\s+/g," ").toLocaleLowerCase()}function vi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c,infoId:y}){const[l,u]=a.useState(y),[k,oe]=a.useState([]),[G,W]=a.useState([]),[S,h]=a.useState("loading"),[ce,K]=a.useState(null),[b,H]=a.useState(null),[$,X]=a.useState(null),[I,E]=a.useState(null),[se,ie]=a.useState([]),[ee,_e]=a.useState(""),[fe,C]=a.useState(""),[be,x]=a.useState(!1),[V,he]=a.useState(null),[Q,z]=a.useState(1);a.useEffect(()=>{let te=!1;return h("loading"),Promise.all([Yt({libraryId:c,infoId:y}).catch(()=>null),Ys({libraryId:c,infoId:y}),Gs({libraryId:c,infoId:y})]).then(([Ce,Ve,ze])=>{if(te)return;const F=(Ce==null?void 0:Ce.payload)??{},U=typeof F.title=="string"&&F.title||typeof F.label=="string"&&F.label||typeof F.name=="string"&&F.name||y;u(U),H(F),X((Ce==null?void 0:Ce.infoType)??null),oe(Ve.items),W(ze.items),h("ready")}).catch(()=>{te||(H(null),X(null),oe([]),W([]),h("error"))}),()=>{te=!0}},[c,y]),a.useEffect(()=>{Zs({libraryId:c}).then(te=>ie(te)).catch(()=>ie([]))},[c]),a.useEffect(()=>{if($!=="translation"){E(null);return}Xs({libraryId:c,infoId:y,approachKey:"vocab-card"}).then(te=>E(te.projection??null)).catch(()=>E(null))},[$,y,c]);const ve=a.useMemo(()=>{var Be;const te=new Map(k.map(re=>[sa(re),re])),Ce=new Map,Ve=new Map;for(const re of k)Ce.set(sa(re),0),Ve.set(sa(re),[]);for(const re of G){const J=Fs({parentItemId:re.parentItemId,parentCheckType:re.parentCheckType,parentDirection:re.parentDirection}),we=[re.childItemId,re.childCheckType??"",re.childDirection??""].join("|");!te.has(J)||!te.has(we)||((Be=Ve.get(J))==null||Be.push(we),Ce.set(we,(Ce.get(we)??0)+1))}const ze=Array.from(Ce.entries()).filter(([,re])=>re===0).map(([re])=>re),F=new Map;for(const re of ze)F.set(re,0);for(;ze.length;){const re=ze.shift(),J=F.get(re)??0;for(const we of Ve.get(re)??[]){const Pe=Math.max(F.get(we)??0,J+1);F.set(we,Pe),Ce.set(we,(Ce.get(we)??1)-1),(Ce.get(we)??0)<=0&&ze.push(we)}}const U=new Map;for(const re of k){const J=sa(re),we=F.get(J)??0,Pe=U.get(we)??[];Pe.push(J),U.set(we,Pe)}return k.map(re=>{const J=sa(re),we=F.get(J)??0,Pe=U.get(we)??[J],De=Math.max(0,Pe.indexOf(J));return{id:J,position:{x:40+De*290+(we%2?18:0),y:30+we*120},draggable:!1,selectable:!0,data:{label:re.label,subtitle:ss(re),checkType:re.checkType??"info",direction:re.direction??null},style:{width:250,borderRadius:10,border:"1px solid rgba(120,170,220,0.22)",background:"rgba(8,20,34,0.88)",color:"#e8f2ff",padding:8}}})},[k,G]),xe=a.useMemo(()=>new Map(k.map(te=>[sa(te),te])),[k]),ke=a.useMemo(()=>{const te=[];for(const Ce of G){const Ve=Fs({parentItemId:Ce.parentItemId,parentCheckType:Ce.parentCheckType,parentDirection:Ce.parentDirection}),ze=[Ce.childItemId,Ce.childCheckType??"",Ce.childDirection??""].join("|");!xe.has(Ve)||!xe.has(ze)||te.push({id:`${Ve}->${ze}`,source:Ve,target:ze,selectable:!1,animated:!1,style:{stroke:"rgba(148, 202, 248, 0.7)"}})}return te},[xe,G]),Te=a.useMemo(()=>ce?xe.get(ce)??null:null,[xe,ce]);a.useEffect(()=>{C(""),x(!1),he(null)},[ce]);const Ne=a.useMemo(()=>{var F,U;if(!Te)return null;const te=$??Te.infoType??null,Ce=Te.checkType??"info",Ve=Te.direction??null,ze=b??{};if(Te.cardType==="vocab"&&I&&Array.isArray(I.words)){const Be=I.words,re=((F=Be[0])==null?void 0:F.label)??"?",J=((U=Be[1])==null?void 0:U.label)??"?";return Ve==="a-to-b"?{prompt:String(re),expected:String(J),mode:"text"}:Ve==="b-to-a"?{prompt:String(J),expected:String(re),mode:"text"}:{prompt:`${re} ↔ ${J}`,expected:`${re} ↔ ${J}`,mode:"self"}}if(te==="citation"&&Ce==="quote-fragment"&&Ve&&typeof ze.text=="string"){const Be=Ve,J=ia(ze.text).nodes[Be];if(J){const we=ys(ze.text,J),Pe=`${we.before} [ ... ] ${we.after}`.replace(/\s+/g," ").trim(),De=J.text;return{prompt:Pe,expected:De,mode:"text"}}}return{prompt:Te.description||Te.label,expected:Te.label,mode:"self"}},[$,b,Te,I]),qe=async te=>{if(Te){if(!ee){he("Select a person to save knowness.");return}try{await Tn({libraryId:c,outcome:{itemType:"info",itemId:Te.cardId,checkType:Te.checkType??"info",direction:Te.direction??null,revisionType:"direct",evalType:"direct-check",correct:te,clientId:"cogita-info-checkcards",clientSequence:Q,personRoleId:ee}}),z(Ce=>Ce+1),he(te?"Saved as correct.":"Saved as incorrect.")}catch{he("Failed to save answer.")}}},Ke=async()=>{if(!Te||!Ne)return;if(Ne.mode!=="text"){he("Automatic check is available only for text answers.");return}if(!ee){he("Select a person to save knowness.");return}const te=Ks(fe)===Ks(Ne.expected);x(!0),await qe(te)};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-info-checkcards-page",children:[e.jsxs("header",{className:"cogita-info-checkcards-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.infoTypes.citation}),e.jsx("h2",{className:"cogita-card-title",children:l}),e.jsx("p",{className:"cogita-card-subtitle",children:y})]}),e.jsxs("div",{className:"cogita-selection-overview",children:[e.jsx("span",{className:"cogita-tag-chip",children:`Cards: ${k.length}`}),e.jsx("span",{className:"cogita-tag-chip",children:`Dependencies: ${G.length}`})]})]}),S==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading checkcards..."})}):S==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load checkcards."})}):e.jsxs("div",{className:"cogita-info-checkcards-layout",children:[e.jsxs("div",{className:"cogita-info-checkcards-main",children:[e.jsx("div",{className:"cogita-info-checkcards-graph",children:e.jsxs(gs,{nodes:ve,edges:ke,fitView:!0,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!0,onNodeClick:(te,Ce)=>K(Ce.id),panOnDrag:!0,children:[e.jsx(ms,{}),e.jsx(ps,{showInteractive:!1})]})}),Te?e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[e.jsx("h4",{children:Te.label}),e.jsx("p",{children:ss(Te)}),e.jsx("p",{className:"cogita-card-subtitle",children:Te.description}),Ne?e.jsxs("div",{className:"cogita-info-checkcard-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Prompt"}),e.jsx("div",{className:"cogita-info-tree-value",children:Ne.prompt}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Answer"}),e.jsx("input",{type:"text",value:fe,onChange:te=>C(te.target.value)})]}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[Ne.mode==="text"?e.jsx("button",{type:"button",className:"ghost",onClick:()=>void Ke(),disabled:!ee,children:"Check answer"}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>x(te=>!te),children:be?"Hide answer":"Show answer"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>void qe(!1),disabled:!ee,children:"Incorrect"}),e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>void qe(!0),disabled:!ee,children:"Correct"})]}),be?e.jsx("div",{className:"cogita-info-tree-value",children:Ne.expected}):null,ee?null:e.jsx("p",{className:"cogita-library-hint",children:"Auto-save knowness is available only after selecting a person."}),V?e.jsx("p",{className:"cogita-library-hint",children:V}):null]}):null]}):e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[e.jsx("h4",{children:"Select a checking card"}),e.jsx("p",{className:"cogita-card-subtitle",children:"Choose a node in the dependency tree to preview and answer it."})]})]}),e.jsxs("aside",{className:"cogita-info-checkcards-panel",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Person"}),e.jsxs("select",{value:ee,onChange:te=>_e(te.target.value),children:[e.jsx("option",{value:"",children:"Select person (optional)"}),se.map(te=>e.jsx("option",{value:te.roleId,children:te.label},te.roleId))]})]}),e.jsx("h3",{children:"Checking cards"}),e.jsx("div",{className:"cogita-info-tree",children:k.map(te=>{const Ce=sa(te),Ve=ce===Ce;return e.jsxs("button",{type:"button",className:`ghost cogita-checkcard-row ${Ve?"active":""}`,onClick:()=>K(Ce),children:[e.jsx("span",{children:te.label}),e.jsx("small",{children:ss(te)})]},Ce)})})]})]})]})})})})})}function wi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c,collectionId:y}){const{libraryName:l}=Ot(c),[u,k]=a.useState([]),[oe,G]=a.useState("loading"),[W,S]=a.useState("idle"),h=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ce=`/#/cogita/library/${c}`,K=()=>{G("loading"),en({libraryId:c}).then($=>{k($),G("idle")}).catch(()=>{k([]),G("error")})};a.useEffect(()=>{K()},[c]);const b=async $=>{try{await tn({libraryId:c,shareId:$}),K()}catch{K()}},H=async $=>{const X=`${h}/${$}`;try{await navigator.clipboard.writeText(X),S("copied")}catch{S("failed")}};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:ce,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${ce}/collections`,children:t.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[oe==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):oe==="error"?e.jsx("p",{children:t.cogita.library.revision.shareError}):u.filter($=>!y||$.collectionId===y).length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:u.filter($=>!y||$.collectionId===y).map($=>e.jsxs("div",{className:"cogita-share-row","data-state":$.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:$.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date($.createdUtc).toLocaleString(),$.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]}),$.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${h}/${$.shareCode}`}):null]}),$.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[$.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>H($.shareCode),children:t.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>b($.shareId),children:t.cogita.library.revision.shareRevokeAction})]})]},$.shareId))}),W==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):W==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function ji({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c}){const{libraryName:y}=Ot(c),[l,u]=a.useState(null),[k,oe]=a.useState(null),[G,W]=a.useState(null),[S,h]=a.useState(null),[ce,K]=a.useState(null),[b,H]=a.useState(null),$=a.useRef(null),X=se=>{if(!Number.isFinite(se))return"0 B";if(se<1024)return`${se} B`;const ie=se/1024;if(ie<1024)return`${ie.toFixed(1)} KB`;const ee=ie/1024;return ee<1024?`${ee.toFixed(1)} MB`:`${(ee/1024).toFixed(1)} GB`},I=async()=>{u(null),K({loadedBytes:0,totalBytes:null,percent:null});try{u(t.cogita.library.overview.exporting);const se=await Cn(c,K),ie=URL.createObjectURL(se),ee=document.createElement("a");ee.href=ie,ee.download=`cogita-library-${y||c}.json`,ee.click(),URL.revokeObjectURL(ie),u(t.cogita.library.overview.exportReady)}catch{u(t.cogita.library.overview.exportFail)}finally{K(se=>se??{loadedBytes:0,totalBytes:null,percent:null})}},E=async se=>{var ee;oe(null),W(null),h(null);const ie=(ee=se.target.files)==null?void 0:ee[0];if(ie)try{oe(t.cogita.library.overview.importing),H({loadedBytes:0,totalBytes:ie.size,percent:0});const _e=await Mn(c,ie,H,fe=>{const C=fe.stage==="infos"?t.cogita.library.overview.importStageInfos:fe.stage==="connections"?t.cogita.library.overview.importStageConnections:t.cogita.library.overview.importStageCollections;h(t.cogita.library.overview.importLiveProgress.replace("{stage}",C).replace("{done}",String(fe.processed)).replace("{total}",String(fe.total)).replace("{infos}",String(fe.infos)).replace("{connections}",String(fe.connections)).replace("{collections}",String(fe.collections)))});W({infos:_e.infosImported,connections:_e.connectionsImported,collections:_e.collectionsImported}),oe(t.cogita.library.overview.importDone)}catch(_e){const fe=_e instanceof In&&_e.message?` ${_e.message}`:"";oe(`${t.cogita.library.overview.importFail}${fe}`)}finally{$.current&&($.current.value="")}};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:y}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:I,children:t.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[t.cogita.library.overview.import,e.jsx("input",{ref:$,type:"file",accept:"application/json",onChange:E})]})]}),ce?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:ce.percent??void 0,max:ce.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.exportProgress.replace("{loaded}",X(ce.loadedBytes)).replace("{total}",ce.totalBytes?X(ce.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,b?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:b.percent??void 0,max:b.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.importProgress.replace("{loaded}",X(b.loadedBytes)).replace("{total}",b.totalBytes?X(b.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,l?e.jsx("p",{className:"cogita-help",children:l}):null,k?e.jsx("p",{className:"cogita-help",children:k}):null,S?e.jsx("p",{className:"cogita-help",children:S}):null,G?e.jsx("p",{className:"cogita-help",children:t.cogita.library.overview.importSummary.replace("{infos}",String(G.infos)).replace("{connections}",String(G.connections)).replace("{collections}",String(G.collections))}):null]})]})})})]})})}function ki({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c}){const{libraryName:y}=Ot(c),[l,u]=a.useState(""),[k,oe]=a.useState([]),G=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:y}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:l,onChange:W=>u(W.target.value),placeholder:t.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const W=l.trim();W&&(oe(S=>[{id:G(),name:W},...S]),u(""))},children:t.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[k.length===0?e.jsx("p",{children:t.cogita.library.modules.storyboardsEmpty}):null,k.map(W=>e.jsx("button",{type:"button",className:"ghost",children:W.name},W.id))]})]})]})})})]})})}function Ni({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c}){const{libraryName:y}=Ot(c),[l,u]=a.useState(""),[k,oe]=a.useState([]),G=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:y}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:l,onChange:W=>u(W.target.value),placeholder:t.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const W=l.trim();W&&(oe(S=>[{id:G(),name:W},...S]),u(""))},children:t.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[k.length===0?e.jsx("p",{children:t.cogita.library.modules.textsEmpty}):null,k.map(W=>e.jsx("button",{type:"button",className:"ghost",children:W.name},W.id))]})]})]})})})]})})}function zs({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c}){const{libraryName:y}=Ot(c),l=`/#/cogita/library/${c}`,[u,k]=a.useState(""),[oe,G]=a.useState([]),[W,S]=a.useState("idle"),[h,ce]=a.useState(0),[K,b]=a.useState(null);a.useEffect(()=>{S("loading");const $=window.setTimeout(()=>{ja({libraryId:c,query:u.trim()||void 0,limit:30}).then(X=>{G(X.items),ce(X.total),b(X.nextCursor??null),S("ready")}).catch(()=>{G([]),ce(0),b(null),S("ready")})},240);return()=>window.clearTimeout($)},[c,u]);const H=async()=>{if(K){S("loading");try{const $=await ja({libraryId:c,query:u.trim()||void 0,limit:30,cursor:K});G(X=>[...X,...$.items]),b($.nextCursor??null),ce($.total),S("ready")}catch{S("ready")}}};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:y}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:l,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${l}/collections/new`,children:t.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:u,onChange:$=>k($.target.value),placeholder:t.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:t.cogita.library.collections.countLabel.replace("{shown}",String(oe.length)).replace("{total}",String(h||oe.length))}),e.jsx("span",{children:W==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:oe.length?oe.map($=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${l}/collections/${$.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:$.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.collections.itemCountLabel.replace("{count}",String($.itemCount))," ·"," ",$.notes||t.cogita.library.collections.noNotes]})]})},$.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${l}/collections/new`,children:t.cogita.library.collections.emptyAction})]})}),K?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:H,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const ue=t=>`${t.cardType}:${t.cardId}:${t.checkType??""}:${t.direction??""}`,Dt=(t,s,n,i)=>`${t}:${s}:${n??""}:${i??""}`;function Si({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c,collectionId:y}){Ot(c);const l=`/#/cogita/library/${c}`,[u,k]=a.useState(t.cogita.library.collections.defaultName),[oe,G]=a.useState(null),[W,S]=a.useState(0),[h,ce]=a.useState([]),[K,b]=a.useState("idle"),[H,$]=a.useState(null),X=a.useMemo(()=>t.cogita.library.list.cardCount.replace("{shown}",String(h.length)).replace("{total}",String(W||h.length)),[t,h.length,W]);a.useEffect(()=>{Oa(c,y).then(E=>{k(E.name),G(E.notes??null),S(E.itemCount)}).catch(()=>{k(t.cogita.library.collections.defaultName),G(null)})},[c,y]),a.useEffect(()=>{b("loading"),Ra({libraryId:c,collectionId:y,limit:40}).then(E=>{ce(E.items),$(E.nextCursor??null),S(E.total),b("ready")}).catch(()=>{ce([]),$(null),b("ready")})},[c,y]);const I=async()=>{if(H){b("loading");try{const E=await Ra({libraryId:c,collectionId:y,limit:40,cursor:H});ce(se=>[...se,...E.items]),$(E.nextCursor??null),S(E.total),b("ready")}catch{b("ready")}}};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:u}),e.jsx("p",{className:"cogita-library-subtitle",children:oe||t.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:l,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${l}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${l}/collections/${y}/graph`,children:t.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${l}/collections/${y}/revision`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:X}),e.jsx("span",{children:K==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:h.length?h.map(E=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:E.cardType==="vocab"?t.cogita.library.list.cardTypeVocab:E.cardType==="connection"?t.cogita.library.list.cardTypeConnection:t.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:E.label}),e.jsx("p",{className:"cogita-card-subtitle",children:E.description})]})},ue(E))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.collections.noCards})})}),H?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:I,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${l}/collections/${y}/revision`,children:t.cogita.library.actions.startRevision})})]})})]})})})]})})}const _t=t=>{if(!t.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const s=t.length,n=t.filter(m=>m.correct).length,i=qa(xs(t));return{score:Math.round(Math.max(0,Math.min(100,i.knowness*100))*100)/100,total:s,correct:n,lastReviewedUtc:i.lastReviewedUtc??null}},Ti=t=>{if(t.maskBase64)try{const s=Ln(t.maskBase64);if(!s.length)return t.correct?1:0;const n=s.reduce((i,o)=>i+o,0);return Math.max(0,Math.min(1,n/s.length/255))}catch{return t.correct?1:0}return t.correct?1:0},xs=t=>t.map(s=>({correctness:Ti(s),createdUtc:s.createdUtc})),qa=(t,s=Date.now())=>{var W;if(!t.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const i=t.slice().sort((S,h)=>S.createdUtc.localeCompare(h.createdUtc)).slice(-5),o=i.reduce((S,h)=>S+h.correctness,0)/i.length,m=5,f=2,v=.15;let A=0,T=0;for(let S=0;S<i.length;S+=1){const h=new Date(i[S].createdUtc).getTime(),ce=S===i.length-1?s:new Date(i[S+1].createdUtc).getTime(),K=Math.max(0,(ce-h)/(1e3*60)),b=1-Math.exp(-K/m);A+=b,i[S].correctness>.5&&(T+=v)}let c=o*A*f+T;const y=((W=i[i.length-1])==null?void 0:W.createdUtc)??null,l=y?Math.max(0,(s-new Date(y).getTime())/(1e3*60)):0,k=1/(1+Math.log1p(l/60));return c*=k,i.length===1&&i[0].correctness>.5&&(c+=5.44*Math.exp(-l/2)),{knowness:c,avgCorrectness:o,lastReviewedUtc:y}},ka=t=>{const s=t.slice();for(let n=s.length-1;n>0;n-=1){const i=Math.floor(Math.random()*(n+1));[s[n],s[i]]=[s[i],s[n]]}return s},$a=t=>t[Math.floor(Math.random()*t.length)],Ci=(t,s)=>{const n=new Map;return t.forEach(i=>n.set(i,Math.random())),t.sort((i,o)=>{const m=s(i)-s(o);return m!==0?m:(n.get(i)??0)-(n.get(o)??0)})},Ua=(t,s,n,i,o)=>{if(!t.length)return null;const m=t.filter(v=>!(o!=null&&o.has(ue(v))));if(m.length===0)return null;const f=m.filter(v=>ue(v)!==n);return $a(f.length?f:m)},Mi=(t,s,n,i,o)=>{if(!t.length)return null;let m=Number.POSITIVE_INFINITY;for(const T of t){const c=ue(T);if(n.has(c))continue;const y=s[c]??1;y<m&&(m=y)}if(!Number.isFinite(m))return null;const f=t.filter(T=>{const c=ue(T);return!n.has(c)&&(s[c]??1)===m}),v=f.filter(T=>!o||ue(T)!==o),A=i?v.filter(T=>!i.has(ue(T))):v;return A.length>0?$a(A):v.length>0?$a(v):o&&f.some(T=>ue(T)===o)?f.find(T=>ue(T)===o)??null:f.length?$a(f):null},nn=(t,s,n,i,o)=>{const m=[],f=t.filter(A=>!o.has(ue(A))&&!n.has(ue(A))&&(s[ue(A)]??0)<1),v=Ci(f,A=>s[ue(A)]??0);for(const A of v){if(m.length>=i)break;m.push(A),o.add(ue(A))}if(m.length<i){const A=ka(t.filter(T=>!o.has(ue(T))&&n.has(ue(T))));for(const T of A){if(m.length>=i)break;m.push(T),o.add(ue(T))}}return m},Ii=(t,s,n,i)=>nn(t,s,n,i,new Set),vs=(t,s,n,i,o,m)=>{const f=Math.max(1,n.stackSize??s),A=ka(t).filter((k,oe,G)=>G.findIndex(W=>ue(W)===ue(k))===oe),T=Ii(A,i,o,f),c=new Set,y=new Set,l=Ua(T,{},null,c,y),u=l?[l]:[];return l&&y.add(ue(l)),{queue:u,meta:{pool:A,active:T,knownessMap:i,unknownSet:o,outcomesById:m,asked:c,queued:y}}},us={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:t=>t,prepare:(t,s)=>{const i=ka(t).filter((o,m,f)=>f.findIndex(v=>ue(v)===ue(o))===m);return{queue:i.slice(0,Math.min(s,i.length)),meta:{}}},applyOutcome:t=>t},ws=(t,s,n,i)=>{const o=Math.max(1,n.stackSize??s),f=ka(t).filter((oe,G,W)=>W.findIndex(S=>ue(S)===ue(oe))===G),v={},A=new Set,T=new Set,c=new Set,y=Math.max(1,n.levels??1);f.forEach(oe=>{const G=ue(oe),W=i==null?void 0:i[G],S=typeof W=="number"&&Number.isFinite(W)?W:1;v[G]=Math.min(y,Math.max(1,Math.round(S)))});const l=[];if(f.length>0){const oe=new Map;f.forEach(W=>{var h;const S=v[ue(W)]??1;oe.has(S)||oe.set(S,[]),(h=oe.get(S))==null||h.push(W)});const G=Array.from(oe.keys()).sort((W,S)=>W-S);for(const W of G){if(l.length>=o)break;const S=ka(oe.get(W)??[]);for(const h of S){if(l.length>=o)break;l.push(h)}}}const u=Ua(l,v,null,A,T),k=u?[u]:[];return u&&T.add(ue(u)),{queue:k,meta:{pool:f,active:l,levelMap:v,asked:A,queued:T,wrongSinceCorrect:c}}},Li={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,s)=>Math.max(1,s.stackSize??t),getProgressTotal:()=>null,prepare:(t,s,n)=>ws(t,s,n),applyOutcome:(t,s,n,i,o)=>{if(!s)return t;const m=Math.max(1,i.levels??1),f=t.meta.pool??[],v=t.meta.active??[],A={...t.meta.levelMap??{}},T=new Set(t.meta.asked??[]),c=new Set(t.meta.queued??[]),y=new Set(t.meta.wrongSinceCorrect??[]),l=ue(s);c.delete(l),T.add(l);const u=A[l]??1;o.correct?(A[l]=y.has(l)?1:Math.min(u+1,m),y.delete(l)):(A[l]=1,y.add(l));const k=o.correct?v.filter(W=>ue(W)!==l):v.slice();if(o.correct&&k.length<Math.max(1,i.stackSize??1)){const W=new Set(k.map(h=>ue(h))),S=Mi(f,A,W,T,l);S&&k.push(S)}const oe=t.queue.slice(),G=Ua(k,A,l,T,c);return G&&(oe.push(G),c.add(ue(G))),{queue:oe,meta:{pool:f,active:k,levelMap:A,asked:T,queued:c,wrongSinceCorrect:y}}}},$i={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,s)=>Math.max(1,s.stackSize??t),getProgressTotal:()=>null,prepare:(t,s,n)=>vs(t,s,n,{},new Set,{}),applyOutcome:(t,s,n,i,o)=>{if(!s)return t;const m=t.meta.pool??[],f=t.meta.active??[],v={...t.meta.knownessMap??{}},A=new Set(t.meta.unknownSet??[]),T={...t.meta.outcomesById??{}},c=new Set(t.meta.asked??[]),y=new Set(t.meta.queued??[]),l=ue(s);y.delete(l),c.add(l);const u={correctness:Math.max(0,Math.min(1,o.correctness??(o.correct?1:0))),createdUtc:o.createdUtc??new Date().toISOString()},oe=(T[l]??[]).concat(u).sort((K,b)=>K.createdUtc.localeCompare(b.createdUtc)).slice(-5);T[l]=oe,A.delete(l);const G=Date.now();m.forEach(K=>{const b=ue(K),H=T[b]??[];if(H.length===0){v[b]=0,A.add(b);return}const $=qa(H,G);v[b]=$.knowness});const W=f.slice();if((v[l]??0)>=1){const K=W.filter(b=>ue(b)!==l);W.length=0,W.push(...K)}const h=Math.max(1,i.stackSize??n);if(W.length<h){const K=new Set(W.map(H=>ue(H))),b=nn(m,v,A,h-W.length,K);W.push(...b)}const ce=t.queue.slice();if(ce.length===0||ue(ce[ce.length-1])===l){const K=Ua(W,{},l,c,y);K&&(ce.push(K),y.add(ue(K)))}return{queue:ce,meta:{pool:m,active:W,knownessMap:v,unknownSet:A,outcomesById:T,asked:c,queued:y}}}},rn={random:us,levels:Li,temporal:$i},Ri=Object.values(rn),js=t=>{if(!t)return us;const s=t.trim().toLowerCase();return s==="random"||s==="levels"||s==="temporal"?rn[s]:us},Wa=(t,s)=>{const n={...t.defaultSettings};return s&&Object.entries(s).forEach(([i,o])=>{typeof o=="number"&&Number.isFinite(o)&&(n[i]=o),typeof o=="string"&&(n[i]=o)}),t.settingsFields.forEach(i=>{var m;const o=n[i.key];if(i.type==="number"){if(typeof o!="number"||Number.isNaN(o)){n[i.key]=t.defaultSettings[i.key]??0;return}i.min!==void 0&&(n[i.key]=Math.max(i.min,n[i.key])),i.max!==void 0&&(n[i.key]=Math.min(i.max,n[i.key]));return}if(i.type==="select"){const f=((m=i.options)==null?void 0:m.map(v=>v.value))??[];(typeof o!="string"||f.length>0&&!f.includes(o))&&(n[i.key]=t.defaultSettings[i.key]??f[0]??"")}}),n},on=(t,s)=>{const n={};return t.settingsFields.forEach(i=>{const o=s.get(i.key);if(o){if(i.type==="number"){const m=Number(o);Number.isNaN(m)||(n[i.key]=m);return}n[i.key]=o}}),Wa(t,n)},Ei=(t,s)=>{const n=new URLSearchParams;return t.settingsFields.forEach(i=>{const o=s[i.key];(typeof o=="number"||typeof o=="string")&&n.set(i.key,String(o))}),n};function Ai({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c,collectionId:y,revisionId:l}){const{libraryName:u}=Ot(c),k=`/#/cogita/library/${c}`,[oe,G]=a.useState(t.cogita.library.collections.defaultName),[W,S]=a.useState(""),[h,ce]=a.useState(20),[K,b]=a.useState("random"),[H,$]=a.useState({}),[X,I]=a.useState("exact"),[E,se]=a.useState([]),[ie,ee]=a.useState(null),[_e,fe]=a.useState([]),[C,be]=a.useState("idle"),[x,V]=a.useState(null),[he,Q]=a.useState("idle"),[z,ve]=a.useState("idle"),[xe,ke]=a.useState("idle"),Te=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Ne=a.useMemo(()=>js(K),[K]),qe=a.useMemo(()=>Wa(Ne,H),[Ne,H]),Ke=a.useMemo(()=>Ei(Ne,qe).toString(),[Ne,qe]);a.useEffect(()=>{Oa(c,y).then(U=>G(U.name)).catch(()=>G(t.cogita.library.collections.defaultName))},[c,y]),a.useEffect(()=>{l&&$n({libraryId:c,collectionId:y,revisionId:l}).then(U=>{S(U.name),b(U.mode||"random"),I(U.check||"exact"),ce(U.limit||20),$(U.revisionSettings??{})}).catch(()=>{S("")})},[y,c,l]),a.useEffect(()=>{Zs({libraryId:c}).then(U=>{se(U),!ie&&U.length>0&&ee(U[0].roleId)}).catch(()=>{se([])})},[c]);const te=()=>{ve("loading"),en({libraryId:c}).then(U=>{fe(U),ve("idle")}).catch(()=>{fe([]),ve("error")})};a.useEffect(()=>{te()},[c]);const Ce=async()=>{be("working"),Q("idle");try{const U=await En({libraryId:c,collectionId:y,revisionType:Ne.id,revisionSettings:qe,mode:K,check:X,limit:h});V(`${Te}/${U.shareCode}${Ke?`?${Ke}`:""}`),be("ready"),te()}catch{be("error")}},Ve=async()=>{if(l){ke("saving");try{await Rn({libraryId:c,collectionId:y,revisionId:l,name:W||oe,revisionType:Ne.id,revisionSettings:qe,mode:K,check:X,limit:h}),ke("saved")}catch{ke("error")}}},ze=async()=>{if(x)try{await navigator.clipboard.writeText(x),Q("copied")}catch{Q("failed")}},F=async U=>{try{await tn({libraryId:c,shareId:U}),te()}catch{te()}};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:oe}),e.jsx("p",{className:"cogita-library-subtitle",children:u})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:k,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${k}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${k}/collections/${y}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${k}/collections/${y}/revision/run?mode=${encodeURIComponent(K)}&check=${encodeURIComponent(X)}&limit=${h}${Ke?`&${Ke}`:""}${ie?`&reviewer=${encodeURIComponent(ie)}`:""}${l?`&revisionId=${encodeURIComponent(l)}`:""}`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:W,onChange:U=>S(U.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsx("select",{value:K,onChange:U=>b(U.target.value),children:Ri.map(U=>e.jsx("option",{value:U.id,children:t.cogita.library.revision[U.labelKey]},U.id))})]}),Ne.settingsFields.map(U=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision[U.labelKey]}),U.type==="select"?e.jsx("select",{value:String(qe[U.key]??""),onChange:Be=>$(re=>({...re,[U.key]:Be.target.value})),children:(U.options??[]).map(Be=>e.jsx("option",{value:Be.value,children:t.cogita.library.revision[Be.labelKey]},Be.value))}):e.jsx("input",{type:"number",min:U.min,max:U.max,step:U.step,value:qe[U.key]??0,onChange:Be=>$(re=>({...re,[U.key]:Number(Be.target.value||0)}))})]},U.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.checkLabel}),e.jsx("input",{value:t.cogita.library.revision.checkValue,disabled:!0})]}),Ne.id!=="levels"&&Ne.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:h,onChange:U=>ce(Number(U.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:ie??"",onChange:U=>ee(U.target.value||null),children:E.map(U=>e.jsx("option",{value:U.roleId,children:U.label},U.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.previewBody1}),e.jsx("p",{children:t.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[l?e.jsx("button",{type:"button",className:"cta ghost",onClick:Ve,disabled:xe==="saving",children:xe==="saving"?"...":t.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${k}/collections/${y}/revision/run?mode=${encodeURIComponent(K)}&check=${encodeURIComponent(X)}&limit=${h}${Ke?`&${Ke}`:""}${ie?`&reviewer=${encodeURIComponent(ie)}`:""}${l?`&revisionId=${encodeURIComponent(l)}`:""}`,children:t.cogita.library.actions.startRevision})]}),xe==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.shareBody}),x?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:x,readOnly:!0})]}):null,C==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareError}):null,he==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):he==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:Ce,disabled:C==="working",children:C==="working"?t.cogita.library.revision.shareWorking:t.cogita.library.revision.shareAction}),x?e.jsx("button",{type:"button",className:"cta ghost",onClick:ze,children:t.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),z==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):_e.length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:_e.map(U=>e.jsxs("div",{className:"cogita-share-row","data-state":U.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:U.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(U.createdUtc).toLocaleString(),U.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]})]}),U.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>F(U.shareId),children:t.cogita.library.revision.shareRevokeAction})]},U.shareId))})]})]})]})]})})})]})})}const ns=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function cn(t,s,n){if(!t)return null;const i=new Map(t.nodes.map(K=>[K.id,K])),o=new Map,m=new Set,f=K=>{if(typeof K=="number")return K;if(typeof K=="string"){const b=Number(K);return Number.isFinite(b)?b:0}return 0},v=K=>{if(o.has(K))return o.get(K);if(m.has(K))return 0;const b=i.get(K);if(!b)return 0;m.add(K);const H=X=>{var E,se;return(X?((E=b.inputsByHandle)==null?void 0:E[X])??[]:b.inputs??((se=b.inputsByHandle)==null?void 0:se.in)??[]).map(ie=>v(ie))};let $=0;switch(b.type){case"input.random":{const X=b.min??0,I=b.max??X+10,E=Math.min(X,I),se=Math.max(X,I);$=Math.floor(Math.random()*(se-E+1))+E;break}case"input.const":{$=b.value??0;break}case"input.list":{const X=(b.list??[]).filter(Boolean),I=Math.round(f(H("index")[0]));$=X.length?X[Math.max(0,Math.min(X.length-1,I))]:String(I);break}case"compute.add":{$=H("in").map(I=>f(I)).reduce((I,E)=>I+E,0);break}case"compute.sub":{const X=H("add").map(E=>f(E)),I=H("sub").map(E=>f(E));$=X.reduce((E,se)=>E+se,0)-I.reduce((E,se)=>E+se,0);break}case"compute.mul":{const X=H("in").map(I=>f(I));$=X.length?X.reduce((I,E)=>I*E,1):0;break}case"compute.div":{const X=f(H("num")[0]),I=H("den").map(E=>f(E)).reduce((E,se)=>E+se,0);$=Math.abs(I)<Number.EPSILON?0:X/I;break}case"compute.pow":{const X=f(H("base")[0]),I=f(H("exp")[0]);$=Math.pow(X,I);break}case"compute.exp":{const X=f(H("base")[0]),I=f(H("exp")[0]);$=Math.pow(X,I);break}case"compute.log":{const X=f(H("value")[0]),I=f(H("base")[0]),E=Math.max(X,Number.EPSILON);$=Math.abs(I)<Number.EPSILON?Math.log(E):Math.log(E)/Math.log(I);break}case"compute.abs":{$=Math.abs(f(H("in")[0]));break}case"compute.min":{const X=H("in").map(I=>f(I));$=X.length?Math.min(...X):0;break}case"compute.max":{const X=H("in").map(I=>f(I));$=X.length?Math.max(...X):0;break}case"compute.floor":{$=Math.floor(f(H("in")[0]));break}case"compute.ceil":{$=Math.ceil(f(H("in")[0]));break}case"compute.round":{$=Math.round(f(H("in")[0]));break}case"compute.mod":{const X=f(H("a")[0]),I=f(H("b")[0]);$=Math.abs(I)<Number.EPSILON?0:X%I;break}case"compute.concat":{const I=["in1","in2","in3","in4","in5","in6"].flatMap(ee=>H(ee)),E=I.length?I:H("in");$=(E.length?E:H()).map(ee=>ee==null?"":String(ee)).join("");break}case"compute.trim":{const X=H("text")[0]??H("in")[0]??"",I=X==null?"":String(X),E=Math.max(0,Math.round(f(H("start")[0]))),se=Math.max(0,Math.round(f(H("end")[0])));E+se>=I.length?$="":$=I.substring(E,I.length-se);break}case"output":{$=H("in")[0]??0;break}default:$=0}return m.delete(K),o.set(K,$),$},A=t.outputs&&t.outputs.length>0?t.outputs:t.output?[t.output]:t.nodes.filter(K=>K.type==="output").map(K=>K.id);t.nodes.forEach(K=>v(K.id)),A.forEach(K=>v(K));const T=K=>Math.abs(K%1)<1e-5?String(Math.round(K)):K.toFixed(3).replace(/\.?0+$/,""),c=K=>typeof K=="number"?T(K):K??"",y=new Map;A.forEach(K=>{var I,E,se,ie;const b=i.get(K);if(!b)return;const H=(E=(I=b.inputsByHandle)==null?void 0:I.name)==null?void 0:E[0],$=H?c(o.get(H)):"",X=($==null?void 0:$.toString().trim())||((se=b.outputLabel)==null?void 0:se.trim())||((ie=b.name)==null?void 0:ie.trim())||K;y.set(K,X)});const l={},u={},k={};A.forEach(K=>{var $,X;const b=i.get(K);if(!b)return;const H=y.get(K)??((($=b.outputLabel)==null?void 0:$.trim())||((X=b.name)==null?void 0:X.trim())||K);l[H]=c(o.get(K)),b.name&&(u[b.name.trim()]=H),u[K]=H});const oe=(K,b)=>{let H=K;return t.nodes.forEach($=>{var ie,ee;const X=c(o.get($.id)),I=A.includes($.id),E=I?y.get($.id)??((ie=$.outputLabel)==null?void 0:ie.trim())??((ee=$.name)==null?void 0:ee.trim())??$.id:"",se=I&&b?E:X;H=H.replace(new RegExp(`\\{\\s*${ns($.id)}\\s*\\}`,"gi"),se),$.name&&(H=H.replace(new RegExp(`\\{\\s*${ns($.name)}\\s*\\}`,"gi"),se)),I&&$.outputLabel&&(H=H.replace(new RegExp(`\\{\\s*${ns($.outputLabel)}\\s*\\}`,"gi"),E))}),H},G=s;let W=G.trim().length>0?G:"";W||(W=A.length?`Compute ${A.join(", ")}`:"Compute"),W=oe(W,!0);const S=(n==null?void 0:n.trim())??"",h=S?oe(S,!1):"",ce={};return o.forEach((K,b)=>{ce[b]=K,k[b]=c(K);const H=i.get(b);H!=null&&H.name&&(k[H.name.trim()]=c(K))}),{prompt:W,answers:l,values:ce,answerText:h,outputVariables:u,variableValues:k}}function ln(t){var n;const s=Object.entries(t.answers);return{prompt:t.prompt,expectedAnswer:t.answerText??((n=s[0])==null?void 0:n[1])??"",expectedAnswers:t.answers,values:t.values,expectedAnswerIsSentence:!!(t.answerText&&t.answerText.trim().length>0),outputVariables:t.outputVariables,variableValues:t.variableValues}}function dn({copy:t,currentCard:s,currentTypeLabel:n,prompt:i,languages:o,answer:m,onAnswerChange:f,computedExpected:v,computedAnswers:A,onComputedAnswerChange:T,answerTemplate:c,outputVariables:y,variableValues:l,computedFieldFeedback:u,feedback:k,canAdvance:oe,quoteContext:G,quotePlaceholder:W,onCheckAnswer:S,onSkip:h,onLanguageSelect:ce,onMarkReviewed:K,onAdvance:b,showCorrectAnswer:H,setShowCorrectAnswer:$,onRevealCorrect:X,answerMask:I,expectedAnswer:E,hasExpectedAnswer:se,handleComputedKeyDown:ie,answerInputRef:ee,computedInputRefs:_e,scriptMode:fe,setScriptMode:C,matchPairs:be,matchLeftOrder:x,matchRightOrder:V,matchSelection:he,matchActiveLeft:Q,matchActiveRight:z,matchFeedback:ve,onMatchLeftSelect:xe,onMatchRightSelect:ke}){const Te=a.useMemo(()=>{var Ee;const F=!c&&v.length===2?`The {${v[0].key}} is of type {${v[1].key}}`:null,U=c??F;if(!U)return null;const Be=new Map(v.map(R=>[R.key,R.expected])),re=new Set,J=[],we=/\{([^}]+)\}/g;let Pe=0,De,Ue=null;for(;(De=we.exec(U))!==null;){const R=U.slice(Pe,De.index);R&&J.push({type:"text",value:R});const O=((Ee=De[1])==null?void 0:Ee.trim())??"",ye=O&&Be.has(O)?O:O&&y&&y[O]?y[O]:null;O&&re.add(O),ye&&re.add(ye),ye&&Be.has(ye)?(J.push({type:"input",value:ye}),Ue||(Ue=ye)):O&&l&&l[O]!==void 0?J.push({type:"text",value:l[O]}):J.push({type:"text",value:De[0]}),Pe=De.index+De[0].length}const Y=U.slice(Pe);return Y&&J.push({type:"text",value:Y}),v.filter(R=>!re.has(R.key)).length>0?null:{parts:J,expectedByKey:Be,firstInputKey:Ue}},[c,v,y,l]),Ne=()=>{if(!Te)return null;const{parts:F,expectedByKey:U,firstInputKey:Be}=Te;return e.jsx("div",{className:"cogita-revision-inline-answer",children:F.map((re,J)=>{var we,Pe;return re.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:re.value},`text-${J}`):e.jsx("input",{ref:De=>{_e.current[re.value]=De},autoFocus:re.value===Be,value:A[re.value]??"",onChange:De=>T(re.value,De.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":u[re.value]??(k==="correct"?"correct":k==="incorrect"?"incorrect":void 0),onKeyDown:De=>Ce(De)||ie(De),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((we=A[re.value])==null?void 0:we.length)??0,((Pe=U.get(re.value))==null?void 0:Pe.length)??6)}ch`}},`input-${re.value}-${J}`)})})},qe=a.useMemo(()=>{const F=new Map;return(be??[]).forEach(U=>F.set(U.leftId,U)),F},[be]),Ke=a.useMemo(()=>{const F=new Map;return(be??[]).forEach(U=>F.set(U.rightId,U)),F},[be]);a.useEffect(()=>{var J;if(s.cardType!=="info"||s.infoType!=="computed"||v.length===0)return;const F=typeof document<"u"?document.activeElement:null;if(F&&(F.tagName==="INPUT"||F.tagName==="TEXTAREA"))return;const U=(Te==null?void 0:Te.firstInputKey)??((J=v[0])==null?void 0:J.key);if(!U)return;const Be=_e.current[U];if(!Be)return;const re=requestAnimationFrame(()=>{Be.focus()});return()=>cancelAnimationFrame(re)},[s,v,Te]);const te=(()=>{const F=[E??"",...v.map(re=>re.expected??"")].join(""),U=[m,...Object.values(A)].join(""),Be=`${F}${U}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Be)})(),Ce=F=>F.ctrlKey&&(F.key==="^"||F.key==="6")?(F.preventDefault(),C(U=>U==="super"?null:"super"),!0):F.ctrlKey&&(F.key==="_"||F.key==="-")?(F.preventDefault(),C(U=>U==="sub"?null:"sub"),!0):!1,Ve=()=>{if(!E||!I)return E??"";const F=E.split(""),U=Array.from(I),Be=U.length>0?U.reduce((re,J)=>re+J,0)/U.length:127;return F.map((re,J)=>{const we=U[J]??Be,Pe=Math.max(0,Math.min(255,Math.round(we)));let De=255,Ue=0;return Pe<=127?Ue=Math.round(Pe/127*255):(Ue=255,De=Math.round(255*(1-(Pe-127)/128))),e.jsx("span",{style:{color:`rgb(${De}, ${Ue}, 0)`},children:re},`mask-${J}`)})},ze=s.cardType==="info"&&s.infoType==="citation"?(G==null?void 0:G.title)||s.label:s.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:n}),e.jsx("strong",{children:ze})]}),s.cardType==="vocab"&&s.checkType==="translation-match"&&be?e.jsxs("div",{className:"cogita-revision-body",children:[i?e.jsx("h2",{children:i}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(x??[]).map(F=>{const U=qe.get(F);if(!U)return null;const Be=(he==null?void 0:he[F])??null,re=(ve==null?void 0:ve[F])??null,J=Q===F;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":J,"data-state":re??void 0,"data-locked":Be?"true":void 0,onClick:()=>xe==null?void 0:xe(F),children:[e.jsx("span",{children:U.leftLabel}),Be&&H?e.jsx("em",{children:"✓"}):null]},F)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(V??[]).map(F=>{const U=Ke.get(F);if(!U)return null;const Be=Object.values(he??{}).includes(F),re=z===F;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Be||re,"data-locked":Be?"true":void 0,onClick:()=>ke==null?void 0:ke(F),children:e.jsx("span",{children:U.rightLabel})},F)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,disabled:s.checkType==="translation-match",children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:h,children:t.cogita.library.revision.skip})]})]}):s.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ee,value:m,onChange:F=>f(F.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":k==="correct"?"correct":k==="incorrect"?"incorrect":void 0,onKeyDown:F=>{F.key==="Enter"&&(F.preventDefault(),F.stopPropagation(),oe?b():S())}})]}),te?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":fe==="super",onClick:()=>C(F=>F==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":fe==="sub",onClick:()=>C(F=>F==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:h,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[s.label?e.jsx("p",{className:"cogita-revision-hint",children:s.label}):null,c?null:e.jsx(An,{value:i??"",mode:"auto"}),v.length>0?(()=>{const F=Ne();return F?e.jsx("div",{className:"cogita-inline-answer-wrap",children:F}):e.jsx("div",{className:"cogita-form-grid",children:v.map((U,Be)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:U.key}),e.jsx("textarea",{ref:re=>{_e.current[U.key]=re},autoFocus:Be===0,value:A[U.key]??"",onChange:re=>T(U.key,re.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":u[U.key]??(k==="correct"?"correct":k==="incorrect"?"incorrect":void 0),onKeyDown:re=>Ce(re)||ie(re)})]},U.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ee,value:m,onChange:F=>f(F.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":k==="correct"?"correct":k==="incorrect"?"incorrect":void 0,onKeyDown:F=>{Ce(F)||F.key==="Enter"&&(F.preventDefault(),F.stopPropagation(),oe?b():S())}})]})}),te?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":fe==="super",onClick:()=>C(F=>F==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":fe==="sub",onClick:()=>C(F=>F==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:h,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="citation"&&G?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.quoteProgress.replace("{done}",String(G.completed)).replace("{total}",String(G.total))}),e.jsx("p",{className:"cogita-quote-text",children:G.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ee,value:m,onChange:F=>f(F.target.value),placeholder:W??t.cogita.library.revision.quoteMissingPlaceholder,"data-state":k==="correct"?"correct":k==="incorrect"?"incorrect":void 0,onKeyDown:F=>{F.key==="Enter"&&(F.preventDefault(),F.stopPropagation(),oe?b():S())}})]}),e.jsx("p",{className:"cogita-quote-text",children:G.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:h,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:o.length?o.map(F=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ce(F.label),children:F.label},F.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:t.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:h,children:t.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:K,children:t.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:h,children:t.cogita.library.revision.skip})]})]}),k&&e.jsx("div",{className:"cogita-revision-feedback","data-state":k,children:k==="correct"?t.cogita.library.revision.correct:t.cogita.library.revision.tryAgain}),k==="incorrect"&&se?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>$(F=>{const U=!F;return U&&X(),U}),children:t.cogita.library.revision.showAnswer}),H?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),v.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[v.map(F=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:F.key}),e.jsx("span",{children:F.expected})]},F.key)),E?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:E})]}):null]}):e.jsx("p",{children:I?Ve():E})]}):null]}):null,oe?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:b,children:t.cogita.library.revision.nextQuestion})}):null]})}const is=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function un({outcomes:t}){const[s,n]=a.useState("day"),i=a.useMemo(()=>{const o=is.find(v=>v.id===s)??is[1],m=Date.now()-o.ms,f=t.filter(v=>new Date(v.createdUtc).getTime()>=m);return _t(f)},[t,s]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:is.map(o=>e.jsx("button",{type:"button",className:"ghost","data-active":s===o.id,onClick:()=>n(o.id),children:o.label},o.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[i.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[i.correct," / ",i.total]})]})}const Pi="cogita-revision",Fi=1,Pa="outcomes",Ki=()=>new Promise((t,s)=>{const n=indexedDB.open(Pi,Fi);n.onupgradeneeded=()=>{const i=n.result;if(!i.objectStoreNames.contains(Pa)){const o=i.createObjectStore(Pa,{keyPath:"id"});o.createIndex("byItem","itemKey",{unique:!1}),o.createIndex("byPending","pending",{unique:!1})}},n.onerror=()=>s(n.error),n.onsuccess=()=>t(n.result)}),Sa=async(t,s)=>{const n=await Ki();return new Promise((i,o)=>{const m=n.transaction(Pa,t),f=m.objectStore(Pa);s(f).then(i).catch(o),m.onerror=()=>o(m.error)})},hn=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const t=new Uint8Array(16);crypto.getRandomValues(t);const s=Array.from(t).map(n=>n.toString(16).padStart(2,"0"));return`${s.slice(0,4).join("")}-${s.slice(4,6).join("")}-${s.slice(6,8).join("")}-${s.slice(8,10).join("")}-${s.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},zi=()=>{const t="cogita_revision_client_id",s=localStorage.getItem(t);if(s)return s;const n=hn();return localStorage.setItem(t,n),n},Bi=()=>{const t="cogita_revision_client_seq",s=Number(localStorage.getItem(t)??"0"),n=Number.isFinite(s)?s+1:1;return localStorage.setItem(t,String(n)),n},gn=(t,s,n,i)=>Dt(t,s,n,i),Fa=async t=>{const s=zi(),n=Bi(),i=new Date().toISOString(),o={...t,clientId:s,clientSequence:n,createdUtc:i,id:hn(),pending:!0};return await Sa("readwrite",m=>new Promise((f,v)=>{const A={...o,itemKey:gn(o.itemType,o.itemId,o.checkType,o.direction)},T=m.add(A);T.onsuccess=()=>f(),T.onerror=()=>v(T.error)})),o},Ka=async(t,s,n,i)=>{if(!s)return[];try{const o=gn(t,s,n,i);return await Sa("readonly",m=>new Promise((f,v)=>{const T=m.index("byItem").getAll(o);T.onsuccess=()=>{const y=(T.result??[]).map(l=>({itemType:l.itemType,itemId:l.itemId,checkType:l.checkType??null,direction:l.direction??null,revisionType:l.revisionType,evalType:l.evalType,correct:l.correct,createdUtc:l.createdUtc,maskBase64:l.maskBase64,payloadBase64:l.payloadBase64,payloadHashBase64:l.payloadHashBase64,clientId:l.clientId,clientSequence:l.clientSequence,personRoleId:l.personRoleId??null})).sort((l,u)=>l.createdUtc.localeCompare(u.createdUtc));f(y)},T.onerror=()=>v(T.error)}))}catch{return[]}},Vt=async()=>{try{return await Sa("readonly",t=>new Promise((s,n)=>{const i=t.getAll();i.onsuccess=()=>{const m=(i.result??[]).map(f=>({itemType:f.itemType,itemId:f.itemId,checkType:f.checkType??null,direction:f.direction??null,revisionType:f.revisionType,evalType:f.evalType,correct:f.correct,createdUtc:f.createdUtc,maskBase64:f.maskBase64,payloadBase64:f.payloadBase64,payloadHashBase64:f.payloadHashBase64,clientId:f.clientId,clientSequence:f.clientSequence,personRoleId:f.personRoleId??null}));s(m)},i.onerror=()=>n(i.error)}))}catch{return[]}},Di=async(t=100)=>{try{return await Sa("readonly",s=>new Promise((n,i)=>{const m=s.index("byPending").getAll(!0);m.onsuccess=()=>{const f=m.result??[];n(f.slice(0,t))},m.onerror=()=>i(m.error)}))}catch{return[]}},_i=async t=>{if(t.length!==0)try{await Sa("readwrite",s=>new Promise((n,i)=>{let o=t.length;t.forEach(m=>{const f=s.get(m);f.onsuccess=()=>{const v=f.result;if(v){v.pending=!1;const A=s.put(v);A.onsuccess=()=>{o-=1,o===0&&n()},A.onerror=()=>i(A.error)}else o-=1,o===0&&n()},f.onerror=()=>i(f.error)})}))}catch{}},rs=async(t,s)=>{const n=await Di(200);if(n.length===0)return;const i=new Map;n.forEach(o=>{var f;const m=o.personRoleId??s??"";i.has(m)||i.set(m,[]),(f=i.get(m))==null||f.push(o)});for(const[o,m]of i.entries()){const f=m.map(v=>({itemType:v.itemType,itemId:v.itemId,checkType:v.checkType??null,direction:v.direction??null,revisionType:v.revisionType,evalType:v.evalType,correct:v.correct,clientId:v.clientId,clientSequence:v.clientSequence,maskBase64:v.maskBase64??null,payloadHashBase64:v.payloadHashBase64??null,payloadBase64:v.payloadBase64??null,personRoleId:o||null}));try{await Pn({libraryId:t,outcomes:f}),await _i(m.map(v=>v.id))}catch{}}},Bs={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Vi=(t,s)=>{const n=Math.max(t.length,s.length,1),i=Math.abs(t.length-s.length);return Math.max(0,1-i/n)},Oi=(t,s)=>{const n=new Uint8Array(t.length),i=Vi(t,s);for(let o=0;o<t.length;o+=1){const m=t[o]===(s[o]??"")?128:0,f=t.length-1-o,v=s.length-1-o,A=t[f]===(s[v]??"")?127:0,T=Math.round((m+A)*i);n[o]=Math.max(0,Math.min(255,T))}return n},La=(t,s)=>t===s||(Bs[t]??[]).includes(s)?!0:(Bs[s]??[]).includes(t),za=(t,s)=>{const n=new Uint8Array(t.length);if(!t.length)return n;const i=[];for(let m=0;m<=t.length-3;m+=1)i.push({index:m,text:t.slice(m,m+3)});let o=!1;return i.forEach(m=>{for(let f=0;f<=s.length-3;f+=1){const v=s.slice(f,f+3);let A=0;for(let u=0;u<3;u+=1)La(m.text[u],v[u])&&(A+=1);if(A<2)continue;let T=m.index-1,c=f-1;for(;T>=0&&c>=0;){const u=t[T],k=s[c];if(u===k){n[T]=Math.max(n[T],255),T-=1,c-=1,o=!0;continue}if(La(u,k)){n[T]=Math.max(n[T],127),T-=1,c-=1,o=!0;continue}if(T>0&&t[T-1]===k){n[T]=Math.max(n[T],0),T-=1,o=!0;continue}if(c>0&&t[T]===s[c-1]){c-=1,o=!0;continue}break}for(let u=0;u<3;u+=1){const k=m.index+u,oe=m.text[u],G=v[u],W=oe===G?255:La(oe,G)?127:0;n[k]=Math.max(n[k],W),o=!0}let y=m.index+3,l=f+3;for(;y<t.length&&l<s.length;){const u=t[y],k=s[l];if(u===k){n[y]=Math.max(n[y],255),y+=1,l+=1,o=!0;continue}if(La(u,k)){n[y]=Math.max(n[y],127),y+=1,l+=1,o=!0;continue}if(y+1<t.length&&t[y+1]===k){n[y]=Math.max(n[y],0),y+=1,o=!0;continue}if(l+1<s.length&&t[y]===s[l+1]){l+=1,o=!0;continue}break}}}),o?n:Oi(t,s)},pa=(t,s,n)=>{const i=t.trim().toLowerCase(),o=s.trim().toLowerCase();return za(i,o)},fa=t=>t.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),mn=(t,s,n)=>{const i=fa(t),o=fa(s);return za(i,o)},Nt=t=>t.trim().toLowerCase(),qi=t=>t==="reverse"?"reverse":"forward",Na=(t,s)=>`${t}|${s}`,Mt=t=>{if(!t)return null;const[s,n]=t.split("|",2);return(s==="forward"||s==="reverse")&&n?{mode:s,fragmentId:n}:{mode:"forward",fragmentId:t}},Ba=(t,s)=>{var i;const n=Mt(s);return n?n.fragmentId&&s?(t??null)===s:(((i=Mt(t))==null?void 0:i.mode)??"forward")===n.mode:!0},gt=t=>{const s=t==null?void 0:t.trim().toLowerCase();return s||null},pn=(t,s)=>{if((gt(t.childItemType)??"info")!==(s.cardType??"").toLowerCase()||t.childItemId!==s.cardId)return!1;const i=gt(t.childCheckType),o=gt(t.childDirection),m=gt(s.checkType),f=gt(s.direction);return!(i&&i!==m||o&&o!==f)},Ui={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Wi={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},Da=(t,s,n)=>{if(!n||!s.startsWith(t))return s;const i=s.slice(t.length);if(!i)return s;const o=n==="super"?Ui:Wi,m=i.split("").map(f=>o[f]??f).join("");return t+m},_a=(t,s,n)=>{var f,v,A;if(!t)return((f=s[0])==null?void 0:f.key)??null;const i=new Set(s.map(T=>T.key)),o=/\{([^}]+)\}/g;let m;for(;(m=o.exec(t))!==null;){const T=((v=m[1])==null?void 0:v.trim())??"";if(!T)continue;if(i.has(T))return T;const c=n==null?void 0:n[T];if(c&&i.has(c))return c}return((A=s[0])==null?void 0:A.key)??null},hs=t=>t.flatMap(s=>{if(s.cardType!=="info"||s.infoType!=="citation")return[s];const n=s.description??"";if(!n.trim())return[s];const i=Mt(s.direction),o=(i==null?void 0:i.mode)??qi(s.direction),m=ia(n),f=Object.keys(m.nodes);return f.length===0?[s]:f.map(v=>({...s,checkType:"quote-fragment",direction:Na(o,v)}))});function Hi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c,collectionId:y,revisionId:l}){const u=Va(),k=`/#/cogita/library/${c}`,oe=a.useMemo(()=>new URLSearchParams(u.search),[u.search]),G=Math.max(1,Number(oe.get("limit")??20)),W=oe.get("mode")??"random",S=a.useMemo(()=>js(W),[W]),h=a.useMemo(()=>Wa(S,on(S,oe)),[S,oe]),ce=oe.get("check")??"exact",K=oe.get("reviewer"),b=a.useMemo(()=>t.cogita.library.revision[S.labelKey]??W,[t,W,S]),H=a.useMemo(()=>ce==="exact"?t.cogita.library.revision.checkValue:ce,[t,ce]),[$,X]=a.useState(t.cogita.library.collections.defaultName),[I,E]=a.useState([]),[se,ie]=a.useState([]),[ee,_e]=a.useState("idle"),[fe,C]=a.useState({current:0,total:0}),[be,x]=a.useState(0),[V,he]=a.useState(""),[Q,z]=a.useState(null),[ve,xe]=a.useState(null),[ke,Te]=a.useState(null),[Ne,qe]=a.useState(null),[Ke,te]=a.useState([]),[Ce,Ve]=a.useState({}),[ze,F]=a.useState({}),[U,Be]=a.useState(null),[re,J]=a.useState(null),[we,Pe]=a.useState(null),[De,Ue]=a.useState(null),[Y,ge]=a.useState(null),[Ee,R]=a.useState({}),O=a.useRef(0),[ye,Me]=a.useState(null),je=a.useRef(null),Re=a.useRef(null),[Fe,We]=a.useState(null),[$e,Ae]=a.useState(!1),[Se,st]=a.useState(null),[Qe,Je]=a.useState([]),[rt,yt]=a.useState(null),Ze=a.useRef(null),tt=a.useRef(null),[lt,dt]=a.useState(null),[It,nt]=a.useState(0),ot=a.useRef(null),Lt=a.useRef({}),[ft,at]=a.useState(!1),[it,xt]=a.useState({}),[Tt,et]=a.useState([]),ht=a.useRef(new Map),[bt,g]=a.useState(new Set),[p,P]=a.useState(!1),ae=a.useRef(null),Oe=a.useRef(new Set),Xe=a.useRef({}),me=I[be]??null,le=(me==null?void 0:me.checkType)==="translation-match"&&Y,vt=a.useRef(new Map),At=a.useRef(new Map),qt=a.useRef(new Map),zt=a.useRef(new Map),Pt=a.useMemo(()=>me?me.cardType==="vocab"?t.cogita.library.revision.vocabLabel:me.infoType?Ge(t,me.infoType):t.cogita.library.revision.infoLabel:"",[t,me]),ra=a.useMemo(()=>{var d;return S.id!=="levels"?I.length:((d=it.pool)==null?void 0:d.length)??S.getFetchLimit(G,h)},[it,h,S,I.length,G]),Ut=S.getProgressTotal?S.getProgressTotal(I,it,G,h):S.id==="levels"?Math.min(G,ra):I.length,mt=Ut?Math.min(be+1,Ut):0,wt=Math.max(1,Number(h.tries??1)),Ct=h.compare??"anchors",Wt=Math.max(0,Math.min(100,Number(h.minCorrectness??0))),pt=(h.considerDependencies??"on")==="on",ct=Math.max(0,Math.min(100,Number(h.dependencyThreshold??85))),Et=r=>{const d=r.slice();for(let N=d.length-1;N>0;N-=1){const w=Math.floor(Math.random()*(N+1));[d[N],d[w]]=[d[w],d[N]]}return d},Gt=r=>r.length?r.reduce((N,w)=>N+w,0)/r.length/255*100:0,Ht=r=>Gt(r)>=Wt,oa=async()=>{const r=await Vt(),d=new Map,N=new Map,w=new Map;r.forEach(L=>{const D=`${L.itemType}:${L.itemId}`,Z=Dt(L.itemType,L.itemId,L.checkType,L.direction);if(d.has(D)||d.set(D,[]),d.get(D).push(L),N.has(Z)||N.set(Z,[]),N.get(Z).push(L),L.itemType==="info"&&L.checkType==="quote-fragment"&&L.direction){const ne=`${L.itemId}:${L.direction}`;w.has(ne)||w.set(ne,[]),w.get(ne).push(L)}});const _=new Map,j=new Map,B=new Map;return d.forEach((L,D)=>_.set(D,_t(L).score)),N.forEach((L,D)=>j.set(D,_t(L).score)),w.forEach((L,D)=>B.set(D,_t(L).score)),{itemKnowness:_,cardKnowness:j,fragmentKnowness:B}},Ha=async r=>{const d=[];let N=null;for(;;){const w=await Ra({libraryId:c,collectionId:r,limit:200,cursor:N});if(d.push(...w.items),!w.nextCursor)break;N=w.nextCursor}return hs(d)},ba=async(r,d)=>{if(ht.current.has(r))return ht.current.get(r)??0;const N=await Ha(r);if(N.length===0)return ht.current.set(r,0),0;const _=N.reduce((j,B)=>{const L=ue(B);return j+(d.get(L)??0)},0)/N.length;return ht.current.set(r,_),_},Qa=(r,d)=>{if(!pt||r.cardType!=="info"||r.infoType!=="citation"||r.checkType!=="quote-fragment")return!0;const N=Mt(r.direction);if(!(N!=null&&N.fragmentId))return!0;const w=r.description??"";if(!w.trim())return!0;const j=ia(w).nodes[N.fragmentId];if(!j||!j.leftId&&!j.rightId)return!0;const B=[j.leftId,j.rightId].filter(Z=>!!Z);if(B.length===0)return!0;const L=B.map(Z=>{const ne=Dt("info",r.cardId,"quote-fragment",Na(N.mode,Z));return d.get(ne)??0});return L.reduce((Z,ne)=>Z+ne,0)/L.length>=ct},ca=async r=>{const d=it,N=r.concat(d.active??[]).concat(d.pool??[]).filter((L,D,Z)=>Z.findIndex(ne=>ue(ne)===ue(L))===D);if(!pt){g(new Set(N.map(ue)));return}const{itemKnowness:w,cardKnowness:_}=await oa(),j=Tt.filter(L=>gt(L.childItemType)==="collection"&&L.childItemId===y&&!gt(L.childCheckType)&&!gt(L.childDirection)),B=new Set;for(const L of N){if(L.cardType!=="info"){B.add(ue(L));continue}if(!Qa(L,_))continue;const D=Tt.filter(pe=>pn(pe,L)).concat(j);if(D.length===0){B.add(ue(L));continue}let Z=0;for(const pe of D)if(gt(pe.parentItemType)==="collection")Z+=await ba(pe.parentItemId,_);else if(gt(pe.parentCheckType)||gt(pe.parentDirection)){const de=gt(pe.parentCheckType),Ie=gt(pe.parentDirection),Le=Dt(pe.parentItemType,pe.parentItemId,de,Ie);Z+=_.get(Le)??0}else{const de=`${pe.parentItemType}:${pe.parentItemId}`;Z+=w.get(de)??0}Z/D.length>=ct&&B.add(ue(L))}g(B)},Ya=r=>{for(let d=r;d<I.length;d+=1){const N=I[d];if(N&&(!pt||N.cardType!=="info"||bt.has(ue(N))))return d}return-1},$t=r=>!pt||r.cardType!=="info"||bt.has(ue(r)),la=r=>{if(S.id!=="temporal"&&S.id!=="levels")return null;const d=it,N=(d.active??[]).concat(d.pool??[]),w=new Set;for(const _ of N){const j=ue(_);if(!(w.has(j)||r.has(j))&&(w.add(j),$t(_)))return _}return null},Ft=a.useMemo(()=>{if(S.id!=="levels")return null;const r=it,d=r.pool??[],N=r.active??[],w=r.levelMap??{},_=Math.max(1,Number(h.levels??1)),j=Array.from({length:_},()=>0),B=new Set(N.map(ne=>ue(ne)));d.forEach(ne=>{const pe=Math.min(_,Math.max(1,w[ue(ne)]??1));j[pe-1]+=1});const L=d.length||1,D=j.map(ne=>ne/L*100),Z=me?w[ue(me)]??1:null;return{counts:j,percentages:D,currentLevel:Z,levelsCount:_,activeCount:N.length,poolCount:d.length,activeSet:B}},[it,h,S,me]),jt=a.useMemo(()=>{if(S.id!=="temporal")return null;const r=it,d=r.pool??[],N=r.active??[],w=r.knownessMap??{},_=new Set(r.unknownSet??[]);let j=0;d.forEach(D=>{(w[ue(D)]??0)>1&&(j+=1)});const B=_.size,L=N.map(D=>({id:ue(D),value:_.has(ue(D))?0:Math.max(0,Math.min(1,w[ue(D)]??0))}));return{knownCount:j,unknownCount:B,dots:L}},[it,S]),da=a.useMemo(()=>{if(!pt)return 0;const r=it;return I.concat(r.active??[]).concat(r.pool??[]).filter((N,w,_)=>_.findIndex(j=>ue(j)===ue(N))===w).filter(N=>N.cardType==="info"&&!bt.has(ue(N))).length},[pt,it,I,bt]);a.useEffect(()=>{if(!pt||ee!=="ready")return;const r=it,N=I.concat(r.active??[]).concat(r.pool??[]).filter((j,B,L)=>L.findIndex(D=>ue(D)===ue(j))===B).filter(j=>j.cardType!=="info"||bt.has(ue(j))).length,w=Ze.current;if(Ze.current=N,w===null||N<=w)return;const _=N-w;yt(`New card available (+${_})`),tt.current&&window.clearTimeout(tt.current),tt.current=window.setTimeout(()=>yt(null),2200)},[pt,ee,it,I,bt]),a.useEffect(()=>()=>{tt.current&&window.clearTimeout(tt.current)},[]);const kt=(r,d)=>{const N=S.applyOutcome({queue:I,meta:it},me,G,h,{correct:r,correctness:d,createdUtc:new Date().toISOString()});E(N.queue),xt(N.meta);const w=N.queue[be+1];w&&ya(w,be+1)};a.useEffect(()=>{Oa(c,y).then(r=>X(r.name)).catch(()=>X(t.cogita.library.collections.defaultName))},[c,y]),a.useEffect(()=>{bs({libraryId:c,type:"language"}).then(r=>ie(r)).catch(()=>ie([]))},[c]),a.useEffect(()=>{fs({libraryId:c}).then(r=>et(r.items??[])).catch(()=>et([]))},[c]),a.useEffect(()=>{rs(c,K)},[c,K]),a.useEffect(()=>{ca(I)},[I,Tt,pt,ct,y]),a.useEffect(()=>{if(!me||!pt){P(!1);return}if(me.cardType!=="info"||bt.has(ue(me))){P(!1);return}const r=Ya(be+1);if(r>=0){P(!1),x(r);return}if(S.id==="temporal"||S.id==="levels"){const d=I.slice(0,be+1),N=I.slice(be+1).filter($t),w=d.concat(N),_=new Set(w.map(ue)),j=la(_);if(j){const L=ue(j);_.has(L)||(w.push(j),_.add(L),xt(D=>{const Z=D,ne=new Set(Z.queued??[]);return ne.add(L),{...Z,queued:ne}}))}const B=w.findIndex((L,D)=>D!==be&&$t(L));if(B>=0){E(w),x(B),P(!1);return}}P(!0)},[me,bt,pt,be,I,it,S.id]),a.useEffect(()=>{let r=!0;return(async()=>{_e("loading"),C({current:0,total:S.id==="levels"?0:S.getFetchLimit(G,h)});try{const N=[];let w=null,_=null;do{const pe=await Ra({libraryId:c,collectionId:y,limit:300,cursor:w});if(N.push(...pe.items),(S.id==="levels"||S.id==="temporal")&&pe.total&&(_=pe.total),C(de=>({current:N.length,total:de.total||pe.total||S.getFetchLimit(G,h)})),w=pe.nextCursor??null,_!==null&&N.length>=_||S.id!=="levels"&&S.id!=="temporal"&&N.length>=S.getFetchLimit(G,h))break}while(w);if(!r)return;const j=hs(N);let B;if(S.id==="levels"){const pe=Math.max(1,Number(h.levels??1)),Ie=(await Vt()).reduce((Le,He)=>{const Ye=Dt(He.itemType,He.itemId,He.checkType,He.direction);return Le[Ye]||(Le[Ye]=[]),Le[Ye].push(He),Le},{});B={},j.forEach(Le=>{const He=ue(Le),Ye=Ie[He]??[],ut=Ye.length>0?_t(Ye).score:0,ta=Math.max(1,Math.min(pe,Math.ceil(ut/100*pe)));B[He]=ta})}let L=null,D=null,Z=null;if(S.id==="temporal"){const pe=await Vt(),de=new Set(j.map(He=>ue(He))),Ie=pe.reduce((He,Ye)=>{const ut=Dt(Ye.itemType,Ye.itemId,Ye.checkType,Ye.direction);return de.has(ut)&&(He[ut]||(He[ut]=[]),He[ut].push(Ye)),He},{});L={},D=new Set,Z={};const Le=Date.now();j.forEach(He=>{const Ye=ue(He),ut=Ie[Ye]??[];if(ut.length===0){L[Ye]=0,D.add(Ye),Z[Ye]=[];return}const ta=xs(ut);Z[Ye]=ta;const bn=qa(ta,Le);L[Ye]=bn.knowness})}const ne=S.id==="levels"?ws(j,G,h,B):S.id==="temporal"?vs(j,G,h,L??{},D??new Set,Z??{}):S.prepare(j,G,h);E(ne.queue),xt(ne.meta),x(0),_e("ready"),C(pe=>({current:Math.min(pe.current,pe.total),total:pe.total}))}catch{r&&_e("error")}})(),()=>{r=!1}},[c,y,G,h,S,K]),a.useEffect(()=>{if(he(""),z(null),dt(null),nt(0),te([]),Ve({}),F({}),J(null),Pe(null),Ue(null),Ae(!1),at(!1),We(null),ge(null),R({}),!me){xe(null),Te(null),Be(null),st(null);return}me.cardType==="info"&&me.infoType==="computed"&&xe(t.cogita.library.revision.loadingComputed);let r=!0;return ya(me,be).then(d=>{!r||!d||(xe(d.prompt),Te(d.expectedAnswer),te(d.computedExpected),Ve(d.computedAnswers),Be(d.computedValues),J(d.answerTemplate),Pe(d.outputVariables),Ue(d.variableValues))}),()=>{r=!1}},[me,t]),a.useEffect(()=>{if(!me||me.cardType!=="info"||me.infoType!=="citation"){ae.current=null,Oe.current=new Set,qe(null);return}const r=me.description??"",d=(me.label??"").trim(),N=d.replace(/\s+/g," ").trim(),w=r.replace(/\s+/g," ").trim(),_=N&&N!==w?d:t.cogita.library.infoTypes.citation;if(!r){qe(null),Te(null);return}const j=ia(r);ae.current=j,xe(_);let B=!0;return oa().then(({fragmentKnowness:L})=>{if(!B)return;const D=getQuoteMode(me.direction),Z=new Set,ne={};L.forEach((Ie,Le)=>{const[He,Ye]=Le.split(":",2);if(He!==me.cardId)return;const ut=Mt(Ye);if(!ut||ut.mode!==D)return;const ta=ut.fragmentId;ne[ta]=Ie,Ie>=ct&&Z.add(ta)}),Oe.current=Z,Xe.current=ne;const pe=Mt(me.direction);if(pe!=null&&pe.fragmentId&&j.nodes[pe.fragmentId]){Bt(j,pe.fragmentId,_);return}const de=ma(j,Z,ne,ct,pt,me.direction);Bt(j,(de==null?void 0:de.id)??null,_)}).catch(()=>{Oe.current=new Set,Xe.current={};const L=Mt(me.direction);if(L!=null&&L.fragmentId&&j.nodes[L.fragmentId]){Bt(j,L.fragmentId,_);return}const D=ma(j,Oe.current,{},ct,pt,me.direction);Bt(j,(D==null?void 0:D.id)??null,_)}),()=>{B=!1}},[me,t,pt,ct]),a.useEffect(()=>{if(!me||me.cardType!=="vocab"||me.checkType!=="translation-match"){ge(null),R({});return}const N=(it.pool??it.active??I).filter(L=>L.cardType==="vocab"&&L.checkType==="translation-match").filter((L,D,Z)=>Z.findIndex(ne=>ne.cardId===L.cardId)===D);N.some(L=>L.cardId===me.cardId)||N.unshift(me);const _=Et(N).slice(0,6).map(L=>{const D=L.label.split("↔").map(pe=>pe.trim()).filter(Boolean);if(D.length<2)return null;const Z=`${L.cardId}:L`,ne=`${L.cardId}:R`;return{cardId:L.cardId,leftId:Z,rightId:ne,leftLabel:D[0],rightLabel:D[1]}}).filter(Boolean),j=_.map(L=>L.leftId),B=Et(_.map(L=>L.rightId));ge({pairs:_,leftOrder:j,rightOrder:B,selection:{},activeLeft:null,activeRight:null,locked:{}})},[me,I,it]),a.useEffect(()=>()=>{je.current&&window.clearTimeout(je.current),Re.current&&window.clearTimeout(Re.current)},[]);const Xt=a.useRef(null);a.useEffect(()=>{if(!me)return;const r=ue(me),d=typeof document<"u"?document.activeElement:null;if(Xt.current===r&&d&&(d.tagName==="INPUT"||d.tagName==="TEXTAREA"))return;let N=0;const w=()=>{if(me){if(me.cardType==="info"&&me.infoType==="computed"){if(Ke.length>0){const j=_a(re,Ke,we),B=j?Lt.current[j]:null;if(B&&(B.focus(),document.activeElement===B)){Xt.current=r;return}}if(ot.current&&(ot.current.focus(),document.activeElement===ot.current)){Xt.current=r;return}}else if(me.cardType==="vocab"&&ot.current&&(ot.current.focus(),document.activeElement===ot.current)){Xt.current=r;return}N<6&&(N+=1,window.setTimeout(w,40))}},_=window.setTimeout(w,40);return()=>window.clearTimeout(_)},[me,Ke,re,we]),a.useEffect(()=>{if(!ft)return;const r=d=>{d.key==="Enter"&&(d.preventDefault(),ha())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[ft]);const Jt=r=>{Je(r),st(_t(r))};a.useEffect(()=>{if(!me){st(null),Je([]);return}const r=me.cardType==="info"?"info":"connection";if(me.cardType==="info"&&me.infoType==="citation"){Vt().then(d=>{const N=d.filter(w=>w.itemType==="info"&&w.itemId===me.cardId&&w.checkType==="quote-fragment"&&Ba(w.direction,me.direction));Jt(N)}).catch(()=>{st(null),Je([])});return}Ka(r,me.cardId,me.checkType,me.direction).then(d=>Jt(d)).catch(()=>{st(null),Je([])})},[c,me,K]);const Ta=(r,d,N,w)=>{if(r==="info"&&N==="quote-fragment"){Vt().then(_=>{const j=_.filter(B=>B.itemType==="info"&&B.itemId===d&&B.checkType==="quote-fragment"&&Ba(B.direction,w));Jt(j)}).catch(()=>{st(null),Je([])});return}Ka(r,d,N,w).then(_=>Jt(_)).catch(()=>{st(null),Je([])})},Ca=(r,d,N)=>{var B;const w=((B=N.pairs.find(L=>L.leftId===r))==null?void 0:B.rightId)??null;if(!w)return N;const _=w===d;R(L=>({...L,[r]:_?"correct":"incorrect"})),je.current&&window.clearTimeout(je.current),Re.current&&window.clearTimeout(Re.current),O.current+=1;const j={kind:_?"correct":"incorrect",tick:O.current};if(Me(null),je.current=window.setTimeout(()=>Me(j),0),Re.current=window.setTimeout(()=>Me(null),420),_){const L={...N.locked,[r]:!0};return Object.keys(L).length>=N.pairs.length?(z("correct"),at(!0)):z("correct"),{...N,selection:{...N.selection,[r]:d},activeLeft:null,activeRight:null,locked:L}}return z("incorrect"),{...N,activeLeft:null,activeRight:null}},ua=r=>{ge(d=>!d||d.locked[r]?d:d.activeRight?Ca(r,d.activeRight,d):{...d,activeLeft:d.activeLeft===r?null:r})},Kt=r=>{ge(d=>d&&(d.activeLeft?Ca(d.activeLeft,r,d):{...d,activeRight:d.activeRight===r?null:r}))},ha=()=>{var r;if(me&&me.cardType==="info"&&me.infoType==="citation"&&ae.current&&Ne&&!((r=Mt(me.direction))!=null&&r.fragmentId)){const d=ma(ae.current,Oe.current,Xe.current,ct,pt,me.direction,Ne.fragmentId);if(d){z(null),he(""),Ae(!1),F({}),at(!1),dt(null),nt(0),Bt(ae.current,d.id,Ne.title);return}}z(null),he(""),Ae(!1),F({}),at(!1),dt(null),nt(0),x(d=>Math.min(d+1,I.length))},Rt=r=>{if(!me)return;const d=r.expected??null,N=r.answer??"";let w=d??"",_=N;if(!d&&r.expectedMap&&r.answerMap){const pe=Object.keys(r.expectedMap).sort((de,Ie)=>de.localeCompare(Ie));w=pe.map(de=>{var Ie;return((Ie=r.expectedMap)==null?void 0:Ie[de])??""}).join("|"),_=pe.map(de=>{var Ie;return((Ie=r.answerMap)==null?void 0:Ie[de])??""}).join("|")}const j=w?pa(w,_,Ct):new Uint8Array,B={revisionType:S.id,evalType:r.evalType,direction:r.direction,prompt:ve??"",expected:d,answer:N,expectedAnswers:r.expectedMap??null,answers:r.answerMap??null,correct:r.correct,maskBase64:j.length?Qt(j):null,values:U??null,checkMode:ce,compareMode:Ct,minCorrectness:Wt},L=new TextEncoder().encode(JSON.stringify(B)),D=me.cardType==="info"?"info":"connection",Z=r.overrideCheckType??me.checkType??null,ne=r.overrideDirection??me.direction??null;Fa({itemType:D,itemId:me.cardId,checkType:Z,direction:ne,revisionType:S.id,evalType:r.evalType,correct:r.correct,maskBase64:j.length?Qt(j):null,payloadBase64:Qt(L),personRoleId:K??null}).then(()=>{Ta(D,me.cardId,Z,ne),ca(I),rs(c,K)}).catch(()=>{})},Zt=(r,d)=>{const N=vt.current.get(d);if(N)return Promise.resolve(N);const w=At.current.get(d);if(w)return w;const _=Yt({libraryId:c,infoId:r}).then(j=>{var pe,de;const B=j.payload,L=((pe=B.definition)==null?void 0:pe.graph)??null,D="",Z=((de=B.definition)==null?void 0:de.answerTemplate)??"",ne=cn(L,D,Z);if(ne){const Le={sample:ln(ne),answerTemplate:Z||null};return vt.current.set(d,Le),Le}return Ss({libraryId:c,infoId:r}).then(Ie=>{const Le={sample:Ie,answerTemplate:null};return vt.current.set(d,Le),Le})}).catch(()=>Ss({libraryId:c,infoId:r}).then(j=>{const B={sample:j,answerTemplate:null};return vt.current.set(d,B),B}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{At.current.delete(d)});return At.current.set(d,_),_},ya=(r,d)=>{var L;const N=`${ue(r)}:${d}`,w=qt.current.get(N);if(w)return Promise.resolve(w);const _=zt.current.get(N);if(_)return _;const j=D=>(qt.current.set(N,D),D);let B;if(r.cardType==="vocab"){if(r.checkType==="translation-match")return B=Promise.resolve(j({prompt:r.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),B;const D=r.label.split("↔").map(Z=>Z.trim()).filter(Boolean);if(D.length>=2){const ne=(r.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",pe=ne?D[0]:D[1],de=ne?D[1]:D[0];B=Promise.resolve(j({prompt:pe,expectedAnswer:de,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else B=Promise.resolve(j({prompt:r.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(r.cardType==="info"&&r.infoType==="word"){const D=(L=r.description)!=null&&L.startsWith("Language: ")?r.description.replace("Language: ",""):null;B=Promise.resolve(j({prompt:r.label,expectedAnswer:D,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else r.cardType==="info"&&r.infoType==="computed"?B=Zt(r.cardId,N).then(D=>{var Ie,Le;if(!D.sample)return j({prompt:r.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const Z=D.sample,ne=Z.expectedAnswers?Object.entries(Z.expectedAnswers).map(([He,Ye])=>({key:He,expected:Ye})):[],pe=ne.reduce((He,Ye)=>(He[Ye.key]="",He),{}),de=Z.expectedAnswerIsSentence&&((Ie=Z.expectedAnswer)==null?void 0:Ie.trim())||null;return j({prompt:Z.prompt,expectedAnswer:ne.length>0?de:((Le=Z.expectedAnswer)==null?void 0:Le.trim())||null,computedExpected:ne,computedAnswers:pe,computedValues:Z.values??null,answerTemplate:D.answerTemplate,outputVariables:Z.outputVariables??null,variableValues:Z.variableValues??null})}).catch(()=>j({prompt:r.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{zt.current.delete(N)}):B=Promise.resolve(j({prompt:r.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return zt.current.set(N,B),B},Bt=(r,d,N)=>{const w=Object.keys(r.nodes).length,_=Oe.current.size;if(!d){qe({title:N,before:r.text,after:"",fragmentId:null,total:w,completed:_}),Te(null),at(!0);return}const j=r.nodes[d];if(!j)return;const B=ys(r.text,j);qe({title:N,before:B.before,after:B.after,fragmentId:j.id,total:w,completed:_}),Te(B.fragment),at(!1)},Ma=()=>{const r=ae.current;r&&qe(d=>d&&{...d,total:Object.keys(r.nodes).length,completed:Oe.current.size})},ga=()=>{const r=I[be+1];r&&ya(r,be+1)},Ia=()=>{if(ga(),me&&me.cardType==="vocab"&&me.checkType==="translation-match"&&Y){if(Y.pairs.length===0){z("incorrect"),at(!0);return}const j=Y.pairs.reduce((de,Ie)=>(de[Ie.rightId]=Ie.rightLabel,de),{});let B=0;const L={};Y.pairs.forEach(de=>{const Le=Y.selection[de.leftId]===de.rightId;L[de.leftId]=Le?"correct":"incorrect",Le&&(B+=1)});const D=Y.pairs.length||1,Z=B/D,ne=B===Y.pairs.length;R(de=>({...de,...L})),ne?(z("correct"),at(!0),nt(0)):(z("incorrect"),at(!1),nt(de=>{const Ie=de+1;return Ie>=wt&&(Ae(!0),at(!0),ge(Le=>{if(!Le)return Le;const He=Le.pairs.reduce((Ye,ut)=>(Ye[ut.leftId]=ut.rightId,Ye),{});return{...Le,selection:He}})),Ie})),kt(ne,Z);const pe="connection";Promise.all(Y.pairs.map(de=>{const Ie=Y.selection[de.leftId]??null,Le=Ie?j[Ie]:"",He={left:de.leftLabel,expected:de.rightLabel,answer:Le,checkType:"translation-match"},Ye=new TextEncoder().encode(JSON.stringify(He));return Fa({itemType:pe,itemId:de.cardId,checkType:"translation-match",direction:null,revisionType:S.id,evalType:"translation-match",correct:Ie===de.rightId,maskBase64:null,payloadBase64:Qt(Ye),personRoleId:K??null})})).then(()=>{Ta(pe,me.cardId,me.checkType,me.direction),rs(c,K)}).catch(()=>{});return}if(Ke.length>0){const j=Ke.reduce((L,D)=>{const Z=Ce[D.key]??"";return L[D.key]=Nt(Z)===Nt(D.expected)?"correct":"incorrect",L},{});Ke.every(({key:L,expected:D})=>{const Z=Ce[L]??"";return ce==="exact"&&Nt(Z)===Nt(D)})?(z("correct"),F(j),at(!0),nt(0),kt(!0,1),Rt({correct:!0,direction:ve?`${ve} -> computed`:"computed",expectedMap:Ke.reduce((L,D)=>(L[D.key]=D.expected,L),{}),answerMap:Ce,evalType:"computed"})):(z("incorrect"),F(j),at(!1),nt(L=>{const D=L+1;return D>=wt&&q&&(Ae(!0),at(!0)),D}),kt(!1,0),window.setTimeout(()=>{var D;const L=_a(re,Ke,we);L&&Lt.current[L]&&((D=Lt.current[L])==null||D.focus())},40),Rt({correct:!1,direction:ve?`${ve} -> computed`:"computed",expectedMap:Ke.reduce((L,D)=>(L[D.key]=D.expected,L),{}),answerMap:Ce,evalType:"computed"}));return}if(me&&me.cardType==="info"&&me.infoType==="citation"&&(Ne!=null&&Ne.fragmentId)){if(!ke)return;const j=Mt(me.direction),B=(j==null?void 0:j.mode)??getQuoteMode(me.direction),L=j!=null&&j.fragmentId&&me.direction?me.direction:Na(B,Ne.fragmentId),D=mn(ke,V,Ct),Z=ce==="exact"&&fa(V)===fa(ke),ne=Ht(D),pe=Z||ne,de=Gt(D);pe?(Xe.current[Ne.fragmentId]=Math.max(Xe.current[Ne.fragmentId]??0,de),(Xe.current[Ne.fragmentId]??0)>=ct&&Oe.current.add(Ne.fragmentId),Ma(),z("correct"),F({}),at(!0),dt(D),nt(0),de<100&&wt<=1&&Ae(!0),kt(!0,de/100),Rt({correct:!0,direction:`quote:${Ne.fragmentId}`,expected:ke,answer:V,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L})):(z("incorrect"),F({}),at(!1),dt(D),nt(Ie=>{const Le=Ie+1;return Le>=wt&&q&&(Ae(!0),at(!0)),Le}),kt(!1,de/100),window.setTimeout(()=>{var Ie;return(Ie=ot.current)==null?void 0:Ie.focus()},40),Rt({correct:!1,direction:`quote:${Ne.fragmentId}`,expected:ke,answer:V,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L}));return}if(!ke)return;const r=pa(ke,V,Ct),d=ce==="exact"&&Nt(V)===Nt(ke),N=Ht(r),w=d||N,_=Gt(r);w?(z("correct"),F({}),at(!0),dt(r),nt(0),_<100&&wt<=1&&Ae(!0),kt(!0,_/100),Rt({correct:!0,direction:ve?`${ve} -> ${ke}`:null,expected:ke,answer:V,evalType:"text"})):(z("incorrect"),F({}),at(!1),dt(r),nt(j=>{const B=j+1;return B>=wt&&q&&(Ae(!0),at(!0)),B}),kt(!1,_/100),window.setTimeout(()=>{var j;return(j=ot.current)==null?void 0:j.focus()},40),Rt({correct:!1,direction:ve?`${ve} -> ${ke}`:null,expected:ke,answer:V,evalType:"text"}))},Ga=r=>{if(ga(),!ke)return;const d=pa(ke,r,Ct),N=Nt(r)===Nt(ke),w=Ht(d),_=N||w,j=Gt(d);_?(z("correct"),F({}),at(!0),dt(d),nt(0),j<100&&wt<=1&&Ae(!0),kt(!0,j/100),Rt({correct:!0,direction:"word->language",expected:ke,answer:r,evalType:"language-select"})):(z("incorrect"),F({}),at(!1),dt(d),nt(B=>{const L=B+1;return L>=wt&&q&&(Ae(!0),at(!0)),L}),kt(!1,j/100),Rt({correct:!1,direction:"word->language",expected:ke,answer:r,evalType:"language-select"}))},Xa=()=>{ga(),z("correct"),at(!0),nt(0),kt(!0,1),ke&&Rt({correct:!0,direction:"manual",expected:ke,answer:V,evalType:"manual"})},Ja=()=>{if(kt(!1,0),me&&me.cardType==="info"&&me.infoType==="citation"){z(null),he(""),Ae(!1),F({}),at(!1),dt(null),nt(0),x(r=>Math.min(r+1,I.length));return}ha()};a.useEffect(()=>{ga()},[be,I]);const ea=r=>{var N;if(r.key!=="Enter")return;if(r.preventDefault(),r.stopPropagation(),ft){ha();return}const d=Ke.find(w=>!(Ce[w.key]??"").trim());if(d){(N=Lt.current[d.key])==null||N.focus();return}Ia()},M=t.cogita.library.revision.revealModeAfterIncorrect,q=Ke.length>0||!!ke;return e.jsxs(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:[ee==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${fe.total?Math.min(100,Math.max(0,fe.current/fe.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:fe.total?`${Math.min(fe.current,fe.total)} / ${fe.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:$}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",b).replace("{check}",H)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:k,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${k}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${k}/collections/${y}`,children:t.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Se?`${Se.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ft?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Ft.currentLevel??"-"," / ",Ft.levelsCount]}):null,Se?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(Se.correct)).replace("{total}",String(Se.total))}),Se.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(Se.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(un,{outcomes:Qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[rt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:rt})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":ye?`${ye.kind}-${ye.tick}`:le?"idle":Q??"idle",children:me?e.jsx(e.Fragment,{children:p?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(dn,{copy:t,currentCard:me,currentTypeLabel:Pt,prompt:ve,languages:se,answer:V,onAnswerChange:r=>he(d=>Da(d,r,Fe)),computedExpected:Ke,computedAnswers:Ce,onComputedAnswerChange:(r,d)=>Ve(N=>({...N,[r]:Da(N[r]??"",d,Fe)})),answerTemplate:re,outputVariables:we,variableValues:De,computedFieldFeedback:ze,feedback:Q,canAdvance:ft,quoteContext:Ne,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ia,onSkip:Ja,onLanguageSelect:Ga,onMarkReviewed:Xa,onAdvance:ha,showCorrectAnswer:$e,setShowCorrectAnswer:Ae,onRevealCorrect:()=>at(!0),answerMask:lt,expectedAnswer:ke,hasExpectedAnswer:q,handleComputedKeyDown:ea,answerInputRef:ot,computedInputRefs:Lt,scriptMode:Fe,setScriptMode:We,matchPairs:Y==null?void 0:Y.pairs,matchLeftOrder:Y==null?void 0:Y.leftOrder,matchRightOrder:Y==null?void 0:Y.rightOrder,matchSelection:Y==null?void 0:Y.selection,matchActiveLeft:Y==null?void 0:Y.activeLeft,matchActiveRight:Y==null?void 0:Y.activeRight,matchFeedback:Ee,onMatchLeftSelect:ua,onMatchRightSelect:Kt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${k}/collections/${y}`,children:t.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Ut?`${mt} / ${Ut}`:t.cogita.library.revision.progressUnlimited}),ee==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),ee==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),ee==="ready"&&I.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:M}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",wt]})]})]}),Ft?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Ft.activeCount," / ",Ft.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ft.counts.map((r,d)=>{const N=d+1,w=Ft.currentLevel===N,_=Ft.percentages[d]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":w,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:N}),e.jsx("strong",{children:r})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,_))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[_.toFixed(1),"%"]})]},`level-${N}`)})})]}):null,jt?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:jt.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:jt.dots.map(r=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,r.value*100))}%`,background:`rgba(${Math.round(255*(1-r.value))}, ${Math.round(200*r.value)}, 80, 0.9)`}},r.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:jt.knownCount})]})]}):null,pt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:da})]})}):null]})]})]})})})]})]})}const os=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],Qi={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Yi=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Gi=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Xi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:c,collectionId:y}){const[l,u]=a.useState(""),[k,oe,G]=Vs([]),[W,S,h]=Os([]),[ce,K]=a.useState(null),[b,H]=a.useState(null),[$,X]=a.useState(null),I=`/#/cogita/library/${c}`;a.useEffect(()=>{Oa(c,y).then(C=>u(C.name)).catch(()=>u(t.cogita.library.collections.defaultName))},[c,y,t]),a.useEffect(()=>{Fn({libraryId:c,collectionId:y}).then(C=>{if(!C.graphId||C.graphId==="00000000-0000-0000-0000-000000000000"){oe([]),S([]);return}const be=C.nodes.map(V=>{var ve;const he=V.payload??{},Q=he.position??{x:120,y:120},z=he.params??{};return{id:V.nodeId,type:"default",position:Q,data:{nodeType:V.nodeType,label:((ve=os.find(xe=>xe.type===V.nodeType))==null?void 0:ve.label)??V.nodeType,params:z}}}),x=C.edges.map(V=>({id:V.edgeId,source:V.fromNodeId,target:V.toNodeId,sourceHandle:V.fromPort??void 0,targetHandle:V.toPort??void 0}));oe(be),S(x)}).catch(()=>{oe([]),S([])})},[c,y,S,oe]);const E=a.useMemo(()=>k.find(C=>C.id===ce)??null,[k,ce]),se=C=>{var he;const be=crypto.randomUUID(),x=((he=os.find(Q=>Q.type===C))==null?void 0:he.label)??C,V={...Qi[C]};oe(Q=>[...Q,{id:be,type:"default",position:{x:120+Q.length*40,y:120+Q.length*40},data:{nodeType:C,label:x,params:V}}]),K(be)},ie=a.useCallback(C=>{S(be=>qs({...C,id:crypto.randomUUID()},be))},[S]),ee=async()=>{H(null);try{await zn({libraryId:c,collectionId:y,nodes:k.map(C=>({nodeId:C.id,nodeType:C.data.nodeType,payload:{position:C.position,params:C.data.params}})),edges:W.map(C=>({edgeId:C.id,fromNodeId:C.source,fromPort:C.sourceHandle??null,toNodeId:C.target,toPort:C.targetHandle??null}))}),H(t.cogita.library.graph.saveSuccess)}catch{H(t.cogita.library.graph.saveFail)}},_e=async()=>{try{const C=await Kn({libraryId:c,collectionId:y});X(C)}catch{X(null)}},fe=C=>{E&&oe(be=>be.map(x=>x.id===E.id?{...x,data:{...x.data,params:C}}:x))};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${I}/collections/${y}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:_e,children:t.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ee,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:os.map(C=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>se(C.type),children:C.label},C.type))}),b?e.jsx("p",{className:"cogita-help",children:b}):null,$&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String($.total))}),e.jsx("p",{children:t.cogita.library.graph.previewBreakdown.replace("{connections}",String($.connections)).replace("{infos}",String($.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(gs,{nodes:k,edges:W,onNodesChange:G,onEdgesChange:h,onConnect:ie,onNodeClick:(C,be)=>K(be.id),fitView:!0,children:[e.jsx(ms,{color:"rgba(120,160,200,0.2)"}),e.jsx(ps,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),E?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:E.data.label}),E.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(na,{libraryId:c,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:E.data.params.tagId?{id:E.data.params.tagId,label:E.data.params.tagLabel??"",infoType:"topic"}:null,onChange:C=>fe({...E.data.params,tagId:(C==null?void 0:C.id)??null,tagLabel:(C==null?void 0:C.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:E.data.params.scope??"any",onChange:C=>fe({...E.data.params,scope:C.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),E.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(na,{libraryId:c,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:E.data.params.languageId?{id:E.data.params.languageId,label:E.data.params.languageLabel??"",infoType:"language"}:null,onChange:C=>fe({...E.data.params,languageId:(C==null?void 0:C.id)??null,languageLabel:(C==null?void 0:C.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:E.data.params.scope??"any",onChange:C=>fe({...E.data.params,scope:C.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),E.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:E.data.params.infoType??"word",onChange:C=>fe({...E.data.params,infoType:C.target.value}),children:Gi.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))})]}),e.jsx(na,{libraryId:c,infoType:E.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:E.data.params.infoId?{id:E.data.params.infoId,label:E.data.params.infoLabel??"",infoType:E.data.params.infoType??"word"}:null,onChange:C=>fe({...E.data.params,infoId:(C==null?void 0:C.id)??null,infoLabel:(C==null?void 0:C.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),E.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:E.data.params.connectionType??"translation",onChange:C=>fe({...E.data.params,connectionType:C.target.value}),children:Yi.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:E.data.params.connectionId??"",onChange:C=>fe({...E.data.params,connectionId:C.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(E.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const cs="cogita.preferences",fn=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],ls={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ds=["settings","run","shared"];function Ji(t,s=""){const n=t.split("/").filter(Boolean);if(n[0]!=="cogita"||n[1]!=="library")return{};const i=n[2];if(!i)return{};if(!n[3])return{libraryId:i,target:"library_overview"};const o=new URLSearchParams(s),m=o.get("revisionId")??void 0,f=o.get("infoId")??void 0,v=o.get("infoView")==="cards"?"cards":"overview",A=o.get("collectionAction"),T=o.get("libraryAction");if(n[3]==="list")return{libraryId:i,target:T==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:m,infoId:f,infoView:v,libraryAction:T==="new-info"?"new-info":void 0};if(n[3]==="detail"||n[3]==="collection")return{libraryId:i,target:"all_cards",cardMode:n[3],revisionId:m,infoId:f,infoView:v};if(n[3]==="new"||n[3]==="add")return{libraryId:i,target:"new_card",revisionId:m,libraryAction:"new-info"};if(n[3]==="edit")return{libraryId:i,target:"new_card",revisionId:m,infoId:n[4]};if(n[3]==="infos"){const y=n[4];return y?n[5]==="checkcards"?{libraryId:i,target:"all_cards",cardMode:"list",revisionId:m,infoId:y,infoView:"cards"}:{libraryId:i,target:"all_cards",cardMode:"list",revisionId:m,infoId:y,infoView:"overview"}:{libraryId:i,target:"all_cards",cardMode:"list",revisionId:m}}if(n[3]==="shared-revisions")return{libraryId:i,target:"all_collections",revisionId:m};if(n[3]==="dependencies")return{libraryId:i,target:"dependencies"};if(n[3]==="transfer")return{libraryId:i,target:"transfer"};if(n[3]==="storyboards")return n[4]==="new"?{libraryId:i,target:"new_storyboard"}:{libraryId:i,target:"storyboards"};if(n[3]==="texts")return n[4]==="new"?{libraryId:i,target:"new_text"}:{libraryId:i,target:"texts"};if(n[3]!=="collections")return{libraryId:i,target:"library_overview"};if(n[4]==="new")return{libraryId:i,target:"new_collection",revisionId:m};const c=n[4];return c?n[5]==="graph"?{libraryId:i,target:"all_collections",collectionId:c,revisionId:m,revisionView:"graph"}:n[5]==="shared-revisions"?{libraryId:i,target:"all_collections",collectionId:c,revisionId:m,revisionView:"shared"}:n[5]==="revision"?{libraryId:i,target:"all_collections",collectionId:c,revisionId:m,revisionView:n[6]==="run"?"run":"settings"}:A==="new-revision"?{libraryId:i,target:"all_collections",collectionId:c,revisionId:m,revisionView:"new"}:{libraryId:i,target:"all_collections",collectionId:c,revisionId:m,revisionView:"detail"}:A==="new-collection"?{libraryId:i,target:"new_collection",collectionAction:"new-collection"}:{libraryId:i,target:"all_collections"}}function Ds(t,s="library_overview",n,i,o,m,f="overview"){const v=(A,T)=>{const c=new URLSearchParams;T!=null&&T.revisionId&&c.set("revisionId",T.revisionId),T!=null&&T.collectionAction&&c.set("collectionAction",T.collectionAction),T!=null&&T.libraryAction&&c.set("libraryAction",T.libraryAction),T!=null&&T.infoId&&c.set("infoId",T.infoId),T!=null&&T.infoView&&(T!=null&&T.infoId)&&c.set("infoView",T.infoView);const y=c.toString();return y?`${A}?${y}`:A};return t?s==="library_overview"?v(`/cogita/library/${t}`,{revisionId:o}):s==="all_cards"?m?f==="cards"?v(`/cogita/library/${t}/infos/${m}/checkcards`,{revisionId:o}):v(`/cogita/library/${t}/infos/${m}`,{revisionId:o}):v(`/cogita/library/${t}/list`,{revisionId:o,infoId:m,infoView:f}):s==="new_card"?m?v(`/cogita/library/${t}/edit/${m}`,{revisionId:o}):v(`/cogita/library/${t}/list`,{revisionId:o,libraryAction:"new-info"}):s==="all_collections"?n?i==="graph"?v(`/cogita/library/${t}/collections/${n}/graph`,{revisionId:o}):i==="settings"?v(`/cogita/library/${t}/collections/${n}/revision`,{revisionId:o}):i==="run"?v(`/cogita/library/${t}/collections/${n}/revision/run`,{revisionId:o}):i==="shared"?v(`/cogita/library/${t}/collections/${n}/shared-revisions`,{revisionId:o}):i==="new"?v(`/cogita/library/${t}/collections/${n}`,{revisionId:o,collectionAction:"new-revision"}):v(`/cogita/library/${t}/collections/${n}`,{revisionId:o}):v(`/cogita/library/${t}/collections`,{revisionId:o}):s==="new_collection"?v(`/cogita/library/${t}/collections`,{revisionId:o,collectionAction:"new-collection"}):s==="transfer"?v(`/cogita/library/${t}/transfer`,{revisionId:o}):s==="storyboards"?v(`/cogita/library/${t}/storyboards`,{revisionId:o}):s==="new_storyboard"?v(`/cogita/library/${t}/storyboards/new`,{revisionId:o}):s==="texts"?v(`/cogita/library/${t}/texts`,{revisionId:o}):s==="new_text"?v(`/cogita/library/${t}/texts/new`,{revisionId:o}):s==="dependencies"?v(`/cogita/library/${t}/dependencies`,{revisionId:o}):v(`/cogita/library/${t}`,{revisionId:o}):"/cogita"}function va(t){return t.length>1&&t.endsWith("/")?t.slice(0,-1):t}function Zi(t){return typeof t=="string"&&fn.includes(t)}function er(t,s){var v;if(!t.length)return null;const n=t.filter(A=>s.has(A.roleId)),i=n.length>0?n:t,o=i.map(A=>{var c,y;const T=((y=(c=A.fields.find(l=>l.fieldType==="role_kind"))==null?void 0:c.plainValue)==null?void 0:y.toLowerCase())??"";return{roleId:A.roleId,roleKind:T}}),m=o.find(A=>A.roleKind.includes("master"));if(m)return m.roleId;const f=o.find(A=>A.roleKind.includes("account")||A.roleKind.includes("user"));return f?f.roleId:((v=i[0])==null?void 0:v.roleId)??null}function tr(t){if(!t)return{version:1,byLibrary:{}};try{const s=JSON.parse(t);return!s||typeof s!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:s.lastLibraryId,byLibrary:s.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function ar({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T}){const c=_s(),y=Va(),l=a.useMemo(()=>Ji(y.pathname,y.search),[y.pathname,y.search]),u=t.cogita.workspace,[k,oe]=a.useState([]),[G,W]=a.useState([]),[S,h]=a.useState([]),[ce,K]=a.useState([]),[b,H]=a.useState(void 0),[$,X]=a.useState("library_overview"),[I,E]=a.useState(void 0),[se,ie]=a.useState(void 0),[ee,_e]=a.useState("detail"),[fe,C]=a.useState(void 0),[be,x]=a.useState(!1),[V,he]=a.useState(!0),[Q,z]=a.useState(!1),[ve,xe]=a.useState(!1),[ke,Te]=a.useState(null),[Ne,qe]=a.useState(0),[Ke,te]=a.useState(""),[Ce,Ve]=a.useState(""),[ze,F]=a.useState(""),[U,Be]=a.useState(null),[re,J]=a.useState(null),we=a.useRef({version:1,byLibrary:{}}),Pe=a.useRef(!1),De=a.useRef(!1),Ue=a.useRef(null),Y=a.useMemo(()=>k.find(g=>g.libraryId===b)??null,[k,b]),ge=a.useMemo(()=>G.find(g=>g.collectionId===I)??null,[G,I]),Ee=a.useMemo(()=>ce.find(g=>g.revisionId===se)??null,[ce,se]),R=a.useMemo(()=>({detail:u.revisions.detail,graph:u.revisions.graph,settings:u.revisions.settings,run:u.revisions.run,shared:u.targets.sharedRevisions,new:u.revisionForm.createAction}),[u.revisions.detail,u.revisions.graph,u.revisions.run,u.revisions.settings,u.targets.sharedRevisions,u.revisionForm.createAction]),O=a.useMemo(()=>[{value:"detail",label:R.detail},{value:"graph",label:R.graph},{value:"settings",label:u.targets.allRevisions},{value:"run",label:R.run},{value:"shared",label:R.shared}],[R.detail,R.graph,R.run,R.shared,u.targets.allRevisions]),ye=a.useMemo(()=>$==="new_card"?"all_cards":$==="new_collection"?"all_collections":$==="new_storyboard"?"storyboards":$==="new_text"?"texts":$,[$]),Me=a.useMemo(()=>ee==="new"?"settings":ee,[ee]),je=a.useMemo(()=>l.infoId?"selected":$==="new_card"?"create":"search",[l.infoId,$]),Re=a.useMemo(()=>S.find(g=>g.infoId===l.infoId)??null,[S,l.infoId]),Fe=a.useMemo(()=>({library_overview:u.targets.libraryOverview,all_cards:u.targets.allCards,new_card:u.targets.newCard,all_collections:u.targets.allCollections,new_collection:u.targets.newCollection,transfer:u.targets.transfer,storyboards:u.targets.storyboards,new_storyboard:u.targets.newStoryboard,texts:u.targets.texts,new_text:u.targets.newText,dependencies:u.targets.dependencies}),[u.targets]),We=a.useMemo(()=>Fe[ye]??ye,[ye,Fe]),$e=R[Me],Ae=!!b,Se=a.useMemo(()=>{const g=A==="pl"?"Ruch na teraz: utwórz bibliotekę i wpisz pierwszy element wiedzy.":A==="de"?"Nächster Schritt: Erstelle eine Bibliothek und füge den ersten Wissenseintrag hinzu.":"Next action: create one library and add your first knowledge item.";return A==="pl"?[{step:"Krok 1",title:"Czym jest Cogita?",lead:"To centrum budowania i prowadzenia procesu nauki po zalogowaniu.",passages:["W jednym miejscu łączysz treści, ćwiczenia i współpracę zespołu.","Zamiast luźnych notatek dostajesz spójny przepływ: biblioteka → kolekcja → powtórka."],focus:["Jedna przestrzeń robocza","Spójny proces"],action:g},{step:"Krok 2",title:"Zacznij od biblioteki",lead:"Biblioteka jest bazą dla całego tematu.",passages:["Nazwij bibliotekę jasno: np. „Historia Kościoła – semestr 1”.","Każdy kolejny moduł korzysta z tej samej biblioteki jako źródła."],focus:["Nazwa tematyczna","Jeden punkt startowy"],action:g},{step:"Krok 3",title:"Dodawaj informacje",lead:"Twórz krótkie, konkretne jednostki wiedzy.",passages:["Wpisy typu info opisują pojęcia, osoby, źródła i cytaty.","Małe jednostki łatwiej łączyć, powtarzać i aktualizować."],focus:["Krótko i konkretnie","Łatwe aktualizacje"],action:g},{step:"Krok 4",title:"Pracuj na typach",lead:"Formularze dostosowują się do rodzaju informacji.",passages:["Każdy typ pokazuje właściwe pola i porządkuje dane.","To zmniejsza chaos i poprawia jakość wyszukiwania."],focus:["Lepsza struktura","Mniej błędów"],action:g},{step:"Krok 5",title:"Łącz wiedzę linkami",lead:"Buduj kontekst przez relacje między wpisami.",passages:["Połącz temat z definicją, źródłem i przykładem.","Graf relacji pomaga zobaczyć, czego brakuje przed kolejnym etapem."],focus:["Relacje między wpisami","Pełniejszy kontekst"],action:g},{step:"Krok 6",title:"Twórz kolekcje celu",lead:"Kolekcja grupuje wpisy pod konkretny scenariusz.",passages:["Osobna kolekcja dla lekcji, osobna dla quizu lub egzaminu.","Nie duplikujesz treści — tylko wybierasz, co jest potrzebne."],focus:["Celowe grupowanie","Bez duplikatów"],action:g},{step:"Krok 7",title:"Dodawaj powtórki",lead:"Powtórka definiuje jak przebiega sprawdzanie.",passages:["Ustaw tempo, kolejność i zakres materiału.","Dla jednej kolekcji możesz mieć kilka powtórek o różnych poziomach."],focus:["Kontrola tempa","Różne poziomy"],action:g},{step:"Krok 8",title:"Info vs karta",lead:"Rozróżniaj źródło wiedzy i widok ćwiczeniowy.",passages:["Info to rekord bazowy, który przechowuje treść.","Karta to forma pytania/utrwalenia generowana z info."],focus:["Źródło danych","Widok ćwiczeń"],action:g},{step:"Krok 9",title:"Uruchamiaj sesję",lead:"Tryb Run prowadzi uczestników krok po kroku.",passages:["Prowadzący kontroluje rytm i przejścia między etapami.","Uczestnicy mają jasny przebieg bez zgadywania, co dalej."],focus:["Płynny przebieg","Lepsza dynamika grupy"],action:g},{step:"Krok 10",title:"Czytaj graf zależności",lead:"Graf pokazuje priorytety nauki.",passages:["Węzły centralne oznaczają tematy, które wpływają na wiele innych.","Najpierw utrwal fundamenty, potem przechodź do warstw zaawansowanych."],focus:["Priorytety materiału","Lepsza kolejność"],action:g},{step:"Krok 11",title:"Storyboard i teksty",lead:"Plan i notatki trzymaj blisko wiedzy źródłowej.",passages:["Storyboard układa narrację i przebieg spotkania.","Teksty zbierają komentarze, wnioski i gotowe treści do publikacji."],focus:["Lepsze przygotowanie","Notatki w kontekście"],action:g},{step:"Krok 12",title:"Udostępniaj bezpiecznie",lead:"Dziel się materiałem bez utraty kontroli.",passages:["Możesz dać dostęp tylko do odczytu dla wybranych osób.","Edycja pozostaje po stronie autora lub zespołu prowadzącego."],focus:["Kontrola uprawnień","Bezpieczne współdzielenie"],action:g},{step:"Krok 13",title:"Nawiguj warstwowo",lead:"Sidebar i breadcrumb prowadzą przez poziomy.",passages:["Zawsze widzisz, czy pracujesz na bibliotece, kolekcji czy powtórce.","Mniej kliknięć „w ciemno”, więcej świadomej nawigacji."],focus:["Orientacja w systemie","Szybsze decyzje"],action:g},{step:"Krok 14",title:"Plan wdrożenia 30 minut",lead:"Najpierw prosty pilot, potem rozwijaj.",passages:["Plan: 1 biblioteka, 10 wpisów info, 1 kolekcja, 1 powtórka testowa.","Po pierwszej sesji popraw strukturę i dodaj kolejne scenariusze."],focus:["Szybki start","Iteracyjne doskonalenie"],action:"Gotowe? Załóż bibliotekę po prawej i przejdź do pierwszego wpisu."}]:A==="de"?[{step:"Schritt 1",title:"Was ist Cogita?",lead:"Ein zentraler Workspace für Lernen und Moderation nach dem Login.",passages:["Du verbindest Inhalte, Übungen und Teamarbeit in einem Ablauf.","Der Prozess bleibt klar: Bibliothek → Sammlung → Wiederholung."],focus:["Ein Workspace","Klarer Ablauf"],action:g},{step:"Schritt 2",title:"Mit Bibliothek starten",lead:"Die Bibliothek ist der Startpunkt für dein Thema.",passages:["Vergib einen klaren Namen für Kurs oder Modul.","Alle weiteren Bereiche greifen auf diese Basis zu."],focus:["Sauberer Start","Gemeinsame Basis"],action:g},{step:"Schritt 3",title:"Infos anlegen",lead:"Erfasse Wissen in kleinen, klaren Einträgen.",passages:["Info-Einträge enthalten Begriffe, Personen, Quellen und Zitate.","Kleinere Einheiten lassen sich besser verknüpfen und trainieren."],focus:["Kleine Einheiten","Leicht wartbar"],action:g},{step:"Schritt 4",title:"Typbasierte Eingabe",lead:"Formulare passen sich automatisch dem Info-Typ an.",passages:["Dadurch bleiben Daten strukturiert und konsistent.","Das verbessert Qualität und Auffindbarkeit."],focus:["Konsistenz","Bessere Suche"],action:g},{step:"Schritt 5",title:"Wissen verlinken",lead:"Verbinde Einträge zu einem Kontextnetz.",passages:["Thema, Quelle und Beispiel werden als Beziehung sichtbar.","So erkennst du Lücken vor der nächsten Lernphase."],focus:["Kontextnetz","Lücken erkennen"],action:g},{step:"Schritt 6",title:"Ziel-Sammlungen bauen",lead:"Eine Sammlung bündelt Inhalte für einen konkreten Zweck.",passages:["Nutze getrennte Sammlungen für Unterricht, Quiz oder Prüfung.","Du wählst Inhalte aus statt sie zu kopieren."],focus:["Zielorientierung","Keine Duplikate"],action:g},{step:"Schritt 7",title:"Wiederholungen erstellen",lead:"Wiederholungen definieren den Prüfungsablauf.",passages:["Tempo, Reihenfolge und Umfang sind pro Wiederholung steuerbar.","Mehrere Wiederholungen pro Sammlung sind möglich."],focus:["Ablaufsteuerung","Mehrere Niveaus"],action:g},{step:"Schritt 8",title:"Info und Karte",lead:"Datenobjekt und Trainingsansicht sind getrennt.",passages:["Info ist die Quelle der Inhalte.","Die Karte ist die Übungsansicht für Frage und Antwort."],focus:["Sauberes Modell","Wiederverwendbar"],action:g},{step:"Schritt 9",title:"Sitzung durchführen",lead:"Im Run-Modus führst du die Gruppe Schritt für Schritt.",passages:["Moderation steuert Übergänge und Timing.","Teilnehmende folgen einem klaren Ablauf."],focus:["Klare Moderation","Stabile Dynamik"],action:g},{step:"Schritt 10",title:"Abhängigkeitsgraph lesen",lead:"Der Graph zeigt Lernprioritäten.",passages:["Zentrale Knoten beeinflussen viele weitere Themen.","Starte mit Grundlagen und baue danach auf."],focus:["Priorisierung","Lernreihenfolge"],action:g},{step:"Schritt 11",title:"Storyboard & Texte",lead:"Plane Ablauf und sammle Notizen im selben Kontext.",passages:["Storyboards strukturieren Sequenzen und Rollen.","Texte halten Erkenntnisse und veröffentlichungsreife Inhalte fest."],focus:["Planung","Dokumentation"],action:g},{step:"Schritt 12",title:"Sicher teilen",lead:"Teile Inhalte ohne Kontrollverlust.",passages:["Leserechte sind separat von Bearbeitungsrechten steuerbar.","So bleibt der Kernbestand geschützt."],focus:["Rechtekontrolle","Sicheres Teilen"],action:g},{step:"Schritt 13",title:"Ebenen-Navigation",lead:"Sidebar und Breadcrumb zeigen deinen aktuellen Kontext.",passages:["Du siehst sofort, auf welcher Ebene du arbeitest.","Das spart Zeit und reduziert Fehlklicks."],focus:["Orientierung","Effizienz"],action:g},{step:"Schritt 14",title:"30-Minuten-Startplan",lead:"Starte klein und erweitere iterativ.",passages:["Plan: 1 Bibliothek, 10 Infos, 1 Sammlung, 1 Test-Wiederholung.","Nach der ersten Runde verbesserst du Struktur und Ablauf."],focus:["Schneller Einstieg","Iteratives Vorgehen"],action:"Jetzt starten: Bibliothek rechts anlegen und den ersten Eintrag erfassen."}]:[{step:"Step 1",title:"What is Cogita?",lead:"A post-login workspace to design, run, and improve knowledge journeys.",passages:["You can keep content, training flow, and collaboration in one place.","The path stays explicit: library → collection → revision → session."],focus:["Single workspace","Clear learning flow"],action:g},{step:"Step 2",title:"Start with a library",lead:"Your library is the root container for one domain or program.",passages:["Name it after your course, cohort, or topic scope.","Every next module reuses this foundation."],focus:["Root container","Consistent base"],action:g},{step:"Step 3",title:"Add information units",lead:"Build knowledge from small, reusable info entries.",passages:["Capture terms, references, people, concepts, and citations.","Smaller entries are easier to link, review, and update."],focus:["Reusable units","Easy maintenance"],action:g},{step:"Step 4",title:"Use type-based forms",lead:"Each info type has a matching data structure and fields.",passages:["Form layouts adapt automatically to the selected type.","This improves consistency and lowers input mistakes."],focus:["Structured input","Fewer errors"],action:g},{step:"Step 5",title:"Link the knowledge graph",lead:"Relationships turn isolated facts into usable context.",passages:["Connect topics, sources, and supporting examples.","Dependency links show what must be learned first."],focus:["Context building","Better sequencing"],action:g},{step:"Step 6",title:"Build goal collections",lead:"Collections package selected infos for a concrete objective.",passages:["Create separate collections for class, quiz, exam, or workshop.","You curate from existing entries instead of duplicating content."],focus:["Goal-oriented sets","No duplication"],action:g},{step:"Step 7",title:"Create revisions",lead:"Revisions define how practice and checking should run.",passages:["Set pacing, order, and scope for each session style.","One collection can host multiple revision strategies."],focus:["Practice design","Multiple modes"],action:g},{step:"Step 8",title:"Understand info vs card",lead:"Data objects and practice views are intentionally separate.",passages:["Info is the canonical source object.","Card is the generated training/checking view."],focus:["Clear model","Reusable content"],action:g},{step:"Step 9",title:"Run live sessions",lead:"Run mode helps facilitators guide each step with control.",passages:["Move through prompts, responses, and timing intentionally.","Participants get a predictable and focused session rhythm."],focus:["Facilitator control","Group clarity"],action:g},{step:"Step 10",title:"Read dependency graphs",lead:"Graph views expose prerequisites and high-impact nodes.",passages:["Central nodes usually deserve priority in onboarding.","Use this to plan revision order and reduce confusion."],focus:["Priority mapping","Smarter progression"],action:g},{step:"Step 11",title:"Use storyboards and texts",lead:"Plan narratives and keep notes near source knowledge.",passages:["Storyboards model session structure and transitions.","Texts capture outcomes, drafts, and reusable explanations."],focus:["Planning layer","Contextual notes"],action:g},{step:"Step 12",title:"Share safely",lead:"Share read access without losing editorial control.",passages:["Keep editing rights restricted to owners or maintainers.","Collaborators can consume material while core data stays protected."],focus:["Access control","Safe collaboration"],action:g},{step:"Step 13",title:"Navigate by layers",lead:"Sidebar and breadcrumb make system depth understandable.",passages:["You always know whether you are at library, collection, or revision level.","Clear location awareness reduces wrong actions."],focus:["Fast orientation","Lower friction"],action:g},{step:"Step 14",title:"30-minute launch plan",lead:"Start with a minimum viable setup, then iterate.",passages:["Plan: create 1 library, add 10 infos, build 1 collection, run 1 revision.","After the first run, refine structure and scale by scenario."],focus:["Immediate execution","Iterative improvement"],action:"Ready now? Create your first library on the right and start adding knowledge."}]},[A]),st=Se.length,Qe=Math.max(0,Math.min(Ne,st-1)),Je=Se[Qe],rt=!!I,yt=Ae&&$==="all_collections",Ze=rt&&$==="all_collections",tt=rt&&$==="all_collections"&&ds.includes(ee),lt=a.useCallback(g=>{const p=!!g.libraryId;let P=g.target,ae=g.collectionId,Oe=g.revisionId,Xe=g.revisionView,me=g.infoId,le=g.infoView??l.infoView??"overview";p?ls[P].requiresCollection&&!ae?(P="all_collections",Oe=void 0,Xe="detail"):P!=="all_collections"?(ae=void 0,Oe=void 0,P!=="new_card"&&P!=="all_cards"&&(me=void 0,le="overview")):ls[P].allowsRevision?ds.includes(Xe)||(Oe=void 0):Xe="detail":(P="library_overview",ae=void 0,Oe=void 0,Xe="detail",me=void 0,le="overview"),H(g.libraryId),X(P),E(ae),ie(Oe),_e(Xe),x(!1);const vt=va(Ds(g.libraryId,P,ae,Xe,Oe,me,le));va(`${y.pathname}${y.search}`)!==vt&&(Ue.current=vt,c(vt))},[y.pathname,y.search,c,l.infoView]),dt=g=>{lt({libraryId:b,target:"all_collections",collectionId:I,revisionId:ds.includes(g)?se:void 0,revisionView:g})},It=a.useMemo(()=>[{key:"library",label:u.layers.library,visible:!0,value:b??"",selectedLabel:(Y==null?void 0:Y.name)??u.path.noLibrarySelected,disabled:V||k.length===0,options:k.map(g=>({value:g.libraryId,label:g.name})),emptyOption:u.noLibraryOption,onSelect:g=>{const p=g||void 0;lt({libraryId:p,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:u.layers.target,visible:Ae,value:ye,selectedLabel:We,disabled:!Ae,options:fn.map(g=>({value:g,label:Fe[g]})),onSelect:g=>{const p=g;lt({libraryId:b,target:p,collectionId:I,revisionId:se,revisionView:ee,infoId:p==="new_card"?l.infoId:void 0})}},{key:"info_mode",label:u.layers.target,visible:ye==="all_cards",value:je,selectedLabel:je==="create"?u.infoMode.create:je==="selected"?(Re==null?void 0:Re.label)??fe??t.cogita.library.list.selectedEmpty:u.infoMode.search,disabled:!Ae,options:[{value:"search",label:u.infoMode.search},{value:"create",label:u.infoMode.create},...l.infoId?[{value:"selected",label:(Re==null?void 0:Re.label)??fe??t.cogita.library.list.selectedEmpty}]:[]],onSelect:g=>{if(g==="selected"){if(!l.infoId)return;lt({libraryId:b,target:"all_cards",collectionId:I,revisionId:se,revisionView:ee,infoId:l.infoId,infoView:"overview"});return}if(g==="create"){lt({libraryId:b,target:"new_card",collectionId:I,revisionId:se,revisionView:ee,infoId:void 0});return}lt({libraryId:b,target:"all_cards",collectionId:I,revisionId:se,revisionView:ee,infoId:void 0,infoView:"overview"})}},{key:"info_selected_action",label:u.layers.target,visible:ye==="all_cards"&&!!l.infoId,value:$==="new_card"&&l.infoId?"edit":l.infoView==="cards"?"cards":"overview",selectedLabel:$==="new_card"&&l.infoId?u.infoActions.edit:l.infoView==="cards"?u.infoActions.seeCards:u.infoActions.overview,disabled:!Ae||!l.infoId,options:[{value:"overview",label:u.infoActions.overview},{value:"edit",label:u.infoActions.edit},{value:"cards",label:u.infoActions.seeCards}],onSelect:g=>{if(l.infoId){if(g==="edit"){lt({libraryId:b,target:"new_card",collectionId:I,revisionId:se,revisionView:ee,infoId:l.infoId});return}if(g==="cards"){lt({libraryId:b,target:"all_cards",collectionId:I,revisionId:se,revisionView:ee,infoId:l.infoId,infoView:"cards"});return}lt({libraryId:b,target:"all_cards",collectionId:I,revisionId:se,revisionView:ee,infoId:l.infoId,infoView:"overview"})}}},{key:"collection",label:u.layers.collection,visible:yt,value:I??"",selectedLabel:(ge==null?void 0:ge.name)??u.path.noCollectionSelected,disabled:!Ae||Q||G.length===0,options:G.map(g=>({value:g.collectionId,label:g.name})),emptyOption:u.selectCollectionOption,onSelect:g=>{lt({libraryId:b,target:"all_collections",collectionId:g||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:u.layers.revision,visible:Ze,value:Me,selectedLabel:$e,disabled:!I,options:O.map(g=>({value:g.value,label:g.label})),onSelect:g=>{dt(g)}},{key:"revision_entry",label:u.layers.revision,visible:tt,value:se??"",selectedLabel:(Ee==null?void 0:Ee.name)??u.status.noRevisions,disabled:!rt||ve||ce.length===0,options:ce.map(g=>({value:g.revisionId,label:g.name})),emptyOption:u.status.noRevisions,onSelect:g=>{lt({libraryId:b,target:"all_collections",collectionId:I,revisionId:g||void 0,revisionView:ee})}}],[O,G,Q,je,S,k,V,lt,ce,ve,ge,I,Re,Ee,se,fe,rt,Ae,Y,b,$e,ee,$,Me,ye,We,yt,Ze,tt,Fe,t.cogita.library.list.selectedEmpty,l.infoId,l.infoView,u.infoActions.edit,u.infoActions.overview,u.infoActions.seeCards,u.layers.collection,u.layers.library,u.layers.revision,u.layers.target,u.noLibraryOption,u.path.noCollectionSelected,u.path.noLibrarySelected,u.selectCollectionOption]),nt=a.useMemo(()=>It.filter(g=>g.visible),[It]),ot=a.useMemo(()=>nt.filter(g=>g.key!=="library"&&g.key!=="collection"&&g.key!=="revision_entry"),[nt]),Lt=a.useMemo(()=>ot.find(g=>g.key==="target")??null,[ot]),ft=a.useMemo(()=>ot.find(g=>g.key==="info_mode")??null,[ot]),at=a.useMemo(()=>ot.find(g=>g.key==="info_selected_action")??null,[ot]),it=a.useMemo(()=>ot.find(g=>g.key==="collection_action")??null,[ot]),xt=a.useCallback((g,p)=>g?e.jsx("div",{className:"cogita-sidebar-actions",children:g.options.map(P=>e.jsx("button",{type:"button",className:`ghost ${String(g.value)===P.value?"active":""}`,onClick:()=>g.onSelect(P.value),disabled:g.disabled,children:P.label},`${p}:${g.key}:${P.value}`))}):null,[]),Tt=a.useMemo(()=>{const g=l.libraryId;if(!g||!y.pathname.startsWith("/cogita/library/"))return null;const p={copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,libraryId:g};if(l.target==="library_overview")return e.jsx(si,{...p});if(l.target==="all_cards")return l.infoId&&l.infoView==="cards"?e.jsx(vi,{...p,infoId:l.infoId}):e.jsx(di,{...p,mode:l.cardMode??"list"});if(l.target==="new_card")return e.jsx(bi,{...p,editInfoId:l.infoId});if(l.target==="dependencies")return e.jsx(xi,{...p});if(l.target==="transfer")return e.jsx(ji,{...p});if(l.target==="storyboards"||l.target==="new_storyboard")return e.jsx(ki,{...p});if(l.target==="texts"||l.target==="new_text")return e.jsx(Ni,{...p});if(l.target==="all_collections"){if(l.collectionId){const P={...p,collectionId:l.collectionId};return l.revisionView==="graph"?e.jsx(Xi,{...P}):l.revisionView==="shared"?e.jsx(wi,{...p,collectionId:l.collectionId}):l.revisionView==="settings"?e.jsx(Ai,{...P,revisionId:l.revisionId}):l.revisionView==="run"?e.jsx(Hi,{...P,revisionId:l.revisionId}):e.jsx(Si,{...P})}return e.jsx(zs,{...p})}return l.target==="new_collection"?e.jsx(zs,{...p}):null},[s,t,A,y.pathname,c,T,m,v,i,o,l.cardMode,l.collectionId,l.infoId,l.libraryId,l.revisionId,l.revisionView,l.target,f,n]);a.useEffect(()=>{let g=!1;return(async()=>{var P,ae,Oe,Xe,me;he(!0);try{await Bn();const[le,vt,At]=await Promise.all([Hs(),Dn(),_n()]);if(g)return;oe(le);const qt=new Set(At.nodes.filter(mt=>mt.nodeType==="role"&&mt.canLink).map(mt=>mt.roleId??"")),zt=er(vt,qt);if(Be(zt),zt){const mt=At.nodes.find(wt=>wt.nodeType==="data"&&wt.roleId===zt&&(wt.fieldType===cs||wt.label===cs));J((mt==null?void 0:mt.dataKeyId)??null),we.current=tr(mt==null?void 0:mt.value)}const Pt=(P=le.find(mt=>mt.libraryId===l.libraryId))==null?void 0:P.libraryId,ra=Pt?(Oe=(ae=we.current.byLibrary)==null?void 0:ae[Pt])==null?void 0:Oe.lastTarget:void 0,Ut=Zi(ra)?ra:"library_overview";H(Pt),X(l.target??Ut),ie(l.revisionId??(Pt?(me=(Xe=we.current.byLibrary)==null?void 0:Xe[Pt])==null?void 0:me.lastRevisionId:void 0)),_e(l.revisionView??"detail"),Pe.current=!0}catch{g||Te(u.status.loadFailed)}finally{g||he(!1)}})(),()=>{g=!0}},[u.status.loadFailed]),a.useLayoutEffect(()=>{if(Pe.current){if(!l.libraryId){H(void 0),X(l.target??"library_overview"),E(void 0),ie(void 0),_e("detail");return}l.libraryId&&k.some(g=>g.libraryId===l.libraryId)&&H(l.libraryId),l.target&&X(l.target),E(l.collectionId),ie(l.revisionId),l.revisionView&&_e(l.revisionView)}},[k,l.collectionId,l.libraryId,l.revisionId,l.revisionView,l.target]),a.useEffect(()=>{if(!b){W([]),E(void 0),h([]),K([]),ie(void 0);return}let g=!1;return z(!0),ja({libraryId:b,limit:200}).then(p=>{var Oe;if(g)return;const P=p.items;W(P);const ae=(Oe=P.find(Xe=>Xe.collectionId===l.collectionId))==null?void 0:Oe.collectionId;E(ae)}).catch(()=>{g||(W([]),E(void 0))}).finally(()=>{g||z(!1)}),()=>{g=!0}},[l.collectionId,b]),a.useEffect(()=>{if(!b||ye!=="all_cards"&&$!=="new_card"){h([]);return}let g=!1;return bs({libraryId:b,limit:200}).then(p=>{g||h(p)}).catch(()=>{g||h([])}),()=>{g=!0}},[ye,b,$]),a.useEffect(()=>{if(!b||!I){K([]),ie(void 0);return}let g=!1;return xe(!0),Qs({libraryId:b,collectionId:I}).then(p=>{var Oe,Xe,me,le;if(g)return;K(p);const P=(Xe=(Oe=we.current.byLibrary)==null?void 0:Oe[b])==null?void 0:Xe.lastRevisionId,ae=((me=p.find(vt=>vt.revisionId===l.revisionId))==null?void 0:me.revisionId)??((le=p.find(vt=>vt.revisionId===P))==null?void 0:le.revisionId);ie(ae)}).catch(()=>{g||(K([]),ie(void 0))}).finally(()=>{g||xe(!1)}),()=>{g=!0}},[l.revisionId,I,b]),a.useEffect(()=>{const g=l.infoId;if(!b||!g){C(void 0);return}let p=!1;return Yt({libraryId:b,infoId:g}).then(P=>{if(p)return;const ae=P.payload;C((ae==null?void 0:ae.label)??(ae==null?void 0:ae.name)??(ae==null?void 0:ae.title)??P.infoId)}).catch(()=>{p||C(g)}),()=>{p=!0}},[l.infoId,b]),a.useEffect(()=>{if(!Pe.current||l.libraryId&&k.some(ae=>ae.libraryId===l.libraryId)&&l.libraryId!==b||l.target&&l.target!==$||l.revisionView&&l.revisionView!==ee||l.revisionId&&l.revisionId!==se||ls[$].requiresCollection&&!I&&l.target==="all_collections"&&l.collectionId)return;const g=va(`${y.pathname}${y.search}`);if(va(y.pathname)==="/cogita"&&!l.libraryId&&!b){Ue.current=null;return}const P=va(Ds(b,$,I,ee,se,l.infoId,l.infoView??"overview"));if(g===P){Ue.current=null;return}Ue.current!==P&&(Ue.current=P,c(P,{replace:!0}))},[k,y.pathname,y.search,c,l.collectionId,l.infoId,l.infoView,l.libraryId,l.revisionId,l.revisionView,l.target,I,b,se,ee,$]),a.useEffect(()=>{if(typeof window>"u")return;const g=()=>{window.innerWidth>920&&x(!1)};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),a.useEffect(()=>{if(!Pe.current||!U||!b||De.current)return;const g=we.current,p={...g.byLibrary??{}},P={...p[b]??{},lastCollectionId:I,lastRevisionId:se,lastRevisionView:ee,lastTarget:$},ae={version:1,lastLibraryId:b,byLibrary:{...p,[b]:P}},Oe=JSON.stringify(g),Xe=JSON.stringify(ae);if(Oe===Xe)return;we.current=ae,De.current=!0,(async()=>{try{if(re)await Vn(re,{plainValue:Xe});else{const le=await On(U,{itemName:cs,itemType:"data",plainValue:Xe});J(le.dataItemId)}}catch{Te(u.status.savePrefsFailed)}finally{De.current=!1}})()},[re,U,I,b,se,ee,$,u.status.savePrefsFailed]);const et=async()=>{const g=Ke.trim();if(!g){Te(t.cogita.user.libraryNameRequired);return}Te(null);try{const p=await Wn({name:g});oe(P=>[p,...P]),H(p.libraryId),X("library_overview"),E(void 0),te("")}catch{Te(t.cogita.user.libraryCreateFailed)}},ht=async()=>{if(!b){Te(u.status.selectLibraryFirst);return}const g=Ce.trim();if(!g){Te(t.cogita.library.collections.saveRequiredName);return}Te(null);try{const p=await qn({libraryId:b,name:g,items:[]}),P=await ja({libraryId:b,limit:200});W(P.items),E(p.collectionId),ie(void 0),X("all_collections"),_e("detail"),Ve("")}catch{Te(t.cogita.library.collections.saveFail)}},bt=async()=>{if(!b||!I){Te(u.status.selectLibraryFirst);return}const g=ze.trim();if(!g){Te(u.revisionForm.nameLabel);return}Te(null);try{const p=await Un({libraryId:b,collectionId:I,name:g,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});K(P=>[p,...P]),ie(p.revisionId),X("all_collections"),_e("settings"),F("")}catch{Te(u.status.loadFailed)}};return e.jsx(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${be?"open":""}`,"aria-label":u.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Y==null?void 0:Y.name)??u.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Y?u.sidebar.libraryActionsHint:u.status.selectLibraryFirst}),xt(Lt,"sidebar")]}),ft?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:u.sidebar.infoActionsHint}),xt(ft,"sidebar"),at?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(Re==null?void 0:Re.label)??fe??t.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:u.sidebar.selectedInfoActionsHint}),xt(at,"sidebar")]}):null]}):null,ge?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:ge.name}),e.jsx("p",{className:"cogita-sidebar-note",children:u.sidebar.collectionActionsHint}),xt(it,"sidebar")]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:u.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:i,children:u.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{v("cogita"),x(!1)},children:u.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:o,children:f?t.account.secureModeDisable:t.account.secureModeEnable})]})]})]}),be?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":u.sidebar.closeMenu,onClick:()=>x(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":u.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>x(g=>!g),"aria-label":be?u.sidebar.closeMenu:u.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),nt.map((g,p)=>e.jsxs("div",{className:"cogita-browser-segment",children:[p>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,g.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":g.label,children:g.selectedLabel}):e.jsxs("select",{"aria-label":g.label,value:g.value,onChange:P=>g.onSelect(P.target.value),disabled:g.disabled,children:[g.emptyOption?e.jsx("option",{value:"",children:g.emptyOption}):null,g.options.map(P=>e.jsx("option",{value:P.value,children:P.label},`${g.key}:${P.value}`))]})]},`menu:${g.key}`))]}),Tt?e.jsxs(e.Fragment,{children:[$==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Ce,onChange:g=>Ve(g.target.value),placeholder:t.cogita.library.collections.namePlaceholder,disabled:!b})]}),e.jsx("button",{type:"button",className:"cta",onClick:ht,disabled:!b,children:t.cogita.library.actions.createCollection}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,$==="all_collections"&&I&&ee==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:u.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:u.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:ze,onChange:g=>F(g.target.value),placeholder:u.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:bt,children:u.revisionForm.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(an.Provider,{value:!0,children:Tt})})]}):null,Tt?null:e.jsx(e.Fragment,{children:b?null:e.jsxs("section",{className:"cogita-browser-intro",children:[e.jsx("div",{className:"cogita-browser-intro-main",children:e.jsxs("article",{className:"cogita-browser-panel cogita-browser-tutorial",children:[e.jsxs("div",{className:"cogita-browser-tutorial-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-browser-tutorial-step",children:Je.step}),e.jsx("h2",{children:Je.title})]}),e.jsxs("p",{children:[Qe+1," / ",st]})]}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-lead",children:Je.lead}),e.jsx("div",{className:"cogita-browser-tutorial-passages",children:Je.passages.map(g=>e.jsx("p",{children:g},g))}),e.jsx("div",{className:"cogita-browser-tutorial-focus",children:Je.focus.map(g=>e.jsx("span",{children:g},g))}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-action",children:Je.action}),e.jsx("div",{className:"cogita-browser-tutorial-progress",role:"list","aria-label":"Tutorial progress",children:Se.map((g,p)=>e.jsx("button",{type:"button",className:`ghost ${p===Qe?"active":""}`,onClick:()=>qe(p),"aria-label":`${p+1}`,children:p+1},`tutorial:${g.title}:${p}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:Qe===0,onClick:()=>qe(g=>Math.max(0,g-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"cta",disabled:Qe===st-1,onClick:()=>qe(g=>Math.min(st-1,g+1)),children:"Next"})]})]})}),e.jsxs("div",{className:"cogita-browser-intro-side",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.createLibraryTitle}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:g=>te(g.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:et,children:t.cogita.user.createLibraryAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.availableLibraries}),k.length===0?e.jsx("p",{className:"cogita-browser-note",children:t.cogita.user.noLibraries}):null,k.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:k.map(g=>e.jsxs("button",{type:"button",className:"cogita-card-item",onClick:()=>{lt({libraryId:g.libraryId,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.user.libraryRoleLabel}),e.jsx("h3",{className:"cogita-card-title",children:g.name})]},g.libraryId))}):null]})]})]})})]})]})})}const cr=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:ar},Symbol.toStringTag,{value:"Module"}));function sr({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,shareId:c}){const[y,l]=a.useState(null),[u,k]=a.useState("loading"),[oe,G]=a.useState(t.cogita.library.collections.defaultName),[W,S]=a.useState("Cogita Library"),[h,ce]=a.useState([]),[K,b]=a.useState([]),[H,$]=a.useState("idle"),[X,I]=a.useState({current:0,total:0}),[E,se]=a.useState(0),[ie,ee]=a.useState(""),[_e,fe]=a.useState(null),[C,be]=a.useState(null),[x,V]=a.useState(null),[he,Q]=a.useState(null),[z,ve]=a.useState([]),[xe,ke]=a.useState({}),[Te,Ne]=a.useState({}),[qe,Ke]=a.useState(null),[te,Ce]=a.useState(null),[Ve,ze]=a.useState(null),[F,U]=a.useState(null),[Be,re]=a.useState({}),J=a.useRef(0),[we,Pe]=a.useState(null),De=a.useRef(null),Ue=a.useRef(null),[Y,ge]=a.useState(null),[Ee,R]=a.useState(!1),[O,ye]=a.useState(null),[Me,je]=a.useState([]),[Re,Fe]=a.useState(null),We=a.useRef(null),$e=a.useRef(null),[Ae,Se]=a.useState(null),[st,Qe]=a.useState(0),Je=a.useRef(null),rt=a.useRef({}),[yt,Ze]=a.useState(!1),[tt,lt]=a.useState({}),dt=a.useRef(null),It=a.useRef(new Set),nt=a.useRef({}),[ot,Lt]=a.useState([]),[ft,at]=a.useState(new Set),[it,xt]=a.useState(!1),Tt=Va(),et=a.useMemo(()=>new URLSearchParams(Tt.search),[Tt.search]),ht=a.useMemo(()=>et.get("key")??"",[et]),bt=(y==null?void 0:y.mode)??"random",g=(y==null?void 0:y.check)??"exact",p=(y==null?void 0:y.limit)??20,P=a.useMemo(()=>js((y==null?void 0:y.revisionType)??bt),[y,bt]),ae=a.useMemo(()=>{const M=y==null?void 0:y.revisionSettings,q=on(P,et);return Wa(P,M??q)},[y,et,P]),Oe=a.useMemo(()=>t.cogita.library.revision[P.labelKey]??bt,[t,bt,P]),Xe=a.useMemo(()=>g==="exact"?t.cogita.library.revision.checkValue:g,[t,g]),le=u==="ready"?h[E]??null:null,vt=(le==null?void 0:le.checkType)==="translation-match"&&F,At=a.useRef(new Map),qt=a.useRef(new Map),zt=a.useRef(new Map),Pt=a.useRef(new Map),ra=a.useMemo(()=>le?le.cardType==="vocab"?t.cogita.library.revision.vocabLabel:le.infoType?Ge(t,le.infoType):t.cogita.library.revision.infoLabel:"",[t,le]),Ut=a.useMemo(()=>{var q;return P.id!=="levels"?h.length:((q=tt.pool)==null?void 0:q.length)??P.getFetchLimit(p,ae)},[tt,ae,P,h.length,p]),mt=P.getProgressTotal?P.getProgressTotal(h,tt,p,ae):P.id==="levels"?Math.min(p,Ut):h.length,wt=mt?Math.min(E+1,mt):0,Ct=Math.max(1,Number(ae.tries??1)),Wt=ae.compare??"anchors",pt=Math.max(0,Math.min(100,Number(ae.minCorrectness??0))),ct=(ae.considerDependencies??"on")==="on",Et=Math.max(0,Math.min(100,Number(ae.dependencyThreshold??85))),Gt=M=>{const q=M.slice();for(let r=q.length-1;r>0;r-=1){const d=Math.floor(Math.random()*(r+1));[q[r],q[d]]=[q[d],q[r]]}return q},Ht=M=>M.length?M.reduce((r,d)=>r+d,0)/M.length/255*100:0,oa=M=>Ht(M)>=pt,Ha=async()=>{const M=await Vt(),q=new Map,r=new Map;M.forEach(w=>{const _=`${w.itemType}:${w.itemId}`,j=Dt(w.itemType,w.itemId,w.checkType,w.direction);q.has(_)||q.set(_,[]),q.get(_).push(w),r.has(j)||r.set(j,[]),r.get(j).push(w)});const d=new Map,N=new Map;return q.forEach((w,_)=>d.set(_,_t(w).score)),r.forEach((w,_)=>N.set(_,_t(w).score)),{itemKnowness:d,cardKnowness:N}},ba=async M=>{const q=tt,r=M.concat(q.active??[]).concat(q.pool??[]).filter((D,Z,ne)=>ne.findIndex(pe=>ue(pe)===ue(D))===Z);if(!ct){at(new Set(r.map(ue)));return}const{itemKnowness:d,cardKnowness:N}=await Ha(),w=D=>{if(D.cardType!=="info"||D.infoType!=="citation"||D.checkType!=="quote-fragment")return!0;const Z=Mt(D.direction);if(!(Z!=null&&Z.fragmentId))return!0;const ne=D.description??"";if(!ne.trim())return!0;const de=ia(ne).nodes[Z.fragmentId];if(!de||!de.leftId&&!de.rightId)return!0;const Ie=[de.leftId,de.rightId].filter(Ye=>!!Ye);if(Ie.length===0)return!0;const Le=Ie.map(Ye=>{const ut=Dt("info",D.cardId,"quote-fragment",Na(Z.mode,Ye));return N.get(ut)??0});return Le.reduce((Ye,ut)=>Ye+ut,0)/Le.length>=Et},_=(y==null?void 0:y.collectionId)??null,j=_?ot.filter(D=>gt(D.childItemType)==="collection"&&D.childItemId===_&&!gt(D.childCheckType)&&!gt(D.childDirection)):[],B=_&&r.length>0?r.reduce((D,Z)=>D+(N.get(ue(Z))??0),0)/r.length:0,L=new Set;for(const D of r){if(D.cardType!=="info"){L.add(ue(D));continue}if(!w(D))continue;const Z=ot.filter(de=>pn(de,D)).concat(j);if(Z.length===0){L.add(ue(D));continue}let ne=0;for(const de of Z)if(gt(de.parentItemType)==="collection")ne+=de.parentItemId===_?B:0;else if(gt(de.parentCheckType)||gt(de.parentDirection)){const Ie=gt(de.parentCheckType),Le=gt(de.parentDirection),He=Dt(de.parentItemType,de.parentItemId,Ie,Le);ne+=N.get(He)??0}else{const Ie=`${de.parentItemType}:${de.parentItemId}`;ne+=d.get(Ie)??0}ne/Z.length>=Et&&L.add(ue(D))}at(L)},Qa=M=>{for(let q=M;q<h.length;q+=1){const r=h[q];if(r&&(!ct||r.cardType!=="info"||ft.has(ue(r))))return q}return-1},ca=M=>!ct||M.cardType!=="info"||ft.has(ue(M)),Ya=M=>{if(P.id!=="temporal"&&P.id!=="levels")return null;const q=tt,r=(q.active??[]).concat(q.pool??[]),d=new Set;for(const N of r){const w=ue(N);if(!(d.has(w)||M.has(w))&&(d.add(w),ca(N)))return N}return null},$t=a.useMemo(()=>{if(P.id!=="levels")return null;const M=tt,q=M.pool??[],r=M.active??[],d=M.levelMap??{},N=Math.max(1,Number(ae.levels??1)),w=Array.from({length:N},()=>0),_=new Set(r.map(D=>ue(D)));q.forEach(D=>{const Z=Math.min(N,Math.max(1,d[ue(D)]??1));w[Z-1]+=1});const j=q.length||1,B=w.map(D=>D/j*100),L=le?d[ue(le)]??1:null;return{counts:w,percentages:B,currentLevel:L,levelsCount:N,activeCount:r.length,poolCount:q.length,activeSet:_}},[tt,ae,P,le]),la=a.useMemo(()=>{if(P.id!=="temporal")return null;const M=tt,q=M.pool??[],r=M.active??[],d=M.knownessMap??{},N=new Set(M.unknownSet??[]);let w=0;q.forEach(B=>{(d[ue(B)]??0)>1&&(w+=1)});const _=N.size,j=r.map(B=>({id:ue(B),value:N.has(ue(B))?0:Math.max(0,Math.min(1,d[ue(B)]??0))}));return{knownCount:w,unknownCount:_,dots:j}},[tt,P]),Ft=a.useMemo(()=>{if(!ct)return 0;const M=tt;return h.concat(M.active??[]).concat(M.pool??[]).filter((r,d,N)=>N.findIndex(w=>ue(w)===ue(r))===d).filter(r=>r.cardType==="info"&&!ft.has(ue(r))).length},[ct,tt,h,ft]);a.useEffect(()=>{if(!ct||H!=="ready")return;const M=tt,r=h.concat(M.active??[]).concat(M.pool??[]).filter((w,_,j)=>j.findIndex(B=>ue(B)===ue(w))===_).filter(w=>w.cardType!=="info"||ft.has(ue(w))).length,d=We.current;if(We.current=r,d===null||r<=d)return;const N=r-d;Fe(`New card available (+${N})`),$e.current&&window.clearTimeout($e.current),$e.current=window.setTimeout(()=>Fe(null),2200)},[ct,H,tt,h,ft]),a.useEffect(()=>()=>{$e.current&&window.clearTimeout($e.current)},[]);const jt=(M,q)=>{const r=P.applyOutcome({queue:h,meta:tt},le,p,ae,{correct:M,correctness:q,createdUtc:new Date().toISOString()});ce(r.queue),lt(r.meta);const d=r.queue[E+1];d&&Rt(d,E+1)};a.useEffect(()=>{if(!c){k("error");return}k("loading"),Hn({shareId:c,key:ht}).then(M=>{l(M),G(M.collectionName),S(M.libraryName),k("ready")}).catch(()=>{k("error")})},[c,ht]),a.useEffect(()=>{c&&Qn({shareId:c,key:ht,type:"language"}).then(M=>b(M)).catch(()=>b([]))},[c,ht]),a.useEffect(()=>{!c||u!=="ready"||Yn({shareId:c,key:ht}).then(M=>Lt(M.items??[])).catch(()=>Lt([]))},[c,ht,u]),a.useEffect(()=>{if(!c||u!=="ready")return;let M=!0;return(async()=>{$("loading"),I({current:0,total:P.id==="levels"?0:P.getFetchLimit(p,ae)});try{const r=[];let d=null,N=null;do{const Z=await Gn({shareId:c,key:ht,limit:300,cursor:d});if(r.push(...Z.items),(P.id==="levels"||P.id==="temporal")&&Z.total&&(N=Z.total),I(ne=>({current:r.length,total:ne.total||Z.total||P.getFetchLimit(p,ae)})),d=Z.nextCursor??null,N!==null&&r.length>=N||P.id!=="levels"&&P.id!=="temporal"&&r.length>=P.getFetchLimit(p,ae))break}while(d);if(!M)return;const w=hs(r);let _;if(P.id==="levels"){const Z=Math.max(1,Number(ae.levels??1));_={},w.forEach(ne=>{const pe=ue(ne);_[pe]=Math.max(1,Math.min(Z,1))})}let j=null,B=null,L=null;if(P.id==="temporal"){const Z=await Vt(),ne=new Set(w.map(Ie=>ue(Ie))),pe=Z.reduce((Ie,Le)=>{const He=Dt(Le.itemType,Le.itemId,Le.checkType,Le.direction);return ne.has(He)&&(Ie[He]||(Ie[He]=[]),Ie[He].push(Le)),Ie},{});j={},B=new Set,L={};const de=Date.now();w.forEach(Ie=>{const Le=ue(Ie),He=pe[Le]??[];if(He.length===0){j[Le]=0,B.add(Le),L[Le]=[];return}const Ye=xs(He);L[Le]=Ye;const ut=qa(Ye,de);j[Le]=ut.knowness})}const D=P.id==="levels"?ws(w,p,ae,_):P.id==="temporal"?vs(w,p,ae,j??{},B??new Set,L??{}):P.prepare(w,p,ae);ce(D.queue),lt(D.meta),se(0),$("ready"),I(Z=>({current:Math.min(Z.current,Z.total),total:Z.total}))}catch{M&&$("error")}})(),()=>{M=!1}},[c,ht,p,P,ae,u]),a.useEffect(()=>{ba(h)},[h,ot,ct,Et,y==null?void 0:y.collectionId]),a.useEffect(()=>{if(!le||!ct){xt(!1);return}if(le.cardType!=="info"||ft.has(ue(le))){xt(!1);return}const M=Qa(E+1);if(M>=0){xt(!1),se(M);return}if(P.id==="temporal"||P.id==="levels"){const q=h.slice(0,E+1),r=h.slice(E+1).filter(ca),d=q.concat(r),N=new Set(d.map(ue)),w=Ya(N);if(w){const j=ue(w);N.has(j)||(d.push(w),N.add(j),lt(B=>{const L=B,D=new Set(L.queued??[]);return D.add(j),{...L,queued:D}}))}const _=d.findIndex((j,B)=>B!==E&&ca(j));if(_>=0){ce(d),se(_),xt(!1);return}}xt(!0)},[le,ft,ct,E,h,tt,P.id]),a.useEffect(()=>{if(ee(""),fe(null),Se(null),Qe(0),ve([]),ke({}),Ne({}),Ke(null),Ce(null),ze(null),R(!1),Ze(!1),ge(null),U(null),re({}),!le){be(null),V(null);return}le.cardType==="info"&&le.infoType==="computed"&&be(t.cogita.library.revision.loadingComputed);let M=!0;return Rt(le,E).then(q=>{!M||!q||(be(q.prompt),V(q.expectedAnswer),ve(q.computedExpected),ke(q.computedAnswers),Ke(q.answerTemplate),Ce(q.outputVariables),ze(q.variableValues))}),()=>{M=!1}},[le,c,t]),a.useEffect(()=>{if(!le||le.cardType!=="info"||le.infoType!=="citation"){dt.current=null,It.current=new Set,Q(null);return}const M=le.description??"",q=(le.label??"").trim(),r=q.replace(/\s+/g," ").trim(),d=M.replace(/\s+/g," ").trim(),N=r&&r!==d?q:t.cogita.library.infoTypes.citation;if(!M){Q(null),V(null);return}const w=ia(M);dt.current=w,be(N);let _=!0;return Vt().then(j=>{if(!_)return;const B=getQuoteMode(le.direction),L=new Map;j.forEach(de=>{if(de.itemType!=="info"||de.checkType!=="quote-fragment"||!de.direction)return;const Ie=Mt(de.direction);if(!Ie||Ie.mode!==B)return;const Le=`${de.itemId}:${Ie.fragmentId}`;L.has(Le)||L.set(Le,[]),L.get(Le).push(de)});const D={},Z=new Set;L.forEach((de,Ie)=>{const[Le,He]=Ie.split(":",2);if(Le!==le.cardId)return;const Ye=_t(de).score;D[He]=Ye,Ye>=Et&&Z.add(He)}),It.current=Z,nt.current=D;const ne=Mt(le.direction);if(ne!=null&&ne.fragmentId&&w.nodes[ne.fragmentId]){Zt(w,ne.fragmentId,N);return}const pe=ma(w,Z,D,Et,ct,le.direction);Zt(w,(pe==null?void 0:pe.id)??null,N)}).catch(()=>{It.current=new Set,nt.current={};const j=Mt(le.direction);if(j!=null&&j.fragmentId&&w.nodes[j.fragmentId]){Zt(w,j.fragmentId,N);return}const B=ma(w,It.current,{},Et,ct,le.direction);Zt(w,(B==null?void 0:B.id)??null,N)}),()=>{_=!1}},[le,t,ct,Et]),a.useEffect(()=>{if(!le||le.cardType!=="vocab"||le.checkType!=="translation-match"){U(null),re({});return}const r=(tt.pool??tt.active??h).filter(j=>j.cardType==="vocab"&&j.checkType==="translation-match").filter((j,B,L)=>L.findIndex(D=>D.cardId===j.cardId)===B);r.some(j=>j.cardId===le.cardId)||r.unshift(le);const N=Gt(r).slice(0,6).map(j=>{const B=j.label.split("↔").map(Z=>Z.trim()).filter(Boolean);if(B.length<2)return null;const L=`${j.cardId}:L`,D=`${j.cardId}:R`;return{cardId:j.cardId,leftId:L,rightId:D,leftLabel:B[0],rightLabel:B[1]}}).filter(Boolean),w=N.map(j=>j.leftId),_=Gt(N.map(j=>j.rightId));U({pairs:N,leftOrder:w,rightOrder:_,selection:{},activeLeft:null,activeRight:null,locked:{}})},[le,h,tt]),a.useEffect(()=>()=>{De.current&&window.clearTimeout(De.current),Ue.current&&window.clearTimeout(Ue.current)},[]);const da=a.useRef(null);a.useEffect(()=>{if(!le)return;const M=ue(le),q=typeof document<"u"?document.activeElement:null;if(da.current===M&&q&&(q.tagName==="INPUT"||q.tagName==="TEXTAREA"))return;let r=0;const d=()=>{if(le){if(le.cardType==="info"&&le.infoType==="computed"){if(z.length>0){const w=_a(qe,z,te),_=w?rt.current[w]:null;if(_&&(_.focus(),document.activeElement===_)){da.current=M;return}}if(Je.current&&(Je.current.focus(),document.activeElement===Je.current)){da.current=M;return}}else if(le.cardType==="vocab"&&Je.current&&(Je.current.focus(),document.activeElement===Je.current)){da.current=M;return}r<6&&(r+=1,window.setTimeout(d,40))}},N=window.setTimeout(d,40);return()=>window.clearTimeout(N)},[le,z,qe,te]),a.useEffect(()=>{if(!yt)return;const M=q=>{q.key==="Enter"&&(q.preventDefault(),ua())};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[yt]);const kt=M=>{je(M),ye(_t(M))};a.useEffect(()=>{if(!le){ye(null),je([]);return}const M=le.cardType==="info"?"info":"connection";if(le.cardType==="info"&&le.infoType==="citation"){Vt().then(q=>{const r=q.filter(d=>d.itemType==="info"&&d.itemId===le.cardId&&d.checkType==="quote-fragment"&&Ba(d.direction,le.direction));kt(r)}).catch(()=>{ye(null),je([])});return}Ka(M,le.cardId,le.checkType,le.direction).then(q=>kt(q)).catch(()=>{ye(null),je([])})},[le]);const Xt=(M,q,r,d)=>{if(M==="info"&&r==="quote-fragment"){Vt().then(N=>{const w=N.filter(_=>_.itemType==="info"&&_.itemId===q&&_.checkType==="quote-fragment"&&Ba(_.direction,d));kt(w)}).catch(()=>{ye(null),je([])});return}Ka(M,q,r,d).then(N=>kt(N)).catch(()=>{ye(null),je([])})},Jt=(M,q,r)=>{var _;const d=((_=r.pairs.find(j=>j.leftId===M))==null?void 0:_.rightId)??null;if(!d)return r;const N=d===q;re(j=>({...j,[M]:N?"correct":"incorrect"})),De.current&&window.clearTimeout(De.current),Ue.current&&window.clearTimeout(Ue.current),J.current+=1;const w={kind:N?"correct":"incorrect",tick:J.current};if(Pe(null),De.current=window.setTimeout(()=>Pe(w),0),Ue.current=window.setTimeout(()=>Pe(null),420),N){const j={...r.locked,[M]:!0};return Object.keys(j).length>=r.pairs.length?(fe("correct"),Ze(!0)):fe("correct"),{...r,selection:{...r.selection,[M]:q},activeLeft:null,activeRight:null,locked:j}}return fe("incorrect"),{...r,activeLeft:null,activeRight:null}},Ta=M=>{U(q=>!q||q.locked[M]?q:q.activeRight?Jt(M,q.activeRight,q):{...q,activeLeft:q.activeLeft===M?null:M})},Ca=M=>{U(q=>q&&(q.activeLeft?Jt(q.activeLeft,M,q):{...q,activeRight:q.activeRight===M?null:M}))},ua=()=>{var M;if(le&&le.cardType==="info"&&le.infoType==="citation"&&dt.current&&he&&!((M=Mt(le.direction))!=null&&M.fragmentId)){const q=ma(dt.current,It.current,nt.current,Et,ct,le.direction,he.fragmentId);if(q){fe(null),ee(""),R(!1),Ne({}),Ze(!1),Se(null),Qe(0),Zt(dt.current,q.id,he.title);return}}fe(null),ee(""),R(!1),Ne({}),Ze(!1),Se(null),Qe(0),se(q=>Math.min(q+1,h.length))},Kt=M=>{if(!le)return;const q=M.expected??null,r=M.answer??"";let d=q??"",N=r;if(!q&&M.expectedMap&&M.answerMap){const Z=Object.keys(M.expectedMap).sort((ne,pe)=>ne.localeCompare(pe));d=Z.map(ne=>{var pe;return((pe=M.expectedMap)==null?void 0:pe[ne])??""}).join("|"),N=Z.map(ne=>{var pe;return((pe=M.answerMap)==null?void 0:pe[ne])??""}).join("|")}const w=d?pa(d,N,Wt):new Uint8Array,_={revisionType:P.id,evalType:M.evalType,direction:M.direction,prompt:C??"",expected:q,answer:r,expectedAnswers:M.expectedMap??null,answers:M.answerMap??null,correct:M.correct,maskBase64:w.length?Qt(w):null,checkMode:g,compareMode:Wt,minCorrectness:pt},j=new TextEncoder().encode(JSON.stringify(_)),B=le.cardType==="info"?"info":"connection",L=M.overrideCheckType??le.checkType??null,D=M.overrideDirection??le.direction??null;Fa({itemType:B,itemId:le.cardId,checkType:L,direction:D,revisionType:P.id,evalType:M.evalType,correct:M.correct,maskBase64:w.length?Qt(w):null,payloadBase64:Qt(j)}).then(()=>{Xt(B,le.cardId,L,D),ba(h)}).catch(()=>{})},ha=(M,q)=>{const r=At.current.get(q);if(r)return Promise.resolve(r);const d=qt.current.get(q);if(d)return d;const N=Xn({shareCode:c,infoId:M,key:ht}).then(w=>{var Z,ne;const _=w.payload,j=((Z=_.definition)==null?void 0:Z.graph)??null,B="",L=((ne=_.definition)==null?void 0:ne.answerTemplate)??"",D=cn(j,B,L);if(D){const de={sample:ln(D),answerTemplate:L||null};return At.current.set(q,de),de}return Ts({shareId:c,infoId:M,key:ht}).then(pe=>{const de={sample:pe,answerTemplate:null};return At.current.set(q,de),de})}).catch(()=>Ts({shareId:c,infoId:M,key:ht}).then(w=>{const _={sample:w,answerTemplate:null};return At.current.set(q,_),_}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{qt.current.delete(q)});return qt.current.set(q,N),N},Rt=(M,q)=>{var j;const r=`${ue(M)}:${q}`,d=zt.current.get(r);if(d)return Promise.resolve(d);const N=Pt.current.get(r);if(N)return N;const w=B=>(zt.current.set(r,B),B);let _;if(M.cardType==="vocab"){if(M.checkType==="translation-match")return _=Promise.resolve(w({prompt:M.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),_;const B=M.label.split("↔").map(L=>L.trim()).filter(Boolean);if(B.length>=2){const D=(M.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",Z=D?B[0]:B[1],ne=D?B[1]:B[0];_=Promise.resolve(w({prompt:Z,expectedAnswer:ne,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else _=Promise.resolve(w({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(M.cardType==="info"&&M.infoType==="word"){const B=(j=M.description)!=null&&j.startsWith("Language: ")?M.description.replace("Language: ",""):null;_=Promise.resolve(w({prompt:M.label,expectedAnswer:B,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else M.cardType==="info"&&M.infoType==="computed"?_=ha(M.cardId,r).then(B=>{var pe,de;if(!B.sample)return w({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const L=B.sample,D=L.expectedAnswers?Object.entries(L.expectedAnswers).map(([Ie,Le])=>({key:Ie,expected:Le})):[],Z=D.reduce((Ie,Le)=>(Ie[Le.key]="",Ie),{}),ne=L.expectedAnswerIsSentence&&((pe=L.expectedAnswer)==null?void 0:pe.trim())||null;return w({prompt:L.prompt,expectedAnswer:D.length>0?ne:((de=L.expectedAnswer)==null?void 0:de.trim())||null,computedExpected:D,computedAnswers:Z,answerTemplate:B.answerTemplate,outputVariables:L.outputVariables??null,variableValues:L.variableValues??null})}).catch(()=>w({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Pt.current.delete(r)}):_=Promise.resolve(w({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return Pt.current.set(r,_),_},Zt=(M,q,r)=>{const d=Object.keys(M.nodes).length,N=It.current.size;if(!q){Q({title:r,before:M.text,after:"",fragmentId:null,total:d,completed:N}),V(null),Ze(!0);return}const w=M.nodes[q];if(!w)return;const _=ys(M.text,w);Q({title:r,before:_.before,after:_.after,fragmentId:w.id,total:d,completed:N}),V(_.fragment),Ze(!1)},ya=()=>{const M=dt.current;M&&Q(q=>q&&{...q,total:Object.keys(M.nodes).length,completed:It.current.size})},Bt=()=>{const M=h[E+1];M&&Rt(M,E+1)},Ma=()=>{if(Bt(),le&&le.cardType==="vocab"&&le.checkType==="translation-match"&&F){if(F.pairs.length===0){fe("incorrect"),Ze(!0);return}const w=F.pairs.reduce((ne,pe)=>(ne[pe.rightId]=pe.rightLabel,ne),{});let _=0;const j={};F.pairs.forEach(ne=>{const de=F.selection[ne.leftId]===ne.rightId;j[ne.leftId]=de?"correct":"incorrect",de&&(_+=1)});const B=F.pairs.length||1,L=_/B,D=_===F.pairs.length;re(ne=>({...ne,...j})),D?(fe("correct"),Ze(!0),Qe(0)):(fe("incorrect"),Ze(!1),Qe(ne=>{const pe=ne+1;return pe>=Ct&&(R(!0),Ze(!0),U(de=>{if(!de)return de;const Ie=de.pairs.reduce((Le,He)=>(Le[He.leftId]=He.rightId,Le),{});return{...de,selection:Ie}})),pe})),jt(D,L);const Z="connection";Promise.all(F.pairs.map(ne=>{const pe=F.selection[ne.leftId]??null,de=pe?w[pe]:"",Ie={left:ne.leftLabel,expected:ne.rightLabel,answer:de,checkType:"translation-match"},Le=new TextEncoder().encode(JSON.stringify(Ie));return Fa({itemType:Z,itemId:ne.cardId,checkType:"translation-match",direction:null,revisionType:P.id,evalType:"translation-match",correct:pe===ne.rightId,maskBase64:null,payloadBase64:Qt(Le)})})).then(()=>{Xt(Z,le.cardId,le.checkType,le.direction),ba(h)}).catch(()=>{});return}if(z.length>0){const w=z.reduce((j,B)=>{const L=xe[B.key]??"";return j[B.key]=Nt(L)===Nt(B.expected)?"correct":"incorrect",j},{});z.every(({key:j,expected:B})=>{const L=xe[j]??"";return g==="exact"&&Nt(L)===Nt(B)})?(fe("correct"),Ne(w),Ze(!0),Qe(0),jt(!0,1),Kt({correct:!0,direction:C?`${C} -> computed`:"computed",expectedMap:z.reduce((j,B)=>(j[B.key]=B.expected,j),{}),answerMap:xe,evalType:"computed"})):(fe("incorrect"),Ne(w),Ze(!1),Qe(j=>{const B=j+1;return B>=Ct&&ea&&(R(!0),Ze(!0)),B}),jt(!1,0),window.setTimeout(()=>{var B;const j=_a(qe,z,te);j&&rt.current[j]&&((B=rt.current[j])==null||B.focus())},40),Kt({correct:!1,direction:C?`${C} -> computed`:"computed",expectedMap:z.reduce((j,B)=>(j[B.key]=B.expected,j),{}),answerMap:xe,evalType:"computed"}));return}if(le&&le.cardType==="info"&&le.infoType==="citation"&&(he!=null&&he.fragmentId)){if(!x)return;const w=Mt(le.direction),_=(w==null?void 0:w.mode)??getQuoteMode(le.direction),j=w!=null&&w.fragmentId&&le.direction?le.direction:Na(_,he.fragmentId),B=mn(x,ie,Wt),L=g==="exact"&&fa(ie)===fa(x),D=oa(B),Z=L||D,ne=Ht(B);Z?(nt.current[he.fragmentId]=Math.max(nt.current[he.fragmentId]??0,ne),(nt.current[he.fragmentId]??0)>=Et&&It.current.add(he.fragmentId),ya(),fe("correct"),Ne({}),Ze(!0),Se(B),Qe(0),ne<100&&Ct<=1&&R(!0),jt(!0,ne/100),Kt({correct:!0,direction:`quote:${he.fragmentId}`,expected:x,answer:ie,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:j})):(fe("incorrect"),Ne({}),Ze(!1),Se(B),Qe(pe=>{const de=pe+1;return de>=Ct&&ea&&(R(!0),Ze(!0)),de}),jt(!1,ne/100),window.setTimeout(()=>{var pe;return(pe=Je.current)==null?void 0:pe.focus()},40),Kt({correct:!1,direction:`quote:${he.fragmentId}`,expected:x,answer:ie,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:j}));return}if(!x)return;const M=pa(x,ie,Wt),q=g==="exact"&&Nt(ie)===Nt(x),r=oa(M),d=q||r,N=Ht(M);d?(fe("correct"),Ne({}),Ze(!0),Se(M),Qe(0),N<100&&Ct<=1&&R(!0),jt(!0,N/100),Kt({correct:!0,direction:C?`${C} -> ${x}`:null,expected:x,answer:ie,evalType:"text"})):(fe("incorrect"),Ne({}),Ze(!1),Se(M),Qe(w=>{const _=w+1;return _>=Ct&&ea&&(R(!0),Ze(!0)),_}),jt(!1,N/100),window.setTimeout(()=>{var w;return(w=Je.current)==null?void 0:w.focus()},40),Kt({correct:!1,direction:C?`${C} -> ${x}`:null,expected:x,answer:ie,evalType:"text"}))},ga=M=>{if(Bt(),!x)return;const q=pa(x,M,Wt),r=Nt(M)===Nt(x),d=oa(q),N=r||d,w=Ht(q);N?(fe("correct"),Ne({}),Ze(!0),Se(q),Qe(0),w<100&&Ct<=1&&R(!0),jt(!0,w/100),Kt({correct:!0,direction:"word->language",expected:x,answer:M,evalType:"language-select"})):(fe("incorrect"),Ne({}),Ze(!1),Se(q),Qe(_=>{const j=_+1;return j>=Ct&&ea&&(R(!0),Ze(!0)),j}),jt(!1,w/100),Kt({correct:!1,direction:"word->language",expected:x,answer:M,evalType:"language-select"}))},Ia=M=>{var r;if(M.key!=="Enter")return;if(M.preventDefault(),M.stopPropagation(),yt){ua();return}const q=z.find(d=>!(xe[d.key]??"").trim());if(q){(r=rt.current[q.key])==null||r.focus();return}Ma()},Ga=()=>{Bt(),fe("correct"),Ze(!0),Qe(0),jt(!0,1),x&&Kt({correct:!0,direction:"manual",expected:x,answer:ie,evalType:"manual"})},Xa=()=>{if(jt(!1,0),le&&le.cardType==="info"&&le.infoType==="citation"){fe(null),ee(""),R(!1),Ne({}),Ze(!1),Se(null),Qe(0),se(M=>Math.min(M+1,h.length));return}ua()};a.useEffect(()=>{Bt()},[E,h]);const Ja=t.cogita.library.revision.revealModeAfterIncorrect,ea=z.length>0||!!x;return e.jsxs(St,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:m,secureMode:f,onNavigate:v,language:A,onLanguageChange:T,children:[(u==="loading"||H==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:u==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${X.total?Math.min(100,Math.max(0,X.current/X.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:X.total?`${Math.min(X.current,X.total)} / ${X.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:oe}),e.jsx("p",{className:"cogita-library-subtitle",children:W}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",Oe).replace("{check}",Xe)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:O?`${O.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[$t?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",$t.currentLevel??"-"," / ",$t.levelsCount]}):null,O?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(O.correct)).replace("{total}",String(O.total))}),O.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(O.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(un,{outcomes:Me})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Re?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Re})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":we?`${we.kind}-${we.tick}`:vt?"idle":_e??"idle",children:u!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:u==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}):le?e.jsx(e.Fragment,{children:it?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(dn,{copy:t,currentCard:le,currentTypeLabel:ra,prompt:C,languages:K,answer:ie,onAnswerChange:M=>ee(q=>Da(q,M,Y)),computedExpected:z,computedAnswers:xe,onComputedAnswerChange:(M,q)=>ke(r=>({...r,[M]:Da(r[M]??"",q,Y)})),answerTemplate:qe,outputVariables:te,variableValues:Ve,computedFieldFeedback:Te,feedback:_e,canAdvance:yt,quoteContext:he,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ma,onSkip:Xa,onLanguageSelect:ga,onMarkReviewed:Ga,onAdvance:ua,showCorrectAnswer:Ee,setShowCorrectAnswer:R,onRevealCorrect:()=>Ze(!0),answerMask:Ae,expectedAnswer:x,hasExpectedAnswer:ea,handleComputedKeyDown:Ia,answerInputRef:Je,computedInputRefs:rt,scriptMode:Y,setScriptMode:ge,matchPairs:F==null?void 0:F.pairs,matchLeftOrder:F==null?void 0:F.leftOrder,matchRightOrder:F==null?void 0:F.rightOrder,matchSelection:F==null?void 0:F.selection,matchActiveLeft:F==null?void 0:F.activeLeft,matchActiveRight:F==null?void 0:F.activeRight,matchFeedback:Be,onMatchLeftSelect:Ta,onMatchRightSelect:Ca})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:mt?`${wt} / ${mt}`:t.cogita.library.revision.progressUnlimited}),u==="error"&&e.jsx("p",{children:t.cogita.library.revision.shareInvalid}),u==="loading"&&e.jsx("p",{children:t.cogita.library.revision.shareLoading}),u==="ready"&&H==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),u==="ready"&&H==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),u==="ready"&&H==="ready"&&h.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Ja}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",Ct]})]})]}),$t?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",$t.activeCount," / ",$t.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:$t.counts.map((M,q)=>{const r=q+1,d=$t.currentLevel===r,N=$t.percentages[q]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":d,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:r}),e.jsx("strong",{children:M})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,N))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[N.toFixed(1),"%"]})]},`level-${r}`)})})]}):null,la?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:la.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:la.dots.map(M=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-M.value))}, ${Math.round(200*M.value)}, 80, 0.9)`}},M.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:la.knownCount})]})]}):null,ct?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Ft})]})}):null]})]})]})})})]})]})}const lr=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:sr},Symbol.toStringTag,{value:"Module"}));export{or as C,cr as a,lr as b};
