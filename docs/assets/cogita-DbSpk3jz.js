import{r as a,j as e,u as In,a as tn,b as vs,c as ws,d as js,R as Ln,B as $n,C as Rn}from"./vendor-CL5v9b84.js";import{L as ks,A as Ns,g as Ss,a as Us,b as Aa,c as Ts,s as qn,d as An,e as Js,f as Un,h as Qt,i as Hs,j as Va,k as Oa,l as Cs,m as En,n as Cn,o as Ws,u as Jn,p as Ms,q as Gs,r as Ys,t as Qs,v as Xs,w as Zs,x as Is,y as Ls,z as er,B as tr,C as an,D as qa,E as ar,F as nr,G as $s,H as sr,I as rr,J as ir,K as Hn,M as ca,N as or,O as lr,P as cr,Q as dr,R as ur,S as hr,T as mr,U as gr,V as pr,W as fr,X as br,Y as yr,Z as xr,_ as vr,$ as wr,a0 as jr,a1 as Wn}from"./recreatio-core-CZDtV1fy.js";import"./vendor-cogita-ui-mbCyoqV0.js";const La={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},Ia={moveMs:900,pauseMs:220,errorMs:900},kr=(t=11)=>{let n=t;const s=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:r,height:i,paddingX:m,paddingY:u,levels:y}=La,N=(i-u*2)/(y.length-1),S=[],l=[],x=[];y.forEach((p,d)=>{const ie=i-u-d*N,K=r-m*2,b=[];for(let O=0;O<p;O+=1){const C=m+(O+1)*K/(p+1),Y=(s()-.5)*18,z=Math.max(m,Math.min(r-m,C+Y)),I=d===0?3:d<2?2.1:1.4,ue=d===0?"root":`l${d}-${O}`;b.push({id:ue,x:d===0?r/2:z,y:ie,r:I,level:d,role:d===0?"root":void 0})}x.push(b),S.push(...b)});const c=x[x.length-1];if(c!=null&&c.length){const p=c[Math.floor(c.length/2)];p.role="goal",p.r=2}for(let p=1;p<x.length;p+=1){const d=x[p-1];x[p].forEach(K=>{const b=[...d].sort((z,I)=>Math.abs(z.x-K.x)-Math.abs(I.x-K.x)),O=b[0],C=b[1]&&s()<.45?b[1]:null;(C?[O,C]:[O]).forEach(z=>{l.push({from:z.id,to:K.id,key:`${z.id}-${K.id}`})}),s()<.2&&b[2]&&l.push({from:b[2].id,to:K.id,key:`${b[2].id}-${K.id}`})})}const g=new Map;l.forEach(p=>{const d=g.get(p.to)??[];d.push(p.from),g.set(p.to,d)});const v=new Map,w=new Map,M=new Map;l.forEach(p=>{const d=v.get(p.from)??[];d.push(p.key),v.set(p.from,d);const ie=w.get(p.from)??[];ie.push(p.to),w.set(p.from,ie);const K=M.get(p.from)??[];K.push(p.to),M.set(p.from,K);const b=M.get(p.to)??[];b.push(p.from),M.set(p.to,b)});const F=new Map;return S.forEach(p=>{F.set(p.id,p)}),{nodes:S,links:l,parentsById:g,linksByFrom:v,childrenByFrom:w,neighborsById:M,nodesById:F}};function Nr({slides:t,activeIndex:n,introOpen:s,prefersReducedMotion:r,onNext:i,onPrev:m,onSelect:u,onExit:y,onOpen:N,onRegister:S}){const l=n===t.length-1,x=s&&n===0?"entry":"docked",c=t[t.length-1],[g,v]=a.useState(!1),w=a.useMemo(()=>Array.from({length:20},($,Q)=>({src:`/cogita/logo/Cogita${String(Q).padStart(2,"0")}.png`,kind:Q<=11?"bubble":Q<=17?"text":"recreatio"})),[]),M=s&&n===0;a.useEffect(()=>{if(!s){v(!1);return}n>0&&!g&&v(!0)},[n,s,g]);const F=a.useRef(0),p=a.useRef(null),d=a.useMemo(()=>{const $={x:40,y:160},Q={x:260,y:48},se=6,j=Q.x-$.x,_=$.y-Q.y,E=j/se,U=[.3,.45,.6,.65,1.4,2.2],te=U.reduce((le,oe)=>le+oe,0),ke=U.map(le=>_*le/te),we=[$];let ze=$.x,Ne=$.y;for(let le=1;le<=se;le+=1){const oe=(Math.random()-.5)*14,Ye=(Math.random()-.5)*28;ze=Math.max($.x+le*14,Math.min(Q.x-(se-le)*14,ze+E+oe));const He=ke[le-1]??ke[ke.length-1];Ne=Ne-He+Ye;const st=Math.max(Q.y,Math.min($.y-4,Ne));we.push({x:Math.round(ze),y:Math.round(st)})}return we[we.length-1]=Q,we},[]),ie=a.useMemo(()=>{const _=(te,ke,we)=>Math.min(we,Math.max(ke,te)),E=d.map(te=>{const ke=10+Math.random()*36;return{x:_(te.x,40,260),y:_(te.y-ke,40,140)}}),U=d.map((te,ke)=>{var Ne;const we=12+Math.random()*40,ze=((Ne=E[ke])==null?void 0:Ne.y)??te.y;return{x:_(te.x,40,260),y:_(Math.max(ze+10,te.y+we),60,170)}});return{upper:E,lower:U}},[d]),K=a.useMemo(()=>{var Q;const $=((Q=d[4])==null?void 0:Q.x)??260;return Math.max(0,Math.min(240,$-40))},[d]),b=a.useMemo(()=>{var ke,we;const $=(ze,Ne,le)=>Math.min(le,Math.max(Ne,ze)),Q=(ze,Ne,le)=>d.map((oe,Ye)=>{var jt,Tt;const He=((jt=ie.upper[Ye])==null?void 0:jt.y)??oe.y,st=((Tt=ie.lower[Ye])==null?void 0:Tt.y)??oe.y,it=(Math.random()-.5)*70,yt=oe.y+ze+it,Ge=$(oe.y+Ne,He+6,st-6),tt=$(oe.y+le,He+6,st-6);return{x:oe.x,y:$(yt,Math.min(Ge,tt),Math.max(Ge,tt))}}),se=-14+Math.random()*28,j=14+Math.random()*28,_=Q(se,-80,12),E=Q(j,-12,80);for(let ze=4;ze<d.length;ze+=1){const Ne=d[ze],le=((ke=ie.upper[ze])==null?void 0:ke.y)??Ne.y,oe=((we=ie.lower[ze])==null?void 0:we.y)??Ne.y;_[ze]={x:Ne.x,y:$(Ne.y-12,le+6,oe-6)},E[ze]={x:Ne.x,y:$(Ne.y+12,le+6,oe-6)}}const U=ie.upper.length?ie.upper[ie.upper.length-1].y:40,te=ie.lower.length?ie.lower[ie.lower.length-1].y:170;return _[_.length-1]={x:d[d.length-1].x,y:$(d[d.length-1].y-14,U,te)},E[E.length-1]={x:d[d.length-1].x,y:$(d[d.length-1].y+12,U,te)},{higher:_,lower:E}},[d,ie]),O=1e4,C=a.useMemo(()=>{let $=17;const Q=()=>($=($*1664525+1013904223)%4294967296,$/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((j,_)=>{const E=(Q()-.5)*240,U=(Q()-.5)*180,te=(Q()-.5)*24;return{id:`card-${_+1}`,throw:{x:`${E.toFixed(0)}px`,y:`${U.toFixed(0)}px`,rot:`${te.toFixed(1)}deg`},grid:{x:`${j.x}px`,y:`${j.y}px`},delay:`${_*.12}s`}})},[]),Y=a.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[z,I]=a.useState([]),ue=a.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),re=a.useMemo(()=>{const Q=[],j=(E,U)=>E+Math.random()*(U-E);for(let E=0;E<6;E+=1){let U=!1;for(let te=0;te<80;te+=1){const ke=j(14,86),we=j(10,34);if(Q.every(Ne=>{const le=Ne.x-ke,oe=Ne.y-we;return Math.hypot(le,oe)>=12})){Q.push({x:ke,y:we}),U=!0;break}}U||Q.push({x:j(16,84),y:j(12,32)})}return Q.map((E,U)=>({id:`p${U+1}`,x:`${E.x.toFixed(1)}%`,y:`${E.y.toFixed(1)}%`,xNum:E.x,yNum:E.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[fe,Ce]=a.useState(0),[ye,T]=a.useState(0),[Ie,J]=a.useState([]),ee=1e4,$e=a.useMemo(()=>{if(re.length<2)return[];const $=U=>{let te=U+1831565813;return te=Math.imul(te^te>>>15,te|1),te^=te+Math.imul(te^te>>>7,te|61),((te^te>>>14)>>>0)/4294967296},Q=(U,te)=>Math.floor($(U)*te),se=new Set,j=[],_=Math.min(3,re.length);let E=0;for(;j.length<_&&E<30;){E+=1;const U=Q(fe*13+E*5,re.length),te=Q(fe*29+E*7,re.length);if(U===te)continue;const ke=U<te?`${U}-${te}`:`${te}-${U}`;se.has(ke)||(se.add(ke),j.push({id:`link-${ke}`,from:re[U],to:re[te],delay:`${(E*.35).toFixed(2)}s`}))}return j},[fe,re]);a.useEffect(()=>{if(!s||n!==2)return;const $=()=>{const se=C.map(j=>j.id);for(let j=se.length-1;j>0;j-=1){const _=Math.floor(Math.random()*(j+1));[se[j],se[_]]=[se[_],se[j]]}return se.slice(0,4)};I($());const Q=window.setInterval(()=>{I($())},O);return()=>window.clearInterval(Q)},[n,s,C,O]),a.useEffect(()=>{if(!s||n!==3)return;const $=()=>{T(Math.floor(Math.random()*ue.length)),J(re.map(()=>Math.random()<.6?"good":"bad")),Ce(se=>se+1)};$();const Q=window.setInterval($,ee);return()=>window.clearInterval(Q)},[n,s,ue.length,re,ee]);const Te=a.useMemo(()=>kr(11),[]),[G,ve]=a.useState(new Set(["root"])),[je,Ve]=a.useState(new Set),[Ue,Le]=a.useState(new Set),[qe,Ze]=a.useState({fromId:"root",toId:"root",key:0}),Re=a.useRef(G),We=a.useRef("root"),et=a.useRef(0),nt=a.useRef(null),_e=a.useRef(null),xe=a.useRef([]);a.useEffect(()=>{Re.current=G},[G]);const q=a.useMemo(()=>{const $=new Set;return G.forEach(Q=>{const se=Te.linksByFrom.get(Q);se&&se.forEach(j=>$.add(j))}),$},[G,Te]),Ae=Te.nodesById.get(qe.toId)??Te.nodesById.get("root"),ne=Ae?`${Ae.x/La.width*100}%`:"50%",B=Ae?`${Ae.y/La.height*100}%`:"90%";a.useEffect(()=>{if(!s||n!==1||r)return;(()=>{ve(new Set(["root"])),Ve(new Set),Le(new Set),Ze({fromId:"root",toId:"root",key:0}),_e.current=null,et.current=0,We.current="root",xe.current=[]})();const Q=()=>{const j=We.current,_=Re.current,U=(Te.childrenByFrom.get(j)??[]).filter(oe=>!_.has(oe));if(U.length)return U[Math.floor(Math.random()*U.length)];if(_.size>=Te.nodes.length){const oe=Te.neighborsById.get(j)??[];return oe.length?oe[Math.floor(Math.random()*oe.length)]:null}const te=oe=>(Te.childrenByFrom.get(oe)??[]).some(He=>!_.has(He)),ke=[j],we=new Set([j]),ze=new Map;let Ne=null;for(;ke.length;){const oe=ke.shift();if(!oe)break;if(oe!==j&&te(oe)){Ne=oe;break}(Te.neighborsById.get(oe)??[]).forEach(He=>{we.has(He)||(we.add(He),ze.set(He,oe),ke.push(He))})}if(!Ne)return null;let le=Ne;for(;ze.get(le)&&ze.get(le)!==j;)le=ze.get(le)??le;return le},se=(j,_)=>{if(j===_){const E=Q();E&&se(j,E);return}et.current+=1,Ze({fromId:j,toId:_,key:et.current}),We.current=_,nt.current=window.setTimeout(()=>{const E=Te.parentsById.get(_)??[],U=Re.current,te=E.filter(Ne=>!U.has(Ne));if(!te.length){const Ne=new Set(U);Ne.add(_),ve(Ne),nt.current=window.setTimeout(()=>{for(;xe.current.length;){const oe=xe.current[xe.current.length-1];if(!Ne.has(oe)){if(oe!==_){se(_,oe);return}break}xe.current.pop()}const le=Q();le&&se(_,le)},Ia.pauseMs);return}const ke=new Set([_,...te]),we=new Set(te.map(Ne=>`${Ne}-${_}`));Ve(ke),Le(we),xe.current.includes(_)||xe.current.push(_);const ze=te[Math.floor(Math.random()*te.length)];_e.current={fromId:_,toId:ze},nt.current=window.setTimeout(()=>{Ve(new Set),Le(new Set);const Ne=_e.current;Ne&&se(Ne.fromId,Ne.toId)},Ia.errorMs)},Ia.moveMs)};return nt.current=window.setTimeout(()=>{const j=Q();j&&se(We.current,j)},Ia.pauseMs),()=>{nt.current&&window.clearTimeout(nt.current)}},[n,s,Te,r]);const he=$=>{if(!s)return;const Q=Date.now();Q-F.current<520||Math.abs($.deltaY)<10||(F.current=Q,$.deltaY>0?i():m(),$.preventDefault())},Je=$=>{if(!s)return;const Q=$.touches[0];Q&&(p.current={x:Q.clientX,y:Q.clientY})},R=$=>{if(!s)return;const Q=p.current;if(p.current=null,!Q)return;const se=$.changedTouches[0];if(!se)return;const j=se.clientX-Q.x,_=se.clientY-Q.y;Math.abs(_)<40||Math.abs(_)<Math.abs(j)||(_<0?i():m())};return e.jsxs("div",{className:`cogita-intro ${s?"is-open":"is-closed"} ${r?"is-reduced":""} ${l?"is-final":""}`,"data-slide":n+1,onWheel:he,onTouchStart:Je,onTouchEnd:R,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":x,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${M&&!g?"is-entry":""}`,children:w.map(($,Q)=>e.jsx("img",{src:$.src,alt:"",className:`cogita-logo-layer ${Q===0?"is-base":""} ${$.kind==="text"?"is-text":$.kind==="recreatio"?"is-recreatio":""} ${$.kind==="bubble"?"is-bubble":""}`},$.src))})}),s&&t.map(($,Q)=>{const se=Q===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${Q+1} ${se?"is-active":""}`,"aria-hidden":!se,children:[e.jsxs("div",{className:"cogita-intro-text",children:[$.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:$.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:$.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:$.title}),$.body&&e.jsx("p",{children:$.body.split(`
`).map((j,_)=>e.jsxs("span",{children:[j,_===0&&e.jsx("br",{})]},String(_)))})]}),$.micro&&e.jsx("p",{className:"cogita-intro-micro",children:$.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:l?S:i,children:$.cta}),l&&$.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>u(0),children:$.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[Q===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${La.width} ${La.height}`,preserveAspectRatio:"none",children:[Te.links.map(j=>{const _=Te.nodesById.get(j.from),E=Te.nodesById.get(j.to);if(!_||!E)return null;const U=q.has(j.key),te=Ue.has(j.key);return e.jsx("line",{className:`map-link ${U?"is-active":""} ${te?"is-error":""}`,x1:_.x,y1:_.y,x2:E.x,y2:E.y},j.key)}),Te.nodes.map(j=>{const _=G.has(j.id),E=je.has(j.id);return e.jsx("circle",{className:`map-node ${j.role?`is-${j.role}`:""} ${_?"is-active":""} ${E?"is-error":""}`,cx:j.x,cy:j.y,r:j.r},j.id)})]}),Ae&&e.jsx("span",{className:"map-explorer-dot",style:{left:ne,top:B,"--move":`${Ia.moveMs}ms`}})]}),Q===2&&e.jsx("div",{className:"cogita-index-cards",children:C.map(j=>{const _=z.indexOf(j.id),E=_>=0?Y[_]:null,U=(E==null?void 0:E.x)??"140px",te=(E==null?void 0:E.y)??"140px",ke=_>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":j.throw.x,"--throw-y":j.throw.y,"--throw-rot":j.throw.rot,"--grid-x":j.grid.x,"--grid-y":j.grid.y,"--stack-x":U,"--stack-y":te,"--stack-opacity":ke,"--delay":j.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},j.id)})}),Q===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ue.map((j,_)=>e.jsxs("div",{className:`round-card ${_===ye?"is-active":""}`,style:{"--card-x":j.x,"--card-y":j.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},j.id)),ue[ye]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ue[ye].x,"--card-y":`calc(${ue[ye].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:re.map(j=>e.jsx("span",{className:"player-dot",style:{left:j.x,top:j.y,"--jitter-x":j.jitterX,"--jitter-y":j.jitterY,"--breath-delay":j.delay}},j.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:$e.map(j=>e.jsx("line",{className:"round-link",x1:j.from.xNum,y1:j.from.yNum,x2:j.to.xNum,y2:j.to.yNum,style:{"--delay":j.delay}},j.id))}),e.jsx("div",{className:"round-flows",children:re.map((j,_)=>{const E=Ie[_]??"good",U=ue[ye];if(!U)return null;const te=`calc(${U.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":j.x,"--from-y":j.y,"--to-x":U.x,"--to-y":te,"--delay":`${_*.12}s`}}),e.jsx("span",{className:`return-dot is-${E}`,style:{"--from-x":U.x,"--from-y":te,"--to-x":j.x,"--to-y":j.y,"--delay":`${_*.12}s`}}),e.jsx("span",{className:`result-pop is-${E}`,style:{"--at-x":j.x,"--at-y":j.y,"--delay":`${_*.12}s`}})]},`${j.id}-${fe}`)})})]},`round-${fe}`),Q===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${d[0].x} ${d[0].y} L${d[1].x} ${d[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${d[1].x} ${d[1].y} L${d[2].x} ${d[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${d[2].x} ${d[2].y} L${d[3].x} ${d[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${d[3].x} ${d[3].y} L${d[4].x} ${d[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${d[4].x} ${d[4].y} L${d[5].x} ${d[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${d[5].x} ${d[5].y} L${d[6].x} ${d[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${K};${K};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${ie.upper.map((j,_)=>`${_===0?"M":"L"}${j.x} ${j.y}`).join(" ")} ${ie.lower.slice().reverse().map(j=>`L${j.x} ${j.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${ie.upper.map((j,_)=>`${_===0?"M":"L"}${j.x} ${j.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${ie.lower.map((j,_)=>`${_===0?"M":"L"}${j.x} ${j.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[b.higher.slice(0,6).map((j,_)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${_+1}`,d:`M${j.x} ${j.y} L${b.higher[_+1].x} ${b.higher[_+1].y}`,pathLength:"100"},`peer-1-${_}`)),b.lower.slice(0,6).map((j,_)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${_+1}`,d:`M${j.x} ${j.y} L${b.lower[_+1].x} ${b.lower[_+1].y}`,pathLength:"100"},`peer-2-${_}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${d[0].x/300*100}%`,"--p0y":`${d[0].y/200*100}%`,"--p1x":`${d[1].x/300*100}%`,"--p1y":`${d[1].y/200*100}%`,"--p2x":`${d[2].x/300*100}%`,"--p2y":`${d[2].y/200*100}%`,"--p3x":`${d[3].x/300*100}%`,"--p3y":`${d[3].y/200*100}%`,"--p4x":`${d[4].x/300*100}%`,"--p4y":`${d[4].y/200*100}%`,"--p5x":`${d[5].x/300*100}%`,"--p5y":`${d[5].y/200*100}%`,"--p6x":`${d[6].x/300*100}%`,"--p6y":`${d[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${b.higher[0].x/300*100}%`,"--q0y":`${b.higher[0].y/200*100}%`,"--q1x":`${b.higher[1].x/300*100}%`,"--q1y":`${b.higher[1].y/200*100}%`,"--q2x":`${b.higher[2].x/300*100}%`,"--q2y":`${b.higher[2].y/200*100}%`,"--q3x":`${b.higher[3].x/300*100}%`,"--q3y":`${b.higher[3].y/200*100}%`,"--q4x":`${b.higher[4].x/300*100}%`,"--q4y":`${b.higher[4].y/200*100}%`,"--q5x":`${b.higher[5].x/300*100}%`,"--q5y":`${b.higher[5].y/200*100}%`,"--q6x":`${b.higher[6].x/300*100}%`,"--q6y":`${b.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${b.lower[0].x/300*100}%`,"--q0y":`${b.lower[0].y/200*100}%`,"--q1x":`${b.lower[1].x/300*100}%`,"--q1y":`${b.lower[1].y/200*100}%`,"--q2x":`${b.lower[2].x/300*100}%`,"--q2y":`${b.lower[2].y/200*100}%`,"--q3x":`${b.lower[3].x/300*100}%`,"--q3y":`${b.lower[3].y/200*100}%`,"--q4x":`${b.lower[4].x/300*100}%`,"--q4y":`${b.lower[4].y/200*100}%`,"--q5x":`${b.lower[5].x/300*100}%`,"--q5y":`${b.lower[5].y/200*100}%`,"--q6x":`${b.lower[6].x/300*100}%`,"--q6y":`${b.lower[6].y/200*100}%`}})]})})}),Q===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),Q===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},$.id)}),!s&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:c.title}),c.body&&e.jsx("p",{children:c.body}),c.micro&&e.jsx("p",{className:"cogita-intro-micro",children:c.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:c.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:N,children:"Otwórz pokaz"})]})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:t.map(($,Q)=>e.jsx("button",{type:"button",className:`dot ${n===Q?"active":""}`,"aria-label":$.title,onClick:()=>u(Q)},$.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:y,children:"Pomiń"})]})]})}const Sr=6,Tr=4;function Cr({copy:t,onAuthAction:n,authLabel:s,showProfileMenu:r,onProfileNavigate:i,onToggleSecureMode:m,onLogout:u,secureMode:y,onNavigate:N,language:S,onLanguageChange:l}){const x=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}N("home")},c=a.useRef(null),g=a.useRef([]),v=a.useMemo(()=>{let J=Date.now()%2147483647;const ee=()=>(J=J*48271%2147483647,J/2147483647);return Array.from({length:Sr},($e,Te)=>{const G=6+ee()*8,ve=7+ee()*10,je=6+ee()*9,Ve=-ee()*G,Ue=-ee()*ve,Le=-ee()*je,qe=.18+ee()*.28,Ze=12+ee()*18,Re=4+ee()*8,We=(ee()-.5)*3.2,et=(ee()-.5)*3.8,nt=ee()>.5?"alternate":"alternate-reverse",_e=ee()>.5?"alternate":"alternate-reverse",xe=ee()>.5?"alternate":"alternate-reverse",q=.18+ee()*.42,Ae=30+ee()*60,ne=-45-ee()*38,B=188+ee()*32,he=.1+ee()*.2;return{id:`wave-${Te+1}`,style:{"--wave-sway-duration":`${G}s`,"--wave-scale-duration":`${ve}s`,"--wave-drift-duration":`${je}s`,"--wave-sway-delay":`${Ve}s`,"--wave-scale-delay":`${Ue}s`,"--wave-drift-delay":`${Le}s`,"--wave-sway-dir":nt,"--wave-scale-dir":_e,"--wave-drift-dir":xe,"--wave-scale":`${qe}`,"--wave-shift":`${Ze}%`,"--wave-xshift":`${Re}%`,"--wave-x0":`${We}%`,"--wave-y0":`${et}%`,"--wave-opacity":`${q}`,"--wave-blur":`${Ae}px`,"--wave-bottom":`${ne}%`,"--wave-hue":`${B}`,"--wave-glow":`${he}`}}})},[]),w=a.useMemo(()=>{let J=Date.now()*3%2147483647;const ee=()=>(J=J*48271%2147483647,J/2147483647);return Array.from({length:Tr},($e,Te)=>{const G=180+ee()*220,ve=220+ee()*280,je=-ee()*G,Ve=-ee()*ve,Ue=.12+ee()*.22,Le=3+ee()*7,qe=1+ee()*3,Ze=(ee()-.5)*2.8,Re=(ee()-.5)*2.2;return{id:`mesh-${Te+1}`,seed:1e3+Te*991+Math.floor(ee()*999),style:{"--mesh-sway-duration":`${G}s`,"--mesh-drift-duration":`${ve}s`,"--mesh-sway-delay":`${je}s`,"--mesh-drift-delay":`${Ve}s`,"--mesh-scale":`${Ue}`,"--mesh-shift":`${Le}%`,"--mesh-xshift":`${qe}%`,"--mesh-x0":`${Re}%`,"--mesh-y0":`${Ze}%`}}})},[]),M=a.useMemo(()=>{const J=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],ee=t.cogita.introSlides,$e=new Map(ee.map(Te=>[Te.id,Te]));return J.map(Te=>{var ve;const G=$e.get(Te.id);return{...Te,...G,title:(G==null?void 0:G.title)??"Cogita",cta:(G==null?void 0:G.cta)??((ve=t.cogita.introSlides[0])==null?void 0:ve.cta)??t.cogita.loginCta,secondary:G==null?void 0:G.secondary}})},[t.cogita.introSlides]),[F,p]=a.useState(0),[d,ie]=a.useState(!0),[K,b]=a.useState(!1),O=M.length-1,C=a.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),Y=a.useCallback(()=>{C(),n()},[C,n]),z=a.useCallback(()=>{ie(!0),p(0)},[]),I=a.useCallback(()=>{ie(!1),p(O)},[O]),ue=a.useCallback(J=>{p(Math.max(0,Math.min(O,J)))},[O]),re=a.useCallback(()=>{F>=O?Y():ue(F+1)},[F,ue,Y,O]),fe=a.useCallback(()=>{ue(F-1)},[F,ue]);a.useEffect(()=>{var $e;const J=($e=window.matchMedia)==null?void 0:$e.call(window,"(prefers-reduced-motion: reduce)");if(!J)return;const ee=()=>b(J.matches);return ee(),J.addEventListener?(J.addEventListener("change",ee),()=>J.removeEventListener("change",ee)):(J.addListener(ee),()=>J.removeListener(ee))},[]),a.useEffect(()=>{if(!d)return;const J=ee=>{const $e=ee.target;if(!$e)return;const Te=$e.tagName;if(!($e.isContentEditable||Te==="INPUT"||Te==="TEXTAREA"||Te==="SELECT"||Te==="BUTTON"||Te==="A"||$e.closest('button, a, [role="button"], [role="link"]'))){if(ee.key==="Escape"){I();return}if(ee.key==="ArrowLeft"||ee.key==="ArrowUp"){fe();return}(ee.key==="ArrowRight"||ee.key==="ArrowDown"||ee.code==="Space"||ee.key===" ")&&(ee.preventDefault(),re())}};return window.addEventListener("keydown",J),()=>window.removeEventListener("keydown",J)},[I,re,fe,d]),a.useEffect(()=>{d&&F===O&&C()},[F,d,O,C]),a.useEffect(()=>{const J=c.current;if(!J)return;const ee=g.current.filter(ne=>!!ne);if(!ee.length)return;const $e=1,Te=.6,G=.6,ve=Math.max(1,Math.min($e,window.devicePixelRatio||1));let je=0,Ve=0,Ue=Te,Le=0,qe=0;const Ze=ne=>{let B=ne%2147483647;return B<=0&&(B+=2147483646),(he,Je)=>{B=B*48271%2147483647;const R=B/2147483647;return he+R*(Je-he)}},Re={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},We=ne=>{const B=Math.sin(ne*12.9898)*43758.5453;return B-Math.floor(B)},et=ne=>{const B=We(ne+.1)||1e-4,he=We(ne+.7)||1e-4;return Math.sqrt(-2*Math.log(B))*Math.cos(2*Math.PI*he)},nt=(ne,B)=>{const he=Math.floor(ne),Je=he+1,R=ne-he,$=R*R*(3-2*R),Q=We(he*12.9898+B*78.233),se=We(Je*12.9898+B*78.233);return Q+(se-Q)*$},_e=ne=>{const B=Ze(ne),he=Math.min(4,Math.max(4,Math.floor(je/1200*Re.filamentCount)));return Array.from({length:he},(Je,R)=>{const $=Math.max(-1,Math.min(1,et(ne+R*.37))),Q=Math.min(1,Math.max(0,We(ne+R*1.31))),se=Math.min(Re.depthLayers-1,Math.floor(Q*Re.depthLayers));return{seed:B(0,Math.PI*2)+ne*.01,offset:$,freqA:Re.freq1*(.75+B(0,.5)),freqB:Re.freq2*(.75+B(0,.5)),ampA:Re.amp1*(.6+B(0,.7)),ampB:Re.amp2*(.6+B(0,.7)),width:2+R%5*.32,depth:Q,layer:se}})},xe=(ne,B,he)=>{const Je=Math.max(30,Math.floor(je*Ve/14e4));ne.save(),ne.globalAlpha=.6;for(let R=0;R<Je;R+=1){const $=We(R*9.1+je*.11)*B+he,Q=We(R*3.7+Ve*.23)*Ve,se=1.2+We(R*5.9)*2.4,j=ne.createRadialGradient($,Q,0,$,Q,se*2);j.addColorStop(0,"rgba(10, 30, 60, 0.45)"),j.addColorStop(1,"rgba(10, 30, 60, 0)"),ne.fillStyle=j,ne.beginPath(),ne.arc($,Q,se*2,0,Math.PI*2),ne.fill()}ne.restore()},q=(ne,B)=>{ne.clearRect(0,0,je,Ve);const he=Ve*Re.waveCenter,Je=Re.waveBandPx,R=Re.segments,$=Re.colors.filaments,Q=Le||je,se=0;xe(ne,Q,se),ne.strokeStyle=$,ne.lineCap="round",ne.lineJoin="round";for(let j=0;j<B.length;j+=1){const _=B[j],E=_.offset*Je*(.85+We(_.seed)*.4),U=1-Math.min(1,Math.abs(E)/Je),te=Math.exp(-Math.pow(E/Re.crestThickness,2)),ke=_.layer===0?1.1:_.layer===1?.85:.6,we=.35+(1-_.depth)*.65,ze=U*we*ke*(.34+te*.45);ne.globalAlpha=ze,ne.lineWidth=_.width*(1+(1-_.depth)*.8);const Ne=[];for(let oe=0;oe<=R;oe+=1){const Ye=oe/R*Q+se,He=(nt(Ye*.012,_.seed)-.5)*Re.xJitter,st=Ye+He,it=(nt(st*_.freqA,_.seed)-.5)*Re.jitterA,yt=(nt(st*_.freqB,_.seed*1.7)-.5)*Re.jitterB,Ge=he+Math.sin(st*_.freqA+_.seed)*_.ampA+Math.sin(st*_.freqB+_.seed*1.3)*_.ampB+E+it+yt;Ne.push({x:st,y:Ge})}ne.beginPath(),ne.moveTo(Ne[0].x,Ne[0].y);for(let oe=1;oe<Ne.length-1;oe+=1){const Ye=(Ne[oe].x+Ne[oe+1].x)/2,He=(Ne[oe].y+Ne[oe+1].y)/2;ne.quadraticCurveTo(Ne[oe].x,Ne[oe].y,Ye,He)}const le=Ne[Ne.length-1];ne.quadraticCurveTo(le.x,le.y,le.x,le.y),ne.stroke()}ne.save(),ne.globalCompositeOperation="lighter",ne.strokeStyle=Re.colors.glow,ne.lineCap="round",ne.lineJoin="round";for(let j=0;j<B.length;j+=1){const _=B[j];if(Math.abs(_.offset)*Je>Re.crestThickness)continue;const E=Re.glowAlpha*(.7+(1-_.depth)*.6);ne.globalAlpha=E,ne.lineWidth=1.6+(1-_.depth)*1.2;const U=[];for(let ke=0;ke<=R;ke+=1){const we=ke/R*Q+se,ze=Math.sin(we*.02+_.seed)*3,Ne=he+Math.sin(we*_.freqA+_.seed)*_.ampA+Math.sin(we*_.freqB+_.seed*1.3)*_.ampB+_.offset*Je*.35+ze;U.push({x:we,y:Ne})}ne.beginPath(),ne.moveTo(U[0].x,U[0].y);for(let ke=1;ke<U.length-1;ke+=1){const we=(U[ke].x+U[ke+1].x)/2,ze=(U[ke].y+U[ke+1].y)/2;ne.quadraticCurveTo(U[ke].x,U[ke].y,we,ze)}const te=U[U.length-1];ne.quadraticCurveTo(te.x,te.y,te.x,te.y),ne.stroke()}ne.restore()},Ae=()=>{je=Math.floor(J.clientWidth),Ve=Math.floor(J.clientHeight),Le=Math.floor(je*1.8),qe=Ve,Ue=je<820?G:Te,ee.forEach(ne=>{const B=ne.getContext("2d");if(!B)return;ne.width=Math.floor(Le*ve*Ue),ne.height=Math.floor(qe*ve*Ue),ne.style.width=`${Le}px`,ne.style.height=`${qe}px`,ne.style.left=`${-(Le-je)/2}px`,B.setTransform(ve*Ue,0,0,ve*Ue,0,0);const he=Number(ne.dataset.seed||1),Je=_e(he);q(B,Je)})};return Ae(),window.addEventListener("resize",Ae,{passive:!0}),()=>window.removeEventListener("resize",Ae)},[w]);const Ce=M[Math.min(F,M.length-1)],ye=d?Ce:M[M.length-1],T=(ye==null?void 0:ye.theme)??M[0].theme,Ie={"--cogita-bg0":T.bg0,"--cogita-bg1":T.bg1,"--cogita-bg2":T.bg2,"--cogita-bloom":T.bloom,"--cogita-sat":T.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:x,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(ks,{value:S,onChange:l}),e.jsx(Ns,{copy:t,label:s,isAuthenticated:r,secureMode:y,onLogin:n,onProfileNavigate:i,onToggleSecureMode:m,onLogout:u,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:c,className:"cogita-section cogita-home",style:Ie,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[w.map((J,ee)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:J.style,"data-seed":J.seed,ref:$e=>{g.current[ee]=$e}},J.id)),v.map(J=>e.jsx("div",{className:"cogita-home-wave",style:J.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},J.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Nr,{slides:M,activeIndex:F,introOpen:d,prefersReducedMotion:K,onNext:re,onPrev:fe,onSelect:ue,onExit:I,onOpen:z,onRegister:Y})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const Pi=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Cr},Symbol.toStringTag,{value:"Module"})),Rs=a.createContext(!1);function At({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,headerExtra:l,children:x}){if(a.useContext(Rs))return e.jsx(e.Fragment,{children:x});const g=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}y("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:g,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(ks,{value:N,onChange:S}),e.jsxs("div",{className:"cogita-header-right",children:[l,e.jsx(Ns,{copy:t,label:n,isAuthenticated:s,secureMode:u,onLogin:()=>y("home"),onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,variant:"ghost"})]})]}),e.jsx("main",{className:"cogita-main",children:x}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}function sa(t){const[n,s]=a.useState("Cogita library"),[r,i]=a.useState(null);return a.useEffect(()=>{let m=!1;return Ss().then(u=>{if(m)return;const y=u.find(N=>N.libraryId===t);y&&s(y.name)}).catch(()=>{m||s("Cogita library")}),()=>{m=!0}},[t]),a.useEffect(()=>{let m=!1;return Us(t).then(u=>{m||i(u)}).catch(()=>{m||i(null)}),()=>{m=!0}},[t]),{libraryName:n,stats:r}}function Gn({slices:t}){const n=t.reduce((r,i)=>r+Math.max(0,i.value),0),s=a.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let r=0;return`conic-gradient(${t.map(m=>{const y=Math.max(0,m.value)/n*360,N=r,S=r+y;return r=S,`${m.color} ${N}deg ${S}deg`}).join(",")})`},[t,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:s}}),e.jsx("div",{className:"cogita-overview-legend",children:t.map(r=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:r.color}}),e.jsx("strong",{children:r.value}),e.jsx("small",{children:r.label})]},r.label))})]})}function Mr({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l}){const{libraryName:x,stats:c}=sa(l),[g,v]=a.useState("infos"),[w,M]=a.useState(0),[F,p]=a.useState(0),[d,ie]=a.useState(0),K=(c==null?void 0:c.totalInfos)??0,b=(c==null?void 0:c.totalCollections)??0,O=0,C=0,Y=0,z=Math.max(0,K-Y-F),I=Math.max(0,K-F-d);a.useEffect(()=>{let re=!1;return(async()=>{try{const Ce=await Aa({libraryId:l,limit:200}),ye=await Promise.all(Ce.items.map(T=>Ts({libraryId:l,collectionId:T.collectionId}).catch(()=>[])));if(re)return;M(ye.reduce((T,Ie)=>T+Ie.length,0))}catch{re||M(0)}})(),()=>{re=!0}},[l]),a.useEffect(()=>{let re=!1;return(async()=>{try{const[Ce,ye,T]=await Promise.all([qn({libraryId:l,type:"computed",limit:1}).catch(()=>({total:0})),qn({libraryId:l,type:"source",limit:1}).catch(()=>({total:0})),An({libraryId:l}).catch(()=>({items:[]}))]);if(re)return;p((Ce.total??0)+(ye.total??0));const Ie=new Set(T.items.filter(J=>J.childItemType.toLowerCase()==="info").map(J=>J.childItemId).filter(Boolean));ie(Ie.size)}catch{re||(p(0),ie(0))}})(),()=>{re=!0}},[l]);const ue=[{key:"infos",label:t.cogita.library.overview.stats.totalInfos,value:K},{key:"collections",label:t.cogita.library.overview.stats.collections,value:b},{key:"revisions",label:t.cogita.library.overview.stats.revisions,value:w},{key:"storyboards",label:t.cogita.library.overview.stats.storyboards,value:O},{key:"texts",label:t.cogita.library.overview.stats.texts,value:C}];return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:x})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ue.map(re=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${g===re.key?"active":""}`,onClick:()=>v(re.key),children:[e.jsx("span",{children:re.label}),e.jsx("strong",{children:re.value})]},re.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:t.cogita.library.overview.statsCardTitle})}),g==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.knownChartTitle}),e.jsx(Gn,{slices:[{label:t.cogita.library.overview.known,value:Y,color:"#75d79a"},{label:t.cogita.library.overview.unknown,value:z,color:"#85b9ff"},{label:t.cogita.library.overview.excluded,value:F,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.checksChartTitle}),e.jsx(Gn,{slices:[{label:t.cogita.library.overview.availableChecks,value:d,color:"#75d79a"},{label:t.cogita.library.overview.unavailableChecks,value:I,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:t.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]})]})})]})})}const Xe=(t,n)=>{const s=t.cogita.library.infoTypes,r=t.cogita.library.connectionTypes,i=t.cogita.library.groupTypes;return{any:s.any,vocab:s.vocab,book:i.book,citation:i.citation,language:s.language,word:s.word,sentence:s.sentence,topic:s.topic,collection:s.collection,person:s.person,institution:s.institution,collective:s.collective,orcid:s.orcid,address:s.address,email:s.email,phone:s.phone,media:s.media,work:s.work,geo:s.geo,music_piece:s.musicPiece,music_fragment:s.musicFragment,source:s.source,computed:s.computed,"word-language":r.wordLanguage,"citation-language":r.citationLanguage,"language-sentence":r.languageSentence,translation:r.translation,"word-topic":r.wordTopic,reference:r.reference,"source-resource":r.sourceResource,"work-contributor":r.workContributor,"work-medium":r.workMedium,"orcid-link":r.orcidLink}[n]??String(n)},Ir=t=>[{value:"any",label:Xe(t,"any")},{value:"language",label:Xe(t,"language")},{value:"word",label:Xe(t,"word")},{value:"sentence",label:Xe(t,"sentence")},{value:"topic",label:Xe(t,"topic")},{value:"collection",label:Xe(t,"collection")},{value:"person",label:Xe(t,"person")},{value:"institution",label:Xe(t,"institution")},{value:"collective",label:Xe(t,"collective")},{value:"orcid",label:Xe(t,"orcid")},{value:"address",label:Xe(t,"address")},{value:"email",label:Xe(t,"email")},{value:"phone",label:Xe(t,"phone")},{value:"media",label:Xe(t,"media")},{value:"work",label:Xe(t,"work")},{value:"geo",label:Xe(t,"geo")},{value:"music_piece",label:Xe(t,"music_piece")},{value:"music_fragment",label:Xe(t,"music_fragment")},{value:"source",label:Xe(t,"source")},{value:"citation",label:Xe(t,"citation")},{value:"computed",label:Xe(t,"computed")},{value:"vocab",label:Xe(t,"vocab")},{value:"book",label:Xe(t,"book")},{value:"word-language",label:Xe(t,"word-language")},{value:"citation-language",label:Xe(t,"citation-language")},{value:"language-sentence",label:Xe(t,"language-sentence")},{value:"translation",label:Xe(t,"translation")},{value:"word-topic",label:Xe(t,"word-topic")},{value:"reference",label:Xe(t,"reference")},{value:"source-resource",label:Xe(t,"source-resource")},{value:"work-contributor",label:Xe(t,"work-contributor")},{value:"work-medium",label:Xe(t,"work-medium")},{value:"orcid-link",label:Xe(t,"orcid-link")}],Lr=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}],hn={key:"languageId",labelKey:"language",kind:"select",path:"languageId",optionsSource:"languages",matcher:"equals"},$r={language:{infoType:"language",entityKind:"single",structure:{payloadFields:["label","name","code"]},filterFields:[]},word:{infoType:"word",entityKind:"single",structure:{payloadFields:["label","lemma","languageId"],connections:[{relationType:"word-language",role:"language",targetType:"language"}]},filterFields:[hn]},sentence:{infoType:"sentence",entityKind:"single",structure:{payloadFields:["label","text","languageId"],connections:[{relationType:"language-sentence",role:"language",targetType:"language"}]},filterFields:[hn]},topic:{infoType:"topic",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},collection:{infoType:"collection",entityKind:"complex",structure:{payloadFields:["label","name"]},filterFields:[]},person:{infoType:"person",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},institution:{infoType:"institution",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},collective:{infoType:"collective",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},orcid:{infoType:"orcid",entityKind:"single",structure:{payloadFields:["label","orcid"]},filterFields:[{key:"orcid",label:"ORCID",kind:"text",path:"orcid",matcher:"contains"}]},address:{infoType:"address",entityKind:"single",structure:{payloadFields:["label","street","city","postalCode","country"]},filterFields:[]},email:{infoType:"email",entityKind:"single",structure:{payloadFields:["label","email","address"]},filterFields:[]},phone:{infoType:"phone",entityKind:"single",structure:{payloadFields:["label","phone","number"]},filterFields:[]},media:{infoType:"media",entityKind:"single",structure:{payloadFields:["label","name","url","kind"]},filterFields:[]},work:{infoType:"work",entityKind:"single",structure:{payloadFields:["label","title","subtitle","doi","isbn","issn","languageId","originalLanguageId"]},filterFields:[hn,{key:"originalLanguageId",labelKey:"originalLanguage",kind:"select",path:"originalLanguageId",optionsSource:"languages",matcher:"equals"},{key:"doi",labelKey:"doi",kind:"text",path:"doi",matcher:"contains"}]},geo:{infoType:"geo",entityKind:"single",structure:{payloadFields:["label","name","country","region","city"]},filterFields:[]},music_piece:{infoType:"music_piece",entityKind:"single",structure:{payloadFields:["label","title","composer"]},filterFields:[]},music_fragment:{infoType:"music_fragment",entityKind:"single",structure:{payloadFields:["label","title","text"]},filterFields:[]},source:{infoType:"source",entityKind:"single",structure:{payloadFields:["label","title","sourceKind","locator"],connections:[{relationType:"source-resource",role:"resource",targetType:"work"}]},filterFields:[{key:"sourceKind",labelKey:"sourceKind",kind:"select",path:"sourceKind",optionsSource:"sourceKinds",matcher:"equals"},{key:"locator",labelKey:"locator",kind:"text",path:"locator",matcher:"locator_contains"}]},citation:{infoType:"citation",entityKind:"single",structure:{payloadFields:["title","text"],connections:[{relationType:"citation-language",role:"language",targetType:"language"},{relationType:"reference",role:"source",targetType:"source"}]},filterFields:[{key:"text",labelKey:"citationText",kind:"text",path:"text",matcher:"contains"}]},computed:{infoType:"computed",entityKind:"complex",structure:{payloadFields:["label","title","definition"]},filterFields:[]},translation:{infoType:"translation",entityKind:"connection",structure:{payloadFields:["note","tagIds"],connections:[{relationType:"translation",role:"wordA",targetType:"word"},{relationType:"translation",role:"wordB",targetType:"word"},{relationType:"word-language",role:"languageA",targetType:"language"},{relationType:"word-language",role:"languageB",targetType:"language"}]},filterFields:[{key:"languageAId",labelKey:"languageA",kind:"select",optionsSource:"languages",matcher:"equals"},{key:"languageBId",labelKey:"languageB",kind:"select",optionsSource:"languages",matcher:"equals"}]}},Yn={infoType:"default",entityKind:"single",structure:{payloadFields:["label"]},filterFields:[]};function Rr(t){return t?$r[t]??Yn:Yn}function Ar(t,n){return t.optionsSource==="languages"?n.languages.map(s=>({value:s.infoId,label:s.label})):t.optionsSource==="sourceKinds"?Lr:[]}const Er="cogita.revision.seed:";function As(t){return`${Er}${t}`}function Pr(t,n){if(typeof window>"u")return null;const s=Array.from(new Set(n.map(m=>m.trim()).filter(Boolean)));if(!s.length)return null;const r=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,i={kind:"info-selection",libraryId:t,infoIds:s,createdAt:new Date().toISOString()};return window.localStorage.setItem(As(r),JSON.stringify(i)),r}function Qn(t,n){if(typeof window>"u")return null;const s=window.localStorage.getItem(As(n));if(!s)return null;try{const r=JSON.parse(s);if(r.kind!=="info-selection"||r.libraryId!==t||!Array.isArray(r.infoIds))return null;const i=r.infoIds.map(m=>String(m??"").trim()).filter(Boolean);return i.length?{infoIds:i}:null}catch{return null}}const mn=60,Kr=500;function Es(t){return`cogita.info-selection:${t}`}function Xn(t){if(typeof window>"u")return{};const n=window.localStorage.getItem(Es(t));if(!n)return{};try{const s=JSON.parse(n);return!s||typeof s!="object"?{}:s}catch{return{}}}function Fr({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l,mode:x}){var xt;const c=In(),g=tn(),v=t.cogita.library.list,[w,M]=a.useState("any"),[F,p]=a.useState(""),[d,ie]=a.useState("relevance"),[K,b]=a.useState("details"),[O,C]=a.useState(!1),[Y,z]=a.useState("idle"),[I,ue]=a.useState([]),[re,fe]=a.useState(mn),[Ce,ye]=a.useState(null),[T,Ie]=a.useState(()=>Xn(l)),[J,ee]=a.useState({}),[$e,Te]=a.useState([]),[G,ve]=a.useState(null),[je,Ve]=a.useState(null),[Ue,Le]=a.useState(null),[qe,Ze]=a.useState("idle"),[Re,We]=a.useState([]),[et,nt]=a.useState(""),[_e,xe]=a.useState(null),[q,Ae]=a.useState("idle"),[ne,B]=a.useState(null),[he,Je]=a.useState(null),[R,$]=a.useState("idle"),Q=a.useMemo(()=>Ir(t),[t]),se=a.useMemo(()=>[{value:"relevance",label:v.sortRelevance},{value:"label_asc",label:v.sortLabelAsc},{value:"label_desc",label:v.sortLabelDesc},{value:"type_asc",label:v.sortTypeAsc},{value:"type_desc",label:v.sortTypeDesc}],[v.sortLabelAsc,v.sortLabelDesc,v.sortRelevance,v.sortTypeAsc,v.sortTypeDesc]);a.useEffect(()=>{Ie(Xn(l)),ee({}),C(!1)},[l]),a.useEffect(()=>{An({libraryId:l}).then(k=>Le(k)).catch(()=>Le({items:[]}))},[l]),a.useEffect(()=>{Js({libraryId:l}).then(k=>We(k)).catch(()=>We([]))},[l]),a.useEffect(()=>{Un({libraryId:l,type:"language",filters:{sourceKind:"info"},limit:200}).then(k=>{const pe=k.map(Be=>({infoId:Be.infoId??"",infoType:Be.entityType,label:Be.title})).filter(Be=>Be.infoId.length>0);Te(pe)}).catch(()=>Te([]))},[l]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Es(l),JSON.stringify(T))},[l,T]);const j=a.useMemo(()=>Rr(w==="any"?null:w),[w]),_=a.useMemo(()=>new URLSearchParams(g.search),[g.search]),E=a.useMemo(()=>g.pathname.split("/").filter(Boolean),[g.pathname]),U=E.findIndex(k=>k==="infos"),te=U>=0&&(E[U+1]??"").trim()||null,ke=U>=0?(E[U+2]??"").trim()==="checkcards"?"cards":"overview":"",we=te??((_.get("infoId")??"").trim()||null),ze=te?ke:(_.get("infoView")??"overview").trim(),Ne=ze==="overview"&&!!we,le=a.useMemo(()=>({language:v.typeFilterLanguage,languageA:v.typeFilterLanguageA,languageB:v.typeFilterLanguageB,originalLanguage:v.typeFilterOriginalLanguage,doi:v.typeFilterDoi,sourceKind:v.typeFilterSourceKind,locator:v.typeFilterLocator,citationText:v.typeFilterCitationText}),[v.typeFilterDoi,v.typeFilterLanguage,v.typeFilterLanguageA,v.typeFilterLanguageB,v.typeFilterLocator,v.typeFilterOriginalLanguage,v.typeFilterCitationText,v.typeFilterSourceKind]),oe=a.useMemo(()=>j.filterFields.map(k=>({...k,label:k.labelKey?le[k.labelKey]:k.label??k.key,options:Ar(k,{languages:$e})})),[le,$e,j.filterFields]),Ye=a.useMemo(()=>oe.some(k=>(J[k.key]??"").trim().length>0),[oe,J]);a.useEffect(()=>{ee({})},[w]),a.useEffect(()=>{const k={sourceKind:"info"};if(Ye)for(const Be of oe){const h=(J[Be.key]??"").trim();h&&(k[Be.path??Be.key]=h)}z("loading");const pe=window.setTimeout(()=>{Un({libraryId:l,type:w==="any"?void 0:w,query:F.trim()||void 0,filters:k,limit:Kr}).then(Be=>{const h=Be.map(Me=>({infoId:Me.infoId??"",infoType:Me.entityType,label:Me.title})).filter(Me=>Me.infoId.length>0);ue(h),z("ready")}).catch(()=>{ue([]),z("ready")})},240);return()=>window.clearTimeout(pe)},[Ye,l,F,w,oe,J]),a.useEffect(()=>{if(!we||ze!=="overview"){ve(null),Ve(null),Ze("idle");return}let k=!1;return Ze("loading"),Promise.all([Qt({libraryId:l,infoId:we}),Hs({libraryId:l,itemType:"info",itemId:we}).catch(()=>null)]).then(([pe,Be])=>{k||(ve(pe),Ve(Be),Ze("ready"))}).catch(()=>{k||(ve(null),Ve(null),Ze("error"))}),()=>{k=!0}},[l,we,ze]),a.useEffect(()=>{if(!we||ze!=="overview"){B(null),Je(null),$("idle");return}let k=!1;return $("loading"),Promise.all([Va({libraryId:l,infoId:we}),Oa({libraryId:l,infoId:we})]).then(([pe,Be])=>{k||(B(pe),Je(Be),$("ready"))}).catch(()=>{k||(B(null),Je(null),$("error"))}),()=>{k=!0}},[l,we,ze]);const He=a.useMemo(()=>G?Re.filter(k=>k.sourceInfoTypes.some(pe=>pe.toLowerCase()===G.infoType.toLowerCase())):[],[Re,G]);a.useEffect(()=>{if(!G){nt("");return}nt(k=>{var pe;return k&&He.some(Be=>Be.approachKey===k)?k:((pe=He[0])==null?void 0:pe.approachKey)??""})},[He,G]),a.useEffect(()=>{if(!G||!et){xe(null),Ae("idle");return}let k=!1;return Ae("loading"),Cs({libraryId:l,infoId:G.infoId,approachKey:et}).then(pe=>{k||(xe(pe),Ae("ready"))}).catch(()=>{k||(xe(null),Ae("error"))}),()=>{k=!0}},[l,et,G]);const st=a.useMemo(()=>{const k=I.slice(),pe=Be=>Xe(t,Be);return d==="relevance"?k:d==="label_asc"?k.sort((Be,h)=>Be.label.localeCompare(h.label)):d==="label_desc"?k.sort((Be,h)=>h.label.localeCompare(Be.label)):d==="type_asc"?k.sort((Be,h)=>Be.infoType===h.infoType?Be.label.localeCompare(h.label):pe(Be.infoType).localeCompare(pe(h.infoType))):k.sort((Be,h)=>Be.infoType===h.infoType?Be.label.localeCompare(h.label):pe(h.infoType).localeCompare(pe(Be.infoType)))},[t,I,d]),it=a.useMemo(()=>st.slice(0,re),[st,re]),yt=it.length<st.length,Ge=a.useMemo(()=>new Set(Object.keys(T)),[T]),tt=a.useMemo(()=>Object.values(T),[T]),jt=a.useMemo(()=>{const k=new Map;for(const pe of tt)k.set(pe.infoType,(k.get(pe.infoType)??0)+1);return Array.from(k.entries()).sort((pe,Be)=>Be[1]-pe[1]||pe[0].localeCompare(Be[0]))},[tt]),Tt=a.useMemo(()=>{if(!we||!Ue)return 0;const k=new Set;for(const pe of Ue.items)pe.childItemType!=="info"||pe.childItemId!==we||k.add([pe.parentItemType,pe.parentItemId,pe.parentCheckType??"",pe.parentDirection??""].join("|"));return k.size},[Ue,we]);a.useEffect(()=>{fe(mn);const k=new Set(I.map(pe=>pe.infoId));ye(pe=>pe&&k.has(pe)?pe:null)},[I]);const It=k=>{Ie(pe=>({...pe,[k.infoId]:{infoId:k.infoId,infoType:k.infoType,label:k.label}}))},Et=k=>{Ie(pe=>{if(!pe[k])return pe;const Be={...pe};return delete Be[k],Be})},gt=(k,pe)=>{if(pe){It(k);return}Et(k.infoId)},Ut=k=>{c(`/cogita/library/${l}/infos/${encodeURIComponent(k)}`,{replace:!0})},ft=()=>{c(`/cogita/library/${l}/list`,{replace:!0})},Zt=()=>{we&&c(`/cogita/library/${l}/edit/${encodeURIComponent(we)}`,{replace:!0})},ht=()=>{const k=Pr(l,tt.map(pe=>pe.infoId));k&&c(`/cogita/library/${l}/revision/run?scope=info-selection&seed=${encodeURIComponent(k)}`)},vt=tt.length===1?((xt=tt[0])==null?void 0:xt.infoId)??null:null,zt=v.selectionCount.replace("{count}",String(tt.length)),Ct=x==="collection"?"grid":x==="detail"?"wide":K,Fe=Br(N),mt=je?Math.max(0,Math.min(100,Math.round((je.score??0)*100))):0,wt=je?_r(je,Fe):Fe.noKnownnessData;return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":Ct,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[Ne?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:Fe.kicker}),e.jsx("h2",{className:"cogita-card-title",children:G?Dr(G.payload,G.infoType,G.infoId):Fe.loading}),G?e.jsxs("p",{className:"cogita-card-subtitle",children:[Xe(t,G.infoType)," · ",G.infoId]}):null]}),e.jsxs("div",{className:"cogita-info-overview-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:ft,children:Fe.backToSearch}),e.jsx("button",{type:"button",className:"cta",onClick:Zt,disabled:!we||qe!=="ready",children:v.editInfo})]})]}),qe==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:Fe.loading})}):qe==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:Fe.loadError})}):G?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-info-overview-metrics",children:[e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:Fe.knownness}),e.jsxs("div",{className:"cogita-info-metric-value",children:[mt,"%"]}),e.jsx("div",{className:"cogita-info-progress","aria-hidden":"true",children:e.jsx("span",{style:{width:`${mt}%`}})}),e.jsx("p",{className:"cogita-library-hint",children:wt})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:Fe.reviews}),e.jsx("div",{className:"cogita-info-metric-value",children:(je==null?void 0:je.totalReviews)??0}),e.jsx("p",{className:"cogita-library-hint",children:Fe.correct.replace("{correct}",String((je==null?void 0:je.correctReviews)??0)).replace("{total}",String((je==null?void 0:je.totalReviews)??0))}),e.jsx("p",{className:"cogita-library-hint",children:je!=null&&je.lastReviewedUtc?`${Fe.lastReview}: ${zr(je.lastReviewedUtc,N)}`:Fe.noLastReview})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:Fe.linkedCards}),e.jsx("div",{className:"cogita-info-metric-value",children:Tt}),e.jsx("p",{className:"cogita-library-hint",children:Fe.linkedCardsHint})]})]}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:Fe.checkcards}),R==="loading"?e.jsx("p",{className:"cogita-library-hint",children:Fe.loadingCheckcards}):R==="error"?e.jsx("p",{className:"cogita-library-hint",children:Fe.loadCheckcardsError}):e.jsxs("div",{className:"cogita-info-tree",children:[e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:Fe.checkcardCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(ne==null?void 0:ne.items.length)??0})]}),e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:Fe.dependencyCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(he==null?void 0:he.items.length)??0})]})]})]}),He.length>0?e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsxs("div",{className:"cogita-info-approach-header",children:[e.jsx("h3",{children:Fe.approach}),e.jsx("select",{value:et,onChange:k=>nt(k.target.value),"aria-label":Fe.approach,children:He.map(k=>e.jsx("option",{value:k.approachKey,children:k.label},k.approachKey))})]}),q==="loading"?e.jsx("p",{className:"cogita-library-hint",children:Fe.loadingApproach}):q==="error"?e.jsx("p",{className:"cogita-library-hint",children:Fe.loadApproachError}):_e?e.jsx(Ua,{value:_e.projection,emptyLabel:Fe.empty}):e.jsx("p",{className:"cogita-library-hint",children:Fe.noApproachData})]}):null,e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:Fe.payload}),e.jsx(Ua,{value:G.payload,emptyLabel:Fe.empty})]}),e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:Fe.links}),e.jsx(Vr,{links:G.links,emptyLabel:Fe.noLinks})]})]})]}):null]})}):null,Ne?null:e.jsxs("section",{className:"cogita-library-search-surface",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":v.typeLabel,value:w,onChange:k=>M(k.target.value),children:Q.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))}),e.jsx("input",{type:"text",value:F,onChange:k=>p(k.target.value),placeholder:v.searchPlaceholder}),e.jsx("select",{"aria-label":v.sortLabel,value:d,onChange:k=>ie(k.target.value),children:se.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))}),e.jsxs("select",{"aria-label":v.viewLabel,value:K,onChange:k=>b(k.target.value),children:[e.jsx("option",{value:"details",children:v.viewDetails}),e.jsx("option",{value:"wide",children:v.viewWide}),e.jsx("option",{value:"grid",children:v.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:v.cardCount.replace("{shown}",String(it.length)).replace("{total}",String(st.length))}),e.jsx("span",{children:Y==="loading"?v.loading:v.ready})]}),e.jsxs("div",{className:"cogita-filters-toggle-row",children:[e.jsx("button",{type:"button",className:"ghost cogita-filters-toggle",onClick:()=>C(k=>!k),children:O?v.hideFilters:v.showFilters}),e.jsx("span",{className:"cogita-sidebar-note",children:v.filtersOptionalHint})]}),O&&oe.length>0?e.jsx("section",{className:"cogita-library-filters cogita-library-filters--compact",children:e.jsx("div",{className:"cogita-filter-grid",children:oe.map(k=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:k.label}),k.kind==="select"?e.jsxs("select",{value:J[k.key]??"",onChange:pe=>ee(Be=>({...Be,[k.key]:pe.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),(k.options??[]).map(pe=>e.jsx("option",{value:pe.value,children:pe.label},`${k.key}:${pe.value}`))]}):e.jsx("input",{type:"text",value:J[k.key]??"",onChange:pe=>ee(Be=>({...Be,[k.key]:pe.target.value}))})]},`type-filter:${k.key}`))})}):null,e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:zt}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{Ie(k=>{const pe={...k};for(const Be of it)pe[Be.infoId]={infoId:Be.infoId,infoType:Be.infoType,label:Be.label};return pe})},disabled:it.length===0,children:v.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Ie({}),disabled:tt.length===0,children:v.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>vt&&Ut(vt),disabled:!vt,title:vt?void 0:v.openSelectedDisabled,children:v.openSelected}),e.jsx("button",{type:"button",className:"cta",onClick:ht,disabled:tt.length===0,children:"Start revision"})]})]}),tt.length>0?e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:v.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:v.selectedStackHint}),e.jsx("div",{className:"cogita-selection-overview",children:jt.map(([k,pe])=>e.jsxs("span",{className:"cogita-tag-chip",children:[e.jsx("span",{children:Xe(t,k)}),e.jsx("span",{className:"cogita-tag-count",children:pe})]},`stack:type:${k}`))})]}):null,Ct==="details"?e.jsxs("div",{className:"cogita-details-grid",role:"table","aria-label":v.searchTitle,children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:v.detailColumnName}),e.jsx("span",{children:v.detailColumnType}),e.jsx("span",{children:v.detailColumnId}),e.jsx("span",{})]}),it.length?it.map(k=>{const pe=Xe(t,k.infoType),Be=Ge.has(k.infoId),h=Ce===k.infoId;return e.jsxs("div",{className:`cogita-details-row ${h||Be?"active":""}`,role:"row",onClick:()=>ye(k.infoId),children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:Be,onChange:Me=>gt(k,Me.target.checked),onClick:Me=>Me.stopPropagation()}),e.jsx("span",{})]}),e.jsx("span",{title:k.label,children:k.label}),e.jsx("span",{title:pe,children:pe}),e.jsx("span",{title:k.infoId,children:k.infoId}),e.jsx("button",{type:"button",className:"ghost cogita-details-open",onClick:Me=>{Me.stopPropagation(),Ut(k.infoId)},"aria-label":v.editInfo,children:">"})]},k.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:v.noMatch})})]}):e.jsx("div",{className:`cogita-card-list cogita-card-list--${Ct}`,"data-view":Ct,children:it.length?it.map(k=>{const pe=Xe(t,k.infoType),Be=Ge.has(k.infoId),h=Ce===k.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":h||Be,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:Be,onChange:Me=>gt(k,Me.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>ye(k.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:pe}),e.jsx("h3",{className:"cogita-card-title",children:k.label}),e.jsx("p",{className:"cogita-card-subtitle",children:k.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Ut(k.infoId),children:v.editInfo})]})},k.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:v.noMatch})})}),yt?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>fe(k=>k+mn),children:v.loadMore})}):null]})]})})})})}function Dr(t,n,s){if(t&&typeof t=="object"&&!Array.isArray(t)){const r=t,i=["title","name","label","value","text","quote","term"];for(const m of i){const u=r[m];if(typeof u=="string"&&u.trim())return u.trim()}}return`${n} · ${s}`}function zr(t,n){try{const s=n==="pl"?"pl-PL":n==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(s,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}catch{return t}}function Br(t){return t==="pl"?{kicker:"Informacja",backToSearch:"Wróć do wyszukiwania",loading:"Ładowanie informacji...",loadError:"Nie udało się wczytać informacji.",knownness:"Znajomość",reviews:"Sprawdzenia",correct:"Poprawne: {correct} / {total}",lastReview:"Ostatnie sprawdzenie",noLastReview:"Brak sprawdzeń",linkedCards:"Powiązane karty",linkedCardsHint:"Karty sprawdzające zależne od tej informacji",payload:"Treść informacji",links:"Powiązania",empty:"Brak danych",noLinks:"Brak powiązań",checkcards:"Karty sprawdzające",loadingCheckcards:"Ładowanie kart sprawdzających...",loadCheckcardsError:"Nie udało się wczytać kart sprawdzających.",noCheckcards:"Brak kart sprawdzających.",checkcardCount:"Liczba kart",dependencyCount:"Zależności (efektywne)",approach:"Podejście",loadingApproach:"Ładowanie widoku...",loadApproachError:"Nie udało się wczytać widoku.",noApproachData:"Brak danych widoku.",noKnownnessData:"Brak danych o znajomości",developmentStart:"Początek nauki",developmentGrowing:"Rozwój w toku",developmentStable:"Utrwalona wiedza",developmentStrong:"Bardzo dobra znajomość"}:t==="de"?{kicker:"Information",backToSearch:"Zur Suche",loading:"Information wird geladen...",loadError:"Information konnte nicht geladen werden.",knownness:"Kenntnisstand",reviews:"Abfragen",correct:"Richtig: {correct} / {total}",lastReview:"Letzte Abfrage",noLastReview:"Noch keine Abfragen",linkedCards:"Verknüpfte Karten",linkedCardsHint:"Prüfkarten, die von dieser Information abhängen",payload:"Inhalt",links:"Verknüpfungen",empty:"Keine Daten",noLinks:"Keine Verknüpfungen",checkcards:"Prüfkarten",loadingCheckcards:"Prüfkarten werden geladen...",loadCheckcardsError:"Prüfkarten konnten nicht geladen werden.",noCheckcards:"Keine Prüfkarten.",checkcardCount:"Anzahl Karten",dependencyCount:"Abhängigkeiten (effektiv)",approach:"Ansicht",loadingApproach:"Ansicht wird geladen...",loadApproachError:"Ansicht konnte nicht geladen werden.",noApproachData:"Keine Ansichtsdaten.",noKnownnessData:"Keine Kenntnisdaten",developmentStart:"Lernbeginn",developmentGrowing:"Aufbauphase",developmentStable:"Stabil",developmentStrong:"Sehr sicher"}:{kicker:"Info",backToSearch:"Back to search",loading:"Loading info...",loadError:"Failed to load info.",knownness:"Knownness",reviews:"Reviews",correct:"Correct: {correct} / {total}",lastReview:"Last review",noLastReview:"No reviews yet",linkedCards:"Linked checking cards",linkedCardsHint:"Checking cards depending on this info",payload:"Information",links:"Links",empty:"No data",noLinks:"No links",checkcards:"Checkcards",loadingCheckcards:"Loading checkcards...",loadCheckcardsError:"Failed to load checkcards.",noCheckcards:"No checkcards.",checkcardCount:"Checkcard count",dependencyCount:"Dependencies (effective)",approach:"Approach",loadingApproach:"Loading view...",loadApproachError:"Failed to load view.",noApproachData:"No view data.",noKnownnessData:"No knownness data",developmentStart:"Just started",developmentGrowing:"In progress",developmentStable:"Stable",developmentStrong:"Strong"}}function _r(t,n){return t.totalReviews<=0?n.noKnownnessData:t.totalReviews<3||t.score<.35?n.developmentStart:t.totalReviews<8||t.score<.65?n.developmentGrowing:t.score<.85?n.developmentStable:n.developmentStrong}function Vr({links:t,emptyLabel:n}){return!t||Object.keys(t).length===0?e.jsx("p",{className:"cogita-library-hint",children:n}):e.jsx("div",{className:"cogita-info-tree",children:Object.entries(t).map(([s,r])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:s}),e.jsx("div",{className:"cogita-info-tree-value",children:Array.isArray(r)?r.length?e.jsx("div",{className:"cogita-selection-overview",children:r.map(i=>e.jsx("span",{className:"cogita-tag-chip",children:i},`${s}:${i}`))}):e.jsx("span",{className:"cogita-library-hint",children:"[]"}):r?e.jsx("span",{className:"cogita-tag-chip",children:r}):e.jsx("span",{className:"cogita-library-hint",children:"null"})})]},s))})}function Ua({value:t,emptyLabel:n}){if(t==null)return e.jsx("p",{className:"cogita-library-hint",children:n});if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)});if(Array.isArray(t))return t.length===0?e.jsx("p",{className:"cogita-library-hint",children:"[]"}):e.jsx("div",{className:"cogita-info-tree",children:t.map((s,r)=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:r+1}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(Ua,{value:s,emptyLabel:n})})]},r))});if(typeof t=="object"){const s=Object.entries(t);return s.length===0?e.jsx("p",{className:"cogita-library-hint",children:n}):e.jsx("div",{className:"cogita-info-tree",children:s.map(([r,i])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:r}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(Ua,{value:i,emptyLabel:n})})]},r))})}return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)})}const pa=5,Zn=50,es=2,ts=[];function Xt({libraryId:t,infoType:n,label:s,placeholder:r,value:i,onChange:m,values:u,onChangeMultiple:y,helperText:N,searchFailedText:S,createFailedText:l,createLabel:x,savingLabel:c,loadMoreLabel:g,allowCreate:v=!0,inputRef:w,autoAdvance:M,onCommit:F,multiple:p}){const d=p?u??ts:ts,[ie,K]=a.useState(p?"":(i==null?void 0:i.label)??""),[b,O]=a.useState([]),[C,Y]=a.useState(pa),[z,I]=a.useState(-1),[ue,re]=a.useState(!1),[fe,Ce]=a.useState(!1),[ye,T]=a.useState(null),Ie=a.useRef(0),J=a.useRef(new Map),ee=a.useMemo(()=>v?p?ie.trim().length>0:ie.trim().length>0&&!i:!1,[v,ie,i,p]);a.useEffect(()=>{p||K((i==null?void 0:i.label)??"")},[i,p]),a.useEffect(()=>{const G=ie.trim();if(!G||G.length<es){O([]),re(!1),Y(pa),I(-1),Ce(!1),T(null);return}const ve=G.toLowerCase(),je=`${t}:${n}:${ve}`,Ve=J.current.get(je);if(Ve){if(p&&d.length>0){const Le=new Set(d.map(qe=>qe.id));O(Ve.filter(qe=>!Le.has(qe.id)))}else O(Ve);Y(pa),I(-1),re(Ve.length>0),Ce(!1),T(null);return}const Ue=window.setTimeout(async()=>{const Le=Date.now();Ie.current=Le,Ce(!0),T(null);try{const qe=await En({libraryId:t,type:n,query:G,limit:Zn});if(Ie.current!==Le)return;const Ze=qe.slice(0,Zn).map(Re=>({id:Re.infoId,label:Re.label,infoType:Re.infoType}));if(J.current.set(je,Ze),p&&d.length>0){const Re=new Set(d.map(We=>We.id));O(Ze.filter(We=>!Re.has(We.id)))}else O(Ze);Y(pa),I(-1),re(!0)}catch{if(Ie.current!==Le)return;T(S??"Search failed.")}finally{Ie.current===Le&&Ce(!1)}},250);return()=>window.clearTimeout(Ue)},[t,n,ie,d]);const $e=G=>{if(p){const ve=d.some(je=>je.id===G.id)?d:[...d,G];y==null||y(ve),K(""),re(!1),I(-1);return}m==null||m(G),K(G.label),re(!1),I(-1),M&&(F==null||F())},Te=async()=>{const G=ie.trim();if(G){Ce(!0),T(null);try{const ve=await Cn({libraryId:t,infoType:n,payload:{label:G}}),je={id:ve.infoId,label:G,infoType:ve.infoType};if(G.length>=es){const Ve=`${t}:${n}:${G.toLowerCase()}`,Ue=J.current.get(Ve)??[];J.current.set(Ve,[je,...Ue])}if(p){y==null||y([...d,je]),K(""),re(!1),I(-1);return}m==null||m(je),re(!1),I(-1),M&&(F==null||F())}catch{T(l??"Create failed.")}finally{Ce(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:s}),e.jsx("input",{value:ie,placeholder:r,onChange:G=>{K(G.target.value),!p&&i&&(m==null||m(null))},onKeyDown:G=>{if(G.key==="ArrowDown"){if(G.preventDefault(),!b.length)return;re(!0),I(ve=>{const je=Math.min(b.length,C)-1,Ve=ve<0?0:Math.min(ve+1,je);return Ve===je&&b.length>C?(Y(Ue=>Math.min(Ue+pa,b.length)),Math.min(ve+1,Math.min(b.length,C+pa)-1)):Ve});return}if(G.key==="ArrowUp"){if(G.preventDefault(),!b.length)return;re(!0),I(ve=>ve<=0?0:ve-1);return}if(G.key==="Enter"){if(G.preventDefault(),z>=0&&b[z]){$e(b[z]);return}if(ee){Te();return}}},onFocus:()=>{b.length>0&&re(!0)},autoComplete:"off",ref:w})]}),p&&d.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:d.map(G=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>y==null?void 0:y(d.filter(ve=>ve.id!==G.id)),children:[G.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},G.id))}),N&&e.jsx("p",{className:"cogita-help",children:N}),ye&&e.jsx("p",{className:"cogita-error",children:ye}),ue&&b.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[b.slice(0,C).map((G,ve)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":ve===z,onClick:()=>$e(G),children:[e.jsx("strong",{children:G.label}),e.jsx("span",{children:G.infoType})]},G.id)),C<b.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>Y(G=>Math.min(G+pa,b.length)),children:g??"Load more"})]}),ee&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Te,disabled:fe,children:fe?c??"Saving...":x??`Create new ${n}`})]})}const as=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],ns=8;function ss({libraryId:t,copy:n,language:s,sourceKindOptions:r,value:i,onChange:m,labels:u}){const[y,N]=a.useState(!1),[S,l]=a.useState(-1),x=a.useMemo(()=>{const w=s;return as.map(M=>{var d;const F=(M==null?void 0:M[w])??(M==null?void 0:M.en)??(M==null?void 0:M.la);return{label:`${F.abbr} — ${F.name}`,latin:((d=M==null?void 0:M.la)==null?void 0:d.abbr)??F.abbr}})},[s]),c=(w,M=!1)=>{const F=w.trim().toLowerCase();return F?x.filter(p=>p.label.toLowerCase().includes(F)).slice(0,ns):M?x.slice(0,ns):[]},g=(w,M)=>{const F=w.trim().toLowerCase();if(!F)return null;const p=as;for(const d of p){const ie=d==null?void 0:d.la,K=(d==null?void 0:d[M])??(d==null?void 0:d.en)??ie,b=(K==null?void 0:K.abbr)??"",O=(K==null?void 0:K.name)??"";if(b.toLowerCase()===F||O.toLowerCase()===F||`${b} — ${O}`.toLowerCase()===F)return{book:d,entry:K,la:ie}}return null};a.useEffect(()=>{if(i.sourceKind==="bible"&&i.locatorValue&&!y){const w=g(i.locatorValue,s);if(w){const M=`${w.entry.abbr} — ${w.entry.name}`;M!==i.bibleBookDisplay&&m({...i,bibleBookDisplay:M})}}},[s,i,y,m]);const v=w=>m({...i,...w});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:u.sourceKindLabel}),e.jsx("select",{value:i.sourceKind,onChange:w=>v({sourceKind:w.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:r.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),i.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:u.bibleBookLabel}),e.jsx("input",{type:"text",value:i.bibleBookDisplay,onChange:w=>{const M=w.target.value;v({bibleBookDisplay:M,locatorValue:""}),N(!0),l(-1)},onKeyDown:w=>{var F;const M=c(i.bibleBookDisplay);if(M.length){if(w.key==="ArrowDown")w.preventDefault(),l(p=>Math.min(p+1,M.length-1));else if(w.key==="ArrowUp")w.preventDefault(),l(p=>Math.max(p-1,0));else if((w.key==="Enter"||w.key==="Tab")&&S>=0&&M[S]){const p=M[S],d=g(p.label,s);if(!d)return;v({bibleBookDisplay:p.label,locatorValue:((F=d.la)==null?void 0:F.abbr)??i.locatorValue}),N(!1)}}},onFocus:()=>N(!0),onBlur:()=>window.setTimeout(()=>N(!1),100),placeholder:u.bibleBookPlaceholder})]}),y&&c(i.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:c(i.bibleBookDisplay,!0).map((w,M)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":M===S,tabIndex:-1,onMouseDown:()=>{var p;const F=g(w.label,s);F&&v({bibleBookDisplay:w.label,locatorValue:((p=F.la)==null?void 0:p.abbr)??i.locatorValue})},children:e.jsx("strong",{children:w.label})},w.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:u.bibleRestLabel}),e.jsx("input",{type:"text",value:i.locatorAux,onChange:w=>v({locatorAux:w.target.value}),placeholder:u.bibleRestPlaceholder})]})]}),i.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:i.sourceUrl,onChange:w=>v({sourceUrl:w.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:i.sourceAccessedDate,onChange:w=>v({sourceAccessedDate:w.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),i.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:t,infoType:"work",label:u.churchDocumentLabel,placeholder:u.churchDocumentPlaceholder,value:i.churchDocument,onChange:w=>v({churchDocument:w}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:u.locatorLabel}),e.jsx("input",{type:"text",value:i.locatorValue,onChange:w=>v({locatorValue:w.target.value}),placeholder:u.locatorPlaceholder})]})]}),i.sourceKind==="work"&&e.jsx(Xt,{libraryId:t,infoType:"work",label:u.workLabel,placeholder:u.workPlaceholder,value:i.work,onChange:w=>v({work:w}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),i.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:t,infoType:"media",label:u.bookLabel,placeholder:u.bookPlaceholder,value:i.bookMedia,onChange:w=>v({bookMedia:w}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:u.locatorLabel}),e.jsx("input",{type:"text",value:i.locatorValue,onChange:w=>v({locatorValue:w.target.value}),placeholder:u.locatorPlaceholder})]})]}),i.sourceKind!=="website"&&i.sourceKind!=="bible"&&i.sourceKind!=="book"&&i.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:u.locatorLabel}),e.jsx("input",{type:"text",value:i.locatorValue,onChange:w=>v({locatorValue:w.target.value}),placeholder:u.locatorPlaceholder})]})]})}const rs=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}];function $a(){return{sourceKind:"string",locatorValue:"",locatorAux:"",bibleBookDisplay:"",sourceUrl:"",sourceAccessedDate:"",churchDocument:null,bookMedia:null,work:null}}function is(t){return t==null?"":typeof t=="string"?t:JSON.stringify(t)}function os(t,n){if(!t||typeof t!="object")return n;const s=t,r=[s.label,s.name,s.title,s.text,s.orcid,s.email,s.number];for(const i of r)if(typeof i=="string"&&i.trim())return i.trim();return n}function ls(t,n){var r;if(!(t instanceof Ms))return n;const s=(r=t.message)==null?void 0:r.trim();if(!s)return n;try{const i=JSON.parse(s);if(typeof i.error=="string"&&i.error.trim())return i.error.trim()}catch{}return s}function Or(t){const n=t.trim();if(!n)return null;try{const s=JSON.parse(n);return s&&typeof s=="object"&&!Array.isArray(s)?s:null}catch{return null}}function Ht(t,n){const s=t==null?void 0:t[n];return typeof s=="string"?s:""}function qr(t,n){return n?t==="book"&&n.infoType==="media"?{bookMedia:n}:t==="work"&&n.infoType==="work"?{work:n}:t==="number_document"&&n.infoType==="work"?{churchDocument:n}:{}:{}}function Ur(t,n){const s=$a(),r=(t.sourceKind??"").trim()||s.sourceKind,i=t.locator??"",m=Or(i);let u="",y="",N="",S="",l="";return r==="website"?(S=Ht(m,"url"),l=Ht(m,"accessedDate"),u=Ht(m,"value")):r==="bible"?(u=Ht(m,"book")||i.trim(),y=Ht(m,"passage")||Ht(m,"rest"),N=Ht(m,"bookDisplay")):m?(u=Ht(m,"value")||Ht(m,"locator"),y=Ht(m,"aux")):u=i,{...s,sourceKind:r,locatorValue:u,locatorAux:y,bibleBookDisplay:N,sourceUrl:S,sourceAccessedDate:l,...qr(r,n)}}function gn(t){return t.sourceKind==="book"?t.bookMedia:t.sourceKind==="work"?t.work:t.sourceKind==="number_document"?t.churchDocument:null}function pn(t){const n=t.locatorValue.trim(),s=t.locatorAux.trim(),r=t.sourceUrl.trim(),i=t.sourceAccessedDate.trim();switch(t.sourceKind){case"website":return{url:r,accessedDate:i};case"bible":return{book:n,bookDisplay:t.bibleBookDisplay.trim(),passage:s};case"book":case"work":case"number_document":return s?{value:n,aux:s}:n;default:return s?{value:n,aux:s}:n}}function cs(t){var i,m,u;const n=t.locatorValue.trim(),s=t.locatorAux.trim(),r=[n,s].filter(Boolean).join(" ");switch(t.sourceKind){case"website":return t.sourceUrl.trim()||"website";case"bible":return r||"bible";case"book":return[(i=t.bookMedia)==null?void 0:i.label,r].filter(Boolean).join(" · ")||"book";case"work":return[(m=t.work)==null?void 0:m.label,r].filter(Boolean).join(" · ")||"work";case"number_document":return[(u=t.churchDocument)==null?void 0:u.label,r].filter(Boolean).join(" · ")||"number_document";default:return r||t.sourceKind||"source"}}function ds(t){return t.sourceKind.trim()?t.sourceKind==="website"?!!t.sourceUrl.trim():t.sourceKind==="bible"?!!(t.locatorValue.trim()&&t.locatorAux.trim()):t.sourceKind==="book"?!!t.bookMedia:t.sourceKind==="work"?!!t.work:t.sourceKind==="number_document"?!!(t.churchDocument&&t.locatorValue.trim()):!!t.locatorValue.trim():!1}function Jr({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l,editInfoId:x}){var nt,_e,xe;const{libraryName:c}=sa(l),g=!!x,[v,w]=a.useState([]),[M,F]=a.useState("word"),[p,d]=a.useState({}),[ie,K]=a.useState({}),[b,O]=a.useState({}),[C,Y]=a.useState({}),[z,I]=a.useState(null),[ue,re]=a.useState("idle"),[fe,Ce]=a.useState($a),[ye,T]=a.useState({}),[Ie,J]=a.useState({}),[ee,$e]=a.useState({}),[Te,G]=a.useState(null),ve=a.useMemo(()=>v.find(q=>q.infoType===M),[M,v]),je=a.useMemo(()=>v.find(q=>q.infoType==="source"),[v]),Ve=a.useMemo(()=>v.map(q=>({value:q.infoType,label:Xe(t,q.infoType)})),[t,v]);a.useEffect(()=>{let q=!1;return Ws({libraryId:l}).then(Ae=>{var ne;if(!q&&(w(Ae),!g)){const B=(ne=Ae[0])==null?void 0:ne.infoType;B&&F(B)}}).catch(()=>{q||w([])}),()=>{q=!0}},[g,l]),a.useEffect(()=>{if(g||!ve)return;const q={},Ae={},ne={},B={};for(const he of ve.payloadFields)q[he.key]="";for(const he of ve.linkFields)he.multiple?ne[he.key]=[]:Ae[he.key]=null,he.targetTypes.length>0&&(B[he.key]=he.targetTypes[0]);d(q),K(Ae),O(ne),Y(B)},[ve==null?void 0:ve.infoType,g]),a.useEffect(()=>{if(!g||!x||v.length===0)return;let q=!1;return re("loading"),I(null),(async()=>{const ne=await Qt({libraryId:l,infoId:x});if(q)return;const B=ne.infoType;F(B);const he=v.find(E=>E.infoType===B);if(!he){re("idle");return}const Je=ne.payload??{},R={};for(const E of he.payloadFields)R[E.key]=is(Je[E.key]);d(R);const $=ne.links??{}??{},Q={},se={},j={},_=[];for(const E of he.linkFields){E.targetTypes.length>0&&(j[E.key]=E.targetTypes[0]);const U=$[E.key];if(E.multiple){const te=Array.isArray(U)?U.filter(ke=>typeof ke=="string"):[];se[E.key]=[];for(const ke of te)_.push(Qt({libraryId:l,infoId:ke}).then(we=>{if(q)return;const ze={id:ke,infoType:we.infoType,label:os(we.payload,ke)};j[E.key]=ze.infoType,se[E.key]=[...se[E.key],ze]}).catch(()=>{}))}else{const te=typeof U=="string"?U:null;Q[E.key]=null,te&&_.push(Qt({libraryId:l,infoId:te}).then(ke=>{if(q)return;const we={id:te,infoType:ke.infoType,label:os(ke.payload,te)};j[E.key]=we.infoType,Q[E.key]=we}).catch(()=>{}))}}await Promise.all(_),!q&&(K(Q),O(se),Y(j),re("idle"))})().catch(()=>{q||(I("Failed to load info details."),re("idle"))}),()=>{q=!0}},[x,g,l,v]),a.useEffect(()=>{M==="source"&&Ce(Ur(p,ie.resource??null))},[M,p.sourceKind,p.locator,(nt=ie.resource)==null?void 0:nt.id,(_e=ie.resource)==null?void 0:_e.infoType,(xe=ie.resource)==null?void 0:xe.label]);const Ue=q=>{var he,Je;const Ae=((he=je==null?void 0:je.payloadFields.find(R=>R.key==="sourceKind"))==null?void 0:he.keepOnCreate)??!1,ne=((Je=je==null?void 0:je.linkFields.find(R=>R.key==="resource"))==null?void 0:Je.keepOnCreate)??!1,B=$a();return B.sourceKind=Ae?q.sourceKind:B.sourceKind,ne&&(B.work=q.work,B.bookMedia=q.bookMedia,B.churchDocument=q.churchDocument),Ae&&q.sourceKind==="bible"&&(B.locatorValue=q.locatorValue,B.bibleBookDisplay=q.bibleBookDisplay),Ae&&q.sourceKind==="website"&&(B.sourceUrl=q.sourceUrl,B.sourceAccessedDate=q.sourceAccessedDate),B},Le=a.useMemo(()=>({sourceKindLabel:t.cogita.library.add.info.sourceKindLabel,bibleBookLabel:t.cogita.library.add.info.sourceBibleBookLabel,bibleBookPlaceholder:t.cogita.library.add.info.sourceBibleBookPlaceholder,bibleRestLabel:t.cogita.library.add.info.sourceBibleRestLabel,bibleRestPlaceholder:t.cogita.library.add.info.sourceBibleRestPlaceholder,churchDocumentLabel:t.cogita.library.add.info.sourceResourceLabel,churchDocumentPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,workLabel:t.cogita.library.add.info.sourceResourceLabel,workPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,bookLabel:t.cogita.library.add.info.sourceResourceLabel,bookPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,locatorLabel:t.cogita.library.list.typeFilterLocator,locatorPlaceholder:t.cogita.library.list.typeFilterLocator}),[t]),qe=async q=>{const Ae=Ie[q]??$a();if(!ds(Ae)){$e(ne=>({...ne,[q]:t.cogita.library.add.info.referenceMissingSource}));return}G(q),$e(ne=>({...ne,[q]:null}));try{const ne=gn(Ae),B=ne?{resource:ne.id}:{},he={label:cs(Ae),sourceKind:Ae.sourceKind.trim(),locator:pn(Ae)},R={id:(await Cn({libraryId:l,infoType:"source",payload:he,links:B})).infoId,infoType:"source",label:he.label};if(O($=>{const Q=$[q]??[];return Q.some(se=>se.id===R.id)?$:{...$,[q]:[...Q,R]}}),g&&x){const $=await Qt({libraryId:l,infoId:x}),Q=$.links&&typeof $.links=="object"?{...$.links}:{},se=Q[q],j=Array.isArray(se)?se.filter(_=>typeof _=="string"):typeof se=="string"?[se]:[];j.includes(R.id)||(Q[q]=[...j,R.id],await Jn({libraryId:l,infoId:x,payload:$.payload,links:Q}))}J($=>({...$,[q]:Ue(Ae)})),$e($=>({...$,[q]:null}))}catch(ne){$e(B=>({...B,[q]:ls(ne,t.cogita.library.lookup.createFailed)}))}finally{G(ne=>ne===q?null:ne)}},Ze=async()=>{var ne;if(!ve)return;const q={};for(const B of ve.payloadFields){if(M==="source"&&(B.key==="sourceKind"||B.key==="locator"))continue;const he=(p[B.key]??"").trim();if(!he){if(B.required){I(`Field '${B.label}' is required.`);return}continue}if(B.inputType==="json")try{q[B.key]=JSON.parse(he)}catch{I(`Field '${B.label}' must be valid JSON.`);return}else q[B.key]=he}const Ae={};for(const B of ve.linkFields)if(!(M==="source"&&B.key==="resource"))if(B.multiple){const he=(b[B.key]??[]).map(Je=>Je.id);if(B.required&&he.length===0){I(`Link '${B.label}' is required.`);return}he.length>0&&(Ae[B.key]=he)}else{const he=((ne=ie[B.key])==null?void 0:ne.id)??null;if(B.required&&!he){I(`Link '${B.label}' is required.`);return}he&&(Ae[B.key]=he)}if(M==="source"){if(!ds(fe)){I(t.cogita.library.add.info.referenceMissingSource);return}const B=fe.sourceKind.trim();q.sourceKind=B,q.locator=pn(fe),(typeof q.label!="string"||!q.label.trim())&&(q.label=cs(fe));const he=gn(fe);he&&(Ae.resource=he.id)}re("saving"),I(null);try{if(g&&x)await Jn({libraryId:l,infoId:x,payload:q,links:Ae}),I("Info updated.");else{await Cn({libraryId:l,infoType:M,payload:q,links:Ae}),I("Info saved.");const B={};for(const R of ve.payloadFields)B[R.key]=R.keepOnCreate?p[R.key]??"":"";d(B);const he={},Je={};for(const R of ve.linkFields)R.multiple?Je[R.key]=R.keepOnCreate?b[R.key]??[]:[]:he[R.key]=R.keepOnCreate?ie[R.key]??null:null;K(R=>({...R,...he})),O(R=>({...R,...Je})),M==="source"&&Ce(R=>{const $=Ue(R),Q=gn($);return d(se=>({...se,sourceKind:$.sourceKind,locator:is(pn($))})),K(se=>({...se,resource:Q})),Q&&Y(se=>({...se,resource:Q.infoType})),$})}}catch(B){I(ls(B,"Failed to save info."))}finally{re("idle")}},Re=q=>{const Ae=p[q.key]??"",ne=q.inputType==="textarea"||q.inputType==="json";return e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:q.label}),ne?e.jsx("textarea",{rows:q.inputType==="json"?8:4,value:Ae,onChange:B=>d(he=>({...he,[q.key]:B.target.value})),placeholder:q.key}):e.jsx("input",{type:"text",value:Ae,onChange:B=>d(he=>({...he,[q.key]:B.target.value})),placeholder:q.key})]},`payload:${q.key}`)},We=q=>{const Ae=C[q.key]??q.targetTypes[0],ne=q.key==="references"&&q.multiple&&q.targetTypes.includes("source"),B=Ie[q.key]??$a(),he=ye[q.key]??!1,Je=ee[q.key];return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:q.label}),q.targetTypes.length>1?e.jsx("select",{value:Ae,onChange:R=>Y($=>({...$,[q.key]:R.target.value})),children:q.targetTypes.map(R=>e.jsx("option",{value:R,children:Xe(t,R)},`${q.key}:${R}`))}):null,q.multiple?e.jsx(Xt,{libraryId:l,infoType:Ae,label:q.label,placeholder:q.key,multiple:!0,values:b[q.key]??[],onChangeMultiple:R=>O($=>({...$,[q.key]:R})),allowCreate:!ne,searchFailedText:"Search failed",createFailedText:"Create failed"}):e.jsx(Xt,{libraryId:l,infoType:Ae,label:q.label,placeholder:q.key,value:ie[q.key]??null,onChange:R=>K($=>({...$,[q.key]:R})),searchFailedText:"Search failed",createFailedText:"Create failed"}),ne?e.jsxs("div",{children:[e.jsxs("label",{className:"cogita-field",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:he,onChange:R=>T($=>({...$,[q.key]:R.target.checked}))}),e.jsx("span",{children:t.cogita.library.add.info.referenceToggle})]}),he?e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.add.info.referenceTitle}),e.jsx(ss,{libraryId:l,copy:t,language:N,sourceKindOptions:[...rs],value:B,onChange:R=>J($=>({...$,[q.key]:R})),labels:Le}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>qe(q.key),disabled:Te===q.key,children:Te===q.key?t.cogita.library.lookup.saving:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.source)})}),Je?e.jsx("p",{className:"cogita-library-subtitle",children:Je}):null]}):null]}):null]},`link:${q.key}`)},et=()=>e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.add.info.referenceTitle}),e.jsx(ss,{libraryId:l,copy:t,language:N,sourceKindOptions:[...rs],value:fe,onChange:Ce,labels:Le})]});return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:g?"Edit info":"Create info"}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:"Specification-driven editor"})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:`/#/cogita/library/${l}/list`,children:"Back to list"})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-panel",children:[g?null:e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Info type"}),e.jsx("select",{value:M,onChange:q=>F(q.target.value),children:Ve.map(q=>e.jsx("option",{value:q.value,children:q.label},q.value))})]}),ue==="loading"&&g?e.jsx("p",{children:"Loading..."}):null,ve&&!(ue==="loading"&&g)?e.jsxs("div",{className:"cogita-form-grid",children:[ve.payloadFields.filter(q=>!(M==="source"&&(q.key==="sourceKind"||q.key==="locator"))).map(Re),M==="source"?et():null,ve.linkFields.filter(q=>!(M==="source"&&q.key==="resource")).map(We)]}):ue==="loading"&&g?null:e.jsx("p",{children:"No specification found for this info type."}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:Ze,disabled:ue==="saving"||!ve,children:ue==="saving"?"Saving...":g?"Update info":"Create info"})}),z?e.jsx("p",{className:"cogita-library-subtitle",children:z}):null]})})})]})})}const us=t=>/\s/.test(t),Ja=t=>/[\p{L}\p{N}]/u.test(t),hs=(t,n)=>{const s=n>0?t[n-1]:"",r=n<t.length?t[n]:"";if(!s||!r)return 0;const i=us(s),m=us(r);if(i||m)return 3;const u=Ja(s),y=Ja(r);return u!==y?2:!u&&!y?1:0},fn=(t,n,s,r,i)=>{const m=Math.max(r-n,s-r);for(let u=0;u<=m;u+=1){const y=r-u;if(y>=n&&y<=s&&hs(t,y)>=i)return y;const N=r+u;if(N>=n&&N<=s&&hs(t,N)>=i)return N}return null},bn=(t,n)=>{const s=n>0?t[n-1]:"",r=n<t.length?t[n]:"";return!s||!r?!0:Ja(s)!==Ja(r)},Hr=(t,n,s,r)=>{const i=s-n,m=n+r,u=s-r;if(i<=r*2||u<=m)return null;const y=Math.floor((n+s)/2),N=fn(t,m,u,y,3);if(N!==null&&bn(t,N))return N;const S=fn(t,m,u,y,2);if(S!==null&&bn(t,S))return S;const l=fn(t,m,u,y,1);return l!==null&&bn(t,l)?l:null},fa=(t,n)=>{const s=Math.max(1,7),r=Math.max(s,13),i={},m=(N,S,l,x,c)=>{const g=String(x),v={id:g,start:N,end:S,text:t.slice(N,S),depth:l,index:x,parentId:c};if(i[g]=v,S-N>r){let M=Hr(t,N,S,s);if(M!==null&&M>N&&M<S){const F=m(N,M,l+1,x*2+1,g),p=m(M,S,l+1,x*2+2,g);v.leftId=F.id,v.rightId=p.id}}return v},u=m(0,t.length,0,0),y=Object.values(i).sort((N,S)=>S.depth-N.depth||N.start-S.start).map(N=>N.id);return{text:t,rootId:u.id,nodes:i,order:y}},Sa=(t,n,s,r,i,m,u)=>{const y=m==="reverse"?t.order.slice().sort((N,S)=>t.nodes[S].start-t.nodes[N].start||t.nodes[S].depth-t.nodes[N].depth):t.order;for(const N of y){if(u&&N===u||n.has(N))continue;const S=t.nodes[N];if(S){if(i&&(S.leftId||S.rightId)){const l=S.leftId?s[S.leftId]??0:r,x=S.rightId?s[S.rightId]??0:r;if((l+x)/2<r)continue}return S}}return null},Pn=(t,n)=>({before:t.slice(0,n.start),fragment:t.slice(n.start,n.end),after:t.slice(n.end)});function Wr({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l}){const x=`/#/cogita/library/${l}`,[c,g,v]=vs([]),[w,M,F]=ws([]),[p,d]=a.useState(null),[ie,K]=a.useState(null),[b,O]=a.useState(null),[C,Y]=a.useState(null),z=a.useMemo(()=>c.find(T=>T.id===p)??null,[c,p]);a.useEffect(()=>{let T=!0;return Gs({libraryId:l}).then(Ie=>{if(!T)return;const J=Ie.nodes.map(ee=>{var $e,Te,G;return{id:ee.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:ee.payload&&typeof ee.payload=="object"&&"label"in ee.payload?String(ee.payload.label):"Item",nodeType:ee.nodeType,itemType:(($e=ee.payload)==null?void 0:$e.itemType)??"info",itemId:((Te=ee.payload)==null?void 0:Te.itemId)??null,infoType:((G=ee.payload)==null?void 0:G.infoType)??null}}});g(J),M(Ie.edges.map(ee=>({id:ee.edgeId,source:ee.fromNodeId,target:ee.toNodeId})))}).catch(()=>{T&&(g([]),M([]))}),()=>{T=!1}},[l]),a.useEffect(()=>{Ys({libraryId:l}).then(K).catch(()=>K(null))},[l,c,w]);const I=a.useCallback(T=>{M(Ie=>js(T,Ie))},[]),ue=()=>{const T=crypto.randomUUID();g(Ie=>[...Ie,{id:T,type:"default",position:{x:140+Ie.length*40,y:120+Ie.length*30},data:{label:t.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},re=()=>{const T=crypto.randomUUID();g(Ie=>[...Ie,{id:T,type:"default",position:{x:180+Ie.length*40,y:160+Ie.length*30},data:{label:t.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},fe=async()=>{O(null);try{const T=c.map(J=>({nodeId:J.id,nodeType:J.data.nodeType,payload:{itemType:J.data.itemType,itemId:J.data.itemId??null,label:J.data.label,infoType:J.data.infoType??null}})),Ie=w.map(J=>({edgeId:J.id,fromNodeId:J.source,toNodeId:J.target}));await Qs({libraryId:l,nodes:T,edges:Ie}),O(t.cogita.library.graph.saveSuccess)}catch{O(t.cogita.library.graph.saveFail)}},Ce=T=>{z&&g(Ie=>Ie.map(J=>J.id===z.id?{...J,data:{...J.data,itemId:(T==null?void 0:T.infoId)??null,itemType:"collection",infoType:"collection",label:(T==null?void 0:T.label)??t.cogita.library.infoTypes.collection}}:J))},ye=T=>{z&&g(Ie=>Ie.map(J=>J.id===z.id?{...J,data:{...J.data,itemId:(T==null?void 0:T.infoId)??null,itemType:"info",infoType:(T==null?void 0:T.infoType)??null,label:(T==null?void 0:T.label)??t.cogita.library.infoTypes.any}}:J))};return a.useEffect(()=>{if(!z||z.data.nodeType!=="info"||z.data.infoType!=="citation"||!z.data.itemId){Y(null);return}let T=!0;return Qt({libraryId:l,infoId:z.data.itemId}).then(Ie=>{if(!T)return;const J=Ie.payload,ee=(J==null?void 0:J.text)??"";if(!ee){Y(null);return}const $e=fa(ee),Te=Object.values($e.nodes).sort((G,ve)=>G.depth-ve.depth||G.start-ve.start).map(G=>({id:G.id,text:G.text,depth:G.depth}));Y({title:(J==null?void 0:J.title)??z.data.label,fragments:Te})}).catch(()=>Y(null)),()=>{T=!1}},[l,z]),e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:t.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:x,children:t.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:fe,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ue,children:t.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:re,children:t.cogita.library.actions.addInfo}),ie?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(ie.totalCollections))})}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Ln,{nodes:c,edges:w,onNodesChange:v,onEdgesChange:F,onConnect:I,onNodeClick:(T,Ie)=>d(Ie.id),fitView:!0,children:[e.jsx($n,{gap:18,size:1}),e.jsx(Rn,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),z?e.jsxs("div",{className:"cogita-graph-inspector",children:[z.data.nodeType==="collection"?e.jsx(Xt,{libraryId:l,infoType:"collection",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:z.data.itemId?{id:z.data.itemId,label:z.data.label,infoType:"collection"}:null,onChange:Ce,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.collection),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}):e.jsx(Xt,{libraryId:l,infoType:"any",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:z.data.itemId?{id:z.data.itemId,label:z.data.label,infoType:z.data.infoType??void 0}:null,onChange:ye,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.any),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),C?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:C.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:C.fragments.map(T=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:T.id}),e.jsx("span",{children:T.text})]},T.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}function Kn({children:t,flashState:n,flashTick:s=0,feedbackToken:r,className:i}){const m=r??(n?`${n}-${s}`:"idle");return e.jsx("section",{className:i?`cogita-revision-card ${i}`:"cogita-revision-card","data-feedback":m,children:t})}function Fn({copy:t,currentCard:n,currentTypeLabel:s,prompt:r,languages:i,answer:m,onAnswerChange:u,computedExpected:y,computedAnswers:N,onComputedAnswerChange:S,answerTemplate:l,outputVariables:x,variableValues:c,computedFieldFeedback:g,feedback:v,canAdvance:w,quoteContext:M,quotePlaceholder:F,onCheckAnswer:p,onSkip:d,onLanguageSelect:ie,onMarkReviewed:K,onAdvance:b,showCorrectAnswer:O,setShowCorrectAnswer:C,onRevealCorrect:Y,answerMask:z,expectedAnswer:I,hasExpectedAnswer:ue,handleComputedKeyDown:re,answerInputRef:fe,computedInputRefs:Ce,scriptMode:ye,setScriptMode:T,matchPairs:Ie,matchLeftOrder:J,matchRightOrder:ee,matchSelection:$e,matchActiveLeft:Te,matchActiveRight:G,matchFeedback:ve,onMatchLeftSelect:je,onMatchRightSelect:Ve,disableCheckAnswer:Ue=!1,hideSkipAction:Le=!1,allowRevealBeforeCheck:qe=!1,autoRevealAfterAnswer:Ze=!1,disableCheckAfterAnswer:Re=!1}){const We=a.useMemo(()=>{var ze;const R=!l&&y.length===2?`The {${y[0].key}} is of type {${y[1].key}}`:null,$=l??R;if(!$)return null;const Q=new Map(y.map(Ne=>[Ne.key,Ne.expected])),se=new Set,j=[],_=/\{([^}]+)\}/g;let E=0,U,te=null;for(;(U=_.exec($))!==null;){const Ne=$.slice(E,U.index);Ne&&j.push({type:"text",value:Ne});const le=((ze=U[1])==null?void 0:ze.trim())??"",oe=le&&Q.has(le)?le:le&&x&&x[le]?x[le]:null;le&&se.add(le),oe&&se.add(oe),oe&&Q.has(oe)?(j.push({type:"input",value:oe}),te||(te=oe)):le&&c&&c[le]!==void 0?j.push({type:"text",value:c[le]}):j.push({type:"text",value:U[0]}),E=U.index+U[0].length}const ke=$.slice(E);return ke&&j.push({type:"text",value:ke}),y.filter(Ne=>!se.has(Ne.key)).length>0?null:{parts:j,expectedByKey:Q,firstInputKey:te}},[l,y,x,c]),et=()=>{if(!We)return null;const{parts:R,expectedByKey:$,firstInputKey:Q}=We;return e.jsx("div",{className:"cogita-revision-inline-answer",children:R.map((se,j)=>{var _,E;return se.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:se.value},`text-${j}`):e.jsx("input",{ref:U=>{Ce.current[se.value]=U},autoFocus:se.value===Q,value:N[se.value]??"",onChange:U=>S(se.value,U.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":g[se.value]??(v==="correct"?"correct":v==="incorrect"?"incorrect":void 0),onKeyDown:U=>q(U)||re(U),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((_=N[se.value])==null?void 0:_.length)??0,((E=$.get(se.value))==null?void 0:E.length)??6)}ch`}},`input-${se.value}-${j}`)})})},nt=a.useMemo(()=>{const R=new Map;return(Ie??[]).forEach($=>R.set($.leftId,$)),R},[Ie]),_e=a.useMemo(()=>{const R=new Map;return(Ie??[]).forEach($=>R.set($.rightId,$)),R},[Ie]);a.useEffect(()=>{var j;if(n.cardType!=="info"||n.infoType!=="computed"||y.length===0)return;const R=typeof document<"u"?document.activeElement:null;if(R&&(R.tagName==="INPUT"||R.tagName==="TEXTAREA"))return;const $=(We==null?void 0:We.firstInputKey)??((j=y[0])==null?void 0:j.key);if(!$)return;const Q=Ce.current[$];if(!Q)return;const se=requestAnimationFrame(()=>{Q.focus()});return()=>cancelAnimationFrame(se)},[n,y,We]);const xe=(()=>{const R=[I??"",...y.map(se=>se.expected??"")].join(""),$=[m,...Object.values(N)].join(""),Q=`${R}${$}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Q)})(),q=R=>R.ctrlKey&&(R.key==="^"||R.key==="6")?(R.preventDefault(),T($=>$==="super"?null:"super"),!0):R.ctrlKey&&(R.key==="_"||R.key==="-")?(R.preventDefault(),T($=>$==="sub"?null:"sub"),!0):!1,Ae=()=>{if(!I||!z)return I??"";const R=I.split(""),$=Array.from(z),Q=$.length>0?$.reduce((se,j)=>se+j,0)/$.length:127;return R.map((se,j)=>{const _=$[j]??Q,E=Math.max(0,Math.min(255,Math.round(_)));let U=255,te=0;return E<=127?te=Math.round(E/127*255):(te=255,U=Math.round(255*(1-(E-127)/128))),e.jsx("span",{style:{color:`rgb(${U}, ${te}, 0)`},children:se},`mask-${j}`)})},ne=n.cardType==="info"&&n.infoType==="citation"?(M==null?void 0:M.title)||n.label:n.description,B=O||Ze&&v!==null,he=Ue||Re&&(v!==null||B),Je=ue&&(qe||v==="incorrect"||B);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[s?e.jsx("span",{children:s}):null,e.jsx("strong",{children:ne})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&Ie?e.jsxs("div",{className:"cogita-revision-body",children:[r?e.jsx("h2",{children:r}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(J??[]).map(R=>{const $=nt.get(R);if(!$)return null;const Q=($e==null?void 0:$e[R])??null,se=(ve==null?void 0:ve[R])??null,j=Te===R;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":j,"data-state":se??void 0,"data-locked":Q?"true":void 0,onClick:()=>je==null?void 0:je(R),children:[e.jsx("span",{children:$.leftLabel}),Q&&O?e.jsx("em",{children:"✓"}):null]},R)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(ee??[]).map(R=>{const $=_e.get(R);if(!$)return null;const Q=Object.values($e??{}).includes(R),se=G===R;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Q||se,"data-locked":Q?"true":void 0,onClick:()=>Ve==null?void 0:Ve(R),children:e.jsx("span",{children:$.rightLabel})},R)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:p,disabled:n.checkType==="translation-match"||he,children:t.cogita.library.revision.checkAnswer}),Le?null:e.jsx("button",{type:"button",className:"ghost",onClick:d,children:t.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:fe,value:m,onChange:R=>u(R.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":v==="correct"?"correct":v==="incorrect"?"incorrect":void 0,onKeyDown:R=>{if(R.key==="Enter")if(R.preventDefault(),R.stopPropagation(),w)b();else{if(he)return;p()}}})]}),xe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ye==="super",onClick:()=>T(R=>R==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ye==="sub",onClick:()=>T(R=>R==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:p,disabled:he,children:t.cogita.library.revision.checkAnswer}),Le?null:e.jsx("button",{type:"button",className:"ghost",onClick:d,children:t.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,l?null:e.jsx(Xs,{value:r??"",mode:"auto"}),y.length>0?(()=>{const R=et();return R?e.jsx("div",{className:"cogita-inline-answer-wrap",children:R}):e.jsx("div",{className:"cogita-form-grid",children:y.map(($,Q)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:$.key}),e.jsx("textarea",{ref:se=>{Ce.current[$.key]=se},autoFocus:Q===0,value:N[$.key]??"",onChange:se=>S($.key,se.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":g[$.key]??(v==="correct"?"correct":v==="incorrect"?"incorrect":void 0),onKeyDown:se=>q(se)||re(se)})]},$.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:fe,value:m,onChange:R=>u(R.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":v==="correct"?"correct":v==="incorrect"?"incorrect":void 0,onKeyDown:R=>{if(!q(R)&&R.key==="Enter")if(R.preventDefault(),R.stopPropagation(),w)b();else{if(he)return;p()}}})]})}),xe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ye==="super",onClick:()=>T(R=>R==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ye==="sub",onClick:()=>T(R=>R==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:p,disabled:he,children:t.cogita.library.revision.checkAnswer}),Le?null:e.jsx("button",{type:"button",className:"ghost",onClick:d,children:t.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="citation"&&M?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.quoteProgress.replace("{done}",String(M.completed)).replace("{total}",String(M.total))}),e.jsx("p",{className:"cogita-quote-text",children:M.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:fe,value:m,onChange:R=>u(R.target.value),placeholder:F??t.cogita.library.revision.quoteMissingPlaceholder,"data-state":v==="correct"?"correct":v==="incorrect"?"incorrect":void 0,onKeyDown:R=>{if(R.key==="Enter")if(R.preventDefault(),R.stopPropagation(),w)b();else{if(he)return;p()}}})]}),e.jsx("p",{className:"cogita-quote-text",children:M.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:p,disabled:he,children:t.cogita.library.revision.checkAnswer}),Le?null:e.jsx("button",{type:"button",className:"ghost",onClick:d,children:t.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:i.length?i.map(R=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ie(R.label),children:R.label},R.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:t.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:d,children:t.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:K,children:t.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:d,children:t.cogita.library.revision.skip})]})]}),v&&e.jsx("div",{className:"cogita-revision-feedback","data-state":v,children:v==="correct"?t.cogita.library.revision.correct:t.cogita.library.revision.tryAgain}),Je?e.jsxs("div",{className:"cogita-revision-reveal",children:[B?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>C(R=>{const $=!R;return $&&Y(),$}),children:t.cogita.library.revision.showAnswer}),B?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),y.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[y.map(R=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:R.key}),e.jsx("span",{children:R.expected})]},R.key)),I?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:I})]}):null]}):e.jsx("p",{children:z?Ae():I})]}):null]}):null,w?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:b,children:t.cogita.library.revision.nextQuestion})}):null]})}const ms={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Gr=(t,n)=>{const s=Math.max(t.length,n.length,1),r=Math.abs(t.length-n.length);return Math.max(0,1-r/s)},Yr=(t,n)=>{const s=new Uint8Array(t.length),r=Gr(t,n);for(let i=0;i<t.length;i+=1){const m=t[i]===(n[i]??"")?128:0,u=t.length-1-i,y=n.length-1-i,N=t[u]===(n[y]??"")?127:0,S=Math.round((m+N)*r);s[i]=Math.max(0,Math.min(255,S))}return s},Qr=(t,n)=>t===n||(ms[t]??[]).includes(n)?!0:(ms[n]??[]).includes(t),Ba=(t,n,s)=>s?Qr(t,n):t===n,Ha=(t,n,s)=>{const r=new Uint8Array(t.length);if(!t.length)return r;const i=(s==null?void 0:s.allowSimilarChars)??!0,m=[];for(let y=0;y<=t.length-3;y+=1)m.push({index:y,text:t.slice(y,y+3)});let u=!1;return m.forEach(y=>{for(let N=0;N<=n.length-3;N+=1){const S=n.slice(N,N+3);let l=0;for(let w=0;w<3;w+=1)Ba(y.text[w],S[w],i)&&(l+=1);if(l<2)continue;let x=y.index-1,c=N-1;for(;x>=0&&c>=0;){const w=t[x],M=n[c];if(w===M){r[x]=Math.max(r[x],255),x-=1,c-=1,u=!0;continue}if(Ba(w,M,i)&&w!==M){r[x]=Math.max(r[x],127),x-=1,c-=1,u=!0;continue}if(x>0&&t[x-1]===M){r[x]=Math.max(r[x],0),x-=1,u=!0;continue}if(c>0&&t[x]===n[c-1]){c-=1,u=!0;continue}break}for(let w=0;w<3;w+=1){const M=y.index+w,F=y.text[w],p=S[w],d=F===p?255:Ba(F,p,i)?127:0;r[M]=Math.max(r[M],d),u=!0}let g=y.index+3,v=N+3;for(;g<t.length&&v<n.length;){const w=t[g],M=n[v];if(w===M){r[g]=Math.max(r[g],255),g+=1,v+=1,u=!0;continue}if(Ba(w,M,i)&&w!==M){r[g]=Math.max(r[g],127),g+=1,v+=1,u=!0;continue}if(g+1<t.length&&t[g+1]===M){r[g]=Math.max(r[g],0),g+=1,u=!0;continue}if(v+1<n.length&&t[g]===n[v+1]){v+=1,u=!0;continue}break}}}),u?r:Yr(t,n)},yn=t=>/[\p{L}\p{N}]/u.test(t),gs=t=>t.trim().toLowerCase(),da=(t,n)=>{if(t.length===0)return 100;const s=(n==null?void 0:n.treatSimilarCharsAsSame)??!1,r=Array.from(t).reduce((i,m)=>s&&m===127?i+255:i+m,0);return Math.round(r/(t.length*255)*100)},Wa=(t,n,s)=>{const r=Math.max(0,Math.min(100,(s==null?void 0:s.thresholdPercent)??100)),i=(s==null?void 0:s.treatSimilarCharsAsSame)??!0,m=(s==null?void 0:s.ignorePunctuationAndSpacing)??!1,u=gs(t),y=gs(n);if(!m){const p=Ha(u,y,{allowSimilarChars:i}),d=da(p,{treatSimilarCharsAsSame:i});return{mask:p,percent:d,isCorrect:d>=r,normalizedExpected:u,normalizedAnswer:y}}const N=Array.from(u),S=Array.from(y),l=[],x=[],c=[];N.forEach((p,d)=>{yn(p)&&(l.push(p),x.push(d))}),S.forEach(p=>{yn(p)&&c.push(p)});const g=l.join(""),v=c.join(""),w=Ha(g,v,{allowSimilarChars:i}),M=new Uint8Array(N.length);for(let p=0;p<M.length;p+=1)M[p]=yn(N[p]??"")?0:255;for(let p=0;p<w.length;p+=1){const d=x[p];d!==void 0&&(M[d]=w[p])}const F=da(w,{treatSimilarCharsAsSame:i});return{mask:M,percent:F,isCorrect:F>=r,normalizedExpected:g,normalizedAnswer:v}},Ta=(t,n,s)=>{const r=t.trim().toLowerCase(),i=n.trim().toLowerCase();return s==="prefix"||s==="bidirectional"?Ha(r,i,{allowSimilarChars:!0}):Ha(r,i,{allowSimilarChars:!0})};function Wt(t){return[t.cardId,t.checkType??"",t.direction??""].join("|")}function ps(t){return[t.parentItemId,t.parentCheckType??"",t.parentDirection??""].join("|")}function fs(t){const n=t.checkType??"info";return t.direction?`${n} / ${t.direction}`:n}function Xr({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l,infoId:x,selectedReviewerRoleId:c}){const[g,v]=a.useState(x),[w,M]=a.useState([]),[F,p]=a.useState([]),[d,ie]=a.useState("loading"),[K,b]=a.useState(null),[O,C]=a.useState(null),[Y,z]=a.useState(null),[I,ue]=a.useState(null),[re,fe]=a.useState(""),[Ce,ye]=a.useState(null),[T,Ie]=a.useState(1),[J,ee]=a.useState(null),[$e,Te]=a.useState(0),[G,ve]=a.useState(!1),[je,Ve]=a.useState(null),[Ue,Le]=a.useState({}),[qe,Ze]=a.useState({}),[Re]=a.useState({}),[We,et]=a.useState(null),nt=a.useRef(null),_e=a.useRef({}),xe=In();a.useEffect(()=>{let E=!1;return ie("loading"),Promise.all([Qt({libraryId:l,infoId:x}).catch(()=>null),Va({libraryId:l,infoId:x}),Oa({libraryId:l,infoId:x})]).then(([U,te,ke])=>{if(E)return;const we=(U==null?void 0:U.payload)??{},ze=typeof we.title=="string"&&we.title||typeof we.label=="string"&&we.label||typeof we.name=="string"&&we.name||x;v(ze),C(we),z((U==null?void 0:U.infoType)??null),M(te.items),p(ke.items),ie("ready")}).catch(()=>{E||(C(null),z(null),M([]),p([]),ie("error"))}),()=>{E=!0}},[l,x]),a.useEffect(()=>{if(Y!=="translation"){ue(null);return}Cs({libraryId:l,infoId:x,approachKey:"vocab-card"}).then(E=>ue(E.projection??null)).catch(()=>ue(null))},[Y,x,l]);const q=a.useMemo(()=>{var Ne;const E=new Map(w.map(le=>[Wt(le),le])),U=new Map,te=new Map;for(const le of w)U.set(Wt(le),0),te.set(Wt(le),[]);for(const le of F){const oe=ps({parentItemId:le.parentItemId,parentCheckType:le.parentCheckType,parentDirection:le.parentDirection}),Ye=[le.childItemId,le.childCheckType??"",le.childDirection??""].join("|");!E.has(oe)||!E.has(Ye)||((Ne=te.get(oe))==null||Ne.push(Ye),U.set(Ye,(U.get(Ye)??0)+1))}const ke=Array.from(U.entries()).filter(([,le])=>le===0).map(([le])=>le),we=new Map;for(const le of ke)we.set(le,0);for(;ke.length;){const le=ke.shift(),oe=we.get(le)??0;for(const Ye of te.get(le)??[]){const He=Math.max(we.get(Ye)??0,oe+1);we.set(Ye,He),U.set(Ye,(U.get(Ye)??1)-1),(U.get(Ye)??0)<=0&&ke.push(Ye)}}const ze=new Map;for(const le of w){const oe=Wt(le),Ye=we.get(oe)??0,He=ze.get(Ye)??[];He.push(oe),ze.set(Ye,He)}return w.map(le=>{const oe=Wt(le),Ye=we.get(oe)??0,He=ze.get(Ye)??[oe],st=Math.max(0,He.indexOf(oe));return{id:oe,position:{x:40+st*290+(Ye%2?18:0),y:30+Ye*120},draggable:!1,selectable:!0,data:{label:le.label,subtitle:fs(le),checkType:le.checkType??"info",direction:le.direction??null},style:{width:250,borderRadius:10,border:"1px solid rgba(120,170,220,0.22)",background:"rgba(8,20,34,0.88)",color:"#e8f2ff",padding:8}}})},[w,F]),Ae=a.useMemo(()=>new Map(w.map(E=>[Wt(E),E])),[w]),ne=a.useMemo(()=>{const E=[];for(const U of F){const te=ps({parentItemId:U.parentItemId,parentCheckType:U.parentCheckType,parentDirection:U.parentDirection}),ke=[U.childItemId,U.childCheckType??"",U.childDirection??""].join("|");!Ae.has(te)||!Ae.has(ke)||E.push({id:`${te}->${ke}`,source:te,target:ke,selectable:!1,animated:!1,style:{stroke:"rgba(148, 202, 248, 0.7)"}})}return E},[Ae,F]),B=a.useMemo(()=>K?Ae.get(K)??null:null,[Ae,K]);a.useEffect(()=>{fe(""),ee(null),Te(0),ve(!1),Ve(null),ye(null),Ze({})},[K]);const he=a.useMemo(()=>{var we,ze;if(!B)return null;const E=Y??B.infoType??null,U=B.checkType??"info",te=B.direction??null,ke=O??{};if(B.cardType==="vocab"&&I&&Array.isArray(I.words)){const Ne=I.words,le=((we=Ne[0])==null?void 0:we.label)??"?",oe=((ze=Ne[1])==null?void 0:ze.label)??"?";return te==="a-to-b"?{kind:"vocab",prompt:String(le),expected:String(oe)}:te==="b-to-a"?{kind:"vocab",prompt:String(oe),expected:String(le)}:{kind:"generic",prompt:`${le} ↔ ${oe}`,expected:`${le} ↔ ${oe}`}}if(E==="citation"&&U==="quote-fragment"&&te&&typeof ke.text=="string"){const Ne=te,le=fa(ke.text),oe=le.nodes[Ne];if(oe){const Ye=Pn(ke.text,oe);return{kind:"citation-fragment",expected:oe.text,quoteContext:{title:g,before:Ye.before,after:Ye.after,total:Object.keys(le.nodes).length,completed:0},quotePlaceholder:oe.text.length>0?".".repeat(Math.max(4,Math.min(18,oe.text.length))):"..."}}}return{kind:"generic",prompt:B.description||B.label,expected:B.label}},[Y,O,B,g,I]),Je=async E=>{if(B&&c)try{await Zs({libraryId:l,outcome:{itemType:"info",itemId:B.cardId,checkType:B.checkType??"info",direction:B.direction??null,revisionType:"direct",evalType:"direct-check",correct:E,clientId:"cogita-info-checkcards",clientSequence:T,personRoleId:c}}),Ie(U=>U+1),ye(E?"Saved as correct.":"Saved as incorrect.")}catch{ye("Failed to save answer.")}},R=B?Wt(B):null,$=R?!!Ue[R]:!1,Q=async()=>{if(!B||!he)return;const E=Wt(B);if(Ue[E]){ye("This card was already checked.");return}const U=he.expected,te=he.kind==="citation-fragment",ke=Wa(U,re,{thresholdPercent:te?90:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:te}),we=ke.isCorrect;ee(we?"correct":"incorrect"),Te(ze=>ze+1),Ve(ke.mask),ve(!0),ye(c?null:"Answer checked locally (not saved: no person selected)."),Le(ze=>({...ze,[E]:!0})),c&&await Je(we)},se=()=>{if(!B||!he)return;const E=Wt(B);Ue[E]||(Le(te=>({...te,[E]:!0})),ye("Answer revealed (not saved)."));const U=Wa(he.expected,he.expected,{thresholdPercent:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:he.kind==="citation-fragment"});Ve(U.mask)},j=a.useMemo(()=>B?B.infoType==="citation"?{...B,description:g}:{...B,description:B.label}:null,[B,g]),_=a.useMemo(()=>Y?Xe(t,Y):t.cogita.library.infoTypes.any,[t,Y]);return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-info-checkcards-page",children:[e.jsxs("header",{className:"cogita-info-checkcards-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:_}),e.jsx("h2",{className:"cogita-card-title",children:g}),e.jsx("p",{className:"cogita-card-subtitle",children:x})]}),e.jsxs("div",{className:"cogita-selection-overview",children:[e.jsx("span",{className:"cogita-tag-chip",children:`Cards: ${w.length}`}),e.jsx("span",{className:"cogita-tag-chip",children:`Dependencies: ${F.length}`}),e.jsx("button",{type:"button",className:"cta",disabled:w.length===0,onClick:()=>xe(`/cogita/library/${l}/revision/run?scope=info&infoId=${encodeURIComponent(x)}`),children:"Start revision"})]})]}),d==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading checkcards..."})}):d==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load checkcards."})}):e.jsxs("div",{className:"cogita-info-checkcards-layout",children:[e.jsxs("div",{className:"cogita-info-checkcards-main",children:[e.jsx("div",{className:"cogita-info-checkcards-graph",children:e.jsxs(Ln,{nodes:q,edges:ne,fitView:!0,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!0,onNodeClick:(E,U)=>b(U.id),panOnDrag:!0,children:[e.jsx($n,{}),e.jsx(Rn,{showInteractive:!1})]})}),B?e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[he&&j?e.jsx(Kn,{flashState:J,flashTick:$e,children:e.jsx(Fn,{copy:t,currentCard:j,currentTypeLabel:"",prompt:he.kind==="citation-fragment"?null:he.prompt,languages:[],answer:re,onAnswerChange:fe,computedExpected:[],computedAnswers:qe,onComputedAnswerChange:(E,U)=>Ze(te=>({...te,[E]:U})),answerTemplate:null,outputVariables:null,variableValues:null,computedFieldFeedback:Re,feedback:J,canAdvance:!1,quoteContext:he.kind==="citation-fragment"?he.quoteContext:null,quotePlaceholder:he.kind==="citation-fragment"?he.quotePlaceholder:null,onCheckAnswer:()=>void Q(),onSkip:()=>b(null),onLanguageSelect:()=>{},onMarkReviewed:()=>{},onAdvance:()=>{},showCorrectAnswer:G,setShowCorrectAnswer:ve,onRevealCorrect:se,answerMask:je,expectedAnswer:he.expected,hasExpectedAnswer:!0,handleComputedKeyDown:()=>{},answerInputRef:nt,computedInputRefs:_e,scriptMode:We,setScriptMode:et,matchPairs:void 0,matchLeftOrder:void 0,matchRightOrder:void 0,matchSelection:void 0,matchActiveLeft:null,matchActiveRight:null,matchFeedback:void 0,onMatchLeftSelect:void 0,onMatchRightSelect:void 0,disableCheckAnswer:$||G,hideSkipAction:!0,allowRevealBeforeCheck:!0,autoRevealAfterAnswer:!0,disableCheckAfterAnswer:!0})}):null,c?null:e.jsx("p",{className:"cogita-library-hint",children:"Result can be checked without a person; saving knowness requires a selected person in the header."}),Ce?e.jsx("p",{className:"cogita-library-hint",children:Ce}):null]}):e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[e.jsx("h4",{children:"Select a checking card"}),e.jsx("p",{className:"cogita-card-subtitle",children:"Choose a node in the dependency tree to preview and answer it."})]})]}),e.jsxs("aside",{className:"cogita-info-checkcards-panel",children:[e.jsx("h3",{children:"Checking cards"}),e.jsx("div",{className:"cogita-info-tree",children:w.map(E=>{const U=Wt(E),te=K===U;return e.jsxs("button",{type:"button",className:`ghost cogita-checkcard-row ${te?"active":""}`,onClick:()=>b(U),children:[e.jsx("span",{children:E.label}),e.jsx("small",{children:fs(E)})]},U)})})]})]})]})})})})})}function Zr({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l,collectionId:x}){const{libraryName:c}=sa(l),[g,v]=a.useState([]),[w,M]=a.useState("loading"),[F,p]=a.useState("idle"),d=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ie=`/#/cogita/library/${l}`,K=()=>{M("loading"),Is({libraryId:l}).then(C=>{v(C),M("idle")}).catch(()=>{v([]),M("error")})};a.useEffect(()=>{K()},[l]);const b=async C=>{try{await Ls({libraryId:l,shareId:C}),K()}catch{K()}},O=async C=>{const Y=`${d}/${C}`;try{await navigator.clipboard.writeText(Y),p("copied")}catch{p("failed")}};return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:ie,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${ie}/collections`,children:t.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[w==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):w==="error"?e.jsx("p",{children:t.cogita.library.revision.shareError}):g.filter(C=>!x||C.collectionId===x).length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:g.filter(C=>!x||C.collectionId===x).map(C=>e.jsxs("div",{className:"cogita-share-row","data-state":C.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:C.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(C.createdUtc).toLocaleString(),C.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]}),C.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${d}/${C.shareCode}`}):null]}),C.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[C.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>O(C.shareCode),children:t.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>b(C.shareId),children:t.cogita.library.revision.shareRevokeAction})]})]},C.shareId))}),F==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):F==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function ei({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l}){const{libraryName:x}=sa(l),[c,g]=a.useState(null),[v,w]=a.useState(null),[M,F]=a.useState(null),[p,d]=a.useState(null),[ie,K]=a.useState(null),[b,O]=a.useState(null),C=a.useRef(null),Y=ue=>{if(!Number.isFinite(ue))return"0 B";if(ue<1024)return`${ue} B`;const re=ue/1024;if(re<1024)return`${re.toFixed(1)} KB`;const fe=re/1024;return fe<1024?`${fe.toFixed(1)} MB`:`${(fe/1024).toFixed(1)} GB`},z=async()=>{g(null),K({loadedBytes:0,totalBytes:null,percent:null});try{g(t.cogita.library.overview.exporting);const ue=await er(l,K),re=URL.createObjectURL(ue),fe=document.createElement("a");fe.href=re,fe.download=`cogita-library-${x||l}.json`,fe.click(),URL.revokeObjectURL(re),g(t.cogita.library.overview.exportReady)}catch{g(t.cogita.library.overview.exportFail)}finally{K(ue=>ue??{loadedBytes:0,totalBytes:null,percent:null})}},I=async ue=>{var fe;w(null),F(null),d(null);const re=(fe=ue.target.files)==null?void 0:fe[0];if(re)try{w(t.cogita.library.overview.importing),O({loadedBytes:0,totalBytes:re.size,percent:0});const Ce=await tr(l,re,O,ye=>{const T=ye.stage==="infos"?t.cogita.library.overview.importStageInfos:ye.stage==="connections"?t.cogita.library.overview.importStageConnections:t.cogita.library.overview.importStageCollections;d(t.cogita.library.overview.importLiveProgress.replace("{stage}",T).replace("{done}",String(ye.processed)).replace("{total}",String(ye.total)).replace("{infos}",String(ye.infos)).replace("{connections}",String(ye.connections)).replace("{collections}",String(ye.collections)))});F({infos:Ce.infosImported,connections:Ce.connectionsImported,collections:Ce.collectionsImported}),w(t.cogita.library.overview.importDone)}catch(Ce){const ye=Ce instanceof Ms&&Ce.message?` ${Ce.message}`:"";w(`${t.cogita.library.overview.importFail}${ye}`)}finally{C.current&&(C.current.value="")}};return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:z,children:t.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[t.cogita.library.overview.import,e.jsx("input",{ref:C,type:"file",accept:"application/json",onChange:I})]})]}),ie?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:ie.percent??void 0,max:ie.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.exportProgress.replace("{loaded}",Y(ie.loadedBytes)).replace("{total}",ie.totalBytes?Y(ie.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,b?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:b.percent??void 0,max:b.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.importProgress.replace("{loaded}",Y(b.loadedBytes)).replace("{total}",b.totalBytes?Y(b.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,c?e.jsx("p",{className:"cogita-help",children:c}):null,v?e.jsx("p",{className:"cogita-help",children:v}):null,p?e.jsx("p",{className:"cogita-help",children:p}):null,M?e.jsx("p",{className:"cogita-help",children:t.cogita.library.overview.importSummary.replace("{infos}",String(M.infos)).replace("{connections}",String(M.connections)).replace("{collections}",String(M.collections))}):null]})]})})})]})})}function ti({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l}){const{libraryName:x}=sa(l),[c,g]=a.useState(""),[v,w]=a.useState([]),M=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:c,onChange:F=>g(F.target.value),placeholder:t.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const F=c.trim();F&&(w(p=>[{id:M(),name:F},...p]),g(""))},children:t.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[v.length===0?e.jsx("p",{children:t.cogita.library.modules.storyboardsEmpty}):null,v.map(F=>e.jsx("button",{type:"button",className:"ghost",children:F.name},F.id))]})]})]})})})]})})}function ai({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l}){const{libraryName:x}=sa(l),[c,g]=a.useState(""),[v,w]=a.useState([]),M=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:c,onChange:F=>g(F.target.value),placeholder:t.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const F=c.trim();F&&(w(p=>[{id:M(),name:F},...p]),g(""))},children:t.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[v.length===0?e.jsx("p",{children:t.cogita.library.modules.textsEmpty}):null,v.map(F=>e.jsx("button",{type:"button",className:"ghost",children:F.name},F.id))]})]})]})})})]})})}function bs({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l}){const{libraryName:x}=sa(l),c=`/#/cogita/library/${l}`,[g,v]=a.useState(""),[w,M]=a.useState([]),[F,p]=a.useState("idle"),[d,ie]=a.useState(0),[K,b]=a.useState(null);a.useEffect(()=>{p("loading");const C=window.setTimeout(()=>{Aa({libraryId:l,query:g.trim()||void 0,limit:30}).then(Y=>{M(Y.items),ie(Y.total),b(Y.nextCursor??null),p("ready")}).catch(()=>{M([]),ie(0),b(null),p("ready")})},240);return()=>window.clearTimeout(C)},[l,g]);const O=async()=>{if(K){p("loading");try{const C=await Aa({libraryId:l,query:g.trim()||void 0,limit:30,cursor:K});M(Y=>[...Y,...C.items]),b(C.nextCursor??null),ie(C.total),p("ready")}catch{p("ready")}}};return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${c}/collections/new`,children:t.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:g,onChange:C=>v(C.target.value),placeholder:t.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:t.cogita.library.collections.countLabel.replace("{shown}",String(w.length)).replace("{total}",String(d||w.length))}),e.jsx("span",{children:F==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:w.length?w.map(C=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${c}/collections/${C.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:C.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.collections.itemCountLabel.replace("{count}",String(C.itemCount))," ·"," ",C.notes||t.cogita.library.collections.noNotes]})]})},C.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${c}/collections/new`,children:t.cogita.library.collections.emptyAction})]})}),K?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:O,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const me=t=>`${t.cardType}:${t.cardId}:${t.checkType??""}:${t.direction??""}`,Vt=(t,n,s,r)=>`${t}:${n}:${s??""}:${r??""}`;function ni({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l,collectionId:x}){sa(l);const c=`/#/cogita/library/${l}`,[g,v]=a.useState(t.cogita.library.collections.defaultName),[w,M]=a.useState(null),[F,p]=a.useState(0),[d,ie]=a.useState([]),[K,b]=a.useState("idle"),[O,C]=a.useState(null),Y=a.useMemo(()=>t.cogita.library.list.cardCount.replace("{shown}",String(d.length)).replace("{total}",String(F||d.length)),[t,d.length,F]);a.useEffect(()=>{an(l,x).then(I=>{v(I.name),M(I.notes??null),p(I.itemCount)}).catch(()=>{v(t.cogita.library.collections.defaultName),M(null)})},[l,x]),a.useEffect(()=>{b("loading"),qa({libraryId:l,collectionId:x,limit:40}).then(I=>{ie(I.items),C(I.nextCursor??null),p(I.total),b("ready")}).catch(()=>{ie([]),C(null),b("ready")})},[l,x]);const z=async()=>{if(O){b("loading");try{const I=await qa({libraryId:l,collectionId:x,limit:40,cursor:O});ie(ue=>[...ue,...I.items]),C(I.nextCursor??null),p(I.total),b("ready")}catch{b("ready")}}};return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:g}),e.jsx("p",{className:"cogita-library-subtitle",children:w||t.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${c}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${c}/collections/${x}/graph`,children:t.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${c}/collections/${x}/revision`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:Y}),e.jsx("span",{children:K==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:d.length?d.map(I=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:I.cardType==="vocab"?t.cogita.library.list.cardTypeVocab:I.cardType==="connection"?t.cogita.library.list.cardTypeConnection:t.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:I.label}),e.jsx("p",{className:"cogita-card-subtitle",children:I.description})]})},me(I))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.collections.noCards})})}),O?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:z,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${c}/collections/${x}/revision`,children:t.cogita.library.actions.startRevision})})]})})]})})})]})})}const Gt=t=>{if(!t.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=t.length,s=t.filter(m=>m.correct).length,r=nn(Dn(t));return{score:Math.round(Math.max(0,Math.min(100,r.knowness*100))*100)/100,total:n,correct:s,lastReviewedUtc:r.lastReviewedUtc??null}},si=t=>{if(t.maskBase64)try{const n=ar(t.maskBase64);if(!n.length)return t.correct?1:0;const s=n.reduce((r,i)=>r+i,0);return Math.max(0,Math.min(1,s/n.length/255))}catch{return t.correct?1:0}return t.correct?1:0},Dn=t=>t.map(n=>({correctness:si(n),createdUtc:n.createdUtc})),nn=(t,n=Date.now())=>{var F;if(!t.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const r=t.slice().sort((p,d)=>p.createdUtc.localeCompare(d.createdUtc)).slice(-5),i=r.reduce((p,d)=>p+d.correctness,0)/r.length,m=5,u=2,y=.15;let N=0,S=0;for(let p=0;p<r.length;p+=1){const d=new Date(r[p].createdUtc).getTime(),ie=p===r.length-1?n:new Date(r[p+1].createdUtc).getTime(),K=Math.max(0,(ie-d)/(1e3*60)),b=1-Math.exp(-K/m);N+=b,r[p].correctness>.5&&(S+=y)}let l=i*N*u+S;const x=((F=r[r.length-1])==null?void 0:F.createdUtc)??null,c=x?Math.max(0,(n-new Date(x).getTime())/(1e3*60)):0,v=1/(1+Math.log1p(c/60));return l*=v,r.length===1&&r[0].correctness>.5&&(l+=5.44*Math.exp(-c/2)),{knowness:l,avgCorrectness:i,lastReviewedUtc:x}},Ea=t=>{const n=t.slice();for(let s=n.length-1;s>0;s-=1){const r=Math.floor(Math.random()*(s+1));[n[s],n[r]]=[n[r],n[s]]}return n},_a=t=>t[Math.floor(Math.random()*t.length)],ri=(t,n)=>{const s=new Map;return t.forEach(r=>s.set(r,Math.random())),t.sort((r,i)=>{const m=n(r)-n(i);return m!==0?m:(s.get(r)??0)-(s.get(i)??0)})},sn=(t,n,s,r,i)=>{if(!t.length)return null;const m=t.filter(y=>!(i!=null&&i.has(me(y))));if(m.length===0)return null;const u=m.filter(y=>me(y)!==s);return _a(u.length?u:m)},ii=(t,n,s,r,i)=>{if(!t.length)return null;let m=Number.POSITIVE_INFINITY;for(const S of t){const l=me(S);if(s.has(l))continue;const x=n[l]??1;x<m&&(m=x)}if(!Number.isFinite(m))return null;const u=t.filter(S=>{const l=me(S);return!s.has(l)&&(n[l]??1)===m}),y=u.filter(S=>!i||me(S)!==i),N=r?y.filter(S=>!r.has(me(S))):y;return N.length>0?_a(N):y.length>0?_a(y):i&&u.some(S=>me(S)===i)?u.find(S=>me(S)===i)??null:u.length?_a(u):null},Ps=(t,n,s,r,i)=>{const m=[],u=t.filter(N=>!i.has(me(N))&&!s.has(me(N))&&(n[me(N)]??0)<1),y=ri(u,N=>n[me(N)]??0);for(const N of y){if(m.length>=r)break;m.push(N),i.add(me(N))}if(m.length<r){const N=Ea(t.filter(S=>!i.has(me(S))&&s.has(me(S))));for(const S of N){if(m.length>=r)break;m.push(S),i.add(me(S))}}return m},oi=(t,n,s,r)=>Ps(t,n,s,r,new Set),zn=(t,n,s,r,i,m)=>{const u=Math.max(1,s.stackSize??n),N=Ea(t).filter((v,w,M)=>M.findIndex(F=>me(F)===me(v))===w),S=oi(N,r,i,u),l=new Set,x=new Set,c=sn(S,{},null,l,x),g=c?[c]:[];return c&&x.add(me(c)),{queue:g,meta:{pool:N,active:S,knownessMap:r,unknownSet:i,outcomesById:m,asked:l,queued:x}}},Mn={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:t=>t,prepare:(t,n)=>{const r=Ea(t).filter((i,m,u)=>u.findIndex(y=>me(y)===me(i))===m);return{queue:r.slice(0,Math.min(n,r.length)),meta:{}}},applyOutcome:t=>t},Bn=(t,n,s,r)=>{const i=Math.max(1,s.stackSize??n),u=Ea(t).filter((w,M,F)=>F.findIndex(p=>me(p)===me(w))===M),y={},N=new Set,S=new Set,l=new Set,x=Math.max(1,s.levels??1);u.forEach(w=>{const M=me(w),F=r==null?void 0:r[M],p=typeof F=="number"&&Number.isFinite(F)?F:1;y[M]=Math.min(x,Math.max(1,Math.round(p)))});const c=[];if(u.length>0){const w=new Map;u.forEach(F=>{var d;const p=y[me(F)]??1;w.has(p)||w.set(p,[]),(d=w.get(p))==null||d.push(F)});const M=Array.from(w.keys()).sort((F,p)=>F-p);for(const F of M){if(c.length>=i)break;const p=Ea(w.get(F)??[]);for(const d of p){if(c.length>=i)break;c.push(d)}}}const g=sn(c,y,null,N,S),v=g?[g]:[];return g&&S.add(me(g)),{queue:v,meta:{pool:u,active:c,levelMap:y,asked:N,queued:S,wrongSinceCorrect:l}}},li={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,n)=>Math.max(1,n.stackSize??t),getProgressTotal:()=>null,prepare:(t,n,s)=>Bn(t,n,s),applyOutcome:(t,n,s,r,i)=>{if(!n)return t;const m=Math.max(1,r.levels??1),u=t.meta.pool??[],y=t.meta.active??[],N={...t.meta.levelMap??{}},S=new Set(t.meta.asked??[]),l=new Set(t.meta.queued??[]),x=new Set(t.meta.wrongSinceCorrect??[]),c=me(n);l.delete(c),S.add(c);const g=N[c]??1;i.correct?(N[c]=x.has(c)?1:Math.min(g+1,m),x.delete(c)):(N[c]=1,x.add(c));const v=i.correct?y.filter(F=>me(F)!==c):y.slice();if(i.correct&&v.length<Math.max(1,r.stackSize??1)){const F=new Set(v.map(d=>me(d))),p=ii(u,N,F,S,c);p&&v.push(p)}const w=t.queue.slice(),M=sn(v,N,c,S,l);return M&&(w.push(M),l.add(me(M))),{queue:w,meta:{pool:u,active:v,levelMap:N,asked:S,queued:l,wrongSinceCorrect:x}}}},ci={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,n)=>Math.max(1,n.stackSize??t),getProgressTotal:()=>null,prepare:(t,n,s)=>zn(t,n,s,{},new Set,{}),applyOutcome:(t,n,s,r,i)=>{if(!n)return t;const m=t.meta.pool??[],u=t.meta.active??[],y={...t.meta.knownessMap??{}},N=new Set(t.meta.unknownSet??[]),S={...t.meta.outcomesById??{}},l=new Set(t.meta.asked??[]),x=new Set(t.meta.queued??[]),c=me(n);x.delete(c),l.add(c);const g={correctness:Math.max(0,Math.min(1,i.correctness??(i.correct?1:0))),createdUtc:i.createdUtc??new Date().toISOString()},w=(S[c]??[]).concat(g).sort((K,b)=>K.createdUtc.localeCompare(b.createdUtc)).slice(-5);S[c]=w,N.delete(c);const M=Date.now();m.forEach(K=>{const b=me(K),O=S[b]??[];if(O.length===0){y[b]=0,N.add(b);return}const C=nn(O,M);y[b]=C.knowness});const F=u.slice();if((y[c]??0)>=1){const K=F.filter(b=>me(b)!==c);F.length=0,F.push(...K)}const d=Math.max(1,r.stackSize??s);if(F.length<d){const K=new Set(F.map(O=>me(O))),b=Ps(m,y,N,d-F.length,K);F.push(...b)}const ie=t.queue.slice();if(ie.length===0||me(ie[ie.length-1])===c){const K=sn(F,{},c,l,x);K&&(ie.push(K),x.add(me(K)))}return{queue:ie,meta:{pool:m,active:F,knownessMap:y,unknownSet:N,outcomesById:S,asked:l,queued:x}}}},Ks={random:Mn,levels:li,temporal:ci},di=Object.values(Ks),_n=t=>{if(!t)return Mn;const n=t.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?Ks[n]:Mn},rn=(t,n)=>{const s={...t.defaultSettings};return n&&Object.entries(n).forEach(([r,i])=>{typeof i=="number"&&Number.isFinite(i)&&(s[r]=i),typeof i=="string"&&(s[r]=i)}),t.settingsFields.forEach(r=>{var m;const i=s[r.key];if(r.type==="number"){if(typeof i!="number"||Number.isNaN(i)){s[r.key]=t.defaultSettings[r.key]??0;return}r.min!==void 0&&(s[r.key]=Math.max(r.min,s[r.key])),r.max!==void 0&&(s[r.key]=Math.min(r.max,s[r.key]));return}if(r.type==="select"){const u=((m=r.options)==null?void 0:m.map(y=>y.value))??[];(typeof i!="string"||u.length>0&&!u.includes(i))&&(s[r.key]=t.defaultSettings[r.key]??u[0]??"")}}),s},Fs=(t,n)=>{const s={};return t.settingsFields.forEach(r=>{const i=n.get(r.key);if(i){if(r.type==="number"){const m=Number(i);Number.isNaN(m)||(s[r.key]=m);return}s[r.key]=i}}),rn(t,s)},ui=(t,n)=>{const s=new URLSearchParams;return t.settingsFields.forEach(r=>{const i=n[r.key];(typeof i=="number"||typeof i=="string")&&s.set(r.key,String(i))}),s};function hi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l,collectionId:x,revisionId:c}){const{libraryName:g}=sa(l),v=`/#/cogita/library/${l}`,[w,M]=a.useState(t.cogita.library.collections.defaultName),[F,p]=a.useState(""),[d,ie]=a.useState(20),[K,b]=a.useState("random"),[O,C]=a.useState({}),[Y,z]=a.useState("exact"),[I,ue]=a.useState([]),[re,fe]=a.useState(null),[Ce,ye]=a.useState([]),[T,Ie]=a.useState("idle"),[J,ee]=a.useState(null),[$e,Te]=a.useState("idle"),[G,ve]=a.useState("idle"),[je,Ve]=a.useState("idle"),Ue=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Le=a.useMemo(()=>_n(K),[K]),qe=a.useMemo(()=>rn(Le,O),[Le,O]),Ze=a.useMemo(()=>ui(Le,qe).toString(),[Le,qe]);a.useEffect(()=>{an(l,x).then(xe=>M(xe.name)).catch(()=>M(t.cogita.library.collections.defaultName))},[l,x]),a.useEffect(()=>{c&&nr({libraryId:l,collectionId:x,revisionId:c}).then(xe=>{p(xe.name),b(xe.mode||"random"),z(xe.check||"exact"),ie(xe.limit||20),C(xe.revisionSettings??{})}).catch(()=>{p("")})},[x,l,c]),a.useEffect(()=>{$s({libraryId:l}).then(xe=>{ue(xe),!re&&xe.length>0&&fe(xe[0].roleId)}).catch(()=>{ue([])})},[l]);const Re=()=>{ve("loading"),Is({libraryId:l}).then(xe=>{ye(xe),ve("idle")}).catch(()=>{ye([]),ve("error")})};a.useEffect(()=>{Re()},[l]);const We=async()=>{Ie("working"),Te("idle");try{const xe=await rr({libraryId:l,collectionId:x,revisionType:Le.id,revisionSettings:qe,mode:K,check:Y,limit:d});ee(`${Ue}/${xe.shareCode}${Ze?`?${Ze}`:""}`),Ie("ready"),Re()}catch{Ie("error")}},et=async()=>{if(c){Ve("saving");try{await sr({libraryId:l,collectionId:x,revisionId:c,name:F||w,revisionType:Le.id,revisionSettings:qe,mode:K,check:Y,limit:d}),Ve("saved")}catch{Ve("error")}}},nt=async()=>{if(J)try{await navigator.clipboard.writeText(J),Te("copied")}catch{Te("failed")}},_e=async xe=>{try{await Ls({libraryId:l,shareId:xe}),Re()}catch{Re()}};return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:w}),e.jsx("p",{className:"cogita-library-subtitle",children:g})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:v,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${v}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${v}/collections/${x}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${v}/collections/${x}/revision/run?mode=${encodeURIComponent(K)}&check=${encodeURIComponent(Y)}&limit=${d}${Ze?`&${Ze}`:""}${re?`&reviewer=${encodeURIComponent(re)}`:""}${c?`&revisionId=${encodeURIComponent(c)}`:""}`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:F,onChange:xe=>p(xe.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsx("select",{value:K,onChange:xe=>b(xe.target.value),children:di.map(xe=>e.jsx("option",{value:xe.id,children:t.cogita.library.revision[xe.labelKey]},xe.id))})]}),Le.settingsFields.map(xe=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision[xe.labelKey]}),xe.type==="select"?e.jsx("select",{value:String(qe[xe.key]??""),onChange:q=>C(Ae=>({...Ae,[xe.key]:q.target.value})),children:(xe.options??[]).map(q=>e.jsx("option",{value:q.value,children:t.cogita.library.revision[q.labelKey]},q.value))}):e.jsx("input",{type:"number",min:xe.min,max:xe.max,step:xe.step,value:qe[xe.key]??0,onChange:q=>C(Ae=>({...Ae,[xe.key]:Number(q.target.value||0)}))})]},xe.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.checkLabel}),e.jsx("input",{value:t.cogita.library.revision.checkValue,disabled:!0})]}),Le.id!=="levels"&&Le.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:d,onChange:xe=>ie(Number(xe.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:re??"",onChange:xe=>fe(xe.target.value||null),children:I.map(xe=>e.jsx("option",{value:xe.roleId,children:xe.label},xe.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.previewBody1}),e.jsx("p",{children:t.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[c?e.jsx("button",{type:"button",className:"cta ghost",onClick:et,disabled:je==="saving",children:je==="saving"?"...":t.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${v}/collections/${x}/revision/run?mode=${encodeURIComponent(K)}&check=${encodeURIComponent(Y)}&limit=${d}${Ze?`&${Ze}`:""}${re?`&reviewer=${encodeURIComponent(re)}`:""}${c?`&revisionId=${encodeURIComponent(c)}`:""}`,children:t.cogita.library.actions.startRevision})]}),je==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.shareBody}),J?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:J,readOnly:!0})]}):null,T==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareError}):null,$e==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):$e==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:We,disabled:T==="working",children:T==="working"?t.cogita.library.revision.shareWorking:t.cogita.library.revision.shareAction}),J?e.jsx("button",{type:"button",className:"cta ghost",onClick:nt,children:t.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),G==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):Ce.length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:Ce.map(xe=>e.jsxs("div",{className:"cogita-share-row","data-state":xe.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:xe.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(xe.createdUtc).toLocaleString(),xe.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]})]}),xe.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>_e(xe.shareId),children:t.cogita.library.revision.shareRevokeAction})]},xe.shareId))})]})]})]})]})})})]})})}const xn=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function Ds(t,n,s){if(!t)return null;const r=new Map(t.nodes.map(K=>[K.id,K])),i=new Map,m=new Set,u=K=>{if(typeof K=="number")return K;if(typeof K=="string"){const b=Number(K);return Number.isFinite(b)?b:0}return 0},y=K=>{if(i.has(K))return i.get(K);if(m.has(K))return 0;const b=r.get(K);if(!b)return 0;m.add(K);const O=Y=>{var I,ue;return(Y?((I=b.inputsByHandle)==null?void 0:I[Y])??[]:b.inputs??((ue=b.inputsByHandle)==null?void 0:ue.in)??[]).map(re=>y(re))};let C=0;switch(b.type){case"input.random":{const Y=b.min??0,z=b.max??Y+10,I=Math.min(Y,z),ue=Math.max(Y,z);C=Math.floor(Math.random()*(ue-I+1))+I;break}case"input.const":{C=b.value??0;break}case"input.list":{const Y=(b.list??[]).filter(Boolean),z=Math.round(u(O("index")[0]));C=Y.length?Y[Math.max(0,Math.min(Y.length-1,z))]:String(z);break}case"compute.add":{C=O("in").map(z=>u(z)).reduce((z,I)=>z+I,0);break}case"compute.sub":{const Y=O("add").map(I=>u(I)),z=O("sub").map(I=>u(I));C=Y.reduce((I,ue)=>I+ue,0)-z.reduce((I,ue)=>I+ue,0);break}case"compute.mul":{const Y=O("in").map(z=>u(z));C=Y.length?Y.reduce((z,I)=>z*I,1):0;break}case"compute.div":{const Y=u(O("num")[0]),z=O("den").map(I=>u(I)).reduce((I,ue)=>I+ue,0);C=Math.abs(z)<Number.EPSILON?0:Y/z;break}case"compute.pow":{const Y=u(O("base")[0]),z=u(O("exp")[0]);C=Math.pow(Y,z);break}case"compute.exp":{const Y=u(O("base")[0]),z=u(O("exp")[0]);C=Math.pow(Y,z);break}case"compute.log":{const Y=u(O("value")[0]),z=u(O("base")[0]),I=Math.max(Y,Number.EPSILON);C=Math.abs(z)<Number.EPSILON?Math.log(I):Math.log(I)/Math.log(z);break}case"compute.abs":{C=Math.abs(u(O("in")[0]));break}case"compute.min":{const Y=O("in").map(z=>u(z));C=Y.length?Math.min(...Y):0;break}case"compute.max":{const Y=O("in").map(z=>u(z));C=Y.length?Math.max(...Y):0;break}case"compute.floor":{C=Math.floor(u(O("in")[0]));break}case"compute.ceil":{C=Math.ceil(u(O("in")[0]));break}case"compute.round":{C=Math.round(u(O("in")[0]));break}case"compute.mod":{const Y=u(O("a")[0]),z=u(O("b")[0]);C=Math.abs(z)<Number.EPSILON?0:Y%z;break}case"compute.concat":{const z=["in1","in2","in3","in4","in5","in6"].flatMap(fe=>O(fe)),I=z.length?z:O("in");C=(I.length?I:O()).map(fe=>fe==null?"":String(fe)).join("");break}case"compute.trim":{const Y=O("text")[0]??O("in")[0]??"",z=Y==null?"":String(Y),I=Math.max(0,Math.round(u(O("start")[0]))),ue=Math.max(0,Math.round(u(O("end")[0])));I+ue>=z.length?C="":C=z.substring(I,z.length-ue);break}case"output":{C=O("in")[0]??0;break}default:C=0}return m.delete(K),i.set(K,C),C},N=t.outputs&&t.outputs.length>0?t.outputs:t.output?[t.output]:t.nodes.filter(K=>K.type==="output").map(K=>K.id);t.nodes.forEach(K=>y(K.id)),N.forEach(K=>y(K));const S=K=>Math.abs(K%1)<1e-5?String(Math.round(K)):K.toFixed(3).replace(/\.?0+$/,""),l=K=>typeof K=="number"?S(K):K??"",x=new Map;N.forEach(K=>{var z,I,ue,re;const b=r.get(K);if(!b)return;const O=(I=(z=b.inputsByHandle)==null?void 0:z.name)==null?void 0:I[0],C=O?l(i.get(O)):"",Y=(C==null?void 0:C.toString().trim())||((ue=b.outputLabel)==null?void 0:ue.trim())||((re=b.name)==null?void 0:re.trim())||K;x.set(K,Y)});const c={},g={},v={};N.forEach(K=>{var C,Y;const b=r.get(K);if(!b)return;const O=x.get(K)??(((C=b.outputLabel)==null?void 0:C.trim())||((Y=b.name)==null?void 0:Y.trim())||K);c[O]=l(i.get(K)),b.name&&(g[b.name.trim()]=O),g[K]=O});const w=(K,b)=>{let O=K;return t.nodes.forEach(C=>{var re,fe;const Y=l(i.get(C.id)),z=N.includes(C.id),I=z?x.get(C.id)??((re=C.outputLabel)==null?void 0:re.trim())??((fe=C.name)==null?void 0:fe.trim())??C.id:"",ue=z&&b?I:Y;O=O.replace(new RegExp(`\\{\\s*${xn(C.id)}\\s*\\}`,"gi"),ue),C.name&&(O=O.replace(new RegExp(`\\{\\s*${xn(C.name)}\\s*\\}`,"gi"),ue)),z&&C.outputLabel&&(O=O.replace(new RegExp(`\\{\\s*${xn(C.outputLabel)}\\s*\\}`,"gi"),I))}),O},M=n;let F=M.trim().length>0?M:"";F||(F=N.length?`Compute ${N.join(", ")}`:"Compute"),F=w(F,!0);const p=(s==null?void 0:s.trim())??"",d=p?w(p,!1):"",ie={};return i.forEach((K,b)=>{ie[b]=K,v[b]=l(K);const O=r.get(b);O!=null&&O.name&&(v[O.name.trim()]=l(K))}),{prompt:F,answers:c,values:ie,answerText:d,outputVariables:g,variableValues:v}}function zs(t){var s;const n=Object.entries(t.answers);return{prompt:t.prompt,expectedAnswer:t.answerText??((s=n[0])==null?void 0:s[1])??"",expectedAnswers:t.answers,values:t.values,expectedAnswerIsSentence:!!(t.answerText&&t.answerText.trim().length>0),outputVariables:t.outputVariables,variableValues:t.variableValues}}const vn=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function Bs({outcomes:t}){const[n,s]=a.useState("day"),r=a.useMemo(()=>{const i=vn.find(y=>y.id===n)??vn[1],m=Date.now()-i.ms,u=t.filter(y=>new Date(y.createdUtc).getTime()>=m);return Gt(u)},[t,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:vn.map(i=>e.jsx("button",{type:"button",className:"ghost","data-active":n===i.id,onClick:()=>s(i.id),children:i.label},i.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[r.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[r.correct," / ",r.total]})]})}const mi="cogita-revision",gi=1,Ga="outcomes",pi=()=>new Promise((t,n)=>{const s=indexedDB.open(mi,gi);s.onupgradeneeded=()=>{const r=s.result;if(!r.objectStoreNames.contains(Ga)){const i=r.createObjectStore(Ga,{keyPath:"id"});i.createIndex("byItem","itemKey",{unique:!1}),i.createIndex("byPending","pending",{unique:!1})}},s.onerror=()=>n(s.error),s.onsuccess=()=>t(s.result)}),Pa=async(t,n)=>{const s=await pi();return new Promise((r,i)=>{const m=s.transaction(Ga,t),u=m.objectStore(Ga);n(u).then(r).catch(i),m.onerror=()=>i(m.error)})},_s=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const t=new Uint8Array(16);crypto.getRandomValues(t);const n=Array.from(t).map(s=>s.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},fi=()=>{const t="cogita_revision_client_id",n=localStorage.getItem(t);if(n)return n;const s=_s();return localStorage.setItem(t,s),s},bi=()=>{const t="cogita_revision_client_seq",n=Number(localStorage.getItem(t)??"0"),s=Number.isFinite(n)?n+1:1;return localStorage.setItem(t,String(s)),s},Vs=(t,n,s,r)=>Vt(t,n,s,r),Ya=async t=>{const n=fi(),s=bi(),r=new Date().toISOString(),i={...t,clientId:n,clientSequence:s,createdUtc:r,id:_s(),pending:!0};return await Pa("readwrite",m=>new Promise((u,y)=>{const N={...i,itemKey:Vs(i.itemType,i.itemId,i.checkType,i.direction)},S=m.add(N);S.onsuccess=()=>u(),S.onerror=()=>y(S.error)})),i},Qa=async(t,n,s,r)=>{if(!n)return[];try{const i=Vs(t,n,s,r);return await Pa("readonly",m=>new Promise((u,y)=>{const S=m.index("byItem").getAll(i);S.onsuccess=()=>{const x=(S.result??[]).map(c=>({itemType:c.itemType,itemId:c.itemId,checkType:c.checkType??null,direction:c.direction??null,revisionType:c.revisionType,evalType:c.evalType,correct:c.correct,createdUtc:c.createdUtc,maskBase64:c.maskBase64,payloadBase64:c.payloadBase64,payloadHashBase64:c.payloadHashBase64,clientId:c.clientId,clientSequence:c.clientSequence,personRoleId:c.personRoleId??null})).sort((c,g)=>c.createdUtc.localeCompare(g.createdUtc));u(x)},S.onerror=()=>y(S.error)}))}catch{return[]}},Yt=async()=>{try{return await Pa("readonly",t=>new Promise((n,s)=>{const r=t.getAll();r.onsuccess=()=>{const m=(r.result??[]).map(u=>({itemType:u.itemType,itemId:u.itemId,checkType:u.checkType??null,direction:u.direction??null,revisionType:u.revisionType,evalType:u.evalType,correct:u.correct,createdUtc:u.createdUtc,maskBase64:u.maskBase64,payloadBase64:u.payloadBase64,payloadHashBase64:u.payloadHashBase64,clientId:u.clientId,clientSequence:u.clientSequence,personRoleId:u.personRoleId??null}));n(m)},r.onerror=()=>s(r.error)}))}catch{return[]}},yi=async(t=100)=>{try{return await Pa("readonly",n=>new Promise((s,r)=>{const m=n.index("byPending").getAll(!0);m.onsuccess=()=>{const u=m.result??[];s(u.slice(0,t))},m.onerror=()=>r(m.error)}))}catch{return[]}},xi=async t=>{if(t.length!==0)try{await Pa("readwrite",n=>new Promise((s,r)=>{let i=t.length;t.forEach(m=>{const u=n.get(m);u.onsuccess=()=>{const y=u.result;if(y){y.pending=!1;const N=n.put(y);N.onsuccess=()=>{i-=1,i===0&&s()},N.onerror=()=>r(N.error)}else i-=1,i===0&&s()},u.onerror=()=>r(u.error)})}))}catch{}},wn=async(t,n)=>{const s=await yi(200);if(s.length===0)return;const r=new Map;s.forEach(i=>{var u;const m=i.personRoleId??n??"";r.has(m)||r.set(m,[]),(u=r.get(m))==null||u.push(i)});for(const[i,m]of r.entries()){const u=m.map(y=>({itemType:y.itemType,itemId:y.itemId,checkType:y.checkType??null,direction:y.direction??null,revisionType:y.revisionType,evalType:y.evalType,correct:y.correct,clientId:y.clientId,clientSequence:y.clientSequence,maskBase64:y.maskBase64??null,payloadHashBase64:y.payloadHashBase64??null,payloadBase64:y.payloadBase64??null,personRoleId:i||null}));try{await ir({libraryId:t,outcomes:u}),await xi(m.map(y=>y.id))}catch{}}},Rt=t=>t.trim().toLowerCase(),Dt=t=>{const n=t==null?void 0:t.trim();return n?{fragmentId:n}:null},Xa=(t,n)=>{const s=Dt(n);if(!s)return!0;const r=Dt(t);return(r==null?void 0:r.fragmentId)===s.fragmentId},pt=t=>{const n=t==null?void 0:t.trim().toLowerCase();return n||null},Os=(t,n)=>{if((pt(t.childItemType)??"info")!==(n.cardType??"").toLowerCase()||t.childItemId!==n.cardId)return!1;const r=pt(t.childCheckType),i=pt(t.childDirection),m=pt(n.checkType),u=pt(n.direction);return!(r&&r!==m||i&&i!==u)},vi={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},wi={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},Za=(t,n,s)=>{if(!s||!n.startsWith(t))return n;const r=n.slice(t.length);if(!r)return n;const i=s==="super"?vi:wi,m=r.split("").map(u=>i[u]??u).join("");return t+m},en=(t,n,s)=>{var u,y,N;if(!t)return((u=n[0])==null?void 0:u.key)??null;const r=new Set(n.map(S=>S.key)),i=/\{([^}]+)\}/g;let m;for(;(m=i.exec(t))!==null;){const S=((y=m[1])==null?void 0:y.trim())??"";if(!S)continue;if(r.has(S))return S;const l=s==null?void 0:s[S];if(l&&r.has(l))return l}return((N=n[0])==null?void 0:N.key)??null},Ra=t=>(()=>{const n=new Set;return t.flatMap(s=>{if(s.cardType!=="info"||s.infoType!=="citation")return[s];const r=s.description??"";if(!r.trim())return[s];const i=fa(r),m=Object.keys(i.nodes);return m.length===0?[s]:m.map(u=>({...s,checkType:"quote-fragment",direction:u})).filter(u=>{const y=[u.cardId,u.checkType??"",u.direction??""].join("|");return n.has(y)?!1:(n.add(y),!0)})})})();function ys({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l,collectionId:x,revisionId:c}){const g=tn(),v=`/#/cogita/library/${l}`,w=a.useMemo(()=>new URLSearchParams(g.search),[g.search]),M=Math.max(1,Number(w.get("limit")??20)),F=w.get("mode")??"random",p=a.useMemo(()=>_n(F),[F]),d=a.useMemo(()=>rn(p,Fs(p,w)),[p,w]),ie=w.get("check")??"exact",K=w.get("reviewer"),b=(w.get("scope")??"").trim(),O=b==="info"||b==="info-selection"?b:"collection",C=O==="info"?(w.get("infoId")??"").trim():"",Y=O==="info-selection"?(w.get("seed")??"").trim():"",z=O==="collection"&&!!x,I=a.useMemo(()=>t.cogita.library.revision[p.labelKey]??F,[t,F,p]),ue=a.useMemo(()=>ie==="exact"?t.cogita.library.revision.checkValue:ie,[t,ie]),[re,fe]=a.useState(t.cogita.library.collections.defaultName),[Ce,ye]=a.useState([]),[T,Ie]=a.useState([]),[J,ee]=a.useState("idle"),[$e,Te]=a.useState({current:0,total:0}),[G,ve]=a.useState(0),[je,Ve]=a.useState(""),[Ue,Le]=a.useState(null),[qe,Ze]=a.useState(null),[Re,We]=a.useState(null),[et,nt]=a.useState(null),[_e,xe]=a.useState([]),[q,Ae]=a.useState({}),[ne,B]=a.useState({}),[he,Je]=a.useState(null),[R,$]=a.useState(null),[Q,se]=a.useState(null),[j,_]=a.useState(null),[E,U]=a.useState(null),[te,ke]=a.useState({}),we=a.useRef(0),[ze,Ne]=a.useState(null),le=a.useRef(null),oe=a.useRef(null),[Ye,He]=a.useState(null),[st,it]=a.useState(!1),[yt,Ge]=a.useState(null),[tt,jt]=a.useState([]),[Tt,It]=a.useState(null),Et=a.useRef(null),gt=a.useRef(null),[Ut,ft]=a.useState(null),[Zt,ht]=a.useState(0),vt=a.useRef(null),zt=a.useRef({}),[Ct,Fe]=a.useState(!1),[mt,wt]=a.useState({}),[xt,k]=a.useState([]),pe=a.useRef(new Map),[Be,h]=a.useState(new Set),[Me,H]=a.useState(!1),Qe=a.useRef(null),ot=a.useRef(new Set),dt=a.useRef({}),ge=Ce[G]??null,kt=(ge==null?void 0:ge.checkType)==="translation-match"&&E,Lt=a.useRef(new Map),ra=a.useRef(new Map),ea=a.useRef(new Map),ta=a.useRef(new Map),Mt=a.useMemo(()=>ge?ge.cardType==="vocab"?t.cogita.library.revision.vocabLabel:ge.infoType?Xe(t,ge.infoType):t.cogita.library.revision.infoLabel:"",[t,ge]),aa=a.useMemo(()=>{var f;return p.id!=="levels"?Ce.length:((f=mt.pool)==null?void 0:f.length)??p.getFetchLimit(M,d)},[mt,d,p,Ce.length,M]),na=p.getProgressTotal?p.getProgressTotal(Ce,mt,M,d):p.id==="levels"?Math.min(M,aa):Ce.length,ut=na?Math.min(G+1,na):0,bt=Math.max(1,Number(d.tries??1)),ua=d.compare??"anchors",Ca=Math.max(0,Math.min(100,Number(d.minCorrectness??0))),St=(d.considerDependencies??"on")==="on",Bt=Math.max(0,Math.min(100,Number(d.dependencyThreshold??85))),Ka=o=>{const f=o.slice();for(let P=f.length-1;P>0;P-=1){const V=Math.floor(Math.random()*(P+1));[f[P],f[V]]=[f[V],f[P]]}return f},ba=o=>da(o,{treatSimilarCharsAsSame:!0})>=Ca,Fa=async()=>{const o=await Yt(),f=new Map,P=new Map,V=new Map;o.forEach(A=>{const Z=`${A.itemType}:${A.itemId}`,be=Vt(A.itemType,A.itemId,A.checkType,A.direction);if(f.has(Z)||f.set(Z,[]),f.get(Z).push(A),P.has(be)||P.set(be,[]),P.get(be).push(A),A.itemType==="info"&&A.checkType==="quote-fragment"&&A.direction){const Ke=`${A.itemId}:${A.direction}`;V.has(Ke)||V.set(Ke,[]),V.get(Ke).push(A)}});const X=new Map,D=new Map,ae=new Map;return f.forEach((A,Z)=>X.set(Z,Gt(A).score)),P.forEach((A,Z)=>D.set(Z,Gt(A).score)),V.forEach((A,Z)=>ae.set(Z,Gt(A).score)),{itemKnowness:X,cardKnowness:D,fragmentKnowness:ae}},Ot=async o=>{const f=[];let P=null;for(;;){const V=await qa({libraryId:l,collectionId:o,limit:200,cursor:P});if(f.push(...V.items),!V.nextCursor)break;P=V.nextCursor}return Ra(f)},ya=async(o,f)=>{if(pe.current.has(o))return pe.current.get(o)??0;const P=await Ot(o);if(P.length===0)return pe.current.set(o,0),0;const X=P.reduce((D,ae)=>{const A=me(ae);return D+(f.get(A)??0)},0)/P.length;return pe.current.set(o,X),X},on=(o,f)=>{if(!St||o.cardType!=="info"||o.infoType!=="citation"||o.checkType!=="quote-fragment")return!0;const P=Dt(o.direction);if(!(P!=null&&P.fragmentId))return!0;const V=o.description??"";if(!V.trim())return!0;const D=fa(V).nodes[P.fragmentId];if(!D||!D.leftId&&!D.rightId)return!0;const ae=[D.leftId,D.rightId].filter(be=>!!be);if(ae.length===0)return!0;const A=ae.map(be=>{const Ke=Vt("info",o.cardId,"quote-fragment",be);return f.get(Ke)??0});return A.reduce((be,Ke)=>be+Ke,0)/A.length>=Bt},Pt=async o=>{const f=mt,P=o.concat(f.active??[]).concat(f.pool??[]).filter((A,Z,be)=>be.findIndex(Ke=>me(Ke)===me(A))===Z);if(!St){h(new Set(P.map(me)));return}const{itemKnowness:V,cardKnowness:X}=await Fa(),D=xt.filter(A=>pt(A.childItemType)==="collection"&&A.childItemId===x&&!pt(A.childCheckType)&&!pt(A.childDirection)),ae=new Set;for(const A of P){if(A.cardType!=="info"){ae.add(me(A));continue}if(!on(A,X))continue;const Z=xt.filter(De=>Os(De,A)).concat(D);if(Z.length===0){ae.add(me(A));continue}let be=0;for(const De of Z)if(pt(De.parentItemType)==="collection")be+=await ya(De.parentItemId,X);else if(pt(De.parentCheckType)||pt(De.parentDirection)){const Oe=pt(De.parentCheckType),at=pt(De.parentDirection),rt=Vt(De.parentItemType,De.parentItemId,Oe,at);be+=X.get(rt)??0}else{const Oe=`${De.parentItemType}:${De.parentItemId}`;be+=V.get(Oe)??0}be/Z.length>=Bt&&ae.add(me(A))}h(ae)},xa=o=>{for(let f=o;f<Ce.length;f+=1){const P=Ce[f];if(P&&(!St||P.cardType!=="info"||Be.has(me(P))))return f}return-1},ia=o=>!St||o.cardType!=="info"||Be.has(me(o)),Da=o=>{if(p.id!=="temporal"&&p.id!=="levels")return null;const f=mt,P=(f.active??[]).concat(f.pool??[]),V=new Set;for(const X of P){const D=me(X);if(!(V.has(D)||o.has(D))&&(V.add(D),ia(X)))return X}return null},_t=a.useMemo(()=>{if(p.id!=="levels")return null;const o=mt,f=o.pool??[],P=o.active??[],V=o.levelMap??{},X=Math.max(1,Number(d.levels??1)),D=Array.from({length:X},()=>0),ae=new Set(P.map(Ke=>me(Ke)));f.forEach(Ke=>{const De=Math.min(X,Math.max(1,V[me(Ke)]??1));D[De-1]+=1});const A=f.length||1,Z=D.map(Ke=>Ke/A*100),be=ge?V[me(ge)]??1:null;return{counts:D,percentages:Z,currentLevel:be,levelsCount:X,activeCount:P.length,poolCount:f.length,activeSet:ae}},[mt,d,p,ge]),va=a.useMemo(()=>{if(p.id!=="temporal")return null;const o=mt,f=o.pool??[],P=o.active??[],V=o.knownessMap??{},X=new Set(o.unknownSet??[]);let D=0;f.forEach(Z=>{(V[me(Z)]??0)>1&&(D+=1)});const ae=X.size,A=P.map(Z=>({id:me(Z),value:X.has(me(Z))?0:Math.max(0,Math.min(1,V[me(Z)]??0))}));return{knownCount:D,unknownCount:ae,dots:A}},[mt,p]),ln=a.useMemo(()=>{if(!St)return 0;const o=mt;return Ce.concat(o.active??[]).concat(o.pool??[]).filter((P,V,X)=>X.findIndex(D=>me(D)===me(P))===V).filter(P=>P.cardType==="info"&&!Be.has(me(P))).length},[St,mt,Ce,Be]);a.useEffect(()=>{if(!St||J!=="ready")return;const o=mt,P=Ce.concat(o.active??[]).concat(o.pool??[]).filter((D,ae,A)=>A.findIndex(Z=>me(Z)===me(D))===ae).filter(D=>D.cardType!=="info"||Be.has(me(D))).length,V=Et.current;if(Et.current=P,V===null||P<=V)return;const X=P-V;It(`New card available (+${X})`),gt.current&&window.clearTimeout(gt.current),gt.current=window.setTimeout(()=>It(null),2200)},[St,J,mt,Ce,Be]),a.useEffect(()=>()=>{gt.current&&window.clearTimeout(gt.current)},[]);const $t=(o,f)=>{const P=p.applyOutcome({queue:Ce,meta:mt},ge,M,d,{correct:o,correctness:f,createdUtc:new Date().toISOString()});ye(P.queue),wt(P.meta);const V=P.queue[G+1];V&&Ma(V,G+1)};a.useEffect(()=>{if(z&&x){an(l,x).then(o=>fe(o.name)).catch(()=>fe(t.cogita.library.collections.defaultName));return}if(O==="info"&&C){Qt({libraryId:l,infoId:C}).then(o=>{const f=o.payload??{};fe(f.title||f.label||f.name||C)}).catch(()=>fe(C||t.cogita.library.revision.runKicker));return}if(O==="info-selection"){const o=Y?Qn(l,Y):null,f=(o==null?void 0:o.infoIds.length)??0;fe(f>0?`Selected infos (${f})`:"Selected infos");return}fe(t.cogita.library.collections.defaultName)},[t,z,x,l,O,C,Y]),a.useEffect(()=>{En({libraryId:l,type:"language"}).then(o=>Ie(o)).catch(()=>Ie([]))},[l]),a.useEffect(()=>{z&&An({libraryId:l}).then(o=>k(o.items??[])).catch(()=>k([]))},[z,l]),a.useEffect(()=>{wn(l,K)},[l,K]),a.useEffect(()=>{Pt(Ce)},[Ce,xt,St,Bt,x]),a.useEffect(()=>{if(!ge||!St){H(!1);return}if(ge.cardType!=="info"||Be.has(me(ge))){H(!1);return}const o=xa(G+1);if(o>=0){H(!1),ve(o);return}if(p.id==="temporal"||p.id==="levels"){const f=Ce.slice(0,G+1),P=Ce.slice(G+1).filter(ia),V=f.concat(P),X=new Set(V.map(me)),D=Da(X);if(D){const A=me(D);X.has(A)||(V.push(D),X.add(A),wt(Z=>{const be=Z,Ke=new Set(be.queued??[]);return Ke.add(A),{...be,queued:Ke}}))}const ae=V.findIndex((A,Z)=>Z!==G&&ia(A));if(ae>=0){ye(V),ve(ae),H(!1);return}}H(!0)},[ge,Be,St,G,Ce,mt,p.id]),a.useEffect(()=>{let o=!0;return(async()=>{ee("loading"),Te({current:0,total:p.id==="levels"?0:p.getFetchLimit(M,d)});try{if(!z){if(k([]),O==="info"){if(!C){o&&(ye([]),k([]),wt({}),ve(0),ee("ready"));return}const[De,Oe]=await Promise.all([Va({libraryId:l,infoId:C}),Oa({libraryId:l,infoId:C})]);if(!o)return;const at=Ra(De.items??[]);k(Oe.items??[]);const rt=p.prepare(at,M,d);ye(rt.queue),wt(rt.meta),ve(0),ee("ready"),Te({current:at.length,total:at.length});return}if(O==="info-selection"){const De=Y?Qn(l,Y):null,Oe=(De==null?void 0:De.infoIds)??[];if(!Oe.length){o&&(ye([]),k([]),wt({}),ve(0),ee("ready"));return}const at=await Promise.all(Oe.map(async la=>{const[Ft,za]=await Promise.all([Va({libraryId:l,infoId:la}),Oa({libraryId:l,infoId:la})]);return{cards:Ft.items??[],deps:za.items??[]}}));if(!o)return;const rt=new Map;at.forEach(la=>{Ra(la.cards).forEach(Ft=>{rt.set(me(Ft),Ft)})});const lt=Array.from(rt.values()),ct=new Set(lt.map(me)),Nt=new Map;at.forEach(la=>{(la.deps??[]).forEach(Ft=>{const za=Vt(Ft.parentItemType,Ft.parentItemId,pt(Ft.parentCheckType),pt(Ft.parentDirection)),Vn=Vt(Ft.childItemType,Ft.childItemId,pt(Ft.childCheckType),pt(Ft.childDirection));if(!ct.has(za)||!ct.has(Vn))return;const On=`${za}->${Vn}`;Nt.has(On)||Nt.set(On,Ft)})}),k(Array.from(Nt.values()));const ga=p.prepare(lt,M,d);ye(ga.queue),wt(ga.meta),ve(0),ee("ready"),Te({current:lt.length,total:lt.length});return}}const P=[];let V=null,X=null;do{const De=await qa({libraryId:l,collectionId:x,limit:300,cursor:V});if(P.push(...De.items),(p.id==="levels"||p.id==="temporal")&&De.total&&(X=De.total),Te(Oe=>({current:P.length,total:Oe.total||De.total||p.getFetchLimit(M,d)})),V=De.nextCursor??null,X!==null&&P.length>=X||p.id!=="levels"&&p.id!=="temporal"&&P.length>=p.getFetchLimit(M,d))break}while(V);if(!o)return;const D=Ra(P);let ae;if(p.id==="levels"){const De=Math.max(1,Number(d.levels??1)),at=(await Yt()).reduce((rt,lt)=>{const ct=Vt(lt.itemType,lt.itemId,lt.checkType,lt.direction);return rt[ct]||(rt[ct]=[]),rt[ct].push(lt),rt},{});ae={},D.forEach(rt=>{const lt=me(rt),ct=at[lt]??[],Nt=ct.length>0?Gt(ct).score:0,ga=Math.max(1,Math.min(De,Math.ceil(Nt/100*De)));ae[lt]=ga})}let A=null,Z=null,be=null;if(p.id==="temporal"){const De=await Yt(),Oe=new Set(D.map(lt=>me(lt))),at=De.reduce((lt,ct)=>{const Nt=Vt(ct.itemType,ct.itemId,ct.checkType,ct.direction);return Oe.has(Nt)&&(lt[Nt]||(lt[Nt]=[]),lt[Nt].push(ct)),lt},{});A={},Z=new Set,be={};const rt=Date.now();D.forEach(lt=>{const ct=me(lt),Nt=at[ct]??[];if(Nt.length===0){A[ct]=0,Z.add(ct),be[ct]=[];return}const ga=Dn(Nt);be[ct]=ga;const la=nn(ga,rt);A[ct]=la.knowness})}const Ke=p.id==="levels"?Bn(D,M,d,ae):p.id==="temporal"?zn(D,M,d,A??{},Z??new Set,be??{}):p.prepare(D,M,d);ye(Ke.queue),wt(Ke.meta),ve(0),ee("ready"),Te(De=>({current:Math.min(De.current,De.total),total:De.total}))}catch{o&&ee("error")}})(),()=>{o=!1}},[x,z,l,M,O,d,p,K,C,Y]),a.useEffect(()=>{if(Ve(""),Le(null),ft(null),ht(0),xe([]),Ae({}),B({}),$(null),se(null),_(null),it(!1),Fe(!1),He(null),U(null),ke({}),!ge){Ze(null),We(null),Je(null),Ge(null);return}ge.cardType==="info"&&ge.infoType==="computed"&&Ze(t.cogita.library.revision.loadingComputed);let o=!0;return Ma(ge,G).then(f=>{!o||!f||(Ze(f.prompt),We(f.expectedAnswer),xe(f.computedExpected),Ae(f.computedAnswers),Je(f.computedValues),$(f.answerTemplate),se(f.outputVariables),_(f.variableValues))}),()=>{o=!1}},[ge,t]),a.useEffect(()=>{if(!ge||ge.cardType!=="info"||ge.infoType!=="citation"){Qe.current=null,ot.current=new Set,nt(null);return}const o=ge.description??"",f=(ge.label??"").trim(),P=f.replace(/\s+/g," ").trim(),V=o.replace(/\s+/g," ").trim(),X=P&&P!==V?f:t.cogita.library.infoTypes.citation;if(!o){nt(null),We(null);return}const D=fa(o);Qe.current=D,Ze(X);let ae=!0;return Fa().then(({fragmentKnowness:A})=>{if(!ae)return;const Z=new Set,be={};A.forEach((Oe,at)=>{const[rt,lt]=at.split(":",2);if(rt!==ge.cardId)return;const ct=Dt(lt);if(!ct)return;const{fragmentId:Nt}=ct;be[Nt]=Oe,Oe>=Bt&&Z.add(Nt)}),ot.current=Z,dt.current=be;const Ke=Dt(ge.direction);if(Ke!=null&&Ke.fragmentId&&D.nodes[Ke.fragmentId]){ma(D,Ke.fragmentId,X);return}const De=Sa(D,Z,be,Bt,St,ge.direction);ma(D,(De==null?void 0:De.id)??null,X)}).catch(()=>{ot.current=new Set,dt.current={};const A=Dt(ge.direction);if(A!=null&&A.fragmentId&&D.nodes[A.fragmentId]){ma(D,A.fragmentId,X);return}const Z=Sa(D,ot.current,{},Bt,St,ge.direction);ma(D,(Z==null?void 0:Z.id)??null,X)}),()=>{ae=!1}},[ge,t,St,Bt]),a.useEffect(()=>{if(!ge||ge.cardType!=="vocab"||ge.checkType!=="translation-match"){U(null),ke({});return}const P=(mt.pool??mt.active??Ce).filter(A=>A.cardType==="vocab"&&A.checkType==="translation-match").filter((A,Z,be)=>be.findIndex(Ke=>Ke.cardId===A.cardId)===Z);P.some(A=>A.cardId===ge.cardId)||P.unshift(ge);const X=Ka(P).slice(0,6).map(A=>{const Z=A.label.split("↔").map(De=>De.trim()).filter(Boolean);if(Z.length<2)return null;const be=`${A.cardId}:L`,Ke=`${A.cardId}:R`;return{cardId:A.cardId,leftId:be,rightId:Ke,leftLabel:Z[0],rightLabel:Z[1]}}).filter(Boolean),D=X.map(A=>A.leftId),ae=Ka(X.map(A=>A.rightId));U({pairs:X,leftOrder:D,rightOrder:ae,selection:{},activeLeft:null,activeRight:null,locked:{}})},[ge,Ce,mt]),a.useEffect(()=>()=>{le.current&&window.clearTimeout(le.current),oe.current&&window.clearTimeout(oe.current)},[]);const Kt=a.useRef(null);a.useEffect(()=>{if(!ge)return;const o=me(ge),f=typeof document<"u"?document.activeElement:null;if(Kt.current===o&&f&&(f.tagName==="INPUT"||f.tagName==="TEXTAREA"))return;let P=0;const V=()=>{if(ge){if(ge.cardType==="info"&&ge.infoType==="computed"){if(_e.length>0){const D=en(R,_e,Q),ae=D?zt.current[D]:null;if(ae&&(ae.focus(),document.activeElement===ae)){Kt.current=o;return}}if(vt.current&&(vt.current.focus(),document.activeElement===vt.current)){Kt.current=o;return}}else if(ge.cardType==="vocab"&&vt.current&&(vt.current.focus(),document.activeElement===vt.current)){Kt.current=o;return}P<6&&(P+=1,window.setTimeout(V,40))}},X=window.setTimeout(V,40);return()=>window.clearTimeout(X)},[ge,_e,R,Q]),a.useEffect(()=>{if(!Ct)return;const o=f=>{f.key==="Enter"&&(f.preventDefault(),ha())};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[Ct]);const wa=o=>{jt(o),Ge(Gt(o))};a.useEffect(()=>{if(!ge){Ge(null),jt([]);return}const o=ge.cardType==="info"?"info":"connection";if(ge.cardType==="info"&&ge.infoType==="citation"){Yt().then(f=>{const P=f.filter(V=>V.itemType==="info"&&V.itemId===ge.cardId&&V.checkType==="quote-fragment"&&Xa(V.direction,ge.direction));wa(P)}).catch(()=>{Ge(null),jt([])});return}Qa(o,ge.cardId,ge.checkType,ge.direction).then(f=>wa(f)).catch(()=>{Ge(null),jt([])})},[l,ge,K]);const ja=(o,f,P,V)=>{if(o==="info"&&P==="quote-fragment"){Yt().then(X=>{const D=X.filter(ae=>ae.itemType==="info"&&ae.itemId===f&&ae.checkType==="quote-fragment"&&Xa(ae.direction,V));wa(D)}).catch(()=>{Ge(null),jt([])});return}Qa(o,f,P,V).then(X=>wa(X)).catch(()=>{Ge(null),jt([])})},oa=(o,f,P)=>{var ae;const V=((ae=P.pairs.find(A=>A.leftId===o))==null?void 0:ae.rightId)??null;if(!V)return P;const X=V===f;ke(A=>({...A,[o]:X?"correct":"incorrect"})),le.current&&window.clearTimeout(le.current),oe.current&&window.clearTimeout(oe.current),we.current+=1;const D={kind:X?"correct":"incorrect",tick:we.current};if(Ne(null),le.current=window.setTimeout(()=>Ne(D),0),oe.current=window.setTimeout(()=>Ne(null),420),X){const A={...P.locked,[o]:!0};return Object.keys(A).length>=P.pairs.length?(Le("correct"),Fe(!0)):Le("correct"),{...P,selection:{...P.selection,[o]:f},activeLeft:null,activeRight:null,locked:A}}return Le("incorrect"),{...P,activeLeft:null,activeRight:null}},cn=o=>{U(f=>!f||f.locked[o]?f:f.activeRight?oa(o,f.activeRight,f):{...f,activeLeft:f.activeLeft===o?null:o})},ka=o=>{U(f=>f&&(f.activeLeft?oa(f.activeLeft,o,f):{...f,activeRight:f.activeRight===o?null:o}))},ha=()=>{var o;if(ge&&ge.cardType==="info"&&ge.infoType==="citation"&&Qe.current&&et&&!((o=Dt(ge.direction))!=null&&o.fragmentId)){const f=Sa(Qe.current,ot.current,dt.current,Bt,St,ge.direction,et.fragmentId);if(f){Le(null),Ve(""),it(!1),B({}),Fe(!1),ft(null),ht(0),ma(Qe.current,f.id,et.title);return}}Le(null),Ve(""),it(!1),B({}),Fe(!1),ft(null),ht(0),ve(f=>Math.min(f+1,Ce.length))},qt=o=>{if(!ge)return;const f=o.expected??null,P=o.answer??"";let V=f??"",X=P;if(!f&&o.expectedMap&&o.answerMap){const De=Object.keys(o.expectedMap).sort((Oe,at)=>Oe.localeCompare(at));V=De.map(Oe=>{var at;return((at=o.expectedMap)==null?void 0:at[Oe])??""}).join("|"),X=De.map(Oe=>{var at;return((at=o.answerMap)==null?void 0:at[Oe])??""}).join("|")}const D=V?Ta(V,X,ua):new Uint8Array,ae={revisionType:p.id,evalType:o.evalType,direction:o.direction,prompt:qe??"",expected:f,answer:P,expectedAnswers:o.expectedMap??null,answers:o.answerMap??null,correct:o.correct,maskBase64:D.length?ca(D):null,values:he??null,checkMode:ie,compareMode:ua,minCorrectness:Ca},A=new TextEncoder().encode(JSON.stringify(ae)),Z=ge.cardType==="info"?"info":"connection",be=o.overrideCheckType??ge.checkType??null,Ke=o.overrideDirection??ge.direction??null;Ya({itemType:Z,itemId:ge.cardId,checkType:be,direction:Ke,revisionType:p.id,evalType:o.evalType,correct:o.correct,maskBase64:D.length?ca(D):null,payloadBase64:ca(A),personRoleId:K??null}).then(()=>{ja(Z,ge.cardId,be,Ke),Pt(Ce),wn(l,K)}).catch(()=>{})},dn=(o,f)=>{const P=Lt.current.get(f);if(P)return Promise.resolve(P);const V=ra.current.get(f);if(V)return V;const X=Qt({libraryId:l,infoId:o}).then(D=>{var De,Oe;const ae=D.payload,A=((De=ae.definition)==null?void 0:De.graph)??null,Z="",be=((Oe=ae.definition)==null?void 0:Oe.answerTemplate)??"",Ke=Ds(A,Z,be);if(Ke){const rt={sample:zs(Ke),answerTemplate:be||null};return Lt.current.set(f,rt),rt}return Hn({libraryId:l,infoId:o}).then(at=>{const rt={sample:at,answerTemplate:null};return Lt.current.set(f,rt),rt})}).catch(()=>Hn({libraryId:l,infoId:o}).then(D=>{const ae={sample:D,answerTemplate:null};return Lt.current.set(f,ae),ae}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{ra.current.delete(f)});return ra.current.set(f,X),X},Ma=(o,f)=>{var A;const P=`${me(o)}:${f}`,V=ea.current.get(P);if(V)return Promise.resolve(V);const X=ta.current.get(P);if(X)return X;const D=Z=>(ea.current.set(P,Z),Z);let ae;if(o.cardType==="vocab"){if(o.checkType==="translation-match")return ae=Promise.resolve(D({prompt:o.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),ae;const Z=o.label.split("↔").map(be=>be.trim()).filter(Boolean);if(Z.length>=2){const Ke=(o.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",De=Ke?Z[0]:Z[1],Oe=Ke?Z[1]:Z[0];ae=Promise.resolve(D({prompt:De,expectedAnswer:Oe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else ae=Promise.resolve(D({prompt:o.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(o.cardType==="info"&&o.infoType==="word"){const Z=(A=o.description)!=null&&A.startsWith("Language: ")?o.description.replace("Language: ",""):null;ae=Promise.resolve(D({prompt:o.label,expectedAnswer:Z,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else o.cardType==="info"&&o.infoType==="computed"?ae=dn(o.cardId,P).then(Z=>{var at,rt;if(!Z.sample)return D({prompt:o.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const be=Z.sample,Ke=be.expectedAnswers?Object.entries(be.expectedAnswers).map(([lt,ct])=>({key:lt,expected:ct})):[],De=Ke.reduce((lt,ct)=>(lt[ct.key]="",lt),{}),Oe=be.expectedAnswerIsSentence&&((at=be.expectedAnswer)==null?void 0:at.trim())||null;return D({prompt:be.prompt,expectedAnswer:Ke.length>0?Oe:((rt=be.expectedAnswer)==null?void 0:rt.trim())||null,computedExpected:Ke,computedAnswers:De,computedValues:be.values??null,answerTemplate:Z.answerTemplate,outputVariables:be.outputVariables??null,variableValues:be.variableValues??null})}).catch(()=>D({prompt:o.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{ta.current.delete(P)}):ae=Promise.resolve(D({prompt:o.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return ta.current.set(P,ae),ae},ma=(o,f,P)=>{const V=Object.keys(o.nodes).length,X=ot.current.size;if(!f){nt({title:P,before:o.text,after:"",fragmentId:null,total:V,completed:X}),We(null),Fe(!0);return}const D=o.nodes[f];if(!D)return;const ae=Pn(o.text,D);nt({title:P,before:ae.before,after:ae.after,fragmentId:D.id,total:V,completed:X}),We(ae.fragment),Fe(!1)},un=()=>{const o=Qe.current;o&&nt(f=>f&&{...f,total:Object.keys(o.nodes).length,completed:ot.current.size})},Jt=()=>{const o=Ce[G+1];o&&Ma(o,G+1)},L=()=>{if(Jt(),ge&&ge.cardType==="vocab"&&ge.checkType==="translation-match"&&E){if(E.pairs.length===0){Le("incorrect"),Fe(!0);return}const D=E.pairs.reduce((Oe,at)=>(Oe[at.rightId]=at.rightLabel,Oe),{});let ae=0;const A={};E.pairs.forEach(Oe=>{const rt=E.selection[Oe.leftId]===Oe.rightId;A[Oe.leftId]=rt?"correct":"incorrect",rt&&(ae+=1)});const Z=E.pairs.length||1,be=ae/Z,Ke=ae===E.pairs.length;ke(Oe=>({...Oe,...A})),Ke?(Le("correct"),Fe(!0),ht(0)):(Le("incorrect"),Fe(!1),ht(Oe=>{const at=Oe+1;return at>=bt&&(it(!0),Fe(!0),U(rt=>{if(!rt)return rt;const lt=rt.pairs.reduce((ct,Nt)=>(ct[Nt.leftId]=Nt.rightId,ct),{});return{...rt,selection:lt}})),at})),$t(Ke,be);const De="connection";Promise.all(E.pairs.map(Oe=>{const at=E.selection[Oe.leftId]??null,rt=at?D[at]:"",lt={left:Oe.leftLabel,expected:Oe.rightLabel,answer:rt,checkType:"translation-match"},ct=new TextEncoder().encode(JSON.stringify(lt));return Ya({itemType:De,itemId:Oe.cardId,checkType:"translation-match",direction:null,revisionType:p.id,evalType:"translation-match",correct:at===Oe.rightId,maskBase64:null,payloadBase64:ca(ct),personRoleId:K??null})})).then(()=>{ja(De,ge.cardId,ge.checkType,ge.direction),wn(l,K)}).catch(()=>{});return}if(_e.length>0){const D=_e.reduce((A,Z)=>{const be=q[Z.key]??"";return A[Z.key]=Rt(be)===Rt(Z.expected)?"correct":"incorrect",A},{});_e.every(({key:A,expected:Z})=>{const be=q[A]??"";return ie==="exact"&&Rt(be)===Rt(Z)})?(Le("correct"),B(D),Fe(!0),ht(0),$t(!0,1),qt({correct:!0,direction:qe?`${qe} -> computed`:"computed",expectedMap:_e.reduce((A,Z)=>(A[Z.key]=Z.expected,A),{}),answerMap:q,evalType:"computed"})):(Le("incorrect"),B(D),Fe(!1),ht(A=>{const Z=A+1;return Z>=bt&&Se&&(it(!0),Fe(!0)),Z}),$t(!1,0),window.setTimeout(()=>{var Z;const A=en(R,_e,Q);A&&zt.current[A]&&((Z=zt.current[A])==null||Z.focus())},40),qt({correct:!1,direction:qe?`${qe} -> computed`:"computed",expectedMap:_e.reduce((A,Z)=>(A[Z.key]=Z.expected,A),{}),answerMap:q,evalType:"computed"}));return}if(ge&&ge.cardType==="info"&&ge.infoType==="citation"&&(et!=null&&et.fragmentId)){if(!Re)return;const D=Dt(ge.direction),ae=(D==null?void 0:D.fragmentId)??et.fragmentId,A=Wa(Re,je,{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}),Z=A.mask,be=A.isCorrect,Ke=A.percent;be?(dt.current[et.fragmentId]=Math.max(dt.current[et.fragmentId]??0,Ke),(dt.current[et.fragmentId]??0)>=Bt&&ot.current.add(et.fragmentId),un(),Le("correct"),B({}),Fe(!0),ft(Z),ht(0),Ke<100&&bt<=1&&it(!0),$t(!0,Ke/100),qt({correct:!0,direction:`quote:${et.fragmentId}`,expected:Re,answer:je,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:ae})):(Le("incorrect"),B({}),Fe(!1),ft(Z),ht(De=>{const Oe=De+1;return Oe>=bt&&Se&&(it(!0),Fe(!0)),Oe}),$t(!1,Ke/100),window.setTimeout(()=>{var De;return(De=vt.current)==null?void 0:De.focus()},40),qt({correct:!1,direction:`quote:${et.fragmentId}`,expected:Re,answer:je,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:ae}));return}if(!Re)return;const o=Ta(Re,je,ua),f=ie==="exact"&&Rt(je)===Rt(Re),P=ba(o),V=f||P,X=da(o);V?(Le("correct"),B({}),Fe(!0),ft(o),ht(0),X<100&&bt<=1&&it(!0),$t(!0,X/100),qt({correct:!0,direction:qe?`${qe} -> ${Re}`:null,expected:Re,answer:je,evalType:"text"})):(Le("incorrect"),B({}),Fe(!1),ft(o),ht(D=>{const ae=D+1;return ae>=bt&&Se&&(it(!0),Fe(!0)),ae}),$t(!1,X/100),window.setTimeout(()=>{var D;return(D=vt.current)==null?void 0:D.focus()},40),qt({correct:!1,direction:qe?`${qe} -> ${Re}`:null,expected:Re,answer:je,evalType:"text"}))},W=o=>{if(Jt(),!Re)return;const f=Ta(Re,o,ua),P=Rt(o)===Rt(Re),V=ba(f),X=P||V,D=da(f);X?(Le("correct"),B({}),Fe(!0),ft(f),ht(0),D<100&&bt<=1&&it(!0),$t(!0,D/100),qt({correct:!0,direction:"word->language",expected:Re,answer:o,evalType:"language-select"})):(Le("incorrect"),B({}),Fe(!1),ft(f),ht(ae=>{const A=ae+1;return A>=bt&&Se&&(it(!0),Fe(!0)),A}),$t(!1,D/100),qt({correct:!1,direction:"word->language",expected:Re,answer:o,evalType:"language-select"}))},de=()=>{Jt(),Le("correct"),Fe(!0),ht(0),$t(!0,1),Re&&qt({correct:!0,direction:"manual",expected:Re,answer:je,evalType:"manual"})},Ee=()=>{if($t(!1,0),ge&&ge.cardType==="info"&&ge.infoType==="citation"){Le(null),Ve(""),it(!1),B({}),Fe(!1),ft(null),ht(0),ve(o=>Math.min(o+1,Ce.length));return}ha()};a.useEffect(()=>{Jt()},[G,Ce]);const Pe=o=>{var P;if(o.key!=="Enter")return;if(o.preventDefault(),o.stopPropagation(),Ct){ha();return}const f=_e.find(V=>!(q[V.key]??"").trim());if(f){(P=zt.current[f.key])==null||P.focus();return}L()},ce=t.cogita.library.revision.revealModeAfterIncorrect,Se=_e.length>0||!!Re;return e.jsxs(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:[J==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${$e.total?Math.min(100,Math.max(0,$e.current/$e.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:$e.total?`${Math.min($e.current,$e.total)} / ${$e.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:re}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",I).replace("{check}",ue)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:v,children:t.cogita.library.actions.libraryOverview}),z?e.jsxs(e.Fragment,{children:[e.jsx("a",{className:"cta ghost",href:`${v}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${v}/collections/${x}`,children:t.cogita.library.actions.collectionDetail})]}):e.jsx("a",{className:"cta ghost",href:`${v}/list`,children:t.cogita.library.actions.allCards})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:yt?`${yt.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[_t?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",_t.currentLevel??"-"," / ",_t.levelsCount]}):null,yt?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(yt.correct)).replace("{total}",String(yt.total))}),yt.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(yt.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(Bs,{outcomes:tt})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Tt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Tt})}):null,e.jsx(Kn,{feedbackToken:ze?`${ze.kind}-${ze.tick}`:kt?"idle":Ue??"idle",children:ge?e.jsx(e.Fragment,{children:Me?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(Fn,{copy:t,currentCard:ge,currentTypeLabel:Mt,prompt:qe,languages:T,answer:je,onAnswerChange:o=>Ve(f=>Za(f,o,Ye)),computedExpected:_e,computedAnswers:q,onComputedAnswerChange:(o,f)=>Ae(P=>({...P,[o]:Za(P[o]??"",f,Ye)})),answerTemplate:R,outputVariables:Q,variableValues:j,computedFieldFeedback:ne,feedback:Ue,canAdvance:Ct,quoteContext:et,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:L,onSkip:Ee,onLanguageSelect:W,onMarkReviewed:de,onAdvance:ha,showCorrectAnswer:st,setShowCorrectAnswer:it,onRevealCorrect:()=>Fe(!0),answerMask:Ut,expectedAnswer:Re,hasExpectedAnswer:Se,handleComputedKeyDown:Pe,answerInputRef:vt,computedInputRefs:zt,scriptMode:Ye,setScriptMode:He,matchPairs:E==null?void 0:E.pairs,matchLeftOrder:E==null?void 0:E.leftOrder,matchRightOrder:E==null?void 0:E.rightOrder,matchSelection:E==null?void 0:E.selection,matchActiveLeft:E==null?void 0:E.activeLeft,matchActiveRight:E==null?void 0:E.activeRight,matchFeedback:te,onMatchLeftSelect:cn,onMatchRightSelect:ka})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:z?`${v}/collections/${x}`:`${v}/list`,children:z?t.cogita.library.actions.collectionDetail:t.cogita.library.actions.allCards})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:na?`${ut} / ${na}`:t.cogita.library.revision.progressUnlimited}),J==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),J==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),J==="ready"&&Ce.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:ce}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",bt]})]})]}),_t?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",_t.activeCount," / ",_t.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:_t.counts.map((o,f)=>{const P=f+1,V=_t.currentLevel===P,X=_t.percentages[f]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":V,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:P}),e.jsx("strong",{children:o})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,X))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[X.toFixed(1),"%"]})]},`level-${P}`)})})]}):null,va?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:va.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:va.dots.map(o=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,o.value*100))}%`,background:`rgba(${Math.round(255*(1-o.value))}, ${Math.round(200*o.value)}, 80, 0.9)`}},o.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:va.knownCount})]})]}):null,St?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:ln})]})}):null]})]})]})})})]})]})}const jn=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],ji={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},ki=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Ni=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Si({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:l,collectionId:x}){const[c,g]=a.useState(""),[v,w,M]=vs([]),[F,p,d]=ws([]),[ie,K]=a.useState(null),[b,O]=a.useState(null),[C,Y]=a.useState(null),z=`/#/cogita/library/${l}`;a.useEffect(()=>{an(l,x).then(T=>g(T.name)).catch(()=>g(t.cogita.library.collections.defaultName))},[l,x,t]),a.useEffect(()=>{or({libraryId:l,collectionId:x}).then(T=>{if(!T.graphId||T.graphId==="00000000-0000-0000-0000-000000000000"){w([]),p([]);return}const Ie=T.nodes.map(ee=>{var ve;const $e=ee.payload??{},Te=$e.position??{x:120,y:120},G=$e.params??{};return{id:ee.nodeId,type:"default",position:Te,data:{nodeType:ee.nodeType,label:((ve=jn.find(je=>je.type===ee.nodeType))==null?void 0:ve.label)??ee.nodeType,params:G}}}),J=T.edges.map(ee=>({id:ee.edgeId,source:ee.fromNodeId,target:ee.toNodeId,sourceHandle:ee.fromPort??void 0,targetHandle:ee.toPort??void 0}));w(Ie),p(J)}).catch(()=>{w([]),p([])})},[l,x,p,w]);const I=a.useMemo(()=>v.find(T=>T.id===ie)??null,[v,ie]),ue=T=>{var $e;const Ie=crypto.randomUUID(),J=(($e=jn.find(Te=>Te.type===T))==null?void 0:$e.label)??T,ee={...ji[T]};w(Te=>[...Te,{id:Ie,type:"default",position:{x:120+Te.length*40,y:120+Te.length*40},data:{nodeType:T,label:J,params:ee}}]),K(Ie)},re=a.useCallback(T=>{p(Ie=>js({...T,id:crypto.randomUUID()},Ie))},[p]),fe=async()=>{O(null);try{await cr({libraryId:l,collectionId:x,nodes:v.map(T=>({nodeId:T.id,nodeType:T.data.nodeType,payload:{position:T.position,params:T.data.params}})),edges:F.map(T=>({edgeId:T.id,fromNodeId:T.source,fromPort:T.sourceHandle??null,toNodeId:T.target,toPort:T.targetHandle??null}))}),O(t.cogita.library.graph.saveSuccess)}catch{O(t.cogita.library.graph.saveFail)}},Ce=async()=>{try{const T=await lr({libraryId:l,collectionId:x});Y(T)}catch{Y(null)}},ye=T=>{I&&w(Ie=>Ie.map(J=>J.id===I.id?{...J,data:{...J.data,params:T}}:J))};return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${z}/collections/${x}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Ce,children:t.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:fe,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:jn.map(T=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ue(T.type),children:T.label},T.type))}),b?e.jsx("p",{className:"cogita-help",children:b}):null,C&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(C.total))}),e.jsx("p",{children:t.cogita.library.graph.previewBreakdown.replace("{connections}",String(C.connections)).replace("{infos}",String(C.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Ln,{nodes:v,edges:F,onNodesChange:M,onEdgesChange:d,onConnect:re,onNodeClick:(T,Ie)=>K(Ie.id),fitView:!0,children:[e.jsx($n,{color:"rgba(120,160,200,0.2)"}),e.jsx(Rn,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),I?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:I.data.label}),I.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:l,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:I.data.params.tagId?{id:I.data.params.tagId,label:I.data.params.tagLabel??"",infoType:"topic"}:null,onChange:T=>ye({...I.data.params,tagId:(T==null?void 0:T.id)??null,tagLabel:(T==null?void 0:T.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:I.data.params.scope??"any",onChange:T=>ye({...I.data.params,scope:T.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),I.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:l,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:I.data.params.languageId?{id:I.data.params.languageId,label:I.data.params.languageLabel??"",infoType:"language"}:null,onChange:T=>ye({...I.data.params,languageId:(T==null?void 0:T.id)??null,languageLabel:(T==null?void 0:T.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:I.data.params.scope??"any",onChange:T=>ye({...I.data.params,scope:T.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),I.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:I.data.params.infoType??"word",onChange:T=>ye({...I.data.params,infoType:T.target.value}),children:Ni.map(T=>e.jsx("option",{value:T.value,children:T.label},T.value))})]}),e.jsx(Xt,{libraryId:l,infoType:I.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:I.data.params.infoId?{id:I.data.params.infoId,label:I.data.params.infoLabel??"",infoType:I.data.params.infoType??"word"}:null,onChange:T=>ye({...I.data.params,infoId:(T==null?void 0:T.id)??null,infoLabel:(T==null?void 0:T.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),I.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:I.data.params.connectionType??"translation",onChange:T=>ye({...I.data.params,connectionType:T.target.value}),children:ki.map(T=>e.jsx("option",{value:T.value,children:T.label},T.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:I.data.params.connectionId??"",onChange:T=>ye({...I.data.params,connectionId:T.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(I.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const kn="cogita.preferences",Nn="cogita.reviewer.preferences",qs=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],Sn={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},Tn=["settings","run","shared"];function Ti(t,n=""){const s=t.split("/").filter(Boolean);if(s[0]!=="cogita"||s[1]!=="library")return{};const r=s[2];if(!r)return{};if(!s[3])return{libraryId:r,target:"library_overview"};const i=new URLSearchParams(n),m=i.get("revisionId")??void 0,u=i.get("infoId")??void 0,y=i.get("infoView")==="cards"?"cards":"overview",N=i.get("collectionAction"),S=i.get("libraryAction");if(s[3]==="list")return{libraryId:r,target:S==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:m,infoId:u,infoView:y,libraryAction:S==="new-info"?"new-info":void 0};if(s[3]==="detail"||s[3]==="collection")return{libraryId:r,target:"all_cards",cardMode:s[3],revisionId:m,infoId:u,infoView:y};if(s[3]==="new"||s[3]==="add")return{libraryId:r,target:"new_card",revisionId:m,libraryAction:"new-info"};if(s[3]==="edit")return{libraryId:r,target:"new_card",revisionId:m,infoId:s[4]};if(s[3]==="infos"){const x=s[4];return x?s[5]==="checkcards"?{libraryId:r,target:"all_cards",cardMode:"list",revisionId:m,infoId:x,infoView:"cards"}:{libraryId:r,target:"all_cards",cardMode:"list",revisionId:m,infoId:x,infoView:"overview"}:{libraryId:r,target:"all_cards",cardMode:"list",revisionId:m}}if(s[3]==="shared-revisions")return{libraryId:r,target:"all_collections",revisionId:m};if(s[3]==="revision"&&s[4]==="run")return{libraryId:r,target:"all_collections",revisionView:"run",revisionId:m,infoId:u,infoView:y};if(s[3]==="dependencies")return{libraryId:r,target:"dependencies"};if(s[3]==="transfer")return{libraryId:r,target:"transfer"};if(s[3]==="storyboards")return s[4]==="new"?{libraryId:r,target:"new_storyboard"}:{libraryId:r,target:"storyboards"};if(s[3]==="texts")return s[4]==="new"?{libraryId:r,target:"new_text"}:{libraryId:r,target:"texts"};if(s[3]!=="collections")return{libraryId:r,target:"library_overview"};if(s[4]==="new")return{libraryId:r,target:"new_collection",revisionId:m};const l=s[4];return l?s[5]==="graph"?{libraryId:r,target:"all_collections",collectionId:l,revisionId:m,revisionView:"graph"}:s[5]==="shared-revisions"?{libraryId:r,target:"all_collections",collectionId:l,revisionId:m,revisionView:"shared"}:s[5]==="revision"?{libraryId:r,target:"all_collections",collectionId:l,revisionId:m,revisionView:s[6]==="run"?"run":"settings"}:N==="new-revision"?{libraryId:r,target:"all_collections",collectionId:l,revisionId:m,revisionView:"new"}:{libraryId:r,target:"all_collections",collectionId:l,revisionId:m,revisionView:"detail"}:N==="new-collection"?{libraryId:r,target:"new_collection",collectionAction:"new-collection"}:{libraryId:r,target:"all_collections"}}function xs(t,n="library_overview",s,r,i,m,u="overview"){const y=(N,S)=>{const l=new URLSearchParams;S!=null&&S.revisionId&&l.set("revisionId",S.revisionId),S!=null&&S.collectionAction&&l.set("collectionAction",S.collectionAction),S!=null&&S.libraryAction&&l.set("libraryAction",S.libraryAction),S!=null&&S.infoId&&l.set("infoId",S.infoId),S!=null&&S.infoView&&(S!=null&&S.infoId)&&l.set("infoView",S.infoView);const x=l.toString();return x?`${N}?${x}`:N};return t?n==="library_overview"?y(`/cogita/library/${t}`,{revisionId:i}):n==="all_cards"?m?u==="cards"?y(`/cogita/library/${t}/infos/${m}/checkcards`,{revisionId:i}):y(`/cogita/library/${t}/infos/${m}`,{revisionId:i}):y(`/cogita/library/${t}/list`,{revisionId:i,infoId:m,infoView:u}):n==="new_card"?m?y(`/cogita/library/${t}/edit/${m}`,{revisionId:i}):y(`/cogita/library/${t}/list`,{revisionId:i,libraryAction:"new-info"}):n==="all_collections"?s?r==="graph"?y(`/cogita/library/${t}/collections/${s}/graph`,{revisionId:i}):r==="settings"?y(`/cogita/library/${t}/collections/${s}/revision`,{revisionId:i}):r==="run"?y(`/cogita/library/${t}/collections/${s}/revision/run`,{revisionId:i}):r==="shared"?y(`/cogita/library/${t}/collections/${s}/shared-revisions`,{revisionId:i}):r==="new"?y(`/cogita/library/${t}/collections/${s}`,{revisionId:i,collectionAction:"new-revision"}):y(`/cogita/library/${t}/collections/${s}`,{revisionId:i}):y(`/cogita/library/${t}/collections`,{revisionId:i}):n==="new_collection"?y(`/cogita/library/${t}/collections`,{revisionId:i,collectionAction:"new-collection"}):n==="transfer"?y(`/cogita/library/${t}/transfer`,{revisionId:i}):n==="storyboards"?y(`/cogita/library/${t}/storyboards`,{revisionId:i}):n==="new_storyboard"?y(`/cogita/library/${t}/storyboards/new`,{revisionId:i}):n==="texts"?y(`/cogita/library/${t}/texts`,{revisionId:i}):n==="new_text"?y(`/cogita/library/${t}/texts/new`,{revisionId:i}):n==="dependencies"?y(`/cogita/library/${t}/dependencies`,{revisionId:i}):y(`/cogita/library/${t}`,{revisionId:i}):"/cogita"}function Na(t){return t.length>1&&t.endsWith("/")?t.slice(0,-1):t}function Ci(t){return typeof t=="string"&&qs.includes(t)}function Mi(t,n){var y;if(!t.length)return null;const s=t.filter(N=>n.has(N.roleId)),r=s.length>0?s:t,i=r.map(N=>{var l,x;const S=((x=(l=N.fields.find(c=>c.fieldType==="role_kind"))==null?void 0:l.plainValue)==null?void 0:x.toLowerCase())??"";return{roleId:N.roleId,roleKind:S}}),m=i.find(N=>N.roleKind.includes("master"));if(m)return m.roleId;const u=i.find(N=>N.roleKind.includes("account")||N.roleKind.includes("user"));return u?u.roleId:((y=r[0])==null?void 0:y.roleId)??null}function Ii(t){if(!t)return{version:1,byLibrary:{}};try{const n=JSON.parse(t);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Li({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S}){const l=In(),x=tn(),c=a.useMemo(()=>Ti(x.pathname,x.search),[x.pathname,x.search]),g=t.cogita.workspace,[v,w]=a.useState([]),[M,F]=a.useState([]),[p,d]=a.useState([]),[ie,K]=a.useState([]),[b,O]=a.useState(void 0),[C,Y]=a.useState("library_overview"),[z,I]=a.useState(void 0),[ue,re]=a.useState(void 0),[fe,Ce]=a.useState("detail"),[ye,T]=a.useState(void 0),[Ie,J]=a.useState(!1),[ee,$e]=a.useState(!0),[Te,G]=a.useState(!1),[ve,je]=a.useState(!1),[Ve,Ue]=a.useState(null),[Le,qe]=a.useState(0),[Ze,Re]=a.useState(""),[We,et]=a.useState(""),[nt,_e]=a.useState(""),[xe,q]=a.useState([]),[Ae,ne]=a.useState(""),[B,he]=a.useState(null),[Je,R]=a.useState(null),$=a.useRef({version:1,byLibrary:{}}),Q=a.useRef(!1),se=a.useRef(!1),j=a.useRef(null),_=a.useMemo(()=>v.find(h=>h.libraryId===b)??null,[v,b]),E=a.useMemo(()=>M.find(h=>h.collectionId===z)??null,[M,z]);a.useEffect(()=>{if(!b){q([]),ne("");return}let h=!1;return $s({libraryId:b}).then(Me=>{if(h)return;const H=Me.filter(Qe=>(Qe.roleKind??"").trim().toLowerCase()==="person");q(H);try{const Qe=window.localStorage.getItem(Nn),dt=(Qe?JSON.parse(Qe):{})[b]??"",ge=dt&&H.some(kt=>kt.roleId===dt)?dt:"";ne(ge)}catch{ne("")}}).catch(()=>{h||(q([]),ne(""))}),()=>{h=!0}},[b]),a.useEffect(()=>{if(b)try{const h=window.localStorage.getItem(Nn),Me=h?JSON.parse(h):{};Ae?Me[b]=Ae:delete Me[b],window.localStorage.setItem(Nn,JSON.stringify(Me))}catch{}},[b,Ae]);const U=a.useMemo(()=>ie.find(h=>h.revisionId===ue)??null,[ie,ue]),te=a.useMemo(()=>({detail:g.revisions.detail,graph:g.revisions.graph,settings:g.revisions.settings,run:g.revisions.run,shared:g.targets.sharedRevisions,new:g.revisionForm.createAction}),[g.revisions.detail,g.revisions.graph,g.revisions.run,g.revisions.settings,g.targets.sharedRevisions,g.revisionForm.createAction]),ke=a.useMemo(()=>[{value:"detail",label:te.detail},{value:"graph",label:te.graph},{value:"settings",label:g.targets.allRevisions},{value:"run",label:te.run},{value:"shared",label:te.shared}],[te.detail,te.graph,te.run,te.shared,g.targets.allRevisions]),we=a.useMemo(()=>C==="new_card"?"all_cards":C==="new_collection"?"all_collections":C==="new_storyboard"?"storyboards":C==="new_text"?"texts":C,[C]),ze=a.useMemo(()=>fe==="new"?"settings":fe,[fe]),Ne=a.useMemo(()=>c.infoId?"selected":C==="new_card"?"create":"search",[c.infoId,C]),le=a.useMemo(()=>p.find(h=>h.infoId===c.infoId)??null,[p,c.infoId]),oe=a.useMemo(()=>({library_overview:g.targets.libraryOverview,all_cards:g.targets.allCards,new_card:g.targets.newCard,all_collections:g.targets.allCollections,new_collection:g.targets.newCollection,transfer:g.targets.transfer,storyboards:g.targets.storyboards,new_storyboard:g.targets.newStoryboard,texts:g.targets.texts,new_text:g.targets.newText,dependencies:g.targets.dependencies}),[g.targets]),Ye=a.useMemo(()=>oe[we]??we,[we,oe]),He=te[ze],st=!!b,it=a.useMemo(()=>{const h=N==="pl"?"Ruch na teraz: utwórz bibliotekę i wpisz pierwszy element wiedzy.":N==="de"?"Nächster Schritt: Erstelle eine Bibliothek und füge den ersten Wissenseintrag hinzu.":"Next action: create one library and add your first knowledge item.";return N==="pl"?[{step:"Krok 1",title:"Czym jest Cogita?",lead:"To centrum budowania i prowadzenia procesu nauki po zalogowaniu.",passages:["W jednym miejscu łączysz treści, ćwiczenia i współpracę zespołu.","Zamiast luźnych notatek dostajesz spójny przepływ: biblioteka → kolekcja → powtórka."],focus:["Jedna przestrzeń robocza","Spójny proces"],action:h},{step:"Krok 2",title:"Zacznij od biblioteki",lead:"Biblioteka jest bazą dla całego tematu.",passages:["Nazwij bibliotekę jasno: np. „Historia Kościoła – semestr 1”.","Każdy kolejny moduł korzysta z tej samej biblioteki jako źródła."],focus:["Nazwa tematyczna","Jeden punkt startowy"],action:h},{step:"Krok 3",title:"Dodawaj informacje",lead:"Twórz krótkie, konkretne jednostki wiedzy.",passages:["Wpisy typu info opisują pojęcia, osoby, źródła i cytaty.","Małe jednostki łatwiej łączyć, powtarzać i aktualizować."],focus:["Krótko i konkretnie","Łatwe aktualizacje"],action:h},{step:"Krok 4",title:"Pracuj na typach",lead:"Formularze dostosowują się do rodzaju informacji.",passages:["Każdy typ pokazuje właściwe pola i porządkuje dane.","To zmniejsza chaos i poprawia jakość wyszukiwania."],focus:["Lepsza struktura","Mniej błędów"],action:h},{step:"Krok 5",title:"Łącz wiedzę linkami",lead:"Buduj kontekst przez relacje między wpisami.",passages:["Połącz temat z definicją, źródłem i przykładem.","Graf relacji pomaga zobaczyć, czego brakuje przed kolejnym etapem."],focus:["Relacje między wpisami","Pełniejszy kontekst"],action:h},{step:"Krok 6",title:"Twórz kolekcje celu",lead:"Kolekcja grupuje wpisy pod konkretny scenariusz.",passages:["Osobna kolekcja dla lekcji, osobna dla quizu lub egzaminu.","Nie duplikujesz treści — tylko wybierasz, co jest potrzebne."],focus:["Celowe grupowanie","Bez duplikatów"],action:h},{step:"Krok 7",title:"Dodawaj powtórki",lead:"Powtórka definiuje jak przebiega sprawdzanie.",passages:["Ustaw tempo, kolejność i zakres materiału.","Dla jednej kolekcji możesz mieć kilka powtórek o różnych poziomach."],focus:["Kontrola tempa","Różne poziomy"],action:h},{step:"Krok 8",title:"Info vs karta",lead:"Rozróżniaj źródło wiedzy i widok ćwiczeniowy.",passages:["Info to rekord bazowy, który przechowuje treść.","Karta to forma pytania/utrwalenia generowana z info."],focus:["Źródło danych","Widok ćwiczeń"],action:h},{step:"Krok 9",title:"Uruchamiaj sesję",lead:"Tryb Run prowadzi uczestników krok po kroku.",passages:["Prowadzący kontroluje rytm i przejścia między etapami.","Uczestnicy mają jasny przebieg bez zgadywania, co dalej."],focus:["Płynny przebieg","Lepsza dynamika grupy"],action:h},{step:"Krok 10",title:"Czytaj graf zależności",lead:"Graf pokazuje priorytety nauki.",passages:["Węzły centralne oznaczają tematy, które wpływają na wiele innych.","Najpierw utrwal fundamenty, potem przechodź do warstw zaawansowanych."],focus:["Priorytety materiału","Lepsza kolejność"],action:h},{step:"Krok 11",title:"Storyboard i teksty",lead:"Plan i notatki trzymaj blisko wiedzy źródłowej.",passages:["Storyboard układa narrację i przebieg spotkania.","Teksty zbierają komentarze, wnioski i gotowe treści do publikacji."],focus:["Lepsze przygotowanie","Notatki w kontekście"],action:h},{step:"Krok 12",title:"Udostępniaj bezpiecznie",lead:"Dziel się materiałem bez utraty kontroli.",passages:["Możesz dać dostęp tylko do odczytu dla wybranych osób.","Edycja pozostaje po stronie autora lub zespołu prowadzącego."],focus:["Kontrola uprawnień","Bezpieczne współdzielenie"],action:h},{step:"Krok 13",title:"Nawiguj warstwowo",lead:"Sidebar i breadcrumb prowadzą przez poziomy.",passages:["Zawsze widzisz, czy pracujesz na bibliotece, kolekcji czy powtórce.","Mniej kliknięć „w ciemno”, więcej świadomej nawigacji."],focus:["Orientacja w systemie","Szybsze decyzje"],action:h},{step:"Krok 14",title:"Plan wdrożenia 30 minut",lead:"Najpierw prosty pilot, potem rozwijaj.",passages:["Plan: 1 biblioteka, 10 wpisów info, 1 kolekcja, 1 powtórka testowa.","Po pierwszej sesji popraw strukturę i dodaj kolejne scenariusze."],focus:["Szybki start","Iteracyjne doskonalenie"],action:"Gotowe? Załóż bibliotekę po prawej i przejdź do pierwszego wpisu."}]:N==="de"?[{step:"Schritt 1",title:"Was ist Cogita?",lead:"Ein zentraler Workspace für Lernen und Moderation nach dem Login.",passages:["Du verbindest Inhalte, Übungen und Teamarbeit in einem Ablauf.","Der Prozess bleibt klar: Bibliothek → Sammlung → Wiederholung."],focus:["Ein Workspace","Klarer Ablauf"],action:h},{step:"Schritt 2",title:"Mit Bibliothek starten",lead:"Die Bibliothek ist der Startpunkt für dein Thema.",passages:["Vergib einen klaren Namen für Kurs oder Modul.","Alle weiteren Bereiche greifen auf diese Basis zu."],focus:["Sauberer Start","Gemeinsame Basis"],action:h},{step:"Schritt 3",title:"Infos anlegen",lead:"Erfasse Wissen in kleinen, klaren Einträgen.",passages:["Info-Einträge enthalten Begriffe, Personen, Quellen und Zitate.","Kleinere Einheiten lassen sich besser verknüpfen und trainieren."],focus:["Kleine Einheiten","Leicht wartbar"],action:h},{step:"Schritt 4",title:"Typbasierte Eingabe",lead:"Formulare passen sich automatisch dem Info-Typ an.",passages:["Dadurch bleiben Daten strukturiert und konsistent.","Das verbessert Qualität und Auffindbarkeit."],focus:["Konsistenz","Bessere Suche"],action:h},{step:"Schritt 5",title:"Wissen verlinken",lead:"Verbinde Einträge zu einem Kontextnetz.",passages:["Thema, Quelle und Beispiel werden als Beziehung sichtbar.","So erkennst du Lücken vor der nächsten Lernphase."],focus:["Kontextnetz","Lücken erkennen"],action:h},{step:"Schritt 6",title:"Ziel-Sammlungen bauen",lead:"Eine Sammlung bündelt Inhalte für einen konkreten Zweck.",passages:["Nutze getrennte Sammlungen für Unterricht, Quiz oder Prüfung.","Du wählst Inhalte aus statt sie zu kopieren."],focus:["Zielorientierung","Keine Duplikate"],action:h},{step:"Schritt 7",title:"Wiederholungen erstellen",lead:"Wiederholungen definieren den Prüfungsablauf.",passages:["Tempo, Reihenfolge und Umfang sind pro Wiederholung steuerbar.","Mehrere Wiederholungen pro Sammlung sind möglich."],focus:["Ablaufsteuerung","Mehrere Niveaus"],action:h},{step:"Schritt 8",title:"Info und Karte",lead:"Datenobjekt und Trainingsansicht sind getrennt.",passages:["Info ist die Quelle der Inhalte.","Die Karte ist die Übungsansicht für Frage und Antwort."],focus:["Sauberes Modell","Wiederverwendbar"],action:h},{step:"Schritt 9",title:"Sitzung durchführen",lead:"Im Run-Modus führst du die Gruppe Schritt für Schritt.",passages:["Moderation steuert Übergänge und Timing.","Teilnehmende folgen einem klaren Ablauf."],focus:["Klare Moderation","Stabile Dynamik"],action:h},{step:"Schritt 10",title:"Abhängigkeitsgraph lesen",lead:"Der Graph zeigt Lernprioritäten.",passages:["Zentrale Knoten beeinflussen viele weitere Themen.","Starte mit Grundlagen und baue danach auf."],focus:["Priorisierung","Lernreihenfolge"],action:h},{step:"Schritt 11",title:"Storyboard & Texte",lead:"Plane Ablauf und sammle Notizen im selben Kontext.",passages:["Storyboards strukturieren Sequenzen und Rollen.","Texte halten Erkenntnisse und veröffentlichungsreife Inhalte fest."],focus:["Planung","Dokumentation"],action:h},{step:"Schritt 12",title:"Sicher teilen",lead:"Teile Inhalte ohne Kontrollverlust.",passages:["Leserechte sind separat von Bearbeitungsrechten steuerbar.","So bleibt der Kernbestand geschützt."],focus:["Rechtekontrolle","Sicheres Teilen"],action:h},{step:"Schritt 13",title:"Ebenen-Navigation",lead:"Sidebar und Breadcrumb zeigen deinen aktuellen Kontext.",passages:["Du siehst sofort, auf welcher Ebene du arbeitest.","Das spart Zeit und reduziert Fehlklicks."],focus:["Orientierung","Effizienz"],action:h},{step:"Schritt 14",title:"30-Minuten-Startplan",lead:"Starte klein und erweitere iterativ.",passages:["Plan: 1 Bibliothek, 10 Infos, 1 Sammlung, 1 Test-Wiederholung.","Nach der ersten Runde verbesserst du Struktur und Ablauf."],focus:["Schneller Einstieg","Iteratives Vorgehen"],action:"Jetzt starten: Bibliothek rechts anlegen und den ersten Eintrag erfassen."}]:[{step:"Step 1",title:"What is Cogita?",lead:"A post-login workspace to design, run, and improve knowledge journeys.",passages:["You can keep content, training flow, and collaboration in one place.","The path stays explicit: library → collection → revision → session."],focus:["Single workspace","Clear learning flow"],action:h},{step:"Step 2",title:"Start with a library",lead:"Your library is the root container for one domain or program.",passages:["Name it after your course, cohort, or topic scope.","Every next module reuses this foundation."],focus:["Root container","Consistent base"],action:h},{step:"Step 3",title:"Add information units",lead:"Build knowledge from small, reusable info entries.",passages:["Capture terms, references, people, concepts, and citations.","Smaller entries are easier to link, review, and update."],focus:["Reusable units","Easy maintenance"],action:h},{step:"Step 4",title:"Use type-based forms",lead:"Each info type has a matching data structure and fields.",passages:["Form layouts adapt automatically to the selected type.","This improves consistency and lowers input mistakes."],focus:["Structured input","Fewer errors"],action:h},{step:"Step 5",title:"Link the knowledge graph",lead:"Relationships turn isolated facts into usable context.",passages:["Connect topics, sources, and supporting examples.","Dependency links show what must be learned first."],focus:["Context building","Better sequencing"],action:h},{step:"Step 6",title:"Build goal collections",lead:"Collections package selected infos for a concrete objective.",passages:["Create separate collections for class, quiz, exam, or workshop.","You curate from existing entries instead of duplicating content."],focus:["Goal-oriented sets","No duplication"],action:h},{step:"Step 7",title:"Create revisions",lead:"Revisions define how practice and checking should run.",passages:["Set pacing, order, and scope for each session style.","One collection can host multiple revision strategies."],focus:["Practice design","Multiple modes"],action:h},{step:"Step 8",title:"Understand info vs card",lead:"Data objects and practice views are intentionally separate.",passages:["Info is the canonical source object.","Card is the generated training/checking view."],focus:["Clear model","Reusable content"],action:h},{step:"Step 9",title:"Run live sessions",lead:"Run mode helps facilitators guide each step with control.",passages:["Move through prompts, responses, and timing intentionally.","Participants get a predictable and focused session rhythm."],focus:["Facilitator control","Group clarity"],action:h},{step:"Step 10",title:"Read dependency graphs",lead:"Graph views expose prerequisites and high-impact nodes.",passages:["Central nodes usually deserve priority in onboarding.","Use this to plan revision order and reduce confusion."],focus:["Priority mapping","Smarter progression"],action:h},{step:"Step 11",title:"Use storyboards and texts",lead:"Plan narratives and keep notes near source knowledge.",passages:["Storyboards model session structure and transitions.","Texts capture outcomes, drafts, and reusable explanations."],focus:["Planning layer","Contextual notes"],action:h},{step:"Step 12",title:"Share safely",lead:"Share read access without losing editorial control.",passages:["Keep editing rights restricted to owners or maintainers.","Collaborators can consume material while core data stays protected."],focus:["Access control","Safe collaboration"],action:h},{step:"Step 13",title:"Navigate by layers",lead:"Sidebar and breadcrumb make system depth understandable.",passages:["You always know whether you are at library, collection, or revision level.","Clear location awareness reduces wrong actions."],focus:["Fast orientation","Lower friction"],action:h},{step:"Step 14",title:"30-minute launch plan",lead:"Start with a minimum viable setup, then iterate.",passages:["Plan: create 1 library, add 10 infos, build 1 collection, run 1 revision.","After the first run, refine structure and scale by scenario."],focus:["Immediate execution","Iterative improvement"],action:"Ready now? Create your first library on the right and start adding knowledge."}]},[N]),yt=it.length,Ge=Math.max(0,Math.min(Le,yt-1)),tt=it[Ge],jt=!!z,Tt=st&&C==="all_collections",It=jt&&C==="all_collections",Et=jt&&C==="all_collections"&&Tn.includes(fe),gt=a.useCallback(h=>{const Me=!!h.libraryId;let H=h.target,Qe=h.collectionId,ot=h.revisionId,dt=h.revisionView,ge=h.infoId,kt=h.infoView??c.infoView??"overview";Me?Sn[H].requiresCollection&&!Qe?(H="all_collections",ot=void 0,dt="detail"):H!=="all_collections"?(Qe=void 0,ot=void 0,H!=="new_card"&&H!=="all_cards"&&(ge=void 0,kt="overview")):Sn[H].allowsRevision?Tn.includes(dt)||(ot=void 0):dt="detail":(H="library_overview",Qe=void 0,ot=void 0,dt="detail",ge=void 0,kt="overview"),O(h.libraryId),Y(H),I(Qe),re(ot),Ce(dt),J(!1);const Lt=Na(xs(h.libraryId,H,Qe,dt,ot,ge,kt));Na(`${x.pathname}${x.search}`)!==Lt&&(j.current=Lt,l(Lt))},[x.pathname,x.search,l,c.infoView]),Ut=h=>{gt({libraryId:b,target:"all_collections",collectionId:z,revisionId:Tn.includes(h)?ue:void 0,revisionView:h})},ft=a.useMemo(()=>[{key:"library",label:g.layers.library,visible:!0,value:b??"",selectedLabel:(_==null?void 0:_.name)??g.path.noLibrarySelected,disabled:ee||v.length===0,options:v.map(h=>({value:h.libraryId,label:h.name})),emptyOption:g.noLibraryOption,onSelect:h=>{const Me=h||void 0;gt({libraryId:Me,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:g.layers.target,visible:st,value:we,selectedLabel:Ye,disabled:!st,options:qs.map(h=>({value:h,label:oe[h]})),onSelect:h=>{const Me=h;gt({libraryId:b,target:Me,collectionId:z,revisionId:ue,revisionView:fe,infoId:Me==="new_card"?c.infoId:void 0})}},{key:"info_mode",label:g.layers.target,visible:we==="all_cards",value:Ne,selectedLabel:Ne==="create"?g.infoMode.create:Ne==="selected"?(le==null?void 0:le.label)??ye??t.cogita.library.list.selectedEmpty:g.infoMode.search,disabled:!st,options:[{value:"search",label:g.infoMode.search},{value:"create",label:g.infoMode.create},...c.infoId?[{value:"selected",label:(le==null?void 0:le.label)??ye??t.cogita.library.list.selectedEmpty}]:[]],onSelect:h=>{if(h==="selected"){if(!c.infoId)return;gt({libraryId:b,target:"all_cards",collectionId:z,revisionId:ue,revisionView:fe,infoId:c.infoId,infoView:"overview"});return}if(h==="create"){gt({libraryId:b,target:"new_card",collectionId:z,revisionId:ue,revisionView:fe,infoId:void 0});return}gt({libraryId:b,target:"all_cards",collectionId:z,revisionId:ue,revisionView:fe,infoId:void 0,infoView:"overview"})}},{key:"info_selected_action",label:g.layers.target,visible:we==="all_cards"&&!!c.infoId,value:C==="new_card"&&c.infoId?"edit":c.infoView==="cards"?"cards":"overview",selectedLabel:C==="new_card"&&c.infoId?g.infoActions.edit:c.infoView==="cards"?g.infoActions.seeCards:g.infoActions.overview,disabled:!st||!c.infoId,options:[{value:"overview",label:g.infoActions.overview},{value:"edit",label:g.infoActions.edit},{value:"cards",label:g.infoActions.seeCards}],onSelect:h=>{if(c.infoId){if(h==="edit"){gt({libraryId:b,target:"new_card",collectionId:z,revisionId:ue,revisionView:fe,infoId:c.infoId});return}if(h==="cards"){gt({libraryId:b,target:"all_cards",collectionId:z,revisionId:ue,revisionView:fe,infoId:c.infoId,infoView:"cards"});return}gt({libraryId:b,target:"all_cards",collectionId:z,revisionId:ue,revisionView:fe,infoId:c.infoId,infoView:"overview"})}}},{key:"collection",label:g.layers.collection,visible:Tt,value:z??"",selectedLabel:(E==null?void 0:E.name)??g.path.noCollectionSelected,disabled:!st||Te||M.length===0,options:M.map(h=>({value:h.collectionId,label:h.name})),emptyOption:g.selectCollectionOption,onSelect:h=>{gt({libraryId:b,target:"all_collections",collectionId:h||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:g.layers.revision,visible:It,value:ze,selectedLabel:He,disabled:!z,options:ke.map(h=>({value:h.value,label:h.label})),onSelect:h=>{Ut(h)}},{key:"revision_entry",label:g.layers.revision,visible:Et,value:ue??"",selectedLabel:(U==null?void 0:U.name)??g.status.noRevisions,disabled:!jt||ve||ie.length===0,options:ie.map(h=>({value:h.revisionId,label:h.name})),emptyOption:g.status.noRevisions,onSelect:h=>{gt({libraryId:b,target:"all_collections",collectionId:z,revisionId:h||void 0,revisionView:fe})}}],[ke,M,Te,Ne,p,v,ee,gt,ie,ve,E,z,le,U,ue,ye,jt,st,_,b,He,fe,C,ze,we,Ye,Tt,It,Et,oe,t.cogita.library.list.selectedEmpty,c.infoId,c.infoView,g.infoActions.edit,g.infoActions.overview,g.infoActions.seeCards,g.layers.collection,g.layers.library,g.layers.revision,g.layers.target,g.noLibraryOption,g.path.noCollectionSelected,g.path.noLibrarySelected,g.selectCollectionOption]),Zt=a.useMemo(()=>ft.filter(h=>h.visible),[ft]),ht=a.useMemo(()=>Zt.filter(h=>h.key!=="library"&&h.key!=="collection"),[Zt]),vt=a.useMemo(()=>ht.find(h=>h.key==="target")??null,[ht]),zt=a.useMemo(()=>ht.find(h=>h.key==="info_mode")??null,[ht]),Ct=a.useMemo(()=>ht.find(h=>h.key==="info_selected_action")??null,[ht]),Fe=a.useMemo(()=>ht.find(h=>h.key==="collection_action")??null,[ht]),mt=a.useMemo(()=>ht.find(h=>h.key==="revision_entry")??null,[ht]),wt=a.useCallback((h,Me)=>h?e.jsx("div",{className:"cogita-sidebar-actions",children:h.options.map(H=>e.jsx("button",{type:"button",className:`ghost ${String(h.value)===H.value?"active":""}`,onClick:()=>h.onSelect(H.value),disabled:h.disabled,children:H.label},`${Me}:${h.key}:${H.value}`))}):null,[]),xt=a.useMemo(()=>{const h=c.libraryId;if(!h||!x.pathname.startsWith("/cogita/library/"))return null;const Me={copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,libraryId:h};if(c.target==="library_overview")return e.jsx(Mr,{...Me});if(c.target==="all_cards")return c.infoId&&c.infoView==="cards"?e.jsx(Xr,{...Me,infoId:c.infoId,selectedReviewerRoleId:Ae||null}):e.jsx(Fr,{...Me,mode:c.cardMode??"list"});if(c.target==="new_card")return e.jsx(Jr,{...Me,editInfoId:c.infoId});if(c.target==="dependencies")return e.jsx(Wr,{...Me});if(c.target==="transfer")return e.jsx(ei,{...Me});if(c.target==="storyboards"||c.target==="new_storyboard")return e.jsx(ti,{...Me});if(c.target==="texts"||c.target==="new_text")return e.jsx(ai,{...Me});if(c.target==="all_collections"){if(!c.collectionId&&c.revisionView==="run")return e.jsx(ys,{...Me,revisionId:c.revisionId});if(c.collectionId){const H={...Me,collectionId:c.collectionId};return c.revisionView==="graph"?e.jsx(Si,{...H}):c.revisionView==="shared"?e.jsx(Zr,{...Me,collectionId:c.collectionId}):c.revisionView==="settings"?e.jsx(hi,{...H,revisionId:c.revisionId}):c.revisionView==="run"?e.jsx(ys,{...H,revisionId:c.revisionId}):e.jsx(ni,{...H})}return e.jsx(bs,{...Me})}return c.target==="new_collection"?e.jsx(bs,{...Me}):null},[n,t,N,x.pathname,l,S,m,y,r,i,c.cardMode,c.collectionId,c.infoId,c.libraryId,c.revisionId,c.revisionView,c.target,u,s,Ae]);a.useEffect(()=>{let h=!1;return(async()=>{var H,Qe,ot,dt,ge;$e(!0);try{await dr();const[kt,Lt,ra]=await Promise.all([Ss(),ur(),hr()]);if(h)return;w(kt);const ea=new Set(ra.nodes.filter(ut=>ut.nodeType==="role"&&ut.canLink).map(ut=>ut.roleId??"")),ta=Mi(Lt,ea);if(he(ta),ta){const ut=ra.nodes.find(bt=>bt.nodeType==="data"&&bt.roleId===ta&&(bt.fieldType===kn||bt.label===kn));R((ut==null?void 0:ut.dataKeyId)??null),$.current=Ii(ut==null?void 0:ut.value)}const Mt=(H=kt.find(ut=>ut.libraryId===c.libraryId))==null?void 0:H.libraryId,aa=Mt?(ot=(Qe=$.current.byLibrary)==null?void 0:Qe[Mt])==null?void 0:ot.lastTarget:void 0,na=Ci(aa)?aa:"library_overview";O(Mt),Y(c.target??na),re(c.revisionId??(Mt?(ge=(dt=$.current.byLibrary)==null?void 0:dt[Mt])==null?void 0:ge.lastRevisionId:void 0)),Ce(c.revisionView??"detail"),Q.current=!0}catch{h||Ue(g.status.loadFailed)}finally{h||$e(!1)}})(),()=>{h=!0}},[g.status.loadFailed]),a.useLayoutEffect(()=>{if(Q.current){if(!c.libraryId){O(void 0),Y(c.target??"library_overview"),I(void 0),re(void 0),Ce("detail");return}c.libraryId&&v.some(h=>h.libraryId===c.libraryId)&&O(c.libraryId),c.target&&Y(c.target),I(c.collectionId),re(c.revisionId),c.revisionView&&Ce(c.revisionView)}},[v,c.collectionId,c.libraryId,c.revisionId,c.revisionView,c.target]),a.useEffect(()=>{if(!b){F([]),I(void 0),d([]),K([]),re(void 0);return}let h=!1;return G(!0),Aa({libraryId:b,limit:200}).then(Me=>{var ot;if(h)return;const H=Me.items;F(H);const Qe=(ot=H.find(dt=>dt.collectionId===c.collectionId))==null?void 0:ot.collectionId;I(Qe)}).catch(()=>{h||(F([]),I(void 0))}).finally(()=>{h||G(!1)}),()=>{h=!0}},[c.collectionId,b]),a.useEffect(()=>{if(!b||we!=="all_cards"&&C!=="new_card"){d([]);return}let h=!1;return En({libraryId:b,limit:200}).then(Me=>{h||d(Me)}).catch(()=>{h||d([])}),()=>{h=!0}},[we,b,C]),a.useEffect(()=>{if(!b||!z){K([]),re(void 0);return}let h=!1;return je(!0),Ts({libraryId:b,collectionId:z}).then(Me=>{var ot,dt,ge,kt;if(h)return;K(Me);const H=(dt=(ot=$.current.byLibrary)==null?void 0:ot[b])==null?void 0:dt.lastRevisionId,Qe=((ge=Me.find(Lt=>Lt.revisionId===c.revisionId))==null?void 0:ge.revisionId)??((kt=Me.find(Lt=>Lt.revisionId===H))==null?void 0:kt.revisionId);re(Qe)}).catch(()=>{h||(K([]),re(void 0))}).finally(()=>{h||je(!1)}),()=>{h=!0}},[c.revisionId,z,b]),a.useEffect(()=>{const h=c.infoId;if(!b||!h){T(void 0);return}let Me=!1;return Qt({libraryId:b,infoId:h}).then(H=>{if(Me)return;const Qe=H.payload;T((Qe==null?void 0:Qe.label)??(Qe==null?void 0:Qe.name)??(Qe==null?void 0:Qe.title)??H.infoId)}).catch(()=>{Me||T(h)}),()=>{Me=!0}},[c.infoId,b]),a.useEffect(()=>{if(!Q.current||c.libraryId&&v.some(ot=>ot.libraryId===c.libraryId)&&c.libraryId!==b||c.target&&c.target!==C||c.revisionView&&c.revisionView!==fe||c.revisionId&&c.revisionId!==ue||Sn[C].requiresCollection&&!z&&c.target==="all_collections"&&c.collectionId)return;const h=Na(`${x.pathname}${x.search}`);if(Na(x.pathname)==="/cogita"&&!c.libraryId&&!b){j.current=null;return}if(Na(x.pathname)===`/cogita/library/${b}/revision/run`&&c.revisionView==="run"&&!c.collectionId&&C==="all_collections"&&fe==="run"&&!z){j.current=null;return}const Qe=Na(xs(b,C,z,fe,ue,c.infoId,c.infoView??"overview"));if(h===Qe){j.current=null;return}j.current!==Qe&&(j.current=Qe,l(Qe,{replace:!0}))},[v,x.pathname,x.search,l,c.collectionId,c.infoId,c.infoView,c.libraryId,c.revisionId,c.revisionView,c.target,z,b,ue,fe,C]),a.useEffect(()=>{if(typeof window>"u")return;const h=()=>{window.innerWidth>920&&J(!1)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]),a.useEffect(()=>{if(!Q.current||!B||!b||se.current)return;const h=$.current,Me={...h.byLibrary??{}},H={...Me[b]??{},lastCollectionId:z,lastRevisionId:ue,lastRevisionView:fe,lastTarget:C},Qe={version:1,lastLibraryId:b,byLibrary:{...Me,[b]:H}},ot=JSON.stringify(h),dt=JSON.stringify(Qe);if(ot===dt)return;$.current=Qe,se.current=!0,(async()=>{try{if(Je)await mr(Je,{plainValue:dt});else{const kt=await gr(B,{itemName:kn,itemType:"data",plainValue:dt});R(kt.dataItemId)}}catch{Ue(g.status.savePrefsFailed)}finally{se.current=!1}})()},[Je,B,z,b,ue,fe,C,g.status.savePrefsFailed]);const k=async()=>{const h=Ze.trim();if(!h){Ue(t.cogita.user.libraryNameRequired);return}Ue(null);try{const Me=await br({name:h});w(H=>[Me,...H]),O(Me.libraryId),Y("library_overview"),I(void 0),Re("")}catch{Ue(t.cogita.user.libraryCreateFailed)}},pe=async()=>{if(!b){Ue(g.status.selectLibraryFirst);return}const h=We.trim();if(!h){Ue(t.cogita.library.collections.saveRequiredName);return}Ue(null);try{const Me=await pr({libraryId:b,name:h,items:[]}),H=await Aa({libraryId:b,limit:200});F(H.items),I(Me.collectionId),re(void 0),Y("all_collections"),Ce("detail"),et("")}catch{Ue(t.cogita.library.collections.saveFail)}},Be=async()=>{if(!b||!z){Ue(g.status.selectLibraryFirst);return}const h=nt.trim();if(!h){Ue(g.revisionForm.nameLabel);return}Ue(null);try{const Me=await fr({libraryId:b,collectionId:z,name:h,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});K(H=>[Me,...H]),re(Me.revisionId),Y("all_collections"),Ce("settings"),_e("")}catch{Ue(g.status.loadFailed)}};return e.jsx(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,headerExtra:b?e.jsxs("label",{className:"cogita-header-reviewer",children:[e.jsx("span",{children:"Person"}),e.jsxs("select",{value:Ae,onChange:h=>ne(h.target.value),children:[e.jsx("option",{value:"",children:"No person"}),xe.map(h=>e.jsx("option",{value:h.roleId,children:h.label},h.roleId))]})]}):null,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${Ie?"open":""}`,"aria-label":g.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(_==null?void 0:_.name)??g.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:_?g.sidebar.libraryActionsHint:g.status.selectLibraryFirst}),wt(vt,"sidebar")]}),zt?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:g.sidebar.infoActionsHint}),wt(zt,"sidebar"),Ct?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(le==null?void 0:le.label)??ye??t.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:g.sidebar.selectedInfoActionsHint}),wt(Ct,"sidebar")]}):null]}):null,E?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:E.name}),e.jsx("p",{className:"cogita-sidebar-note",children:g.sidebar.collectionActionsHint}),wt(Fe,"sidebar"),mt?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(U==null?void 0:U.name)??g.status.noRevisions}),wt(mt,"sidebar")]}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:g.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:r,children:g.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{y("cogita"),J(!1)},children:g.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:i,children:u?t.account.secureModeDisable:t.account.secureModeEnable})]})]})]}),Ie?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":g.sidebar.closeMenu,onClick:()=>J(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":g.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>J(h=>!h),"aria-label":Ie?g.sidebar.closeMenu:g.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),Zt.map((h,Me)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Me>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,h.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":h.label,children:h.selectedLabel}):e.jsxs("select",{"aria-label":h.label,value:h.value,onChange:H=>h.onSelect(H.target.value),disabled:h.disabled,children:[h.emptyOption?e.jsx("option",{value:"",children:h.emptyOption}):null,h.options.map(H=>e.jsx("option",{value:H.value,children:H.label},`${h.key}:${H.value}`))]})]},`menu:${h.key}`))]}),xt?e.jsxs(e.Fragment,{children:[C==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:We,onChange:h=>et(h.target.value),placeholder:t.cogita.library.collections.namePlaceholder,disabled:!b})]}),e.jsx("button",{type:"button",className:"cta",onClick:pe,disabled:!b,children:t.cogita.library.actions.createCollection}),Ve?e.jsx("p",{className:"cogita-form-error",children:Ve}):null]}):null,C==="all_collections"&&z&&fe==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:g.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:g.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:nt,onChange:h=>_e(h.target.value),placeholder:g.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Be,children:g.revisionForm.createAction}),Ve?e.jsx("p",{className:"cogita-form-error",children:Ve}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Rs.Provider,{value:!0,children:xt})})]}):null,xt?null:e.jsx(e.Fragment,{children:b?null:e.jsxs("section",{className:"cogita-browser-intro",children:[e.jsx("div",{className:"cogita-browser-intro-main",children:e.jsxs("article",{className:"cogita-browser-panel cogita-browser-tutorial",children:[e.jsxs("div",{className:"cogita-browser-tutorial-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-browser-tutorial-step",children:tt.step}),e.jsx("h2",{children:tt.title})]}),e.jsxs("p",{children:[Ge+1," / ",yt]})]}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-lead",children:tt.lead}),e.jsx("div",{className:"cogita-browser-tutorial-passages",children:tt.passages.map(h=>e.jsx("p",{children:h},h))}),e.jsx("div",{className:"cogita-browser-tutorial-focus",children:tt.focus.map(h=>e.jsx("span",{children:h},h))}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-action",children:tt.action}),e.jsx("div",{className:"cogita-browser-tutorial-progress",role:"list","aria-label":"Tutorial progress",children:it.map((h,Me)=>e.jsx("button",{type:"button",className:`ghost ${Me===Ge?"active":""}`,onClick:()=>qe(Me),"aria-label":`${Me+1}`,children:Me+1},`tutorial:${h.title}:${Me}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:Ge===0,onClick:()=>qe(h=>Math.max(0,h-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"cta",disabled:Ge===yt-1,onClick:()=>qe(h=>Math.min(yt-1,h+1)),children:"Next"})]})]})}),e.jsxs("div",{className:"cogita-browser-intro-side",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.createLibraryTitle}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ze,onChange:h=>Re(h.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:k,children:t.cogita.user.createLibraryAction}),Ve?e.jsx("p",{className:"cogita-form-error",children:Ve}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.availableLibraries}),v.length===0?e.jsx("p",{className:"cogita-browser-note",children:t.cogita.user.noLibraries}):null,v.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:v.map(h=>e.jsxs("button",{type:"button",className:"cogita-card-item",onClick:()=>{gt({libraryId:h.libraryId,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.user.libraryRoleLabel}),e.jsx("h3",{className:"cogita-card-title",children:h.name})]},h.libraryId))}):null]})]})]})})]})]})})}const Ki=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Li},Symbol.toStringTag,{value:"Module"}));function $i({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,shareId:l}){const[x,c]=a.useState(null),[g,v]=a.useState("loading"),[w,M]=a.useState(t.cogita.library.collections.defaultName),[F,p]=a.useState("Cogita Library"),[d,ie]=a.useState([]),[K,b]=a.useState([]),[O,C]=a.useState("idle"),[Y,z]=a.useState({current:0,total:0}),[I,ue]=a.useState(0),[re,fe]=a.useState(""),[Ce,ye]=a.useState(null),[T,Ie]=a.useState(null),[J,ee]=a.useState(null),[$e,Te]=a.useState(null),[G,ve]=a.useState([]),[je,Ve]=a.useState({}),[Ue,Le]=a.useState({}),[qe,Ze]=a.useState(null),[Re,We]=a.useState(null),[et,nt]=a.useState(null),[_e,xe]=a.useState(null),[q,Ae]=a.useState({}),ne=a.useRef(0),[B,he]=a.useState(null),Je=a.useRef(null),R=a.useRef(null),[$,Q]=a.useState(null),[se,j]=a.useState(!1),[_,E]=a.useState(null),[U,te]=a.useState([]),[ke,we]=a.useState(null),ze=a.useRef(null),Ne=a.useRef(null),[le,oe]=a.useState(null),[Ye,He]=a.useState(0),st=a.useRef(null),it=a.useRef({}),[yt,Ge]=a.useState(!1),[tt,jt]=a.useState({}),Tt=a.useRef(null),It=a.useRef(new Set),Et=a.useRef({}),[gt,Ut]=a.useState([]),[ft,Zt]=a.useState(new Set),[ht,vt]=a.useState(!1),zt=tn(),Ct=a.useMemo(()=>new URLSearchParams(zt.search),[zt.search]),Fe=a.useMemo(()=>Ct.get("key")??"",[Ct]),mt=(x==null?void 0:x.mode)??"random",wt=(x==null?void 0:x.check)??"exact",xt=(x==null?void 0:x.limit)??20,k=a.useMemo(()=>_n((x==null?void 0:x.revisionType)??mt),[x,mt]),pe=a.useMemo(()=>{const L=x==null?void 0:x.revisionSettings,W=Fs(k,Ct);return rn(k,L??W)},[x,Ct,k]),Be=a.useMemo(()=>t.cogita.library.revision[k.labelKey]??mt,[t,mt,k]),h=a.useMemo(()=>wt==="exact"?t.cogita.library.revision.checkValue:wt,[t,wt]),H=g==="ready"?d[I]??null:null,Qe=(H==null?void 0:H.checkType)==="translation-match"&&_e,ot=a.useRef(new Map),dt=a.useRef(new Map),ge=a.useRef(new Map),kt=a.useRef(new Map),Lt=a.useMemo(()=>H?H.cardType==="vocab"?t.cogita.library.revision.vocabLabel:H.infoType?Xe(t,H.infoType):t.cogita.library.revision.infoLabel:"",[t,H]),ra=a.useMemo(()=>{var W;return k.id!=="levels"?d.length:((W=tt.pool)==null?void 0:W.length)??k.getFetchLimit(xt,pe)},[tt,pe,k,d.length,xt]),ea=k.getProgressTotal?k.getProgressTotal(d,tt,xt,pe):k.id==="levels"?Math.min(xt,ra):d.length,ta=ea?Math.min(I+1,ea):0,Mt=Math.max(1,Number(pe.tries??1)),aa=pe.compare??"anchors",na=Math.max(0,Math.min(100,Number(pe.minCorrectness??0))),ut=(pe.considerDependencies??"on")==="on",bt=Math.max(0,Math.min(100,Number(pe.dependencyThreshold??85))),ua=L=>{const W=L.slice();for(let de=W.length-1;de>0;de-=1){const Ee=Math.floor(Math.random()*(de+1));[W[de],W[Ee]]=[W[Ee],W[de]]}return W},Ca=L=>da(L,{treatSimilarCharsAsSame:!0})>=na,St=async()=>{const L=await Yt(),W=new Map,de=new Map;L.forEach(ce=>{const Se=`${ce.itemType}:${ce.itemId}`,o=Vt(ce.itemType,ce.itemId,ce.checkType,ce.direction);W.has(Se)||W.set(Se,[]),W.get(Se).push(ce),de.has(o)||de.set(o,[]),de.get(o).push(ce)});const Ee=new Map,Pe=new Map;return W.forEach((ce,Se)=>Ee.set(Se,Gt(ce).score)),de.forEach((ce,Se)=>Pe.set(Se,Gt(ce).score)),{itemKnowness:Ee,cardKnowness:Pe}},Bt=async L=>{const W=tt,de=L.concat(W.active??[]).concat(W.pool??[]).filter((V,X,D)=>D.findIndex(ae=>me(ae)===me(V))===X);if(!ut){Zt(new Set(de.map(me)));return}const{itemKnowness:Ee,cardKnowness:Pe}=await St(),ce=V=>{if(V.cardType!=="info"||V.infoType!=="citation"||V.checkType!=="quote-fragment")return!0;const X=Dt(V.direction);if(!(X!=null&&X.fragmentId))return!0;const D=V.description??"";if(!D.trim())return!0;const A=fa(D).nodes[X.fragmentId];if(!A||!A.leftId&&!A.rightId)return!0;const Z=[A.leftId,A.rightId].filter(De=>!!De);if(Z.length===0)return!0;const be=Z.map(De=>{const Oe=Vt("info",V.cardId,"quote-fragment",De);return Pe.get(Oe)??0});return be.reduce((De,Oe)=>De+Oe,0)/be.length>=bt},Se=(x==null?void 0:x.collectionId)??null,o=Se?gt.filter(V=>pt(V.childItemType)==="collection"&&V.childItemId===Se&&!pt(V.childCheckType)&&!pt(V.childDirection)):[],f=Se&&de.length>0?de.reduce((V,X)=>V+(Pe.get(me(X))??0),0)/de.length:0,P=new Set;for(const V of de){if(V.cardType!=="info"){P.add(me(V));continue}if(!ce(V))continue;const X=gt.filter(A=>Os(A,V)).concat(o);if(X.length===0){P.add(me(V));continue}let D=0;for(const A of X)if(pt(A.parentItemType)==="collection")D+=A.parentItemId===Se?f:0;else if(pt(A.parentCheckType)||pt(A.parentDirection)){const Z=pt(A.parentCheckType),be=pt(A.parentDirection),Ke=Vt(A.parentItemType,A.parentItemId,Z,be);D+=Pe.get(Ke)??0}else{const Z=`${A.parentItemType}:${A.parentItemId}`;D+=Ee.get(Z)??0}D/X.length>=bt&&P.add(me(V))}Zt(P)},Ka=L=>{for(let W=L;W<d.length;W+=1){const de=d[W];if(de&&(!ut||de.cardType!=="info"||ft.has(me(de))))return W}return-1},ba=L=>!ut||L.cardType!=="info"||ft.has(me(L)),Fa=L=>{if(k.id!=="temporal"&&k.id!=="levels")return null;const W=tt,de=(W.active??[]).concat(W.pool??[]),Ee=new Set;for(const Pe of de){const ce=me(Pe);if(!(Ee.has(ce)||L.has(ce))&&(Ee.add(ce),ba(Pe)))return Pe}return null},Ot=a.useMemo(()=>{if(k.id!=="levels")return null;const L=tt,W=L.pool??[],de=L.active??[],Ee=L.levelMap??{},Pe=Math.max(1,Number(pe.levels??1)),ce=Array.from({length:Pe},()=>0),Se=new Set(de.map(V=>me(V)));W.forEach(V=>{const X=Math.min(Pe,Math.max(1,Ee[me(V)]??1));ce[X-1]+=1});const o=W.length||1,f=ce.map(V=>V/o*100),P=H?Ee[me(H)]??1:null;return{counts:ce,percentages:f,currentLevel:P,levelsCount:Pe,activeCount:de.length,poolCount:W.length,activeSet:Se}},[tt,pe,k,H]),ya=a.useMemo(()=>{if(k.id!=="temporal")return null;const L=tt,W=L.pool??[],de=L.active??[],Ee=L.knownessMap??{},Pe=new Set(L.unknownSet??[]);let ce=0;W.forEach(f=>{(Ee[me(f)]??0)>1&&(ce+=1)});const Se=Pe.size,o=de.map(f=>({id:me(f),value:Pe.has(me(f))?0:Math.max(0,Math.min(1,Ee[me(f)]??0))}));return{knownCount:ce,unknownCount:Se,dots:o}},[tt,k]),on=a.useMemo(()=>{if(!ut)return 0;const L=tt;return d.concat(L.active??[]).concat(L.pool??[]).filter((de,Ee,Pe)=>Pe.findIndex(ce=>me(ce)===me(de))===Ee).filter(de=>de.cardType==="info"&&!ft.has(me(de))).length},[ut,tt,d,ft]);a.useEffect(()=>{if(!ut||O!=="ready")return;const L=tt,de=d.concat(L.active??[]).concat(L.pool??[]).filter((ce,Se,o)=>o.findIndex(f=>me(f)===me(ce))===Se).filter(ce=>ce.cardType!=="info"||ft.has(me(ce))).length,Ee=ze.current;if(ze.current=de,Ee===null||de<=Ee)return;const Pe=de-Ee;we(`New card available (+${Pe})`),Ne.current&&window.clearTimeout(Ne.current),Ne.current=window.setTimeout(()=>we(null),2200)},[ut,O,tt,d,ft]),a.useEffect(()=>()=>{Ne.current&&window.clearTimeout(Ne.current)},[]);const Pt=(L,W)=>{const de=k.applyOutcome({queue:d,meta:tt},H,xt,pe,{correct:L,correctness:W,createdUtc:new Date().toISOString()});ie(de.queue),jt(de.meta);const Ee=de.queue[I+1];Ee&&ja(Ee,I+1)};a.useEffect(()=>{if(!l){v("error");return}v("loading"),yr({shareId:l,key:Fe}).then(L=>{c(L),M(L.collectionName),p(L.libraryName),v("ready")}).catch(()=>{v("error")})},[l,Fe]),a.useEffect(()=>{l&&xr({shareId:l,key:Fe,type:"language"}).then(L=>b(L)).catch(()=>b([]))},[l,Fe]),a.useEffect(()=>{!l||g!=="ready"||vr({shareId:l,key:Fe}).then(L=>Ut(L.items??[])).catch(()=>Ut([]))},[l,Fe,g]),a.useEffect(()=>{if(!l||g!=="ready")return;let L=!0;return(async()=>{C("loading"),z({current:0,total:k.id==="levels"?0:k.getFetchLimit(xt,pe)});try{const de=[];let Ee=null,Pe=null;do{const X=await wr({shareId:l,key:Fe,limit:300,cursor:Ee});if(de.push(...X.items),(k.id==="levels"||k.id==="temporal")&&X.total&&(Pe=X.total),z(D=>({current:de.length,total:D.total||X.total||k.getFetchLimit(xt,pe)})),Ee=X.nextCursor??null,Pe!==null&&de.length>=Pe||k.id!=="levels"&&k.id!=="temporal"&&de.length>=k.getFetchLimit(xt,pe))break}while(Ee);if(!L)return;const ce=Ra(de);let Se;if(k.id==="levels"){const X=Math.max(1,Number(pe.levels??1));Se={},ce.forEach(D=>{const ae=me(D);Se[ae]=Math.max(1,Math.min(X,1))})}let o=null,f=null,P=null;if(k.id==="temporal"){const X=await Yt(),D=new Set(ce.map(Z=>me(Z))),ae=X.reduce((Z,be)=>{const Ke=Vt(be.itemType,be.itemId,be.checkType,be.direction);return D.has(Ke)&&(Z[Ke]||(Z[Ke]=[]),Z[Ke].push(be)),Z},{});o={},f=new Set,P={};const A=Date.now();ce.forEach(Z=>{const be=me(Z),Ke=ae[be]??[];if(Ke.length===0){o[be]=0,f.add(be),P[be]=[];return}const De=Dn(Ke);P[be]=De;const Oe=nn(De,A);o[be]=Oe.knowness})}const V=k.id==="levels"?Bn(ce,xt,pe,Se):k.id==="temporal"?zn(ce,xt,pe,o??{},f??new Set,P??{}):k.prepare(ce,xt,pe);ie(V.queue),jt(V.meta),ue(0),C("ready"),z(X=>({current:Math.min(X.current,X.total),total:X.total}))}catch{L&&C("error")}})(),()=>{L=!1}},[l,Fe,xt,k,pe,g]),a.useEffect(()=>{Bt(d)},[d,gt,ut,bt,x==null?void 0:x.collectionId]),a.useEffect(()=>{if(!H||!ut){vt(!1);return}if(H.cardType!=="info"||ft.has(me(H))){vt(!1);return}const L=Ka(I+1);if(L>=0){vt(!1),ue(L);return}if(k.id==="temporal"||k.id==="levels"){const W=d.slice(0,I+1),de=d.slice(I+1).filter(ba),Ee=W.concat(de),Pe=new Set(Ee.map(me)),ce=Fa(Pe);if(ce){const o=me(ce);Pe.has(o)||(Ee.push(ce),Pe.add(o),jt(f=>{const P=f,V=new Set(P.queued??[]);return V.add(o),{...P,queued:V}}))}const Se=Ee.findIndex((o,f)=>f!==I&&ba(o));if(Se>=0){ie(Ee),ue(Se),vt(!1);return}}vt(!0)},[H,ft,ut,I,d,tt,k.id]),a.useEffect(()=>{if(fe(""),ye(null),oe(null),He(0),ve([]),Ve({}),Le({}),Ze(null),We(null),nt(null),j(!1),Ge(!1),Q(null),xe(null),Ae({}),!H){Ie(null),ee(null);return}H.cardType==="info"&&H.infoType==="computed"&&Ie(t.cogita.library.revision.loadingComputed);let L=!0;return ja(H,I).then(W=>{!L||!W||(Ie(W.prompt),ee(W.expectedAnswer),ve(W.computedExpected),Ve(W.computedAnswers),Ze(W.answerTemplate),We(W.outputVariables),nt(W.variableValues))}),()=>{L=!1}},[H,l,t]),a.useEffect(()=>{if(!H||H.cardType!=="info"||H.infoType!=="citation"){Tt.current=null,It.current=new Set,Te(null);return}const L=H.description??"",W=(H.label??"").trim(),de=W.replace(/\s+/g," ").trim(),Ee=L.replace(/\s+/g," ").trim(),Pe=de&&de!==Ee?W:t.cogita.library.infoTypes.citation;if(!L){Te(null),ee(null);return}const ce=fa(L);Tt.current=ce,Ie(Pe);let Se=!0;return Yt().then(o=>{if(!Se)return;const f=new Map;o.forEach(ae=>{if(ae.itemType!=="info"||ae.checkType!=="quote-fragment"||!ae.direction)return;const A=Dt(ae.direction);if(!A)return;const Z=`${ae.itemId}:${A.fragmentId}`;f.has(Z)||f.set(Z,[]),f.get(Z).push(ae)});const P={},V=new Set;f.forEach((ae,A)=>{const[Z,be]=A.split(":",2);if(Z!==H.cardId)return;const Ke=Gt(ae).score;P[be]=Ke,Ke>=bt&&V.add(be)}),It.current=V,Et.current=P;const X=Dt(H.direction);if(X!=null&&X.fragmentId&&ce.nodes[X.fragmentId]){oa(ce,X.fragmentId,Pe);return}const D=Sa(ce,V,P,bt,ut,H.direction);oa(ce,(D==null?void 0:D.id)??null,Pe)}).catch(()=>{It.current=new Set,Et.current={};const o=Dt(H.direction);if(o!=null&&o.fragmentId&&ce.nodes[o.fragmentId]){oa(ce,o.fragmentId,Pe);return}const f=Sa(ce,It.current,{},bt,ut,H.direction);oa(ce,(f==null?void 0:f.id)??null,Pe)}),()=>{Se=!1}},[H,t,ut,bt]),a.useEffect(()=>{if(!H||H.cardType!=="vocab"||H.checkType!=="translation-match"){xe(null),Ae({});return}const de=(tt.pool??tt.active??d).filter(o=>o.cardType==="vocab"&&o.checkType==="translation-match").filter((o,f,P)=>P.findIndex(V=>V.cardId===o.cardId)===f);de.some(o=>o.cardId===H.cardId)||de.unshift(H);const Pe=ua(de).slice(0,6).map(o=>{const f=o.label.split("↔").map(X=>X.trim()).filter(Boolean);if(f.length<2)return null;const P=`${o.cardId}:L`,V=`${o.cardId}:R`;return{cardId:o.cardId,leftId:P,rightId:V,leftLabel:f[0],rightLabel:f[1]}}).filter(Boolean),ce=Pe.map(o=>o.leftId),Se=ua(Pe.map(o=>o.rightId));xe({pairs:Pe,leftOrder:ce,rightOrder:Se,selection:{},activeLeft:null,activeRight:null,locked:{}})},[H,d,tt]),a.useEffect(()=>()=>{Je.current&&window.clearTimeout(Je.current),R.current&&window.clearTimeout(R.current)},[]);const xa=a.useRef(null);a.useEffect(()=>{if(!H)return;const L=me(H),W=typeof document<"u"?document.activeElement:null;if(xa.current===L&&W&&(W.tagName==="INPUT"||W.tagName==="TEXTAREA"))return;let de=0;const Ee=()=>{if(H){if(H.cardType==="info"&&H.infoType==="computed"){if(G.length>0){const ce=en(qe,G,Re),Se=ce?it.current[ce]:null;if(Se&&(Se.focus(),document.activeElement===Se)){xa.current=L;return}}if(st.current&&(st.current.focus(),document.activeElement===st.current)){xa.current=L;return}}else if(H.cardType==="vocab"&&st.current&&(st.current.focus(),document.activeElement===st.current)){xa.current=L;return}de<6&&(de+=1,window.setTimeout(Ee,40))}},Pe=window.setTimeout(Ee,40);return()=>window.clearTimeout(Pe)},[H,G,qe,Re]),a.useEffect(()=>{if(!yt)return;const L=W=>{W.key==="Enter"&&(W.preventDefault(),$t())};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[yt]);const ia=L=>{te(L),E(Gt(L))};a.useEffect(()=>{if(!H){E(null),te([]);return}const L=H.cardType==="info"?"info":"connection";if(H.cardType==="info"&&H.infoType==="citation"){Yt().then(W=>{const de=W.filter(Ee=>Ee.itemType==="info"&&Ee.itemId===H.cardId&&Ee.checkType==="quote-fragment"&&Xa(Ee.direction,H.direction));ia(de)}).catch(()=>{E(null),te([])});return}Qa(L,H.cardId,H.checkType,H.direction).then(W=>ia(W)).catch(()=>{E(null),te([])})},[H]);const Da=(L,W,de,Ee)=>{if(L==="info"&&de==="quote-fragment"){Yt().then(Pe=>{const ce=Pe.filter(Se=>Se.itemType==="info"&&Se.itemId===W&&Se.checkType==="quote-fragment"&&Xa(Se.direction,Ee));ia(ce)}).catch(()=>{E(null),te([])});return}Qa(L,W,de,Ee).then(Pe=>ia(Pe)).catch(()=>{E(null),te([])})},_t=(L,W,de)=>{var Se;const Ee=((Se=de.pairs.find(o=>o.leftId===L))==null?void 0:Se.rightId)??null;if(!Ee)return de;const Pe=Ee===W;Ae(o=>({...o,[L]:Pe?"correct":"incorrect"})),Je.current&&window.clearTimeout(Je.current),R.current&&window.clearTimeout(R.current),ne.current+=1;const ce={kind:Pe?"correct":"incorrect",tick:ne.current};if(he(null),Je.current=window.setTimeout(()=>he(ce),0),R.current=window.setTimeout(()=>he(null),420),Pe){const o={...de.locked,[L]:!0};return Object.keys(o).length>=de.pairs.length?(ye("correct"),Ge(!0)):ye("correct"),{...de,selection:{...de.selection,[L]:W},activeLeft:null,activeRight:null,locked:o}}return ye("incorrect"),{...de,activeLeft:null,activeRight:null}},va=L=>{xe(W=>!W||W.locked[L]?W:W.activeRight?_t(L,W.activeRight,W):{...W,activeLeft:W.activeLeft===L?null:L})},ln=L=>{xe(W=>W&&(W.activeLeft?_t(W.activeLeft,L,W):{...W,activeRight:W.activeRight===L?null:L}))},$t=()=>{var L;if(H&&H.cardType==="info"&&H.infoType==="citation"&&Tt.current&&$e&&!((L=Dt(H.direction))!=null&&L.fragmentId)){const W=Sa(Tt.current,It.current,Et.current,bt,ut,H.direction,$e.fragmentId);if(W){ye(null),fe(""),j(!1),Le({}),Ge(!1),oe(null),He(0),oa(Tt.current,W.id,$e.title);return}}ye(null),fe(""),j(!1),Le({}),Ge(!1),oe(null),He(0),ue(W=>Math.min(W+1,d.length))},Kt=L=>{if(!H)return;const W=L.expected??null,de=L.answer??"";let Ee=W??"",Pe=de;if(!W&&L.expectedMap&&L.answerMap){const X=Object.keys(L.expectedMap).sort((D,ae)=>D.localeCompare(ae));Ee=X.map(D=>{var ae;return((ae=L.expectedMap)==null?void 0:ae[D])??""}).join("|"),Pe=X.map(D=>{var ae;return((ae=L.answerMap)==null?void 0:ae[D])??""}).join("|")}const ce=Ee?Ta(Ee,Pe,aa):new Uint8Array,Se={revisionType:k.id,evalType:L.evalType,direction:L.direction,prompt:T??"",expected:W,answer:de,expectedAnswers:L.expectedMap??null,answers:L.answerMap??null,correct:L.correct,maskBase64:ce.length?ca(ce):null,checkMode:wt,compareMode:aa,minCorrectness:na},o=new TextEncoder().encode(JSON.stringify(Se)),f=H.cardType==="info"?"info":"connection",P=L.overrideCheckType??H.checkType??null,V=L.overrideDirection??H.direction??null;Ya({itemType:f,itemId:H.cardId,checkType:P,direction:V,revisionType:k.id,evalType:L.evalType,correct:L.correct,maskBase64:ce.length?ca(ce):null,payloadBase64:ca(o)}).then(()=>{Da(f,H.cardId,P,V),Bt(d)}).catch(()=>{})},wa=(L,W)=>{const de=ot.current.get(W);if(de)return Promise.resolve(de);const Ee=dt.current.get(W);if(Ee)return Ee;const Pe=jr({shareCode:l,infoId:L,key:Fe}).then(ce=>{var X,D;const Se=ce.payload,o=((X=Se.definition)==null?void 0:X.graph)??null,f="",P=((D=Se.definition)==null?void 0:D.answerTemplate)??"",V=Ds(o,f,P);if(V){const A={sample:zs(V),answerTemplate:P||null};return ot.current.set(W,A),A}return Wn({shareId:l,infoId:L,key:Fe}).then(ae=>{const A={sample:ae,answerTemplate:null};return ot.current.set(W,A),A})}).catch(()=>Wn({shareId:l,infoId:L,key:Fe}).then(ce=>{const Se={sample:ce,answerTemplate:null};return ot.current.set(W,Se),Se}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{dt.current.delete(W)});return dt.current.set(W,Pe),Pe},ja=(L,W)=>{var o;const de=`${me(L)}:${W}`,Ee=ge.current.get(de);if(Ee)return Promise.resolve(Ee);const Pe=kt.current.get(de);if(Pe)return Pe;const ce=f=>(ge.current.set(de,f),f);let Se;if(L.cardType==="vocab"){if(L.checkType==="translation-match")return Se=Promise.resolve(ce({prompt:L.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),Se;const f=L.label.split("↔").map(P=>P.trim()).filter(Boolean);if(f.length>=2){const V=(L.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",X=V?f[0]:f[1],D=V?f[1]:f[0];Se=Promise.resolve(ce({prompt:X,expectedAnswer:D,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else Se=Promise.resolve(ce({prompt:L.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(L.cardType==="info"&&L.infoType==="word"){const f=(o=L.description)!=null&&o.startsWith("Language: ")?L.description.replace("Language: ",""):null;Se=Promise.resolve(ce({prompt:L.label,expectedAnswer:f,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else L.cardType==="info"&&L.infoType==="computed"?Se=wa(L.cardId,de).then(f=>{var ae,A;if(!f.sample)return ce({prompt:L.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const P=f.sample,V=P.expectedAnswers?Object.entries(P.expectedAnswers).map(([Z,be])=>({key:Z,expected:be})):[],X=V.reduce((Z,be)=>(Z[be.key]="",Z),{}),D=P.expectedAnswerIsSentence&&((ae=P.expectedAnswer)==null?void 0:ae.trim())||null;return ce({prompt:P.prompt,expectedAnswer:V.length>0?D:((A=P.expectedAnswer)==null?void 0:A.trim())||null,computedExpected:V,computedAnswers:X,answerTemplate:f.answerTemplate,outputVariables:P.outputVariables??null,variableValues:P.variableValues??null})}).catch(()=>ce({prompt:L.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{kt.current.delete(de)}):Se=Promise.resolve(ce({prompt:L.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return kt.current.set(de,Se),Se},oa=(L,W,de)=>{const Ee=Object.keys(L.nodes).length,Pe=It.current.size;if(!W){Te({title:de,before:L.text,after:"",fragmentId:null,total:Ee,completed:Pe}),ee(null),Ge(!0);return}const ce=L.nodes[W];if(!ce)return;const Se=Pn(L.text,ce);Te({title:de,before:Se.before,after:Se.after,fragmentId:ce.id,total:Ee,completed:Pe}),ee(Se.fragment),Ge(!1)},cn=()=>{const L=Tt.current;L&&Te(W=>W&&{...W,total:Object.keys(L.nodes).length,completed:It.current.size})},ka=()=>{const L=d[I+1];L&&ja(L,I+1)},ha=()=>{if(ka(),H&&H.cardType==="vocab"&&H.checkType==="translation-match"&&_e){if(_e.pairs.length===0){ye("incorrect"),Ge(!0);return}const ce=_e.pairs.reduce((D,ae)=>(D[ae.rightId]=ae.rightLabel,D),{});let Se=0;const o={};_e.pairs.forEach(D=>{const A=_e.selection[D.leftId]===D.rightId;o[D.leftId]=A?"correct":"incorrect",A&&(Se+=1)});const f=_e.pairs.length||1,P=Se/f,V=Se===_e.pairs.length;Ae(D=>({...D,...o})),V?(ye("correct"),Ge(!0),He(0)):(ye("incorrect"),Ge(!1),He(D=>{const ae=D+1;return ae>=Mt&&(j(!0),Ge(!0),xe(A=>{if(!A)return A;const Z=A.pairs.reduce((be,Ke)=>(be[Ke.leftId]=Ke.rightId,be),{});return{...A,selection:Z}})),ae})),Pt(V,P);const X="connection";Promise.all(_e.pairs.map(D=>{const ae=_e.selection[D.leftId]??null,A=ae?ce[ae]:"",Z={left:D.leftLabel,expected:D.rightLabel,answer:A,checkType:"translation-match"},be=new TextEncoder().encode(JSON.stringify(Z));return Ya({itemType:X,itemId:D.cardId,checkType:"translation-match",direction:null,revisionType:k.id,evalType:"translation-match",correct:ae===D.rightId,maskBase64:null,payloadBase64:ca(be)})})).then(()=>{Da(X,H.cardId,H.checkType,H.direction),Bt(d)}).catch(()=>{});return}if(G.length>0){const ce=G.reduce((o,f)=>{const P=je[f.key]??"";return o[f.key]=Rt(P)===Rt(f.expected)?"correct":"incorrect",o},{});G.every(({key:o,expected:f})=>{const P=je[o]??"";return wt==="exact"&&Rt(P)===Rt(f)})?(ye("correct"),Le(ce),Ge(!0),He(0),Pt(!0,1),Kt({correct:!0,direction:T?`${T} -> computed`:"computed",expectedMap:G.reduce((o,f)=>(o[f.key]=f.expected,o),{}),answerMap:je,evalType:"computed"})):(ye("incorrect"),Le(ce),Ge(!1),He(o=>{const f=o+1;return f>=Mt&&Jt&&(j(!0),Ge(!0)),f}),Pt(!1,0),window.setTimeout(()=>{var f;const o=en(qe,G,Re);o&&it.current[o]&&((f=it.current[o])==null||f.focus())},40),Kt({correct:!1,direction:T?`${T} -> computed`:"computed",expectedMap:G.reduce((o,f)=>(o[f.key]=f.expected,o),{}),answerMap:je,evalType:"computed"}));return}if(H&&H.cardType==="info"&&H.infoType==="citation"&&($e!=null&&$e.fragmentId)){if(!J)return;const ce=Dt(H.direction),Se=(ce==null?void 0:ce.fragmentId)??$e.fragmentId,o=Wa(J,re,{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}),f=o.mask,P=o.isCorrect,V=o.percent;P?(Et.current[$e.fragmentId]=Math.max(Et.current[$e.fragmentId]??0,V),(Et.current[$e.fragmentId]??0)>=bt&&It.current.add($e.fragmentId),cn(),ye("correct"),Le({}),Ge(!0),oe(f),He(0),V<100&&Mt<=1&&j(!0),Pt(!0,V/100),Kt({correct:!0,direction:`quote:${$e.fragmentId}`,expected:J,answer:re,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:Se})):(ye("incorrect"),Le({}),Ge(!1),oe(f),He(X=>{const D=X+1;return D>=Mt&&Jt&&(j(!0),Ge(!0)),D}),Pt(!1,V/100),window.setTimeout(()=>{var X;return(X=st.current)==null?void 0:X.focus()},40),Kt({correct:!1,direction:`quote:${$e.fragmentId}`,expected:J,answer:re,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:Se}));return}if(!J)return;const L=Ta(J,re,aa),W=wt==="exact"&&Rt(re)===Rt(J),de=Ca(L),Ee=W||de,Pe=da(L);Ee?(ye("correct"),Le({}),Ge(!0),oe(L),He(0),Pe<100&&Mt<=1&&j(!0),Pt(!0,Pe/100),Kt({correct:!0,direction:T?`${T} -> ${J}`:null,expected:J,answer:re,evalType:"text"})):(ye("incorrect"),Le({}),Ge(!1),oe(L),He(ce=>{const Se=ce+1;return Se>=Mt&&Jt&&(j(!0),Ge(!0)),Se}),Pt(!1,Pe/100),window.setTimeout(()=>{var ce;return(ce=st.current)==null?void 0:ce.focus()},40),Kt({correct:!1,direction:T?`${T} -> ${J}`:null,expected:J,answer:re,evalType:"text"}))},qt=L=>{if(ka(),!J)return;const W=Ta(J,L,aa),de=Rt(L)===Rt(J),Ee=Ca(W),Pe=de||Ee,ce=da(W);Pe?(ye("correct"),Le({}),Ge(!0),oe(W),He(0),ce<100&&Mt<=1&&j(!0),Pt(!0,ce/100),Kt({correct:!0,direction:"word->language",expected:J,answer:L,evalType:"language-select"})):(ye("incorrect"),Le({}),Ge(!1),oe(W),He(Se=>{const o=Se+1;return o>=Mt&&Jt&&(j(!0),Ge(!0)),o}),Pt(!1,ce/100),Kt({correct:!1,direction:"word->language",expected:J,answer:L,evalType:"language-select"}))},dn=L=>{var de;if(L.key!=="Enter")return;if(L.preventDefault(),L.stopPropagation(),yt){$t();return}const W=G.find(Ee=>!(je[Ee.key]??"").trim());if(W){(de=it.current[W.key])==null||de.focus();return}ha()},Ma=()=>{ka(),ye("correct"),Ge(!0),He(0),Pt(!0,1),J&&Kt({correct:!0,direction:"manual",expected:J,answer:re,evalType:"manual"})},ma=()=>{if(Pt(!1,0),H&&H.cardType==="info"&&H.infoType==="citation"){ye(null),fe(""),j(!1),Le({}),Ge(!1),oe(null),He(0),ue(L=>Math.min(L+1,d.length));return}$t()};a.useEffect(()=>{ka()},[I,d]);const un=t.cogita.library.revision.revealModeAfterIncorrect,Jt=G.length>0||!!J;return e.jsxs(At,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:m,secureMode:u,onNavigate:y,language:N,onLanguageChange:S,children:[(g==="loading"||O==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:g==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${Y.total?Math.min(100,Math.max(0,Y.current/Y.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:Y.total?`${Math.min(Y.current,Y.total)} / ${Y.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:w}),e.jsx("p",{className:"cogita-library-subtitle",children:F}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",Be).replace("{check}",h)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:_?`${_.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ot?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Ot.currentLevel??"-"," / ",Ot.levelsCount]}):null,_?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(_.correct)).replace("{total}",String(_.total))}),_.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(_.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(Bs,{outcomes:U})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[ke?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:ke})}):null,e.jsx(Kn,{feedbackToken:B?`${B.kind}-${B.tick}`:Qe?"idle":Ce??"idle",children:g!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:g==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}):H?e.jsx(e.Fragment,{children:ht?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(Fn,{copy:t,currentCard:H,currentTypeLabel:Lt,prompt:T,languages:K,answer:re,onAnswerChange:L=>fe(W=>Za(W,L,$)),computedExpected:G,computedAnswers:je,onComputedAnswerChange:(L,W)=>Ve(de=>({...de,[L]:Za(de[L]??"",W,$)})),answerTemplate:qe,outputVariables:Re,variableValues:et,computedFieldFeedback:Ue,feedback:Ce,canAdvance:yt,quoteContext:$e,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:ha,onSkip:ma,onLanguageSelect:qt,onMarkReviewed:Ma,onAdvance:$t,showCorrectAnswer:se,setShowCorrectAnswer:j,onRevealCorrect:()=>Ge(!0),answerMask:le,expectedAnswer:J,hasExpectedAnswer:Jt,handleComputedKeyDown:dn,answerInputRef:st,computedInputRefs:it,scriptMode:$,setScriptMode:Q,matchPairs:_e==null?void 0:_e.pairs,matchLeftOrder:_e==null?void 0:_e.leftOrder,matchRightOrder:_e==null?void 0:_e.rightOrder,matchSelection:_e==null?void 0:_e.selection,matchActiveLeft:_e==null?void 0:_e.activeLeft,matchActiveRight:_e==null?void 0:_e.activeRight,matchFeedback:q,onMatchLeftSelect:va,onMatchRightSelect:ln})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ea?`${ta} / ${ea}`:t.cogita.library.revision.progressUnlimited}),g==="error"&&e.jsx("p",{children:t.cogita.library.revision.shareInvalid}),g==="loading"&&e.jsx("p",{children:t.cogita.library.revision.shareLoading}),g==="ready"&&O==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),g==="ready"&&O==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),g==="ready"&&O==="ready"&&d.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:un}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",Mt]})]})]}),Ot?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Ot.activeCount," / ",Ot.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ot.counts.map((L,W)=>{const de=W+1,Ee=Ot.currentLevel===de,Pe=Ot.percentages[W]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":Ee,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:de}),e.jsx("strong",{children:L})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,Pe))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[Pe.toFixed(1),"%"]})]},`level-${de}`)})})]}):null,ya?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ya.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ya.dots.map(L=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-L.value))}, ${Math.round(200*L.value)}, 80, 0.9)`}},L.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ya.knownCount})]})]}):null,ut?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:on})]})}):null]})]})]})})})]})]})}const Fi=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:$i},Symbol.toStringTag,{value:"Module"}));export{Pi as C,Ki as a,Fi as b};
