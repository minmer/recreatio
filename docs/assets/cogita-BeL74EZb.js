import{r,j as e,u as Or,R as pr,B as fr,C as xr,H as Nr,P as Lr,a as $t,b as hi,c as bi,d as _r,e as qr,f as yr}from"./vendor-SpL5bUHi.js";import{L as Ur,A as Wr,g as zr,a as mi,b as jt,c as Hr,s as Cr,d as Jr,e as Ut,f as rt,h as ar,i as it,j as hr,k as pi,u as fi,l as ga,m as xi,p as yi,n as vi,o as Yr,r as Qr,q as wi,t as ji,v as ki,w as Wt,x as Et,y as Ti,z as Ni,B as Li,C as Ci,D as Mi,E as Si,F as Mr,G as Ya,H as Ii,I as Pi,J as Ri,K as $i,M as Ei,N as Ai,O as Fi,P as Bi,Q as Di,R as Ki,S as Vi,T as Oi,U as _i,V as qi,W as Ui,X as Wi,Y as Sr}from"./recreatio-core-CzuC6moy.js";import"./vendor-cogita-ui-BgsFclds.js";const wt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},vt={moveMs:900,pauseMs:220,errorMs:900},zi=(a=11)=>{let n=a;const s=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:u,height:g,paddingX:j,paddingY:x,levels:L}=wt,A=(g-x*2)/(L.length-1),C=[],o=[],I=[];L.forEach((p,f)=>{const ue=g-x-f*A,K=u-j*2,w=[];for(let Z=0;Z<p;Z+=1){const B=j+(Z+1)*K/(p+1),ne=(s()-.5)*18,R=Math.max(j,Math.min(u-j,B+ne)),W=f===0?3:f<2?2.1:1.4,ge=f===0?"root":`l${f}-${Z}`;w.push({id:ge,x:f===0?u/2:R,y:ue,r:W,level:f,role:f===0?"root":void 0})}I.push(w),C.push(...w)});const m=I[I.length-1];if(m!=null&&m.length){const p=m[Math.floor(m.length/2)];p.role="goal",p.r=2}for(let p=1;p<I.length;p+=1){const f=I[p-1];I[p].forEach(K=>{const w=[...f].sort((R,W)=>Math.abs(R.x-K.x)-Math.abs(W.x-K.x)),Z=w[0],B=w[1]&&s()<.45?w[1]:null;(B?[Z,B]:[Z]).forEach(R=>{o.push({from:R.id,to:K.id,key:`${R.id}-${K.id}`})}),s()<.2&&w[2]&&o.push({from:w[2].id,to:K.id,key:`${w[2].id}-${K.id}`})})}const b=new Map;o.forEach(p=>{const f=b.get(p.to)??[];f.push(p.from),b.set(p.to,f)});const q=new Map,Y=new Map,U=new Map;o.forEach(p=>{const f=q.get(p.from)??[];f.push(p.key),q.set(p.from,f);const ue=Y.get(p.from)??[];ue.push(p.to),Y.set(p.from,ue);const K=U.get(p.from)??[];K.push(p.to),U.set(p.from,K);const w=U.get(p.to)??[];w.push(p.from),U.set(p.to,w)});const l=new Map;return C.forEach(p=>{l.set(p.id,p)}),{nodes:C,links:o,parentsById:b,linksByFrom:q,childrenByFrom:Y,neighborsById:U,nodesById:l}};function Hi({slides:a,activeIndex:n,introOpen:s,prefersReducedMotion:u,onNext:g,onPrev:j,onSelect:x,onExit:L,onOpen:A,onRegister:C}){const o=n===a.length-1,I=s&&n===0?"entry":"docked",m=a[a.length-1],[b,q]=r.useState(!1),Y=r.useMemo(()=>Array.from({length:20},(v,T)=>({src:`/cogita/logo/Cogita${String(T).padStart(2,"0")}.png`,kind:T<=11?"bubble":T<=17?"text":"recreatio"})),[]),U=s&&n===0;r.useEffect(()=>{if(!s){q(!1);return}n>0&&!b&&q(!0)},[n,s,b]);const l=r.useRef(0),p=r.useRef(null),f=r.useMemo(()=>{const v={x:40,y:160},T={x:260,y:48},Q=6,t=T.x-v.x,i=v.y-T.y,h=t/Q,N=[.3,.45,.6,.65,1.4,2.2],V=N.reduce((se,we)=>se+we,0),ee=N.map(se=>i*se/V),te=[v];let G=v.x,de=v.y;for(let se=1;se<=Q;se+=1){const we=(Math.random()-.5)*14,aa=(Math.random()-.5)*28;G=Math.max(v.x+se*14,Math.min(T.x-(Q-se)*14,G+h+we));const qe=ee[se-1]??ee[ee.length-1];de=de-qe+aa;const ia=Math.max(T.y,Math.min(v.y-4,de));te.push({x:Math.round(G),y:Math.round(ia)})}return te[te.length-1]=T,te},[]),ue=r.useMemo(()=>{const i=(V,ee,te)=>Math.min(te,Math.max(ee,V)),h=f.map(V=>{const ee=10+Math.random()*36;return{x:i(V.x,40,260),y:i(V.y-ee,40,140)}}),N=f.map((V,ee)=>{var de;const te=12+Math.random()*40,G=((de=h[ee])==null?void 0:de.y)??V.y;return{x:i(V.x,40,260),y:i(Math.max(G+10,V.y+te),60,170)}});return{upper:h,lower:N}},[f]),K=r.useMemo(()=>{var T;const v=((T=f[4])==null?void 0:T.x)??260;return Math.max(0,Math.min(240,v-40))},[f]),w=r.useMemo(()=>{var ee,te;const v=(G,de,se)=>Math.min(se,Math.max(de,G)),T=(G,de,se)=>f.map((we,aa)=>{var Sa,la;const qe=((Sa=ue.upper[aa])==null?void 0:Sa.y)??we.y,ia=((la=ue.lower[aa])==null?void 0:la.y)??we.y,Oe=(Math.random()-.5)*70,We=we.y+G+Oe,Fe=v(we.y+de,qe+6,ia-6),Xe=v(we.y+se,qe+6,ia-6);return{x:we.x,y:v(We,Math.min(Fe,Xe),Math.max(Fe,Xe))}}),Q=-14+Math.random()*28,t=14+Math.random()*28,i=T(Q,-80,12),h=T(t,-12,80);for(let G=4;G<f.length;G+=1){const de=f[G],se=((ee=ue.upper[G])==null?void 0:ee.y)??de.y,we=((te=ue.lower[G])==null?void 0:te.y)??de.y;i[G]={x:de.x,y:v(de.y-12,se+6,we-6)},h[G]={x:de.x,y:v(de.y+12,se+6,we-6)}}const N=ue.upper.length?ue.upper[ue.upper.length-1].y:40,V=ue.lower.length?ue.lower[ue.lower.length-1].y:170;return i[i.length-1]={x:f[f.length-1].x,y:v(f[f.length-1].y-14,N,V)},h[h.length-1]={x:f[f.length-1].x,y:v(f[f.length-1].y+12,N,V)},{higher:i,lower:h}},[f,ue]),Z=1e4,B=r.useMemo(()=>{let v=17;const T=()=>(v=(v*1664525+1013904223)%4294967296,v/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,i)=>{const h=(T()-.5)*240,N=(T()-.5)*180,V=(T()-.5)*24;return{id:`card-${i+1}`,throw:{x:`${h.toFixed(0)}px`,y:`${N.toFixed(0)}px`,rot:`${V.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${i*.12}s`}})},[]),ne=r.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[R,W]=r.useState([]),ge=r.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),me=r.useMemo(()=>{const T=[],t=(h,N)=>h+Math.random()*(N-h);for(let h=0;h<6;h+=1){let N=!1;for(let V=0;V<80;V+=1){const ee=t(14,86),te=t(10,34);if(T.every(de=>{const se=de.x-ee,we=de.y-te;return Math.hypot(se,we)>=12})){T.push({x:ee,y:te}),N=!0;break}}N||T.push({x:t(16,84),y:t(12,32)})}return T.map((h,N)=>({id:`p${N+1}`,x:`${h.x.toFixed(1)}%`,y:`${h.y.toFixed(1)}%`,xNum:h.x,yNum:h.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[he,D]=r.useState(0),[oe,c]=r.useState(0),[ie,ae]=r.useState([]),O=1e4,Ce=r.useMemo(()=>{if(me.length<2)return[];const v=N=>{let V=N+1831565813;return V=Math.imul(V^V>>>15,V|1),V^=V+Math.imul(V^V>>>7,V|61),((V^V>>>14)>>>0)/4294967296},T=(N,V)=>Math.floor(v(N)*V),Q=new Set,t=[],i=Math.min(3,me.length);let h=0;for(;t.length<i&&h<30;){h+=1;const N=T(he*13+h*5,me.length),V=T(he*29+h*7,me.length);if(N===V)continue;const ee=N<V?`${N}-${V}`:`${V}-${N}`;Q.has(ee)||(Q.add(ee),t.push({id:`link-${ee}`,from:me[N],to:me[V],delay:`${(h*.35).toFixed(2)}s`}))}return t},[he,me]);r.useEffect(()=>{if(!s||n!==2)return;const v=()=>{const Q=B.map(t=>t.id);for(let t=Q.length-1;t>0;t-=1){const i=Math.floor(Math.random()*(t+1));[Q[t],Q[i]]=[Q[i],Q[t]]}return Q.slice(0,4)};W(v());const T=window.setInterval(()=>{W(v())},Z);return()=>window.clearInterval(T)},[n,s,B,Z]),r.useEffect(()=>{if(!s||n!==3)return;const v=()=>{c(Math.floor(Math.random()*ge.length)),ae(me.map(()=>Math.random()<.6?"good":"bad")),D(Q=>Q+1)};v();const T=window.setInterval(v,O);return()=>window.clearInterval(T)},[n,s,ge.length,me,O]);const le=r.useMemo(()=>zi(11),[]),[re,Ne]=r.useState(new Set(["root"])),[Ee,Te]=r.useState(new Set),[Ae,Me]=r.useState(new Set),[Je,Ke]=r.useState({fromId:"root",toId:"root",key:0}),$e=r.useRef(re),ze=r.useRef("root"),sa=r.useRef(0),ea=r.useRef(null),k=r.useRef(null),_=r.useRef([]);r.useEffect(()=>{$e.current=re},[re]);const Le=r.useMemo(()=>{const v=new Set;return re.forEach(T=>{const Q=le.linksByFrom.get(T);Q&&Q.forEach(t=>v.add(t))}),v},[re,le]),ke=le.nodesById.get(Je.toId)??le.nodesById.get("root"),pe=ke?`${ke.x/wt.width*100}%`:"50%",Re=ke?`${ke.y/wt.height*100}%`:"90%";r.useEffect(()=>{if(!s||n!==1||u)return;(()=>{Ne(new Set(["root"])),Te(new Set),Me(new Set),Ke({fromId:"root",toId:"root",key:0}),k.current=null,sa.current=0,ze.current="root",_.current=[]})();const T=()=>{const t=ze.current,i=$e.current,N=(le.childrenByFrom.get(t)??[]).filter(we=>!i.has(we));if(N.length)return N[Math.floor(Math.random()*N.length)];if(i.size>=le.nodes.length){const we=le.neighborsById.get(t)??[];return we.length?we[Math.floor(Math.random()*we.length)]:null}const V=we=>(le.childrenByFrom.get(we)??[]).some(qe=>!i.has(qe)),ee=[t],te=new Set([t]),G=new Map;let de=null;for(;ee.length;){const we=ee.shift();if(!we)break;if(we!==t&&V(we)){de=we;break}(le.neighborsById.get(we)??[]).forEach(qe=>{te.has(qe)||(te.add(qe),G.set(qe,we),ee.push(qe))})}if(!de)return null;let se=de;for(;G.get(se)&&G.get(se)!==t;)se=G.get(se)??se;return se},Q=(t,i)=>{if(t===i){const h=T();h&&Q(t,h);return}sa.current+=1,Ke({fromId:t,toId:i,key:sa.current}),ze.current=i,ea.current=window.setTimeout(()=>{const h=le.parentsById.get(i)??[],N=$e.current,V=h.filter(de=>!N.has(de));if(!V.length){const de=new Set(N);de.add(i),Ne(de),ea.current=window.setTimeout(()=>{for(;_.current.length;){const we=_.current[_.current.length-1];if(!de.has(we)){if(we!==i){Q(i,we);return}break}_.current.pop()}const se=T();se&&Q(i,se)},vt.pauseMs);return}const ee=new Set([i,...V]),te=new Set(V.map(de=>`${de}-${i}`));Te(ee),Me(te),_.current.includes(i)||_.current.push(i);const G=V[Math.floor(Math.random()*V.length)];k.current={fromId:i,toId:G},ea.current=window.setTimeout(()=>{Te(new Set),Me(new Set);const de=k.current;de&&Q(de.fromId,de.toId)},vt.errorMs)},vt.moveMs)};return ea.current=window.setTimeout(()=>{const t=T();t&&Q(ze.current,t)},vt.pauseMs),()=>{ea.current&&window.clearTimeout(ea.current)}},[n,s,le,u]);const Ue=v=>{if(!s)return;const T=Date.now();T-l.current<520||Math.abs(v.deltaY)<10||(l.current=T,v.deltaY>0?g():j(),v.preventDefault())},Be=v=>{if(!s)return;const T=v.touches[0];T&&(p.current={x:T.clientX,y:T.clientY})},_e=v=>{if(!s)return;const T=p.current;if(p.current=null,!T)return;const Q=v.changedTouches[0];if(!Q)return;const t=Q.clientX-T.x,i=Q.clientY-T.y;Math.abs(i)<40||Math.abs(i)<Math.abs(t)||(i<0?g():j())};return e.jsxs("div",{className:`cogita-intro ${s?"is-open":"is-closed"} ${u?"is-reduced":""} ${o?"is-final":""}`,"data-slide":n+1,onWheel:Ue,onTouchStart:Be,onTouchEnd:_e,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":I,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${U&&!b?"is-entry":""}`,children:Y.map((v,T)=>e.jsx("img",{src:v.src,alt:"",className:`cogita-logo-layer ${T===0?"is-base":""} ${v.kind==="text"?"is-text":v.kind==="recreatio"?"is-recreatio":""} ${v.kind==="bubble"?"is-bubble":""}`},v.src))})}),s&&a.map((v,T)=>{const Q=T===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${T+1} ${Q?"is-active":""}`,"aria-hidden":!Q,children:[e.jsxs("div",{className:"cogita-intro-text",children:[v.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:v.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:v.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:v.title}),v.body&&e.jsx("p",{children:v.body.split(`
`).map((t,i)=>e.jsxs("span",{children:[t,i===0&&e.jsx("br",{})]},String(i)))})]}),v.micro&&e.jsx("p",{className:"cogita-intro-micro",children:v.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:o?C:g,children:v.cta}),o&&v.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>x(0),children:v.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[T===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${wt.width} ${wt.height}`,preserveAspectRatio:"none",children:[le.links.map(t=>{const i=le.nodesById.get(t.from),h=le.nodesById.get(t.to);if(!i||!h)return null;const N=Le.has(t.key),V=Ae.has(t.key);return e.jsx("line",{className:`map-link ${N?"is-active":""} ${V?"is-error":""}`,x1:i.x,y1:i.y,x2:h.x,y2:h.y},t.key)}),le.nodes.map(t=>{const i=re.has(t.id),h=Ee.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${i?"is-active":""} ${h?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),ke&&e.jsx("span",{className:"map-explorer-dot",style:{left:pe,top:Re,"--move":`${vt.moveMs}ms`}})]}),T===2&&e.jsx("div",{className:"cogita-index-cards",children:B.map(t=>{const i=R.indexOf(t.id),h=i>=0?ne[i]:null,N=(h==null?void 0:h.x)??"140px",V=(h==null?void 0:h.y)??"140px",ee=i>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":N,"--stack-y":V,"--stack-opacity":ee,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),T===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ge.map((t,i)=>e.jsxs("div",{className:`round-card ${i===oe?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),ge[oe]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ge[oe].x,"--card-y":`calc(${ge[oe].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:me.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Ce.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:me.map((t,i)=>{const h=ie[i]??"good",N=ge[oe];if(!N)return null;const V=`calc(${N.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":N.x,"--to-y":V,"--delay":`${i*.12}s`}}),e.jsx("span",{className:`return-dot is-${h}`,style:{"--from-x":N.x,"--from-y":V,"--to-x":t.x,"--to-y":t.y,"--delay":`${i*.12}s`}}),e.jsx("span",{className:`result-pop is-${h}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${i*.12}s`}})]},`${t.id}-${he}`)})})]},`round-${he}`),T===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${f[0].x} ${f[0].y} L${f[1].x} ${f[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${f[1].x} ${f[1].y} L${f[2].x} ${f[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${f[2].x} ${f[2].y} L${f[3].x} ${f[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${f[3].x} ${f[3].y} L${f[4].x} ${f[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${f[4].x} ${f[4].y} L${f[5].x} ${f[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${f[5].x} ${f[5].y} L${f[6].x} ${f[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${K};${K};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${ue.upper.map((t,i)=>`${i===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${ue.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${ue.upper.map((t,i)=>`${i===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${ue.lower.map((t,i)=>`${i===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[w.higher.slice(0,6).map((t,i)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${i+1}`,d:`M${t.x} ${t.y} L${w.higher[i+1].x} ${w.higher[i+1].y}`,pathLength:"100"},`peer-1-${i}`)),w.lower.slice(0,6).map((t,i)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${i+1}`,d:`M${t.x} ${t.y} L${w.lower[i+1].x} ${w.lower[i+1].y}`,pathLength:"100"},`peer-2-${i}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${f[0].x/300*100}%`,"--p0y":`${f[0].y/200*100}%`,"--p1x":`${f[1].x/300*100}%`,"--p1y":`${f[1].y/200*100}%`,"--p2x":`${f[2].x/300*100}%`,"--p2y":`${f[2].y/200*100}%`,"--p3x":`${f[3].x/300*100}%`,"--p3y":`${f[3].y/200*100}%`,"--p4x":`${f[4].x/300*100}%`,"--p4y":`${f[4].y/200*100}%`,"--p5x":`${f[5].x/300*100}%`,"--p5y":`${f[5].y/200*100}%`,"--p6x":`${f[6].x/300*100}%`,"--p6y":`${f[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${w.higher[0].x/300*100}%`,"--q0y":`${w.higher[0].y/200*100}%`,"--q1x":`${w.higher[1].x/300*100}%`,"--q1y":`${w.higher[1].y/200*100}%`,"--q2x":`${w.higher[2].x/300*100}%`,"--q2y":`${w.higher[2].y/200*100}%`,"--q3x":`${w.higher[3].x/300*100}%`,"--q3y":`${w.higher[3].y/200*100}%`,"--q4x":`${w.higher[4].x/300*100}%`,"--q4y":`${w.higher[4].y/200*100}%`,"--q5x":`${w.higher[5].x/300*100}%`,"--q5y":`${w.higher[5].y/200*100}%`,"--q6x":`${w.higher[6].x/300*100}%`,"--q6y":`${w.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${w.lower[0].x/300*100}%`,"--q0y":`${w.lower[0].y/200*100}%`,"--q1x":`${w.lower[1].x/300*100}%`,"--q1y":`${w.lower[1].y/200*100}%`,"--q2x":`${w.lower[2].x/300*100}%`,"--q2y":`${w.lower[2].y/200*100}%`,"--q3x":`${w.lower[3].x/300*100}%`,"--q3y":`${w.lower[3].y/200*100}%`,"--q4x":`${w.lower[4].x/300*100}%`,"--q4y":`${w.lower[4].y/200*100}%`,"--q5x":`${w.lower[5].x/300*100}%`,"--q5y":`${w.lower[5].y/200*100}%`,"--q6x":`${w.lower[6].x/300*100}%`,"--q6y":`${w.lower[6].y/200*100}%`}})]})})}),T===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),T===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},v.id)}),!s&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:m.title}),m.body&&e.jsx("p",{children:m.body}),m.micro&&e.jsx("p",{className:"cogita-intro-micro",children:m.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:C,children:m.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:A,children:"Otwórz pokaz"})]})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((v,T)=>e.jsx("button",{type:"button",className:`dot ${n===T?"active":""}`,"aria-label":v.title,onClick:()=>x(T)},v.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:L,children:"Pomiń"})]})]})}const Ji=6,Yi=4;function Qi({copy:a,onAuthAction:n,authLabel:s,showProfileMenu:u,onProfileNavigate:g,onToggleSecureMode:j,onLogout:x,secureMode:L,onNavigate:A,language:C,onLanguageChange:o}){const I=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}A("home")},m=r.useRef(null),b=r.useRef([]),q=r.useMemo(()=>{let ae=Date.now()%2147483647;const O=()=>(ae=ae*48271%2147483647,ae/2147483647);return Array.from({length:Ji},(Ce,le)=>{const re=6+O()*8,Ne=7+O()*10,Ee=6+O()*9,Te=-O()*re,Ae=-O()*Ne,Me=-O()*Ee,Je=.18+O()*.28,Ke=12+O()*18,$e=4+O()*8,ze=(O()-.5)*3.2,sa=(O()-.5)*3.8,ea=O()>.5?"alternate":"alternate-reverse",k=O()>.5?"alternate":"alternate-reverse",_=O()>.5?"alternate":"alternate-reverse",Le=.18+O()*.42,ke=30+O()*60,pe=-45-O()*38,Re=188+O()*32,Ue=.1+O()*.2;return{id:`wave-${le+1}`,style:{"--wave-sway-duration":`${re}s`,"--wave-scale-duration":`${Ne}s`,"--wave-drift-duration":`${Ee}s`,"--wave-sway-delay":`${Te}s`,"--wave-scale-delay":`${Ae}s`,"--wave-drift-delay":`${Me}s`,"--wave-sway-dir":ea,"--wave-scale-dir":k,"--wave-drift-dir":_,"--wave-scale":`${Je}`,"--wave-shift":`${Ke}%`,"--wave-xshift":`${$e}%`,"--wave-x0":`${ze}%`,"--wave-y0":`${sa}%`,"--wave-opacity":`${Le}`,"--wave-blur":`${ke}px`,"--wave-bottom":`${pe}%`,"--wave-hue":`${Re}`,"--wave-glow":`${Ue}`}}})},[]),Y=r.useMemo(()=>{let ae=Date.now()*3%2147483647;const O=()=>(ae=ae*48271%2147483647,ae/2147483647);return Array.from({length:Yi},(Ce,le)=>{const re=180+O()*220,Ne=220+O()*280,Ee=-O()*re,Te=-O()*Ne,Ae=.12+O()*.22,Me=3+O()*7,Je=1+O()*3,Ke=(O()-.5)*2.8,$e=(O()-.5)*2.2;return{id:`mesh-${le+1}`,seed:1e3+le*991+Math.floor(O()*999),style:{"--mesh-sway-duration":`${re}s`,"--mesh-drift-duration":`${Ne}s`,"--mesh-sway-delay":`${Ee}s`,"--mesh-drift-delay":`${Te}s`,"--mesh-scale":`${Ae}`,"--mesh-shift":`${Me}%`,"--mesh-xshift":`${Je}%`,"--mesh-x0":`${$e}%`,"--mesh-y0":`${Ke}%`}}})},[]),U=r.useMemo(()=>{const ae=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],O=a.cogita.introSlides,Ce=new Map(O.map(le=>[le.id,le]));return ae.map(le=>{var Ne;const re=Ce.get(le.id);return{...le,...re,title:(re==null?void 0:re.title)??"Cogita",cta:(re==null?void 0:re.cta)??((Ne=a.cogita.introSlides[0])==null?void 0:Ne.cta)??a.cogita.loginCta,secondary:re==null?void 0:re.secondary}})},[a.cogita.introSlides]),[l,p]=r.useState(0),[f,ue]=r.useState(!0),[K,w]=r.useState(!1),Z=U.length-1,B=r.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ne=r.useCallback(()=>{B(),n()},[B,n]),R=r.useCallback(()=>{ue(!0),p(0)},[]),W=r.useCallback(()=>{ue(!1),p(Z)},[Z]),ge=r.useCallback(ae=>{p(Math.max(0,Math.min(Z,ae)))},[Z]),me=r.useCallback(()=>{l>=Z?ne():ge(l+1)},[l,ge,ne,Z]),he=r.useCallback(()=>{ge(l-1)},[l,ge]);r.useEffect(()=>{var Ce;const ae=(Ce=window.matchMedia)==null?void 0:Ce.call(window,"(prefers-reduced-motion: reduce)");if(!ae)return;const O=()=>w(ae.matches);return O(),ae.addEventListener?(ae.addEventListener("change",O),()=>ae.removeEventListener("change",O)):(ae.addListener(O),()=>ae.removeListener(O))},[]),r.useEffect(()=>{if(!f)return;const ae=O=>{const Ce=O.target;if(!Ce)return;const le=Ce.tagName;if(!(Ce.isContentEditable||le==="INPUT"||le==="TEXTAREA"||le==="SELECT"||le==="BUTTON"||le==="A"||Ce.closest('button, a, [role="button"], [role="link"]'))){if(O.key==="Escape"){W();return}if(O.key==="ArrowLeft"||O.key==="ArrowUp"){he();return}(O.key==="ArrowRight"||O.key==="ArrowDown"||O.code==="Space"||O.key===" ")&&(O.preventDefault(),me())}};return window.addEventListener("keydown",ae),()=>window.removeEventListener("keydown",ae)},[W,me,he,f]),r.useEffect(()=>{f&&l===Z&&B()},[l,f,Z,B]),r.useEffect(()=>{const ae=m.current;if(!ae)return;const O=b.current.filter(pe=>!!pe);if(!O.length)return;const Ce=1,le=.6,re=.6,Ne=Math.max(1,Math.min(Ce,window.devicePixelRatio||1));let Ee=0,Te=0,Ae=le,Me=0,Je=0;const Ke=pe=>{let Re=pe%2147483647;return Re<=0&&(Re+=2147483646),(Ue,Be)=>{Re=Re*48271%2147483647;const _e=Re/2147483647;return Ue+_e*(Be-Ue)}},$e={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},ze=pe=>{const Re=Math.sin(pe*12.9898)*43758.5453;return Re-Math.floor(Re)},sa=pe=>{const Re=ze(pe+.1)||1e-4,Ue=ze(pe+.7)||1e-4;return Math.sqrt(-2*Math.log(Re))*Math.cos(2*Math.PI*Ue)},ea=(pe,Re)=>{const Ue=Math.floor(pe),Be=Ue+1,_e=pe-Ue,v=_e*_e*(3-2*_e),T=ze(Ue*12.9898+Re*78.233),Q=ze(Be*12.9898+Re*78.233);return T+(Q-T)*v},k=pe=>{const Re=Ke(pe),Ue=Math.min(4,Math.max(4,Math.floor(Ee/1200*$e.filamentCount)));return Array.from({length:Ue},(Be,_e)=>{const v=Math.max(-1,Math.min(1,sa(pe+_e*.37))),T=Math.min(1,Math.max(0,ze(pe+_e*1.31))),Q=Math.min($e.depthLayers-1,Math.floor(T*$e.depthLayers));return{seed:Re(0,Math.PI*2)+pe*.01,offset:v,freqA:$e.freq1*(.75+Re(0,.5)),freqB:$e.freq2*(.75+Re(0,.5)),ampA:$e.amp1*(.6+Re(0,.7)),ampB:$e.amp2*(.6+Re(0,.7)),width:2+_e%5*.32,depth:T,layer:Q}})},_=(pe,Re,Ue)=>{const Be=Math.max(30,Math.floor(Ee*Te/14e4));pe.save(),pe.globalAlpha=.6;for(let _e=0;_e<Be;_e+=1){const v=ze(_e*9.1+Ee*.11)*Re+Ue,T=ze(_e*3.7+Te*.23)*Te,Q=1.2+ze(_e*5.9)*2.4,t=pe.createRadialGradient(v,T,0,v,T,Q*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),pe.fillStyle=t,pe.beginPath(),pe.arc(v,T,Q*2,0,Math.PI*2),pe.fill()}pe.restore()},Le=(pe,Re)=>{pe.clearRect(0,0,Ee,Te);const Ue=Te*$e.waveCenter,Be=$e.waveBandPx,_e=$e.segments,v=$e.colors.filaments,T=Me||Ee,Q=0;_(pe,T,Q),pe.strokeStyle=v,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<Re.length;t+=1){const i=Re[t],h=i.offset*Be*(.85+ze(i.seed)*.4),N=1-Math.min(1,Math.abs(h)/Be),V=Math.exp(-Math.pow(h/$e.crestThickness,2)),ee=i.layer===0?1.1:i.layer===1?.85:.6,te=.35+(1-i.depth)*.65,G=N*te*ee*(.34+V*.45);pe.globalAlpha=G,pe.lineWidth=i.width*(1+(1-i.depth)*.8);const de=[];for(let we=0;we<=_e;we+=1){const aa=we/_e*T+Q,qe=(ea(aa*.012,i.seed)-.5)*$e.xJitter,ia=aa+qe,Oe=(ea(ia*i.freqA,i.seed)-.5)*$e.jitterA,We=(ea(ia*i.freqB,i.seed*1.7)-.5)*$e.jitterB,Fe=Ue+Math.sin(ia*i.freqA+i.seed)*i.ampA+Math.sin(ia*i.freqB+i.seed*1.3)*i.ampB+h+Oe+We;de.push({x:ia,y:Fe})}pe.beginPath(),pe.moveTo(de[0].x,de[0].y);for(let we=1;we<de.length-1;we+=1){const aa=(de[we].x+de[we+1].x)/2,qe=(de[we].y+de[we+1].y)/2;pe.quadraticCurveTo(de[we].x,de[we].y,aa,qe)}const se=de[de.length-1];pe.quadraticCurveTo(se.x,se.y,se.x,se.y),pe.stroke()}pe.save(),pe.globalCompositeOperation="lighter",pe.strokeStyle=$e.colors.glow,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<Re.length;t+=1){const i=Re[t];if(Math.abs(i.offset)*Be>$e.crestThickness)continue;const h=$e.glowAlpha*(.7+(1-i.depth)*.6);pe.globalAlpha=h,pe.lineWidth=1.6+(1-i.depth)*1.2;const N=[];for(let ee=0;ee<=_e;ee+=1){const te=ee/_e*T+Q,G=Math.sin(te*.02+i.seed)*3,de=Ue+Math.sin(te*i.freqA+i.seed)*i.ampA+Math.sin(te*i.freqB+i.seed*1.3)*i.ampB+i.offset*Be*.35+G;N.push({x:te,y:de})}pe.beginPath(),pe.moveTo(N[0].x,N[0].y);for(let ee=1;ee<N.length-1;ee+=1){const te=(N[ee].x+N[ee+1].x)/2,G=(N[ee].y+N[ee+1].y)/2;pe.quadraticCurveTo(N[ee].x,N[ee].y,te,G)}const V=N[N.length-1];pe.quadraticCurveTo(V.x,V.y,V.x,V.y),pe.stroke()}pe.restore()},ke=()=>{Ee=Math.floor(ae.clientWidth),Te=Math.floor(ae.clientHeight),Me=Math.floor(Ee*1.8),Je=Te,Ae=Ee<820?re:le,O.forEach(pe=>{const Re=pe.getContext("2d");if(!Re)return;pe.width=Math.floor(Me*Ne*Ae),pe.height=Math.floor(Je*Ne*Ae),pe.style.width=`${Me}px`,pe.style.height=`${Je}px`,pe.style.left=`${-(Me-Ee)/2}px`,Re.setTransform(Ne*Ae,0,0,Ne*Ae,0,0);const Ue=Number(pe.dataset.seed||1),Be=k(Ue);Le(Re,Be)})};return ke(),window.addEventListener("resize",ke,{passive:!0}),()=>window.removeEventListener("resize",ke)},[Y]);const D=U[Math.min(l,U.length-1)],oe=f?D:U[U.length-1],c=(oe==null?void 0:oe.theme)??U[0].theme,ie={"--cogita-bg0":c.bg0,"--cogita-bg1":c.bg1,"--cogita-bg2":c.bg2,"--cogita-bloom":c.bloom,"--cogita-sat":c.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:I,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Ur,{value:C,onChange:o}),e.jsx(Wr,{copy:a,label:s,isAuthenticated:u,secureMode:L,onLogin:n,onProfileNavigate:g,onToggleSecureMode:j,onLogout:x,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:m,className:"cogita-section cogita-home",style:ie,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[Y.map((ae,O)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:ae.style,"data-seed":ae.seed,ref:Ce=>{b.current[O]=Ce}},ae.id)),q.map(ae=>e.jsx("div",{className:"cogita-home-wave",style:ae.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},ae.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Hi,{slides:U,activeIndex:l,introOpen:f,prefersReducedMotion:K,onNext:me,onPrev:he,onSelect:ge,onExit:W,onOpen:R,onRegister:ne})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Gn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Qi},Symbol.toStringTag,{value:"Module"})),Gr=r.createContext(!1);function Na({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:o}){if(r.useContext(Gr))return e.jsx(e.Fragment,{children:o});const m=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}L("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:m,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Ur,{value:A,onChange:C}),e.jsx(Wr,{copy:a,label:n,isAuthenticated:s,secureMode:x,onLogin:()=>L("home"),onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:o}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function qa(a){const[n,s]=r.useState("Cogita library"),[u,g]=r.useState(null);return r.useEffect(()=>{let j=!1;return zr().then(x=>{if(j)return;const L=x.find(A=>A.libraryId===a);L&&s(L.name)}).catch(()=>{j||s("Cogita library")}),()=>{j=!0}},[a]),r.useEffect(()=>{let j=!1;return mi(a).then(x=>{j||g(x)}).catch(()=>{j||g(null)}),()=>{j=!0}},[a]),{libraryName:n,stats:u}}function Ir({slices:a}){const n=a.reduce((u,g)=>u+Math.max(0,g.value),0),s=r.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let u=0;return`conic-gradient(${a.map(j=>{const L=Math.max(0,j.value)/n*360,A=u,C=u+L;return u=C,`${j.color} ${A}deg ${C}deg`}).join(",")})`},[a,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:s}}),e.jsx("div",{className:"cogita-overview-legend",children:a.map(u=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:u.color}}),e.jsx("strong",{children:u.value}),e.jsx("small",{children:u.label})]},u.label))})]})}function Gi({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o}){const{libraryName:I,stats:m}=qa(o),[b,q]=r.useState("infos"),[Y,U]=r.useState(0),[l,p]=r.useState(0),[f,ue]=r.useState(0),K=(m==null?void 0:m.totalInfos)??0,w=(m==null?void 0:m.totalCollections)??0,Z=0,B=0,ne=0,R=Math.max(0,K-ne-l),W=Math.max(0,K-l-f);r.useEffect(()=>{let me=!1;return(async()=>{try{const D=await jt({libraryId:o,limit:200}),oe=await Promise.all(D.items.map(c=>Hr({libraryId:o,collectionId:c.collectionId}).catch(()=>[])));if(me)return;U(oe.reduce((c,ie)=>c+ie.length,0))}catch{me||U(0)}})(),()=>{me=!0}},[o]),r.useEffect(()=>{let me=!1;return(async()=>{try{const[D,oe,c]=await Promise.all([Cr({libraryId:o,type:"computed",limit:1}).catch(()=>({total:0})),Cr({libraryId:o,type:"source",limit:1}).catch(()=>({total:0})),Jr({libraryId:o}).catch(()=>({items:[]}))]);if(me)return;p((D.total??0)+(oe.total??0));const ie=new Set(c.items.filter(ae=>ae.childItemType.toLowerCase()==="info").map(ae=>ae.childItemId).filter(Boolean));ue(ie.size)}catch{me||(p(0),ue(0))}})(),()=>{me=!0}},[o]);const ge=[{key:"infos",label:a.cogita.library.overview.stats.totalInfos,value:K},{key:"collections",label:a.cogita.library.overview.stats.collections,value:w},{key:"revisions",label:a.cogita.library.overview.stats.revisions,value:Y},{key:"storyboards",label:a.cogita.library.overview.stats.storyboards,value:Z},{key:"texts",label:a.cogita.library.overview.stats.texts,value:B}];return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:I})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ge.map(me=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${b===me.key?"active":""}`,onClick:()=>q(me.key),children:[e.jsx("span",{children:me.label}),e.jsx("strong",{children:me.value})]},me.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:a.cogita.library.overview.statsCardTitle})}),b==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.knownChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.known,value:ne,color:"#75d79a"},{label:a.cogita.library.overview.unknown,value:R,color:"#85b9ff"},{label:a.cogita.library.overview.excluded,value:l,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.checksChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.availableChecks,value:f,color:"#75d79a"},{label:a.cogita.library.overview.unavailableChecks,value:W,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:a.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]})]})})]})})}const Ge=(a,n)=>{const s=a.cogita.library.infoTypes;return{any:s.any,vocab:s.vocab,language:s.language,word:s.word,sentence:s.sentence,topic:s.topic,collection:s.collection,person:s.person,institution:s.institution,collective:s.collective,orcid:s.orcid,address:s.address,email:s.email,phone:s.phone,media:s.media,work:s.work,geo:s.geo,music_piece:s.musicPiece,music_fragment:s.musicFragment,source:s.source,quote:s.quote,computed:s.computed}[n]??String(n)},Xr=a=>[{value:"any",label:Ge(a,"any")},{value:"language",label:Ge(a,"language")},{value:"word",label:Ge(a,"word")},{value:"sentence",label:Ge(a,"sentence")},{value:"topic",label:Ge(a,"topic")},{value:"collection",label:Ge(a,"collection")},{value:"person",label:Ge(a,"person")},{value:"institution",label:Ge(a,"institution")},{value:"collective",label:Ge(a,"collective")},{value:"orcid",label:Ge(a,"orcid")},{value:"address",label:Ge(a,"address")},{value:"email",label:Ge(a,"email")},{value:"phone",label:Ge(a,"phone")},{value:"media",label:Ge(a,"media")},{value:"work",label:Ge(a,"work")},{value:"geo",label:Ge(a,"geo")},{value:"music_piece",label:Ge(a,"music_piece")},{value:"music_fragment",label:Ge(a,"music_fragment")},{value:"source",label:Ge(a,"source")},{value:"quote",label:Ge(a,"quote")},{value:"computed",label:Ge(a,"computed")}],Xi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Zi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],tr=60,en=500,an={computed:(a,n)=>n?a.label.toLowerCase().includes(n)||a.label.includes(`{${n}}`):!0};function Zr(a){return`cogita.info-selection:${a}`}function Pr(a){if(typeof window>"u")return{};const n=window.localStorage.getItem(Zr(a));if(!n)return{};try{const s=JSON.parse(n);return!s||typeof s!="object"?{}:s}catch{return{}}}function tn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o,mode:I}){var ea;const m=Or(),b=a.cogita.library.list,[q,Y]=r.useState("any"),[U,l]=r.useState(""),[p,f]=r.useState(""),[ue,K]=r.useState("relevance"),[w,Z]=r.useState("details"),[B,ne]=r.useState("idle"),[R,W]=r.useState([]),[ge,me]=r.useState(tr),[he,D]=r.useState(null),[oe,c]=r.useState(()=>Pr(o)),ie=r.useMemo(()=>Xr(a),[a]),ae=r.useMemo(()=>[{value:"relevance",label:b.sortRelevance},{value:"label_asc",label:b.sortLabelAsc},{value:"label_desc",label:b.sortLabelDesc},{value:"type_asc",label:b.sortTypeAsc},{value:"type_desc",label:b.sortTypeDesc}],[b.sortLabelAsc,b.sortLabelDesc,b.sortRelevance,b.sortTypeAsc,b.sortTypeDesc]);r.useEffect(()=>{c(Pr(o))},[o]),r.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Zr(o),JSON.stringify(oe))},[o,oe]),r.useEffect(()=>{ne("loading");const k=window.setTimeout(()=>{Ut({libraryId:o,type:q==="any"?void 0:q,query:U.trim()||void 0,limit:en}).then(_=>{W(_),ne("ready")}).catch(()=>{W([]),ne("ready")})},240);return()=>window.clearTimeout(k)},[o,U,q]);const O=p.trim().toLowerCase(),Ce=r.useMemo(()=>{if(q==="any"||!O)return R;const k=an[q];return k?R.filter(_=>k(_,O)):R.filter(_=>_.label.toLowerCase().includes(O))},[O,R,q]),le=r.useMemo(()=>{const k=Ce.slice(),_=Le=>Ge(a,Le);return ue==="relevance"?k:ue==="label_asc"?k.sort((Le,ke)=>Le.label.localeCompare(ke.label)):ue==="label_desc"?k.sort((Le,ke)=>ke.label.localeCompare(Le.label)):ue==="type_asc"?k.sort((Le,ke)=>Le.infoType===ke.infoType?Le.label.localeCompare(ke.label):_(Le.infoType).localeCompare(_(ke.infoType))):k.sort((Le,ke)=>Le.infoType===ke.infoType?Le.label.localeCompare(ke.label):_(ke.infoType).localeCompare(_(Le.infoType)))},[Ce,a,ue]),re=r.useMemo(()=>le.slice(0,ge),[le,ge]),Ne=re.length<le.length,Ee=r.useMemo(()=>new Set(Object.keys(oe)),[oe]),Te=r.useMemo(()=>Object.values(oe),[oe]);r.useEffect(()=>{me(tr);const k=new Set(R.map(_=>_.infoId));D(_=>_&&k.has(_)?_:null)},[R]);const Ae=k=>{c(_=>({..._,[k.infoId]:{infoId:k.infoId,infoType:k.infoType,label:k.label}}))},Me=k=>{c(_=>{if(!_[k])return _;const Le={..._};return delete Le[k],Le})},Je=(k,_)=>{if(_){Ae(k);return}Me(k.infoId)},Ke=k=>{m(`/cogita/library/${o}/list?infoId=${encodeURIComponent(k)}&infoView=overview`,{replace:!0})},$e=Te.length===1?((ea=Te[0])==null?void 0:ea.infoId)??null:null,ze=b.selectionCount.replace("{count}",String(Te.length)),sa=I==="collection"?"grid":I==="detail"?"wide":w;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":sa,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-pane cogita-library-pane--full",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":b.typeLabel,value:q,onChange:k=>Y(k.target.value),children:ie.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))}),e.jsx("input",{type:"text",value:U,onChange:k=>l(k.target.value),placeholder:b.searchPlaceholder}),q!=="any"?e.jsx("input",{type:"text",value:p,onChange:k=>f(k.target.value),placeholder:`${b.constraintPlaceholder} (${Ge(a,q)})`,"aria-label":b.constraintLabel}):null,e.jsx("select",{"aria-label":b.sortLabel,value:ue,onChange:k=>K(k.target.value),children:ae.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))}),e.jsxs("select",{"aria-label":b.viewLabel,value:w,onChange:k=>Z(k.target.value),children:[e.jsx("option",{value:"details",children:b.viewDetails}),e.jsx("option",{value:"wide",children:b.viewWide}),e.jsx("option",{value:"grid",children:b.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:b.cardCount.replace("{shown}",String(re.length)).replace("{total}",String(le.length))}),e.jsx("span",{children:B==="loading"?b.loading:b.ready})]}),e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:ze}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{c(k=>{const _={...k};for(const Le of re)_[Le.infoId]={infoId:Le.infoId,infoType:Le.infoType,label:Le.label};return _})},disabled:re.length===0,children:b.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>c({}),disabled:Te.length===0,children:b.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>$e&&Ke($e),disabled:!$e,title:$e?void 0:b.openSelectedDisabled,children:b.openSelected})]})]}),e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:b.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:b.selectedStackHint}),e.jsx("div",{className:"cogita-selection-stack-items",children:Te.length?Te.map(k=>e.jsxs("div",{className:"cogita-selection-stack-item",children:[e.jsxs("button",{type:"button",className:"cogita-tag-chip",onClick:()=>Ke(k.infoId),children:[e.jsx("span",{children:k.label}),e.jsx("span",{className:"cogita-tag-count",children:Ge(a,k.infoType)})]}),e.jsx("button",{type:"button",className:"ghost cogita-selection-remove",onClick:()=>Me(k.infoId),"aria-label":b.removeFromStack,children:"×"})]},`stack:${k.infoId}`)):e.jsx("p",{className:"cogita-tag-empty",children:b.selectedEmpty})})]}),e.jsx("div",{className:`cogita-card-list cogita-card-list--${sa}`,"data-view":sa,children:re.length?re.map(k=>{const _=Ge(a,k.infoType),Le=Ee.has(k.infoId),ke=he===k.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":ke||Le,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:Le,onChange:pe=>Je(k,pe.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>D(k.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:_}),e.jsx("h3",{className:"cogita-card-title",children:k.label}),e.jsx("p",{className:"cogita-card-subtitle",children:k.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Ke(k.infoId),children:b.editInfo})]})},k.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:b.noMatch})})}),Ne?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>me(k=>k+tr),children:b.loadMore})}):null]})})})})})}const tt=5,Rr=50,$r=2,Er=[];function Ye({libraryId:a,infoType:n,label:s,placeholder:u,value:g,onChange:j,values:x,onChangeMultiple:L,helperText:A,searchFailedText:C,createFailedText:o,createLabel:I,savingLabel:m,loadMoreLabel:b,inputRef:q,autoAdvance:Y,onCommit:U,multiple:l}){const p=l?x??Er:Er,[f,ue]=r.useState(l?"":(g==null?void 0:g.label)??""),[K,w]=r.useState([]),[Z,B]=r.useState(tt),[ne,R]=r.useState(-1),[W,ge]=r.useState(!1),[me,he]=r.useState(!1),[D,oe]=r.useState(null),c=r.useRef(0),ie=r.useRef(new Map),ae=r.useMemo(()=>l?f.trim().length>0:f.trim().length>0&&!g,[f,g,l]);r.useEffect(()=>{l||ue((g==null?void 0:g.label)??"")},[g,l]),r.useEffect(()=>{const le=f.trim();if(!le||le.length<$r){w([]),ge(!1),B(tt),R(-1),he(!1),oe(null);return}const re=le.toLowerCase(),Ne=`${a}:${n}:${re}`,Ee=ie.current.get(Ne);if(Ee){if(l&&p.length>0){const Ae=new Set(p.map(Me=>Me.id));w(Ee.filter(Me=>!Ae.has(Me.id)))}else w(Ee);B(tt),R(-1),ge(Ee.length>0),he(!1),oe(null);return}const Te=window.setTimeout(async()=>{const Ae=Date.now();c.current=Ae,he(!0),oe(null);try{const Me=await Ut({libraryId:a,type:n,query:le,limit:Rr});if(c.current!==Ae)return;const Je=Me.slice(0,Rr).map(Ke=>({id:Ke.infoId,label:Ke.label,infoType:Ke.infoType}));if(ie.current.set(Ne,Je),l&&p.length>0){const Ke=new Set(p.map($e=>$e.id));w(Je.filter($e=>!Ke.has($e.id)))}else w(Je);B(tt),R(-1),ge(!0)}catch{if(c.current!==Ae)return;oe(C??"Search failed.")}finally{c.current===Ae&&he(!1)}},250);return()=>window.clearTimeout(Te)},[a,n,f,p]);const O=le=>{if(l){const re=p.some(Ne=>Ne.id===le.id)?p:[...p,le];L==null||L(re),ue(""),ge(!1),R(-1);return}j==null||j(le),ue(le.label),ge(!1),R(-1),Y&&(U==null||U())},Ce=async()=>{const le=f.trim();if(le){he(!0),oe(null);try{const re=await rt({libraryId:a,infoType:n,payload:{label:le}}),Ne={id:re.infoId,label:le,infoType:re.infoType};if(le.length>=$r){const Ee=`${a}:${n}:${le.toLowerCase()}`,Te=ie.current.get(Ee)??[];ie.current.set(Ee,[Ne,...Te])}if(l){L==null||L([...p,Ne]),ue(""),ge(!1),R(-1);return}j==null||j(Ne),ge(!1),R(-1),Y&&(U==null||U())}catch{oe(o??"Create failed.")}finally{he(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:s}),e.jsx("input",{value:f,placeholder:u,onChange:le=>{ue(le.target.value),!l&&g&&(j==null||j(null))},onKeyDown:le=>{if(le.key==="ArrowDown"){if(le.preventDefault(),!K.length)return;ge(!0),R(re=>{const Ne=Math.min(K.length,Z)-1,Ee=re<0?0:Math.min(re+1,Ne);return Ee===Ne&&K.length>Z?(B(Te=>Math.min(Te+tt,K.length)),Math.min(re+1,Math.min(K.length,Z+tt)-1)):Ee});return}if(le.key==="ArrowUp"){if(le.preventDefault(),!K.length)return;ge(!0),R(re=>re<=0?0:re-1);return}if(le.key==="Enter"){if(le.preventDefault(),ne>=0&&K[ne]){O(K[ne]);return}if(ae){Ce();return}}},onFocus:()=>{K.length>0&&ge(!0)},autoComplete:"off",ref:q})]}),l&&p.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:p.map(le=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>L==null?void 0:L(p.filter(re=>re.id!==le.id)),children:[le.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},le.id))}),A&&e.jsx("p",{className:"cogita-help",children:A}),D&&e.jsx("p",{className:"cogita-error",children:D}),W&&K.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[K.slice(0,Z).map((le,re)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":re===ne,onClick:()=>O(le),children:[e.jsx("strong",{children:le.label}),e.jsx("span",{children:le.infoType})]},le.id)),Z<K.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>B(le=>Math.min(le+tt,K.length)),children:b??"Load more"})]}),ae&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Ce,disabled:me,children:me?m??"Saving...":I??`Create new ${n}`})]})}const At=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Ar=8;function Fr({libraryId:a,copy:n,language:s,sourceKindOptions:u,value:g,onChange:j,labels:x}){const[L,A]=r.useState(!1),[C,o]=r.useState(-1),I=r.useMemo(()=>{const Y=s;return At.map(U=>{var f;const l=(U==null?void 0:U[Y])??(U==null?void 0:U.en)??(U==null?void 0:U.la);return{label:`${l.abbr} — ${l.name}`,latin:((f=U==null?void 0:U.la)==null?void 0:f.abbr)??l.abbr}})},[s]),m=(Y,U=!1)=>{const l=Y.trim().toLowerCase();return l?I.filter(p=>p.label.toLowerCase().includes(l)).slice(0,Ar):U?I.slice(0,Ar):[]},b=(Y,U)=>{const l=Y.trim().toLowerCase();if(!l)return null;const p=At;for(const f of p){const ue=f==null?void 0:f.la,K=(f==null?void 0:f[U])??(f==null?void 0:f.en)??ue,w=(K==null?void 0:K.abbr)??"",Z=(K==null?void 0:K.name)??"";if(w.toLowerCase()===l||Z.toLowerCase()===l||`${w} — ${Z}`.toLowerCase()===l)return{book:f,entry:K,la:ue}}return null};r.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!L){const Y=b(g.locatorValue,s);if(Y){const U=`${Y.entry.abbr} — ${Y.entry.name}`;U!==g.bibleBookDisplay&&j({...g,bibleBookDisplay:U})}}},[s,g,L,j]);const q=Y=>j({...g,...Y});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:Y=>q({sourceKind:Y.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:u.map(Y=>e.jsx("option",{value:Y.value,children:Y.label},Y.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:Y=>{const U=Y.target.value;q({bibleBookDisplay:U,locatorValue:""}),A(!0),o(-1)},onKeyDown:Y=>{var l;const U=m(g.bibleBookDisplay);if(U.length){if(Y.key==="ArrowDown")Y.preventDefault(),o(p=>Math.min(p+1,U.length-1));else if(Y.key==="ArrowUp")Y.preventDefault(),o(p=>Math.max(p-1,0));else if((Y.key==="Enter"||Y.key==="Tab")&&C>=0&&U[C]){const p=U[C],f=b(p.label,s);if(!f)return;q({bibleBookDisplay:p.label,locatorValue:((l=f.la)==null?void 0:l.abbr)??g.locatorValue}),A(!1)}}},onFocus:()=>A(!0),onBlur:()=>window.setTimeout(()=>A(!1),100),placeholder:x.bibleBookPlaceholder})]}),L&&m(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:m(g.bibleBookDisplay,!0).map((Y,U)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":U===C,tabIndex:-1,onMouseDown:()=>{var p;const l=b(Y.label,s);l&&q({bibleBookDisplay:Y.label,locatorValue:((p=l.la)==null?void 0:p.abbr)??g.locatorValue})},children:e.jsx("strong",{children:Y.label})},Y.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:Y=>q({locatorAux:Y.target.value}),placeholder:x.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:Y=>q({sourceUrl:Y.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:Y=>q({sourceAccessedDate:Y.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:a,infoType:"work",label:x.churchDocumentLabel,placeholder:x.churchDocumentPlaceholder,value:g.churchDocument,onChange:Y=>q({churchDocument:Y}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:Y=>q({locatorValue:Y.target.value}),placeholder:x.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(Ye,{libraryId:a,infoType:"work",label:x.workLabel,placeholder:x.workPlaceholder,value:g.work,onChange:Y=>q({work:Y}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:a,infoType:"media",label:x.bookLabel,placeholder:x.bookPlaceholder,value:g.bookMedia,onChange:Y=>q({bookMedia:Y}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:Y=>q({locatorValue:Y.target.value}),placeholder:x.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:Y=>q({locatorValue:Y.target.value}),placeholder:x.locatorPlaceholder})]})]})}const rn=[],nn=[];function on({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),s=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),u=a.handles.length,g=u>1?(u-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),s?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((j,x)=>e.jsx(Nr,{type:"target",id:j.id,position:Lr.Left,style:{top:46+x*28},children:j.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:j.label}):null},j.id)),a.output!==!1?e.jsx(Nr,{type:"source",id:"out",position:Lr.Right}):null]})}function sn({copy:a,value:n,onChange:s}){var Ke,$e,ze,sa,ea,k,_,Le,ke,pe,Re,Ue,Be,_e;const u=r.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=v=>!v||v.nodes.length===0?rn:v.nodes.map((T,Q)=>{var t,i,h,N;return{id:T.id,type:"computed",position:T.position??{x:40+Q*160,y:60+Q%3*80},data:{title:T.name||((t=u[T.type])==null?void 0:t.label)||T.type,subtitle:((i=u[T.type])==null?void 0:i.label)||T.type,type:T.type,name:T.name,outputLabel:T.outputLabel,min:T.min,max:T.max,value:T.type==="input.const"?T.value:void 0,list:T.list,handles:((h=u[T.type])==null?void 0:h.handles)??[],output:((N=u[T.type])==null?void 0:N.output)??!0}}}),j=v=>{if(!v||v.nodes.length===0)return nn;const T=new Set(v.nodes.map(i=>i.id)),Q=[];let t=0;return v.nodes.forEach(i=>{const h=i.inputsByHandle??(i.inputs?{in:i.inputs}:{});Object.entries(h).forEach(([N,V])=>{V.forEach(ee=>{T.has(ee)&&Q.push({id:`${i.id}-${N}-${ee}-${t++}`,source:ee,target:i.id,targetHandle:N==="in"?void 0:N})})})}),Q},x=r.useMemo(()=>g(n),[n,u]),L=r.useMemo(()=>j(n),[n]),A=(v,T)=>{if(!v)return"null";const Q=v.nodes.map(i=>{const h=(i.list??[]).join(","),N=i.inputs?i.inputs.join(","):"",V=i.inputsByHandle?Object.entries(i.inputsByHandle).map(([te,G])=>`${te}:${[...G].sort().join(",")}`).sort().join("|"):"",ee=T&&i.position?`${i.position.x},${i.position.y}`:"";return[i.id,i.type,i.name??"",i.outputLabel??"",i.min??"",i.max??"",h,N,V,ee].join(":")}).sort().join("||"),t=v.outputs?[...v.outputs].sort().join(","):v.output??"";return`${Q}::${t}`},C=r.useMemo(()=>{var T;const v=!!((T=n==null?void 0:n.nodes)!=null&&T.some(Q=>!!Q.position));return A(n,v)},[n]),[o,I]=r.useState(x),[m,b]=r.useState(L),[q,Y]=r.useState(null),[U,l]=r.useState([]),[p,f]=r.useState(null),[ue,K]=r.useState(null),[w,Z]=r.useState({}),[B,ne]=r.useState(0),R=r.useRef(s),W=r.useRef(C),ge=r.useRef(C),me=r.useRef(A(n,!1)),he=r.useMemo(()=>q?o.find(v=>v.id===q)??null:null,[o,q]),D=r.useMemo(()=>{const v=["in1","in2","in3","in4","in5","in6"],T=new Map;return m.forEach(Q=>{if(!Q.target)return;const t=Q.targetHandle??"in1";T.has(Q.target)||T.set(Q.target,new Set),T.get(Q.target).add(t)}),o.map(Q=>{var t;if(((t=Q.data)==null?void 0:t.type)==="compute.concat"){const i=T.get(Q.id)??new Set,h=[];let N=!1;return v.forEach(V=>{var ee,te;if(i.has(V)||!N){const G=(te=(ee=u["compute.concat"])==null?void 0:ee.handles)==null?void 0:te.find(de=>de.id===V);G&&h.push(G),i.has(V)||(N=!0)}}),{...Q,selected:Q.id===q,data:{...Q.data,handles:h}}}return{...Q,selected:Q.id===q}})},[o,q,m,u]);r.useEffect(()=>{f(null),K(null)},[q]),r.useEffect(()=>{if(U.length===0)return;const v=T=>{if(T.key!=="Delete"&&T.key!=="Backspace")return;const Q=T.target;Q&&(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"||Q.isContentEditable)||(T.preventDefault(),b(t=>t.filter(i=>!U.includes(i.id))),l([]))};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[U,b]),r.useEffect(()=>{R.current=s},[s]),r.useEffect(()=>{if(W.current!==C){if(ge.current===C||me.current===C){W.current=C;return}W.current=C,I(x),b(L),Y(null),f(null),K(null),Z({}),ne(v=>v+1)}},[x,L,b,I,C]),r.useEffect(()=>{const v=o.filter(h=>{var N;return((N=h.data)==null?void 0:N.type)==="output"}).map(h=>h.id).sort(),T=new Map;m.forEach(h=>{let N=T.get(h.target);N||(N={},T.set(h.target,N));const V=h.targetHandle||"in";N[V]||(N[V]=[]),N[V].push(h.source)}),T.forEach(h=>{Object.values(h).forEach(N=>N.sort())});const Q={nodes:o.map(h=>{var N,V,ee,te,G,de,se,we,aa;return{id:h.id,type:((N=h.data)==null?void 0:N.type)??"compute.add",position:h.position,name:(V=h.data)==null?void 0:V.name,outputLabel:(ee=h.data)==null?void 0:ee.outputLabel,min:(te=h.data)==null?void 0:te.min,max:(G=h.data)==null?void 0:G.max,value:((de=h.data)==null?void 0:de.type)==="input.const"?(se=h.data)==null?void 0:se.value:void 0,list:(we=h.data)==null?void 0:we.list,inputs:(aa=T.get(h.id))==null?void 0:aa.in,inputsByHandle:T.get(h.id)}}),output:v[0]??null,outputs:v},t=A(Q,!0),i=A(Q,!1);t===ge.current||i===me.current||(ge.current=t,me.current=i,R.current(Q))},[o,m]),r.useEffect(()=>{const v={};let T=!1;o.forEach(Q=>{var V,ee,te,G,de;if(((V=Q.data)==null?void 0:V.type)!=="input.random")return;if(w[Q.id]!==void 0){v[Q.id]=w[Q.id];return}const t=Number.isFinite((ee=Q.data)==null?void 0:ee.min)?Number((te=Q.data)==null?void 0:te.min):0,i=Number.isFinite((G=Q.data)==null?void 0:G.max)?Number((de=Q.data)==null?void 0:de.max):t+10,h=Math.min(t,i),N=Math.max(t,i);v[Q.id]=Math.floor(Math.random()*(N-h+1))+h,T=!0}),(T||Object.keys(v).length!==Object.keys(w).length)&&Z(v)},[o,w,B]);const oe=r.useMemo(()=>o.map(T=>{var t,i,h,N,V;const Q=(((t=T.data)==null?void 0:t.list)??[]).join(",");return[T.id,((i=T.data)==null?void 0:i.type)??"",((h=T.data)==null?void 0:h.name)??"",((N=T.data)==null?void 0:N.min)??"",((V=T.data)==null?void 0:V.max)??"",Q].join(":")}).sort().join("|"),[o]),c=r.useMemo(()=>m.map(T=>`${T.source}:${T.target}:${T.targetHandle??""}`).sort().join("|"),[m]),ie=r.useMemo(()=>{const v=new Map(o.map(te=>[te.id,te])),T=new Map;m.forEach(te=>{let G=T.get(te.target);G||(G={},T.set(te.target,G));const de=te.targetHandle||"in";G[de]||(G[de]=[]),G[de].push(te.source)});const Q=new Map,t=new Set,i=te=>{if(typeof te=="number")return te;if(typeof te=="string"){const G=Number(te);return Number.isFinite(G)?G:0}return 0},h=(te,G)=>{var de,se;return G?((de=T.get(te.id))==null?void 0:de[G])??[]:((se=T.get(te.id))==null?void 0:se.in)??[]},N=(te,G)=>h(te,G).map(de=>i(ee(de))),V=(te,G)=>h(te,G).map(de=>ee(de)),ee=te=>{var we,aa,qe,ia;if(Q.has(te))return Q.get(te);if(t.has(te))return 0;const G=v.get(te);if(!G)return 0;t.add(te);const de=((we=G.data)==null?void 0:we.type)??"";let se=0;switch(de){case"input.random":{se=w[te]??0;break}case"input.const":{se=Number.isFinite((aa=G.data)==null?void 0:aa.value)?Number((qe=G.data)==null?void 0:qe.value):0;break}case"input.list":{const Oe=(((ia=G.data)==null?void 0:ia.list)??[]).filter(Boolean),We=Math.round(N(G,"index")[0]??0);se=(Oe.length?Oe[Math.max(0,Math.min(Oe.length-1,We))]:"")||String(We);break}case"compute.add":{se=N(G,"in").reduce((Oe,We)=>Oe+We,0);break}case"compute.sub":{se=N(G,"add").reduce((Oe,We)=>Oe+We,0)-N(G,"sub").reduce((Oe,We)=>Oe+We,0);break}case"compute.mul":{const Oe=N(G,"in");se=Oe.length?Oe.reduce((We,Fe)=>We*Fe,1):0;break}case"compute.div":{const Oe=N(G,"num")[0]??0,We=N(G,"den").reduce((Fe,Xe)=>Fe+Xe,0);se=Math.abs(We)<Number.EPSILON?0:Oe/We;break}case"compute.pow":{const Oe=N(G,"base")[0]??0,We=N(G,"exp")[0]??0;se=Math.pow(Oe,We);break}case"compute.exp":{const Oe=N(G,"base")[0]??0,We=N(G,"exp")[0]??0;se=Math.pow(Oe,We);break}case"compute.log":{const Oe=N(G,"value")[0]??0,We=N(G,"base")[0]??0,Fe=Math.max(Oe,Number.EPSILON);se=Math.abs(We)<Number.EPSILON?Math.log(Fe):Math.log(Fe)/Math.log(We);break}case"compute.abs":{se=Math.abs(N(G,"in")[0]??0);break}case"compute.min":{const Oe=N(G,"in");se=Oe.length?Math.min(...Oe):0;break}case"compute.max":{const Oe=N(G,"in");se=Oe.length?Math.max(...Oe):0;break}case"compute.floor":{se=Math.floor(N(G,"in")[0]??0);break}case"compute.ceil":{se=Math.ceil(N(G,"in")[0]??0);break}case"compute.round":{se=Math.round(N(G,"in")[0]??0);break}case"compute.mod":{const Oe=N(G,"a")[0]??0,We=N(G,"b")[0]??0;se=Math.abs(We)<Number.EPSILON?0:Oe%We;break}case"compute.concat":{const We=["in1","in2","in3","in4","in5","in6"].flatMap(la=>V(G,la)),Fe=We.length?We:V(G,"in");se=(Fe.length?Fe:V(G)).map(la=>la==null?"":String(la)).join("");break}case"compute.trim":{const Oe=V(G,"text")[0]??V(G,"in")[0]??"",We=Oe==null?"":String(Oe),Fe=Math.max(0,Math.round(N(G,"start")[0]??0)),Xe=Math.max(0,Math.round(N(G,"end")[0]??0));se=Fe+Xe>=We.length?"":We.substring(Fe,We.length-Xe);break}case"output":{const Oe=h(G,"in")[0];se=Oe?ee(Oe):0;break}default:se=0}return t.delete(te),Q.set(te,se),se};return o.forEach(te=>ee(te.id)),Q},[oe,c,w]),ae=r.useRef(ie);r.useEffect(()=>{ae.current=ie},[ie]);const O=r.useCallback(v=>{const T=ae.current.get(v.id);return e.jsx(on,{data:{...v.data,value:T}})},[]),Ce=r.useMemo(()=>({computed:O}),[O]),le=v=>{var i;if(!v.target||!v.targetHandle){b(h=>$t(v,h));return}const T=o.find(h=>h.id===v.target),Q=T?u[((i=T.data)==null?void 0:i.type)??""]:null,t=Q==null?void 0:Q.handles.find(h=>h.id===v.targetHandle);b(h=>{let N=h;return t!=null&&t.limitOne&&(N=h.filter(V=>!(V.target===v.target&&V.targetHandle===v.targetHandle))),$t(v,N)})},re=v=>{const T=crypto.randomUUID(),Q=u[v]??{label:v,handles:[]},t=Q.label;I(i=>[...i,{id:T,type:"computed",position:{x:80+i.length*40,y:80+i.length*30},data:{title:t,subtitle:Q.label,type:v,name:"",handles:Q.handles,list:v==="input.list"?[]:void 0,output:Q.output??!0}}])},Ne=v=>{if(q){if(v.name!==void 0){const T=v.name.trim(),Q=T===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(T);if(K(Q?null:a.cogita.library.graph.invalidName),!T)f(null);else{const t=o.find(i=>{var h;return i.id!==q&&((h=i.data)==null?void 0:h.name)&&i.data.name.trim().toLowerCase()===T.toLowerCase()});f(t?a.cogita.library.graph.duplicateName:null)}}I(T=>T.map(Q=>{var t,i,h,N;return Q.id===q?{...Q,data:{...Q.data,...v,title:v.name?v.name:(t=Q.data)==null?void 0:t.title,subtitle:((h=u[v.type??((i=Q.data)==null?void 0:i.type)??""])==null?void 0:h.label)??((N=Q.data)==null?void 0:N.subtitle)}}:Q}))}},Ee=()=>{q&&(I(v=>v.filter(T=>T.id!==q)),b(v=>v.filter(T=>T.source!==q&&T.target!==q)),Z(v=>{const T={...v};return delete T[q],T}),Y(null),f(null))},Te=r.useRef({nodeId:null,edgeIds:[]}),Ae=v=>{var N;const T=((N=v.nodes[0])==null?void 0:N.id)??null,Q=v.edges.map(V=>V.id),t=Te.current,i=t.nodeId===T,h=t.edgeIds.length===Q.length&&t.edgeIds.every((V,ee)=>V===Q[ee]);i&&h||(Te.current={nodeId:T,edgeIds:Q},Y(T),l(Q))},Me=v=>{const T=v.filter(Q=>Q.type!=="select"&&Q.type!=="dimensions");T.length!==0&&I(Q=>bi(T,Q))},Je=v=>{const T=v.filter(Q=>Q.type!=="select");T.length!==0&&b(Q=>hi(T,Q))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(pr,{nodeTypes:Ce,nodes:D,edges:m,onNodesChange:Me,onEdgesChange:Je,onConnect:le,onNodeClick:(v,T)=>Y(T.id),onSelectionChange:Ae,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(fr,{gap:18,size:1}),e.jsx(xr,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>re("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>re("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>re("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>re("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>re("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>re("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>re("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>re("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>re("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>re("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>re("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>re("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>re("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>re("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>re("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>re("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>re("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>re("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>re("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>re("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),he?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Ke=he.data)==null?void 0:Ke.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:v=>Ne({name:v.target.value})}),p?e.jsx("em",{className:"cogita-help",children:p}):null,ue?e.jsx("em",{className:"cogita-help",children:ue}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((ze=u[(($e=he.data)==null?void 0:$e.type)??""])==null?void 0:ze.label)??((sa=he.data)==null?void 0:sa.type)]}),((ea=he.data)==null?void 0:ea.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((k=he.data)==null?void 0:k.outputLabel)??"",onChange:v=>Ne({outputLabel:v.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((_=he.data)==null?void 0:_.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Le=he.data)==null?void 0:Le.min)??0,onChange:v=>Ne({min:Number(v.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((ke=he.data)==null?void 0:ke.max)??10,onChange:v=>Ne({max:Number(v.target.value)})})]})]}),((pe=he.data)==null?void 0:pe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:((Re=he.data)==null?void 0:Re.value)??0,onChange:v=>Ne({value:Number(v.target.value)})})]}),((Ue=he.data)==null?void 0:Ue.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Be=he.data)==null?void 0:Be.list)??[]).join(`
`),onChange:v=>Ne({list:v.target.value.split(`
`).map(T=>T.replace(/\r$/,"")).filter(T=>T.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((_e=he.data)==null?void 0:_e.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{q&&(Z(v=>{var h,N,V,ee;const T=Number.isFinite((h=he.data)==null?void 0:h.min)?Number((N=he.data)==null?void 0:N.min):0,Q=Number.isFinite((V=he.data)==null?void 0:V.max)?Number((ee=he.data)==null?void 0:ee.max):T+10,t=Math.min(T,Q),i=Math.max(T,Q);return{...v,[q]:Math.floor(Math.random()*(i-t+1))+t}}),ne(v=>v+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Ee,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const rr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function vr(a,n,s){if(!a)return null;const u=new Map(a.nodes.map(K=>[K.id,K])),g=new Map,j=new Set,x=K=>{if(typeof K=="number")return K;if(typeof K=="string"){const w=Number(K);return Number.isFinite(w)?w:0}return 0},L=K=>{if(g.has(K))return g.get(K);if(j.has(K))return 0;const w=u.get(K);if(!w)return 0;j.add(K);const Z=ne=>{var W,ge;return(ne?((W=w.inputsByHandle)==null?void 0:W[ne])??[]:w.inputs??((ge=w.inputsByHandle)==null?void 0:ge.in)??[]).map(me=>L(me))};let B=0;switch(w.type){case"input.random":{const ne=w.min??0,R=w.max??ne+10,W=Math.min(ne,R),ge=Math.max(ne,R);B=Math.floor(Math.random()*(ge-W+1))+W;break}case"input.const":{B=w.value??0;break}case"input.list":{const ne=(w.list??[]).filter(Boolean),R=Math.round(x(Z("index")[0]));B=ne.length?ne[Math.max(0,Math.min(ne.length-1,R))]:String(R);break}case"compute.add":{B=Z("in").map(R=>x(R)).reduce((R,W)=>R+W,0);break}case"compute.sub":{const ne=Z("add").map(W=>x(W)),R=Z("sub").map(W=>x(W));B=ne.reduce((W,ge)=>W+ge,0)-R.reduce((W,ge)=>W+ge,0);break}case"compute.mul":{const ne=Z("in").map(R=>x(R));B=ne.length?ne.reduce((R,W)=>R*W,1):0;break}case"compute.div":{const ne=x(Z("num")[0]),R=Z("den").map(W=>x(W)).reduce((W,ge)=>W+ge,0);B=Math.abs(R)<Number.EPSILON?0:ne/R;break}case"compute.pow":{const ne=x(Z("base")[0]),R=x(Z("exp")[0]);B=Math.pow(ne,R);break}case"compute.exp":{const ne=x(Z("base")[0]),R=x(Z("exp")[0]);B=Math.pow(ne,R);break}case"compute.log":{const ne=x(Z("value")[0]),R=x(Z("base")[0]),W=Math.max(ne,Number.EPSILON);B=Math.abs(R)<Number.EPSILON?Math.log(W):Math.log(W)/Math.log(R);break}case"compute.abs":{B=Math.abs(x(Z("in")[0]));break}case"compute.min":{const ne=Z("in").map(R=>x(R));B=ne.length?Math.min(...ne):0;break}case"compute.max":{const ne=Z("in").map(R=>x(R));B=ne.length?Math.max(...ne):0;break}case"compute.floor":{B=Math.floor(x(Z("in")[0]));break}case"compute.ceil":{B=Math.ceil(x(Z("in")[0]));break}case"compute.round":{B=Math.round(x(Z("in")[0]));break}case"compute.mod":{const ne=x(Z("a")[0]),R=x(Z("b")[0]);B=Math.abs(R)<Number.EPSILON?0:ne%R;break}case"compute.concat":{const R=["in1","in2","in3","in4","in5","in6"].flatMap(he=>Z(he)),W=R.length?R:Z("in");B=(W.length?W:Z()).map(he=>he==null?"":String(he)).join("");break}case"compute.trim":{const ne=Z("text")[0]??Z("in")[0]??"",R=ne==null?"":String(ne),W=Math.max(0,Math.round(x(Z("start")[0]))),ge=Math.max(0,Math.round(x(Z("end")[0])));W+ge>=R.length?B="":B=R.substring(W,R.length-ge);break}case"output":{B=Z("in")[0]??0;break}default:B=0}return j.delete(K),g.set(K,B),B},A=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(K=>K.type==="output").map(K=>K.id);a.nodes.forEach(K=>L(K.id)),A.forEach(K=>L(K));const C=K=>Math.abs(K%1)<1e-5?String(Math.round(K)):K.toFixed(3).replace(/\.?0+$/,""),o=K=>typeof K=="number"?C(K):K??"",I=new Map;A.forEach(K=>{var R,W,ge,me;const w=u.get(K);if(!w)return;const Z=(W=(R=w.inputsByHandle)==null?void 0:R.name)==null?void 0:W[0],B=Z?o(g.get(Z)):"",ne=(B==null?void 0:B.toString().trim())||((ge=w.outputLabel)==null?void 0:ge.trim())||((me=w.name)==null?void 0:me.trim())||K;I.set(K,ne)});const m={},b={},q={};A.forEach(K=>{var B,ne;const w=u.get(K);if(!w)return;const Z=I.get(K)??(((B=w.outputLabel)==null?void 0:B.trim())||((ne=w.name)==null?void 0:ne.trim())||K);m[Z]=o(g.get(K)),w.name&&(b[w.name.trim()]=Z),b[K]=Z});const Y=(K,w)=>{let Z=K;return a.nodes.forEach(B=>{var me,he;const ne=o(g.get(B.id)),R=A.includes(B.id),W=R?I.get(B.id)??((me=B.outputLabel)==null?void 0:me.trim())??((he=B.name)==null?void 0:he.trim())??B.id:"",ge=R&&w?W:ne;Z=Z.replace(new RegExp(`\\{\\s*${rr(B.id)}\\s*\\}`,"gi"),ge),B.name&&(Z=Z.replace(new RegExp(`\\{\\s*${rr(B.name)}\\s*\\}`,"gi"),ge)),R&&B.outputLabel&&(Z=Z.replace(new RegExp(`\\{\\s*${rr(B.outputLabel)}\\s*\\}`,"gi"),W))}),Z},U=n;let l=U.trim().length>0?U:"";l||(l=A.length?`Compute ${A.join(", ")}`:"Compute"),l=Y(l,!0);const p=(s==null?void 0:s.trim())??"",f=p?Y(p,!1):"",ue={};return g.forEach((K,w)=>{ue[w]=K,q[w]=o(K);const Z=u.get(w);Z!=null&&Z.name&&(q[Z.name.trim()]=o(K))}),{prompt:l,answers:m,values:ue,answerText:f,outputVariables:b,variableValues:q}}function ei(a){var s;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((s=n[0])==null?void 0:s[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function ln({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o,editInfoId:I}){const{libraryName:m}=qa(o),b=!!I,q=`/#/cogita/library/${o}`,[Y,U]=r.useState("info"),[l,p]=r.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[f,ue]=r.useState(""),[K,w]=r.useState(null),[Z,B]=r.useState(null),[ne,R]=r.useState("idle"),[W,ge]=r.useState(null),[me,he]=r.useState(-1),[D,oe]=r.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[c,ie]=r.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[ae,O]=r.useState(null),[Ce,le]=r.useState("idle"),[re,Ne]=r.useState(null),[Ee,Te]=r.useState(null),[Ae,Me]=r.useState(null),Je=r.useRef(null),Ke=r.useRef(null),$e=r.useRef(null),ze=r.useMemo(()=>Xr(a),[a]),sa=r.useMemo(()=>Xi(a),[a]),ea=r.useMemo(()=>Zi(a),[a]),k=r.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),_=r.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Le=r.useMemo(()=>ze.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[ze]),ke=r.useMemo(()=>{const t=A;return At.map(i=>{var V;const h=(i==null?void 0:i[t])??(i==null?void 0:i.en)??(i==null?void 0:i.la);return{label:`${h.abbr} — ${h.name}`,latin:((V=i==null?void 0:i.la)==null?void 0:V.abbr)??h.abbr}})},[A]),pe=(t,i=!1)=>{const h=t.trim().toLowerCase();return h?ke.filter(N=>N.label.toLowerCase().includes(h)).slice(0,8):i?ke.slice(0,8):[]},Re=(t,i)=>{const h=t.trim().toLowerCase();if(!h)return null;const N=At;for(const V of N){const ee=V==null?void 0:V.la,te=(V==null?void 0:V[i])??(V==null?void 0:V.en)??ee;if([te==null?void 0:te.abbr,te==null?void 0:te.name,ee==null?void 0:ee.abbr,ee==null?void 0:ee.name,`${te==null?void 0:te.abbr} — ${te==null?void 0:te.name}`].filter(Boolean).map(de=>de.toLowerCase()).some(de=>de===h))return{book:V,entry:te,la:ee}}return null};r.useEffect(()=>{if(!D.language||!D.word){Ne(null);return}const t=window.setTimeout(()=>{ar({libraryId:o,languageId:D.language.id,wordId:D.word.id}).then(i=>{Ne(i.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{Ne(null)})},200);return()=>window.clearTimeout(t)},[o,D.language,D.word]),r.useEffect(()=>{if(!c.languageA||!c.wordA){Te(null);return}const t=window.setTimeout(()=>{ar({libraryId:o,languageId:c.languageA.id,wordId:c.wordA.id}).then(i=>{Te(i.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Te(null)})},200);return()=>window.clearTimeout(t)},[o,c.languageA,c.wordA]),r.useEffect(()=>{if(!c.languageB||!c.wordB){Me(null);return}const t=window.setTimeout(()=>{ar({libraryId:o,languageId:c.languageB.id,wordId:c.wordB.id}).then(i=>{Me(i.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Me(null)})},200);return()=>window.clearTimeout(t)},[o,c.languageB,c.wordB]),r.useEffect(()=>{if(!b||!I)return;let t=!1;return le("loading"),O(null),it({libraryId:o,infoId:I}).then(async i=>{var N,V;if(t)return;const h=i.payload??{};if(p(ee=>({...ee,infoType:i.infoType,label:h.label??"",notes:h.notes??"",language:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,sourceKind:h.sourceKind??"string",sourceResourceType:ee.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:h.text??"",workLanguage:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,workOriginalLanguage:h.originalLanguageId?{id:h.originalLanguageId,label:h.originalLanguageId,infoType:"language"}:null,workDoi:h.doi??"",mediaType:h.mediaType??"book",mediaPublisher:h.publisher??"",mediaPublicationPlace:h.publicationPlace??"",mediaPublicationYear:h.publicationYear??"",mediaPages:h.pages??"",mediaIsbn:h.isbn??"",mediaCover:h.cover??"",mediaHeight:h.height??"",mediaLength:h.length??"",mediaWidth:h.width??"",mediaWeight:h.weight??"",mediaCollection:h.collection??"",mediaLocation:h.location??"",sourceUrl:"",sourceAccessedDate:""})),i.infoType==="source"&&h.locator&&typeof h.locator=="object"){const ee=h.locator;if(h.sourceKind==="website")p(te=>({...te,sourceUrl:typeof ee.url=="string"?ee.url:"",sourceAccessedDate:typeof ee.date=="string"?ee.date:""}));else if(h.sourceKind==="bible"){const te=typeof ee.book=="string"?ee.book:"",G=te?Re(te,A):null,de=G?`${G.entry.abbr} — ${G.entry.name}`:te;p(se=>({...se,sourceLocatorValue:te,sourceLocatorAux:typeof ee.rest=="string"?ee.rest:"",sourceBibleBookDisplay:de}))}else h.sourceKind==="book"?p(te=>({...te,sourceLocatorValue:typeof ee.page=="string"?ee.page:""})):h.sourceKind==="number_document"?p(te=>({...te,sourceLocatorValue:typeof ee.number=="string"?ee.number:""})):typeof ee.text=="string"&&p(te=>({...te,sourceLocatorValue:ee.text}))}if(h.languageId&&i.infoType!=="work")try{const ee=await it({libraryId:o,infoId:h.languageId});if(t)return;p(te=>{var G;return{...te,language:{id:h.languageId,label:((G=ee.payload)==null?void 0:G.label)??h.languageId,infoType:"language"}}})}catch{}if(h.languageId&&i.infoType==="work")try{const ee=await it({libraryId:o,infoId:h.languageId});if(t)return;p(te=>{var G;return{...te,workLanguage:{id:h.languageId,label:((G=ee.payload)==null?void 0:G.label)??h.languageId,infoType:"language"}}})}catch{}if(h.originalLanguageId)try{const ee=await it({libraryId:o,infoId:h.originalLanguageId});if(t)return;p(te=>{var G;return{...te,workOriginalLanguage:{id:h.originalLanguageId,label:((G=ee.payload)==null?void 0:G.label)??h.originalLanguageId,infoType:"language"}}})}catch{}i.infoType==="computed"?(ue(((N=h.definition)==null?void 0:N.answerTemplate)??""),w(((V=h.definition)==null?void 0:V.graph)??null),B(null),R("idle")):(ue(""),w(null),B(null),R("idle")),U("info")}).catch(()=>{t||O(a.cogita.library.add.info.failed)}).finally(()=>{t||le("idle")}),()=>{t=!0}},[a,I,b,o]),r.useEffect(()=>{if(l.sourceKind==="bible"&&l.sourceLocatorValue&&W!=="source"){const t=Re(l.sourceLocatorValue,A);if(t){const i=`${t.entry.abbr} — ${t.entry.name}`;i!==l.sourceBibleBookDisplay&&p(h=>({...h,sourceBibleBookDisplay:i}))}}},[A,l.sourceKind,l.sourceLocatorValue,l.sourceBibleBookDisplay]);const Ue=async()=>{var t,i;O(null);try{const h={label:l.infoType==="quote"||l.infoType==="source"?"":l.label,notes:l.infoType==="computed"?"":l.notes};if(l.language&&(l.infoType==="word"||l.infoType==="sentence")&&(h.languageId=l.language.id),l.infoType==="source"&&(h.sourceKind=l.sourceKind,l.sourceKind==="website"?h.locator={url:l.sourceUrl.trim(),date:l.sourceAccessedDate.trim()}:l.sourceKind==="bible"?h.locator={book:l.sourceLocatorValue.trim(),rest:l.sourceLocatorAux.trim()}:l.sourceKind==="book"?h.locator={page:l.sourceLocatorValue.trim()}:l.sourceKind==="number_document"?h.locator={number:l.sourceLocatorValue.trim()}:h.locator={text:l.sourceLocatorValue.trim()}),l.infoType==="quote"&&(h.text=l.quoteText),l.infoType==="work"&&(h.languageId=((t=l.workLanguage)==null?void 0:t.id)??null,h.originalLanguageId=((i=l.workOriginalLanguage)==null?void 0:i.id)??null,h.doi=l.workDoi.trim()),l.infoType==="media"&&(h.mediaType=l.mediaType,h.publisher=l.mediaPublisher.trim(),h.publicationPlace=l.mediaPublicationPlace.trim(),h.publicationYear=l.mediaPublicationYear.trim(),h.pages=l.mediaPages.trim(),h.isbn=l.mediaIsbn.trim(),h.cover=l.mediaCover.trim(),h.height=l.mediaHeight.trim(),h.length=l.mediaLength.trim(),h.width=l.mediaWidth.trim(),h.weight=l.mediaWeight.trim(),h.collection=l.mediaCollection.trim(),h.location=l.mediaLocation.trim()),l.infoType==="computed"){if(!K){O(a.cogita.library.add.info.computedRequired);return}if(!f.trim()){O(a.cogita.library.add.info.computedAnswerRequired);return}if(K.nodes.find(se=>se.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(se.name))){O(a.cogita.library.add.info.computedInvalidName);return}const V=K.nodes.map(se=>{var we;return(we=se.name)==null?void 0:we.trim()}).filter(Boolean),ee=new Set;for(const se of V){const we=se.toLowerCase();if(ee.has(we)){O(a.cogita.library.add.info.computedDuplicateName);return}ee.add(we)}const te=K.nodes.filter(se=>se.type==="output"),G=te.map(se=>{var we;return(we=se.name)==null?void 0:we.trim()}).filter(Boolean);if(G.length!==te.length){O(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!G.every(se=>new RegExp(`\\{\\s*${se}\\s*\\}`,"i").test(f))){O(a.cogita.library.add.info.computedAnswerMissingOutput);return}h.definition={answerTemplate:f,graph:K}}if(b&&I)le("saving"),await fi({libraryId:o,infoId:I,payload:h}),O(a.cogita.library.add.info.updated),le("idle");else{let N=null;if(l.referenceEnabled){const se={sourceKind:l.referenceSourceKind,locatorValue:l.referenceLocatorValue,locatorAux:l.referenceLocatorAux,bibleBookDisplay:l.referenceBibleBookDisplay,sourceUrl:l.referenceSourceUrl,sourceAccessedDate:l.referenceSourceAccessedDate,churchDocument:l.referenceChurchDocument,bookMedia:l.referenceBookMedia,work:l.referenceWork},{payload:we,resourceInfoId:aa,error:qe}=Be(se);if(qe){O(a.cogita.library.add.info.referenceMissingSource);return}N={payload:we,resourceInfoId:aa}}const V=await rt({libraryId:o,infoType:l.infoType,payload:h});if(l.infoType==="source"&&l.sourceResource&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[V.infoId,l.sourceResource.id]}),l.infoType==="quote"&&l.language&&await ga({libraryId:o,connectionType:"quote-language",infoIds:[V.infoId,l.language.id]}),N){const se=await rt({libraryId:o,infoType:"source",payload:N.payload});N.resourceInfoId&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[se.infoId,N.resourceInfoId]}),await ga({libraryId:o,connectionType:"reference",infoIds:[V.infoId,se.infoId]})}O(a.cogita.library.add.info.saved);const ee=l.infoType==="word"||l.infoType==="sentence",te=l.referenceEnabled,G=l.referenceSourceKind,de={referenceEnabled:te,referenceSourceKind:te?G:"string",referenceSourceUrl:te&&G==="website"?l.referenceSourceUrl:"",referenceSourceAccessedDate:te&&G==="website"?l.referenceSourceAccessedDate:"",referenceChurchDocument:te&&G==="number_document"?l.referenceChurchDocument:null,referenceBookMedia:te&&G==="book"?l.referenceBookMedia:null,referenceWork:te&&G==="work"?l.referenceWork:null,referenceLocatorValue:te&&G==="bible"?l.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:te&&G==="bible"?l.referenceBibleBookDisplay:""};p({infoType:l.infoType,label:"",language:ee?l.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:l.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...de}),l.infoType==="computed"&&(ue(""),w(null),B(null),R("idle"))}}catch{O(a.cogita.library.add.info.failed)}},Be=t=>{let i=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:i,error:!0};i=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:i,error:!0};i=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:i,error:!0};i=t.work.id}const h={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const N=t.sourceUrl.trim();return N?(h.locator={url:N,date:t.sourceAccessedDate.trim()},{payload:h,resourceInfoId:i}):{payload:{},resourceInfoId:i,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:i,error:!0}:(h.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:h,resourceInfoId:i}):(t.sourceKind==="book"?h.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?h.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(h.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:i,error:!0}:{payload:h,resourceInfoId:i})},_e=()=>{if(R("idle"),!K){B(null),R("error");return}const t=vr(K,"",f);if(!t){B(null),R("error");return}B({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),R("ready")},v=async()=>{O(null);try{if(D.connectionType==="reference"){if(!D.referencedInfo||!D.source){O(a.cogita.library.add.connection.selectReference);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.referencedInfo.id,D.source.id]})}else if(D.connectionType==="source-resource"){if(!D.source||!D.sourceResource){O(a.cogita.library.add.connection.selectSourceResource);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.source.id,D.sourceResource.id]})}else if(D.connectionType==="quote-language"){if(!D.quote||!D.language){O(a.cogita.library.add.connection.selectQuoteLanguage);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.quote.id,D.language.id]})}else if(D.connectionType==="work-contributor"){if(!D.work||!D.contributor||!D.contributorRole.trim()){O(a.cogita.library.add.connection.selectWorkContributor);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.work.id,D.contributor.id],payload:{role:D.contributorRole.trim()}})}else if(D.connectionType==="work-medium"){if(!D.work||!D.medium){O(a.cogita.library.add.connection.selectWorkMedium);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.work.id,D.medium.id]})}else if(D.connectionType==="orcid-link"){if(!D.orcidEntity||!D.orcid){O(a.cogita.library.add.connection.selectOrcidLink);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.orcidEntity.id,D.orcid.id]})}else if(D.connectionType==="word-language"){if(!D.language||!D.word){O(a.cogita.library.add.connection.selectWordLanguage);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.language.id,D.word.id],payload:{note:D.note}})}else if(D.connectionType==="word-topic"){if(!D.word||!D.topic){O(a.cogita.library.add.connection.selectWordTopic);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.word.id,D.topic.id],payload:{note:D.note}})}else if(D.connectionType==="translation"){if(!D.wordA||!D.wordB){O(a.cogita.library.add.connection.selectTwoWords);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.wordA.id,D.wordB.id],payload:{note:D.note}})}else if(D.connectionType==="language-sentence"){if(!D.language||!D.sentence){O(a.cogita.library.add.connection.selectLanguageSentence);return}await ga({libraryId:o,connectionType:D.connectionType,infoIds:[D.language.id,D.sentence.id],payload:{note:D.note}})}O(a.cogita.library.add.connection.saved),oe(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{O(a.cogita.library.add.connection.failed)}},T=async()=>{var t,i;O(null);try{if(c.groupType==="citation"){const N=c.citationTitle.trim(),V=c.citationQuoteText.trim();if(!V){O(a.cogita.library.add.group.citationMissingQuote);return}let ee=null;if(c.citationReferenceEnabled){const de={sourceKind:c.citationSourceKind,locatorValue:c.citationLocatorValue,locatorAux:c.citationLocatorAux,bibleBookDisplay:c.citationBibleBookDisplay,sourceUrl:c.citationSourceUrl,sourceAccessedDate:c.citationSourceAccessedDate,churchDocument:c.citationChurchDocument,bookMedia:c.citationBookMedia,work:c.citationWork},{payload:se,resourceInfoId:we,error:aa}=Be(de);if(aa){O(a.cogita.library.add.info.referenceMissingSource);return}ee={payload:se,resourceInfoId:we}}const te={text:V};N&&(te.title=N);const G=await rt({libraryId:o,infoType:"quote",payload:te});if(c.citationLanguage&&await ga({libraryId:o,connectionType:"quote-language",infoIds:[G.infoId,c.citationLanguage.id]}),ee){const de=await rt({libraryId:o,infoType:"source",payload:ee.payload});ee.resourceInfoId&&await ga({libraryId:o,connectionType:"source-resource",infoIds:[de.infoId,ee.resourceInfoId]}),await ga({libraryId:o,connectionType:"reference",infoIds:[G.infoId,de.infoId]})}O(a.cogita.library.add.group.savedCitation),ie(de=>({...de,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:de.citationReferenceEnabled,citationSourceKind:de.citationReferenceEnabled?de.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:de.citationReferenceEnabled?de.citationChurchDocument:null,citationBookMedia:de.citationReferenceEnabled?de.citationBookMedia:null,citationWork:de.citationReferenceEnabled?de.citationWork:null}));return}if(c.groupType==="book"){const N=c.bookTitle.trim();if(!N){O(a.cogita.library.add.group.bookMissingTitle);return}const V=c.bookWorkTitle.trim();if(!V){O(a.cogita.library.add.group.bookMissingWork);return}if(c.bookContributors.find(se=>se.contributor&&!se.role.trim()||!se.contributor&&se.role.trim())){O(a.cogita.library.add.group.bookMissingContributor);return}const te=await rt({libraryId:o,infoType:"media",payload:{label:N,mediaType:"book",publisher:c.bookPublisher.trim(),publicationPlace:c.bookPublicationPlace.trim(),publicationYear:c.bookPublicationYear.trim(),pages:c.bookPages.trim(),isbn:c.bookIsbn.trim(),cover:c.bookCover.trim(),height:c.bookHeight.trim(),length:c.bookLength.trim(),width:c.bookWidth.trim(),weight:c.bookWeight.trim(),collection:c.bookCollection.trim(),location:c.bookLocation.trim()}}),G=await rt({libraryId:o,infoType:"work",payload:{label:V,languageId:((t=c.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((i=c.bookWorkOriginalLanguage)==null?void 0:i.id)??null,doi:c.bookWorkDoi.trim()}});await ga({libraryId:o,connectionType:"work-medium",infoIds:[G.infoId,te.infoId]});const de=c.bookContributors.filter(se=>se.contributor&&se.role.trim());for(const se of de)await ga({libraryId:o,connectionType:"work-contributor",infoIds:[G.infoId,se.contributor.id],payload:{role:se.role.trim()}});O(a.cogita.library.add.group.savedBook),ie(se=>({...se,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!c.languageA||!c.wordA||!c.languageB||!c.wordB){O(a.cogita.library.add.group.selectBoth);return}const h=N=>Array.from(new Map(N.map(V=>[V.id,V])).values());Ee||await ga({libraryId:o,connectionType:"word-language",infoIds:[c.languageA.id,c.wordA.id]}),Ae||await ga({libraryId:o,connectionType:"word-language",infoIds:[c.languageB.id,c.wordB.id]});for(const N of h(c.wordATags))await ga({libraryId:o,connectionType:"word-topic",infoIds:[c.wordA.id,N.id]});for(const N of h(c.wordBTags))await ga({libraryId:o,connectionType:"word-topic",infoIds:[c.wordB.id,N.id]});await ga({libraryId:o,connectionType:"translation",infoIds:[c.wordA.id,c.wordB.id],payload:{tagIds:h(c.translationTags).map(N=>N.id)}}),O(a.cogita.library.add.group.savedVocab),ie(N=>({...N,groupType:c.groupType,languageA:c.languageA,wordA:null,languageB:c.languageB,wordB:null,wordATags:c.wordATags,wordBTags:c.wordBTags,translationTags:c.translationTags})),requestAnimationFrame(()=>{var N;return(N=Je.current)==null?void 0:N.focus()})}catch{O(a.cogita.library.add.group.failed)}},Q=c.groupType==="citation"?a.cogita.library.add.group.saveCitation:c.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:q,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${q}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":Y===t,onClick:()=>{b||U(t)},disabled:b&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[Y==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:l.infoType,onChange:t=>{b||p(i=>({...i,infoType:t.target.value}))},disabled:b,children:ze.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),l.infoType!=="quote"&&l.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:l.label,onChange:t=>p(i=>({...i,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(l.infoType==="word"||l.infoType==="sentence"||l.infoType==="quote")&&e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:l.language,onChange:t=>p(i=>({...i,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),l.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:l.workLanguage,onChange:t=>p(i=>({...i,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:l.workOriginalLanguage,onChange:t=>p(i=>({...i,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:l.workDoi,onChange:t=>p(i=>({...i,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),l.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:l.mediaType,onChange:t=>p(i=>({...i,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:l.mediaPublisher,onChange:t=>p(i=>({...i,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:l.mediaPublicationPlace,onChange:t=>p(i=>({...i,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:l.mediaPublicationYear,onChange:t=>p(i=>({...i,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:l.mediaPages,onChange:t=>p(i=>({...i,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:l.mediaIsbn,onChange:t=>p(i=>({...i,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:l.mediaCover,onChange:t=>p(i=>({...i,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:l.mediaHeight,onChange:t=>p(i=>({...i,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:l.mediaLength,onChange:t=>p(i=>({...i,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:l.mediaWidth,onChange:t=>p(i=>({...i,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:l.mediaWeight,onChange:t=>p(i=>({...i,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:l.mediaCollection,onChange:t=>p(i=>({...i,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:l.mediaLocation,onChange:t=>p(i=>({...i,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),l.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:l.quoteText,onChange:t=>p(i=>({...i,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),l.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:l.sourceKind,onChange:t=>{const i=t.target.value,h=i==="book"||i==="media"?"media":i==="bible"||i==="number_document"||i==="work"?"work":l.sourceResourceType;p(N=>({...N,sourceKind:i,sourceResourceType:h,sourceResource:null,sourceLocatorValue:i==="bible"?"":N.sourceLocatorValue,sourceLocatorAux:i==="bible"?"":N.sourceLocatorAux,sourceBibleBookDisplay:i==="bible"?N.sourceBibleBookDisplay:""}))},children:k.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),l.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:l.sourceBibleBookDisplay,onChange:t=>{const i=t.target.value;p(h=>({...h,sourceBibleBookDisplay:i,sourceLocatorValue:""})),ge("source"),he(-1)},onKeyDown:t=>{const i=pe(l.sourceBibleBookDisplay);if(i.length){if(t.key==="ArrowDown")t.preventDefault(),he(h=>Math.min(h+1,i.length-1));else if(t.key==="ArrowUp")t.preventDefault(),he(h=>Math.max(h-1,0));else if((t.key==="Enter"||t.key==="Tab")&&me>=0&&i[me]){const h=i[me],N=Re(h.label,A);if(!N)return;p(V=>{var ee;return{...V,sourceBibleBookDisplay:h.label,sourceLocatorValue:((ee=N.la)==null?void 0:ee.abbr)??V.sourceLocatorValue}}),ge(null)}}},onFocus:()=>ge("source"),onBlur:()=>window.setTimeout(()=>ge(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),W==="source"&&pe(l.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:pe(l.sourceBibleBookDisplay,!0).map((t,i)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":i===me,tabIndex:-1,onMouseDown:()=>{const h=Re(t.label,A);h&&p(N=>{var V;return{...N,sourceBibleBookDisplay:t.label,sourceLocatorValue:((V=h.la)==null?void 0:V.abbr)??N.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:l.sourceLocatorAux,onChange:t=>p(i=>({...i,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),l.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:l.sourceUrl,onChange:t=>p(i=>({...i,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:l.sourceAccessedDate,onChange:t=>p(i=>({...i,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),l.sourceKind!=="website"&&l.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:l.sourceLocatorValue,onChange:t=>p(i=>({...i,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),l.sourceKind!=="string"&&l.sourceKind!=="website"&&l.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:l.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(l.sourceKind),onChange:t=>p(i=>({...i,sourceResourceType:t.target.value,sourceResource:null})),children:Le.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ye,{libraryId:o,infoType:l.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:l.sourceResource,onChange:t=>p(i=>({...i,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,l.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),l.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:l.notes,onChange:t=>p(i=>({...i,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,l.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:f,onChange:t=>ue(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(sn,{copy:a,value:K,onChange:t=>w(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:_e,children:a.cogita.library.add.info.computedPreview})}),Z&&ne==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(hr,{value:Z.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(Z.answers).map(([t,i])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(pi,{value:i,mode:"auto"})]},t))}),Z.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(hr,{value:Z.answerText,mode:"auto"})]}):null]}):ne==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:l.referenceEnabled,onChange:t=>p(i=>({...i,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),l.referenceEnabled&&e.jsx(Fr,{libraryId:o,copy:a,language:A,sourceKindOptions:k,labels:_,value:{sourceKind:l.referenceSourceKind,locatorValue:l.referenceLocatorValue,locatorAux:l.referenceLocatorAux,bibleBookDisplay:l.referenceBibleBookDisplay,sourceUrl:l.referenceSourceUrl,sourceAccessedDate:l.referenceSourceAccessedDate,churchDocument:l.referenceChurchDocument,bookMedia:l.referenceBookMedia,work:l.referenceWork},onChange:t=>p(i=>({...i,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:Ue,disabled:Ce==="saving"||Ce==="loading",children:b?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,Y==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:D.connectionType,onChange:t=>oe(i=>({...i,connectionType:t.target.value})),children:sa.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),D.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:D.language,onChange:t=>oe(i=>({...i,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:D.word,onChange:t=>oe(i=>({...i,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),re&&e.jsx("p",{className:"cogita-help",children:re})]}),D.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:D.word,onChange:t=>oe(i=>({...i,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:D.topic,onChange:t=>oe(i=>({...i,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),D.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:D.wordA,onChange:t=>oe(i=>({...i,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:D.wordB,onChange:t=>oe(i=>({...i,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),D.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:D.quote,onChange:t=>oe(i=>({...i,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:D.language,onChange:t=>oe(i=>({...i,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),D.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:D.language,onChange:t=>oe(i=>({...i,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:D.sentence,onChange:t=>oe(i=>({...i,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),D.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:D.referencedInfoType,onChange:t=>oe(i=>({...i,referencedInfoType:t.target.value,referencedInfo:null})),children:ze.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ye,{libraryId:o,infoType:D.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:D.referencedInfo,onChange:t=>oe(i=>({...i,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,D.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:D.source,onChange:t=>oe(i=>({...i,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),D.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:D.source,onChange:t=>oe(i=>({...i,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:D.sourceResourceType,onChange:t=>oe(i=>({...i,sourceResourceType:t.target.value,sourceResource:null})),children:Le.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Ye,{libraryId:o,infoType:D.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:D.sourceResource,onChange:t=>oe(i=>({...i,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,D.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),D.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:D.work,onChange:t=>oe(i=>({...i,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:D.contributorType,onChange:t=>oe(i=>({...i,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ge(a,t)},t))})]}),e.jsx(Ye,{libraryId:o,infoType:D.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:D.contributor,onChange:t=>oe(i=>({...i,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,D.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:D.contributorRole,onChange:t=>oe(i=>({...i,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),D.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:D.work,onChange:t=>oe(i=>({...i,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:D.medium,onChange:t=>oe(i=>({...i,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),D.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:D.orcidEntityType,onChange:t=>oe(i=>({...i,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ge(a,t)},t))})]}),e.jsx(Ye,{libraryId:o,infoType:D.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:D.orcidEntity,onChange:t=>oe(i=>({...i,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,D.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(Ye,{libraryId:o,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:D.orcid,onChange:t=>oe(i=>({...i,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:D.note,onChange:t=>oe(i=>({...i,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:v,children:a.cogita.library.add.connection.save})})]}):null,Y==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:c.groupType,onChange:t=>ie(i=>({...i,groupType:t.target.value})),children:ea.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),c.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:c.citationLanguage,onChange:t=>ie(i=>({...i,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:c.citationTitle,onChange:t=>ie(i=>({...i,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:c.citationQuoteText,onChange:t=>ie(i=>({...i,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:c.citationReferenceEnabled,onChange:t=>ie(i=>({...i,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),c.citationReferenceEnabled&&e.jsx(Fr,{libraryId:o,copy:a,language:A,sourceKindOptions:k,labels:_,value:{sourceKind:c.citationSourceKind,locatorValue:c.citationLocatorValue,locatorAux:c.citationLocatorAux,bibleBookDisplay:c.citationBibleBookDisplay,sourceUrl:c.citationSourceUrl,sourceAccessedDate:c.citationSourceAccessedDate,churchDocument:c.citationChurchDocument,bookMedia:c.citationBookMedia,work:c.citationWork},onChange:t=>ie(i=>({...i,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),c.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:c.bookTitle,onChange:t=>ie(i=>({...i,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:c.bookPublisher,onChange:t=>ie(i=>({...i,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:c.bookPublicationPlace,onChange:t=>ie(i=>({...i,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:c.bookPublicationYear,onChange:t=>ie(i=>({...i,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:c.bookPages,onChange:t=>ie(i=>({...i,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:c.bookIsbn,onChange:t=>ie(i=>({...i,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:c.bookCover,onChange:t=>ie(i=>({...i,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:c.bookHeight,onChange:t=>ie(i=>({...i,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:c.bookLength,onChange:t=>ie(i=>({...i,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:c.bookWidth,onChange:t=>ie(i=>({...i,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:c.bookWeight,onChange:t=>ie(i=>({...i,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:c.bookCollection,onChange:t=>ie(i=>({...i,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:c.bookLocation,onChange:t=>ie(i=>({...i,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:c.bookWorkTitle,onChange:t=>ie(i=>({...i,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:c.bookWorkLanguage,onChange:t=>ie(i=>({...i,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:c.bookWorkOriginalLanguage,onChange:t=>ie(i=>({...i,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:c.bookWorkDoi,onChange:t=>ie(i=>({...i,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>ie(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),c.bookContributors.map((t,i)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:h=>ie(N=>({...N,bookContributors:N.bookContributors.map((V,ee)=>ee===i?{...V,contributorType:h.target.value,contributor:null}:V)})),children:["person","institution","collective"].map(h=>e.jsx("option",{value:h,children:Ge(a,h)},h))})]}),e.jsx(Ye,{libraryId:o,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:h=>ie(N=>({...N,bookContributors:N.bookContributors.map((V,ee)=>ee===i?{...V,contributor:h}:V)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:h=>ie(N=>({...N,bookContributors:N.bookContributors.map((V,ee)=>ee===i?{...V,role:h.target.value}:V)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>ie(h=>{const N=h.bookContributors.filter((V,ee)=>ee!==i);return N.length===0?{...h,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...h,bookContributors:N}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${i}`))]}),c.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:c.languageA,onChange:t=>ie(i=>({...i,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:c.languageB,onChange:t=>ie(i=>({...i,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:c.wordA,onChange:t=>ie(i=>({...i,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Je,autoAdvance:!0,onCommit:()=>{var t;return(t=Ke.current)==null?void 0:t.focus()}}),e.jsx(Ye,{libraryId:o,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:c.wordB,onChange:t=>ie(i=>({...i,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Ke,autoAdvance:!0,onCommit:()=>{var t;return(t=$e.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:c.translationTags,onChangeMultiple:t=>ie(i=>({...i,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:c.wordATags,onChangeMultiple:t=>ie(i=>({...i,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:c.wordBTags,onChangeMultiple:t=>ie(i=>({...i,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),c.groupType==="vocab"&&Ee&&e.jsx("p",{className:"cogita-help",children:Ee}),c.groupType==="vocab"&&Ae&&e.jsx("p",{className:"cogita-help",children:Ae}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:T,ref:$e,children:Q})})]}):null,ae?e.jsx("p",{className:"cogita-form-error",children:ae}):null]})})})})})]})})}const Br=a=>/\s/.test(a),Ft=a=>/[\p{L}\p{N}]/u.test(a),Dr=(a,n)=>{const s=n>0?a[n-1]:"",u=n<a.length?a[n]:"";if(!s||!u)return 0;const g=Br(s),j=Br(u);if(g||j)return 3;const x=Ft(s),L=Ft(u);return x!==L?2:!x&&!L?1:0},ir=(a,n,s,u,g)=>{const j=Math.max(u-n,s-u);for(let x=0;x<=j;x+=1){const L=u-x;if(L>=n&&L<=s&&Dr(a,L)>=g)return L;const A=u+x;if(A>=n&&A<=s&&Dr(a,A)>=g)return A}return null},nr=(a,n)=>{const s=n>0?a[n-1]:"",u=n<a.length?a[n]:"";return!s||!u?!0:Ft(s)!==Ft(u)},cn=(a,n,s,u)=>{const g=s-n,j=n+u,x=s-u;if(g<=u*2||x<=j)return null;const L=Math.floor((n+s)/2),A=ir(a,j,x,L,3);if(A!==null&&nr(a,A))return A;const C=ir(a,j,x,L,2);if(C!==null&&nr(a,C))return C;const o=ir(a,j,x,L,1);return o!==null&&nr(a,o)?o:null},pt=(a,n)=>{const s=Math.max(1,7),u=Math.max(s,13),g={},j=(A,C,o,I,m)=>{const b=String(I),q={id:b,start:A,end:C,text:a.slice(A,C),depth:o,index:I,parentId:m};if(g[b]=q,C-A>u){let U=cn(a,A,C,s);if(U!==null&&U>A&&U<C){const l=j(A,U,o+1,I*2+1,b),p=j(U,C,o+1,I*2+2,b);q.leftId=l.id,q.rightId=p.id}}return q},x=j(0,a.length,0,0),L=Object.values(g).sort((A,C)=>C.depth-A.depth||A.start-C.start).map(A=>A.id);return{text:a,rootId:x.id,nodes:g,order:L}},bt=(a,n,s,u,g,j,x)=>{const L=j==="reverse"?a.order.slice().sort((A,C)=>a.nodes[C].start-a.nodes[A].start||a.nodes[C].depth-a.nodes[A].depth):a.order;for(const A of L){if(x&&A===x||n.has(A))continue;const C=a.nodes[A];if(C){if(g&&(C.leftId||C.rightId)){const o=C.leftId?s[C.leftId]??0:u,I=C.rightId?s[C.rightId]??0:u;if((o+I)/2<u)continue}return C}}return null},ai=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function dn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o}){const I=`/#/cogita/library/${o}`,[m,b,q]=_r([]),[Y,U,l]=qr([]),[p,f]=r.useState(null),[ue,K]=r.useState(null),[w,Z]=r.useState(null),[B,ne]=r.useState(null),R=r.useMemo(()=>m.find(c=>c.id===p)??null,[m,p]);r.useEffect(()=>{let c=!0;return xi({libraryId:o}).then(ie=>{if(!c)return;const ae=ie.nodes.map(O=>{var Ce,le,re;return{id:O.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:O.payload&&typeof O.payload=="object"&&"label"in O.payload?String(O.payload.label):"Item",nodeType:O.nodeType,itemType:((Ce=O.payload)==null?void 0:Ce.itemType)??"info",itemId:((le=O.payload)==null?void 0:le.itemId)??null,infoType:((re=O.payload)==null?void 0:re.infoType)??null}}});b(ae),U(ie.edges.map(O=>({id:O.edgeId,source:O.fromNodeId,target:O.toNodeId})))}).catch(()=>{c&&(b([]),U([]))}),()=>{c=!1}},[o]),r.useEffect(()=>{yi({libraryId:o}).then(K).catch(()=>K(null))},[o,m,Y]);const W=r.useCallback(c=>{U(ie=>$t(c,ie))},[]),ge=()=>{const c=crypto.randomUUID();b(ie=>[...ie,{id:c,type:"default",position:{x:140+ie.length*40,y:120+ie.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},me=()=>{const c=crypto.randomUUID();b(ie=>[...ie,{id:c,type:"default",position:{x:180+ie.length*40,y:160+ie.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},he=async()=>{Z(null);try{const c=m.map(ae=>({nodeId:ae.id,nodeType:ae.data.nodeType,payload:{itemType:ae.data.itemType,itemId:ae.data.itemId??null,label:ae.data.label,infoType:ae.data.infoType??null}})),ie=Y.map(ae=>({edgeId:ae.id,fromNodeId:ae.source,toNodeId:ae.target}));await vi({libraryId:o,nodes:c,edges:ie}),Z(a.cogita.library.graph.saveSuccess)}catch{Z(a.cogita.library.graph.saveFail)}},D=c=>{R&&b(ie=>ie.map(ae=>ae.id===R.id?{...ae,data:{...ae.data,itemId:(c==null?void 0:c.infoId)??null,itemType:"collection",infoType:"collection",label:(c==null?void 0:c.label)??a.cogita.library.infoTypes.collection}}:ae))},oe=c=>{R&&b(ie=>ie.map(ae=>ae.id===R.id?{...ae,data:{...ae.data,itemId:(c==null?void 0:c.infoId)??null,itemType:"info",infoType:(c==null?void 0:c.infoType)??null,label:(c==null?void 0:c.label)??a.cogita.library.infoTypes.any}}:ae))};return r.useEffect(()=>{if(!R||R.data.nodeType!=="info"||R.data.infoType!=="quote"||!R.data.itemId){ne(null);return}let c=!0;return it({libraryId:o,infoId:R.data.itemId}).then(ie=>{if(!c)return;const ae=ie.payload,O=(ae==null?void 0:ae.text)??"";if(!O){ne(null);return}const Ce=pt(O),le=Object.values(Ce.nodes).sort((re,Ne)=>re.depth-Ne.depth||re.start-Ne.start).map(re=>({id:re.id,text:re.text,depth:re.depth}));ne({title:(ae==null?void 0:ae.title)??R.data.label,fragments:le})}).catch(()=>ne(null)),()=>{c=!1}},[o,R]),e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:I,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:he,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ge,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:me,children:a.cogita.library.actions.addInfo}),ue?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(ue.totalCollections))})}):null,w?e.jsx("p",{className:"cogita-help",children:w}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(pr,{nodes:m,edges:Y,onNodesChange:q,onEdgesChange:l,onConnect:W,onNodeClick:(c,ie)=>f(ie.id),fitView:!0,children:[e.jsx(fr,{gap:18,size:1}),e.jsx(xr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),R?e.jsxs("div",{className:"cogita-graph-inspector",children:[R.data.nodeType==="collection"?e.jsx(Ye,{libraryId:o,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:R.data.itemId?{id:R.data.itemId,label:R.data.label,infoType:"collection"}:null,onChange:D,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(Ye,{libraryId:o,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:R.data.itemId?{id:R.data.itemId,label:R.data.label,infoType:R.data.infoType??void 0}:null,onChange:oe,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),B?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:B.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:B.fragments.map(c=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:c.id}),e.jsx("span",{children:c.text})]},c.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function un({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o,collectionId:I}){const{libraryName:m}=qa(o),[b,q]=r.useState([]),[Y,U]=r.useState("loading"),[l,p]=r.useState("idle"),f=r.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ue=`/#/cogita/library/${o}`,K=()=>{U("loading"),Yr({libraryId:o}).then(B=>{q(B),U("idle")}).catch(()=>{q([]),U("error")})};r.useEffect(()=>{K()},[o]);const w=async B=>{try{await Qr({libraryId:o,shareId:B}),K()}catch{K()}},Z=async B=>{const ne=`${f}/${B}`;try{await navigator.clipboard.writeText(ne),p("copied")}catch{p("failed")}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:ue,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${ue}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Y==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):Y==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):b.filter(B=>!I||B.collectionId===I).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:b.filter(B=>!I||B.collectionId===I).map(B=>e.jsxs("div",{className:"cogita-share-row","data-state":B.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:B.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(B.createdUtc).toLocaleString(),B.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),B.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${f}/${B.shareCode}`}):null]}),B.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[B.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>Z(B.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>w(B.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},B.shareId))}),l==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):l==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function gn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o}){const{libraryName:I}=qa(o),[m,b]=r.useState(null),[q,Y]=r.useState(null),[U,l]=r.useState(null),[p,f]=r.useState(null),[ue,K]=r.useState(null),[w,Z]=r.useState(null),B=r.useRef(null),ne=ge=>{if(!Number.isFinite(ge))return"0 B";if(ge<1024)return`${ge} B`;const me=ge/1024;if(me<1024)return`${me.toFixed(1)} KB`;const he=me/1024;return he<1024?`${he.toFixed(1)} MB`:`${(he/1024).toFixed(1)} GB`},R=async()=>{b(null),K({loadedBytes:0,totalBytes:null,percent:null});try{b(a.cogita.library.overview.exporting);const ge=await wi(o,K),me=URL.createObjectURL(ge),he=document.createElement("a");he.href=me,he.download=`cogita-library-${I||o}.json`,he.click(),URL.revokeObjectURL(me),b(a.cogita.library.overview.exportReady)}catch{b(a.cogita.library.overview.exportFail)}finally{K(ge=>ge??{loadedBytes:0,totalBytes:null,percent:null})}},W=async ge=>{var he;Y(null),l(null),f(null);const me=(he=ge.target.files)==null?void 0:he[0];if(me)try{Y(a.cogita.library.overview.importing),Z({loadedBytes:0,totalBytes:me.size,percent:0});const D=await ji(o,me,Z,oe=>{const c=oe.stage==="infos"?a.cogita.library.overview.importStageInfos:oe.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;f(a.cogita.library.overview.importLiveProgress.replace("{stage}",c).replace("{done}",String(oe.processed)).replace("{total}",String(oe.total)).replace("{infos}",String(oe.infos)).replace("{connections}",String(oe.connections)).replace("{collections}",String(oe.collections)))});l({infos:D.infosImported,connections:D.connectionsImported,collections:D.collectionsImported}),Y(a.cogita.library.overview.importDone)}catch(D){const oe=D instanceof ki&&D.message?` ${D.message}`:"";Y(`${a.cogita.library.overview.importFail}${oe}`)}finally{B.current&&(B.current.value="")}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:I}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:R,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:B,type:"file",accept:"application/json",onChange:W})]})]}),ue?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:ue.percent??void 0,max:ue.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ne(ue.loadedBytes)).replace("{total}",ue.totalBytes?ne(ue.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,w?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:w.percent??void 0,max:w.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ne(w.loadedBytes)).replace("{total}",w.totalBytes?ne(w.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null,q?e.jsx("p",{className:"cogita-help",children:q}):null,p?e.jsx("p",{className:"cogita-help",children:p}):null,U?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(U.infos)).replace("{connections}",String(U.connections)).replace("{collections}",String(U.collections))}):null]})]})})})]})})}function hn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o}){const{libraryName:I}=qa(o),[m,b]=r.useState(""),[q,Y]=r.useState([]),U=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:I}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:l=>b(l.target.value),placeholder:a.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const l=m.trim();l&&(Y(p=>[{id:U(),name:l},...p]),b(""))},children:a.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[q.length===0?e.jsx("p",{children:a.cogita.library.modules.storyboardsEmpty}):null,q.map(l=>e.jsx("button",{type:"button",className:"ghost",children:l.name},l.id))]})]})]})})})]})})}function bn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o}){const{libraryName:I}=qa(o),[m,b]=r.useState(""),[q,Y]=r.useState([]),U=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:I}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:l=>b(l.target.value),placeholder:a.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const l=m.trim();l&&(Y(p=>[{id:U(),name:l},...p]),b(""))},children:a.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[q.length===0?e.jsx("p",{children:a.cogita.library.modules.textsEmpty}):null,q.map(l=>e.jsx("button",{type:"button",className:"ghost",children:l.name},l.id))]})]})]})})})]})})}function Kr({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o}){const{libraryName:I}=qa(o),m=`/#/cogita/library/${o}`,[b,q]=r.useState(""),[Y,U]=r.useState([]),[l,p]=r.useState("idle"),[f,ue]=r.useState(0),[K,w]=r.useState(null);r.useEffect(()=>{p("loading");const B=window.setTimeout(()=>{jt({libraryId:o,query:b.trim()||void 0,limit:30}).then(ne=>{U(ne.items),ue(ne.total),w(ne.nextCursor??null),p("ready")}).catch(()=>{U([]),ue(0),w(null),p("ready")})},240);return()=>window.clearTimeout(B)},[o,b]);const Z=async()=>{if(K){p("loading");try{const B=await jt({libraryId:o,query:b.trim()||void 0,limit:30,cursor:K});U(ne=>[...ne,...B.items]),w(B.nextCursor??null),ue(B.total),p("ready")}catch{p("ready")}}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:I}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${m}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:b,onChange:B=>q(B.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(Y.length)).replace("{total}",String(f||Y.length))}),e.jsx("span",{children:l==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:Y.length?Y.map(B=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${m}/collections/${B.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:B.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(B.itemCount))," ·"," ",B.notes||a.cogita.library.collections.noNotes]})]})},B.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${m}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),K?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Z,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const xe=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ka=(a,n,s,u)=>`${a}:${n}:${s??""}:${u??""}`;function mn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o,collectionId:I}){qa(o);const m=`/#/cogita/library/${o}`,[b,q]=r.useState(a.cogita.library.collections.defaultName),[Y,U]=r.useState(null),[l,p]=r.useState(0),[f,ue]=r.useState([]),[K,w]=r.useState("idle"),[Z,B]=r.useState(null),ne=r.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(l||f.length)),[a,f.length,l]);r.useEffect(()=>{Wt(o,I).then(W=>{q(W.name),U(W.notes??null),p(W.itemCount)}).catch(()=>{q(a.cogita.library.collections.defaultName),U(null)})},[o,I]),r.useEffect(()=>{w("loading"),Et({libraryId:o,collectionId:I,limit:40}).then(W=>{ue(W.items),B(W.nextCursor??null),p(W.total),w("ready")}).catch(()=>{ue([]),B(null),w("ready")})},[o,I]);const R=async()=>{if(Z){w("loading");try{const W=await Et({libraryId:o,collectionId:I,limit:40,cursor:Z});ue(ge=>[...ge,...W.items]),B(W.nextCursor??null),p(W.total),w("ready")}catch{w("ready")}}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:Y||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${m}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${m}/collections/${I}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${m}/collections/${I}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ne}),e.jsx("span",{children:K==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:f.length?f.map(W=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:W.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:W.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:W.label}),e.jsx("p",{className:"cogita-card-subtitle",children:W.description})]})},xe(W))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),Z?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:R,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${m}/collections/${I}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Va=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,s=a.filter(j=>j.correct).length,u=zt(wr(a));return{score:Math.round(Math.max(0,Math.min(100,u.knowness*100))*100)/100,total:n,correct:s,lastReviewedUtc:u.lastReviewedUtc??null}},pn=a=>{if(a.maskBase64)try{const n=Ti(a.maskBase64);if(!n.length)return a.correct?1:0;const s=n.reduce((u,g)=>u+g,0);return Math.max(0,Math.min(1,s/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},wr=a=>a.map(n=>({correctness:pn(n),createdUtc:n.createdUtc})),zt=(a,n=Date.now())=>{var l;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const u=a.slice().sort((p,f)=>p.createdUtc.localeCompare(f.createdUtc)).slice(-5),g=u.reduce((p,f)=>p+f.correctness,0)/u.length,j=5,x=2,L=.15;let A=0,C=0;for(let p=0;p<u.length;p+=1){const f=new Date(u[p].createdUtc).getTime(),ue=p===u.length-1?n:new Date(u[p+1].createdUtc).getTime(),K=Math.max(0,(ue-f)/(1e3*60)),w=1-Math.exp(-K/j);A+=w,u[p].correctness>.5&&(C+=L)}let o=g*A*x+C;const I=((l=u[u.length-1])==null?void 0:l.createdUtc)??null,m=I?Math.max(0,(n-new Date(I).getTime())/(1e3*60)):0,q=1/(1+Math.log1p(m/60));return o*=q,u.length===1&&u[0].correctness>.5&&(o+=5.44*Math.exp(-m/2)),{knowness:o,avgCorrectness:g,lastReviewedUtc:I}},kt=a=>{const n=a.slice();for(let s=n.length-1;s>0;s-=1){const u=Math.floor(Math.random()*(s+1));[n[s],n[u]]=[n[u],n[s]]}return n},Rt=a=>a[Math.floor(Math.random()*a.length)],fn=(a,n)=>{const s=new Map;return a.forEach(u=>s.set(u,Math.random())),a.sort((u,g)=>{const j=n(u)-n(g);return j!==0?j:(s.get(u)??0)-(s.get(g)??0)})},Ht=(a,n,s,u,g)=>{if(!a.length)return null;const j=a.filter(L=>!(g!=null&&g.has(xe(L))));if(j.length===0)return null;const x=j.filter(L=>xe(L)!==s);return Rt(x.length?x:j)},xn=(a,n,s,u,g)=>{if(!a.length)return null;let j=Number.POSITIVE_INFINITY;for(const C of a){const o=xe(C);if(s.has(o))continue;const I=n[o]??1;I<j&&(j=I)}if(!Number.isFinite(j))return null;const x=a.filter(C=>{const o=xe(C);return!s.has(o)&&(n[o]??1)===j}),L=x.filter(C=>!g||xe(C)!==g),A=u?L.filter(C=>!u.has(xe(C))):L;return A.length>0?Rt(A):L.length>0?Rt(L):g&&x.some(C=>xe(C)===g)?x.find(C=>xe(C)===g)??null:x.length?Rt(x):null},ti=(a,n,s,u,g)=>{const j=[],x=a.filter(A=>!g.has(xe(A))&&!s.has(xe(A))&&(n[xe(A)]??0)<1),L=fn(x,A=>n[xe(A)]??0);for(const A of L){if(j.length>=u)break;j.push(A),g.add(xe(A))}if(j.length<u){const A=kt(a.filter(C=>!g.has(xe(C))&&s.has(xe(C))));for(const C of A){if(j.length>=u)break;j.push(C),g.add(xe(C))}}return j},yn=(a,n,s,u)=>ti(a,n,s,u,new Set),jr=(a,n,s,u,g,j)=>{const x=Math.max(1,s.stackSize??n),A=kt(a).filter((q,Y,U)=>U.findIndex(l=>xe(l)===xe(q))===Y),C=yn(A,u,g,x),o=new Set,I=new Set,m=Ht(C,{},null,o,I),b=m?[m]:[];return m&&I.add(xe(m)),{queue:b,meta:{pool:A,active:C,knownessMap:u,unknownSet:g,outcomesById:j,asked:o,queued:I}}},br={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const u=kt(a).filter((g,j,x)=>x.findIndex(L=>xe(L)===xe(g))===j);return{queue:u.slice(0,Math.min(n,u.length)),meta:{}}},applyOutcome:a=>a},kr=(a,n,s,u)=>{const g=Math.max(1,s.stackSize??n),x=kt(a).filter((Y,U,l)=>l.findIndex(p=>xe(p)===xe(Y))===U),L={},A=new Set,C=new Set,o=new Set,I=Math.max(1,s.levels??1);x.forEach(Y=>{const U=xe(Y),l=u==null?void 0:u[U],p=typeof l=="number"&&Number.isFinite(l)?l:1;L[U]=Math.min(I,Math.max(1,Math.round(p)))});const m=[];if(x.length>0){const Y=new Map;x.forEach(l=>{var f;const p=L[xe(l)]??1;Y.has(p)||Y.set(p,[]),(f=Y.get(p))==null||f.push(l)});const U=Array.from(Y.keys()).sort((l,p)=>l-p);for(const l of U){if(m.length>=g)break;const p=kt(Y.get(l)??[]);for(const f of p){if(m.length>=g)break;m.push(f)}}}const b=Ht(m,L,null,A,C),q=b?[b]:[];return b&&C.add(xe(b)),{queue:q,meta:{pool:x,active:m,levelMap:L,asked:A,queued:C,wrongSinceCorrect:o}}},vn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,s)=>kr(a,n,s),applyOutcome:(a,n,s,u,g)=>{if(!n)return a;const j=Math.max(1,u.levels??1),x=a.meta.pool??[],L=a.meta.active??[],A={...a.meta.levelMap??{}},C=new Set(a.meta.asked??[]),o=new Set(a.meta.queued??[]),I=new Set(a.meta.wrongSinceCorrect??[]),m=xe(n);o.delete(m),C.add(m);const b=A[m]??1;g.correct?(A[m]=I.has(m)?1:Math.min(b+1,j),I.delete(m)):(A[m]=1,I.add(m));const q=g.correct?L.filter(l=>xe(l)!==m):L.slice();if(g.correct&&q.length<Math.max(1,u.stackSize??1)){const l=new Set(q.map(f=>xe(f))),p=xn(x,A,l,C,m);p&&q.push(p)}const Y=a.queue.slice(),U=Ht(q,A,m,C,o);return U&&(Y.push(U),o.add(xe(U))),{queue:Y,meta:{pool:x,active:q,levelMap:A,asked:C,queued:o,wrongSinceCorrect:I}}}},wn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,s)=>jr(a,n,s,{},new Set,{}),applyOutcome:(a,n,s,u,g)=>{if(!n)return a;const j=a.meta.pool??[],x=a.meta.active??[],L={...a.meta.knownessMap??{}},A=new Set(a.meta.unknownSet??[]),C={...a.meta.outcomesById??{}},o=new Set(a.meta.asked??[]),I=new Set(a.meta.queued??[]),m=xe(n);I.delete(m),o.add(m);const b={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},Y=(C[m]??[]).concat(b).sort((K,w)=>K.createdUtc.localeCompare(w.createdUtc)).slice(-5);C[m]=Y,A.delete(m);const U=Date.now();j.forEach(K=>{const w=xe(K),Z=C[w]??[];if(Z.length===0){L[w]=0,A.add(w);return}const B=zt(Z,U);L[w]=B.knowness});const l=x.slice();if((L[m]??0)>=1){const K=l.filter(w=>xe(w)!==m);l.length=0,l.push(...K)}const f=Math.max(1,u.stackSize??s);if(l.length<f){const K=new Set(l.map(Z=>xe(Z))),w=ti(j,L,A,f-l.length,K);l.push(...w)}const ue=a.queue.slice();if(ue.length===0||xe(ue[ue.length-1])===m){const K=Ht(l,{},m,o,I);K&&(ue.push(K),I.add(xe(K)))}return{queue:ue,meta:{pool:j,active:l,knownessMap:L,unknownSet:A,outcomesById:C,asked:o,queued:I}}}},ri={random:br,levels:vn,temporal:wn},jn=Object.values(ri),Tr=a=>{if(!a)return br;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?ri[n]:br},Jt=(a,n)=>{const s={...a.defaultSettings};return n&&Object.entries(n).forEach(([u,g])=>{typeof g=="number"&&Number.isFinite(g)&&(s[u]=g),typeof g=="string"&&(s[u]=g)}),a.settingsFields.forEach(u=>{var j;const g=s[u.key];if(u.type==="number"){if(typeof g!="number"||Number.isNaN(g)){s[u.key]=a.defaultSettings[u.key]??0;return}u.min!==void 0&&(s[u.key]=Math.max(u.min,s[u.key])),u.max!==void 0&&(s[u.key]=Math.min(u.max,s[u.key]));return}if(u.type==="select"){const x=((j=u.options)==null?void 0:j.map(L=>L.value))??[];(typeof g!="string"||x.length>0&&!x.includes(g))&&(s[u.key]=a.defaultSettings[u.key]??x[0]??"")}}),s},ii=(a,n)=>{const s={};return a.settingsFields.forEach(u=>{const g=n.get(u.key);if(g){if(u.type==="number"){const j=Number(g);Number.isNaN(j)||(s[u.key]=j);return}s[u.key]=g}}),Jt(a,s)},kn=(a,n)=>{const s=new URLSearchParams;return a.settingsFields.forEach(u=>{const g=n[u.key];(typeof g=="number"||typeof g=="string")&&s.set(u.key,String(g))}),s};function Tn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o,collectionId:I,revisionId:m}){const{libraryName:b}=qa(o),q=`/#/cogita/library/${o}`,[Y,U]=r.useState(a.cogita.library.collections.defaultName),[l,p]=r.useState(""),[f,ue]=r.useState(20),[K,w]=r.useState("random"),[Z,B]=r.useState({}),[ne,R]=r.useState("exact"),[W,ge]=r.useState([]),[me,he]=r.useState(null),[D,oe]=r.useState([]),[c,ie]=r.useState("idle"),[ae,O]=r.useState(null),[Ce,le]=r.useState("idle"),[re,Ne]=r.useState("idle"),[Ee,Te]=r.useState("idle"),Ae=r.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Me=r.useMemo(()=>Tr(K),[K]),Je=r.useMemo(()=>Jt(Me,Z),[Me,Z]),Ke=r.useMemo(()=>kn(Me,Je).toString(),[Me,Je]);r.useEffect(()=>{Wt(o,I).then(_=>U(_.name)).catch(()=>U(a.cogita.library.collections.defaultName))},[o,I]),r.useEffect(()=>{m&&Ni({libraryId:o,collectionId:I,revisionId:m}).then(_=>{p(_.name),w(_.mode||"random"),R(_.check||"exact"),ue(_.limit||20),B(_.revisionSettings??{})}).catch(()=>{p("")})},[I,o,m]),r.useEffect(()=>{Li({libraryId:o}).then(_=>{ge(_),!me&&_.length>0&&he(_[0].roleId)}).catch(()=>{ge([])})},[o]);const $e=()=>{Ne("loading"),Yr({libraryId:o}).then(_=>{oe(_),Ne("idle")}).catch(()=>{oe([]),Ne("error")})};r.useEffect(()=>{$e()},[o]);const ze=async()=>{ie("working"),le("idle");try{const _=await Mi({libraryId:o,collectionId:I,revisionType:Me.id,revisionSettings:Je,mode:K,check:ne,limit:f});O(`${Ae}/${_.shareCode}${Ke?`?${Ke}`:""}`),ie("ready"),$e()}catch{ie("error")}},sa=async()=>{if(m){Te("saving");try{await Ci({libraryId:o,collectionId:I,revisionId:m,name:l||Y,revisionType:Me.id,revisionSettings:Je,mode:K,check:ne,limit:f}),Te("saved")}catch{Te("error")}}},ea=async()=>{if(ae)try{await navigator.clipboard.writeText(ae),le("copied")}catch{le("failed")}},k=async _=>{try{await Qr({libraryId:o,shareId:_}),$e()}catch{$e()}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:Y}),e.jsx("p",{className:"cogita-library-subtitle",children:b})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:q,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${q}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${q}/collections/${I}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${q}/collections/${I}/revision/run?mode=${encodeURIComponent(K)}&check=${encodeURIComponent(ne)}&limit=${f}${Ke?`&${Ke}`:""}${me?`&reviewer=${encodeURIComponent(me)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:l,onChange:_=>p(_.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:K,onChange:_=>w(_.target.value),children:jn.map(_=>e.jsx("option",{value:_.id,children:a.cogita.library.revision[_.labelKey]},_.id))})]}),Me.settingsFields.map(_=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[_.labelKey]}),_.type==="select"?e.jsx("select",{value:String(Je[_.key]??""),onChange:Le=>B(ke=>({...ke,[_.key]:Le.target.value})),children:(_.options??[]).map(Le=>e.jsx("option",{value:Le.value,children:a.cogita.library.revision[Le.labelKey]},Le.value))}):e.jsx("input",{type:"number",min:_.min,max:_.max,step:_.step,value:Je[_.key]??0,onChange:Le=>B(ke=>({...ke,[_.key]:Number(Le.target.value||0)}))})]},_.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),Me.id!=="levels"&&Me.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:f,onChange:_=>ue(Number(_.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:me??"",onChange:_=>he(_.target.value||null),children:W.map(_=>e.jsx("option",{value:_.roleId,children:_.label},_.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[m?e.jsx("button",{type:"button",className:"cta ghost",onClick:sa,disabled:Ee==="saving",children:Ee==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${q}/collections/${I}/revision/run?mode=${encodeURIComponent(K)}&check=${encodeURIComponent(ne)}&limit=${f}${Ke?`&${Ke}`:""}${me?`&reviewer=${encodeURIComponent(me)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Ee==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),ae?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:ae,readOnly:!0})]}):null,c==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,Ce==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):Ce==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:ze,disabled:c==="working",children:c==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),ae?e.jsx("button",{type:"button",className:"cta ghost",onClick:ea,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),re==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):D.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:D.map(_=>e.jsxs("div",{className:"cogita-share-row","data-state":_.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:_.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(_.createdUtc).toLocaleString(),_.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),_.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>k(_.shareId),children:a.cogita.library.revision.shareRevokeAction})]},_.shareId))})]})]})]})]})})})]})})}function ni({copy:a,currentCard:n,currentTypeLabel:s,prompt:u,languages:g,answer:j,onAnswerChange:x,computedExpected:L,computedAnswers:A,onComputedAnswerChange:C,answerTemplate:o,outputVariables:I,variableValues:m,computedFieldFeedback:b,feedback:q,canAdvance:Y,quoteContext:U,quotePlaceholder:l,onCheckAnswer:p,onSkip:f,onLanguageSelect:ue,onMarkReviewed:K,onAdvance:w,showCorrectAnswer:Z,setShowCorrectAnswer:B,onRevealCorrect:ne,answerMask:R,expectedAnswer:W,hasExpectedAnswer:ge,handleComputedKeyDown:me,answerInputRef:he,computedInputRefs:D,scriptMode:oe,setScriptMode:c,matchPairs:ie,matchLeftOrder:ae,matchRightOrder:O,matchSelection:Ce,matchActiveLeft:le,matchActiveRight:re,matchFeedback:Ne,onMatchLeftSelect:Ee,onMatchRightSelect:Te}){const Ae=r.useMemo(()=>{var Q;const k=!o&&L.length===2?`The {${L[0].key}} is of type {${L[1].key}}`:null,_=o??k;if(!_)return null;const Le=new Map(L.map(t=>[t.key,t.expected])),ke=new Set,pe=[],Re=/\{([^}]+)\}/g;let Ue=0,Be,_e=null;for(;(Be=Re.exec(_))!==null;){const t=_.slice(Ue,Be.index);t&&pe.push({type:"text",value:t});const i=((Q=Be[1])==null?void 0:Q.trim())??"",h=i&&Le.has(i)?i:i&&I&&I[i]?I[i]:null;i&&ke.add(i),h&&ke.add(h),h&&Le.has(h)?(pe.push({type:"input",value:h}),_e||(_e=h)):i&&m&&m[i]!==void 0?pe.push({type:"text",value:m[i]}):pe.push({type:"text",value:Be[0]}),Ue=Be.index+Be[0].length}const v=_.slice(Ue);return v&&pe.push({type:"text",value:v}),L.filter(t=>!ke.has(t.key)).length>0?null:{parts:pe,expectedByKey:Le,firstInputKey:_e}},[o,L,I,m]),Me=()=>{if(!Ae)return null;const{parts:k,expectedByKey:_,firstInputKey:Le}=Ae;return e.jsx("div",{className:"cogita-revision-inline-answer",children:k.map((ke,pe)=>{var Re,Ue;return ke.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:ke.value},`text-${pe}`):e.jsx("input",{ref:Be=>{D.current[ke.value]=Be},autoFocus:ke.value===Le,value:A[ke.value]??"",onChange:Be=>C(ke.value,Be.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":b[ke.value]??(q==="correct"?"correct":q==="incorrect"?"incorrect":void 0),onKeyDown:Be=>ze(Be)||me(Be),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Re=A[ke.value])==null?void 0:Re.length)??0,((Ue=_.get(ke.value))==null?void 0:Ue.length)??6)}ch`}},`input-${ke.value}-${pe}`)})})},Je=r.useMemo(()=>{const k=new Map;return(ie??[]).forEach(_=>k.set(_.leftId,_)),k},[ie]),Ke=r.useMemo(()=>{const k=new Map;return(ie??[]).forEach(_=>k.set(_.rightId,_)),k},[ie]);r.useEffect(()=>{var pe;if(n.cardType!=="info"||n.infoType!=="computed"||L.length===0)return;const k=typeof document<"u"?document.activeElement:null;if(k&&(k.tagName==="INPUT"||k.tagName==="TEXTAREA"))return;const _=(Ae==null?void 0:Ae.firstInputKey)??((pe=L[0])==null?void 0:pe.key);if(!_)return;const Le=D.current[_];if(!Le)return;const ke=requestAnimationFrame(()=>{Le.focus()});return()=>cancelAnimationFrame(ke)},[n,L,Ae]);const $e=(()=>{const k=[W??"",...L.map(ke=>ke.expected??"")].join(""),_=[j,...Object.values(A)].join(""),Le=`${k}${_}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Le)})(),ze=k=>k.ctrlKey&&(k.key==="^"||k.key==="6")?(k.preventDefault(),c(_=>_==="super"?null:"super"),!0):k.ctrlKey&&(k.key==="_"||k.key==="-")?(k.preventDefault(),c(_=>_==="sub"?null:"sub"),!0):!1,sa=()=>{if(!W||!R)return W??"";const k=W.split(""),_=Array.from(R),Le=_.length>0?_.reduce((ke,pe)=>ke+pe,0)/_.length:127;return k.map((ke,pe)=>{const Re=_[pe]??Le,Ue=Math.max(0,Math.min(255,Math.round(Re)));let Be=255,_e=0;return Ue<=127?_e=Math.round(Ue/127*255):(_e=255,Be=Math.round(255*(1-(Ue-127)/128))),e.jsx("span",{style:{color:`rgb(${Be}, ${_e}, 0)`},children:ke},`mask-${pe}`)})},ea=n.cardType==="info"&&n.infoType==="quote"?(U==null?void 0:U.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:s}),e.jsx("strong",{children:ea})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&ie?e.jsxs("div",{className:"cogita-revision-body",children:[u?e.jsx("h2",{children:u}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(ae??[]).map(k=>{const _=Je.get(k);if(!_)return null;const Le=(Ce==null?void 0:Ce[k])??null,ke=(Ne==null?void 0:Ne[k])??null,pe=le===k;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":pe,"data-state":ke??void 0,"data-locked":Le?"true":void 0,onClick:()=>Ee==null?void 0:Ee(k),children:[e.jsx("span",{children:_.leftLabel}),Le&&Z?e.jsx("em",{children:"✓"}):null]},k)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(O??[]).map(k=>{const _=Ke.get(k);if(!_)return null;const Le=Object.values(Ce??{}).includes(k),ke=re===k;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Le||ke,"data-locked":Le?"true":void 0,onClick:()=>Te==null?void 0:Te(k),children:e.jsx("span",{children:_.rightLabel})},k)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:p,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:he,value:j,onChange:k=>x(k.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":q==="correct"?"correct":q==="incorrect"?"incorrect":void 0,onKeyDown:k=>{k.key==="Enter"&&(k.preventDefault(),k.stopPropagation(),Y?w():p())}})]}),$e?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":oe==="super",onClick:()=>c(k=>k==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":oe==="sub",onClick:()=>c(k=>k==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:p,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,o?null:e.jsx(hr,{value:u??"",mode:"auto"}),L.length>0?(()=>{const k=Me();return k?e.jsx("div",{className:"cogita-inline-answer-wrap",children:k}):e.jsx("div",{className:"cogita-form-grid",children:L.map((_,Le)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:_.key}),e.jsx("textarea",{ref:ke=>{D.current[_.key]=ke},autoFocus:Le===0,value:A[_.key]??"",onChange:ke=>C(_.key,ke.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":b[_.key]??(q==="correct"?"correct":q==="incorrect"?"incorrect":void 0),onKeyDown:ke=>ze(ke)||me(ke)})]},_.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:he,value:j,onChange:k=>x(k.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":q==="correct"?"correct":q==="incorrect"?"incorrect":void 0,onKeyDown:k=>{ze(k)||k.key==="Enter"&&(k.preventDefault(),k.stopPropagation(),Y?w():p())}})]})}),$e?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":oe==="super",onClick:()=>c(k=>k==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":oe==="sub",onClick:()=>c(k=>k==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:p,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&U?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(U.completed)).replace("{total}",String(U.total))}),e.jsx("p",{className:"cogita-quote-text",children:U.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:he,value:j,onChange:k=>x(k.target.value),placeholder:l??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":q==="correct"?"correct":q==="incorrect"?"incorrect":void 0,onKeyDown:k=>{k.key==="Enter"&&(k.preventDefault(),k.stopPropagation(),Y?w():p())}})]}),e.jsx("p",{className:"cogita-quote-text",children:U.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:p,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(k=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ue(k.label),children:k.label},k.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:K,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}),q&&e.jsx("div",{className:"cogita-revision-feedback","data-state":q,children:q==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),q==="incorrect"&&ge?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>B(k=>{const _=!k;return _&&ne(),_}),children:a.cogita.library.revision.showAnswer}),Z?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),L.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[L.map(k=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:k.key}),e.jsx("span",{children:k.expected})]},k.key)),W?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:W})]}):null]}):e.jsx("p",{children:R?sa():W})]}):null]}):null,Y?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:w,children:a.cogita.library.revision.nextQuestion})}):null]})}const or=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function oi({outcomes:a}){const[n,s]=r.useState("day"),u=r.useMemo(()=>{const g=or.find(L=>L.id===n)??or[1],j=Date.now()-g.ms,x=a.filter(L=>new Date(L.createdUtc).getTime()>=j);return Va(x)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:or.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>s(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[u.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[u.correct," / ",u.total]})]})}const Nn="cogita-revision",Ln=1,Bt="outcomes",Cn=()=>new Promise((a,n)=>{const s=indexedDB.open(Nn,Ln);s.onupgradeneeded=()=>{const u=s.result;if(!u.objectStoreNames.contains(Bt)){const g=u.createObjectStore(Bt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},s.onerror=()=>n(s.error),s.onsuccess=()=>a(s.result)}),Nt=async(a,n)=>{const s=await Cn();return new Promise((u,g)=>{const j=s.transaction(Bt,a),x=j.objectStore(Bt);n(x).then(u).catch(g),j.onerror=()=>g(j.error)})},si=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(s=>s.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Mn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const s=si();return localStorage.setItem(a,s),s},Sn=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),s=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(s)),s},li=(a,n,s,u)=>Ka(a,n,s,u),Dt=async a=>{const n=Mn(),s=Sn(),u=new Date().toISOString(),g={...a,clientId:n,clientSequence:s,createdUtc:u,id:si(),pending:!0};return await Nt("readwrite",j=>new Promise((x,L)=>{const A={...g,itemKey:li(g.itemType,g.itemId,g.checkType,g.direction)},C=j.add(A);C.onsuccess=()=>x(),C.onerror=()=>L(C.error)})),g},Kt=async(a,n,s,u)=>{if(!n)return[];try{const g=li(a,n,s,u);return await Nt("readonly",j=>new Promise((x,L)=>{const C=j.index("byItem").getAll(g);C.onsuccess=()=>{const I=(C.result??[]).map(m=>({itemType:m.itemType,itemId:m.itemId,checkType:m.checkType??null,direction:m.direction??null,revisionType:m.revisionType,evalType:m.evalType,correct:m.correct,createdUtc:m.createdUtc,maskBase64:m.maskBase64,payloadBase64:m.payloadBase64,payloadHashBase64:m.payloadHashBase64,clientId:m.clientId,clientSequence:m.clientSequence,personRoleId:m.personRoleId??null})).sort((m,b)=>m.createdUtc.localeCompare(b.createdUtc));x(I)},C.onerror=()=>L(C.error)}))}catch{return[]}},Oa=async()=>{try{return await Nt("readonly",a=>new Promise((n,s)=>{const u=a.getAll();u.onsuccess=()=>{const j=(u.result??[]).map(x=>({itemType:x.itemType,itemId:x.itemId,checkType:x.checkType??null,direction:x.direction??null,revisionType:x.revisionType,evalType:x.evalType,correct:x.correct,createdUtc:x.createdUtc,maskBase64:x.maskBase64,payloadBase64:x.payloadBase64,payloadHashBase64:x.payloadHashBase64,clientId:x.clientId,clientSequence:x.clientSequence,personRoleId:x.personRoleId??null}));n(j)},u.onerror=()=>s(u.error)}))}catch{return[]}},In=async(a=100)=>{try{return await Nt("readonly",n=>new Promise((s,u)=>{const j=n.index("byPending").getAll(!0);j.onsuccess=()=>{const x=j.result??[];s(x.slice(0,a))},j.onerror=()=>u(j.error)}))}catch{return[]}},Pn=async a=>{if(a.length!==0)try{await Nt("readwrite",n=>new Promise((s,u)=>{let g=a.length;a.forEach(j=>{const x=n.get(j);x.onsuccess=()=>{const L=x.result;if(L){L.pending=!1;const A=n.put(L);A.onsuccess=()=>{g-=1,g===0&&s()},A.onerror=()=>u(A.error)}else g-=1,g===0&&s()},x.onerror=()=>u(x.error)})}))}catch{}},sr=async(a,n)=>{const s=await In(200);if(s.length===0)return;const u=new Map;s.forEach(g=>{var x;const j=g.personRoleId??n??"";u.has(j)||u.set(j,[]),(x=u.get(j))==null||x.push(g)});for(const[g,j]of u.entries()){const x=j.map(L=>({itemType:L.itemType,itemId:L.itemId,checkType:L.checkType??null,direction:L.direction??null,revisionType:L.revisionType,evalType:L.evalType,correct:L.correct,clientId:L.clientId,clientSequence:L.clientSequence,maskBase64:L.maskBase64??null,payloadHashBase64:L.payloadHashBase64??null,payloadBase64:L.payloadBase64??null,personRoleId:g||null}));try{await Si({libraryId:a,outcomes:x}),await Pn(j.map(L=>L.id))}catch{}}},Vr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Rn=(a,n)=>{const s=Math.max(a.length,n.length,1),u=Math.abs(a.length-n.length);return Math.max(0,1-u/s)},$n=(a,n)=>{const s=new Uint8Array(a.length),u=Rn(a,n);for(let g=0;g<a.length;g+=1){const j=a[g]===(n[g]??"")?128:0,x=a.length-1-g,L=n.length-1-g,A=a[x]===(n[L]??"")?127:0,C=Math.round((j+A)*u);s[g]=Math.max(0,Math.min(255,C))}return s},It=(a,n)=>a===n||(Vr[a]??[]).includes(n)?!0:(Vr[n]??[]).includes(a),Vt=(a,n)=>{const s=new Uint8Array(a.length);if(!a.length)return s;const u=[];for(let j=0;j<=a.length-3;j+=1)u.push({index:j,text:a.slice(j,j+3)});let g=!1;return u.forEach(j=>{for(let x=0;x<=n.length-3;x+=1){const L=n.slice(x,x+3);let A=0;for(let b=0;b<3;b+=1)It(j.text[b],L[b])&&(A+=1);if(A<2)continue;let C=j.index-1,o=x-1;for(;C>=0&&o>=0;){const b=a[C],q=n[o];if(b===q){s[C]=Math.max(s[C],255),C-=1,o-=1,g=!0;continue}if(It(b,q)){s[C]=Math.max(s[C],127),C-=1,o-=1,g=!0;continue}if(C>0&&a[C-1]===q){s[C]=Math.max(s[C],0),C-=1,g=!0;continue}if(o>0&&a[C]===n[o-1]){o-=1,g=!0;continue}break}for(let b=0;b<3;b+=1){const q=j.index+b,Y=j.text[b],U=L[b],l=Y===U?255:It(Y,U)?127:0;s[q]=Math.max(s[q],l),g=!0}let I=j.index+3,m=x+3;for(;I<a.length&&m<n.length;){const b=a[I],q=n[m];if(b===q){s[I]=Math.max(s[I],255),I+=1,m+=1,g=!0;continue}if(It(b,q)){s[I]=Math.max(s[I],127),I+=1,m+=1,g=!0;continue}if(I+1<a.length&&a[I+1]===q){s[I]=Math.max(s[I],0),I+=1,g=!0;continue}if(m+1<n.length&&a[I]===n[m+1]){m+=1,g=!0;continue}break}}}),g?s:$n(a,n)},mt=(a,n,s)=>{const u=a.trim().toLowerCase(),g=n.trim().toLowerCase();return Vt(u,g)},ft=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),ci=(a,n,s)=>{const u=ft(a),g=ft(n);return Vt(u,g)},ja=a=>a.trim().toLowerCase(),En=a=>a==="reverse"?"reverse":"forward",Tt=(a,n)=>`${a}|${n}`,Ta=a=>{if(!a)return null;const[n,s]=a.split("|",2);return(n==="forward"||n==="reverse")&&s?{mode:n,fragmentId:s}:{mode:"forward",fragmentId:a}},Ot=(a,n)=>{var u;const s=Ta(n);return s?s.fragmentId&&n?(a??null)===n:(((u=Ta(a))==null?void 0:u.mode)??"forward")===s.mode:!0},pa=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},di=(a,n)=>{if((pa(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const u=pa(a.childCheckType),g=pa(a.childDirection),j=pa(n.checkType),x=pa(n.direction);return!(u&&u!==j||g&&g!==x)},An={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Fn={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},_t=(a,n,s)=>{if(!s||!n.startsWith(a))return n;const u=n.slice(a.length);if(!u)return n;const g=s==="super"?An:Fn,j=u.split("").map(x=>g[x]??x).join("");return a+j},qt=(a,n,s)=>{var x,L,A;if(!a)return((x=n[0])==null?void 0:x.key)??null;const u=new Set(n.map(C=>C.key)),g=/\{([^}]+)\}/g;let j;for(;(j=g.exec(a))!==null;){const C=((L=j[1])==null?void 0:L.trim())??"";if(!C)continue;if(u.has(C))return C;const o=s==null?void 0:s[C];if(o&&u.has(o))return o}return((A=n[0])==null?void 0:A.key)??null},mr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const s=n.description??"";if(!s.trim())return[n];const u=Ta(n.direction),g=(u==null?void 0:u.mode)??En(n.direction),j=pt(s),x=Object.keys(j.nodes);return x.length===0?[n]:x.map(L=>({...n,checkType:"quote-fragment",direction:Tt(g,L)}))});function Bn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o,collectionId:I,revisionId:m}){const b=yr(),q=`/#/cogita/library/${o}`,Y=r.useMemo(()=>new URLSearchParams(b.search),[b.search]),U=Math.max(1,Number(Y.get("limit")??20)),l=Y.get("mode")??"random",p=r.useMemo(()=>Tr(l),[l]),f=r.useMemo(()=>Jt(p,ii(p,Y)),[p,Y]),ue=Y.get("check")??"exact",K=Y.get("reviewer"),w=r.useMemo(()=>a.cogita.library.revision[p.labelKey]??l,[a,l,p]),Z=r.useMemo(()=>ue==="exact"?a.cogita.library.revision.checkValue:ue,[a,ue]),[B,ne]=r.useState(a.cogita.library.collections.defaultName),[R,W]=r.useState([]),[ge,me]=r.useState([]),[he,D]=r.useState("idle"),[oe,c]=r.useState({current:0,total:0}),[ie,ae]=r.useState(0),[O,Ce]=r.useState(""),[le,re]=r.useState(null),[Ne,Ee]=r.useState(null),[Te,Ae]=r.useState(null),[Me,Je]=r.useState(null),[Ke,$e]=r.useState([]),[ze,sa]=r.useState({}),[ea,k]=r.useState({}),[_,Le]=r.useState(null),[ke,pe]=r.useState(null),[Re,Ue]=r.useState(null),[Be,_e]=r.useState(null),[v,T]=r.useState(null),[Q,t]=r.useState({}),i=r.useRef(0),[h,N]=r.useState(null),V=r.useRef(null),ee=r.useRef(null),[te,G]=r.useState(null),[de,se]=r.useState(!1),[we,aa]=r.useState(null),[qe,ia]=r.useState([]),[Oe,We]=r.useState(null),Fe=r.useRef(null),Xe=r.useRef(null),[Sa,la]=r.useState(null),[Ra,ca]=r.useState(0),xa=r.useRef(null),Ba=r.useRef({}),[ya,oa]=r.useState(!1),[E,Pe]=r.useState({}),[Ve,ta]=r.useState([]),Ze=r.useRef(new Map),[na,ba]=r.useState(new Set),[da,De]=r.useState(!1),ra=r.useRef(null),Ia=r.useRef(new Set),$a=r.useRef({}),je=R[ie]??null,ve=(je==null?void 0:je.checkType)==="translation-match"&&v,Ua=r.useRef(new Map),La=r.useRef(new Map),_a=r.useRef(new Map),Wa=r.useRef(new Map),ma=r.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?Ge(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),za=r.useMemo(()=>{var y;return p.id!=="levels"?R.length:((y=E.pool)==null?void 0:y.length)??p.getFetchLimit(U,f)},[E,f,p,R.length,U]),nt=p.getProgressTotal?p.getProgressTotal(R,E,U,f):p.id==="levels"?Math.min(U,za):R.length,ot=nt?Math.min(ie+1,nt):0,Ea=Math.max(1,Number(f.tries??1)),ka=f.compare??"anchors",Ha=Math.max(0,Math.min(100,Number(f.minCorrectness??0))),fa=(f.considerDependencies??"on")==="on",ua=Math.max(0,Math.min(100,Number(f.dependencyThreshold??85))),Pa=d=>{const y=d.slice();for(let P=y.length-1;P>0;P-=1){const M=Math.floor(Math.random()*(P+1));[y[P],y[M]]=[y[M],y[P]]}return y},Qa=d=>d.length?d.reduce((P,M)=>P+M,0)/d.length/255*100:0,Ja=d=>Qa(d)>=Ha,st=async()=>{const d=await Oa(),y=new Map,P=new Map,M=new Map;d.forEach(F=>{const H=`${F.itemType}:${F.itemId}`,ce=Ka(F.itemType,F.itemId,F.checkType,F.direction);if(y.has(H)||y.set(H,[]),y.get(H).push(F),P.has(ce)||P.set(ce,[]),P.get(ce).push(F),F.itemType==="info"&&F.checkType==="quote-fragment"&&F.direction){const be=`${F.itemId}:${F.direction}`;M.has(be)||M.set(be,[]),M.get(be).push(F)}});const J=new Map,S=new Map,z=new Map;return y.forEach((F,H)=>J.set(H,Va(F).score)),P.forEach((F,H)=>S.set(H,Va(F).score)),M.forEach((F,H)=>z.set(H,Va(F).score)),{itemKnowness:J,cardKnowness:S,fragmentKnowness:z}},Yt=async d=>{const y=[];let P=null;for(;;){const M=await Et({libraryId:o,collectionId:d,limit:200,cursor:P});if(y.push(...M.items),!M.nextCursor)break;P=M.nextCursor}return mr(y)},xt=async(d,y)=>{if(Ze.current.has(d))return Ze.current.get(d)??0;const P=await Yt(d);if(P.length===0)return Ze.current.set(d,0),0;const J=P.reduce((S,z)=>{const F=xe(z);return S+(y.get(F)??0)},0)/P.length;return Ze.current.set(d,J),J},Qt=(d,y)=>{if(!fa||d.cardType!=="info"||d.infoType!=="quote"||d.checkType!=="quote-fragment")return!0;const P=Ta(d.direction);if(!(P!=null&&P.fragmentId))return!0;const M=d.description??"";if(!M.trim())return!0;const S=pt(M).nodes[P.fragmentId];if(!S||!S.leftId&&!S.rightId)return!0;const z=[S.leftId,S.rightId].filter(ce=>!!ce);if(z.length===0)return!0;const F=z.map(ce=>{const be=Ka("info",d.cardId,"quote-fragment",Tt(P.mode,ce));return y.get(be)??0});return F.reduce((ce,be)=>ce+be,0)/F.length>=ua},lt=async d=>{const y=E,P=d.concat(y.active??[]).concat(y.pool??[]).filter((F,H,ce)=>ce.findIndex(be=>xe(be)===xe(F))===H);if(!fa){ba(new Set(P.map(xe)));return}const{itemKnowness:M,cardKnowness:J}=await st(),S=Ve.filter(F=>pa(F.childItemType)==="collection"&&F.childItemId===I&&!pa(F.childCheckType)&&!pa(F.childDirection)),z=new Set;for(const F of P){if(F.cardType!=="info"){z.add(xe(F));continue}if(!Qt(F,J))continue;const H=Ve.filter(ye=>di(ye,F)).concat(S);if(H.length===0){z.add(xe(F));continue}let ce=0;for(const ye of H)if(pa(ye.parentItemType)==="collection")ce+=await xt(ye.parentItemId,J);else if(pa(ye.parentCheckType)||pa(ye.parentDirection)){const fe=pa(ye.parentCheckType),Se=pa(ye.parentDirection),Ie=Ka(ye.parentItemType,ye.parentItemId,fe,Se);ce+=J.get(Ie)??0}else{const fe=`${ye.parentItemType}:${ye.parentItemId}`;ce+=M.get(fe)??0}ce/H.length>=ua&&z.add(xe(F))}ba(z)},Gt=d=>{for(let y=d;y<R.length;y+=1){const P=R[y];if(P&&(!fa||P.cardType!=="info"||na.has(xe(P))))return y}return-1},Ca=d=>!fa||d.cardType!=="info"||na.has(xe(d)),ct=d=>{if(p.id!=="temporal"&&p.id!=="levels")return null;const y=E,P=(y.active??[]).concat(y.pool??[]),M=new Set;for(const J of P){const S=xe(J);if(!(M.has(S)||d.has(S))&&(M.add(S),Ca(J)))return J}return null},Aa=r.useMemo(()=>{if(p.id!=="levels")return null;const d=E,y=d.pool??[],P=d.active??[],M=d.levelMap??{},J=Math.max(1,Number(f.levels??1)),S=Array.from({length:J},()=>0),z=new Set(P.map(be=>xe(be)));y.forEach(be=>{const ye=Math.min(J,Math.max(1,M[xe(be)]??1));S[ye-1]+=1});const F=y.length||1,H=S.map(be=>be/F*100),ce=je?M[xe(je)]??1:null;return{counts:S,percentages:H,currentLevel:ce,levelsCount:J,activeCount:P.length,poolCount:y.length,activeSet:z}},[E,f,p,je]),va=r.useMemo(()=>{if(p.id!=="temporal")return null;const d=E,y=d.pool??[],P=d.active??[],M=d.knownessMap??{},J=new Set(d.unknownSet??[]);let S=0;y.forEach(H=>{(M[xe(H)]??0)>1&&(S+=1)});const z=J.size,F=P.map(H=>({id:xe(H),value:J.has(xe(H))?0:Math.max(0,Math.min(1,M[xe(H)]??0))}));return{knownCount:S,unknownCount:z,dots:F}},[E,p]),dt=r.useMemo(()=>{if(!fa)return 0;const d=E;return R.concat(d.active??[]).concat(d.pool??[]).filter((P,M,J)=>J.findIndex(S=>xe(S)===xe(P))===M).filter(P=>P.cardType==="info"&&!na.has(xe(P))).length},[fa,E,R,na]);r.useEffect(()=>{if(!fa||he!=="ready")return;const d=E,P=R.concat(d.active??[]).concat(d.pool??[]).filter((S,z,F)=>F.findIndex(H=>xe(H)===xe(S))===z).filter(S=>S.cardType!=="info"||na.has(xe(S))).length,M=Fe.current;if(Fe.current=P,M===null||P<=M)return;const J=P-M;We(`New card available (+${J})`),Xe.current&&window.clearTimeout(Xe.current),Xe.current=window.setTimeout(()=>We(null),2200)},[fa,he,E,R,na]),r.useEffect(()=>()=>{Xe.current&&window.clearTimeout(Xe.current)},[]);const wa=(d,y)=>{const P=p.applyOutcome({queue:R,meta:E},je,U,f,{correct:d,correctness:y,createdUtc:new Date().toISOString()});W(P.queue),Pe(P.meta);const M=P.queue[ie+1];M&&yt(M,ie+1)};r.useEffect(()=>{Wt(o,I).then(d=>ne(d.name)).catch(()=>ne(a.cogita.library.collections.defaultName))},[o,I]),r.useEffect(()=>{Ut({libraryId:o,type:"language"}).then(d=>me(d)).catch(()=>me([]))},[o]),r.useEffect(()=>{Jr({libraryId:o}).then(d=>ta(d.items??[])).catch(()=>ta([]))},[o]),r.useEffect(()=>{sr(o,K)},[o,K]),r.useEffect(()=>{lt(R)},[R,Ve,fa,ua,I]),r.useEffect(()=>{if(!je||!fa){De(!1);return}if(je.cardType!=="info"||na.has(xe(je))){De(!1);return}const d=Gt(ie+1);if(d>=0){De(!1),ae(d);return}if(p.id==="temporal"||p.id==="levels"){const y=R.slice(0,ie+1),P=R.slice(ie+1).filter(Ca),M=y.concat(P),J=new Set(M.map(xe)),S=ct(J);if(S){const F=xe(S);J.has(F)||(M.push(S),J.add(F),Pe(H=>{const ce=H,be=new Set(ce.queued??[]);return be.add(F),{...ce,queued:be}}))}const z=M.findIndex((F,H)=>H!==ie&&Ca(F));if(z>=0){W(M),ae(z),De(!1);return}}De(!0)},[je,na,fa,ie,R,E,p.id]),r.useEffect(()=>{let d=!0;return(async()=>{D("loading"),c({current:0,total:p.id==="levels"?0:p.getFetchLimit(U,f)});try{const P=[];let M=null,J=null;do{const ye=await Et({libraryId:o,collectionId:I,limit:300,cursor:M});if(P.push(...ye.items),(p.id==="levels"||p.id==="temporal")&&ye.total&&(J=ye.total),c(fe=>({current:P.length,total:fe.total||ye.total||p.getFetchLimit(U,f)})),M=ye.nextCursor??null,J!==null&&P.length>=J||p.id!=="levels"&&p.id!=="temporal"&&P.length>=p.getFetchLimit(U,f))break}while(M);if(!d)return;const S=mr(P);let z;if(p.id==="levels"){const ye=Math.max(1,Number(f.levels??1)),Se=(await Oa()).reduce((Ie,He)=>{const Qe=Ka(He.itemType,He.itemId,He.checkType,He.direction);return Ie[Qe]||(Ie[Qe]=[]),Ie[Qe].push(He),Ie},{});z={},S.forEach(Ie=>{const He=xe(Ie),Qe=Se[He]??[],ha=Qe.length>0?Va(Qe).score:0,at=Math.max(1,Math.min(ye,Math.ceil(ha/100*ye)));z[He]=at})}let F=null,H=null,ce=null;if(p.id==="temporal"){const ye=await Oa(),fe=new Set(S.map(He=>xe(He))),Se=ye.reduce((He,Qe)=>{const ha=Ka(Qe.itemType,Qe.itemId,Qe.checkType,Qe.direction);return fe.has(ha)&&(He[ha]||(He[ha]=[]),He[ha].push(Qe)),He},{});F={},H=new Set,ce={};const Ie=Date.now();S.forEach(He=>{const Qe=xe(He),ha=Se[Qe]??[];if(ha.length===0){F[Qe]=0,H.add(Qe),ce[Qe]=[];return}const at=wr(ha);ce[Qe]=at;const gi=zt(at,Ie);F[Qe]=gi.knowness})}const be=p.id==="levels"?kr(S,U,f,z):p.id==="temporal"?jr(S,U,f,F??{},H??new Set,ce??{}):p.prepare(S,U,f);W(be.queue),Pe(be.meta),ae(0),D("ready"),c(ye=>({current:Math.min(ye.current,ye.total),total:ye.total}))}catch{d&&D("error")}})(),()=>{d=!1}},[o,I,U,f,p,K]),r.useEffect(()=>{if(Ce(""),re(null),la(null),ca(0),$e([]),sa({}),k({}),pe(null),Ue(null),_e(null),se(!1),oa(!1),G(null),T(null),t({}),!je){Ee(null),Ae(null),Le(null),aa(null);return}je.cardType==="info"&&je.infoType==="computed"&&Ee(a.cogita.library.revision.loadingComputed);let d=!0;return yt(je,ie).then(y=>{!d||!y||(Ee(y.prompt),Ae(y.expectedAnswer),$e(y.computedExpected),sa(y.computedAnswers),Le(y.computedValues),pe(y.answerTemplate),Ue(y.outputVariables),_e(y.variableValues))}),()=>{d=!1}},[je,a]),r.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){ra.current=null,Ia.current=new Set,Je(null);return}const d=je.description??"",y=(je.label??"").trim(),P=y.replace(/\s+/g," ").trim(),M=d.replace(/\s+/g," ").trim(),J=P&&P!==M?y:a.cogita.library.infoTypes.quote;if(!d){Je(null),Ae(null);return}const S=pt(d);ra.current=S,Ee(J);let z=!0;return st().then(({fragmentKnowness:F})=>{if(!z)return;const H=getQuoteMode(je.direction),ce=new Set,be={};F.forEach((Se,Ie)=>{const[He,Qe]=Ie.split(":",2);if(He!==je.cardId)return;const ha=Ta(Qe);if(!ha||ha.mode!==H)return;const at=ha.fragmentId;be[at]=Se,Se>=ua&&ce.add(at)}),Ia.current=ce,$a.current=be;const ye=Ta(je.direction);if(ye!=null&&ye.fragmentId&&S.nodes[ye.fragmentId]){Da(S,ye.fragmentId,J);return}const fe=bt(S,ce,be,ua,fa,je.direction);Da(S,(fe==null?void 0:fe.id)??null,J)}).catch(()=>{Ia.current=new Set,$a.current={};const F=Ta(je.direction);if(F!=null&&F.fragmentId&&S.nodes[F.fragmentId]){Da(S,F.fragmentId,J);return}const H=bt(S,Ia.current,{},ua,fa,je.direction);Da(S,(H==null?void 0:H.id)??null,J)}),()=>{z=!1}},[je,a,fa,ua]),r.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){T(null),t({});return}const P=(E.pool??E.active??R).filter(F=>F.cardType==="vocab"&&F.checkType==="translation-match").filter((F,H,ce)=>ce.findIndex(be=>be.cardId===F.cardId)===H);P.some(F=>F.cardId===je.cardId)||P.unshift(je);const J=Pa(P).slice(0,6).map(F=>{const H=F.label.split("↔").map(ye=>ye.trim()).filter(Boolean);if(H.length<2)return null;const ce=`${F.cardId}:L`,be=`${F.cardId}:R`;return{cardId:F.cardId,leftId:ce,rightId:be,leftLabel:H[0],rightLabel:H[1]}}).filter(Boolean),S=J.map(F=>F.leftId),z=Pa(J.map(F=>F.rightId));T({pairs:J,leftOrder:S,rightOrder:z,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,R,E]),r.useEffect(()=>()=>{V.current&&window.clearTimeout(V.current),ee.current&&window.clearTimeout(ee.current)},[]);const Ga=r.useRef(null);r.useEffect(()=>{if(!je)return;const d=xe(je),y=typeof document<"u"?document.activeElement:null;if(Ga.current===d&&y&&(y.tagName==="INPUT"||y.tagName==="TEXTAREA"))return;let P=0;const M=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(Ke.length>0){const S=qt(ke,Ke,Re),z=S?Ba.current[S]:null;if(z&&(z.focus(),document.activeElement===z)){Ga.current=d;return}}if(xa.current&&(xa.current.focus(),document.activeElement===xa.current)){Ga.current=d;return}}else if(je.cardType==="vocab"&&xa.current&&(xa.current.focus(),document.activeElement===xa.current)){Ga.current=d;return}P<6&&(P+=1,window.setTimeout(M,40))}},J=window.setTimeout(M,40);return()=>window.clearTimeout(J)},[je,Ke,ke,Re]),r.useEffect(()=>{if(!ya)return;const d=y=>{y.key==="Enter"&&(y.preventDefault(),gt())};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[ya]);const Xa=d=>{ia(d),aa(Va(d))};r.useEffect(()=>{if(!je){aa(null),ia([]);return}const d=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Oa().then(y=>{const P=y.filter(M=>M.itemType==="info"&&M.itemId===je.cardId&&M.checkType==="quote-fragment"&&Ot(M.direction,je.direction));Xa(P)}).catch(()=>{aa(null),ia([])});return}Kt(d,je.cardId,je.checkType,je.direction).then(y=>Xa(y)).catch(()=>{aa(null),ia([])})},[o,je,K]);const Lt=(d,y,P,M)=>{if(d==="info"&&P==="quote-fragment"){Oa().then(J=>{const S=J.filter(z=>z.itemType==="info"&&z.itemId===y&&z.checkType==="quote-fragment"&&Ot(z.direction,M));Xa(S)}).catch(()=>{aa(null),ia([])});return}Kt(d,y,P,M).then(J=>Xa(J)).catch(()=>{aa(null),ia([])})},Ct=(d,y,P)=>{var z;const M=((z=P.pairs.find(F=>F.leftId===d))==null?void 0:z.rightId)??null;if(!M)return P;const J=M===y;t(F=>({...F,[d]:J?"correct":"incorrect"})),V.current&&window.clearTimeout(V.current),ee.current&&window.clearTimeout(ee.current),i.current+=1;const S={kind:J?"correct":"incorrect",tick:i.current};if(N(null),V.current=window.setTimeout(()=>N(S),0),ee.current=window.setTimeout(()=>N(null),420),J){const F={...P.locked,[d]:!0};return Object.keys(F).length>=P.pairs.length?(re("correct"),oa(!0)):re("correct"),{...P,selection:{...P.selection,[d]:y},activeLeft:null,activeRight:null,locked:F}}return re("incorrect"),{...P,activeLeft:null,activeRight:null}},ut=d=>{T(y=>!y||y.locked[d]?y:y.activeRight?Ct(d,y.activeRight,y):{...y,activeLeft:y.activeLeft===d?null:d})},Fa=d=>{T(y=>y&&(y.activeLeft?Ct(y.activeLeft,d,y):{...y,activeRight:y.activeRight===d?null:d}))},gt=()=>{var d;if(je&&je.cardType==="info"&&je.infoType==="quote"&&ra.current&&Me&&!((d=Ta(je.direction))!=null&&d.fragmentId)){const y=bt(ra.current,Ia.current,$a.current,ua,fa,je.direction,Me.fragmentId);if(y){re(null),Ce(""),se(!1),k({}),oa(!1),la(null),ca(0),Da(ra.current,y.id,Me.title);return}}re(null),Ce(""),se(!1),k({}),oa(!1),la(null),ca(0),ae(y=>Math.min(y+1,R.length))},Ma=d=>{if(!je)return;const y=d.expected??null,P=d.answer??"";let M=y??"",J=P;if(!y&&d.expectedMap&&d.answerMap){const ye=Object.keys(d.expectedMap).sort((fe,Se)=>fe.localeCompare(Se));M=ye.map(fe=>{var Se;return((Se=d.expectedMap)==null?void 0:Se[fe])??""}).join("|"),J=ye.map(fe=>{var Se;return((Se=d.answerMap)==null?void 0:Se[fe])??""}).join("|")}const S=M?mt(M,J,ka):new Uint8Array,z={revisionType:p.id,evalType:d.evalType,direction:d.direction,prompt:Ne??"",expected:y,answer:P,expectedAnswers:d.expectedMap??null,answers:d.answerMap??null,correct:d.correct,maskBase64:S.length?Ya(S):null,values:_??null,checkMode:ue,compareMode:ka,minCorrectness:Ha},F=new TextEncoder().encode(JSON.stringify(z)),H=je.cardType==="info"?"info":"connection",ce=d.overrideCheckType??je.checkType??null,be=d.overrideDirection??je.direction??null;Dt({itemType:H,itemId:je.cardId,checkType:ce,direction:be,revisionType:p.id,evalType:d.evalType,correct:d.correct,maskBase64:S.length?Ya(S):null,payloadBase64:Ya(F),personRoleId:K??null}).then(()=>{Lt(H,je.cardId,ce,be),lt(R),sr(o,K)}).catch(()=>{})},Za=(d,y)=>{const P=Ua.current.get(y);if(P)return Promise.resolve(P);const M=La.current.get(y);if(M)return M;const J=it({libraryId:o,infoId:d}).then(S=>{var ye,fe;const z=S.payload,F=((ye=z.definition)==null?void 0:ye.graph)??null,H="",ce=((fe=z.definition)==null?void 0:fe.answerTemplate)??"",be=vr(F,H,ce);if(be){const Ie={sample:ei(be),answerTemplate:ce||null};return Ua.current.set(y,Ie),Ie}return Mr({libraryId:o,infoId:d}).then(Se=>{const Ie={sample:Se,answerTemplate:null};return Ua.current.set(y,Ie),Ie})}).catch(()=>Mr({libraryId:o,infoId:d}).then(S=>{const z={sample:S,answerTemplate:null};return Ua.current.set(y,z),z}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{La.current.delete(y)});return La.current.set(y,J),J},yt=(d,y)=>{var F;const P=`${xe(d)}:${y}`,M=_a.current.get(P);if(M)return Promise.resolve(M);const J=Wa.current.get(P);if(J)return J;const S=H=>(_a.current.set(P,H),H);let z;if(d.cardType==="vocab"){if(d.checkType==="translation-match")return z=Promise.resolve(S({prompt:d.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),z;const H=d.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(H.length>=2){const be=(d.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ye=be?H[0]:H[1],fe=be?H[1]:H[0];z=Promise.resolve(S({prompt:ye,expectedAnswer:fe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else z=Promise.resolve(S({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(d.cardType==="info"&&d.infoType==="word"){const H=(F=d.description)!=null&&F.startsWith("Language: ")?d.description.replace("Language: ",""):null;z=Promise.resolve(S({prompt:d.label,expectedAnswer:H,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else d.cardType==="info"&&d.infoType==="computed"?z=Za(d.cardId,P).then(H=>{var Se,Ie;if(!H.sample)return S({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ce=H.sample,be=ce.expectedAnswers?Object.entries(ce.expectedAnswers).map(([He,Qe])=>({key:He,expected:Qe})):[],ye=be.reduce((He,Qe)=>(He[Qe.key]="",He),{}),fe=ce.expectedAnswerIsSentence&&((Se=ce.expectedAnswer)==null?void 0:Se.trim())||null;return S({prompt:ce.prompt,expectedAnswer:be.length>0?fe:((Ie=ce.expectedAnswer)==null?void 0:Ie.trim())||null,computedExpected:be,computedAnswers:ye,computedValues:ce.values??null,answerTemplate:H.answerTemplate,outputVariables:ce.outputVariables??null,variableValues:ce.variableValues??null})}).catch(()=>S({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Wa.current.delete(P)}):z=Promise.resolve(S({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return Wa.current.set(P,z),z},Da=(d,y,P)=>{const M=Object.keys(d.nodes).length,J=Ia.current.size;if(!y){Je({title:P,before:d.text,after:"",fragmentId:null,total:M,completed:J}),Ae(null),oa(!0);return}const S=d.nodes[y];if(!S)return;const z=ai(d.text,S);Je({title:P,before:z.before,after:z.after,fragmentId:S.id,total:M,completed:J}),Ae(z.fragment),oa(!1)},Mt=()=>{const d=ra.current;d&&Je(y=>y&&{...y,total:Object.keys(d.nodes).length,completed:Ia.current.size})},ht=()=>{const d=R[ie+1];d&&yt(d,ie+1)},St=()=>{if(ht(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&v){if(v.pairs.length===0){re("incorrect"),oa(!0);return}const S=v.pairs.reduce((fe,Se)=>(fe[Se.rightId]=Se.rightLabel,fe),{});let z=0;const F={};v.pairs.forEach(fe=>{const Ie=v.selection[fe.leftId]===fe.rightId;F[fe.leftId]=Ie?"correct":"incorrect",Ie&&(z+=1)});const H=v.pairs.length||1,ce=z/H,be=z===v.pairs.length;t(fe=>({...fe,...F})),be?(re("correct"),oa(!0),ca(0)):(re("incorrect"),oa(!1),ca(fe=>{const Se=fe+1;return Se>=Ea&&(se(!0),oa(!0),T(Ie=>{if(!Ie)return Ie;const He=Ie.pairs.reduce((Qe,ha)=>(Qe[ha.leftId]=ha.rightId,Qe),{});return{...Ie,selection:He}})),Se})),wa(be,ce);const ye="connection";Promise.all(v.pairs.map(fe=>{const Se=v.selection[fe.leftId]??null,Ie=Se?S[Se]:"",He={left:fe.leftLabel,expected:fe.rightLabel,answer:Ie,checkType:"translation-match"},Qe=new TextEncoder().encode(JSON.stringify(He));return Dt({itemType:ye,itemId:fe.cardId,checkType:"translation-match",direction:null,revisionType:p.id,evalType:"translation-match",correct:Se===fe.rightId,maskBase64:null,payloadBase64:Ya(Qe),personRoleId:K??null})})).then(()=>{Lt(ye,je.cardId,je.checkType,je.direction),sr(o,K)}).catch(()=>{});return}if(Ke.length>0){const S=Ke.reduce((F,H)=>{const ce=ze[H.key]??"";return F[H.key]=ja(ce)===ja(H.expected)?"correct":"incorrect",F},{});Ke.every(({key:F,expected:H})=>{const ce=ze[F]??"";return ue==="exact"&&ja(ce)===ja(H)})?(re("correct"),k(S),oa(!0),ca(0),wa(!0,1),Ma({correct:!0,direction:Ne?`${Ne} -> computed`:"computed",expectedMap:Ke.reduce((F,H)=>(F[H.key]=H.expected,F),{}),answerMap:ze,evalType:"computed"})):(re("incorrect"),k(S),oa(!1),ca(F=>{const H=F+1;return H>=Ea&&X&&(se(!0),oa(!0)),H}),wa(!1,0),window.setTimeout(()=>{var H;const F=qt(ke,Ke,Re);F&&Ba.current[F]&&((H=Ba.current[F])==null||H.focus())},40),Ma({correct:!1,direction:Ne?`${Ne} -> computed`:"computed",expectedMap:Ke.reduce((F,H)=>(F[H.key]=H.expected,F),{}),answerMap:ze,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Me!=null&&Me.fragmentId)){if(!Te)return;const S=Ta(je.direction),z=(S==null?void 0:S.mode)??getQuoteMode(je.direction),F=S!=null&&S.fragmentId&&je.direction?je.direction:Tt(z,Me.fragmentId),H=ci(Te,O,ka),ce=ue==="exact"&&ft(O)===ft(Te),be=Ja(H),ye=ce||be,fe=Qa(H);ye?($a.current[Me.fragmentId]=Math.max($a.current[Me.fragmentId]??0,fe),($a.current[Me.fragmentId]??0)>=ua&&Ia.current.add(Me.fragmentId),Mt(),re("correct"),k({}),oa(!0),la(H),ca(0),fe<100&&Ea<=1&&se(!0),wa(!0,fe/100),Ma({correct:!0,direction:`quote:${Me.fragmentId}`,expected:Te,answer:O,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:F})):(re("incorrect"),k({}),oa(!1),la(H),ca(Se=>{const Ie=Se+1;return Ie>=Ea&&X&&(se(!0),oa(!0)),Ie}),wa(!1,fe/100),window.setTimeout(()=>{var Se;return(Se=xa.current)==null?void 0:Se.focus()},40),Ma({correct:!1,direction:`quote:${Me.fragmentId}`,expected:Te,answer:O,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:F}));return}if(!Te)return;const d=mt(Te,O,ka),y=ue==="exact"&&ja(O)===ja(Te),P=Ja(d),M=y||P,J=Qa(d);M?(re("correct"),k({}),oa(!0),la(d),ca(0),J<100&&Ea<=1&&se(!0),wa(!0,J/100),Ma({correct:!0,direction:Ne?`${Ne} -> ${Te}`:null,expected:Te,answer:O,evalType:"text"})):(re("incorrect"),k({}),oa(!1),la(d),ca(S=>{const z=S+1;return z>=Ea&&X&&(se(!0),oa(!0)),z}),wa(!1,J/100),window.setTimeout(()=>{var S;return(S=xa.current)==null?void 0:S.focus()},40),Ma({correct:!1,direction:Ne?`${Ne} -> ${Te}`:null,expected:Te,answer:O,evalType:"text"}))},Xt=d=>{if(ht(),!Te)return;const y=mt(Te,d,ka),P=ja(d)===ja(Te),M=Ja(y),J=P||M,S=Qa(y);J?(re("correct"),k({}),oa(!0),la(y),ca(0),S<100&&Ea<=1&&se(!0),wa(!0,S/100),Ma({correct:!0,direction:"word->language",expected:Te,answer:d,evalType:"language-select"})):(re("incorrect"),k({}),oa(!1),la(y),ca(z=>{const F=z+1;return F>=Ea&&X&&(se(!0),oa(!0)),F}),wa(!1,S/100),Ma({correct:!1,direction:"word->language",expected:Te,answer:d,evalType:"language-select"}))},Zt=()=>{ht(),re("correct"),oa(!0),ca(0),wa(!0,1),Te&&Ma({correct:!0,direction:"manual",expected:Te,answer:O,evalType:"manual"})},er=()=>{if(wa(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){re(null),Ce(""),se(!1),k({}),oa(!1),la(null),ca(0),ae(d=>Math.min(d+1,R.length));return}gt()};r.useEffect(()=>{ht()},[ie,R]);const et=d=>{var P;if(d.key!=="Enter")return;if(d.preventDefault(),d.stopPropagation(),ya){gt();return}const y=Ke.find(M=>!(ze[M.key]??"").trim());if(y){(P=Ba.current[y.key])==null||P.focus();return}St()},$=a.cogita.library.revision.revealModeAfterIncorrect,X=Ke.length>0||!!Te;return e.jsxs(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:[he==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${oe.total?Math.min(100,Math.max(0,oe.current/oe.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:oe.total?`${Math.min(oe.current,oe.total)} / ${oe.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:B}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",w).replace("{check}",Z)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:q,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${q}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${q}/collections/${I}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:we?`${we.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Aa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Aa.currentLevel??"-"," / ",Aa.levelsCount]}):null,we?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(we.correct)).replace("{total}",String(we.total))}),we.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(we.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(oi,{outcomes:qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Oe?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Oe})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":h?`${h.kind}-${h.tick}`:ve?"idle":le??"idle",children:je?e.jsx(e.Fragment,{children:da?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ni,{copy:a,currentCard:je,currentTypeLabel:ma,prompt:Ne,languages:ge,answer:O,onAnswerChange:d=>Ce(y=>_t(y,d,te)),computedExpected:Ke,computedAnswers:ze,onComputedAnswerChange:(d,y)=>sa(P=>({...P,[d]:_t(P[d]??"",y,te)})),answerTemplate:ke,outputVariables:Re,variableValues:Be,computedFieldFeedback:ea,feedback:le,canAdvance:ya,quoteContext:Me,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:St,onSkip:er,onLanguageSelect:Xt,onMarkReviewed:Zt,onAdvance:gt,showCorrectAnswer:de,setShowCorrectAnswer:se,onRevealCorrect:()=>oa(!0),answerMask:Sa,expectedAnswer:Te,hasExpectedAnswer:X,handleComputedKeyDown:et,answerInputRef:xa,computedInputRefs:Ba,scriptMode:te,setScriptMode:G,matchPairs:v==null?void 0:v.pairs,matchLeftOrder:v==null?void 0:v.leftOrder,matchRightOrder:v==null?void 0:v.rightOrder,matchSelection:v==null?void 0:v.selection,matchActiveLeft:v==null?void 0:v.activeLeft,matchActiveRight:v==null?void 0:v.activeRight,matchFeedback:Q,onMatchLeftSelect:ut,onMatchRightSelect:Fa})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${q}/collections/${I}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:nt?`${ot} / ${nt}`:a.cogita.library.revision.progressUnlimited}),he==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),he==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),he==="ready"&&R.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:$}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ea]})]})]}),Aa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Aa.activeCount," / ",Aa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Aa.counts.map((d,y)=>{const P=y+1,M=Aa.currentLevel===P,J=Aa.percentages[y]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":M,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:P}),e.jsx("strong",{children:d})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,J))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[J.toFixed(1),"%"]})]},`level-${P}`)})})]}):null,va?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:va.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:va.dots.map(d=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,d.value*100))}%`,background:`rgba(${Math.round(255*(1-d.value))}, ${Math.round(200*d.value)}, 80, 0.9)`}},d.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:va.knownCount})]})]}):null,fa?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:dt})]})}):null]})]})]})})})]})]})}const lr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],Dn={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Kn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Vn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function On({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:o,collectionId:I}){const[m,b]=r.useState(""),[q,Y,U]=_r([]),[l,p,f]=qr([]),[ue,K]=r.useState(null),[w,Z]=r.useState(null),[B,ne]=r.useState(null),R=`/#/cogita/library/${o}`;r.useEffect(()=>{Wt(o,I).then(c=>b(c.name)).catch(()=>b(a.cogita.library.collections.defaultName))},[o,I,a]),r.useEffect(()=>{Ii({libraryId:o,collectionId:I}).then(c=>{if(!c.graphId||c.graphId==="00000000-0000-0000-0000-000000000000"){Y([]),p([]);return}const ie=c.nodes.map(O=>{var Ne;const Ce=O.payload??{},le=Ce.position??{x:120,y:120},re=Ce.params??{};return{id:O.nodeId,type:"default",position:le,data:{nodeType:O.nodeType,label:((Ne=lr.find(Ee=>Ee.type===O.nodeType))==null?void 0:Ne.label)??O.nodeType,params:re}}}),ae=c.edges.map(O=>({id:O.edgeId,source:O.fromNodeId,target:O.toNodeId,sourceHandle:O.fromPort??void 0,targetHandle:O.toPort??void 0}));Y(ie),p(ae)}).catch(()=>{Y([]),p([])})},[o,I,p,Y]);const W=r.useMemo(()=>q.find(c=>c.id===ue)??null,[q,ue]),ge=c=>{var Ce;const ie=crypto.randomUUID(),ae=((Ce=lr.find(le=>le.type===c))==null?void 0:Ce.label)??c,O={...Dn[c]};Y(le=>[...le,{id:ie,type:"default",position:{x:120+le.length*40,y:120+le.length*40},data:{nodeType:c,label:ae,params:O}}]),K(ie)},me=r.useCallback(c=>{p(ie=>$t({...c,id:crypto.randomUUID()},ie))},[p]),he=async()=>{Z(null);try{await Ri({libraryId:o,collectionId:I,nodes:q.map(c=>({nodeId:c.id,nodeType:c.data.nodeType,payload:{position:c.position,params:c.data.params}})),edges:l.map(c=>({edgeId:c.id,fromNodeId:c.source,fromPort:c.sourceHandle??null,toNodeId:c.target,toPort:c.targetHandle??null}))}),Z(a.cogita.library.graph.saveSuccess)}catch{Z(a.cogita.library.graph.saveFail)}},D=async()=>{try{const c=await Pi({libraryId:o,collectionId:I});ne(c)}catch{ne(null)}},oe=c=>{W&&Y(ie=>ie.map(ae=>ae.id===W.id?{...ae,data:{...ae.data,params:c}}:ae))};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${R}/collections/${I}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:D,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:he,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:lr.map(c=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ge(c.type),children:c.label},c.type))}),w?e.jsx("p",{className:"cogita-help",children:w}):null,B&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(B.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(B.connections)).replace("{infos}",String(B.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(pr,{nodes:q,edges:l,onNodesChange:U,onEdgesChange:f,onConnect:me,onNodeClick:(c,ie)=>K(ie.id),fitView:!0,children:[e.jsx(fr,{color:"rgba(120,160,200,0.2)"}),e.jsx(xr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),W?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:W.data.label}),W.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:W.data.params.tagId?{id:W.data.params.tagId,label:W.data.params.tagLabel??"",infoType:"topic"}:null,onChange:c=>oe({...W.data.params,tagId:(c==null?void 0:c.id)??null,tagLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:W.data.params.scope??"any",onChange:c=>oe({...W.data.params,scope:c.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),W.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{libraryId:o,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:W.data.params.languageId?{id:W.data.params.languageId,label:W.data.params.languageLabel??"",infoType:"language"}:null,onChange:c=>oe({...W.data.params,languageId:(c==null?void 0:c.id)??null,languageLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:W.data.params.scope??"any",onChange:c=>oe({...W.data.params,scope:c.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),W.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:W.data.params.infoType??"word",onChange:c=>oe({...W.data.params,infoType:c.target.value}),children:Vn.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsx(Ye,{libraryId:o,infoType:W.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:W.data.params.infoId?{id:W.data.params.infoId,label:W.data.params.infoLabel??"",infoType:W.data.params.infoType??"word"}:null,onChange:c=>oe({...W.data.params,infoId:(c==null?void 0:c.id)??null,infoLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),W.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:W.data.params.connectionType??"translation",onChange:c=>oe({...W.data.params,connectionType:c.target.value}),children:Kn.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:W.data.params.connectionId??"",onChange:c=>oe({...W.data.params,connectionId:c.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(W.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const cr="cogita.preferences",ui=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],dr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ur=["settings","run","shared"];function _n(a,n=""){const s=a.split("/").filter(Boolean);if(s[0]!=="cogita"||s[1]!=="library")return{};const u=s[2];if(!u)return{};if(!s[3])return{libraryId:u,target:"library_overview"};const g=new URLSearchParams(n),j=g.get("revisionId")??void 0,x=g.get("infoId")??void 0,L=g.get("infoView")==="cards"?"cards":"overview",A=g.get("collectionAction"),C=g.get("libraryAction");if(s[3]==="list")return{libraryId:u,target:C==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:j,infoId:x,infoView:L,libraryAction:C==="new-info"?"new-info":void 0};if(s[3]==="detail"||s[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:s[3],revisionId:j,infoId:x,infoView:L};if(s[3]==="new"||s[3]==="add")return{libraryId:u,target:"new_card",revisionId:j,libraryAction:"new-info"};if(s[3]==="edit")return{libraryId:u,target:"new_card",revisionId:j,infoId:s[4]};if(s[3]==="shared-revisions")return{libraryId:u,target:"all_collections",revisionId:j};if(s[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(s[3]==="transfer")return{libraryId:u,target:"transfer"};if(s[3]==="storyboards")return s[4]==="new"?{libraryId:u,target:"new_storyboard"}:{libraryId:u,target:"storyboards"};if(s[3]==="texts")return s[4]==="new"?{libraryId:u,target:"new_text"}:{libraryId:u,target:"texts"};if(s[3]!=="collections")return{libraryId:u,target:"library_overview"};if(s[4]==="new")return{libraryId:u,target:"new_collection",revisionId:j};const o=s[4];return o?s[5]==="graph"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:j,revisionView:"graph"}:s[5]==="shared-revisions"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:j,revisionView:"shared"}:s[5]==="revision"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:j,revisionView:s[6]==="run"?"run":"settings"}:A==="new-revision"?{libraryId:u,target:"all_collections",collectionId:o,revisionId:j,revisionView:"new"}:{libraryId:u,target:"all_collections",collectionId:o,revisionId:j,revisionView:"detail"}:A==="new-collection"?{libraryId:u,target:"new_collection",collectionAction:"new-collection"}:{libraryId:u,target:"all_collections"}}function gr(a,n="library_overview",s,u,g,j,x="overview"){const L=(A,C)=>{const o=new URLSearchParams;C!=null&&C.revisionId&&o.set("revisionId",C.revisionId),C!=null&&C.collectionAction&&o.set("collectionAction",C.collectionAction),C!=null&&C.libraryAction&&o.set("libraryAction",C.libraryAction),C!=null&&C.infoId&&o.set("infoId",C.infoId),C!=null&&C.infoView&&(C!=null&&C.infoId)&&o.set("infoView",C.infoView);const I=o.toString();return I?`${A}?${I}`:A};return a?n==="library_overview"?L(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?L(`/cogita/library/${a}/list`,{revisionId:g,infoId:j,infoView:x}):n==="new_card"?j?L(`/cogita/library/${a}/edit/${j}`,{revisionId:g}):L(`/cogita/library/${a}/list`,{revisionId:g,libraryAction:"new-info"}):n==="all_collections"?s?u==="graph"?L(`/cogita/library/${a}/collections/${s}/graph`,{revisionId:g}):u==="settings"?L(`/cogita/library/${a}/collections/${s}/revision`,{revisionId:g}):u==="run"?L(`/cogita/library/${a}/collections/${s}/revision/run`,{revisionId:g}):u==="shared"?L(`/cogita/library/${a}/collections/${s}/shared-revisions`,{revisionId:g}):u==="new"?L(`/cogita/library/${a}/collections/${s}`,{revisionId:g,collectionAction:"new-revision"}):L(`/cogita/library/${a}/collections/${s}`,{revisionId:g}):L(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?L(`/cogita/library/${a}/collections`,{revisionId:g,collectionAction:"new-collection"}):n==="transfer"?L(`/cogita/library/${a}/transfer`,{revisionId:g}):n==="storyboards"?L(`/cogita/library/${a}/storyboards`,{revisionId:g}):n==="new_storyboard"?L(`/cogita/library/${a}/storyboards/new`,{revisionId:g}):n==="texts"?L(`/cogita/library/${a}/texts`,{revisionId:g}):n==="new_text"?L(`/cogita/library/${a}/texts/new`,{revisionId:g}):n==="dependencies"?L(`/cogita/library/${a}/dependencies`,{revisionId:g}):L(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function Pt(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function qn(a){return typeof a=="string"&&ui.includes(a)}function Un(a,n){var L;if(!a.length)return null;const s=a.filter(A=>n.has(A.roleId)),u=s.length>0?s:a,g=u.map(A=>{var o,I;const C=((I=(o=A.fields.find(m=>m.fieldType==="role_kind"))==null?void 0:o.plainValue)==null?void 0:I.toLowerCase())??"";return{roleId:A.roleId,roleKind:C}}),j=g.find(A=>A.roleKind.includes("master"));if(j)return j.roleId;const x=g.find(A=>A.roleKind.includes("account")||A.roleKind.includes("user"));return x?x.roleId:((L=u[0])==null?void 0:L.roleId)??null}function Wn(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function zn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C}){const o=Or(),I=yr(),m=r.useMemo(()=>_n(I.pathname,I.search),[I.pathname,I.search]),b=a.cogita.workspace,[q,Y]=r.useState([]),[U,l]=r.useState([]),[p,f]=r.useState([]),[ue,K]=r.useState([]),[w,Z]=r.useState(void 0),[B,ne]=r.useState("library_overview"),[R,W]=r.useState(void 0),[ge,me]=r.useState(void 0),[he,D]=r.useState("detail"),[oe,c]=r.useState(void 0),[ie,ae]=r.useState(!1),[O,Ce]=r.useState(!0),[le,re]=r.useState(!1),[Ne,Ee]=r.useState(!1),[Te,Ae]=r.useState(null),[Me,Je]=r.useState(""),[Ke,$e]=r.useState(""),[ze,sa]=r.useState(""),[ea,k]=r.useState(null),[_,Le]=r.useState(null),ke=r.useRef({version:1,byLibrary:{}}),pe=r.useRef(!1),Re=r.useRef(!1),Ue=r.useRef(null),Be=r.useMemo(()=>q.find(E=>E.libraryId===w)??null,[q,w]),_e=r.useMemo(()=>U.find(E=>E.collectionId===R)??null,[U,R]),v=r.useMemo(()=>ue.find(E=>E.revisionId===ge)??null,[ue,ge]),T=r.useMemo(()=>({detail:b.revisions.detail,graph:b.revisions.graph,settings:b.revisions.settings,run:b.revisions.run,shared:b.targets.sharedRevisions,new:b.revisionForm.createAction}),[b.revisions.detail,b.revisions.graph,b.revisions.run,b.revisions.settings,b.targets.sharedRevisions,b.revisionForm.createAction]),Q=r.useMemo(()=>[{value:"detail",label:T.detail},{value:"graph",label:T.graph},{value:"settings",label:b.targets.allRevisions},{value:"run",label:T.run},{value:"shared",label:T.shared}],[T.detail,T.graph,T.run,T.shared,b.targets.allRevisions]),t=r.useMemo(()=>B==="new_card"?"all_cards":B==="new_collection"?"all_collections":B==="new_storyboard"?"storyboards":B==="new_text"?"texts":B,[B]),i=r.useMemo(()=>he==="new"?"settings":he,[he]),h=r.useMemo(()=>m.infoId?"selected":B==="new_card"?"create":"search",[m.infoId,B]),N=r.useMemo(()=>p.find(E=>E.infoId===m.infoId)??null,[p,m.infoId]),V=r.useMemo(()=>({library_overview:b.targets.libraryOverview,all_cards:b.targets.allCards,new_card:b.targets.newCard,all_collections:b.targets.allCollections,new_collection:b.targets.newCollection,transfer:b.targets.transfer,storyboards:b.targets.storyboards,new_storyboard:b.targets.newStoryboard,texts:b.targets.texts,new_text:b.targets.newText,dependencies:b.targets.dependencies}),[b.targets]),ee=r.useMemo(()=>V[t]??t,[t,V]),te=T[i],G=!!w,de=!!R,se=G&&B==="all_collections",we=de&&B==="all_collections",aa=de&&B==="all_collections"&&ur.includes(he),qe=r.useCallback(E=>{const Pe=!!E.libraryId;let Ve=E.target,ta=E.collectionId,Ze=E.revisionId,na=E.revisionView,ba=E.infoId,da=E.infoView??m.infoView??"overview";Pe?dr[Ve].requiresCollection&&!ta?(Ve="all_collections",Ze=void 0,na="detail"):Ve!=="all_collections"?(ta=void 0,Ze=void 0,Ve!=="new_card"&&Ve!=="all_cards"&&(ba=void 0,da="overview")):dr[Ve].allowsRevision?ur.includes(na)||(Ze=void 0):na="detail":(Ve="library_overview",ta=void 0,Ze=void 0,na="detail",ba=void 0,da="overview"),Z(E.libraryId),ne(Ve),W(ta),me(Ze),D(na),ae(!1);const De=Pt(gr(E.libraryId,Ve,ta,na,Ze,ba,da));Pt(`${I.pathname}${I.search}`)!==De&&(Ue.current=De,o(De))},[I.pathname,I.search,o,m.infoView]),ia=E=>{qe({libraryId:w,target:"all_collections",collectionId:R,revisionId:ur.includes(E)?ge:void 0,revisionView:E})},Oe=r.useMemo(()=>[{key:"library",label:b.layers.library,visible:!0,value:w??"",selectedLabel:(Be==null?void 0:Be.name)??b.path.noLibrarySelected,disabled:O||q.length===0,options:q.map(E=>({value:E.libraryId,label:E.name})),emptyOption:b.noLibraryOption,onSelect:E=>{const Pe=E||void 0;qe({libraryId:Pe,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:b.layers.target,visible:G,value:t,selectedLabel:ee,disabled:!G,options:ui.map(E=>({value:E,label:V[E]})),onSelect:E=>{const Pe=E;qe({libraryId:w,target:Pe,collectionId:R,revisionId:ge,revisionView:he,infoId:Pe==="new_card"?m.infoId:void 0})}},{key:"info_mode",label:b.layers.target,visible:t==="all_cards",value:h,selectedLabel:h==="create"?b.infoMode.create:h==="selected"?(N==null?void 0:N.label)??oe??a.cogita.library.list.selectedEmpty:b.infoMode.search,disabled:!G,options:[{value:"search",label:b.infoMode.search},{value:"create",label:b.infoMode.create},...m.infoId?[{value:"selected",label:(N==null?void 0:N.label)??oe??a.cogita.library.list.selectedEmpty}]:[]],onSelect:E=>{if(E!=="selected"){if(E==="create"){qe({libraryId:w,target:"new_card",collectionId:R,revisionId:ge,revisionView:he,infoId:void 0});return}qe({libraryId:w,target:"all_cards",collectionId:R,revisionId:ge,revisionView:he,infoId:void 0,infoView:"overview"})}}},{key:"info_selected_action",label:b.layers.target,visible:t==="all_cards"&&!!m.infoId,value:B==="new_card"&&m.infoId?"edit":m.infoView==="cards"?"cards":"overview",selectedLabel:B==="new_card"&&m.infoId?b.infoActions.edit:m.infoView==="cards"?b.infoActions.seeCards:b.infoActions.overview,disabled:!G||!m.infoId,options:[{value:"overview",label:b.infoActions.overview},{value:"edit",label:b.infoActions.edit},{value:"cards",label:b.infoActions.seeCards}],onSelect:E=>{if(m.infoId){if(E==="edit"){qe({libraryId:w,target:"new_card",collectionId:R,revisionId:ge,revisionView:he,infoId:m.infoId});return}if(E==="cards"){qe({libraryId:w,target:"all_cards",collectionId:R,revisionId:ge,revisionView:he,infoId:m.infoId,infoView:"cards"});return}qe({libraryId:w,target:"all_cards",collectionId:R,revisionId:ge,revisionView:he,infoId:m.infoId,infoView:"overview"})}}},{key:"collection",label:b.layers.collection,visible:se,value:R??"",selectedLabel:(_e==null?void 0:_e.name)??b.path.noCollectionSelected,disabled:!G||le||U.length===0,options:U.map(E=>({value:E.collectionId,label:E.name})),emptyOption:b.selectCollectionOption,onSelect:E=>{qe({libraryId:w,target:"all_collections",collectionId:E||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:b.layers.revision,visible:we,value:i,selectedLabel:te,disabled:!R,options:Q.map(E=>({value:E.value,label:E.label})),onSelect:E=>{ia(E)}},{key:"revision_entry",label:b.layers.revision,visible:aa,value:ge??"",selectedLabel:(v==null?void 0:v.name)??b.status.noRevisions,disabled:!de||Ne||ue.length===0,options:ue.map(E=>({value:E.revisionId,label:E.name})),emptyOption:b.status.noRevisions,onSelect:E=>{qe({libraryId:w,target:"all_collections",collectionId:R,revisionId:E||void 0,revisionView:he})}}],[Q,U,le,h,p,q,O,qe,ue,Ne,_e,R,N,v,ge,oe,de,G,Be,w,te,he,B,i,t,ee,se,we,aa,V,a.cogita.library.list.selectedEmpty,m.infoId,m.infoView,b.infoActions.edit,b.infoActions.overview,b.infoActions.seeCards,b.layers.collection,b.layers.library,b.layers.revision,b.layers.target,b.noLibraryOption,b.path.noCollectionSelected,b.path.noLibrarySelected,b.selectCollectionOption]),We=r.useMemo(()=>Oe.filter(E=>E.visible),[Oe]),Fe=r.useMemo(()=>We.filter(E=>E.key!=="library"&&E.key!=="collection"&&E.key!=="revision_entry"),[We]),Xe=r.useMemo(()=>Fe.find(E=>E.key==="target")??null,[Fe]),Sa=r.useMemo(()=>Fe.find(E=>E.key==="info_mode")??null,[Fe]),la=r.useMemo(()=>Fe.find(E=>E.key==="info_selected_action")??null,[Fe]),Ra=r.useMemo(()=>Fe.find(E=>E.key==="collection_action")??null,[Fe]),ca=r.useCallback((E,Pe)=>E?e.jsx("div",{className:"cogita-sidebar-actions",children:E.options.map(Ve=>e.jsx("button",{type:"button",className:`ghost ${String(E.value)===Ve.value?"active":""}`,onClick:()=>E.onSelect(Ve.value),disabled:E.disabled,children:Ve.label},`${Pe}:${E.key}:${Ve.value}`))}):null,[]),xa=r.useMemo(()=>{const E=m.libraryId;if(!E||!I.pathname.startsWith("/cogita/library/"))return null;const Pe={copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,libraryId:E};if(m.target==="library_overview")return e.jsx(Gi,{...Pe});if(m.target==="all_cards")return e.jsx(tn,{...Pe,mode:m.cardMode??"list"});if(m.target==="new_card")return e.jsx(ln,{...Pe,editInfoId:m.infoId});if(m.target==="dependencies")return e.jsx(dn,{...Pe});if(m.target==="transfer")return e.jsx(gn,{...Pe});if(m.target==="storyboards"||m.target==="new_storyboard")return e.jsx(hn,{...Pe});if(m.target==="texts"||m.target==="new_text")return e.jsx(bn,{...Pe});if(m.target==="all_collections"){if(m.collectionId){const Ve={...Pe,collectionId:m.collectionId};return m.revisionView==="graph"?e.jsx(On,{...Ve}):m.revisionView==="shared"?e.jsx(un,{...Pe,collectionId:m.collectionId}):m.revisionView==="settings"?e.jsx(Tn,{...Ve,revisionId:m.revisionId}):m.revisionView==="run"?e.jsx(Bn,{...Ve,revisionId:m.revisionId}):e.jsx(mn,{...Ve})}return e.jsx(Kr,{...Pe})}return m.target==="new_collection"?e.jsx(Kr,{...Pe}):null},[n,a,A,I.pathname,o,C,j,L,u,g,m.cardMode,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,x,s]);r.useEffect(()=>{let E=!1;return(async()=>{var Ve,ta,Ze,na,ba,da,De;Ce(!0);try{await $i();const[ra,Ia,$a]=await Promise.all([zr(),Ei(),Ai()]);if(E)return;Y(ra);const je=new Set($a.nodes.filter(ma=>ma.nodeType==="role"&&ma.canLink).map(ma=>ma.roleId??"")),ve=Un(Ia,je);if(k(ve),ve){const ma=$a.nodes.find(za=>za.nodeType==="data"&&za.roleId===ve&&(za.fieldType===cr||za.label===cr));Le((ma==null?void 0:ma.dataKeyId)??null),ke.current=Wn(ma==null?void 0:ma.value)}const Ua=ke.current.lastLibraryId,La=((Ve=ra.find(ma=>ma.libraryId===m.libraryId))==null?void 0:Ve.libraryId)??(ra.length===1?ra[0].libraryId:void 0)??((ta=ra.find(ma=>ma.libraryId===Ua))==null?void 0:ta.libraryId)??((Ze=ra[0])==null?void 0:Ze.libraryId),_a=La?(ba=(na=ke.current.byLibrary)==null?void 0:na[La])==null?void 0:ba.lastTarget:void 0,Wa=qn(_a)?_a:"library_overview";Z(La),ne(m.target??Wa),me(m.revisionId??(La?(De=(da=ke.current.byLibrary)==null?void 0:da[La])==null?void 0:De.lastRevisionId:void 0)),D(m.revisionView??"detail"),pe.current=!0}catch{E||Ae(b.status.loadFailed)}finally{E||Ce(!1)}})(),()=>{E=!0}},[b.status.loadFailed]),r.useLayoutEffect(()=>{pe.current&&(m.libraryId&&q.some(E=>E.libraryId===m.libraryId)&&Z(m.libraryId),m.target&&ne(m.target),W(m.collectionId),me(m.revisionId),m.revisionView&&D(m.revisionView))},[q,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target]),r.useEffect(()=>{if(!w){l([]),W(void 0),f([]),K([]),me(void 0);return}let E=!1;return re(!0),jt({libraryId:w,limit:200}).then(Pe=>{var Ze;if(E)return;const Ve=Pe.items;l(Ve);const ta=(Ze=Ve.find(na=>na.collectionId===m.collectionId))==null?void 0:Ze.collectionId;W(ta)}).catch(()=>{E||(l([]),W(void 0))}).finally(()=>{E||re(!1)}),()=>{E=!0}},[m.collectionId,w]),r.useEffect(()=>{if(!w||t!=="all_cards"&&B!=="new_card"){f([]);return}let E=!1;return Ut({libraryId:w,limit:200}).then(Pe=>{E||f(Pe)}).catch(()=>{E||f([])}),()=>{E=!0}},[t,w,B]),r.useEffect(()=>{if(!w||!R){K([]),me(void 0);return}let E=!1;return Ee(!0),Hr({libraryId:w,collectionId:R}).then(Pe=>{var Ze,na,ba,da;if(E)return;K(Pe);const Ve=(na=(Ze=ke.current.byLibrary)==null?void 0:Ze[w])==null?void 0:na.lastRevisionId,ta=((ba=Pe.find(De=>De.revisionId===m.revisionId))==null?void 0:ba.revisionId)??((da=Pe.find(De=>De.revisionId===Ve))==null?void 0:da.revisionId);me(ta)}).catch(()=>{E||(K([]),me(void 0))}).finally(()=>{E||Ee(!1)}),()=>{E=!0}},[m.revisionId,R,w]),r.useEffect(()=>{const E=m.infoId;if(!w||!E){c(void 0);return}let Pe=!1;return it({libraryId:w,infoId:E}).then(Ve=>{if(Pe)return;const ta=Ve.payload;c((ta==null?void 0:ta.label)??(ta==null?void 0:ta.name)??(ta==null?void 0:ta.title)??Ve.infoId)}).catch(()=>{Pe||c(E)}),()=>{Pe=!0}},[m.infoId,w]),r.useEffect(()=>{if(!pe.current||m.libraryId&&q.some(Ve=>Ve.libraryId===m.libraryId)&&m.libraryId!==w||m.target&&m.target!==B||m.revisionView&&m.revisionView!==he||m.revisionId&&m.revisionId!==ge||dr[B].requiresCollection&&!R&&m.target==="all_collections"&&m.collectionId)return;const E=Pt(`${I.pathname}${I.search}`),Pe=Pt(gr(w,B,R,he,ge,m.infoId,m.infoView??"overview"));if(E===Pe){Ue.current=null;return}Ue.current!==Pe&&(Ue.current=Pe,o(Pe,{replace:!0}))},[q,I.pathname,I.search,o,m.collectionId,m.infoId,m.infoView,m.libraryId,m.revisionId,m.revisionView,m.target,R,w,ge,he,B]),r.useEffect(()=>{if(typeof window>"u")return;const E=()=>{window.innerWidth>920&&ae(!1)};return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]),r.useEffect(()=>{if(!pe.current||!ea||!w||Re.current)return;const E=ke.current,Pe={...E.byLibrary??{}},Ve={...Pe[w]??{},lastCollectionId:R,lastRevisionId:ge,lastRevisionView:he,lastTarget:B},ta={version:1,lastLibraryId:w,byLibrary:{...Pe,[w]:Ve}},Ze=JSON.stringify(E),na=JSON.stringify(ta);if(Ze===na)return;ke.current=ta,Re.current=!0,(async()=>{try{if(_)await Fi(_,{plainValue:na});else{const da=await Bi(ea,{itemName:cr,itemType:"data",plainValue:na});Le(da.dataItemId)}}catch{Ae(b.status.savePrefsFailed)}finally{Re.current=!1}})()},[_,ea,R,w,ge,he,B,b.status.savePrefsFailed]);const Ba=async()=>{const E=Me.trim();if(!E){Ae(a.cogita.user.libraryNameRequired);return}Ae(null);try{const Pe=await Vi({name:E});Y(Ve=>[Pe,...Ve]),Z(Pe.libraryId),ne("library_overview"),W(void 0),Je("")}catch{Ae(a.cogita.user.libraryCreateFailed)}},ya=async()=>{if(!w){Ae(b.status.selectLibraryFirst);return}const E=Ke.trim();if(!E){Ae(a.cogita.library.collections.saveRequiredName);return}Ae(null);try{const Pe=await Di({libraryId:w,name:E,items:[]}),Ve=await jt({libraryId:w,limit:200});l(Ve.items),W(Pe.collectionId),me(void 0),ne("all_collections"),D("detail"),$e("")}catch{Ae(a.cogita.library.collections.saveFail)}},oa=async()=>{if(!w||!R){Ae(b.status.selectLibraryFirst);return}const E=ze.trim();if(!E){Ae(b.revisionForm.nameLabel);return}Ae(null);try{const Pe=await Ki({libraryId:w,collectionId:R,name:E,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});K(Ve=>[Pe,...Ve]),me(Pe.revisionId),ne("all_collections"),D("settings"),sa("")}catch{Ae(b.status.loadFailed)}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${ie?"open":""}`,"aria-label":b.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Be==null?void 0:Be.name)??b.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Be?b.sidebar.libraryActionsHint:b.status.selectLibraryFirst}),ca(Xe,"sidebar")]}),Sa?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:b.sidebar.infoActionsHint}),ca(Sa,"sidebar"),la?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(N==null?void 0:N.label)??oe??a.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:b.sidebar.selectedInfoActionsHint}),ca(la,"sidebar")]}):null]}):null,_e?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:_e.name}),e.jsx("p",{className:"cogita-sidebar-note",children:b.sidebar.collectionActionsHint}),ca(Ra,"sidebar")]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:b.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:u,children:b.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{L("cogita"),ae(!1)},children:b.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:x?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),ie?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":b.sidebar.closeMenu,onClick:()=>ae(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":b.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>ae(E=>!E),"aria-label":ie?b.sidebar.closeMenu:b.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),We.map((E,Pe)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Pe>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,E.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":E.label,children:E.selectedLabel}):e.jsxs("select",{"aria-label":E.label,value:E.value,onChange:Ve=>E.onSelect(Ve.target.value),disabled:E.disabled,children:[E.emptyOption?e.jsx("option",{value:"",children:E.emptyOption}):null,E.options.map(Ve=>e.jsx("option",{value:Ve.value,children:Ve.label},`${E.key}:${Ve.value}`))]})]},`menu:${E.key}`))]}),xa?e.jsxs(e.Fragment,{children:[B==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:E=>$e(E.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!w})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,disabled:!w,children:a.cogita.library.actions.createCollection}),Te?e.jsx("p",{className:"cogita-form-error",children:Te}):null]}):null,B==="all_collections"&&R&&he==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:b.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:b.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:ze,onChange:E=>sa(E.target.value),placeholder:b.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:oa,children:b.revisionForm.createAction}),Te?e.jsx("p",{className:"cogita-form-error",children:Te}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Gr.Provider,{value:!0,children:xa})})]}):null,xa?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:b.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[We.map((E,Pe)=>e.jsxs("span",{children:[Pe>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:E.selectedLabel})]},`path:${E.key}`)),se?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:b.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[b.path.currentRoute," ",e.jsx("code",{children:gr(w,B,R,he,ge,m.infoId,m.infoView??"overview")})]}),w?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${w}`,children:b.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${w}/list`,children:b.links.allCards}),R?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${w}/collections/${R}/shared-revisions`,children:b.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:b.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Me,onChange:E=>Je(E.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ba,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:E=>$e(E.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!w})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,disabled:!w,children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:b.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:ze,onChange:E=>sa(E.target.value),placeholder:b.revisionForm.namePlaceholder,disabled:!R})]}),e.jsx("button",{type:"button",className:"cta",onClick:oa,disabled:!R,children:b.revisionForm.createAction}),Te?e.jsx("p",{className:"cogita-form-error",children:Te}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:b.panels.collections}),le?e.jsx("p",{className:"cogita-library-subtitle",children:b.status.loadingCollections}):null,!le&&U.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:b.status.noCollections}):null,U.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:U.map(E=>e.jsxs("button",{type:"button",className:`cogita-card-item ${E.collectionId===R?"active":""}`,onClick:()=>{W(E.collectionId),me(void 0),D("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:b.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:E.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[E.itemCount," ",b.cards.itemsSuffix]})]},E.collectionId))}):null]})]})]})]})})}const Xn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:zn},Symbol.toStringTag,{value:"Module"}));function Hn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,shareId:o}){const[I,m]=r.useState(null),[b,q]=r.useState("loading"),[Y,U]=r.useState(a.cogita.library.collections.defaultName),[l,p]=r.useState("Cogita Library"),[f,ue]=r.useState([]),[K,w]=r.useState([]),[Z,B]=r.useState("idle"),[ne,R]=r.useState({current:0,total:0}),[W,ge]=r.useState(0),[me,he]=r.useState(""),[D,oe]=r.useState(null),[c,ie]=r.useState(null),[ae,O]=r.useState(null),[Ce,le]=r.useState(null),[re,Ne]=r.useState([]),[Ee,Te]=r.useState({}),[Ae,Me]=r.useState({}),[Je,Ke]=r.useState(null),[$e,ze]=r.useState(null),[sa,ea]=r.useState(null),[k,_]=r.useState(null),[Le,ke]=r.useState({}),pe=r.useRef(0),[Re,Ue]=r.useState(null),Be=r.useRef(null),_e=r.useRef(null),[v,T]=r.useState(null),[Q,t]=r.useState(!1),[i,h]=r.useState(null),[N,V]=r.useState([]),[ee,te]=r.useState(null),G=r.useRef(null),de=r.useRef(null),[se,we]=r.useState(null),[aa,qe]=r.useState(0),ia=r.useRef(null),Oe=r.useRef({}),[We,Fe]=r.useState(!1),[Xe,Sa]=r.useState({}),la=r.useRef(null),Ra=r.useRef(new Set),ca=r.useRef({}),[xa,Ba]=r.useState([]),[ya,oa]=r.useState(new Set),[E,Pe]=r.useState(!1),Ve=yr(),ta=r.useMemo(()=>new URLSearchParams(Ve.search),[Ve.search]),Ze=r.useMemo(()=>ta.get("key")??"",[ta]),na=(I==null?void 0:I.mode)??"random",ba=(I==null?void 0:I.check)??"exact",da=(I==null?void 0:I.limit)??20,De=r.useMemo(()=>Tr((I==null?void 0:I.revisionType)??na),[I,na]),ra=r.useMemo(()=>{const $=I==null?void 0:I.revisionSettings,X=ii(De,ta);return Jt(De,$??X)},[I,ta,De]),Ia=r.useMemo(()=>a.cogita.library.revision[De.labelKey]??na,[a,na,De]),$a=r.useMemo(()=>ba==="exact"?a.cogita.library.revision.checkValue:ba,[a,ba]),ve=b==="ready"?f[W]??null:null,Ua=(ve==null?void 0:ve.checkType)==="translation-match"&&k,La=r.useRef(new Map),_a=r.useRef(new Map),Wa=r.useRef(new Map),ma=r.useRef(new Map),za=r.useMemo(()=>ve?ve.cardType==="vocab"?a.cogita.library.revision.vocabLabel:ve.infoType?Ge(a,ve.infoType):a.cogita.library.revision.infoLabel:"",[a,ve]),nt=r.useMemo(()=>{var X;return De.id!=="levels"?f.length:((X=Xe.pool)==null?void 0:X.length)??De.getFetchLimit(da,ra)},[Xe,ra,De,f.length,da]),ot=De.getProgressTotal?De.getProgressTotal(f,Xe,da,ra):De.id==="levels"?Math.min(da,nt):f.length,Ea=ot?Math.min(W+1,ot):0,ka=Math.max(1,Number(ra.tries??1)),Ha=ra.compare??"anchors",fa=Math.max(0,Math.min(100,Number(ra.minCorrectness??0))),ua=(ra.considerDependencies??"on")==="on",Pa=Math.max(0,Math.min(100,Number(ra.dependencyThreshold??85))),Qa=$=>{const X=$.slice();for(let d=X.length-1;d>0;d-=1){const y=Math.floor(Math.random()*(d+1));[X[d],X[y]]=[X[y],X[d]]}return X},Ja=$=>$.length?$.reduce((d,y)=>d+y,0)/$.length/255*100:0,st=$=>Ja($)>=fa,Yt=async()=>{const $=await Oa(),X=new Map,d=new Map;$.forEach(M=>{const J=`${M.itemType}:${M.itemId}`,S=Ka(M.itemType,M.itemId,M.checkType,M.direction);X.has(J)||X.set(J,[]),X.get(J).push(M),d.has(S)||d.set(S,[]),d.get(S).push(M)});const y=new Map,P=new Map;return X.forEach((M,J)=>y.set(J,Va(M).score)),d.forEach((M,J)=>P.set(J,Va(M).score)),{itemKnowness:y,cardKnowness:P}},xt=async $=>{const X=Xe,d=$.concat(X.active??[]).concat(X.pool??[]).filter((H,ce,be)=>be.findIndex(ye=>xe(ye)===xe(H))===ce);if(!ua){oa(new Set(d.map(xe)));return}const{itemKnowness:y,cardKnowness:P}=await Yt(),M=H=>{if(H.cardType!=="info"||H.infoType!=="quote"||H.checkType!=="quote-fragment")return!0;const ce=Ta(H.direction);if(!(ce!=null&&ce.fragmentId))return!0;const be=H.description??"";if(!be.trim())return!0;const fe=pt(be).nodes[ce.fragmentId];if(!fe||!fe.leftId&&!fe.rightId)return!0;const Se=[fe.leftId,fe.rightId].filter(Qe=>!!Qe);if(Se.length===0)return!0;const Ie=Se.map(Qe=>{const ha=Ka("info",H.cardId,"quote-fragment",Tt(ce.mode,Qe));return P.get(ha)??0});return Ie.reduce((Qe,ha)=>Qe+ha,0)/Ie.length>=Pa},J=(I==null?void 0:I.collectionId)??null,S=J?xa.filter(H=>pa(H.childItemType)==="collection"&&H.childItemId===J&&!pa(H.childCheckType)&&!pa(H.childDirection)):[],z=J&&d.length>0?d.reduce((H,ce)=>H+(P.get(xe(ce))??0),0)/d.length:0,F=new Set;for(const H of d){if(H.cardType!=="info"){F.add(xe(H));continue}if(!M(H))continue;const ce=xa.filter(fe=>di(fe,H)).concat(S);if(ce.length===0){F.add(xe(H));continue}let be=0;for(const fe of ce)if(pa(fe.parentItemType)==="collection")be+=fe.parentItemId===J?z:0;else if(pa(fe.parentCheckType)||pa(fe.parentDirection)){const Se=pa(fe.parentCheckType),Ie=pa(fe.parentDirection),He=Ka(fe.parentItemType,fe.parentItemId,Se,Ie);be+=P.get(He)??0}else{const Se=`${fe.parentItemType}:${fe.parentItemId}`;be+=y.get(Se)??0}be/ce.length>=Pa&&F.add(xe(H))}oa(F)},Qt=$=>{for(let X=$;X<f.length;X+=1){const d=f[X];if(d&&(!ua||d.cardType!=="info"||ya.has(xe(d))))return X}return-1},lt=$=>!ua||$.cardType!=="info"||ya.has(xe($)),Gt=$=>{if(De.id!=="temporal"&&De.id!=="levels")return null;const X=Xe,d=(X.active??[]).concat(X.pool??[]),y=new Set;for(const P of d){const M=xe(P);if(!(y.has(M)||$.has(M))&&(y.add(M),lt(P)))return P}return null},Ca=r.useMemo(()=>{if(De.id!=="levels")return null;const $=Xe,X=$.pool??[],d=$.active??[],y=$.levelMap??{},P=Math.max(1,Number(ra.levels??1)),M=Array.from({length:P},()=>0),J=new Set(d.map(H=>xe(H)));X.forEach(H=>{const ce=Math.min(P,Math.max(1,y[xe(H)]??1));M[ce-1]+=1});const S=X.length||1,z=M.map(H=>H/S*100),F=ve?y[xe(ve)]??1:null;return{counts:M,percentages:z,currentLevel:F,levelsCount:P,activeCount:d.length,poolCount:X.length,activeSet:J}},[Xe,ra,De,ve]),ct=r.useMemo(()=>{if(De.id!=="temporal")return null;const $=Xe,X=$.pool??[],d=$.active??[],y=$.knownessMap??{},P=new Set($.unknownSet??[]);let M=0;X.forEach(z=>{(y[xe(z)]??0)>1&&(M+=1)});const J=P.size,S=d.map(z=>({id:xe(z),value:P.has(xe(z))?0:Math.max(0,Math.min(1,y[xe(z)]??0))}));return{knownCount:M,unknownCount:J,dots:S}},[Xe,De]),Aa=r.useMemo(()=>{if(!ua)return 0;const $=Xe;return f.concat($.active??[]).concat($.pool??[]).filter((d,y,P)=>P.findIndex(M=>xe(M)===xe(d))===y).filter(d=>d.cardType==="info"&&!ya.has(xe(d))).length},[ua,Xe,f,ya]);r.useEffect(()=>{if(!ua||Z!=="ready")return;const $=Xe,d=f.concat($.active??[]).concat($.pool??[]).filter((M,J,S)=>S.findIndex(z=>xe(z)===xe(M))===J).filter(M=>M.cardType!=="info"||ya.has(xe(M))).length,y=G.current;if(G.current=d,y===null||d<=y)return;const P=d-y;te(`New card available (+${P})`),de.current&&window.clearTimeout(de.current),de.current=window.setTimeout(()=>te(null),2200)},[ua,Z,Xe,f,ya]),r.useEffect(()=>()=>{de.current&&window.clearTimeout(de.current)},[]);const va=($,X)=>{const d=De.applyOutcome({queue:f,meta:Xe},ve,da,ra,{correct:$,correctness:X,createdUtc:new Date().toISOString()});ue(d.queue),Sa(d.meta);const y=d.queue[W+1];y&&Ma(y,W+1)};r.useEffect(()=>{if(!o){q("error");return}q("loading"),Oi({shareId:o,key:Ze}).then($=>{m($),U($.collectionName),p($.libraryName),q("ready")}).catch(()=>{q("error")})},[o,Ze]),r.useEffect(()=>{o&&_i({shareId:o,key:Ze,type:"language"}).then($=>w($)).catch(()=>w([]))},[o,Ze]),r.useEffect(()=>{!o||b!=="ready"||qi({shareId:o,key:Ze}).then($=>Ba($.items??[])).catch(()=>Ba([]))},[o,Ze,b]),r.useEffect(()=>{if(!o||b!=="ready")return;let $=!0;return(async()=>{B("loading"),R({current:0,total:De.id==="levels"?0:De.getFetchLimit(da,ra)});try{const d=[];let y=null,P=null;do{const ce=await Ui({shareId:o,key:Ze,limit:300,cursor:y});if(d.push(...ce.items),(De.id==="levels"||De.id==="temporal")&&ce.total&&(P=ce.total),R(be=>({current:d.length,total:be.total||ce.total||De.getFetchLimit(da,ra)})),y=ce.nextCursor??null,P!==null&&d.length>=P||De.id!=="levels"&&De.id!=="temporal"&&d.length>=De.getFetchLimit(da,ra))break}while(y);if(!$)return;const M=mr(d);let J;if(De.id==="levels"){const ce=Math.max(1,Number(ra.levels??1));J={},M.forEach(be=>{const ye=xe(be);J[ye]=Math.max(1,Math.min(ce,1))})}let S=null,z=null,F=null;if(De.id==="temporal"){const ce=await Oa(),be=new Set(M.map(Se=>xe(Se))),ye=ce.reduce((Se,Ie)=>{const He=Ka(Ie.itemType,Ie.itemId,Ie.checkType,Ie.direction);return be.has(He)&&(Se[He]||(Se[He]=[]),Se[He].push(Ie)),Se},{});S={},z=new Set,F={};const fe=Date.now();M.forEach(Se=>{const Ie=xe(Se),He=ye[Ie]??[];if(He.length===0){S[Ie]=0,z.add(Ie),F[Ie]=[];return}const Qe=wr(He);F[Ie]=Qe;const ha=zt(Qe,fe);S[Ie]=ha.knowness})}const H=De.id==="levels"?kr(M,da,ra,J):De.id==="temporal"?jr(M,da,ra,S??{},z??new Set,F??{}):De.prepare(M,da,ra);ue(H.queue),Sa(H.meta),ge(0),B("ready"),R(ce=>({current:Math.min(ce.current,ce.total),total:ce.total}))}catch{$&&B("error")}})(),()=>{$=!1}},[o,Ze,da,De,ra,b]),r.useEffect(()=>{xt(f)},[f,xa,ua,Pa,I==null?void 0:I.collectionId]),r.useEffect(()=>{if(!ve||!ua){Pe(!1);return}if(ve.cardType!=="info"||ya.has(xe(ve))){Pe(!1);return}const $=Qt(W+1);if($>=0){Pe(!1),ge($);return}if(De.id==="temporal"||De.id==="levels"){const X=f.slice(0,W+1),d=f.slice(W+1).filter(lt),y=X.concat(d),P=new Set(y.map(xe)),M=Gt(P);if(M){const S=xe(M);P.has(S)||(y.push(M),P.add(S),Sa(z=>{const F=z,H=new Set(F.queued??[]);return H.add(S),{...F,queued:H}}))}const J=y.findIndex((S,z)=>z!==W&&lt(S));if(J>=0){ue(y),ge(J),Pe(!1);return}}Pe(!0)},[ve,ya,ua,W,f,Xe,De.id]),r.useEffect(()=>{if(he(""),oe(null),we(null),qe(0),Ne([]),Te({}),Me({}),Ke(null),ze(null),ea(null),t(!1),Fe(!1),T(null),_(null),ke({}),!ve){ie(null),O(null);return}ve.cardType==="info"&&ve.infoType==="computed"&&ie(a.cogita.library.revision.loadingComputed);let $=!0;return Ma(ve,W).then(X=>{!$||!X||(ie(X.prompt),O(X.expectedAnswer),Ne(X.computedExpected),Te(X.computedAnswers),Ke(X.answerTemplate),ze(X.outputVariables),ea(X.variableValues))}),()=>{$=!1}},[ve,o,a]),r.useEffect(()=>{if(!ve||ve.cardType!=="info"||ve.infoType!=="quote"){la.current=null,Ra.current=new Set,le(null);return}const $=ve.description??"",X=(ve.label??"").trim(),d=X.replace(/\s+/g," ").trim(),y=$.replace(/\s+/g," ").trim(),P=d&&d!==y?X:a.cogita.library.infoTypes.quote;if(!$){le(null),O(null);return}const M=pt($);la.current=M,ie(P);let J=!0;return Oa().then(S=>{if(!J)return;const z=getQuoteMode(ve.direction),F=new Map;S.forEach(fe=>{if(fe.itemType!=="info"||fe.checkType!=="quote-fragment"||!fe.direction)return;const Se=Ta(fe.direction);if(!Se||Se.mode!==z)return;const Ie=`${fe.itemId}:${Se.fragmentId}`;F.has(Ie)||F.set(Ie,[]),F.get(Ie).push(fe)});const H={},ce=new Set;F.forEach((fe,Se)=>{const[Ie,He]=Se.split(":",2);if(Ie!==ve.cardId)return;const Qe=Va(fe).score;H[He]=Qe,Qe>=Pa&&ce.add(He)}),Ra.current=ce,ca.current=H;const be=Ta(ve.direction);if(be!=null&&be.fragmentId&&M.nodes[be.fragmentId]){Za(M,be.fragmentId,P);return}const ye=bt(M,ce,H,Pa,ua,ve.direction);Za(M,(ye==null?void 0:ye.id)??null,P)}).catch(()=>{Ra.current=new Set,ca.current={};const S=Ta(ve.direction);if(S!=null&&S.fragmentId&&M.nodes[S.fragmentId]){Za(M,S.fragmentId,P);return}const z=bt(M,Ra.current,{},Pa,ua,ve.direction);Za(M,(z==null?void 0:z.id)??null,P)}),()=>{J=!1}},[ve,a,ua,Pa]),r.useEffect(()=>{if(!ve||ve.cardType!=="vocab"||ve.checkType!=="translation-match"){_(null),ke({});return}const d=(Xe.pool??Xe.active??f).filter(S=>S.cardType==="vocab"&&S.checkType==="translation-match").filter((S,z,F)=>F.findIndex(H=>H.cardId===S.cardId)===z);d.some(S=>S.cardId===ve.cardId)||d.unshift(ve);const P=Qa(d).slice(0,6).map(S=>{const z=S.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(z.length<2)return null;const F=`${S.cardId}:L`,H=`${S.cardId}:R`;return{cardId:S.cardId,leftId:F,rightId:H,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),M=P.map(S=>S.leftId),J=Qa(P.map(S=>S.rightId));_({pairs:P,leftOrder:M,rightOrder:J,selection:{},activeLeft:null,activeRight:null,locked:{}})},[ve,f,Xe]),r.useEffect(()=>()=>{Be.current&&window.clearTimeout(Be.current),_e.current&&window.clearTimeout(_e.current)},[]);const dt=r.useRef(null);r.useEffect(()=>{if(!ve)return;const $=xe(ve),X=typeof document<"u"?document.activeElement:null;if(dt.current===$&&X&&(X.tagName==="INPUT"||X.tagName==="TEXTAREA"))return;let d=0;const y=()=>{if(ve){if(ve.cardType==="info"&&ve.infoType==="computed"){if(re.length>0){const M=qt(Je,re,$e),J=M?Oe.current[M]:null;if(J&&(J.focus(),document.activeElement===J)){dt.current=$;return}}if(ia.current&&(ia.current.focus(),document.activeElement===ia.current)){dt.current=$;return}}else if(ve.cardType==="vocab"&&ia.current&&(ia.current.focus(),document.activeElement===ia.current)){dt.current=$;return}d<6&&(d+=1,window.setTimeout(y,40))}},P=window.setTimeout(y,40);return()=>window.clearTimeout(P)},[ve,re,Je,$e]),r.useEffect(()=>{if(!We)return;const $=X=>{X.key==="Enter"&&(X.preventDefault(),ut())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[We]);const wa=$=>{V($),h(Va($))};r.useEffect(()=>{if(!ve){h(null),V([]);return}const $=ve.cardType==="info"?"info":"connection";if(ve.cardType==="info"&&ve.infoType==="quote"){Oa().then(X=>{const d=X.filter(y=>y.itemType==="info"&&y.itemId===ve.cardId&&y.checkType==="quote-fragment"&&Ot(y.direction,ve.direction));wa(d)}).catch(()=>{h(null),V([])});return}Kt($,ve.cardId,ve.checkType,ve.direction).then(X=>wa(X)).catch(()=>{h(null),V([])})},[ve]);const Ga=($,X,d,y)=>{if($==="info"&&d==="quote-fragment"){Oa().then(P=>{const M=P.filter(J=>J.itemType==="info"&&J.itemId===X&&J.checkType==="quote-fragment"&&Ot(J.direction,y));wa(M)}).catch(()=>{h(null),V([])});return}Kt($,X,d,y).then(P=>wa(P)).catch(()=>{h(null),V([])})},Xa=($,X,d)=>{var J;const y=((J=d.pairs.find(S=>S.leftId===$))==null?void 0:J.rightId)??null;if(!y)return d;const P=y===X;ke(S=>({...S,[$]:P?"correct":"incorrect"})),Be.current&&window.clearTimeout(Be.current),_e.current&&window.clearTimeout(_e.current),pe.current+=1;const M={kind:P?"correct":"incorrect",tick:pe.current};if(Ue(null),Be.current=window.setTimeout(()=>Ue(M),0),_e.current=window.setTimeout(()=>Ue(null),420),P){const S={...d.locked,[$]:!0};return Object.keys(S).length>=d.pairs.length?(oe("correct"),Fe(!0)):oe("correct"),{...d,selection:{...d.selection,[$]:X},activeLeft:null,activeRight:null,locked:S}}return oe("incorrect"),{...d,activeLeft:null,activeRight:null}},Lt=$=>{_(X=>!X||X.locked[$]?X:X.activeRight?Xa($,X.activeRight,X):{...X,activeLeft:X.activeLeft===$?null:$})},Ct=$=>{_(X=>X&&(X.activeLeft?Xa(X.activeLeft,$,X):{...X,activeRight:X.activeRight===$?null:$}))},ut=()=>{var $;if(ve&&ve.cardType==="info"&&ve.infoType==="quote"&&la.current&&Ce&&!(($=Ta(ve.direction))!=null&&$.fragmentId)){const X=bt(la.current,Ra.current,ca.current,Pa,ua,ve.direction,Ce.fragmentId);if(X){oe(null),he(""),t(!1),Me({}),Fe(!1),we(null),qe(0),Za(la.current,X.id,Ce.title);return}}oe(null),he(""),t(!1),Me({}),Fe(!1),we(null),qe(0),ge(X=>Math.min(X+1,f.length))},Fa=$=>{if(!ve)return;const X=$.expected??null,d=$.answer??"";let y=X??"",P=d;if(!X&&$.expectedMap&&$.answerMap){const ce=Object.keys($.expectedMap).sort((be,ye)=>be.localeCompare(ye));y=ce.map(be=>{var ye;return((ye=$.expectedMap)==null?void 0:ye[be])??""}).join("|"),P=ce.map(be=>{var ye;return((ye=$.answerMap)==null?void 0:ye[be])??""}).join("|")}const M=y?mt(y,P,Ha):new Uint8Array,J={revisionType:De.id,evalType:$.evalType,direction:$.direction,prompt:c??"",expected:X,answer:d,expectedAnswers:$.expectedMap??null,answers:$.answerMap??null,correct:$.correct,maskBase64:M.length?Ya(M):null,checkMode:ba,compareMode:Ha,minCorrectness:fa},S=new TextEncoder().encode(JSON.stringify(J)),z=ve.cardType==="info"?"info":"connection",F=$.overrideCheckType??ve.checkType??null,H=$.overrideDirection??ve.direction??null;Dt({itemType:z,itemId:ve.cardId,checkType:F,direction:H,revisionType:De.id,evalType:$.evalType,correct:$.correct,maskBase64:M.length?Ya(M):null,payloadBase64:Ya(S)}).then(()=>{Ga(z,ve.cardId,F,H),xt(f)}).catch(()=>{})},gt=($,X)=>{const d=La.current.get(X);if(d)return Promise.resolve(d);const y=_a.current.get(X);if(y)return y;const P=Wi({shareCode:o,infoId:$,key:Ze}).then(M=>{var ce,be;const J=M.payload,S=((ce=J.definition)==null?void 0:ce.graph)??null,z="",F=((be=J.definition)==null?void 0:be.answerTemplate)??"",H=vr(S,z,F);if(H){const fe={sample:ei(H),answerTemplate:F||null};return La.current.set(X,fe),fe}return Sr({shareId:o,infoId:$,key:Ze}).then(ye=>{const fe={sample:ye,answerTemplate:null};return La.current.set(X,fe),fe})}).catch(()=>Sr({shareId:o,infoId:$,key:Ze}).then(M=>{const J={sample:M,answerTemplate:null};return La.current.set(X,J),J}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{_a.current.delete(X)});return _a.current.set(X,P),P},Ma=($,X)=>{var S;const d=`${xe($)}:${X}`,y=Wa.current.get(d);if(y)return Promise.resolve(y);const P=ma.current.get(d);if(P)return P;const M=z=>(Wa.current.set(d,z),z);let J;if($.cardType==="vocab"){if($.checkType==="translation-match")return J=Promise.resolve(M({prompt:$.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),J;const z=$.label.split("↔").map(F=>F.trim()).filter(Boolean);if(z.length>=2){const H=($.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ce=H?z[0]:z[1],be=H?z[1]:z[0];J=Promise.resolve(M({prompt:ce,expectedAnswer:be,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else J=Promise.resolve(M({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if($.cardType==="info"&&$.infoType==="word"){const z=(S=$.description)!=null&&S.startsWith("Language: ")?$.description.replace("Language: ",""):null;J=Promise.resolve(M({prompt:$.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else $.cardType==="info"&&$.infoType==="computed"?J=gt($.cardId,d).then(z=>{var ye,fe;if(!z.sample)return M({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const F=z.sample,H=F.expectedAnswers?Object.entries(F.expectedAnswers).map(([Se,Ie])=>({key:Se,expected:Ie})):[],ce=H.reduce((Se,Ie)=>(Se[Ie.key]="",Se),{}),be=F.expectedAnswerIsSentence&&((ye=F.expectedAnswer)==null?void 0:ye.trim())||null;return M({prompt:F.prompt,expectedAnswer:H.length>0?be:((fe=F.expectedAnswer)==null?void 0:fe.trim())||null,computedExpected:H,computedAnswers:ce,answerTemplate:z.answerTemplate,outputVariables:F.outputVariables??null,variableValues:F.variableValues??null})}).catch(()=>M({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{ma.current.delete(d)}):J=Promise.resolve(M({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return ma.current.set(d,J),J},Za=($,X,d)=>{const y=Object.keys($.nodes).length,P=Ra.current.size;if(!X){le({title:d,before:$.text,after:"",fragmentId:null,total:y,completed:P}),O(null),Fe(!0);return}const M=$.nodes[X];if(!M)return;const J=ai($.text,M);le({title:d,before:J.before,after:J.after,fragmentId:M.id,total:y,completed:P}),O(J.fragment),Fe(!1)},yt=()=>{const $=la.current;$&&le(X=>X&&{...X,total:Object.keys($.nodes).length,completed:Ra.current.size})},Da=()=>{const $=f[W+1];$&&Ma($,W+1)},Mt=()=>{if(Da(),ve&&ve.cardType==="vocab"&&ve.checkType==="translation-match"&&k){if(k.pairs.length===0){oe("incorrect"),Fe(!0);return}const M=k.pairs.reduce((be,ye)=>(be[ye.rightId]=ye.rightLabel,be),{});let J=0;const S={};k.pairs.forEach(be=>{const fe=k.selection[be.leftId]===be.rightId;S[be.leftId]=fe?"correct":"incorrect",fe&&(J+=1)});const z=k.pairs.length||1,F=J/z,H=J===k.pairs.length;ke(be=>({...be,...S})),H?(oe("correct"),Fe(!0),qe(0)):(oe("incorrect"),Fe(!1),qe(be=>{const ye=be+1;return ye>=ka&&(t(!0),Fe(!0),_(fe=>{if(!fe)return fe;const Se=fe.pairs.reduce((Ie,He)=>(Ie[He.leftId]=He.rightId,Ie),{});return{...fe,selection:Se}})),ye})),va(H,F);const ce="connection";Promise.all(k.pairs.map(be=>{const ye=k.selection[be.leftId]??null,fe=ye?M[ye]:"",Se={left:be.leftLabel,expected:be.rightLabel,answer:fe,checkType:"translation-match"},Ie=new TextEncoder().encode(JSON.stringify(Se));return Dt({itemType:ce,itemId:be.cardId,checkType:"translation-match",direction:null,revisionType:De.id,evalType:"translation-match",correct:ye===be.rightId,maskBase64:null,payloadBase64:Ya(Ie)})})).then(()=>{Ga(ce,ve.cardId,ve.checkType,ve.direction),xt(f)}).catch(()=>{});return}if(re.length>0){const M=re.reduce((S,z)=>{const F=Ee[z.key]??"";return S[z.key]=ja(F)===ja(z.expected)?"correct":"incorrect",S},{});re.every(({key:S,expected:z})=>{const F=Ee[S]??"";return ba==="exact"&&ja(F)===ja(z)})?(oe("correct"),Me(M),Fe(!0),qe(0),va(!0,1),Fa({correct:!0,direction:c?`${c} -> computed`:"computed",expectedMap:re.reduce((S,z)=>(S[z.key]=z.expected,S),{}),answerMap:Ee,evalType:"computed"})):(oe("incorrect"),Me(M),Fe(!1),qe(S=>{const z=S+1;return z>=ka&&et&&(t(!0),Fe(!0)),z}),va(!1,0),window.setTimeout(()=>{var z;const S=qt(Je,re,$e);S&&Oe.current[S]&&((z=Oe.current[S])==null||z.focus())},40),Fa({correct:!1,direction:c?`${c} -> computed`:"computed",expectedMap:re.reduce((S,z)=>(S[z.key]=z.expected,S),{}),answerMap:Ee,evalType:"computed"}));return}if(ve&&ve.cardType==="info"&&ve.infoType==="quote"&&(Ce!=null&&Ce.fragmentId)){if(!ae)return;const M=Ta(ve.direction),J=(M==null?void 0:M.mode)??getQuoteMode(ve.direction),S=M!=null&&M.fragmentId&&ve.direction?ve.direction:Tt(J,Ce.fragmentId),z=ci(ae,me,Ha),F=ba==="exact"&&ft(me)===ft(ae),H=st(z),ce=F||H,be=Ja(z);ce?(ca.current[Ce.fragmentId]=Math.max(ca.current[Ce.fragmentId]??0,be),(ca.current[Ce.fragmentId]??0)>=Pa&&Ra.current.add(Ce.fragmentId),yt(),oe("correct"),Me({}),Fe(!0),we(z),qe(0),be<100&&ka<=1&&t(!0),va(!0,be/100),Fa({correct:!0,direction:`quote:${Ce.fragmentId}`,expected:ae,answer:me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:S})):(oe("incorrect"),Me({}),Fe(!1),we(z),qe(ye=>{const fe=ye+1;return fe>=ka&&et&&(t(!0),Fe(!0)),fe}),va(!1,be/100),window.setTimeout(()=>{var ye;return(ye=ia.current)==null?void 0:ye.focus()},40),Fa({correct:!1,direction:`quote:${Ce.fragmentId}`,expected:ae,answer:me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:S}));return}if(!ae)return;const $=mt(ae,me,Ha),X=ba==="exact"&&ja(me)===ja(ae),d=st($),y=X||d,P=Ja($);y?(oe("correct"),Me({}),Fe(!0),we($),qe(0),P<100&&ka<=1&&t(!0),va(!0,P/100),Fa({correct:!0,direction:c?`${c} -> ${ae}`:null,expected:ae,answer:me,evalType:"text"})):(oe("incorrect"),Me({}),Fe(!1),we($),qe(M=>{const J=M+1;return J>=ka&&et&&(t(!0),Fe(!0)),J}),va(!1,P/100),window.setTimeout(()=>{var M;return(M=ia.current)==null?void 0:M.focus()},40),Fa({correct:!1,direction:c?`${c} -> ${ae}`:null,expected:ae,answer:me,evalType:"text"}))},ht=$=>{if(Da(),!ae)return;const X=mt(ae,$,Ha),d=ja($)===ja(ae),y=st(X),P=d||y,M=Ja(X);P?(oe("correct"),Me({}),Fe(!0),we(X),qe(0),M<100&&ka<=1&&t(!0),va(!0,M/100),Fa({correct:!0,direction:"word->language",expected:ae,answer:$,evalType:"language-select"})):(oe("incorrect"),Me({}),Fe(!1),we(X),qe(J=>{const S=J+1;return S>=ka&&et&&(t(!0),Fe(!0)),S}),va(!1,M/100),Fa({correct:!1,direction:"word->language",expected:ae,answer:$,evalType:"language-select"}))},St=$=>{var d;if($.key!=="Enter")return;if($.preventDefault(),$.stopPropagation(),We){ut();return}const X=re.find(y=>!(Ee[y.key]??"").trim());if(X){(d=Oe.current[X.key])==null||d.focus();return}Mt()},Xt=()=>{Da(),oe("correct"),Fe(!0),qe(0),va(!0,1),ae&&Fa({correct:!0,direction:"manual",expected:ae,answer:me,evalType:"manual"})},Zt=()=>{if(va(!1,0),ve&&ve.cardType==="info"&&ve.infoType==="quote"){oe(null),he(""),t(!1),Me({}),Fe(!1),we(null),qe(0),ge($=>Math.min($+1,f.length));return}ut()};r.useEffect(()=>{Da()},[W,f]);const er=a.cogita.library.revision.revealModeAfterIncorrect,et=re.length>0||!!ae;return e.jsxs(Na,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:u,onToggleSecureMode:g,onLogout:j,secureMode:x,onNavigate:L,language:A,onLanguageChange:C,children:[(b==="loading"||Z==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:b==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ne.total?Math.min(100,Math.max(0,ne.current/ne.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ne.total?`${Math.min(ne.current,ne.total)} / ${ne.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:Y}),e.jsx("p",{className:"cogita-library-subtitle",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",Ia).replace("{check}",$a)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:i?`${i.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ca?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Ca.currentLevel??"-"," / ",Ca.levelsCount]}):null,i?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(i.correct)).replace("{total}",String(i.total))}),i.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(i.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(oi,{outcomes:N})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[ee?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:ee})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Re?`${Re.kind}-${Re.tick}`:Ua?"idle":D??"idle",children:b!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:b==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):ve?e.jsx(e.Fragment,{children:E?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ni,{copy:a,currentCard:ve,currentTypeLabel:za,prompt:c,languages:K,answer:me,onAnswerChange:$=>he(X=>_t(X,$,v)),computedExpected:re,computedAnswers:Ee,onComputedAnswerChange:($,X)=>Te(d=>({...d,[$]:_t(d[$]??"",X,v)})),answerTemplate:Je,outputVariables:$e,variableValues:sa,computedFieldFeedback:Ae,feedback:D,canAdvance:We,quoteContext:Ce,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:Zt,onLanguageSelect:ht,onMarkReviewed:Xt,onAdvance:ut,showCorrectAnswer:Q,setShowCorrectAnswer:t,onRevealCorrect:()=>Fe(!0),answerMask:se,expectedAnswer:ae,hasExpectedAnswer:et,handleComputedKeyDown:St,answerInputRef:ia,computedInputRefs:Oe,scriptMode:v,setScriptMode:T,matchPairs:k==null?void 0:k.pairs,matchLeftOrder:k==null?void 0:k.leftOrder,matchRightOrder:k==null?void 0:k.rightOrder,matchSelection:k==null?void 0:k.selection,matchActiveLeft:k==null?void 0:k.activeLeft,matchActiveRight:k==null?void 0:k.activeRight,matchFeedback:Le,onMatchLeftSelect:Lt,onMatchRightSelect:Ct})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ot?`${Ea} / ${ot}`:a.cogita.library.revision.progressUnlimited}),b==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),b==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),b==="ready"&&Z==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),b==="ready"&&Z==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),b==="ready"&&Z==="ready"&&f.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:er}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",ka]})]})]}),Ca?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Ca.activeCount," / ",Ca.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ca.counts.map(($,X)=>{const d=X+1,y=Ca.currentLevel===d,P=Ca.percentages[X]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":y,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:d}),e.jsx("strong",{children:$})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,P))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[P.toFixed(1),"%"]})]},`level-${d}`)})})]}):null,ct?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ct.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ct.dots.map($=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-$.value))}, ${Math.round(200*$.value)}, 80, 0.9)`}},$.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ct.knownCount})]})]}):null,ua?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Aa})]})}):null]})]})]})})})]})]})}const Zn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Hn},Symbol.toStringTag,{value:"Module"}));export{Gn as C,Xn as a,Zn as b};
