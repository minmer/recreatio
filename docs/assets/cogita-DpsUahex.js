import{r as i,j as e,R as fr,B as xr,C as yr,H as Cr,P as Mr,a as Rt,b as di,c as ui,u as Or,d as Vr,e as vr,f as gi}from"./vendor-DrCXrCXJ.js";import{L as qr,A as _r,g as Ur,a as hi,b as jt,c as Wr,s as $t,d as zr,e as jr,f as et,h as hr,i as Et,j as br,k as bi,l as tr,m as at,u as mi,n as ga,o as pi,p as fi,q as xi,r as Hr,t as Jr,v as yi,w as vi,x as ji,y as Wt,z as At,B as wi,C as ki,D as Ti,E as Ni,F as Li,G as Ci,H as za,I as Mi,J as Si,K as Ii,M as Pi,N as Ri,O as $i,P as Ei,Q as Ai,R as Fi,S as Bi,T as Di,U as Ki,V as Oi,W as Vi,X as qi,Y as _i,Z as Sr}from"./recreatio-core-Bh2y2_Tf.js";import"./vendor-cogita-ui-DLgJCpO3.js";const vt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},yt={moveMs:900,pauseMs:220,errorMs:900},Ui=(a=11)=>{let n=a;const o=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:u,height:g,paddingX:w,paddingY:f,levels:P}=vt,M=(g-f*2)/(P.length-1),F=[],l=[],C=[];P.forEach((b,y)=>{const me=g-f-y*M,E=u-w*2,p=[];for(let G=0;G<b;G+=1){const $=w+(G+1)*E/(b+1),ne=(o()-.5)*18,I=Math.max(w,Math.min(u-w,$+ne)),_=y===0?3:y<2?2.1:1.4,ue=y===0?"root":`l${y}-${G}`;p.push({id:ue,x:y===0?u/2:I,y:me,r:_,level:y,role:y===0?"root":void 0})}C.push(p),F.push(...p)});const m=C[C.length-1];if(m!=null&&m.length){const b=m[Math.floor(m.length/2)];b.role="goal",b.r=2}for(let b=1;b<C.length;b+=1){const y=C[b-1];C[b].forEach(E=>{const p=[...y].sort((I,_)=>Math.abs(I.x-E.x)-Math.abs(_.x-E.x)),G=p[0],$=p[1]&&o()<.45?p[1]:null;($?[G,$]:[G]).forEach(I=>{l.push({from:I.id,to:E.id,key:`${I.id}-${E.id}`})}),o()<.2&&p[2]&&l.push({from:p[2].id,to:E.id,key:`${p[2].id}-${E.id}`})})}const x=new Map;l.forEach(b=>{const y=x.get(b.to)??[];y.push(b.from),x.set(b.to,y)});const V=new Map,J=new Map,q=new Map;l.forEach(b=>{const y=V.get(b.from)??[];y.push(b.key),V.set(b.from,y);const me=J.get(b.from)??[];me.push(b.to),J.set(b.from,me);const E=q.get(b.from)??[];E.push(b.to),q.set(b.from,E);const p=q.get(b.to)??[];p.push(b.from),q.set(b.to,p)});const s=new Map;return F.forEach(b=>{s.set(b.id,b)}),{nodes:F,links:l,parentsById:x,linksByFrom:V,childrenByFrom:J,neighborsById:q,nodesById:s}};function Wi({slides:a,activeIndex:n,introOpen:o,prefersReducedMotion:u,onNext:g,onPrev:w,onSelect:f,onExit:P,onOpen:M,onRegister:F}){const l=n===a.length-1,C=o&&n===0?"entry":"docked",m=a[a.length-1],[x,V]=i.useState(!1),J=i.useMemo(()=>Array.from({length:20},(j,k)=>({src:`/cogita/logo/Cogita${String(k).padStart(2,"0")}.png`,kind:k<=11?"bubble":k<=17?"text":"recreatio"})),[]),q=o&&n===0;i.useEffect(()=>{if(!o){V(!1);return}n>0&&!x&&V(!0)},[n,o,x]);const s=i.useRef(0),b=i.useRef(null),y=i.useMemo(()=>{const j={x:40,y:160},k={x:260,y:48},Y=6,t=k.x-j.x,r=j.y-k.y,h=t/Y,T=[.3,.45,.6,.65,1.4,2.2],D=T.reduce((oe,we)=>oe+we,0),ee=T.map(oe=>r*oe/D),te=[j];let Q=j.x,de=j.y;for(let oe=1;oe<=Y;oe+=1){const we=(Math.random()-.5)*14,aa=(Math.random()-.5)*28;Q=Math.max(j.x+oe*14,Math.min(k.x-(Y-oe)*14,Q+h+we));const Ue=ee[oe-1]??ee[ee.length-1];de=de-Ue+aa;const ta=Math.max(k.y,Math.min(j.y-4,de));te.push({x:Math.round(Q),y:Math.round(ta)})}return te[te.length-1]=k,te},[]),me=i.useMemo(()=>{const r=(D,ee,te)=>Math.min(te,Math.max(ee,D)),h=y.map(D=>{const ee=10+Math.random()*36;return{x:r(D.x,40,260),y:r(D.y-ee,40,140)}}),T=y.map((D,ee)=>{var de;const te=12+Math.random()*40,Q=((de=h[ee])==null?void 0:de.y)??D.y;return{x:r(D.x,40,260),y:r(Math.max(Q+10,D.y+te),60,170)}});return{upper:h,lower:T}},[y]),E=i.useMemo(()=>{var k;const j=((k=y[4])==null?void 0:k.x)??260;return Math.max(0,Math.min(240,j-40))},[y]),p=i.useMemo(()=>{var ee,te;const j=(Q,de,oe)=>Math.min(oe,Math.max(de,Q)),k=(Q,de,oe)=>y.map((we,aa)=>{var Ta,ra;const Ue=((Ta=me.upper[aa])==null?void 0:Ta.y)??we.y,ta=((ra=me.lower[aa])==null?void 0:ra.y)??we.y,De=(Math.random()-.5)*70,We=we.y+Q+De,Ke=j(we.y+de,Ue+6,ta-6),Ze=j(we.y+oe,Ue+6,ta-6);return{x:we.x,y:j(We,Math.min(Ke,Ze),Math.max(Ke,Ze))}}),Y=-14+Math.random()*28,t=14+Math.random()*28,r=k(Y,-80,12),h=k(t,-12,80);for(let Q=4;Q<y.length;Q+=1){const de=y[Q],oe=((ee=me.upper[Q])==null?void 0:ee.y)??de.y,we=((te=me.lower[Q])==null?void 0:te.y)??de.y;r[Q]={x:de.x,y:j(de.y-12,oe+6,we-6)},h[Q]={x:de.x,y:j(de.y+12,oe+6,we-6)}}const T=me.upper.length?me.upper[me.upper.length-1].y:40,D=me.lower.length?me.lower[me.lower.length-1].y:170;return r[r.length-1]={x:y[y.length-1].x,y:j(y[y.length-1].y-14,T,D)},h[h.length-1]={x:y[y.length-1].x,y:j(y[y.length-1].y+12,T,D)},{higher:r,lower:h}},[y,me]),G=1e4,$=i.useMemo(()=>{let j=17;const k=()=>(j=(j*1664525+1013904223)%4294967296,j/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const h=(k()-.5)*240,T=(k()-.5)*180,D=(k()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${h.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${D.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),ne=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[I,_]=i.useState([]),ue=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),he=i.useMemo(()=>{const k=[],t=(h,T)=>h+Math.random()*(T-h);for(let h=0;h<6;h+=1){let T=!1;for(let D=0;D<80;D+=1){const ee=t(14,86),te=t(10,34);if(k.every(de=>{const oe=de.x-ee,we=de.y-te;return Math.hypot(oe,we)>=12})){k.push({x:ee,y:te}),T=!0;break}}T||k.push({x:t(16,84),y:t(12,32)})}return k.map((h,T)=>({id:`p${T+1}`,x:`${h.x.toFixed(1)}%`,y:`${h.y.toFixed(1)}%`,xNum:h.x,yNum:h.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ge,B]=i.useState(0),[se,d]=i.useState(0),[re,ae]=i.useState([]),O=1e4,Me=i.useMemo(()=>{if(he.length<2)return[];const j=T=>{let D=T+1831565813;return D=Math.imul(D^D>>>15,D|1),D^=D+Math.imul(D^D>>>7,D|61),((D^D>>>14)>>>0)/4294967296},k=(T,D)=>Math.floor(j(T)*D),Y=new Set,t=[],r=Math.min(3,he.length);let h=0;for(;t.length<r&&h<30;){h+=1;const T=k(ge*13+h*5,he.length),D=k(ge*29+h*7,he.length);if(T===D)continue;const ee=T<D?`${T}-${D}`:`${D}-${T}`;Y.has(ee)||(Y.add(ee),t.push({id:`link-${ee}`,from:he[T],to:he[D],delay:`${(h*.35).toFixed(2)}s`}))}return t},[ge,he]);i.useEffect(()=>{if(!o||n!==2)return;const j=()=>{const Y=$.map(t=>t.id);for(let t=Y.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[Y[t],Y[r]]=[Y[r],Y[t]]}return Y.slice(0,4)};_(j());const k=window.setInterval(()=>{_(j())},G);return()=>window.clearInterval(k)},[n,o,$,G]),i.useEffect(()=>{if(!o||n!==3)return;const j=()=>{d(Math.floor(Math.random()*ue.length)),ae(he.map(()=>Math.random()<.6?"good":"bad")),B(Y=>Y+1)};j();const k=window.setInterval(j,O);return()=>window.clearInterval(k)},[n,o,ue.length,he,O]);const le=i.useMemo(()=>Ui(11),[]),[ie,Te]=i.useState(new Set(["root"])),[Ae,ke]=i.useState(new Set),[$e,Se]=i.useState(new Set),[Ge,Oe]=i.useState({fromId:"root",toId:"root",key:0}),Fe=i.useRef(ie),Je=i.useRef("root"),ia=i.useRef(0),Re=i.useRef(null),W=i.useRef(null),Z=i.useRef([]);i.useEffect(()=>{Fe.current=ie},[ie]);const Ve=i.useMemo(()=>{const j=new Set;return ie.forEach(k=>{const Y=le.linksByFrom.get(k);Y&&Y.forEach(t=>j.add(t))}),j},[ie,le]),Ne=le.nodesById.get(Ge.toId)??le.nodesById.get("root"),fe=Ne?`${Ne.x/vt.width*100}%`:"50%",Ee=Ne?`${Ne.y/vt.height*100}%`:"90%";i.useEffect(()=>{if(!o||n!==1||u)return;(()=>{Te(new Set(["root"])),ke(new Set),Se(new Set),Oe({fromId:"root",toId:"root",key:0}),W.current=null,ia.current=0,Je.current="root",Z.current=[]})();const k=()=>{const t=Je.current,r=Fe.current,T=(le.childrenByFrom.get(t)??[]).filter(we=>!r.has(we));if(T.length)return T[Math.floor(Math.random()*T.length)];if(r.size>=le.nodes.length){const we=le.neighborsById.get(t)??[];return we.length?we[Math.floor(Math.random()*we.length)]:null}const D=we=>(le.childrenByFrom.get(we)??[]).some(Ue=>!r.has(Ue)),ee=[t],te=new Set([t]),Q=new Map;let de=null;for(;ee.length;){const we=ee.shift();if(!we)break;if(we!==t&&D(we)){de=we;break}(le.neighborsById.get(we)??[]).forEach(Ue=>{te.has(Ue)||(te.add(Ue),Q.set(Ue,we),ee.push(Ue))})}if(!de)return null;let oe=de;for(;Q.get(oe)&&Q.get(oe)!==t;)oe=Q.get(oe)??oe;return oe},Y=(t,r)=>{if(t===r){const h=k();h&&Y(t,h);return}ia.current+=1,Oe({fromId:t,toId:r,key:ia.current}),Je.current=r,Re.current=window.setTimeout(()=>{const h=le.parentsById.get(r)??[],T=Fe.current,D=h.filter(de=>!T.has(de));if(!D.length){const de=new Set(T);de.add(r),Te(de),Re.current=window.setTimeout(()=>{for(;Z.current.length;){const we=Z.current[Z.current.length-1];if(!de.has(we)){if(we!==r){Y(r,we);return}break}Z.current.pop()}const oe=k();oe&&Y(r,oe)},yt.pauseMs);return}const ee=new Set([r,...D]),te=new Set(D.map(de=>`${de}-${r}`));ke(ee),Se(te),Z.current.includes(r)||Z.current.push(r);const Q=D[Math.floor(Math.random()*D.length)];W.current={fromId:r,toId:Q},Re.current=window.setTimeout(()=>{ke(new Set),Se(new Set);const de=W.current;de&&Y(de.fromId,de.toId)},yt.errorMs)},yt.moveMs)};return Re.current=window.setTimeout(()=>{const t=k();t&&Y(Je.current,t)},yt.pauseMs),()=>{Re.current&&window.clearTimeout(Re.current)}},[n,o,le,u]);const _e=j=>{if(!o)return;const k=Date.now();k-s.current<520||Math.abs(j.deltaY)<10||(s.current=k,j.deltaY>0?g():w(),j.preventDefault())},Be=j=>{if(!o)return;const k=j.touches[0];k&&(b.current={x:k.clientX,y:k.clientY})},qe=j=>{if(!o)return;const k=b.current;if(b.current=null,!k)return;const Y=j.changedTouches[0];if(!Y)return;const t=Y.clientX-k.x,r=Y.clientY-k.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?g():w())};return e.jsxs("div",{className:`cogita-intro ${o?"is-open":"is-closed"} ${u?"is-reduced":""} ${l?"is-final":""}`,"data-slide":n+1,onWheel:_e,onTouchStart:Be,onTouchEnd:qe,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":C,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${q&&!x?"is-entry":""}`,children:J.map((j,k)=>e.jsx("img",{src:j.src,alt:"",className:`cogita-logo-layer ${k===0?"is-base":""} ${j.kind==="text"?"is-text":j.kind==="recreatio"?"is-recreatio":""} ${j.kind==="bubble"?"is-bubble":""}`},j.src))})}),o&&a.map((j,k)=>{const Y=k===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${k+1} ${Y?"is-active":""}`,"aria-hidden":!Y,children:[e.jsxs("div",{className:"cogita-intro-text",children:[j.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:j.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:j.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:j.title}),j.body&&e.jsx("p",{children:j.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),j.micro&&e.jsx("p",{className:"cogita-intro-micro",children:j.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:l?F:g,children:j.cta}),l&&j.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>f(0),children:j.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[k===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${vt.width} ${vt.height}`,preserveAspectRatio:"none",children:[le.links.map(t=>{const r=le.nodesById.get(t.from),h=le.nodesById.get(t.to);if(!r||!h)return null;const T=Ve.has(t.key),D=$e.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${D?"is-error":""}`,x1:r.x,y1:r.y,x2:h.x,y2:h.y},t.key)}),le.nodes.map(t=>{const r=ie.has(t.id),h=Ae.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${h?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Ne&&e.jsx("span",{className:"map-explorer-dot",style:{left:fe,top:Ee,"--move":`${yt.moveMs}ms`}})]}),k===2&&e.jsx("div",{className:"cogita-index-cards",children:$.map(t=>{const r=I.indexOf(t.id),h=r>=0?ne[r]:null,T=(h==null?void 0:h.x)??"140px",D=(h==null?void 0:h.y)??"140px",ee=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":D,"--stack-opacity":ee,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),k===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ue.map((t,r)=>e.jsxs("div",{className:`round-card ${r===se?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),ue[se]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ue[se].x,"--card-y":`calc(${ue[se].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:he.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Me.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:he.map((t,r)=>{const h=re[r]??"good",T=ue[se];if(!T)return null;const D=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":D,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${h}`,style:{"--from-x":T.x,"--from-y":D,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${h}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${ge}`)})})]},`round-${ge}`),k===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${y[0].x} ${y[0].y} L${y[1].x} ${y[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${y[1].x} ${y[1].y} L${y[2].x} ${y[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${y[2].x} ${y[2].y} L${y[3].x} ${y[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${y[3].x} ${y[3].y} L${y[4].x} ${y[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${y[4].x} ${y[4].y} L${y[5].x} ${y[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${y[5].x} ${y[5].y} L${y[6].x} ${y[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${E};${E};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${me.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${me.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${me.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${me.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[p.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${p.higher[r+1].x} ${p.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),p.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${p.lower[r+1].x} ${p.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${y[0].x/300*100}%`,"--p0y":`${y[0].y/200*100}%`,"--p1x":`${y[1].x/300*100}%`,"--p1y":`${y[1].y/200*100}%`,"--p2x":`${y[2].x/300*100}%`,"--p2y":`${y[2].y/200*100}%`,"--p3x":`${y[3].x/300*100}%`,"--p3y":`${y[3].y/200*100}%`,"--p4x":`${y[4].x/300*100}%`,"--p4y":`${y[4].y/200*100}%`,"--p5x":`${y[5].x/300*100}%`,"--p5y":`${y[5].y/200*100}%`,"--p6x":`${y[6].x/300*100}%`,"--p6y":`${y[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${p.higher[0].x/300*100}%`,"--q0y":`${p.higher[0].y/200*100}%`,"--q1x":`${p.higher[1].x/300*100}%`,"--q1y":`${p.higher[1].y/200*100}%`,"--q2x":`${p.higher[2].x/300*100}%`,"--q2y":`${p.higher[2].y/200*100}%`,"--q3x":`${p.higher[3].x/300*100}%`,"--q3y":`${p.higher[3].y/200*100}%`,"--q4x":`${p.higher[4].x/300*100}%`,"--q4y":`${p.higher[4].y/200*100}%`,"--q5x":`${p.higher[5].x/300*100}%`,"--q5y":`${p.higher[5].y/200*100}%`,"--q6x":`${p.higher[6].x/300*100}%`,"--q6y":`${p.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${p.lower[0].x/300*100}%`,"--q0y":`${p.lower[0].y/200*100}%`,"--q1x":`${p.lower[1].x/300*100}%`,"--q1y":`${p.lower[1].y/200*100}%`,"--q2x":`${p.lower[2].x/300*100}%`,"--q2y":`${p.lower[2].y/200*100}%`,"--q3x":`${p.lower[3].x/300*100}%`,"--q3y":`${p.lower[3].y/200*100}%`,"--q4x":`${p.lower[4].x/300*100}%`,"--q4y":`${p.lower[4].y/200*100}%`,"--q5x":`${p.lower[5].x/300*100}%`,"--q5y":`${p.lower[5].y/200*100}%`,"--q6x":`${p.lower[6].x/300*100}%`,"--q6y":`${p.lower[6].y/200*100}%`}})]})})}),k===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),k===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},j.id)}),!o&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:m.title}),m.body&&e.jsx("p",{children:m.body}),m.micro&&e.jsx("p",{className:"cogita-intro-micro",children:m.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:F,children:m.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:M,children:"Otwórz pokaz"})]})]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((j,k)=>e.jsx("button",{type:"button",className:`dot ${n===k?"active":""}`,"aria-label":j.title,onClick:()=>f(k)},j.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:P,children:"Pomiń"})]})]})}const zi=6,Hi=4;function Ji({copy:a,onAuthAction:n,authLabel:o,showProfileMenu:u,onProfileNavigate:g,onToggleSecureMode:w,onLogout:f,secureMode:P,onNavigate:M,language:F,onLanguageChange:l}){const C=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}M("home")},m=i.useRef(null),x=i.useRef([]),V=i.useMemo(()=>{let ae=Date.now()%2147483647;const O=()=>(ae=ae*48271%2147483647,ae/2147483647);return Array.from({length:zi},(Me,le)=>{const ie=6+O()*8,Te=7+O()*10,Ae=6+O()*9,ke=-O()*ie,$e=-O()*Te,Se=-O()*Ae,Ge=.18+O()*.28,Oe=12+O()*18,Fe=4+O()*8,Je=(O()-.5)*3.2,ia=(O()-.5)*3.8,Re=O()>.5?"alternate":"alternate-reverse",W=O()>.5?"alternate":"alternate-reverse",Z=O()>.5?"alternate":"alternate-reverse",Ve=.18+O()*.42,Ne=30+O()*60,fe=-45-O()*38,Ee=188+O()*32,_e=.1+O()*.2;return{id:`wave-${le+1}`,style:{"--wave-sway-duration":`${ie}s`,"--wave-scale-duration":`${Te}s`,"--wave-drift-duration":`${Ae}s`,"--wave-sway-delay":`${ke}s`,"--wave-scale-delay":`${$e}s`,"--wave-drift-delay":`${Se}s`,"--wave-sway-dir":Re,"--wave-scale-dir":W,"--wave-drift-dir":Z,"--wave-scale":`${Ge}`,"--wave-shift":`${Oe}%`,"--wave-xshift":`${Fe}%`,"--wave-x0":`${Je}%`,"--wave-y0":`${ia}%`,"--wave-opacity":`${Ve}`,"--wave-blur":`${Ne}px`,"--wave-bottom":`${fe}%`,"--wave-hue":`${Ee}`,"--wave-glow":`${_e}`}}})},[]),J=i.useMemo(()=>{let ae=Date.now()*3%2147483647;const O=()=>(ae=ae*48271%2147483647,ae/2147483647);return Array.from({length:Hi},(Me,le)=>{const ie=180+O()*220,Te=220+O()*280,Ae=-O()*ie,ke=-O()*Te,$e=.12+O()*.22,Se=3+O()*7,Ge=1+O()*3,Oe=(O()-.5)*2.8,Fe=(O()-.5)*2.2;return{id:`mesh-${le+1}`,seed:1e3+le*991+Math.floor(O()*999),style:{"--mesh-sway-duration":`${ie}s`,"--mesh-drift-duration":`${Te}s`,"--mesh-sway-delay":`${Ae}s`,"--mesh-drift-delay":`${ke}s`,"--mesh-scale":`${$e}`,"--mesh-shift":`${Se}%`,"--mesh-xshift":`${Ge}%`,"--mesh-x0":`${Fe}%`,"--mesh-y0":`${Oe}%`}}})},[]),q=i.useMemo(()=>{const ae=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],O=a.cogita.introSlides,Me=new Map(O.map(le=>[le.id,le]));return ae.map(le=>{var Te;const ie=Me.get(le.id);return{...le,...ie,title:(ie==null?void 0:ie.title)??"Cogita",cta:(ie==null?void 0:ie.cta)??((Te=a.cogita.introSlides[0])==null?void 0:Te.cta)??a.cogita.loginCta,secondary:ie==null?void 0:ie.secondary}})},[a.cogita.introSlides]),[s,b]=i.useState(0),[y,me]=i.useState(!0),[E,p]=i.useState(!1),G=q.length-1,$=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ne=i.useCallback(()=>{$(),n()},[$,n]),I=i.useCallback(()=>{me(!0),b(0)},[]),_=i.useCallback(()=>{me(!1),b(G)},[G]),ue=i.useCallback(ae=>{b(Math.max(0,Math.min(G,ae)))},[G]),he=i.useCallback(()=>{s>=G?ne():ue(s+1)},[s,ue,ne,G]),ge=i.useCallback(()=>{ue(s-1)},[s,ue]);i.useEffect(()=>{var Me;const ae=(Me=window.matchMedia)==null?void 0:Me.call(window,"(prefers-reduced-motion: reduce)");if(!ae)return;const O=()=>p(ae.matches);return O(),ae.addEventListener?(ae.addEventListener("change",O),()=>ae.removeEventListener("change",O)):(ae.addListener(O),()=>ae.removeListener(O))},[]),i.useEffect(()=>{if(!y)return;const ae=O=>{const Me=O.target;if(!Me)return;const le=Me.tagName;if(!(Me.isContentEditable||le==="INPUT"||le==="TEXTAREA"||le==="SELECT"||le==="BUTTON"||le==="A"||Me.closest('button, a, [role="button"], [role="link"]'))){if(O.key==="Escape"){_();return}if(O.key==="ArrowLeft"||O.key==="ArrowUp"){ge();return}(O.key==="ArrowRight"||O.key==="ArrowDown"||O.code==="Space"||O.key===" ")&&(O.preventDefault(),he())}};return window.addEventListener("keydown",ae),()=>window.removeEventListener("keydown",ae)},[_,he,ge,y]),i.useEffect(()=>{y&&s===G&&$()},[s,y,G,$]),i.useEffect(()=>{const ae=m.current;if(!ae)return;const O=x.current.filter(fe=>!!fe);if(!O.length)return;const Me=1,le=.6,ie=.6,Te=Math.max(1,Math.min(Me,window.devicePixelRatio||1));let Ae=0,ke=0,$e=le,Se=0,Ge=0;const Oe=fe=>{let Ee=fe%2147483647;return Ee<=0&&(Ee+=2147483646),(_e,Be)=>{Ee=Ee*48271%2147483647;const qe=Ee/2147483647;return _e+qe*(Be-_e)}},Fe={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},Je=fe=>{const Ee=Math.sin(fe*12.9898)*43758.5453;return Ee-Math.floor(Ee)},ia=fe=>{const Ee=Je(fe+.1)||1e-4,_e=Je(fe+.7)||1e-4;return Math.sqrt(-2*Math.log(Ee))*Math.cos(2*Math.PI*_e)},Re=(fe,Ee)=>{const _e=Math.floor(fe),Be=_e+1,qe=fe-_e,j=qe*qe*(3-2*qe),k=Je(_e*12.9898+Ee*78.233),Y=Je(Be*12.9898+Ee*78.233);return k+(Y-k)*j},W=fe=>{const Ee=Oe(fe),_e=Math.min(4,Math.max(4,Math.floor(Ae/1200*Fe.filamentCount)));return Array.from({length:_e},(Be,qe)=>{const j=Math.max(-1,Math.min(1,ia(fe+qe*.37))),k=Math.min(1,Math.max(0,Je(fe+qe*1.31))),Y=Math.min(Fe.depthLayers-1,Math.floor(k*Fe.depthLayers));return{seed:Ee(0,Math.PI*2)+fe*.01,offset:j,freqA:Fe.freq1*(.75+Ee(0,.5)),freqB:Fe.freq2*(.75+Ee(0,.5)),ampA:Fe.amp1*(.6+Ee(0,.7)),ampB:Fe.amp2*(.6+Ee(0,.7)),width:2+qe%5*.32,depth:k,layer:Y}})},Z=(fe,Ee,_e)=>{const Be=Math.max(30,Math.floor(Ae*ke/14e4));fe.save(),fe.globalAlpha=.6;for(let qe=0;qe<Be;qe+=1){const j=Je(qe*9.1+Ae*.11)*Ee+_e,k=Je(qe*3.7+ke*.23)*ke,Y=1.2+Je(qe*5.9)*2.4,t=fe.createRadialGradient(j,k,0,j,k,Y*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),fe.fillStyle=t,fe.beginPath(),fe.arc(j,k,Y*2,0,Math.PI*2),fe.fill()}fe.restore()},Ve=(fe,Ee)=>{fe.clearRect(0,0,Ae,ke);const _e=ke*Fe.waveCenter,Be=Fe.waveBandPx,qe=Fe.segments,j=Fe.colors.filaments,k=Se||Ae,Y=0;Z(fe,k,Y),fe.strokeStyle=j,fe.lineCap="round",fe.lineJoin="round";for(let t=0;t<Ee.length;t+=1){const r=Ee[t],h=r.offset*Be*(.85+Je(r.seed)*.4),T=1-Math.min(1,Math.abs(h)/Be),D=Math.exp(-Math.pow(h/Fe.crestThickness,2)),ee=r.layer===0?1.1:r.layer===1?.85:.6,te=.35+(1-r.depth)*.65,Q=T*te*ee*(.34+D*.45);fe.globalAlpha=Q,fe.lineWidth=r.width*(1+(1-r.depth)*.8);const de=[];for(let we=0;we<=qe;we+=1){const aa=we/qe*k+Y,Ue=(Re(aa*.012,r.seed)-.5)*Fe.xJitter,ta=aa+Ue,De=(Re(ta*r.freqA,r.seed)-.5)*Fe.jitterA,We=(Re(ta*r.freqB,r.seed*1.7)-.5)*Fe.jitterB,Ke=_e+Math.sin(ta*r.freqA+r.seed)*r.ampA+Math.sin(ta*r.freqB+r.seed*1.3)*r.ampB+h+De+We;de.push({x:ta,y:Ke})}fe.beginPath(),fe.moveTo(de[0].x,de[0].y);for(let we=1;we<de.length-1;we+=1){const aa=(de[we].x+de[we+1].x)/2,Ue=(de[we].y+de[we+1].y)/2;fe.quadraticCurveTo(de[we].x,de[we].y,aa,Ue)}const oe=de[de.length-1];fe.quadraticCurveTo(oe.x,oe.y,oe.x,oe.y),fe.stroke()}fe.save(),fe.globalCompositeOperation="lighter",fe.strokeStyle=Fe.colors.glow,fe.lineCap="round",fe.lineJoin="round";for(let t=0;t<Ee.length;t+=1){const r=Ee[t];if(Math.abs(r.offset)*Be>Fe.crestThickness)continue;const h=Fe.glowAlpha*(.7+(1-r.depth)*.6);fe.globalAlpha=h,fe.lineWidth=1.6+(1-r.depth)*1.2;const T=[];for(let ee=0;ee<=qe;ee+=1){const te=ee/qe*k+Y,Q=Math.sin(te*.02+r.seed)*3,de=_e+Math.sin(te*r.freqA+r.seed)*r.ampA+Math.sin(te*r.freqB+r.seed*1.3)*r.ampB+r.offset*Be*.35+Q;T.push({x:te,y:de})}fe.beginPath(),fe.moveTo(T[0].x,T[0].y);for(let ee=1;ee<T.length-1;ee+=1){const te=(T[ee].x+T[ee+1].x)/2,Q=(T[ee].y+T[ee+1].y)/2;fe.quadraticCurveTo(T[ee].x,T[ee].y,te,Q)}const D=T[T.length-1];fe.quadraticCurveTo(D.x,D.y,D.x,D.y),fe.stroke()}fe.restore()},Ne=()=>{Ae=Math.floor(ae.clientWidth),ke=Math.floor(ae.clientHeight),Se=Math.floor(Ae*1.8),Ge=ke,$e=Ae<820?ie:le,O.forEach(fe=>{const Ee=fe.getContext("2d");if(!Ee)return;fe.width=Math.floor(Se*Te*$e),fe.height=Math.floor(Ge*Te*$e),fe.style.width=`${Se}px`,fe.style.height=`${Ge}px`,fe.style.left=`${-(Se-Ae)/2}px`,Ee.setTransform(Te*$e,0,0,Te*$e,0,0);const _e=Number(fe.dataset.seed||1),Be=W(_e);Ve(Ee,Be)})};return Ne(),window.addEventListener("resize",Ne,{passive:!0}),()=>window.removeEventListener("resize",Ne)},[J]);const B=q[Math.min(s,q.length-1)],se=y?B:q[q.length-1],d=(se==null?void 0:se.theme)??q[0].theme,re={"--cogita-bg0":d.bg0,"--cogita-bg1":d.bg1,"--cogita-bg2":d.bg2,"--cogita-bloom":d.bloom,"--cogita-sat":d.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:C,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:F,onChange:l}),e.jsx(_r,{copy:a,label:o,isAuthenticated:u,secureMode:P,onLogin:n,onProfileNavigate:g,onToggleSecureMode:w,onLogout:f,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:m,className:"cogita-section cogita-home",style:re,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[J.map((ae,O)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:ae.style,"data-seed":ae.seed,ref:Me=>{x.current[O]=Me}},ae.id)),V.map(ae=>e.jsx("div",{className:"cogita-home-wave",style:ae.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},ae.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Wi,{slides:q,activeIndex:s,introOpen:y,prefersReducedMotion:E,onNext:he,onPrev:ge,onSelect:ue,onExit:_,onOpen:I,onRegister:ne})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Ji},Symbol.toStringTag,{value:"Module"})),Yr=i.createContext(!1);function Ca({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:l}){if(i.useContext(Yr))return e.jsx(e.Fragment,{children:l});const m=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}P("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:m,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:M,onChange:F}),e.jsx(_r,{copy:a,label:n,isAuthenticated:o,secureMode:f,onLogin:()=>P("home"),onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:l}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function qa(a){const[n,o]=i.useState("Cogita library"),[u,g]=i.useState(null);return i.useEffect(()=>{let w=!1;return Ur().then(f=>{if(w)return;const P=f.find(M=>M.libraryId===a);P&&o(P.name)}).catch(()=>{w||o("Cogita library")}),()=>{w=!0}},[a]),i.useEffect(()=>{let w=!1;return hi(a).then(f=>{w||g(f)}).catch(()=>{w||g(null)}),()=>{w=!0}},[a]),{libraryName:n,stats:u}}function Ir({slices:a}){const n=a.reduce((u,g)=>u+Math.max(0,g.value),0),o=i.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let u=0;return`conic-gradient(${a.map(w=>{const P=Math.max(0,w.value)/n*360,M=u,F=u+P;return u=F,`${w.color} ${M}deg ${F}deg`}).join(",")})`},[a,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:o}}),e.jsx("div",{className:"cogita-overview-legend",children:a.map(u=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:u.color}}),e.jsx("strong",{children:u.value}),e.jsx("small",{children:u.label})]},u.label))})]})}function Yi({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l}){const{libraryName:C,stats:m}=qa(l),[x,V]=i.useState("infos"),[J,q]=i.useState(0),[s,b]=i.useState(0),[y,me]=i.useState(0),E=(m==null?void 0:m.totalInfos)??0,p=(m==null?void 0:m.totalCollections)??0,G=0,$=0,ne=0,I=Math.max(0,E-ne-s),_=Math.max(0,E-s-y);i.useEffect(()=>{let he=!1;return(async()=>{try{const B=await jt({libraryId:l,limit:200}),se=await Promise.all(B.items.map(d=>Wr({libraryId:l,collectionId:d.collectionId}).catch(()=>[])));if(he)return;q(se.reduce((d,re)=>d+re.length,0))}catch{he||q(0)}})(),()=>{he=!0}},[l]),i.useEffect(()=>{let he=!1;return(async()=>{try{const[B,se,d]=await Promise.all([$t({libraryId:l,type:"computed",limit:1}).catch(()=>({total:0})),$t({libraryId:l,type:"source",limit:1}).catch(()=>({total:0})),zr({libraryId:l}).catch(()=>({items:[]}))]);if(he)return;b((B.total??0)+(se.total??0));const re=new Set(d.items.filter(ae=>ae.childItemType.toLowerCase()==="info").map(ae=>ae.childItemId).filter(Boolean));me(re.size)}catch{he||(b(0),me(0))}})(),()=>{he=!0}},[l]);const ue=[{key:"infos",label:a.cogita.library.overview.stats.totalInfos,value:E},{key:"collections",label:a.cogita.library.overview.stats.collections,value:p},{key:"revisions",label:a.cogita.library.overview.stats.revisions,value:J},{key:"storyboards",label:a.cogita.library.overview.stats.storyboards,value:G},{key:"texts",label:a.cogita.library.overview.stats.texts,value:$}];return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:C})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ue.map(he=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${x===he.key?"active":""}`,onClick:()=>V(he.key),children:[e.jsx("span",{children:he.label}),e.jsx("strong",{children:he.value})]},he.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:a.cogita.library.overview.statsCardTitle})}),x==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.knownChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.known,value:ne,color:"#75d79a"},{label:a.cogita.library.overview.unknown,value:I,color:"#85b9ff"},{label:a.cogita.library.overview.excluded,value:s,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.checksChartTitle}),e.jsx(Ir,{slices:[{label:a.cogita.library.overview.availableChecks,value:y,color:"#75d79a"},{label:a.cogita.library.overview.unavailableChecks,value:_,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:a.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]})]})})]})})}const pe=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ka=(a,n,o,u)=>`${a}:${n}:${o??""}:${u??""}`,ea=(a,n)=>{const o=a.cogita.library.infoTypes;return{any:o.any,vocab:o.vocab,language:o.language,word:o.word,sentence:o.sentence,topic:o.topic,collection:o.collection,person:o.person,institution:o.institution,collective:o.collective,orcid:o.orcid,address:o.address,email:o.email,phone:o.phone,media:o.media,work:o.work,geo:o.geo,music_piece:o.musicPiece,music_fragment:o.musicFragment,source:o.source,quote:o.quote,computed:o.computed}[n]??String(n)},Qr=a=>[{value:"any",label:ea(a,"any")},{value:"language",label:ea(a,"language")},{value:"word",label:ea(a,"word")},{value:"sentence",label:ea(a,"sentence")},{value:"topic",label:ea(a,"topic")},{value:"collection",label:ea(a,"collection")},{value:"person",label:ea(a,"person")},{value:"institution",label:ea(a,"institution")},{value:"collective",label:ea(a,"collective")},{value:"orcid",label:ea(a,"orcid")},{value:"address",label:ea(a,"address")},{value:"email",label:ea(a,"email")},{value:"phone",label:ea(a,"phone")},{value:"media",label:ea(a,"media")},{value:"work",label:ea(a,"work")},{value:"geo",label:ea(a,"geo")},{value:"music_piece",label:ea(a,"music_piece")},{value:"music_fragment",label:ea(a,"music_fragment")},{value:"source",label:ea(a,"source")},{value:"quote",label:ea(a,"quote")},{value:"computed",label:ea(a,"computed")}],Qi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Gi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],Xi=a=>[{value:"any",label:ea(a,"any")},{value:"vocab",label:ea(a,"vocab")},...Qr(a).filter(n=>n.value!=="any")],Za=5,Pr=50,Rr=2,$r=[];function He({libraryId:a,infoType:n,label:o,placeholder:u,value:g,onChange:w,values:f,onChangeMultiple:P,helperText:M,searchFailedText:F,createFailedText:l,createLabel:C,savingLabel:m,loadMoreLabel:x,inputRef:V,autoAdvance:J,onCommit:q,multiple:s}){const b=s?f??$r:$r,[y,me]=i.useState(s?"":(g==null?void 0:g.label)??""),[E,p]=i.useState([]),[G,$]=i.useState(Za),[ne,I]=i.useState(-1),[_,ue]=i.useState(!1),[he,ge]=i.useState(!1),[B,se]=i.useState(null),d=i.useRef(0),re=i.useRef(new Map),ae=i.useMemo(()=>s?y.trim().length>0:y.trim().length>0&&!g,[y,g,s]);i.useEffect(()=>{s||me((g==null?void 0:g.label)??"")},[g,s]),i.useEffect(()=>{const le=y.trim();if(!le||le.length<Rr){p([]),ue(!1),$(Za),I(-1),ge(!1),se(null);return}const ie=le.toLowerCase(),Te=`${a}:${n}:${ie}`,Ae=re.current.get(Te);if(Ae){if(s&&b.length>0){const $e=new Set(b.map(Se=>Se.id));p(Ae.filter(Se=>!$e.has(Se.id)))}else p(Ae);$(Za),I(-1),ue(Ae.length>0),ge(!1),se(null);return}const ke=window.setTimeout(async()=>{const $e=Date.now();d.current=$e,ge(!0),se(null);try{const Se=await jr({libraryId:a,type:n,query:le,limit:Pr});if(d.current!==$e)return;const Ge=Se.slice(0,Pr).map(Oe=>({id:Oe.infoId,label:Oe.label,infoType:Oe.infoType}));if(re.current.set(Te,Ge),s&&b.length>0){const Oe=new Set(b.map(Fe=>Fe.id));p(Ge.filter(Fe=>!Oe.has(Fe.id)))}else p(Ge);$(Za),I(-1),ue(!0)}catch{if(d.current!==$e)return;se(F??"Search failed.")}finally{d.current===$e&&ge(!1)}},250);return()=>window.clearTimeout(ke)},[a,n,y,b]);const O=le=>{if(s){const ie=b.some(Te=>Te.id===le.id)?b:[...b,le];P==null||P(ie),me(""),ue(!1),I(-1);return}w==null||w(le),me(le.label),ue(!1),I(-1),J&&(q==null||q())},Me=async()=>{const le=y.trim();if(le){ge(!0),se(null);try{const ie=await et({libraryId:a,infoType:n,payload:{label:le}}),Te={id:ie.infoId,label:le,infoType:ie.infoType};if(le.length>=Rr){const Ae=`${a}:${n}:${le.toLowerCase()}`,ke=re.current.get(Ae)??[];re.current.set(Ae,[Te,...ke])}if(s){P==null||P([...b,Te]),me(""),ue(!1),I(-1);return}w==null||w(Te),ue(!1),I(-1),J&&(q==null||q())}catch{se(l??"Create failed.")}finally{ge(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:o}),e.jsx("input",{value:y,placeholder:u,onChange:le=>{me(le.target.value),!s&&g&&(w==null||w(null))},onKeyDown:le=>{if(le.key==="ArrowDown"){if(le.preventDefault(),!E.length)return;ue(!0),I(ie=>{const Te=Math.min(E.length,G)-1,Ae=ie<0?0:Math.min(ie+1,Te);return Ae===Te&&E.length>G?($(ke=>Math.min(ke+Za,E.length)),Math.min(ie+1,Math.min(E.length,G+Za)-1)):Ae});return}if(le.key==="ArrowUp"){if(le.preventDefault(),!E.length)return;ue(!0),I(ie=>ie<=0?0:ie-1);return}if(le.key==="Enter"){if(le.preventDefault(),ne>=0&&E[ne]){O(E[ne]);return}if(ae){Me();return}}},onFocus:()=>{E.length>0&&ue(!0)},autoComplete:"off",ref:V})]}),s&&b.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:b.map(le=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>P==null?void 0:P(b.filter(ie=>ie.id!==le.id)),children:[le.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},le.id))}),M&&e.jsx("p",{className:"cogita-help",children:M}),B&&e.jsx("p",{className:"cogita-error",children:B}),_&&E.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[E.slice(0,G).map((le,ie)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":ie===ne,onClick:()=>O(le),children:[e.jsx("strong",{children:le.label}),e.jsx("span",{children:le.infoType})]},le.id)),G<E.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>$(le=>Math.min(le+Za,E.length)),children:x??"Load more"})]}),ae&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Me,disabled:he,children:he?m??"Saving...":C??`Create new ${n}`})]})}function Zi({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l,mode:C}){const{libraryName:m}=qa(l),x=`/#/cogita/library/${l}`,[V,J]=i.useState("any"),[q,s]=i.useState(""),[b,y]=i.useState([]),[me,E]=i.useState("idle"),[p,G]=i.useState(null),[$,ne]=i.useState(null),[I,_]=i.useState("idle"),[ue,he]=i.useState(0),[ge,B]=i.useState(null),[se,d]=i.useState("idle"),[re,ae]=i.useState(null),[O,Me]=i.useState(null),[le,ie]=i.useState(null),[Te,Ae]=i.useState(null),ke=i.useMemo(()=>({languageAId:(re==null?void 0:re.id)??void 0,languageBId:(O==null?void 0:O.id)??void 0,topicId:(le==null?void 0:le.id)??void 0,levelId:(Te==null?void 0:Te.id)??void 0}),[re,O,le,Te]),$e=i.useMemo(()=>V==="vocab"||V==="any",[V]);i.useEffect(()=>{E("loading");const Re=window.setTimeout(()=>{$t({libraryId:l,type:V==="any"?void 0:V,query:q.trim()||void 0,limit:30,languageAId:$e?ke.languageAId:void 0,languageBId:$e?ke.languageBId:void 0,topicId:$e?ke.topicId:void 0,levelId:$e?ke.levelId:void 0}).then(W=>{y(W.items),he(W.total),B(W.nextCursor??null),E("ready"),G(W.items[0]??null)}).catch(()=>{y([]),he(0),B(null),E("ready")})},240);return()=>window.clearTimeout(Re)},[l,q,V,$e,ke]),i.useEffect(()=>{if(!p||p.cardType!=="info"||p.infoType!=="computed"){ne(null),_("idle"),d("idle");return}_("loading"),hr({libraryId:l,infoId:p.cardId}).then(Re=>{ne(Re),_("ready")}).catch(()=>{ne(null),_("ready")})},[l,p]);const Se=async()=>{if(ge){E("loading");try{const Re=await $t({libraryId:l,type:V==="any"?void 0:V,query:q.trim()||void 0,limit:30,cursor:ge,languageAId:$e?ke.languageAId:void 0,languageBId:$e?ke.languageBId:void 0,topicId:$e?ke.topicId:void 0,levelId:$e?ke.levelId:void 0});y(W=>[...W,...Re.items]),B(Re.nextCursor??null),he(Re.total),E("ready")}catch{E("ready")}}},Ge=async()=>{if(!(!p||p.cardType!=="connection"&&p.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){d("loading");try{await bi({libraryId:l,connectionId:p.cardId});let W=null;y(Z=>{const Ve=Z.filter(Ne=>Ne.cardId!==p.cardId);return W=Ve[0]??null,Ve}),he(Z=>Math.max(0,Z-(p.cardType==="vocab"?3:1))),G(Z=>Z&&Z.cardId===p.cardId?W:Z),d("idle")}catch{d("error")}}},Oe=i.useMemo(()=>C==="collection"?"grid":C==="list"?"list":"detail",[C]),Fe=p?pe(p):null,Je=i.useMemo(()=>Xi(a),[a]),ia=i.useMemo(()=>{const Re=ue||b.length;return a.cogita.library.list.cardCount.replace("{shown}",String(b.length)).replace("{total}",String(Re))},[a,b.length,ue]);return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Oe,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:x,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${x}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${x}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(Re=>e.jsx("a",{className:"ghost","data-active":C===Re,href:`${x}/${Re}`,children:Re==="detail"?a.cogita.library.list.modes.detail:Re==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},Re))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:V,onChange:Re=>J(Re.target.value),children:Je.map(Re=>e.jsx("option",{value:Re.value,children:Re.label},Re.value))}),e.jsx("input",{type:"text",value:q,onChange:Re=>s(Re.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(V==="vocab"||V==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:re,onChange:ae,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:O,onChange:Me,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:le,onChange:ie,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:Te,onChange:Ae,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(re||O||le||Te)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{ae(null),Me(null),ie(null),Ae(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ia}),e.jsx("span",{children:me==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":C==="collection"?"grid":"list",children:b.length?b.map(Re=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":Fe===pe(Re),onClick:()=>G(Re),children:[e.jsx("div",{className:"cogita-card-type",children:Re.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:Re.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:Re.label}),e.jsx("p",{className:"cogita-card-subtitle",children:Re.description})]},pe(Re))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${x}/new`,children:a.cogita.library.list.addInfo})]})}),ge?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Se,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(p==null?void 0:p.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(p==null?void 0:p.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${x}/edit/${p.cardId}`,children:a.cogita.library.list.editInfo}):null,(p==null?void 0:p.cardType)==="connection"||(p==null?void 0:p.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:Ge,disabled:se==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${x}/new`,children:a.cogita.library.actions.addInfo})]})]}),p?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:p.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:p.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),se==="error"&&(p.cardType==="connection"||p.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,p.cardType==="info"&&p.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),I==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),I!=="loading"&&$?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(Et,{value:$.prompt,mode:"auto"}),$.expectedAnswers&&Object.keys($.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries($.expectedAnswers).map(([Re,W])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Re}),e.jsx(br,{value:W,mode:"auto"})]},Re))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(br,{value:$.expectedAnswer,mode:"auto"})]})]}):I!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Ft=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Er=8;function Ar({libraryId:a,copy:n,language:o,sourceKindOptions:u,value:g,onChange:w,labels:f}){const[P,M]=i.useState(!1),[F,l]=i.useState(-1),C=i.useMemo(()=>{const J=o;return Ft.map(q=>{var y;const s=(q==null?void 0:q[J])??(q==null?void 0:q.en)??(q==null?void 0:q.la);return{label:`${s.abbr} — ${s.name}`,latin:((y=q==null?void 0:q.la)==null?void 0:y.abbr)??s.abbr}})},[o]),m=(J,q=!1)=>{const s=J.trim().toLowerCase();return s?C.filter(b=>b.label.toLowerCase().includes(s)).slice(0,Er):q?C.slice(0,Er):[]},x=(J,q)=>{const s=J.trim().toLowerCase();if(!s)return null;const b=Ft;for(const y of b){const me=y==null?void 0:y.la,E=(y==null?void 0:y[q])??(y==null?void 0:y.en)??me,p=(E==null?void 0:E.abbr)??"",G=(E==null?void 0:E.name)??"";if(p.toLowerCase()===s||G.toLowerCase()===s||`${p} — ${G}`.toLowerCase()===s)return{book:y,entry:E,la:me}}return null};i.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!P){const J=x(g.locatorValue,o);if(J){const q=`${J.entry.abbr} — ${J.entry.name}`;q!==g.bibleBookDisplay&&w({...g,bibleBookDisplay:q})}}},[o,g,P,w]);const V=J=>w({...g,...J});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:J=>V({sourceKind:J.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:u.map(J=>e.jsx("option",{value:J.value,children:J.label},J.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:J=>{const q=J.target.value;V({bibleBookDisplay:q,locatorValue:""}),M(!0),l(-1)},onKeyDown:J=>{var s;const q=m(g.bibleBookDisplay);if(q.length){if(J.key==="ArrowDown")J.preventDefault(),l(b=>Math.min(b+1,q.length-1));else if(J.key==="ArrowUp")J.preventDefault(),l(b=>Math.max(b-1,0));else if((J.key==="Enter"||J.key==="Tab")&&F>=0&&q[F]){const b=q[F],y=x(b.label,o);if(!y)return;V({bibleBookDisplay:b.label,locatorValue:((s=y.la)==null?void 0:s.abbr)??g.locatorValue}),M(!1)}}},onFocus:()=>M(!0),onBlur:()=>window.setTimeout(()=>M(!1),100),placeholder:f.bibleBookPlaceholder})]}),P&&m(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:m(g.bibleBookDisplay,!0).map((J,q)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":q===F,tabIndex:-1,onMouseDown:()=>{var b;const s=x(J.label,o);s&&V({bibleBookDisplay:J.label,locatorValue:((b=s.la)==null?void 0:b.abbr)??g.locatorValue})},children:e.jsx("strong",{children:J.label})},J.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:J=>V({locatorAux:J.target.value}),placeholder:f.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:J=>V({sourceUrl:J.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:J=>V({sourceAccessedDate:J.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:a,infoType:"work",label:f.churchDocumentLabel,placeholder:f.churchDocumentPlaceholder,value:g.churchDocument,onChange:J=>V({churchDocument:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>V({locatorValue:J.target.value}),placeholder:f.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(He,{libraryId:a,infoType:"work",label:f.workLabel,placeholder:f.workPlaceholder,value:g.work,onChange:J=>V({work:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:a,infoType:"media",label:f.bookLabel,placeholder:f.bookPlaceholder,value:g.bookMedia,onChange:J=>V({bookMedia:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>V({locatorValue:J.target.value}),placeholder:f.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>V({locatorValue:J.target.value}),placeholder:f.locatorPlaceholder})]})]})}const en=[],an=[];function tn({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),o=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),u=a.handles.length,g=u>1?(u-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),o?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((w,f)=>e.jsx(Cr,{type:"target",id:w.id,position:Mr.Left,style:{top:46+f*28},children:w.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:w.label}):null},w.id)),a.output!==!1?e.jsx(Cr,{type:"source",id:"out",position:Mr.Right}):null]})}function rn({copy:a,value:n,onChange:o}){var Oe,Fe,Je,ia,Re,W,Z,Ve,Ne,fe,Ee,_e,Be,qe;const u=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=j=>!j||j.nodes.length===0?en:j.nodes.map((k,Y)=>{var t,r,h,T;return{id:k.id,type:"computed",position:k.position??{x:40+Y*160,y:60+Y%3*80},data:{title:k.name||((t=u[k.type])==null?void 0:t.label)||k.type,subtitle:((r=u[k.type])==null?void 0:r.label)||k.type,type:k.type,name:k.name,outputLabel:k.outputLabel,min:k.min,max:k.max,value:k.type==="input.const"?k.value:void 0,list:k.list,handles:((h=u[k.type])==null?void 0:h.handles)??[],output:((T=u[k.type])==null?void 0:T.output)??!0}}}),w=j=>{if(!j||j.nodes.length===0)return an;const k=new Set(j.nodes.map(r=>r.id)),Y=[];let t=0;return j.nodes.forEach(r=>{const h=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(h).forEach(([T,D])=>{D.forEach(ee=>{k.has(ee)&&Y.push({id:`${r.id}-${T}-${ee}-${t++}`,source:ee,target:r.id,targetHandle:T==="in"?void 0:T})})})}),Y},f=i.useMemo(()=>g(n),[n,u]),P=i.useMemo(()=>w(n),[n]),M=(j,k)=>{if(!j)return"null";const Y=j.nodes.map(r=>{const h=(r.list??[]).join(","),T=r.inputs?r.inputs.join(","):"",D=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([te,Q])=>`${te}:${[...Q].sort().join(",")}`).sort().join("|"):"",ee=k&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",h,T,D,ee].join(":")}).sort().join("||"),t=j.outputs?[...j.outputs].sort().join(","):j.output??"";return`${Y}::${t}`},F=i.useMemo(()=>{var k;const j=!!((k=n==null?void 0:n.nodes)!=null&&k.some(Y=>!!Y.position));return M(n,j)},[n]),[l,C]=i.useState(f),[m,x]=i.useState(P),[V,J]=i.useState(null),[q,s]=i.useState([]),[b,y]=i.useState(null),[me,E]=i.useState(null),[p,G]=i.useState({}),[$,ne]=i.useState(0),I=i.useRef(o),_=i.useRef(F),ue=i.useRef(F),he=i.useRef(M(n,!1)),ge=i.useMemo(()=>V?l.find(j=>j.id===V)??null:null,[l,V]),B=i.useMemo(()=>{const j=["in1","in2","in3","in4","in5","in6"],k=new Map;return m.forEach(Y=>{if(!Y.target)return;const t=Y.targetHandle??"in1";k.has(Y.target)||k.set(Y.target,new Set),k.get(Y.target).add(t)}),l.map(Y=>{var t;if(((t=Y.data)==null?void 0:t.type)==="compute.concat"){const r=k.get(Y.id)??new Set,h=[];let T=!1;return j.forEach(D=>{var ee,te;if(r.has(D)||!T){const Q=(te=(ee=u["compute.concat"])==null?void 0:ee.handles)==null?void 0:te.find(de=>de.id===D);Q&&h.push(Q),r.has(D)||(T=!0)}}),{...Y,selected:Y.id===V,data:{...Y.data,handles:h}}}return{...Y,selected:Y.id===V}})},[l,V,m,u]);i.useEffect(()=>{y(null),E(null)},[V]),i.useEffect(()=>{if(q.length===0)return;const j=k=>{if(k.key!=="Delete"&&k.key!=="Backspace")return;const Y=k.target;Y&&(Y.tagName==="INPUT"||Y.tagName==="TEXTAREA"||Y.isContentEditable)||(k.preventDefault(),x(t=>t.filter(r=>!q.includes(r.id))),s([]))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[q,x]),i.useEffect(()=>{I.current=o},[o]),i.useEffect(()=>{if(_.current!==F){if(ue.current===F||he.current===F){_.current=F;return}_.current=F,C(f),x(P),J(null),y(null),E(null),G({}),ne(j=>j+1)}},[f,P,x,C,F]),i.useEffect(()=>{const j=l.filter(h=>{var T;return((T=h.data)==null?void 0:T.type)==="output"}).map(h=>h.id).sort(),k=new Map;m.forEach(h=>{let T=k.get(h.target);T||(T={},k.set(h.target,T));const D=h.targetHandle||"in";T[D]||(T[D]=[]),T[D].push(h.source)}),k.forEach(h=>{Object.values(h).forEach(T=>T.sort())});const Y={nodes:l.map(h=>{var T,D,ee,te,Q,de,oe,we,aa;return{id:h.id,type:((T=h.data)==null?void 0:T.type)??"compute.add",position:h.position,name:(D=h.data)==null?void 0:D.name,outputLabel:(ee=h.data)==null?void 0:ee.outputLabel,min:(te=h.data)==null?void 0:te.min,max:(Q=h.data)==null?void 0:Q.max,value:((de=h.data)==null?void 0:de.type)==="input.const"?(oe=h.data)==null?void 0:oe.value:void 0,list:(we=h.data)==null?void 0:we.list,inputs:(aa=k.get(h.id))==null?void 0:aa.in,inputsByHandle:k.get(h.id)}}),output:j[0]??null,outputs:j},t=M(Y,!0),r=M(Y,!1);t===ue.current||r===he.current||(ue.current=t,he.current=r,I.current(Y))},[l,m]),i.useEffect(()=>{const j={};let k=!1;l.forEach(Y=>{var D,ee,te,Q,de;if(((D=Y.data)==null?void 0:D.type)!=="input.random")return;if(p[Y.id]!==void 0){j[Y.id]=p[Y.id];return}const t=Number.isFinite((ee=Y.data)==null?void 0:ee.min)?Number((te=Y.data)==null?void 0:te.min):0,r=Number.isFinite((Q=Y.data)==null?void 0:Q.max)?Number((de=Y.data)==null?void 0:de.max):t+10,h=Math.min(t,r),T=Math.max(t,r);j[Y.id]=Math.floor(Math.random()*(T-h+1))+h,k=!0}),(k||Object.keys(j).length!==Object.keys(p).length)&&G(j)},[l,p,$]);const se=i.useMemo(()=>l.map(k=>{var t,r,h,T,D;const Y=(((t=k.data)==null?void 0:t.list)??[]).join(",");return[k.id,((r=k.data)==null?void 0:r.type)??"",((h=k.data)==null?void 0:h.name)??"",((T=k.data)==null?void 0:T.min)??"",((D=k.data)==null?void 0:D.max)??"",Y].join(":")}).sort().join("|"),[l]),d=i.useMemo(()=>m.map(k=>`${k.source}:${k.target}:${k.targetHandle??""}`).sort().join("|"),[m]),re=i.useMemo(()=>{const j=new Map(l.map(te=>[te.id,te])),k=new Map;m.forEach(te=>{let Q=k.get(te.target);Q||(Q={},k.set(te.target,Q));const de=te.targetHandle||"in";Q[de]||(Q[de]=[]),Q[de].push(te.source)});const Y=new Map,t=new Set,r=te=>{if(typeof te=="number")return te;if(typeof te=="string"){const Q=Number(te);return Number.isFinite(Q)?Q:0}return 0},h=(te,Q)=>{var de,oe;return Q?((de=k.get(te.id))==null?void 0:de[Q])??[]:((oe=k.get(te.id))==null?void 0:oe.in)??[]},T=(te,Q)=>h(te,Q).map(de=>r(ee(de))),D=(te,Q)=>h(te,Q).map(de=>ee(de)),ee=te=>{var we,aa,Ue,ta;if(Y.has(te))return Y.get(te);if(t.has(te))return 0;const Q=j.get(te);if(!Q)return 0;t.add(te);const de=((we=Q.data)==null?void 0:we.type)??"";let oe=0;switch(de){case"input.random":{oe=p[te]??0;break}case"input.const":{oe=Number.isFinite((aa=Q.data)==null?void 0:aa.value)?Number((Ue=Q.data)==null?void 0:Ue.value):0;break}case"input.list":{const De=(((ta=Q.data)==null?void 0:ta.list)??[]).filter(Boolean),We=Math.round(T(Q,"index")[0]??0);oe=(De.length?De[Math.max(0,Math.min(De.length-1,We))]:"")||String(We);break}case"compute.add":{oe=T(Q,"in").reduce((De,We)=>De+We,0);break}case"compute.sub":{oe=T(Q,"add").reduce((De,We)=>De+We,0)-T(Q,"sub").reduce((De,We)=>De+We,0);break}case"compute.mul":{const De=T(Q,"in");oe=De.length?De.reduce((We,Ke)=>We*Ke,1):0;break}case"compute.div":{const De=T(Q,"num")[0]??0,We=T(Q,"den").reduce((Ke,Ze)=>Ke+Ze,0);oe=Math.abs(We)<Number.EPSILON?0:De/We;break}case"compute.pow":{const De=T(Q,"base")[0]??0,We=T(Q,"exp")[0]??0;oe=Math.pow(De,We);break}case"compute.exp":{const De=T(Q,"base")[0]??0,We=T(Q,"exp")[0]??0;oe=Math.pow(De,We);break}case"compute.log":{const De=T(Q,"value")[0]??0,We=T(Q,"base")[0]??0,Ke=Math.max(De,Number.EPSILON);oe=Math.abs(We)<Number.EPSILON?Math.log(Ke):Math.log(Ke)/Math.log(We);break}case"compute.abs":{oe=Math.abs(T(Q,"in")[0]??0);break}case"compute.min":{const De=T(Q,"in");oe=De.length?Math.min(...De):0;break}case"compute.max":{const De=T(Q,"in");oe=De.length?Math.max(...De):0;break}case"compute.floor":{oe=Math.floor(T(Q,"in")[0]??0);break}case"compute.ceil":{oe=Math.ceil(T(Q,"in")[0]??0);break}case"compute.round":{oe=Math.round(T(Q,"in")[0]??0);break}case"compute.mod":{const De=T(Q,"a")[0]??0,We=T(Q,"b")[0]??0;oe=Math.abs(We)<Number.EPSILON?0:De%We;break}case"compute.concat":{const We=["in1","in2","in3","in4","in5","in6"].flatMap(ra=>D(Q,ra)),Ke=We.length?We:D(Q,"in");oe=(Ke.length?Ke:D(Q)).map(ra=>ra==null?"":String(ra)).join("");break}case"compute.trim":{const De=D(Q,"text")[0]??D(Q,"in")[0]??"",We=De==null?"":String(De),Ke=Math.max(0,Math.round(T(Q,"start")[0]??0)),Ze=Math.max(0,Math.round(T(Q,"end")[0]??0));oe=Ke+Ze>=We.length?"":We.substring(Ke,We.length-Ze);break}case"output":{const De=h(Q,"in")[0];oe=De?ee(De):0;break}default:oe=0}return t.delete(te),Y.set(te,oe),oe};return l.forEach(te=>ee(te.id)),Y},[se,d,p]),ae=i.useRef(re);i.useEffect(()=>{ae.current=re},[re]);const O=i.useCallback(j=>{const k=ae.current.get(j.id);return e.jsx(tn,{data:{...j.data,value:k}})},[]),Me=i.useMemo(()=>({computed:O}),[O]),le=j=>{var r;if(!j.target||!j.targetHandle){x(h=>Rt(j,h));return}const k=l.find(h=>h.id===j.target),Y=k?u[((r=k.data)==null?void 0:r.type)??""]:null,t=Y==null?void 0:Y.handles.find(h=>h.id===j.targetHandle);x(h=>{let T=h;return t!=null&&t.limitOne&&(T=h.filter(D=>!(D.target===j.target&&D.targetHandle===j.targetHandle))),Rt(j,T)})},ie=j=>{const k=crypto.randomUUID(),Y=u[j]??{label:j,handles:[]},t=Y.label;C(r=>[...r,{id:k,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:Y.label,type:j,name:"",handles:Y.handles,list:j==="input.list"?[]:void 0,output:Y.output??!0}}])},Te=j=>{if(V){if(j.name!==void 0){const k=j.name.trim(),Y=k===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(k);if(E(Y?null:a.cogita.library.graph.invalidName),!k)y(null);else{const t=l.find(r=>{var h;return r.id!==V&&((h=r.data)==null?void 0:h.name)&&r.data.name.trim().toLowerCase()===k.toLowerCase()});y(t?a.cogita.library.graph.duplicateName:null)}}C(k=>k.map(Y=>{var t,r,h,T;return Y.id===V?{...Y,data:{...Y.data,...j,title:j.name?j.name:(t=Y.data)==null?void 0:t.title,subtitle:((h=u[j.type??((r=Y.data)==null?void 0:r.type)??""])==null?void 0:h.label)??((T=Y.data)==null?void 0:T.subtitle)}}:Y}))}},Ae=()=>{V&&(C(j=>j.filter(k=>k.id!==V)),x(j=>j.filter(k=>k.source!==V&&k.target!==V)),G(j=>{const k={...j};return delete k[V],k}),J(null),y(null))},ke=i.useRef({nodeId:null,edgeIds:[]}),$e=j=>{var T;const k=((T=j.nodes[0])==null?void 0:T.id)??null,Y=j.edges.map(D=>D.id),t=ke.current,r=t.nodeId===k,h=t.edgeIds.length===Y.length&&t.edgeIds.every((D,ee)=>D===Y[ee]);r&&h||(ke.current={nodeId:k,edgeIds:Y},J(k),s(Y))},Se=j=>{const k=j.filter(Y=>Y.type!=="select"&&Y.type!=="dimensions");k.length!==0&&C(Y=>ui(k,Y))},Ge=j=>{const k=j.filter(Y=>Y.type!=="select");k.length!==0&&x(Y=>di(k,Y))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodeTypes:Me,nodes:B,edges:m,onNodesChange:Se,onEdgesChange:Ge,onConnect:le,onNodeClick:(j,k)=>J(k.id),onSelectionChange:$e,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>ie("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>ie("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>ie("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>ie("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>ie("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>ie("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>ie("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>ie("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>ie("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>ie("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>ie("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>ie("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>ie("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>ie("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>ie("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>ie("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>ie("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>ie("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>ie("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>ie("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),ge?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Oe=ge.data)==null?void 0:Oe.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:j=>Te({name:j.target.value})}),b?e.jsx("em",{className:"cogita-help",children:b}):null,me?e.jsx("em",{className:"cogita-help",children:me}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((Je=u[((Fe=ge.data)==null?void 0:Fe.type)??""])==null?void 0:Je.label)??((ia=ge.data)==null?void 0:ia.type)]}),((Re=ge.data)==null?void 0:Re.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((W=ge.data)==null?void 0:W.outputLabel)??"",onChange:j=>Te({outputLabel:j.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((Z=ge.data)==null?void 0:Z.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Ve=ge.data)==null?void 0:Ve.min)??0,onChange:j=>Te({min:Number(j.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Ne=ge.data)==null?void 0:Ne.max)??10,onChange:j=>Te({max:Number(j.target.value)})})]})]}),((fe=ge.data)==null?void 0:fe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:((Ee=ge.data)==null?void 0:Ee.value)??0,onChange:j=>Te({value:Number(j.target.value)})})]}),((_e=ge.data)==null?void 0:_e.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Be=ge.data)==null?void 0:Be.list)??[]).join(`
`),onChange:j=>Te({list:j.target.value.split(`
`).map(k=>k.replace(/\r$/,"")).filter(k=>k.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((qe=ge.data)==null?void 0:qe.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{V&&(G(j=>{var h,T,D,ee;const k=Number.isFinite((h=ge.data)==null?void 0:h.min)?Number((T=ge.data)==null?void 0:T.min):0,Y=Number.isFinite((D=ge.data)==null?void 0:D.max)?Number((ee=ge.data)==null?void 0:ee.max):k+10,t=Math.min(k,Y),r=Math.max(k,Y);return{...j,[V]:Math.floor(Math.random()*(r-t+1))+t}}),ne(j=>j+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Ae,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const rr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function wr(a,n,o){if(!a)return null;const u=new Map(a.nodes.map(E=>[E.id,E])),g=new Map,w=new Set,f=E=>{if(typeof E=="number")return E;if(typeof E=="string"){const p=Number(E);return Number.isFinite(p)?p:0}return 0},P=E=>{if(g.has(E))return g.get(E);if(w.has(E))return 0;const p=u.get(E);if(!p)return 0;w.add(E);const G=ne=>{var _,ue;return(ne?((_=p.inputsByHandle)==null?void 0:_[ne])??[]:p.inputs??((ue=p.inputsByHandle)==null?void 0:ue.in)??[]).map(he=>P(he))};let $=0;switch(p.type){case"input.random":{const ne=p.min??0,I=p.max??ne+10,_=Math.min(ne,I),ue=Math.max(ne,I);$=Math.floor(Math.random()*(ue-_+1))+_;break}case"input.const":{$=p.value??0;break}case"input.list":{const ne=(p.list??[]).filter(Boolean),I=Math.round(f(G("index")[0]));$=ne.length?ne[Math.max(0,Math.min(ne.length-1,I))]:String(I);break}case"compute.add":{$=G("in").map(I=>f(I)).reduce((I,_)=>I+_,0);break}case"compute.sub":{const ne=G("add").map(_=>f(_)),I=G("sub").map(_=>f(_));$=ne.reduce((_,ue)=>_+ue,0)-I.reduce((_,ue)=>_+ue,0);break}case"compute.mul":{const ne=G("in").map(I=>f(I));$=ne.length?ne.reduce((I,_)=>I*_,1):0;break}case"compute.div":{const ne=f(G("num")[0]),I=G("den").map(_=>f(_)).reduce((_,ue)=>_+ue,0);$=Math.abs(I)<Number.EPSILON?0:ne/I;break}case"compute.pow":{const ne=f(G("base")[0]),I=f(G("exp")[0]);$=Math.pow(ne,I);break}case"compute.exp":{const ne=f(G("base")[0]),I=f(G("exp")[0]);$=Math.pow(ne,I);break}case"compute.log":{const ne=f(G("value")[0]),I=f(G("base")[0]),_=Math.max(ne,Number.EPSILON);$=Math.abs(I)<Number.EPSILON?Math.log(_):Math.log(_)/Math.log(I);break}case"compute.abs":{$=Math.abs(f(G("in")[0]));break}case"compute.min":{const ne=G("in").map(I=>f(I));$=ne.length?Math.min(...ne):0;break}case"compute.max":{const ne=G("in").map(I=>f(I));$=ne.length?Math.max(...ne):0;break}case"compute.floor":{$=Math.floor(f(G("in")[0]));break}case"compute.ceil":{$=Math.ceil(f(G("in")[0]));break}case"compute.round":{$=Math.round(f(G("in")[0]));break}case"compute.mod":{const ne=f(G("a")[0]),I=f(G("b")[0]);$=Math.abs(I)<Number.EPSILON?0:ne%I;break}case"compute.concat":{const I=["in1","in2","in3","in4","in5","in6"].flatMap(ge=>G(ge)),_=I.length?I:G("in");$=(_.length?_:G()).map(ge=>ge==null?"":String(ge)).join("");break}case"compute.trim":{const ne=G("text")[0]??G("in")[0]??"",I=ne==null?"":String(ne),_=Math.max(0,Math.round(f(G("start")[0]))),ue=Math.max(0,Math.round(f(G("end")[0])));_+ue>=I.length?$="":$=I.substring(_,I.length-ue);break}case"output":{$=G("in")[0]??0;break}default:$=0}return w.delete(E),g.set(E,$),$},M=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(E=>E.type==="output").map(E=>E.id);a.nodes.forEach(E=>P(E.id)),M.forEach(E=>P(E));const F=E=>Math.abs(E%1)<1e-5?String(Math.round(E)):E.toFixed(3).replace(/\.?0+$/,""),l=E=>typeof E=="number"?F(E):E??"",C=new Map;M.forEach(E=>{var I,_,ue,he;const p=u.get(E);if(!p)return;const G=(_=(I=p.inputsByHandle)==null?void 0:I.name)==null?void 0:_[0],$=G?l(g.get(G)):"",ne=($==null?void 0:$.toString().trim())||((ue=p.outputLabel)==null?void 0:ue.trim())||((he=p.name)==null?void 0:he.trim())||E;C.set(E,ne)});const m={},x={},V={};M.forEach(E=>{var $,ne;const p=u.get(E);if(!p)return;const G=C.get(E)??((($=p.outputLabel)==null?void 0:$.trim())||((ne=p.name)==null?void 0:ne.trim())||E);m[G]=l(g.get(E)),p.name&&(x[p.name.trim()]=G),x[E]=G});const J=(E,p)=>{let G=E;return a.nodes.forEach($=>{var he,ge;const ne=l(g.get($.id)),I=M.includes($.id),_=I?C.get($.id)??((he=$.outputLabel)==null?void 0:he.trim())??((ge=$.name)==null?void 0:ge.trim())??$.id:"",ue=I&&p?_:ne;G=G.replace(new RegExp(`\\{\\s*${rr($.id)}\\s*\\}`,"gi"),ue),$.name&&(G=G.replace(new RegExp(`\\{\\s*${rr($.name)}\\s*\\}`,"gi"),ue)),I&&$.outputLabel&&(G=G.replace(new RegExp(`\\{\\s*${rr($.outputLabel)}\\s*\\}`,"gi"),_))}),G},q=n;let s=q.trim().length>0?q:"";s||(s=M.length?`Compute ${M.join(", ")}`:"Compute"),s=J(s,!0);const b=(o==null?void 0:o.trim())??"",y=b?J(b,!1):"",me={};return g.forEach((E,p)=>{me[p]=E,V[p]=l(E);const G=u.get(p);G!=null&&G.name&&(V[G.name.trim()]=l(E))}),{prompt:s,answers:m,values:me,answerText:y,outputVariables:x,variableValues:V}}function Gr(a){var o;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((o=n[0])==null?void 0:o[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function nn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l,editInfoId:C}){const{libraryName:m}=qa(l),x=!!C,V=`/#/cogita/library/${l}`,[J,q]=i.useState("info"),[s,b]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[y,me]=i.useState(""),[E,p]=i.useState(null),[G,$]=i.useState(null),[ne,I]=i.useState("idle"),[_,ue]=i.useState(null),[he,ge]=i.useState(-1),[B,se]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[d,re]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[ae,O]=i.useState(null),[Me,le]=i.useState("idle"),[ie,Te]=i.useState(null),[Ae,ke]=i.useState(null),[$e,Se]=i.useState(null),Ge=i.useRef(null),Oe=i.useRef(null),Fe=i.useRef(null),Je=i.useMemo(()=>Qr(a),[a]),ia=i.useMemo(()=>Qi(a),[a]),Re=i.useMemo(()=>Gi(a),[a]),W=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),Z=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Ve=i.useMemo(()=>Je.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[Je]),Ne=i.useMemo(()=>{const t=M;return Ft.map(r=>{var D;const h=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${h.abbr} — ${h.name}`,latin:((D=r==null?void 0:r.la)==null?void 0:D.abbr)??h.abbr}})},[M]),fe=(t,r=!1)=>{const h=t.trim().toLowerCase();return h?Ne.filter(T=>T.label.toLowerCase().includes(h)).slice(0,8):r?Ne.slice(0,8):[]},Ee=(t,r)=>{const h=t.trim().toLowerCase();if(!h)return null;const T=Ft;for(const D of T){const ee=D==null?void 0:D.la,te=(D==null?void 0:D[r])??(D==null?void 0:D.en)??ee;if([te==null?void 0:te.abbr,te==null?void 0:te.name,ee==null?void 0:ee.abbr,ee==null?void 0:ee.name,`${te==null?void 0:te.abbr} — ${te==null?void 0:te.name}`].filter(Boolean).map(de=>de.toLowerCase()).some(de=>de===h))return{book:D,entry:te,la:ee}}return null};i.useEffect(()=>{if(!B.language||!B.word){Te(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:B.language.id,wordId:B.word.id}).then(r=>{Te(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{Te(null)})},200);return()=>window.clearTimeout(t)},[l,B.language,B.word]),i.useEffect(()=>{if(!d.languageA||!d.wordA){ke(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:d.languageA.id,wordId:d.wordA.id}).then(r=>{ke(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{ke(null)})},200);return()=>window.clearTimeout(t)},[l,d.languageA,d.wordA]),i.useEffect(()=>{if(!d.languageB||!d.wordB){Se(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:d.languageB.id,wordId:d.wordB.id}).then(r=>{Se(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Se(null)})},200);return()=>window.clearTimeout(t)},[l,d.languageB,d.wordB]),i.useEffect(()=>{if(!x||!C)return;let t=!1;return le("loading"),O(null),at({libraryId:l,infoId:C}).then(async r=>{var T,D;if(t)return;const h=r.payload??{};if(b(ee=>({...ee,infoType:r.infoType,label:h.label??"",notes:h.notes??"",language:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,sourceKind:h.sourceKind??"string",sourceResourceType:ee.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:h.text??"",workLanguage:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,workOriginalLanguage:h.originalLanguageId?{id:h.originalLanguageId,label:h.originalLanguageId,infoType:"language"}:null,workDoi:h.doi??"",mediaType:h.mediaType??"book",mediaPublisher:h.publisher??"",mediaPublicationPlace:h.publicationPlace??"",mediaPublicationYear:h.publicationYear??"",mediaPages:h.pages??"",mediaIsbn:h.isbn??"",mediaCover:h.cover??"",mediaHeight:h.height??"",mediaLength:h.length??"",mediaWidth:h.width??"",mediaWeight:h.weight??"",mediaCollection:h.collection??"",mediaLocation:h.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&h.locator&&typeof h.locator=="object"){const ee=h.locator;if(h.sourceKind==="website")b(te=>({...te,sourceUrl:typeof ee.url=="string"?ee.url:"",sourceAccessedDate:typeof ee.date=="string"?ee.date:""}));else if(h.sourceKind==="bible"){const te=typeof ee.book=="string"?ee.book:"",Q=te?Ee(te,M):null,de=Q?`${Q.entry.abbr} — ${Q.entry.name}`:te;b(oe=>({...oe,sourceLocatorValue:te,sourceLocatorAux:typeof ee.rest=="string"?ee.rest:"",sourceBibleBookDisplay:de}))}else h.sourceKind==="book"?b(te=>({...te,sourceLocatorValue:typeof ee.page=="string"?ee.page:""})):h.sourceKind==="number_document"?b(te=>({...te,sourceLocatorValue:typeof ee.number=="string"?ee.number:""})):typeof ee.text=="string"&&b(te=>({...te,sourceLocatorValue:ee.text}))}if(h.languageId&&r.infoType!=="work")try{const ee=await at({libraryId:l,infoId:h.languageId});if(t)return;b(te=>{var Q;return{...te,language:{id:h.languageId,label:((Q=ee.payload)==null?void 0:Q.label)??h.languageId,infoType:"language"}}})}catch{}if(h.languageId&&r.infoType==="work")try{const ee=await at({libraryId:l,infoId:h.languageId});if(t)return;b(te=>{var Q;return{...te,workLanguage:{id:h.languageId,label:((Q=ee.payload)==null?void 0:Q.label)??h.languageId,infoType:"language"}}})}catch{}if(h.originalLanguageId)try{const ee=await at({libraryId:l,infoId:h.originalLanguageId});if(t)return;b(te=>{var Q;return{...te,workOriginalLanguage:{id:h.originalLanguageId,label:((Q=ee.payload)==null?void 0:Q.label)??h.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(me(((T=h.definition)==null?void 0:T.answerTemplate)??""),p(((D=h.definition)==null?void 0:D.graph)??null),$(null),I("idle")):(me(""),p(null),$(null),I("idle")),q("info")}).catch(()=>{t||O(a.cogita.library.add.info.failed)}).finally(()=>{t||le("idle")}),()=>{t=!0}},[a,C,x,l]),i.useEffect(()=>{if(s.sourceKind==="bible"&&s.sourceLocatorValue&&_!=="source"){const t=Ee(s.sourceLocatorValue,M);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==s.sourceBibleBookDisplay&&b(h=>({...h,sourceBibleBookDisplay:r}))}}},[M,s.sourceKind,s.sourceLocatorValue,s.sourceBibleBookDisplay]);const _e=async()=>{var t,r;O(null);try{const h={label:s.infoType==="quote"||s.infoType==="source"?"":s.label,notes:s.infoType==="computed"?"":s.notes};if(s.language&&(s.infoType==="word"||s.infoType==="sentence")&&(h.languageId=s.language.id),s.infoType==="source"&&(h.sourceKind=s.sourceKind,s.sourceKind==="website"?h.locator={url:s.sourceUrl.trim(),date:s.sourceAccessedDate.trim()}:s.sourceKind==="bible"?h.locator={book:s.sourceLocatorValue.trim(),rest:s.sourceLocatorAux.trim()}:s.sourceKind==="book"?h.locator={page:s.sourceLocatorValue.trim()}:s.sourceKind==="number_document"?h.locator={number:s.sourceLocatorValue.trim()}:h.locator={text:s.sourceLocatorValue.trim()}),s.infoType==="quote"&&(h.text=s.quoteText),s.infoType==="work"&&(h.languageId=((t=s.workLanguage)==null?void 0:t.id)??null,h.originalLanguageId=((r=s.workOriginalLanguage)==null?void 0:r.id)??null,h.doi=s.workDoi.trim()),s.infoType==="media"&&(h.mediaType=s.mediaType,h.publisher=s.mediaPublisher.trim(),h.publicationPlace=s.mediaPublicationPlace.trim(),h.publicationYear=s.mediaPublicationYear.trim(),h.pages=s.mediaPages.trim(),h.isbn=s.mediaIsbn.trim(),h.cover=s.mediaCover.trim(),h.height=s.mediaHeight.trim(),h.length=s.mediaLength.trim(),h.width=s.mediaWidth.trim(),h.weight=s.mediaWeight.trim(),h.collection=s.mediaCollection.trim(),h.location=s.mediaLocation.trim()),s.infoType==="computed"){if(!E){O(a.cogita.library.add.info.computedRequired);return}if(!y.trim()){O(a.cogita.library.add.info.computedAnswerRequired);return}if(E.nodes.find(oe=>oe.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(oe.name))){O(a.cogita.library.add.info.computedInvalidName);return}const D=E.nodes.map(oe=>{var we;return(we=oe.name)==null?void 0:we.trim()}).filter(Boolean),ee=new Set;for(const oe of D){const we=oe.toLowerCase();if(ee.has(we)){O(a.cogita.library.add.info.computedDuplicateName);return}ee.add(we)}const te=E.nodes.filter(oe=>oe.type==="output"),Q=te.map(oe=>{var we;return(we=oe.name)==null?void 0:we.trim()}).filter(Boolean);if(Q.length!==te.length){O(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!Q.every(oe=>new RegExp(`\\{\\s*${oe}\\s*\\}`,"i").test(y))){O(a.cogita.library.add.info.computedAnswerMissingOutput);return}h.definition={answerTemplate:y,graph:E}}if(x&&C)le("saving"),await mi({libraryId:l,infoId:C,payload:h}),O(a.cogita.library.add.info.updated),le("idle");else{let T=null;if(s.referenceEnabled){const oe={sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},{payload:we,resourceInfoId:aa,error:Ue}=Be(oe);if(Ue){O(a.cogita.library.add.info.referenceMissingSource);return}T={payload:we,resourceInfoId:aa}}const D=await et({libraryId:l,infoType:s.infoType,payload:h});if(s.infoType==="source"&&s.sourceResource&&await ga({libraryId:l,connectionType:"source-resource",infoIds:[D.infoId,s.sourceResource.id]}),s.infoType==="quote"&&s.language&&await ga({libraryId:l,connectionType:"quote-language",infoIds:[D.infoId,s.language.id]}),T){const oe=await et({libraryId:l,infoType:"source",payload:T.payload});T.resourceInfoId&&await ga({libraryId:l,connectionType:"source-resource",infoIds:[oe.infoId,T.resourceInfoId]}),await ga({libraryId:l,connectionType:"reference",infoIds:[D.infoId,oe.infoId]})}O(a.cogita.library.add.info.saved);const ee=s.infoType==="word"||s.infoType==="sentence",te=s.referenceEnabled,Q=s.referenceSourceKind,de={referenceEnabled:te,referenceSourceKind:te?Q:"string",referenceSourceUrl:te&&Q==="website"?s.referenceSourceUrl:"",referenceSourceAccessedDate:te&&Q==="website"?s.referenceSourceAccessedDate:"",referenceChurchDocument:te&&Q==="number_document"?s.referenceChurchDocument:null,referenceBookMedia:te&&Q==="book"?s.referenceBookMedia:null,referenceWork:te&&Q==="work"?s.referenceWork:null,referenceLocatorValue:te&&Q==="bible"?s.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:te&&Q==="bible"?s.referenceBibleBookDisplay:""};b({infoType:s.infoType,label:"",language:ee?s.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:s.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...de}),s.infoType==="computed"&&(me(""),p(null),$(null),I("idle"))}}catch{O(a.cogita.library.add.info.failed)}},Be=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const h={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(h.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:h,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(h.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:h,resourceInfoId:r}):(t.sourceKind==="book"?h.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?h.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(h.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:h,resourceInfoId:r})},qe=()=>{if(I("idle"),!E){$(null),I("error");return}const t=wr(E,"",y);if(!t){$(null),I("error");return}$({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),I("ready")},j=async()=>{O(null);try{if(B.connectionType==="reference"){if(!B.referencedInfo||!B.source){O(a.cogita.library.add.connection.selectReference);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.referencedInfo.id,B.source.id]})}else if(B.connectionType==="source-resource"){if(!B.source||!B.sourceResource){O(a.cogita.library.add.connection.selectSourceResource);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.source.id,B.sourceResource.id]})}else if(B.connectionType==="quote-language"){if(!B.quote||!B.language){O(a.cogita.library.add.connection.selectQuoteLanguage);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.quote.id,B.language.id]})}else if(B.connectionType==="work-contributor"){if(!B.work||!B.contributor||!B.contributorRole.trim()){O(a.cogita.library.add.connection.selectWorkContributor);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.work.id,B.contributor.id],payload:{role:B.contributorRole.trim()}})}else if(B.connectionType==="work-medium"){if(!B.work||!B.medium){O(a.cogita.library.add.connection.selectWorkMedium);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.work.id,B.medium.id]})}else if(B.connectionType==="orcid-link"){if(!B.orcidEntity||!B.orcid){O(a.cogita.library.add.connection.selectOrcidLink);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.orcidEntity.id,B.orcid.id]})}else if(B.connectionType==="word-language"){if(!B.language||!B.word){O(a.cogita.library.add.connection.selectWordLanguage);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.language.id,B.word.id],payload:{note:B.note}})}else if(B.connectionType==="word-topic"){if(!B.word||!B.topic){O(a.cogita.library.add.connection.selectWordTopic);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.word.id,B.topic.id],payload:{note:B.note}})}else if(B.connectionType==="translation"){if(!B.wordA||!B.wordB){O(a.cogita.library.add.connection.selectTwoWords);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.wordA.id,B.wordB.id],payload:{note:B.note}})}else if(B.connectionType==="language-sentence"){if(!B.language||!B.sentence){O(a.cogita.library.add.connection.selectLanguageSentence);return}await ga({libraryId:l,connectionType:B.connectionType,infoIds:[B.language.id,B.sentence.id],payload:{note:B.note}})}O(a.cogita.library.add.connection.saved),se(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{O(a.cogita.library.add.connection.failed)}},k=async()=>{var t,r;O(null);try{if(d.groupType==="citation"){const T=d.citationTitle.trim(),D=d.citationQuoteText.trim();if(!D){O(a.cogita.library.add.group.citationMissingQuote);return}let ee=null;if(d.citationReferenceEnabled){const de={sourceKind:d.citationSourceKind,locatorValue:d.citationLocatorValue,locatorAux:d.citationLocatorAux,bibleBookDisplay:d.citationBibleBookDisplay,sourceUrl:d.citationSourceUrl,sourceAccessedDate:d.citationSourceAccessedDate,churchDocument:d.citationChurchDocument,bookMedia:d.citationBookMedia,work:d.citationWork},{payload:oe,resourceInfoId:we,error:aa}=Be(de);if(aa){O(a.cogita.library.add.info.referenceMissingSource);return}ee={payload:oe,resourceInfoId:we}}const te={text:D};T&&(te.title=T);const Q=await et({libraryId:l,infoType:"quote",payload:te});if(d.citationLanguage&&await ga({libraryId:l,connectionType:"quote-language",infoIds:[Q.infoId,d.citationLanguage.id]}),ee){const de=await et({libraryId:l,infoType:"source",payload:ee.payload});ee.resourceInfoId&&await ga({libraryId:l,connectionType:"source-resource",infoIds:[de.infoId,ee.resourceInfoId]}),await ga({libraryId:l,connectionType:"reference",infoIds:[Q.infoId,de.infoId]})}O(a.cogita.library.add.group.savedCitation),re(de=>({...de,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:de.citationReferenceEnabled,citationSourceKind:de.citationReferenceEnabled?de.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:de.citationReferenceEnabled?de.citationChurchDocument:null,citationBookMedia:de.citationReferenceEnabled?de.citationBookMedia:null,citationWork:de.citationReferenceEnabled?de.citationWork:null}));return}if(d.groupType==="book"){const T=d.bookTitle.trim();if(!T){O(a.cogita.library.add.group.bookMissingTitle);return}const D=d.bookWorkTitle.trim();if(!D){O(a.cogita.library.add.group.bookMissingWork);return}if(d.bookContributors.find(oe=>oe.contributor&&!oe.role.trim()||!oe.contributor&&oe.role.trim())){O(a.cogita.library.add.group.bookMissingContributor);return}const te=await et({libraryId:l,infoType:"media",payload:{label:T,mediaType:"book",publisher:d.bookPublisher.trim(),publicationPlace:d.bookPublicationPlace.trim(),publicationYear:d.bookPublicationYear.trim(),pages:d.bookPages.trim(),isbn:d.bookIsbn.trim(),cover:d.bookCover.trim(),height:d.bookHeight.trim(),length:d.bookLength.trim(),width:d.bookWidth.trim(),weight:d.bookWeight.trim(),collection:d.bookCollection.trim(),location:d.bookLocation.trim()}}),Q=await et({libraryId:l,infoType:"work",payload:{label:D,languageId:((t=d.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=d.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:d.bookWorkDoi.trim()}});await ga({libraryId:l,connectionType:"work-medium",infoIds:[Q.infoId,te.infoId]});const de=d.bookContributors.filter(oe=>oe.contributor&&oe.role.trim());for(const oe of de)await ga({libraryId:l,connectionType:"work-contributor",infoIds:[Q.infoId,oe.contributor.id],payload:{role:oe.role.trim()}});O(a.cogita.library.add.group.savedBook),re(oe=>({...oe,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!d.languageA||!d.wordA||!d.languageB||!d.wordB){O(a.cogita.library.add.group.selectBoth);return}const h=T=>Array.from(new Map(T.map(D=>[D.id,D])).values());Ae||await ga({libraryId:l,connectionType:"word-language",infoIds:[d.languageA.id,d.wordA.id]}),$e||await ga({libraryId:l,connectionType:"word-language",infoIds:[d.languageB.id,d.wordB.id]});for(const T of h(d.wordATags))await ga({libraryId:l,connectionType:"word-topic",infoIds:[d.wordA.id,T.id]});for(const T of h(d.wordBTags))await ga({libraryId:l,connectionType:"word-topic",infoIds:[d.wordB.id,T.id]});await ga({libraryId:l,connectionType:"translation",infoIds:[d.wordA.id,d.wordB.id],payload:{tagIds:h(d.translationTags).map(T=>T.id)}}),O(a.cogita.library.add.group.savedVocab),re(T=>({...T,groupType:d.groupType,languageA:d.languageA,wordA:null,languageB:d.languageB,wordB:null,wordATags:d.wordATags,wordBTags:d.wordBTags,translationTags:d.translationTags})),requestAnimationFrame(()=>{var T;return(T=Ge.current)==null?void 0:T.focus()})}catch{O(a.cogita.library.add.group.failed)}},Y=d.groupType==="citation"?a.cogita.library.add.group.saveCitation:d.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:V,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${V}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":J===t,onClick:()=>{x||q(t)},disabled:x&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[J==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:s.infoType,onChange:t=>{x||b(r=>({...r,infoType:t.target.value}))},disabled:x,children:Je.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.infoType!=="quote"&&s.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:s.label,onChange:t=>b(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(s.infoType==="word"||s.infoType==="sentence"||s.infoType==="quote")&&e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:s.language,onChange:t=>b(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),s.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:s.workLanguage,onChange:t=>b(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:s.workOriginalLanguage,onChange:t=>b(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:s.workDoi,onChange:t=>b(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),s.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:s.mediaType,onChange:t=>b(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:s.mediaPublisher,onChange:t=>b(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationPlace,onChange:t=>b(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationYear,onChange:t=>b(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:s.mediaPages,onChange:t=>b(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:s.mediaIsbn,onChange:t=>b(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:s.mediaCover,onChange:t=>b(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:s.mediaHeight,onChange:t=>b(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:s.mediaLength,onChange:t=>b(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:s.mediaWidth,onChange:t=>b(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:s.mediaWeight,onChange:t=>b(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:s.mediaCollection,onChange:t=>b(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:s.mediaLocation,onChange:t=>b(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),s.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:s.quoteText,onChange:t=>b(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),s.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:s.sourceKind,onChange:t=>{const r=t.target.value,h=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":s.sourceResourceType;b(T=>({...T,sourceKind:r,sourceResourceType:h,sourceResource:null,sourceLocatorValue:r==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?T.sourceBibleBookDisplay:""}))},children:W.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:s.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;b(h=>({...h,sourceBibleBookDisplay:r,sourceLocatorValue:""})),ue("source"),ge(-1)},onKeyDown:t=>{const r=fe(s.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),ge(h=>Math.min(h+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),ge(h=>Math.max(h-1,0));else if((t.key==="Enter"||t.key==="Tab")&&he>=0&&r[he]){const h=r[he],T=Ee(h.label,M);if(!T)return;b(D=>{var ee;return{...D,sourceBibleBookDisplay:h.label,sourceLocatorValue:((ee=T.la)==null?void 0:ee.abbr)??D.sourceLocatorValue}}),ue(null)}}},onFocus:()=>ue("source"),onBlur:()=>window.setTimeout(()=>ue(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),_==="source"&&fe(s.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:fe(s.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===he,tabIndex:-1,onMouseDown:()=>{const h=Ee(t.label,M);h&&b(T=>{var D;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((D=h.la)==null?void 0:D.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorAux,onChange:t=>b(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),s.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:s.sourceUrl,onChange:t=>b(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:s.sourceAccessedDate,onChange:t=>b(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorValue,onChange:t=>b(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),s.sourceKind!=="string"&&s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:s.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(s.sourceKind),onChange:t=>b(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ve.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(He,{libraryId:l,infoType:s.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:s.sourceResource,onChange:t=>b(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ea(a,s.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),s.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:s.notes,onChange:t=>b(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,s.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:y,onChange:t=>me(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(rn,{copy:a,value:E,onChange:t=>p(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:qe,children:a.cogita.library.add.info.computedPreview})}),G&&ne==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(Et,{value:G.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(G.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(br,{value:r,mode:"auto"})]},t))}),G.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(Et,{value:G.answerText,mode:"auto"})]}):null]}):ne==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.referenceEnabled,onChange:t=>b(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),s.referenceEnabled&&e.jsx(Ar,{libraryId:l,copy:a,language:M,sourceKindOptions:W,labels:Z,value:{sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},onChange:t=>b(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:_e,disabled:Me==="saving"||Me==="loading",children:x?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,J==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:B.connectionType,onChange:t=>se(r=>({...r,connectionType:t.target.value})),children:ia.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),B.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:B.language,onChange:t=>se(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:B.word,onChange:t=>se(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),ie&&e.jsx("p",{className:"cogita-help",children:ie})]}),B.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:B.word,onChange:t=>se(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:B.topic,onChange:t=>se(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:B.wordA,onChange:t=>se(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:B.wordB,onChange:t=>se(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:B.quote,onChange:t=>se(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:B.language,onChange:t=>se(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:B.language,onChange:t=>se(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:B.sentence,onChange:t=>se(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:B.referencedInfoType,onChange:t=>se(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:Je.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(He,{libraryId:l,infoType:B.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:B.referencedInfo,onChange:t=>se(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ea(a,B.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:B.source,onChange:t=>se(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:B.source,onChange:t=>se(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:B.sourceResourceType,onChange:t=>se(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ve.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(He,{libraryId:l,infoType:B.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:B.sourceResource,onChange:t=>se(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ea(a,B.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:B.work,onChange:t=>se(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:B.contributorType,onChange:t=>se(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ea(a,t)},t))})]}),e.jsx(He,{libraryId:l,infoType:B.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:B.contributor,onChange:t=>se(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ea(a,B.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:B.contributorRole,onChange:t=>se(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),B.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:B.work,onChange:t=>se(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:B.medium,onChange:t=>se(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),B.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:B.orcidEntityType,onChange:t=>se(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ea(a,t)},t))})]}),e.jsx(He,{libraryId:l,infoType:B.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:B.orcidEntity,onChange:t=>se(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ea(a,B.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(He,{libraryId:l,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:B.orcid,onChange:t=>se(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:B.note,onChange:t=>se(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:j,children:a.cogita.library.add.connection.save})})]}):null,J==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:d.groupType,onChange:t=>re(r=>({...r,groupType:t.target.value})),children:Re.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:d.citationLanguage,onChange:t=>re(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:d.citationTitle,onChange:t=>re(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:d.citationQuoteText,onChange:t=>re(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:d.citationReferenceEnabled,onChange:t=>re(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),d.citationReferenceEnabled&&e.jsx(Ar,{libraryId:l,copy:a,language:M,sourceKindOptions:W,labels:Z,value:{sourceKind:d.citationSourceKind,locatorValue:d.citationLocatorValue,locatorAux:d.citationLocatorAux,bibleBookDisplay:d.citationBibleBookDisplay,sourceUrl:d.citationSourceUrl,sourceAccessedDate:d.citationSourceAccessedDate,churchDocument:d.citationChurchDocument,bookMedia:d.citationBookMedia,work:d.citationWork},onChange:t=>re(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),d.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:d.bookTitle,onChange:t=>re(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:d.bookPublisher,onChange:t=>re(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:d.bookPublicationPlace,onChange:t=>re(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:d.bookPublicationYear,onChange:t=>re(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:d.bookPages,onChange:t=>re(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:d.bookIsbn,onChange:t=>re(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:d.bookCover,onChange:t=>re(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:d.bookHeight,onChange:t=>re(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:d.bookLength,onChange:t=>re(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:d.bookWidth,onChange:t=>re(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:d.bookWeight,onChange:t=>re(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:d.bookCollection,onChange:t=>re(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:d.bookLocation,onChange:t=>re(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:d.bookWorkTitle,onChange:t=>re(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:d.bookWorkLanguage,onChange:t=>re(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:d.bookWorkOriginalLanguage,onChange:t=>re(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:d.bookWorkDoi,onChange:t=>re(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>re(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),d.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((D,ee)=>ee===r?{...D,contributorType:h.target.value,contributor:null}:D)})),children:["person","institution","collective"].map(h=>e.jsx("option",{value:h,children:ea(a,h)},h))})]}),e.jsx(He,{libraryId:l,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((D,ee)=>ee===r?{...D,contributor:h}:D)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ea(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:h=>re(T=>({...T,bookContributors:T.bookContributors.map((D,ee)=>ee===r?{...D,role:h.target.value}:D)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>re(h=>{const T=h.bookContributors.filter((D,ee)=>ee!==r);return T.length===0?{...h,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...h,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),d.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:d.languageA,onChange:t=>re(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:d.languageB,onChange:t=>re(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:d.wordA,onChange:t=>re(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Ge,autoAdvance:!0,onCommit:()=>{var t;return(t=Oe.current)==null?void 0:t.focus()}}),e.jsx(He,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:d.wordB,onChange:t=>re(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Oe,autoAdvance:!0,onCommit:()=>{var t;return(t=Fe.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(He,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:d.translationTags,onChangeMultiple:t=>re(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(He,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:d.wordATags,onChangeMultiple:t=>re(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(He,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:d.wordBTags,onChangeMultiple:t=>re(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),d.groupType==="vocab"&&Ae&&e.jsx("p",{className:"cogita-help",children:Ae}),d.groupType==="vocab"&&$e&&e.jsx("p",{className:"cogita-help",children:$e}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:k,ref:Fe,children:Y})})]}):null,ae?e.jsx("p",{className:"cogita-form-error",children:ae}):null]})})})})})]})})}const Fr=a=>/\s/.test(a),Bt=a=>/[\p{L}\p{N}]/u.test(a),Br=(a,n)=>{const o=n>0?a[n-1]:"",u=n<a.length?a[n]:"";if(!o||!u)return 0;const g=Fr(o),w=Fr(u);if(g||w)return 3;const f=Bt(o),P=Bt(u);return f!==P?2:!f&&!P?1:0},ir=(a,n,o,u,g)=>{const w=Math.max(u-n,o-u);for(let f=0;f<=w;f+=1){const P=u-f;if(P>=n&&P<=o&&Br(a,P)>=g)return P;const M=u+f;if(M>=n&&M<=o&&Br(a,M)>=g)return M}return null},nr=(a,n)=>{const o=n>0?a[n-1]:"",u=n<a.length?a[n]:"";return!o||!u?!0:Bt(o)!==Bt(u)},ln=(a,n,o,u)=>{const g=o-n,w=n+u,f=o-u;if(g<=u*2||f<=w)return null;const P=Math.floor((n+o)/2),M=ir(a,w,f,P,3);if(M!==null&&nr(a,M))return M;const F=ir(a,w,f,P,2);if(F!==null&&nr(a,F))return F;const l=ir(a,w,f,P,1);return l!==null&&nr(a,l)?l:null},bt=(a,n)=>{const o=Math.max(1,7),u=Math.max(o,13),g={},w=(M,F,l,C,m)=>{const x=String(C),V={id:x,start:M,end:F,text:a.slice(M,F),depth:l,index:C,parentId:m};if(g[x]=V,F-M>u){let q=ln(a,M,F,o);if(q!==null&&q>M&&q<F){const s=w(M,q,l+1,C*2+1,x),b=w(q,F,l+1,C*2+2,x);V.leftId=s.id,V.rightId=b.id}}return V},f=w(0,a.length,0,0),P=Object.values(g).sort((M,F)=>F.depth-M.depth||M.start-F.start).map(M=>M.id);return{text:a,rootId:f.id,nodes:g,order:P}},gt=(a,n,o,u,g,w,f)=>{const P=w==="reverse"?a.order.slice().sort((M,F)=>a.nodes[F].start-a.nodes[M].start||a.nodes[F].depth-a.nodes[M].depth):a.order;for(const M of P){if(f&&M===f||n.has(M))continue;const F=a.nodes[M];if(F){if(g&&(F.leftId||F.rightId)){const l=F.leftId?o[F.leftId]??0:u,C=F.rightId?o[F.rightId]??0:u;if((l+C)/2<u)continue}return F}}return null},Xr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function on({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l}){const C=`/#/cogita/library/${l}`,[m,x,V]=Or([]),[J,q,s]=Vr([]),[b,y]=i.useState(null),[me,E]=i.useState(null),[p,G]=i.useState(null),[$,ne]=i.useState(null),I=i.useMemo(()=>m.find(d=>d.id===b)??null,[m,b]);i.useEffect(()=>{let d=!0;return pi({libraryId:l}).then(re=>{if(!d)return;const ae=re.nodes.map(O=>{var Me,le,ie;return{id:O.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:O.payload&&typeof O.payload=="object"&&"label"in O.payload?String(O.payload.label):"Item",nodeType:O.nodeType,itemType:((Me=O.payload)==null?void 0:Me.itemType)??"info",itemId:((le=O.payload)==null?void 0:le.itemId)??null,infoType:((ie=O.payload)==null?void 0:ie.infoType)??null}}});x(ae),q(re.edges.map(O=>({id:O.edgeId,source:O.fromNodeId,target:O.toNodeId})))}).catch(()=>{d&&(x([]),q([]))}),()=>{d=!1}},[l]),i.useEffect(()=>{fi({libraryId:l}).then(E).catch(()=>E(null))},[l,m,J]);const _=i.useCallback(d=>{q(re=>Rt(d,re))},[]),ue=()=>{const d=crypto.randomUUID();x(re=>[...re,{id:d,type:"default",position:{x:140+re.length*40,y:120+re.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},he=()=>{const d=crypto.randomUUID();x(re=>[...re,{id:d,type:"default",position:{x:180+re.length*40,y:160+re.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ge=async()=>{G(null);try{const d=m.map(ae=>({nodeId:ae.id,nodeType:ae.data.nodeType,payload:{itemType:ae.data.itemType,itemId:ae.data.itemId??null,label:ae.data.label,infoType:ae.data.infoType??null}})),re=J.map(ae=>({edgeId:ae.id,fromNodeId:ae.source,toNodeId:ae.target}));await xi({libraryId:l,nodes:d,edges:re}),G(a.cogita.library.graph.saveSuccess)}catch{G(a.cogita.library.graph.saveFail)}},B=d=>{I&&x(re=>re.map(ae=>ae.id===I.id?{...ae,data:{...ae.data,itemId:(d==null?void 0:d.infoId)??null,itemType:"collection",infoType:"collection",label:(d==null?void 0:d.label)??a.cogita.library.infoTypes.collection}}:ae))},se=d=>{I&&x(re=>re.map(ae=>ae.id===I.id?{...ae,data:{...ae.data,itemId:(d==null?void 0:d.infoId)??null,itemType:"info",infoType:(d==null?void 0:d.infoType)??null,label:(d==null?void 0:d.label)??a.cogita.library.infoTypes.any}}:ae))};return i.useEffect(()=>{if(!I||I.data.nodeType!=="info"||I.data.infoType!=="quote"||!I.data.itemId){ne(null);return}let d=!0;return at({libraryId:l,infoId:I.data.itemId}).then(re=>{if(!d)return;const ae=re.payload,O=(ae==null?void 0:ae.text)??"";if(!O){ne(null);return}const Me=bt(O),le=Object.values(Me.nodes).sort((ie,Te)=>ie.depth-Te.depth||ie.start-Te.start).map(ie=>({id:ie.id,text:ie.text,depth:ie.depth}));ne({title:(ae==null?void 0:ae.title)??I.data.label,fragments:le})}).catch(()=>ne(null)),()=>{d=!1}},[l,I]),e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:C,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ge,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ue,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:he,children:a.cogita.library.actions.addInfo}),me?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(me.totalCollections))})}):null,p?e.jsx("p",{className:"cogita-help",children:p}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodes:m,edges:J,onNodesChange:V,onEdgesChange:s,onConnect:_,onNodeClick:(d,re)=>y(re.id),fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),I?e.jsxs("div",{className:"cogita-graph-inspector",children:[I.data.nodeType==="collection"?e.jsx(He,{libraryId:l,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:I.data.itemId?{id:I.data.itemId,label:I.data.label,infoType:"collection"}:null,onChange:B,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(He,{libraryId:l,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:I.data.itemId?{id:I.data.itemId,label:I.data.label,infoType:I.data.infoType??void 0}:null,onChange:se,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),$?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:$.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:$.fragments.map(d=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:d.id}),e.jsx("span",{children:d.text})]},d.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function sn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l,collectionId:C}){const{libraryName:m}=qa(l),[x,V]=i.useState([]),[J,q]=i.useState("loading"),[s,b]=i.useState("idle"),y=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),me=`/#/cogita/library/${l}`,E=()=>{q("loading"),Hr({libraryId:l}).then($=>{V($),q("idle")}).catch(()=>{V([]),q("error")})};i.useEffect(()=>{E()},[l]);const p=async $=>{try{await Jr({libraryId:l,shareId:$}),E()}catch{E()}},G=async $=>{const ne=`${y}/${$}`;try{await navigator.clipboard.writeText(ne),b("copied")}catch{b("failed")}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:me,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${me}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[J==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):J==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):x.filter($=>!C||$.collectionId===C).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:x.filter($=>!C||$.collectionId===C).map($=>e.jsxs("div",{className:"cogita-share-row","data-state":$.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:$.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date($.createdUtc).toLocaleString(),$.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),$.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${y}/${$.shareCode}`}):null]}),$.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[$.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>G($.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>p($.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},$.shareId))}),s==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):s==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function cn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l}){const{libraryName:C}=qa(l),[m,x]=i.useState(null),[V,J]=i.useState(null),[q,s]=i.useState(null),[b,y]=i.useState(null),[me,E]=i.useState(null),[p,G]=i.useState(null),$=i.useRef(null),ne=ue=>{if(!Number.isFinite(ue))return"0 B";if(ue<1024)return`${ue} B`;const he=ue/1024;if(he<1024)return`${he.toFixed(1)} KB`;const ge=he/1024;return ge<1024?`${ge.toFixed(1)} MB`:`${(ge/1024).toFixed(1)} GB`},I=async()=>{x(null),E({loadedBytes:0,totalBytes:null,percent:null});try{x(a.cogita.library.overview.exporting);const ue=await yi(l,E),he=URL.createObjectURL(ue),ge=document.createElement("a");ge.href=he,ge.download=`cogita-library-${C||l}.json`,ge.click(),URL.revokeObjectURL(he),x(a.cogita.library.overview.exportReady)}catch{x(a.cogita.library.overview.exportFail)}finally{E(ue=>ue??{loadedBytes:0,totalBytes:null,percent:null})}},_=async ue=>{var ge;J(null),s(null),y(null);const he=(ge=ue.target.files)==null?void 0:ge[0];if(he)try{J(a.cogita.library.overview.importing),G({loadedBytes:0,totalBytes:he.size,percent:0});const B=await vi(l,he,G,se=>{const d=se.stage==="infos"?a.cogita.library.overview.importStageInfos:se.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;y(a.cogita.library.overview.importLiveProgress.replace("{stage}",d).replace("{done}",String(se.processed)).replace("{total}",String(se.total)).replace("{infos}",String(se.infos)).replace("{connections}",String(se.connections)).replace("{collections}",String(se.collections)))});s({infos:B.infosImported,connections:B.connectionsImported,collections:B.collectionsImported}),J(a.cogita.library.overview.importDone)}catch(B){const se=B instanceof ji&&B.message?` ${B.message}`:"";J(`${a.cogita.library.overview.importFail}${se}`)}finally{$.current&&($.current.value="")}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:I,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:$,type:"file",accept:"application/json",onChange:_})]})]}),me?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:me.percent??void 0,max:me.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ne(me.loadedBytes)).replace("{total}",me.totalBytes?ne(me.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,p?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:p.percent??void 0,max:p.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ne(p.loadedBytes)).replace("{total}",p.totalBytes?ne(p.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null,V?e.jsx("p",{className:"cogita-help",children:V}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null,q?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(q.infos)).replace("{connections}",String(q.connections)).replace("{collections}",String(q.collections))}):null]})]})})})]})})}function dn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l}){const{libraryName:C}=qa(l),[m,x]=i.useState(""),[V,J]=i.useState([]),q=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:s=>x(s.target.value),placeholder:a.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=m.trim();s&&(J(b=>[{id:q(),name:s},...b]),x(""))},children:a.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[V.length===0?e.jsx("p",{children:a.cogita.library.modules.storyboardsEmpty}):null,V.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function un({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l}){const{libraryName:C}=qa(l),[m,x]=i.useState(""),[V,J]=i.useState([]),q=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:s=>x(s.target.value),placeholder:a.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=m.trim();s&&(J(b=>[{id:q(),name:s},...b]),x(""))},children:a.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[V.length===0?e.jsx("p",{children:a.cogita.library.modules.textsEmpty}):null,V.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function Dr({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l}){const{libraryName:C}=qa(l),m=`/#/cogita/library/${l}`,[x,V]=i.useState(""),[J,q]=i.useState([]),[s,b]=i.useState("idle"),[y,me]=i.useState(0),[E,p]=i.useState(null);i.useEffect(()=>{b("loading");const $=window.setTimeout(()=>{jt({libraryId:l,query:x.trim()||void 0,limit:30}).then(ne=>{q(ne.items),me(ne.total),p(ne.nextCursor??null),b("ready")}).catch(()=>{q([]),me(0),p(null),b("ready")})},240);return()=>window.clearTimeout($)},[l,x]);const G=async()=>{if(E){b("loading");try{const $=await jt({libraryId:l,query:x.trim()||void 0,limit:30,cursor:E});q(ne=>[...ne,...$.items]),p($.nextCursor??null),me($.total),b("ready")}catch{b("ready")}}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${m}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:x,onChange:$=>V($.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(J.length)).replace("{total}",String(y||J.length))}),e.jsx("span",{children:s==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:J.length?J.map($=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${m}/collections/${$.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:$.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String($.itemCount))," ·"," ",$.notes||a.cogita.library.collections.noNotes]})]})},$.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${m}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),E?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:G,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}function gn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l,collectionId:C}){qa(l);const m=`/#/cogita/library/${l}`,[x,V]=i.useState(a.cogita.library.collections.defaultName),[J,q]=i.useState(null),[s,b]=i.useState(0),[y,me]=i.useState([]),[E,p]=i.useState("idle"),[G,$]=i.useState(null),ne=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(y.length)).replace("{total}",String(s||y.length)),[a,y.length,s]);i.useEffect(()=>{Wt(l,C).then(_=>{V(_.name),q(_.notes??null),b(_.itemCount)}).catch(()=>{V(a.cogita.library.collections.defaultName),q(null)})},[l,C]),i.useEffect(()=>{p("loading"),At({libraryId:l,collectionId:C,limit:40}).then(_=>{me(_.items),$(_.nextCursor??null),b(_.total),p("ready")}).catch(()=>{me([]),$(null),p("ready")})},[l,C]);const I=async()=>{if(G){p("loading");try{const _=await At({libraryId:l,collectionId:C,limit:40,cursor:G});me(ue=>[...ue,..._.items]),$(_.nextCursor??null),b(_.total),p("ready")}catch{p("ready")}}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:J||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${m}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${m}/collections/${C}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${m}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ne}),e.jsx("span",{children:E==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:y.length?y.map(_=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:_.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:_.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:_.label}),e.jsx("p",{className:"cogita-card-subtitle",children:_.description})]})},pe(_))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),G?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:I,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${m}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Oa=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,o=a.filter(w=>w.correct).length,u=zt(kr(a));return{score:Math.round(Math.max(0,Math.min(100,u.knowness*100))*100)/100,total:n,correct:o,lastReviewedUtc:u.lastReviewedUtc??null}},hn=a=>{if(a.maskBase64)try{const n=wi(a.maskBase64);if(!n.length)return a.correct?1:0;const o=n.reduce((u,g)=>u+g,0);return Math.max(0,Math.min(1,o/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},kr=a=>a.map(n=>({correctness:hn(n),createdUtc:n.createdUtc})),zt=(a,n=Date.now())=>{var s;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const u=a.slice().sort((b,y)=>b.createdUtc.localeCompare(y.createdUtc)).slice(-5),g=u.reduce((b,y)=>b+y.correctness,0)/u.length,w=5,f=2,P=.15;let M=0,F=0;for(let b=0;b<u.length;b+=1){const y=new Date(u[b].createdUtc).getTime(),me=b===u.length-1?n:new Date(u[b+1].createdUtc).getTime(),E=Math.max(0,(me-y)/(1e3*60)),p=1-Math.exp(-E/w);M+=p,u[b].correctness>.5&&(F+=P)}let l=g*M*f+F;const C=((s=u[u.length-1])==null?void 0:s.createdUtc)??null,m=C?Math.max(0,(n-new Date(C).getTime())/(1e3*60)):0,V=1/(1+Math.log1p(m/60));return l*=V,u.length===1&&u[0].correctness>.5&&(l+=5.44*Math.exp(-m/2)),{knowness:l,avgCorrectness:g,lastReviewedUtc:C}},wt=a=>{const n=a.slice();for(let o=n.length-1;o>0;o-=1){const u=Math.floor(Math.random()*(o+1));[n[o],n[u]]=[n[u],n[o]]}return n},Pt=a=>a[Math.floor(Math.random()*a.length)],bn=(a,n)=>{const o=new Map;return a.forEach(u=>o.set(u,Math.random())),a.sort((u,g)=>{const w=n(u)-n(g);return w!==0?w:(o.get(u)??0)-(o.get(g)??0)})},Ht=(a,n,o,u,g)=>{if(!a.length)return null;const w=a.filter(P=>!(g!=null&&g.has(pe(P))));if(w.length===0)return null;const f=w.filter(P=>pe(P)!==o);return Pt(f.length?f:w)},mn=(a,n,o,u,g)=>{if(!a.length)return null;let w=Number.POSITIVE_INFINITY;for(const F of a){const l=pe(F);if(o.has(l))continue;const C=n[l]??1;C<w&&(w=C)}if(!Number.isFinite(w))return null;const f=a.filter(F=>{const l=pe(F);return!o.has(l)&&(n[l]??1)===w}),P=f.filter(F=>!g||pe(F)!==g),M=u?P.filter(F=>!u.has(pe(F))):P;return M.length>0?Pt(M):P.length>0?Pt(P):g&&f.some(F=>pe(F)===g)?f.find(F=>pe(F)===g)??null:f.length?Pt(f):null},Zr=(a,n,o,u,g)=>{const w=[],f=a.filter(M=>!g.has(pe(M))&&!o.has(pe(M))&&(n[pe(M)]??0)<1),P=bn(f,M=>n[pe(M)]??0);for(const M of P){if(w.length>=u)break;w.push(M),g.add(pe(M))}if(w.length<u){const M=wt(a.filter(F=>!g.has(pe(F))&&o.has(pe(F))));for(const F of M){if(w.length>=u)break;w.push(F),g.add(pe(F))}}return w},pn=(a,n,o,u)=>Zr(a,n,o,u,new Set),Tr=(a,n,o,u,g,w)=>{const f=Math.max(1,o.stackSize??n),M=wt(a).filter((V,J,q)=>q.findIndex(s=>pe(s)===pe(V))===J),F=pn(M,u,g,f),l=new Set,C=new Set,m=Ht(F,{},null,l,C),x=m?[m]:[];return m&&C.add(pe(m)),{queue:x,meta:{pool:M,active:F,knownessMap:u,unknownSet:g,outcomesById:w,asked:l,queued:C}}},mr={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const u=wt(a).filter((g,w,f)=>f.findIndex(P=>pe(P)===pe(g))===w);return{queue:u.slice(0,Math.min(n,u.length)),meta:{}}},applyOutcome:a=>a},Nr=(a,n,o,u)=>{const g=Math.max(1,o.stackSize??n),f=wt(a).filter((J,q,s)=>s.findIndex(b=>pe(b)===pe(J))===q),P={},M=new Set,F=new Set,l=new Set,C=Math.max(1,o.levels??1);f.forEach(J=>{const q=pe(J),s=u==null?void 0:u[q],b=typeof s=="number"&&Number.isFinite(s)?s:1;P[q]=Math.min(C,Math.max(1,Math.round(b)))});const m=[];if(f.length>0){const J=new Map;f.forEach(s=>{var y;const b=P[pe(s)]??1;J.has(b)||J.set(b,[]),(y=J.get(b))==null||y.push(s)});const q=Array.from(J.keys()).sort((s,b)=>s-b);for(const s of q){if(m.length>=g)break;const b=wt(J.get(s)??[]);for(const y of b){if(m.length>=g)break;m.push(y)}}}const x=Ht(m,P,null,M,F),V=x?[x]:[];return x&&F.add(pe(x)),{queue:V,meta:{pool:f,active:m,levelMap:P,asked:M,queued:F,wrongSinceCorrect:l}}},fn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,o)=>Nr(a,n,o),applyOutcome:(a,n,o,u,g)=>{if(!n)return a;const w=Math.max(1,u.levels??1),f=a.meta.pool??[],P=a.meta.active??[],M={...a.meta.levelMap??{}},F=new Set(a.meta.asked??[]),l=new Set(a.meta.queued??[]),C=new Set(a.meta.wrongSinceCorrect??[]),m=pe(n);l.delete(m),F.add(m);const x=M[m]??1;g.correct?(M[m]=C.has(m)?1:Math.min(x+1,w),C.delete(m)):(M[m]=1,C.add(m));const V=g.correct?P.filter(s=>pe(s)!==m):P.slice();if(g.correct&&V.length<Math.max(1,u.stackSize??1)){const s=new Set(V.map(y=>pe(y))),b=mn(f,M,s,F,m);b&&V.push(b)}const J=a.queue.slice(),q=Ht(V,M,m,F,l);return q&&(J.push(q),l.add(pe(q))),{queue:J,meta:{pool:f,active:V,levelMap:M,asked:F,queued:l,wrongSinceCorrect:C}}}},xn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,o)=>Tr(a,n,o,{},new Set,{}),applyOutcome:(a,n,o,u,g)=>{if(!n)return a;const w=a.meta.pool??[],f=a.meta.active??[],P={...a.meta.knownessMap??{}},M=new Set(a.meta.unknownSet??[]),F={...a.meta.outcomesById??{}},l=new Set(a.meta.asked??[]),C=new Set(a.meta.queued??[]),m=pe(n);C.delete(m),l.add(m);const x={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},J=(F[m]??[]).concat(x).sort((E,p)=>E.createdUtc.localeCompare(p.createdUtc)).slice(-5);F[m]=J,M.delete(m);const q=Date.now();w.forEach(E=>{const p=pe(E),G=F[p]??[];if(G.length===0){P[p]=0,M.add(p);return}const $=zt(G,q);P[p]=$.knowness});const s=f.slice();if((P[m]??0)>=1){const E=s.filter(p=>pe(p)!==m);s.length=0,s.push(...E)}const y=Math.max(1,u.stackSize??o);if(s.length<y){const E=new Set(s.map(G=>pe(G))),p=Zr(w,P,M,y-s.length,E);s.push(...p)}const me=a.queue.slice();if(me.length===0||pe(me[me.length-1])===m){const E=Ht(s,{},m,l,C);E&&(me.push(E),C.add(pe(E)))}return{queue:me,meta:{pool:w,active:s,knownessMap:P,unknownSet:M,outcomesById:F,asked:l,queued:C}}}},ei={random:mr,levels:fn,temporal:xn},yn=Object.values(ei),Lr=a=>{if(!a)return mr;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?ei[n]:mr},Jt=(a,n)=>{const o={...a.defaultSettings};return n&&Object.entries(n).forEach(([u,g])=>{typeof g=="number"&&Number.isFinite(g)&&(o[u]=g),typeof g=="string"&&(o[u]=g)}),a.settingsFields.forEach(u=>{var w;const g=o[u.key];if(u.type==="number"){if(typeof g!="number"||Number.isNaN(g)){o[u.key]=a.defaultSettings[u.key]??0;return}u.min!==void 0&&(o[u.key]=Math.max(u.min,o[u.key])),u.max!==void 0&&(o[u.key]=Math.min(u.max,o[u.key]));return}if(u.type==="select"){const f=((w=u.options)==null?void 0:w.map(P=>P.value))??[];(typeof g!="string"||f.length>0&&!f.includes(g))&&(o[u.key]=a.defaultSettings[u.key]??f[0]??"")}}),o},ai=(a,n)=>{const o={};return a.settingsFields.forEach(u=>{const g=n.get(u.key);if(g){if(u.type==="number"){const w=Number(g);Number.isNaN(w)||(o[u.key]=w);return}o[u.key]=g}}),Jt(a,o)},vn=(a,n)=>{const o=new URLSearchParams;return a.settingsFields.forEach(u=>{const g=n[u.key];(typeof g=="number"||typeof g=="string")&&o.set(u.key,String(g))}),o};function jn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l,collectionId:C,revisionId:m}){const{libraryName:x}=qa(l),V=`/#/cogita/library/${l}`,[J,q]=i.useState(a.cogita.library.collections.defaultName),[s,b]=i.useState(""),[y,me]=i.useState(20),[E,p]=i.useState("random"),[G,$]=i.useState({}),[ne,I]=i.useState("exact"),[_,ue]=i.useState([]),[he,ge]=i.useState(null),[B,se]=i.useState([]),[d,re]=i.useState("idle"),[ae,O]=i.useState(null),[Me,le]=i.useState("idle"),[ie,Te]=i.useState("idle"),[Ae,ke]=i.useState("idle"),$e=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Se=i.useMemo(()=>Lr(E),[E]),Ge=i.useMemo(()=>Jt(Se,G),[Se,G]),Oe=i.useMemo(()=>vn(Se,Ge).toString(),[Se,Ge]);i.useEffect(()=>{Wt(l,C).then(Z=>q(Z.name)).catch(()=>q(a.cogita.library.collections.defaultName))},[l,C]),i.useEffect(()=>{m&&ki({libraryId:l,collectionId:C,revisionId:m}).then(Z=>{b(Z.name),p(Z.mode||"random"),I(Z.check||"exact"),me(Z.limit||20),$(Z.revisionSettings??{})}).catch(()=>{b("")})},[C,l,m]),i.useEffect(()=>{Ti({libraryId:l}).then(Z=>{ue(Z),!he&&Z.length>0&&ge(Z[0].roleId)}).catch(()=>{ue([])})},[l]);const Fe=()=>{Te("loading"),Hr({libraryId:l}).then(Z=>{se(Z),Te("idle")}).catch(()=>{se([]),Te("error")})};i.useEffect(()=>{Fe()},[l]);const Je=async()=>{re("working"),le("idle");try{const Z=await Li({libraryId:l,collectionId:C,revisionType:Se.id,revisionSettings:Ge,mode:E,check:ne,limit:y});O(`${$e}/${Z.shareCode}${Oe?`?${Oe}`:""}`),re("ready"),Fe()}catch{re("error")}},ia=async()=>{if(m){ke("saving");try{await Ni({libraryId:l,collectionId:C,revisionId:m,name:s||J,revisionType:Se.id,revisionSettings:Ge,mode:E,check:ne,limit:y}),ke("saved")}catch{ke("error")}}},Re=async()=>{if(ae)try{await navigator.clipboard.writeText(ae),le("copied")}catch{le("failed")}},W=async Z=>{try{await Jr({libraryId:l,shareId:Z}),Fe()}catch{Fe()}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:J}),e.jsx("p",{className:"cogita-library-subtitle",children:x})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:V,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${V}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${V}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${V}/collections/${C}/revision/run?mode=${encodeURIComponent(E)}&check=${encodeURIComponent(ne)}&limit=${y}${Oe?`&${Oe}`:""}${he?`&reviewer=${encodeURIComponent(he)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:s,onChange:Z=>b(Z.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:E,onChange:Z=>p(Z.target.value),children:yn.map(Z=>e.jsx("option",{value:Z.id,children:a.cogita.library.revision[Z.labelKey]},Z.id))})]}),Se.settingsFields.map(Z=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[Z.labelKey]}),Z.type==="select"?e.jsx("select",{value:String(Ge[Z.key]??""),onChange:Ve=>$(Ne=>({...Ne,[Z.key]:Ve.target.value})),children:(Z.options??[]).map(Ve=>e.jsx("option",{value:Ve.value,children:a.cogita.library.revision[Ve.labelKey]},Ve.value))}):e.jsx("input",{type:"number",min:Z.min,max:Z.max,step:Z.step,value:Ge[Z.key]??0,onChange:Ve=>$(Ne=>({...Ne,[Z.key]:Number(Ve.target.value||0)}))})]},Z.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),Se.id!=="levels"&&Se.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:y,onChange:Z=>me(Number(Z.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:he??"",onChange:Z=>ge(Z.target.value||null),children:_.map(Z=>e.jsx("option",{value:Z.roleId,children:Z.label},Z.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[m?e.jsx("button",{type:"button",className:"cta ghost",onClick:ia,disabled:Ae==="saving",children:Ae==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${V}/collections/${C}/revision/run?mode=${encodeURIComponent(E)}&check=${encodeURIComponent(ne)}&limit=${y}${Oe?`&${Oe}`:""}${he?`&reviewer=${encodeURIComponent(he)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Ae==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),ae?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:ae,readOnly:!0})]}):null,d==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,Me==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):Me==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:Je,disabled:d==="working",children:d==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),ae?e.jsx("button",{type:"button",className:"cta ghost",onClick:Re,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),ie==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):B.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:B.map(Z=>e.jsxs("div",{className:"cogita-share-row","data-state":Z.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:Z.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(Z.createdUtc).toLocaleString(),Z.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),Z.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>W(Z.shareId),children:a.cogita.library.revision.shareRevokeAction})]},Z.shareId))})]})]})]})]})})})]})})}function ti({copy:a,currentCard:n,currentTypeLabel:o,prompt:u,languages:g,answer:w,onAnswerChange:f,computedExpected:P,computedAnswers:M,onComputedAnswerChange:F,answerTemplate:l,outputVariables:C,variableValues:m,computedFieldFeedback:x,feedback:V,canAdvance:J,quoteContext:q,quotePlaceholder:s,onCheckAnswer:b,onSkip:y,onLanguageSelect:me,onMarkReviewed:E,onAdvance:p,showCorrectAnswer:G,setShowCorrectAnswer:$,onRevealCorrect:ne,answerMask:I,expectedAnswer:_,hasExpectedAnswer:ue,handleComputedKeyDown:he,answerInputRef:ge,computedInputRefs:B,scriptMode:se,setScriptMode:d,matchPairs:re,matchLeftOrder:ae,matchRightOrder:O,matchSelection:Me,matchActiveLeft:le,matchActiveRight:ie,matchFeedback:Te,onMatchLeftSelect:Ae,onMatchRightSelect:ke}){const $e=i.useMemo(()=>{var Y;const W=!l&&P.length===2?`The {${P[0].key}} is of type {${P[1].key}}`:null,Z=l??W;if(!Z)return null;const Ve=new Map(P.map(t=>[t.key,t.expected])),Ne=new Set,fe=[],Ee=/\{([^}]+)\}/g;let _e=0,Be,qe=null;for(;(Be=Ee.exec(Z))!==null;){const t=Z.slice(_e,Be.index);t&&fe.push({type:"text",value:t});const r=((Y=Be[1])==null?void 0:Y.trim())??"",h=r&&Ve.has(r)?r:r&&C&&C[r]?C[r]:null;r&&Ne.add(r),h&&Ne.add(h),h&&Ve.has(h)?(fe.push({type:"input",value:h}),qe||(qe=h)):r&&m&&m[r]!==void 0?fe.push({type:"text",value:m[r]}):fe.push({type:"text",value:Be[0]}),_e=Be.index+Be[0].length}const j=Z.slice(_e);return j&&fe.push({type:"text",value:j}),P.filter(t=>!Ne.has(t.key)).length>0?null:{parts:fe,expectedByKey:Ve,firstInputKey:qe}},[l,P,C,m]),Se=()=>{if(!$e)return null;const{parts:W,expectedByKey:Z,firstInputKey:Ve}=$e;return e.jsx("div",{className:"cogita-revision-inline-answer",children:W.map((Ne,fe)=>{var Ee,_e;return Ne.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Ne.value},`text-${fe}`):e.jsx("input",{ref:Be=>{B.current[Ne.value]=Be},autoFocus:Ne.value===Ve,value:M[Ne.value]??"",onChange:Be=>F(Ne.value,Be.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[Ne.value]??(V==="correct"?"correct":V==="incorrect"?"incorrect":void 0),onKeyDown:Be=>Je(Be)||he(Be),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Ee=M[Ne.value])==null?void 0:Ee.length)??0,((_e=Z.get(Ne.value))==null?void 0:_e.length)??6)}ch`}},`input-${Ne.value}-${fe}`)})})},Ge=i.useMemo(()=>{const W=new Map;return(re??[]).forEach(Z=>W.set(Z.leftId,Z)),W},[re]),Oe=i.useMemo(()=>{const W=new Map;return(re??[]).forEach(Z=>W.set(Z.rightId,Z)),W},[re]);i.useEffect(()=>{var fe;if(n.cardType!=="info"||n.infoType!=="computed"||P.length===0)return;const W=typeof document<"u"?document.activeElement:null;if(W&&(W.tagName==="INPUT"||W.tagName==="TEXTAREA"))return;const Z=($e==null?void 0:$e.firstInputKey)??((fe=P[0])==null?void 0:fe.key);if(!Z)return;const Ve=B.current[Z];if(!Ve)return;const Ne=requestAnimationFrame(()=>{Ve.focus()});return()=>cancelAnimationFrame(Ne)},[n,P,$e]);const Fe=(()=>{const W=[_??"",...P.map(Ne=>Ne.expected??"")].join(""),Z=[w,...Object.values(M)].join(""),Ve=`${W}${Z}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Ve)})(),Je=W=>W.ctrlKey&&(W.key==="^"||W.key==="6")?(W.preventDefault(),d(Z=>Z==="super"?null:"super"),!0):W.ctrlKey&&(W.key==="_"||W.key==="-")?(W.preventDefault(),d(Z=>Z==="sub"?null:"sub"),!0):!1,ia=()=>{if(!_||!I)return _??"";const W=_.split(""),Z=Array.from(I),Ve=Z.length>0?Z.reduce((Ne,fe)=>Ne+fe,0)/Z.length:127;return W.map((Ne,fe)=>{const Ee=Z[fe]??Ve,_e=Math.max(0,Math.min(255,Math.round(Ee)));let Be=255,qe=0;return _e<=127?qe=Math.round(_e/127*255):(qe=255,Be=Math.round(255*(1-(_e-127)/128))),e.jsx("span",{style:{color:`rgb(${Be}, ${qe}, 0)`},children:Ne},`mask-${fe}`)})},Re=n.cardType==="info"&&n.infoType==="quote"?(q==null?void 0:q.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:o}),e.jsx("strong",{children:Re})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&re?e.jsxs("div",{className:"cogita-revision-body",children:[u?e.jsx("h2",{children:u}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(ae??[]).map(W=>{const Z=Ge.get(W);if(!Z)return null;const Ve=(Me==null?void 0:Me[W])??null,Ne=(Te==null?void 0:Te[W])??null,fe=le===W;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":fe,"data-state":Ne??void 0,"data-locked":Ve?"true":void 0,onClick:()=>Ae==null?void 0:Ae(W),children:[e.jsx("span",{children:Z.leftLabel}),Ve&&G?e.jsx("em",{children:"✓"}):null]},W)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(O??[]).map(W=>{const Z=Oe.get(W);if(!Z)return null;const Ve=Object.values(Me??{}).includes(W),Ne=ie===W;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Ve||Ne,"data-locked":Ve?"true":void 0,onClick:()=>ke==null?void 0:ke(W),children:e.jsx("span",{children:Z.rightLabel})},W)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:y,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ge,value:w,onChange:W=>f(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":V==="correct"?"correct":V==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?p():b())}})]}),Fe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":se==="super",onClick:()=>d(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":se==="sub",onClick:()=>d(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:y,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,l?null:e.jsx(Et,{value:u??"",mode:"auto"}),P.length>0?(()=>{const W=Se();return W?e.jsx("div",{className:"cogita-inline-answer-wrap",children:W}):e.jsx("div",{className:"cogita-form-grid",children:P.map((Z,Ve)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:Z.key}),e.jsx("textarea",{ref:Ne=>{B.current[Z.key]=Ne},autoFocus:Ve===0,value:M[Z.key]??"",onChange:Ne=>F(Z.key,Ne.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[Z.key]??(V==="correct"?"correct":V==="incorrect"?"incorrect":void 0),onKeyDown:Ne=>Je(Ne)||he(Ne)})]},Z.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ge,value:w,onChange:W=>f(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":V==="correct"?"correct":V==="incorrect"?"incorrect":void 0,onKeyDown:W=>{Je(W)||W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?p():b())}})]})}),Fe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":se==="super",onClick:()=>d(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":se==="sub",onClick:()=>d(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:y,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&q?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(q.completed)).replace("{total}",String(q.total))}),e.jsx("p",{className:"cogita-quote-text",children:q.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ge,value:w,onChange:W=>f(W.target.value),placeholder:s??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":V==="correct"?"correct":V==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?p():b())}})]}),e.jsx("p",{className:"cogita-quote-text",children:q.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:y,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(W=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>me(W.label),children:W.label},W.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:y,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:E,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:y,children:a.cogita.library.revision.skip})]})]}),V&&e.jsx("div",{className:"cogita-revision-feedback","data-state":V,children:V==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),V==="incorrect"&&ue?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>$(W=>{const Z=!W;return Z&&ne(),Z}),children:a.cogita.library.revision.showAnswer}),G?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),P.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[P.map(W=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:W.key}),e.jsx("span",{children:W.expected})]},W.key)),_?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:_})]}):null]}):e.jsx("p",{children:I?ia():_})]}):null]}):null,J?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:p,children:a.cogita.library.revision.nextQuestion})}):null]})}const lr=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ri({outcomes:a}){const[n,o]=i.useState("day"),u=i.useMemo(()=>{const g=lr.find(P=>P.id===n)??lr[1],w=Date.now()-g.ms,f=a.filter(P=>new Date(P.createdUtc).getTime()>=w);return Oa(f)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:lr.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>o(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[u.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[u.correct," / ",u.total]})]})}const wn="cogita-revision",kn=1,Dt="outcomes",Tn=()=>new Promise((a,n)=>{const o=indexedDB.open(wn,kn);o.onupgradeneeded=()=>{const u=o.result;if(!u.objectStoreNames.contains(Dt)){const g=u.createObjectStore(Dt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},o.onerror=()=>n(o.error),o.onsuccess=()=>a(o.result)}),Tt=async(a,n)=>{const o=await Tn();return new Promise((u,g)=>{const w=o.transaction(Dt,a),f=w.objectStore(Dt);n(f).then(u).catch(g),w.onerror=()=>g(w.error)})},ii=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(o=>o.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Nn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const o=ii();return localStorage.setItem(a,o),o},Ln=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),o=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(o)),o},ni=(a,n,o,u)=>Ka(a,n,o,u),Kt=async a=>{const n=Nn(),o=Ln(),u=new Date().toISOString(),g={...a,clientId:n,clientSequence:o,createdUtc:u,id:ii(),pending:!0};return await Tt("readwrite",w=>new Promise((f,P)=>{const M={...g,itemKey:ni(g.itemType,g.itemId,g.checkType,g.direction)},F=w.add(M);F.onsuccess=()=>f(),F.onerror=()=>P(F.error)})),g},Ot=async(a,n,o,u)=>{if(!n)return[];try{const g=ni(a,n,o,u);return await Tt("readonly",w=>new Promise((f,P)=>{const F=w.index("byItem").getAll(g);F.onsuccess=()=>{const C=(F.result??[]).map(m=>({itemType:m.itemType,itemId:m.itemId,checkType:m.checkType??null,direction:m.direction??null,revisionType:m.revisionType,evalType:m.evalType,correct:m.correct,createdUtc:m.createdUtc,maskBase64:m.maskBase64,payloadBase64:m.payloadBase64,payloadHashBase64:m.payloadHashBase64,clientId:m.clientId,clientSequence:m.clientSequence,personRoleId:m.personRoleId??null})).sort((m,x)=>m.createdUtc.localeCompare(x.createdUtc));f(C)},F.onerror=()=>P(F.error)}))}catch{return[]}},Va=async()=>{try{return await Tt("readonly",a=>new Promise((n,o)=>{const u=a.getAll();u.onsuccess=()=>{const w=(u.result??[]).map(f=>({itemType:f.itemType,itemId:f.itemId,checkType:f.checkType??null,direction:f.direction??null,revisionType:f.revisionType,evalType:f.evalType,correct:f.correct,createdUtc:f.createdUtc,maskBase64:f.maskBase64,payloadBase64:f.payloadBase64,payloadHashBase64:f.payloadHashBase64,clientId:f.clientId,clientSequence:f.clientSequence,personRoleId:f.personRoleId??null}));n(w)},u.onerror=()=>o(u.error)}))}catch{return[]}},Cn=async(a=100)=>{try{return await Tt("readonly",n=>new Promise((o,u)=>{const w=n.index("byPending").getAll(!0);w.onsuccess=()=>{const f=w.result??[];o(f.slice(0,a))},w.onerror=()=>u(w.error)}))}catch{return[]}},Mn=async a=>{if(a.length!==0)try{await Tt("readwrite",n=>new Promise((o,u)=>{let g=a.length;a.forEach(w=>{const f=n.get(w);f.onsuccess=()=>{const P=f.result;if(P){P.pending=!1;const M=n.put(P);M.onsuccess=()=>{g-=1,g===0&&o()},M.onerror=()=>u(M.error)}else g-=1,g===0&&o()},f.onerror=()=>u(f.error)})}))}catch{}},or=async(a,n)=>{const o=await Cn(200);if(o.length===0)return;const u=new Map;o.forEach(g=>{var f;const w=g.personRoleId??n??"";u.has(w)||u.set(w,[]),(f=u.get(w))==null||f.push(g)});for(const[g,w]of u.entries()){const f=w.map(P=>({itemType:P.itemType,itemId:P.itemId,checkType:P.checkType??null,direction:P.direction??null,revisionType:P.revisionType,evalType:P.evalType,correct:P.correct,clientId:P.clientId,clientSequence:P.clientSequence,maskBase64:P.maskBase64??null,payloadHashBase64:P.payloadHashBase64??null,payloadBase64:P.payloadBase64??null,personRoleId:g||null}));try{await Ci({libraryId:a,outcomes:f}),await Mn(w.map(P=>P.id))}catch{}}},Kr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Sn=(a,n)=>{const o=Math.max(a.length,n.length,1),u=Math.abs(a.length-n.length);return Math.max(0,1-u/o)},In=(a,n)=>{const o=new Uint8Array(a.length),u=Sn(a,n);for(let g=0;g<a.length;g+=1){const w=a[g]===(n[g]??"")?128:0,f=a.length-1-g,P=n.length-1-g,M=a[f]===(n[P]??"")?127:0,F=Math.round((w+M)*u);o[g]=Math.max(0,Math.min(255,F))}return o},St=(a,n)=>a===n||(Kr[a]??[]).includes(n)?!0:(Kr[n]??[]).includes(a),Vt=(a,n)=>{const o=new Uint8Array(a.length);if(!a.length)return o;const u=[];for(let w=0;w<=a.length-3;w+=1)u.push({index:w,text:a.slice(w,w+3)});let g=!1;return u.forEach(w=>{for(let f=0;f<=n.length-3;f+=1){const P=n.slice(f,f+3);let M=0;for(let x=0;x<3;x+=1)St(w.text[x],P[x])&&(M+=1);if(M<2)continue;let F=w.index-1,l=f-1;for(;F>=0&&l>=0;){const x=a[F],V=n[l];if(x===V){o[F]=Math.max(o[F],255),F-=1,l-=1,g=!0;continue}if(St(x,V)){o[F]=Math.max(o[F],127),F-=1,l-=1,g=!0;continue}if(F>0&&a[F-1]===V){o[F]=Math.max(o[F],0),F-=1,g=!0;continue}if(l>0&&a[F]===n[l-1]){l-=1,g=!0;continue}break}for(let x=0;x<3;x+=1){const V=w.index+x,J=w.text[x],q=P[x],s=J===q?255:St(J,q)?127:0;o[V]=Math.max(o[V],s),g=!0}let C=w.index+3,m=f+3;for(;C<a.length&&m<n.length;){const x=a[C],V=n[m];if(x===V){o[C]=Math.max(o[C],255),C+=1,m+=1,g=!0;continue}if(St(x,V)){o[C]=Math.max(o[C],127),C+=1,m+=1,g=!0;continue}if(C+1<a.length&&a[C+1]===V){o[C]=Math.max(o[C],0),C+=1,g=!0;continue}if(m+1<n.length&&a[C]===n[m+1]){m+=1,g=!0;continue}break}}}),g?o:In(a,n)},ht=(a,n,o)=>{const u=a.trim().toLowerCase(),g=n.trim().toLowerCase();return Vt(u,g)},mt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),li=(a,n,o)=>{const u=mt(a),g=mt(n);return Vt(u,g)},ka=a=>a.trim().toLowerCase(),Pn=a=>a==="reverse"?"reverse":"forward",kt=(a,n)=>`${a}|${n}`,La=a=>{if(!a)return null;const[n,o]=a.split("|",2);return(n==="forward"||n==="reverse")&&o?{mode:n,fragmentId:o}:{mode:"forward",fragmentId:a}},qt=(a,n)=>{var u;const o=La(n);return o?o.fragmentId&&n?(a??null)===n:(((u=La(a))==null?void 0:u.mode)??"forward")===o.mode:!0},ba=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},oi=(a,n)=>{if((ba(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const u=ba(a.childCheckType),g=ba(a.childDirection),w=ba(n.checkType),f=ba(n.direction);return!(u&&u!==w||g&&g!==f)},Rn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},$n={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},_t=(a,n,o)=>{if(!o||!n.startsWith(a))return n;const u=n.slice(a.length);if(!u)return n;const g=o==="super"?Rn:$n,w=u.split("").map(f=>g[f]??f).join("");return a+w},Ut=(a,n,o)=>{var f,P,M;if(!a)return((f=n[0])==null?void 0:f.key)??null;const u=new Set(n.map(F=>F.key)),g=/\{([^}]+)\}/g;let w;for(;(w=g.exec(a))!==null;){const F=((P=w[1])==null?void 0:P.trim())??"";if(!F)continue;if(u.has(F))return F;const l=o==null?void 0:o[F];if(l&&u.has(l))return l}return((M=n[0])==null?void 0:M.key)??null},pr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const o=n.description??"";if(!o.trim())return[n];const u=La(n.direction),g=(u==null?void 0:u.mode)??Pn(n.direction),w=bt(o),f=Object.keys(w.nodes);return f.length===0?[n]:f.map(P=>({...n,checkType:"quote-fragment",direction:kt(g,P)}))});function En({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l,collectionId:C,revisionId:m}){const x=vr(),V=`/#/cogita/library/${l}`,J=i.useMemo(()=>new URLSearchParams(x.search),[x.search]),q=Math.max(1,Number(J.get("limit")??20)),s=J.get("mode")??"random",b=i.useMemo(()=>Lr(s),[s]),y=i.useMemo(()=>Jt(b,ai(b,J)),[b,J]),me=J.get("check")??"exact",E=J.get("reviewer"),p=i.useMemo(()=>a.cogita.library.revision[b.labelKey]??s,[a,s,b]),G=i.useMemo(()=>me==="exact"?a.cogita.library.revision.checkValue:me,[a,me]),[$,ne]=i.useState(a.cogita.library.collections.defaultName),[I,_]=i.useState([]),[ue,he]=i.useState([]),[ge,B]=i.useState("idle"),[se,d]=i.useState({current:0,total:0}),[re,ae]=i.useState(0),[O,Me]=i.useState(""),[le,ie]=i.useState(null),[Te,Ae]=i.useState(null),[ke,$e]=i.useState(null),[Se,Ge]=i.useState(null),[Oe,Fe]=i.useState([]),[Je,ia]=i.useState({}),[Re,W]=i.useState({}),[Z,Ve]=i.useState(null),[Ne,fe]=i.useState(null),[Ee,_e]=i.useState(null),[Be,qe]=i.useState(null),[j,k]=i.useState(null),[Y,t]=i.useState({}),r=i.useRef(0),[h,T]=i.useState(null),D=i.useRef(null),ee=i.useRef(null),[te,Q]=i.useState(null),[de,oe]=i.useState(!1),[we,aa]=i.useState(null),[Ue,ta]=i.useState([]),[De,We]=i.useState(null),Ke=i.useRef(null),Ze=i.useRef(null),[Ta,ra]=i.useState(null),[Ra,sa]=i.useState(0),ya=i.useRef(null),K=i.useRef({}),[Le,Ce]=i.useState(!1),[Ye,oa]=i.useState({}),[ca,fa]=i.useState([]),na=i.useRef(new Map),[ma,xa]=i.useState(new Set),[va,ze]=i.useState(!1),la=i.useRef(null),Ma=i.useRef(new Set),Ba=i.useRef({}),ve=I[re]??null,je=(ve==null?void 0:ve.checkType)==="translation-match"&&j,_a=i.useRef(new Map),ua=i.useRef(new Map),$a=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useMemo(()=>ve?ve.cardType==="vocab"?a.cogita.library.revision.vocabLabel:ve.infoType?ea(a,ve.infoType):a.cogita.library.revision.infoLabel:"",[a,ve]),Yt=i.useMemo(()=>{var v;return b.id!=="levels"?I.length:((v=Ye.pool)==null?void 0:v.length)??b.getFetchLimit(q,y)},[Ye,y,b,I.length,q]),rt=b.getProgressTotal?b.getProgressTotal(I,Ye,q,y):b.id==="levels"?Math.min(q,Yt):I.length,it=rt?Math.min(re+1,rt):0,Ea=Math.max(1,Number(y.tries??1)),Na=y.compare??"anchors",Ua=Math.max(0,Math.min(100,Number(y.minCorrectness??0))),pa=(y.considerDependencies??"on")==="on",da=Math.max(0,Math.min(100,Number(y.dependencyThreshold??85))),Pa=c=>{const v=c.slice();for(let S=v.length-1;S>0;S-=1){const N=Math.floor(Math.random()*(S+1));[v[S],v[N]]=[v[N],v[S]]}return v},Ha=c=>c.length?c.reduce((S,N)=>S+N,0)/c.length/255*100:0,Wa=c=>Ha(c)>=Ua,nt=async()=>{const c=await Va(),v=new Map,S=new Map,N=new Map;c.forEach(A=>{const z=`${A.itemType}:${A.itemId}`,ce=Ka(A.itemType,A.itemId,A.checkType,A.direction);if(v.has(z)||v.set(z,[]),v.get(z).push(A),S.has(ce)||S.set(ce,[]),S.get(ce).push(A),A.itemType==="info"&&A.checkType==="quote-fragment"&&A.direction){const be=`${A.itemId}:${A.direction}`;N.has(be)||N.set(be,[]),N.get(be).push(A)}});const H=new Map,L=new Map,U=new Map;return v.forEach((A,z)=>H.set(z,Oa(A).score)),S.forEach((A,z)=>L.set(z,Oa(A).score)),N.forEach((A,z)=>U.set(z,Oa(A).score)),{itemKnowness:H,cardKnowness:L,fragmentKnowness:U}},Qt=async c=>{const v=[];let S=null;for(;;){const N=await At({libraryId:l,collectionId:c,limit:200,cursor:S});if(v.push(...N.items),!N.nextCursor)break;S=N.nextCursor}return pr(v)},ft=async(c,v)=>{if(na.current.has(c))return na.current.get(c)??0;const S=await Qt(c);if(S.length===0)return na.current.set(c,0),0;const H=S.reduce((L,U)=>{const A=pe(U);return L+(v.get(A)??0)},0)/S.length;return na.current.set(c,H),H},Gt=(c,v)=>{if(!pa||c.cardType!=="info"||c.infoType!=="quote"||c.checkType!=="quote-fragment")return!0;const S=La(c.direction);if(!(S!=null&&S.fragmentId))return!0;const N=c.description??"";if(!N.trim())return!0;const L=bt(N).nodes[S.fragmentId];if(!L||!L.leftId&&!L.rightId)return!0;const U=[L.leftId,L.rightId].filter(ce=>!!ce);if(U.length===0)return!0;const A=U.map(ce=>{const be=Ka("info",c.cardId,"quote-fragment",kt(S.mode,ce));return v.get(be)??0});return A.reduce((ce,be)=>ce+be,0)/A.length>=da},lt=async c=>{const v=Ye,S=c.concat(v.active??[]).concat(v.pool??[]).filter((A,z,ce)=>ce.findIndex(be=>pe(be)===pe(A))===z);if(!pa){xa(new Set(S.map(pe)));return}const{itemKnowness:N,cardKnowness:H}=await nt(),L=ca.filter(A=>ba(A.childItemType)==="collection"&&A.childItemId===C&&!ba(A.childCheckType)&&!ba(A.childDirection)),U=new Set;for(const A of S){if(A.cardType!=="info"){U.add(pe(A));continue}if(!Gt(A,H))continue;const z=ca.filter(ye=>oi(ye,A)).concat(L);if(z.length===0){U.add(pe(A));continue}let ce=0;for(const ye of z)if(ba(ye.parentItemType)==="collection")ce+=await ft(ye.parentItemId,H);else if(ba(ye.parentCheckType)||ba(ye.parentDirection)){const xe=ba(ye.parentCheckType),Ie=ba(ye.parentDirection),Pe=Ka(ye.parentItemType,ye.parentItemId,xe,Ie);ce+=H.get(Pe)??0}else{const xe=`${ye.parentItemType}:${ye.parentItemId}`;ce+=N.get(xe)??0}ce/z.length>=da&&U.add(pe(A))}xa(U)},Xt=c=>{for(let v=c;v<I.length;v+=1){const S=I[v];if(S&&(!pa||S.cardType!=="info"||ma.has(pe(S))))return v}return-1},Sa=c=>!pa||c.cardType!=="info"||ma.has(pe(c)),ot=c=>{if(b.id!=="temporal"&&b.id!=="levels")return null;const v=Ye,S=(v.active??[]).concat(v.pool??[]),N=new Set;for(const H of S){const L=pe(H);if(!(N.has(L)||c.has(L))&&(N.add(L),Sa(H)))return H}return null},Aa=i.useMemo(()=>{if(b.id!=="levels")return null;const c=Ye,v=c.pool??[],S=c.active??[],N=c.levelMap??{},H=Math.max(1,Number(y.levels??1)),L=Array.from({length:H},()=>0),U=new Set(S.map(be=>pe(be)));v.forEach(be=>{const ye=Math.min(H,Math.max(1,N[pe(be)]??1));L[ye-1]+=1});const A=v.length||1,z=L.map(be=>be/A*100),ce=ve?N[pe(ve)]??1:null;return{counts:L,percentages:z,currentLevel:ce,levelsCount:H,activeCount:S.length,poolCount:v.length,activeSet:U}},[Ye,y,b,ve]),ja=i.useMemo(()=>{if(b.id!=="temporal")return null;const c=Ye,v=c.pool??[],S=c.active??[],N=c.knownessMap??{},H=new Set(c.unknownSet??[]);let L=0;v.forEach(z=>{(N[pe(z)]??0)>1&&(L+=1)});const U=H.size,A=S.map(z=>({id:pe(z),value:H.has(pe(z))?0:Math.max(0,Math.min(1,N[pe(z)]??0))}));return{knownCount:L,unknownCount:U,dots:A}},[Ye,b]),st=i.useMemo(()=>{if(!pa)return 0;const c=Ye;return I.concat(c.active??[]).concat(c.pool??[]).filter((S,N,H)=>H.findIndex(L=>pe(L)===pe(S))===N).filter(S=>S.cardType==="info"&&!ma.has(pe(S))).length},[pa,Ye,I,ma]);i.useEffect(()=>{if(!pa||ge!=="ready")return;const c=Ye,S=I.concat(c.active??[]).concat(c.pool??[]).filter((L,U,A)=>A.findIndex(z=>pe(z)===pe(L))===U).filter(L=>L.cardType!=="info"||ma.has(pe(L))).length,N=Ke.current;if(Ke.current=S,N===null||S<=N)return;const H=S-N;We(`New card available (+${H})`),Ze.current&&window.clearTimeout(Ze.current),Ze.current=window.setTimeout(()=>We(null),2200)},[pa,ge,Ye,I,ma]),i.useEffect(()=>()=>{Ze.current&&window.clearTimeout(Ze.current)},[]);const wa=(c,v)=>{const S=b.applyOutcome({queue:I,meta:Ye},ve,q,y,{correct:c,correctness:v,createdUtc:new Date().toISOString()});_(S.queue),oa(S.meta);const N=S.queue[re+1];N&&xt(N,re+1)};i.useEffect(()=>{Wt(l,C).then(c=>ne(c.name)).catch(()=>ne(a.cogita.library.collections.defaultName))},[l,C]),i.useEffect(()=>{jr({libraryId:l,type:"language"}).then(c=>he(c)).catch(()=>he([]))},[l]),i.useEffect(()=>{zr({libraryId:l}).then(c=>fa(c.items??[])).catch(()=>fa([]))},[l]),i.useEffect(()=>{or(l,E)},[l,E]),i.useEffect(()=>{lt(I)},[I,ca,pa,da,C]),i.useEffect(()=>{if(!ve||!pa){ze(!1);return}if(ve.cardType!=="info"||ma.has(pe(ve))){ze(!1);return}const c=Xt(re+1);if(c>=0){ze(!1),ae(c);return}if(b.id==="temporal"||b.id==="levels"){const v=I.slice(0,re+1),S=I.slice(re+1).filter(Sa),N=v.concat(S),H=new Set(N.map(pe)),L=ot(H);if(L){const A=pe(L);H.has(A)||(N.push(L),H.add(A),oa(z=>{const ce=z,be=new Set(ce.queued??[]);return be.add(A),{...ce,queued:be}}))}const U=N.findIndex((A,z)=>z!==re&&Sa(A));if(U>=0){_(N),ae(U),ze(!1);return}}ze(!0)},[ve,ma,pa,re,I,Ye,b.id]),i.useEffect(()=>{let c=!0;return(async()=>{B("loading"),d({current:0,total:b.id==="levels"?0:b.getFetchLimit(q,y)});try{const S=[];let N=null,H=null;do{const ye=await At({libraryId:l,collectionId:C,limit:300,cursor:N});if(S.push(...ye.items),(b.id==="levels"||b.id==="temporal")&&ye.total&&(H=ye.total),d(xe=>({current:S.length,total:xe.total||ye.total||b.getFetchLimit(q,y)})),N=ye.nextCursor??null,H!==null&&S.length>=H||b.id!=="levels"&&b.id!=="temporal"&&S.length>=b.getFetchLimit(q,y))break}while(N);if(!c)return;const L=pr(S);let U;if(b.id==="levels"){const ye=Math.max(1,Number(y.levels??1)),Ie=(await Va()).reduce((Pe,Qe)=>{const Xe=Ka(Qe.itemType,Qe.itemId,Qe.checkType,Qe.direction);return Pe[Xe]||(Pe[Xe]=[]),Pe[Xe].push(Qe),Pe},{});U={},L.forEach(Pe=>{const Qe=pe(Pe),Xe=Ie[Qe]??[],ha=Xe.length>0?Oa(Xe).score:0,Xa=Math.max(1,Math.min(ye,Math.ceil(ha/100*ye)));U[Qe]=Xa})}let A=null,z=null,ce=null;if(b.id==="temporal"){const ye=await Va(),xe=new Set(L.map(Qe=>pe(Qe))),Ie=ye.reduce((Qe,Xe)=>{const ha=Ka(Xe.itemType,Xe.itemId,Xe.checkType,Xe.direction);return xe.has(ha)&&(Qe[ha]||(Qe[ha]=[]),Qe[ha].push(Xe)),Qe},{});A={},z=new Set,ce={};const Pe=Date.now();L.forEach(Qe=>{const Xe=pe(Qe),ha=Ie[Xe]??[];if(ha.length===0){A[Xe]=0,z.add(Xe),ce[Xe]=[];return}const Xa=kr(ha);ce[Xe]=Xa;const ci=zt(Xa,Pe);A[Xe]=ci.knowness})}const be=b.id==="levels"?Nr(L,q,y,U):b.id==="temporal"?Tr(L,q,y,A??{},z??new Set,ce??{}):b.prepare(L,q,y);_(be.queue),oa(be.meta),ae(0),B("ready"),d(ye=>({current:Math.min(ye.current,ye.total),total:ye.total}))}catch{c&&B("error")}})(),()=>{c=!1}},[l,C,q,y,b,E]),i.useEffect(()=>{if(Me(""),ie(null),ra(null),sa(0),Fe([]),ia({}),W({}),fe(null),_e(null),qe(null),oe(!1),Ce(!1),Q(null),k(null),t({}),!ve){Ae(null),$e(null),Ve(null),aa(null);return}ve.cardType==="info"&&ve.infoType==="computed"&&Ae(a.cogita.library.revision.loadingComputed);let c=!0;return xt(ve,re).then(v=>{!c||!v||(Ae(v.prompt),$e(v.expectedAnswer),Fe(v.computedExpected),ia(v.computedAnswers),Ve(v.computedValues),fe(v.answerTemplate),_e(v.outputVariables),qe(v.variableValues))}),()=>{c=!1}},[ve,a]),i.useEffect(()=>{if(!ve||ve.cardType!=="info"||ve.infoType!=="quote"){la.current=null,Ma.current=new Set,Ge(null);return}const c=ve.description??"",v=(ve.label??"").trim(),S=v.replace(/\s+/g," ").trim(),N=c.replace(/\s+/g," ").trim(),H=S&&S!==N?v:a.cogita.library.infoTypes.quote;if(!c){Ge(null),$e(null);return}const L=bt(c);la.current=L,Ae(H);let U=!0;return nt().then(({fragmentKnowness:A})=>{if(!U)return;const z=getQuoteMode(ve.direction),ce=new Set,be={};A.forEach((Ie,Pe)=>{const[Qe,Xe]=Pe.split(":",2);if(Qe!==ve.cardId)return;const ha=La(Xe);if(!ha||ha.mode!==z)return;const Xa=ha.fragmentId;be[Xa]=Ie,Ie>=da&&ce.add(Xa)}),Ma.current=ce,Ba.current=be;const ye=La(ve.direction);if(ye!=null&&ye.fragmentId&&L.nodes[ye.fragmentId]){Da(L,ye.fragmentId,H);return}const xe=gt(L,ce,be,da,pa,ve.direction);Da(L,(xe==null?void 0:xe.id)??null,H)}).catch(()=>{Ma.current=new Set,Ba.current={};const A=La(ve.direction);if(A!=null&&A.fragmentId&&L.nodes[A.fragmentId]){Da(L,A.fragmentId,H);return}const z=gt(L,Ma.current,{},da,pa,ve.direction);Da(L,(z==null?void 0:z.id)??null,H)}),()=>{U=!1}},[ve,a,pa,da]),i.useEffect(()=>{if(!ve||ve.cardType!=="vocab"||ve.checkType!=="translation-match"){k(null),t({});return}const S=(Ye.pool??Ye.active??I).filter(A=>A.cardType==="vocab"&&A.checkType==="translation-match").filter((A,z,ce)=>ce.findIndex(be=>be.cardId===A.cardId)===z);S.some(A=>A.cardId===ve.cardId)||S.unshift(ve);const H=Pa(S).slice(0,6).map(A=>{const z=A.label.split("↔").map(ye=>ye.trim()).filter(Boolean);if(z.length<2)return null;const ce=`${A.cardId}:L`,be=`${A.cardId}:R`;return{cardId:A.cardId,leftId:ce,rightId:be,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),L=H.map(A=>A.leftId),U=Pa(H.map(A=>A.rightId));k({pairs:H,leftOrder:L,rightOrder:U,selection:{},activeLeft:null,activeRight:null,locked:{}})},[ve,I,Ye]),i.useEffect(()=>()=>{D.current&&window.clearTimeout(D.current),ee.current&&window.clearTimeout(ee.current)},[]);const Ja=i.useRef(null);i.useEffect(()=>{if(!ve)return;const c=pe(ve),v=typeof document<"u"?document.activeElement:null;if(Ja.current===c&&v&&(v.tagName==="INPUT"||v.tagName==="TEXTAREA"))return;let S=0;const N=()=>{if(ve){if(ve.cardType==="info"&&ve.infoType==="computed"){if(Oe.length>0){const L=Ut(Ne,Oe,Ee),U=L?K.current[L]:null;if(U&&(U.focus(),document.activeElement===U)){Ja.current=c;return}}if(ya.current&&(ya.current.focus(),document.activeElement===ya.current)){Ja.current=c;return}}else if(ve.cardType==="vocab"&&ya.current&&(ya.current.focus(),document.activeElement===ya.current)){Ja.current=c;return}S<6&&(S+=1,window.setTimeout(N,40))}},H=window.setTimeout(N,40);return()=>window.clearTimeout(H)},[ve,Oe,Ne,Ee]),i.useEffect(()=>{if(!Le)return;const c=v=>{v.key==="Enter"&&(v.preventDefault(),dt())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[Le]);const Ya=c=>{ta(c),aa(Oa(c))};i.useEffect(()=>{if(!ve){aa(null),ta([]);return}const c=ve.cardType==="info"?"info":"connection";if(ve.cardType==="info"&&ve.infoType==="quote"){Va().then(v=>{const S=v.filter(N=>N.itemType==="info"&&N.itemId===ve.cardId&&N.checkType==="quote-fragment"&&qt(N.direction,ve.direction));Ya(S)}).catch(()=>{aa(null),ta([])});return}Ot(c,ve.cardId,ve.checkType,ve.direction).then(v=>Ya(v)).catch(()=>{aa(null),ta([])})},[l,ve,E]);const Nt=(c,v,S,N)=>{if(c==="info"&&S==="quote-fragment"){Va().then(H=>{const L=H.filter(U=>U.itemType==="info"&&U.itemId===v&&U.checkType==="quote-fragment"&&qt(U.direction,N));Ya(L)}).catch(()=>{aa(null),ta([])});return}Ot(c,v,S,N).then(H=>Ya(H)).catch(()=>{aa(null),ta([])})},Lt=(c,v,S)=>{var U;const N=((U=S.pairs.find(A=>A.leftId===c))==null?void 0:U.rightId)??null;if(!N)return S;const H=N===v;t(A=>({...A,[c]:H?"correct":"incorrect"})),D.current&&window.clearTimeout(D.current),ee.current&&window.clearTimeout(ee.current),r.current+=1;const L={kind:H?"correct":"incorrect",tick:r.current};if(T(null),D.current=window.setTimeout(()=>T(L),0),ee.current=window.setTimeout(()=>T(null),420),H){const A={...S.locked,[c]:!0};return Object.keys(A).length>=S.pairs.length?(ie("correct"),Ce(!0)):ie("correct"),{...S,selection:{...S.selection,[c]:v},activeLeft:null,activeRight:null,locked:A}}return ie("incorrect"),{...S,activeLeft:null,activeRight:null}},ct=c=>{k(v=>!v||v.locked[c]?v:v.activeRight?Lt(c,v.activeRight,v):{...v,activeLeft:v.activeLeft===c?null:c})},Fa=c=>{k(v=>v&&(v.activeLeft?Lt(v.activeLeft,c,v):{...v,activeRight:v.activeRight===c?null:c}))},dt=()=>{var c;if(ve&&ve.cardType==="info"&&ve.infoType==="quote"&&la.current&&Se&&!((c=La(ve.direction))!=null&&c.fragmentId)){const v=gt(la.current,Ma.current,Ba.current,da,pa,ve.direction,Se.fragmentId);if(v){ie(null),Me(""),oe(!1),W({}),Ce(!1),ra(null),sa(0),Da(la.current,v.id,Se.title);return}}ie(null),Me(""),oe(!1),W({}),Ce(!1),ra(null),sa(0),ae(v=>Math.min(v+1,I.length))},Ia=c=>{if(!ve)return;const v=c.expected??null,S=c.answer??"";let N=v??"",H=S;if(!v&&c.expectedMap&&c.answerMap){const ye=Object.keys(c.expectedMap).sort((xe,Ie)=>xe.localeCompare(Ie));N=ye.map(xe=>{var Ie;return((Ie=c.expectedMap)==null?void 0:Ie[xe])??""}).join("|"),H=ye.map(xe=>{var Ie;return((Ie=c.answerMap)==null?void 0:Ie[xe])??""}).join("|")}const L=N?ht(N,H,Na):new Uint8Array,U={revisionType:b.id,evalType:c.evalType,direction:c.direction,prompt:Te??"",expected:v,answer:S,expectedAnswers:c.expectedMap??null,answers:c.answerMap??null,correct:c.correct,maskBase64:L.length?za(L):null,values:Z??null,checkMode:me,compareMode:Na,minCorrectness:Ua},A=new TextEncoder().encode(JSON.stringify(U)),z=ve.cardType==="info"?"info":"connection",ce=c.overrideCheckType??ve.checkType??null,be=c.overrideDirection??ve.direction??null;Kt({itemType:z,itemId:ve.cardId,checkType:ce,direction:be,revisionType:b.id,evalType:c.evalType,correct:c.correct,maskBase64:L.length?za(L):null,payloadBase64:za(A),personRoleId:E??null}).then(()=>{Nt(z,ve.cardId,ce,be),lt(I),or(l,E)}).catch(()=>{})},Qa=(c,v)=>{const S=_a.current.get(v);if(S)return Promise.resolve(S);const N=ua.current.get(v);if(N)return N;const H=at({libraryId:l,infoId:c}).then(L=>{var ye,xe;const U=L.payload,A=((ye=U.definition)==null?void 0:ye.graph)??null,z="",ce=((xe=U.definition)==null?void 0:xe.answerTemplate)??"",be=wr(A,z,ce);if(be){const Pe={sample:Gr(be),answerTemplate:ce||null};return _a.current.set(v,Pe),Pe}return hr({libraryId:l,infoId:c}).then(Ie=>{const Pe={sample:Ie,answerTemplate:null};return _a.current.set(v,Pe),Pe})}).catch(()=>hr({libraryId:l,infoId:c}).then(L=>{const U={sample:L,answerTemplate:null};return _a.current.set(v,U),U}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{ua.current.delete(v)});return ua.current.set(v,H),H},xt=(c,v)=>{var A;const S=`${pe(c)}:${v}`,N=$a.current.get(S);if(N)return Promise.resolve(N);const H=tt.current.get(S);if(H)return H;const L=z=>($a.current.set(S,z),z);let U;if(c.cardType==="vocab"){if(c.checkType==="translation-match")return U=Promise.resolve(L({prompt:c.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),U;const z=c.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(z.length>=2){const be=(c.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ye=be?z[0]:z[1],xe=be?z[1]:z[0];U=Promise.resolve(L({prompt:ye,expectedAnswer:xe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else U=Promise.resolve(L({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(c.cardType==="info"&&c.infoType==="word"){const z=(A=c.description)!=null&&A.startsWith("Language: ")?c.description.replace("Language: ",""):null;U=Promise.resolve(L({prompt:c.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else c.cardType==="info"&&c.infoType==="computed"?U=Qa(c.cardId,S).then(z=>{var Ie,Pe;if(!z.sample)return L({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ce=z.sample,be=ce.expectedAnswers?Object.entries(ce.expectedAnswers).map(([Qe,Xe])=>({key:Qe,expected:Xe})):[],ye=be.reduce((Qe,Xe)=>(Qe[Xe.key]="",Qe),{}),xe=ce.expectedAnswerIsSentence&&((Ie=ce.expectedAnswer)==null?void 0:Ie.trim())||null;return L({prompt:ce.prompt,expectedAnswer:be.length>0?xe:((Pe=ce.expectedAnswer)==null?void 0:Pe.trim())||null,computedExpected:be,computedAnswers:ye,computedValues:ce.values??null,answerTemplate:z.answerTemplate,outputVariables:ce.outputVariables??null,variableValues:ce.variableValues??null})}).catch(()=>L({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{tt.current.delete(S)}):U=Promise.resolve(L({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return tt.current.set(S,U),U},Da=(c,v,S)=>{const N=Object.keys(c.nodes).length,H=Ma.current.size;if(!v){Ge({title:S,before:c.text,after:"",fragmentId:null,total:N,completed:H}),$e(null),Ce(!0);return}const L=c.nodes[v];if(!L)return;const U=Xr(c.text,L);Ge({title:S,before:U.before,after:U.after,fragmentId:L.id,total:N,completed:H}),$e(U.fragment),Ce(!1)},Ct=()=>{const c=la.current;c&&Ge(v=>v&&{...v,total:Object.keys(c.nodes).length,completed:Ma.current.size})},ut=()=>{const c=I[re+1];c&&xt(c,re+1)},Mt=()=>{if(ut(),ve&&ve.cardType==="vocab"&&ve.checkType==="translation-match"&&j){if(j.pairs.length===0){ie("incorrect"),Ce(!0);return}const L=j.pairs.reduce((xe,Ie)=>(xe[Ie.rightId]=Ie.rightLabel,xe),{});let U=0;const A={};j.pairs.forEach(xe=>{const Pe=j.selection[xe.leftId]===xe.rightId;A[xe.leftId]=Pe?"correct":"incorrect",Pe&&(U+=1)});const z=j.pairs.length||1,ce=U/z,be=U===j.pairs.length;t(xe=>({...xe,...A})),be?(ie("correct"),Ce(!0),sa(0)):(ie("incorrect"),Ce(!1),sa(xe=>{const Ie=xe+1;return Ie>=Ea&&(oe(!0),Ce(!0),k(Pe=>{if(!Pe)return Pe;const Qe=Pe.pairs.reduce((Xe,ha)=>(Xe[ha.leftId]=ha.rightId,Xe),{});return{...Pe,selection:Qe}})),Ie})),wa(be,ce);const ye="connection";Promise.all(j.pairs.map(xe=>{const Ie=j.selection[xe.leftId]??null,Pe=Ie?L[Ie]:"",Qe={left:xe.leftLabel,expected:xe.rightLabel,answer:Pe,checkType:"translation-match"},Xe=new TextEncoder().encode(JSON.stringify(Qe));return Kt({itemType:ye,itemId:xe.cardId,checkType:"translation-match",direction:null,revisionType:b.id,evalType:"translation-match",correct:Ie===xe.rightId,maskBase64:null,payloadBase64:za(Xe),personRoleId:E??null})})).then(()=>{Nt(ye,ve.cardId,ve.checkType,ve.direction),or(l,E)}).catch(()=>{});return}if(Oe.length>0){const L=Oe.reduce((A,z)=>{const ce=Je[z.key]??"";return A[z.key]=ka(ce)===ka(z.expected)?"correct":"incorrect",A},{});Oe.every(({key:A,expected:z})=>{const ce=Je[A]??"";return me==="exact"&&ka(ce)===ka(z)})?(ie("correct"),W(L),Ce(!0),sa(0),wa(!0,1),Ia({correct:!0,direction:Te?`${Te} -> computed`:"computed",expectedMap:Oe.reduce((A,z)=>(A[z.key]=z.expected,A),{}),answerMap:Je,evalType:"computed"})):(ie("incorrect"),W(L),Ce(!1),sa(A=>{const z=A+1;return z>=Ea&&X&&(oe(!0),Ce(!0)),z}),wa(!1,0),window.setTimeout(()=>{var z;const A=Ut(Ne,Oe,Ee);A&&K.current[A]&&((z=K.current[A])==null||z.focus())},40),Ia({correct:!1,direction:Te?`${Te} -> computed`:"computed",expectedMap:Oe.reduce((A,z)=>(A[z.key]=z.expected,A),{}),answerMap:Je,evalType:"computed"}));return}if(ve&&ve.cardType==="info"&&ve.infoType==="quote"&&(Se!=null&&Se.fragmentId)){if(!ke)return;const L=La(ve.direction),U=(L==null?void 0:L.mode)??getQuoteMode(ve.direction),A=L!=null&&L.fragmentId&&ve.direction?ve.direction:kt(U,Se.fragmentId),z=li(ke,O,Na),ce=me==="exact"&&mt(O)===mt(ke),be=Wa(z),ye=ce||be,xe=Ha(z);ye?(Ba.current[Se.fragmentId]=Math.max(Ba.current[Se.fragmentId]??0,xe),(Ba.current[Se.fragmentId]??0)>=da&&Ma.current.add(Se.fragmentId),Ct(),ie("correct"),W({}),Ce(!0),ra(z),sa(0),xe<100&&Ea<=1&&oe(!0),wa(!0,xe/100),Ia({correct:!0,direction:`quote:${Se.fragmentId}`,expected:ke,answer:O,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:A})):(ie("incorrect"),W({}),Ce(!1),ra(z),sa(Ie=>{const Pe=Ie+1;return Pe>=Ea&&X&&(oe(!0),Ce(!0)),Pe}),wa(!1,xe/100),window.setTimeout(()=>{var Ie;return(Ie=ya.current)==null?void 0:Ie.focus()},40),Ia({correct:!1,direction:`quote:${Se.fragmentId}`,expected:ke,answer:O,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:A}));return}if(!ke)return;const c=ht(ke,O,Na),v=me==="exact"&&ka(O)===ka(ke),S=Wa(c),N=v||S,H=Ha(c);N?(ie("correct"),W({}),Ce(!0),ra(c),sa(0),H<100&&Ea<=1&&oe(!0),wa(!0,H/100),Ia({correct:!0,direction:Te?`${Te} -> ${ke}`:null,expected:ke,answer:O,evalType:"text"})):(ie("incorrect"),W({}),Ce(!1),ra(c),sa(L=>{const U=L+1;return U>=Ea&&X&&(oe(!0),Ce(!0)),U}),wa(!1,H/100),window.setTimeout(()=>{var L;return(L=ya.current)==null?void 0:L.focus()},40),Ia({correct:!1,direction:Te?`${Te} -> ${ke}`:null,expected:ke,answer:O,evalType:"text"}))},Zt=c=>{if(ut(),!ke)return;const v=ht(ke,c,Na),S=ka(c)===ka(ke),N=Wa(v),H=S||N,L=Ha(v);H?(ie("correct"),W({}),Ce(!0),ra(v),sa(0),L<100&&Ea<=1&&oe(!0),wa(!0,L/100),Ia({correct:!0,direction:"word->language",expected:ke,answer:c,evalType:"language-select"})):(ie("incorrect"),W({}),Ce(!1),ra(v),sa(U=>{const A=U+1;return A>=Ea&&X&&(oe(!0),Ce(!0)),A}),wa(!1,L/100),Ia({correct:!1,direction:"word->language",expected:ke,answer:c,evalType:"language-select"}))},er=()=>{ut(),ie("correct"),Ce(!0),sa(0),wa(!0,1),ke&&Ia({correct:!0,direction:"manual",expected:ke,answer:O,evalType:"manual"})},ar=()=>{if(wa(!1,0),ve&&ve.cardType==="info"&&ve.infoType==="quote"){ie(null),Me(""),oe(!1),W({}),Ce(!1),ra(null),sa(0),ae(c=>Math.min(c+1,I.length));return}dt()};i.useEffect(()=>{ut()},[re,I]);const Ga=c=>{var S;if(c.key!=="Enter")return;if(c.preventDefault(),c.stopPropagation(),Le){dt();return}const v=Oe.find(N=>!(Je[N.key]??"").trim());if(v){(S=K.current[v.key])==null||S.focus();return}Mt()},R=a.cogita.library.revision.revealModeAfterIncorrect,X=Oe.length>0||!!ke;return e.jsxs(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:[ge==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${se.total?Math.min(100,Math.max(0,se.current/se.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:se.total?`${Math.min(se.current,se.total)} / ${se.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:$}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",p).replace("{check}",G)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:V,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${V}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${V}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:we?`${we.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Aa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Aa.currentLevel??"-"," / ",Aa.levelsCount]}):null,we?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(we.correct)).replace("{total}",String(we.total))}),we.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(we.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ri,{outcomes:Ue})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[De?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:De})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":h?`${h.kind}-${h.tick}`:je?"idle":le??"idle",children:ve?e.jsx(e.Fragment,{children:va?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ti,{copy:a,currentCard:ve,currentTypeLabel:pt,prompt:Te,languages:ue,answer:O,onAnswerChange:c=>Me(v=>_t(v,c,te)),computedExpected:Oe,computedAnswers:Je,onComputedAnswerChange:(c,v)=>ia(S=>({...S,[c]:_t(S[c]??"",v,te)})),answerTemplate:Ne,outputVariables:Ee,variableValues:Be,computedFieldFeedback:Re,feedback:le,canAdvance:Le,quoteContext:Se,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:ar,onLanguageSelect:Zt,onMarkReviewed:er,onAdvance:dt,showCorrectAnswer:de,setShowCorrectAnswer:oe,onRevealCorrect:()=>Ce(!0),answerMask:Ta,expectedAnswer:ke,hasExpectedAnswer:X,handleComputedKeyDown:Ga,answerInputRef:ya,computedInputRefs:K,scriptMode:te,setScriptMode:Q,matchPairs:j==null?void 0:j.pairs,matchLeftOrder:j==null?void 0:j.leftOrder,matchRightOrder:j==null?void 0:j.rightOrder,matchSelection:j==null?void 0:j.selection,matchActiveLeft:j==null?void 0:j.activeLeft,matchActiveRight:j==null?void 0:j.activeRight,matchFeedback:Y,onMatchLeftSelect:ct,onMatchRightSelect:Fa})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${V}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:rt?`${it} / ${rt}`:a.cogita.library.revision.progressUnlimited}),ge==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ge==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ge==="ready"&&I.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:R}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ea]})]})]}),Aa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Aa.activeCount," / ",Aa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Aa.counts.map((c,v)=>{const S=v+1,N=Aa.currentLevel===S,H=Aa.percentages[v]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":N,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:S}),e.jsx("strong",{children:c})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,H))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[H.toFixed(1),"%"]})]},`level-${S}`)})})]}):null,ja?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ja.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ja.dots.map(c=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,c.value*100))}%`,background:`rgba(${Math.round(255*(1-c.value))}, ${Math.round(200*c.value)}, 80, 0.9)`}},c.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ja.knownCount})]})]}):null,pa?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:st})]})}):null]})]})]})})})]})]})}const sr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],An={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Fn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Bn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Dn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:l,collectionId:C}){const[m,x]=i.useState(""),[V,J,q]=Or([]),[s,b,y]=Vr([]),[me,E]=i.useState(null),[p,G]=i.useState(null),[$,ne]=i.useState(null),I=`/#/cogita/library/${l}`;i.useEffect(()=>{Wt(l,C).then(d=>x(d.name)).catch(()=>x(a.cogita.library.collections.defaultName))},[l,C,a]),i.useEffect(()=>{Mi({libraryId:l,collectionId:C}).then(d=>{if(!d.graphId||d.graphId==="00000000-0000-0000-0000-000000000000"){J([]),b([]);return}const re=d.nodes.map(O=>{var Te;const Me=O.payload??{},le=Me.position??{x:120,y:120},ie=Me.params??{};return{id:O.nodeId,type:"default",position:le,data:{nodeType:O.nodeType,label:((Te=sr.find(Ae=>Ae.type===O.nodeType))==null?void 0:Te.label)??O.nodeType,params:ie}}}),ae=d.edges.map(O=>({id:O.edgeId,source:O.fromNodeId,target:O.toNodeId,sourceHandle:O.fromPort??void 0,targetHandle:O.toPort??void 0}));J(re),b(ae)}).catch(()=>{J([]),b([])})},[l,C,b,J]);const _=i.useMemo(()=>V.find(d=>d.id===me)??null,[V,me]),ue=d=>{var Me;const re=crypto.randomUUID(),ae=((Me=sr.find(le=>le.type===d))==null?void 0:Me.label)??d,O={...An[d]};J(le=>[...le,{id:re,type:"default",position:{x:120+le.length*40,y:120+le.length*40},data:{nodeType:d,label:ae,params:O}}]),E(re)},he=i.useCallback(d=>{b(re=>Rt({...d,id:crypto.randomUUID()},re))},[b]),ge=async()=>{G(null);try{await Ii({libraryId:l,collectionId:C,nodes:V.map(d=>({nodeId:d.id,nodeType:d.data.nodeType,payload:{position:d.position,params:d.data.params}})),edges:s.map(d=>({edgeId:d.id,fromNodeId:d.source,fromPort:d.sourceHandle??null,toNodeId:d.target,toPort:d.targetHandle??null}))}),G(a.cogita.library.graph.saveSuccess)}catch{G(a.cogita.library.graph.saveFail)}},B=async()=>{try{const d=await Si({libraryId:l,collectionId:C});ne(d)}catch{ne(null)}},se=d=>{_&&J(re=>re.map(ae=>ae.id===_.id?{...ae,data:{...ae.data,params:d}}:ae))};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${I}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:B,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ge,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:sr.map(d=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ue(d.type),children:d.label},d.type))}),p?e.jsx("p",{className:"cogita-help",children:p}):null,$&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String($.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String($.connections)).replace("{infos}",String($.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(fr,{nodes:V,edges:s,onNodesChange:q,onEdgesChange:y,onConnect:he,onNodeClick:(d,re)=>E(re.id),fitView:!0,children:[e.jsx(xr,{color:"rgba(120,160,200,0.2)"}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),_?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:_.data.label}),_.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:_.data.params.tagId?{id:_.data.params.tagId,label:_.data.params.tagLabel??"",infoType:"topic"}:null,onChange:d=>se({..._.data.params,tagId:(d==null?void 0:d.id)??null,tagLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:_.data.params.scope??"any",onChange:d=>se({..._.data.params,scope:d.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),_.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(He,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:_.data.params.languageId?{id:_.data.params.languageId,label:_.data.params.languageLabel??"",infoType:"language"}:null,onChange:d=>se({..._.data.params,languageId:(d==null?void 0:d.id)??null,languageLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:_.data.params.scope??"any",onChange:d=>se({..._.data.params,scope:d.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),_.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:_.data.params.infoType??"word",onChange:d=>se({..._.data.params,infoType:d.target.value}),children:Bn.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsx(He,{libraryId:l,infoType:_.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:_.data.params.infoId?{id:_.data.params.infoId,label:_.data.params.infoLabel??"",infoType:_.data.params.infoType??"word"}:null,onChange:d=>se({..._.data.params,infoId:(d==null?void 0:d.id)??null,infoLabel:(d==null?void 0:d.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),_.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:_.data.params.connectionType??"translation",onChange:d=>se({..._.data.params,connectionType:d.target.value}),children:Fn.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:_.data.params.connectionId??"",onChange:d=>se({..._.data.params,connectionId:d.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(_.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const cr="cogita.preferences",si=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],dr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ur=["settings","run","shared"];function Kn(a,n=""){const o=a.split("/").filter(Boolean);if(o[0]!=="cogita"||o[1]!=="library")return{};const u=o[2];if(!u)return{};if(!o[3])return{libraryId:u,target:"library_overview"};const g=new URLSearchParams(n),w=g.get("revisionId")??void 0,f=g.get("collectionAction"),P=g.get("libraryAction");if(o[3]==="list")return{libraryId:u,target:P==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:w,libraryAction:P==="new-info"?"new-info":void 0};if(o[3]==="detail"||o[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:o[3],revisionId:w};if(o[3]==="new"||o[3]==="add")return{libraryId:u,target:"new_card",revisionId:w,libraryAction:"new-info"};if(o[3]==="edit")return{libraryId:u,target:"new_card",revisionId:w,infoId:o[4]};if(o[3]==="shared-revisions")return{libraryId:u,target:"all_collections",revisionId:w};if(o[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(o[3]==="transfer")return{libraryId:u,target:"transfer"};if(o[3]==="storyboards")return o[4]==="new"?{libraryId:u,target:"new_storyboard"}:{libraryId:u,target:"storyboards"};if(o[3]==="texts")return o[4]==="new"?{libraryId:u,target:"new_text"}:{libraryId:u,target:"texts"};if(o[3]!=="collections")return{libraryId:u,target:"library_overview"};if(o[4]==="new")return{libraryId:u,target:"new_collection",revisionId:w};const M=o[4];return M?o[5]==="graph"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"graph"}:o[5]==="shared-revisions"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"shared"}:o[5]==="revision"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:o[6]==="run"?"run":"settings"}:f==="new-revision"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"new"}:{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"detail"}:f==="new-collection"?{libraryId:u,target:"new_collection",collectionAction:"new-collection"}:{libraryId:u,target:"all_collections"}}function gr(a,n="library_overview",o,u,g,w){const f=(P,M)=>{const F=new URLSearchParams;M!=null&&M.revisionId&&F.set("revisionId",M.revisionId),M!=null&&M.collectionAction&&F.set("collectionAction",M.collectionAction),M!=null&&M.libraryAction&&F.set("libraryAction",M.libraryAction);const l=F.toString();return l?`${P}?${l}`:P};return a?n==="library_overview"?f(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?f(`/cogita/library/${a}/list`,{revisionId:g}):n==="new_card"?w?f(`/cogita/library/${a}/edit/${w}`,{revisionId:g}):f(`/cogita/library/${a}/list`,{revisionId:g,libraryAction:"new-info"}):n==="all_collections"?o?u==="graph"?f(`/cogita/library/${a}/collections/${o}/graph`,{revisionId:g}):u==="settings"?f(`/cogita/library/${a}/collections/${o}/revision`,{revisionId:g}):u==="run"?f(`/cogita/library/${a}/collections/${o}/revision/run`,{revisionId:g}):u==="shared"?f(`/cogita/library/${a}/collections/${o}/shared-revisions`,{revisionId:g}):u==="new"?f(`/cogita/library/${a}/collections/${o}`,{revisionId:g,collectionAction:"new-revision"}):f(`/cogita/library/${a}/collections/${o}`,{revisionId:g}):f(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?f(`/cogita/library/${a}/collections`,{revisionId:g,collectionAction:"new-collection"}):n==="transfer"?f(`/cogita/library/${a}/transfer`,{revisionId:g}):n==="storyboards"?f(`/cogita/library/${a}/storyboards`,{revisionId:g}):n==="new_storyboard"?f(`/cogita/library/${a}/storyboards/new`,{revisionId:g}):n==="texts"?f(`/cogita/library/${a}/texts`,{revisionId:g}):n==="new_text"?f(`/cogita/library/${a}/texts/new`,{revisionId:g}):n==="dependencies"?f(`/cogita/library/${a}/dependencies`,{revisionId:g}):f(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function It(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function On(a){return typeof a=="string"&&si.includes(a)}function Vn(a,n){var P;if(!a.length)return null;const o=a.filter(M=>n.has(M.roleId)),u=o.length>0?o:a,g=u.map(M=>{var l,C;const F=((C=(l=M.fields.find(m=>m.fieldType==="role_kind"))==null?void 0:l.plainValue)==null?void 0:C.toLowerCase())??"";return{roleId:M.roleId,roleKind:F}}),w=g.find(M=>M.roleKind.includes("master"));if(w)return w.roleId;const f=g.find(M=>M.roleKind.includes("account")||M.roleKind.includes("user"));return f?f.roleId:((P=u[0])==null?void 0:P.roleId)??null}function qn(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function _n({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F}){const l=gi(),C=vr(),m=i.useMemo(()=>Kn(C.pathname,C.search),[C.pathname,C.search]),x=a.cogita.workspace,[V,J]=i.useState([]),[q,s]=i.useState([]),[b,y]=i.useState([]),[me,E]=i.useState([]),[p,G]=i.useState(void 0),[$,ne]=i.useState("library_overview"),[I,_]=i.useState(void 0),[ue,he]=i.useState(void 0),[ge,B]=i.useState("detail"),[se,d]=i.useState(void 0),[re,ae]=i.useState(!1),[O,Me]=i.useState(!0),[le,ie]=i.useState(!1),[Te,Ae]=i.useState(!1),[ke,$e]=i.useState(null),[Se,Ge]=i.useState(""),[Oe,Fe]=i.useState(""),[Je,ia]=i.useState(""),[Re,W]=i.useState(null),[Z,Ve]=i.useState(null),Ne=i.useRef({version:1,byLibrary:{}}),fe=i.useRef(!1),Ee=i.useRef(!1),_e=i.useRef(null),Be=i.useMemo(()=>V.find(K=>K.libraryId===p)??null,[V,p]),qe=i.useMemo(()=>q.find(K=>K.collectionId===I)??null,[q,I]),j=i.useMemo(()=>me.find(K=>K.revisionId===ue)??null,[me,ue]),k=i.useMemo(()=>({detail:x.revisions.detail,graph:x.revisions.graph,settings:x.revisions.settings,run:x.revisions.run,shared:x.targets.sharedRevisions,new:x.revisionForm.createAction}),[x.revisions.detail,x.revisions.graph,x.revisions.run,x.revisions.settings,x.targets.sharedRevisions,x.revisionForm.createAction]),Y=i.useMemo(()=>[{value:"detail",label:k.detail},{value:"graph",label:k.graph},{value:"settings",label:x.targets.allRevisions},{value:"run",label:k.run},{value:"shared",label:k.shared}],[k.detail,k.graph,k.run,k.shared,x.targets.allRevisions]),t=i.useMemo(()=>$==="new_card"?"all_cards":$==="new_collection"?"all_collections":$==="new_storyboard"?"storyboards":$==="new_text"?"texts":$,[$]),r=i.useMemo(()=>ge==="new"?"settings":ge,[ge]),h=i.useMemo(()=>$==="new_card"&&m.infoId?"selected":$==="new_card"?"new":"search",[m.infoId,$]),T=i.useMemo(()=>b.find(K=>K.infoId===m.infoId)??null,[b,m.infoId]),D=i.useMemo(()=>({library_overview:x.targets.libraryOverview,all_cards:x.targets.allCards,new_card:x.targets.newCard,all_collections:x.targets.allCollections,new_collection:x.targets.newCollection,transfer:x.targets.transfer,storyboards:x.targets.storyboards,new_storyboard:x.targets.newStoryboard,texts:x.targets.texts,new_text:x.targets.newText,dependencies:x.targets.dependencies}),[x.targets]),ee=i.useMemo(()=>D[t]??t,[t,D]),te=k[r],Q=!!p,de=!!I,oe=Q&&$==="all_collections",we=de&&$==="all_collections",aa=de&&$==="all_collections"&&ur.includes(ge),Ue=i.useCallback(K=>{const Le=!!K.libraryId;let Ce=K.target,Ye=K.collectionId,oa=K.revisionId,ca=K.revisionView,fa=K.infoId;Le?dr[Ce].requiresCollection&&!Ye?(Ce="all_collections",oa=void 0,ca="detail"):Ce!=="all_collections"?(Ye=void 0,oa=void 0,Ce!=="new_card"&&(fa=void 0)):dr[Ce].allowsRevision?ur.includes(ca)||(oa=void 0):ca="detail":(Ce="library_overview",Ye=void 0,oa=void 0,ca="detail",fa=void 0),G(K.libraryId),ne(Ce),_(Ye),he(oa),B(ca),ae(!1);const na=It(gr(K.libraryId,Ce,Ye,ca,oa,fa));It(`${C.pathname}${C.search}`)!==na&&(_e.current=na,l(na))},[C.pathname,C.search,l]),ta=K=>{Ue({libraryId:p,target:"all_collections",collectionId:I,revisionId:ur.includes(K)?ue:void 0,revisionView:K})},De=i.useMemo(()=>[{key:"library",label:x.layers.library,visible:!0,value:p??"",selectedLabel:(Be==null?void 0:Be.name)??x.path.noLibrarySelected,disabled:O||V.length===0,options:V.map(K=>({value:K.libraryId,label:K.name})),emptyOption:x.noLibraryOption,onSelect:K=>{const Le=K||void 0;Ue({libraryId:Le,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:x.layers.target,visible:Q,value:t,selectedLabel:ee,disabled:!Q,options:si.map(K=>({value:K,label:D[K]})),onSelect:K=>{const Le=K;Ue({libraryId:p,target:Le,collectionId:I,revisionId:ue,revisionView:ge,infoId:Le==="new_card"?m.infoId:void 0})}},{key:"info_mode",label:x.layers.target,visible:t==="all_cards",value:h,selectedLabel:h==="new"?D.new_card:h==="selected"?a.cogita.library.list.selectedTitle:D.all_cards,disabled:!Q,options:[{value:"search",label:D.all_cards},{value:"new",label:D.new_card},{value:"selected",label:a.cogita.library.list.selectedTitle}],onSelect:K=>{var Le;if(K==="new"){Ue({libraryId:p,target:"new_card",collectionId:I,revisionId:ue,revisionView:ge,infoId:void 0});return}if(K==="selected"){const Ce=m.infoId??((Le=b[0])==null?void 0:Le.infoId);if(!Ce)return;Ue({libraryId:p,target:"new_card",collectionId:I,revisionId:ue,revisionView:ge,infoId:Ce});return}Ue({libraryId:p,target:"all_cards",collectionId:I,revisionId:ue,revisionView:ge,infoId:void 0})}},{key:"info_entry",label:a.cogita.library.list.selectedTitle,visible:t==="all_cards"&&h==="selected",value:m.infoId??"",selectedLabel:(T==null?void 0:T.label)??se??a.cogita.library.list.selectedEmpty,disabled:!Q||b.length===0,options:b.map(K=>({value:K.infoId,label:K.label})),emptyOption:a.cogita.library.list.selectedEmpty,onSelect:K=>{K&&Ue({libraryId:p,target:"new_card",collectionId:I,revisionId:ue,revisionView:ge,infoId:K})}},{key:"collection",label:x.layers.collection,visible:oe,value:I??"",selectedLabel:(qe==null?void 0:qe.name)??x.path.noCollectionSelected,disabled:!Q||le||q.length===0,options:q.map(K=>({value:K.collectionId,label:K.name})),emptyOption:x.selectCollectionOption,onSelect:K=>{Ue({libraryId:p,target:"all_collections",collectionId:K||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:x.layers.revision,visible:we,value:r,selectedLabel:te,disabled:!I,options:Y.map(K=>({value:K.value,label:K.label})),onSelect:K=>{ta(K)}},{key:"revision_entry",label:x.layers.revision,visible:aa,value:ue??"",selectedLabel:(j==null?void 0:j.name)??x.status.noRevisions,disabled:!de||Te||me.length===0,options:me.map(K=>({value:K.revisionId,label:K.name})),emptyOption:x.status.noRevisions,onSelect:K=>{Ue({libraryId:p,target:"all_collections",collectionId:I,revisionId:K||void 0,revisionView:ge})}}],[Y,q,le,h,b,V,O,Ue,me,Te,qe,I,T,j,ue,se,de,Q,Be,p,te,ge,$,r,t,ee,oe,we,aa,D,a.cogita.library.list.selectedTitle,a.cogita.library.list.selectedEmpty,m.infoId,x.layers.collection,x.layers.library,x.layers.revision,x.layers.target,x.noLibraryOption,x.path.noCollectionSelected,x.path.noLibrarySelected,x.selectCollectionOption]),We=i.useMemo(()=>De.filter(K=>K.visible),[De]),Ke=i.useMemo(()=>We.filter(K=>K.key!=="library"&&K.key!=="collection"&&K.key!=="revision_entry"&&K.key!=="info_entry"),[We]),Ze=i.useMemo(()=>Ke.filter(K=>K.key==="target"||K.key==="info_mode"),[Ke]),Ta=i.useMemo(()=>Ke.find(K=>K.key==="collection_action")??null,[Ke]),ra=i.useMemo(()=>{const K=m.libraryId;if(!K||!C.pathname.startsWith("/cogita/library/"))return null;const Le={copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,libraryId:K};if(m.target==="library_overview")return e.jsx(Yi,{...Le});if(m.target==="all_cards")return e.jsx(Zi,{...Le,mode:m.cardMode??"list"});if(m.target==="new_card")return e.jsx(nn,{...Le,editInfoId:m.infoId});if(m.target==="dependencies")return e.jsx(on,{...Le});if(m.target==="transfer")return e.jsx(cn,{...Le});if(m.target==="storyboards"||m.target==="new_storyboard")return e.jsx(dn,{...Le});if(m.target==="texts"||m.target==="new_text")return e.jsx(un,{...Le});if(m.target==="all_collections"){if(m.collectionId){const Ce={...Le,collectionId:m.collectionId};return m.revisionView==="graph"?e.jsx(Dn,{...Ce}):m.revisionView==="shared"?e.jsx(sn,{...Le,collectionId:m.collectionId}):m.revisionView==="settings"?e.jsx(jn,{...Ce,revisionId:m.revisionId}):m.revisionView==="run"?e.jsx(En,{...Ce,revisionId:m.revisionId}):e.jsx(gn,{...Ce})}return e.jsx(Dr,{...Le})}return m.target==="new_collection"?e.jsx(Dr,{...Le}):null},[n,a,M,C.pathname,l,F,w,P,u,g,m.cardMode,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,f,o]);i.useEffect(()=>{let K=!1;return(async()=>{var Ce,Ye,oa,ca,fa,na,ma;Me(!0);try{await Pi();const[xa,va,ze]=await Promise.all([Ur(),Ri(),$i()]);if(K)return;J(xa);const la=new Set(ze.nodes.filter(ua=>ua.nodeType==="role"&&ua.canLink).map(ua=>ua.roleId??"")),Ma=Vn(va,la);if(W(Ma),Ma){const ua=ze.nodes.find($a=>$a.nodeType==="data"&&$a.roleId===Ma&&($a.fieldType===cr||$a.label===cr));Ve((ua==null?void 0:ua.dataKeyId)??null),Ne.current=qn(ua==null?void 0:ua.value)}const Ba=Ne.current.lastLibraryId,ve=((Ce=xa.find(ua=>ua.libraryId===m.libraryId))==null?void 0:Ce.libraryId)??(xa.length===1?xa[0].libraryId:void 0)??((Ye=xa.find(ua=>ua.libraryId===Ba))==null?void 0:Ye.libraryId)??((oa=xa[0])==null?void 0:oa.libraryId),je=ve?(fa=(ca=Ne.current.byLibrary)==null?void 0:ca[ve])==null?void 0:fa.lastTarget:void 0,_a=On(je)?je:"library_overview";G(ve),ne(m.target??_a),he(m.revisionId??(ve?(ma=(na=Ne.current.byLibrary)==null?void 0:na[ve])==null?void 0:ma.lastRevisionId:void 0)),B(m.revisionView??"detail"),fe.current=!0}catch{K||$e(x.status.loadFailed)}finally{K||Me(!1)}})(),()=>{K=!0}},[x.status.loadFailed]),i.useLayoutEffect(()=>{fe.current&&(m.libraryId&&V.some(K=>K.libraryId===m.libraryId)&&G(m.libraryId),m.target&&ne(m.target),_(m.collectionId),he(m.revisionId),m.revisionView&&B(m.revisionView))},[V,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target]),i.useEffect(()=>{if(!p){s([]),_(void 0),y([]),E([]),he(void 0);return}let K=!1;return ie(!0),jt({libraryId:p,limit:200}).then(Le=>{var oa;if(K)return;const Ce=Le.items;s(Ce);const Ye=(oa=Ce.find(ca=>ca.collectionId===m.collectionId))==null?void 0:oa.collectionId;_(Ye)}).catch(()=>{K||(s([]),_(void 0))}).finally(()=>{K||ie(!1)}),()=>{K=!0}},[m.collectionId,p]),i.useEffect(()=>{if(!p||t!=="all_cards"&&$!=="new_card"){y([]);return}let K=!1;return jr({libraryId:p,limit:200}).then(Le=>{K||y(Le)}).catch(()=>{K||y([])}),()=>{K=!0}},[t,p,$]),i.useEffect(()=>{if(!p||!I){E([]),he(void 0);return}let K=!1;return Ae(!0),Wr({libraryId:p,collectionId:I}).then(Le=>{var oa,ca,fa,na;if(K)return;E(Le);const Ce=(ca=(oa=Ne.current.byLibrary)==null?void 0:oa[p])==null?void 0:ca.lastRevisionId,Ye=((fa=Le.find(ma=>ma.revisionId===m.revisionId))==null?void 0:fa.revisionId)??((na=Le.find(ma=>ma.revisionId===Ce))==null?void 0:na.revisionId);he(Ye)}).catch(()=>{K||(E([]),he(void 0))}).finally(()=>{K||Ae(!1)}),()=>{K=!0}},[m.revisionId,I,p]),i.useEffect(()=>{const K=m.infoId;if(!p||!K){d(void 0);return}let Le=!1;return at({libraryId:p,infoId:K}).then(Ce=>{if(Le)return;const Ye=Ce.payload;d((Ye==null?void 0:Ye.label)??(Ye==null?void 0:Ye.name)??(Ye==null?void 0:Ye.title)??Ce.infoId)}).catch(()=>{Le||d(K)}),()=>{Le=!0}},[m.infoId,p]),i.useEffect(()=>{if(!fe.current||m.libraryId&&V.some(Ce=>Ce.libraryId===m.libraryId)&&m.libraryId!==p||m.target&&m.target!==$||m.revisionView&&m.revisionView!==ge||m.revisionId&&m.revisionId!==ue||dr[$].requiresCollection&&!I&&m.target==="all_collections"&&m.collectionId)return;const K=It(`${C.pathname}${C.search}`),Le=It(gr(p,$,I,ge,ue,m.infoId));if(K===Le){_e.current=null;return}_e.current!==Le&&(_e.current=Le,l(Le,{replace:!0}))},[V,C.pathname,C.search,l,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,I,p,ue,ge,$]),i.useEffect(()=>{if(typeof window>"u")return;const K=()=>{window.innerWidth>920&&ae(!1)};return window.addEventListener("resize",K),()=>window.removeEventListener("resize",K)},[]),i.useEffect(()=>{if(!fe.current||!Re||!p||Ee.current)return;const K=Ne.current,Le={...K.byLibrary??{}},Ce={...Le[p]??{},lastCollectionId:I,lastRevisionId:ue,lastRevisionView:ge,lastTarget:$},Ye={version:1,lastLibraryId:p,byLibrary:{...Le,[p]:Ce}},oa=JSON.stringify(K),ca=JSON.stringify(Ye);if(oa===ca)return;Ne.current=Ye,Ee.current=!0,(async()=>{try{if(Z)await Ei(Z,{plainValue:ca});else{const na=await Ai(Re,{itemName:cr,itemType:"data",plainValue:ca});Ve(na.dataItemId)}}catch{$e(x.status.savePrefsFailed)}finally{Ee.current=!1}})()},[Z,Re,I,p,ue,ge,$,x.status.savePrefsFailed]);const Ra=async()=>{const K=Se.trim();if(!K){$e(a.cogita.user.libraryNameRequired);return}$e(null);try{const Le=await Di({name:K});J(Ce=>[Le,...Ce]),G(Le.libraryId),ne("library_overview"),_(void 0),Ge("")}catch{$e(a.cogita.user.libraryCreateFailed)}},sa=async()=>{if(!p){$e(x.status.selectLibraryFirst);return}const K=Oe.trim();if(!K){$e(a.cogita.library.collections.saveRequiredName);return}$e(null);try{const Le=await Fi({libraryId:p,name:K,items:[]}),Ce=await jt({libraryId:p,limit:200});s(Ce.items),_(Le.collectionId),he(void 0),ne("all_collections"),B("detail"),Fe("")}catch{$e(a.cogita.library.collections.saveFail)}},ya=async()=>{if(!p||!I){$e(x.status.selectLibraryFirst);return}const K=Je.trim();if(!K){$e(x.revisionForm.nameLabel);return}$e(null);try{const Le=await Bi({libraryId:p,collectionId:I,name:K,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});E(Ce=>[Le,...Ce]),he(Le.revisionId),ne("all_collections"),B("settings"),ia("")}catch{$e(x.status.loadFailed)}};return e.jsx(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${re?"open":""}`,"aria-label":x.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Be==null?void 0:Be.name)??x.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Be?x.sidebar.libraryActionsHint:x.status.selectLibraryFirst}),Ze.length>0?e.jsx("div",{className:"cogita-sidebar-actions",children:Ze.map(K=>K.options.map(Le=>e.jsx("button",{type:"button",className:`ghost ${String(K.value)===Le.value?"active":""}`,onClick:()=>K.onSelect(Le.value),disabled:K.disabled,children:Le.label},`sidebar:${K.key}:${Le.value}`)))}):null]}),qe?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:qe.name}),e.jsx("p",{className:"cogita-sidebar-note",children:x.sidebar.collectionActionsHint}),Ta?e.jsx("div",{className:"cogita-sidebar-actions",children:Ta.options.map(K=>e.jsx("button",{type:"button",className:`ghost ${String(Ta.value)===K.value?"active":""}`,onClick:()=>Ta.onSelect(K.value),disabled:Ta.disabled,children:K.label},`sidebar:revision:${K.value}`))}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:x.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:u,children:x.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{P("cogita"),ae(!1)},children:x.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:f?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),re?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":x.sidebar.closeMenu,onClick:()=>ae(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":x.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>ae(K=>!K),"aria-label":re?x.sidebar.closeMenu:x.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),We.map((K,Le)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Le>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,K.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":K.label,children:K.selectedLabel}):e.jsxs("select",{"aria-label":K.label,value:K.value,onChange:Ce=>K.onSelect(Ce.target.value),disabled:K.disabled,children:[K.emptyOption?e.jsx("option",{value:"",children:K.emptyOption}):null,K.options.map(Ce=>e.jsx("option",{value:Ce.value,children:Ce.label},`${K.key}:${Ce.value}`))]})]},`menu:${K.key}`))]}),ra?e.jsxs(e.Fragment,{children:[$==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Oe,onChange:K=>Fe(K.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!p})]}),e.jsx("button",{type:"button",className:"cta",onClick:sa,disabled:!p,children:a.cogita.library.actions.createCollection}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,$==="all_collections"&&I&&ge==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:Je,onChange:K=>ia(K.target.value),placeholder:x.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,children:x.revisionForm.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Yr.Provider,{value:!0,children:ra})})]}):null,ra?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[We.map((K,Le)=>e.jsxs("span",{children:[Le>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:K.selectedLabel})]},`path:${K.key}`)),oe?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:x.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[x.path.currentRoute," ",e.jsx("code",{children:gr(p,$,I,ge,ue,m.infoId)})]}),p?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${p}`,children:x.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${p}/list`,children:x.links.allCards}),I?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${p}/collections/${I}/shared-revisions`,children:x.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Se,onChange:K=>Ge(K.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ra,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Oe,onChange:K=>Fe(K.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!p})]}),e.jsx("button",{type:"button",className:"cta",onClick:sa,disabled:!p,children:a.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:Je,onChange:K=>ia(K.target.value),placeholder:x.revisionForm.namePlaceholder,disabled:!I})]}),e.jsx("button",{type:"button",className:"cta",onClick:ya,disabled:!I,children:x.revisionForm.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:x.panels.collections}),le?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.loadingCollections}):null,!le&&q.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.noCollections}):null,q.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:q.map(K=>e.jsxs("button",{type:"button",className:`cogita-card-item ${K.collectionId===I?"active":""}`,onClick:()=>{_(K.collectionId),he(void 0),B("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:x.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:K.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[K.itemCount," ",x.cards.itemsSuffix]})]},K.collectionId))}):null]})]})]})]})})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:_n},Symbol.toStringTag,{value:"Module"}));function Un({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,shareId:l}){const[C,m]=i.useState(null),[x,V]=i.useState("loading"),[J,q]=i.useState(a.cogita.library.collections.defaultName),[s,b]=i.useState("Cogita Library"),[y,me]=i.useState([]),[E,p]=i.useState([]),[G,$]=i.useState("idle"),[ne,I]=i.useState({current:0,total:0}),[_,ue]=i.useState(0),[he,ge]=i.useState(""),[B,se]=i.useState(null),[d,re]=i.useState(null),[ae,O]=i.useState(null),[Me,le]=i.useState(null),[ie,Te]=i.useState([]),[Ae,ke]=i.useState({}),[$e,Se]=i.useState({}),[Ge,Oe]=i.useState(null),[Fe,Je]=i.useState(null),[ia,Re]=i.useState(null),[W,Z]=i.useState(null),[Ve,Ne]=i.useState({}),fe=i.useRef(0),[Ee,_e]=i.useState(null),Be=i.useRef(null),qe=i.useRef(null),[j,k]=i.useState(null),[Y,t]=i.useState(!1),[r,h]=i.useState(null),[T,D]=i.useState([]),[ee,te]=i.useState(null),Q=i.useRef(null),de=i.useRef(null),[oe,we]=i.useState(null),[aa,Ue]=i.useState(0),ta=i.useRef(null),De=i.useRef({}),[We,Ke]=i.useState(!1),[Ze,Ta]=i.useState({}),ra=i.useRef(null),Ra=i.useRef(new Set),sa=i.useRef({}),[ya,K]=i.useState([]),[Le,Ce]=i.useState(new Set),[Ye,oa]=i.useState(!1),ca=vr(),fa=i.useMemo(()=>new URLSearchParams(ca.search),[ca.search]),na=i.useMemo(()=>fa.get("key")??"",[fa]),ma=(C==null?void 0:C.mode)??"random",xa=(C==null?void 0:C.check)??"exact",va=(C==null?void 0:C.limit)??20,ze=i.useMemo(()=>Lr((C==null?void 0:C.revisionType)??ma),[C,ma]),la=i.useMemo(()=>{const R=C==null?void 0:C.revisionSettings,X=ai(ze,fa);return Jt(ze,R??X)},[C,fa,ze]),Ma=i.useMemo(()=>a.cogita.library.revision[ze.labelKey]??ma,[a,ma,ze]),Ba=i.useMemo(()=>xa==="exact"?a.cogita.library.revision.checkValue:xa,[a,xa]),je=x==="ready"?y[_]??null:null,_a=(je==null?void 0:je.checkType)==="translation-match"&&W,ua=i.useRef(new Map),$a=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useRef(new Map),Yt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?ea(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),rt=i.useMemo(()=>{var X;return ze.id!=="levels"?y.length:((X=Ze.pool)==null?void 0:X.length)??ze.getFetchLimit(va,la)},[Ze,la,ze,y.length,va]),it=ze.getProgressTotal?ze.getProgressTotal(y,Ze,va,la):ze.id==="levels"?Math.min(va,rt):y.length,Ea=it?Math.min(_+1,it):0,Na=Math.max(1,Number(la.tries??1)),Ua=la.compare??"anchors",pa=Math.max(0,Math.min(100,Number(la.minCorrectness??0))),da=(la.considerDependencies??"on")==="on",Pa=Math.max(0,Math.min(100,Number(la.dependencyThreshold??85))),Ha=R=>{const X=R.slice();for(let c=X.length-1;c>0;c-=1){const v=Math.floor(Math.random()*(c+1));[X[c],X[v]]=[X[v],X[c]]}return X},Wa=R=>R.length?R.reduce((c,v)=>c+v,0)/R.length/255*100:0,nt=R=>Wa(R)>=pa,Qt=async()=>{const R=await Va(),X=new Map,c=new Map;R.forEach(N=>{const H=`${N.itemType}:${N.itemId}`,L=Ka(N.itemType,N.itemId,N.checkType,N.direction);X.has(H)||X.set(H,[]),X.get(H).push(N),c.has(L)||c.set(L,[]),c.get(L).push(N)});const v=new Map,S=new Map;return X.forEach((N,H)=>v.set(H,Oa(N).score)),c.forEach((N,H)=>S.set(H,Oa(N).score)),{itemKnowness:v,cardKnowness:S}},ft=async R=>{const X=Ze,c=R.concat(X.active??[]).concat(X.pool??[]).filter((z,ce,be)=>be.findIndex(ye=>pe(ye)===pe(z))===ce);if(!da){Ce(new Set(c.map(pe)));return}const{itemKnowness:v,cardKnowness:S}=await Qt(),N=z=>{if(z.cardType!=="info"||z.infoType!=="quote"||z.checkType!=="quote-fragment")return!0;const ce=La(z.direction);if(!(ce!=null&&ce.fragmentId))return!0;const be=z.description??"";if(!be.trim())return!0;const xe=bt(be).nodes[ce.fragmentId];if(!xe||!xe.leftId&&!xe.rightId)return!0;const Ie=[xe.leftId,xe.rightId].filter(Xe=>!!Xe);if(Ie.length===0)return!0;const Pe=Ie.map(Xe=>{const ha=Ka("info",z.cardId,"quote-fragment",kt(ce.mode,Xe));return S.get(ha)??0});return Pe.reduce((Xe,ha)=>Xe+ha,0)/Pe.length>=Pa},H=(C==null?void 0:C.collectionId)??null,L=H?ya.filter(z=>ba(z.childItemType)==="collection"&&z.childItemId===H&&!ba(z.childCheckType)&&!ba(z.childDirection)):[],U=H&&c.length>0?c.reduce((z,ce)=>z+(S.get(pe(ce))??0),0)/c.length:0,A=new Set;for(const z of c){if(z.cardType!=="info"){A.add(pe(z));continue}if(!N(z))continue;const ce=ya.filter(xe=>oi(xe,z)).concat(L);if(ce.length===0){A.add(pe(z));continue}let be=0;for(const xe of ce)if(ba(xe.parentItemType)==="collection")be+=xe.parentItemId===H?U:0;else if(ba(xe.parentCheckType)||ba(xe.parentDirection)){const Ie=ba(xe.parentCheckType),Pe=ba(xe.parentDirection),Qe=Ka(xe.parentItemType,xe.parentItemId,Ie,Pe);be+=S.get(Qe)??0}else{const Ie=`${xe.parentItemType}:${xe.parentItemId}`;be+=v.get(Ie)??0}be/ce.length>=Pa&&A.add(pe(z))}Ce(A)},Gt=R=>{for(let X=R;X<y.length;X+=1){const c=y[X];if(c&&(!da||c.cardType!=="info"||Le.has(pe(c))))return X}return-1},lt=R=>!da||R.cardType!=="info"||Le.has(pe(R)),Xt=R=>{if(ze.id!=="temporal"&&ze.id!=="levels")return null;const X=Ze,c=(X.active??[]).concat(X.pool??[]),v=new Set;for(const S of c){const N=pe(S);if(!(v.has(N)||R.has(N))&&(v.add(N),lt(S)))return S}return null},Sa=i.useMemo(()=>{if(ze.id!=="levels")return null;const R=Ze,X=R.pool??[],c=R.active??[],v=R.levelMap??{},S=Math.max(1,Number(la.levels??1)),N=Array.from({length:S},()=>0),H=new Set(c.map(z=>pe(z)));X.forEach(z=>{const ce=Math.min(S,Math.max(1,v[pe(z)]??1));N[ce-1]+=1});const L=X.length||1,U=N.map(z=>z/L*100),A=je?v[pe(je)]??1:null;return{counts:N,percentages:U,currentLevel:A,levelsCount:S,activeCount:c.length,poolCount:X.length,activeSet:H}},[Ze,la,ze,je]),ot=i.useMemo(()=>{if(ze.id!=="temporal")return null;const R=Ze,X=R.pool??[],c=R.active??[],v=R.knownessMap??{},S=new Set(R.unknownSet??[]);let N=0;X.forEach(U=>{(v[pe(U)]??0)>1&&(N+=1)});const H=S.size,L=c.map(U=>({id:pe(U),value:S.has(pe(U))?0:Math.max(0,Math.min(1,v[pe(U)]??0))}));return{knownCount:N,unknownCount:H,dots:L}},[Ze,ze]),Aa=i.useMemo(()=>{if(!da)return 0;const R=Ze;return y.concat(R.active??[]).concat(R.pool??[]).filter((c,v,S)=>S.findIndex(N=>pe(N)===pe(c))===v).filter(c=>c.cardType==="info"&&!Le.has(pe(c))).length},[da,Ze,y,Le]);i.useEffect(()=>{if(!da||G!=="ready")return;const R=Ze,c=y.concat(R.active??[]).concat(R.pool??[]).filter((N,H,L)=>L.findIndex(U=>pe(U)===pe(N))===H).filter(N=>N.cardType!=="info"||Le.has(pe(N))).length,v=Q.current;if(Q.current=c,v===null||c<=v)return;const S=c-v;te(`New card available (+${S})`),de.current&&window.clearTimeout(de.current),de.current=window.setTimeout(()=>te(null),2200)},[da,G,Ze,y,Le]),i.useEffect(()=>()=>{de.current&&window.clearTimeout(de.current)},[]);const ja=(R,X)=>{const c=ze.applyOutcome({queue:y,meta:Ze},je,va,la,{correct:R,correctness:X,createdUtc:new Date().toISOString()});me(c.queue),Ta(c.meta);const v=c.queue[_+1];v&&Ia(v,_+1)};i.useEffect(()=>{if(!l){V("error");return}V("loading"),Ki({shareId:l,key:na}).then(R=>{m(R),q(R.collectionName),b(R.libraryName),V("ready")}).catch(()=>{V("error")})},[l,na]),i.useEffect(()=>{l&&Oi({shareId:l,key:na,type:"language"}).then(R=>p(R)).catch(()=>p([]))},[l,na]),i.useEffect(()=>{!l||x!=="ready"||Vi({shareId:l,key:na}).then(R=>K(R.items??[])).catch(()=>K([]))},[l,na,x]),i.useEffect(()=>{if(!l||x!=="ready")return;let R=!0;return(async()=>{$("loading"),I({current:0,total:ze.id==="levels"?0:ze.getFetchLimit(va,la)});try{const c=[];let v=null,S=null;do{const ce=await qi({shareId:l,key:na,limit:300,cursor:v});if(c.push(...ce.items),(ze.id==="levels"||ze.id==="temporal")&&ce.total&&(S=ce.total),I(be=>({current:c.length,total:be.total||ce.total||ze.getFetchLimit(va,la)})),v=ce.nextCursor??null,S!==null&&c.length>=S||ze.id!=="levels"&&ze.id!=="temporal"&&c.length>=ze.getFetchLimit(va,la))break}while(v);if(!R)return;const N=pr(c);let H;if(ze.id==="levels"){const ce=Math.max(1,Number(la.levels??1));H={},N.forEach(be=>{const ye=pe(be);H[ye]=Math.max(1,Math.min(ce,1))})}let L=null,U=null,A=null;if(ze.id==="temporal"){const ce=await Va(),be=new Set(N.map(Ie=>pe(Ie))),ye=ce.reduce((Ie,Pe)=>{const Qe=Ka(Pe.itemType,Pe.itemId,Pe.checkType,Pe.direction);return be.has(Qe)&&(Ie[Qe]||(Ie[Qe]=[]),Ie[Qe].push(Pe)),Ie},{});L={},U=new Set,A={};const xe=Date.now();N.forEach(Ie=>{const Pe=pe(Ie),Qe=ye[Pe]??[];if(Qe.length===0){L[Pe]=0,U.add(Pe),A[Pe]=[];return}const Xe=kr(Qe);A[Pe]=Xe;const ha=zt(Xe,xe);L[Pe]=ha.knowness})}const z=ze.id==="levels"?Nr(N,va,la,H):ze.id==="temporal"?Tr(N,va,la,L??{},U??new Set,A??{}):ze.prepare(N,va,la);me(z.queue),Ta(z.meta),ue(0),$("ready"),I(ce=>({current:Math.min(ce.current,ce.total),total:ce.total}))}catch{R&&$("error")}})(),()=>{R=!1}},[l,na,va,ze,la,x]),i.useEffect(()=>{ft(y)},[y,ya,da,Pa,C==null?void 0:C.collectionId]),i.useEffect(()=>{if(!je||!da){oa(!1);return}if(je.cardType!=="info"||Le.has(pe(je))){oa(!1);return}const R=Gt(_+1);if(R>=0){oa(!1),ue(R);return}if(ze.id==="temporal"||ze.id==="levels"){const X=y.slice(0,_+1),c=y.slice(_+1).filter(lt),v=X.concat(c),S=new Set(v.map(pe)),N=Xt(S);if(N){const L=pe(N);S.has(L)||(v.push(N),S.add(L),Ta(U=>{const A=U,z=new Set(A.queued??[]);return z.add(L),{...A,queued:z}}))}const H=v.findIndex((L,U)=>U!==_&&lt(L));if(H>=0){me(v),ue(H),oa(!1);return}}oa(!0)},[je,Le,da,_,y,Ze,ze.id]),i.useEffect(()=>{if(ge(""),se(null),we(null),Ue(0),Te([]),ke({}),Se({}),Oe(null),Je(null),Re(null),t(!1),Ke(!1),k(null),Z(null),Ne({}),!je){re(null),O(null);return}je.cardType==="info"&&je.infoType==="computed"&&re(a.cogita.library.revision.loadingComputed);let R=!0;return Ia(je,_).then(X=>{!R||!X||(re(X.prompt),O(X.expectedAnswer),Te(X.computedExpected),ke(X.computedAnswers),Oe(X.answerTemplate),Je(X.outputVariables),Re(X.variableValues))}),()=>{R=!1}},[je,l,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){ra.current=null,Ra.current=new Set,le(null);return}const R=je.description??"",X=(je.label??"").trim(),c=X.replace(/\s+/g," ").trim(),v=R.replace(/\s+/g," ").trim(),S=c&&c!==v?X:a.cogita.library.infoTypes.quote;if(!R){le(null),O(null);return}const N=bt(R);ra.current=N,re(S);let H=!0;return Va().then(L=>{if(!H)return;const U=getQuoteMode(je.direction),A=new Map;L.forEach(xe=>{if(xe.itemType!=="info"||xe.checkType!=="quote-fragment"||!xe.direction)return;const Ie=La(xe.direction);if(!Ie||Ie.mode!==U)return;const Pe=`${xe.itemId}:${Ie.fragmentId}`;A.has(Pe)||A.set(Pe,[]),A.get(Pe).push(xe)});const z={},ce=new Set;A.forEach((xe,Ie)=>{const[Pe,Qe]=Ie.split(":",2);if(Pe!==je.cardId)return;const Xe=Oa(xe).score;z[Qe]=Xe,Xe>=Pa&&ce.add(Qe)}),Ra.current=ce,sa.current=z;const be=La(je.direction);if(be!=null&&be.fragmentId&&N.nodes[be.fragmentId]){Qa(N,be.fragmentId,S);return}const ye=gt(N,ce,z,Pa,da,je.direction);Qa(N,(ye==null?void 0:ye.id)??null,S)}).catch(()=>{Ra.current=new Set,sa.current={};const L=La(je.direction);if(L!=null&&L.fragmentId&&N.nodes[L.fragmentId]){Qa(N,L.fragmentId,S);return}const U=gt(N,Ra.current,{},Pa,da,je.direction);Qa(N,(U==null?void 0:U.id)??null,S)}),()=>{H=!1}},[je,a,da,Pa]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){Z(null),Ne({});return}const c=(Ze.pool??Ze.active??y).filter(L=>L.cardType==="vocab"&&L.checkType==="translation-match").filter((L,U,A)=>A.findIndex(z=>z.cardId===L.cardId)===U);c.some(L=>L.cardId===je.cardId)||c.unshift(je);const S=Ha(c).slice(0,6).map(L=>{const U=L.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(U.length<2)return null;const A=`${L.cardId}:L`,z=`${L.cardId}:R`;return{cardId:L.cardId,leftId:A,rightId:z,leftLabel:U[0],rightLabel:U[1]}}).filter(Boolean),N=S.map(L=>L.leftId),H=Ha(S.map(L=>L.rightId));Z({pairs:S,leftOrder:N,rightOrder:H,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,y,Ze]),i.useEffect(()=>()=>{Be.current&&window.clearTimeout(Be.current),qe.current&&window.clearTimeout(qe.current)},[]);const st=i.useRef(null);i.useEffect(()=>{if(!je)return;const R=pe(je),X=typeof document<"u"?document.activeElement:null;if(st.current===R&&X&&(X.tagName==="INPUT"||X.tagName==="TEXTAREA"))return;let c=0;const v=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(ie.length>0){const N=Ut(Ge,ie,Fe),H=N?De.current[N]:null;if(H&&(H.focus(),document.activeElement===H)){st.current=R;return}}if(ta.current&&(ta.current.focus(),document.activeElement===ta.current)){st.current=R;return}}else if(je.cardType==="vocab"&&ta.current&&(ta.current.focus(),document.activeElement===ta.current)){st.current=R;return}c<6&&(c+=1,window.setTimeout(v,40))}},S=window.setTimeout(v,40);return()=>window.clearTimeout(S)},[je,ie,Ge,Fe]),i.useEffect(()=>{if(!We)return;const R=X=>{X.key==="Enter"&&(X.preventDefault(),ct())};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[We]);const wa=R=>{D(R),h(Oa(R))};i.useEffect(()=>{if(!je){h(null),D([]);return}const R=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Va().then(X=>{const c=X.filter(v=>v.itemType==="info"&&v.itemId===je.cardId&&v.checkType==="quote-fragment"&&qt(v.direction,je.direction));wa(c)}).catch(()=>{h(null),D([])});return}Ot(R,je.cardId,je.checkType,je.direction).then(X=>wa(X)).catch(()=>{h(null),D([])})},[je]);const Ja=(R,X,c,v)=>{if(R==="info"&&c==="quote-fragment"){Va().then(S=>{const N=S.filter(H=>H.itemType==="info"&&H.itemId===X&&H.checkType==="quote-fragment"&&qt(H.direction,v));wa(N)}).catch(()=>{h(null),D([])});return}Ot(R,X,c,v).then(S=>wa(S)).catch(()=>{h(null),D([])})},Ya=(R,X,c)=>{var H;const v=((H=c.pairs.find(L=>L.leftId===R))==null?void 0:H.rightId)??null;if(!v)return c;const S=v===X;Ne(L=>({...L,[R]:S?"correct":"incorrect"})),Be.current&&window.clearTimeout(Be.current),qe.current&&window.clearTimeout(qe.current),fe.current+=1;const N={kind:S?"correct":"incorrect",tick:fe.current};if(_e(null),Be.current=window.setTimeout(()=>_e(N),0),qe.current=window.setTimeout(()=>_e(null),420),S){const L={...c.locked,[R]:!0};return Object.keys(L).length>=c.pairs.length?(se("correct"),Ke(!0)):se("correct"),{...c,selection:{...c.selection,[R]:X},activeLeft:null,activeRight:null,locked:L}}return se("incorrect"),{...c,activeLeft:null,activeRight:null}},Nt=R=>{Z(X=>!X||X.locked[R]?X:X.activeRight?Ya(R,X.activeRight,X):{...X,activeLeft:X.activeLeft===R?null:R})},Lt=R=>{Z(X=>X&&(X.activeLeft?Ya(X.activeLeft,R,X):{...X,activeRight:X.activeRight===R?null:R}))},ct=()=>{var R;if(je&&je.cardType==="info"&&je.infoType==="quote"&&ra.current&&Me&&!((R=La(je.direction))!=null&&R.fragmentId)){const X=gt(ra.current,Ra.current,sa.current,Pa,da,je.direction,Me.fragmentId);if(X){se(null),ge(""),t(!1),Se({}),Ke(!1),we(null),Ue(0),Qa(ra.current,X.id,Me.title);return}}se(null),ge(""),t(!1),Se({}),Ke(!1),we(null),Ue(0),ue(X=>Math.min(X+1,y.length))},Fa=R=>{if(!je)return;const X=R.expected??null,c=R.answer??"";let v=X??"",S=c;if(!X&&R.expectedMap&&R.answerMap){const ce=Object.keys(R.expectedMap).sort((be,ye)=>be.localeCompare(ye));v=ce.map(be=>{var ye;return((ye=R.expectedMap)==null?void 0:ye[be])??""}).join("|"),S=ce.map(be=>{var ye;return((ye=R.answerMap)==null?void 0:ye[be])??""}).join("|")}const N=v?ht(v,S,Ua):new Uint8Array,H={revisionType:ze.id,evalType:R.evalType,direction:R.direction,prompt:d??"",expected:X,answer:c,expectedAnswers:R.expectedMap??null,answers:R.answerMap??null,correct:R.correct,maskBase64:N.length?za(N):null,checkMode:xa,compareMode:Ua,minCorrectness:pa},L=new TextEncoder().encode(JSON.stringify(H)),U=je.cardType==="info"?"info":"connection",A=R.overrideCheckType??je.checkType??null,z=R.overrideDirection??je.direction??null;Kt({itemType:U,itemId:je.cardId,checkType:A,direction:z,revisionType:ze.id,evalType:R.evalType,correct:R.correct,maskBase64:N.length?za(N):null,payloadBase64:za(L)}).then(()=>{Ja(U,je.cardId,A,z),ft(y)}).catch(()=>{})},dt=(R,X)=>{const c=ua.current.get(X);if(c)return Promise.resolve(c);const v=$a.current.get(X);if(v)return v;const S=_i({shareCode:l,infoId:R,key:na}).then(N=>{var ce,be;const H=N.payload,L=((ce=H.definition)==null?void 0:ce.graph)??null,U="",A=((be=H.definition)==null?void 0:be.answerTemplate)??"",z=wr(L,U,A);if(z){const xe={sample:Gr(z),answerTemplate:A||null};return ua.current.set(X,xe),xe}return Sr({shareId:l,infoId:R,key:na}).then(ye=>{const xe={sample:ye,answerTemplate:null};return ua.current.set(X,xe),xe})}).catch(()=>Sr({shareId:l,infoId:R,key:na}).then(N=>{const H={sample:N,answerTemplate:null};return ua.current.set(X,H),H}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{$a.current.delete(X)});return $a.current.set(X,S),S},Ia=(R,X)=>{var L;const c=`${pe(R)}:${X}`,v=tt.current.get(c);if(v)return Promise.resolve(v);const S=pt.current.get(c);if(S)return S;const N=U=>(tt.current.set(c,U),U);let H;if(R.cardType==="vocab"){if(R.checkType==="translation-match")return H=Promise.resolve(N({prompt:R.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),H;const U=R.label.split("↔").map(A=>A.trim()).filter(Boolean);if(U.length>=2){const z=(R.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ce=z?U[0]:U[1],be=z?U[1]:U[0];H=Promise.resolve(N({prompt:ce,expectedAnswer:be,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else H=Promise.resolve(N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(R.cardType==="info"&&R.infoType==="word"){const U=(L=R.description)!=null&&L.startsWith("Language: ")?R.description.replace("Language: ",""):null;H=Promise.resolve(N({prompt:R.label,expectedAnswer:U,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else R.cardType==="info"&&R.infoType==="computed"?H=dt(R.cardId,c).then(U=>{var ye,xe;if(!U.sample)return N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const A=U.sample,z=A.expectedAnswers?Object.entries(A.expectedAnswers).map(([Ie,Pe])=>({key:Ie,expected:Pe})):[],ce=z.reduce((Ie,Pe)=>(Ie[Pe.key]="",Ie),{}),be=A.expectedAnswerIsSentence&&((ye=A.expectedAnswer)==null?void 0:ye.trim())||null;return N({prompt:A.prompt,expectedAnswer:z.length>0?be:((xe=A.expectedAnswer)==null?void 0:xe.trim())||null,computedExpected:z,computedAnswers:ce,answerTemplate:U.answerTemplate,outputVariables:A.outputVariables??null,variableValues:A.variableValues??null})}).catch(()=>N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{pt.current.delete(c)}):H=Promise.resolve(N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return pt.current.set(c,H),H},Qa=(R,X,c)=>{const v=Object.keys(R.nodes).length,S=Ra.current.size;if(!X){le({title:c,before:R.text,after:"",fragmentId:null,total:v,completed:S}),O(null),Ke(!0);return}const N=R.nodes[X];if(!N)return;const H=Xr(R.text,N);le({title:c,before:H.before,after:H.after,fragmentId:N.id,total:v,completed:S}),O(H.fragment),Ke(!1)},xt=()=>{const R=ra.current;R&&le(X=>X&&{...X,total:Object.keys(R.nodes).length,completed:Ra.current.size})},Da=()=>{const R=y[_+1];R&&Ia(R,_+1)},Ct=()=>{if(Da(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&W){if(W.pairs.length===0){se("incorrect"),Ke(!0);return}const N=W.pairs.reduce((be,ye)=>(be[ye.rightId]=ye.rightLabel,be),{});let H=0;const L={};W.pairs.forEach(be=>{const xe=W.selection[be.leftId]===be.rightId;L[be.leftId]=xe?"correct":"incorrect",xe&&(H+=1)});const U=W.pairs.length||1,A=H/U,z=H===W.pairs.length;Ne(be=>({...be,...L})),z?(se("correct"),Ke(!0),Ue(0)):(se("incorrect"),Ke(!1),Ue(be=>{const ye=be+1;return ye>=Na&&(t(!0),Ke(!0),Z(xe=>{if(!xe)return xe;const Ie=xe.pairs.reduce((Pe,Qe)=>(Pe[Qe.leftId]=Qe.rightId,Pe),{});return{...xe,selection:Ie}})),ye})),ja(z,A);const ce="connection";Promise.all(W.pairs.map(be=>{const ye=W.selection[be.leftId]??null,xe=ye?N[ye]:"",Ie={left:be.leftLabel,expected:be.rightLabel,answer:xe,checkType:"translation-match"},Pe=new TextEncoder().encode(JSON.stringify(Ie));return Kt({itemType:ce,itemId:be.cardId,checkType:"translation-match",direction:null,revisionType:ze.id,evalType:"translation-match",correct:ye===be.rightId,maskBase64:null,payloadBase64:za(Pe)})})).then(()=>{Ja(ce,je.cardId,je.checkType,je.direction),ft(y)}).catch(()=>{});return}if(ie.length>0){const N=ie.reduce((L,U)=>{const A=Ae[U.key]??"";return L[U.key]=ka(A)===ka(U.expected)?"correct":"incorrect",L},{});ie.every(({key:L,expected:U})=>{const A=Ae[L]??"";return xa==="exact"&&ka(A)===ka(U)})?(se("correct"),Se(N),Ke(!0),Ue(0),ja(!0,1),Fa({correct:!0,direction:d?`${d} -> computed`:"computed",expectedMap:ie.reduce((L,U)=>(L[U.key]=U.expected,L),{}),answerMap:Ae,evalType:"computed"})):(se("incorrect"),Se(N),Ke(!1),Ue(L=>{const U=L+1;return U>=Na&&Ga&&(t(!0),Ke(!0)),U}),ja(!1,0),window.setTimeout(()=>{var U;const L=Ut(Ge,ie,Fe);L&&De.current[L]&&((U=De.current[L])==null||U.focus())},40),Fa({correct:!1,direction:d?`${d} -> computed`:"computed",expectedMap:ie.reduce((L,U)=>(L[U.key]=U.expected,L),{}),answerMap:Ae,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Me!=null&&Me.fragmentId)){if(!ae)return;const N=La(je.direction),H=(N==null?void 0:N.mode)??getQuoteMode(je.direction),L=N!=null&&N.fragmentId&&je.direction?je.direction:kt(H,Me.fragmentId),U=li(ae,he,Ua),A=xa==="exact"&&mt(he)===mt(ae),z=nt(U),ce=A||z,be=Wa(U);ce?(sa.current[Me.fragmentId]=Math.max(sa.current[Me.fragmentId]??0,be),(sa.current[Me.fragmentId]??0)>=Pa&&Ra.current.add(Me.fragmentId),xt(),se("correct"),Se({}),Ke(!0),we(U),Ue(0),be<100&&Na<=1&&t(!0),ja(!0,be/100),Fa({correct:!0,direction:`quote:${Me.fragmentId}`,expected:ae,answer:he,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L})):(se("incorrect"),Se({}),Ke(!1),we(U),Ue(ye=>{const xe=ye+1;return xe>=Na&&Ga&&(t(!0),Ke(!0)),xe}),ja(!1,be/100),window.setTimeout(()=>{var ye;return(ye=ta.current)==null?void 0:ye.focus()},40),Fa({correct:!1,direction:`quote:${Me.fragmentId}`,expected:ae,answer:he,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L}));return}if(!ae)return;const R=ht(ae,he,Ua),X=xa==="exact"&&ka(he)===ka(ae),c=nt(R),v=X||c,S=Wa(R);v?(se("correct"),Se({}),Ke(!0),we(R),Ue(0),S<100&&Na<=1&&t(!0),ja(!0,S/100),Fa({correct:!0,direction:d?`${d} -> ${ae}`:null,expected:ae,answer:he,evalType:"text"})):(se("incorrect"),Se({}),Ke(!1),we(R),Ue(N=>{const H=N+1;return H>=Na&&Ga&&(t(!0),Ke(!0)),H}),ja(!1,S/100),window.setTimeout(()=>{var N;return(N=ta.current)==null?void 0:N.focus()},40),Fa({correct:!1,direction:d?`${d} -> ${ae}`:null,expected:ae,answer:he,evalType:"text"}))},ut=R=>{if(Da(),!ae)return;const X=ht(ae,R,Ua),c=ka(R)===ka(ae),v=nt(X),S=c||v,N=Wa(X);S?(se("correct"),Se({}),Ke(!0),we(X),Ue(0),N<100&&Na<=1&&t(!0),ja(!0,N/100),Fa({correct:!0,direction:"word->language",expected:ae,answer:R,evalType:"language-select"})):(se("incorrect"),Se({}),Ke(!1),we(X),Ue(H=>{const L=H+1;return L>=Na&&Ga&&(t(!0),Ke(!0)),L}),ja(!1,N/100),Fa({correct:!1,direction:"word->language",expected:ae,answer:R,evalType:"language-select"}))},Mt=R=>{var c;if(R.key!=="Enter")return;if(R.preventDefault(),R.stopPropagation(),We){ct();return}const X=ie.find(v=>!(Ae[v.key]??"").trim());if(X){(c=De.current[X.key])==null||c.focus();return}Ct()},Zt=()=>{Da(),se("correct"),Ke(!0),Ue(0),ja(!0,1),ae&&Fa({correct:!0,direction:"manual",expected:ae,answer:he,evalType:"manual"})},er=()=>{if(ja(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){se(null),ge(""),t(!1),Se({}),Ke(!1),we(null),Ue(0),ue(R=>Math.min(R+1,y.length));return}ct()};i.useEffect(()=>{Da()},[_,y]);const ar=a.cogita.library.revision.revealModeAfterIncorrect,Ga=ie.length>0||!!ae;return e.jsxs(Ca,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:f,onNavigate:P,language:M,onLanguageChange:F,children:[(x==="loading"||G==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ne.total?Math.min(100,Math.max(0,ne.current/ne.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ne.total?`${Math.min(ne.current,ne.total)} / ${ne.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:J}),e.jsx("p",{className:"cogita-library-subtitle",children:s}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",Ma).replace("{check}",Ba)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Sa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Sa.currentLevel??"-"," / ",Sa.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ri,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[ee?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:ee})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Ee?`${Ee.kind}-${Ee.tick}`:_a?"idle":B??"idle",children:x!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):je?e.jsx(e.Fragment,{children:Ye?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ti,{copy:a,currentCard:je,currentTypeLabel:Yt,prompt:d,languages:E,answer:he,onAnswerChange:R=>ge(X=>_t(X,R,j)),computedExpected:ie,computedAnswers:Ae,onComputedAnswerChange:(R,X)=>ke(c=>({...c,[R]:_t(c[R]??"",X,j)})),answerTemplate:Ge,outputVariables:Fe,variableValues:ia,computedFieldFeedback:$e,feedback:B,canAdvance:We,quoteContext:Me,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ct,onSkip:er,onLanguageSelect:ut,onMarkReviewed:Zt,onAdvance:ct,showCorrectAnswer:Y,setShowCorrectAnswer:t,onRevealCorrect:()=>Ke(!0),answerMask:oe,expectedAnswer:ae,hasExpectedAnswer:Ga,handleComputedKeyDown:Mt,answerInputRef:ta,computedInputRefs:De,scriptMode:j,setScriptMode:k,matchPairs:W==null?void 0:W.pairs,matchLeftOrder:W==null?void 0:W.leftOrder,matchRightOrder:W==null?void 0:W.rightOrder,matchSelection:W==null?void 0:W.selection,matchActiveLeft:W==null?void 0:W.activeLeft,matchActiveRight:W==null?void 0:W.activeRight,matchFeedback:Ve,onMatchLeftSelect:Nt,onMatchRightSelect:Lt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:it?`${Ea} / ${it}`:a.cogita.library.revision.progressUnlimited}),x==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),x==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),x==="ready"&&G==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),x==="ready"&&G==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),x==="ready"&&G==="ready"&&y.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:ar}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Na]})]})]}),Sa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Sa.activeCount," / ",Sa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Sa.counts.map((R,X)=>{const c=X+1,v=Sa.currentLevel===c,S=Sa.percentages[X]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":v,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:c}),e.jsx("strong",{children:R})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,S))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[S.toFixed(1),"%"]})]},`level-${c}`)})})]}):null,ot?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ot.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ot.dots.map(R=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-R.value))}, ${Math.round(200*R.value)}, 80, 0.9)`}},R.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ot.knownCount})]})]}):null,da?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Aa})]})}):null]})]})]})})})]})]})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Un},Symbol.toStringTag,{value:"Module"}));export{Jn as C,Yn as a,Qn as b};
