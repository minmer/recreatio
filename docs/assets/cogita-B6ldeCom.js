import{r as a,j as e,u as zs,a as _a,b as Bs,c as Ds,d as _s,R as gs,B as ms,C as ps}from"./vendor-CL5v9b84.js";import{L as Vs,A as Os,g as qs,a as mn,b as wa,c as Us,s as js,d as fs,e as pn,f as ks,h as Yt,i as fn,j as Ws,k as Hs,l as bn,m as bs,n as Qs,o as yn,u as xn,p as vn,q as wn,r as jn,t as Ys,v as Gs,w as kn,x as Nn,y as Tn,z as Va,B as $a,C as Sn,D as Cn,E as Mn,F as In,G as Ln,H as $n,I as Rn,J as Ns,K as Qt,M as En,N as An,O as Pn,P as Fn,Q as Kn,R as zn,S as Bn,T as Dn,U as _n,V as Vn,W as On,X as qn,Y as Un,Z as Wn,_ as Hn,$ as Qn,a0 as Ts}from"./recreatio-core-D7iLAa61.js";import"./vendor-cogita-ui-mbCyoqV0.js";const va={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},ya={moveMs:900,pauseMs:220,errorMs:900},Yn=(t=11)=>{let s=t;const n=()=>(s=(s*1664525+1013904223)%4294967296,s/4294967296),{width:i,height:o,paddingX:p,paddingY:f,levels:y}=va,A=(o-f*2)/(y.length-1),C=[],c=[],x=[];y.forEach((S,g)=>{const ie=o-f-g*A,P=i-p*2,b=[];for(let q=0;q<S;q+=1){const E=p+(q+1)*P/(S+1),G=(n()-.5)*18,k=Math.max(p,Math.min(i-p,E+G)),M=g===0?3:g<2?2.1:1.4,J=g===0?"root":`l${g}-${q}`;b.push({id:J,x:g===0?i/2:k,y:ie,r:M,level:g,role:g===0?"root":void 0})}x.push(b),C.push(...b)});const l=x[x.length-1];if(l!=null&&l.length){const S=l[Math.floor(l.length/2)];S.role="goal",S.r=2}for(let S=1;S<x.length;S+=1){const g=x[S-1];x[S].forEach(P=>{const b=[...g].sort((k,M)=>Math.abs(k.x-P.x)-Math.abs(M.x-P.x)),q=b[0],E=b[1]&&n()<.45?b[1]:null;(E?[q,E]:[q]).forEach(k=>{c.push({from:k.id,to:P.id,key:`${k.id}-${P.id}`})}),n()<.2&&b[2]&&c.push({from:b[2].id,to:P.id,key:`${b[2].id}-${P.id}`})})}const h=new Map;c.forEach(S=>{const g=h.get(S.to)??[];g.push(S.from),h.set(S.to,g)});const N=new Map,ne=new Map,Y=new Map;c.forEach(S=>{const g=N.get(S.from)??[];g.push(S.key),N.set(S.from,g);const ie=ne.get(S.from)??[];ie.push(S.to),ne.set(S.from,ie);const P=Y.get(S.from)??[];P.push(S.to),Y.set(S.from,P);const b=Y.get(S.to)??[];b.push(S.from),Y.set(S.to,b)});const U=new Map;return C.forEach(S=>{U.set(S.id,S)}),{nodes:C,links:c,parentsById:h,linksByFrom:N,childrenByFrom:ne,neighborsById:Y,nodesById:U}};function Gn({slides:t,activeIndex:s,introOpen:n,prefersReducedMotion:i,onNext:o,onPrev:p,onSelect:f,onExit:y,onOpen:A,onRegister:C}){const c=s===t.length-1,x=n&&s===0?"entry":"docked",l=t[t.length-1],[h,N]=a.useState(!1),ne=a.useMemo(()=>Array.from({length:20},(Q,de)=>({src:`/cogita/logo/Cogita${String(de).padStart(2,"0")}.png`,kind:de<=11?"bubble":de<=17?"text":"recreatio"})),[]),Y=n&&s===0;a.useEffect(()=>{if(!n){N(!1);return}s>0&&!h&&N(!0)},[s,n,h]);const U=a.useRef(0),S=a.useRef(null),g=a.useMemo(()=>{const Q={x:40,y:160},de={x:260,y:48},$e=6,R=de.x-Q.x,V=Q.y-de.y,me=R/$e,ke=[.3,.45,.6,.65,1.4,2.2],be=ke.reduce((Ee,we)=>Ee+we,0),Le=ke.map(Ee=>V*Ee/be),Pe=[Q];let Ve=Q.x,Ie=Q.y;for(let Ee=1;Ee<=$e;Ee+=1){const we=(Math.random()-.5)*14,st=(Math.random()-.5)*28;Ve=Math.max(Q.x+Ee*14,Math.min(de.x-($e-Ee)*14,Ve+me+we));const qe=Le[Ee-1]??Le[Le.length-1];Ie=Ie-qe+st;const Xe=Math.max(de.y,Math.min(Q.y-4,Ie));Pe.push({x:Math.round(Ve),y:Math.round(Xe)})}return Pe[Pe.length-1]=de,Pe},[]),ie=a.useMemo(()=>{const V=(be,Le,Pe)=>Math.min(Pe,Math.max(Le,be)),me=g.map(be=>{const Le=10+Math.random()*36;return{x:V(be.x,40,260),y:V(be.y-Le,40,140)}}),ke=g.map((be,Le)=>{var Ie;const Pe=12+Math.random()*40,Ve=((Ie=me[Le])==null?void 0:Ie.y)??be.y;return{x:V(be.x,40,260),y:V(Math.max(Ve+10,be.y+Pe),60,170)}});return{upper:me,lower:ke}},[g]),P=a.useMemo(()=>{var de;const Q=((de=g[4])==null?void 0:de.x)??260;return Math.max(0,Math.min(240,Q-40))},[g]),b=a.useMemo(()=>{var Le,Pe;const Q=(Ve,Ie,Ee)=>Math.min(Ee,Math.max(Ie,Ve)),de=(Ve,Ie,Ee)=>g.map((we,st)=>{var ct,dt;const qe=((ct=ie.upper[st])==null?void 0:ct.y)??we.y,Xe=((dt=ie.lower[st])==null?void 0:dt.y)??we.y,rt=(Math.random()-.5)*70,yt=we.y+Ve+rt,Je=Q(we.y+Ie,qe+6,Xe-6),Ze=Q(we.y+Ee,qe+6,Xe-6);return{x:we.x,y:Q(yt,Math.min(Je,Ze),Math.max(Je,Ze))}}),$e=-14+Math.random()*28,R=14+Math.random()*28,V=de($e,-80,12),me=de(R,-12,80);for(let Ve=4;Ve<g.length;Ve+=1){const Ie=g[Ve],Ee=((Le=ie.upper[Ve])==null?void 0:Le.y)??Ie.y,we=((Pe=ie.lower[Ve])==null?void 0:Pe.y)??Ie.y;V[Ve]={x:Ie.x,y:Q(Ie.y-12,Ee+6,we-6)},me[Ve]={x:Ie.x,y:Q(Ie.y+12,Ee+6,we-6)}}const ke=ie.upper.length?ie.upper[ie.upper.length-1].y:40,be=ie.lower.length?ie.lower[ie.lower.length-1].y:170;return V[V.length-1]={x:g[g.length-1].x,y:Q(g[g.length-1].y-14,ke,be)},me[me.length-1]={x:g[g.length-1].x,y:Q(g[g.length-1].y+12,ke,be)},{higher:V,lower:me}},[g,ie]),q=1e4,E=a.useMemo(()=>{let Q=17;const de=()=>(Q=(Q*1664525+1013904223)%4294967296,Q/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((R,V)=>{const me=(de()-.5)*240,ke=(de()-.5)*180,be=(de()-.5)*24;return{id:`card-${V+1}`,throw:{x:`${me.toFixed(0)}px`,y:`${ke.toFixed(0)}px`,rot:`${be.toFixed(1)}deg`},grid:{x:`${R.x}px`,y:`${R.y}px`},delay:`${V*.12}s`}})},[]),G=a.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[k,M]=a.useState([]),J=a.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),ae=a.useMemo(()=>{const de=[],R=(me,ke)=>me+Math.random()*(ke-me);for(let me=0;me<6;me+=1){let ke=!1;for(let be=0;be<80;be+=1){const Le=R(14,86),Pe=R(10,34);if(de.every(Ie=>{const Ee=Ie.x-Le,we=Ie.y-Pe;return Math.hypot(Ee,we)>=12})){de.push({x:Le,y:Pe}),ke=!0;break}}ke||de.push({x:R(16,84),y:R(12,32)})}return de.map((me,ke)=>({id:`p${ke+1}`,x:`${me.x.toFixed(1)}%`,y:`${me.y.toFixed(1)}%`,xNum:me.x,yNum:me.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[te,Fe]=a.useState(0),[ge,L]=a.useState(0),[pe,j]=a.useState([]),_=1e4,he=a.useMemo(()=>{if(ae.length<2)return[];const Q=ke=>{let be=ke+1831565813;return be=Math.imul(be^be>>>15,be|1),be^=be+Math.imul(be^be>>>7,be|61),((be^be>>>14)>>>0)/4294967296},de=(ke,be)=>Math.floor(Q(ke)*be),$e=new Set,R=[],V=Math.min(3,ae.length);let me=0;for(;R.length<V&&me<30;){me+=1;const ke=de(te*13+me*5,ae.length),be=de(te*29+me*7,ae.length);if(ke===be)continue;const Le=ke<be?`${ke}-${be}`:`${be}-${ke}`;$e.has(Le)||($e.add(Le),R.push({id:`link-${Le}`,from:ae[ke],to:ae[be],delay:`${(me*.35).toFixed(2)}s`}))}return R},[te,ae]);a.useEffect(()=>{if(!n||s!==2)return;const Q=()=>{const $e=E.map(R=>R.id);for(let R=$e.length-1;R>0;R-=1){const V=Math.floor(Math.random()*(R+1));[$e[R],$e[V]]=[$e[V],$e[R]]}return $e.slice(0,4)};M(Q());const de=window.setInterval(()=>{M(Q())},q);return()=>window.clearInterval(de)},[s,n,E,q]),a.useEffect(()=>{if(!n||s!==3)return;const Q=()=>{L(Math.floor(Math.random()*J.length)),j(ae.map(()=>Math.random()<.6?"good":"bad")),Fe($e=>$e+1)};Q();const de=window.setInterval(Q,_);return()=>window.clearInterval(de)},[s,n,J.length,ae,_]);const W=a.useMemo(()=>Yn(11),[]),[K,fe]=a.useState(new Set(["root"])),[xe,ve]=a.useState(new Set),[Ae,Se]=a.useState(new Set),[Ue,Ke]=a.useState({fromId:"root",toId:"root",key:0}),Ne=a.useRef(K),He=a.useRef("root"),at=a.useRef(0),et=a.useRef(null),D=a.useRef(null),H=a.useRef([]);a.useEffect(()=>{Ne.current=K},[K]);const We=a.useMemo(()=>{const Q=new Set;return K.forEach(de=>{const $e=W.linksByFrom.get(de);$e&&$e.forEach(R=>Q.add(R))}),Q},[K,W]),Ce=W.nodesById.get(Ue.toId)??W.nodesById.get("root"),re=Ce?`${Ce.x/va.width*100}%`:"50%",Re=Ce?`${Ce.y/va.height*100}%`:"90%";a.useEffect(()=>{if(!n||s!==1||i)return;(()=>{fe(new Set(["root"])),ve(new Set),Se(new Set),Ke({fromId:"root",toId:"root",key:0}),D.current=null,at.current=0,He.current="root",H.current=[]})();const de=()=>{const R=He.current,V=Ne.current,ke=(W.childrenByFrom.get(R)??[]).filter(we=>!V.has(we));if(ke.length)return ke[Math.floor(Math.random()*ke.length)];if(V.size>=W.nodes.length){const we=W.neighborsById.get(R)??[];return we.length?we[Math.floor(Math.random()*we.length)]:null}const be=we=>(W.childrenByFrom.get(we)??[]).some(qe=>!V.has(qe)),Le=[R],Pe=new Set([R]),Ve=new Map;let Ie=null;for(;Le.length;){const we=Le.shift();if(!we)break;if(we!==R&&be(we)){Ie=we;break}(W.neighborsById.get(we)??[]).forEach(qe=>{Pe.has(qe)||(Pe.add(qe),Ve.set(qe,we),Le.push(qe))})}if(!Ie)return null;let Ee=Ie;for(;Ve.get(Ee)&&Ve.get(Ee)!==R;)Ee=Ve.get(Ee)??Ee;return Ee},$e=(R,V)=>{if(R===V){const me=de();me&&$e(R,me);return}at.current+=1,Ke({fromId:R,toId:V,key:at.current}),He.current=V,et.current=window.setTimeout(()=>{const me=W.parentsById.get(V)??[],ke=Ne.current,be=me.filter(Ie=>!ke.has(Ie));if(!be.length){const Ie=new Set(ke);Ie.add(V),fe(Ie),et.current=window.setTimeout(()=>{for(;H.current.length;){const we=H.current[H.current.length-1];if(!Ie.has(we)){if(we!==V){$e(V,we);return}break}H.current.pop()}const Ee=de();Ee&&$e(V,Ee)},ya.pauseMs);return}const Le=new Set([V,...be]),Pe=new Set(be.map(Ie=>`${Ie}-${V}`));ve(Le),Se(Pe),H.current.includes(V)||H.current.push(V);const Ve=be[Math.floor(Math.random()*be.length)];D.current={fromId:V,toId:Ve},et.current=window.setTimeout(()=>{ve(new Set),Se(new Set);const Ie=D.current;Ie&&$e(Ie.fromId,Ie.toId)},ya.errorMs)},ya.moveMs)};return et.current=window.setTimeout(()=>{const R=de();R&&$e(He.current,R)},ya.pauseMs),()=>{et.current&&window.clearTimeout(et.current)}},[s,n,W,i]);const ze=Q=>{if(!n)return;const de=Date.now();de-U.current<520||Math.abs(Q.deltaY)<10||(U.current=de,Q.deltaY>0?o():p(),Q.preventDefault())},Be=Q=>{if(!n)return;const de=Q.touches[0];de&&(S.current={x:de.clientX,y:de.clientY})},De=Q=>{if(!n)return;const de=S.current;if(S.current=null,!de)return;const $e=Q.changedTouches[0];if(!$e)return;const R=$e.clientX-de.x,V=$e.clientY-de.y;Math.abs(V)<40||Math.abs(V)<Math.abs(R)||(V<0?o():p())};return e.jsxs("div",{className:`cogita-intro ${n?"is-open":"is-closed"} ${i?"is-reduced":""} ${c?"is-final":""}`,"data-slide":s+1,onWheel:ze,onTouchStart:Be,onTouchEnd:De,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":x,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${Y&&!h?"is-entry":""}`,children:ne.map((Q,de)=>e.jsx("img",{src:Q.src,alt:"",className:`cogita-logo-layer ${de===0?"is-base":""} ${Q.kind==="text"?"is-text":Q.kind==="recreatio"?"is-recreatio":""} ${Q.kind==="bubble"?"is-bubble":""}`},Q.src))})}),n&&t.map((Q,de)=>{const $e=de===s;return e.jsxs("section",{className:`cogita-intro-slide slide-${de+1} ${$e?"is-active":""}`,"aria-hidden":!$e,children:[e.jsxs("div",{className:"cogita-intro-text",children:[Q.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:Q.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:Q.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:Q.title}),Q.body&&e.jsx("p",{children:Q.body.split(`
`).map((R,V)=>e.jsxs("span",{children:[R,V===0&&e.jsx("br",{})]},String(V)))})]}),Q.micro&&e.jsx("p",{className:"cogita-intro-micro",children:Q.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:c?C:o,children:Q.cta}),c&&Q.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>f(0),children:Q.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[de===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${va.width} ${va.height}`,preserveAspectRatio:"none",children:[W.links.map(R=>{const V=W.nodesById.get(R.from),me=W.nodesById.get(R.to);if(!V||!me)return null;const ke=We.has(R.key),be=Ae.has(R.key);return e.jsx("line",{className:`map-link ${ke?"is-active":""} ${be?"is-error":""}`,x1:V.x,y1:V.y,x2:me.x,y2:me.y},R.key)}),W.nodes.map(R=>{const V=K.has(R.id),me=xe.has(R.id);return e.jsx("circle",{className:`map-node ${R.role?`is-${R.role}`:""} ${V?"is-active":""} ${me?"is-error":""}`,cx:R.x,cy:R.y,r:R.r},R.id)})]}),Ce&&e.jsx("span",{className:"map-explorer-dot",style:{left:re,top:Re,"--move":`${ya.moveMs}ms`}})]}),de===2&&e.jsx("div",{className:"cogita-index-cards",children:E.map(R=>{const V=k.indexOf(R.id),me=V>=0?G[V]:null,ke=(me==null?void 0:me.x)??"140px",be=(me==null?void 0:me.y)??"140px",Le=V>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":R.throw.x,"--throw-y":R.throw.y,"--throw-rot":R.throw.rot,"--grid-x":R.grid.x,"--grid-y":R.grid.y,"--stack-x":ke,"--stack-y":be,"--stack-opacity":Le,"--delay":R.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},R.id)})}),de===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[J.map((R,V)=>e.jsxs("div",{className:`round-card ${V===ge?"is-active":""}`,style:{"--card-x":R.x,"--card-y":R.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},R.id)),J[ge]&&e.jsx("span",{className:"round-ring",style:{"--card-x":J[ge].x,"--card-y":`calc(${J[ge].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:ae.map(R=>e.jsx("span",{className:"player-dot",style:{left:R.x,top:R.y,"--jitter-x":R.jitterX,"--jitter-y":R.jitterY,"--breath-delay":R.delay}},R.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:he.map(R=>e.jsx("line",{className:"round-link",x1:R.from.xNum,y1:R.from.yNum,x2:R.to.xNum,y2:R.to.yNum,style:{"--delay":R.delay}},R.id))}),e.jsx("div",{className:"round-flows",children:ae.map((R,V)=>{const me=pe[V]??"good",ke=J[ge];if(!ke)return null;const be=`calc(${ke.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":R.x,"--from-y":R.y,"--to-x":ke.x,"--to-y":be,"--delay":`${V*.12}s`}}),e.jsx("span",{className:`return-dot is-${me}`,style:{"--from-x":ke.x,"--from-y":be,"--to-x":R.x,"--to-y":R.y,"--delay":`${V*.12}s`}}),e.jsx("span",{className:`result-pop is-${me}`,style:{"--at-x":R.x,"--at-y":R.y,"--delay":`${V*.12}s`}})]},`${R.id}-${te}`)})})]},`round-${te}`),de===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${g[0].x} ${g[0].y} L${g[1].x} ${g[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${g[1].x} ${g[1].y} L${g[2].x} ${g[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${g[2].x} ${g[2].y} L${g[3].x} ${g[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${g[3].x} ${g[3].y} L${g[4].x} ${g[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${g[4].x} ${g[4].y} L${g[5].x} ${g[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${g[5].x} ${g[5].y} L${g[6].x} ${g[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${P};${P};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${ie.upper.map((R,V)=>`${V===0?"M":"L"}${R.x} ${R.y}`).join(" ")} ${ie.lower.slice().reverse().map(R=>`L${R.x} ${R.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${ie.upper.map((R,V)=>`${V===0?"M":"L"}${R.x} ${R.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${ie.lower.map((R,V)=>`${V===0?"M":"L"}${R.x} ${R.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[b.higher.slice(0,6).map((R,V)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${V+1}`,d:`M${R.x} ${R.y} L${b.higher[V+1].x} ${b.higher[V+1].y}`,pathLength:"100"},`peer-1-${V}`)),b.lower.slice(0,6).map((R,V)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${V+1}`,d:`M${R.x} ${R.y} L${b.lower[V+1].x} ${b.lower[V+1].y}`,pathLength:"100"},`peer-2-${V}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${g[0].x/300*100}%`,"--p0y":`${g[0].y/200*100}%`,"--p1x":`${g[1].x/300*100}%`,"--p1y":`${g[1].y/200*100}%`,"--p2x":`${g[2].x/300*100}%`,"--p2y":`${g[2].y/200*100}%`,"--p3x":`${g[3].x/300*100}%`,"--p3y":`${g[3].y/200*100}%`,"--p4x":`${g[4].x/300*100}%`,"--p4y":`${g[4].y/200*100}%`,"--p5x":`${g[5].x/300*100}%`,"--p5y":`${g[5].y/200*100}%`,"--p6x":`${g[6].x/300*100}%`,"--p6y":`${g[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${b.higher[0].x/300*100}%`,"--q0y":`${b.higher[0].y/200*100}%`,"--q1x":`${b.higher[1].x/300*100}%`,"--q1y":`${b.higher[1].y/200*100}%`,"--q2x":`${b.higher[2].x/300*100}%`,"--q2y":`${b.higher[2].y/200*100}%`,"--q3x":`${b.higher[3].x/300*100}%`,"--q3y":`${b.higher[3].y/200*100}%`,"--q4x":`${b.higher[4].x/300*100}%`,"--q4y":`${b.higher[4].y/200*100}%`,"--q5x":`${b.higher[5].x/300*100}%`,"--q5y":`${b.higher[5].y/200*100}%`,"--q6x":`${b.higher[6].x/300*100}%`,"--q6y":`${b.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${b.lower[0].x/300*100}%`,"--q0y":`${b.lower[0].y/200*100}%`,"--q1x":`${b.lower[1].x/300*100}%`,"--q1y":`${b.lower[1].y/200*100}%`,"--q2x":`${b.lower[2].x/300*100}%`,"--q2y":`${b.lower[2].y/200*100}%`,"--q3x":`${b.lower[3].x/300*100}%`,"--q3y":`${b.lower[3].y/200*100}%`,"--q4x":`${b.lower[4].x/300*100}%`,"--q4y":`${b.lower[4].y/200*100}%`,"--q5x":`${b.lower[5].x/300*100}%`,"--q5y":`${b.lower[5].y/200*100}%`,"--q6x":`${b.lower[6].x/300*100}%`,"--q6y":`${b.lower[6].y/200*100}%`}})]})})}),de===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),de===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},Q.id)}),!n&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:l.title}),l.body&&e.jsx("p",{children:l.body}),l.micro&&e.jsx("p",{className:"cogita-intro-micro",children:l.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:C,children:l.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:A,children:"Otwórz pokaz"})]})]})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:t.map((Q,de)=>e.jsx("button",{type:"button",className:`dot ${s===de?"active":""}`,"aria-label":Q.title,onClick:()=>f(de)},Q.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:y,children:"Pomiń"})]})]})}const Xn=6,Jn=4;function Zn({copy:t,onAuthAction:s,authLabel:n,showProfileMenu:i,onProfileNavigate:o,onToggleSecureMode:p,onLogout:f,secureMode:y,onNavigate:A,language:C,onLanguageChange:c}){const x=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}A("home")},l=a.useRef(null),h=a.useRef([]),N=a.useMemo(()=>{let j=Date.now()%2147483647;const _=()=>(j=j*48271%2147483647,j/2147483647);return Array.from({length:Xn},(he,W)=>{const K=6+_()*8,fe=7+_()*10,xe=6+_()*9,ve=-_()*K,Ae=-_()*fe,Se=-_()*xe,Ue=.18+_()*.28,Ke=12+_()*18,Ne=4+_()*8,He=(_()-.5)*3.2,at=(_()-.5)*3.8,et=_()>.5?"alternate":"alternate-reverse",D=_()>.5?"alternate":"alternate-reverse",H=_()>.5?"alternate":"alternate-reverse",We=.18+_()*.42,Ce=30+_()*60,re=-45-_()*38,Re=188+_()*32,ze=.1+_()*.2;return{id:`wave-${W+1}`,style:{"--wave-sway-duration":`${K}s`,"--wave-scale-duration":`${fe}s`,"--wave-drift-duration":`${xe}s`,"--wave-sway-delay":`${ve}s`,"--wave-scale-delay":`${Ae}s`,"--wave-drift-delay":`${Se}s`,"--wave-sway-dir":et,"--wave-scale-dir":D,"--wave-drift-dir":H,"--wave-scale":`${Ue}`,"--wave-shift":`${Ke}%`,"--wave-xshift":`${Ne}%`,"--wave-x0":`${He}%`,"--wave-y0":`${at}%`,"--wave-opacity":`${We}`,"--wave-blur":`${Ce}px`,"--wave-bottom":`${re}%`,"--wave-hue":`${Re}`,"--wave-glow":`${ze}`}}})},[]),ne=a.useMemo(()=>{let j=Date.now()*3%2147483647;const _=()=>(j=j*48271%2147483647,j/2147483647);return Array.from({length:Jn},(he,W)=>{const K=180+_()*220,fe=220+_()*280,xe=-_()*K,ve=-_()*fe,Ae=.12+_()*.22,Se=3+_()*7,Ue=1+_()*3,Ke=(_()-.5)*2.8,Ne=(_()-.5)*2.2;return{id:`mesh-${W+1}`,seed:1e3+W*991+Math.floor(_()*999),style:{"--mesh-sway-duration":`${K}s`,"--mesh-drift-duration":`${fe}s`,"--mesh-sway-delay":`${xe}s`,"--mesh-drift-delay":`${ve}s`,"--mesh-scale":`${Ae}`,"--mesh-shift":`${Se}%`,"--mesh-xshift":`${Ue}%`,"--mesh-x0":`${Ne}%`,"--mesh-y0":`${Ke}%`}}})},[]),Y=a.useMemo(()=>{const j=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],_=t.cogita.introSlides,he=new Map(_.map(W=>[W.id,W]));return j.map(W=>{var fe;const K=he.get(W.id);return{...W,...K,title:(K==null?void 0:K.title)??"Cogita",cta:(K==null?void 0:K.cta)??((fe=t.cogita.introSlides[0])==null?void 0:fe.cta)??t.cogita.loginCta,secondary:K==null?void 0:K.secondary}})},[t.cogita.introSlides]),[U,S]=a.useState(0),[g,ie]=a.useState(!0),[P,b]=a.useState(!1),q=Y.length-1,E=a.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),G=a.useCallback(()=>{E(),s()},[E,s]),k=a.useCallback(()=>{ie(!0),S(0)},[]),M=a.useCallback(()=>{ie(!1),S(q)},[q]),J=a.useCallback(j=>{S(Math.max(0,Math.min(q,j)))},[q]),ae=a.useCallback(()=>{U>=q?G():J(U+1)},[U,J,G,q]),te=a.useCallback(()=>{J(U-1)},[U,J]);a.useEffect(()=>{var he;const j=(he=window.matchMedia)==null?void 0:he.call(window,"(prefers-reduced-motion: reduce)");if(!j)return;const _=()=>b(j.matches);return _(),j.addEventListener?(j.addEventListener("change",_),()=>j.removeEventListener("change",_)):(j.addListener(_),()=>j.removeListener(_))},[]),a.useEffect(()=>{if(!g)return;const j=_=>{const he=_.target;if(!he)return;const W=he.tagName;if(!(he.isContentEditable||W==="INPUT"||W==="TEXTAREA"||W==="SELECT"||W==="BUTTON"||W==="A"||he.closest('button, a, [role="button"], [role="link"]'))){if(_.key==="Escape"){M();return}if(_.key==="ArrowLeft"||_.key==="ArrowUp"){te();return}(_.key==="ArrowRight"||_.key==="ArrowDown"||_.code==="Space"||_.key===" ")&&(_.preventDefault(),ae())}};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[M,ae,te,g]),a.useEffect(()=>{g&&U===q&&E()},[U,g,q,E]),a.useEffect(()=>{const j=l.current;if(!j)return;const _=h.current.filter(re=>!!re);if(!_.length)return;const he=1,W=.6,K=.6,fe=Math.max(1,Math.min(he,window.devicePixelRatio||1));let xe=0,ve=0,Ae=W,Se=0,Ue=0;const Ke=re=>{let Re=re%2147483647;return Re<=0&&(Re+=2147483646),(ze,Be)=>{Re=Re*48271%2147483647;const De=Re/2147483647;return ze+De*(Be-ze)}},Ne={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},He=re=>{const Re=Math.sin(re*12.9898)*43758.5453;return Re-Math.floor(Re)},at=re=>{const Re=He(re+.1)||1e-4,ze=He(re+.7)||1e-4;return Math.sqrt(-2*Math.log(Re))*Math.cos(2*Math.PI*ze)},et=(re,Re)=>{const ze=Math.floor(re),Be=ze+1,De=re-ze,Q=De*De*(3-2*De),de=He(ze*12.9898+Re*78.233),$e=He(Be*12.9898+Re*78.233);return de+($e-de)*Q},D=re=>{const Re=Ke(re),ze=Math.min(4,Math.max(4,Math.floor(xe/1200*Ne.filamentCount)));return Array.from({length:ze},(Be,De)=>{const Q=Math.max(-1,Math.min(1,at(re+De*.37))),de=Math.min(1,Math.max(0,He(re+De*1.31))),$e=Math.min(Ne.depthLayers-1,Math.floor(de*Ne.depthLayers));return{seed:Re(0,Math.PI*2)+re*.01,offset:Q,freqA:Ne.freq1*(.75+Re(0,.5)),freqB:Ne.freq2*(.75+Re(0,.5)),ampA:Ne.amp1*(.6+Re(0,.7)),ampB:Ne.amp2*(.6+Re(0,.7)),width:2+De%5*.32,depth:de,layer:$e}})},H=(re,Re,ze)=>{const Be=Math.max(30,Math.floor(xe*ve/14e4));re.save(),re.globalAlpha=.6;for(let De=0;De<Be;De+=1){const Q=He(De*9.1+xe*.11)*Re+ze,de=He(De*3.7+ve*.23)*ve,$e=1.2+He(De*5.9)*2.4,R=re.createRadialGradient(Q,de,0,Q,de,$e*2);R.addColorStop(0,"rgba(10, 30, 60, 0.45)"),R.addColorStop(1,"rgba(10, 30, 60, 0)"),re.fillStyle=R,re.beginPath(),re.arc(Q,de,$e*2,0,Math.PI*2),re.fill()}re.restore()},We=(re,Re)=>{re.clearRect(0,0,xe,ve);const ze=ve*Ne.waveCenter,Be=Ne.waveBandPx,De=Ne.segments,Q=Ne.colors.filaments,de=Se||xe,$e=0;H(re,de,$e),re.strokeStyle=Q,re.lineCap="round",re.lineJoin="round";for(let R=0;R<Re.length;R+=1){const V=Re[R],me=V.offset*Be*(.85+He(V.seed)*.4),ke=1-Math.min(1,Math.abs(me)/Be),be=Math.exp(-Math.pow(me/Ne.crestThickness,2)),Le=V.layer===0?1.1:V.layer===1?.85:.6,Pe=.35+(1-V.depth)*.65,Ve=ke*Pe*Le*(.34+be*.45);re.globalAlpha=Ve,re.lineWidth=V.width*(1+(1-V.depth)*.8);const Ie=[];for(let we=0;we<=De;we+=1){const st=we/De*de+$e,qe=(et(st*.012,V.seed)-.5)*Ne.xJitter,Xe=st+qe,rt=(et(Xe*V.freqA,V.seed)-.5)*Ne.jitterA,yt=(et(Xe*V.freqB,V.seed*1.7)-.5)*Ne.jitterB,Je=ze+Math.sin(Xe*V.freqA+V.seed)*V.ampA+Math.sin(Xe*V.freqB+V.seed*1.3)*V.ampB+me+rt+yt;Ie.push({x:Xe,y:Je})}re.beginPath(),re.moveTo(Ie[0].x,Ie[0].y);for(let we=1;we<Ie.length-1;we+=1){const st=(Ie[we].x+Ie[we+1].x)/2,qe=(Ie[we].y+Ie[we+1].y)/2;re.quadraticCurveTo(Ie[we].x,Ie[we].y,st,qe)}const Ee=Ie[Ie.length-1];re.quadraticCurveTo(Ee.x,Ee.y,Ee.x,Ee.y),re.stroke()}re.save(),re.globalCompositeOperation="lighter",re.strokeStyle=Ne.colors.glow,re.lineCap="round",re.lineJoin="round";for(let R=0;R<Re.length;R+=1){const V=Re[R];if(Math.abs(V.offset)*Be>Ne.crestThickness)continue;const me=Ne.glowAlpha*(.7+(1-V.depth)*.6);re.globalAlpha=me,re.lineWidth=1.6+(1-V.depth)*1.2;const ke=[];for(let Le=0;Le<=De;Le+=1){const Pe=Le/De*de+$e,Ve=Math.sin(Pe*.02+V.seed)*3,Ie=ze+Math.sin(Pe*V.freqA+V.seed)*V.ampA+Math.sin(Pe*V.freqB+V.seed*1.3)*V.ampB+V.offset*Be*.35+Ve;ke.push({x:Pe,y:Ie})}re.beginPath(),re.moveTo(ke[0].x,ke[0].y);for(let Le=1;Le<ke.length-1;Le+=1){const Pe=(ke[Le].x+ke[Le+1].x)/2,Ve=(ke[Le].y+ke[Le+1].y)/2;re.quadraticCurveTo(ke[Le].x,ke[Le].y,Pe,Ve)}const be=ke[ke.length-1];re.quadraticCurveTo(be.x,be.y,be.x,be.y),re.stroke()}re.restore()},Ce=()=>{xe=Math.floor(j.clientWidth),ve=Math.floor(j.clientHeight),Se=Math.floor(xe*1.8),Ue=ve,Ae=xe<820?K:W,_.forEach(re=>{const Re=re.getContext("2d");if(!Re)return;re.width=Math.floor(Se*fe*Ae),re.height=Math.floor(Ue*fe*Ae),re.style.width=`${Se}px`,re.style.height=`${Ue}px`,re.style.left=`${-(Se-xe)/2}px`,Re.setTransform(fe*Ae,0,0,fe*Ae,0,0);const ze=Number(re.dataset.seed||1),Be=D(ze);We(Re,Be)})};return Ce(),window.addEventListener("resize",Ce,{passive:!0}),()=>window.removeEventListener("resize",Ce)},[ne]);const Fe=Y[Math.min(U,Y.length-1)],ge=g?Fe:Y[Y.length-1],L=(ge==null?void 0:ge.theme)??Y[0].theme,pe={"--cogita-bg0":L.bg0,"--cogita-bg1":L.bg1,"--cogita-bg2":L.bg2,"--cogita-bloom":L.bloom,"--cogita-sat":L.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:x,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Vs,{value:C,onChange:c}),e.jsx(Os,{copy:t,label:n,isAuthenticated:i,secureMode:y,onLogin:s,onProfileNavigate:o,onToggleSecureMode:p,onLogout:f,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:l,className:"cogita-section cogita-home",style:pe,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[ne.map((j,_)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:j.style,"data-seed":j.seed,ref:he=>{h.current[_]=he}},j.id)),N.map(j=>e.jsx("div",{className:"cogita-home-wave",style:j.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},j.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Gn,{slides:Y,activeIndex:U,introOpen:g,prefersReducedMotion:P,onNext:ae,onPrev:te,onSelect:J,onExit:M,onOpen:k,onRegister:G})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const rr=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Zn},Symbol.toStringTag,{value:"Module"})),Xs=a.createContext(!1);function Tt({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:c}){if(a.useContext(Xs))return e.jsx(e.Fragment,{children:c});const l=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}y("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:l,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Vs,{value:A,onChange:C}),e.jsx(Os,{copy:t,label:s,isAuthenticated:n,secureMode:f,onLogin:()=>y("home"),onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:c}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}function Ot(t){const[s,n]=a.useState("Cogita library"),[i,o]=a.useState(null);return a.useEffect(()=>{let p=!1;return qs().then(f=>{if(p)return;const y=f.find(A=>A.libraryId===t);y&&n(y.name)}).catch(()=>{p||n("Cogita library")}),()=>{p=!0}},[t]),a.useEffect(()=>{let p=!1;return mn(t).then(f=>{p||o(f)}).catch(()=>{p||o(null)}),()=>{p=!0}},[t]),{libraryName:s,stats:i}}function Ss({slices:t}){const s=t.reduce((i,o)=>i+Math.max(0,o.value),0),n=a.useMemo(()=>{if(s<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let i=0;return`conic-gradient(${t.map(p=>{const y=Math.max(0,p.value)/s*360,A=i,C=i+y;return i=C,`${p.color} ${A}deg ${C}deg`}).join(",")})`},[t,s]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:n}}),e.jsx("div",{className:"cogita-overview-legend",children:t.map(i=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:i.color}}),e.jsx("strong",{children:i.value}),e.jsx("small",{children:i.label})]},i.label))})]})}function ei({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c}){const{libraryName:x,stats:l}=Ot(c),[h,N]=a.useState("infos"),[ne,Y]=a.useState(0),[U,S]=a.useState(0),[g,ie]=a.useState(0),P=(l==null?void 0:l.totalInfos)??0,b=(l==null?void 0:l.totalCollections)??0,q=0,E=0,G=0,k=Math.max(0,P-G-U),M=Math.max(0,P-U-g);a.useEffect(()=>{let ae=!1;return(async()=>{try{const Fe=await wa({libraryId:c,limit:200}),ge=await Promise.all(Fe.items.map(L=>Us({libraryId:c,collectionId:L.collectionId}).catch(()=>[])));if(ae)return;Y(ge.reduce((L,pe)=>L+pe.length,0))}catch{ae||Y(0)}})(),()=>{ae=!0}},[c]),a.useEffect(()=>{let ae=!1;return(async()=>{try{const[Fe,ge,L]=await Promise.all([js({libraryId:c,type:"computed",limit:1}).catch(()=>({total:0})),js({libraryId:c,type:"source",limit:1}).catch(()=>({total:0})),fs({libraryId:c}).catch(()=>({items:[]}))]);if(ae)return;S((Fe.total??0)+(ge.total??0));const pe=new Set(L.items.filter(j=>j.childItemType.toLowerCase()==="info").map(j=>j.childItemId).filter(Boolean));ie(pe.size)}catch{ae||(S(0),ie(0))}})(),()=>{ae=!0}},[c]);const J=[{key:"infos",label:t.cogita.library.overview.stats.totalInfos,value:P},{key:"collections",label:t.cogita.library.overview.stats.collections,value:b},{key:"revisions",label:t.cogita.library.overview.stats.revisions,value:ne},{key:"storyboards",label:t.cogita.library.overview.stats.storyboards,value:q},{key:"texts",label:t.cogita.library.overview.stats.texts,value:E}];return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:x})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:J.map(ae=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${h===ae.key?"active":""}`,onClick:()=>N(ae.key),children:[e.jsx("span",{children:ae.label}),e.jsx("strong",{children:ae.value})]},ae.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:t.cogita.library.overview.statsCardTitle})}),h==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.knownChartTitle}),e.jsx(Ss,{slices:[{label:t.cogita.library.overview.known,value:G,color:"#75d79a"},{label:t.cogita.library.overview.unknown,value:k,color:"#85b9ff"},{label:t.cogita.library.overview.excluded,value:U,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.checksChartTitle}),e.jsx(Ss,{slices:[{label:t.cogita.library.overview.availableChecks,value:g,color:"#75d79a"},{label:t.cogita.library.overview.unavailableChecks,value:M,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:t.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]})]})})]})})}const Ye=(t,s)=>{const n=t.cogita.library.infoTypes,i=t.cogita.library.connectionTypes,o=t.cogita.library.groupTypes;return{any:n.any,vocab:n.vocab,book:o.book,citation:o.citation,language:n.language,word:n.word,sentence:n.sentence,topic:n.topic,collection:n.collection,person:n.person,institution:n.institution,collective:n.collective,orcid:n.orcid,address:n.address,email:n.email,phone:n.phone,media:n.media,work:n.work,geo:n.geo,music_piece:n.musicPiece,music_fragment:n.musicFragment,source:n.source,computed:n.computed,"word-language":i.wordLanguage,"quote-language":i.quoteLanguage,"language-sentence":i.languageSentence,translation:i.translation,"word-topic":i.wordTopic,reference:i.reference,"source-resource":i.sourceResource,"work-contributor":i.workContributor,"work-medium":i.workMedium,"orcid-link":i.orcidLink}[s]??String(s)},ti=t=>[{value:"any",label:Ye(t,"any")},{value:"language",label:Ye(t,"language")},{value:"word",label:Ye(t,"word")},{value:"sentence",label:Ye(t,"sentence")},{value:"topic",label:Ye(t,"topic")},{value:"collection",label:Ye(t,"collection")},{value:"person",label:Ye(t,"person")},{value:"institution",label:Ye(t,"institution")},{value:"collective",label:Ye(t,"collective")},{value:"orcid",label:Ye(t,"orcid")},{value:"address",label:Ye(t,"address")},{value:"email",label:Ye(t,"email")},{value:"phone",label:Ye(t,"phone")},{value:"media",label:Ye(t,"media")},{value:"work",label:Ye(t,"work")},{value:"geo",label:Ye(t,"geo")},{value:"music_piece",label:Ye(t,"music_piece")},{value:"music_fragment",label:Ye(t,"music_fragment")},{value:"source",label:Ye(t,"source")},{value:"citation",label:Ye(t,"citation")},{value:"computed",label:Ye(t,"computed")},{value:"vocab",label:Ye(t,"vocab")},{value:"book",label:Ye(t,"book")},{value:"word-language",label:Ye(t,"word-language")},{value:"quote-language",label:Ye(t,"quote-language")},{value:"language-sentence",label:Ye(t,"language-sentence")},{value:"translation",label:Ye(t,"translation")},{value:"word-topic",label:Ye(t,"word-topic")},{value:"reference",label:Ye(t,"reference")},{value:"source-resource",label:Ye(t,"source-resource")},{value:"work-contributor",label:Ye(t,"work-contributor")},{value:"work-medium",label:Ye(t,"work-medium")},{value:"orcid-link",label:Ye(t,"orcid-link")}],ai=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}],Ja={key:"languageId",labelKey:"language",kind:"select",path:"languageId",optionsSource:"languages",matcher:"equals"},si={language:{infoType:"language",entityKind:"single",structure:{payloadFields:["label","name","code","notes"]},filterFields:[]},word:{infoType:"word",entityKind:"single",structure:{payloadFields:["label","lemma","notes","languageId"],connections:[{relationType:"word-language",role:"language",targetType:"language"}]},filterFields:[Ja]},sentence:{infoType:"sentence",entityKind:"single",structure:{payloadFields:["label","text","notes","languageId"],connections:[{relationType:"language-sentence",role:"language",targetType:"language"}]},filterFields:[Ja]},topic:{infoType:"topic",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},collection:{infoType:"collection",entityKind:"complex",structure:{payloadFields:["label","name","notes"]},filterFields:[]},person:{infoType:"person",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},institution:{infoType:"institution",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},collective:{infoType:"collective",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},orcid:{infoType:"orcid",entityKind:"single",structure:{payloadFields:["label","orcid","notes"]},filterFields:[{key:"orcid",label:"ORCID",kind:"text",path:"orcid",matcher:"contains"}]},address:{infoType:"address",entityKind:"single",structure:{payloadFields:["label","street","city","postalCode","country","notes"]},filterFields:[]},email:{infoType:"email",entityKind:"single",structure:{payloadFields:["label","email","address","notes"]},filterFields:[]},phone:{infoType:"phone",entityKind:"single",structure:{payloadFields:["label","phone","number","notes"]},filterFields:[]},media:{infoType:"media",entityKind:"single",structure:{payloadFields:["label","name","url","kind","notes"]},filterFields:[]},work:{infoType:"work",entityKind:"single",structure:{payloadFields:["label","title","subtitle","doi","isbn","issn","languageId","originalLanguageId","notes"]},filterFields:[Ja,{key:"originalLanguageId",labelKey:"originalLanguage",kind:"select",path:"originalLanguageId",optionsSource:"languages",matcher:"equals"},{key:"doi",labelKey:"doi",kind:"text",path:"doi",matcher:"contains"}]},geo:{infoType:"geo",entityKind:"single",structure:{payloadFields:["label","name","country","region","city","notes"]},filterFields:[]},music_piece:{infoType:"music_piece",entityKind:"single",structure:{payloadFields:["label","title","composer","notes"]},filterFields:[]},music_fragment:{infoType:"music_fragment",entityKind:"single",structure:{payloadFields:["label","title","text","notes"]},filterFields:[]},source:{infoType:"source",entityKind:"single",structure:{payloadFields:["label","title","sourceKind","locator","notes"],connections:[{relationType:"source-resource",role:"resource",targetType:"work"}]},filterFields:[{key:"sourceKind",labelKey:"sourceKind",kind:"select",path:"sourceKind",optionsSource:"sourceKinds",matcher:"equals"},{key:"locator",labelKey:"locator",kind:"text",path:"locator",matcher:"locator_contains"}]},citation:{infoType:"citation",entityKind:"single",structure:{payloadFields:["title","text","notes"],connections:[{relationType:"quote-language",role:"language",targetType:"language"},{relationType:"reference",role:"source",targetType:"source"}]},filterFields:[{key:"text",labelKey:"quote",kind:"text",path:"text",matcher:"contains"}]},computed:{infoType:"computed",entityKind:"complex",structure:{payloadFields:["label","title","definition","notes"]},filterFields:[]},translation:{infoType:"translation",entityKind:"connection",structure:{payloadFields:["note","tagIds"],connections:[{relationType:"translation",role:"wordA",targetType:"word"},{relationType:"translation",role:"wordB",targetType:"word"},{relationType:"word-language",role:"languageA",targetType:"language"},{relationType:"word-language",role:"languageB",targetType:"language"}]},filterFields:[{key:"languageAId",labelKey:"languageA",kind:"select",optionsSource:"languages",matcher:"equals"},{key:"languageBId",labelKey:"languageB",kind:"select",optionsSource:"languages",matcher:"equals"}]}},Cs={infoType:"default",entityKind:"single",structure:{payloadFields:["label","notes"]},filterFields:[]};function ni(t){return t?si[t]??Cs:Cs}function ii(t,s){return t.optionsSource==="languages"?s.languages.map(n=>({value:n.infoId,label:n.label})):t.optionsSource==="sourceKinds"?ai:[]}const Za=60,ri=500;function Js(t){return`cogita.info-selection:${t}`}function Ms(t){if(typeof window>"u")return{};const s=window.localStorage.getItem(Js(t));if(!s)return{};try{const n=JSON.parse(s);return!n||typeof n!="object"?{}:n}catch{return{}}}function oi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c,mode:x}){var m,je;const l=zs(),h=_a(),N=t.cogita.library.list,[ne,Y]=a.useState("any"),[U,S]=a.useState(""),[g,ie]=a.useState("relevance"),[P,b]=a.useState("details"),[q,E]=a.useState(!1),[G,k]=a.useState("idle"),[M,J]=a.useState([]),[ae,te]=a.useState(Za),[Fe,ge]=a.useState(null),[L,pe]=a.useState(()=>Ms(c)),[j,_]=a.useState({}),[he,W]=a.useState([]),[K,fe]=a.useState(null),[xe,ve]=a.useState(null),[Ae,Se]=a.useState(null),[Ue,Ke]=a.useState("idle"),[Ne,He]=a.useState([]),[at,et]=a.useState(""),[D,H]=a.useState(null),[We,Ce]=a.useState("idle"),[re,Re]=a.useState(null),[ze,Be]=a.useState(null),[De,Q]=a.useState("idle"),de=a.useMemo(()=>ti(t),[t]),$e=a.useMemo(()=>[{value:"relevance",label:N.sortRelevance},{value:"label_asc",label:N.sortLabelAsc},{value:"label_desc",label:N.sortLabelDesc},{value:"type_asc",label:N.sortTypeAsc},{value:"type_desc",label:N.sortTypeDesc}],[N.sortLabelAsc,N.sortLabelDesc,N.sortRelevance,N.sortTypeAsc,N.sortTypeDesc]);a.useEffect(()=>{pe(Ms(c)),_({}),E(!1)},[c]),a.useEffect(()=>{fs({libraryId:c}).then(d=>Se(d)).catch(()=>Se({items:[]}))},[c]),a.useEffect(()=>{pn({libraryId:c}).then(d=>He(d)).catch(()=>He([]))},[c]),a.useEffect(()=>{ks({libraryId:c,type:"language",filters:{sourceKind:"info"},limit:200}).then(d=>{const X=d.map(ye=>({infoId:ye.infoId??"",infoType:ye.entityType,label:ye.title})).filter(ye=>ye.infoId.length>0);W(X)}).catch(()=>W([]))},[c]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Js(c),JSON.stringify(L))},[c,L]);const R=a.useMemo(()=>ni(ne==="any"?null:ne),[ne]),V=a.useMemo(()=>new URLSearchParams(h.search),[h.search]),me=a.useMemo(()=>h.pathname.split("/").filter(Boolean),[h.pathname]),ke=me.findIndex(d=>d==="infos"),be=ke>=0&&(me[ke+1]??"").trim()||null,Le=ke>=0?(me[ke+2]??"").trim()==="checkcards"?"cards":"overview":"",Pe=be??((V.get("infoId")??"").trim()||null),Ve=be?Le:(V.get("infoView")??"overview").trim(),Ie=Ve==="overview"&&!!Pe,Ee=a.useMemo(()=>({language:N.typeFilterLanguage,languageA:N.typeFilterLanguageA,languageB:N.typeFilterLanguageB,originalLanguage:N.typeFilterOriginalLanguage,doi:N.typeFilterDoi,sourceKind:N.typeFilterSourceKind,locator:N.typeFilterLocator,quote:N.typeFilterQuote}),[N.typeFilterDoi,N.typeFilterLanguage,N.typeFilterLanguageA,N.typeFilterLanguageB,N.typeFilterLocator,N.typeFilterOriginalLanguage,N.typeFilterQuote,N.typeFilterSourceKind]),we=a.useMemo(()=>R.filterFields.map(d=>({...d,label:d.labelKey?Ee[d.labelKey]:d.label??d.key,options:ii(d,{languages:he})})),[Ee,he,R.filterFields]),st=a.useMemo(()=>we.some(d=>(j[d.key]??"").trim().length>0),[we,j]);a.useEffect(()=>{_({})},[ne]),a.useEffect(()=>{const d={sourceKind:"info"};if(st)for(const ye of we){const _e=(j[ye.key]??"").trim();_e&&(d[ye.path??ye.key]=_e)}k("loading");const X=window.setTimeout(()=>{ks({libraryId:c,type:ne==="any"?void 0:ne,query:U.trim()||void 0,filters:d,limit:ri}).then(ye=>{const _e=ye.map(ee=>({infoId:ee.infoId??"",infoType:ee.entityType,label:ee.title})).filter(ee=>ee.infoId.length>0);J(_e),k("ready")}).catch(()=>{J([]),k("ready")})},240);return()=>window.clearTimeout(X)},[st,c,U,ne,we,j]),a.useEffect(()=>{if(!Pe||Ve!=="overview"){fe(null),ve(null),Ke("idle");return}let d=!1;return Ke("loading"),Promise.all([Yt({libraryId:c,infoId:Pe}),fn({libraryId:c,itemType:"info",itemId:Pe}).catch(()=>null)]).then(([X,ye])=>{d||(fe(X),ve(ye),Ke("ready"))}).catch(()=>{d||(fe(null),ve(null),Ke("error"))}),()=>{d=!0}},[c,Pe,Ve]),a.useEffect(()=>{if(!Pe||Ve!=="overview"){Re(null),Be(null),Q("idle");return}let d=!1;return Q("loading"),Promise.all([Ws({libraryId:c,infoId:Pe}),Hs({libraryId:c,infoId:Pe})]).then(([X,ye])=>{d||(Re(X),Be(ye),Q("ready"))}).catch(()=>{d||(Re(null),Be(null),Q("error"))}),()=>{d=!0}},[c,Pe,Ve]);const qe=a.useMemo(()=>K?Ne.filter(d=>d.sourceInfoTypes.some(X=>X.toLowerCase()===K.infoType.toLowerCase())):[],[Ne,K]);a.useEffect(()=>{if(!K){et("");return}et(d=>{var X;return d&&qe.some(ye=>ye.approachKey===d)?d:((X=qe[0])==null?void 0:X.approachKey)??""})},[qe,K]),a.useEffect(()=>{if(!K||!at){H(null),Ce("idle");return}let d=!1;return Ce("loading"),bn({libraryId:c,infoId:K.infoId,approachKey:at}).then(X=>{d||(H(X),Ce("ready"))}).catch(()=>{d||(H(null),Ce("error"))}),()=>{d=!0}},[c,at,K]);const Xe=a.useMemo(()=>{const d=M.slice(),X=ye=>Ye(t,ye);return g==="relevance"?d:g==="label_asc"?d.sort((ye,_e)=>ye.label.localeCompare(_e.label)):g==="label_desc"?d.sort((ye,_e)=>_e.label.localeCompare(ye.label)):g==="type_asc"?d.sort((ye,_e)=>ye.infoType===_e.infoType?ye.label.localeCompare(_e.label):X(ye.infoType).localeCompare(X(_e.infoType))):d.sort((ye,_e)=>ye.infoType===_e.infoType?ye.label.localeCompare(_e.label):X(_e.infoType).localeCompare(X(ye.infoType)))},[t,M,g]),rt=a.useMemo(()=>Xe.slice(0,ae),[Xe,ae]),yt=rt.length<Xe.length,Je=a.useMemo(()=>new Set(Object.keys(L)),[L]),Ze=a.useMemo(()=>Object.values(L),[L]),ct=a.useMemo(()=>{const d=new Map;for(const X of Ze)d.set(X.infoType,(d.get(X.infoType)??0)+1);return Array.from(d.entries()).sort((X,ye)=>ye[1]-X[1]||X[0].localeCompare(ye[0]))},[Ze]),dt=a.useMemo(()=>{if(!Pe||!Ae)return 0;const d=new Set;for(const X of Ae.items)X.childItemType!=="info"||X.childItemId!==Pe||d.add([X.parentItemType,X.parentItemId,X.parentCheckType??"",X.parentDirection??""].join("|"));return d.size},[Ae,Pe]);a.useEffect(()=>{te(Za);const d=new Set(M.map(X=>X.infoId));ge(X=>X&&d.has(X)?X:null)},[M]);const It=d=>{pe(X=>({...X,[d.infoId]:{infoId:d.infoId,infoType:d.infoType,label:d.label}}))},nt=d=>{pe(X=>{if(!X[d])return X;const ye={...X};return delete ye[d],ye})},ot=(d,X)=>{if(X){It(d);return}nt(d.infoId)},Lt=d=>{l(`/cogita/library/${c}/infos/${encodeURIComponent(d)}`,{replace:!0})},ft=()=>{l(`/cogita/library/${c}/list`,{replace:!0})},tt=()=>{Pe&&l(`/cogita/library/${c}/edit/${encodeURIComponent(Pe)}`,{replace:!0})},it=Ze.length===1?((m=Ze[0])==null?void 0:m.infoId)??null:null,xt=N.selectionCount.replace("{count}",String(Ze.length)),St=x==="collection"?"grid":x==="detail"?"wide":P,Ge=ui(A),ht=xe?Math.max(0,Math.min(100,Math.round((xe.score??0)*100))):0,bt=xe?hi(xe,Ge):Ge.noKnownnessData;return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":St,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[Ie?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:Ge.kicker}),e.jsx("h2",{className:"cogita-card-title",children:K?li(K.payload,K.infoType,K.infoId):Ge.loading}),K?e.jsxs("p",{className:"cogita-card-subtitle",children:[Ye(t,K.infoType)," · ",K.infoId]}):null]}),e.jsxs("div",{className:"cogita-info-overview-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:ft,children:Ge.backToSearch}),e.jsx("button",{type:"button",className:"cta",onClick:tt,disabled:!Pe||Ue!=="ready",children:N.editInfo})]})]}),Ue==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:Ge.loading})}):Ue==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:Ge.loadError})}):K?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-info-overview-metrics",children:[e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:Ge.knownness}),e.jsxs("div",{className:"cogita-info-metric-value",children:[ht,"%"]}),e.jsx("div",{className:"cogita-info-progress","aria-hidden":"true",children:e.jsx("span",{style:{width:`${ht}%`}})}),e.jsx("p",{className:"cogita-library-hint",children:bt})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:Ge.reviews}),e.jsx("div",{className:"cogita-info-metric-value",children:(xe==null?void 0:xe.totalReviews)??0}),e.jsx("p",{className:"cogita-library-hint",children:Ge.correct.replace("{correct}",String((xe==null?void 0:xe.correctReviews)??0)).replace("{total}",String((xe==null?void 0:xe.totalReviews)??0))}),e.jsx("p",{className:"cogita-library-hint",children:xe!=null&&xe.lastReviewedUtc?`${Ge.lastReview}: ${di(xe.lastReviewedUtc,A)}`:Ge.noLastReview})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:Ge.linkedCards}),e.jsx("div",{className:"cogita-info-metric-value",children:dt}),e.jsx("p",{className:"cogita-library-hint",children:Ge.linkedCardsHint})]})]}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:Ge.checkcards}),De==="loading"?e.jsx("p",{className:"cogita-library-hint",children:Ge.loadingCheckcards}):De==="error"?e.jsx("p",{className:"cogita-library-hint",children:Ge.loadCheckcardsError}):e.jsxs("div",{className:"cogita-info-tree",children:[e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:Ge.checkcardCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(re==null?void 0:re.items.length)??0})]}),e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:Ge.dependencyCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(ze==null?void 0:ze.items.length)??0})]}),(je=re==null?void 0:re.items)!=null&&je.length?e.jsx("div",{className:"cogita-selection-overview",children:re.items.map((d,X)=>e.jsx("span",{className:"cogita-tag-chip",children:ci(d)},`checkcard:${X}:${d.cardId}:${d.checkType??""}:${d.direction??""}`))}):e.jsx("p",{className:"cogita-library-hint",children:Ge.noCheckcards})]})]}),qe.length>0?e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsxs("div",{className:"cogita-info-approach-header",children:[e.jsx("h3",{children:Ge.approach}),e.jsx("select",{value:at,onChange:d=>et(d.target.value),"aria-label":Ge.approach,children:qe.map(d=>e.jsx("option",{value:d.approachKey,children:d.label},d.approachKey))})]}),We==="loading"?e.jsx("p",{className:"cogita-library-hint",children:Ge.loadingApproach}):We==="error"?e.jsx("p",{className:"cogita-library-hint",children:Ge.loadApproachError}):D?e.jsx(Ra,{value:D.projection,emptyLabel:Ge.empty}):e.jsx("p",{className:"cogita-library-hint",children:Ge.noApproachData})]}):null,e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:Ge.payload}),e.jsx(Ra,{value:K.payload,emptyLabel:Ge.empty})]}),e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:Ge.links}),e.jsx(gi,{links:K.links,emptyLabel:Ge.noLinks})]})]})]}):null]})}):null,Ie?null:e.jsxs("section",{className:"cogita-library-search-surface",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":N.typeLabel,value:ne,onChange:d=>Y(d.target.value),children:de.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))}),e.jsx("input",{type:"text",value:U,onChange:d=>S(d.target.value),placeholder:N.searchPlaceholder}),e.jsx("select",{"aria-label":N.sortLabel,value:g,onChange:d=>ie(d.target.value),children:$e.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))}),e.jsxs("select",{"aria-label":N.viewLabel,value:P,onChange:d=>b(d.target.value),children:[e.jsx("option",{value:"details",children:N.viewDetails}),e.jsx("option",{value:"wide",children:N.viewWide}),e.jsx("option",{value:"grid",children:N.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:N.cardCount.replace("{shown}",String(rt.length)).replace("{total}",String(Xe.length))}),e.jsx("span",{children:G==="loading"?N.loading:N.ready})]}),e.jsxs("div",{className:"cogita-filters-toggle-row",children:[e.jsx("button",{type:"button",className:"ghost cogita-filters-toggle",onClick:()=>E(d=>!d),children:q?N.hideFilters:N.showFilters}),e.jsx("span",{className:"cogita-sidebar-note",children:N.filtersOptionalHint})]}),q&&we.length>0?e.jsx("section",{className:"cogita-library-filters cogita-library-filters--compact",children:e.jsx("div",{className:"cogita-filter-grid",children:we.map(d=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:d.label}),d.kind==="select"?e.jsxs("select",{value:j[d.key]??"",onChange:X=>_(ye=>({...ye,[d.key]:X.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),(d.options??[]).map(X=>e.jsx("option",{value:X.value,children:X.label},`${d.key}:${X.value}`))]}):e.jsx("input",{type:"text",value:j[d.key]??"",onChange:X=>_(ye=>({...ye,[d.key]:X.target.value}))})]},`type-filter:${d.key}`))})}):null,e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:xt}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{pe(d=>{const X={...d};for(const ye of rt)X[ye.infoId]={infoId:ye.infoId,infoType:ye.infoType,label:ye.label};return X})},disabled:rt.length===0,children:N.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>pe({}),disabled:Ze.length===0,children:N.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>it&&Lt(it),disabled:!it,title:it?void 0:N.openSelectedDisabled,children:N.openSelected})]})]}),Ze.length>0?e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:N.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:N.selectedStackHint}),e.jsx("div",{className:"cogita-selection-overview",children:ct.map(([d,X])=>e.jsxs("span",{className:"cogita-tag-chip",children:[e.jsx("span",{children:Ye(t,d)}),e.jsx("span",{className:"cogita-tag-count",children:X})]},`stack:type:${d}`))})]}):null,St==="details"?e.jsxs("div",{className:"cogita-details-grid",role:"table","aria-label":N.searchTitle,children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:N.detailColumnName}),e.jsx("span",{children:N.detailColumnType}),e.jsx("span",{children:N.detailColumnId}),e.jsx("span",{})]}),rt.length?rt.map(d=>{const X=Ye(t,d.infoType),ye=Je.has(d.infoId),_e=Fe===d.infoId;return e.jsxs("div",{className:`cogita-details-row ${_e||ye?"active":""}`,role:"row",onClick:()=>ge(d.infoId),children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:ye,onChange:ee=>ot(d,ee.target.checked),onClick:ee=>ee.stopPropagation()}),e.jsx("span",{})]}),e.jsx("span",{title:d.label,children:d.label}),e.jsx("span",{title:X,children:X}),e.jsx("span",{title:d.infoId,children:d.infoId}),e.jsx("button",{type:"button",className:"ghost cogita-details-open",onClick:ee=>{ee.stopPropagation(),Lt(d.infoId)},"aria-label":N.editInfo,children:">"})]},d.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:N.noMatch})})]}):e.jsx("div",{className:`cogita-card-list cogita-card-list--${St}`,"data-view":St,children:rt.length?rt.map(d=>{const X=Ye(t,d.infoType),ye=Je.has(d.infoId),_e=Fe===d.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":_e||ye,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:ye,onChange:ee=>ot(d,ee.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>ge(d.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:X}),e.jsx("h3",{className:"cogita-card-title",children:d.label}),e.jsx("p",{className:"cogita-card-subtitle",children:d.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Lt(d.infoId),children:N.editInfo})]})},d.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:N.noMatch})})}),yt?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>te(d=>d+Za),children:N.loadMore})}):null]})]})})})})}function li(t,s,n){if(t&&typeof t=="object"&&!Array.isArray(t)){const i=t,o=["title","name","label","value","text","quote","term"];for(const p of o){const f=i[p];if(typeof f=="string"&&f.trim())return f.trim()}}return`${s} · ${n}`}function ci(t){const s=[t.cardType];return t.infoType&&s.push(t.infoType),t.checkType&&s.push(t.checkType),t.direction&&s.push(t.direction),s.join(" · ")}function di(t,s){try{const n=s==="pl"?"pl-PL":s==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}catch{return t}}function ui(t){return t==="pl"?{kicker:"Informacja",backToSearch:"Wróć do wyszukiwania",loading:"Ładowanie informacji...",loadError:"Nie udało się wczytać informacji.",knownness:"Znajomość",reviews:"Sprawdzenia",correct:"Poprawne: {correct} / {total}",lastReview:"Ostatnie sprawdzenie",noLastReview:"Brak sprawdzeń",linkedCards:"Powiązane karty",linkedCardsHint:"Karty sprawdzające zależne od tej informacji",payload:"Treść informacji",links:"Powiązania",empty:"Brak danych",noLinks:"Brak powiązań",checkcards:"Karty sprawdzające",loadingCheckcards:"Ładowanie kart sprawdzających...",loadCheckcardsError:"Nie udało się wczytać kart sprawdzających.",noCheckcards:"Brak kart sprawdzających.",checkcardCount:"Liczba kart",dependencyCount:"Zależności (efektywne)",approach:"Podejście",loadingApproach:"Ładowanie widoku...",loadApproachError:"Nie udało się wczytać widoku.",noApproachData:"Brak danych widoku.",noKnownnessData:"Brak danych o znajomości",developmentStart:"Początek nauki",developmentGrowing:"Rozwój w toku",developmentStable:"Utrwalona wiedza",developmentStrong:"Bardzo dobra znajomość"}:t==="de"?{kicker:"Information",backToSearch:"Zur Suche",loading:"Information wird geladen...",loadError:"Information konnte nicht geladen werden.",knownness:"Kenntnisstand",reviews:"Abfragen",correct:"Richtig: {correct} / {total}",lastReview:"Letzte Abfrage",noLastReview:"Noch keine Abfragen",linkedCards:"Verknüpfte Karten",linkedCardsHint:"Prüfkarten, die von dieser Information abhängen",payload:"Inhalt",links:"Verknüpfungen",empty:"Keine Daten",noLinks:"Keine Verknüpfungen",checkcards:"Prüfkarten",loadingCheckcards:"Prüfkarten werden geladen...",loadCheckcardsError:"Prüfkarten konnten nicht geladen werden.",noCheckcards:"Keine Prüfkarten.",checkcardCount:"Anzahl Karten",dependencyCount:"Abhängigkeiten (effektiv)",approach:"Ansicht",loadingApproach:"Ansicht wird geladen...",loadApproachError:"Ansicht konnte nicht geladen werden.",noApproachData:"Keine Ansichtsdaten.",noKnownnessData:"Keine Kenntnisdaten",developmentStart:"Lernbeginn",developmentGrowing:"Aufbauphase",developmentStable:"Stabil",developmentStrong:"Sehr sicher"}:{kicker:"Info",backToSearch:"Back to search",loading:"Loading info...",loadError:"Failed to load info.",knownness:"Knownness",reviews:"Reviews",correct:"Correct: {correct} / {total}",lastReview:"Last review",noLastReview:"No reviews yet",linkedCards:"Linked checking cards",linkedCardsHint:"Checking cards depending on this info",payload:"Information",links:"Links",empty:"No data",noLinks:"No links",checkcards:"Checkcards",loadingCheckcards:"Loading checkcards...",loadCheckcardsError:"Failed to load checkcards.",noCheckcards:"No checkcards.",checkcardCount:"Checkcard count",dependencyCount:"Dependencies (effective)",approach:"Approach",loadingApproach:"Loading view...",loadApproachError:"Failed to load view.",noApproachData:"No view data.",noKnownnessData:"No knownness data",developmentStart:"Just started",developmentGrowing:"In progress",developmentStable:"Stable",developmentStrong:"Strong"}}function hi(t,s){return t.totalReviews<=0?s.noKnownnessData:t.totalReviews<3||t.score<.35?s.developmentStart:t.totalReviews<8||t.score<.65?s.developmentGrowing:t.score<.85?s.developmentStable:s.developmentStrong}function gi({links:t,emptyLabel:s}){return!t||Object.keys(t).length===0?e.jsx("p",{className:"cogita-library-hint",children:s}):e.jsx("div",{className:"cogita-info-tree",children:Object.entries(t).map(([n,i])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:n}),e.jsx("div",{className:"cogita-info-tree-value",children:Array.isArray(i)?i.length?e.jsx("div",{className:"cogita-selection-overview",children:i.map(o=>e.jsx("span",{className:"cogita-tag-chip",children:o},`${n}:${o}`))}):e.jsx("span",{className:"cogita-library-hint",children:"[]"}):i?e.jsx("span",{className:"cogita-tag-chip",children:i}):e.jsx("span",{className:"cogita-library-hint",children:"null"})})]},n))})}function Ra({value:t,emptyLabel:s}){if(t==null)return e.jsx("p",{className:"cogita-library-hint",children:s});if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)});if(Array.isArray(t))return t.length===0?e.jsx("p",{className:"cogita-library-hint",children:"[]"}):e.jsx("div",{className:"cogita-info-tree",children:t.map((n,i)=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:i+1}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(Ra,{value:n,emptyLabel:s})})]},i))});if(typeof t=="object"){const n=Object.entries(t);return n.length===0?e.jsx("p",{className:"cogita-library-hint",children:s}):e.jsx("div",{className:"cogita-info-tree",children:n.map(([i,o])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:i}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(Ra,{value:o,emptyLabel:s})})]},i))})}return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)})}const aa=5,Is=50,Ls=2,$s=[];function sa({libraryId:t,infoType:s,label:n,placeholder:i,value:o,onChange:p,values:f,onChangeMultiple:y,helperText:A,searchFailedText:C,createFailedText:c,createLabel:x,savingLabel:l,loadMoreLabel:h,inputRef:N,autoAdvance:ne,onCommit:Y,multiple:U}){const S=U?f??$s:$s,[g,ie]=a.useState(U?"":(o==null?void 0:o.label)??""),[P,b]=a.useState([]),[q,E]=a.useState(aa),[G,k]=a.useState(-1),[M,J]=a.useState(!1),[ae,te]=a.useState(!1),[Fe,ge]=a.useState(null),L=a.useRef(0),pe=a.useRef(new Map),j=a.useMemo(()=>U?g.trim().length>0:g.trim().length>0&&!o,[g,o,U]);a.useEffect(()=>{U||ie((o==null?void 0:o.label)??"")},[o,U]),a.useEffect(()=>{const W=g.trim();if(!W||W.length<Ls){b([]),J(!1),E(aa),k(-1),te(!1),ge(null);return}const K=W.toLowerCase(),fe=`${t}:${s}:${K}`,xe=pe.current.get(fe);if(xe){if(U&&S.length>0){const Ae=new Set(S.map(Se=>Se.id));b(xe.filter(Se=>!Ae.has(Se.id)))}else b(xe);E(aa),k(-1),J(xe.length>0),te(!1),ge(null);return}const ve=window.setTimeout(async()=>{const Ae=Date.now();L.current=Ae,te(!0),ge(null);try{const Se=await bs({libraryId:t,type:s,query:W,limit:Is});if(L.current!==Ae)return;const Ue=Se.slice(0,Is).map(Ke=>({id:Ke.infoId,label:Ke.label,infoType:Ke.infoType}));if(pe.current.set(fe,Ue),U&&S.length>0){const Ke=new Set(S.map(Ne=>Ne.id));b(Ue.filter(Ne=>!Ke.has(Ne.id)))}else b(Ue);E(aa),k(-1),J(!0)}catch{if(L.current!==Ae)return;ge(C??"Search failed.")}finally{L.current===Ae&&te(!1)}},250);return()=>window.clearTimeout(ve)},[t,s,g,S]);const _=W=>{if(U){const K=S.some(fe=>fe.id===W.id)?S:[...S,W];y==null||y(K),ie(""),J(!1),k(-1);return}p==null||p(W),ie(W.label),J(!1),k(-1),ne&&(Y==null||Y())},he=async()=>{const W=g.trim();if(W){te(!0),ge(null);try{const K=await Qs({libraryId:t,infoType:s,payload:{label:W}}),fe={id:K.infoId,label:W,infoType:K.infoType};if(W.length>=Ls){const xe=`${t}:${s}:${W.toLowerCase()}`,ve=pe.current.get(xe)??[];pe.current.set(xe,[fe,...ve])}if(U){y==null||y([...S,fe]),ie(""),J(!1),k(-1);return}p==null||p(fe),J(!1),k(-1),ne&&(Y==null||Y())}catch{ge(c??"Create failed.")}finally{te(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:n}),e.jsx("input",{value:g,placeholder:i,onChange:W=>{ie(W.target.value),!U&&o&&(p==null||p(null))},onKeyDown:W=>{if(W.key==="ArrowDown"){if(W.preventDefault(),!P.length)return;J(!0),k(K=>{const fe=Math.min(P.length,q)-1,xe=K<0?0:Math.min(K+1,fe);return xe===fe&&P.length>q?(E(ve=>Math.min(ve+aa,P.length)),Math.min(K+1,Math.min(P.length,q+aa)-1)):xe});return}if(W.key==="ArrowUp"){if(W.preventDefault(),!P.length)return;J(!0),k(K=>K<=0?0:K-1);return}if(W.key==="Enter"){if(W.preventDefault(),G>=0&&P[G]){_(P[G]);return}if(j){he();return}}},onFocus:()=>{P.length>0&&J(!0)},autoComplete:"off",ref:N})]}),U&&S.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:S.map(W=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>y==null?void 0:y(S.filter(K=>K.id!==W.id)),children:[W.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},W.id))}),A&&e.jsx("p",{className:"cogita-help",children:A}),Fe&&e.jsx("p",{className:"cogita-error",children:Fe}),M&&P.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[P.slice(0,q).map((W,K)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":K===G,onClick:()=>_(W),children:[e.jsx("strong",{children:W.label}),e.jsx("span",{children:W.infoType})]},W.id)),q<P.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>E(W=>Math.min(W+aa,P.length)),children:h??"Load more"})]}),j&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:he,disabled:ae,children:ae?l??"Saving...":x??`Create new ${s}`})]})}function mi(t){return t==null?"":typeof t=="string"?t:JSON.stringify(t)}function Rs(t,s){if(!t||typeof t!="object")return s;const n=t,i=[n.label,n.name,n.title,n.text,n.orcid,n.email,n.number];for(const o of i)if(typeof o=="string"&&o.trim())return o.trim();return s}function pi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c,editInfoId:x}){const{libraryName:l}=Ot(c),h=!!x,[N,ne]=a.useState([]),[Y,U]=a.useState("word"),[S,g]=a.useState({}),[ie,P]=a.useState({}),[b,q]=a.useState({}),[E,G]=a.useState({}),[k,M]=a.useState(null),[J,ae]=a.useState("idle"),te=a.useMemo(()=>N.find(j=>j.infoType===Y),[Y,N]),Fe=a.useMemo(()=>N.map(j=>({value:j.infoType,label:Ye(t,j.infoType)})),[t,N]);a.useEffect(()=>{let j=!1;return yn({libraryId:c}).then(_=>{var he;if(!j&&(ne(_),!h)){const W=(he=_[0])==null?void 0:he.infoType;W&&U(W)}}).catch(()=>{j||ne([])}),()=>{j=!0}},[h,c]),a.useEffect(()=>{if(!te)return;const j={},_={},he={},W={};for(const K of te.payloadFields)j[K.key]="";for(const K of te.linkFields)K.multiple?he[K.key]=[]:_[K.key]=null,K.targetTypes.length>0&&(W[K.key]=K.targetTypes[0]);g(j),P(_),q(he),G(W)},[te==null?void 0:te.infoType]),a.useEffect(()=>{if(!h||!x||N.length===0)return;let j=!1;return ae("loading"),M(null),(async()=>{const he=await Yt({libraryId:c,infoId:x});if(j)return;const W=he.infoType;U(W);const K=N.find(Ne=>Ne.infoType===W);if(!K){ae("idle");return}const fe=he.payload??{},xe={};for(const Ne of K.payloadFields)xe[Ne.key]=mi(fe[Ne.key]);g(xe);const ve=he.links??{}??{},Ae={},Se={},Ue={},Ke=[];for(const Ne of K.linkFields){Ne.targetTypes.length>0&&(Ue[Ne.key]=Ne.targetTypes[0]);const He=ve[Ne.key];if(Ne.multiple){const at=Array.isArray(He)?He.filter(et=>typeof et=="string"):[];Se[Ne.key]=[];for(const et of at)Ke.push(Yt({libraryId:c,infoId:et}).then(D=>{if(j)return;const H={id:et,infoType:D.infoType,label:Rs(D.payload,et)};Se[Ne.key]=[...Se[Ne.key],H]}).catch(()=>{}))}else{const at=typeof He=="string"?He:null;Ae[Ne.key]=null,at&&Ke.push(Yt({libraryId:c,infoId:at}).then(et=>{j||(Ae[Ne.key]={id:at,infoType:et.infoType,label:Rs(et.payload,at)})}).catch(()=>{}))}}await Promise.all(Ke),!j&&(P(Ae),q(Se),G(Ne=>({...Ne,...Ue})),ae("idle"))})().catch(()=>{j||(M("Failed to load info details."),ae("idle"))}),()=>{j=!0}},[x,h,c,N]);const ge=async()=>{var W;if(!te)return;const j={};for(const K of te.payloadFields){const fe=(S[K.key]??"").trim();if(!fe){if(K.required){M(`Field '${K.label}' is required.`);return}continue}if(K.inputType==="json")try{j[K.key]=JSON.parse(fe)}catch{M(`Field '${K.label}' must be valid JSON.`);return}else j[K.key]=fe}const _={};for(const K of te.linkFields)if(K.multiple){const fe=(b[K.key]??[]).map(xe=>xe.id);if(K.required&&fe.length===0){M(`Link '${K.label}' is required.`);return}fe.length>0&&(_[K.key]=fe)}else{const fe=((W=ie[K.key])==null?void 0:W.id)??null;if(K.required&&!fe){M(`Link '${K.label}' is required.`);return}fe&&(_[K.key]=fe)}const he=Object.keys(_).length>0;ae("saving"),M(null);try{if(h&&x)await xn({libraryId:c,infoId:x,payload:j,links:he?_:void 0}),M("Info updated.");else{await Qs({libraryId:c,infoType:Y,payload:j,links:he?_:void 0}),M("Info saved.");const K={};for(const ve of te.payloadFields)K[ve.key]="";g(K);const fe={},xe={};for(const ve of te.linkFields)ve.multiple?xe[ve.key]=[]:fe[ve.key]=null;P(ve=>({...ve,...fe})),q(ve=>({...ve,...xe}))}}catch{M("Failed to save info.")}finally{ae("idle")}},L=j=>{const _=S[j.key]??"",he=j.inputType==="textarea"||j.inputType==="json";return e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:j.label}),he?e.jsx("textarea",{rows:j.inputType==="json"?8:4,value:_,onChange:W=>g(K=>({...K,[j.key]:W.target.value})),placeholder:j.key}):e.jsx("input",{type:"text",value:_,onChange:W=>g(K=>({...K,[j.key]:W.target.value})),placeholder:j.key})]},`payload:${j.key}`)},pe=j=>{const _=E[j.key]??j.targetTypes[0];return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:j.label}),j.targetTypes.length>1?e.jsx("select",{value:_,onChange:he=>G(W=>({...W,[j.key]:he.target.value})),children:j.targetTypes.map(he=>e.jsx("option",{value:he,children:Ye(t,he)},`${j.key}:${he}`))}):null,j.multiple?e.jsx(sa,{libraryId:c,infoType:_,label:j.label,placeholder:j.key,multiple:!0,values:b[j.key]??[],onChangeMultiple:he=>q(W=>({...W,[j.key]:he})),searchFailedText:"Search failed",createFailedText:"Create failed"}):e.jsx(sa,{libraryId:c,infoType:_,label:j.label,placeholder:j.key,value:ie[j.key]??null,onChange:he=>P(W=>({...W,[j.key]:he})),searchFailedText:"Search failed",createFailedText:"Create failed"})]},`link:${j.key}`)};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:h?"Edit info":"Create info"}),e.jsx("h1",{className:"cogita-library-title",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:"Specification-driven editor"})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:`/#/cogita/library/${c}/list`,children:"Back to list"})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-panel",children:[h?null:e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Info type"}),e.jsx("select",{value:Y,onChange:j=>U(j.target.value),children:Fe.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))})]}),J==="loading"?e.jsx("p",{children:"Loading..."}):null,te?e.jsxs("div",{className:"cogita-form-grid",children:[te.payloadFields.map(L),te.linkFields.map(pe)]}):e.jsx("p",{children:"No specification found for this info type."}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:ge,disabled:J==="saving"||!te,children:J==="saving"?"Saving...":h?"Update info":"Create info"})}),k?e.jsx("p",{className:"cogita-library-subtitle",children:k}):null]})})})]})})}const Es=t=>/\s/.test(t),Ea=t=>/[\p{L}\p{N}]/u.test(t),As=(t,s)=>{const n=s>0?t[s-1]:"",i=s<t.length?t[s]:"";if(!n||!i)return 0;const o=Es(n),p=Es(i);if(o||p)return 3;const f=Ea(n),y=Ea(i);return f!==y?2:!f&&!y?1:0},es=(t,s,n,i,o)=>{const p=Math.max(i-s,n-i);for(let f=0;f<=p;f+=1){const y=i-f;if(y>=s&&y<=n&&As(t,y)>=o)return y;const A=i+f;if(A>=s&&A<=n&&As(t,A)>=o)return A}return null},ts=(t,s)=>{const n=s>0?t[s-1]:"",i=s<t.length?t[s]:"";return!n||!i?!0:Ea(n)!==Ea(i)},fi=(t,s,n,i)=>{const o=n-s,p=s+i,f=n-i;if(o<=i*2||f<=p)return null;const y=Math.floor((s+n)/2),A=es(t,p,f,y,3);if(A!==null&&ts(t,A))return A;const C=es(t,p,f,y,2);if(C!==null&&ts(t,C))return C;const c=es(t,p,f,y,1);return c!==null&&ts(t,c)?c:null},ma=(t,s)=>{const n=Math.max(1,7),i=Math.max(n,13),o={},p=(A,C,c,x,l)=>{const h=String(x),N={id:h,start:A,end:C,text:t.slice(A,C),depth:c,index:x,parentId:l};if(o[h]=N,C-A>i){let Y=fi(t,A,C,n);if(Y!==null&&Y>A&&Y<C){const U=p(A,Y,c+1,x*2+1,h),S=p(Y,C,c+1,x*2+2,h);N.leftId=U.id,N.rightId=S.id}}return N},f=p(0,t.length,0,0),y=Object.values(o).sort((A,C)=>C.depth-A.depth||A.start-C.start).map(A=>A.id);return{text:t,rootId:f.id,nodes:o,order:y}},ha=(t,s,n,i,o,p,f)=>{const y=p==="reverse"?t.order.slice().sort((A,C)=>t.nodes[C].start-t.nodes[A].start||t.nodes[C].depth-t.nodes[A].depth):t.order;for(const A of y){if(f&&A===f||s.has(A))continue;const C=t.nodes[A];if(C){if(o&&(C.leftId||C.rightId)){const c=C.leftId?n[C.leftId]??0:i,x=C.rightId?n[C.rightId]??0:i;if((c+x)/2<i)continue}return C}}return null},Zs=(t,s)=>({before:t.slice(0,s.start),fragment:t.slice(s.start,s.end),after:t.slice(s.end)});function bi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c}){const x=`/#/cogita/library/${c}`,[l,h,N]=Bs([]),[ne,Y,U]=Ds([]),[S,g]=a.useState(null),[ie,P]=a.useState(null),[b,q]=a.useState(null),[E,G]=a.useState(null),k=a.useMemo(()=>l.find(L=>L.id===S)??null,[l,S]);a.useEffect(()=>{let L=!0;return vn({libraryId:c}).then(pe=>{if(!L)return;const j=pe.nodes.map(_=>{var he,W,K;return{id:_.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:_.payload&&typeof _.payload=="object"&&"label"in _.payload?String(_.payload.label):"Item",nodeType:_.nodeType,itemType:((he=_.payload)==null?void 0:he.itemType)??"info",itemId:((W=_.payload)==null?void 0:W.itemId)??null,infoType:((K=_.payload)==null?void 0:K.infoType)??null}}});h(j),Y(pe.edges.map(_=>({id:_.edgeId,source:_.fromNodeId,target:_.toNodeId})))}).catch(()=>{L&&(h([]),Y([]))}),()=>{L=!1}},[c]),a.useEffect(()=>{wn({libraryId:c}).then(P).catch(()=>P(null))},[c,l,ne]);const M=a.useCallback(L=>{Y(pe=>_s(L,pe))},[]),J=()=>{const L=crypto.randomUUID();h(pe=>[...pe,{id:L,type:"default",position:{x:140+pe.length*40,y:120+pe.length*30},data:{label:t.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},ae=()=>{const L=crypto.randomUUID();h(pe=>[...pe,{id:L,type:"default",position:{x:180+pe.length*40,y:160+pe.length*30},data:{label:t.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},te=async()=>{q(null);try{const L=l.map(j=>({nodeId:j.id,nodeType:j.data.nodeType,payload:{itemType:j.data.itemType,itemId:j.data.itemId??null,label:j.data.label,infoType:j.data.infoType??null}})),pe=ne.map(j=>({edgeId:j.id,fromNodeId:j.source,toNodeId:j.target}));await jn({libraryId:c,nodes:L,edges:pe}),q(t.cogita.library.graph.saveSuccess)}catch{q(t.cogita.library.graph.saveFail)}},Fe=L=>{k&&h(pe=>pe.map(j=>j.id===k.id?{...j,data:{...j.data,itemId:(L==null?void 0:L.infoId)??null,itemType:"collection",infoType:"collection",label:(L==null?void 0:L.label)??t.cogita.library.infoTypes.collection}}:j))},ge=L=>{k&&h(pe=>pe.map(j=>j.id===k.id?{...j,data:{...j.data,itemId:(L==null?void 0:L.infoId)??null,itemType:"info",infoType:(L==null?void 0:L.infoType)??null,label:(L==null?void 0:L.label)??t.cogita.library.infoTypes.any}}:j))};return a.useEffect(()=>{if(!k||k.data.nodeType!=="info"||k.data.infoType!=="citation"||!k.data.itemId){G(null);return}let L=!0;return Yt({libraryId:c,infoId:k.data.itemId}).then(pe=>{if(!L)return;const j=pe.payload,_=(j==null?void 0:j.text)??"";if(!_){G(null);return}const he=ma(_),W=Object.values(he.nodes).sort((K,fe)=>K.depth-fe.depth||K.start-fe.start).map(K=>({id:K.id,text:K.text,depth:K.depth}));G({title:(j==null?void 0:j.title)??k.data.label,fragments:W})}).catch(()=>G(null)),()=>{L=!1}},[c,k]),e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:t.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:x,children:t.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:te,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:J,children:t.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ae,children:t.cogita.library.actions.addInfo}),ie?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(ie.totalCollections))})}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(gs,{nodes:l,edges:ne,onNodesChange:N,onEdgesChange:U,onConnect:M,onNodeClick:(L,pe)=>g(pe.id),fitView:!0,children:[e.jsx(ms,{gap:18,size:1}),e.jsx(ps,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),k?e.jsxs("div",{className:"cogita-graph-inspector",children:[k.data.nodeType==="collection"?e.jsx(sa,{libraryId:c,infoType:"collection",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:k.data.itemId?{id:k.data.itemId,label:k.data.label,infoType:"collection"}:null,onChange:Fe,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.collection),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}):e.jsx(sa,{libraryId:c,infoType:"any",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:k.data.itemId?{id:k.data.itemId,label:k.data.label,infoType:k.data.infoType??void 0}:null,onChange:ge,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.any),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),E?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:E.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:E.fragments.map(L=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:L.id}),e.jsx("span",{children:L.text})]},L.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}function as(t){return[t.cardId,t.checkType??"",t.direction??""].join("|")}function yi(t){return[t.parentItemId,t.parentCheckType??"",t.parentDirection??""].join("|")}function ss(t){const s=t.checkType??"info";return t.direction?`${s} / ${t.direction}`:s}function xi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c,infoId:x}){const[l,h]=a.useState(x),[N,ne]=a.useState([]),[Y,U]=a.useState([]),[S,g]=a.useState("loading"),[ie,P]=a.useState(null);a.useEffect(()=>{let k=!1;return g("loading"),Promise.all([Yt({libraryId:c,infoId:x}).catch(()=>null),Ws({libraryId:c,infoId:x}),Hs({libraryId:c,infoId:x})]).then(([M,J,ae])=>{if(k)return;const te=(M==null?void 0:M.payload)??{},Fe=typeof te.title=="string"&&te.title||typeof te.label=="string"&&te.label||typeof te.name=="string"&&te.name||x;h(Fe),ne(J.items),U(ae.items),g("ready")}).catch(()=>{k||(ne([]),U([]),g("error"))}),()=>{k=!0}},[c,x]);const b=a.useMemo(()=>N.map((k,M)=>{const J=as(k),ae=M%3,te=Math.floor(M/3);return{id:J,position:{x:40+ae*280,y:40+te*120},draggable:!1,selectable:!0,data:{label:k.label,subtitle:ss(k),checkType:k.checkType??"info",direction:k.direction??null},style:{width:250,borderRadius:10,border:"1px solid rgba(120,170,220,0.22)",background:"rgba(8,20,34,0.88)",color:"#e8f2ff",padding:8}}}),[N]),q=a.useMemo(()=>new Map(N.map(k=>[as(k),k])),[N]),E=a.useMemo(()=>{const k=[];for(const M of Y){const J=yi({parentItemId:M.parentItemId,parentCheckType:M.parentCheckType,parentDirection:M.parentDirection}),ae=[M.childItemId,M.childCheckType??"",M.childDirection??""].join("|");!q.has(J)||!q.has(ae)||k.push({id:`${J}->${ae}`,source:J,target:ae,selectable:!1,animated:!1,style:{stroke:"rgba(148, 202, 248, 0.7)"}})}return k},[q,Y]),G=a.useMemo(()=>ie?q.get(ie)??null:null,[q,ie]);return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-info-checkcards-page",children:[e.jsxs("header",{className:"cogita-info-checkcards-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.infoTypes.citation}),e.jsx("h2",{className:"cogita-card-title",children:l}),e.jsx("p",{className:"cogita-card-subtitle",children:x})]}),e.jsxs("div",{className:"cogita-selection-overview",children:[e.jsx("span",{className:"cogita-tag-chip",children:`Cards: ${N.length}`}),e.jsx("span",{className:"cogita-tag-chip",children:`Dependencies: ${Y.length}`})]})]}),S==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading checkcards..."})}):S==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load checkcards."})}):e.jsxs("div",{className:"cogita-info-checkcards-layout",children:[e.jsx("div",{className:"cogita-info-checkcards-graph",children:e.jsxs(gs,{nodes:b,edges:E,fitView:!0,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!0,onNodeClick:(k,M)=>P(M.id),panOnDrag:!0,children:[e.jsx(ms,{}),e.jsx(ps,{showInteractive:!1})]})}),e.jsxs("aside",{className:"cogita-info-checkcards-panel",children:[e.jsx("h3",{children:"Checking cards"}),e.jsx("div",{className:"cogita-info-tree",children:N.map(k=>{const M=as(k),J=ie===M;return e.jsxs("button",{type:"button",className:`ghost cogita-checkcard-row ${J?"active":""}`,onClick:()=>P(M),children:[e.jsx("span",{children:k.label}),e.jsx("small",{children:ss(k)})]},M)})}),G?e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[e.jsx("h4",{children:G.label}),e.jsx("p",{children:ss(G)}),e.jsx("p",{className:"cogita-card-subtitle",children:G.description})]}):null]})]})]})})})})})}function vi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c,collectionId:x}){const{libraryName:l}=Ot(c),[h,N]=a.useState([]),[ne,Y]=a.useState("loading"),[U,S]=a.useState("idle"),g=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ie=`/#/cogita/library/${c}`,P=()=>{Y("loading"),Ys({libraryId:c}).then(E=>{N(E),Y("idle")}).catch(()=>{N([]),Y("error")})};a.useEffect(()=>{P()},[c]);const b=async E=>{try{await Gs({libraryId:c,shareId:E}),P()}catch{P()}},q=async E=>{const G=`${g}/${E}`;try{await navigator.clipboard.writeText(G),S("copied")}catch{S("failed")}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:ie,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${ie}/collections`,children:t.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[ne==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):ne==="error"?e.jsx("p",{children:t.cogita.library.revision.shareError}):h.filter(E=>!x||E.collectionId===x).length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:h.filter(E=>!x||E.collectionId===x).map(E=>e.jsxs("div",{className:"cogita-share-row","data-state":E.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:E.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(E.createdUtc).toLocaleString(),E.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]}),E.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${g}/${E.shareCode}`}):null]}),E.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[E.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>q(E.shareCode),children:t.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>b(E.shareId),children:t.cogita.library.revision.shareRevokeAction})]})]},E.shareId))}),U==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):U==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function wi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c}){const{libraryName:x}=Ot(c),[l,h]=a.useState(null),[N,ne]=a.useState(null),[Y,U]=a.useState(null),[S,g]=a.useState(null),[ie,P]=a.useState(null),[b,q]=a.useState(null),E=a.useRef(null),G=J=>{if(!Number.isFinite(J))return"0 B";if(J<1024)return`${J} B`;const ae=J/1024;if(ae<1024)return`${ae.toFixed(1)} KB`;const te=ae/1024;return te<1024?`${te.toFixed(1)} MB`:`${(te/1024).toFixed(1)} GB`},k=async()=>{h(null),P({loadedBytes:0,totalBytes:null,percent:null});try{h(t.cogita.library.overview.exporting);const J=await kn(c,P),ae=URL.createObjectURL(J),te=document.createElement("a");te.href=ae,te.download=`cogita-library-${x||c}.json`,te.click(),URL.revokeObjectURL(ae),h(t.cogita.library.overview.exportReady)}catch{h(t.cogita.library.overview.exportFail)}finally{P(J=>J??{loadedBytes:0,totalBytes:null,percent:null})}},M=async J=>{var te;ne(null),U(null),g(null);const ae=(te=J.target.files)==null?void 0:te[0];if(ae)try{ne(t.cogita.library.overview.importing),q({loadedBytes:0,totalBytes:ae.size,percent:0});const Fe=await Nn(c,ae,q,ge=>{const L=ge.stage==="infos"?t.cogita.library.overview.importStageInfos:ge.stage==="connections"?t.cogita.library.overview.importStageConnections:t.cogita.library.overview.importStageCollections;g(t.cogita.library.overview.importLiveProgress.replace("{stage}",L).replace("{done}",String(ge.processed)).replace("{total}",String(ge.total)).replace("{infos}",String(ge.infos)).replace("{connections}",String(ge.connections)).replace("{collections}",String(ge.collections)))});U({infos:Fe.infosImported,connections:Fe.connectionsImported,collections:Fe.collectionsImported}),ne(t.cogita.library.overview.importDone)}catch(Fe){const ge=Fe instanceof Tn&&Fe.message?` ${Fe.message}`:"";ne(`${t.cogita.library.overview.importFail}${ge}`)}finally{E.current&&(E.current.value="")}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:k,children:t.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[t.cogita.library.overview.import,e.jsx("input",{ref:E,type:"file",accept:"application/json",onChange:M})]})]}),ie?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:ie.percent??void 0,max:ie.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.exportProgress.replace("{loaded}",G(ie.loadedBytes)).replace("{total}",ie.totalBytes?G(ie.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,b?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:b.percent??void 0,max:b.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.importProgress.replace("{loaded}",G(b.loadedBytes)).replace("{total}",b.totalBytes?G(b.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,l?e.jsx("p",{className:"cogita-help",children:l}):null,N?e.jsx("p",{className:"cogita-help",children:N}):null,S?e.jsx("p",{className:"cogita-help",children:S}):null,Y?e.jsx("p",{className:"cogita-help",children:t.cogita.library.overview.importSummary.replace("{infos}",String(Y.infos)).replace("{connections}",String(Y.connections)).replace("{collections}",String(Y.collections))}):null]})]})})})]})})}function ji({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c}){const{libraryName:x}=Ot(c),[l,h]=a.useState(""),[N,ne]=a.useState([]),Y=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:l,onChange:U=>h(U.target.value),placeholder:t.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const U=l.trim();U&&(ne(S=>[{id:Y(),name:U},...S]),h(""))},children:t.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[N.length===0?e.jsx("p",{children:t.cogita.library.modules.storyboardsEmpty}):null,N.map(U=>e.jsx("button",{type:"button",className:"ghost",children:U.name},U.id))]})]})]})})})]})})}function ki({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c}){const{libraryName:x}=Ot(c),[l,h]=a.useState(""),[N,ne]=a.useState([]),Y=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:l,onChange:U=>h(U.target.value),placeholder:t.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const U=l.trim();U&&(ne(S=>[{id:Y(),name:U},...S]),h(""))},children:t.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[N.length===0?e.jsx("p",{children:t.cogita.library.modules.textsEmpty}):null,N.map(U=>e.jsx("button",{type:"button",className:"ghost",children:U.name},U.id))]})]})]})})})]})})}function Ps({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c}){const{libraryName:x}=Ot(c),l=`/#/cogita/library/${c}`,[h,N]=a.useState(""),[ne,Y]=a.useState([]),[U,S]=a.useState("idle"),[g,ie]=a.useState(0),[P,b]=a.useState(null);a.useEffect(()=>{S("loading");const E=window.setTimeout(()=>{wa({libraryId:c,query:h.trim()||void 0,limit:30}).then(G=>{Y(G.items),ie(G.total),b(G.nextCursor??null),S("ready")}).catch(()=>{Y([]),ie(0),b(null),S("ready")})},240);return()=>window.clearTimeout(E)},[c,h]);const q=async()=>{if(P){S("loading");try{const E=await wa({libraryId:c,query:h.trim()||void 0,limit:30,cursor:P});Y(G=>[...G,...E.items]),b(E.nextCursor??null),ie(E.total),S("ready")}catch{S("ready")}}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:l,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${l}/collections/new`,children:t.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:h,onChange:E=>N(E.target.value),placeholder:t.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:t.cogita.library.collections.countLabel.replace("{shown}",String(ne.length)).replace("{total}",String(g||ne.length))}),e.jsx("span",{children:U==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:ne.length?ne.map(E=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${l}/collections/${E.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:E.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.collections.itemCountLabel.replace("{count}",String(E.itemCount))," ·"," ",E.notes||t.cogita.library.collections.noNotes]})]})},E.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${l}/collections/new`,children:t.cogita.library.collections.emptyAction})]})}),P?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:q,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const ce=t=>`${t.cardType}:${t.cardId}:${t.checkType??""}:${t.direction??""}`,Dt=(t,s,n,i)=>`${t}:${s}:${n??""}:${i??""}`;function Ni({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c,collectionId:x}){Ot(c);const l=`/#/cogita/library/${c}`,[h,N]=a.useState(t.cogita.library.collections.defaultName),[ne,Y]=a.useState(null),[U,S]=a.useState(0),[g,ie]=a.useState([]),[P,b]=a.useState("idle"),[q,E]=a.useState(null),G=a.useMemo(()=>t.cogita.library.list.cardCount.replace("{shown}",String(g.length)).replace("{total}",String(U||g.length)),[t,g.length,U]);a.useEffect(()=>{Va(c,x).then(M=>{N(M.name),Y(M.notes??null),S(M.itemCount)}).catch(()=>{N(t.cogita.library.collections.defaultName),Y(null)})},[c,x]),a.useEffect(()=>{b("loading"),$a({libraryId:c,collectionId:x,limit:40}).then(M=>{ie(M.items),E(M.nextCursor??null),S(M.total),b("ready")}).catch(()=>{ie([]),E(null),b("ready")})},[c,x]);const k=async()=>{if(q){b("loading");try{const M=await $a({libraryId:c,collectionId:x,limit:40,cursor:q});ie(J=>[...J,...M.items]),E(M.nextCursor??null),S(M.total),b("ready")}catch{b("ready")}}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:h}),e.jsx("p",{className:"cogita-library-subtitle",children:ne||t.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:l,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${l}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${l}/collections/${x}/graph`,children:t.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${l}/collections/${x}/revision`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:G}),e.jsx("span",{children:P==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:g.length?g.map(M=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:M.cardType==="vocab"?t.cogita.library.list.cardTypeVocab:M.cardType==="connection"?t.cogita.library.list.cardTypeConnection:t.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:M.label}),e.jsx("p",{className:"cogita-card-subtitle",children:M.description})]})},ce(M))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.collections.noCards})})}),q?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:k,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${l}/collections/${x}/revision`,children:t.cogita.library.actions.startRevision})})]})})]})})})]})})}const _t=t=>{if(!t.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const s=t.length,n=t.filter(p=>p.correct).length,i=Oa(ys(t));return{score:Math.round(Math.max(0,Math.min(100,i.knowness*100))*100)/100,total:s,correct:n,lastReviewedUtc:i.lastReviewedUtc??null}},Ti=t=>{if(t.maskBase64)try{const s=Sn(t.maskBase64);if(!s.length)return t.correct?1:0;const n=s.reduce((i,o)=>i+o,0);return Math.max(0,Math.min(1,n/s.length/255))}catch{return t.correct?1:0}return t.correct?1:0},ys=t=>t.map(s=>({correctness:Ti(s),createdUtc:s.createdUtc})),Oa=(t,s=Date.now())=>{var U;if(!t.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const i=t.slice().sort((S,g)=>S.createdUtc.localeCompare(g.createdUtc)).slice(-5),o=i.reduce((S,g)=>S+g.correctness,0)/i.length,p=5,f=2,y=.15;let A=0,C=0;for(let S=0;S<i.length;S+=1){const g=new Date(i[S].createdUtc).getTime(),ie=S===i.length-1?s:new Date(i[S+1].createdUtc).getTime(),P=Math.max(0,(ie-g)/(1e3*60)),b=1-Math.exp(-P/p);A+=b,i[S].correctness>.5&&(C+=y)}let c=o*A*f+C;const x=((U=i[i.length-1])==null?void 0:U.createdUtc)??null,l=x?Math.max(0,(s-new Date(x).getTime())/(1e3*60)):0,N=1/(1+Math.log1p(l/60));return c*=N,i.length===1&&i[0].correctness>.5&&(c+=5.44*Math.exp(-l/2)),{knowness:c,avgCorrectness:o,lastReviewedUtc:x}},ja=t=>{const s=t.slice();for(let n=s.length-1;n>0;n-=1){const i=Math.floor(Math.random()*(n+1));[s[n],s[i]]=[s[i],s[n]]}return s},La=t=>t[Math.floor(Math.random()*t.length)],Si=(t,s)=>{const n=new Map;return t.forEach(i=>n.set(i,Math.random())),t.sort((i,o)=>{const p=s(i)-s(o);return p!==0?p:(n.get(i)??0)-(n.get(o)??0)})},qa=(t,s,n,i,o)=>{if(!t.length)return null;const p=t.filter(y=>!(o!=null&&o.has(ce(y))));if(p.length===0)return null;const f=p.filter(y=>ce(y)!==n);return La(f.length?f:p)},Ci=(t,s,n,i,o)=>{if(!t.length)return null;let p=Number.POSITIVE_INFINITY;for(const C of t){const c=ce(C);if(n.has(c))continue;const x=s[c]??1;x<p&&(p=x)}if(!Number.isFinite(p))return null;const f=t.filter(C=>{const c=ce(C);return!n.has(c)&&(s[c]??1)===p}),y=f.filter(C=>!o||ce(C)!==o),A=i?y.filter(C=>!i.has(ce(C))):y;return A.length>0?La(A):y.length>0?La(y):o&&f.some(C=>ce(C)===o)?f.find(C=>ce(C)===o)??null:f.length?La(f):null},en=(t,s,n,i,o)=>{const p=[],f=t.filter(A=>!o.has(ce(A))&&!n.has(ce(A))&&(s[ce(A)]??0)<1),y=Si(f,A=>s[ce(A)]??0);for(const A of y){if(p.length>=i)break;p.push(A),o.add(ce(A))}if(p.length<i){const A=ja(t.filter(C=>!o.has(ce(C))&&n.has(ce(C))));for(const C of A){if(p.length>=i)break;p.push(C),o.add(ce(C))}}return p},Mi=(t,s,n,i)=>en(t,s,n,i,new Set),xs=(t,s,n,i,o,p)=>{const f=Math.max(1,n.stackSize??s),A=ja(t).filter((N,ne,Y)=>Y.findIndex(U=>ce(U)===ce(N))===ne),C=Mi(A,i,o,f),c=new Set,x=new Set,l=qa(C,{},null,c,x),h=l?[l]:[];return l&&x.add(ce(l)),{queue:h,meta:{pool:A,active:C,knownessMap:i,unknownSet:o,outcomesById:p,asked:c,queued:x}}},us={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:t=>t,prepare:(t,s)=>{const i=ja(t).filter((o,p,f)=>f.findIndex(y=>ce(y)===ce(o))===p);return{queue:i.slice(0,Math.min(s,i.length)),meta:{}}},applyOutcome:t=>t},vs=(t,s,n,i)=>{const o=Math.max(1,n.stackSize??s),f=ja(t).filter((ne,Y,U)=>U.findIndex(S=>ce(S)===ce(ne))===Y),y={},A=new Set,C=new Set,c=new Set,x=Math.max(1,n.levels??1);f.forEach(ne=>{const Y=ce(ne),U=i==null?void 0:i[Y],S=typeof U=="number"&&Number.isFinite(U)?U:1;y[Y]=Math.min(x,Math.max(1,Math.round(S)))});const l=[];if(f.length>0){const ne=new Map;f.forEach(U=>{var g;const S=y[ce(U)]??1;ne.has(S)||ne.set(S,[]),(g=ne.get(S))==null||g.push(U)});const Y=Array.from(ne.keys()).sort((U,S)=>U-S);for(const U of Y){if(l.length>=o)break;const S=ja(ne.get(U)??[]);for(const g of S){if(l.length>=o)break;l.push(g)}}}const h=qa(l,y,null,A,C),N=h?[h]:[];return h&&C.add(ce(h)),{queue:N,meta:{pool:f,active:l,levelMap:y,asked:A,queued:C,wrongSinceCorrect:c}}},Ii={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,s)=>Math.max(1,s.stackSize??t),getProgressTotal:()=>null,prepare:(t,s,n)=>vs(t,s,n),applyOutcome:(t,s,n,i,o)=>{if(!s)return t;const p=Math.max(1,i.levels??1),f=t.meta.pool??[],y=t.meta.active??[],A={...t.meta.levelMap??{}},C=new Set(t.meta.asked??[]),c=new Set(t.meta.queued??[]),x=new Set(t.meta.wrongSinceCorrect??[]),l=ce(s);c.delete(l),C.add(l);const h=A[l]??1;o.correct?(A[l]=x.has(l)?1:Math.min(h+1,p),x.delete(l)):(A[l]=1,x.add(l));const N=o.correct?y.filter(U=>ce(U)!==l):y.slice();if(o.correct&&N.length<Math.max(1,i.stackSize??1)){const U=new Set(N.map(g=>ce(g))),S=Ci(f,A,U,C,l);S&&N.push(S)}const ne=t.queue.slice(),Y=qa(N,A,l,C,c);return Y&&(ne.push(Y),c.add(ce(Y))),{queue:ne,meta:{pool:f,active:N,levelMap:A,asked:C,queued:c,wrongSinceCorrect:x}}}},Li={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,s)=>Math.max(1,s.stackSize??t),getProgressTotal:()=>null,prepare:(t,s,n)=>xs(t,s,n,{},new Set,{}),applyOutcome:(t,s,n,i,o)=>{if(!s)return t;const p=t.meta.pool??[],f=t.meta.active??[],y={...t.meta.knownessMap??{}},A=new Set(t.meta.unknownSet??[]),C={...t.meta.outcomesById??{}},c=new Set(t.meta.asked??[]),x=new Set(t.meta.queued??[]),l=ce(s);x.delete(l),c.add(l);const h={correctness:Math.max(0,Math.min(1,o.correctness??(o.correct?1:0))),createdUtc:o.createdUtc??new Date().toISOString()},ne=(C[l]??[]).concat(h).sort((P,b)=>P.createdUtc.localeCompare(b.createdUtc)).slice(-5);C[l]=ne,A.delete(l);const Y=Date.now();p.forEach(P=>{const b=ce(P),q=C[b]??[];if(q.length===0){y[b]=0,A.add(b);return}const E=Oa(q,Y);y[b]=E.knowness});const U=f.slice();if((y[l]??0)>=1){const P=U.filter(b=>ce(b)!==l);U.length=0,U.push(...P)}const g=Math.max(1,i.stackSize??n);if(U.length<g){const P=new Set(U.map(q=>ce(q))),b=en(p,y,A,g-U.length,P);U.push(...b)}const ie=t.queue.slice();if(ie.length===0||ce(ie[ie.length-1])===l){const P=qa(U,{},l,c,x);P&&(ie.push(P),x.add(ce(P)))}return{queue:ie,meta:{pool:p,active:U,knownessMap:y,unknownSet:A,outcomesById:C,asked:c,queued:x}}}},tn={random:us,levels:Ii,temporal:Li},$i=Object.values(tn),ws=t=>{if(!t)return us;const s=t.trim().toLowerCase();return s==="random"||s==="levels"||s==="temporal"?tn[s]:us},Ua=(t,s)=>{const n={...t.defaultSettings};return s&&Object.entries(s).forEach(([i,o])=>{typeof o=="number"&&Number.isFinite(o)&&(n[i]=o),typeof o=="string"&&(n[i]=o)}),t.settingsFields.forEach(i=>{var p;const o=n[i.key];if(i.type==="number"){if(typeof o!="number"||Number.isNaN(o)){n[i.key]=t.defaultSettings[i.key]??0;return}i.min!==void 0&&(n[i.key]=Math.max(i.min,n[i.key])),i.max!==void 0&&(n[i.key]=Math.min(i.max,n[i.key]));return}if(i.type==="select"){const f=((p=i.options)==null?void 0:p.map(y=>y.value))??[];(typeof o!="string"||f.length>0&&!f.includes(o))&&(n[i.key]=t.defaultSettings[i.key]??f[0]??"")}}),n},an=(t,s)=>{const n={};return t.settingsFields.forEach(i=>{const o=s.get(i.key);if(o){if(i.type==="number"){const p=Number(o);Number.isNaN(p)||(n[i.key]=p);return}n[i.key]=o}}),Ua(t,n)},Ri=(t,s)=>{const n=new URLSearchParams;return t.settingsFields.forEach(i=>{const o=s[i.key];(typeof o=="number"||typeof o=="string")&&n.set(i.key,String(o))}),n};function Ei({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c,collectionId:x,revisionId:l}){const{libraryName:h}=Ot(c),N=`/#/cogita/library/${c}`,[ne,Y]=a.useState(t.cogita.library.collections.defaultName),[U,S]=a.useState(""),[g,ie]=a.useState(20),[P,b]=a.useState("random"),[q,E]=a.useState({}),[G,k]=a.useState("exact"),[M,J]=a.useState([]),[ae,te]=a.useState(null),[Fe,ge]=a.useState([]),[L,pe]=a.useState("idle"),[j,_]=a.useState(null),[he,W]=a.useState("idle"),[K,fe]=a.useState("idle"),[xe,ve]=a.useState("idle"),Ae=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Se=a.useMemo(()=>ws(P),[P]),Ue=a.useMemo(()=>Ua(Se,q),[Se,q]),Ke=a.useMemo(()=>Ri(Se,Ue).toString(),[Se,Ue]);a.useEffect(()=>{Va(c,x).then(H=>Y(H.name)).catch(()=>Y(t.cogita.library.collections.defaultName))},[c,x]),a.useEffect(()=>{l&&Cn({libraryId:c,collectionId:x,revisionId:l}).then(H=>{S(H.name),b(H.mode||"random"),k(H.check||"exact"),ie(H.limit||20),E(H.revisionSettings??{})}).catch(()=>{S("")})},[x,c,l]),a.useEffect(()=>{Mn({libraryId:c}).then(H=>{J(H),!ae&&H.length>0&&te(H[0].roleId)}).catch(()=>{J([])})},[c]);const Ne=()=>{fe("loading"),Ys({libraryId:c}).then(H=>{ge(H),fe("idle")}).catch(()=>{ge([]),fe("error")})};a.useEffect(()=>{Ne()},[c]);const He=async()=>{pe("working"),W("idle");try{const H=await Ln({libraryId:c,collectionId:x,revisionType:Se.id,revisionSettings:Ue,mode:P,check:G,limit:g});_(`${Ae}/${H.shareCode}${Ke?`?${Ke}`:""}`),pe("ready"),Ne()}catch{pe("error")}},at=async()=>{if(l){ve("saving");try{await In({libraryId:c,collectionId:x,revisionId:l,name:U||ne,revisionType:Se.id,revisionSettings:Ue,mode:P,check:G,limit:g}),ve("saved")}catch{ve("error")}}},et=async()=>{if(j)try{await navigator.clipboard.writeText(j),W("copied")}catch{W("failed")}},D=async H=>{try{await Gs({libraryId:c,shareId:H}),Ne()}catch{Ne()}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:ne}),e.jsx("p",{className:"cogita-library-subtitle",children:h})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:N,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${N}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${N}/collections/${x}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${N}/collections/${x}/revision/run?mode=${encodeURIComponent(P)}&check=${encodeURIComponent(G)}&limit=${g}${Ke?`&${Ke}`:""}${ae?`&reviewer=${encodeURIComponent(ae)}`:""}${l?`&revisionId=${encodeURIComponent(l)}`:""}`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:U,onChange:H=>S(H.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsx("select",{value:P,onChange:H=>b(H.target.value),children:$i.map(H=>e.jsx("option",{value:H.id,children:t.cogita.library.revision[H.labelKey]},H.id))})]}),Se.settingsFields.map(H=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision[H.labelKey]}),H.type==="select"?e.jsx("select",{value:String(Ue[H.key]??""),onChange:We=>E(Ce=>({...Ce,[H.key]:We.target.value})),children:(H.options??[]).map(We=>e.jsx("option",{value:We.value,children:t.cogita.library.revision[We.labelKey]},We.value))}):e.jsx("input",{type:"number",min:H.min,max:H.max,step:H.step,value:Ue[H.key]??0,onChange:We=>E(Ce=>({...Ce,[H.key]:Number(We.target.value||0)}))})]},H.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.checkLabel}),e.jsx("input",{value:t.cogita.library.revision.checkValue,disabled:!0})]}),Se.id!=="levels"&&Se.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:g,onChange:H=>ie(Number(H.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:ae??"",onChange:H=>te(H.target.value||null),children:M.map(H=>e.jsx("option",{value:H.roleId,children:H.label},H.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.previewBody1}),e.jsx("p",{children:t.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[l?e.jsx("button",{type:"button",className:"cta ghost",onClick:at,disabled:xe==="saving",children:xe==="saving"?"...":t.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${N}/collections/${x}/revision/run?mode=${encodeURIComponent(P)}&check=${encodeURIComponent(G)}&limit=${g}${Ke?`&${Ke}`:""}${ae?`&reviewer=${encodeURIComponent(ae)}`:""}${l?`&revisionId=${encodeURIComponent(l)}`:""}`,children:t.cogita.library.actions.startRevision})]}),xe==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.shareBody}),j?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:j,readOnly:!0})]}):null,L==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareError}):null,he==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):he==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:He,disabled:L==="working",children:L==="working"?t.cogita.library.revision.shareWorking:t.cogita.library.revision.shareAction}),j?e.jsx("button",{type:"button",className:"cta ghost",onClick:et,children:t.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),K==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):Fe.length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:Fe.map(H=>e.jsxs("div",{className:"cogita-share-row","data-state":H.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:H.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(H.createdUtc).toLocaleString(),H.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]})]}),H.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>D(H.shareId),children:t.cogita.library.revision.shareRevokeAction})]},H.shareId))})]})]})]})]})})})]})})}const ns=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function sn(t,s,n){if(!t)return null;const i=new Map(t.nodes.map(P=>[P.id,P])),o=new Map,p=new Set,f=P=>{if(typeof P=="number")return P;if(typeof P=="string"){const b=Number(P);return Number.isFinite(b)?b:0}return 0},y=P=>{if(o.has(P))return o.get(P);if(p.has(P))return 0;const b=i.get(P);if(!b)return 0;p.add(P);const q=G=>{var M,J;return(G?((M=b.inputsByHandle)==null?void 0:M[G])??[]:b.inputs??((J=b.inputsByHandle)==null?void 0:J.in)??[]).map(ae=>y(ae))};let E=0;switch(b.type){case"input.random":{const G=b.min??0,k=b.max??G+10,M=Math.min(G,k),J=Math.max(G,k);E=Math.floor(Math.random()*(J-M+1))+M;break}case"input.const":{E=b.value??0;break}case"input.list":{const G=(b.list??[]).filter(Boolean),k=Math.round(f(q("index")[0]));E=G.length?G[Math.max(0,Math.min(G.length-1,k))]:String(k);break}case"compute.add":{E=q("in").map(k=>f(k)).reduce((k,M)=>k+M,0);break}case"compute.sub":{const G=q("add").map(M=>f(M)),k=q("sub").map(M=>f(M));E=G.reduce((M,J)=>M+J,0)-k.reduce((M,J)=>M+J,0);break}case"compute.mul":{const G=q("in").map(k=>f(k));E=G.length?G.reduce((k,M)=>k*M,1):0;break}case"compute.div":{const G=f(q("num")[0]),k=q("den").map(M=>f(M)).reduce((M,J)=>M+J,0);E=Math.abs(k)<Number.EPSILON?0:G/k;break}case"compute.pow":{const G=f(q("base")[0]),k=f(q("exp")[0]);E=Math.pow(G,k);break}case"compute.exp":{const G=f(q("base")[0]),k=f(q("exp")[0]);E=Math.pow(G,k);break}case"compute.log":{const G=f(q("value")[0]),k=f(q("base")[0]),M=Math.max(G,Number.EPSILON);E=Math.abs(k)<Number.EPSILON?Math.log(M):Math.log(M)/Math.log(k);break}case"compute.abs":{E=Math.abs(f(q("in")[0]));break}case"compute.min":{const G=q("in").map(k=>f(k));E=G.length?Math.min(...G):0;break}case"compute.max":{const G=q("in").map(k=>f(k));E=G.length?Math.max(...G):0;break}case"compute.floor":{E=Math.floor(f(q("in")[0]));break}case"compute.ceil":{E=Math.ceil(f(q("in")[0]));break}case"compute.round":{E=Math.round(f(q("in")[0]));break}case"compute.mod":{const G=f(q("a")[0]),k=f(q("b")[0]);E=Math.abs(k)<Number.EPSILON?0:G%k;break}case"compute.concat":{const k=["in1","in2","in3","in4","in5","in6"].flatMap(te=>q(te)),M=k.length?k:q("in");E=(M.length?M:q()).map(te=>te==null?"":String(te)).join("");break}case"compute.trim":{const G=q("text")[0]??q("in")[0]??"",k=G==null?"":String(G),M=Math.max(0,Math.round(f(q("start")[0]))),J=Math.max(0,Math.round(f(q("end")[0])));M+J>=k.length?E="":E=k.substring(M,k.length-J);break}case"output":{E=q("in")[0]??0;break}default:E=0}return p.delete(P),o.set(P,E),E},A=t.outputs&&t.outputs.length>0?t.outputs:t.output?[t.output]:t.nodes.filter(P=>P.type==="output").map(P=>P.id);t.nodes.forEach(P=>y(P.id)),A.forEach(P=>y(P));const C=P=>Math.abs(P%1)<1e-5?String(Math.round(P)):P.toFixed(3).replace(/\.?0+$/,""),c=P=>typeof P=="number"?C(P):P??"",x=new Map;A.forEach(P=>{var k,M,J,ae;const b=i.get(P);if(!b)return;const q=(M=(k=b.inputsByHandle)==null?void 0:k.name)==null?void 0:M[0],E=q?c(o.get(q)):"",G=(E==null?void 0:E.toString().trim())||((J=b.outputLabel)==null?void 0:J.trim())||((ae=b.name)==null?void 0:ae.trim())||P;x.set(P,G)});const l={},h={},N={};A.forEach(P=>{var E,G;const b=i.get(P);if(!b)return;const q=x.get(P)??(((E=b.outputLabel)==null?void 0:E.trim())||((G=b.name)==null?void 0:G.trim())||P);l[q]=c(o.get(P)),b.name&&(h[b.name.trim()]=q),h[P]=q});const ne=(P,b)=>{let q=P;return t.nodes.forEach(E=>{var ae,te;const G=c(o.get(E.id)),k=A.includes(E.id),M=k?x.get(E.id)??((ae=E.outputLabel)==null?void 0:ae.trim())??((te=E.name)==null?void 0:te.trim())??E.id:"",J=k&&b?M:G;q=q.replace(new RegExp(`\\{\\s*${ns(E.id)}\\s*\\}`,"gi"),J),E.name&&(q=q.replace(new RegExp(`\\{\\s*${ns(E.name)}\\s*\\}`,"gi"),J)),k&&E.outputLabel&&(q=q.replace(new RegExp(`\\{\\s*${ns(E.outputLabel)}\\s*\\}`,"gi"),M))}),q},Y=s;let U=Y.trim().length>0?Y:"";U||(U=A.length?`Compute ${A.join(", ")}`:"Compute"),U=ne(U,!0);const S=(n==null?void 0:n.trim())??"",g=S?ne(S,!1):"",ie={};return o.forEach((P,b)=>{ie[b]=P,N[b]=c(P);const q=i.get(b);q!=null&&q.name&&(N[q.name.trim()]=c(P))}),{prompt:U,answers:l,values:ie,answerText:g,outputVariables:h,variableValues:N}}function nn(t){var n;const s=Object.entries(t.answers);return{prompt:t.prompt,expectedAnswer:t.answerText??((n=s[0])==null?void 0:n[1])??"",expectedAnswers:t.answers,values:t.values,expectedAnswerIsSentence:!!(t.answerText&&t.answerText.trim().length>0),outputVariables:t.outputVariables,variableValues:t.variableValues}}function rn({copy:t,currentCard:s,currentTypeLabel:n,prompt:i,languages:o,answer:p,onAnswerChange:f,computedExpected:y,computedAnswers:A,onComputedAnswerChange:C,answerTemplate:c,outputVariables:x,variableValues:l,computedFieldFeedback:h,feedback:N,canAdvance:ne,quoteContext:Y,quotePlaceholder:U,onCheckAnswer:S,onSkip:g,onLanguageSelect:ie,onMarkReviewed:P,onAdvance:b,showCorrectAnswer:q,setShowCorrectAnswer:E,onRevealCorrect:G,answerMask:k,expectedAnswer:M,hasExpectedAnswer:J,handleComputedKeyDown:ae,answerInputRef:te,computedInputRefs:Fe,scriptMode:ge,setScriptMode:L,matchPairs:pe,matchLeftOrder:j,matchRightOrder:_,matchSelection:he,matchActiveLeft:W,matchActiveRight:K,matchFeedback:fe,onMatchLeftSelect:xe,onMatchRightSelect:ve}){const Ae=a.useMemo(()=>{var $e;const D=!c&&y.length===2?`The {${y[0].key}} is of type {${y[1].key}}`:null,H=c??D;if(!H)return null;const We=new Map(y.map(R=>[R.key,R.expected])),Ce=new Set,re=[],Re=/\{([^}]+)\}/g;let ze=0,Be,De=null;for(;(Be=Re.exec(H))!==null;){const R=H.slice(ze,Be.index);R&&re.push({type:"text",value:R});const V=(($e=Be[1])==null?void 0:$e.trim())??"",me=V&&We.has(V)?V:V&&x&&x[V]?x[V]:null;V&&Ce.add(V),me&&Ce.add(me),me&&We.has(me)?(re.push({type:"input",value:me}),De||(De=me)):V&&l&&l[V]!==void 0?re.push({type:"text",value:l[V]}):re.push({type:"text",value:Be[0]}),ze=Be.index+Be[0].length}const Q=H.slice(ze);return Q&&re.push({type:"text",value:Q}),y.filter(R=>!Ce.has(R.key)).length>0?null:{parts:re,expectedByKey:We,firstInputKey:De}},[c,y,x,l]),Se=()=>{if(!Ae)return null;const{parts:D,expectedByKey:H,firstInputKey:We}=Ae;return e.jsx("div",{className:"cogita-revision-inline-answer",children:D.map((Ce,re)=>{var Re,ze;return Ce.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Ce.value},`text-${re}`):e.jsx("input",{ref:Be=>{Fe.current[Ce.value]=Be},autoFocus:Ce.value===We,value:A[Ce.value]??"",onChange:Be=>C(Ce.value,Be.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":h[Ce.value]??(N==="correct"?"correct":N==="incorrect"?"incorrect":void 0),onKeyDown:Be=>He(Be)||ae(Be),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Re=A[Ce.value])==null?void 0:Re.length)??0,((ze=H.get(Ce.value))==null?void 0:ze.length)??6)}ch`}},`input-${Ce.value}-${re}`)})})},Ue=a.useMemo(()=>{const D=new Map;return(pe??[]).forEach(H=>D.set(H.leftId,H)),D},[pe]),Ke=a.useMemo(()=>{const D=new Map;return(pe??[]).forEach(H=>D.set(H.rightId,H)),D},[pe]);a.useEffect(()=>{var re;if(s.cardType!=="info"||s.infoType!=="computed"||y.length===0)return;const D=typeof document<"u"?document.activeElement:null;if(D&&(D.tagName==="INPUT"||D.tagName==="TEXTAREA"))return;const H=(Ae==null?void 0:Ae.firstInputKey)??((re=y[0])==null?void 0:re.key);if(!H)return;const We=Fe.current[H];if(!We)return;const Ce=requestAnimationFrame(()=>{We.focus()});return()=>cancelAnimationFrame(Ce)},[s,y,Ae]);const Ne=(()=>{const D=[M??"",...y.map(Ce=>Ce.expected??"")].join(""),H=[p,...Object.values(A)].join(""),We=`${D}${H}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(We)})(),He=D=>D.ctrlKey&&(D.key==="^"||D.key==="6")?(D.preventDefault(),L(H=>H==="super"?null:"super"),!0):D.ctrlKey&&(D.key==="_"||D.key==="-")?(D.preventDefault(),L(H=>H==="sub"?null:"sub"),!0):!1,at=()=>{if(!M||!k)return M??"";const D=M.split(""),H=Array.from(k),We=H.length>0?H.reduce((Ce,re)=>Ce+re,0)/H.length:127;return D.map((Ce,re)=>{const Re=H[re]??We,ze=Math.max(0,Math.min(255,Math.round(Re)));let Be=255,De=0;return ze<=127?De=Math.round(ze/127*255):(De=255,Be=Math.round(255*(1-(ze-127)/128))),e.jsx("span",{style:{color:`rgb(${Be}, ${De}, 0)`},children:Ce},`mask-${re}`)})},et=s.cardType==="info"&&s.infoType==="citation"?(Y==null?void 0:Y.title)||s.label:s.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:n}),e.jsx("strong",{children:et})]}),s.cardType==="vocab"&&s.checkType==="translation-match"&&pe?e.jsxs("div",{className:"cogita-revision-body",children:[i?e.jsx("h2",{children:i}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(j??[]).map(D=>{const H=Ue.get(D);if(!H)return null;const We=(he==null?void 0:he[D])??null,Ce=(fe==null?void 0:fe[D])??null,re=W===D;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":re,"data-state":Ce??void 0,"data-locked":We?"true":void 0,onClick:()=>xe==null?void 0:xe(D),children:[e.jsx("span",{children:H.leftLabel}),We&&q?e.jsx("em",{children:"✓"}):null]},D)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(_??[]).map(D=>{const H=Ke.get(D);if(!H)return null;const We=Object.values(he??{}).includes(D),Ce=K===D;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":We||Ce,"data-locked":We?"true":void 0,onClick:()=>ve==null?void 0:ve(D),children:e.jsx("span",{children:H.rightLabel})},D)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,disabled:s.checkType==="translation-match",children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:te,value:p,onChange:D=>f(D.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":N==="correct"?"correct":N==="incorrect"?"incorrect":void 0,onKeyDown:D=>{D.key==="Enter"&&(D.preventDefault(),D.stopPropagation(),ne?b():S())}})]}),Ne?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>L(D=>D==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>L(D=>D==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[s.label?e.jsx("p",{className:"cogita-revision-hint",children:s.label}):null,c?null:e.jsx($n,{value:i??"",mode:"auto"}),y.length>0?(()=>{const D=Se();return D?e.jsx("div",{className:"cogita-inline-answer-wrap",children:D}):e.jsx("div",{className:"cogita-form-grid",children:y.map((H,We)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:H.key}),e.jsx("textarea",{ref:Ce=>{Fe.current[H.key]=Ce},autoFocus:We===0,value:A[H.key]??"",onChange:Ce=>C(H.key,Ce.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":h[H.key]??(N==="correct"?"correct":N==="incorrect"?"incorrect":void 0),onKeyDown:Ce=>He(Ce)||ae(Ce)})]},H.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:te,value:p,onChange:D=>f(D.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":N==="correct"?"correct":N==="incorrect"?"incorrect":void 0,onKeyDown:D=>{He(D)||D.key==="Enter"&&(D.preventDefault(),D.stopPropagation(),ne?b():S())}})]})}),Ne?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>L(D=>D==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>L(D=>D==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="citation"&&Y?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.quoteProgress.replace("{done}",String(Y.completed)).replace("{total}",String(Y.total))}),e.jsx("p",{className:"cogita-quote-text",children:Y.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:te,value:p,onChange:D=>f(D.target.value),placeholder:U??t.cogita.library.revision.quoteMissingPlaceholder,"data-state":N==="correct"?"correct":N==="incorrect"?"incorrect":void 0,onKeyDown:D=>{D.key==="Enter"&&(D.preventDefault(),D.stopPropagation(),ne?b():S())}})]}),e.jsx("p",{className:"cogita-quote-text",children:Y.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:o.length?o.map(D=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ie(D.label),children:D.label},D.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:t.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:P,children:t.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}),N&&e.jsx("div",{className:"cogita-revision-feedback","data-state":N,children:N==="correct"?t.cogita.library.revision.correct:t.cogita.library.revision.tryAgain}),N==="incorrect"&&J?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>E(D=>{const H=!D;return H&&G(),H}),children:t.cogita.library.revision.showAnswer}),q?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),y.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[y.map(D=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:D.key}),e.jsx("span",{children:D.expected})]},D.key)),M?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:M})]}):null]}):e.jsx("p",{children:k?at():M})]}):null]}):null,ne?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:b,children:t.cogita.library.revision.nextQuestion})}):null]})}const is=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function on({outcomes:t}){const[s,n]=a.useState("day"),i=a.useMemo(()=>{const o=is.find(y=>y.id===s)??is[1],p=Date.now()-o.ms,f=t.filter(y=>new Date(y.createdUtc).getTime()>=p);return _t(f)},[t,s]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:is.map(o=>e.jsx("button",{type:"button",className:"ghost","data-active":s===o.id,onClick:()=>n(o.id),children:o.label},o.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[i.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[i.correct," / ",i.total]})]})}const Ai="cogita-revision",Pi=1,Aa="outcomes",Fi=()=>new Promise((t,s)=>{const n=indexedDB.open(Ai,Pi);n.onupgradeneeded=()=>{const i=n.result;if(!i.objectStoreNames.contains(Aa)){const o=i.createObjectStore(Aa,{keyPath:"id"});o.createIndex("byItem","itemKey",{unique:!1}),o.createIndex("byPending","pending",{unique:!1})}},n.onerror=()=>s(n.error),n.onsuccess=()=>t(n.result)}),Na=async(t,s)=>{const n=await Fi();return new Promise((i,o)=>{const p=n.transaction(Aa,t),f=p.objectStore(Aa);s(f).then(i).catch(o),p.onerror=()=>o(p.error)})},ln=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const t=new Uint8Array(16);crypto.getRandomValues(t);const s=Array.from(t).map(n=>n.toString(16).padStart(2,"0"));return`${s.slice(0,4).join("")}-${s.slice(4,6).join("")}-${s.slice(6,8).join("")}-${s.slice(8,10).join("")}-${s.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Ki=()=>{const t="cogita_revision_client_id",s=localStorage.getItem(t);if(s)return s;const n=ln();return localStorage.setItem(t,n),n},zi=()=>{const t="cogita_revision_client_seq",s=Number(localStorage.getItem(t)??"0"),n=Number.isFinite(s)?s+1:1;return localStorage.setItem(t,String(n)),n},cn=(t,s,n,i)=>Dt(t,s,n,i),Pa=async t=>{const s=Ki(),n=zi(),i=new Date().toISOString(),o={...t,clientId:s,clientSequence:n,createdUtc:i,id:ln(),pending:!0};return await Na("readwrite",p=>new Promise((f,y)=>{const A={...o,itemKey:cn(o.itemType,o.itemId,o.checkType,o.direction)},C=p.add(A);C.onsuccess=()=>f(),C.onerror=()=>y(C.error)})),o},Fa=async(t,s,n,i)=>{if(!s)return[];try{const o=cn(t,s,n,i);return await Na("readonly",p=>new Promise((f,y)=>{const C=p.index("byItem").getAll(o);C.onsuccess=()=>{const x=(C.result??[]).map(l=>({itemType:l.itemType,itemId:l.itemId,checkType:l.checkType??null,direction:l.direction??null,revisionType:l.revisionType,evalType:l.evalType,correct:l.correct,createdUtc:l.createdUtc,maskBase64:l.maskBase64,payloadBase64:l.payloadBase64,payloadHashBase64:l.payloadHashBase64,clientId:l.clientId,clientSequence:l.clientSequence,personRoleId:l.personRoleId??null})).sort((l,h)=>l.createdUtc.localeCompare(h.createdUtc));f(x)},C.onerror=()=>y(C.error)}))}catch{return[]}},Vt=async()=>{try{return await Na("readonly",t=>new Promise((s,n)=>{const i=t.getAll();i.onsuccess=()=>{const p=(i.result??[]).map(f=>({itemType:f.itemType,itemId:f.itemId,checkType:f.checkType??null,direction:f.direction??null,revisionType:f.revisionType,evalType:f.evalType,correct:f.correct,createdUtc:f.createdUtc,maskBase64:f.maskBase64,payloadBase64:f.payloadBase64,payloadHashBase64:f.payloadHashBase64,clientId:f.clientId,clientSequence:f.clientSequence,personRoleId:f.personRoleId??null}));s(p)},i.onerror=()=>n(i.error)}))}catch{return[]}},Bi=async(t=100)=>{try{return await Na("readonly",s=>new Promise((n,i)=>{const p=s.index("byPending").getAll(!0);p.onsuccess=()=>{const f=p.result??[];n(f.slice(0,t))},p.onerror=()=>i(p.error)}))}catch{return[]}},Di=async t=>{if(t.length!==0)try{await Na("readwrite",s=>new Promise((n,i)=>{let o=t.length;t.forEach(p=>{const f=s.get(p);f.onsuccess=()=>{const y=f.result;if(y){y.pending=!1;const A=s.put(y);A.onsuccess=()=>{o-=1,o===0&&n()},A.onerror=()=>i(A.error)}else o-=1,o===0&&n()},f.onerror=()=>i(f.error)})}))}catch{}},rs=async(t,s)=>{const n=await Bi(200);if(n.length===0)return;const i=new Map;n.forEach(o=>{var f;const p=o.personRoleId??s??"";i.has(p)||i.set(p,[]),(f=i.get(p))==null||f.push(o)});for(const[o,p]of i.entries()){const f=p.map(y=>({itemType:y.itemType,itemId:y.itemId,checkType:y.checkType??null,direction:y.direction??null,revisionType:y.revisionType,evalType:y.evalType,correct:y.correct,clientId:y.clientId,clientSequence:y.clientSequence,maskBase64:y.maskBase64??null,payloadHashBase64:y.payloadHashBase64??null,payloadBase64:y.payloadBase64??null,personRoleId:o||null}));try{await Rn({libraryId:t,outcomes:f}),await Di(p.map(y=>y.id))}catch{}}},Fs={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},_i=(t,s)=>{const n=Math.max(t.length,s.length,1),i=Math.abs(t.length-s.length);return Math.max(0,1-i/n)},Vi=(t,s)=>{const n=new Uint8Array(t.length),i=_i(t,s);for(let o=0;o<t.length;o+=1){const p=t[o]===(s[o]??"")?128:0,f=t.length-1-o,y=s.length-1-o,A=t[f]===(s[y]??"")?127:0,C=Math.round((p+A)*i);n[o]=Math.max(0,Math.min(255,C))}return n},Ia=(t,s)=>t===s||(Fs[t]??[]).includes(s)?!0:(Fs[s]??[]).includes(t),Ka=(t,s)=>{const n=new Uint8Array(t.length);if(!t.length)return n;const i=[];for(let p=0;p<=t.length-3;p+=1)i.push({index:p,text:t.slice(p,p+3)});let o=!1;return i.forEach(p=>{for(let f=0;f<=s.length-3;f+=1){const y=s.slice(f,f+3);let A=0;for(let h=0;h<3;h+=1)Ia(p.text[h],y[h])&&(A+=1);if(A<2)continue;let C=p.index-1,c=f-1;for(;C>=0&&c>=0;){const h=t[C],N=s[c];if(h===N){n[C]=Math.max(n[C],255),C-=1,c-=1,o=!0;continue}if(Ia(h,N)){n[C]=Math.max(n[C],127),C-=1,c-=1,o=!0;continue}if(C>0&&t[C-1]===N){n[C]=Math.max(n[C],0),C-=1,o=!0;continue}if(c>0&&t[C]===s[c-1]){c-=1,o=!0;continue}break}for(let h=0;h<3;h+=1){const N=p.index+h,ne=p.text[h],Y=y[h],U=ne===Y?255:Ia(ne,Y)?127:0;n[N]=Math.max(n[N],U),o=!0}let x=p.index+3,l=f+3;for(;x<t.length&&l<s.length;){const h=t[x],N=s[l];if(h===N){n[x]=Math.max(n[x],255),x+=1,l+=1,o=!0;continue}if(Ia(h,N)){n[x]=Math.max(n[x],127),x+=1,l+=1,o=!0;continue}if(x+1<t.length&&t[x+1]===N){n[x]=Math.max(n[x],0),x+=1,o=!0;continue}if(l+1<s.length&&t[x]===s[l+1]){l+=1,o=!0;continue}break}}}),o?n:Vi(t,s)},ga=(t,s,n)=>{const i=t.trim().toLowerCase(),o=s.trim().toLowerCase();return Ka(i,o)},pa=t=>t.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),dn=(t,s,n)=>{const i=pa(t),o=pa(s);return Ka(i,o)},Nt=t=>t.trim().toLowerCase(),Oi=t=>t==="reverse"?"reverse":"forward",ka=(t,s)=>`${t}|${s}`,Mt=t=>{if(!t)return null;const[s,n]=t.split("|",2);return(s==="forward"||s==="reverse")&&n?{mode:s,fragmentId:n}:{mode:"forward",fragmentId:t}},za=(t,s)=>{var i;const n=Mt(s);return n?n.fragmentId&&s?(t??null)===s:(((i=Mt(t))==null?void 0:i.mode)??"forward")===n.mode:!0},gt=t=>{const s=t==null?void 0:t.trim().toLowerCase();return s||null},un=(t,s)=>{if((gt(t.childItemType)??"info")!==(s.cardType??"").toLowerCase()||t.childItemId!==s.cardId)return!1;const i=gt(t.childCheckType),o=gt(t.childDirection),p=gt(s.checkType),f=gt(s.direction);return!(i&&i!==p||o&&o!==f)},qi={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Ui={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},Ba=(t,s,n)=>{if(!n||!s.startsWith(t))return s;const i=s.slice(t.length);if(!i)return s;const o=n==="super"?qi:Ui,p=i.split("").map(f=>o[f]??f).join("");return t+p},Da=(t,s,n)=>{var f,y,A;if(!t)return((f=s[0])==null?void 0:f.key)??null;const i=new Set(s.map(C=>C.key)),o=/\{([^}]+)\}/g;let p;for(;(p=o.exec(t))!==null;){const C=((y=p[1])==null?void 0:y.trim())??"";if(!C)continue;if(i.has(C))return C;const c=n==null?void 0:n[C];if(c&&i.has(c))return c}return((A=s[0])==null?void 0:A.key)??null},hs=t=>t.flatMap(s=>{if(s.cardType!=="info"||s.infoType!=="citation")return[s];const n=s.description??"";if(!n.trim())return[s];const i=Mt(s.direction),o=(i==null?void 0:i.mode)??Oi(s.direction),p=ma(n),f=Object.keys(p.nodes);return f.length===0?[s]:f.map(y=>({...s,checkType:"quote-fragment",direction:ka(o,y)}))});function Wi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c,collectionId:x,revisionId:l}){const h=_a(),N=`/#/cogita/library/${c}`,ne=a.useMemo(()=>new URLSearchParams(h.search),[h.search]),Y=Math.max(1,Number(ne.get("limit")??20)),U=ne.get("mode")??"random",S=a.useMemo(()=>ws(U),[U]),g=a.useMemo(()=>Ua(S,an(S,ne)),[S,ne]),ie=ne.get("check")??"exact",P=ne.get("reviewer"),b=a.useMemo(()=>t.cogita.library.revision[S.labelKey]??U,[t,U,S]),q=a.useMemo(()=>ie==="exact"?t.cogita.library.revision.checkValue:ie,[t,ie]),[E,G]=a.useState(t.cogita.library.collections.defaultName),[k,M]=a.useState([]),[J,ae]=a.useState([]),[te,Fe]=a.useState("idle"),[ge,L]=a.useState({current:0,total:0}),[pe,j]=a.useState(0),[_,he]=a.useState(""),[W,K]=a.useState(null),[fe,xe]=a.useState(null),[ve,Ae]=a.useState(null),[Se,Ue]=a.useState(null),[Ke,Ne]=a.useState([]),[He,at]=a.useState({}),[et,D]=a.useState({}),[H,We]=a.useState(null),[Ce,re]=a.useState(null),[Re,ze]=a.useState(null),[Be,De]=a.useState(null),[Q,de]=a.useState(null),[$e,R]=a.useState({}),V=a.useRef(0),[me,ke]=a.useState(null),be=a.useRef(null),Le=a.useRef(null),[Pe,Ve]=a.useState(null),[Ie,Ee]=a.useState(!1),[we,st]=a.useState(null),[qe,Xe]=a.useState([]),[rt,yt]=a.useState(null),Je=a.useRef(null),Ze=a.useRef(null),[ct,dt]=a.useState(null),[It,nt]=a.useState(0),ot=a.useRef(null),Lt=a.useRef({}),[ft,tt]=a.useState(!1),[it,xt]=a.useState({}),[St,Ge]=a.useState([]),ht=a.useRef(new Map),[bt,m]=a.useState(new Set),[je,d]=a.useState(!1),X=a.useRef(null),ye=a.useRef(new Set),_e=a.useRef({}),ee=k[pe]??null,oe=(ee==null?void 0:ee.checkType)==="translation-match"&&Q,vt=a.useRef(new Map),At=a.useRef(new Map),qt=a.useRef(new Map),zt=a.useRef(new Map),Pt=a.useMemo(()=>ee?ee.cardType==="vocab"?t.cogita.library.revision.vocabLabel:ee.infoType?Ye(t,ee.infoType):t.cogita.library.revision.infoLabel:"",[t,ee]),na=a.useMemo(()=>{var u;return S.id!=="levels"?k.length:((u=it.pool)==null?void 0:u.length)??S.getFetchLimit(Y,g)},[it,g,S,k.length,Y]),Ut=S.getProgressTotal?S.getProgressTotal(k,it,Y,g):S.id==="levels"?Math.min(Y,na):k.length,mt=Ut?Math.min(pe+1,Ut):0,wt=Math.max(1,Number(g.tries??1)),Ct=g.compare??"anchors",Wt=Math.max(0,Math.min(100,Number(g.minCorrectness??0))),pt=(g.considerDependencies??"on")==="on",lt=Math.max(0,Math.min(100,Number(g.dependencyThreshold??85))),Et=r=>{const u=r.slice();for(let T=u.length-1;T>0;T-=1){const v=Math.floor(Math.random()*(T+1));[u[T],u[v]]=[u[v],u[T]]}return u},Gt=r=>r.length?r.reduce((T,v)=>T+v,0)/r.length/255*100:0,Ht=r=>Gt(r)>=Wt,ia=async()=>{const r=await Vt(),u=new Map,T=new Map,v=new Map;r.forEach($=>{const z=`${$.itemType}:${$.itemId}`,Z=Dt($.itemType,$.itemId,$.checkType,$.direction);if(u.has(z)||u.set(z,[]),u.get(z).push($),T.has(Z)||T.set(Z,[]),T.get(Z).push($),$.itemType==="info"&&$.checkType==="quote-fragment"&&$.direction){const se=`${$.itemId}:${$.direction}`;v.has(se)||v.set(se,[]),v.get(se).push($)}});const B=new Map,w=new Map,F=new Map;return u.forEach(($,z)=>B.set(z,_t($).score)),T.forEach(($,z)=>w.set(z,_t($).score)),v.forEach(($,z)=>F.set(z,_t($).score)),{itemKnowness:B,cardKnowness:w,fragmentKnowness:F}},Wa=async r=>{const u=[];let T=null;for(;;){const v=await $a({libraryId:c,collectionId:r,limit:200,cursor:T});if(u.push(...v.items),!v.nextCursor)break;T=v.nextCursor}return hs(u)},fa=async(r,u)=>{if(ht.current.has(r))return ht.current.get(r)??0;const T=await Wa(r);if(T.length===0)return ht.current.set(r,0),0;const B=T.reduce((w,F)=>{const $=ce(F);return w+(u.get($)??0)},0)/T.length;return ht.current.set(r,B),B},Ha=(r,u)=>{if(!pt||r.cardType!=="info"||r.infoType!=="citation"||r.checkType!=="quote-fragment")return!0;const T=Mt(r.direction);if(!(T!=null&&T.fragmentId))return!0;const v=r.description??"";if(!v.trim())return!0;const w=ma(v).nodes[T.fragmentId];if(!w||!w.leftId&&!w.rightId)return!0;const F=[w.leftId,w.rightId].filter(Z=>!!Z);if(F.length===0)return!0;const $=F.map(Z=>{const se=Dt("info",r.cardId,"quote-fragment",ka(T.mode,Z));return u.get(se)??0});return $.reduce((Z,se)=>Z+se,0)/$.length>=lt},ra=async r=>{const u=it,T=r.concat(u.active??[]).concat(u.pool??[]).filter(($,z,Z)=>Z.findIndex(se=>ce(se)===ce($))===z);if(!pt){m(new Set(T.map(ce)));return}const{itemKnowness:v,cardKnowness:B}=await ia(),w=St.filter($=>gt($.childItemType)==="collection"&&$.childItemId===x&&!gt($.childCheckType)&&!gt($.childDirection)),F=new Set;for(const $ of T){if($.cardType!=="info"){F.add(ce($));continue}if(!Ha($,B))continue;const z=St.filter(ue=>un(ue,$)).concat(w);if(z.length===0){F.add(ce($));continue}let Z=0;for(const ue of z)if(gt(ue.parentItemType)==="collection")Z+=await fa(ue.parentItemId,B);else if(gt(ue.parentCheckType)||gt(ue.parentDirection)){const le=gt(ue.parentCheckType),Te=gt(ue.parentDirection),Me=Dt(ue.parentItemType,ue.parentItemId,le,Te);Z+=B.get(Me)??0}else{const le=`${ue.parentItemType}:${ue.parentItemId}`;Z+=v.get(le)??0}Z/z.length>=lt&&F.add(ce($))}m(F)},Qa=r=>{for(let u=r;u<k.length;u+=1){const T=k[u];if(T&&(!pt||T.cardType!=="info"||bt.has(ce(T))))return u}return-1},$t=r=>!pt||r.cardType!=="info"||bt.has(ce(r)),oa=r=>{if(S.id!=="temporal"&&S.id!=="levels")return null;const u=it,T=(u.active??[]).concat(u.pool??[]),v=new Set;for(const B of T){const w=ce(B);if(!(v.has(w)||r.has(w))&&(v.add(w),$t(B)))return B}return null},Ft=a.useMemo(()=>{if(S.id!=="levels")return null;const r=it,u=r.pool??[],T=r.active??[],v=r.levelMap??{},B=Math.max(1,Number(g.levels??1)),w=Array.from({length:B},()=>0),F=new Set(T.map(se=>ce(se)));u.forEach(se=>{const ue=Math.min(B,Math.max(1,v[ce(se)]??1));w[ue-1]+=1});const $=u.length||1,z=w.map(se=>se/$*100),Z=ee?v[ce(ee)]??1:null;return{counts:w,percentages:z,currentLevel:Z,levelsCount:B,activeCount:T.length,poolCount:u.length,activeSet:F}},[it,g,S,ee]),jt=a.useMemo(()=>{if(S.id!=="temporal")return null;const r=it,u=r.pool??[],T=r.active??[],v=r.knownessMap??{},B=new Set(r.unknownSet??[]);let w=0;u.forEach(z=>{(v[ce(z)]??0)>1&&(w+=1)});const F=B.size,$=T.map(z=>({id:ce(z),value:B.has(ce(z))?0:Math.max(0,Math.min(1,v[ce(z)]??0))}));return{knownCount:w,unknownCount:F,dots:$}},[it,S]),la=a.useMemo(()=>{if(!pt)return 0;const r=it;return k.concat(r.active??[]).concat(r.pool??[]).filter((T,v,B)=>B.findIndex(w=>ce(w)===ce(T))===v).filter(T=>T.cardType==="info"&&!bt.has(ce(T))).length},[pt,it,k,bt]);a.useEffect(()=>{if(!pt||te!=="ready")return;const r=it,T=k.concat(r.active??[]).concat(r.pool??[]).filter((w,F,$)=>$.findIndex(z=>ce(z)===ce(w))===F).filter(w=>w.cardType!=="info"||bt.has(ce(w))).length,v=Je.current;if(Je.current=T,v===null||T<=v)return;const B=T-v;yt(`New card available (+${B})`),Ze.current&&window.clearTimeout(Ze.current),Ze.current=window.setTimeout(()=>yt(null),2200)},[pt,te,it,k,bt]),a.useEffect(()=>()=>{Ze.current&&window.clearTimeout(Ze.current)},[]);const kt=(r,u)=>{const T=S.applyOutcome({queue:k,meta:it},ee,Y,g,{correct:r,correctness:u,createdUtc:new Date().toISOString()});M(T.queue),xt(T.meta);const v=T.queue[pe+1];v&&ba(v,pe+1)};a.useEffect(()=>{Va(c,x).then(r=>G(r.name)).catch(()=>G(t.cogita.library.collections.defaultName))},[c,x]),a.useEffect(()=>{bs({libraryId:c,type:"language"}).then(r=>ae(r)).catch(()=>ae([]))},[c]),a.useEffect(()=>{fs({libraryId:c}).then(r=>Ge(r.items??[])).catch(()=>Ge([]))},[c]),a.useEffect(()=>{rs(c,P)},[c,P]),a.useEffect(()=>{ra(k)},[k,St,pt,lt,x]),a.useEffect(()=>{if(!ee||!pt){d(!1);return}if(ee.cardType!=="info"||bt.has(ce(ee))){d(!1);return}const r=Qa(pe+1);if(r>=0){d(!1),j(r);return}if(S.id==="temporal"||S.id==="levels"){const u=k.slice(0,pe+1),T=k.slice(pe+1).filter($t),v=u.concat(T),B=new Set(v.map(ce)),w=oa(B);if(w){const $=ce(w);B.has($)||(v.push(w),B.add($),xt(z=>{const Z=z,se=new Set(Z.queued??[]);return se.add($),{...Z,queued:se}}))}const F=v.findIndex(($,z)=>z!==pe&&$t($));if(F>=0){M(v),j(F),d(!1);return}}d(!0)},[ee,bt,pt,pe,k,it,S.id]),a.useEffect(()=>{let r=!0;return(async()=>{Fe("loading"),L({current:0,total:S.id==="levels"?0:S.getFetchLimit(Y,g)});try{const T=[];let v=null,B=null;do{const ue=await $a({libraryId:c,collectionId:x,limit:300,cursor:v});if(T.push(...ue.items),(S.id==="levels"||S.id==="temporal")&&ue.total&&(B=ue.total),L(le=>({current:T.length,total:le.total||ue.total||S.getFetchLimit(Y,g)})),v=ue.nextCursor??null,B!==null&&T.length>=B||S.id!=="levels"&&S.id!=="temporal"&&T.length>=S.getFetchLimit(Y,g))break}while(v);if(!r)return;const w=hs(T);let F;if(S.id==="levels"){const ue=Math.max(1,Number(g.levels??1)),Te=(await Vt()).reduce((Me,Oe)=>{const Qe=Dt(Oe.itemType,Oe.itemId,Oe.checkType,Oe.direction);return Me[Qe]||(Me[Qe]=[]),Me[Qe].push(Oe),Me},{});F={},w.forEach(Me=>{const Oe=ce(Me),Qe=Te[Oe]??[],ut=Qe.length>0?_t(Qe).score:0,ta=Math.max(1,Math.min(ue,Math.ceil(ut/100*ue)));F[Oe]=ta})}let $=null,z=null,Z=null;if(S.id==="temporal"){const ue=await Vt(),le=new Set(w.map(Oe=>ce(Oe))),Te=ue.reduce((Oe,Qe)=>{const ut=Dt(Qe.itemType,Qe.itemId,Qe.checkType,Qe.direction);return le.has(ut)&&(Oe[ut]||(Oe[ut]=[]),Oe[ut].push(Qe)),Oe},{});$={},z=new Set,Z={};const Me=Date.now();w.forEach(Oe=>{const Qe=ce(Oe),ut=Te[Qe]??[];if(ut.length===0){$[Qe]=0,z.add(Qe),Z[Qe]=[];return}const ta=ys(ut);Z[Qe]=ta;const gn=Oa(ta,Me);$[Qe]=gn.knowness})}const se=S.id==="levels"?vs(w,Y,g,F):S.id==="temporal"?xs(w,Y,g,$??{},z??new Set,Z??{}):S.prepare(w,Y,g);M(se.queue),xt(se.meta),j(0),Fe("ready"),L(ue=>({current:Math.min(ue.current,ue.total),total:ue.total}))}catch{r&&Fe("error")}})(),()=>{r=!1}},[c,x,Y,g,S,P]),a.useEffect(()=>{if(he(""),K(null),dt(null),nt(0),Ne([]),at({}),D({}),re(null),ze(null),De(null),Ee(!1),tt(!1),Ve(null),de(null),R({}),!ee){xe(null),Ae(null),We(null),st(null);return}ee.cardType==="info"&&ee.infoType==="computed"&&xe(t.cogita.library.revision.loadingComputed);let r=!0;return ba(ee,pe).then(u=>{!r||!u||(xe(u.prompt),Ae(u.expectedAnswer),Ne(u.computedExpected),at(u.computedAnswers),We(u.computedValues),re(u.answerTemplate),ze(u.outputVariables),De(u.variableValues))}),()=>{r=!1}},[ee,t]),a.useEffect(()=>{if(!ee||ee.cardType!=="info"||ee.infoType!=="citation"){X.current=null,ye.current=new Set,Ue(null);return}const r=ee.description??"",u=(ee.label??"").trim(),T=u.replace(/\s+/g," ").trim(),v=r.replace(/\s+/g," ").trim(),B=T&&T!==v?u:t.cogita.library.infoTypes.citation;if(!r){Ue(null),Ae(null);return}const w=ma(r);X.current=w,xe(B);let F=!0;return ia().then(({fragmentKnowness:$})=>{if(!F)return;const z=getQuoteMode(ee.direction),Z=new Set,se={};$.forEach((Te,Me)=>{const[Oe,Qe]=Me.split(":",2);if(Oe!==ee.cardId)return;const ut=Mt(Qe);if(!ut||ut.mode!==z)return;const ta=ut.fragmentId;se[ta]=Te,Te>=lt&&Z.add(ta)}),ye.current=Z,_e.current=se;const ue=Mt(ee.direction);if(ue!=null&&ue.fragmentId&&w.nodes[ue.fragmentId]){Bt(w,ue.fragmentId,B);return}const le=ha(w,Z,se,lt,pt,ee.direction);Bt(w,(le==null?void 0:le.id)??null,B)}).catch(()=>{ye.current=new Set,_e.current={};const $=Mt(ee.direction);if($!=null&&$.fragmentId&&w.nodes[$.fragmentId]){Bt(w,$.fragmentId,B);return}const z=ha(w,ye.current,{},lt,pt,ee.direction);Bt(w,(z==null?void 0:z.id)??null,B)}),()=>{F=!1}},[ee,t,pt,lt]),a.useEffect(()=>{if(!ee||ee.cardType!=="vocab"||ee.checkType!=="translation-match"){de(null),R({});return}const T=(it.pool??it.active??k).filter($=>$.cardType==="vocab"&&$.checkType==="translation-match").filter(($,z,Z)=>Z.findIndex(se=>se.cardId===$.cardId)===z);T.some($=>$.cardId===ee.cardId)||T.unshift(ee);const B=Et(T).slice(0,6).map($=>{const z=$.label.split("↔").map(ue=>ue.trim()).filter(Boolean);if(z.length<2)return null;const Z=`${$.cardId}:L`,se=`${$.cardId}:R`;return{cardId:$.cardId,leftId:Z,rightId:se,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),w=B.map($=>$.leftId),F=Et(B.map($=>$.rightId));de({pairs:B,leftOrder:w,rightOrder:F,selection:{},activeLeft:null,activeRight:null,locked:{}})},[ee,k,it]),a.useEffect(()=>()=>{be.current&&window.clearTimeout(be.current),Le.current&&window.clearTimeout(Le.current)},[]);const Xt=a.useRef(null);a.useEffect(()=>{if(!ee)return;const r=ce(ee),u=typeof document<"u"?document.activeElement:null;if(Xt.current===r&&u&&(u.tagName==="INPUT"||u.tagName==="TEXTAREA"))return;let T=0;const v=()=>{if(ee){if(ee.cardType==="info"&&ee.infoType==="computed"){if(Ke.length>0){const w=Da(Ce,Ke,Re),F=w?Lt.current[w]:null;if(F&&(F.focus(),document.activeElement===F)){Xt.current=r;return}}if(ot.current&&(ot.current.focus(),document.activeElement===ot.current)){Xt.current=r;return}}else if(ee.cardType==="vocab"&&ot.current&&(ot.current.focus(),document.activeElement===ot.current)){Xt.current=r;return}T<6&&(T+=1,window.setTimeout(v,40))}},B=window.setTimeout(v,40);return()=>window.clearTimeout(B)},[ee,Ke,Ce,Re]),a.useEffect(()=>{if(!ft)return;const r=u=>{u.key==="Enter"&&(u.preventDefault(),da())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[ft]);const Jt=r=>{Xe(r),st(_t(r))};a.useEffect(()=>{if(!ee){st(null),Xe([]);return}const r=ee.cardType==="info"?"info":"connection";if(ee.cardType==="info"&&ee.infoType==="citation"){Vt().then(u=>{const T=u.filter(v=>v.itemType==="info"&&v.itemId===ee.cardId&&v.checkType==="quote-fragment"&&za(v.direction,ee.direction));Jt(T)}).catch(()=>{st(null),Xe([])});return}Fa(r,ee.cardId,ee.checkType,ee.direction).then(u=>Jt(u)).catch(()=>{st(null),Xe([])})},[c,ee,P]);const Ta=(r,u,T,v)=>{if(r==="info"&&T==="quote-fragment"){Vt().then(B=>{const w=B.filter(F=>F.itemType==="info"&&F.itemId===u&&F.checkType==="quote-fragment"&&za(F.direction,v));Jt(w)}).catch(()=>{st(null),Xe([])});return}Fa(r,u,T,v).then(B=>Jt(B)).catch(()=>{st(null),Xe([])})},Sa=(r,u,T)=>{var F;const v=((F=T.pairs.find($=>$.leftId===r))==null?void 0:F.rightId)??null;if(!v)return T;const B=v===u;R($=>({...$,[r]:B?"correct":"incorrect"})),be.current&&window.clearTimeout(be.current),Le.current&&window.clearTimeout(Le.current),V.current+=1;const w={kind:B?"correct":"incorrect",tick:V.current};if(ke(null),be.current=window.setTimeout(()=>ke(w),0),Le.current=window.setTimeout(()=>ke(null),420),B){const $={...T.locked,[r]:!0};return Object.keys($).length>=T.pairs.length?(K("correct"),tt(!0)):K("correct"),{...T,selection:{...T.selection,[r]:u},activeLeft:null,activeRight:null,locked:$}}return K("incorrect"),{...T,activeLeft:null,activeRight:null}},ca=r=>{de(u=>!u||u.locked[r]?u:u.activeRight?Sa(r,u.activeRight,u):{...u,activeLeft:u.activeLeft===r?null:r})},Kt=r=>{de(u=>u&&(u.activeLeft?Sa(u.activeLeft,r,u):{...u,activeRight:u.activeRight===r?null:r}))},da=()=>{var r;if(ee&&ee.cardType==="info"&&ee.infoType==="citation"&&X.current&&Se&&!((r=Mt(ee.direction))!=null&&r.fragmentId)){const u=ha(X.current,ye.current,_e.current,lt,pt,ee.direction,Se.fragmentId);if(u){K(null),he(""),Ee(!1),D({}),tt(!1),dt(null),nt(0),Bt(X.current,u.id,Se.title);return}}K(null),he(""),Ee(!1),D({}),tt(!1),dt(null),nt(0),j(u=>Math.min(u+1,k.length))},Rt=r=>{if(!ee)return;const u=r.expected??null,T=r.answer??"";let v=u??"",B=T;if(!u&&r.expectedMap&&r.answerMap){const ue=Object.keys(r.expectedMap).sort((le,Te)=>le.localeCompare(Te));v=ue.map(le=>{var Te;return((Te=r.expectedMap)==null?void 0:Te[le])??""}).join("|"),B=ue.map(le=>{var Te;return((Te=r.answerMap)==null?void 0:Te[le])??""}).join("|")}const w=v?ga(v,B,Ct):new Uint8Array,F={revisionType:S.id,evalType:r.evalType,direction:r.direction,prompt:fe??"",expected:u,answer:T,expectedAnswers:r.expectedMap??null,answers:r.answerMap??null,correct:r.correct,maskBase64:w.length?Qt(w):null,values:H??null,checkMode:ie,compareMode:Ct,minCorrectness:Wt},$=new TextEncoder().encode(JSON.stringify(F)),z=ee.cardType==="info"?"info":"connection",Z=r.overrideCheckType??ee.checkType??null,se=r.overrideDirection??ee.direction??null;Pa({itemType:z,itemId:ee.cardId,checkType:Z,direction:se,revisionType:S.id,evalType:r.evalType,correct:r.correct,maskBase64:w.length?Qt(w):null,payloadBase64:Qt($),personRoleId:P??null}).then(()=>{Ta(z,ee.cardId,Z,se),ra(k),rs(c,P)}).catch(()=>{})},Zt=(r,u)=>{const T=vt.current.get(u);if(T)return Promise.resolve(T);const v=At.current.get(u);if(v)return v;const B=Yt({libraryId:c,infoId:r}).then(w=>{var ue,le;const F=w.payload,$=((ue=F.definition)==null?void 0:ue.graph)??null,z="",Z=((le=F.definition)==null?void 0:le.answerTemplate)??"",se=sn($,z,Z);if(se){const Me={sample:nn(se),answerTemplate:Z||null};return vt.current.set(u,Me),Me}return Ns({libraryId:c,infoId:r}).then(Te=>{const Me={sample:Te,answerTemplate:null};return vt.current.set(u,Me),Me})}).catch(()=>Ns({libraryId:c,infoId:r}).then(w=>{const F={sample:w,answerTemplate:null};return vt.current.set(u,F),F}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{At.current.delete(u)});return At.current.set(u,B),B},ba=(r,u)=>{var $;const T=`${ce(r)}:${u}`,v=qt.current.get(T);if(v)return Promise.resolve(v);const B=zt.current.get(T);if(B)return B;const w=z=>(qt.current.set(T,z),z);let F;if(r.cardType==="vocab"){if(r.checkType==="translation-match")return F=Promise.resolve(w({prompt:r.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),F;const z=r.label.split("↔").map(Z=>Z.trim()).filter(Boolean);if(z.length>=2){const se=(r.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ue=se?z[0]:z[1],le=se?z[1]:z[0];F=Promise.resolve(w({prompt:ue,expectedAnswer:le,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else F=Promise.resolve(w({prompt:r.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(r.cardType==="info"&&r.infoType==="word"){const z=($=r.description)!=null&&$.startsWith("Language: ")?r.description.replace("Language: ",""):null;F=Promise.resolve(w({prompt:r.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else r.cardType==="info"&&r.infoType==="computed"?F=Zt(r.cardId,T).then(z=>{var Te,Me;if(!z.sample)return w({prompt:r.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const Z=z.sample,se=Z.expectedAnswers?Object.entries(Z.expectedAnswers).map(([Oe,Qe])=>({key:Oe,expected:Qe})):[],ue=se.reduce((Oe,Qe)=>(Oe[Qe.key]="",Oe),{}),le=Z.expectedAnswerIsSentence&&((Te=Z.expectedAnswer)==null?void 0:Te.trim())||null;return w({prompt:Z.prompt,expectedAnswer:se.length>0?le:((Me=Z.expectedAnswer)==null?void 0:Me.trim())||null,computedExpected:se,computedAnswers:ue,computedValues:Z.values??null,answerTemplate:z.answerTemplate,outputVariables:Z.outputVariables??null,variableValues:Z.variableValues??null})}).catch(()=>w({prompt:r.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{zt.current.delete(T)}):F=Promise.resolve(w({prompt:r.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return zt.current.set(T,F),F},Bt=(r,u,T)=>{const v=Object.keys(r.nodes).length,B=ye.current.size;if(!u){Ue({title:T,before:r.text,after:"",fragmentId:null,total:v,completed:B}),Ae(null),tt(!0);return}const w=r.nodes[u];if(!w)return;const F=Zs(r.text,w);Ue({title:T,before:F.before,after:F.after,fragmentId:w.id,total:v,completed:B}),Ae(F.fragment),tt(!1)},Ca=()=>{const r=X.current;r&&Ue(u=>u&&{...u,total:Object.keys(r.nodes).length,completed:ye.current.size})},ua=()=>{const r=k[pe+1];r&&ba(r,pe+1)},Ma=()=>{if(ua(),ee&&ee.cardType==="vocab"&&ee.checkType==="translation-match"&&Q){if(Q.pairs.length===0){K("incorrect"),tt(!0);return}const w=Q.pairs.reduce((le,Te)=>(le[Te.rightId]=Te.rightLabel,le),{});let F=0;const $={};Q.pairs.forEach(le=>{const Me=Q.selection[le.leftId]===le.rightId;$[le.leftId]=Me?"correct":"incorrect",Me&&(F+=1)});const z=Q.pairs.length||1,Z=F/z,se=F===Q.pairs.length;R(le=>({...le,...$})),se?(K("correct"),tt(!0),nt(0)):(K("incorrect"),tt(!1),nt(le=>{const Te=le+1;return Te>=wt&&(Ee(!0),tt(!0),de(Me=>{if(!Me)return Me;const Oe=Me.pairs.reduce((Qe,ut)=>(Qe[ut.leftId]=ut.rightId,Qe),{});return{...Me,selection:Oe}})),Te})),kt(se,Z);const ue="connection";Promise.all(Q.pairs.map(le=>{const Te=Q.selection[le.leftId]??null,Me=Te?w[Te]:"",Oe={left:le.leftLabel,expected:le.rightLabel,answer:Me,checkType:"translation-match"},Qe=new TextEncoder().encode(JSON.stringify(Oe));return Pa({itemType:ue,itemId:le.cardId,checkType:"translation-match",direction:null,revisionType:S.id,evalType:"translation-match",correct:Te===le.rightId,maskBase64:null,payloadBase64:Qt(Qe),personRoleId:P??null})})).then(()=>{Ta(ue,ee.cardId,ee.checkType,ee.direction),rs(c,P)}).catch(()=>{});return}if(Ke.length>0){const w=Ke.reduce(($,z)=>{const Z=He[z.key]??"";return $[z.key]=Nt(Z)===Nt(z.expected)?"correct":"incorrect",$},{});Ke.every(({key:$,expected:z})=>{const Z=He[$]??"";return ie==="exact"&&Nt(Z)===Nt(z)})?(K("correct"),D(w),tt(!0),nt(0),kt(!0,1),Rt({correct:!0,direction:fe?`${fe} -> computed`:"computed",expectedMap:Ke.reduce(($,z)=>($[z.key]=z.expected,$),{}),answerMap:He,evalType:"computed"})):(K("incorrect"),D(w),tt(!1),nt($=>{const z=$+1;return z>=wt&&O&&(Ee(!0),tt(!0)),z}),kt(!1,0),window.setTimeout(()=>{var z;const $=Da(Ce,Ke,Re);$&&Lt.current[$]&&((z=Lt.current[$])==null||z.focus())},40),Rt({correct:!1,direction:fe?`${fe} -> computed`:"computed",expectedMap:Ke.reduce(($,z)=>($[z.key]=z.expected,$),{}),answerMap:He,evalType:"computed"}));return}if(ee&&ee.cardType==="info"&&ee.infoType==="citation"&&(Se!=null&&Se.fragmentId)){if(!ve)return;const w=Mt(ee.direction),F=(w==null?void 0:w.mode)??getQuoteMode(ee.direction),$=w!=null&&w.fragmentId&&ee.direction?ee.direction:ka(F,Se.fragmentId),z=dn(ve,_,Ct),Z=ie==="exact"&&pa(_)===pa(ve),se=Ht(z),ue=Z||se,le=Gt(z);ue?(_e.current[Se.fragmentId]=Math.max(_e.current[Se.fragmentId]??0,le),(_e.current[Se.fragmentId]??0)>=lt&&ye.current.add(Se.fragmentId),Ca(),K("correct"),D({}),tt(!0),dt(z),nt(0),le<100&&wt<=1&&Ee(!0),kt(!0,le/100),Rt({correct:!0,direction:`quote:${Se.fragmentId}`,expected:ve,answer:_,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:$})):(K("incorrect"),D({}),tt(!1),dt(z),nt(Te=>{const Me=Te+1;return Me>=wt&&O&&(Ee(!0),tt(!0)),Me}),kt(!1,le/100),window.setTimeout(()=>{var Te;return(Te=ot.current)==null?void 0:Te.focus()},40),Rt({correct:!1,direction:`quote:${Se.fragmentId}`,expected:ve,answer:_,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:$}));return}if(!ve)return;const r=ga(ve,_,Ct),u=ie==="exact"&&Nt(_)===Nt(ve),T=Ht(r),v=u||T,B=Gt(r);v?(K("correct"),D({}),tt(!0),dt(r),nt(0),B<100&&wt<=1&&Ee(!0),kt(!0,B/100),Rt({correct:!0,direction:fe?`${fe} -> ${ve}`:null,expected:ve,answer:_,evalType:"text"})):(K("incorrect"),D({}),tt(!1),dt(r),nt(w=>{const F=w+1;return F>=wt&&O&&(Ee(!0),tt(!0)),F}),kt(!1,B/100),window.setTimeout(()=>{var w;return(w=ot.current)==null?void 0:w.focus()},40),Rt({correct:!1,direction:fe?`${fe} -> ${ve}`:null,expected:ve,answer:_,evalType:"text"}))},Ya=r=>{if(ua(),!ve)return;const u=ga(ve,r,Ct),T=Nt(r)===Nt(ve),v=Ht(u),B=T||v,w=Gt(u);B?(K("correct"),D({}),tt(!0),dt(u),nt(0),w<100&&wt<=1&&Ee(!0),kt(!0,w/100),Rt({correct:!0,direction:"word->language",expected:ve,answer:r,evalType:"language-select"})):(K("incorrect"),D({}),tt(!1),dt(u),nt(F=>{const $=F+1;return $>=wt&&O&&(Ee(!0),tt(!0)),$}),kt(!1,w/100),Rt({correct:!1,direction:"word->language",expected:ve,answer:r,evalType:"language-select"}))},Ga=()=>{ua(),K("correct"),tt(!0),nt(0),kt(!0,1),ve&&Rt({correct:!0,direction:"manual",expected:ve,answer:_,evalType:"manual"})},Xa=()=>{if(kt(!1,0),ee&&ee.cardType==="info"&&ee.infoType==="citation"){K(null),he(""),Ee(!1),D({}),tt(!1),dt(null),nt(0),j(r=>Math.min(r+1,k.length));return}da()};a.useEffect(()=>{ua()},[pe,k]);const ea=r=>{var T;if(r.key!=="Enter")return;if(r.preventDefault(),r.stopPropagation(),ft){da();return}const u=Ke.find(v=>!(He[v.key]??"").trim());if(u){(T=Lt.current[u.key])==null||T.focus();return}Ma()},I=t.cogita.library.revision.revealModeAfterIncorrect,O=Ke.length>0||!!ve;return e.jsxs(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:[te==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ge.total?Math.min(100,Math.max(0,ge.current/ge.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ge.total?`${Math.min(ge.current,ge.total)} / ${ge.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:E}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",b).replace("{check}",q)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:N,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${N}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${N}/collections/${x}`,children:t.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:we?`${we.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ft?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Ft.currentLevel??"-"," / ",Ft.levelsCount]}):null,we?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(we.correct)).replace("{total}",String(we.total))}),we.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(we.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(on,{outcomes:qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[rt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:rt})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":me?`${me.kind}-${me.tick}`:oe?"idle":W??"idle",children:ee?e.jsx(e.Fragment,{children:je?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(rn,{copy:t,currentCard:ee,currentTypeLabel:Pt,prompt:fe,languages:J,answer:_,onAnswerChange:r=>he(u=>Ba(u,r,Pe)),computedExpected:Ke,computedAnswers:He,onComputedAnswerChange:(r,u)=>at(T=>({...T,[r]:Ba(T[r]??"",u,Pe)})),answerTemplate:Ce,outputVariables:Re,variableValues:Be,computedFieldFeedback:et,feedback:W,canAdvance:ft,quoteContext:Se,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ma,onSkip:Xa,onLanguageSelect:Ya,onMarkReviewed:Ga,onAdvance:da,showCorrectAnswer:Ie,setShowCorrectAnswer:Ee,onRevealCorrect:()=>tt(!0),answerMask:ct,expectedAnswer:ve,hasExpectedAnswer:O,handleComputedKeyDown:ea,answerInputRef:ot,computedInputRefs:Lt,scriptMode:Pe,setScriptMode:Ve,matchPairs:Q==null?void 0:Q.pairs,matchLeftOrder:Q==null?void 0:Q.leftOrder,matchRightOrder:Q==null?void 0:Q.rightOrder,matchSelection:Q==null?void 0:Q.selection,matchActiveLeft:Q==null?void 0:Q.activeLeft,matchActiveRight:Q==null?void 0:Q.activeRight,matchFeedback:$e,onMatchLeftSelect:ca,onMatchRightSelect:Kt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${N}/collections/${x}`,children:t.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Ut?`${mt} / ${Ut}`:t.cogita.library.revision.progressUnlimited}),te==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),te==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),te==="ready"&&k.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:I}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",wt]})]})]}),Ft?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Ft.activeCount," / ",Ft.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ft.counts.map((r,u)=>{const T=u+1,v=Ft.currentLevel===T,B=Ft.percentages[u]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":v,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:T}),e.jsx("strong",{children:r})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,B))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[B.toFixed(1),"%"]})]},`level-${T}`)})})]}):null,jt?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:jt.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:jt.dots.map(r=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,r.value*100))}%`,background:`rgba(${Math.round(255*(1-r.value))}, ${Math.round(200*r.value)}, 80, 0.9)`}},r.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:jt.knownCount})]})]}):null,pt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:la})]})}):null]})]})]})})})]})]})}const os=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],Hi={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Qi=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Yi=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Gi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:c,collectionId:x}){const[l,h]=a.useState(""),[N,ne,Y]=Bs([]),[U,S,g]=Ds([]),[ie,P]=a.useState(null),[b,q]=a.useState(null),[E,G]=a.useState(null),k=`/#/cogita/library/${c}`;a.useEffect(()=>{Va(c,x).then(L=>h(L.name)).catch(()=>h(t.cogita.library.collections.defaultName))},[c,x,t]),a.useEffect(()=>{En({libraryId:c,collectionId:x}).then(L=>{if(!L.graphId||L.graphId==="00000000-0000-0000-0000-000000000000"){ne([]),S([]);return}const pe=L.nodes.map(_=>{var fe;const he=_.payload??{},W=he.position??{x:120,y:120},K=he.params??{};return{id:_.nodeId,type:"default",position:W,data:{nodeType:_.nodeType,label:((fe=os.find(xe=>xe.type===_.nodeType))==null?void 0:fe.label)??_.nodeType,params:K}}}),j=L.edges.map(_=>({id:_.edgeId,source:_.fromNodeId,target:_.toNodeId,sourceHandle:_.fromPort??void 0,targetHandle:_.toPort??void 0}));ne(pe),S(j)}).catch(()=>{ne([]),S([])})},[c,x,S,ne]);const M=a.useMemo(()=>N.find(L=>L.id===ie)??null,[N,ie]),J=L=>{var he;const pe=crypto.randomUUID(),j=((he=os.find(W=>W.type===L))==null?void 0:he.label)??L,_={...Hi[L]};ne(W=>[...W,{id:pe,type:"default",position:{x:120+W.length*40,y:120+W.length*40},data:{nodeType:L,label:j,params:_}}]),P(pe)},ae=a.useCallback(L=>{S(pe=>_s({...L,id:crypto.randomUUID()},pe))},[S]),te=async()=>{q(null);try{await Pn({libraryId:c,collectionId:x,nodes:N.map(L=>({nodeId:L.id,nodeType:L.data.nodeType,payload:{position:L.position,params:L.data.params}})),edges:U.map(L=>({edgeId:L.id,fromNodeId:L.source,fromPort:L.sourceHandle??null,toNodeId:L.target,toPort:L.targetHandle??null}))}),q(t.cogita.library.graph.saveSuccess)}catch{q(t.cogita.library.graph.saveFail)}},Fe=async()=>{try{const L=await An({libraryId:c,collectionId:x});G(L)}catch{G(null)}},ge=L=>{M&&ne(pe=>pe.map(j=>j.id===M.id?{...j,data:{...j.data,params:L}}:j))};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${k}/collections/${x}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Fe,children:t.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:te,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:os.map(L=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>J(L.type),children:L.label},L.type))}),b?e.jsx("p",{className:"cogita-help",children:b}):null,E&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(E.total))}),e.jsx("p",{children:t.cogita.library.graph.previewBreakdown.replace("{connections}",String(E.connections)).replace("{infos}",String(E.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(gs,{nodes:N,edges:U,onNodesChange:Y,onEdgesChange:g,onConnect:ae,onNodeClick:(L,pe)=>P(pe.id),fitView:!0,children:[e.jsx(ms,{color:"rgba(120,160,200,0.2)"}),e.jsx(ps,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),M?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:M.data.label}),M.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(sa,{libraryId:c,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:M.data.params.tagId?{id:M.data.params.tagId,label:M.data.params.tagLabel??"",infoType:"topic"}:null,onChange:L=>ge({...M.data.params,tagId:(L==null?void 0:L.id)??null,tagLabel:(L==null?void 0:L.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:M.data.params.scope??"any",onChange:L=>ge({...M.data.params,scope:L.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),M.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(sa,{libraryId:c,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:M.data.params.languageId?{id:M.data.params.languageId,label:M.data.params.languageLabel??"",infoType:"language"}:null,onChange:L=>ge({...M.data.params,languageId:(L==null?void 0:L.id)??null,languageLabel:(L==null?void 0:L.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:M.data.params.scope??"any",onChange:L=>ge({...M.data.params,scope:L.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),M.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:M.data.params.infoType??"word",onChange:L=>ge({...M.data.params,infoType:L.target.value}),children:Yi.map(L=>e.jsx("option",{value:L.value,children:L.label},L.value))})]}),e.jsx(sa,{libraryId:c,infoType:M.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:M.data.params.infoId?{id:M.data.params.infoId,label:M.data.params.infoLabel??"",infoType:M.data.params.infoType??"word"}:null,onChange:L=>ge({...M.data.params,infoId:(L==null?void 0:L.id)??null,infoLabel:(L==null?void 0:L.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),M.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:M.data.params.connectionType??"translation",onChange:L=>ge({...M.data.params,connectionType:L.target.value}),children:Qi.map(L=>e.jsx("option",{value:L.value,children:L.label},L.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:M.data.params.connectionId??"",onChange:L=>ge({...M.data.params,connectionId:L.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(M.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const ls="cogita.preferences",hn=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],cs={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ds=["settings","run","shared"];function Xi(t,s=""){const n=t.split("/").filter(Boolean);if(n[0]!=="cogita"||n[1]!=="library")return{};const i=n[2];if(!i)return{};if(!n[3])return{libraryId:i,target:"library_overview"};const o=new URLSearchParams(s),p=o.get("revisionId")??void 0,f=o.get("infoId")??void 0,y=o.get("infoView")==="cards"?"cards":"overview",A=o.get("collectionAction"),C=o.get("libraryAction");if(n[3]==="list")return{libraryId:i,target:C==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:p,infoId:f,infoView:y,libraryAction:C==="new-info"?"new-info":void 0};if(n[3]==="detail"||n[3]==="collection")return{libraryId:i,target:"all_cards",cardMode:n[3],revisionId:p,infoId:f,infoView:y};if(n[3]==="new"||n[3]==="add")return{libraryId:i,target:"new_card",revisionId:p,libraryAction:"new-info"};if(n[3]==="edit")return{libraryId:i,target:"new_card",revisionId:p,infoId:n[4]};if(n[3]==="infos"){const x=n[4];return x?n[5]==="checkcards"?{libraryId:i,target:"all_cards",cardMode:"list",revisionId:p,infoId:x,infoView:"cards"}:{libraryId:i,target:"all_cards",cardMode:"list",revisionId:p,infoId:x,infoView:"overview"}:{libraryId:i,target:"all_cards",cardMode:"list",revisionId:p}}if(n[3]==="shared-revisions")return{libraryId:i,target:"all_collections",revisionId:p};if(n[3]==="dependencies")return{libraryId:i,target:"dependencies"};if(n[3]==="transfer")return{libraryId:i,target:"transfer"};if(n[3]==="storyboards")return n[4]==="new"?{libraryId:i,target:"new_storyboard"}:{libraryId:i,target:"storyboards"};if(n[3]==="texts")return n[4]==="new"?{libraryId:i,target:"new_text"}:{libraryId:i,target:"texts"};if(n[3]!=="collections")return{libraryId:i,target:"library_overview"};if(n[4]==="new")return{libraryId:i,target:"new_collection",revisionId:p};const c=n[4];return c?n[5]==="graph"?{libraryId:i,target:"all_collections",collectionId:c,revisionId:p,revisionView:"graph"}:n[5]==="shared-revisions"?{libraryId:i,target:"all_collections",collectionId:c,revisionId:p,revisionView:"shared"}:n[5]==="revision"?{libraryId:i,target:"all_collections",collectionId:c,revisionId:p,revisionView:n[6]==="run"?"run":"settings"}:A==="new-revision"?{libraryId:i,target:"all_collections",collectionId:c,revisionId:p,revisionView:"new"}:{libraryId:i,target:"all_collections",collectionId:c,revisionId:p,revisionView:"detail"}:A==="new-collection"?{libraryId:i,target:"new_collection",collectionAction:"new-collection"}:{libraryId:i,target:"all_collections"}}function Ks(t,s="library_overview",n,i,o,p,f="overview"){const y=(A,C)=>{const c=new URLSearchParams;C!=null&&C.revisionId&&c.set("revisionId",C.revisionId),C!=null&&C.collectionAction&&c.set("collectionAction",C.collectionAction),C!=null&&C.libraryAction&&c.set("libraryAction",C.libraryAction),C!=null&&C.infoId&&c.set("infoId",C.infoId),C!=null&&C.infoView&&(C!=null&&C.infoId)&&c.set("infoView",C.infoView);const x=c.toString();return x?`${A}?${x}`:A};return t?s==="library_overview"?y(`/cogita/library/${t}`,{revisionId:o}):s==="all_cards"?p?f==="cards"?y(`/cogita/library/${t}/infos/${p}/checkcards`,{revisionId:o}):y(`/cogita/library/${t}/infos/${p}`,{revisionId:o}):y(`/cogita/library/${t}/list`,{revisionId:o,infoId:p,infoView:f}):s==="new_card"?p?y(`/cogita/library/${t}/edit/${p}`,{revisionId:o}):y(`/cogita/library/${t}/list`,{revisionId:o,libraryAction:"new-info"}):s==="all_collections"?n?i==="graph"?y(`/cogita/library/${t}/collections/${n}/graph`,{revisionId:o}):i==="settings"?y(`/cogita/library/${t}/collections/${n}/revision`,{revisionId:o}):i==="run"?y(`/cogita/library/${t}/collections/${n}/revision/run`,{revisionId:o}):i==="shared"?y(`/cogita/library/${t}/collections/${n}/shared-revisions`,{revisionId:o}):i==="new"?y(`/cogita/library/${t}/collections/${n}`,{revisionId:o,collectionAction:"new-revision"}):y(`/cogita/library/${t}/collections/${n}`,{revisionId:o}):y(`/cogita/library/${t}/collections`,{revisionId:o}):s==="new_collection"?y(`/cogita/library/${t}/collections`,{revisionId:o,collectionAction:"new-collection"}):s==="transfer"?y(`/cogita/library/${t}/transfer`,{revisionId:o}):s==="storyboards"?y(`/cogita/library/${t}/storyboards`,{revisionId:o}):s==="new_storyboard"?y(`/cogita/library/${t}/storyboards/new`,{revisionId:o}):s==="texts"?y(`/cogita/library/${t}/texts`,{revisionId:o}):s==="new_text"?y(`/cogita/library/${t}/texts/new`,{revisionId:o}):s==="dependencies"?y(`/cogita/library/${t}/dependencies`,{revisionId:o}):y(`/cogita/library/${t}`,{revisionId:o}):"/cogita"}function xa(t){return t.length>1&&t.endsWith("/")?t.slice(0,-1):t}function Ji(t){return typeof t=="string"&&hn.includes(t)}function Zi(t,s){var y;if(!t.length)return null;const n=t.filter(A=>s.has(A.roleId)),i=n.length>0?n:t,o=i.map(A=>{var c,x;const C=((x=(c=A.fields.find(l=>l.fieldType==="role_kind"))==null?void 0:c.plainValue)==null?void 0:x.toLowerCase())??"";return{roleId:A.roleId,roleKind:C}}),p=o.find(A=>A.roleKind.includes("master"));if(p)return p.roleId;const f=o.find(A=>A.roleKind.includes("account")||A.roleKind.includes("user"));return f?f.roleId:((y=i[0])==null?void 0:y.roleId)??null}function er(t){if(!t)return{version:1,byLibrary:{}};try{const s=JSON.parse(t);return!s||typeof s!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:s.lastLibraryId,byLibrary:s.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function tr({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C}){const c=zs(),x=_a(),l=a.useMemo(()=>Xi(x.pathname,x.search),[x.pathname,x.search]),h=t.cogita.workspace,[N,ne]=a.useState([]),[Y,U]=a.useState([]),[S,g]=a.useState([]),[ie,P]=a.useState([]),[b,q]=a.useState(void 0),[E,G]=a.useState("library_overview"),[k,M]=a.useState(void 0),[J,ae]=a.useState(void 0),[te,Fe]=a.useState("detail"),[ge,L]=a.useState(void 0),[pe,j]=a.useState(!1),[_,he]=a.useState(!0),[W,K]=a.useState(!1),[fe,xe]=a.useState(!1),[ve,Ae]=a.useState(null),[Se,Ue]=a.useState(0),[Ke,Ne]=a.useState(""),[He,at]=a.useState(""),[et,D]=a.useState(""),[H,We]=a.useState(null),[Ce,re]=a.useState(null),Re=a.useRef({version:1,byLibrary:{}}),ze=a.useRef(!1),Be=a.useRef(!1),De=a.useRef(null),Q=a.useMemo(()=>N.find(m=>m.libraryId===b)??null,[N,b]),de=a.useMemo(()=>Y.find(m=>m.collectionId===k)??null,[Y,k]),$e=a.useMemo(()=>ie.find(m=>m.revisionId===J)??null,[ie,J]),R=a.useMemo(()=>({detail:h.revisions.detail,graph:h.revisions.graph,settings:h.revisions.settings,run:h.revisions.run,shared:h.targets.sharedRevisions,new:h.revisionForm.createAction}),[h.revisions.detail,h.revisions.graph,h.revisions.run,h.revisions.settings,h.targets.sharedRevisions,h.revisionForm.createAction]),V=a.useMemo(()=>[{value:"detail",label:R.detail},{value:"graph",label:R.graph},{value:"settings",label:h.targets.allRevisions},{value:"run",label:R.run},{value:"shared",label:R.shared}],[R.detail,R.graph,R.run,R.shared,h.targets.allRevisions]),me=a.useMemo(()=>E==="new_card"?"all_cards":E==="new_collection"?"all_collections":E==="new_storyboard"?"storyboards":E==="new_text"?"texts":E,[E]),ke=a.useMemo(()=>te==="new"?"settings":te,[te]),be=a.useMemo(()=>l.infoId?"selected":E==="new_card"?"create":"search",[l.infoId,E]),Le=a.useMemo(()=>S.find(m=>m.infoId===l.infoId)??null,[S,l.infoId]),Pe=a.useMemo(()=>({library_overview:h.targets.libraryOverview,all_cards:h.targets.allCards,new_card:h.targets.newCard,all_collections:h.targets.allCollections,new_collection:h.targets.newCollection,transfer:h.targets.transfer,storyboards:h.targets.storyboards,new_storyboard:h.targets.newStoryboard,texts:h.targets.texts,new_text:h.targets.newText,dependencies:h.targets.dependencies}),[h.targets]),Ve=a.useMemo(()=>Pe[me]??me,[me,Pe]),Ie=R[ke],Ee=!!b,we=a.useMemo(()=>{const m=A==="pl"?"Ruch na teraz: utwórz bibliotekę i wpisz pierwszy element wiedzy.":A==="de"?"Nächster Schritt: Erstelle eine Bibliothek und füge den ersten Wissenseintrag hinzu.":"Next action: create one library and add your first knowledge item.";return A==="pl"?[{step:"Krok 1",title:"Czym jest Cogita?",lead:"To centrum budowania i prowadzenia procesu nauki po zalogowaniu.",passages:["W jednym miejscu łączysz treści, ćwiczenia i współpracę zespołu.","Zamiast luźnych notatek dostajesz spójny przepływ: biblioteka → kolekcja → powtórka."],focus:["Jedna przestrzeń robocza","Spójny proces"],action:m},{step:"Krok 2",title:"Zacznij od biblioteki",lead:"Biblioteka jest bazą dla całego tematu.",passages:["Nazwij bibliotekę jasno: np. „Historia Kościoła – semestr 1”.","Każdy kolejny moduł korzysta z tej samej biblioteki jako źródła."],focus:["Nazwa tematyczna","Jeden punkt startowy"],action:m},{step:"Krok 3",title:"Dodawaj informacje",lead:"Twórz krótkie, konkretne jednostki wiedzy.",passages:["Wpisy typu info opisują pojęcia, osoby, źródła i cytaty.","Małe jednostki łatwiej łączyć, powtarzać i aktualizować."],focus:["Krótko i konkretnie","Łatwe aktualizacje"],action:m},{step:"Krok 4",title:"Pracuj na typach",lead:"Formularze dostosowują się do rodzaju informacji.",passages:["Każdy typ pokazuje właściwe pola i porządkuje dane.","To zmniejsza chaos i poprawia jakość wyszukiwania."],focus:["Lepsza struktura","Mniej błędów"],action:m},{step:"Krok 5",title:"Łącz wiedzę linkami",lead:"Buduj kontekst przez relacje między wpisami.",passages:["Połącz temat z definicją, źródłem i przykładem.","Graf relacji pomaga zobaczyć, czego brakuje przed kolejnym etapem."],focus:["Relacje między wpisami","Pełniejszy kontekst"],action:m},{step:"Krok 6",title:"Twórz kolekcje celu",lead:"Kolekcja grupuje wpisy pod konkretny scenariusz.",passages:["Osobna kolekcja dla lekcji, osobna dla quizu lub egzaminu.","Nie duplikujesz treści — tylko wybierasz, co jest potrzebne."],focus:["Celowe grupowanie","Bez duplikatów"],action:m},{step:"Krok 7",title:"Dodawaj powtórki",lead:"Powtórka definiuje jak przebiega sprawdzanie.",passages:["Ustaw tempo, kolejność i zakres materiału.","Dla jednej kolekcji możesz mieć kilka powtórek o różnych poziomach."],focus:["Kontrola tempa","Różne poziomy"],action:m},{step:"Krok 8",title:"Info vs karta",lead:"Rozróżniaj źródło wiedzy i widok ćwiczeniowy.",passages:["Info to rekord bazowy, który przechowuje treść.","Karta to forma pytania/utrwalenia generowana z info."],focus:["Źródło danych","Widok ćwiczeń"],action:m},{step:"Krok 9",title:"Uruchamiaj sesję",lead:"Tryb Run prowadzi uczestników krok po kroku.",passages:["Prowadzący kontroluje rytm i przejścia między etapami.","Uczestnicy mają jasny przebieg bez zgadywania, co dalej."],focus:["Płynny przebieg","Lepsza dynamika grupy"],action:m},{step:"Krok 10",title:"Czytaj graf zależności",lead:"Graf pokazuje priorytety nauki.",passages:["Węzły centralne oznaczają tematy, które wpływają na wiele innych.","Najpierw utrwal fundamenty, potem przechodź do warstw zaawansowanych."],focus:["Priorytety materiału","Lepsza kolejność"],action:m},{step:"Krok 11",title:"Storyboard i teksty",lead:"Plan i notatki trzymaj blisko wiedzy źródłowej.",passages:["Storyboard układa narrację i przebieg spotkania.","Teksty zbierają komentarze, wnioski i gotowe treści do publikacji."],focus:["Lepsze przygotowanie","Notatki w kontekście"],action:m},{step:"Krok 12",title:"Udostępniaj bezpiecznie",lead:"Dziel się materiałem bez utraty kontroli.",passages:["Możesz dać dostęp tylko do odczytu dla wybranych osób.","Edycja pozostaje po stronie autora lub zespołu prowadzącego."],focus:["Kontrola uprawnień","Bezpieczne współdzielenie"],action:m},{step:"Krok 13",title:"Nawiguj warstwowo",lead:"Sidebar i breadcrumb prowadzą przez poziomy.",passages:["Zawsze widzisz, czy pracujesz na bibliotece, kolekcji czy powtórce.","Mniej kliknięć „w ciemno”, więcej świadomej nawigacji."],focus:["Orientacja w systemie","Szybsze decyzje"],action:m},{step:"Krok 14",title:"Plan wdrożenia 30 minut",lead:"Najpierw prosty pilot, potem rozwijaj.",passages:["Plan: 1 biblioteka, 10 wpisów info, 1 kolekcja, 1 powtórka testowa.","Po pierwszej sesji popraw strukturę i dodaj kolejne scenariusze."],focus:["Szybki start","Iteracyjne doskonalenie"],action:"Gotowe? Załóż bibliotekę po prawej i przejdź do pierwszego wpisu."}]:A==="de"?[{step:"Schritt 1",title:"Was ist Cogita?",lead:"Ein zentraler Workspace für Lernen und Moderation nach dem Login.",passages:["Du verbindest Inhalte, Übungen und Teamarbeit in einem Ablauf.","Der Prozess bleibt klar: Bibliothek → Sammlung → Wiederholung."],focus:["Ein Workspace","Klarer Ablauf"],action:m},{step:"Schritt 2",title:"Mit Bibliothek starten",lead:"Die Bibliothek ist der Startpunkt für dein Thema.",passages:["Vergib einen klaren Namen für Kurs oder Modul.","Alle weiteren Bereiche greifen auf diese Basis zu."],focus:["Sauberer Start","Gemeinsame Basis"],action:m},{step:"Schritt 3",title:"Infos anlegen",lead:"Erfasse Wissen in kleinen, klaren Einträgen.",passages:["Info-Einträge enthalten Begriffe, Personen, Quellen und Zitate.","Kleinere Einheiten lassen sich besser verknüpfen und trainieren."],focus:["Kleine Einheiten","Leicht wartbar"],action:m},{step:"Schritt 4",title:"Typbasierte Eingabe",lead:"Formulare passen sich automatisch dem Info-Typ an.",passages:["Dadurch bleiben Daten strukturiert und konsistent.","Das verbessert Qualität und Auffindbarkeit."],focus:["Konsistenz","Bessere Suche"],action:m},{step:"Schritt 5",title:"Wissen verlinken",lead:"Verbinde Einträge zu einem Kontextnetz.",passages:["Thema, Quelle und Beispiel werden als Beziehung sichtbar.","So erkennst du Lücken vor der nächsten Lernphase."],focus:["Kontextnetz","Lücken erkennen"],action:m},{step:"Schritt 6",title:"Ziel-Sammlungen bauen",lead:"Eine Sammlung bündelt Inhalte für einen konkreten Zweck.",passages:["Nutze getrennte Sammlungen für Unterricht, Quiz oder Prüfung.","Du wählst Inhalte aus statt sie zu kopieren."],focus:["Zielorientierung","Keine Duplikate"],action:m},{step:"Schritt 7",title:"Wiederholungen erstellen",lead:"Wiederholungen definieren den Prüfungsablauf.",passages:["Tempo, Reihenfolge und Umfang sind pro Wiederholung steuerbar.","Mehrere Wiederholungen pro Sammlung sind möglich."],focus:["Ablaufsteuerung","Mehrere Niveaus"],action:m},{step:"Schritt 8",title:"Info und Karte",lead:"Datenobjekt und Trainingsansicht sind getrennt.",passages:["Info ist die Quelle der Inhalte.","Die Karte ist die Übungsansicht für Frage und Antwort."],focus:["Sauberes Modell","Wiederverwendbar"],action:m},{step:"Schritt 9",title:"Sitzung durchführen",lead:"Im Run-Modus führst du die Gruppe Schritt für Schritt.",passages:["Moderation steuert Übergänge und Timing.","Teilnehmende folgen einem klaren Ablauf."],focus:["Klare Moderation","Stabile Dynamik"],action:m},{step:"Schritt 10",title:"Abhängigkeitsgraph lesen",lead:"Der Graph zeigt Lernprioritäten.",passages:["Zentrale Knoten beeinflussen viele weitere Themen.","Starte mit Grundlagen und baue danach auf."],focus:["Priorisierung","Lernreihenfolge"],action:m},{step:"Schritt 11",title:"Storyboard & Texte",lead:"Plane Ablauf und sammle Notizen im selben Kontext.",passages:["Storyboards strukturieren Sequenzen und Rollen.","Texte halten Erkenntnisse und veröffentlichungsreife Inhalte fest."],focus:["Planung","Dokumentation"],action:m},{step:"Schritt 12",title:"Sicher teilen",lead:"Teile Inhalte ohne Kontrollverlust.",passages:["Leserechte sind separat von Bearbeitungsrechten steuerbar.","So bleibt der Kernbestand geschützt."],focus:["Rechtekontrolle","Sicheres Teilen"],action:m},{step:"Schritt 13",title:"Ebenen-Navigation",lead:"Sidebar und Breadcrumb zeigen deinen aktuellen Kontext.",passages:["Du siehst sofort, auf welcher Ebene du arbeitest.","Das spart Zeit und reduziert Fehlklicks."],focus:["Orientierung","Effizienz"],action:m},{step:"Schritt 14",title:"30-Minuten-Startplan",lead:"Starte klein und erweitere iterativ.",passages:["Plan: 1 Bibliothek, 10 Infos, 1 Sammlung, 1 Test-Wiederholung.","Nach der ersten Runde verbesserst du Struktur und Ablauf."],focus:["Schneller Einstieg","Iteratives Vorgehen"],action:"Jetzt starten: Bibliothek rechts anlegen und den ersten Eintrag erfassen."}]:[{step:"Step 1",title:"What is Cogita?",lead:"A post-login workspace to design, run, and improve knowledge journeys.",passages:["You can keep content, training flow, and collaboration in one place.","The path stays explicit: library → collection → revision → session."],focus:["Single workspace","Clear learning flow"],action:m},{step:"Step 2",title:"Start with a library",lead:"Your library is the root container for one domain or program.",passages:["Name it after your course, cohort, or topic scope.","Every next module reuses this foundation."],focus:["Root container","Consistent base"],action:m},{step:"Step 3",title:"Add information units",lead:"Build knowledge from small, reusable info entries.",passages:["Capture terms, references, people, concepts, and citations.","Smaller entries are easier to link, review, and update."],focus:["Reusable units","Easy maintenance"],action:m},{step:"Step 4",title:"Use type-based forms",lead:"Each info type has a matching data structure and fields.",passages:["Form layouts adapt automatically to the selected type.","This improves consistency and lowers input mistakes."],focus:["Structured input","Fewer errors"],action:m},{step:"Step 5",title:"Link the knowledge graph",lead:"Relationships turn isolated facts into usable context.",passages:["Connect topics, sources, and supporting examples.","Dependency links show what must be learned first."],focus:["Context building","Better sequencing"],action:m},{step:"Step 6",title:"Build goal collections",lead:"Collections package selected infos for a concrete objective.",passages:["Create separate collections for class, quiz, exam, or workshop.","You curate from existing entries instead of duplicating content."],focus:["Goal-oriented sets","No duplication"],action:m},{step:"Step 7",title:"Create revisions",lead:"Revisions define how practice and checking should run.",passages:["Set pacing, order, and scope for each session style.","One collection can host multiple revision strategies."],focus:["Practice design","Multiple modes"],action:m},{step:"Step 8",title:"Understand info vs card",lead:"Data objects and practice views are intentionally separate.",passages:["Info is the canonical source object.","Card is the generated training/checking view."],focus:["Clear model","Reusable content"],action:m},{step:"Step 9",title:"Run live sessions",lead:"Run mode helps facilitators guide each step with control.",passages:["Move through prompts, responses, and timing intentionally.","Participants get a predictable and focused session rhythm."],focus:["Facilitator control","Group clarity"],action:m},{step:"Step 10",title:"Read dependency graphs",lead:"Graph views expose prerequisites and high-impact nodes.",passages:["Central nodes usually deserve priority in onboarding.","Use this to plan revision order and reduce confusion."],focus:["Priority mapping","Smarter progression"],action:m},{step:"Step 11",title:"Use storyboards and texts",lead:"Plan narratives and keep notes near source knowledge.",passages:["Storyboards model session structure and transitions.","Texts capture outcomes, drafts, and reusable explanations."],focus:["Planning layer","Contextual notes"],action:m},{step:"Step 12",title:"Share safely",lead:"Share read access without losing editorial control.",passages:["Keep editing rights restricted to owners or maintainers.","Collaborators can consume material while core data stays protected."],focus:["Access control","Safe collaboration"],action:m},{step:"Step 13",title:"Navigate by layers",lead:"Sidebar and breadcrumb make system depth understandable.",passages:["You always know whether you are at library, collection, or revision level.","Clear location awareness reduces wrong actions."],focus:["Fast orientation","Lower friction"],action:m},{step:"Step 14",title:"30-minute launch plan",lead:"Start with a minimum viable setup, then iterate.",passages:["Plan: create 1 library, add 10 infos, build 1 collection, run 1 revision.","After the first run, refine structure and scale by scenario."],focus:["Immediate execution","Iterative improvement"],action:"Ready now? Create your first library on the right and start adding knowledge."}]},[A]),st=we.length,qe=Math.max(0,Math.min(Se,st-1)),Xe=we[qe],rt=!!k,yt=Ee&&E==="all_collections",Je=rt&&E==="all_collections",Ze=rt&&E==="all_collections"&&ds.includes(te),ct=a.useCallback(m=>{const je=!!m.libraryId;let d=m.target,X=m.collectionId,ye=m.revisionId,_e=m.revisionView,ee=m.infoId,oe=m.infoView??l.infoView??"overview";je?cs[d].requiresCollection&&!X?(d="all_collections",ye=void 0,_e="detail"):d!=="all_collections"?(X=void 0,ye=void 0,d!=="new_card"&&d!=="all_cards"&&(ee=void 0,oe="overview")):cs[d].allowsRevision?ds.includes(_e)||(ye=void 0):_e="detail":(d="library_overview",X=void 0,ye=void 0,_e="detail",ee=void 0,oe="overview"),q(m.libraryId),G(d),M(X),ae(ye),Fe(_e),j(!1);const vt=xa(Ks(m.libraryId,d,X,_e,ye,ee,oe));xa(`${x.pathname}${x.search}`)!==vt&&(De.current=vt,c(vt))},[x.pathname,x.search,c,l.infoView]),dt=m=>{ct({libraryId:b,target:"all_collections",collectionId:k,revisionId:ds.includes(m)?J:void 0,revisionView:m})},It=a.useMemo(()=>[{key:"library",label:h.layers.library,visible:!0,value:b??"",selectedLabel:(Q==null?void 0:Q.name)??h.path.noLibrarySelected,disabled:_||N.length===0,options:N.map(m=>({value:m.libraryId,label:m.name})),emptyOption:h.noLibraryOption,onSelect:m=>{const je=m||void 0;ct({libraryId:je,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:h.layers.target,visible:Ee,value:me,selectedLabel:Ve,disabled:!Ee,options:hn.map(m=>({value:m,label:Pe[m]})),onSelect:m=>{const je=m;ct({libraryId:b,target:je,collectionId:k,revisionId:J,revisionView:te,infoId:je==="new_card"?l.infoId:void 0})}},{key:"info_mode",label:h.layers.target,visible:me==="all_cards",value:be,selectedLabel:be==="create"?h.infoMode.create:be==="selected"?(Le==null?void 0:Le.label)??ge??t.cogita.library.list.selectedEmpty:h.infoMode.search,disabled:!Ee,options:[{value:"search",label:h.infoMode.search},{value:"create",label:h.infoMode.create},...l.infoId?[{value:"selected",label:(Le==null?void 0:Le.label)??ge??t.cogita.library.list.selectedEmpty}]:[]],onSelect:m=>{if(m==="selected"){if(!l.infoId)return;ct({libraryId:b,target:"all_cards",collectionId:k,revisionId:J,revisionView:te,infoId:l.infoId,infoView:"overview"});return}if(m==="create"){ct({libraryId:b,target:"new_card",collectionId:k,revisionId:J,revisionView:te,infoId:void 0});return}ct({libraryId:b,target:"all_cards",collectionId:k,revisionId:J,revisionView:te,infoId:void 0,infoView:"overview"})}},{key:"info_selected_action",label:h.layers.target,visible:me==="all_cards"&&!!l.infoId,value:E==="new_card"&&l.infoId?"edit":l.infoView==="cards"?"cards":"overview",selectedLabel:E==="new_card"&&l.infoId?h.infoActions.edit:l.infoView==="cards"?h.infoActions.seeCards:h.infoActions.overview,disabled:!Ee||!l.infoId,options:[{value:"overview",label:h.infoActions.overview},{value:"edit",label:h.infoActions.edit},{value:"cards",label:h.infoActions.seeCards}],onSelect:m=>{if(l.infoId){if(m==="edit"){ct({libraryId:b,target:"new_card",collectionId:k,revisionId:J,revisionView:te,infoId:l.infoId});return}if(m==="cards"){ct({libraryId:b,target:"all_cards",collectionId:k,revisionId:J,revisionView:te,infoId:l.infoId,infoView:"cards"});return}ct({libraryId:b,target:"all_cards",collectionId:k,revisionId:J,revisionView:te,infoId:l.infoId,infoView:"overview"})}}},{key:"collection",label:h.layers.collection,visible:yt,value:k??"",selectedLabel:(de==null?void 0:de.name)??h.path.noCollectionSelected,disabled:!Ee||W||Y.length===0,options:Y.map(m=>({value:m.collectionId,label:m.name})),emptyOption:h.selectCollectionOption,onSelect:m=>{ct({libraryId:b,target:"all_collections",collectionId:m||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:h.layers.revision,visible:Je,value:ke,selectedLabel:Ie,disabled:!k,options:V.map(m=>({value:m.value,label:m.label})),onSelect:m=>{dt(m)}},{key:"revision_entry",label:h.layers.revision,visible:Ze,value:J??"",selectedLabel:($e==null?void 0:$e.name)??h.status.noRevisions,disabled:!rt||fe||ie.length===0,options:ie.map(m=>({value:m.revisionId,label:m.name})),emptyOption:h.status.noRevisions,onSelect:m=>{ct({libraryId:b,target:"all_collections",collectionId:k,revisionId:m||void 0,revisionView:te})}}],[V,Y,W,be,S,N,_,ct,ie,fe,de,k,Le,$e,J,ge,rt,Ee,Q,b,Ie,te,E,ke,me,Ve,yt,Je,Ze,Pe,t.cogita.library.list.selectedEmpty,l.infoId,l.infoView,h.infoActions.edit,h.infoActions.overview,h.infoActions.seeCards,h.layers.collection,h.layers.library,h.layers.revision,h.layers.target,h.noLibraryOption,h.path.noCollectionSelected,h.path.noLibrarySelected,h.selectCollectionOption]),nt=a.useMemo(()=>It.filter(m=>m.visible),[It]),ot=a.useMemo(()=>nt.filter(m=>m.key!=="library"&&m.key!=="collection"&&m.key!=="revision_entry"),[nt]),Lt=a.useMemo(()=>ot.find(m=>m.key==="target")??null,[ot]),ft=a.useMemo(()=>ot.find(m=>m.key==="info_mode")??null,[ot]),tt=a.useMemo(()=>ot.find(m=>m.key==="info_selected_action")??null,[ot]),it=a.useMemo(()=>ot.find(m=>m.key==="collection_action")??null,[ot]),xt=a.useCallback((m,je)=>m?e.jsx("div",{className:"cogita-sidebar-actions",children:m.options.map(d=>e.jsx("button",{type:"button",className:`ghost ${String(m.value)===d.value?"active":""}`,onClick:()=>m.onSelect(d.value),disabled:m.disabled,children:d.label},`${je}:${m.key}:${d.value}`))}):null,[]),St=a.useMemo(()=>{const m=l.libraryId;if(!m||!x.pathname.startsWith("/cogita/library/"))return null;const je={copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,libraryId:m};if(l.target==="library_overview")return e.jsx(ei,{...je});if(l.target==="all_cards")return l.infoId&&l.infoView==="cards"?e.jsx(xi,{...je,infoId:l.infoId}):e.jsx(oi,{...je,mode:l.cardMode??"list"});if(l.target==="new_card")return e.jsx(pi,{...je,editInfoId:l.infoId});if(l.target==="dependencies")return e.jsx(bi,{...je});if(l.target==="transfer")return e.jsx(wi,{...je});if(l.target==="storyboards"||l.target==="new_storyboard")return e.jsx(ji,{...je});if(l.target==="texts"||l.target==="new_text")return e.jsx(ki,{...je});if(l.target==="all_collections"){if(l.collectionId){const d={...je,collectionId:l.collectionId};return l.revisionView==="graph"?e.jsx(Gi,{...d}):l.revisionView==="shared"?e.jsx(vi,{...je,collectionId:l.collectionId}):l.revisionView==="settings"?e.jsx(Ei,{...d,revisionId:l.revisionId}):l.revisionView==="run"?e.jsx(Wi,{...d,revisionId:l.revisionId}):e.jsx(Ni,{...d})}return e.jsx(Ps,{...je})}return l.target==="new_collection"?e.jsx(Ps,{...je}):null},[s,t,A,x.pathname,c,C,p,y,i,o,l.cardMode,l.collectionId,l.infoId,l.libraryId,l.revisionId,l.revisionView,l.target,f,n]);a.useEffect(()=>{let m=!1;return(async()=>{var d,X,ye,_e,ee;he(!0);try{await Fn();const[oe,vt,At]=await Promise.all([qs(),Kn(),zn()]);if(m)return;ne(oe);const qt=new Set(At.nodes.filter(mt=>mt.nodeType==="role"&&mt.canLink).map(mt=>mt.roleId??"")),zt=Zi(vt,qt);if(We(zt),zt){const mt=At.nodes.find(wt=>wt.nodeType==="data"&&wt.roleId===zt&&(wt.fieldType===ls||wt.label===ls));re((mt==null?void 0:mt.dataKeyId)??null),Re.current=er(mt==null?void 0:mt.value)}const Pt=(d=oe.find(mt=>mt.libraryId===l.libraryId))==null?void 0:d.libraryId,na=Pt?(ye=(X=Re.current.byLibrary)==null?void 0:X[Pt])==null?void 0:ye.lastTarget:void 0,Ut=Ji(na)?na:"library_overview";q(Pt),G(l.target??Ut),ae(l.revisionId??(Pt?(ee=(_e=Re.current.byLibrary)==null?void 0:_e[Pt])==null?void 0:ee.lastRevisionId:void 0)),Fe(l.revisionView??"detail"),ze.current=!0}catch{m||Ae(h.status.loadFailed)}finally{m||he(!1)}})(),()=>{m=!0}},[h.status.loadFailed]),a.useLayoutEffect(()=>{if(ze.current){if(!l.libraryId){q(void 0),G(l.target??"library_overview"),M(void 0),ae(void 0),Fe("detail");return}l.libraryId&&N.some(m=>m.libraryId===l.libraryId)&&q(l.libraryId),l.target&&G(l.target),M(l.collectionId),ae(l.revisionId),l.revisionView&&Fe(l.revisionView)}},[N,l.collectionId,l.libraryId,l.revisionId,l.revisionView,l.target]),a.useEffect(()=>{if(!b){U([]),M(void 0),g([]),P([]),ae(void 0);return}let m=!1;return K(!0),wa({libraryId:b,limit:200}).then(je=>{var ye;if(m)return;const d=je.items;U(d);const X=(ye=d.find(_e=>_e.collectionId===l.collectionId))==null?void 0:ye.collectionId;M(X)}).catch(()=>{m||(U([]),M(void 0))}).finally(()=>{m||K(!1)}),()=>{m=!0}},[l.collectionId,b]),a.useEffect(()=>{if(!b||me!=="all_cards"&&E!=="new_card"){g([]);return}let m=!1;return bs({libraryId:b,limit:200}).then(je=>{m||g(je)}).catch(()=>{m||g([])}),()=>{m=!0}},[me,b,E]),a.useEffect(()=>{if(!b||!k){P([]),ae(void 0);return}let m=!1;return xe(!0),Us({libraryId:b,collectionId:k}).then(je=>{var ye,_e,ee,oe;if(m)return;P(je);const d=(_e=(ye=Re.current.byLibrary)==null?void 0:ye[b])==null?void 0:_e.lastRevisionId,X=((ee=je.find(vt=>vt.revisionId===l.revisionId))==null?void 0:ee.revisionId)??((oe=je.find(vt=>vt.revisionId===d))==null?void 0:oe.revisionId);ae(X)}).catch(()=>{m||(P([]),ae(void 0))}).finally(()=>{m||xe(!1)}),()=>{m=!0}},[l.revisionId,k,b]),a.useEffect(()=>{const m=l.infoId;if(!b||!m){L(void 0);return}let je=!1;return Yt({libraryId:b,infoId:m}).then(d=>{if(je)return;const X=d.payload;L((X==null?void 0:X.label)??(X==null?void 0:X.name)??(X==null?void 0:X.title)??d.infoId)}).catch(()=>{je||L(m)}),()=>{je=!0}},[l.infoId,b]),a.useEffect(()=>{if(!ze.current||l.libraryId&&N.some(X=>X.libraryId===l.libraryId)&&l.libraryId!==b||l.target&&l.target!==E||l.revisionView&&l.revisionView!==te||l.revisionId&&l.revisionId!==J||cs[E].requiresCollection&&!k&&l.target==="all_collections"&&l.collectionId)return;const m=xa(`${x.pathname}${x.search}`);if(xa(x.pathname)==="/cogita"&&!l.libraryId&&!b){De.current=null;return}const d=xa(Ks(b,E,k,te,J,l.infoId,l.infoView??"overview"));if(m===d){De.current=null;return}De.current!==d&&(De.current=d,c(d,{replace:!0}))},[N,x.pathname,x.search,c,l.collectionId,l.infoId,l.infoView,l.libraryId,l.revisionId,l.revisionView,l.target,k,b,J,te,E]),a.useEffect(()=>{if(typeof window>"u")return;const m=()=>{window.innerWidth>920&&j(!1)};return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]),a.useEffect(()=>{if(!ze.current||!H||!b||Be.current)return;const m=Re.current,je={...m.byLibrary??{}},d={...je[b]??{},lastCollectionId:k,lastRevisionId:J,lastRevisionView:te,lastTarget:E},X={version:1,lastLibraryId:b,byLibrary:{...je,[b]:d}},ye=JSON.stringify(m),_e=JSON.stringify(X);if(ye===_e)return;Re.current=X,Be.current=!0,(async()=>{try{if(Ce)await Bn(Ce,{plainValue:_e});else{const oe=await Dn(H,{itemName:ls,itemType:"data",plainValue:_e});re(oe.dataItemId)}}catch{Ae(h.status.savePrefsFailed)}finally{Be.current=!1}})()},[Ce,H,k,b,J,te,E,h.status.savePrefsFailed]);const Ge=async()=>{const m=Ke.trim();if(!m){Ae(t.cogita.user.libraryNameRequired);return}Ae(null);try{const je=await On({name:m});ne(d=>[je,...d]),q(je.libraryId),G("library_overview"),M(void 0),Ne("")}catch{Ae(t.cogita.user.libraryCreateFailed)}},ht=async()=>{if(!b){Ae(h.status.selectLibraryFirst);return}const m=He.trim();if(!m){Ae(t.cogita.library.collections.saveRequiredName);return}Ae(null);try{const je=await _n({libraryId:b,name:m,items:[]}),d=await wa({libraryId:b,limit:200});U(d.items),M(je.collectionId),ae(void 0),G("all_collections"),Fe("detail"),at("")}catch{Ae(t.cogita.library.collections.saveFail)}},bt=async()=>{if(!b||!k){Ae(h.status.selectLibraryFirst);return}const m=et.trim();if(!m){Ae(h.revisionForm.nameLabel);return}Ae(null);try{const je=await Vn({libraryId:b,collectionId:k,name:m,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});P(d=>[je,...d]),ae(je.revisionId),G("all_collections"),Fe("settings"),D("")}catch{Ae(h.status.loadFailed)}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${pe?"open":""}`,"aria-label":h.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Q==null?void 0:Q.name)??h.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Q?h.sidebar.libraryActionsHint:h.status.selectLibraryFirst}),xt(Lt,"sidebar")]}),ft?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:h.sidebar.infoActionsHint}),xt(ft,"sidebar"),tt?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(Le==null?void 0:Le.label)??ge??t.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:h.sidebar.selectedInfoActionsHint}),xt(tt,"sidebar")]}):null]}):null,de?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:de.name}),e.jsx("p",{className:"cogita-sidebar-note",children:h.sidebar.collectionActionsHint}),xt(it,"sidebar")]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:h.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:i,children:h.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{y("cogita"),j(!1)},children:h.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:o,children:f?t.account.secureModeDisable:t.account.secureModeEnable})]})]})]}),pe?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":h.sidebar.closeMenu,onClick:()=>j(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":h.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>j(m=>!m),"aria-label":pe?h.sidebar.closeMenu:h.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),nt.map((m,je)=>e.jsxs("div",{className:"cogita-browser-segment",children:[je>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,m.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":m.label,children:m.selectedLabel}):e.jsxs("select",{"aria-label":m.label,value:m.value,onChange:d=>m.onSelect(d.target.value),disabled:m.disabled,children:[m.emptyOption?e.jsx("option",{value:"",children:m.emptyOption}):null,m.options.map(d=>e.jsx("option",{value:d.value,children:d.label},`${m.key}:${d.value}`))]})]},`menu:${m.key}`))]}),St?e.jsxs(e.Fragment,{children:[E==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:m=>at(m.target.value),placeholder:t.cogita.library.collections.namePlaceholder,disabled:!b})]}),e.jsx("button",{type:"button",className:"cta",onClick:ht,disabled:!b,children:t.cogita.library.actions.createCollection}),ve?e.jsx("p",{className:"cogita-form-error",children:ve}):null]}):null,E==="all_collections"&&k&&te==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:h.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:h.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:et,onChange:m=>D(m.target.value),placeholder:h.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:bt,children:h.revisionForm.createAction}),ve?e.jsx("p",{className:"cogita-form-error",children:ve}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Xs.Provider,{value:!0,children:St})})]}):null,St?null:e.jsx(e.Fragment,{children:b?null:e.jsxs("section",{className:"cogita-browser-intro",children:[e.jsx("div",{className:"cogita-browser-intro-main",children:e.jsxs("article",{className:"cogita-browser-panel cogita-browser-tutorial",children:[e.jsxs("div",{className:"cogita-browser-tutorial-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-browser-tutorial-step",children:Xe.step}),e.jsx("h2",{children:Xe.title})]}),e.jsxs("p",{children:[qe+1," / ",st]})]}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-lead",children:Xe.lead}),e.jsx("div",{className:"cogita-browser-tutorial-passages",children:Xe.passages.map(m=>e.jsx("p",{children:m},m))}),e.jsx("div",{className:"cogita-browser-tutorial-focus",children:Xe.focus.map(m=>e.jsx("span",{children:m},m))}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-action",children:Xe.action}),e.jsx("div",{className:"cogita-browser-tutorial-progress",role:"list","aria-label":"Tutorial progress",children:we.map((m,je)=>e.jsx("button",{type:"button",className:`ghost ${je===qe?"active":""}`,onClick:()=>Ue(je),"aria-label":`${je+1}`,children:je+1},`tutorial:${m.title}:${je}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:qe===0,onClick:()=>Ue(m=>Math.max(0,m-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"cta",disabled:qe===st-1,onClick:()=>Ue(m=>Math.min(st-1,m+1)),children:"Next"})]})]})}),e.jsxs("div",{className:"cogita-browser-intro-side",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.createLibraryTitle}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:m=>Ne(m.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ge,children:t.cogita.user.createLibraryAction}),ve?e.jsx("p",{className:"cogita-form-error",children:ve}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.availableLibraries}),N.length===0?e.jsx("p",{className:"cogita-browser-note",children:t.cogita.user.noLibraries}):null,N.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:N.map(m=>e.jsxs("button",{type:"button",className:"cogita-card-item",onClick:()=>{ct({libraryId:m.libraryId,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.user.libraryRoleLabel}),e.jsx("h3",{className:"cogita-card-title",children:m.name})]},m.libraryId))}):null]})]})]})})]})]})})}const or=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:tr},Symbol.toStringTag,{value:"Module"}));function ar({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,shareId:c}){const[x,l]=a.useState(null),[h,N]=a.useState("loading"),[ne,Y]=a.useState(t.cogita.library.collections.defaultName),[U,S]=a.useState("Cogita Library"),[g,ie]=a.useState([]),[P,b]=a.useState([]),[q,E]=a.useState("idle"),[G,k]=a.useState({current:0,total:0}),[M,J]=a.useState(0),[ae,te]=a.useState(""),[Fe,ge]=a.useState(null),[L,pe]=a.useState(null),[j,_]=a.useState(null),[he,W]=a.useState(null),[K,fe]=a.useState([]),[xe,ve]=a.useState({}),[Ae,Se]=a.useState({}),[Ue,Ke]=a.useState(null),[Ne,He]=a.useState(null),[at,et]=a.useState(null),[D,H]=a.useState(null),[We,Ce]=a.useState({}),re=a.useRef(0),[Re,ze]=a.useState(null),Be=a.useRef(null),De=a.useRef(null),[Q,de]=a.useState(null),[$e,R]=a.useState(!1),[V,me]=a.useState(null),[ke,be]=a.useState([]),[Le,Pe]=a.useState(null),Ve=a.useRef(null),Ie=a.useRef(null),[Ee,we]=a.useState(null),[st,qe]=a.useState(0),Xe=a.useRef(null),rt=a.useRef({}),[yt,Je]=a.useState(!1),[Ze,ct]=a.useState({}),dt=a.useRef(null),It=a.useRef(new Set),nt=a.useRef({}),[ot,Lt]=a.useState([]),[ft,tt]=a.useState(new Set),[it,xt]=a.useState(!1),St=_a(),Ge=a.useMemo(()=>new URLSearchParams(St.search),[St.search]),ht=a.useMemo(()=>Ge.get("key")??"",[Ge]),bt=(x==null?void 0:x.mode)??"random",m=(x==null?void 0:x.check)??"exact",je=(x==null?void 0:x.limit)??20,d=a.useMemo(()=>ws((x==null?void 0:x.revisionType)??bt),[x,bt]),X=a.useMemo(()=>{const I=x==null?void 0:x.revisionSettings,O=an(d,Ge);return Ua(d,I??O)},[x,Ge,d]),ye=a.useMemo(()=>t.cogita.library.revision[d.labelKey]??bt,[t,bt,d]),_e=a.useMemo(()=>m==="exact"?t.cogita.library.revision.checkValue:m,[t,m]),oe=h==="ready"?g[M]??null:null,vt=(oe==null?void 0:oe.checkType)==="translation-match"&&D,At=a.useRef(new Map),qt=a.useRef(new Map),zt=a.useRef(new Map),Pt=a.useRef(new Map),na=a.useMemo(()=>oe?oe.cardType==="vocab"?t.cogita.library.revision.vocabLabel:oe.infoType?Ye(t,oe.infoType):t.cogita.library.revision.infoLabel:"",[t,oe]),Ut=a.useMemo(()=>{var O;return d.id!=="levels"?g.length:((O=Ze.pool)==null?void 0:O.length)??d.getFetchLimit(je,X)},[Ze,X,d,g.length,je]),mt=d.getProgressTotal?d.getProgressTotal(g,Ze,je,X):d.id==="levels"?Math.min(je,Ut):g.length,wt=mt?Math.min(M+1,mt):0,Ct=Math.max(1,Number(X.tries??1)),Wt=X.compare??"anchors",pt=Math.max(0,Math.min(100,Number(X.minCorrectness??0))),lt=(X.considerDependencies??"on")==="on",Et=Math.max(0,Math.min(100,Number(X.dependencyThreshold??85))),Gt=I=>{const O=I.slice();for(let r=O.length-1;r>0;r-=1){const u=Math.floor(Math.random()*(r+1));[O[r],O[u]]=[O[u],O[r]]}return O},Ht=I=>I.length?I.reduce((r,u)=>r+u,0)/I.length/255*100:0,ia=I=>Ht(I)>=pt,Wa=async()=>{const I=await Vt(),O=new Map,r=new Map;I.forEach(v=>{const B=`${v.itemType}:${v.itemId}`,w=Dt(v.itemType,v.itemId,v.checkType,v.direction);O.has(B)||O.set(B,[]),O.get(B).push(v),r.has(w)||r.set(w,[]),r.get(w).push(v)});const u=new Map,T=new Map;return O.forEach((v,B)=>u.set(B,_t(v).score)),r.forEach((v,B)=>T.set(B,_t(v).score)),{itemKnowness:u,cardKnowness:T}},fa=async I=>{const O=Ze,r=I.concat(O.active??[]).concat(O.pool??[]).filter((z,Z,se)=>se.findIndex(ue=>ce(ue)===ce(z))===Z);if(!lt){tt(new Set(r.map(ce)));return}const{itemKnowness:u,cardKnowness:T}=await Wa(),v=z=>{if(z.cardType!=="info"||z.infoType!=="citation"||z.checkType!=="quote-fragment")return!0;const Z=Mt(z.direction);if(!(Z!=null&&Z.fragmentId))return!0;const se=z.description??"";if(!se.trim())return!0;const le=ma(se).nodes[Z.fragmentId];if(!le||!le.leftId&&!le.rightId)return!0;const Te=[le.leftId,le.rightId].filter(Qe=>!!Qe);if(Te.length===0)return!0;const Me=Te.map(Qe=>{const ut=Dt("info",z.cardId,"quote-fragment",ka(Z.mode,Qe));return T.get(ut)??0});return Me.reduce((Qe,ut)=>Qe+ut,0)/Me.length>=Et},B=(x==null?void 0:x.collectionId)??null,w=B?ot.filter(z=>gt(z.childItemType)==="collection"&&z.childItemId===B&&!gt(z.childCheckType)&&!gt(z.childDirection)):[],F=B&&r.length>0?r.reduce((z,Z)=>z+(T.get(ce(Z))??0),0)/r.length:0,$=new Set;for(const z of r){if(z.cardType!=="info"){$.add(ce(z));continue}if(!v(z))continue;const Z=ot.filter(le=>un(le,z)).concat(w);if(Z.length===0){$.add(ce(z));continue}let se=0;for(const le of Z)if(gt(le.parentItemType)==="collection")se+=le.parentItemId===B?F:0;else if(gt(le.parentCheckType)||gt(le.parentDirection)){const Te=gt(le.parentCheckType),Me=gt(le.parentDirection),Oe=Dt(le.parentItemType,le.parentItemId,Te,Me);se+=T.get(Oe)??0}else{const Te=`${le.parentItemType}:${le.parentItemId}`;se+=u.get(Te)??0}se/Z.length>=Et&&$.add(ce(z))}tt($)},Ha=I=>{for(let O=I;O<g.length;O+=1){const r=g[O];if(r&&(!lt||r.cardType!=="info"||ft.has(ce(r))))return O}return-1},ra=I=>!lt||I.cardType!=="info"||ft.has(ce(I)),Qa=I=>{if(d.id!=="temporal"&&d.id!=="levels")return null;const O=Ze,r=(O.active??[]).concat(O.pool??[]),u=new Set;for(const T of r){const v=ce(T);if(!(u.has(v)||I.has(v))&&(u.add(v),ra(T)))return T}return null},$t=a.useMemo(()=>{if(d.id!=="levels")return null;const I=Ze,O=I.pool??[],r=I.active??[],u=I.levelMap??{},T=Math.max(1,Number(X.levels??1)),v=Array.from({length:T},()=>0),B=new Set(r.map(z=>ce(z)));O.forEach(z=>{const Z=Math.min(T,Math.max(1,u[ce(z)]??1));v[Z-1]+=1});const w=O.length||1,F=v.map(z=>z/w*100),$=oe?u[ce(oe)]??1:null;return{counts:v,percentages:F,currentLevel:$,levelsCount:T,activeCount:r.length,poolCount:O.length,activeSet:B}},[Ze,X,d,oe]),oa=a.useMemo(()=>{if(d.id!=="temporal")return null;const I=Ze,O=I.pool??[],r=I.active??[],u=I.knownessMap??{},T=new Set(I.unknownSet??[]);let v=0;O.forEach(F=>{(u[ce(F)]??0)>1&&(v+=1)});const B=T.size,w=r.map(F=>({id:ce(F),value:T.has(ce(F))?0:Math.max(0,Math.min(1,u[ce(F)]??0))}));return{knownCount:v,unknownCount:B,dots:w}},[Ze,d]),Ft=a.useMemo(()=>{if(!lt)return 0;const I=Ze;return g.concat(I.active??[]).concat(I.pool??[]).filter((r,u,T)=>T.findIndex(v=>ce(v)===ce(r))===u).filter(r=>r.cardType==="info"&&!ft.has(ce(r))).length},[lt,Ze,g,ft]);a.useEffect(()=>{if(!lt||q!=="ready")return;const I=Ze,r=g.concat(I.active??[]).concat(I.pool??[]).filter((v,B,w)=>w.findIndex(F=>ce(F)===ce(v))===B).filter(v=>v.cardType!=="info"||ft.has(ce(v))).length,u=Ve.current;if(Ve.current=r,u===null||r<=u)return;const T=r-u;Pe(`New card available (+${T})`),Ie.current&&window.clearTimeout(Ie.current),Ie.current=window.setTimeout(()=>Pe(null),2200)},[lt,q,Ze,g,ft]),a.useEffect(()=>()=>{Ie.current&&window.clearTimeout(Ie.current)},[]);const jt=(I,O)=>{const r=d.applyOutcome({queue:g,meta:Ze},oe,je,X,{correct:I,correctness:O,createdUtc:new Date().toISOString()});ie(r.queue),ct(r.meta);const u=r.queue[M+1];u&&Rt(u,M+1)};a.useEffect(()=>{if(!c){N("error");return}N("loading"),qn({shareId:c,key:ht}).then(I=>{l(I),Y(I.collectionName),S(I.libraryName),N("ready")}).catch(()=>{N("error")})},[c,ht]),a.useEffect(()=>{c&&Un({shareId:c,key:ht,type:"language"}).then(I=>b(I)).catch(()=>b([]))},[c,ht]),a.useEffect(()=>{!c||h!=="ready"||Wn({shareId:c,key:ht}).then(I=>Lt(I.items??[])).catch(()=>Lt([]))},[c,ht,h]),a.useEffect(()=>{if(!c||h!=="ready")return;let I=!0;return(async()=>{E("loading"),k({current:0,total:d.id==="levels"?0:d.getFetchLimit(je,X)});try{const r=[];let u=null,T=null;do{const Z=await Hn({shareId:c,key:ht,limit:300,cursor:u});if(r.push(...Z.items),(d.id==="levels"||d.id==="temporal")&&Z.total&&(T=Z.total),k(se=>({current:r.length,total:se.total||Z.total||d.getFetchLimit(je,X)})),u=Z.nextCursor??null,T!==null&&r.length>=T||d.id!=="levels"&&d.id!=="temporal"&&r.length>=d.getFetchLimit(je,X))break}while(u);if(!I)return;const v=hs(r);let B;if(d.id==="levels"){const Z=Math.max(1,Number(X.levels??1));B={},v.forEach(se=>{const ue=ce(se);B[ue]=Math.max(1,Math.min(Z,1))})}let w=null,F=null,$=null;if(d.id==="temporal"){const Z=await Vt(),se=new Set(v.map(Te=>ce(Te))),ue=Z.reduce((Te,Me)=>{const Oe=Dt(Me.itemType,Me.itemId,Me.checkType,Me.direction);return se.has(Oe)&&(Te[Oe]||(Te[Oe]=[]),Te[Oe].push(Me)),Te},{});w={},F=new Set,$={};const le=Date.now();v.forEach(Te=>{const Me=ce(Te),Oe=ue[Me]??[];if(Oe.length===0){w[Me]=0,F.add(Me),$[Me]=[];return}const Qe=ys(Oe);$[Me]=Qe;const ut=Oa(Qe,le);w[Me]=ut.knowness})}const z=d.id==="levels"?vs(v,je,X,B):d.id==="temporal"?xs(v,je,X,w??{},F??new Set,$??{}):d.prepare(v,je,X);ie(z.queue),ct(z.meta),J(0),E("ready"),k(Z=>({current:Math.min(Z.current,Z.total),total:Z.total}))}catch{I&&E("error")}})(),()=>{I=!1}},[c,ht,je,d,X,h]),a.useEffect(()=>{fa(g)},[g,ot,lt,Et,x==null?void 0:x.collectionId]),a.useEffect(()=>{if(!oe||!lt){xt(!1);return}if(oe.cardType!=="info"||ft.has(ce(oe))){xt(!1);return}const I=Ha(M+1);if(I>=0){xt(!1),J(I);return}if(d.id==="temporal"||d.id==="levels"){const O=g.slice(0,M+1),r=g.slice(M+1).filter(ra),u=O.concat(r),T=new Set(u.map(ce)),v=Qa(T);if(v){const w=ce(v);T.has(w)||(u.push(v),T.add(w),ct(F=>{const $=F,z=new Set($.queued??[]);return z.add(w),{...$,queued:z}}))}const B=u.findIndex((w,F)=>F!==M&&ra(w));if(B>=0){ie(u),J(B),xt(!1);return}}xt(!0)},[oe,ft,lt,M,g,Ze,d.id]),a.useEffect(()=>{if(te(""),ge(null),we(null),qe(0),fe([]),ve({}),Se({}),Ke(null),He(null),et(null),R(!1),Je(!1),de(null),H(null),Ce({}),!oe){pe(null),_(null);return}oe.cardType==="info"&&oe.infoType==="computed"&&pe(t.cogita.library.revision.loadingComputed);let I=!0;return Rt(oe,M).then(O=>{!I||!O||(pe(O.prompt),_(O.expectedAnswer),fe(O.computedExpected),ve(O.computedAnswers),Ke(O.answerTemplate),He(O.outputVariables),et(O.variableValues))}),()=>{I=!1}},[oe,c,t]),a.useEffect(()=>{if(!oe||oe.cardType!=="info"||oe.infoType!=="citation"){dt.current=null,It.current=new Set,W(null);return}const I=oe.description??"",O=(oe.label??"").trim(),r=O.replace(/\s+/g," ").trim(),u=I.replace(/\s+/g," ").trim(),T=r&&r!==u?O:t.cogita.library.infoTypes.citation;if(!I){W(null),_(null);return}const v=ma(I);dt.current=v,pe(T);let B=!0;return Vt().then(w=>{if(!B)return;const F=getQuoteMode(oe.direction),$=new Map;w.forEach(le=>{if(le.itemType!=="info"||le.checkType!=="quote-fragment"||!le.direction)return;const Te=Mt(le.direction);if(!Te||Te.mode!==F)return;const Me=`${le.itemId}:${Te.fragmentId}`;$.has(Me)||$.set(Me,[]),$.get(Me).push(le)});const z={},Z=new Set;$.forEach((le,Te)=>{const[Me,Oe]=Te.split(":",2);if(Me!==oe.cardId)return;const Qe=_t(le).score;z[Oe]=Qe,Qe>=Et&&Z.add(Oe)}),It.current=Z,nt.current=z;const se=Mt(oe.direction);if(se!=null&&se.fragmentId&&v.nodes[se.fragmentId]){Zt(v,se.fragmentId,T);return}const ue=ha(v,Z,z,Et,lt,oe.direction);Zt(v,(ue==null?void 0:ue.id)??null,T)}).catch(()=>{It.current=new Set,nt.current={};const w=Mt(oe.direction);if(w!=null&&w.fragmentId&&v.nodes[w.fragmentId]){Zt(v,w.fragmentId,T);return}const F=ha(v,It.current,{},Et,lt,oe.direction);Zt(v,(F==null?void 0:F.id)??null,T)}),()=>{B=!1}},[oe,t,lt,Et]),a.useEffect(()=>{if(!oe||oe.cardType!=="vocab"||oe.checkType!=="translation-match"){H(null),Ce({});return}const r=(Ze.pool??Ze.active??g).filter(w=>w.cardType==="vocab"&&w.checkType==="translation-match").filter((w,F,$)=>$.findIndex(z=>z.cardId===w.cardId)===F);r.some(w=>w.cardId===oe.cardId)||r.unshift(oe);const T=Gt(r).slice(0,6).map(w=>{const F=w.label.split("↔").map(Z=>Z.trim()).filter(Boolean);if(F.length<2)return null;const $=`${w.cardId}:L`,z=`${w.cardId}:R`;return{cardId:w.cardId,leftId:$,rightId:z,leftLabel:F[0],rightLabel:F[1]}}).filter(Boolean),v=T.map(w=>w.leftId),B=Gt(T.map(w=>w.rightId));H({pairs:T,leftOrder:v,rightOrder:B,selection:{},activeLeft:null,activeRight:null,locked:{}})},[oe,g,Ze]),a.useEffect(()=>()=>{Be.current&&window.clearTimeout(Be.current),De.current&&window.clearTimeout(De.current)},[]);const la=a.useRef(null);a.useEffect(()=>{if(!oe)return;const I=ce(oe),O=typeof document<"u"?document.activeElement:null;if(la.current===I&&O&&(O.tagName==="INPUT"||O.tagName==="TEXTAREA"))return;let r=0;const u=()=>{if(oe){if(oe.cardType==="info"&&oe.infoType==="computed"){if(K.length>0){const v=Da(Ue,K,Ne),B=v?rt.current[v]:null;if(B&&(B.focus(),document.activeElement===B)){la.current=I;return}}if(Xe.current&&(Xe.current.focus(),document.activeElement===Xe.current)){la.current=I;return}}else if(oe.cardType==="vocab"&&Xe.current&&(Xe.current.focus(),document.activeElement===Xe.current)){la.current=I;return}r<6&&(r+=1,window.setTimeout(u,40))}},T=window.setTimeout(u,40);return()=>window.clearTimeout(T)},[oe,K,Ue,Ne]),a.useEffect(()=>{if(!yt)return;const I=O=>{O.key==="Enter"&&(O.preventDefault(),ca())};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[yt]);const kt=I=>{be(I),me(_t(I))};a.useEffect(()=>{if(!oe){me(null),be([]);return}const I=oe.cardType==="info"?"info":"connection";if(oe.cardType==="info"&&oe.infoType==="citation"){Vt().then(O=>{const r=O.filter(u=>u.itemType==="info"&&u.itemId===oe.cardId&&u.checkType==="quote-fragment"&&za(u.direction,oe.direction));kt(r)}).catch(()=>{me(null),be([])});return}Fa(I,oe.cardId,oe.checkType,oe.direction).then(O=>kt(O)).catch(()=>{me(null),be([])})},[oe]);const Xt=(I,O,r,u)=>{if(I==="info"&&r==="quote-fragment"){Vt().then(T=>{const v=T.filter(B=>B.itemType==="info"&&B.itemId===O&&B.checkType==="quote-fragment"&&za(B.direction,u));kt(v)}).catch(()=>{me(null),be([])});return}Fa(I,O,r,u).then(T=>kt(T)).catch(()=>{me(null),be([])})},Jt=(I,O,r)=>{var B;const u=((B=r.pairs.find(w=>w.leftId===I))==null?void 0:B.rightId)??null;if(!u)return r;const T=u===O;Ce(w=>({...w,[I]:T?"correct":"incorrect"})),Be.current&&window.clearTimeout(Be.current),De.current&&window.clearTimeout(De.current),re.current+=1;const v={kind:T?"correct":"incorrect",tick:re.current};if(ze(null),Be.current=window.setTimeout(()=>ze(v),0),De.current=window.setTimeout(()=>ze(null),420),T){const w={...r.locked,[I]:!0};return Object.keys(w).length>=r.pairs.length?(ge("correct"),Je(!0)):ge("correct"),{...r,selection:{...r.selection,[I]:O},activeLeft:null,activeRight:null,locked:w}}return ge("incorrect"),{...r,activeLeft:null,activeRight:null}},Ta=I=>{H(O=>!O||O.locked[I]?O:O.activeRight?Jt(I,O.activeRight,O):{...O,activeLeft:O.activeLeft===I?null:I})},Sa=I=>{H(O=>O&&(O.activeLeft?Jt(O.activeLeft,I,O):{...O,activeRight:O.activeRight===I?null:I}))},ca=()=>{var I;if(oe&&oe.cardType==="info"&&oe.infoType==="citation"&&dt.current&&he&&!((I=Mt(oe.direction))!=null&&I.fragmentId)){const O=ha(dt.current,It.current,nt.current,Et,lt,oe.direction,he.fragmentId);if(O){ge(null),te(""),R(!1),Se({}),Je(!1),we(null),qe(0),Zt(dt.current,O.id,he.title);return}}ge(null),te(""),R(!1),Se({}),Je(!1),we(null),qe(0),J(O=>Math.min(O+1,g.length))},Kt=I=>{if(!oe)return;const O=I.expected??null,r=I.answer??"";let u=O??"",T=r;if(!O&&I.expectedMap&&I.answerMap){const Z=Object.keys(I.expectedMap).sort((se,ue)=>se.localeCompare(ue));u=Z.map(se=>{var ue;return((ue=I.expectedMap)==null?void 0:ue[se])??""}).join("|"),T=Z.map(se=>{var ue;return((ue=I.answerMap)==null?void 0:ue[se])??""}).join("|")}const v=u?ga(u,T,Wt):new Uint8Array,B={revisionType:d.id,evalType:I.evalType,direction:I.direction,prompt:L??"",expected:O,answer:r,expectedAnswers:I.expectedMap??null,answers:I.answerMap??null,correct:I.correct,maskBase64:v.length?Qt(v):null,checkMode:m,compareMode:Wt,minCorrectness:pt},w=new TextEncoder().encode(JSON.stringify(B)),F=oe.cardType==="info"?"info":"connection",$=I.overrideCheckType??oe.checkType??null,z=I.overrideDirection??oe.direction??null;Pa({itemType:F,itemId:oe.cardId,checkType:$,direction:z,revisionType:d.id,evalType:I.evalType,correct:I.correct,maskBase64:v.length?Qt(v):null,payloadBase64:Qt(w)}).then(()=>{Xt(F,oe.cardId,$,z),fa(g)}).catch(()=>{})},da=(I,O)=>{const r=At.current.get(O);if(r)return Promise.resolve(r);const u=qt.current.get(O);if(u)return u;const T=Qn({shareCode:c,infoId:I,key:ht}).then(v=>{var Z,se;const B=v.payload,w=((Z=B.definition)==null?void 0:Z.graph)??null,F="",$=((se=B.definition)==null?void 0:se.answerTemplate)??"",z=sn(w,F,$);if(z){const le={sample:nn(z),answerTemplate:$||null};return At.current.set(O,le),le}return Ts({shareId:c,infoId:I,key:ht}).then(ue=>{const le={sample:ue,answerTemplate:null};return At.current.set(O,le),le})}).catch(()=>Ts({shareId:c,infoId:I,key:ht}).then(v=>{const B={sample:v,answerTemplate:null};return At.current.set(O,B),B}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{qt.current.delete(O)});return qt.current.set(O,T),T},Rt=(I,O)=>{var w;const r=`${ce(I)}:${O}`,u=zt.current.get(r);if(u)return Promise.resolve(u);const T=Pt.current.get(r);if(T)return T;const v=F=>(zt.current.set(r,F),F);let B;if(I.cardType==="vocab"){if(I.checkType==="translation-match")return B=Promise.resolve(v({prompt:I.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),B;const F=I.label.split("↔").map($=>$.trim()).filter(Boolean);if(F.length>=2){const z=(I.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",Z=z?F[0]:F[1],se=z?F[1]:F[0];B=Promise.resolve(v({prompt:Z,expectedAnswer:se,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else B=Promise.resolve(v({prompt:I.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(I.cardType==="info"&&I.infoType==="word"){const F=(w=I.description)!=null&&w.startsWith("Language: ")?I.description.replace("Language: ",""):null;B=Promise.resolve(v({prompt:I.label,expectedAnswer:F,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else I.cardType==="info"&&I.infoType==="computed"?B=da(I.cardId,r).then(F=>{var ue,le;if(!F.sample)return v({prompt:I.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const $=F.sample,z=$.expectedAnswers?Object.entries($.expectedAnswers).map(([Te,Me])=>({key:Te,expected:Me})):[],Z=z.reduce((Te,Me)=>(Te[Me.key]="",Te),{}),se=$.expectedAnswerIsSentence&&((ue=$.expectedAnswer)==null?void 0:ue.trim())||null;return v({prompt:$.prompt,expectedAnswer:z.length>0?se:((le=$.expectedAnswer)==null?void 0:le.trim())||null,computedExpected:z,computedAnswers:Z,answerTemplate:F.answerTemplate,outputVariables:$.outputVariables??null,variableValues:$.variableValues??null})}).catch(()=>v({prompt:I.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Pt.current.delete(r)}):B=Promise.resolve(v({prompt:I.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return Pt.current.set(r,B),B},Zt=(I,O,r)=>{const u=Object.keys(I.nodes).length,T=It.current.size;if(!O){W({title:r,before:I.text,after:"",fragmentId:null,total:u,completed:T}),_(null),Je(!0);return}const v=I.nodes[O];if(!v)return;const B=Zs(I.text,v);W({title:r,before:B.before,after:B.after,fragmentId:v.id,total:u,completed:T}),_(B.fragment),Je(!1)},ba=()=>{const I=dt.current;I&&W(O=>O&&{...O,total:Object.keys(I.nodes).length,completed:It.current.size})},Bt=()=>{const I=g[M+1];I&&Rt(I,M+1)},Ca=()=>{if(Bt(),oe&&oe.cardType==="vocab"&&oe.checkType==="translation-match"&&D){if(D.pairs.length===0){ge("incorrect"),Je(!0);return}const v=D.pairs.reduce((se,ue)=>(se[ue.rightId]=ue.rightLabel,se),{});let B=0;const w={};D.pairs.forEach(se=>{const le=D.selection[se.leftId]===se.rightId;w[se.leftId]=le?"correct":"incorrect",le&&(B+=1)});const F=D.pairs.length||1,$=B/F,z=B===D.pairs.length;Ce(se=>({...se,...w})),z?(ge("correct"),Je(!0),qe(0)):(ge("incorrect"),Je(!1),qe(se=>{const ue=se+1;return ue>=Ct&&(R(!0),Je(!0),H(le=>{if(!le)return le;const Te=le.pairs.reduce((Me,Oe)=>(Me[Oe.leftId]=Oe.rightId,Me),{});return{...le,selection:Te}})),ue})),jt(z,$);const Z="connection";Promise.all(D.pairs.map(se=>{const ue=D.selection[se.leftId]??null,le=ue?v[ue]:"",Te={left:se.leftLabel,expected:se.rightLabel,answer:le,checkType:"translation-match"},Me=new TextEncoder().encode(JSON.stringify(Te));return Pa({itemType:Z,itemId:se.cardId,checkType:"translation-match",direction:null,revisionType:d.id,evalType:"translation-match",correct:ue===se.rightId,maskBase64:null,payloadBase64:Qt(Me)})})).then(()=>{Xt(Z,oe.cardId,oe.checkType,oe.direction),fa(g)}).catch(()=>{});return}if(K.length>0){const v=K.reduce((w,F)=>{const $=xe[F.key]??"";return w[F.key]=Nt($)===Nt(F.expected)?"correct":"incorrect",w},{});K.every(({key:w,expected:F})=>{const $=xe[w]??"";return m==="exact"&&Nt($)===Nt(F)})?(ge("correct"),Se(v),Je(!0),qe(0),jt(!0,1),Kt({correct:!0,direction:L?`${L} -> computed`:"computed",expectedMap:K.reduce((w,F)=>(w[F.key]=F.expected,w),{}),answerMap:xe,evalType:"computed"})):(ge("incorrect"),Se(v),Je(!1),qe(w=>{const F=w+1;return F>=Ct&&ea&&(R(!0),Je(!0)),F}),jt(!1,0),window.setTimeout(()=>{var F;const w=Da(Ue,K,Ne);w&&rt.current[w]&&((F=rt.current[w])==null||F.focus())},40),Kt({correct:!1,direction:L?`${L} -> computed`:"computed",expectedMap:K.reduce((w,F)=>(w[F.key]=F.expected,w),{}),answerMap:xe,evalType:"computed"}));return}if(oe&&oe.cardType==="info"&&oe.infoType==="citation"&&(he!=null&&he.fragmentId)){if(!j)return;const v=Mt(oe.direction),B=(v==null?void 0:v.mode)??getQuoteMode(oe.direction),w=v!=null&&v.fragmentId&&oe.direction?oe.direction:ka(B,he.fragmentId),F=dn(j,ae,Wt),$=m==="exact"&&pa(ae)===pa(j),z=ia(F),Z=$||z,se=Ht(F);Z?(nt.current[he.fragmentId]=Math.max(nt.current[he.fragmentId]??0,se),(nt.current[he.fragmentId]??0)>=Et&&It.current.add(he.fragmentId),ba(),ge("correct"),Se({}),Je(!0),we(F),qe(0),se<100&&Ct<=1&&R(!0),jt(!0,se/100),Kt({correct:!0,direction:`quote:${he.fragmentId}`,expected:j,answer:ae,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:w})):(ge("incorrect"),Se({}),Je(!1),we(F),qe(ue=>{const le=ue+1;return le>=Ct&&ea&&(R(!0),Je(!0)),le}),jt(!1,se/100),window.setTimeout(()=>{var ue;return(ue=Xe.current)==null?void 0:ue.focus()},40),Kt({correct:!1,direction:`quote:${he.fragmentId}`,expected:j,answer:ae,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:w}));return}if(!j)return;const I=ga(j,ae,Wt),O=m==="exact"&&Nt(ae)===Nt(j),r=ia(I),u=O||r,T=Ht(I);u?(ge("correct"),Se({}),Je(!0),we(I),qe(0),T<100&&Ct<=1&&R(!0),jt(!0,T/100),Kt({correct:!0,direction:L?`${L} -> ${j}`:null,expected:j,answer:ae,evalType:"text"})):(ge("incorrect"),Se({}),Je(!1),we(I),qe(v=>{const B=v+1;return B>=Ct&&ea&&(R(!0),Je(!0)),B}),jt(!1,T/100),window.setTimeout(()=>{var v;return(v=Xe.current)==null?void 0:v.focus()},40),Kt({correct:!1,direction:L?`${L} -> ${j}`:null,expected:j,answer:ae,evalType:"text"}))},ua=I=>{if(Bt(),!j)return;const O=ga(j,I,Wt),r=Nt(I)===Nt(j),u=ia(O),T=r||u,v=Ht(O);T?(ge("correct"),Se({}),Je(!0),we(O),qe(0),v<100&&Ct<=1&&R(!0),jt(!0,v/100),Kt({correct:!0,direction:"word->language",expected:j,answer:I,evalType:"language-select"})):(ge("incorrect"),Se({}),Je(!1),we(O),qe(B=>{const w=B+1;return w>=Ct&&ea&&(R(!0),Je(!0)),w}),jt(!1,v/100),Kt({correct:!1,direction:"word->language",expected:j,answer:I,evalType:"language-select"}))},Ma=I=>{var r;if(I.key!=="Enter")return;if(I.preventDefault(),I.stopPropagation(),yt){ca();return}const O=K.find(u=>!(xe[u.key]??"").trim());if(O){(r=rt.current[O.key])==null||r.focus();return}Ca()},Ya=()=>{Bt(),ge("correct"),Je(!0),qe(0),jt(!0,1),j&&Kt({correct:!0,direction:"manual",expected:j,answer:ae,evalType:"manual"})},Ga=()=>{if(jt(!1,0),oe&&oe.cardType==="info"&&oe.infoType==="citation"){ge(null),te(""),R(!1),Se({}),Je(!1),we(null),qe(0),J(I=>Math.min(I+1,g.length));return}ca()};a.useEffect(()=>{Bt()},[M,g]);const Xa=t.cogita.library.revision.revealModeAfterIncorrect,ea=K.length>0||!!j;return e.jsxs(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:i,onToggleSecureMode:o,onLogout:p,secureMode:f,onNavigate:y,language:A,onLanguageChange:C,children:[(h==="loading"||q==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:h==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${G.total?Math.min(100,Math.max(0,G.current/G.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:G.total?`${Math.min(G.current,G.total)} / ${G.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:ne}),e.jsx("p",{className:"cogita-library-subtitle",children:U}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",ye).replace("{check}",_e)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:V?`${V.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[$t?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",$t.currentLevel??"-"," / ",$t.levelsCount]}):null,V?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(V.correct)).replace("{total}",String(V.total))}),V.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(V.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(on,{outcomes:ke})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Le?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Le})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Re?`${Re.kind}-${Re.tick}`:vt?"idle":Fe??"idle",children:h!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:h==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}):oe?e.jsx(e.Fragment,{children:it?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(rn,{copy:t,currentCard:oe,currentTypeLabel:na,prompt:L,languages:P,answer:ae,onAnswerChange:I=>te(O=>Ba(O,I,Q)),computedExpected:K,computedAnswers:xe,onComputedAnswerChange:(I,O)=>ve(r=>({...r,[I]:Ba(r[I]??"",O,Q)})),answerTemplate:Ue,outputVariables:Ne,variableValues:at,computedFieldFeedback:Ae,feedback:Fe,canAdvance:yt,quoteContext:he,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ca,onSkip:Ga,onLanguageSelect:ua,onMarkReviewed:Ya,onAdvance:ca,showCorrectAnswer:$e,setShowCorrectAnswer:R,onRevealCorrect:()=>Je(!0),answerMask:Ee,expectedAnswer:j,hasExpectedAnswer:ea,handleComputedKeyDown:Ma,answerInputRef:Xe,computedInputRefs:rt,scriptMode:Q,setScriptMode:de,matchPairs:D==null?void 0:D.pairs,matchLeftOrder:D==null?void 0:D.leftOrder,matchRightOrder:D==null?void 0:D.rightOrder,matchSelection:D==null?void 0:D.selection,matchActiveLeft:D==null?void 0:D.activeLeft,matchActiveRight:D==null?void 0:D.activeRight,matchFeedback:We,onMatchLeftSelect:Ta,onMatchRightSelect:Sa})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:mt?`${wt} / ${mt}`:t.cogita.library.revision.progressUnlimited}),h==="error"&&e.jsx("p",{children:t.cogita.library.revision.shareInvalid}),h==="loading"&&e.jsx("p",{children:t.cogita.library.revision.shareLoading}),h==="ready"&&q==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),h==="ready"&&q==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),h==="ready"&&q==="ready"&&g.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Xa}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",Ct]})]})]}),$t?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",$t.activeCount," / ",$t.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:$t.counts.map((I,O)=>{const r=O+1,u=$t.currentLevel===r,T=$t.percentages[O]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":u,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:r}),e.jsx("strong",{children:I})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,T))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[T.toFixed(1),"%"]})]},`level-${r}`)})})]}):null,oa?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:oa.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:oa.dots.map(I=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-I.value))}, ${Math.round(200*I.value)}, 80, 0.9)`}},I.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:oa.knownCount})]})]}):null,lt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Ft})]})}):null]})]})]})})})]})]})}const lr=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:ar},Symbol.toStringTag,{value:"Module"}));export{rr as C,or as a,lr as b};
