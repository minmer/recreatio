import{r as i,j as e,R as fr,B as xr,C as yr,H as Lr,P as Cr,a as Rt,b as ui,c as gi,u as Or,d as Vr,e as vr,f as hi}from"./vendor-DrCXrCXJ.js";import{L as qr,A as _r,g as Ur,a as bi,b as jt,c as Wr,s as $t,d as zr,e as Hr,f as Wa,h as hr,i as Et,j as br,k as mi,l as tr,m as et,u as pi,n as da,o as fi,p as xi,q as yi,r as Jr,t as Yr,v as vi,w as ji,x as wi,y as Wt,z as At,B as ki,C as Ti,D as Ni,E as Li,F as Ci,G as Mi,H as za,I as Si,J as Ii,K as Pi,M as Ri,N as $i,O as Ei,P as Ai,Q as Fi,R as Bi,S as Di,T as Ki,U as Oi,V as Vi,W as qi,X as _i,Y as Ui,Z as Mr}from"./recreatio-core-Bh2y2_Tf.js";import"./vendor-cogita-ui-DLgJCpO3.js";const vt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},yt={moveMs:900,pauseMs:220,errorMs:900},Wi=(a=11)=>{let n=a;const o=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:u,height:g,paddingX:w,paddingY:p,levels:I}=vt,M=(g-p*2)/(I.length-1),E=[],l=[],C=[];I.forEach((b,f)=>{const Q=g-p-f*M,A=u-w*2,v=[];for(let G=0;G<b;G+=1){const P=w+(G+1)*A/(b+1),ne=(o()-.5)*18,D=Math.max(w,Math.min(u-w,P+ne)),O=f===0?3:f<2?2.1:1.4,ge=f===0?"root":`l${f}-${G}`;v.push({id:ge,x:f===0?u/2:D,y:Q,r:O,level:f,role:f===0?"root":void 0})}C.push(v),E.push(...v)});const m=C[C.length-1];if(m!=null&&m.length){const b=m[Math.floor(m.length/2)];b.role="goal",b.r=2}for(let b=1;b<C.length;b+=1){const f=C[b-1];C[b].forEach(A=>{const v=[...f].sort((D,O)=>Math.abs(D.x-A.x)-Math.abs(O.x-A.x)),G=v[0],P=v[1]&&o()<.45?v[1]:null;(P?[G,P]:[G]).forEach(D=>{l.push({from:D.id,to:A.id,key:`${D.id}-${A.id}`})}),o()<.2&&v[2]&&l.push({from:v[2].id,to:A.id,key:`${v[2].id}-${A.id}`})})}const x=new Map;l.forEach(b=>{const f=x.get(b.to)??[];f.push(b.from),x.set(b.to,f)});const q=new Map,J=new Map,_=new Map;l.forEach(b=>{const f=q.get(b.from)??[];f.push(b.key),q.set(b.from,f);const Q=J.get(b.from)??[];Q.push(b.to),J.set(b.from,Q);const A=_.get(b.from)??[];A.push(b.to),_.set(b.from,A);const v=_.get(b.to)??[];v.push(b.from),_.set(b.to,v)});const s=new Map;return E.forEach(b=>{s.set(b.id,b)}),{nodes:E,links:l,parentsById:x,linksByFrom:q,childrenByFrom:J,neighborsById:_,nodesById:s}};function zi({slides:a,activeIndex:n,introOpen:o,prefersReducedMotion:u,onNext:g,onPrev:w,onSelect:p,onExit:I,onOpen:M,onRegister:E}){const l=n===a.length-1,C=o&&n===0?"entry":"docked",m=a[a.length-1],[x,q]=i.useState(!1),J=i.useMemo(()=>Array.from({length:20},(j,k)=>({src:`/cogita/logo/Cogita${String(k).padStart(2,"0")}.png`,kind:k<=11?"bubble":k<=17?"text":"recreatio"})),[]),_=o&&n===0;i.useEffect(()=>{if(!o){q(!1);return}n>0&&!x&&q(!0)},[n,o,x]);const s=i.useRef(0),b=i.useRef(null),f=i.useMemo(()=>{const j={x:40,y:160},k={x:260,y:48},Y=6,t=k.x-j.x,r=j.y-k.y,h=t/Y,T=[.3,.45,.6,.65,1.4,2.2],K=T.reduce((oe,ye)=>oe+ye,0),X=T.map(oe=>r*oe/K),te=[j];let ee=j.x,ue=j.y;for(let oe=1;oe<=Y;oe+=1){const ye=(Math.random()-.5)*14,ra=(Math.random()-.5)*28;ee=Math.max(j.x+oe*14,Math.min(k.x-(Y-oe)*14,ee+h+ye));const Xe=X[oe-1]??X[X.length-1];ue=ue-Xe+ra;const aa=Math.max(k.y,Math.min(j.y-4,ue));te.push({x:Math.round(ee),y:Math.round(aa)})}return te[te.length-1]=k,te},[]),Q=i.useMemo(()=>{const r=(K,X,te)=>Math.min(te,Math.max(X,K)),h=f.map(K=>{const X=10+Math.random()*36;return{x:r(K.x,40,260),y:r(K.y-X,40,140)}}),T=f.map((K,X)=>{var ue;const te=12+Math.random()*40,ee=((ue=h[X])==null?void 0:ue.y)??K.y;return{x:r(K.x,40,260),y:r(Math.max(ee+10,K.y+te),60,170)}});return{upper:h,lower:T}},[f]),A=i.useMemo(()=>{var k;const j=((k=f[4])==null?void 0:k.x)??260;return Math.max(0,Math.min(240,j-40))},[f]),v=i.useMemo(()=>{var X,te;const j=(ee,ue,oe)=>Math.min(oe,Math.max(ue,ee)),k=(ee,ue,oe)=>f.map((ye,ra)=>{var $a,na;const Xe=(($a=Q.upper[ra])==null?void 0:$a.y)??ye.y,aa=((na=Q.lower[ra])==null?void 0:na.y)??ye.y,Be=(Math.random()-.5)*70,We=ye.y+ee+Be,Oe=j(ye.y+ue,Xe+6,aa-6),ea=j(ye.y+oe,Xe+6,aa-6);return{x:ye.x,y:j(We,Math.min(Oe,ea),Math.max(Oe,ea))}}),Y=-14+Math.random()*28,t=14+Math.random()*28,r=k(Y,-80,12),h=k(t,-12,80);for(let ee=4;ee<f.length;ee+=1){const ue=f[ee],oe=((X=Q.upper[ee])==null?void 0:X.y)??ue.y,ye=((te=Q.lower[ee])==null?void 0:te.y)??ue.y;r[ee]={x:ue.x,y:j(ue.y-12,oe+6,ye-6)},h[ee]={x:ue.x,y:j(ue.y+12,oe+6,ye-6)}}const T=Q.upper.length?Q.upper[Q.upper.length-1].y:40,K=Q.lower.length?Q.lower[Q.lower.length-1].y:170;return r[r.length-1]={x:f[f.length-1].x,y:j(f[f.length-1].y-14,T,K)},h[h.length-1]={x:f[f.length-1].x,y:j(f[f.length-1].y+12,T,K)},{higher:r,lower:h}},[f,Q]),G=1e4,P=i.useMemo(()=>{let j=17;const k=()=>(j=(j*1664525+1013904223)%4294967296,j/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const h=(k()-.5)*240,T=(k()-.5)*180,K=(k()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${h.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${K.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),ne=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[D,O]=i.useState([]),ge=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),me=i.useMemo(()=>{const k=[],t=(h,T)=>h+Math.random()*(T-h);for(let h=0;h<6;h+=1){let T=!1;for(let K=0;K<80;K+=1){const X=t(14,86),te=t(10,34);if(k.every(ue=>{const oe=ue.x-X,ye=ue.y-te;return Math.hypot(oe,ye)>=12})){k.push({x:X,y:te}),T=!0;break}}T||k.push({x:t(16,84),y:t(12,32)})}return k.map((h,T)=>({id:`p${T+1}`,x:`${h.x.toFixed(1)}%`,y:`${h.y.toFixed(1)}%`,xNum:h.x,yNum:h.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ve,F]=i.useState(0),[ce,c]=i.useState(0),[ie,re]=i.useState([]),B=1e4,Ce=i.useMemo(()=>{if(me.length<2)return[];const j=T=>{let K=T+1831565813;return K=Math.imul(K^K>>>15,K|1),K^=K+Math.imul(K^K>>>7,K|61),((K^K>>>14)>>>0)/4294967296},k=(T,K)=>Math.floor(j(T)*K),Y=new Set,t=[],r=Math.min(3,me.length);let h=0;for(;t.length<r&&h<30;){h+=1;const T=k(ve*13+h*5,me.length),K=k(ve*29+h*7,me.length);if(T===K)continue;const X=T<K?`${T}-${K}`:`${K}-${T}`;Y.has(X)||(Y.add(X),t.push({id:`link-${X}`,from:me[T],to:me[K],delay:`${(h*.35).toFixed(2)}s`}))}return t},[ve,me]);i.useEffect(()=>{if(!o||n!==2)return;const j=()=>{const Y=P.map(t=>t.id);for(let t=Y.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[Y[t],Y[r]]=[Y[r],Y[t]]}return Y.slice(0,4)};O(j());const k=window.setInterval(()=>{O(j())},G);return()=>window.clearInterval(k)},[n,o,P,G]),i.useEffect(()=>{if(!o||n!==3)return;const j=()=>{c(Math.floor(Math.random()*ge.length)),re(me.map(()=>Math.random()<.6?"good":"bad")),F(Y=>Y+1)};j();const k=window.setInterval(j,B);return()=>window.clearInterval(k)},[n,o,ge.length,me,B]);const se=i.useMemo(()=>Wi(11),[]),[le,ke]=i.useState(new Set(["root"])),[Te,Ne]=i.useState(new Set),[Fe,Me]=i.useState(new Set),[Qe,_e]=i.useState({fromId:"root",toId:"root",key:0}),Ee=i.useRef(le),He=i.useRef("root"),la=i.useRef(0),Pe=i.useRef(null),W=i.useRef(null),ae=i.useRef([]);i.useEffect(()=>{Ee.current=le},[le]);const Ve=i.useMemo(()=>{const j=new Set;return le.forEach(k=>{const Y=se.linksByFrom.get(k);Y&&Y.forEach(t=>j.add(t))}),j},[le,se]),Le=se.nodesById.get(Qe.toId)??se.nodesById.get("root"),pe=Le?`${Le.x/vt.width*100}%`:"50%",Re=Le?`${Le.y/vt.height*100}%`:"90%";i.useEffect(()=>{if(!o||n!==1||u)return;(()=>{ke(new Set(["root"])),Ne(new Set),Me(new Set),_e({fromId:"root",toId:"root",key:0}),W.current=null,la.current=0,He.current="root",ae.current=[]})();const k=()=>{const t=He.current,r=Ee.current,T=(se.childrenByFrom.get(t)??[]).filter(ye=>!r.has(ye));if(T.length)return T[Math.floor(Math.random()*T.length)];if(r.size>=se.nodes.length){const ye=se.neighborsById.get(t)??[];return ye.length?ye[Math.floor(Math.random()*ye.length)]:null}const K=ye=>(se.childrenByFrom.get(ye)??[]).some(Xe=>!r.has(Xe)),X=[t],te=new Set([t]),ee=new Map;let ue=null;for(;X.length;){const ye=X.shift();if(!ye)break;if(ye!==t&&K(ye)){ue=ye;break}(se.neighborsById.get(ye)??[]).forEach(Xe=>{te.has(Xe)||(te.add(Xe),ee.set(Xe,ye),X.push(Xe))})}if(!ue)return null;let oe=ue;for(;ee.get(oe)&&ee.get(oe)!==t;)oe=ee.get(oe)??oe;return oe},Y=(t,r)=>{if(t===r){const h=k();h&&Y(t,h);return}la.current+=1,_e({fromId:t,toId:r,key:la.current}),He.current=r,Pe.current=window.setTimeout(()=>{const h=se.parentsById.get(r)??[],T=Ee.current,K=h.filter(ue=>!T.has(ue));if(!K.length){const ue=new Set(T);ue.add(r),ke(ue),Pe.current=window.setTimeout(()=>{for(;ae.current.length;){const ye=ae.current[ae.current.length-1];if(!ue.has(ye)){if(ye!==r){Y(r,ye);return}break}ae.current.pop()}const oe=k();oe&&Y(r,oe)},yt.pauseMs);return}const X=new Set([r,...K]),te=new Set(K.map(ue=>`${ue}-${r}`));Ne(X),Me(te),ae.current.includes(r)||ae.current.push(r);const ee=K[Math.floor(Math.random()*K.length)];W.current={fromId:r,toId:ee},Pe.current=window.setTimeout(()=>{Ne(new Set),Me(new Set);const ue=W.current;ue&&Y(ue.fromId,ue.toId)},yt.errorMs)},yt.moveMs)};return Pe.current=window.setTimeout(()=>{const t=k();t&&Y(He.current,t)},yt.pauseMs),()=>{Pe.current&&window.clearTimeout(Pe.current)}},[n,o,se,u]);const Ue=j=>{if(!o)return;const k=Date.now();k-s.current<520||Math.abs(j.deltaY)<10||(s.current=k,j.deltaY>0?g():w(),j.preventDefault())},Ae=j=>{if(!o)return;const k=j.touches[0];k&&(b.current={x:k.clientX,y:k.clientY})},qe=j=>{if(!o)return;const k=b.current;if(b.current=null,!k)return;const Y=j.changedTouches[0];if(!Y)return;const t=Y.clientX-k.x,r=Y.clientY-k.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?g():w())};return e.jsxs("div",{className:`cogita-intro ${o?"is-open":"is-closed"} ${u?"is-reduced":""} ${l?"is-final":""}`,"data-slide":n+1,onWheel:Ue,onTouchStart:Ae,onTouchEnd:qe,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":C,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${_&&!x?"is-entry":""}`,children:J.map((j,k)=>e.jsx("img",{src:j.src,alt:"",className:`cogita-logo-layer ${k===0?"is-base":""} ${j.kind==="text"?"is-text":j.kind==="recreatio"?"is-recreatio":""} ${j.kind==="bubble"?"is-bubble":""}`},j.src))})}),o&&a.map((j,k)=>{const Y=k===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${k+1} ${Y?"is-active":""}`,"aria-hidden":!Y,children:[e.jsxs("div",{className:"cogita-intro-text",children:[j.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:j.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:j.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:j.title}),j.body&&e.jsx("p",{children:j.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),j.micro&&e.jsx("p",{className:"cogita-intro-micro",children:j.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:l?E:g,children:j.cta}),l&&j.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>p(0),children:j.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[k===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${vt.width} ${vt.height}`,preserveAspectRatio:"none",children:[se.links.map(t=>{const r=se.nodesById.get(t.from),h=se.nodesById.get(t.to);if(!r||!h)return null;const T=Ve.has(t.key),K=Fe.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${K?"is-error":""}`,x1:r.x,y1:r.y,x2:h.x,y2:h.y},t.key)}),se.nodes.map(t=>{const r=le.has(t.id),h=Te.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${h?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Le&&e.jsx("span",{className:"map-explorer-dot",style:{left:pe,top:Re,"--move":`${yt.moveMs}ms`}})]}),k===2&&e.jsx("div",{className:"cogita-index-cards",children:P.map(t=>{const r=D.indexOf(t.id),h=r>=0?ne[r]:null,T=(h==null?void 0:h.x)??"140px",K=(h==null?void 0:h.y)??"140px",X=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":K,"--stack-opacity":X,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),k===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ge.map((t,r)=>e.jsxs("div",{className:`round-card ${r===ce?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),ge[ce]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ge[ce].x,"--card-y":`calc(${ge[ce].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:me.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Ce.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:me.map((t,r)=>{const h=ie[r]??"good",T=ge[ce];if(!T)return null;const K=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":K,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${h}`,style:{"--from-x":T.x,"--from-y":K,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${h}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${ve}`)})})]},`round-${ve}`),k===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${f[0].x} ${f[0].y} L${f[1].x} ${f[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${f[1].x} ${f[1].y} L${f[2].x} ${f[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${f[2].x} ${f[2].y} L${f[3].x} ${f[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${f[3].x} ${f[3].y} L${f[4].x} ${f[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${f[4].x} ${f[4].y} L${f[5].x} ${f[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${f[5].x} ${f[5].y} L${f[6].x} ${f[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${A};${A};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${Q.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${Q.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${Q.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${Q.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[v.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${v.higher[r+1].x} ${v.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),v.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${v.lower[r+1].x} ${v.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${f[0].x/300*100}%`,"--p0y":`${f[0].y/200*100}%`,"--p1x":`${f[1].x/300*100}%`,"--p1y":`${f[1].y/200*100}%`,"--p2x":`${f[2].x/300*100}%`,"--p2y":`${f[2].y/200*100}%`,"--p3x":`${f[3].x/300*100}%`,"--p3y":`${f[3].y/200*100}%`,"--p4x":`${f[4].x/300*100}%`,"--p4y":`${f[4].y/200*100}%`,"--p5x":`${f[5].x/300*100}%`,"--p5y":`${f[5].y/200*100}%`,"--p6x":`${f[6].x/300*100}%`,"--p6y":`${f[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${v.higher[0].x/300*100}%`,"--q0y":`${v.higher[0].y/200*100}%`,"--q1x":`${v.higher[1].x/300*100}%`,"--q1y":`${v.higher[1].y/200*100}%`,"--q2x":`${v.higher[2].x/300*100}%`,"--q2y":`${v.higher[2].y/200*100}%`,"--q3x":`${v.higher[3].x/300*100}%`,"--q3y":`${v.higher[3].y/200*100}%`,"--q4x":`${v.higher[4].x/300*100}%`,"--q4y":`${v.higher[4].y/200*100}%`,"--q5x":`${v.higher[5].x/300*100}%`,"--q5y":`${v.higher[5].y/200*100}%`,"--q6x":`${v.higher[6].x/300*100}%`,"--q6y":`${v.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${v.lower[0].x/300*100}%`,"--q0y":`${v.lower[0].y/200*100}%`,"--q1x":`${v.lower[1].x/300*100}%`,"--q1y":`${v.lower[1].y/200*100}%`,"--q2x":`${v.lower[2].x/300*100}%`,"--q2y":`${v.lower[2].y/200*100}%`,"--q3x":`${v.lower[3].x/300*100}%`,"--q3y":`${v.lower[3].y/200*100}%`,"--q4x":`${v.lower[4].x/300*100}%`,"--q4y":`${v.lower[4].y/200*100}%`,"--q5x":`${v.lower[5].x/300*100}%`,"--q5y":`${v.lower[5].y/200*100}%`,"--q6x":`${v.lower[6].x/300*100}%`,"--q6y":`${v.lower[6].y/200*100}%`}})]})})}),k===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),k===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},j.id)}),!o&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:m.title}),m.body&&e.jsx("p",{children:m.body}),m.micro&&e.jsx("p",{className:"cogita-intro-micro",children:m.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:E,children:m.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:M,children:"Otwórz pokaz"})]})]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((j,k)=>e.jsx("button",{type:"button",className:`dot ${n===k?"active":""}`,"aria-label":j.title,onClick:()=>p(k)},j.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:I,children:"Pomiń"})]})]})}const Hi=6,Ji=4;function Yi({copy:a,onAuthAction:n,authLabel:o,showProfileMenu:u,onProfileNavigate:g,onToggleSecureMode:w,onLogout:p,secureMode:I,onNavigate:M,language:E,onLanguageChange:l}){const C=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}M("home")},m=i.useRef(null),x=i.useRef([]),q=i.useMemo(()=>{let re=Date.now()%2147483647;const B=()=>(re=re*48271%2147483647,re/2147483647);return Array.from({length:Hi},(Ce,se)=>{const le=6+B()*8,ke=7+B()*10,Te=6+B()*9,Ne=-B()*le,Fe=-B()*ke,Me=-B()*Te,Qe=.18+B()*.28,_e=12+B()*18,Ee=4+B()*8,He=(B()-.5)*3.2,la=(B()-.5)*3.8,Pe=B()>.5?"alternate":"alternate-reverse",W=B()>.5?"alternate":"alternate-reverse",ae=B()>.5?"alternate":"alternate-reverse",Ve=.18+B()*.42,Le=30+B()*60,pe=-45-B()*38,Re=188+B()*32,Ue=.1+B()*.2;return{id:`wave-${se+1}`,style:{"--wave-sway-duration":`${le}s`,"--wave-scale-duration":`${ke}s`,"--wave-drift-duration":`${Te}s`,"--wave-sway-delay":`${Ne}s`,"--wave-scale-delay":`${Fe}s`,"--wave-drift-delay":`${Me}s`,"--wave-sway-dir":Pe,"--wave-scale-dir":W,"--wave-drift-dir":ae,"--wave-scale":`${Qe}`,"--wave-shift":`${_e}%`,"--wave-xshift":`${Ee}%`,"--wave-x0":`${He}%`,"--wave-y0":`${la}%`,"--wave-opacity":`${Ve}`,"--wave-blur":`${Le}px`,"--wave-bottom":`${pe}%`,"--wave-hue":`${Re}`,"--wave-glow":`${Ue}`}}})},[]),J=i.useMemo(()=>{let re=Date.now()*3%2147483647;const B=()=>(re=re*48271%2147483647,re/2147483647);return Array.from({length:Ji},(Ce,se)=>{const le=180+B()*220,ke=220+B()*280,Te=-B()*le,Ne=-B()*ke,Fe=.12+B()*.22,Me=3+B()*7,Qe=1+B()*3,_e=(B()-.5)*2.8,Ee=(B()-.5)*2.2;return{id:`mesh-${se+1}`,seed:1e3+se*991+Math.floor(B()*999),style:{"--mesh-sway-duration":`${le}s`,"--mesh-drift-duration":`${ke}s`,"--mesh-sway-delay":`${Te}s`,"--mesh-drift-delay":`${Ne}s`,"--mesh-scale":`${Fe}`,"--mesh-shift":`${Me}%`,"--mesh-xshift":`${Qe}%`,"--mesh-x0":`${Ee}%`,"--mesh-y0":`${_e}%`}}})},[]),_=i.useMemo(()=>{const re=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],B=a.cogita.introSlides,Ce=new Map(B.map(se=>[se.id,se]));return re.map(se=>{var ke;const le=Ce.get(se.id);return{...se,...le,title:(le==null?void 0:le.title)??"Cogita",cta:(le==null?void 0:le.cta)??((ke=a.cogita.introSlides[0])==null?void 0:ke.cta)??a.cogita.loginCta,secondary:le==null?void 0:le.secondary}})},[a.cogita.introSlides]),[s,b]=i.useState(0),[f,Q]=i.useState(!0),[A,v]=i.useState(!1),G=_.length-1,P=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ne=i.useCallback(()=>{P(),n()},[P,n]),D=i.useCallback(()=>{Q(!0),b(0)},[]),O=i.useCallback(()=>{Q(!1),b(G)},[G]),ge=i.useCallback(re=>{b(Math.max(0,Math.min(G,re)))},[G]),me=i.useCallback(()=>{s>=G?ne():ge(s+1)},[s,ge,ne,G]),ve=i.useCallback(()=>{ge(s-1)},[s,ge]);i.useEffect(()=>{var Ce;const re=(Ce=window.matchMedia)==null?void 0:Ce.call(window,"(prefers-reduced-motion: reduce)");if(!re)return;const B=()=>v(re.matches);return B(),re.addEventListener?(re.addEventListener("change",B),()=>re.removeEventListener("change",B)):(re.addListener(B),()=>re.removeListener(B))},[]),i.useEffect(()=>{if(!f)return;const re=B=>{const Ce=B.target;if(!Ce)return;const se=Ce.tagName;if(!(Ce.isContentEditable||se==="INPUT"||se==="TEXTAREA"||se==="SELECT"||se==="BUTTON"||se==="A"||Ce.closest('button, a, [role="button"], [role="link"]'))){if(B.key==="Escape"){O();return}if(B.key==="ArrowLeft"||B.key==="ArrowUp"){ve();return}(B.key==="ArrowRight"||B.key==="ArrowDown"||B.code==="Space"||B.key===" ")&&(B.preventDefault(),me())}};return window.addEventListener("keydown",re),()=>window.removeEventListener("keydown",re)},[O,me,ve,f]),i.useEffect(()=>{f&&s===G&&P()},[s,f,G,P]),i.useEffect(()=>{const re=m.current;if(!re)return;const B=x.current.filter(pe=>!!pe);if(!B.length)return;const Ce=1,se=.6,le=.6,ke=Math.max(1,Math.min(Ce,window.devicePixelRatio||1));let Te=0,Ne=0,Fe=se,Me=0,Qe=0;const _e=pe=>{let Re=pe%2147483647;return Re<=0&&(Re+=2147483646),(Ue,Ae)=>{Re=Re*48271%2147483647;const qe=Re/2147483647;return Ue+qe*(Ae-Ue)}},Ee={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},He=pe=>{const Re=Math.sin(pe*12.9898)*43758.5453;return Re-Math.floor(Re)},la=pe=>{const Re=He(pe+.1)||1e-4,Ue=He(pe+.7)||1e-4;return Math.sqrt(-2*Math.log(Re))*Math.cos(2*Math.PI*Ue)},Pe=(pe,Re)=>{const Ue=Math.floor(pe),Ae=Ue+1,qe=pe-Ue,j=qe*qe*(3-2*qe),k=He(Ue*12.9898+Re*78.233),Y=He(Ae*12.9898+Re*78.233);return k+(Y-k)*j},W=pe=>{const Re=_e(pe),Ue=Math.min(4,Math.max(4,Math.floor(Te/1200*Ee.filamentCount)));return Array.from({length:Ue},(Ae,qe)=>{const j=Math.max(-1,Math.min(1,la(pe+qe*.37))),k=Math.min(1,Math.max(0,He(pe+qe*1.31))),Y=Math.min(Ee.depthLayers-1,Math.floor(k*Ee.depthLayers));return{seed:Re(0,Math.PI*2)+pe*.01,offset:j,freqA:Ee.freq1*(.75+Re(0,.5)),freqB:Ee.freq2*(.75+Re(0,.5)),ampA:Ee.amp1*(.6+Re(0,.7)),ampB:Ee.amp2*(.6+Re(0,.7)),width:2+qe%5*.32,depth:k,layer:Y}})},ae=(pe,Re,Ue)=>{const Ae=Math.max(30,Math.floor(Te*Ne/14e4));pe.save(),pe.globalAlpha=.6;for(let qe=0;qe<Ae;qe+=1){const j=He(qe*9.1+Te*.11)*Re+Ue,k=He(qe*3.7+Ne*.23)*Ne,Y=1.2+He(qe*5.9)*2.4,t=pe.createRadialGradient(j,k,0,j,k,Y*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),pe.fillStyle=t,pe.beginPath(),pe.arc(j,k,Y*2,0,Math.PI*2),pe.fill()}pe.restore()},Ve=(pe,Re)=>{pe.clearRect(0,0,Te,Ne);const Ue=Ne*Ee.waveCenter,Ae=Ee.waveBandPx,qe=Ee.segments,j=Ee.colors.filaments,k=Me||Te,Y=0;ae(pe,k,Y),pe.strokeStyle=j,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<Re.length;t+=1){const r=Re[t],h=r.offset*Ae*(.85+He(r.seed)*.4),T=1-Math.min(1,Math.abs(h)/Ae),K=Math.exp(-Math.pow(h/Ee.crestThickness,2)),X=r.layer===0?1.1:r.layer===1?.85:.6,te=.35+(1-r.depth)*.65,ee=T*te*X*(.34+K*.45);pe.globalAlpha=ee,pe.lineWidth=r.width*(1+(1-r.depth)*.8);const ue=[];for(let ye=0;ye<=qe;ye+=1){const ra=ye/qe*k+Y,Xe=(Pe(ra*.012,r.seed)-.5)*Ee.xJitter,aa=ra+Xe,Be=(Pe(aa*r.freqA,r.seed)-.5)*Ee.jitterA,We=(Pe(aa*r.freqB,r.seed*1.7)-.5)*Ee.jitterB,Oe=Ue+Math.sin(aa*r.freqA+r.seed)*r.ampA+Math.sin(aa*r.freqB+r.seed*1.3)*r.ampB+h+Be+We;ue.push({x:aa,y:Oe})}pe.beginPath(),pe.moveTo(ue[0].x,ue[0].y);for(let ye=1;ye<ue.length-1;ye+=1){const ra=(ue[ye].x+ue[ye+1].x)/2,Xe=(ue[ye].y+ue[ye+1].y)/2;pe.quadraticCurveTo(ue[ye].x,ue[ye].y,ra,Xe)}const oe=ue[ue.length-1];pe.quadraticCurveTo(oe.x,oe.y,oe.x,oe.y),pe.stroke()}pe.save(),pe.globalCompositeOperation="lighter",pe.strokeStyle=Ee.colors.glow,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<Re.length;t+=1){const r=Re[t];if(Math.abs(r.offset)*Ae>Ee.crestThickness)continue;const h=Ee.glowAlpha*(.7+(1-r.depth)*.6);pe.globalAlpha=h,pe.lineWidth=1.6+(1-r.depth)*1.2;const T=[];for(let X=0;X<=qe;X+=1){const te=X/qe*k+Y,ee=Math.sin(te*.02+r.seed)*3,ue=Ue+Math.sin(te*r.freqA+r.seed)*r.ampA+Math.sin(te*r.freqB+r.seed*1.3)*r.ampB+r.offset*Ae*.35+ee;T.push({x:te,y:ue})}pe.beginPath(),pe.moveTo(T[0].x,T[0].y);for(let X=1;X<T.length-1;X+=1){const te=(T[X].x+T[X+1].x)/2,ee=(T[X].y+T[X+1].y)/2;pe.quadraticCurveTo(T[X].x,T[X].y,te,ee)}const K=T[T.length-1];pe.quadraticCurveTo(K.x,K.y,K.x,K.y),pe.stroke()}pe.restore()},Le=()=>{Te=Math.floor(re.clientWidth),Ne=Math.floor(re.clientHeight),Me=Math.floor(Te*1.8),Qe=Ne,Fe=Te<820?le:se,B.forEach(pe=>{const Re=pe.getContext("2d");if(!Re)return;pe.width=Math.floor(Me*ke*Fe),pe.height=Math.floor(Qe*ke*Fe),pe.style.width=`${Me}px`,pe.style.height=`${Qe}px`,pe.style.left=`${-(Me-Te)/2}px`,Re.setTransform(ke*Fe,0,0,ke*Fe,0,0);const Ue=Number(pe.dataset.seed||1),Ae=W(Ue);Ve(Re,Ae)})};return Le(),window.addEventListener("resize",Le,{passive:!0}),()=>window.removeEventListener("resize",Le)},[J]);const F=_[Math.min(s,_.length-1)],ce=f?F:_[_.length-1],c=(ce==null?void 0:ce.theme)??_[0].theme,ie={"--cogita-bg0":c.bg0,"--cogita-bg1":c.bg1,"--cogita-bg2":c.bg2,"--cogita-bloom":c.bloom,"--cogita-sat":c.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:C,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:E,onChange:l}),e.jsx(_r,{copy:a,label:o,isAuthenticated:u,secureMode:I,onLogin:n,onProfileNavigate:g,onToggleSecureMode:w,onLogout:p,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:m,className:"cogita-section cogita-home",style:ie,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[J.map((re,B)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:re.style,"data-seed":re.seed,ref:Ce=>{x.current[B]=Ce}},re.id)),q.map(re=>e.jsx("div",{className:"cogita-home-wave",style:re.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},re.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(zi,{slides:_,activeIndex:s,introOpen:f,prefersReducedMotion:A,onNext:me,onPrev:ve,onSelect:ge,onExit:O,onOpen:D,onRegister:ne})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Yi},Symbol.toStringTag,{value:"Module"})),Qr=i.createContext(!1);function Na({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:l}){if(i.useContext(Qr))return e.jsx(e.Fragment,{children:l});const m=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}I("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:m,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(qr,{value:M,onChange:E}),e.jsx(_r,{copy:a,label:n,isAuthenticated:o,secureMode:p,onLogin:()=>I("home"),onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:l}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function qa(a){const[n,o]=i.useState("Cogita library"),[u,g]=i.useState(null);return i.useEffect(()=>{let w=!1;return Ur().then(p=>{if(w)return;const I=p.find(M=>M.libraryId===a);I&&o(I.name)}).catch(()=>{w||o("Cogita library")}),()=>{w=!0}},[a]),i.useEffect(()=>{let w=!1;return bi(a).then(p=>{w||g(p)}).catch(()=>{w||g(null)}),()=>{w=!0}},[a]),{libraryName:n,stats:u}}function Sr({slices:a}){const n=a.reduce((u,g)=>u+Math.max(0,g.value),0),o=i.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let u=0;return`conic-gradient(${a.map(w=>{const I=Math.max(0,w.value)/n*360,M=u,E=u+I;return u=E,`${w.color} ${M}deg ${E}deg`}).join(",")})`},[a,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:o}}),e.jsx("div",{className:"cogita-overview-legend",children:a.map(u=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:u.color}}),e.jsx("strong",{children:u.value}),e.jsx("small",{children:u.label})]},u.label))})]})}function Qi({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C,stats:m}=qa(l),[x,q]=i.useState("infos"),[J,_]=i.useState(0),[s,b]=i.useState(0),[f,Q]=i.useState(0),A=(m==null?void 0:m.totalInfos)??0,v=(m==null?void 0:m.totalCollections)??0,G=0,P=0,ne=0,D=Math.max(0,A-ne-s),O=Math.max(0,A-s-f);i.useEffect(()=>{let me=!1;return(async()=>{try{const F=await jt({libraryId:l,limit:200}),ce=await Promise.all(F.items.map(c=>Wr({libraryId:l,collectionId:c.collectionId}).catch(()=>[])));if(me)return;_(ce.reduce((c,ie)=>c+ie.length,0))}catch{me||_(0)}})(),()=>{me=!0}},[l]),i.useEffect(()=>{let me=!1;return(async()=>{try{const[F,ce,c]=await Promise.all([$t({libraryId:l,type:"computed",limit:1}).catch(()=>({total:0})),$t({libraryId:l,type:"source",limit:1}).catch(()=>({total:0})),zr({libraryId:l}).catch(()=>({items:[]}))]);if(me)return;b((F.total??0)+(ce.total??0));const ie=new Set(c.items.filter(re=>re.childItemType.toLowerCase()==="info").map(re=>re.childItemId).filter(Boolean));Q(ie.size)}catch{me||(b(0),Q(0))}})(),()=>{me=!0}},[l]);const ge=[{key:"infos",label:a.cogita.library.overview.stats.totalInfos,value:A},{key:"collections",label:a.cogita.library.overview.stats.collections,value:v},{key:"revisions",label:a.cogita.library.overview.stats.revisions,value:J},{key:"storyboards",label:a.cogita.library.overview.stats.storyboards,value:G},{key:"texts",label:a.cogita.library.overview.stats.texts,value:P}];return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:C})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ge.map(me=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${x===me.key?"active":""}`,onClick:()=>q(me.key),children:[e.jsx("span",{children:me.label}),e.jsx("strong",{children:me.value})]},me.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:a.cogita.library.overview.statsCardTitle})}),x==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.knownChartTitle}),e.jsx(Sr,{slices:[{label:a.cogita.library.overview.known,value:ne,color:"#75d79a"},{label:a.cogita.library.overview.unknown,value:D,color:"#85b9ff"},{label:a.cogita.library.overview.excluded,value:s,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:a.cogita.library.overview.checksChartTitle}),e.jsx(Sr,{slices:[{label:a.cogita.library.overview.availableChecks,value:f,color:"#75d79a"},{label:a.cogita.library.overview.unavailableChecks,value:O,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:a.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]})]})})]})})}const be=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ka=(a,n,o,u)=>`${a}:${n}:${o??""}:${u??""}`,ta=(a,n)=>{const o=a.cogita.library.infoTypes;return{any:o.any,vocab:o.vocab,language:o.language,word:o.word,sentence:o.sentence,topic:o.topic,collection:o.collection,person:o.person,institution:o.institution,collective:o.collective,orcid:o.orcid,address:o.address,email:o.email,phone:o.phone,media:o.media,work:o.work,geo:o.geo,music_piece:o.musicPiece,music_fragment:o.musicFragment,source:o.source,quote:o.quote,computed:o.computed}[n]??String(n)},Gr=a=>[{value:"any",label:ta(a,"any")},{value:"language",label:ta(a,"language")},{value:"word",label:ta(a,"word")},{value:"sentence",label:ta(a,"sentence")},{value:"topic",label:ta(a,"topic")},{value:"collection",label:ta(a,"collection")},{value:"person",label:ta(a,"person")},{value:"institution",label:ta(a,"institution")},{value:"collective",label:ta(a,"collective")},{value:"orcid",label:ta(a,"orcid")},{value:"address",label:ta(a,"address")},{value:"email",label:ta(a,"email")},{value:"phone",label:ta(a,"phone")},{value:"media",label:ta(a,"media")},{value:"work",label:ta(a,"work")},{value:"geo",label:ta(a,"geo")},{value:"music_piece",label:ta(a,"music_piece")},{value:"music_fragment",label:ta(a,"music_fragment")},{value:"source",label:ta(a,"source")},{value:"quote",label:ta(a,"quote")},{value:"computed",label:ta(a,"computed")}],Gi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Xi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],Zi=a=>[{value:"any",label:ta(a,"any")},{value:"vocab",label:ta(a,"vocab")},...Gr(a).filter(n=>n.value!=="any")],Za=5,Ir=50,Pr=2,Rr=[];function ze({libraryId:a,infoType:n,label:o,placeholder:u,value:g,onChange:w,values:p,onChangeMultiple:I,helperText:M,searchFailedText:E,createFailedText:l,createLabel:C,savingLabel:m,loadMoreLabel:x,inputRef:q,autoAdvance:J,onCommit:_,multiple:s}){const b=s?p??Rr:Rr,[f,Q]=i.useState(s?"":(g==null?void 0:g.label)??""),[A,v]=i.useState([]),[G,P]=i.useState(Za),[ne,D]=i.useState(-1),[O,ge]=i.useState(!1),[me,ve]=i.useState(!1),[F,ce]=i.useState(null),c=i.useRef(0),ie=i.useRef(new Map),re=i.useMemo(()=>s?f.trim().length>0:f.trim().length>0&&!g,[f,g,s]);i.useEffect(()=>{s||Q((g==null?void 0:g.label)??"")},[g,s]),i.useEffect(()=>{const se=f.trim();if(!se||se.length<Pr){v([]),ge(!1),P(Za),D(-1),ve(!1),ce(null);return}const le=se.toLowerCase(),ke=`${a}:${n}:${le}`,Te=ie.current.get(ke);if(Te){if(s&&b.length>0){const Fe=new Set(b.map(Me=>Me.id));v(Te.filter(Me=>!Fe.has(Me.id)))}else v(Te);P(Za),D(-1),ge(Te.length>0),ve(!1),ce(null);return}const Ne=window.setTimeout(async()=>{const Fe=Date.now();c.current=Fe,ve(!0),ce(null);try{const Me=await Hr({libraryId:a,type:n,query:se,limit:Ir});if(c.current!==Fe)return;const Qe=Me.slice(0,Ir).map(_e=>({id:_e.infoId,label:_e.label,infoType:_e.infoType}));if(ie.current.set(ke,Qe),s&&b.length>0){const _e=new Set(b.map(Ee=>Ee.id));v(Qe.filter(Ee=>!_e.has(Ee.id)))}else v(Qe);P(Za),D(-1),ge(!0)}catch{if(c.current!==Fe)return;ce(E??"Search failed.")}finally{c.current===Fe&&ve(!1)}},250);return()=>window.clearTimeout(Ne)},[a,n,f,b]);const B=se=>{if(s){const le=b.some(ke=>ke.id===se.id)?b:[...b,se];I==null||I(le),Q(""),ge(!1),D(-1);return}w==null||w(se),Q(se.label),ge(!1),D(-1),J&&(_==null||_())},Ce=async()=>{const se=f.trim();if(se){ve(!0),ce(null);try{const le=await Wa({libraryId:a,infoType:n,payload:{label:se}}),ke={id:le.infoId,label:se,infoType:le.infoType};if(se.length>=Pr){const Te=`${a}:${n}:${se.toLowerCase()}`,Ne=ie.current.get(Te)??[];ie.current.set(Te,[ke,...Ne])}if(s){I==null||I([...b,ke]),Q(""),ge(!1),D(-1);return}w==null||w(ke),ge(!1),D(-1),J&&(_==null||_())}catch{ce(l??"Create failed.")}finally{ve(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:o}),e.jsx("input",{value:f,placeholder:u,onChange:se=>{Q(se.target.value),!s&&g&&(w==null||w(null))},onKeyDown:se=>{if(se.key==="ArrowDown"){if(se.preventDefault(),!A.length)return;ge(!0),D(le=>{const ke=Math.min(A.length,G)-1,Te=le<0?0:Math.min(le+1,ke);return Te===ke&&A.length>G?(P(Ne=>Math.min(Ne+Za,A.length)),Math.min(le+1,Math.min(A.length,G+Za)-1)):Te});return}if(se.key==="ArrowUp"){if(se.preventDefault(),!A.length)return;ge(!0),D(le=>le<=0?0:le-1);return}if(se.key==="Enter"){if(se.preventDefault(),ne>=0&&A[ne]){B(A[ne]);return}if(re){Ce();return}}},onFocus:()=>{A.length>0&&ge(!0)},autoComplete:"off",ref:q})]}),s&&b.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:b.map(se=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>I==null?void 0:I(b.filter(le=>le.id!==se.id)),children:[se.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},se.id))}),M&&e.jsx("p",{className:"cogita-help",children:M}),F&&e.jsx("p",{className:"cogita-error",children:F}),O&&A.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[A.slice(0,G).map((se,le)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":le===ne,onClick:()=>B(se),children:[e.jsx("strong",{children:se.label}),e.jsx("span",{children:se.infoType})]},se.id)),G<A.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>P(se=>Math.min(se+Za,A.length)),children:x??"Load more"})]}),re&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:Ce,disabled:me,children:me?m??"Saving...":C??`Create new ${n}`})]})}function $r({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,mode:C}){const{libraryName:m}=qa(l),x=`/#/cogita/library/${l}`,[q,J]=i.useState("any"),[_,s]=i.useState(""),[b,f]=i.useState([]),[Q,A]=i.useState("idle"),[v,G]=i.useState(null),[P,ne]=i.useState(null),[D,O]=i.useState("idle"),[ge,me]=i.useState(0),[ve,F]=i.useState(null),[ce,c]=i.useState("idle"),[ie,re]=i.useState(null),[B,Ce]=i.useState(null),[se,le]=i.useState(null),[ke,Te]=i.useState(null),Ne=i.useMemo(()=>({languageAId:(ie==null?void 0:ie.id)??void 0,languageBId:(B==null?void 0:B.id)??void 0,topicId:(se==null?void 0:se.id)??void 0,levelId:(ke==null?void 0:ke.id)??void 0}),[ie,B,se,ke]),Fe=i.useMemo(()=>q==="vocab"||q==="any",[q]);i.useEffect(()=>{A("loading");const Pe=window.setTimeout(()=>{$t({libraryId:l,type:q==="any"?void 0:q,query:_.trim()||void 0,limit:30,languageAId:Fe?Ne.languageAId:void 0,languageBId:Fe?Ne.languageBId:void 0,topicId:Fe?Ne.topicId:void 0,levelId:Fe?Ne.levelId:void 0}).then(W=>{f(W.items),me(W.total),F(W.nextCursor??null),A("ready"),G(W.items[0]??null)}).catch(()=>{f([]),me(0),F(null),A("ready")})},240);return()=>window.clearTimeout(Pe)},[l,_,q,Fe,Ne]),i.useEffect(()=>{if(!v||v.cardType!=="info"||v.infoType!=="computed"){ne(null),O("idle"),c("idle");return}O("loading"),hr({libraryId:l,infoId:v.cardId}).then(Pe=>{ne(Pe),O("ready")}).catch(()=>{ne(null),O("ready")})},[l,v]);const Me=async()=>{if(ve){A("loading");try{const Pe=await $t({libraryId:l,type:q==="any"?void 0:q,query:_.trim()||void 0,limit:30,cursor:ve,languageAId:Fe?Ne.languageAId:void 0,languageBId:Fe?Ne.languageBId:void 0,topicId:Fe?Ne.topicId:void 0,levelId:Fe?Ne.levelId:void 0});f(W=>[...W,...Pe.items]),F(Pe.nextCursor??null),me(Pe.total),A("ready")}catch{A("ready")}}},Qe=async()=>{if(!(!v||v.cardType!=="connection"&&v.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){c("loading");try{await mi({libraryId:l,connectionId:v.cardId});let W=null;f(ae=>{const Ve=ae.filter(Le=>Le.cardId!==v.cardId);return W=Ve[0]??null,Ve}),me(ae=>Math.max(0,ae-(v.cardType==="vocab"?3:1))),G(ae=>ae&&ae.cardId===v.cardId?W:ae),c("idle")}catch{c("error")}}},_e=i.useMemo(()=>C==="collection"?"grid":C==="list"?"list":"detail",[C]),Ee=v?be(v):null,He=i.useMemo(()=>Zi(a),[a]),la=i.useMemo(()=>{const Pe=ge||b.length;return a.cogita.library.list.cardCount.replace("{shown}",String(b.length)).replace("{total}",String(Pe))},[a,b.length,ge]);return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":_e,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:x,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${x}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${x}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(Pe=>e.jsx("a",{className:"ghost","data-active":C===Pe,href:`${x}/${Pe}`,children:Pe==="detail"?a.cogita.library.list.modes.detail:Pe==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},Pe))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:q,onChange:Pe=>J(Pe.target.value),children:He.map(Pe=>e.jsx("option",{value:Pe.value,children:Pe.label},Pe.value))}),e.jsx("input",{type:"text",value:_,onChange:Pe=>s(Pe.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(q==="vocab"||q==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:ie,onChange:re,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:B,onChange:Ce,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:se,onChange:le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:ke,onChange:Te,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(ie||B||se||ke)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{re(null),Ce(null),le(null),Te(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:la}),e.jsx("span",{children:Q==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":C==="collection"?"grid":"list",children:b.length?b.map(Pe=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":Ee===be(Pe),onClick:()=>G(Pe),children:[e.jsx("div",{className:"cogita-card-type",children:Pe.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:Pe.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:Pe.label}),e.jsx("p",{className:"cogita-card-subtitle",children:Pe.description})]},be(Pe))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${x}/new`,children:a.cogita.library.list.addInfo})]})}),ve?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Me,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(v==null?void 0:v.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(v==null?void 0:v.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${x}/edit/${v.cardId}`,children:a.cogita.library.list.editInfo}):null,(v==null?void 0:v.cardType)==="connection"||(v==null?void 0:v.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:Qe,disabled:ce==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${x}/new`,children:a.cogita.library.actions.addInfo})]})]}),v?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:v.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:v.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),ce==="error"&&(v.cardType==="connection"||v.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,v.cardType==="info"&&v.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),D==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),D!=="loading"&&P?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(Et,{value:P.prompt,mode:"auto"}),P.expectedAnswers&&Object.keys(P.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(P.expectedAnswers).map(([Pe,W])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Pe}),e.jsx(br,{value:W,mode:"auto"})]},Pe))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(br,{value:P.expectedAnswer,mode:"auto"})]})]}):D!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Ft=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Er=8;function Ar({libraryId:a,copy:n,language:o,sourceKindOptions:u,value:g,onChange:w,labels:p}){const[I,M]=i.useState(!1),[E,l]=i.useState(-1),C=i.useMemo(()=>{const J=o;return Ft.map(_=>{var f;const s=(_==null?void 0:_[J])??(_==null?void 0:_.en)??(_==null?void 0:_.la);return{label:`${s.abbr} — ${s.name}`,latin:((f=_==null?void 0:_.la)==null?void 0:f.abbr)??s.abbr}})},[o]),m=(J,_=!1)=>{const s=J.trim().toLowerCase();return s?C.filter(b=>b.label.toLowerCase().includes(s)).slice(0,Er):_?C.slice(0,Er):[]},x=(J,_)=>{const s=J.trim().toLowerCase();if(!s)return null;const b=Ft;for(const f of b){const Q=f==null?void 0:f.la,A=(f==null?void 0:f[_])??(f==null?void 0:f.en)??Q,v=(A==null?void 0:A.abbr)??"",G=(A==null?void 0:A.name)??"";if(v.toLowerCase()===s||G.toLowerCase()===s||`${v} — ${G}`.toLowerCase()===s)return{book:f,entry:A,la:Q}}return null};i.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!I){const J=x(g.locatorValue,o);if(J){const _=`${J.entry.abbr} — ${J.entry.name}`;_!==g.bibleBookDisplay&&w({...g,bibleBookDisplay:_})}}},[o,g,I,w]);const q=J=>w({...g,...J});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:J=>q({sourceKind:J.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:u.map(J=>e.jsx("option",{value:J.value,children:J.label},J.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:J=>{const _=J.target.value;q({bibleBookDisplay:_,locatorValue:""}),M(!0),l(-1)},onKeyDown:J=>{var s;const _=m(g.bibleBookDisplay);if(_.length){if(J.key==="ArrowDown")J.preventDefault(),l(b=>Math.min(b+1,_.length-1));else if(J.key==="ArrowUp")J.preventDefault(),l(b=>Math.max(b-1,0));else if((J.key==="Enter"||J.key==="Tab")&&E>=0&&_[E]){const b=_[E],f=x(b.label,o);if(!f)return;q({bibleBookDisplay:b.label,locatorValue:((s=f.la)==null?void 0:s.abbr)??g.locatorValue}),M(!1)}}},onFocus:()=>M(!0),onBlur:()=>window.setTimeout(()=>M(!1),100),placeholder:p.bibleBookPlaceholder})]}),I&&m(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:m(g.bibleBookDisplay,!0).map((J,_)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":_===E,tabIndex:-1,onMouseDown:()=>{var b;const s=x(J.label,o);s&&q({bibleBookDisplay:J.label,locatorValue:((b=s.la)==null?void 0:b.abbr)??g.locatorValue})},children:e.jsx("strong",{children:J.label})},J.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:J=>q({locatorAux:J.target.value}),placeholder:p.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:J=>q({sourceUrl:J.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:J=>q({sourceAccessedDate:J.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:a,infoType:"work",label:p.churchDocumentLabel,placeholder:p.churchDocumentPlaceholder,value:g.churchDocument,onChange:J=>q({churchDocument:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>q({locatorValue:J.target.value}),placeholder:p.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(ze,{libraryId:a,infoType:"work",label:p.workLabel,placeholder:p.workPlaceholder,value:g.work,onChange:J=>q({work:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:a,infoType:"media",label:p.bookLabel,placeholder:p.bookPlaceholder,value:g.bookMedia,onChange:J=>q({bookMedia:J}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>q({locatorValue:J.target.value}),placeholder:p.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:J=>q({locatorValue:J.target.value}),placeholder:p.locatorPlaceholder})]})]})}const en=[],an=[];function tn({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),o=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),u=a.handles.length,g=u>1?(u-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),o?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((w,p)=>e.jsx(Lr,{type:"target",id:w.id,position:Cr.Left,style:{top:46+p*28},children:w.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:w.label}):null},w.id)),a.output!==!1?e.jsx(Lr,{type:"source",id:"out",position:Cr.Right}):null]})}function rn({copy:a,value:n,onChange:o}){var _e,Ee,He,la,Pe,W,ae,Ve,Le,pe,Re,Ue,Ae,qe;const u=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=j=>!j||j.nodes.length===0?en:j.nodes.map((k,Y)=>{var t,r,h,T;return{id:k.id,type:"computed",position:k.position??{x:40+Y*160,y:60+Y%3*80},data:{title:k.name||((t=u[k.type])==null?void 0:t.label)||k.type,subtitle:((r=u[k.type])==null?void 0:r.label)||k.type,type:k.type,name:k.name,outputLabel:k.outputLabel,min:k.min,max:k.max,value:k.type==="input.const"?k.value:void 0,list:k.list,handles:((h=u[k.type])==null?void 0:h.handles)??[],output:((T=u[k.type])==null?void 0:T.output)??!0}}}),w=j=>{if(!j||j.nodes.length===0)return an;const k=new Set(j.nodes.map(r=>r.id)),Y=[];let t=0;return j.nodes.forEach(r=>{const h=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(h).forEach(([T,K])=>{K.forEach(X=>{k.has(X)&&Y.push({id:`${r.id}-${T}-${X}-${t++}`,source:X,target:r.id,targetHandle:T==="in"?void 0:T})})})}),Y},p=i.useMemo(()=>g(n),[n,u]),I=i.useMemo(()=>w(n),[n]),M=(j,k)=>{if(!j)return"null";const Y=j.nodes.map(r=>{const h=(r.list??[]).join(","),T=r.inputs?r.inputs.join(","):"",K=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([te,ee])=>`${te}:${[...ee].sort().join(",")}`).sort().join("|"):"",X=k&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",h,T,K,X].join(":")}).sort().join("||"),t=j.outputs?[...j.outputs].sort().join(","):j.output??"";return`${Y}::${t}`},E=i.useMemo(()=>{var k;const j=!!((k=n==null?void 0:n.nodes)!=null&&k.some(Y=>!!Y.position));return M(n,j)},[n]),[l,C]=i.useState(p),[m,x]=i.useState(I),[q,J]=i.useState(null),[_,s]=i.useState([]),[b,f]=i.useState(null),[Q,A]=i.useState(null),[v,G]=i.useState({}),[P,ne]=i.useState(0),D=i.useRef(o),O=i.useRef(E),ge=i.useRef(E),me=i.useRef(M(n,!1)),ve=i.useMemo(()=>q?l.find(j=>j.id===q)??null:null,[l,q]),F=i.useMemo(()=>{const j=["in1","in2","in3","in4","in5","in6"],k=new Map;return m.forEach(Y=>{if(!Y.target)return;const t=Y.targetHandle??"in1";k.has(Y.target)||k.set(Y.target,new Set),k.get(Y.target).add(t)}),l.map(Y=>{var t;if(((t=Y.data)==null?void 0:t.type)==="compute.concat"){const r=k.get(Y.id)??new Set,h=[];let T=!1;return j.forEach(K=>{var X,te;if(r.has(K)||!T){const ee=(te=(X=u["compute.concat"])==null?void 0:X.handles)==null?void 0:te.find(ue=>ue.id===K);ee&&h.push(ee),r.has(K)||(T=!0)}}),{...Y,selected:Y.id===q,data:{...Y.data,handles:h}}}return{...Y,selected:Y.id===q}})},[l,q,m,u]);i.useEffect(()=>{f(null),A(null)},[q]),i.useEffect(()=>{if(_.length===0)return;const j=k=>{if(k.key!=="Delete"&&k.key!=="Backspace")return;const Y=k.target;Y&&(Y.tagName==="INPUT"||Y.tagName==="TEXTAREA"||Y.isContentEditable)||(k.preventDefault(),x(t=>t.filter(r=>!_.includes(r.id))),s([]))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[_,x]),i.useEffect(()=>{D.current=o},[o]),i.useEffect(()=>{if(O.current!==E){if(ge.current===E||me.current===E){O.current=E;return}O.current=E,C(p),x(I),J(null),f(null),A(null),G({}),ne(j=>j+1)}},[p,I,x,C,E]),i.useEffect(()=>{const j=l.filter(h=>{var T;return((T=h.data)==null?void 0:T.type)==="output"}).map(h=>h.id).sort(),k=new Map;m.forEach(h=>{let T=k.get(h.target);T||(T={},k.set(h.target,T));const K=h.targetHandle||"in";T[K]||(T[K]=[]),T[K].push(h.source)}),k.forEach(h=>{Object.values(h).forEach(T=>T.sort())});const Y={nodes:l.map(h=>{var T,K,X,te,ee,ue,oe,ye,ra;return{id:h.id,type:((T=h.data)==null?void 0:T.type)??"compute.add",position:h.position,name:(K=h.data)==null?void 0:K.name,outputLabel:(X=h.data)==null?void 0:X.outputLabel,min:(te=h.data)==null?void 0:te.min,max:(ee=h.data)==null?void 0:ee.max,value:((ue=h.data)==null?void 0:ue.type)==="input.const"?(oe=h.data)==null?void 0:oe.value:void 0,list:(ye=h.data)==null?void 0:ye.list,inputs:(ra=k.get(h.id))==null?void 0:ra.in,inputsByHandle:k.get(h.id)}}),output:j[0]??null,outputs:j},t=M(Y,!0),r=M(Y,!1);t===ge.current||r===me.current||(ge.current=t,me.current=r,D.current(Y))},[l,m]),i.useEffect(()=>{const j={};let k=!1;l.forEach(Y=>{var K,X,te,ee,ue;if(((K=Y.data)==null?void 0:K.type)!=="input.random")return;if(v[Y.id]!==void 0){j[Y.id]=v[Y.id];return}const t=Number.isFinite((X=Y.data)==null?void 0:X.min)?Number((te=Y.data)==null?void 0:te.min):0,r=Number.isFinite((ee=Y.data)==null?void 0:ee.max)?Number((ue=Y.data)==null?void 0:ue.max):t+10,h=Math.min(t,r),T=Math.max(t,r);j[Y.id]=Math.floor(Math.random()*(T-h+1))+h,k=!0}),(k||Object.keys(j).length!==Object.keys(v).length)&&G(j)},[l,v,P]);const ce=i.useMemo(()=>l.map(k=>{var t,r,h,T,K;const Y=(((t=k.data)==null?void 0:t.list)??[]).join(",");return[k.id,((r=k.data)==null?void 0:r.type)??"",((h=k.data)==null?void 0:h.name)??"",((T=k.data)==null?void 0:T.min)??"",((K=k.data)==null?void 0:K.max)??"",Y].join(":")}).sort().join("|"),[l]),c=i.useMemo(()=>m.map(k=>`${k.source}:${k.target}:${k.targetHandle??""}`).sort().join("|"),[m]),ie=i.useMemo(()=>{const j=new Map(l.map(te=>[te.id,te])),k=new Map;m.forEach(te=>{let ee=k.get(te.target);ee||(ee={},k.set(te.target,ee));const ue=te.targetHandle||"in";ee[ue]||(ee[ue]=[]),ee[ue].push(te.source)});const Y=new Map,t=new Set,r=te=>{if(typeof te=="number")return te;if(typeof te=="string"){const ee=Number(te);return Number.isFinite(ee)?ee:0}return 0},h=(te,ee)=>{var ue,oe;return ee?((ue=k.get(te.id))==null?void 0:ue[ee])??[]:((oe=k.get(te.id))==null?void 0:oe.in)??[]},T=(te,ee)=>h(te,ee).map(ue=>r(X(ue))),K=(te,ee)=>h(te,ee).map(ue=>X(ue)),X=te=>{var ye,ra,Xe,aa;if(Y.has(te))return Y.get(te);if(t.has(te))return 0;const ee=j.get(te);if(!ee)return 0;t.add(te);const ue=((ye=ee.data)==null?void 0:ye.type)??"";let oe=0;switch(ue){case"input.random":{oe=v[te]??0;break}case"input.const":{oe=Number.isFinite((ra=ee.data)==null?void 0:ra.value)?Number((Xe=ee.data)==null?void 0:Xe.value):0;break}case"input.list":{const Be=(((aa=ee.data)==null?void 0:aa.list)??[]).filter(Boolean),We=Math.round(T(ee,"index")[0]??0);oe=(Be.length?Be[Math.max(0,Math.min(Be.length-1,We))]:"")||String(We);break}case"compute.add":{oe=T(ee,"in").reduce((Be,We)=>Be+We,0);break}case"compute.sub":{oe=T(ee,"add").reduce((Be,We)=>Be+We,0)-T(ee,"sub").reduce((Be,We)=>Be+We,0);break}case"compute.mul":{const Be=T(ee,"in");oe=Be.length?Be.reduce((We,Oe)=>We*Oe,1):0;break}case"compute.div":{const Be=T(ee,"num")[0]??0,We=T(ee,"den").reduce((Oe,ea)=>Oe+ea,0);oe=Math.abs(We)<Number.EPSILON?0:Be/We;break}case"compute.pow":{const Be=T(ee,"base")[0]??0,We=T(ee,"exp")[0]??0;oe=Math.pow(Be,We);break}case"compute.exp":{const Be=T(ee,"base")[0]??0,We=T(ee,"exp")[0]??0;oe=Math.pow(Be,We);break}case"compute.log":{const Be=T(ee,"value")[0]??0,We=T(ee,"base")[0]??0,Oe=Math.max(Be,Number.EPSILON);oe=Math.abs(We)<Number.EPSILON?Math.log(Oe):Math.log(Oe)/Math.log(We);break}case"compute.abs":{oe=Math.abs(T(ee,"in")[0]??0);break}case"compute.min":{const Be=T(ee,"in");oe=Be.length?Math.min(...Be):0;break}case"compute.max":{const Be=T(ee,"in");oe=Be.length?Math.max(...Be):0;break}case"compute.floor":{oe=Math.floor(T(ee,"in")[0]??0);break}case"compute.ceil":{oe=Math.ceil(T(ee,"in")[0]??0);break}case"compute.round":{oe=Math.round(T(ee,"in")[0]??0);break}case"compute.mod":{const Be=T(ee,"a")[0]??0,We=T(ee,"b")[0]??0;oe=Math.abs(We)<Number.EPSILON?0:Be%We;break}case"compute.concat":{const We=["in1","in2","in3","in4","in5","in6"].flatMap(na=>K(ee,na)),Oe=We.length?We:K(ee,"in");oe=(Oe.length?Oe:K(ee)).map(na=>na==null?"":String(na)).join("");break}case"compute.trim":{const Be=K(ee,"text")[0]??K(ee,"in")[0]??"",We=Be==null?"":String(Be),Oe=Math.max(0,Math.round(T(ee,"start")[0]??0)),ea=Math.max(0,Math.round(T(ee,"end")[0]??0));oe=Oe+ea>=We.length?"":We.substring(Oe,We.length-ea);break}case"output":{const Be=h(ee,"in")[0];oe=Be?X(Be):0;break}default:oe=0}return t.delete(te),Y.set(te,oe),oe};return l.forEach(te=>X(te.id)),Y},[ce,c,v]),re=i.useRef(ie);i.useEffect(()=>{re.current=ie},[ie]);const B=i.useCallback(j=>{const k=re.current.get(j.id);return e.jsx(tn,{data:{...j.data,value:k}})},[]),Ce=i.useMemo(()=>({computed:B}),[B]),se=j=>{var r;if(!j.target||!j.targetHandle){x(h=>Rt(j,h));return}const k=l.find(h=>h.id===j.target),Y=k?u[((r=k.data)==null?void 0:r.type)??""]:null,t=Y==null?void 0:Y.handles.find(h=>h.id===j.targetHandle);x(h=>{let T=h;return t!=null&&t.limitOne&&(T=h.filter(K=>!(K.target===j.target&&K.targetHandle===j.targetHandle))),Rt(j,T)})},le=j=>{const k=crypto.randomUUID(),Y=u[j]??{label:j,handles:[]},t=Y.label;C(r=>[...r,{id:k,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:Y.label,type:j,name:"",handles:Y.handles,list:j==="input.list"?[]:void 0,output:Y.output??!0}}])},ke=j=>{if(q){if(j.name!==void 0){const k=j.name.trim(),Y=k===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(k);if(A(Y?null:a.cogita.library.graph.invalidName),!k)f(null);else{const t=l.find(r=>{var h;return r.id!==q&&((h=r.data)==null?void 0:h.name)&&r.data.name.trim().toLowerCase()===k.toLowerCase()});f(t?a.cogita.library.graph.duplicateName:null)}}C(k=>k.map(Y=>{var t,r,h,T;return Y.id===q?{...Y,data:{...Y.data,...j,title:j.name?j.name:(t=Y.data)==null?void 0:t.title,subtitle:((h=u[j.type??((r=Y.data)==null?void 0:r.type)??""])==null?void 0:h.label)??((T=Y.data)==null?void 0:T.subtitle)}}:Y}))}},Te=()=>{q&&(C(j=>j.filter(k=>k.id!==q)),x(j=>j.filter(k=>k.source!==q&&k.target!==q)),G(j=>{const k={...j};return delete k[q],k}),J(null),f(null))},Ne=i.useRef({nodeId:null,edgeIds:[]}),Fe=j=>{var T;const k=((T=j.nodes[0])==null?void 0:T.id)??null,Y=j.edges.map(K=>K.id),t=Ne.current,r=t.nodeId===k,h=t.edgeIds.length===Y.length&&t.edgeIds.every((K,X)=>K===Y[X]);r&&h||(Ne.current={nodeId:k,edgeIds:Y},J(k),s(Y))},Me=j=>{const k=j.filter(Y=>Y.type!=="select"&&Y.type!=="dimensions");k.length!==0&&C(Y=>gi(k,Y))},Qe=j=>{const k=j.filter(Y=>Y.type!=="select");k.length!==0&&x(Y=>ui(k,Y))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodeTypes:Ce,nodes:F,edges:m,onNodesChange:Me,onEdgesChange:Qe,onConnect:se,onNodeClick:(j,k)=>J(k.id),onSelectionChange:Fe,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>le("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>le("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>le("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>le("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>le("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>le("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>le("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>le("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>le("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>le("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>le("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>le("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>le("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>le("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>le("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>le("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>le("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>le("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>le("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>le("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),ve?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((_e=ve.data)==null?void 0:_e.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:j=>ke({name:j.target.value})}),b?e.jsx("em",{className:"cogita-help",children:b}):null,Q?e.jsx("em",{className:"cogita-help",children:Q}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((He=u[((Ee=ve.data)==null?void 0:Ee.type)??""])==null?void 0:He.label)??((la=ve.data)==null?void 0:la.type)]}),((Pe=ve.data)==null?void 0:Pe.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((W=ve.data)==null?void 0:W.outputLabel)??"",onChange:j=>ke({outputLabel:j.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((ae=ve.data)==null?void 0:ae.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Ve=ve.data)==null?void 0:Ve.min)??0,onChange:j=>ke({min:Number(j.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Le=ve.data)==null?void 0:Le.max)??10,onChange:j=>ke({max:Number(j.target.value)})})]})]}),((pe=ve.data)==null?void 0:pe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:((Re=ve.data)==null?void 0:Re.value)??0,onChange:j=>ke({value:Number(j.target.value)})})]}),((Ue=ve.data)==null?void 0:Ue.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Ae=ve.data)==null?void 0:Ae.list)??[]).join(`
`),onChange:j=>ke({list:j.target.value.split(`
`).map(k=>k.replace(/\r$/,"")).filter(k=>k.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((qe=ve.data)==null?void 0:qe.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{q&&(G(j=>{var h,T,K,X;const k=Number.isFinite((h=ve.data)==null?void 0:h.min)?Number((T=ve.data)==null?void 0:T.min):0,Y=Number.isFinite((K=ve.data)==null?void 0:K.max)?Number((X=ve.data)==null?void 0:X.max):k+10,t=Math.min(k,Y),r=Math.max(k,Y);return{...j,[q]:Math.floor(Math.random()*(r-t+1))+t}}),ne(j=>j+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Te,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const rr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function jr(a,n,o){if(!a)return null;const u=new Map(a.nodes.map(A=>[A.id,A])),g=new Map,w=new Set,p=A=>{if(typeof A=="number")return A;if(typeof A=="string"){const v=Number(A);return Number.isFinite(v)?v:0}return 0},I=A=>{if(g.has(A))return g.get(A);if(w.has(A))return 0;const v=u.get(A);if(!v)return 0;w.add(A);const G=ne=>{var O,ge;return(ne?((O=v.inputsByHandle)==null?void 0:O[ne])??[]:v.inputs??((ge=v.inputsByHandle)==null?void 0:ge.in)??[]).map(me=>I(me))};let P=0;switch(v.type){case"input.random":{const ne=v.min??0,D=v.max??ne+10,O=Math.min(ne,D),ge=Math.max(ne,D);P=Math.floor(Math.random()*(ge-O+1))+O;break}case"input.const":{P=v.value??0;break}case"input.list":{const ne=(v.list??[]).filter(Boolean),D=Math.round(p(G("index")[0]));P=ne.length?ne[Math.max(0,Math.min(ne.length-1,D))]:String(D);break}case"compute.add":{P=G("in").map(D=>p(D)).reduce((D,O)=>D+O,0);break}case"compute.sub":{const ne=G("add").map(O=>p(O)),D=G("sub").map(O=>p(O));P=ne.reduce((O,ge)=>O+ge,0)-D.reduce((O,ge)=>O+ge,0);break}case"compute.mul":{const ne=G("in").map(D=>p(D));P=ne.length?ne.reduce((D,O)=>D*O,1):0;break}case"compute.div":{const ne=p(G("num")[0]),D=G("den").map(O=>p(O)).reduce((O,ge)=>O+ge,0);P=Math.abs(D)<Number.EPSILON?0:ne/D;break}case"compute.pow":{const ne=p(G("base")[0]),D=p(G("exp")[0]);P=Math.pow(ne,D);break}case"compute.exp":{const ne=p(G("base")[0]),D=p(G("exp")[0]);P=Math.pow(ne,D);break}case"compute.log":{const ne=p(G("value")[0]),D=p(G("base")[0]),O=Math.max(ne,Number.EPSILON);P=Math.abs(D)<Number.EPSILON?Math.log(O):Math.log(O)/Math.log(D);break}case"compute.abs":{P=Math.abs(p(G("in")[0]));break}case"compute.min":{const ne=G("in").map(D=>p(D));P=ne.length?Math.min(...ne):0;break}case"compute.max":{const ne=G("in").map(D=>p(D));P=ne.length?Math.max(...ne):0;break}case"compute.floor":{P=Math.floor(p(G("in")[0]));break}case"compute.ceil":{P=Math.ceil(p(G("in")[0]));break}case"compute.round":{P=Math.round(p(G("in")[0]));break}case"compute.mod":{const ne=p(G("a")[0]),D=p(G("b")[0]);P=Math.abs(D)<Number.EPSILON?0:ne%D;break}case"compute.concat":{const D=["in1","in2","in3","in4","in5","in6"].flatMap(ve=>G(ve)),O=D.length?D:G("in");P=(O.length?O:G()).map(ve=>ve==null?"":String(ve)).join("");break}case"compute.trim":{const ne=G("text")[0]??G("in")[0]??"",D=ne==null?"":String(ne),O=Math.max(0,Math.round(p(G("start")[0]))),ge=Math.max(0,Math.round(p(G("end")[0])));O+ge>=D.length?P="":P=D.substring(O,D.length-ge);break}case"output":{P=G("in")[0]??0;break}default:P=0}return w.delete(A),g.set(A,P),P},M=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(A=>A.type==="output").map(A=>A.id);a.nodes.forEach(A=>I(A.id)),M.forEach(A=>I(A));const E=A=>Math.abs(A%1)<1e-5?String(Math.round(A)):A.toFixed(3).replace(/\.?0+$/,""),l=A=>typeof A=="number"?E(A):A??"",C=new Map;M.forEach(A=>{var D,O,ge,me;const v=u.get(A);if(!v)return;const G=(O=(D=v.inputsByHandle)==null?void 0:D.name)==null?void 0:O[0],P=G?l(g.get(G)):"",ne=(P==null?void 0:P.toString().trim())||((ge=v.outputLabel)==null?void 0:ge.trim())||((me=v.name)==null?void 0:me.trim())||A;C.set(A,ne)});const m={},x={},q={};M.forEach(A=>{var P,ne;const v=u.get(A);if(!v)return;const G=C.get(A)??(((P=v.outputLabel)==null?void 0:P.trim())||((ne=v.name)==null?void 0:ne.trim())||A);m[G]=l(g.get(A)),v.name&&(x[v.name.trim()]=G),x[A]=G});const J=(A,v)=>{let G=A;return a.nodes.forEach(P=>{var me,ve;const ne=l(g.get(P.id)),D=M.includes(P.id),O=D?C.get(P.id)??((me=P.outputLabel)==null?void 0:me.trim())??((ve=P.name)==null?void 0:ve.trim())??P.id:"",ge=D&&v?O:ne;G=G.replace(new RegExp(`\\{\\s*${rr(P.id)}\\s*\\}`,"gi"),ge),P.name&&(G=G.replace(new RegExp(`\\{\\s*${rr(P.name)}\\s*\\}`,"gi"),ge)),D&&P.outputLabel&&(G=G.replace(new RegExp(`\\{\\s*${rr(P.outputLabel)}\\s*\\}`,"gi"),O))}),G},_=n;let s=_.trim().length>0?_:"";s||(s=M.length?`Compute ${M.join(", ")}`:"Compute"),s=J(s,!0);const b=(o==null?void 0:o.trim())??"",f=b?J(b,!1):"",Q={};return g.forEach((A,v)=>{Q[v]=A,q[v]=l(A);const G=u.get(v);G!=null&&G.name&&(q[G.name.trim()]=l(A))}),{prompt:s,answers:m,values:Q,answerText:f,outputVariables:x,variableValues:q}}function Xr(a){var o;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((o=n[0])==null?void 0:o[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function nn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,editInfoId:C}){const{libraryName:m}=qa(l),x=!!C,q=`/#/cogita/library/${l}`,[J,_]=i.useState("info"),[s,b]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[f,Q]=i.useState(""),[A,v]=i.useState(null),[G,P]=i.useState(null),[ne,D]=i.useState("idle"),[O,ge]=i.useState(null),[me,ve]=i.useState(-1),[F,ce]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[c,ie]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[re,B]=i.useState(null),[Ce,se]=i.useState("idle"),[le,ke]=i.useState(null),[Te,Ne]=i.useState(null),[Fe,Me]=i.useState(null),Qe=i.useRef(null),_e=i.useRef(null),Ee=i.useRef(null),He=i.useMemo(()=>Gr(a),[a]),la=i.useMemo(()=>Gi(a),[a]),Pe=i.useMemo(()=>Xi(a),[a]),W=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),ae=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Ve=i.useMemo(()=>He.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[He]),Le=i.useMemo(()=>{const t=M;return Ft.map(r=>{var K;const h=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${h.abbr} — ${h.name}`,latin:((K=r==null?void 0:r.la)==null?void 0:K.abbr)??h.abbr}})},[M]),pe=(t,r=!1)=>{const h=t.trim().toLowerCase();return h?Le.filter(T=>T.label.toLowerCase().includes(h)).slice(0,8):r?Le.slice(0,8):[]},Re=(t,r)=>{const h=t.trim().toLowerCase();if(!h)return null;const T=Ft;for(const K of T){const X=K==null?void 0:K.la,te=(K==null?void 0:K[r])??(K==null?void 0:K.en)??X;if([te==null?void 0:te.abbr,te==null?void 0:te.name,X==null?void 0:X.abbr,X==null?void 0:X.name,`${te==null?void 0:te.abbr} — ${te==null?void 0:te.name}`].filter(Boolean).map(ue=>ue.toLowerCase()).some(ue=>ue===h))return{book:K,entry:te,la:X}}return null};i.useEffect(()=>{if(!F.language||!F.word){ke(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:F.language.id,wordId:F.word.id}).then(r=>{ke(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{ke(null)})},200);return()=>window.clearTimeout(t)},[l,F.language,F.word]),i.useEffect(()=>{if(!c.languageA||!c.wordA){Ne(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:c.languageA.id,wordId:c.wordA.id}).then(r=>{Ne(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Ne(null)})},200);return()=>window.clearTimeout(t)},[l,c.languageA,c.wordA]),i.useEffect(()=>{if(!c.languageB||!c.wordB){Me(null);return}const t=window.setTimeout(()=>{tr({libraryId:l,languageId:c.languageB.id,wordId:c.wordB.id}).then(r=>{Me(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Me(null)})},200);return()=>window.clearTimeout(t)},[l,c.languageB,c.wordB]),i.useEffect(()=>{if(!x||!C)return;let t=!1;return se("loading"),B(null),et({libraryId:l,infoId:C}).then(async r=>{var T,K;if(t)return;const h=r.payload??{};if(b(X=>({...X,infoType:r.infoType,label:h.label??"",notes:h.notes??"",language:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,sourceKind:h.sourceKind??"string",sourceResourceType:X.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:h.text??"",workLanguage:h.languageId?{id:h.languageId,label:h.languageId,infoType:"language"}:null,workOriginalLanguage:h.originalLanguageId?{id:h.originalLanguageId,label:h.originalLanguageId,infoType:"language"}:null,workDoi:h.doi??"",mediaType:h.mediaType??"book",mediaPublisher:h.publisher??"",mediaPublicationPlace:h.publicationPlace??"",mediaPublicationYear:h.publicationYear??"",mediaPages:h.pages??"",mediaIsbn:h.isbn??"",mediaCover:h.cover??"",mediaHeight:h.height??"",mediaLength:h.length??"",mediaWidth:h.width??"",mediaWeight:h.weight??"",mediaCollection:h.collection??"",mediaLocation:h.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&h.locator&&typeof h.locator=="object"){const X=h.locator;if(h.sourceKind==="website")b(te=>({...te,sourceUrl:typeof X.url=="string"?X.url:"",sourceAccessedDate:typeof X.date=="string"?X.date:""}));else if(h.sourceKind==="bible"){const te=typeof X.book=="string"?X.book:"",ee=te?Re(te,M):null,ue=ee?`${ee.entry.abbr} — ${ee.entry.name}`:te;b(oe=>({...oe,sourceLocatorValue:te,sourceLocatorAux:typeof X.rest=="string"?X.rest:"",sourceBibleBookDisplay:ue}))}else h.sourceKind==="book"?b(te=>({...te,sourceLocatorValue:typeof X.page=="string"?X.page:""})):h.sourceKind==="number_document"?b(te=>({...te,sourceLocatorValue:typeof X.number=="string"?X.number:""})):typeof X.text=="string"&&b(te=>({...te,sourceLocatorValue:X.text}))}if(h.languageId&&r.infoType!=="work")try{const X=await et({libraryId:l,infoId:h.languageId});if(t)return;b(te=>{var ee;return{...te,language:{id:h.languageId,label:((ee=X.payload)==null?void 0:ee.label)??h.languageId,infoType:"language"}}})}catch{}if(h.languageId&&r.infoType==="work")try{const X=await et({libraryId:l,infoId:h.languageId});if(t)return;b(te=>{var ee;return{...te,workLanguage:{id:h.languageId,label:((ee=X.payload)==null?void 0:ee.label)??h.languageId,infoType:"language"}}})}catch{}if(h.originalLanguageId)try{const X=await et({libraryId:l,infoId:h.originalLanguageId});if(t)return;b(te=>{var ee;return{...te,workOriginalLanguage:{id:h.originalLanguageId,label:((ee=X.payload)==null?void 0:ee.label)??h.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(Q(((T=h.definition)==null?void 0:T.answerTemplate)??""),v(((K=h.definition)==null?void 0:K.graph)??null),P(null),D("idle")):(Q(""),v(null),P(null),D("idle")),_("info")}).catch(()=>{t||B(a.cogita.library.add.info.failed)}).finally(()=>{t||se("idle")}),()=>{t=!0}},[a,C,x,l]),i.useEffect(()=>{if(s.sourceKind==="bible"&&s.sourceLocatorValue&&O!=="source"){const t=Re(s.sourceLocatorValue,M);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==s.sourceBibleBookDisplay&&b(h=>({...h,sourceBibleBookDisplay:r}))}}},[M,s.sourceKind,s.sourceLocatorValue,s.sourceBibleBookDisplay]);const Ue=async()=>{var t,r;B(null);try{const h={label:s.infoType==="quote"||s.infoType==="source"?"":s.label,notes:s.infoType==="computed"?"":s.notes};if(s.language&&(s.infoType==="word"||s.infoType==="sentence")&&(h.languageId=s.language.id),s.infoType==="source"&&(h.sourceKind=s.sourceKind,s.sourceKind==="website"?h.locator={url:s.sourceUrl.trim(),date:s.sourceAccessedDate.trim()}:s.sourceKind==="bible"?h.locator={book:s.sourceLocatorValue.trim(),rest:s.sourceLocatorAux.trim()}:s.sourceKind==="book"?h.locator={page:s.sourceLocatorValue.trim()}:s.sourceKind==="number_document"?h.locator={number:s.sourceLocatorValue.trim()}:h.locator={text:s.sourceLocatorValue.trim()}),s.infoType==="quote"&&(h.text=s.quoteText),s.infoType==="work"&&(h.languageId=((t=s.workLanguage)==null?void 0:t.id)??null,h.originalLanguageId=((r=s.workOriginalLanguage)==null?void 0:r.id)??null,h.doi=s.workDoi.trim()),s.infoType==="media"&&(h.mediaType=s.mediaType,h.publisher=s.mediaPublisher.trim(),h.publicationPlace=s.mediaPublicationPlace.trim(),h.publicationYear=s.mediaPublicationYear.trim(),h.pages=s.mediaPages.trim(),h.isbn=s.mediaIsbn.trim(),h.cover=s.mediaCover.trim(),h.height=s.mediaHeight.trim(),h.length=s.mediaLength.trim(),h.width=s.mediaWidth.trim(),h.weight=s.mediaWeight.trim(),h.collection=s.mediaCollection.trim(),h.location=s.mediaLocation.trim()),s.infoType==="computed"){if(!A){B(a.cogita.library.add.info.computedRequired);return}if(!f.trim()){B(a.cogita.library.add.info.computedAnswerRequired);return}if(A.nodes.find(oe=>oe.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(oe.name))){B(a.cogita.library.add.info.computedInvalidName);return}const K=A.nodes.map(oe=>{var ye;return(ye=oe.name)==null?void 0:ye.trim()}).filter(Boolean),X=new Set;for(const oe of K){const ye=oe.toLowerCase();if(X.has(ye)){B(a.cogita.library.add.info.computedDuplicateName);return}X.add(ye)}const te=A.nodes.filter(oe=>oe.type==="output"),ee=te.map(oe=>{var ye;return(ye=oe.name)==null?void 0:ye.trim()}).filter(Boolean);if(ee.length!==te.length){B(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!ee.every(oe=>new RegExp(`\\{\\s*${oe}\\s*\\}`,"i").test(f))){B(a.cogita.library.add.info.computedAnswerMissingOutput);return}h.definition={answerTemplate:f,graph:A}}if(x&&C)se("saving"),await pi({libraryId:l,infoId:C,payload:h}),B(a.cogita.library.add.info.updated),se("idle");else{let T=null;if(s.referenceEnabled){const oe={sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},{payload:ye,resourceInfoId:ra,error:Xe}=Ae(oe);if(Xe){B(a.cogita.library.add.info.referenceMissingSource);return}T={payload:ye,resourceInfoId:ra}}const K=await Wa({libraryId:l,infoType:s.infoType,payload:h});if(s.infoType==="source"&&s.sourceResource&&await da({libraryId:l,connectionType:"source-resource",infoIds:[K.infoId,s.sourceResource.id]}),s.infoType==="quote"&&s.language&&await da({libraryId:l,connectionType:"quote-language",infoIds:[K.infoId,s.language.id]}),T){const oe=await Wa({libraryId:l,infoType:"source",payload:T.payload});T.resourceInfoId&&await da({libraryId:l,connectionType:"source-resource",infoIds:[oe.infoId,T.resourceInfoId]}),await da({libraryId:l,connectionType:"reference",infoIds:[K.infoId,oe.infoId]})}B(a.cogita.library.add.info.saved);const X=s.infoType==="word"||s.infoType==="sentence",te=s.referenceEnabled,ee=s.referenceSourceKind,ue={referenceEnabled:te,referenceSourceKind:te?ee:"string",referenceSourceUrl:te&&ee==="website"?s.referenceSourceUrl:"",referenceSourceAccessedDate:te&&ee==="website"?s.referenceSourceAccessedDate:"",referenceChurchDocument:te&&ee==="number_document"?s.referenceChurchDocument:null,referenceBookMedia:te&&ee==="book"?s.referenceBookMedia:null,referenceWork:te&&ee==="work"?s.referenceWork:null,referenceLocatorValue:te&&ee==="bible"?s.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:te&&ee==="bible"?s.referenceBibleBookDisplay:""};b({infoType:s.infoType,label:"",language:X?s.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:s.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...ue}),s.infoType==="computed"&&(Q(""),v(null),P(null),D("idle"))}}catch{B(a.cogita.library.add.info.failed)}},Ae=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const h={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(h.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:h,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(h.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:h,resourceInfoId:r}):(t.sourceKind==="book"?h.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?h.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(h.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:h,resourceInfoId:r})},qe=()=>{if(D("idle"),!A){P(null),D("error");return}const t=jr(A,"",f);if(!t){P(null),D("error");return}P({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),D("ready")},j=async()=>{B(null);try{if(F.connectionType==="reference"){if(!F.referencedInfo||!F.source){B(a.cogita.library.add.connection.selectReference);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.referencedInfo.id,F.source.id]})}else if(F.connectionType==="source-resource"){if(!F.source||!F.sourceResource){B(a.cogita.library.add.connection.selectSourceResource);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.source.id,F.sourceResource.id]})}else if(F.connectionType==="quote-language"){if(!F.quote||!F.language){B(a.cogita.library.add.connection.selectQuoteLanguage);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.quote.id,F.language.id]})}else if(F.connectionType==="work-contributor"){if(!F.work||!F.contributor||!F.contributorRole.trim()){B(a.cogita.library.add.connection.selectWorkContributor);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.work.id,F.contributor.id],payload:{role:F.contributorRole.trim()}})}else if(F.connectionType==="work-medium"){if(!F.work||!F.medium){B(a.cogita.library.add.connection.selectWorkMedium);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.work.id,F.medium.id]})}else if(F.connectionType==="orcid-link"){if(!F.orcidEntity||!F.orcid){B(a.cogita.library.add.connection.selectOrcidLink);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.orcidEntity.id,F.orcid.id]})}else if(F.connectionType==="word-language"){if(!F.language||!F.word){B(a.cogita.library.add.connection.selectWordLanguage);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.language.id,F.word.id],payload:{note:F.note}})}else if(F.connectionType==="word-topic"){if(!F.word||!F.topic){B(a.cogita.library.add.connection.selectWordTopic);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.word.id,F.topic.id],payload:{note:F.note}})}else if(F.connectionType==="translation"){if(!F.wordA||!F.wordB){B(a.cogita.library.add.connection.selectTwoWords);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.wordA.id,F.wordB.id],payload:{note:F.note}})}else if(F.connectionType==="language-sentence"){if(!F.language||!F.sentence){B(a.cogita.library.add.connection.selectLanguageSentence);return}await da({libraryId:l,connectionType:F.connectionType,infoIds:[F.language.id,F.sentence.id],payload:{note:F.note}})}B(a.cogita.library.add.connection.saved),ce(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{B(a.cogita.library.add.connection.failed)}},k=async()=>{var t,r;B(null);try{if(c.groupType==="citation"){const T=c.citationTitle.trim(),K=c.citationQuoteText.trim();if(!K){B(a.cogita.library.add.group.citationMissingQuote);return}let X=null;if(c.citationReferenceEnabled){const ue={sourceKind:c.citationSourceKind,locatorValue:c.citationLocatorValue,locatorAux:c.citationLocatorAux,bibleBookDisplay:c.citationBibleBookDisplay,sourceUrl:c.citationSourceUrl,sourceAccessedDate:c.citationSourceAccessedDate,churchDocument:c.citationChurchDocument,bookMedia:c.citationBookMedia,work:c.citationWork},{payload:oe,resourceInfoId:ye,error:ra}=Ae(ue);if(ra){B(a.cogita.library.add.info.referenceMissingSource);return}X={payload:oe,resourceInfoId:ye}}const te={text:K};T&&(te.title=T);const ee=await Wa({libraryId:l,infoType:"quote",payload:te});if(c.citationLanguage&&await da({libraryId:l,connectionType:"quote-language",infoIds:[ee.infoId,c.citationLanguage.id]}),X){const ue=await Wa({libraryId:l,infoType:"source",payload:X.payload});X.resourceInfoId&&await da({libraryId:l,connectionType:"source-resource",infoIds:[ue.infoId,X.resourceInfoId]}),await da({libraryId:l,connectionType:"reference",infoIds:[ee.infoId,ue.infoId]})}B(a.cogita.library.add.group.savedCitation),ie(ue=>({...ue,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:ue.citationReferenceEnabled,citationSourceKind:ue.citationReferenceEnabled?ue.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:ue.citationReferenceEnabled?ue.citationChurchDocument:null,citationBookMedia:ue.citationReferenceEnabled?ue.citationBookMedia:null,citationWork:ue.citationReferenceEnabled?ue.citationWork:null}));return}if(c.groupType==="book"){const T=c.bookTitle.trim();if(!T){B(a.cogita.library.add.group.bookMissingTitle);return}const K=c.bookWorkTitle.trim();if(!K){B(a.cogita.library.add.group.bookMissingWork);return}if(c.bookContributors.find(oe=>oe.contributor&&!oe.role.trim()||!oe.contributor&&oe.role.trim())){B(a.cogita.library.add.group.bookMissingContributor);return}const te=await Wa({libraryId:l,infoType:"media",payload:{label:T,mediaType:"book",publisher:c.bookPublisher.trim(),publicationPlace:c.bookPublicationPlace.trim(),publicationYear:c.bookPublicationYear.trim(),pages:c.bookPages.trim(),isbn:c.bookIsbn.trim(),cover:c.bookCover.trim(),height:c.bookHeight.trim(),length:c.bookLength.trim(),width:c.bookWidth.trim(),weight:c.bookWeight.trim(),collection:c.bookCollection.trim(),location:c.bookLocation.trim()}}),ee=await Wa({libraryId:l,infoType:"work",payload:{label:K,languageId:((t=c.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=c.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:c.bookWorkDoi.trim()}});await da({libraryId:l,connectionType:"work-medium",infoIds:[ee.infoId,te.infoId]});const ue=c.bookContributors.filter(oe=>oe.contributor&&oe.role.trim());for(const oe of ue)await da({libraryId:l,connectionType:"work-contributor",infoIds:[ee.infoId,oe.contributor.id],payload:{role:oe.role.trim()}});B(a.cogita.library.add.group.savedBook),ie(oe=>({...oe,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!c.languageA||!c.wordA||!c.languageB||!c.wordB){B(a.cogita.library.add.group.selectBoth);return}const h=T=>Array.from(new Map(T.map(K=>[K.id,K])).values());Te||await da({libraryId:l,connectionType:"word-language",infoIds:[c.languageA.id,c.wordA.id]}),Fe||await da({libraryId:l,connectionType:"word-language",infoIds:[c.languageB.id,c.wordB.id]});for(const T of h(c.wordATags))await da({libraryId:l,connectionType:"word-topic",infoIds:[c.wordA.id,T.id]});for(const T of h(c.wordBTags))await da({libraryId:l,connectionType:"word-topic",infoIds:[c.wordB.id,T.id]});await da({libraryId:l,connectionType:"translation",infoIds:[c.wordA.id,c.wordB.id],payload:{tagIds:h(c.translationTags).map(T=>T.id)}}),B(a.cogita.library.add.group.savedVocab),ie(T=>({...T,groupType:c.groupType,languageA:c.languageA,wordA:null,languageB:c.languageB,wordB:null,wordATags:c.wordATags,wordBTags:c.wordBTags,translationTags:c.translationTags})),requestAnimationFrame(()=>{var T;return(T=Qe.current)==null?void 0:T.focus()})}catch{B(a.cogita.library.add.group.failed)}},Y=c.groupType==="citation"?a.cogita.library.add.group.saveCitation:c.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:q,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${q}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":J===t,onClick:()=>{x||_(t)},disabled:x&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[J==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:s.infoType,onChange:t=>{x||b(r=>({...r,infoType:t.target.value}))},disabled:x,children:He.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.infoType!=="quote"&&s.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:s.label,onChange:t=>b(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(s.infoType==="word"||s.infoType==="sentence"||s.infoType==="quote")&&e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:s.language,onChange:t=>b(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),s.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:s.workLanguage,onChange:t=>b(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:s.workOriginalLanguage,onChange:t=>b(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:s.workDoi,onChange:t=>b(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),s.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:s.mediaType,onChange:t=>b(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:s.mediaPublisher,onChange:t=>b(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationPlace,onChange:t=>b(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:s.mediaPublicationYear,onChange:t=>b(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:s.mediaPages,onChange:t=>b(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:s.mediaIsbn,onChange:t=>b(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:s.mediaCover,onChange:t=>b(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:s.mediaHeight,onChange:t=>b(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:s.mediaLength,onChange:t=>b(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:s.mediaWidth,onChange:t=>b(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:s.mediaWeight,onChange:t=>b(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:s.mediaCollection,onChange:t=>b(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:s.mediaLocation,onChange:t=>b(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),s.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:s.quoteText,onChange:t=>b(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),s.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:s.sourceKind,onChange:t=>{const r=t.target.value,h=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":s.sourceResourceType;b(T=>({...T,sourceKind:r,sourceResourceType:h,sourceResource:null,sourceLocatorValue:r==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?T.sourceBibleBookDisplay:""}))},children:W.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),s.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:s.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;b(h=>({...h,sourceBibleBookDisplay:r,sourceLocatorValue:""})),ge("source"),ve(-1)},onKeyDown:t=>{const r=pe(s.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),ve(h=>Math.min(h+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),ve(h=>Math.max(h-1,0));else if((t.key==="Enter"||t.key==="Tab")&&me>=0&&r[me]){const h=r[me],T=Re(h.label,M);if(!T)return;b(K=>{var X;return{...K,sourceBibleBookDisplay:h.label,sourceLocatorValue:((X=T.la)==null?void 0:X.abbr)??K.sourceLocatorValue}}),ge(null)}}},onFocus:()=>ge("source"),onBlur:()=>window.setTimeout(()=>ge(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),O==="source"&&pe(s.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:pe(s.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===me,tabIndex:-1,onMouseDown:()=>{const h=Re(t.label,M);h&&b(T=>{var K;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((K=h.la)==null?void 0:K.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorAux,onChange:t=>b(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),s.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:s.sourceUrl,onChange:t=>b(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:s.sourceAccessedDate,onChange:t=>b(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:s.sourceLocatorValue,onChange:t=>b(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),s.sourceKind!=="string"&&s.sourceKind!=="website"&&s.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:s.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(s.sourceKind),onChange:t=>b(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ve.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:l,infoType:s.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:s.sourceResource,onChange:t=>b(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ta(a,s.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),s.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:s.notes,onChange:t=>b(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,s.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:f,onChange:t=>Q(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(rn,{copy:a,value:A,onChange:t=>v(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:qe,children:a.cogita.library.add.info.computedPreview})}),G&&ne==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(Et,{value:G.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(G.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(br,{value:r,mode:"auto"})]},t))}),G.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(Et,{value:G.answerText,mode:"auto"})]}):null]}):ne==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.referenceEnabled,onChange:t=>b(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),s.referenceEnabled&&e.jsx(Ar,{libraryId:l,copy:a,language:M,sourceKindOptions:W,labels:ae,value:{sourceKind:s.referenceSourceKind,locatorValue:s.referenceLocatorValue,locatorAux:s.referenceLocatorAux,bibleBookDisplay:s.referenceBibleBookDisplay,sourceUrl:s.referenceSourceUrl,sourceAccessedDate:s.referenceSourceAccessedDate,churchDocument:s.referenceChurchDocument,bookMedia:s.referenceBookMedia,work:s.referenceWork},onChange:t=>b(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:Ue,disabled:Ce==="saving"||Ce==="loading",children:x?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,J==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:F.connectionType,onChange:t=>ce(r=>({...r,connectionType:t.target.value})),children:la.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),F.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:F.language,onChange:t=>ce(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:F.word,onChange:t=>ce(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),le&&e.jsx("p",{className:"cogita-help",children:le})]}),F.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:F.word,onChange:t=>ce(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:F.topic,onChange:t=>ce(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:F.wordA,onChange:t=>ce(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:F.wordB,onChange:t=>ce(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:F.quote,onChange:t=>ce(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:F.language,onChange:t=>ce(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:F.language,onChange:t=>ce(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:F.sentence,onChange:t=>ce(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:F.referencedInfoType,onChange:t=>ce(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:He.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:l,infoType:F.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:F.referencedInfo,onChange:t=>ce(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ta(a,F.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:F.source,onChange:t=>ce(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:F.source,onChange:t=>ce(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:F.sourceResourceType,onChange:t=>ce(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ve.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(ze,{libraryId:l,infoType:F.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:F.sourceResource,onChange:t=>ce(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ta(a,F.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:F.work,onChange:t=>ce(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:F.contributorType,onChange:t=>ce(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ta(a,t)},t))})]}),e.jsx(ze,{libraryId:l,infoType:F.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:F.contributor,onChange:t=>ce(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ta(a,F.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:F.contributorRole,onChange:t=>ce(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),F.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:F.work,onChange:t=>ce(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:F.medium,onChange:t=>ce(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),F.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:F.orcidEntityType,onChange:t=>ce(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ta(a,t)},t))})]}),e.jsx(ze,{libraryId:l,infoType:F.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:F.orcidEntity,onChange:t=>ce(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ta(a,F.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(ze,{libraryId:l,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:F.orcid,onChange:t=>ce(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:F.note,onChange:t=>ce(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:j,children:a.cogita.library.add.connection.save})})]}):null,J==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:c.groupType,onChange:t=>ie(r=>({...r,groupType:t.target.value})),children:Pe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),c.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:c.citationLanguage,onChange:t=>ie(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:c.citationTitle,onChange:t=>ie(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:c.citationQuoteText,onChange:t=>ie(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:c.citationReferenceEnabled,onChange:t=>ie(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),c.citationReferenceEnabled&&e.jsx(Ar,{libraryId:l,copy:a,language:M,sourceKindOptions:W,labels:ae,value:{sourceKind:c.citationSourceKind,locatorValue:c.citationLocatorValue,locatorAux:c.citationLocatorAux,bibleBookDisplay:c.citationBibleBookDisplay,sourceUrl:c.citationSourceUrl,sourceAccessedDate:c.citationSourceAccessedDate,churchDocument:c.citationChurchDocument,bookMedia:c.citationBookMedia,work:c.citationWork},onChange:t=>ie(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),c.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:c.bookTitle,onChange:t=>ie(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:c.bookPublisher,onChange:t=>ie(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:c.bookPublicationPlace,onChange:t=>ie(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:c.bookPublicationYear,onChange:t=>ie(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:c.bookPages,onChange:t=>ie(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:c.bookIsbn,onChange:t=>ie(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:c.bookCover,onChange:t=>ie(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:c.bookHeight,onChange:t=>ie(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:c.bookLength,onChange:t=>ie(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:c.bookWidth,onChange:t=>ie(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:c.bookWeight,onChange:t=>ie(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:c.bookCollection,onChange:t=>ie(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:c.bookLocation,onChange:t=>ie(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:c.bookWorkTitle,onChange:t=>ie(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:c.bookWorkLanguage,onChange:t=>ie(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:c.bookWorkOriginalLanguage,onChange:t=>ie(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:c.bookWorkDoi,onChange:t=>ie(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>ie(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),c.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:h=>ie(T=>({...T,bookContributors:T.bookContributors.map((K,X)=>X===r?{...K,contributorType:h.target.value,contributor:null}:K)})),children:["person","institution","collective"].map(h=>e.jsx("option",{value:h,children:ta(a,h)},h))})]}),e.jsx(ze,{libraryId:l,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:h=>ie(T=>({...T,bookContributors:T.bookContributors.map((K,X)=>X===r?{...K,contributor:h}:K)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ta(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:h=>ie(T=>({...T,bookContributors:T.bookContributors.map((K,X)=>X===r?{...K,role:h.target.value}:K)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>ie(h=>{const T=h.bookContributors.filter((K,X)=>X!==r);return T.length===0?{...h,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...h,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),c.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:c.languageA,onChange:t=>ie(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:c.languageB,onChange:t=>ie(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:c.wordA,onChange:t=>ie(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Qe,autoAdvance:!0,onCommit:()=>{var t;return(t=_e.current)==null?void 0:t.focus()}}),e.jsx(ze,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:c.wordB,onChange:t=>ie(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:_e,autoAdvance:!0,onCommit:()=>{var t;return(t=Ee.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(ze,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:c.translationTags,onChangeMultiple:t=>ie(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(ze,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:c.wordATags,onChangeMultiple:t=>ie(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(ze,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:c.wordBTags,onChangeMultiple:t=>ie(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),c.groupType==="vocab"&&Te&&e.jsx("p",{className:"cogita-help",children:Te}),c.groupType==="vocab"&&Fe&&e.jsx("p",{className:"cogita-help",children:Fe}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:k,ref:Ee,children:Y})})]}):null,re?e.jsx("p",{className:"cogita-form-error",children:re}):null]})})})})})]})})}const Fr=a=>/\s/.test(a),Bt=a=>/[\p{L}\p{N}]/u.test(a),Br=(a,n)=>{const o=n>0?a[n-1]:"",u=n<a.length?a[n]:"";if(!o||!u)return 0;const g=Fr(o),w=Fr(u);if(g||w)return 3;const p=Bt(o),I=Bt(u);return p!==I?2:!p&&!I?1:0},ir=(a,n,o,u,g)=>{const w=Math.max(u-n,o-u);for(let p=0;p<=w;p+=1){const I=u-p;if(I>=n&&I<=o&&Br(a,I)>=g)return I;const M=u+p;if(M>=n&&M<=o&&Br(a,M)>=g)return M}return null},nr=(a,n)=>{const o=n>0?a[n-1]:"",u=n<a.length?a[n]:"";return!o||!u?!0:Bt(o)!==Bt(u)},ln=(a,n,o,u)=>{const g=o-n,w=n+u,p=o-u;if(g<=u*2||p<=w)return null;const I=Math.floor((n+o)/2),M=ir(a,w,p,I,3);if(M!==null&&nr(a,M))return M;const E=ir(a,w,p,I,2);if(E!==null&&nr(a,E))return E;const l=ir(a,w,p,I,1);return l!==null&&nr(a,l)?l:null},bt=(a,n)=>{const o=Math.max(1,7),u=Math.max(o,13),g={},w=(M,E,l,C,m)=>{const x=String(C),q={id:x,start:M,end:E,text:a.slice(M,E),depth:l,index:C,parentId:m};if(g[x]=q,E-M>u){let _=ln(a,M,E,o);if(_!==null&&_>M&&_<E){const s=w(M,_,l+1,C*2+1,x),b=w(_,E,l+1,C*2+2,x);q.leftId=s.id,q.rightId=b.id}}return q},p=w(0,a.length,0,0),I=Object.values(g).sort((M,E)=>E.depth-M.depth||M.start-E.start).map(M=>M.id);return{text:a,rootId:p.id,nodes:g,order:I}},gt=(a,n,o,u,g,w,p)=>{const I=w==="reverse"?a.order.slice().sort((M,E)=>a.nodes[E].start-a.nodes[M].start||a.nodes[E].depth-a.nodes[M].depth):a.order;for(const M of I){if(p&&M===p||n.has(M))continue;const E=a.nodes[M];if(E){if(g&&(E.leftId||E.rightId)){const l=E.leftId?o[E.leftId]??0:u,C=E.rightId?o[E.rightId]??0:u;if((l+C)/2<u)continue}return E}}return null},Zr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function on({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const C=`/#/cogita/library/${l}`,[m,x,q]=Or([]),[J,_,s]=Vr([]),[b,f]=i.useState(null),[Q,A]=i.useState(null),[v,G]=i.useState(null),[P,ne]=i.useState(null),D=i.useMemo(()=>m.find(c=>c.id===b)??null,[m,b]);i.useEffect(()=>{let c=!0;return fi({libraryId:l}).then(ie=>{if(!c)return;const re=ie.nodes.map(B=>{var Ce,se,le;return{id:B.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:B.payload&&typeof B.payload=="object"&&"label"in B.payload?String(B.payload.label):"Item",nodeType:B.nodeType,itemType:((Ce=B.payload)==null?void 0:Ce.itemType)??"info",itemId:((se=B.payload)==null?void 0:se.itemId)??null,infoType:((le=B.payload)==null?void 0:le.infoType)??null}}});x(re),_(ie.edges.map(B=>({id:B.edgeId,source:B.fromNodeId,target:B.toNodeId})))}).catch(()=>{c&&(x([]),_([]))}),()=>{c=!1}},[l]),i.useEffect(()=>{xi({libraryId:l}).then(A).catch(()=>A(null))},[l,m,J]);const O=i.useCallback(c=>{_(ie=>Rt(c,ie))},[]),ge=()=>{const c=crypto.randomUUID();x(ie=>[...ie,{id:c,type:"default",position:{x:140+ie.length*40,y:120+ie.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},me=()=>{const c=crypto.randomUUID();x(ie=>[...ie,{id:c,type:"default",position:{x:180+ie.length*40,y:160+ie.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ve=async()=>{G(null);try{const c=m.map(re=>({nodeId:re.id,nodeType:re.data.nodeType,payload:{itemType:re.data.itemType,itemId:re.data.itemId??null,label:re.data.label,infoType:re.data.infoType??null}})),ie=J.map(re=>({edgeId:re.id,fromNodeId:re.source,toNodeId:re.target}));await yi({libraryId:l,nodes:c,edges:ie}),G(a.cogita.library.graph.saveSuccess)}catch{G(a.cogita.library.graph.saveFail)}},F=c=>{D&&x(ie=>ie.map(re=>re.id===D.id?{...re,data:{...re.data,itemId:(c==null?void 0:c.infoId)??null,itemType:"collection",infoType:"collection",label:(c==null?void 0:c.label)??a.cogita.library.infoTypes.collection}}:re))},ce=c=>{D&&x(ie=>ie.map(re=>re.id===D.id?{...re,data:{...re.data,itemId:(c==null?void 0:c.infoId)??null,itemType:"info",infoType:(c==null?void 0:c.infoType)??null,label:(c==null?void 0:c.label)??a.cogita.library.infoTypes.any}}:re))};return i.useEffect(()=>{if(!D||D.data.nodeType!=="info"||D.data.infoType!=="quote"||!D.data.itemId){ne(null);return}let c=!0;return et({libraryId:l,infoId:D.data.itemId}).then(ie=>{if(!c)return;const re=ie.payload,B=(re==null?void 0:re.text)??"";if(!B){ne(null);return}const Ce=bt(B),se=Object.values(Ce.nodes).sort((le,ke)=>le.depth-ke.depth||le.start-ke.start).map(le=>({id:le.id,text:le.text,depth:le.depth}));ne({title:(re==null?void 0:re.title)??D.data.label,fragments:se})}).catch(()=>ne(null)),()=>{c=!1}},[l,D]),e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:C,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ve,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ge,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:me,children:a.cogita.library.actions.addInfo}),Q?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(Q.totalCollections))})}):null,v?e.jsx("p",{className:"cogita-help",children:v}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fr,{nodes:m,edges:J,onNodesChange:q,onEdgesChange:s,onConnect:O,onNodeClick:(c,ie)=>f(ie.id),fitView:!0,children:[e.jsx(xr,{gap:18,size:1}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),D?e.jsxs("div",{className:"cogita-graph-inspector",children:[D.data.nodeType==="collection"?e.jsx(ze,{libraryId:l,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:D.data.itemId?{id:D.data.itemId,label:D.data.label,infoType:"collection"}:null,onChange:F,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(ze,{libraryId:l,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:D.data.itemId?{id:D.data.itemId,label:D.data.label,infoType:D.data.infoType??void 0}:null,onChange:ce,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),P?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:P.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:P.fragments.map(c=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:c.id}),e.jsx("span",{children:c.text})]},c.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function sn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C}){const{libraryName:m}=qa(l),[x,q]=i.useState([]),[J,_]=i.useState("loading"),[s,b]=i.useState("idle"),f=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Q=`/#/cogita/library/${l}`,A=()=>{_("loading"),Jr({libraryId:l}).then(P=>{q(P),_("idle")}).catch(()=>{q([]),_("error")})};i.useEffect(()=>{A()},[l]);const v=async P=>{try{await Yr({libraryId:l,shareId:P}),A()}catch{A()}},G=async P=>{const ne=`${f}/${P}`;try{await navigator.clipboard.writeText(ne),b("copied")}catch{b("failed")}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:Q,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${Q}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[J==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):J==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):x.filter(P=>!C||P.collectionId===C).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:x.filter(P=>!C||P.collectionId===C).map(P=>e.jsxs("div",{className:"cogita-share-row","data-state":P.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:P.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(P.createdUtc).toLocaleString(),P.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),P.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${f}/${P.shareCode}`}):null]}),P.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[P.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>G(P.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>v(P.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},P.shareId))}),s==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):s==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function cn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C}=qa(l),[m,x]=i.useState(null),[q,J]=i.useState(null),[_,s]=i.useState(null),[b,f]=i.useState(null),[Q,A]=i.useState(null),[v,G]=i.useState(null),P=i.useRef(null),ne=ge=>{if(!Number.isFinite(ge))return"0 B";if(ge<1024)return`${ge} B`;const me=ge/1024;if(me<1024)return`${me.toFixed(1)} KB`;const ve=me/1024;return ve<1024?`${ve.toFixed(1)} MB`:`${(ve/1024).toFixed(1)} GB`},D=async()=>{x(null),A({loadedBytes:0,totalBytes:null,percent:null});try{x(a.cogita.library.overview.exporting);const ge=await vi(l,A),me=URL.createObjectURL(ge),ve=document.createElement("a");ve.href=me,ve.download=`cogita-library-${C||l}.json`,ve.click(),URL.revokeObjectURL(me),x(a.cogita.library.overview.exportReady)}catch{x(a.cogita.library.overview.exportFail)}finally{A(ge=>ge??{loadedBytes:0,totalBytes:null,percent:null})}},O=async ge=>{var ve;J(null),s(null),f(null);const me=(ve=ge.target.files)==null?void 0:ve[0];if(me)try{J(a.cogita.library.overview.importing),G({loadedBytes:0,totalBytes:me.size,percent:0});const F=await ji(l,me,G,ce=>{const c=ce.stage==="infos"?a.cogita.library.overview.importStageInfos:ce.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;f(a.cogita.library.overview.importLiveProgress.replace("{stage}",c).replace("{done}",String(ce.processed)).replace("{total}",String(ce.total)).replace("{infos}",String(ce.infos)).replace("{connections}",String(ce.connections)).replace("{collections}",String(ce.collections)))});s({infos:F.infosImported,connections:F.connectionsImported,collections:F.collectionsImported}),J(a.cogita.library.overview.importDone)}catch(F){const ce=F instanceof wi&&F.message?` ${F.message}`:"";J(`${a.cogita.library.overview.importFail}${ce}`)}finally{P.current&&(P.current.value="")}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:D,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:P,type:"file",accept:"application/json",onChange:O})]})]}),Q?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:Q.percent??void 0,max:Q.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ne(Q.loadedBytes)).replace("{total}",Q.totalBytes?ne(Q.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,v?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:v.percent??void 0,max:v.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ne(v.loadedBytes)).replace("{total}",v.totalBytes?ne(v.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null,q?e.jsx("p",{className:"cogita-help",children:q}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null,_?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(_.infos)).replace("{connections}",String(_.connections)).replace("{collections}",String(_.collections))}):null]})]})})})]})})}function dn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C}=qa(l),[m,x]=i.useState(""),[q,J]=i.useState([]),_=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:s=>x(s.target.value),placeholder:a.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=m.trim();s&&(J(b=>[{id:_(),name:s},...b]),x(""))},children:a.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[q.length===0?e.jsx("p",{children:a.cogita.library.modules.storyboardsEmpty}):null,q.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function un({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C}=qa(l),[m,x]=i.useState(""),[q,J]=i.useState([]),_=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:m,onChange:s=>x(s.target.value),placeholder:a.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const s=m.trim();s&&(J(b=>[{id:_(),name:s},...b]),x(""))},children:a.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:a.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[q.length===0?e.jsx("p",{children:a.cogita.library.modules.textsEmpty}):null,q.map(s=>e.jsx("button",{type:"button",className:"ghost",children:s.name},s.id))]})]})]})})})]})})}function Dr({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l}){const{libraryName:C}=qa(l),m=`/#/cogita/library/${l}`,[x,q]=i.useState(""),[J,_]=i.useState([]),[s,b]=i.useState("idle"),[f,Q]=i.useState(0),[A,v]=i.useState(null);i.useEffect(()=>{b("loading");const P=window.setTimeout(()=>{jt({libraryId:l,query:x.trim()||void 0,limit:30}).then(ne=>{_(ne.items),Q(ne.total),v(ne.nextCursor??null),b("ready")}).catch(()=>{_([]),Q(0),v(null),b("ready")})},240);return()=>window.clearTimeout(P)},[l,x]);const G=async()=>{if(A){b("loading");try{const P=await jt({libraryId:l,query:x.trim()||void 0,limit:30,cursor:A});_(ne=>[...ne,...P.items]),v(P.nextCursor??null),Q(P.total),b("ready")}catch{b("ready")}}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${m}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:x,onChange:P=>q(P.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(J.length)).replace("{total}",String(f||J.length))}),e.jsx("span",{children:s==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:J.length?J.map(P=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${m}/collections/${P.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:P.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(P.itemCount))," ·"," ",P.notes||a.cogita.library.collections.noNotes]})]})},P.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${m}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),A?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:G,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}function gn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C}){qa(l);const m=`/#/cogita/library/${l}`,[x,q]=i.useState(a.cogita.library.collections.defaultName),[J,_]=i.useState(null),[s,b]=i.useState(0),[f,Q]=i.useState([]),[A,v]=i.useState("idle"),[G,P]=i.useState(null),ne=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(f.length)).replace("{total}",String(s||f.length)),[a,f.length,s]);i.useEffect(()=>{Wt(l,C).then(O=>{q(O.name),_(O.notes??null),b(O.itemCount)}).catch(()=>{q(a.cogita.library.collections.defaultName),_(null)})},[l,C]),i.useEffect(()=>{v("loading"),At({libraryId:l,collectionId:C,limit:40}).then(O=>{Q(O.items),P(O.nextCursor??null),b(O.total),v("ready")}).catch(()=>{Q([]),P(null),v("ready")})},[l,C]);const D=async()=>{if(G){v("loading");try{const O=await At({libraryId:l,collectionId:C,limit:40,cursor:G});Q(ge=>[...ge,...O.items]),P(O.nextCursor??null),b(O.total),v("ready")}catch{v("ready")}}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:x}),e.jsx("p",{className:"cogita-library-subtitle",children:J||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${m}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${m}/collections/${C}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${m}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ne}),e.jsx("span",{children:A==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:f.length?f.map(O=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:O.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:O.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:O.label}),e.jsx("p",{className:"cogita-card-subtitle",children:O.description})]})},be(O))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),G?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:D,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${m}/collections/${C}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Oa=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,o=a.filter(w=>w.correct).length,u=zt(wr(a));return{score:Math.round(Math.max(0,Math.min(100,u.knowness*100))*100)/100,total:n,correct:o,lastReviewedUtc:u.lastReviewedUtc??null}},hn=a=>{if(a.maskBase64)try{const n=ki(a.maskBase64);if(!n.length)return a.correct?1:0;const o=n.reduce((u,g)=>u+g,0);return Math.max(0,Math.min(1,o/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},wr=a=>a.map(n=>({correctness:hn(n),createdUtc:n.createdUtc})),zt=(a,n=Date.now())=>{var s;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const u=a.slice().sort((b,f)=>b.createdUtc.localeCompare(f.createdUtc)).slice(-5),g=u.reduce((b,f)=>b+f.correctness,0)/u.length,w=5,p=2,I=.15;let M=0,E=0;for(let b=0;b<u.length;b+=1){const f=new Date(u[b].createdUtc).getTime(),Q=b===u.length-1?n:new Date(u[b+1].createdUtc).getTime(),A=Math.max(0,(Q-f)/(1e3*60)),v=1-Math.exp(-A/w);M+=v,u[b].correctness>.5&&(E+=I)}let l=g*M*p+E;const C=((s=u[u.length-1])==null?void 0:s.createdUtc)??null,m=C?Math.max(0,(n-new Date(C).getTime())/(1e3*60)):0,q=1/(1+Math.log1p(m/60));return l*=q,u.length===1&&u[0].correctness>.5&&(l+=5.44*Math.exp(-m/2)),{knowness:l,avgCorrectness:g,lastReviewedUtc:C}},wt=a=>{const n=a.slice();for(let o=n.length-1;o>0;o-=1){const u=Math.floor(Math.random()*(o+1));[n[o],n[u]]=[n[u],n[o]]}return n},Pt=a=>a[Math.floor(Math.random()*a.length)],bn=(a,n)=>{const o=new Map;return a.forEach(u=>o.set(u,Math.random())),a.sort((u,g)=>{const w=n(u)-n(g);return w!==0?w:(o.get(u)??0)-(o.get(g)??0)})},Ht=(a,n,o,u,g)=>{if(!a.length)return null;const w=a.filter(I=>!(g!=null&&g.has(be(I))));if(w.length===0)return null;const p=w.filter(I=>be(I)!==o);return Pt(p.length?p:w)},mn=(a,n,o,u,g)=>{if(!a.length)return null;let w=Number.POSITIVE_INFINITY;for(const E of a){const l=be(E);if(o.has(l))continue;const C=n[l]??1;C<w&&(w=C)}if(!Number.isFinite(w))return null;const p=a.filter(E=>{const l=be(E);return!o.has(l)&&(n[l]??1)===w}),I=p.filter(E=>!g||be(E)!==g),M=u?I.filter(E=>!u.has(be(E))):I;return M.length>0?Pt(M):I.length>0?Pt(I):g&&p.some(E=>be(E)===g)?p.find(E=>be(E)===g)??null:p.length?Pt(p):null},ei=(a,n,o,u,g)=>{const w=[],p=a.filter(M=>!g.has(be(M))&&!o.has(be(M))&&(n[be(M)]??0)<1),I=bn(p,M=>n[be(M)]??0);for(const M of I){if(w.length>=u)break;w.push(M),g.add(be(M))}if(w.length<u){const M=wt(a.filter(E=>!g.has(be(E))&&o.has(be(E))));for(const E of M){if(w.length>=u)break;w.push(E),g.add(be(E))}}return w},pn=(a,n,o,u)=>ei(a,n,o,u,new Set),kr=(a,n,o,u,g,w)=>{const p=Math.max(1,o.stackSize??n),M=wt(a).filter((q,J,_)=>_.findIndex(s=>be(s)===be(q))===J),E=pn(M,u,g,p),l=new Set,C=new Set,m=Ht(E,{},null,l,C),x=m?[m]:[];return m&&C.add(be(m)),{queue:x,meta:{pool:M,active:E,knownessMap:u,unknownSet:g,outcomesById:w,asked:l,queued:C}}},mr={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const u=wt(a).filter((g,w,p)=>p.findIndex(I=>be(I)===be(g))===w);return{queue:u.slice(0,Math.min(n,u.length)),meta:{}}},applyOutcome:a=>a},Tr=(a,n,o,u)=>{const g=Math.max(1,o.stackSize??n),p=wt(a).filter((J,_,s)=>s.findIndex(b=>be(b)===be(J))===_),I={},M=new Set,E=new Set,l=new Set,C=Math.max(1,o.levels??1);p.forEach(J=>{const _=be(J),s=u==null?void 0:u[_],b=typeof s=="number"&&Number.isFinite(s)?s:1;I[_]=Math.min(C,Math.max(1,Math.round(b)))});const m=[];if(p.length>0){const J=new Map;p.forEach(s=>{var f;const b=I[be(s)]??1;J.has(b)||J.set(b,[]),(f=J.get(b))==null||f.push(s)});const _=Array.from(J.keys()).sort((s,b)=>s-b);for(const s of _){if(m.length>=g)break;const b=wt(J.get(s)??[]);for(const f of b){if(m.length>=g)break;m.push(f)}}}const x=Ht(m,I,null,M,E),q=x?[x]:[];return x&&E.add(be(x)),{queue:q,meta:{pool:p,active:m,levelMap:I,asked:M,queued:E,wrongSinceCorrect:l}}},fn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,o)=>Tr(a,n,o),applyOutcome:(a,n,o,u,g)=>{if(!n)return a;const w=Math.max(1,u.levels??1),p=a.meta.pool??[],I=a.meta.active??[],M={...a.meta.levelMap??{}},E=new Set(a.meta.asked??[]),l=new Set(a.meta.queued??[]),C=new Set(a.meta.wrongSinceCorrect??[]),m=be(n);l.delete(m),E.add(m);const x=M[m]??1;g.correct?(M[m]=C.has(m)?1:Math.min(x+1,w),C.delete(m)):(M[m]=1,C.add(m));const q=g.correct?I.filter(s=>be(s)!==m):I.slice();if(g.correct&&q.length<Math.max(1,u.stackSize??1)){const s=new Set(q.map(f=>be(f))),b=mn(p,M,s,E,m);b&&q.push(b)}const J=a.queue.slice(),_=Ht(q,M,m,E,l);return _&&(J.push(_),l.add(be(_))),{queue:J,meta:{pool:p,active:q,levelMap:M,asked:E,queued:l,wrongSinceCorrect:C}}}},xn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,o)=>kr(a,n,o,{},new Set,{}),applyOutcome:(a,n,o,u,g)=>{if(!n)return a;const w=a.meta.pool??[],p=a.meta.active??[],I={...a.meta.knownessMap??{}},M=new Set(a.meta.unknownSet??[]),E={...a.meta.outcomesById??{}},l=new Set(a.meta.asked??[]),C=new Set(a.meta.queued??[]),m=be(n);C.delete(m),l.add(m);const x={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},J=(E[m]??[]).concat(x).sort((A,v)=>A.createdUtc.localeCompare(v.createdUtc)).slice(-5);E[m]=J,M.delete(m);const _=Date.now();w.forEach(A=>{const v=be(A),G=E[v]??[];if(G.length===0){I[v]=0,M.add(v);return}const P=zt(G,_);I[v]=P.knowness});const s=p.slice();if((I[m]??0)>=1){const A=s.filter(v=>be(v)!==m);s.length=0,s.push(...A)}const f=Math.max(1,u.stackSize??o);if(s.length<f){const A=new Set(s.map(G=>be(G))),v=ei(w,I,M,f-s.length,A);s.push(...v)}const Q=a.queue.slice();if(Q.length===0||be(Q[Q.length-1])===m){const A=Ht(s,{},m,l,C);A&&(Q.push(A),C.add(be(A)))}return{queue:Q,meta:{pool:w,active:s,knownessMap:I,unknownSet:M,outcomesById:E,asked:l,queued:C}}}},ai={random:mr,levels:fn,temporal:xn},yn=Object.values(ai),Nr=a=>{if(!a)return mr;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?ai[n]:mr},Jt=(a,n)=>{const o={...a.defaultSettings};return n&&Object.entries(n).forEach(([u,g])=>{typeof g=="number"&&Number.isFinite(g)&&(o[u]=g),typeof g=="string"&&(o[u]=g)}),a.settingsFields.forEach(u=>{var w;const g=o[u.key];if(u.type==="number"){if(typeof g!="number"||Number.isNaN(g)){o[u.key]=a.defaultSettings[u.key]??0;return}u.min!==void 0&&(o[u.key]=Math.max(u.min,o[u.key])),u.max!==void 0&&(o[u.key]=Math.min(u.max,o[u.key]));return}if(u.type==="select"){const p=((w=u.options)==null?void 0:w.map(I=>I.value))??[];(typeof g!="string"||p.length>0&&!p.includes(g))&&(o[u.key]=a.defaultSettings[u.key]??p[0]??"")}}),o},ti=(a,n)=>{const o={};return a.settingsFields.forEach(u=>{const g=n.get(u.key);if(g){if(u.type==="number"){const w=Number(g);Number.isNaN(w)||(o[u.key]=w);return}o[u.key]=g}}),Jt(a,o)},vn=(a,n)=>{const o=new URLSearchParams;return a.settingsFields.forEach(u=>{const g=n[u.key];(typeof g=="number"||typeof g=="string")&&o.set(u.key,String(g))}),o};function jn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C,revisionId:m}){const{libraryName:x}=qa(l),q=`/#/cogita/library/${l}`,[J,_]=i.useState(a.cogita.library.collections.defaultName),[s,b]=i.useState(""),[f,Q]=i.useState(20),[A,v]=i.useState("random"),[G,P]=i.useState({}),[ne,D]=i.useState("exact"),[O,ge]=i.useState([]),[me,ve]=i.useState(null),[F,ce]=i.useState([]),[c,ie]=i.useState("idle"),[re,B]=i.useState(null),[Ce,se]=i.useState("idle"),[le,ke]=i.useState("idle"),[Te,Ne]=i.useState("idle"),Fe=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Me=i.useMemo(()=>Nr(A),[A]),Qe=i.useMemo(()=>Jt(Me,G),[Me,G]),_e=i.useMemo(()=>vn(Me,Qe).toString(),[Me,Qe]);i.useEffect(()=>{Wt(l,C).then(ae=>_(ae.name)).catch(()=>_(a.cogita.library.collections.defaultName))},[l,C]),i.useEffect(()=>{m&&Ti({libraryId:l,collectionId:C,revisionId:m}).then(ae=>{b(ae.name),v(ae.mode||"random"),D(ae.check||"exact"),Q(ae.limit||20),P(ae.revisionSettings??{})}).catch(()=>{b("")})},[C,l,m]),i.useEffect(()=>{Ni({libraryId:l}).then(ae=>{ge(ae),!me&&ae.length>0&&ve(ae[0].roleId)}).catch(()=>{ge([])})},[l]);const Ee=()=>{ke("loading"),Jr({libraryId:l}).then(ae=>{ce(ae),ke("idle")}).catch(()=>{ce([]),ke("error")})};i.useEffect(()=>{Ee()},[l]);const He=async()=>{ie("working"),se("idle");try{const ae=await Ci({libraryId:l,collectionId:C,revisionType:Me.id,revisionSettings:Qe,mode:A,check:ne,limit:f});B(`${Fe}/${ae.shareCode}${_e?`?${_e}`:""}`),ie("ready"),Ee()}catch{ie("error")}},la=async()=>{if(m){Ne("saving");try{await Li({libraryId:l,collectionId:C,revisionId:m,name:s||J,revisionType:Me.id,revisionSettings:Qe,mode:A,check:ne,limit:f}),Ne("saved")}catch{Ne("error")}}},Pe=async()=>{if(re)try{await navigator.clipboard.writeText(re),se("copied")}catch{se("failed")}},W=async ae=>{try{await Yr({libraryId:l,shareId:ae}),Ee()}catch{Ee()}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:J}),e.jsx("p",{className:"cogita-library-subtitle",children:x})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:q,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${q}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${q}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${q}/collections/${C}/revision/run?mode=${encodeURIComponent(A)}&check=${encodeURIComponent(ne)}&limit=${f}${_e?`&${_e}`:""}${me?`&reviewer=${encodeURIComponent(me)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:s,onChange:ae=>b(ae.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:A,onChange:ae=>v(ae.target.value),children:yn.map(ae=>e.jsx("option",{value:ae.id,children:a.cogita.library.revision[ae.labelKey]},ae.id))})]}),Me.settingsFields.map(ae=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[ae.labelKey]}),ae.type==="select"?e.jsx("select",{value:String(Qe[ae.key]??""),onChange:Ve=>P(Le=>({...Le,[ae.key]:Ve.target.value})),children:(ae.options??[]).map(Ve=>e.jsx("option",{value:Ve.value,children:a.cogita.library.revision[Ve.labelKey]},Ve.value))}):e.jsx("input",{type:"number",min:ae.min,max:ae.max,step:ae.step,value:Qe[ae.key]??0,onChange:Ve=>P(Le=>({...Le,[ae.key]:Number(Ve.target.value||0)}))})]},ae.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),Me.id!=="levels"&&Me.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:f,onChange:ae=>Q(Number(ae.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:me??"",onChange:ae=>ve(ae.target.value||null),children:O.map(ae=>e.jsx("option",{value:ae.roleId,children:ae.label},ae.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[m?e.jsx("button",{type:"button",className:"cta ghost",onClick:la,disabled:Te==="saving",children:Te==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${q}/collections/${C}/revision/run?mode=${encodeURIComponent(A)}&check=${encodeURIComponent(ne)}&limit=${f}${_e?`&${_e}`:""}${me?`&reviewer=${encodeURIComponent(me)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Te==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),re?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:re,readOnly:!0})]}):null,c==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,Ce==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):Ce==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:He,disabled:c==="working",children:c==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),re?e.jsx("button",{type:"button",className:"cta ghost",onClick:Pe,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),le==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):F.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:F.map(ae=>e.jsxs("div",{className:"cogita-share-row","data-state":ae.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:ae.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(ae.createdUtc).toLocaleString(),ae.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),ae.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>W(ae.shareId),children:a.cogita.library.revision.shareRevokeAction})]},ae.shareId))})]})]})]})]})})})]})})}function ri({copy:a,currentCard:n,currentTypeLabel:o,prompt:u,languages:g,answer:w,onAnswerChange:p,computedExpected:I,computedAnswers:M,onComputedAnswerChange:E,answerTemplate:l,outputVariables:C,variableValues:m,computedFieldFeedback:x,feedback:q,canAdvance:J,quoteContext:_,quotePlaceholder:s,onCheckAnswer:b,onSkip:f,onLanguageSelect:Q,onMarkReviewed:A,onAdvance:v,showCorrectAnswer:G,setShowCorrectAnswer:P,onRevealCorrect:ne,answerMask:D,expectedAnswer:O,hasExpectedAnswer:ge,handleComputedKeyDown:me,answerInputRef:ve,computedInputRefs:F,scriptMode:ce,setScriptMode:c,matchPairs:ie,matchLeftOrder:re,matchRightOrder:B,matchSelection:Ce,matchActiveLeft:se,matchActiveRight:le,matchFeedback:ke,onMatchLeftSelect:Te,onMatchRightSelect:Ne}){const Fe=i.useMemo(()=>{var Y;const W=!l&&I.length===2?`The {${I[0].key}} is of type {${I[1].key}}`:null,ae=l??W;if(!ae)return null;const Ve=new Map(I.map(t=>[t.key,t.expected])),Le=new Set,pe=[],Re=/\{([^}]+)\}/g;let Ue=0,Ae,qe=null;for(;(Ae=Re.exec(ae))!==null;){const t=ae.slice(Ue,Ae.index);t&&pe.push({type:"text",value:t});const r=((Y=Ae[1])==null?void 0:Y.trim())??"",h=r&&Ve.has(r)?r:r&&C&&C[r]?C[r]:null;r&&Le.add(r),h&&Le.add(h),h&&Ve.has(h)?(pe.push({type:"input",value:h}),qe||(qe=h)):r&&m&&m[r]!==void 0?pe.push({type:"text",value:m[r]}):pe.push({type:"text",value:Ae[0]}),Ue=Ae.index+Ae[0].length}const j=ae.slice(Ue);return j&&pe.push({type:"text",value:j}),I.filter(t=>!Le.has(t.key)).length>0?null:{parts:pe,expectedByKey:Ve,firstInputKey:qe}},[l,I,C,m]),Me=()=>{if(!Fe)return null;const{parts:W,expectedByKey:ae,firstInputKey:Ve}=Fe;return e.jsx("div",{className:"cogita-revision-inline-answer",children:W.map((Le,pe)=>{var Re,Ue;return Le.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Le.value},`text-${pe}`):e.jsx("input",{ref:Ae=>{F.current[Le.value]=Ae},autoFocus:Le.value===Ve,value:M[Le.value]??"",onChange:Ae=>E(Le.value,Ae.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[Le.value]??(q==="correct"?"correct":q==="incorrect"?"incorrect":void 0),onKeyDown:Ae=>He(Ae)||me(Ae),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Re=M[Le.value])==null?void 0:Re.length)??0,((Ue=ae.get(Le.value))==null?void 0:Ue.length)??6)}ch`}},`input-${Le.value}-${pe}`)})})},Qe=i.useMemo(()=>{const W=new Map;return(ie??[]).forEach(ae=>W.set(ae.leftId,ae)),W},[ie]),_e=i.useMemo(()=>{const W=new Map;return(ie??[]).forEach(ae=>W.set(ae.rightId,ae)),W},[ie]);i.useEffect(()=>{var pe;if(n.cardType!=="info"||n.infoType!=="computed"||I.length===0)return;const W=typeof document<"u"?document.activeElement:null;if(W&&(W.tagName==="INPUT"||W.tagName==="TEXTAREA"))return;const ae=(Fe==null?void 0:Fe.firstInputKey)??((pe=I[0])==null?void 0:pe.key);if(!ae)return;const Ve=F.current[ae];if(!Ve)return;const Le=requestAnimationFrame(()=>{Ve.focus()});return()=>cancelAnimationFrame(Le)},[n,I,Fe]);const Ee=(()=>{const W=[O??"",...I.map(Le=>Le.expected??"")].join(""),ae=[w,...Object.values(M)].join(""),Ve=`${W}${ae}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Ve)})(),He=W=>W.ctrlKey&&(W.key==="^"||W.key==="6")?(W.preventDefault(),c(ae=>ae==="super"?null:"super"),!0):W.ctrlKey&&(W.key==="_"||W.key==="-")?(W.preventDefault(),c(ae=>ae==="sub"?null:"sub"),!0):!1,la=()=>{if(!O||!D)return O??"";const W=O.split(""),ae=Array.from(D),Ve=ae.length>0?ae.reduce((Le,pe)=>Le+pe,0)/ae.length:127;return W.map((Le,pe)=>{const Re=ae[pe]??Ve,Ue=Math.max(0,Math.min(255,Math.round(Re)));let Ae=255,qe=0;return Ue<=127?qe=Math.round(Ue/127*255):(qe=255,Ae=Math.round(255*(1-(Ue-127)/128))),e.jsx("span",{style:{color:`rgb(${Ae}, ${qe}, 0)`},children:Le},`mask-${pe}`)})},Pe=n.cardType==="info"&&n.infoType==="quote"?(_==null?void 0:_.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:o}),e.jsx("strong",{children:Pe})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&ie?e.jsxs("div",{className:"cogita-revision-body",children:[u?e.jsx("h2",{children:u}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(re??[]).map(W=>{const ae=Qe.get(W);if(!ae)return null;const Ve=(Ce==null?void 0:Ce[W])??null,Le=(ke==null?void 0:ke[W])??null,pe=se===W;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":pe,"data-state":Le??void 0,"data-locked":Ve?"true":void 0,onClick:()=>Te==null?void 0:Te(W),children:[e.jsx("span",{children:ae.leftLabel}),Ve&&G?e.jsx("em",{children:"✓"}):null]},W)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(B??[]).map(W=>{const ae=_e.get(W);if(!ae)return null;const Ve=Object.values(Ce??{}).includes(W),Le=le===W;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Ve||Le,"data-locked":Ve?"true":void 0,onClick:()=>Ne==null?void 0:Ne(W),children:e.jsx("span",{children:ae.rightLabel})},W)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ve,value:w,onChange:W=>p(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":q==="correct"?"correct":q==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?v():b())}})]}),Ee?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ce==="super",onClick:()=>c(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ce==="sub",onClick:()=>c(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,l?null:e.jsx(Et,{value:u??"",mode:"auto"}),I.length>0?(()=>{const W=Me();return W?e.jsx("div",{className:"cogita-inline-answer-wrap",children:W}):e.jsx("div",{className:"cogita-form-grid",children:I.map((ae,Ve)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:ae.key}),e.jsx("textarea",{ref:Le=>{F.current[ae.key]=Le},autoFocus:Ve===0,value:M[ae.key]??"",onChange:Le=>E(ae.key,Le.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":x[ae.key]??(q==="correct"?"correct":q==="incorrect"?"incorrect":void 0),onKeyDown:Le=>He(Le)||me(Le)})]},ae.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ve,value:w,onChange:W=>p(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":q==="correct"?"correct":q==="incorrect"?"incorrect":void 0,onKeyDown:W=>{He(W)||W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?v():b())}})]})}),Ee?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ce==="super",onClick:()=>c(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ce==="sub",onClick:()=>c(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&_?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(_.completed)).replace("{total}",String(_.total))}),e.jsx("p",{className:"cogita-quote-text",children:_.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ve,value:w,onChange:W=>p(W.target.value),placeholder:s??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":q==="correct"?"correct":q==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),J?v():b())}})]}),e.jsx("p",{className:"cogita-quote-text",children:_.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(W=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>Q(W.label),children:W.label},W.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:u}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:A,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:f,children:a.cogita.library.revision.skip})]})]}),q&&e.jsx("div",{className:"cogita-revision-feedback","data-state":q,children:q==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),q==="incorrect"&&ge?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>P(W=>{const ae=!W;return ae&&ne(),ae}),children:a.cogita.library.revision.showAnswer}),G?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),I.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[I.map(W=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:W.key}),e.jsx("span",{children:W.expected})]},W.key)),O?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:O})]}):null]}):e.jsx("p",{children:D?la():O})]}):null]}):null,J?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:v,children:a.cogita.library.revision.nextQuestion})}):null]})}const lr=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ii({outcomes:a}){const[n,o]=i.useState("day"),u=i.useMemo(()=>{const g=lr.find(I=>I.id===n)??lr[1],w=Date.now()-g.ms,p=a.filter(I=>new Date(I.createdUtc).getTime()>=w);return Oa(p)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:lr.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>o(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[u.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[u.correct," / ",u.total]})]})}const wn="cogita-revision",kn=1,Dt="outcomes",Tn=()=>new Promise((a,n)=>{const o=indexedDB.open(wn,kn);o.onupgradeneeded=()=>{const u=o.result;if(!u.objectStoreNames.contains(Dt)){const g=u.createObjectStore(Dt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},o.onerror=()=>n(o.error),o.onsuccess=()=>a(o.result)}),Tt=async(a,n)=>{const o=await Tn();return new Promise((u,g)=>{const w=o.transaction(Dt,a),p=w.objectStore(Dt);n(p).then(u).catch(g),w.onerror=()=>g(w.error)})},ni=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(o=>o.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Nn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const o=ni();return localStorage.setItem(a,o),o},Ln=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),o=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(o)),o},li=(a,n,o,u)=>Ka(a,n,o,u),Kt=async a=>{const n=Nn(),o=Ln(),u=new Date().toISOString(),g={...a,clientId:n,clientSequence:o,createdUtc:u,id:ni(),pending:!0};return await Tt("readwrite",w=>new Promise((p,I)=>{const M={...g,itemKey:li(g.itemType,g.itemId,g.checkType,g.direction)},E=w.add(M);E.onsuccess=()=>p(),E.onerror=()=>I(E.error)})),g},Ot=async(a,n,o,u)=>{if(!n)return[];try{const g=li(a,n,o,u);return await Tt("readonly",w=>new Promise((p,I)=>{const E=w.index("byItem").getAll(g);E.onsuccess=()=>{const C=(E.result??[]).map(m=>({itemType:m.itemType,itemId:m.itemId,checkType:m.checkType??null,direction:m.direction??null,revisionType:m.revisionType,evalType:m.evalType,correct:m.correct,createdUtc:m.createdUtc,maskBase64:m.maskBase64,payloadBase64:m.payloadBase64,payloadHashBase64:m.payloadHashBase64,clientId:m.clientId,clientSequence:m.clientSequence,personRoleId:m.personRoleId??null})).sort((m,x)=>m.createdUtc.localeCompare(x.createdUtc));p(C)},E.onerror=()=>I(E.error)}))}catch{return[]}},Va=async()=>{try{return await Tt("readonly",a=>new Promise((n,o)=>{const u=a.getAll();u.onsuccess=()=>{const w=(u.result??[]).map(p=>({itemType:p.itemType,itemId:p.itemId,checkType:p.checkType??null,direction:p.direction??null,revisionType:p.revisionType,evalType:p.evalType,correct:p.correct,createdUtc:p.createdUtc,maskBase64:p.maskBase64,payloadBase64:p.payloadBase64,payloadHashBase64:p.payloadHashBase64,clientId:p.clientId,clientSequence:p.clientSequence,personRoleId:p.personRoleId??null}));n(w)},u.onerror=()=>o(u.error)}))}catch{return[]}},Cn=async(a=100)=>{try{return await Tt("readonly",n=>new Promise((o,u)=>{const w=n.index("byPending").getAll(!0);w.onsuccess=()=>{const p=w.result??[];o(p.slice(0,a))},w.onerror=()=>u(w.error)}))}catch{return[]}},Mn=async a=>{if(a.length!==0)try{await Tt("readwrite",n=>new Promise((o,u)=>{let g=a.length;a.forEach(w=>{const p=n.get(w);p.onsuccess=()=>{const I=p.result;if(I){I.pending=!1;const M=n.put(I);M.onsuccess=()=>{g-=1,g===0&&o()},M.onerror=()=>u(M.error)}else g-=1,g===0&&o()},p.onerror=()=>u(p.error)})}))}catch{}},or=async(a,n)=>{const o=await Cn(200);if(o.length===0)return;const u=new Map;o.forEach(g=>{var p;const w=g.personRoleId??n??"";u.has(w)||u.set(w,[]),(p=u.get(w))==null||p.push(g)});for(const[g,w]of u.entries()){const p=w.map(I=>({itemType:I.itemType,itemId:I.itemId,checkType:I.checkType??null,direction:I.direction??null,revisionType:I.revisionType,evalType:I.evalType,correct:I.correct,clientId:I.clientId,clientSequence:I.clientSequence,maskBase64:I.maskBase64??null,payloadHashBase64:I.payloadHashBase64??null,payloadBase64:I.payloadBase64??null,personRoleId:g||null}));try{await Mi({libraryId:a,outcomes:p}),await Mn(w.map(I=>I.id))}catch{}}},Kr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Sn=(a,n)=>{const o=Math.max(a.length,n.length,1),u=Math.abs(a.length-n.length);return Math.max(0,1-u/o)},In=(a,n)=>{const o=new Uint8Array(a.length),u=Sn(a,n);for(let g=0;g<a.length;g+=1){const w=a[g]===(n[g]??"")?128:0,p=a.length-1-g,I=n.length-1-g,M=a[p]===(n[I]??"")?127:0,E=Math.round((w+M)*u);o[g]=Math.max(0,Math.min(255,E))}return o},St=(a,n)=>a===n||(Kr[a]??[]).includes(n)?!0:(Kr[n]??[]).includes(a),Vt=(a,n)=>{const o=new Uint8Array(a.length);if(!a.length)return o;const u=[];for(let w=0;w<=a.length-3;w+=1)u.push({index:w,text:a.slice(w,w+3)});let g=!1;return u.forEach(w=>{for(let p=0;p<=n.length-3;p+=1){const I=n.slice(p,p+3);let M=0;for(let x=0;x<3;x+=1)St(w.text[x],I[x])&&(M+=1);if(M<2)continue;let E=w.index-1,l=p-1;for(;E>=0&&l>=0;){const x=a[E],q=n[l];if(x===q){o[E]=Math.max(o[E],255),E-=1,l-=1,g=!0;continue}if(St(x,q)){o[E]=Math.max(o[E],127),E-=1,l-=1,g=!0;continue}if(E>0&&a[E-1]===q){o[E]=Math.max(o[E],0),E-=1,g=!0;continue}if(l>0&&a[E]===n[l-1]){l-=1,g=!0;continue}break}for(let x=0;x<3;x+=1){const q=w.index+x,J=w.text[x],_=I[x],s=J===_?255:St(J,_)?127:0;o[q]=Math.max(o[q],s),g=!0}let C=w.index+3,m=p+3;for(;C<a.length&&m<n.length;){const x=a[C],q=n[m];if(x===q){o[C]=Math.max(o[C],255),C+=1,m+=1,g=!0;continue}if(St(x,q)){o[C]=Math.max(o[C],127),C+=1,m+=1,g=!0;continue}if(C+1<a.length&&a[C+1]===q){o[C]=Math.max(o[C],0),C+=1,g=!0;continue}if(m+1<n.length&&a[C]===n[m+1]){m+=1,g=!0;continue}break}}}),g?o:In(a,n)},ht=(a,n,o)=>{const u=a.trim().toLowerCase(),g=n.trim().toLowerCase();return Vt(u,g)},mt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),oi=(a,n,o)=>{const u=mt(a),g=mt(n);return Vt(u,g)},wa=a=>a.trim().toLowerCase(),Pn=a=>a==="reverse"?"reverse":"forward",kt=(a,n)=>`${a}|${n}`,Ta=a=>{if(!a)return null;const[n,o]=a.split("|",2);return(n==="forward"||n==="reverse")&&o?{mode:n,fragmentId:o}:{mode:"forward",fragmentId:a}},qt=(a,n)=>{var u;const o=Ta(n);return o?o.fragmentId&&n?(a??null)===n:(((u=Ta(a))==null?void 0:u.mode)??"forward")===o.mode:!0},ba=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},si=(a,n)=>{if((ba(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const u=ba(a.childCheckType),g=ba(a.childDirection),w=ba(n.checkType),p=ba(n.direction);return!(u&&u!==w||g&&g!==p)},Rn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},$n={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},_t=(a,n,o)=>{if(!o||!n.startsWith(a))return n;const u=n.slice(a.length);if(!u)return n;const g=o==="super"?Rn:$n,w=u.split("").map(p=>g[p]??p).join("");return a+w},Ut=(a,n,o)=>{var p,I,M;if(!a)return((p=n[0])==null?void 0:p.key)??null;const u=new Set(n.map(E=>E.key)),g=/\{([^}]+)\}/g;let w;for(;(w=g.exec(a))!==null;){const E=((I=w[1])==null?void 0:I.trim())??"";if(!E)continue;if(u.has(E))return E;const l=o==null?void 0:o[E];if(l&&u.has(l))return l}return((M=n[0])==null?void 0:M.key)??null},pr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const o=n.description??"";if(!o.trim())return[n];const u=Ta(n.direction),g=(u==null?void 0:u.mode)??Pn(n.direction),w=bt(o),p=Object.keys(w.nodes);return p.length===0?[n]:p.map(I=>({...n,checkType:"quote-fragment",direction:kt(g,I)}))});function En({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C,revisionId:m}){const x=vr(),q=`/#/cogita/library/${l}`,J=i.useMemo(()=>new URLSearchParams(x.search),[x.search]),_=Math.max(1,Number(J.get("limit")??20)),s=J.get("mode")??"random",b=i.useMemo(()=>Nr(s),[s]),f=i.useMemo(()=>Jt(b,ti(b,J)),[b,J]),Q=J.get("check")??"exact",A=J.get("reviewer"),v=i.useMemo(()=>a.cogita.library.revision[b.labelKey]??s,[a,s,b]),G=i.useMemo(()=>Q==="exact"?a.cogita.library.revision.checkValue:Q,[a,Q]),[P,ne]=i.useState(a.cogita.library.collections.defaultName),[D,O]=i.useState([]),[ge,me]=i.useState([]),[ve,F]=i.useState("idle"),[ce,c]=i.useState({current:0,total:0}),[ie,re]=i.useState(0),[B,Ce]=i.useState(""),[se,le]=i.useState(null),[ke,Te]=i.useState(null),[Ne,Fe]=i.useState(null),[Me,Qe]=i.useState(null),[_e,Ee]=i.useState([]),[He,la]=i.useState({}),[Pe,W]=i.useState({}),[ae,Ve]=i.useState(null),[Le,pe]=i.useState(null),[Re,Ue]=i.useState(null),[Ae,qe]=i.useState(null),[j,k]=i.useState(null),[Y,t]=i.useState({}),r=i.useRef(0),[h,T]=i.useState(null),K=i.useRef(null),X=i.useRef(null),[te,ee]=i.useState(null),[ue,oe]=i.useState(!1),[ye,ra]=i.useState(null),[Xe,aa]=i.useState([]),[Be,We]=i.useState(null),Oe=i.useRef(null),ea=i.useRef(null),[$a,na]=i.useState(null),[Ea,sa]=i.useState(0),V=i.useRef(null),$e=i.useRef({}),[De,Ke]=i.useState(!1),[Ze,oa]=i.useState({}),[xa,pa]=i.useState([]),ua=i.useRef(new Map),[ma,Ia]=i.useState(new Set),[ya,Je]=i.useState(!1),ia=i.useRef(null),Pa=i.useRef(new Set),La=i.useRef({}),je=D[ie]??null,we=(je==null?void 0:je.checkType)==="translation-match"&&j,ga=i.useRef(new Map),Ca=i.useRef(new Map),at=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?ta(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),Yt=i.useMemo(()=>{var y;return b.id!=="levels"?D.length:((y=Ze.pool)==null?void 0:y.length)??b.getFetchLimit(_,f)},[Ze,f,b,D.length,_]),rt=b.getProgressTotal?b.getProgressTotal(D,Ze,_,f):b.id==="levels"?Math.min(_,Yt):D.length,it=rt?Math.min(ie+1,rt):0,Aa=Math.max(1,Number(f.tries??1)),ka=f.compare??"anchors",_a=Math.max(0,Math.min(100,Number(f.minCorrectness??0))),fa=(f.considerDependencies??"on")==="on",ca=Math.max(0,Math.min(100,Number(f.dependencyThreshold??85))),Ra=d=>{const y=d.slice();for(let S=y.length-1;S>0;S-=1){const N=Math.floor(Math.random()*(S+1));[y[S],y[N]]=[y[N],y[S]]}return y},Ha=d=>d.length?d.reduce((S,N)=>S+N,0)/d.length/255*100:0,Ua=d=>Ha(d)>=_a,nt=async()=>{const d=await Va(),y=new Map,S=new Map,N=new Map;d.forEach($=>{const z=`${$.itemType}:${$.itemId}`,de=Ka($.itemType,$.itemId,$.checkType,$.direction);if(y.has(z)||y.set(z,[]),y.get(z).push($),S.has(de)||S.set(de,[]),S.get(de).push($),$.itemType==="info"&&$.checkType==="quote-fragment"&&$.direction){const he=`${$.itemId}:${$.direction}`;N.has(he)||N.set(he,[]),N.get(he).push($)}});const H=new Map,L=new Map,U=new Map;return y.forEach(($,z)=>H.set(z,Oa($).score)),S.forEach(($,z)=>L.set(z,Oa($).score)),N.forEach(($,z)=>U.set(z,Oa($).score)),{itemKnowness:H,cardKnowness:L,fragmentKnowness:U}},Qt=async d=>{const y=[];let S=null;for(;;){const N=await At({libraryId:l,collectionId:d,limit:200,cursor:S});if(y.push(...N.items),!N.nextCursor)break;S=N.nextCursor}return pr(y)},ft=async(d,y)=>{if(ua.current.has(d))return ua.current.get(d)??0;const S=await Qt(d);if(S.length===0)return ua.current.set(d,0),0;const H=S.reduce((L,U)=>{const $=be(U);return L+(y.get($)??0)},0)/S.length;return ua.current.set(d,H),H},Gt=(d,y)=>{if(!fa||d.cardType!=="info"||d.infoType!=="quote"||d.checkType!=="quote-fragment")return!0;const S=Ta(d.direction);if(!(S!=null&&S.fragmentId))return!0;const N=d.description??"";if(!N.trim())return!0;const L=bt(N).nodes[S.fragmentId];if(!L||!L.leftId&&!L.rightId)return!0;const U=[L.leftId,L.rightId].filter(de=>!!de);if(U.length===0)return!0;const $=U.map(de=>{const he=Ka("info",d.cardId,"quote-fragment",kt(S.mode,de));return y.get(he)??0});return $.reduce((de,he)=>de+he,0)/$.length>=ca},lt=async d=>{const y=Ze,S=d.concat(y.active??[]).concat(y.pool??[]).filter(($,z,de)=>de.findIndex(he=>be(he)===be($))===z);if(!fa){Ia(new Set(S.map(be)));return}const{itemKnowness:N,cardKnowness:H}=await nt(),L=xa.filter($=>ba($.childItemType)==="collection"&&$.childItemId===C&&!ba($.childCheckType)&&!ba($.childDirection)),U=new Set;for(const $ of S){if($.cardType!=="info"){U.add(be($));continue}if(!Gt($,H))continue;const z=xa.filter(xe=>si(xe,$)).concat(L);if(z.length===0){U.add(be($));continue}let de=0;for(const xe of z)if(ba(xe.parentItemType)==="collection")de+=await ft(xe.parentItemId,H);else if(ba(xe.parentCheckType)||ba(xe.parentDirection)){const fe=ba(xe.parentCheckType),Se=ba(xe.parentDirection),Ie=Ka(xe.parentItemType,xe.parentItemId,fe,Se);de+=H.get(Ie)??0}else{const fe=`${xe.parentItemType}:${xe.parentItemId}`;de+=N.get(fe)??0}de/z.length>=ca&&U.add(be($))}Ia(U)},Xt=d=>{for(let y=d;y<D.length;y+=1){const S=D[y];if(S&&(!fa||S.cardType!=="info"||ma.has(be(S))))return y}return-1},Ma=d=>!fa||d.cardType!=="info"||ma.has(be(d)),ot=d=>{if(b.id!=="temporal"&&b.id!=="levels")return null;const y=Ze,S=(y.active??[]).concat(y.pool??[]),N=new Set;for(const H of S){const L=be(H);if(!(N.has(L)||d.has(L))&&(N.add(L),Ma(H)))return H}return null},Fa=i.useMemo(()=>{if(b.id!=="levels")return null;const d=Ze,y=d.pool??[],S=d.active??[],N=d.levelMap??{},H=Math.max(1,Number(f.levels??1)),L=Array.from({length:H},()=>0),U=new Set(S.map(he=>be(he)));y.forEach(he=>{const xe=Math.min(H,Math.max(1,N[be(he)]??1));L[xe-1]+=1});const $=y.length||1,z=L.map(he=>he/$*100),de=je?N[be(je)]??1:null;return{counts:L,percentages:z,currentLevel:de,levelsCount:H,activeCount:S.length,poolCount:y.length,activeSet:U}},[Ze,f,b,je]),va=i.useMemo(()=>{if(b.id!=="temporal")return null;const d=Ze,y=d.pool??[],S=d.active??[],N=d.knownessMap??{},H=new Set(d.unknownSet??[]);let L=0;y.forEach(z=>{(N[be(z)]??0)>1&&(L+=1)});const U=H.size,$=S.map(z=>({id:be(z),value:H.has(be(z))?0:Math.max(0,Math.min(1,N[be(z)]??0))}));return{knownCount:L,unknownCount:U,dots:$}},[Ze,b]),st=i.useMemo(()=>{if(!fa)return 0;const d=Ze;return D.concat(d.active??[]).concat(d.pool??[]).filter((S,N,H)=>H.findIndex(L=>be(L)===be(S))===N).filter(S=>S.cardType==="info"&&!ma.has(be(S))).length},[fa,Ze,D,ma]);i.useEffect(()=>{if(!fa||ve!=="ready")return;const d=Ze,S=D.concat(d.active??[]).concat(d.pool??[]).filter((L,U,$)=>$.findIndex(z=>be(z)===be(L))===U).filter(L=>L.cardType!=="info"||ma.has(be(L))).length,N=Oe.current;if(Oe.current=S,N===null||S<=N)return;const H=S-N;We(`New card available (+${H})`),ea.current&&window.clearTimeout(ea.current),ea.current=window.setTimeout(()=>We(null),2200)},[fa,ve,Ze,D,ma]),i.useEffect(()=>()=>{ea.current&&window.clearTimeout(ea.current)},[]);const ja=(d,y)=>{const S=b.applyOutcome({queue:D,meta:Ze},je,_,f,{correct:d,correctness:y,createdUtc:new Date().toISOString()});O(S.queue),oa(S.meta);const N=S.queue[ie+1];N&&xt(N,ie+1)};i.useEffect(()=>{Wt(l,C).then(d=>ne(d.name)).catch(()=>ne(a.cogita.library.collections.defaultName))},[l,C]),i.useEffect(()=>{Hr({libraryId:l,type:"language"}).then(d=>me(d)).catch(()=>me([]))},[l]),i.useEffect(()=>{zr({libraryId:l}).then(d=>pa(d.items??[])).catch(()=>pa([]))},[l]),i.useEffect(()=>{or(l,A)},[l,A]),i.useEffect(()=>{lt(D)},[D,xa,fa,ca,C]),i.useEffect(()=>{if(!je||!fa){Je(!1);return}if(je.cardType!=="info"||ma.has(be(je))){Je(!1);return}const d=Xt(ie+1);if(d>=0){Je(!1),re(d);return}if(b.id==="temporal"||b.id==="levels"){const y=D.slice(0,ie+1),S=D.slice(ie+1).filter(Ma),N=y.concat(S),H=new Set(N.map(be)),L=ot(H);if(L){const $=be(L);H.has($)||(N.push(L),H.add($),oa(z=>{const de=z,he=new Set(de.queued??[]);return he.add($),{...de,queued:he}}))}const U=N.findIndex(($,z)=>z!==ie&&Ma($));if(U>=0){O(N),re(U),Je(!1);return}}Je(!0)},[je,ma,fa,ie,D,Ze,b.id]),i.useEffect(()=>{let d=!0;return(async()=>{F("loading"),c({current:0,total:b.id==="levels"?0:b.getFetchLimit(_,f)});try{const S=[];let N=null,H=null;do{const xe=await At({libraryId:l,collectionId:C,limit:300,cursor:N});if(S.push(...xe.items),(b.id==="levels"||b.id==="temporal")&&xe.total&&(H=xe.total),c(fe=>({current:S.length,total:fe.total||xe.total||b.getFetchLimit(_,f)})),N=xe.nextCursor??null,H!==null&&S.length>=H||b.id!=="levels"&&b.id!=="temporal"&&S.length>=b.getFetchLimit(_,f))break}while(N);if(!d)return;const L=pr(S);let U;if(b.id==="levels"){const xe=Math.max(1,Number(f.levels??1)),Se=(await Va()).reduce((Ie,Ye)=>{const Ge=Ka(Ye.itemType,Ye.itemId,Ye.checkType,Ye.direction);return Ie[Ge]||(Ie[Ge]=[]),Ie[Ge].push(Ye),Ie},{});U={},L.forEach(Ie=>{const Ye=be(Ie),Ge=Se[Ye]??[],ha=Ge.length>0?Oa(Ge).score:0,Xa=Math.max(1,Math.min(xe,Math.ceil(ha/100*xe)));U[Ye]=Xa})}let $=null,z=null,de=null;if(b.id==="temporal"){const xe=await Va(),fe=new Set(L.map(Ye=>be(Ye))),Se=xe.reduce((Ye,Ge)=>{const ha=Ka(Ge.itemType,Ge.itemId,Ge.checkType,Ge.direction);return fe.has(ha)&&(Ye[ha]||(Ye[ha]=[]),Ye[ha].push(Ge)),Ye},{});$={},z=new Set,de={};const Ie=Date.now();L.forEach(Ye=>{const Ge=be(Ye),ha=Se[Ge]??[];if(ha.length===0){$[Ge]=0,z.add(Ge),de[Ge]=[];return}const Xa=wr(ha);de[Ge]=Xa;const di=zt(Xa,Ie);$[Ge]=di.knowness})}const he=b.id==="levels"?Tr(L,_,f,U):b.id==="temporal"?kr(L,_,f,$??{},z??new Set,de??{}):b.prepare(L,_,f);O(he.queue),oa(he.meta),re(0),F("ready"),c(xe=>({current:Math.min(xe.current,xe.total),total:xe.total}))}catch{d&&F("error")}})(),()=>{d=!1}},[l,C,_,f,b,A]),i.useEffect(()=>{if(Ce(""),le(null),na(null),sa(0),Ee([]),la({}),W({}),pe(null),Ue(null),qe(null),oe(!1),Ke(!1),ee(null),k(null),t({}),!je){Te(null),Fe(null),Ve(null),ra(null);return}je.cardType==="info"&&je.infoType==="computed"&&Te(a.cogita.library.revision.loadingComputed);let d=!0;return xt(je,ie).then(y=>{!d||!y||(Te(y.prompt),Fe(y.expectedAnswer),Ee(y.computedExpected),la(y.computedAnswers),Ve(y.computedValues),pe(y.answerTemplate),Ue(y.outputVariables),qe(y.variableValues))}),()=>{d=!1}},[je,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){ia.current=null,Pa.current=new Set,Qe(null);return}const d=je.description??"",y=(je.label??"").trim(),S=y.replace(/\s+/g," ").trim(),N=d.replace(/\s+/g," ").trim(),H=S&&S!==N?y:a.cogita.library.infoTypes.quote;if(!d){Qe(null),Fe(null);return}const L=bt(d);ia.current=L,Te(H);let U=!0;return nt().then(({fragmentKnowness:$})=>{if(!U)return;const z=getQuoteMode(je.direction),de=new Set,he={};$.forEach((Se,Ie)=>{const[Ye,Ge]=Ie.split(":",2);if(Ye!==je.cardId)return;const ha=Ta(Ge);if(!ha||ha.mode!==z)return;const Xa=ha.fragmentId;he[Xa]=Se,Se>=ca&&de.add(Xa)}),Pa.current=de,La.current=he;const xe=Ta(je.direction);if(xe!=null&&xe.fragmentId&&L.nodes[xe.fragmentId]){Da(L,xe.fragmentId,H);return}const fe=gt(L,de,he,ca,fa,je.direction);Da(L,(fe==null?void 0:fe.id)??null,H)}).catch(()=>{Pa.current=new Set,La.current={};const $=Ta(je.direction);if($!=null&&$.fragmentId&&L.nodes[$.fragmentId]){Da(L,$.fragmentId,H);return}const z=gt(L,Pa.current,{},ca,fa,je.direction);Da(L,(z==null?void 0:z.id)??null,H)}),()=>{U=!1}},[je,a,fa,ca]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){k(null),t({});return}const S=(Ze.pool??Ze.active??D).filter($=>$.cardType==="vocab"&&$.checkType==="translation-match").filter(($,z,de)=>de.findIndex(he=>he.cardId===$.cardId)===z);S.some($=>$.cardId===je.cardId)||S.unshift(je);const H=Ra(S).slice(0,6).map($=>{const z=$.label.split("↔").map(xe=>xe.trim()).filter(Boolean);if(z.length<2)return null;const de=`${$.cardId}:L`,he=`${$.cardId}:R`;return{cardId:$.cardId,leftId:de,rightId:he,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),L=H.map($=>$.leftId),U=Ra(H.map($=>$.rightId));k({pairs:H,leftOrder:L,rightOrder:U,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,D,Ze]),i.useEffect(()=>()=>{K.current&&window.clearTimeout(K.current),X.current&&window.clearTimeout(X.current)},[]);const Ja=i.useRef(null);i.useEffect(()=>{if(!je)return;const d=be(je),y=typeof document<"u"?document.activeElement:null;if(Ja.current===d&&y&&(y.tagName==="INPUT"||y.tagName==="TEXTAREA"))return;let S=0;const N=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(_e.length>0){const L=Ut(Le,_e,Re),U=L?$e.current[L]:null;if(U&&(U.focus(),document.activeElement===U)){Ja.current=d;return}}if(V.current&&(V.current.focus(),document.activeElement===V.current)){Ja.current=d;return}}else if(je.cardType==="vocab"&&V.current&&(V.current.focus(),document.activeElement===V.current)){Ja.current=d;return}S<6&&(S+=1,window.setTimeout(N,40))}},H=window.setTimeout(N,40);return()=>window.clearTimeout(H)},[je,_e,Le,Re]),i.useEffect(()=>{if(!De)return;const d=y=>{y.key==="Enter"&&(y.preventDefault(),dt())};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[De]);const Ya=d=>{aa(d),ra(Oa(d))};i.useEffect(()=>{if(!je){ra(null),aa([]);return}const d=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Va().then(y=>{const S=y.filter(N=>N.itemType==="info"&&N.itemId===je.cardId&&N.checkType==="quote-fragment"&&qt(N.direction,je.direction));Ya(S)}).catch(()=>{ra(null),aa([])});return}Ot(d,je.cardId,je.checkType,je.direction).then(y=>Ya(y)).catch(()=>{ra(null),aa([])})},[l,je,A]);const Nt=(d,y,S,N)=>{if(d==="info"&&S==="quote-fragment"){Va().then(H=>{const L=H.filter(U=>U.itemType==="info"&&U.itemId===y&&U.checkType==="quote-fragment"&&qt(U.direction,N));Ya(L)}).catch(()=>{ra(null),aa([])});return}Ot(d,y,S,N).then(H=>Ya(H)).catch(()=>{ra(null),aa([])})},Lt=(d,y,S)=>{var U;const N=((U=S.pairs.find($=>$.leftId===d))==null?void 0:U.rightId)??null;if(!N)return S;const H=N===y;t($=>({...$,[d]:H?"correct":"incorrect"})),K.current&&window.clearTimeout(K.current),X.current&&window.clearTimeout(X.current),r.current+=1;const L={kind:H?"correct":"incorrect",tick:r.current};if(T(null),K.current=window.setTimeout(()=>T(L),0),X.current=window.setTimeout(()=>T(null),420),H){const $={...S.locked,[d]:!0};return Object.keys($).length>=S.pairs.length?(le("correct"),Ke(!0)):le("correct"),{...S,selection:{...S.selection,[d]:y},activeLeft:null,activeRight:null,locked:$}}return le("incorrect"),{...S,activeLeft:null,activeRight:null}},ct=d=>{k(y=>!y||y.locked[d]?y:y.activeRight?Lt(d,y.activeRight,y):{...y,activeLeft:y.activeLeft===d?null:d})},Ba=d=>{k(y=>y&&(y.activeLeft?Lt(y.activeLeft,d,y):{...y,activeRight:y.activeRight===d?null:d}))},dt=()=>{var d;if(je&&je.cardType==="info"&&je.infoType==="quote"&&ia.current&&Me&&!((d=Ta(je.direction))!=null&&d.fragmentId)){const y=gt(ia.current,Pa.current,La.current,ca,fa,je.direction,Me.fragmentId);if(y){le(null),Ce(""),oe(!1),W({}),Ke(!1),na(null),sa(0),Da(ia.current,y.id,Me.title);return}}le(null),Ce(""),oe(!1),W({}),Ke(!1),na(null),sa(0),re(y=>Math.min(y+1,D.length))},Sa=d=>{if(!je)return;const y=d.expected??null,S=d.answer??"";let N=y??"",H=S;if(!y&&d.expectedMap&&d.answerMap){const xe=Object.keys(d.expectedMap).sort((fe,Se)=>fe.localeCompare(Se));N=xe.map(fe=>{var Se;return((Se=d.expectedMap)==null?void 0:Se[fe])??""}).join("|"),H=xe.map(fe=>{var Se;return((Se=d.answerMap)==null?void 0:Se[fe])??""}).join("|")}const L=N?ht(N,H,ka):new Uint8Array,U={revisionType:b.id,evalType:d.evalType,direction:d.direction,prompt:ke??"",expected:y,answer:S,expectedAnswers:d.expectedMap??null,answers:d.answerMap??null,correct:d.correct,maskBase64:L.length?za(L):null,values:ae??null,checkMode:Q,compareMode:ka,minCorrectness:_a},$=new TextEncoder().encode(JSON.stringify(U)),z=je.cardType==="info"?"info":"connection",de=d.overrideCheckType??je.checkType??null,he=d.overrideDirection??je.direction??null;Kt({itemType:z,itemId:je.cardId,checkType:de,direction:he,revisionType:b.id,evalType:d.evalType,correct:d.correct,maskBase64:L.length?za(L):null,payloadBase64:za($),personRoleId:A??null}).then(()=>{Nt(z,je.cardId,de,he),lt(D),or(l,A)}).catch(()=>{})},Qa=(d,y)=>{const S=ga.current.get(y);if(S)return Promise.resolve(S);const N=Ca.current.get(y);if(N)return N;const H=et({libraryId:l,infoId:d}).then(L=>{var xe,fe;const U=L.payload,$=((xe=U.definition)==null?void 0:xe.graph)??null,z="",de=((fe=U.definition)==null?void 0:fe.answerTemplate)??"",he=jr($,z,de);if(he){const Ie={sample:Xr(he),answerTemplate:de||null};return ga.current.set(y,Ie),Ie}return hr({libraryId:l,infoId:d}).then(Se=>{const Ie={sample:Se,answerTemplate:null};return ga.current.set(y,Ie),Ie})}).catch(()=>hr({libraryId:l,infoId:d}).then(L=>{const U={sample:L,answerTemplate:null};return ga.current.set(y,U),U}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Ca.current.delete(y)});return Ca.current.set(y,H),H},xt=(d,y)=>{var $;const S=`${be(d)}:${y}`,N=at.current.get(S);if(N)return Promise.resolve(N);const H=tt.current.get(S);if(H)return H;const L=z=>(at.current.set(S,z),z);let U;if(d.cardType==="vocab"){if(d.checkType==="translation-match")return U=Promise.resolve(L({prompt:d.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),U;const z=d.label.split("↔").map(de=>de.trim()).filter(Boolean);if(z.length>=2){const he=(d.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",xe=he?z[0]:z[1],fe=he?z[1]:z[0];U=Promise.resolve(L({prompt:xe,expectedAnswer:fe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else U=Promise.resolve(L({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(d.cardType==="info"&&d.infoType==="word"){const z=($=d.description)!=null&&$.startsWith("Language: ")?d.description.replace("Language: ",""):null;U=Promise.resolve(L({prompt:d.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else d.cardType==="info"&&d.infoType==="computed"?U=Qa(d.cardId,S).then(z=>{var Se,Ie;if(!z.sample)return L({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const de=z.sample,he=de.expectedAnswers?Object.entries(de.expectedAnswers).map(([Ye,Ge])=>({key:Ye,expected:Ge})):[],xe=he.reduce((Ye,Ge)=>(Ye[Ge.key]="",Ye),{}),fe=de.expectedAnswerIsSentence&&((Se=de.expectedAnswer)==null?void 0:Se.trim())||null;return L({prompt:de.prompt,expectedAnswer:he.length>0?fe:((Ie=de.expectedAnswer)==null?void 0:Ie.trim())||null,computedExpected:he,computedAnswers:xe,computedValues:de.values??null,answerTemplate:z.answerTemplate,outputVariables:de.outputVariables??null,variableValues:de.variableValues??null})}).catch(()=>L({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{tt.current.delete(S)}):U=Promise.resolve(L({prompt:d.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return tt.current.set(S,U),U},Da=(d,y,S)=>{const N=Object.keys(d.nodes).length,H=Pa.current.size;if(!y){Qe({title:S,before:d.text,after:"",fragmentId:null,total:N,completed:H}),Fe(null),Ke(!0);return}const L=d.nodes[y];if(!L)return;const U=Zr(d.text,L);Qe({title:S,before:U.before,after:U.after,fragmentId:L.id,total:N,completed:H}),Fe(U.fragment),Ke(!1)},Ct=()=>{const d=ia.current;d&&Qe(y=>y&&{...y,total:Object.keys(d.nodes).length,completed:Pa.current.size})},ut=()=>{const d=D[ie+1];d&&xt(d,ie+1)},Mt=()=>{if(ut(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&j){if(j.pairs.length===0){le("incorrect"),Ke(!0);return}const L=j.pairs.reduce((fe,Se)=>(fe[Se.rightId]=Se.rightLabel,fe),{});let U=0;const $={};j.pairs.forEach(fe=>{const Ie=j.selection[fe.leftId]===fe.rightId;$[fe.leftId]=Ie?"correct":"incorrect",Ie&&(U+=1)});const z=j.pairs.length||1,de=U/z,he=U===j.pairs.length;t(fe=>({...fe,...$})),he?(le("correct"),Ke(!0),sa(0)):(le("incorrect"),Ke(!1),sa(fe=>{const Se=fe+1;return Se>=Aa&&(oe(!0),Ke(!0),k(Ie=>{if(!Ie)return Ie;const Ye=Ie.pairs.reduce((Ge,ha)=>(Ge[ha.leftId]=ha.rightId,Ge),{});return{...Ie,selection:Ye}})),Se})),ja(he,de);const xe="connection";Promise.all(j.pairs.map(fe=>{const Se=j.selection[fe.leftId]??null,Ie=Se?L[Se]:"",Ye={left:fe.leftLabel,expected:fe.rightLabel,answer:Ie,checkType:"translation-match"},Ge=new TextEncoder().encode(JSON.stringify(Ye));return Kt({itemType:xe,itemId:fe.cardId,checkType:"translation-match",direction:null,revisionType:b.id,evalType:"translation-match",correct:Se===fe.rightId,maskBase64:null,payloadBase64:za(Ge),personRoleId:A??null})})).then(()=>{Nt(xe,je.cardId,je.checkType,je.direction),or(l,A)}).catch(()=>{});return}if(_e.length>0){const L=_e.reduce(($,z)=>{const de=He[z.key]??"";return $[z.key]=wa(de)===wa(z.expected)?"correct":"incorrect",$},{});_e.every(({key:$,expected:z})=>{const de=He[$]??"";return Q==="exact"&&wa(de)===wa(z)})?(le("correct"),W(L),Ke(!0),sa(0),ja(!0,1),Sa({correct:!0,direction:ke?`${ke} -> computed`:"computed",expectedMap:_e.reduce(($,z)=>($[z.key]=z.expected,$),{}),answerMap:He,evalType:"computed"})):(le("incorrect"),W(L),Ke(!1),sa($=>{const z=$+1;return z>=Aa&&Z&&(oe(!0),Ke(!0)),z}),ja(!1,0),window.setTimeout(()=>{var z;const $=Ut(Le,_e,Re);$&&$e.current[$]&&((z=$e.current[$])==null||z.focus())},40),Sa({correct:!1,direction:ke?`${ke} -> computed`:"computed",expectedMap:_e.reduce(($,z)=>($[z.key]=z.expected,$),{}),answerMap:He,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Me!=null&&Me.fragmentId)){if(!Ne)return;const L=Ta(je.direction),U=(L==null?void 0:L.mode)??getQuoteMode(je.direction),$=L!=null&&L.fragmentId&&je.direction?je.direction:kt(U,Me.fragmentId),z=oi(Ne,B,ka),de=Q==="exact"&&mt(B)===mt(Ne),he=Ua(z),xe=de||he,fe=Ha(z);xe?(La.current[Me.fragmentId]=Math.max(La.current[Me.fragmentId]??0,fe),(La.current[Me.fragmentId]??0)>=ca&&Pa.current.add(Me.fragmentId),Ct(),le("correct"),W({}),Ke(!0),na(z),sa(0),fe<100&&Aa<=1&&oe(!0),ja(!0,fe/100),Sa({correct:!0,direction:`quote:${Me.fragmentId}`,expected:Ne,answer:B,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:$})):(le("incorrect"),W({}),Ke(!1),na(z),sa(Se=>{const Ie=Se+1;return Ie>=Aa&&Z&&(oe(!0),Ke(!0)),Ie}),ja(!1,fe/100),window.setTimeout(()=>{var Se;return(Se=V.current)==null?void 0:Se.focus()},40),Sa({correct:!1,direction:`quote:${Me.fragmentId}`,expected:Ne,answer:B,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:$}));return}if(!Ne)return;const d=ht(Ne,B,ka),y=Q==="exact"&&wa(B)===wa(Ne),S=Ua(d),N=y||S,H=Ha(d);N?(le("correct"),W({}),Ke(!0),na(d),sa(0),H<100&&Aa<=1&&oe(!0),ja(!0,H/100),Sa({correct:!0,direction:ke?`${ke} -> ${Ne}`:null,expected:Ne,answer:B,evalType:"text"})):(le("incorrect"),W({}),Ke(!1),na(d),sa(L=>{const U=L+1;return U>=Aa&&Z&&(oe(!0),Ke(!0)),U}),ja(!1,H/100),window.setTimeout(()=>{var L;return(L=V.current)==null?void 0:L.focus()},40),Sa({correct:!1,direction:ke?`${ke} -> ${Ne}`:null,expected:Ne,answer:B,evalType:"text"}))},Zt=d=>{if(ut(),!Ne)return;const y=ht(Ne,d,ka),S=wa(d)===wa(Ne),N=Ua(y),H=S||N,L=Ha(y);H?(le("correct"),W({}),Ke(!0),na(y),sa(0),L<100&&Aa<=1&&oe(!0),ja(!0,L/100),Sa({correct:!0,direction:"word->language",expected:Ne,answer:d,evalType:"language-select"})):(le("incorrect"),W({}),Ke(!1),na(y),sa(U=>{const $=U+1;return $>=Aa&&Z&&(oe(!0),Ke(!0)),$}),ja(!1,L/100),Sa({correct:!1,direction:"word->language",expected:Ne,answer:d,evalType:"language-select"}))},er=()=>{ut(),le("correct"),Ke(!0),sa(0),ja(!0,1),Ne&&Sa({correct:!0,direction:"manual",expected:Ne,answer:B,evalType:"manual"})},ar=()=>{if(ja(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){le(null),Ce(""),oe(!1),W({}),Ke(!1),na(null),sa(0),re(d=>Math.min(d+1,D.length));return}dt()};i.useEffect(()=>{ut()},[ie,D]);const Ga=d=>{var S;if(d.key!=="Enter")return;if(d.preventDefault(),d.stopPropagation(),De){dt();return}const y=_e.find(N=>!(He[N.key]??"").trim());if(y){(S=$e.current[y.key])==null||S.focus();return}Mt()},R=a.cogita.library.revision.revealModeAfterIncorrect,Z=_e.length>0||!!Ne;return e.jsxs(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:[ve==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ce.total?Math.min(100,Math.max(0,ce.current/ce.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ce.total?`${Math.min(ce.current,ce.total)} / ${ce.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:P}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",v).replace("{check}",G)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:q,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${q}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${q}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ye?`${ye.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Fa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Fa.currentLevel??"-"," / ",Fa.levelsCount]}):null,ye?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(ye.correct)).replace("{total}",String(ye.total))}),ye.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(ye.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:Xe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Be?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Be})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":h?`${h.kind}-${h.tick}`:we?"idle":se??"idle",children:je?e.jsx(e.Fragment,{children:ya?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:je,currentTypeLabel:pt,prompt:ke,languages:ge,answer:B,onAnswerChange:d=>Ce(y=>_t(y,d,te)),computedExpected:_e,computedAnswers:He,onComputedAnswerChange:(d,y)=>la(S=>({...S,[d]:_t(S[d]??"",y,te)})),answerTemplate:Le,outputVariables:Re,variableValues:Ae,computedFieldFeedback:Pe,feedback:se,canAdvance:De,quoteContext:Me,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:ar,onLanguageSelect:Zt,onMarkReviewed:er,onAdvance:dt,showCorrectAnswer:ue,setShowCorrectAnswer:oe,onRevealCorrect:()=>Ke(!0),answerMask:$a,expectedAnswer:Ne,hasExpectedAnswer:Z,handleComputedKeyDown:Ga,answerInputRef:V,computedInputRefs:$e,scriptMode:te,setScriptMode:ee,matchPairs:j==null?void 0:j.pairs,matchLeftOrder:j==null?void 0:j.leftOrder,matchRightOrder:j==null?void 0:j.rightOrder,matchSelection:j==null?void 0:j.selection,matchActiveLeft:j==null?void 0:j.activeLeft,matchActiveRight:j==null?void 0:j.activeRight,matchFeedback:Y,onMatchLeftSelect:ct,onMatchRightSelect:Ba})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${q}/collections/${C}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:rt?`${it} / ${rt}`:a.cogita.library.revision.progressUnlimited}),ve==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ve==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ve==="ready"&&D.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:R}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Aa]})]})]}),Fa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Fa.activeCount," / ",Fa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Fa.counts.map((d,y)=>{const S=y+1,N=Fa.currentLevel===S,H=Fa.percentages[y]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":N,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:S}),e.jsx("strong",{children:d})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,H))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[H.toFixed(1),"%"]})]},`level-${S}`)})})]}):null,va?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:va.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:va.dots.map(d=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,d.value*100))}%`,background:`rgba(${Math.round(255*(1-d.value))}, ${Math.round(200*d.value)}, 80, 0.9)`}},d.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:va.knownCount})]})]}):null,fa?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:st})]})}):null]})]})]})})})]})]})}const sr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],An={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Fn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Bn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Dn({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:l,collectionId:C}){const[m,x]=i.useState(""),[q,J,_]=Or([]),[s,b,f]=Vr([]),[Q,A]=i.useState(null),[v,G]=i.useState(null),[P,ne]=i.useState(null),D=`/#/cogita/library/${l}`;i.useEffect(()=>{Wt(l,C).then(c=>x(c.name)).catch(()=>x(a.cogita.library.collections.defaultName))},[l,C,a]),i.useEffect(()=>{Si({libraryId:l,collectionId:C}).then(c=>{if(!c.graphId||c.graphId==="00000000-0000-0000-0000-000000000000"){J([]),b([]);return}const ie=c.nodes.map(B=>{var ke;const Ce=B.payload??{},se=Ce.position??{x:120,y:120},le=Ce.params??{};return{id:B.nodeId,type:"default",position:se,data:{nodeType:B.nodeType,label:((ke=sr.find(Te=>Te.type===B.nodeType))==null?void 0:ke.label)??B.nodeType,params:le}}}),re=c.edges.map(B=>({id:B.edgeId,source:B.fromNodeId,target:B.toNodeId,sourceHandle:B.fromPort??void 0,targetHandle:B.toPort??void 0}));J(ie),b(re)}).catch(()=>{J([]),b([])})},[l,C,b,J]);const O=i.useMemo(()=>q.find(c=>c.id===Q)??null,[q,Q]),ge=c=>{var Ce;const ie=crypto.randomUUID(),re=((Ce=sr.find(se=>se.type===c))==null?void 0:Ce.label)??c,B={...An[c]};J(se=>[...se,{id:ie,type:"default",position:{x:120+se.length*40,y:120+se.length*40},data:{nodeType:c,label:re,params:B}}]),A(ie)},me=i.useCallback(c=>{b(ie=>Rt({...c,id:crypto.randomUUID()},ie))},[b]),ve=async()=>{G(null);try{await Pi({libraryId:l,collectionId:C,nodes:q.map(c=>({nodeId:c.id,nodeType:c.data.nodeType,payload:{position:c.position,params:c.data.params}})),edges:s.map(c=>({edgeId:c.id,fromNodeId:c.source,fromPort:c.sourceHandle??null,toNodeId:c.target,toPort:c.targetHandle??null}))}),G(a.cogita.library.graph.saveSuccess)}catch{G(a.cogita.library.graph.saveFail)}},F=async()=>{try{const c=await Ii({libraryId:l,collectionId:C});ne(c)}catch{ne(null)}},ce=c=>{O&&J(ie=>ie.map(re=>re.id===O.id?{...re,data:{...re.data,params:c}}:re))};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${D}/collections/${C}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:F,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ve,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:sr.map(c=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ge(c.type),children:c.label},c.type))}),v?e.jsx("p",{className:"cogita-help",children:v}):null,P&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(P.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(P.connections)).replace("{infos}",String(P.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(fr,{nodes:q,edges:s,onNodesChange:_,onEdgesChange:f,onConnect:me,onNodeClick:(c,ie)=>A(ie.id),fitView:!0,children:[e.jsx(xr,{color:"rgba(120,160,200,0.2)"}),e.jsx(yr,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),O?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:O.data.label}),O.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:O.data.params.tagId?{id:O.data.params.tagId,label:O.data.params.tagLabel??"",infoType:"topic"}:null,onChange:c=>ce({...O.data.params,tagId:(c==null?void 0:c.id)??null,tagLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:O.data.params.scope??"any",onChange:c=>ce({...O.data.params,scope:c.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),O.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:O.data.params.languageId?{id:O.data.params.languageId,label:O.data.params.languageLabel??"",infoType:"language"}:null,onChange:c=>ce({...O.data.params,languageId:(c==null?void 0:c.id)??null,languageLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:O.data.params.scope??"any",onChange:c=>ce({...O.data.params,scope:c.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),O.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:O.data.params.infoType??"word",onChange:c=>ce({...O.data.params,infoType:c.target.value}),children:Bn.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsx(ze,{libraryId:l,infoType:O.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:O.data.params.infoId?{id:O.data.params.infoId,label:O.data.params.infoLabel??"",infoType:O.data.params.infoType??"word"}:null,onChange:c=>ce({...O.data.params,infoId:(c==null?void 0:c.id)??null,infoLabel:(c==null?void 0:c.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),O.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:O.data.params.connectionType??"translation",onChange:c=>ce({...O.data.params,connectionType:c.target.value}),children:Fn.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:O.data.params.connectionId??"",onChange:c=>ce({...O.data.params,connectionId:c.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(O.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const cr="cogita.preferences",ci=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],dr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},ur=["settings","run","shared"];function Kn(a,n=""){const o=a.split("/").filter(Boolean);if(o[0]!=="cogita"||o[1]!=="library")return{};const u=o[2];if(!u)return{};if(!o[3])return{libraryId:u,target:"library_overview"};const g=new URLSearchParams(n),w=g.get("revisionId")??void 0,p=g.get("collectionAction"),I=g.get("libraryAction");if(o[3]==="list")return{libraryId:u,target:I==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:w,libraryAction:I==="new-info"?"new-info":void 0};if(o[3]==="detail"||o[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:o[3],revisionId:w};if(o[3]==="new"||o[3]==="add")return{libraryId:u,target:"new_card",revisionId:w,libraryAction:"new-info"};if(o[3]==="edit")return{libraryId:u,target:"new_card",revisionId:w,infoId:o[4]};if(o[3]==="shared-revisions")return{libraryId:u,target:"all_collections",revisionId:w};if(o[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(o[3]==="transfer")return{libraryId:u,target:"transfer"};if(o[3]==="storyboards")return o[4]==="new"?{libraryId:u,target:"new_storyboard"}:{libraryId:u,target:"storyboards"};if(o[3]==="texts")return o[4]==="new"?{libraryId:u,target:"new_text"}:{libraryId:u,target:"texts"};if(o[3]!=="collections")return{libraryId:u,target:"library_overview"};if(o[4]==="new")return{libraryId:u,target:"new_collection",revisionId:w};const M=o[4];return M?o[5]==="graph"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"graph"}:o[5]==="shared-revisions"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"shared"}:o[5]==="revision"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:o[6]==="run"?"run":"settings"}:p==="new-revision"?{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"new"}:{libraryId:u,target:"all_collections",collectionId:M,revisionId:w,revisionView:"detail"}:p==="new-collection"?{libraryId:u,target:"new_collection",collectionAction:"new-collection"}:{libraryId:u,target:"all_collections"}}function gr(a,n="library_overview",o,u,g,w){const p=(I,M)=>{const E=new URLSearchParams;M!=null&&M.revisionId&&E.set("revisionId",M.revisionId),M!=null&&M.collectionAction&&E.set("collectionAction",M.collectionAction),M!=null&&M.libraryAction&&E.set("libraryAction",M.libraryAction);const l=E.toString();return l?`${I}?${l}`:I};return a?n==="library_overview"?p(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?p(`/cogita/library/${a}/list`,{revisionId:g}):n==="new_card"?w?p(`/cogita/library/${a}/edit/${w}`,{revisionId:g}):p(`/cogita/library/${a}/list`,{revisionId:g,libraryAction:"new-info"}):n==="all_collections"?o?u==="graph"?p(`/cogita/library/${a}/collections/${o}/graph`,{revisionId:g}):u==="settings"?p(`/cogita/library/${a}/collections/${o}/revision`,{revisionId:g}):u==="run"?p(`/cogita/library/${a}/collections/${o}/revision/run`,{revisionId:g}):u==="shared"?p(`/cogita/library/${a}/collections/${o}/shared-revisions`,{revisionId:g}):u==="new"?p(`/cogita/library/${a}/collections/${o}`,{revisionId:g,collectionAction:"new-revision"}):p(`/cogita/library/${a}/collections/${o}`,{revisionId:g}):p(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?p(`/cogita/library/${a}/collections`,{revisionId:g,collectionAction:"new-collection"}):n==="transfer"?p(`/cogita/library/${a}/transfer`,{revisionId:g}):n==="storyboards"?p(`/cogita/library/${a}/storyboards`,{revisionId:g}):n==="new_storyboard"?p(`/cogita/library/${a}/storyboards/new`,{revisionId:g}):n==="texts"?p(`/cogita/library/${a}/texts`,{revisionId:g}):n==="new_text"?p(`/cogita/library/${a}/texts/new`,{revisionId:g}):n==="dependencies"?p(`/cogita/library/${a}/dependencies`,{revisionId:g}):p(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function It(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function On(a){return typeof a=="string"&&ci.includes(a)}function Vn(a,n){var I;if(!a.length)return null;const o=a.filter(M=>n.has(M.roleId)),u=o.length>0?o:a,g=u.map(M=>{var l,C;const E=((C=(l=M.fields.find(m=>m.fieldType==="role_kind"))==null?void 0:l.plainValue)==null?void 0:C.toLowerCase())??"";return{roleId:M.roleId,roleKind:E}}),w=g.find(M=>M.roleKind.includes("master"));if(w)return w.roleId;const p=g.find(M=>M.roleKind.includes("account")||M.roleKind.includes("user"));return p?p.roleId:((I=u[0])==null?void 0:I.roleId)??null}function qn(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function _n({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E}){const l=hi(),C=vr(),m=i.useMemo(()=>Kn(C.pathname,C.search),[C.pathname,C.search]),x=a.cogita.workspace,[q,J]=i.useState([]),[_,s]=i.useState([]),[b,f]=i.useState([]),[Q,A]=i.useState(void 0),[v,G]=i.useState("library_overview"),[P,ne]=i.useState(void 0),[D,O]=i.useState(void 0),[ge,me]=i.useState("detail"),[ve,F]=i.useState(void 0),[ce,c]=i.useState(!1),[ie,re]=i.useState(!0),[B,Ce]=i.useState(!1),[se,le]=i.useState(!1),[ke,Te]=i.useState(null),[Ne,Fe]=i.useState(""),[Me,Qe]=i.useState(""),[_e,Ee]=i.useState(""),[He,la]=i.useState(""),[Pe,W]=i.useState(null),[ae,Ve]=i.useState(null),Le=i.useRef({version:1,byLibrary:{}}),pe=i.useRef(!1),Re=i.useRef(!1),Ue=i.useRef(null),Ae=i.useMemo(()=>q.find(V=>V.libraryId===Q)??null,[q,Q]),qe=i.useMemo(()=>_.find(V=>V.collectionId===P)??null,[_,P]),j=i.useMemo(()=>b.find(V=>V.revisionId===D)??null,[b,D]),k=i.useMemo(()=>({detail:x.revisions.detail,graph:x.revisions.graph,settings:x.revisions.settings,run:x.revisions.run,shared:x.targets.sharedRevisions,new:x.revisionForm.createAction}),[x.revisions.detail,x.revisions.graph,x.revisions.run,x.revisions.settings,x.targets.sharedRevisions,x.revisionForm.createAction]),Y=i.useMemo(()=>[{value:"detail",label:k.detail},{value:"graph",label:k.graph},{value:"settings",label:x.targets.allRevisions},{value:"run",label:k.run},{value:"shared",label:k.shared}],[k.detail,k.graph,k.run,k.shared,x.targets.allRevisions]),t=i.useMemo(()=>v==="new_card"?"all_cards":v==="new_collection"?"all_collections":v==="new_storyboard"?"storyboards":v==="new_text"?"texts":v,[v]),r=i.useMemo(()=>ge==="new"?"settings":ge,[ge]),h=i.useMemo(()=>({library_overview:x.targets.libraryOverview,all_cards:x.targets.allCards,new_card:x.targets.newCard,all_collections:x.targets.allCollections,new_collection:x.targets.newCollection,transfer:x.targets.transfer,storyboards:x.targets.storyboards,new_storyboard:x.targets.newStoryboard,texts:x.targets.texts,new_text:x.targets.newText,dependencies:x.targets.dependencies}),[x.targets]),T=i.useMemo(()=>h[t]??t,[t,h]),K=k[r],X=!!Q,te=!!P,ee=X&&v==="all_collections",ue=te&&v==="all_collections",oe=te&&v==="all_collections"&&ur.includes(ge),ye=i.useCallback(V=>{const $e=!!V.libraryId;let De=V.target,Ke=V.collectionId,Ze=V.revisionId,oa=V.revisionView,xa=V.infoId;$e?dr[De].requiresCollection&&!Ke?(De="all_collections",Ze=void 0,oa="detail"):De!=="all_collections"?(Ke=void 0,Ze=void 0,De!=="new_card"&&(xa=void 0)):dr[De].allowsRevision?ur.includes(oa)||(Ze=void 0):oa="detail":(De="library_overview",Ke=void 0,Ze=void 0,oa="detail",xa=void 0),A(V.libraryId),G(De),ne(Ke),O(Ze),me(oa),c(!1);const pa=It(gr(V.libraryId,De,Ke,oa,Ze,xa));It(`${C.pathname}${C.search}`)!==pa&&(Ue.current=pa,l(pa))},[C.pathname,C.search,l]),ra=V=>{ye({libraryId:Q,target:"all_collections",collectionId:P,revisionId:ur.includes(V)?D:void 0,revisionView:V})},Xe=i.useMemo(()=>[{key:"library",label:x.layers.library,visible:!0,value:Q??"",selectedLabel:(Ae==null?void 0:Ae.name)??x.path.noLibrarySelected,disabled:ie||q.length===0,options:q.map(V=>({value:V.libraryId,label:V.name})),emptyOption:x.noLibraryOption,onSelect:V=>{const $e=V||void 0;ye({libraryId:$e,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:x.layers.target,visible:X,value:t,selectedLabel:T,disabled:!X,options:ci.map(V=>({value:V,label:h[V]})),onSelect:V=>{const $e=V;ye({libraryId:Q,target:$e,collectionId:P,revisionId:D,revisionView:ge,infoId:$e==="new_card"?m.infoId:void 0})}},{key:"collection",label:x.layers.collection,visible:ee,value:P??"",selectedLabel:(qe==null?void 0:qe.name)??x.path.noCollectionSelected,disabled:!X||B||_.length===0,options:_.map(V=>({value:V.collectionId,label:V.name})),emptyOption:x.selectCollectionOption,onSelect:V=>{ye({libraryId:Q,target:"all_collections",collectionId:V||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:x.layers.revision,visible:ue,value:r,selectedLabel:K,disabled:!P,options:Y.map(V=>({value:V.value,label:V.label})),onSelect:V=>{ra(V)}},{key:"revision_entry",label:x.layers.revision,visible:oe,value:D??"",selectedLabel:(j==null?void 0:j.name)??x.status.noRevisions,disabled:!te||se||b.length===0,options:b.map(V=>({value:V.revisionId,label:V.name})),emptyOption:x.status.noRevisions,onSelect:V=>{ye({libraryId:Q,target:"all_collections",collectionId:P,revisionId:V||void 0,revisionView:ge})}},{key:"selected_info",label:a.cogita.library.list.selectedTitle,visible:!!m.infoId,value:m.infoId??"",selectedLabel:ve??m.infoId??"",disabled:!0,options:[],onSelect:V=>{}}],[Y,_,B,q,ie,ye,b,se,qe,P,j,D,ve,te,X,Ae,Q,K,ge,v,r,t,T,ee,ue,oe,h,a.cogita.library.list.selectedTitle,m.infoId,x.layers.collection,x.layers.library,x.layers.revision,x.layers.target,x.noLibraryOption,x.path.noCollectionSelected,x.path.noLibrarySelected,x.selectCollectionOption]),aa=i.useMemo(()=>Xe.filter(V=>V.visible),[Xe]),Be=i.useMemo(()=>aa.filter(V=>V.key!=="library"&&V.key!=="collection"&&V.key!=="revision_entry"&&V.key!=="selected_info"),[aa]),We=i.useMemo(()=>Be.find(V=>V.key==="target")??null,[Be]),Oe=i.useMemo(()=>Be.find(V=>V.key==="collection_action")??null,[Be]),ea=i.useMemo(()=>{const V=m.libraryId;if(!V||!C.pathname.startsWith("/cogita/library/"))return null;const $e={copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,libraryId:V};if(m.target==="library_overview")return e.jsx(Qi,{...$e});if(m.target==="all_cards")return e.jsx($r,{...$e,mode:m.cardMode??"list"});if(m.target==="new_card")return m.infoId?e.jsx(nn,{...$e,editInfoId:m.infoId}):e.jsx($r,{...$e,mode:"list"});if(m.target==="dependencies")return e.jsx(on,{...$e});if(m.target==="transfer")return e.jsx(cn,{...$e});if(m.target==="storyboards"||m.target==="new_storyboard")return e.jsx(dn,{...$e});if(m.target==="texts"||m.target==="new_text")return e.jsx(un,{...$e});if(m.target==="all_collections"){if(m.collectionId){const De={...$e,collectionId:m.collectionId};return m.revisionView==="graph"?e.jsx(Dn,{...De}):m.revisionView==="shared"?e.jsx(sn,{...$e,collectionId:m.collectionId}):m.revisionView==="settings"?e.jsx(jn,{...De,revisionId:m.revisionId}):m.revisionView==="run"?e.jsx(En,{...De,revisionId:m.revisionId}):e.jsx(gn,{...De})}return e.jsx(Dr,{...$e})}return m.target==="new_collection"?e.jsx(Dr,{...$e}):null},[n,a,M,C.pathname,l,E,w,I,u,g,m.cardMode,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,p,o]);i.useEffect(()=>{let V=!1;return(async()=>{var De,Ke,Ze,oa,xa,pa,ua;re(!0);try{await Ri();const[ma,Ia,ya]=await Promise.all([Ur(),$i(),Ei()]);if(V)return;J(ma);const Je=new Set(ya.nodes.filter(ga=>ga.nodeType==="role"&&ga.canLink).map(ga=>ga.roleId??"")),ia=Vn(Ia,Je);if(W(ia),ia){const ga=ya.nodes.find(Ca=>Ca.nodeType==="data"&&Ca.roleId===ia&&(Ca.fieldType===cr||Ca.label===cr));Ve((ga==null?void 0:ga.dataKeyId)??null),Le.current=qn(ga==null?void 0:ga.value)}const Pa=Le.current.lastLibraryId,La=((De=ma.find(ga=>ga.libraryId===m.libraryId))==null?void 0:De.libraryId)??(ma.length===1?ma[0].libraryId:void 0)??((Ke=ma.find(ga=>ga.libraryId===Pa))==null?void 0:Ke.libraryId)??((Ze=ma[0])==null?void 0:Ze.libraryId),je=La?(xa=(oa=Le.current.byLibrary)==null?void 0:oa[La])==null?void 0:xa.lastTarget:void 0,we=On(je)?je:"library_overview";A(La),G(m.target??we),O(m.revisionId??(La?(ua=(pa=Le.current.byLibrary)==null?void 0:pa[La])==null?void 0:ua.lastRevisionId:void 0)),me(m.revisionView??"detail"),pe.current=!0}catch{V||Te(x.status.loadFailed)}finally{V||re(!1)}})(),()=>{V=!0}},[x.status.loadFailed]),i.useLayoutEffect(()=>{pe.current&&(m.libraryId&&q.some(V=>V.libraryId===m.libraryId)&&A(m.libraryId),m.target&&G(m.target),ne(m.collectionId),O(m.revisionId),m.revisionView&&me(m.revisionView))},[q,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target]),i.useEffect(()=>{if(!Q){s([]),ne(void 0),f([]),O(void 0);return}let V=!1;return Ce(!0),jt({libraryId:Q,limit:200}).then($e=>{var Ze;if(V)return;const De=$e.items;s(De);const Ke=(Ze=De.find(oa=>oa.collectionId===m.collectionId))==null?void 0:Ze.collectionId;ne(Ke)}).catch(()=>{V||(s([]),ne(void 0))}).finally(()=>{V||Ce(!1)}),()=>{V=!0}},[m.collectionId,Q]),i.useEffect(()=>{if(!Q||!P){f([]),O(void 0);return}let V=!1;return le(!0),Wr({libraryId:Q,collectionId:P}).then($e=>{var Ze,oa,xa,pa;if(V)return;f($e);const De=(oa=(Ze=Le.current.byLibrary)==null?void 0:Ze[Q])==null?void 0:oa.lastRevisionId,Ke=((xa=$e.find(ua=>ua.revisionId===m.revisionId))==null?void 0:xa.revisionId)??((pa=$e.find(ua=>ua.revisionId===De))==null?void 0:pa.revisionId);O(Ke)}).catch(()=>{V||(f([]),O(void 0))}).finally(()=>{V||le(!1)}),()=>{V=!0}},[m.revisionId,P,Q]),i.useEffect(()=>{const V=m.infoId;if(!Q||!V){F(void 0);return}let $e=!1;return et({libraryId:Q,infoId:V}).then(De=>{if($e)return;const Ke=De.payload;F((Ke==null?void 0:Ke.label)??(Ke==null?void 0:Ke.name)??(Ke==null?void 0:Ke.title)??De.infoId)}).catch(()=>{$e||F(V)}),()=>{$e=!0}},[m.infoId,Q]),i.useEffect(()=>{if(!pe.current||m.libraryId&&q.some(De=>De.libraryId===m.libraryId)&&m.libraryId!==Q||m.target&&m.target!==v||m.revisionView&&m.revisionView!==ge||m.revisionId&&m.revisionId!==D||dr[v].requiresCollection&&!P&&m.target==="all_collections"&&m.collectionId)return;const V=It(`${C.pathname}${C.search}`),$e=It(gr(Q,v,P,ge,D,m.infoId));if(V===$e){Ue.current=null;return}Ue.current!==$e&&(Ue.current=$e,l($e,{replace:!0}))},[q,C.pathname,C.search,l,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,P,Q,D,ge,v]),i.useEffect(()=>{if(typeof window>"u")return;const V=()=>{window.innerWidth>920&&c(!1)};return window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[]),i.useEffect(()=>{if(!pe.current||!Pe||!Q||Re.current)return;const V=Le.current,$e={...V.byLibrary??{}},De={...$e[Q]??{},lastCollectionId:P,lastRevisionId:D,lastRevisionView:ge,lastTarget:v},Ke={version:1,lastLibraryId:Q,byLibrary:{...$e,[Q]:De}},Ze=JSON.stringify(V),oa=JSON.stringify(Ke);if(Ze===oa)return;Le.current=Ke,Re.current=!0,(async()=>{try{if(ae)await Ai(ae,{plainValue:oa});else{const pa=await Fi(Pe,{itemName:cr,itemType:"data",plainValue:oa});Ve(pa.dataItemId)}}catch{Te(x.status.savePrefsFailed)}finally{Re.current=!1}})()},[ae,Pe,P,Q,D,ge,v,x.status.savePrefsFailed]);const $a=async()=>{const V=Ne.trim();if(!V){Te(a.cogita.user.libraryNameRequired);return}Te(null);try{const $e=await Ki({name:V});J(De=>[$e,...De]),A($e.libraryId),G("library_overview"),ne(void 0),Fe("")}catch{Te(a.cogita.user.libraryCreateFailed)}},na=async()=>{if(!Q){Te(x.status.selectLibraryFirst);return}const V=Me.trim();if(!V){Te(a.cogita.library.collections.saveRequiredName);return}Te(null);try{const $e=await Bi({libraryId:Q,name:V,items:[]}),De=await jt({libraryId:Q,limit:200});s(De.items),ne($e.collectionId),O(void 0),G("all_collections"),me("detail"),Qe("")}catch{Te(a.cogita.library.collections.saveFail)}},Ea=async()=>{if(!Q){Te(x.status.selectLibraryFirst);return}const V=_e.trim();if(!V){Te(a.cogita.library.add.info.labelLabel);return}Te(null);try{await Wa({libraryId:Q,infoType:"topic",payload:{label:V,notes:""}}),Ee(""),ye({libraryId:Q,target:"all_cards",collectionId:P,revisionId:D,revisionView:ge})}catch{Te(a.cogita.library.add.info.messages.failed)}},sa=async()=>{if(!Q||!P){Te(x.status.selectLibraryFirst);return}const V=He.trim();if(!V){Te(x.revisionForm.nameLabel);return}Te(null);try{const $e=await Di({libraryId:Q,collectionId:P,name:V,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});f(De=>[$e,...De]),O($e.revisionId),G("all_collections"),me("settings"),la("")}catch{Te(x.status.loadFailed)}};return e.jsx(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${ce?"open":""}`,"aria-label":x.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Ae==null?void 0:Ae.name)??x.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Ae?x.sidebar.libraryActionsHint:x.status.selectLibraryFirst}),We?e.jsx("div",{className:"cogita-sidebar-actions",children:We.options.map(V=>e.jsx("button",{type:"button",className:`ghost ${String(We.value)===V.value?"active":""}`,onClick:()=>We.onSelect(V.value),disabled:We.disabled,children:V.label},`sidebar:target:${V.value}`))}):null]}),qe?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:qe.name}),e.jsx("p",{className:"cogita-sidebar-note",children:x.sidebar.collectionActionsHint}),Oe?e.jsx("div",{className:"cogita-sidebar-actions",children:Oe.options.map(V=>e.jsx("button",{type:"button",className:`ghost ${String(Oe.value)===V.value?"active":""}`,onClick:()=>Oe.onSelect(V.value),disabled:Oe.disabled,children:V.label},`sidebar:revision:${V.value}`))}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:x.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:u,children:x.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{I("cogita"),c(!1)},children:x.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:p?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),ce?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":x.sidebar.closeMenu,onClick:()=>c(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":x.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>c(V=>!V),"aria-label":ce?x.sidebar.closeMenu:x.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),aa.map((V,$e)=>e.jsxs("div",{className:"cogita-browser-segment",children:[$e>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,V.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":V.label,children:V.selectedLabel}):e.jsxs("select",{"aria-label":V.label,value:V.value,onChange:De=>V.onSelect(De.target.value),disabled:V.disabled,children:[V.emptyOption?e.jsx("option",{value:"",children:V.emptyOption}):null,V.options.map(De=>e.jsx("option",{value:De.value,children:De.label},`${V.key}:${De.value}`))]})]},`menu:${V.key}`))]}),ea?e.jsxs(e.Fragment,{children:[v==="new_card"&&!m.infoId?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.actions.addInfo}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:_e,onChange:V=>Ee(V.target.value),placeholder:a.cogita.library.add.info.labelPlaceholder,disabled:!Q})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ea,disabled:!Q,children:a.cogita.library.actions.addInfo}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,v==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:a.cogita.library.collections.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Me,onChange:V=>Qe(V.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!Q})]}),e.jsx("button",{type:"button",className:"cta",onClick:na,disabled:!Q,children:a.cogita.library.collections.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,v==="all_collections"&&P&&ge==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:V=>la(V.target.value),placeholder:x.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:sa,children:x.revisionForm.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Qr.Provider,{value:!0,children:ea})})]}):null,ea?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[aa.map((V,$e)=>e.jsxs("span",{children:[$e>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:V.selectedLabel})]},`path:${V.key}`)),ee?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:x.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[x.path.currentRoute," ",e.jsx("code",{children:gr(Q,v,P,ge,D,m.infoId)})]}),Q?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${Q}`,children:x.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${Q}/list`,children:x.links.allCards}),P?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${Q}/collections/${P}/shared-revisions`,children:x.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:x.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ne,onChange:V=>Fe(V.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:$a,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Me,onChange:V=>Qe(V.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!Q})]}),e.jsx("button",{type:"button",className:"cta",onClick:na,disabled:!Q,children:a.cogita.library.collections.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:V=>la(V.target.value),placeholder:x.revisionForm.namePlaceholder,disabled:!P})]}),e.jsx("button",{type:"button",className:"cta",onClick:sa,disabled:!P,children:x.revisionForm.createAction}),ke?e.jsx("p",{className:"cogita-form-error",children:ke}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:x.panels.collections}),B?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.loadingCollections}):null,!B&&_.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:x.status.noCollections}):null,_.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:_.map(V=>e.jsxs("button",{type:"button",className:`cogita-card-item ${V.collectionId===P?"active":""}`,onClick:()=>{ne(V.collectionId),O(void 0),me("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:x.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:V.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[V.itemCount," ",x.cards.itemsSuffix]})]},V.collectionId))}):null]})]})]})]})})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:_n},Symbol.toStringTag,{value:"Module"}));function Un({copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,shareId:l}){const[C,m]=i.useState(null),[x,q]=i.useState("loading"),[J,_]=i.useState(a.cogita.library.collections.defaultName),[s,b]=i.useState("Cogita Library"),[f,Q]=i.useState([]),[A,v]=i.useState([]),[G,P]=i.useState("idle"),[ne,D]=i.useState({current:0,total:0}),[O,ge]=i.useState(0),[me,ve]=i.useState(""),[F,ce]=i.useState(null),[c,ie]=i.useState(null),[re,B]=i.useState(null),[Ce,se]=i.useState(null),[le,ke]=i.useState([]),[Te,Ne]=i.useState({}),[Fe,Me]=i.useState({}),[Qe,_e]=i.useState(null),[Ee,He]=i.useState(null),[la,Pe]=i.useState(null),[W,ae]=i.useState(null),[Ve,Le]=i.useState({}),pe=i.useRef(0),[Re,Ue]=i.useState(null),Ae=i.useRef(null),qe=i.useRef(null),[j,k]=i.useState(null),[Y,t]=i.useState(!1),[r,h]=i.useState(null),[T,K]=i.useState([]),[X,te]=i.useState(null),ee=i.useRef(null),ue=i.useRef(null),[oe,ye]=i.useState(null),[ra,Xe]=i.useState(0),aa=i.useRef(null),Be=i.useRef({}),[We,Oe]=i.useState(!1),[ea,$a]=i.useState({}),na=i.useRef(null),Ea=i.useRef(new Set),sa=i.useRef({}),[V,$e]=i.useState([]),[De,Ke]=i.useState(new Set),[Ze,oa]=i.useState(!1),xa=vr(),pa=i.useMemo(()=>new URLSearchParams(xa.search),[xa.search]),ua=i.useMemo(()=>pa.get("key")??"",[pa]),ma=(C==null?void 0:C.mode)??"random",Ia=(C==null?void 0:C.check)??"exact",ya=(C==null?void 0:C.limit)??20,Je=i.useMemo(()=>Nr((C==null?void 0:C.revisionType)??ma),[C,ma]),ia=i.useMemo(()=>{const R=C==null?void 0:C.revisionSettings,Z=ti(Je,pa);return Jt(Je,R??Z)},[C,pa,Je]),Pa=i.useMemo(()=>a.cogita.library.revision[Je.labelKey]??ma,[a,ma,Je]),La=i.useMemo(()=>Ia==="exact"?a.cogita.library.revision.checkValue:Ia,[a,Ia]),we=x==="ready"?f[O]??null:null,ga=(we==null?void 0:we.checkType)==="translation-match"&&W,Ca=i.useRef(new Map),at=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useRef(new Map),Yt=i.useMemo(()=>we?we.cardType==="vocab"?a.cogita.library.revision.vocabLabel:we.infoType?ta(a,we.infoType):a.cogita.library.revision.infoLabel:"",[a,we]),rt=i.useMemo(()=>{var Z;return Je.id!=="levels"?f.length:((Z=ea.pool)==null?void 0:Z.length)??Je.getFetchLimit(ya,ia)},[ea,ia,Je,f.length,ya]),it=Je.getProgressTotal?Je.getProgressTotal(f,ea,ya,ia):Je.id==="levels"?Math.min(ya,rt):f.length,Aa=it?Math.min(O+1,it):0,ka=Math.max(1,Number(ia.tries??1)),_a=ia.compare??"anchors",fa=Math.max(0,Math.min(100,Number(ia.minCorrectness??0))),ca=(ia.considerDependencies??"on")==="on",Ra=Math.max(0,Math.min(100,Number(ia.dependencyThreshold??85))),Ha=R=>{const Z=R.slice();for(let d=Z.length-1;d>0;d-=1){const y=Math.floor(Math.random()*(d+1));[Z[d],Z[y]]=[Z[y],Z[d]]}return Z},Ua=R=>R.length?R.reduce((d,y)=>d+y,0)/R.length/255*100:0,nt=R=>Ua(R)>=fa,Qt=async()=>{const R=await Va(),Z=new Map,d=new Map;R.forEach(N=>{const H=`${N.itemType}:${N.itemId}`,L=Ka(N.itemType,N.itemId,N.checkType,N.direction);Z.has(H)||Z.set(H,[]),Z.get(H).push(N),d.has(L)||d.set(L,[]),d.get(L).push(N)});const y=new Map,S=new Map;return Z.forEach((N,H)=>y.set(H,Oa(N).score)),d.forEach((N,H)=>S.set(H,Oa(N).score)),{itemKnowness:y,cardKnowness:S}},ft=async R=>{const Z=ea,d=R.concat(Z.active??[]).concat(Z.pool??[]).filter((z,de,he)=>he.findIndex(xe=>be(xe)===be(z))===de);if(!ca){Ke(new Set(d.map(be)));return}const{itemKnowness:y,cardKnowness:S}=await Qt(),N=z=>{if(z.cardType!=="info"||z.infoType!=="quote"||z.checkType!=="quote-fragment")return!0;const de=Ta(z.direction);if(!(de!=null&&de.fragmentId))return!0;const he=z.description??"";if(!he.trim())return!0;const fe=bt(he).nodes[de.fragmentId];if(!fe||!fe.leftId&&!fe.rightId)return!0;const Se=[fe.leftId,fe.rightId].filter(Ge=>!!Ge);if(Se.length===0)return!0;const Ie=Se.map(Ge=>{const ha=Ka("info",z.cardId,"quote-fragment",kt(de.mode,Ge));return S.get(ha)??0});return Ie.reduce((Ge,ha)=>Ge+ha,0)/Ie.length>=Ra},H=(C==null?void 0:C.collectionId)??null,L=H?V.filter(z=>ba(z.childItemType)==="collection"&&z.childItemId===H&&!ba(z.childCheckType)&&!ba(z.childDirection)):[],U=H&&d.length>0?d.reduce((z,de)=>z+(S.get(be(de))??0),0)/d.length:0,$=new Set;for(const z of d){if(z.cardType!=="info"){$.add(be(z));continue}if(!N(z))continue;const de=V.filter(fe=>si(fe,z)).concat(L);if(de.length===0){$.add(be(z));continue}let he=0;for(const fe of de)if(ba(fe.parentItemType)==="collection")he+=fe.parentItemId===H?U:0;else if(ba(fe.parentCheckType)||ba(fe.parentDirection)){const Se=ba(fe.parentCheckType),Ie=ba(fe.parentDirection),Ye=Ka(fe.parentItemType,fe.parentItemId,Se,Ie);he+=S.get(Ye)??0}else{const Se=`${fe.parentItemType}:${fe.parentItemId}`;he+=y.get(Se)??0}he/de.length>=Ra&&$.add(be(z))}Ke($)},Gt=R=>{for(let Z=R;Z<f.length;Z+=1){const d=f[Z];if(d&&(!ca||d.cardType!=="info"||De.has(be(d))))return Z}return-1},lt=R=>!ca||R.cardType!=="info"||De.has(be(R)),Xt=R=>{if(Je.id!=="temporal"&&Je.id!=="levels")return null;const Z=ea,d=(Z.active??[]).concat(Z.pool??[]),y=new Set;for(const S of d){const N=be(S);if(!(y.has(N)||R.has(N))&&(y.add(N),lt(S)))return S}return null},Ma=i.useMemo(()=>{if(Je.id!=="levels")return null;const R=ea,Z=R.pool??[],d=R.active??[],y=R.levelMap??{},S=Math.max(1,Number(ia.levels??1)),N=Array.from({length:S},()=>0),H=new Set(d.map(z=>be(z)));Z.forEach(z=>{const de=Math.min(S,Math.max(1,y[be(z)]??1));N[de-1]+=1});const L=Z.length||1,U=N.map(z=>z/L*100),$=we?y[be(we)]??1:null;return{counts:N,percentages:U,currentLevel:$,levelsCount:S,activeCount:d.length,poolCount:Z.length,activeSet:H}},[ea,ia,Je,we]),ot=i.useMemo(()=>{if(Je.id!=="temporal")return null;const R=ea,Z=R.pool??[],d=R.active??[],y=R.knownessMap??{},S=new Set(R.unknownSet??[]);let N=0;Z.forEach(U=>{(y[be(U)]??0)>1&&(N+=1)});const H=S.size,L=d.map(U=>({id:be(U),value:S.has(be(U))?0:Math.max(0,Math.min(1,y[be(U)]??0))}));return{knownCount:N,unknownCount:H,dots:L}},[ea,Je]),Fa=i.useMemo(()=>{if(!ca)return 0;const R=ea;return f.concat(R.active??[]).concat(R.pool??[]).filter((d,y,S)=>S.findIndex(N=>be(N)===be(d))===y).filter(d=>d.cardType==="info"&&!De.has(be(d))).length},[ca,ea,f,De]);i.useEffect(()=>{if(!ca||G!=="ready")return;const R=ea,d=f.concat(R.active??[]).concat(R.pool??[]).filter((N,H,L)=>L.findIndex(U=>be(U)===be(N))===H).filter(N=>N.cardType!=="info"||De.has(be(N))).length,y=ee.current;if(ee.current=d,y===null||d<=y)return;const S=d-y;te(`New card available (+${S})`),ue.current&&window.clearTimeout(ue.current),ue.current=window.setTimeout(()=>te(null),2200)},[ca,G,ea,f,De]),i.useEffect(()=>()=>{ue.current&&window.clearTimeout(ue.current)},[]);const va=(R,Z)=>{const d=Je.applyOutcome({queue:f,meta:ea},we,ya,ia,{correct:R,correctness:Z,createdUtc:new Date().toISOString()});Q(d.queue),$a(d.meta);const y=d.queue[O+1];y&&Sa(y,O+1)};i.useEffect(()=>{if(!l){q("error");return}q("loading"),Oi({shareId:l,key:ua}).then(R=>{m(R),_(R.collectionName),b(R.libraryName),q("ready")}).catch(()=>{q("error")})},[l,ua]),i.useEffect(()=>{l&&Vi({shareId:l,key:ua,type:"language"}).then(R=>v(R)).catch(()=>v([]))},[l,ua]),i.useEffect(()=>{!l||x!=="ready"||qi({shareId:l,key:ua}).then(R=>$e(R.items??[])).catch(()=>$e([]))},[l,ua,x]),i.useEffect(()=>{if(!l||x!=="ready")return;let R=!0;return(async()=>{P("loading"),D({current:0,total:Je.id==="levels"?0:Je.getFetchLimit(ya,ia)});try{const d=[];let y=null,S=null;do{const de=await _i({shareId:l,key:ua,limit:300,cursor:y});if(d.push(...de.items),(Je.id==="levels"||Je.id==="temporal")&&de.total&&(S=de.total),D(he=>({current:d.length,total:he.total||de.total||Je.getFetchLimit(ya,ia)})),y=de.nextCursor??null,S!==null&&d.length>=S||Je.id!=="levels"&&Je.id!=="temporal"&&d.length>=Je.getFetchLimit(ya,ia))break}while(y);if(!R)return;const N=pr(d);let H;if(Je.id==="levels"){const de=Math.max(1,Number(ia.levels??1));H={},N.forEach(he=>{const xe=be(he);H[xe]=Math.max(1,Math.min(de,1))})}let L=null,U=null,$=null;if(Je.id==="temporal"){const de=await Va(),he=new Set(N.map(Se=>be(Se))),xe=de.reduce((Se,Ie)=>{const Ye=Ka(Ie.itemType,Ie.itemId,Ie.checkType,Ie.direction);return he.has(Ye)&&(Se[Ye]||(Se[Ye]=[]),Se[Ye].push(Ie)),Se},{});L={},U=new Set,$={};const fe=Date.now();N.forEach(Se=>{const Ie=be(Se),Ye=xe[Ie]??[];if(Ye.length===0){L[Ie]=0,U.add(Ie),$[Ie]=[];return}const Ge=wr(Ye);$[Ie]=Ge;const ha=zt(Ge,fe);L[Ie]=ha.knowness})}const z=Je.id==="levels"?Tr(N,ya,ia,H):Je.id==="temporal"?kr(N,ya,ia,L??{},U??new Set,$??{}):Je.prepare(N,ya,ia);Q(z.queue),$a(z.meta),ge(0),P("ready"),D(de=>({current:Math.min(de.current,de.total),total:de.total}))}catch{R&&P("error")}})(),()=>{R=!1}},[l,ua,ya,Je,ia,x]),i.useEffect(()=>{ft(f)},[f,V,ca,Ra,C==null?void 0:C.collectionId]),i.useEffect(()=>{if(!we||!ca){oa(!1);return}if(we.cardType!=="info"||De.has(be(we))){oa(!1);return}const R=Gt(O+1);if(R>=0){oa(!1),ge(R);return}if(Je.id==="temporal"||Je.id==="levels"){const Z=f.slice(0,O+1),d=f.slice(O+1).filter(lt),y=Z.concat(d),S=new Set(y.map(be)),N=Xt(S);if(N){const L=be(N);S.has(L)||(y.push(N),S.add(L),$a(U=>{const $=U,z=new Set($.queued??[]);return z.add(L),{...$,queued:z}}))}const H=y.findIndex((L,U)=>U!==O&&lt(L));if(H>=0){Q(y),ge(H),oa(!1);return}}oa(!0)},[we,De,ca,O,f,ea,Je.id]),i.useEffect(()=>{if(ve(""),ce(null),ye(null),Xe(0),ke([]),Ne({}),Me({}),_e(null),He(null),Pe(null),t(!1),Oe(!1),k(null),ae(null),Le({}),!we){ie(null),B(null);return}we.cardType==="info"&&we.infoType==="computed"&&ie(a.cogita.library.revision.loadingComputed);let R=!0;return Sa(we,O).then(Z=>{!R||!Z||(ie(Z.prompt),B(Z.expectedAnswer),ke(Z.computedExpected),Ne(Z.computedAnswers),_e(Z.answerTemplate),He(Z.outputVariables),Pe(Z.variableValues))}),()=>{R=!1}},[we,l,a]),i.useEffect(()=>{if(!we||we.cardType!=="info"||we.infoType!=="quote"){na.current=null,Ea.current=new Set,se(null);return}const R=we.description??"",Z=(we.label??"").trim(),d=Z.replace(/\s+/g," ").trim(),y=R.replace(/\s+/g," ").trim(),S=d&&d!==y?Z:a.cogita.library.infoTypes.quote;if(!R){se(null),B(null);return}const N=bt(R);na.current=N,ie(S);let H=!0;return Va().then(L=>{if(!H)return;const U=getQuoteMode(we.direction),$=new Map;L.forEach(fe=>{if(fe.itemType!=="info"||fe.checkType!=="quote-fragment"||!fe.direction)return;const Se=Ta(fe.direction);if(!Se||Se.mode!==U)return;const Ie=`${fe.itemId}:${Se.fragmentId}`;$.has(Ie)||$.set(Ie,[]),$.get(Ie).push(fe)});const z={},de=new Set;$.forEach((fe,Se)=>{const[Ie,Ye]=Se.split(":",2);if(Ie!==we.cardId)return;const Ge=Oa(fe).score;z[Ye]=Ge,Ge>=Ra&&de.add(Ye)}),Ea.current=de,sa.current=z;const he=Ta(we.direction);if(he!=null&&he.fragmentId&&N.nodes[he.fragmentId]){Qa(N,he.fragmentId,S);return}const xe=gt(N,de,z,Ra,ca,we.direction);Qa(N,(xe==null?void 0:xe.id)??null,S)}).catch(()=>{Ea.current=new Set,sa.current={};const L=Ta(we.direction);if(L!=null&&L.fragmentId&&N.nodes[L.fragmentId]){Qa(N,L.fragmentId,S);return}const U=gt(N,Ea.current,{},Ra,ca,we.direction);Qa(N,(U==null?void 0:U.id)??null,S)}),()=>{H=!1}},[we,a,ca,Ra]),i.useEffect(()=>{if(!we||we.cardType!=="vocab"||we.checkType!=="translation-match"){ae(null),Le({});return}const d=(ea.pool??ea.active??f).filter(L=>L.cardType==="vocab"&&L.checkType==="translation-match").filter((L,U,$)=>$.findIndex(z=>z.cardId===L.cardId)===U);d.some(L=>L.cardId===we.cardId)||d.unshift(we);const S=Ha(d).slice(0,6).map(L=>{const U=L.label.split("↔").map(de=>de.trim()).filter(Boolean);if(U.length<2)return null;const $=`${L.cardId}:L`,z=`${L.cardId}:R`;return{cardId:L.cardId,leftId:$,rightId:z,leftLabel:U[0],rightLabel:U[1]}}).filter(Boolean),N=S.map(L=>L.leftId),H=Ha(S.map(L=>L.rightId));ae({pairs:S,leftOrder:N,rightOrder:H,selection:{},activeLeft:null,activeRight:null,locked:{}})},[we,f,ea]),i.useEffect(()=>()=>{Ae.current&&window.clearTimeout(Ae.current),qe.current&&window.clearTimeout(qe.current)},[]);const st=i.useRef(null);i.useEffect(()=>{if(!we)return;const R=be(we),Z=typeof document<"u"?document.activeElement:null;if(st.current===R&&Z&&(Z.tagName==="INPUT"||Z.tagName==="TEXTAREA"))return;let d=0;const y=()=>{if(we){if(we.cardType==="info"&&we.infoType==="computed"){if(le.length>0){const N=Ut(Qe,le,Ee),H=N?Be.current[N]:null;if(H&&(H.focus(),document.activeElement===H)){st.current=R;return}}if(aa.current&&(aa.current.focus(),document.activeElement===aa.current)){st.current=R;return}}else if(we.cardType==="vocab"&&aa.current&&(aa.current.focus(),document.activeElement===aa.current)){st.current=R;return}d<6&&(d+=1,window.setTimeout(y,40))}},S=window.setTimeout(y,40);return()=>window.clearTimeout(S)},[we,le,Qe,Ee]),i.useEffect(()=>{if(!We)return;const R=Z=>{Z.key==="Enter"&&(Z.preventDefault(),ct())};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[We]);const ja=R=>{K(R),h(Oa(R))};i.useEffect(()=>{if(!we){h(null),K([]);return}const R=we.cardType==="info"?"info":"connection";if(we.cardType==="info"&&we.infoType==="quote"){Va().then(Z=>{const d=Z.filter(y=>y.itemType==="info"&&y.itemId===we.cardId&&y.checkType==="quote-fragment"&&qt(y.direction,we.direction));ja(d)}).catch(()=>{h(null),K([])});return}Ot(R,we.cardId,we.checkType,we.direction).then(Z=>ja(Z)).catch(()=>{h(null),K([])})},[we]);const Ja=(R,Z,d,y)=>{if(R==="info"&&d==="quote-fragment"){Va().then(S=>{const N=S.filter(H=>H.itemType==="info"&&H.itemId===Z&&H.checkType==="quote-fragment"&&qt(H.direction,y));ja(N)}).catch(()=>{h(null),K([])});return}Ot(R,Z,d,y).then(S=>ja(S)).catch(()=>{h(null),K([])})},Ya=(R,Z,d)=>{var H;const y=((H=d.pairs.find(L=>L.leftId===R))==null?void 0:H.rightId)??null;if(!y)return d;const S=y===Z;Le(L=>({...L,[R]:S?"correct":"incorrect"})),Ae.current&&window.clearTimeout(Ae.current),qe.current&&window.clearTimeout(qe.current),pe.current+=1;const N={kind:S?"correct":"incorrect",tick:pe.current};if(Ue(null),Ae.current=window.setTimeout(()=>Ue(N),0),qe.current=window.setTimeout(()=>Ue(null),420),S){const L={...d.locked,[R]:!0};return Object.keys(L).length>=d.pairs.length?(ce("correct"),Oe(!0)):ce("correct"),{...d,selection:{...d.selection,[R]:Z},activeLeft:null,activeRight:null,locked:L}}return ce("incorrect"),{...d,activeLeft:null,activeRight:null}},Nt=R=>{ae(Z=>!Z||Z.locked[R]?Z:Z.activeRight?Ya(R,Z.activeRight,Z):{...Z,activeLeft:Z.activeLeft===R?null:R})},Lt=R=>{ae(Z=>Z&&(Z.activeLeft?Ya(Z.activeLeft,R,Z):{...Z,activeRight:Z.activeRight===R?null:R}))},ct=()=>{var R;if(we&&we.cardType==="info"&&we.infoType==="quote"&&na.current&&Ce&&!((R=Ta(we.direction))!=null&&R.fragmentId)){const Z=gt(na.current,Ea.current,sa.current,Ra,ca,we.direction,Ce.fragmentId);if(Z){ce(null),ve(""),t(!1),Me({}),Oe(!1),ye(null),Xe(0),Qa(na.current,Z.id,Ce.title);return}}ce(null),ve(""),t(!1),Me({}),Oe(!1),ye(null),Xe(0),ge(Z=>Math.min(Z+1,f.length))},Ba=R=>{if(!we)return;const Z=R.expected??null,d=R.answer??"";let y=Z??"",S=d;if(!Z&&R.expectedMap&&R.answerMap){const de=Object.keys(R.expectedMap).sort((he,xe)=>he.localeCompare(xe));y=de.map(he=>{var xe;return((xe=R.expectedMap)==null?void 0:xe[he])??""}).join("|"),S=de.map(he=>{var xe;return((xe=R.answerMap)==null?void 0:xe[he])??""}).join("|")}const N=y?ht(y,S,_a):new Uint8Array,H={revisionType:Je.id,evalType:R.evalType,direction:R.direction,prompt:c??"",expected:Z,answer:d,expectedAnswers:R.expectedMap??null,answers:R.answerMap??null,correct:R.correct,maskBase64:N.length?za(N):null,checkMode:Ia,compareMode:_a,minCorrectness:fa},L=new TextEncoder().encode(JSON.stringify(H)),U=we.cardType==="info"?"info":"connection",$=R.overrideCheckType??we.checkType??null,z=R.overrideDirection??we.direction??null;Kt({itemType:U,itemId:we.cardId,checkType:$,direction:z,revisionType:Je.id,evalType:R.evalType,correct:R.correct,maskBase64:N.length?za(N):null,payloadBase64:za(L)}).then(()=>{Ja(U,we.cardId,$,z),ft(f)}).catch(()=>{})},dt=(R,Z)=>{const d=Ca.current.get(Z);if(d)return Promise.resolve(d);const y=at.current.get(Z);if(y)return y;const S=Ui({shareCode:l,infoId:R,key:ua}).then(N=>{var de,he;const H=N.payload,L=((de=H.definition)==null?void 0:de.graph)??null,U="",$=((he=H.definition)==null?void 0:he.answerTemplate)??"",z=jr(L,U,$);if(z){const fe={sample:Xr(z),answerTemplate:$||null};return Ca.current.set(Z,fe),fe}return Mr({shareId:l,infoId:R,key:ua}).then(xe=>{const fe={sample:xe,answerTemplate:null};return Ca.current.set(Z,fe),fe})}).catch(()=>Mr({shareId:l,infoId:R,key:ua}).then(N=>{const H={sample:N,answerTemplate:null};return Ca.current.set(Z,H),H}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{at.current.delete(Z)});return at.current.set(Z,S),S},Sa=(R,Z)=>{var L;const d=`${be(R)}:${Z}`,y=tt.current.get(d);if(y)return Promise.resolve(y);const S=pt.current.get(d);if(S)return S;const N=U=>(tt.current.set(d,U),U);let H;if(R.cardType==="vocab"){if(R.checkType==="translation-match")return H=Promise.resolve(N({prompt:R.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),H;const U=R.label.split("↔").map($=>$.trim()).filter(Boolean);if(U.length>=2){const z=(R.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",de=z?U[0]:U[1],he=z?U[1]:U[0];H=Promise.resolve(N({prompt:de,expectedAnswer:he,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else H=Promise.resolve(N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(R.cardType==="info"&&R.infoType==="word"){const U=(L=R.description)!=null&&L.startsWith("Language: ")?R.description.replace("Language: ",""):null;H=Promise.resolve(N({prompt:R.label,expectedAnswer:U,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else R.cardType==="info"&&R.infoType==="computed"?H=dt(R.cardId,d).then(U=>{var xe,fe;if(!U.sample)return N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const $=U.sample,z=$.expectedAnswers?Object.entries($.expectedAnswers).map(([Se,Ie])=>({key:Se,expected:Ie})):[],de=z.reduce((Se,Ie)=>(Se[Ie.key]="",Se),{}),he=$.expectedAnswerIsSentence&&((xe=$.expectedAnswer)==null?void 0:xe.trim())||null;return N({prompt:$.prompt,expectedAnswer:z.length>0?he:((fe=$.expectedAnswer)==null?void 0:fe.trim())||null,computedExpected:z,computedAnswers:de,answerTemplate:U.answerTemplate,outputVariables:$.outputVariables??null,variableValues:$.variableValues??null})}).catch(()=>N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{pt.current.delete(d)}):H=Promise.resolve(N({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return pt.current.set(d,H),H},Qa=(R,Z,d)=>{const y=Object.keys(R.nodes).length,S=Ea.current.size;if(!Z){se({title:d,before:R.text,after:"",fragmentId:null,total:y,completed:S}),B(null),Oe(!0);return}const N=R.nodes[Z];if(!N)return;const H=Zr(R.text,N);se({title:d,before:H.before,after:H.after,fragmentId:N.id,total:y,completed:S}),B(H.fragment),Oe(!1)},xt=()=>{const R=na.current;R&&se(Z=>Z&&{...Z,total:Object.keys(R.nodes).length,completed:Ea.current.size})},Da=()=>{const R=f[O+1];R&&Sa(R,O+1)},Ct=()=>{if(Da(),we&&we.cardType==="vocab"&&we.checkType==="translation-match"&&W){if(W.pairs.length===0){ce("incorrect"),Oe(!0);return}const N=W.pairs.reduce((he,xe)=>(he[xe.rightId]=xe.rightLabel,he),{});let H=0;const L={};W.pairs.forEach(he=>{const fe=W.selection[he.leftId]===he.rightId;L[he.leftId]=fe?"correct":"incorrect",fe&&(H+=1)});const U=W.pairs.length||1,$=H/U,z=H===W.pairs.length;Le(he=>({...he,...L})),z?(ce("correct"),Oe(!0),Xe(0)):(ce("incorrect"),Oe(!1),Xe(he=>{const xe=he+1;return xe>=ka&&(t(!0),Oe(!0),ae(fe=>{if(!fe)return fe;const Se=fe.pairs.reduce((Ie,Ye)=>(Ie[Ye.leftId]=Ye.rightId,Ie),{});return{...fe,selection:Se}})),xe})),va(z,$);const de="connection";Promise.all(W.pairs.map(he=>{const xe=W.selection[he.leftId]??null,fe=xe?N[xe]:"",Se={left:he.leftLabel,expected:he.rightLabel,answer:fe,checkType:"translation-match"},Ie=new TextEncoder().encode(JSON.stringify(Se));return Kt({itemType:de,itemId:he.cardId,checkType:"translation-match",direction:null,revisionType:Je.id,evalType:"translation-match",correct:xe===he.rightId,maskBase64:null,payloadBase64:za(Ie)})})).then(()=>{Ja(de,we.cardId,we.checkType,we.direction),ft(f)}).catch(()=>{});return}if(le.length>0){const N=le.reduce((L,U)=>{const $=Te[U.key]??"";return L[U.key]=wa($)===wa(U.expected)?"correct":"incorrect",L},{});le.every(({key:L,expected:U})=>{const $=Te[L]??"";return Ia==="exact"&&wa($)===wa(U)})?(ce("correct"),Me(N),Oe(!0),Xe(0),va(!0,1),Ba({correct:!0,direction:c?`${c} -> computed`:"computed",expectedMap:le.reduce((L,U)=>(L[U.key]=U.expected,L),{}),answerMap:Te,evalType:"computed"})):(ce("incorrect"),Me(N),Oe(!1),Xe(L=>{const U=L+1;return U>=ka&&Ga&&(t(!0),Oe(!0)),U}),va(!1,0),window.setTimeout(()=>{var U;const L=Ut(Qe,le,Ee);L&&Be.current[L]&&((U=Be.current[L])==null||U.focus())},40),Ba({correct:!1,direction:c?`${c} -> computed`:"computed",expectedMap:le.reduce((L,U)=>(L[U.key]=U.expected,L),{}),answerMap:Te,evalType:"computed"}));return}if(we&&we.cardType==="info"&&we.infoType==="quote"&&(Ce!=null&&Ce.fragmentId)){if(!re)return;const N=Ta(we.direction),H=(N==null?void 0:N.mode)??getQuoteMode(we.direction),L=N!=null&&N.fragmentId&&we.direction?we.direction:kt(H,Ce.fragmentId),U=oi(re,me,_a),$=Ia==="exact"&&mt(me)===mt(re),z=nt(U),de=$||z,he=Ua(U);de?(sa.current[Ce.fragmentId]=Math.max(sa.current[Ce.fragmentId]??0,he),(sa.current[Ce.fragmentId]??0)>=Ra&&Ea.current.add(Ce.fragmentId),xt(),ce("correct"),Me({}),Oe(!0),ye(U),Xe(0),he<100&&ka<=1&&t(!0),va(!0,he/100),Ba({correct:!0,direction:`quote:${Ce.fragmentId}`,expected:re,answer:me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L})):(ce("incorrect"),Me({}),Oe(!1),ye(U),Xe(xe=>{const fe=xe+1;return fe>=ka&&Ga&&(t(!0),Oe(!0)),fe}),va(!1,he/100),window.setTimeout(()=>{var xe;return(xe=aa.current)==null?void 0:xe.focus()},40),Ba({correct:!1,direction:`quote:${Ce.fragmentId}`,expected:re,answer:me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:L}));return}if(!re)return;const R=ht(re,me,_a),Z=Ia==="exact"&&wa(me)===wa(re),d=nt(R),y=Z||d,S=Ua(R);y?(ce("correct"),Me({}),Oe(!0),ye(R),Xe(0),S<100&&ka<=1&&t(!0),va(!0,S/100),Ba({correct:!0,direction:c?`${c} -> ${re}`:null,expected:re,answer:me,evalType:"text"})):(ce("incorrect"),Me({}),Oe(!1),ye(R),Xe(N=>{const H=N+1;return H>=ka&&Ga&&(t(!0),Oe(!0)),H}),va(!1,S/100),window.setTimeout(()=>{var N;return(N=aa.current)==null?void 0:N.focus()},40),Ba({correct:!1,direction:c?`${c} -> ${re}`:null,expected:re,answer:me,evalType:"text"}))},ut=R=>{if(Da(),!re)return;const Z=ht(re,R,_a),d=wa(R)===wa(re),y=nt(Z),S=d||y,N=Ua(Z);S?(ce("correct"),Me({}),Oe(!0),ye(Z),Xe(0),N<100&&ka<=1&&t(!0),va(!0,N/100),Ba({correct:!0,direction:"word->language",expected:re,answer:R,evalType:"language-select"})):(ce("incorrect"),Me({}),Oe(!1),ye(Z),Xe(H=>{const L=H+1;return L>=ka&&Ga&&(t(!0),Oe(!0)),L}),va(!1,N/100),Ba({correct:!1,direction:"word->language",expected:re,answer:R,evalType:"language-select"}))},Mt=R=>{var d;if(R.key!=="Enter")return;if(R.preventDefault(),R.stopPropagation(),We){ct();return}const Z=le.find(y=>!(Te[y.key]??"").trim());if(Z){(d=Be.current[Z.key])==null||d.focus();return}Ct()},Zt=()=>{Da(),ce("correct"),Oe(!0),Xe(0),va(!0,1),re&&Ba({correct:!0,direction:"manual",expected:re,answer:me,evalType:"manual"})},er=()=>{if(va(!1,0),we&&we.cardType==="info"&&we.infoType==="quote"){ce(null),ve(""),t(!1),Me({}),Oe(!1),ye(null),Xe(0),ge(R=>Math.min(R+1,f.length));return}ct()};i.useEffect(()=>{Da()},[O,f]);const ar=a.cogita.library.revision.revealModeAfterIncorrect,Ga=le.length>0||!!re;return e.jsxs(Na,{copy:a,authLabel:n,showProfileMenu:o,onProfileNavigate:u,onToggleSecureMode:g,onLogout:w,secureMode:p,onNavigate:I,language:M,onLanguageChange:E,children:[(x==="loading"||G==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ne.total?Math.min(100,Math.max(0,ne.current/ne.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ne.total?`${Math.min(ne.current,ne.total)} / ${ne.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:J}),e.jsx("p",{className:"cogita-library-subtitle",children:s}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",Pa).replace("{check}",La)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ma?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Ma.currentLevel??"-"," / ",Ma.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ii,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[X?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:X})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Re?`${Re.kind}-${Re.tick}`:ga?"idle":F??"idle",children:x!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:x==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):we?e.jsx(e.Fragment,{children:Ze?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ri,{copy:a,currentCard:we,currentTypeLabel:Yt,prompt:c,languages:A,answer:me,onAnswerChange:R=>ve(Z=>_t(Z,R,j)),computedExpected:le,computedAnswers:Te,onComputedAnswerChange:(R,Z)=>Ne(d=>({...d,[R]:_t(d[R]??"",Z,j)})),answerTemplate:Qe,outputVariables:Ee,variableValues:la,computedFieldFeedback:Fe,feedback:F,canAdvance:We,quoteContext:Ce,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ct,onSkip:er,onLanguageSelect:ut,onMarkReviewed:Zt,onAdvance:ct,showCorrectAnswer:Y,setShowCorrectAnswer:t,onRevealCorrect:()=>Oe(!0),answerMask:oe,expectedAnswer:re,hasExpectedAnswer:Ga,handleComputedKeyDown:Mt,answerInputRef:aa,computedInputRefs:Be,scriptMode:j,setScriptMode:k,matchPairs:W==null?void 0:W.pairs,matchLeftOrder:W==null?void 0:W.leftOrder,matchRightOrder:W==null?void 0:W.rightOrder,matchSelection:W==null?void 0:W.selection,matchActiveLeft:W==null?void 0:W.activeLeft,matchActiveRight:W==null?void 0:W.activeRight,matchFeedback:Ve,onMatchLeftSelect:Nt,onMatchRightSelect:Lt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:it?`${Aa} / ${it}`:a.cogita.library.revision.progressUnlimited}),x==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),x==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),x==="ready"&&G==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),x==="ready"&&G==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),x==="ready"&&G==="ready"&&f.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:ar}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",ka]})]})]}),Ma?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Ma.activeCount," / ",Ma.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ma.counts.map((R,Z)=>{const d=Z+1,y=Ma.currentLevel===d,S=Ma.percentages[Z]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":y,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:d}),e.jsx("strong",{children:R})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,S))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[S.toFixed(1),"%"]})]},`level-${d}`)})})]}):null,ot?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ot.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ot.dots.map(R=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-R.value))}, ${Math.round(200*R.value)}, 80, 0.9)`}},R.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ot.knownCount})]})]}):null,ca?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Fa})]})}):null]})]})]})})})]})]})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Un},Symbol.toStringTag,{value:"Module"}));export{Jn as C,Yn as a,Qn as b};
