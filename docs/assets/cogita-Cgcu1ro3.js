import{r as n,j as e,u as rn,a as Ja,b as pi,c as fi,d as bi,R as bs,B as ys,C as vs,Q as yi}from"./vendor-CAC2WLor.js";import{L as vi,A as xi,g as Oa,a as Di,b as wi,c as xs,s as Rs,d as ws,e as Bi,f as Un,h as la,i as zi,j as Oi,k as xn,l as wn,m as ji,n as js,o as cs,p as Ui,u as $s,q as ks,r as Ji,t as Qi,v as Hi,w as Wi,x as Gi,y as ki,z as Yi,B as Xi,C as Zi,D as Rn,E as an,F as er,G as tr,H as ar,I as nr,J as sr,K as Ni,M as $n,N as ir,O as rr,P as or,Q as lr,R as cr,S as dr,T as ds,U as Ia,V as Ns,W as Si,X as us,Y as ur,Z as Ti,_ as hr,$ as mr,a0 as gr,a1 as pr,a2 as fr,a3 as br,a4 as yr,a5 as vr,a6 as Ps,a7 as xr,a8 as Es,a9 as Ks,aa as wr,ab as jr,ac as kr,ad as Nr,ae as Sr,af as hs,ag as Tr,ah as Cr,ai as Ir,aj as Mr}from"./recreatio-core-BIYXTfzb.js";import"./vendor-cogita-ui-DTaQ_FiW.js";const Za={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},Ga={moveMs:900,pauseMs:220,errorMs:900},Lr=(t=11)=>{let a=t;const s=()=>(a=(a*1664525+1013904223)%4294967296,a/4294967296),{width:i,height:l,paddingX:u,paddingY:o,levels:x}=Za,h=(l-o*2)/(x.length-1),w=[],d=[],g=[];x.forEach((v,b)=>{const Z=l-o-b*h,P=i-u*2,f=[];for(let q=0;q<v;q+=1){const E=u+(q+1)*P/(v+1),ie=(s()-.5)*18,$=Math.max(u,Math.min(i-u,E+ie)),B=b===0?3:b<2?2.1:1.4,A=b===0?"root":`l${b}-${q}`;f.push({id:A,x:b===0?i/2:$,y:Z,r:B,level:b,role:b===0?"root":void 0})}g.push(f),w.push(...f)});const r=g[g.length-1];if(r!=null&&r.length){const v=r[Math.floor(r.length/2)];v.role="goal",v.r=2}for(let v=1;v<g.length;v+=1){const b=g[v-1];g[v].forEach(P=>{const f=[...b].sort(($,B)=>Math.abs($.x-P.x)-Math.abs(B.x-P.x)),q=f[0],E=f[1]&&s()<.45?f[1]:null;(E?[q,E]:[q]).forEach($=>{d.push({from:$.id,to:P.id,key:`${$.id}-${P.id}`})}),s()<.2&&f[2]&&d.push({from:f[2].id,to:P.id,key:`${f[2].id}-${P.id}`})})}const c=new Map;d.forEach(v=>{const b=c.get(v.to)??[];b.push(v.from),c.set(v.to,b)});const j=new Map,y=new Map,k=new Map;d.forEach(v=>{const b=j.get(v.from)??[];b.push(v.key),j.set(v.from,b);const Z=y.get(v.from)??[];Z.push(v.to),y.set(v.from,Z);const P=k.get(v.from)??[];P.push(v.to),k.set(v.from,P);const f=k.get(v.to)??[];f.push(v.from),k.set(v.to,f)});const C=new Map;return w.forEach(v=>{C.set(v.id,v)}),{nodes:w,links:d,parentsById:c,linksByFrom:j,childrenByFrom:y,neighborsById:k,nodesById:C}};function Ar({slides:t,activeIndex:a,introOpen:s,prefersReducedMotion:i,onNext:l,onPrev:u,onSelect:o,onExit:x,onOpen:h,onRegister:w}){const d=a===t.length-1,g=s&&a===0?"entry":"docked",r=t[t.length-1],[c,j]=n.useState(!1),y=n.useMemo(()=>Array.from({length:20},(we,Le)=>({src:`/cogita/logo/Cogita${String(Le).padStart(2,"0")}.png`,kind:Le<=11?"bubble":Le<=17?"text":"recreatio"})),[]),k=s&&a===0;n.useEffect(()=>{if(!s){j(!1);return}a>0&&!c&&j(!0)},[a,s,c]);const C=n.useRef(0),v=n.useRef(null),b=n.useMemo(()=>{const we={x:40,y:160},Le={x:260,y:48},R=6,_=Le.x-we.x,z=we.y-Le.y,W=_/R,ee=[.3,.45,.6,.65,1.4,2.2],ue=ee.reduce((U,re)=>U+re,0),I=ee.map(U=>z*U/ue),N=[we];let ae=we.x,F=we.y;for(let U=1;U<=R;U+=1){const re=(Math.random()-.5)*14,ve=(Math.random()-.5)*28;ae=Math.max(we.x+U*14,Math.min(Le.x-(R-U)*14,ae+W+re));const X=I[U-1]??I[I.length-1];F=F-X+ve;const de=Math.max(Le.y,Math.min(we.y-4,F));N.push({x:Math.round(ae),y:Math.round(de)})}return N[N.length-1]=Le,N},[]),Z=n.useMemo(()=>{const z=(ue,I,N)=>Math.min(N,Math.max(I,ue)),W=b.map(ue=>{const I=10+Math.random()*36;return{x:z(ue.x,40,260),y:z(ue.y-I,40,140)}}),ee=b.map((ue,I)=>{var F;const N=12+Math.random()*40,ae=((F=W[I])==null?void 0:F.y)??ue.y;return{x:z(ue.x,40,260),y:z(Math.max(ae+10,ue.y+N),60,170)}});return{upper:W,lower:ee}},[b]),P=n.useMemo(()=>{var Le;const we=((Le=b[4])==null?void 0:Le.x)??260;return Math.max(0,Math.min(240,we-40))},[b]),f=n.useMemo(()=>{var I,N;const we=(ae,F,U)=>Math.min(U,Math.max(F,ae)),Le=(ae,F,U)=>b.map((re,ve)=>{var ut,yt;const X=((ut=Z.upper[ve])==null?void 0:ut.y)??re.y,de=((yt=Z.lower[ve])==null?void 0:yt.y)??re.y,$e=(Math.random()-.5)*70,at=re.y+ae+$e,st=we(re.y+F,X+6,de-6),it=we(re.y+U,X+6,de-6);return{x:re.x,y:we(at,Math.min(st,it),Math.max(st,it))}}),R=-14+Math.random()*28,_=14+Math.random()*28,z=Le(R,-80,12),W=Le(_,-12,80);for(let ae=4;ae<b.length;ae+=1){const F=b[ae],U=((I=Z.upper[ae])==null?void 0:I.y)??F.y,re=((N=Z.lower[ae])==null?void 0:N.y)??F.y;z[ae]={x:F.x,y:we(F.y-12,U+6,re-6)},W[ae]={x:F.x,y:we(F.y+12,U+6,re-6)}}const ee=Z.upper.length?Z.upper[Z.upper.length-1].y:40,ue=Z.lower.length?Z.lower[Z.lower.length-1].y:170;return z[z.length-1]={x:b[b.length-1].x,y:we(b[b.length-1].y-14,ee,ue)},W[W.length-1]={x:b[b.length-1].x,y:we(b[b.length-1].y+12,ee,ue)},{higher:z,lower:W}},[b,Z]),q=1e4,E=n.useMemo(()=>{let we=17;const Le=()=>(we=(we*1664525+1013904223)%4294967296,we/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((_,z)=>{const W=(Le()-.5)*240,ee=(Le()-.5)*180,ue=(Le()-.5)*24;return{id:`card-${z+1}`,throw:{x:`${W.toFixed(0)}px`,y:`${ee.toFixed(0)}px`,rot:`${ue.toFixed(1)}deg`},grid:{x:`${_.x}px`,y:`${_.y}px`},delay:`${z*.12}s`}})},[]),ie=n.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[$,B]=n.useState([]),A=n.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),J=n.useMemo(()=>{const Le=[],_=(W,ee)=>W+Math.random()*(ee-W);for(let W=0;W<6;W+=1){let ee=!1;for(let ue=0;ue<80;ue+=1){const I=_(14,86),N=_(10,34);if(Le.every(F=>{const U=F.x-I,re=F.y-N;return Math.hypot(U,re)>=12})){Le.push({x:I,y:N}),ee=!0;break}}ee||Le.push({x:_(16,84),y:_(12,32)})}return Le.map((W,ee)=>({id:`p${ee+1}`,x:`${W.x.toFixed(1)}%`,y:`${W.y.toFixed(1)}%`,xNum:W.x,yNum:W.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[fe,De]=n.useState(0),[Ce,H]=n.useState(0),[Ne,Y]=n.useState([]),me=1e4,Je=n.useMemo(()=>{if(J.length<2)return[];const we=ee=>{let ue=ee+1831565813;return ue=Math.imul(ue^ue>>>15,ue|1),ue^=ue+Math.imul(ue^ue>>>7,ue|61),((ue^ue>>>14)>>>0)/4294967296},Le=(ee,ue)=>Math.floor(we(ee)*ue),R=new Set,_=[],z=Math.min(3,J.length);let W=0;for(;_.length<z&&W<30;){W+=1;const ee=Le(fe*13+W*5,J.length),ue=Le(fe*29+W*7,J.length);if(ee===ue)continue;const I=ee<ue?`${ee}-${ue}`:`${ue}-${ee}`;R.has(I)||(R.add(I),_.push({id:`link-${I}`,from:J[ee],to:J[ue],delay:`${(W*.35).toFixed(2)}s`}))}return _},[fe,J]);n.useEffect(()=>{if(!s||a!==2)return;const we=()=>{const R=E.map(_=>_.id);for(let _=R.length-1;_>0;_-=1){const z=Math.floor(Math.random()*(_+1));[R[_],R[z]]=[R[z],R[_]]}return R.slice(0,4)};B(we());const Le=window.setInterval(()=>{B(we())},q);return()=>window.clearInterval(Le)},[a,s,E,q]),n.useEffect(()=>{if(!s||a!==3)return;const we=()=>{H(Math.floor(Math.random()*A.length)),Y(J.map(()=>Math.random()<.6?"good":"bad")),De(R=>R+1)};we();const Le=window.setInterval(we,me);return()=>window.clearInterval(Le)},[a,s,A.length,J,me]);const qe=n.useMemo(()=>Lr(11),[]),[K,G]=n.useState(new Set(["root"])),[je,O]=n.useState(new Set),[Se,Me]=n.useState(new Set),[Fe,Ze]=n.useState({fromId:"root",toId:"root",key:0}),D=n.useRef(K),ce=n.useRef("root"),He=n.useRef(0),Ee=n.useRef(null),se=n.useRef(null),Xe=n.useRef([]);n.useEffect(()=>{D.current=K},[K]);const pt=n.useMemo(()=>{const we=new Set;return K.forEach(Le=>{const R=qe.linksByFrom.get(Le);R&&R.forEach(_=>we.add(_))}),we},[K,qe]),xt=qe.nodesById.get(Fe.toId)??qe.nodesById.get("root"),Ve=xt?`${xt.x/Za.width*100}%`:"50%",ye=xt?`${xt.y/Za.height*100}%`:"90%";n.useEffect(()=>{if(!s||a!==1||i)return;(()=>{G(new Set(["root"])),O(new Set),Me(new Set),Ze({fromId:"root",toId:"root",key:0}),se.current=null,He.current=0,ce.current="root",Xe.current=[]})();const Le=()=>{const _=ce.current,z=D.current,ee=(qe.childrenByFrom.get(_)??[]).filter(re=>!z.has(re));if(ee.length)return ee[Math.floor(Math.random()*ee.length)];if(z.size>=qe.nodes.length){const re=qe.neighborsById.get(_)??[];return re.length?re[Math.floor(Math.random()*re.length)]:null}const ue=re=>(qe.childrenByFrom.get(re)??[]).some(X=>!z.has(X)),I=[_],N=new Set([_]),ae=new Map;let F=null;for(;I.length;){const re=I.shift();if(!re)break;if(re!==_&&ue(re)){F=re;break}(qe.neighborsById.get(re)??[]).forEach(X=>{N.has(X)||(N.add(X),ae.set(X,re),I.push(X))})}if(!F)return null;let U=F;for(;ae.get(U)&&ae.get(U)!==_;)U=ae.get(U)??U;return U},R=(_,z)=>{if(_===z){const W=Le();W&&R(_,W);return}He.current+=1,Ze({fromId:_,toId:z,key:He.current}),ce.current=z,Ee.current=window.setTimeout(()=>{const W=qe.parentsById.get(z)??[],ee=D.current,ue=W.filter(F=>!ee.has(F));if(!ue.length){const F=new Set(ee);F.add(z),G(F),Ee.current=window.setTimeout(()=>{for(;Xe.current.length;){const re=Xe.current[Xe.current.length-1];if(!F.has(re)){if(re!==z){R(z,re);return}break}Xe.current.pop()}const U=Le();U&&R(z,U)},Ga.pauseMs);return}const I=new Set([z,...ue]),N=new Set(ue.map(F=>`${F}-${z}`));O(I),Me(N),Xe.current.includes(z)||Xe.current.push(z);const ae=ue[Math.floor(Math.random()*ue.length)];se.current={fromId:z,toId:ae},Ee.current=window.setTimeout(()=>{O(new Set),Me(new Set);const F=se.current;F&&R(F.fromId,F.toId)},Ga.errorMs)},Ga.moveMs)};return Ee.current=window.setTimeout(()=>{const _=Le();_&&R(ce.current,_)},Ga.pauseMs),()=>{Ee.current&&window.clearTimeout(Ee.current)}},[a,s,qe,i]);const Qe=we=>{if(!s)return;const Le=Date.now();Le-C.current<520||Math.abs(we.deltaY)<10||(C.current=Le,we.deltaY>0?l():u(),we.preventDefault())},Ue=we=>{if(!s)return;const Le=we.touches[0];Le&&(v.current={x:Le.clientX,y:Le.clientY})},ke=we=>{if(!s)return;const Le=v.current;if(v.current=null,!Le)return;const R=we.changedTouches[0];if(!R)return;const _=R.clientX-Le.x,z=R.clientY-Le.y;Math.abs(z)<40||Math.abs(z)<Math.abs(_)||(z<0?l():u())};return e.jsxs("div",{className:`cogita-intro ${s?"is-open":"is-closed"} ${i?"is-reduced":""} ${d?"is-final":""}`,"data-slide":a+1,onWheel:Qe,onTouchStart:Ue,onTouchEnd:ke,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":g,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${k&&!c?"is-entry":""}`,children:y.map((we,Le)=>e.jsx("img",{src:we.src,alt:"",className:`cogita-logo-layer ${Le===0?"is-base":""} ${we.kind==="text"?"is-text":we.kind==="recreatio"?"is-recreatio":""} ${we.kind==="bubble"?"is-bubble":""}`},we.src))})}),s&&t.map((we,Le)=>{const R=Le===a;return e.jsxs("section",{className:`cogita-intro-slide slide-${Le+1} ${R?"is-active":""}`,"aria-hidden":!R,children:[e.jsxs("div",{className:"cogita-intro-text",children:[we.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:we.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:we.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:we.title}),we.body&&e.jsx("p",{children:we.body.split(`
`).map((_,z)=>e.jsxs("span",{children:[_,z===0&&e.jsx("br",{})]},String(z)))})]}),we.micro&&e.jsx("p",{className:"cogita-intro-micro",children:we.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:d?w:l,children:we.cta}),d&&we.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>o(0),children:we.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[Le===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${Za.width} ${Za.height}`,preserveAspectRatio:"none",children:[qe.links.map(_=>{const z=qe.nodesById.get(_.from),W=qe.nodesById.get(_.to);if(!z||!W)return null;const ee=pt.has(_.key),ue=Se.has(_.key);return e.jsx("line",{className:`map-link ${ee?"is-active":""} ${ue?"is-error":""}`,x1:z.x,y1:z.y,x2:W.x,y2:W.y},_.key)}),qe.nodes.map(_=>{const z=K.has(_.id),W=je.has(_.id);return e.jsx("circle",{className:`map-node ${_.role?`is-${_.role}`:""} ${z?"is-active":""} ${W?"is-error":""}`,cx:_.x,cy:_.y,r:_.r},_.id)})]}),xt&&e.jsx("span",{className:"map-explorer-dot",style:{left:Ve,top:ye,"--move":`${Ga.moveMs}ms`}})]}),Le===2&&e.jsx("div",{className:"cogita-index-cards",children:E.map(_=>{const z=$.indexOf(_.id),W=z>=0?ie[z]:null,ee=(W==null?void 0:W.x)??"140px",ue=(W==null?void 0:W.y)??"140px",I=z>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":_.throw.x,"--throw-y":_.throw.y,"--throw-rot":_.throw.rot,"--grid-x":_.grid.x,"--grid-y":_.grid.y,"--stack-x":ee,"--stack-y":ue,"--stack-opacity":I,"--delay":_.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},_.id)})}),Le===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[A.map((_,z)=>e.jsxs("div",{className:`round-card ${z===Ce?"is-active":""}`,style:{"--card-x":_.x,"--card-y":_.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},_.id)),A[Ce]&&e.jsx("span",{className:"round-ring",style:{"--card-x":A[Ce].x,"--card-y":`calc(${A[Ce].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:J.map(_=>e.jsx("span",{className:"player-dot",style:{left:_.x,top:_.y,"--jitter-x":_.jitterX,"--jitter-y":_.jitterY,"--breath-delay":_.delay}},_.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:Je.map(_=>e.jsx("line",{className:"round-link",x1:_.from.xNum,y1:_.from.yNum,x2:_.to.xNum,y2:_.to.yNum,style:{"--delay":_.delay}},_.id))}),e.jsx("div",{className:"round-flows",children:J.map((_,z)=>{const W=Ne[z]??"good",ee=A[Ce];if(!ee)return null;const ue=`calc(${ee.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":_.x,"--from-y":_.y,"--to-x":ee.x,"--to-y":ue,"--delay":`${z*.12}s`}}),e.jsx("span",{className:`return-dot is-${W}`,style:{"--from-x":ee.x,"--from-y":ue,"--to-x":_.x,"--to-y":_.y,"--delay":`${z*.12}s`}}),e.jsx("span",{className:`result-pop is-${W}`,style:{"--at-x":_.x,"--at-y":_.y,"--delay":`${z*.12}s`}})]},`${_.id}-${fe}`)})})]},`round-${fe}`),Le===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${b[0].x} ${b[0].y} L${b[1].x} ${b[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${b[1].x} ${b[1].y} L${b[2].x} ${b[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${b[2].x} ${b[2].y} L${b[3].x} ${b[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${b[3].x} ${b[3].y} L${b[4].x} ${b[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${b[4].x} ${b[4].y} L${b[5].x} ${b[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${b[5].x} ${b[5].y} L${b[6].x} ${b[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${P};${P};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${Z.upper.map((_,z)=>`${z===0?"M":"L"}${_.x} ${_.y}`).join(" ")} ${Z.lower.slice().reverse().map(_=>`L${_.x} ${_.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${Z.upper.map((_,z)=>`${z===0?"M":"L"}${_.x} ${_.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${Z.lower.map((_,z)=>`${z===0?"M":"L"}${_.x} ${_.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[f.higher.slice(0,6).map((_,z)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${z+1}`,d:`M${_.x} ${_.y} L${f.higher[z+1].x} ${f.higher[z+1].y}`,pathLength:"100"},`peer-1-${z}`)),f.lower.slice(0,6).map((_,z)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${z+1}`,d:`M${_.x} ${_.y} L${f.lower[z+1].x} ${f.lower[z+1].y}`,pathLength:"100"},`peer-2-${z}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${b[0].x/300*100}%`,"--p0y":`${b[0].y/200*100}%`,"--p1x":`${b[1].x/300*100}%`,"--p1y":`${b[1].y/200*100}%`,"--p2x":`${b[2].x/300*100}%`,"--p2y":`${b[2].y/200*100}%`,"--p3x":`${b[3].x/300*100}%`,"--p3y":`${b[3].y/200*100}%`,"--p4x":`${b[4].x/300*100}%`,"--p4y":`${b[4].y/200*100}%`,"--p5x":`${b[5].x/300*100}%`,"--p5y":`${b[5].y/200*100}%`,"--p6x":`${b[6].x/300*100}%`,"--p6y":`${b[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${f.higher[0].x/300*100}%`,"--q0y":`${f.higher[0].y/200*100}%`,"--q1x":`${f.higher[1].x/300*100}%`,"--q1y":`${f.higher[1].y/200*100}%`,"--q2x":`${f.higher[2].x/300*100}%`,"--q2y":`${f.higher[2].y/200*100}%`,"--q3x":`${f.higher[3].x/300*100}%`,"--q3y":`${f.higher[3].y/200*100}%`,"--q4x":`${f.higher[4].x/300*100}%`,"--q4y":`${f.higher[4].y/200*100}%`,"--q5x":`${f.higher[5].x/300*100}%`,"--q5y":`${f.higher[5].y/200*100}%`,"--q6x":`${f.higher[6].x/300*100}%`,"--q6y":`${f.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${f.lower[0].x/300*100}%`,"--q0y":`${f.lower[0].y/200*100}%`,"--q1x":`${f.lower[1].x/300*100}%`,"--q1y":`${f.lower[1].y/200*100}%`,"--q2x":`${f.lower[2].x/300*100}%`,"--q2y":`${f.lower[2].y/200*100}%`,"--q3x":`${f.lower[3].x/300*100}%`,"--q3y":`${f.lower[3].y/200*100}%`,"--q4x":`${f.lower[4].x/300*100}%`,"--q4y":`${f.lower[4].y/200*100}%`,"--q5x":`${f.lower[5].x/300*100}%`,"--q5y":`${f.lower[5].y/200*100}%`,"--q6x":`${f.lower[6].x/300*100}%`,"--q6y":`${f.lower[6].y/200*100}%`}})]})})}),Le===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),Le===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},we.id)}),!s&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:r.title}),r.body&&e.jsx("p",{children:r.body}),r.micro&&e.jsx("p",{className:"cogita-intro-micro",children:r.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,children:r.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:h,children:"Otwórz pokaz"})]})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:t.map((we,Le)=>e.jsx("button",{type:"button",className:`dot ${a===Le?"active":""}`,"aria-label":we.title,onClick:()=>o(Le)},we.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:x,children:"Pomiń"})]})]})}const Rr=6,$r=4;function Pr({copy:t,onAuthAction:a,authLabel:s,showProfileMenu:i,onProfileNavigate:l,onToggleSecureMode:u,onLogout:o,secureMode:x,onNavigate:h,language:w,onLanguageChange:d}){const g=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}h("home")},r=n.useRef(null),c=n.useRef([]),j=n.useMemo(()=>{let Y=Date.now()%2147483647;const me=()=>(Y=Y*48271%2147483647,Y/2147483647);return Array.from({length:Rr},(Je,qe)=>{const K=6+me()*8,G=7+me()*10,je=6+me()*9,O=-me()*K,Se=-me()*G,Me=-me()*je,Fe=.18+me()*.28,Ze=12+me()*18,D=4+me()*8,ce=(me()-.5)*3.2,He=(me()-.5)*3.8,Ee=me()>.5?"alternate":"alternate-reverse",se=me()>.5?"alternate":"alternate-reverse",Xe=me()>.5?"alternate":"alternate-reverse",pt=.18+me()*.42,xt=30+me()*60,Ve=-45-me()*38,ye=188+me()*32,Qe=.1+me()*.2;return{id:`wave-${qe+1}`,style:{"--wave-sway-duration":`${K}s`,"--wave-scale-duration":`${G}s`,"--wave-drift-duration":`${je}s`,"--wave-sway-delay":`${O}s`,"--wave-scale-delay":`${Se}s`,"--wave-drift-delay":`${Me}s`,"--wave-sway-dir":Ee,"--wave-scale-dir":se,"--wave-drift-dir":Xe,"--wave-scale":`${Fe}`,"--wave-shift":`${Ze}%`,"--wave-xshift":`${D}%`,"--wave-x0":`${ce}%`,"--wave-y0":`${He}%`,"--wave-opacity":`${pt}`,"--wave-blur":`${xt}px`,"--wave-bottom":`${Ve}%`,"--wave-hue":`${ye}`,"--wave-glow":`${Qe}`}}})},[]),y=n.useMemo(()=>{let Y=Date.now()*3%2147483647;const me=()=>(Y=Y*48271%2147483647,Y/2147483647);return Array.from({length:$r},(Je,qe)=>{const K=180+me()*220,G=220+me()*280,je=-me()*K,O=-me()*G,Se=.12+me()*.22,Me=3+me()*7,Fe=1+me()*3,Ze=(me()-.5)*2.8,D=(me()-.5)*2.2;return{id:`mesh-${qe+1}`,seed:1e3+qe*991+Math.floor(me()*999),style:{"--mesh-sway-duration":`${K}s`,"--mesh-drift-duration":`${G}s`,"--mesh-sway-delay":`${je}s`,"--mesh-drift-delay":`${O}s`,"--mesh-scale":`${Se}`,"--mesh-shift":`${Me}%`,"--mesh-xshift":`${Fe}%`,"--mesh-x0":`${D}%`,"--mesh-y0":`${Ze}%`}}})},[]),k=n.useMemo(()=>{const Y=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],me=t.cogita.introSlides,Je=new Map(me.map(qe=>[qe.id,qe]));return Y.map(qe=>{var G;const K=Je.get(qe.id);return{...qe,...K,title:(K==null?void 0:K.title)??"Cogita",cta:(K==null?void 0:K.cta)??((G=t.cogita.introSlides[0])==null?void 0:G.cta)??t.cogita.loginCta,secondary:K==null?void 0:K.secondary}})},[t.cogita.introSlides]),[C,v]=n.useState(0),[b,Z]=n.useState(!0),[P,f]=n.useState(!1),q=k.length-1,E=n.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ie=n.useCallback(()=>{E(),a()},[E,a]),$=n.useCallback(()=>{Z(!0),v(0)},[]),B=n.useCallback(()=>{Z(!1),v(q)},[q]),A=n.useCallback(Y=>{v(Math.max(0,Math.min(q,Y)))},[q]),J=n.useCallback(()=>{C>=q?ie():A(C+1)},[C,A,ie,q]),fe=n.useCallback(()=>{A(C-1)},[C,A]);n.useEffect(()=>{var Je;const Y=(Je=window.matchMedia)==null?void 0:Je.call(window,"(prefers-reduced-motion: reduce)");if(!Y)return;const me=()=>f(Y.matches);return me(),Y.addEventListener?(Y.addEventListener("change",me),()=>Y.removeEventListener("change",me)):(Y.addListener(me),()=>Y.removeListener(me))},[]),n.useEffect(()=>{if(!b)return;const Y=me=>{const Je=me.target;if(!Je)return;const qe=Je.tagName;if(!(Je.isContentEditable||qe==="INPUT"||qe==="TEXTAREA"||qe==="SELECT"||qe==="BUTTON"||qe==="A"||Je.closest('button, a, [role="button"], [role="link"]'))){if(me.key==="Escape"){B();return}if(me.key==="ArrowLeft"||me.key==="ArrowUp"){fe();return}(me.key==="ArrowRight"||me.key==="ArrowDown"||me.code==="Space"||me.key===" ")&&(me.preventDefault(),J())}};return window.addEventListener("keydown",Y),()=>window.removeEventListener("keydown",Y)},[B,J,fe,b]),n.useEffect(()=>{b&&C===q&&E()},[C,b,q,E]),n.useEffect(()=>{const Y=r.current;if(!Y)return;const me=c.current.filter(Ve=>!!Ve);if(!me.length)return;const Je=1,qe=.6,K=.6,G=Math.max(1,Math.min(Je,window.devicePixelRatio||1));let je=0,O=0,Se=qe,Me=0,Fe=0;const Ze=Ve=>{let ye=Ve%2147483647;return ye<=0&&(ye+=2147483646),(Qe,Ue)=>{ye=ye*48271%2147483647;const ke=ye/2147483647;return Qe+ke*(Ue-Qe)}},D={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},ce=Ve=>{const ye=Math.sin(Ve*12.9898)*43758.5453;return ye-Math.floor(ye)},He=Ve=>{const ye=ce(Ve+.1)||1e-4,Qe=ce(Ve+.7)||1e-4;return Math.sqrt(-2*Math.log(ye))*Math.cos(2*Math.PI*Qe)},Ee=(Ve,ye)=>{const Qe=Math.floor(Ve),Ue=Qe+1,ke=Ve-Qe,we=ke*ke*(3-2*ke),Le=ce(Qe*12.9898+ye*78.233),R=ce(Ue*12.9898+ye*78.233);return Le+(R-Le)*we},se=Ve=>{const ye=Ze(Ve),Qe=Math.min(4,Math.max(4,Math.floor(je/1200*D.filamentCount)));return Array.from({length:Qe},(Ue,ke)=>{const we=Math.max(-1,Math.min(1,He(Ve+ke*.37))),Le=Math.min(1,Math.max(0,ce(Ve+ke*1.31))),R=Math.min(D.depthLayers-1,Math.floor(Le*D.depthLayers));return{seed:ye(0,Math.PI*2)+Ve*.01,offset:we,freqA:D.freq1*(.75+ye(0,.5)),freqB:D.freq2*(.75+ye(0,.5)),ampA:D.amp1*(.6+ye(0,.7)),ampB:D.amp2*(.6+ye(0,.7)),width:2+ke%5*.32,depth:Le,layer:R}})},Xe=(Ve,ye,Qe)=>{const Ue=Math.max(30,Math.floor(je*O/14e4));Ve.save(),Ve.globalAlpha=.6;for(let ke=0;ke<Ue;ke+=1){const we=ce(ke*9.1+je*.11)*ye+Qe,Le=ce(ke*3.7+O*.23)*O,R=1.2+ce(ke*5.9)*2.4,_=Ve.createRadialGradient(we,Le,0,we,Le,R*2);_.addColorStop(0,"rgba(10, 30, 60, 0.45)"),_.addColorStop(1,"rgba(10, 30, 60, 0)"),Ve.fillStyle=_,Ve.beginPath(),Ve.arc(we,Le,R*2,0,Math.PI*2),Ve.fill()}Ve.restore()},pt=(Ve,ye)=>{Ve.clearRect(0,0,je,O);const Qe=O*D.waveCenter,Ue=D.waveBandPx,ke=D.segments,we=D.colors.filaments,Le=Me||je,R=0;Xe(Ve,Le,R),Ve.strokeStyle=we,Ve.lineCap="round",Ve.lineJoin="round";for(let _=0;_<ye.length;_+=1){const z=ye[_],W=z.offset*Ue*(.85+ce(z.seed)*.4),ee=1-Math.min(1,Math.abs(W)/Ue),ue=Math.exp(-Math.pow(W/D.crestThickness,2)),I=z.layer===0?1.1:z.layer===1?.85:.6,N=.35+(1-z.depth)*.65,ae=ee*N*I*(.34+ue*.45);Ve.globalAlpha=ae,Ve.lineWidth=z.width*(1+(1-z.depth)*.8);const F=[];for(let re=0;re<=ke;re+=1){const ve=re/ke*Le+R,X=(Ee(ve*.012,z.seed)-.5)*D.xJitter,de=ve+X,$e=(Ee(de*z.freqA,z.seed)-.5)*D.jitterA,at=(Ee(de*z.freqB,z.seed*1.7)-.5)*D.jitterB,st=Qe+Math.sin(de*z.freqA+z.seed)*z.ampA+Math.sin(de*z.freqB+z.seed*1.3)*z.ampB+W+$e+at;F.push({x:de,y:st})}Ve.beginPath(),Ve.moveTo(F[0].x,F[0].y);for(let re=1;re<F.length-1;re+=1){const ve=(F[re].x+F[re+1].x)/2,X=(F[re].y+F[re+1].y)/2;Ve.quadraticCurveTo(F[re].x,F[re].y,ve,X)}const U=F[F.length-1];Ve.quadraticCurveTo(U.x,U.y,U.x,U.y),Ve.stroke()}Ve.save(),Ve.globalCompositeOperation="lighter",Ve.strokeStyle=D.colors.glow,Ve.lineCap="round",Ve.lineJoin="round";for(let _=0;_<ye.length;_+=1){const z=ye[_];if(Math.abs(z.offset)*Ue>D.crestThickness)continue;const W=D.glowAlpha*(.7+(1-z.depth)*.6);Ve.globalAlpha=W,Ve.lineWidth=1.6+(1-z.depth)*1.2;const ee=[];for(let I=0;I<=ke;I+=1){const N=I/ke*Le+R,ae=Math.sin(N*.02+z.seed)*3,F=Qe+Math.sin(N*z.freqA+z.seed)*z.ampA+Math.sin(N*z.freqB+z.seed*1.3)*z.ampB+z.offset*Ue*.35+ae;ee.push({x:N,y:F})}Ve.beginPath(),Ve.moveTo(ee[0].x,ee[0].y);for(let I=1;I<ee.length-1;I+=1){const N=(ee[I].x+ee[I+1].x)/2,ae=(ee[I].y+ee[I+1].y)/2;Ve.quadraticCurveTo(ee[I].x,ee[I].y,N,ae)}const ue=ee[ee.length-1];Ve.quadraticCurveTo(ue.x,ue.y,ue.x,ue.y),Ve.stroke()}Ve.restore()},xt=()=>{je=Math.floor(Y.clientWidth),O=Math.floor(Y.clientHeight),Me=Math.floor(je*1.8),Fe=O,Se=je<820?K:qe,me.forEach(Ve=>{const ye=Ve.getContext("2d");if(!ye)return;Ve.width=Math.floor(Me*G*Se),Ve.height=Math.floor(Fe*G*Se),Ve.style.width=`${Me}px`,Ve.style.height=`${Fe}px`,Ve.style.left=`${-(Me-je)/2}px`,ye.setTransform(G*Se,0,0,G*Se,0,0);const Qe=Number(Ve.dataset.seed||1),Ue=se(Qe);pt(ye,Ue)})};return xt(),window.addEventListener("resize",xt,{passive:!0}),()=>window.removeEventListener("resize",xt)},[y]);const De=k[Math.min(C,k.length-1)],Ce=b?De:k[k.length-1],H=(Ce==null?void 0:Ce.theme)??k[0].theme,Ne={"--cogita-bg0":H.bg0,"--cogita-bg1":H.bg1,"--cogita-bg2":H.bg2,"--cogita-bloom":H.bloom,"--cogita-sat":H.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:g,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(vi,{value:w,onChange:d}),e.jsx(xi,{copy:t,label:s,isAuthenticated:i,secureMode:x,onLogin:a,onProfileNavigate:l,onToggleSecureMode:u,onLogout:o,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:r,className:"cogita-section cogita-home",style:Ne,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[y.map((Y,me)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:Y.style,"data-seed":Y.seed,ref:Je=>{c.current[me]=Je}},Y.id)),j.map(Y=>e.jsx("div",{className:"cogita-home-wave",style:Y.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},Y.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Ar,{slides:k,activeIndex:C,introOpen:b,prefersReducedMotion:P,onNext:J,onPrev:fe,onSelect:A,onExit:B,onOpen:$,onRegister:ie})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const bl=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Pr},Symbol.toStringTag,{value:"Module"})),Ci=n.createContext(!1);function Et({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,headerExtra:d,children:g}){if(n.useContext(Ci))return e.jsx(e.Fragment,{children:g});const c=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}x("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:c,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(vi,{value:h,onChange:w}),e.jsxs("div",{className:"cogita-header-right",children:[d,e.jsx(xi,{copy:t,label:a,isAuthenticated:s,secureMode:o,onLogin:()=>x("home"),onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,variant:"ghost"})]})]}),e.jsx("main",{className:"cogita-main",children:g}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const ms=new Map;let Ya=null;const gn=new Map,Jn=new Map,gs=new Map,Qn=new Map;async function Er(){if(Ya){await Ya;return}Ya=wi().then(t=>{t.forEach(a=>{ms.set(a.libraryId,a.name)})}).catch(()=>{}).finally(()=>{Ya=null}),await Ya}async function Kr(t){const a=ms.get(t);return a||(await Er(),ms.get(t)??null)}async function Fr(t){if(gn.has(t))return gn.get(t)??null;const a=Jn.get(t);if(a)return a;const s=Di(t).then(i=>(gn.set(t,i),i)).catch(()=>(gn.set(t,null),null)).finally(()=>{Jn.delete(t)});return Jn.set(t,s),s}async function _r(t){const a=gs.get(t);if(a)return a;const s=Qn.get(t);if(s)return s;const i=Oa({libraryId:t,limit:200}).then(l=>(gs.set(t,l.items),l.items)).catch(()=>[]).finally(()=>{Qn.delete(t)});return Qn.set(t,i),i}function Fs(t,a){gs.set(t,a)}function xa(t){const[a,s]=n.useState("Cogita library"),[i,l]=n.useState(null);return n.useEffect(()=>{let u=!1;return Kr(t).then(o=>{u||!o||s(o)}).catch(()=>{u||s("Cogita library")}),()=>{u=!0}},[t]),n.useEffect(()=>{let u=!1;return Fr(t).then(o=>{u||l(o)}).catch(()=>{u||l(null)}),()=>{u=!0}},[t]),{libraryName:a,stats:i}}function _s({slices:t}){const a=t.reduce((i,l)=>i+Math.max(0,l.value),0),s=n.useMemo(()=>{if(a<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let i=0;return`conic-gradient(${t.map(u=>{const x=Math.max(0,u.value)/a*360,h=i,w=i+x;return i=w,`${u.color} ${h}deg ${w}deg`}).join(",")})`},[t,a]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:s}}),e.jsx("div",{className:"cogita-overview-legend",children:t.map(i=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:i.color}}),e.jsx("strong",{children:i.value}),e.jsx("small",{children:i.label})]},i.label))})]})}function Vr({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d}){const{libraryName:g,stats:r}=xa(d),[c,j]=n.useState("infos"),[y,k]=n.useState(0),[C,v]=n.useState(0),[b,Z]=n.useState(0),P=(r==null?void 0:r.totalInfos)??0,f=(r==null?void 0:r.totalCollections)??0,q=0,E=0,ie=0,$=Math.max(0,P-ie-C),B=Math.max(0,P-C-b);n.useEffect(()=>{let J=!1;return(async()=>{try{const De=await Oa({libraryId:d,limit:200}),Ce=await Promise.all(De.items.map(H=>xs({libraryId:d,collectionId:H.collectionId}).catch(()=>[])));if(J)return;k(Ce.reduce((H,Ne)=>H+Ne.length,0))}catch{J||k(0)}})(),()=>{J=!0}},[d]),n.useEffect(()=>{let J=!1;return(async()=>{try{const[De,Ce,H]=await Promise.all([Rs({libraryId:d,type:"computed",limit:1}).catch(()=>({total:0})),Rs({libraryId:d,type:"source",limit:1}).catch(()=>({total:0})),ws({libraryId:d}).catch(()=>({items:[]}))]);if(J)return;v((De.total??0)+(Ce.total??0));const Ne=new Set(H.items.filter(Y=>Y.childItemType.toLowerCase()==="info").map(Y=>Y.childItemId).filter(Boolean));Z(Ne.size)}catch{J||(v(0),Z(0))}})(),()=>{J=!0}},[d]);const A=[{key:"infos",label:t.cogita.library.overview.stats.totalInfos,value:P},{key:"collections",label:t.cogita.library.overview.stats.collections,value:f},{key:"revisions",label:t.cogita.library.overview.stats.revisions,value:y},{key:"storyboards",label:t.cogita.library.overview.stats.storyboards,value:q},{key:"texts",label:t.cogita.library.overview.stats.texts,value:E}];return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:g})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:A.map(J=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${c===J.key?"active":""}`,onClick:()=>j(J.key),children:[e.jsx("span",{children:J.label}),e.jsx("strong",{children:J.value})]},J.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:t.cogita.library.overview.statsCardTitle})}),c==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.knownChartTitle}),e.jsx(_s,{slices:[{label:t.cogita.library.overview.known,value:ie,color:"#75d79a"},{label:t.cogita.library.overview.unknown,value:$,color:"#85b9ff"},{label:t.cogita.library.overview.excluded,value:C,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.checksChartTitle}),e.jsx(_s,{slices:[{label:t.cogita.library.overview.availableChecks,value:b,color:"#75d79a"},{label:t.cogita.library.overview.unavailableChecks,value:B,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:t.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]})]})})]})})}const bt=(t,a)=>{const s=t.cogita.library.infoTypes,i=t.cogita.library.connectionTypes,l=t.cogita.library.groupTypes;return{any:s.any,vocab:s.vocab,book:l.book,citation:l.citation,language:s.language,word:s.word,sentence:s.sentence,topic:s.topic,collection:s.collection,person:s.person,institution:s.institution,collective:s.collective,orcid:s.orcid,address:s.address,email:s.email,phone:s.phone,media:s.media,work:s.work,geo:s.geo,music_piece:s.musicPiece,music_fragment:s.musicFragment,source:s.source,question:s.question,computed:s.computed,"word-language":i.wordLanguage,"citation-language":i.citationLanguage,"language-sentence":i.languageSentence,translation:i.translation,"word-topic":i.wordTopic,reference:i.reference,"source-resource":i.sourceResource,"work-contributor":i.workContributor,"work-medium":i.workMedium,"orcid-link":i.orcidLink}[a]??String(a)},qr=t=>[{value:"any",label:bt(t,"any")},{value:"language",label:bt(t,"language")},{value:"word",label:bt(t,"word")},{value:"sentence",label:bt(t,"sentence")},{value:"topic",label:bt(t,"topic")},{value:"collection",label:bt(t,"collection")},{value:"person",label:bt(t,"person")},{value:"institution",label:bt(t,"institution")},{value:"collective",label:bt(t,"collective")},{value:"orcid",label:bt(t,"orcid")},{value:"address",label:bt(t,"address")},{value:"email",label:bt(t,"email")},{value:"phone",label:bt(t,"phone")},{value:"media",label:bt(t,"media")},{value:"work",label:bt(t,"work")},{value:"geo",label:bt(t,"geo")},{value:"music_piece",label:bt(t,"music_piece")},{value:"music_fragment",label:bt(t,"music_fragment")},{value:"source",label:bt(t,"source")},{value:"question",label:bt(t,"question")},{value:"citation",label:bt(t,"citation")},{value:"computed",label:bt(t,"computed")},{value:"vocab",label:bt(t,"vocab")},{value:"book",label:bt(t,"book")},{value:"word-language",label:bt(t,"word-language")},{value:"citation-language",label:bt(t,"citation-language")},{value:"language-sentence",label:bt(t,"language-sentence")},{value:"translation",label:bt(t,"translation")},{value:"word-topic",label:bt(t,"word-topic")},{value:"reference",label:bt(t,"reference")},{value:"source-resource",label:bt(t,"source-resource")},{value:"work-contributor",label:bt(t,"work-contributor")},{value:"work-medium",label:bt(t,"work-medium")},{value:"orcid-link",label:bt(t,"orcid-link")}],Dr=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}],Hn={key:"languageId",labelKey:"language",kind:"select",path:"languageId",optionsSource:"languages",matcher:"equals"},Br={language:{infoType:"language",entityKind:"single",structure:{payloadFields:["label","name","code"]},filterFields:[]},word:{infoType:"word",entityKind:"single",structure:{payloadFields:["label","lemma","languageId"],connections:[{relationType:"word-language",role:"language",targetType:"language"}]},filterFields:[Hn]},sentence:{infoType:"sentence",entityKind:"single",structure:{payloadFields:["label","text","languageId"],connections:[{relationType:"language-sentence",role:"language",targetType:"language"}]},filterFields:[Hn]},topic:{infoType:"topic",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},collection:{infoType:"collection",entityKind:"complex",structure:{payloadFields:["label","name"]},filterFields:[]},person:{infoType:"person",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},institution:{infoType:"institution",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},collective:{infoType:"collective",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},orcid:{infoType:"orcid",entityKind:"single",structure:{payloadFields:["label","orcid"]},filterFields:[{key:"orcid",label:"ORCID",kind:"text",path:"orcid",matcher:"contains"}]},address:{infoType:"address",entityKind:"single",structure:{payloadFields:["label","street","city","postalCode","country"]},filterFields:[]},email:{infoType:"email",entityKind:"single",structure:{payloadFields:["label","email","address"]},filterFields:[]},phone:{infoType:"phone",entityKind:"single",structure:{payloadFields:["label","phone","number"]},filterFields:[]},media:{infoType:"media",entityKind:"single",structure:{payloadFields:["label","name","url","kind"]},filterFields:[]},work:{infoType:"work",entityKind:"single",structure:{payloadFields:["label","title","subtitle","doi","isbn","issn","languageId","originalLanguageId"]},filterFields:[Hn,{key:"originalLanguageId",labelKey:"originalLanguage",kind:"select",path:"originalLanguageId",optionsSource:"languages",matcher:"equals"},{key:"doi",labelKey:"doi",kind:"text",path:"doi",matcher:"contains"}]},geo:{infoType:"geo",entityKind:"single",structure:{payloadFields:["label","name","country","region","city"]},filterFields:[]},music_piece:{infoType:"music_piece",entityKind:"single",structure:{payloadFields:["label","title","composer"]},filterFields:[]},music_fragment:{infoType:"music_fragment",entityKind:"single",structure:{payloadFields:["label","title","text"]},filterFields:[]},source:{infoType:"source",entityKind:"single",structure:{payloadFields:["label","title","sourceKind","locator"],connections:[{relationType:"source-resource",role:"resource",targetType:"work"}]},filterFields:[{key:"sourceKind",labelKey:"sourceKind",kind:"select",path:"sourceKind",optionsSource:"sourceKinds",matcher:"equals"},{key:"locator",labelKey:"locator",kind:"text",path:"locator",matcher:"locator_contains"}]},citation:{infoType:"citation",entityKind:"single",structure:{payloadFields:["title","text"],connections:[{relationType:"citation-language",role:"language",targetType:"language"},{relationType:"reference",role:"source",targetType:"source"}]},filterFields:[{key:"text",labelKey:"citationText",kind:"text",path:"text",matcher:"contains"}]},question:{infoType:"question",entityKind:"single",structure:{payloadFields:["definition"]},filterFields:[{key:"questionType",labelKey:"type",kind:"text",path:"definition.type",matcher:"contains"},{key:"questionText",labelKey:"text",kind:"text",path:"definition.question",matcher:"contains"}]},computed:{infoType:"computed",entityKind:"complex",structure:{payloadFields:["label","title","definition"]},filterFields:[]},translation:{infoType:"translation",entityKind:"connection",structure:{payloadFields:["note","tagIds"],connections:[{relationType:"translation",role:"wordA",targetType:"word"},{relationType:"translation",role:"wordB",targetType:"word"},{relationType:"word-language",role:"languageA",targetType:"language"},{relationType:"word-language",role:"languageB",targetType:"language"}]},filterFields:[{key:"languageAId",labelKey:"languageA",kind:"select",optionsSource:"languages",matcher:"equals"},{key:"languageBId",labelKey:"languageB",kind:"select",optionsSource:"languages",matcher:"equals"}]}},Vs={infoType:"default",entityKind:"single",structure:{payloadFields:["label"]},filterFields:[]};function zr(t){return t?Br[t]??Vs:Vs}function Or(t,a){return t.optionsSource==="languages"?a.languages.map(s=>({value:s.infoId,label:s.label})):t.optionsSource==="sourceKinds"?Dr:[]}const Ur="cogita.revision.seed:";function Ii(t){return`${Ur}${t}`}function Jr(t,a){if(typeof window>"u")return null;const s=Array.from(new Set(a.map(u=>u.trim()).filter(Boolean)));if(!s.length)return null;const i=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,l={kind:"info-selection",libraryId:t,infoIds:s,createdAt:new Date().toISOString()};return window.localStorage.setItem(Ii(i),JSON.stringify(l)),i}function qs(t,a){if(typeof window>"u")return null;const s=window.localStorage.getItem(Ii(a));if(!s)return null;try{const i=JSON.parse(s);if(i.kind!=="info-selection"||i.libraryId!==t||!Array.isArray(i.infoIds))return null;const l=i.infoIds.map(u=>String(u??"").trim()).filter(Boolean);return l.length?{infoIds:l}:null}catch{return null}}const Qr="cogita.collection-draft:";function Mi(t){return`${Qr}${t}`}function Hr(t,a){if(typeof window>"u")return null;const s=Array.from(new Set(a.map(u=>u.trim()).filter(Boolean)));if(!s.length)return null;const i=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,l={kind:"info-selection",libraryId:t,infoIds:s,createdAt:new Date().toISOString()};return window.localStorage.setItem(Mi(i),JSON.stringify(l)),i}function Wr(t,a){if(typeof window>"u")return null;const s=window.localStorage.getItem(Mi(a));if(!s)return null;try{const i=JSON.parse(s);if(i.kind!=="info-selection"||i.libraryId!==t||!Array.isArray(i.infoIds))return null;const l=i.infoIds.map(u=>String(u??"").trim()).filter(Boolean);return l.length?{infoIds:l}:null}catch{return null}}const Wn=60,Gr=500;function Li(t){return`cogita.info-selection:${t}`}function Ds(t){if(typeof window>"u")return{};const a=window.localStorage.getItem(Li(t));if(!a)return{};try{const s=JSON.parse(a);return!s||typeof s!="object"?{}:s}catch{return{}}}function Yr({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,mode:g}){var ot;const r=rn(),c=Ja(),j=t.cogita.library.list,[y,k]=n.useState("any"),[C,v]=n.useState(""),[b,Z]=n.useState("relevance"),[P,f]=n.useState("details"),[q,E]=n.useState(!1),[ie,$]=n.useState("idle"),[B,A]=n.useState([]),[J,fe]=n.useState(Wn),[De,Ce]=n.useState(null),[H,Ne]=n.useState(()=>Ds(d)),[Y,me]=n.useState({}),[Je,qe]=n.useState([]),[K,G]=n.useState([]),[je,O]=n.useState(null),[Se,Me]=n.useState(null),[Fe,Ze]=n.useState(null),[D,ce]=n.useState("idle"),[He,Ee]=n.useState([]),[se,Xe]=n.useState(""),[pt,xt]=n.useState(null),[Ve,ye]=n.useState("idle"),[Qe,Ue]=n.useState(null),[ke,we]=n.useState(null),[Le,R]=n.useState("idle"),[_,z]=n.useState([]),[W,ee]=n.useState("idle"),ue=n.useMemo(()=>qr(t),[t]),I=n.useMemo(()=>[{value:"relevance",label:j.sortRelevance},{value:"label_asc",label:j.sortLabelAsc},{value:"label_desc",label:j.sortLabelDesc},{value:"type_asc",label:j.sortTypeAsc},{value:"type_desc",label:j.sortTypeDesc}],[j.sortLabelAsc,j.sortLabelDesc,j.sortRelevance,j.sortTypeAsc,j.sortTypeDesc]);n.useEffect(()=>{Ne(Ds(d)),me({}),E(!1)},[d]),n.useEffect(()=>{ws({libraryId:d}).then(S=>Ze(S)).catch(()=>Ze({items:[]}))},[d]),n.useEffect(()=>{Bi({libraryId:d}).then(S=>Ee(S)).catch(()=>Ee([]))},[d]),n.useEffect(()=>{Un({libraryId:d,type:"language",filters:{sourceKind:"info"},limit:200}).then(S=>{const Te=S.map(nt=>({infoId:nt.infoId??"",infoType:nt.entityType,label:nt.title})).filter(nt=>nt.infoId.length>0);qe(Te)}).catch(()=>qe([]))},[d]),n.useEffect(()=>{Un({libraryId:d,type:"source",filters:{sourceKind:"info"},limit:200}).then(S=>{const Te=S.map(nt=>({infoId:nt.infoId??"",infoType:nt.entityType,label:nt.title})).filter(nt=>nt.infoId.length>0);G(Te)}).catch(()=>G([]))},[d]),n.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Li(d),JSON.stringify(H))},[d,H]);const N=n.useMemo(()=>zr(y==="any"?null:y),[y]),ae=n.useMemo(()=>c.pathname.split("/").filter(Boolean),[c.pathname]),F=ae.findIndex(S=>S==="infos"),U=F>=0&&(ae[F+1]??"").trim()||null,re=F>=0?(ae[F+2]??"").trim():"",ve=F>=0?re==="checkcards"?"cards":re==="collections"?"collections":"overview":"",X=U,de=U?ve:"",$e=de==="overview"&&!!X,at=de==="collections"&&!!X,st=n.useMemo(()=>({language:j.typeFilterLanguage,languageA:j.typeFilterLanguageA,languageB:j.typeFilterLanguageB,originalLanguage:j.typeFilterOriginalLanguage,doi:j.typeFilterDoi,sourceKind:j.typeFilterSourceKind,locator:j.typeFilterLocator,citationText:j.typeFilterCitationText}),[j.typeFilterDoi,j.typeFilterLanguage,j.typeFilterLanguageA,j.typeFilterLanguageB,j.typeFilterLocator,j.typeFilterOriginalLanguage,j.typeFilterCitationText,j.typeFilterSourceKind]),it=n.useMemo(()=>N.filterFields.map(S=>({...S,label:S.labelKey?st[S.labelKey]:S.label??S.key,options:Or(S,{languages:Je})})),[st,Je,N.filterFields]),ut=n.useMemo(()=>it.some(S=>(Y[S.key]??"").trim().length>0),[it,Y]);n.useEffect(()=>{me({})},[y]),n.useEffect(()=>{const S={sourceKind:"info"};if(ut)for(const p of it){const be=(Y[p.key]??"").trim();be&&(S[p.path??p.key]=be)}const Te=(Y.__referenceId??"").trim();Te&&(S["link.references"]=Te),$("loading");const nt=window.setTimeout(()=>{Un({libraryId:d,type:y==="any"?void 0:y,query:C.trim()||void 0,filters:S,limit:Gr}).then(p=>{const be=p.map(L=>({infoId:L.infoId??"",infoType:L.entityType,label:L.title})).filter(L=>L.infoId.length>0);A(be),$("ready")}).catch(()=>{A([]),$("ready")})},240);return()=>window.clearTimeout(nt)},[ut,d,C,y,it,Y]),n.useEffect(()=>{if(!X||de!=="overview"&&de!=="collections"){O(null),Me(null),ce("idle");return}let S=!1;return ce("loading"),Promise.all([la({libraryId:d,infoId:X}),zi({libraryId:d,itemType:"info",itemId:X}).catch(()=>null)]).then(([Te,nt])=>{S||(O(Te),Me(nt),ce("ready"))}).catch(()=>{S||(O(null),Me(null),ce("error"))}),()=>{S=!0}},[d,X,de]),n.useEffect(()=>{if(!X||de!=="collections"){z([]),ee("idle");return}let S=!1;return ee("loading"),Oi({libraryId:d,infoId:X}).then(Te=>{S||(z(Te),ee("ready"))}).catch(()=>{S||(z([]),ee("error"))}),()=>{S=!0}},[d,X,de]),n.useEffect(()=>{if(!X||de!=="overview"){Ue(null),we(null),R("idle");return}let S=!1;return R("loading"),Promise.all([xn({libraryId:d,infoId:X}),wn({libraryId:d,infoId:X})]).then(([Te,nt])=>{S||(Ue(Te),we(nt),R("ready"))}).catch(()=>{S||(Ue(null),we(null),R("error"))}),()=>{S=!0}},[d,X,de]);const yt=n.useMemo(()=>je?He.filter(S=>S.sourceInfoTypes.some(Te=>Te.toLowerCase()===je.infoType.toLowerCase())):[],[He,je]);n.useEffect(()=>{if(!je){Xe("");return}Xe(S=>{var Te;return S&&yt.some(nt=>nt.approachKey===S)?S:((Te=yt[0])==null?void 0:Te.approachKey)??""})},[yt,je]),n.useEffect(()=>{if(!je||!se){xt(null),ye("idle");return}let S=!1;return ye("loading"),ji({libraryId:d,infoId:je.infoId,approachKey:se}).then(Te=>{S||(xt(Te),ye("ready"))}).catch(()=>{S||(xt(null),ye("error"))}),()=>{S=!0}},[d,se,je]);const ht=n.useMemo(()=>{const S=B.slice(),Te=nt=>bt(t,nt);return b==="relevance"?S:b==="label_asc"?S.sort((nt,p)=>nt.label.localeCompare(p.label)):b==="label_desc"?S.sort((nt,p)=>p.label.localeCompare(nt.label)):b==="type_asc"?S.sort((nt,p)=>nt.infoType===p.infoType?nt.label.localeCompare(p.label):Te(nt.infoType).localeCompare(Te(p.infoType))):S.sort((nt,p)=>nt.infoType===p.infoType?nt.label.localeCompare(p.label):Te(p.infoType).localeCompare(Te(nt.infoType)))},[t,B,b]),Ge=n.useMemo(()=>ht.slice(0,J),[ht,J]),We=Ge.length<ht.length,vt=n.useMemo(()=>new Set(Object.keys(H)),[H]),Oe=n.useMemo(()=>Object.values(H),[H]),ct=n.useMemo(()=>{const S=new Map;for(const Te of Oe)S.set(Te.infoType,(S.get(Te.infoType)??0)+1);return Array.from(S.entries()).sort((Te,nt)=>nt[1]-Te[1]||Te[0].localeCompare(nt[0]))},[Oe]),$t=n.useMemo(()=>{if(!X||!Fe)return 0;const S=new Set;for(const Te of Fe.items)Te.childItemType!=="info"||Te.childItemId!==X||S.add([Te.parentItemType,Te.parentItemId,Te.parentCheckType??"",Te.parentDirection??""].join("|"));return S.size},[Fe,X]);n.useEffect(()=>{fe(Wn);const S=new Set(B.map(Te=>Te.infoId));Ce(Te=>Te&&S.has(Te)?Te:null)},[B]);const Mt=S=>{Ne(Te=>({...Te,[S.infoId]:{infoId:S.infoId,infoType:S.infoType,label:S.label}}))},ft=S=>{Ne(Te=>{if(!Te[S])return Te;const nt={...Te};return delete nt[S],nt})},Kt=(S,Te)=>{if(Te){Mt(S);return}ft(S.infoId)},Bt=S=>{r(`/cogita/library/${d}/infos/${encodeURIComponent(S)}`,{replace:!0})},kt=()=>{r(`/cogita/library/${d}/infos`,{replace:!0})},zt=()=>{X&&r(`/cogita/library/${d}/infos/${encodeURIComponent(X)}/edit`,{replace:!0})},ea=()=>{const S=Jr(d,Oe.map(Te=>Te.infoId));S&&r(`/cogita/library/${d}/revisions/run?scope=info-selection&seed=${encodeURIComponent(S)}`)},Na=()=>{const S=Hr(d,Oe.map(Te=>Te.infoId));S&&r(`/cogita/library/${d}/collections/new?draft=${encodeURIComponent(S)}&draftType=info-selection`)},Lt=Oe.length===1?((ot=Oe[0])==null?void 0:ot.infoId)??null:null,ca=j.selectionCount.replace("{count}",String(Oe.length)),It=g==="collection"?"grid":g==="detail"?"wide":P,lt=Zr(h),Vt=Se?Math.max(0,Math.min(100,Math.round((Se.score??0)*100))):0,qt=Se?eo(Se,lt):lt.noKnownnessData;return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":It,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[$e?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:lt.kicker}),e.jsx("h2",{className:"cogita-card-title",children:je?Bs(je.payload,je.infoType,je.infoId):lt.loading}),je?e.jsxs("p",{className:"cogita-card-subtitle",children:[bt(t,je.infoType)," · ",je.infoId]}):null]}),e.jsxs("div",{className:"cogita-info-overview-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:kt,children:lt.backToSearch}),e.jsx("button",{type:"button",className:"cta",onClick:zt,disabled:!X||D!=="ready",children:j.editInfo})]})]}),D==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:lt.loading})}):D==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:lt.loadError})}):je?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-info-overview-metrics",children:[e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:lt.knownness}),e.jsxs("div",{className:"cogita-info-metric-value",children:[Vt,"%"]}),e.jsx("div",{className:"cogita-info-progress","aria-hidden":"true",children:e.jsx("span",{style:{width:`${Vt}%`}})}),e.jsx("p",{className:"cogita-library-hint",children:qt})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:lt.reviews}),e.jsx("div",{className:"cogita-info-metric-value",children:(Se==null?void 0:Se.totalReviews)??0}),e.jsx("p",{className:"cogita-library-hint",children:lt.correct.replace("{correct}",String((Se==null?void 0:Se.correctReviews)??0)).replace("{total}",String((Se==null?void 0:Se.totalReviews)??0))}),e.jsx("p",{className:"cogita-library-hint",children:Se!=null&&Se.lastReviewedUtc?`${lt.lastReview}: ${Xr(Se.lastReviewedUtc,h)}`:lt.noLastReview})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:lt.linkedCards}),e.jsx("div",{className:"cogita-info-metric-value",children:$t}),e.jsx("p",{className:"cogita-library-hint",children:lt.linkedCardsHint})]})]}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:lt.checkcards}),Le==="loading"?e.jsx("p",{className:"cogita-library-hint",children:lt.loadingCheckcards}):Le==="error"?e.jsx("p",{className:"cogita-library-hint",children:lt.loadCheckcardsError}):e.jsxs("div",{className:"cogita-info-tree",children:[e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:lt.checkcardCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(Qe==null?void 0:Qe.items.length)??0})]}),e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:lt.dependencyCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(ke==null?void 0:ke.items.length)??0})]})]})]}),yt.length>0?e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsxs("div",{className:"cogita-info-approach-header",children:[e.jsx("h3",{children:lt.approach}),e.jsx("select",{value:se,onChange:S=>Xe(S.target.value),"aria-label":lt.approach,children:yt.map(S=>e.jsx("option",{value:S.approachKey,children:S.label},S.approachKey))})]}),Ve==="loading"?e.jsx("p",{className:"cogita-library-hint",children:lt.loadingApproach}):Ve==="error"?e.jsx("p",{className:"cogita-library-hint",children:lt.loadApproachError}):pt?e.jsx(jn,{value:pt.projection,emptyLabel:lt.empty}):e.jsx("p",{className:"cogita-library-hint",children:lt.noApproachData})]}):null,e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:lt.payload}),e.jsx(jn,{value:je.payload,emptyLabel:lt.empty})]}),e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:lt.links}),e.jsx(to,{links:je.links,emptyLabel:lt.noLinks})]})]})]}):null]})}):null,at?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Informacja"}),e.jsx("h2",{className:"cogita-card-title",children:je?Bs(je.payload,je.infoType,je.infoId):X??""}),e.jsx("p",{className:"cogita-card-subtitle",children:"Collections using this info"})]}),e.jsx("div",{className:"cogita-info-overview-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:kt,children:"Back to search"})})]}),W==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading collections..."})}):null,W==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load collections."})}):null,W==="ready"&&_.length===0?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"This info is not used in any collection yet."})}):null,W==="ready"&&_.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:_.map(S=>e.jsx("article",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`/#/cogita/library/${d}/collections/${S.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:"Collection"}),e.jsx("h3",{className:"cogita-card-title",children:S.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[S.itemCount," items"]})]})},S.collectionId))}):null]})}):null,!$e&&!at?e.jsxs("section",{className:"cogita-library-search-surface",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":j.typeLabel,value:y,onChange:S=>k(S.target.value),children:ue.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))}),e.jsx("input",{type:"text",value:C,onChange:S=>v(S.target.value),placeholder:j.searchPlaceholder}),e.jsx("select",{"aria-label":j.sortLabel,value:b,onChange:S=>Z(S.target.value),children:I.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))}),e.jsxs("select",{"aria-label":j.viewLabel,value:P,onChange:S=>f(S.target.value),children:[e.jsx("option",{value:"details",children:j.viewDetails}),e.jsx("option",{value:"wide",children:j.viewWide}),e.jsx("option",{value:"grid",children:j.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:j.cardCount.replace("{shown}",String(Ge.length)).replace("{total}",String(ht.length))}),e.jsx("span",{children:ie==="loading"?j.loading:j.ready})]}),e.jsxs("div",{className:"cogita-filters-toggle-row",children:[e.jsx("button",{type:"button",className:"ghost cogita-filters-toggle",onClick:()=>E(S=>!S),children:q?j.hideFilters:j.showFilters}),e.jsx("span",{className:"cogita-sidebar-note",children:j.filtersOptionalHint})]}),q?e.jsx("section",{className:"cogita-library-filters cogita-library-filters--compact",children:e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:j.typeLabel}),e.jsx("select",{value:y,onChange:S=>k(S.target.value),children:ue.map(S=>e.jsx("option",{value:S.value,children:S.label},`advanced-type:${S.value}`))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Reference"}),e.jsxs("select",{value:Y.__referenceId??"",onChange:S=>me(Te=>({...Te,__referenceId:S.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),K.map(S=>e.jsx("option",{value:S.infoId,children:S.label},`reference:${S.infoId}`))]})]}),it.map(S=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:S.label}),S.kind==="select"?e.jsxs("select",{value:Y[S.key]??"",onChange:Te=>me(nt=>({...nt,[S.key]:Te.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),(S.options??[]).map(Te=>e.jsx("option",{value:Te.value,children:Te.label},`${S.key}:${Te.value}`))]}):e.jsx("input",{type:"text",value:Y[S.key]??"",onChange:Te=>me(nt=>({...nt,[S.key]:Te.target.value}))})]},`type-filter:${S.key}`))]})}):null,e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:ca}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{Ne(S=>{const Te={...S};for(const nt of Ge)Te[nt.infoId]={infoId:nt.infoId,infoType:nt.infoType,label:nt.label};return Te})},disabled:Ge.length===0,children:j.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Ne({}),disabled:Oe.length===0,children:j.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Lt&&Bt(Lt),disabled:!Lt,title:Lt?void 0:j.openSelectedDisabled,children:j.openSelected})]})]}),It==="details"?e.jsxs("div",{className:"cogita-details-grid",role:"table","aria-label":j.searchTitle,children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:j.detailColumnName}),e.jsx("span",{children:j.detailColumnType}),e.jsx("span",{children:j.detailColumnId}),e.jsx("span",{})]}),Ge.length?Ge.map(S=>{const Te=bt(t,S.infoType),nt=vt.has(S.infoId),p=De===S.infoId;return e.jsxs("div",{className:`cogita-details-row ${p||nt?"active":""}`,role:"row",onClick:()=>Ce(S.infoId),children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:nt,onChange:be=>Kt(S,be.target.checked),onClick:be=>be.stopPropagation()}),e.jsx("span",{})]}),e.jsx("span",{title:S.label,children:S.label}),e.jsx("span",{title:Te,children:Te}),e.jsx("span",{title:S.infoId,children:S.infoId}),e.jsx("button",{type:"button",className:"ghost cogita-details-open",onClick:be=>{be.stopPropagation(),Bt(S.infoId)},"aria-label":j.editInfo,children:">"})]},S.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:j.noMatch})})]}):e.jsx("div",{className:`cogita-card-list cogita-card-list--${It}`,"data-view":It,children:Ge.length?Ge.map(S=>{const Te=bt(t,S.infoType),nt=vt.has(S.infoId),p=De===S.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":p||nt,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:nt,onChange:be=>Kt(S,be.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>Ce(S.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:Te}),e.jsx("h3",{className:"cogita-card-title",children:S.label}),e.jsx("p",{className:"cogita-card-subtitle",children:S.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Bt(S.infoId),children:j.editInfo})]})},S.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:j.noMatch})})}),We?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>fe(S=>S+Wn),children:j.loadMore})}):null,Oe.length>0?e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:j.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:j.selectedStackHint}),e.jsx("div",{className:"cogita-selection-overview",children:ct.map(([S,Te])=>e.jsxs("span",{className:"cogita-tag-chip",children:[e.jsx("span",{children:bt(t,S)}),e.jsx("span",{className:"cogita-tag-count",children:Te})]},`stack:type:${S}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:ea,disabled:Oe.length===0,children:"Start revision"}),e.jsx("button",{type:"button",className:"ghost",onClick:Na,disabled:Oe.length===0,children:"Create collection from selection"})]})]}):null]}):null]})})})})}function Bs(t,a,s){if(t&&typeof t=="object"&&!Array.isArray(t)){const i=t,l=["title","name","label","value","text","quote","term"];for(const u of l){const o=i[u];if(typeof o=="string"&&o.trim())return o.trim()}}return`${a} · ${s}`}function Xr(t,a){try{const s=a==="pl"?"pl-PL":a==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(s,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}catch{return t}}function Zr(t){return t==="pl"?{kicker:"Informacja",backToSearch:"Wróć do wyszukiwania",loading:"Ładowanie informacji...",loadError:"Nie udało się wczytać informacji.",knownness:"Znajomość",reviews:"Sprawdzenia",correct:"Poprawne: {correct} / {total}",lastReview:"Ostatnie sprawdzenie",noLastReview:"Brak sprawdzeń",linkedCards:"Powiązane karty",linkedCardsHint:"Karty sprawdzające zależne od tej informacji",payload:"Treść informacji",links:"Powiązania",empty:"Brak danych",noLinks:"Brak powiązań",checkcards:"Karty sprawdzające",loadingCheckcards:"Ładowanie kart sprawdzających...",loadCheckcardsError:"Nie udało się wczytać kart sprawdzających.",noCheckcards:"Brak kart sprawdzających.",checkcardCount:"Liczba kart",dependencyCount:"Zależności (efektywne)",approach:"Podejście",loadingApproach:"Ładowanie widoku...",loadApproachError:"Nie udało się wczytać widoku.",noApproachData:"Brak danych widoku.",noKnownnessData:"Brak danych o znajomości",developmentStart:"Początek nauki",developmentGrowing:"Rozwój w toku",developmentStable:"Utrwalona wiedza",developmentStrong:"Bardzo dobra znajomość"}:t==="de"?{kicker:"Information",backToSearch:"Zur Suche",loading:"Information wird geladen...",loadError:"Information konnte nicht geladen werden.",knownness:"Kenntnisstand",reviews:"Abfragen",correct:"Richtig: {correct} / {total}",lastReview:"Letzte Abfrage",noLastReview:"Noch keine Abfragen",linkedCards:"Verknüpfte Karten",linkedCardsHint:"Prüfkarten, die von dieser Information abhängen",payload:"Inhalt",links:"Verknüpfungen",empty:"Keine Daten",noLinks:"Keine Verknüpfungen",checkcards:"Prüfkarten",loadingCheckcards:"Prüfkarten werden geladen...",loadCheckcardsError:"Prüfkarten konnten nicht geladen werden.",noCheckcards:"Keine Prüfkarten.",checkcardCount:"Anzahl Karten",dependencyCount:"Abhängigkeiten (effektiv)",approach:"Ansicht",loadingApproach:"Ansicht wird geladen...",loadApproachError:"Ansicht konnte nicht geladen werden.",noApproachData:"Keine Ansichtsdaten.",noKnownnessData:"Keine Kenntnisdaten",developmentStart:"Lernbeginn",developmentGrowing:"Aufbauphase",developmentStable:"Stabil",developmentStrong:"Sehr sicher"}:{kicker:"Info",backToSearch:"Back to search",loading:"Loading info...",loadError:"Failed to load info.",knownness:"Knownness",reviews:"Reviews",correct:"Correct: {correct} / {total}",lastReview:"Last review",noLastReview:"No reviews yet",linkedCards:"Linked checking cards",linkedCardsHint:"Checking cards depending on this info",payload:"Information",links:"Links",empty:"No data",noLinks:"No links",checkcards:"Checkcards",loadingCheckcards:"Loading checkcards...",loadCheckcardsError:"Failed to load checkcards.",noCheckcards:"No checkcards.",checkcardCount:"Checkcard count",dependencyCount:"Dependencies (effective)",approach:"Approach",loadingApproach:"Loading view...",loadApproachError:"Failed to load view.",noApproachData:"No view data.",noKnownnessData:"No knownness data",developmentStart:"Just started",developmentGrowing:"In progress",developmentStable:"Stable",developmentStrong:"Strong"}}function eo(t,a){return t.totalReviews<=0?a.noKnownnessData:t.totalReviews<3||t.score<.35?a.developmentStart:t.totalReviews<8||t.score<.65?a.developmentGrowing:t.score<.85?a.developmentStable:a.developmentStrong}function to({links:t,emptyLabel:a}){return!t||Object.keys(t).length===0?e.jsx("p",{className:"cogita-library-hint",children:a}):e.jsx("div",{className:"cogita-info-tree",children:Object.entries(t).map(([s,i])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:s}),e.jsx("div",{className:"cogita-info-tree-value",children:Array.isArray(i)?i.length?e.jsx("div",{className:"cogita-selection-overview",children:i.map(l=>e.jsx("span",{className:"cogita-tag-chip",children:l},`${s}:${l}`))}):e.jsx("span",{className:"cogita-library-hint",children:"[]"}):i?e.jsx("span",{className:"cogita-tag-chip",children:i}):e.jsx("span",{className:"cogita-library-hint",children:"null"})})]},s))})}function jn({value:t,emptyLabel:a}){if(t==null)return e.jsx("p",{className:"cogita-library-hint",children:a});if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)});if(Array.isArray(t))return t.length===0?e.jsx("p",{className:"cogita-library-hint",children:"[]"}):e.jsx("div",{className:"cogita-info-tree",children:t.map((s,i)=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:i+1}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(jn,{value:s,emptyLabel:a})})]},i))});if(typeof t=="object"){const s=Object.entries(t);return s.length===0?e.jsx("p",{className:"cogita-library-hint",children:a}):e.jsx("div",{className:"cogita-info-tree",children:s.map(([i,l])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:i}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(jn,{value:l,emptyLabel:a})})]},i))})}return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)})}const $a=5,zs=50,Os=2,Us=[];function va({libraryId:t,infoType:a,label:s,placeholder:i,value:l,onChange:u,values:o,onChangeMultiple:x,helperText:h,searchFailedText:w,createFailedText:d,createLabel:g,savingLabel:r,loadMoreLabel:c,allowCreate:j=!0,inputRef:y,autoAdvance:k,onCommit:C,multiple:v}){const b=v?o??Us:Us,[Z,P]=n.useState(v?"":(l==null?void 0:l.label)??""),[f,q]=n.useState([]),[E,ie]=n.useState($a),[$,B]=n.useState(-1),[A,J]=n.useState(!1),[fe,De]=n.useState(!1),[Ce,H]=n.useState(null),Ne=n.useRef(0),Y=n.useRef(new Map),me=n.useMemo(()=>j?v?Z.trim().length>0:Z.trim().length>0&&!l:!1,[j,Z,l,v]);n.useEffect(()=>{v||P((l==null?void 0:l.label)??"")},[l,v]),n.useEffect(()=>{const K=Z.trim();if(!K||K.length<Os){q([]),J(!1),ie($a),B(-1),De(!1),H(null);return}const G=K.toLowerCase(),je=`${t}:${a}:${G}`,O=Y.current.get(je);if(O){if(v&&b.length>0){const Me=new Set(b.map(Fe=>Fe.id));q(O.filter(Fe=>!Me.has(Fe.id)))}else q(O);ie($a),B(-1),J(O.length>0),De(!1),H(null);return}const Se=window.setTimeout(async()=>{const Me=Date.now();Ne.current=Me,De(!0),H(null);try{const Fe=await js({libraryId:t,type:a,query:K,limit:zs});if(Ne.current!==Me)return;const Ze=Fe.slice(0,zs).map(D=>({id:D.infoId,label:D.label,infoType:D.infoType}));if(Y.current.set(je,Ze),v&&b.length>0){const D=new Set(b.map(ce=>ce.id));q(Ze.filter(ce=>!D.has(ce.id)))}else q(Ze);ie($a),B(-1),J(!0)}catch{if(Ne.current!==Me)return;H(w??"Search failed.")}finally{Ne.current===Me&&De(!1)}},250);return()=>window.clearTimeout(Se)},[t,a,Z,b]);const Je=K=>{if(v){const G=b.some(je=>je.id===K.id)?b:[...b,K];x==null||x(G),P(""),J(!1),B(-1);return}u==null||u(K),P(K.label),J(!1),B(-1),k&&(C==null||C())},qe=async()=>{const K=Z.trim();if(K){De(!0),H(null);try{const G=await cs({libraryId:t,infoType:a,payload:{label:K}}),je={id:G.infoId,label:K,infoType:G.infoType};if(K.length>=Os){const O=`${t}:${a}:${K.toLowerCase()}`,Se=Y.current.get(O)??[];Y.current.set(O,[je,...Se])}if(v){x==null||x([...b,je]),P(""),J(!1),B(-1);return}u==null||u(je),J(!1),B(-1),k&&(C==null||C())}catch{H(d??"Create failed.")}finally{De(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:s}),e.jsx("input",{value:Z,placeholder:i,onChange:K=>{P(K.target.value),!v&&l&&(u==null||u(null))},onKeyDown:K=>{if(K.key==="ArrowDown"){if(K.preventDefault(),!f.length)return;J(!0),B(G=>{const je=Math.min(f.length,E)-1,O=G<0?0:Math.min(G+1,je);return O===je&&f.length>E?(ie(Se=>Math.min(Se+$a,f.length)),Math.min(G+1,Math.min(f.length,E+$a)-1)):O});return}if(K.key==="ArrowUp"){if(K.preventDefault(),!f.length)return;J(!0),B(G=>G<=0?0:G-1);return}if(K.key==="Enter"){if(K.preventDefault(),$>=0&&f[$]){Je(f[$]);return}if(me){qe();return}}},onFocus:()=>{f.length>0&&J(!0)},autoComplete:"off",ref:y})]}),v&&b.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:b.map(K=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>x==null?void 0:x(b.filter(G=>G.id!==K.id)),children:[K.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},K.id))}),h&&e.jsx("p",{className:"cogita-help",children:h}),Ce&&e.jsx("p",{className:"cogita-error",children:Ce}),A&&f.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[f.slice(0,E).map((K,G)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":G===$,onClick:()=>Je(K),children:[e.jsx("strong",{children:K.label}),e.jsx("span",{children:K.infoType})]},K.id)),E<f.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>ie(K=>Math.min(K+$a,f.length)),children:c??"Load more"})]}),me&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:qe,disabled:fe,children:fe?r??"Saving...":g??`Create new ${a}`})]})}const Js=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Qs=8;function Hs({libraryId:t,copy:a,language:s,sourceKindOptions:i,value:l,onChange:u,labels:o}){const[x,h]=n.useState(!1),[w,d]=n.useState(-1),g=n.useMemo(()=>{const y=s;return Js.map(k=>{var b;const C=(k==null?void 0:k[y])??(k==null?void 0:k.en)??(k==null?void 0:k.la);return{label:`${C.abbr} — ${C.name}`,latin:((b=k==null?void 0:k.la)==null?void 0:b.abbr)??C.abbr}})},[s]),r=(y,k=!1)=>{const C=y.trim().toLowerCase();return C?g.filter(v=>v.label.toLowerCase().includes(C)).slice(0,Qs):k?g.slice(0,Qs):[]},c=(y,k)=>{const C=y.trim().toLowerCase();if(!C)return null;const v=Js;for(const b of v){const Z=b==null?void 0:b.la,P=(b==null?void 0:b[k])??(b==null?void 0:b.en)??Z,f=(P==null?void 0:P.abbr)??"",q=(P==null?void 0:P.name)??"";if(f.toLowerCase()===C||q.toLowerCase()===C||`${f} — ${q}`.toLowerCase()===C)return{book:b,entry:P,la:Z}}return null};n.useEffect(()=>{if(l.sourceKind==="bible"&&l.locatorValue&&!x){const y=c(l.locatorValue,s);if(y){const k=`${y.entry.abbr} — ${y.entry.name}`;k!==l.bibleBookDisplay&&u({...l,bibleBookDisplay:k})}}},[s,l,x,u]);const j=y=>u({...l,...y});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.sourceKindLabel}),e.jsx("select",{value:l.sourceKind,onChange:y=>j({sourceKind:y.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:i.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))})]}),l.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.bibleBookLabel}),e.jsx("input",{type:"text",value:l.bibleBookDisplay,onChange:y=>{const k=y.target.value;j({bibleBookDisplay:k,locatorValue:""}),h(!0),d(-1)},onKeyDown:y=>{var C;const k=r(l.bibleBookDisplay);if(k.length){if(y.key==="ArrowDown")y.preventDefault(),d(v=>Math.min(v+1,k.length-1));else if(y.key==="ArrowUp")y.preventDefault(),d(v=>Math.max(v-1,0));else if((y.key==="Enter"||y.key==="Tab")&&w>=0&&k[w]){const v=k[w],b=c(v.label,s);if(!b)return;j({bibleBookDisplay:v.label,locatorValue:((C=b.la)==null?void 0:C.abbr)??l.locatorValue}),h(!1)}}},onFocus:()=>h(!0),onBlur:()=>window.setTimeout(()=>h(!1),100),placeholder:o.bibleBookPlaceholder})]}),x&&r(l.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:r(l.bibleBookDisplay,!0).map((y,k)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":k===w,tabIndex:-1,onMouseDown:()=>{var v;const C=c(y.label,s);C&&j({bibleBookDisplay:y.label,locatorValue:((v=C.la)==null?void 0:v.abbr)??l.locatorValue})},children:e.jsx("strong",{children:y.label})},y.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.bibleRestLabel}),e.jsx("input",{type:"text",value:l.locatorAux,onChange:y=>j({locatorAux:y.target.value}),placeholder:o.bibleRestPlaceholder})]})]}),l.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:l.sourceUrl,onChange:y=>j({sourceUrl:y.target.value}),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:l.sourceAccessedDate,onChange:y=>j({sourceAccessedDate:y.target.value}),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),l.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(va,{libraryId:t,infoType:"work",label:o.churchDocumentLabel,placeholder:o.churchDocumentPlaceholder,value:l.churchDocument,onChange:y=>j({churchDocument:y}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.locatorLabel}),e.jsx("input",{type:"text",value:l.locatorValue,onChange:y=>j({locatorValue:y.target.value}),placeholder:o.locatorPlaceholder})]})]}),l.sourceKind==="work"&&e.jsx(va,{libraryId:t,infoType:"work",label:o.workLabel,placeholder:o.workPlaceholder,value:l.work,onChange:y=>j({work:y}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),l.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(va,{libraryId:t,infoType:"media",label:o.bookLabel,placeholder:o.bookPlaceholder,value:l.bookMedia,onChange:y=>j({bookMedia:y}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.locatorLabel}),e.jsx("input",{type:"text",value:l.locatorValue,onChange:y=>j({locatorValue:y.target.value}),placeholder:o.locatorPlaceholder})]})]}),l.sourceKind!=="website"&&l.sourceKind!=="bible"&&l.sourceKind!=="book"&&l.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.locatorLabel}),e.jsx("input",{type:"text",value:l.locatorValue,onChange:y=>j({locatorValue:y.target.value}),placeholder:o.locatorPlaceholder})]})]})}const Xa=JSON.stringify({type:"selection",title:"Question title",question:"Question text",options:["Option A","Option B","Option C"],answer:[0]},null,2);function pn(t="selection"){return t==="matching"?{type:t,title:"",question:"",columns:[[""],[""]],answer:{paths:[]},matchingPaths:[["",""]]}:t==="ordering"?{type:t,title:"",question:"",options:[""]}:t==="truefalse"?{type:t,title:"",question:"",answer:!0}:t==="text"||t==="date"?{type:t,title:"",question:"",answer:""}:t==="number"?{type:t,title:"",question:"",answer:""}:{type:t,title:"",question:"",options:[""],answer:[]}}function ao(t){return["selection","truefalse","text","number","date","matching","ordering"].includes(t)}function Da(t){if(!t||typeof t!="object")return null;const a=t,s=typeof a.type=="string"?a.type:typeof a.kind=="string"?a.kind:"selection",i=s==="multi_select"||s==="single_select"?"selection":s==="boolean"?"truefalse":s==="order"?"ordering":s==="short"||s==="open"||s==="short_text"?"text":s,l=ao(i)?i:"selection",u=typeof a.title=="string"?a.title:"",o=typeof a.question=="string"?a.question:"";if(l==="matching"){let w=[];Array.isArray(a.columns)?w=a.columns.map(y=>Array.isArray(y)?y.map(k=>typeof k=="string"?k:""):[""]):Array.isArray(a.left)&&Array.isArray(a.right)&&(w=[a.left.map(y=>typeof y=="string"?y:""),a.right.map(y=>typeof y=="string"?y:"")]),w.length<2&&(w=[[""],[""]]);const d=a.answer&&typeof a.answer=="object"?a.answer:null,r=(Array.isArray(d==null?void 0:d.paths)?d==null?void 0:d.paths:Array.isArray(a.correctPairs)?a.correctPairs:[]).map(y=>Array.isArray(y)?y.map(k=>Number(k)).filter(k=>Number.isInteger(k)&&k>=0):[]).filter(y=>y.length>0),c=Array.isArray(a.matchingPaths)?a.matchingPaths.map(y=>Array.isArray(y)?Array.from({length:w.length},(k,C)=>String(y[C]??"")):new Array(w.length).fill("")):null,j=c&&c.length>0?c:[...r.map(y=>y.map(String)),new Array(w.length).fill("")];return{type:l,title:u,question:o,columns:w,answer:{paths:r},matchingPaths:j}}if(l==="ordering"){const w=Array.isArray(a.options)?a.options.map(d=>typeof d=="string"?d:""):Array.isArray(a.items)?a.items.map(d=>typeof d=="string"?d:""):[""];return{type:l,title:u,question:o,options:w.length?w:[""]}}if(l==="truefalse"){const w=typeof a.answer=="boolean"?a.answer:typeof a.expected=="boolean"?a.expected:!0;return{type:l,title:u,question:o,answer:w}}if(l==="number")return typeof a.answer=="number"?{type:l,title:u,question:o,answer:a.answer}:typeof a.answer=="string"?{type:l,title:u,question:o,answer:a.answer}:typeof a.expected=="number"?{type:l,title:u,question:o,answer:a.expected}:{type:l,title:u,question:o,answer:""};if(l==="text"||l==="date"){const w=typeof a.answer=="string"?a.answer:typeof a.expected=="string"?a.expected:"";return{type:l,title:u,question:o,answer:w}}const x=Array.isArray(a.options)?a.options.map(w=>typeof w=="string"?w:""):[""],h=Array.isArray(a.answer)?a.answer.map(w=>Number(w)).filter(w=>Number.isInteger(w)&&w>=0):Array.isArray(a.correct)?a.correct.map(w=>Number(w)).filter(w=>Number.isInteger(w)&&w>=0):[];return{type:l,title:u,question:o,options:x.length?x:[""],answer:h}}function Gn(t){const a=(t.title??"").trim(),s=(t.question??"").trim();switch(t.type){case"matching":{const i=(t.columns??[[""],[""]]).map(g=>g.map(r=>r.trim()).filter(Boolean)).filter(g=>g.length>0),l=i.length>=2?i:[[""],[""]],u=t.answer&&typeof t.answer=="object"&&"paths"in t.answer?t.answer.paths:[],o=(t.matchingPaths??[]).map(g=>g.map(r=>String(r??""))),x=l.length,h=o.map(g=>g.slice(0,x).map(r=>r.trim())).filter(g=>g.some(Boolean)).map(g=>g.map(r=>Number(r))).filter(g=>g.length===x&&g.every(r=>Number.isInteger(r)&&r>=0)),w=(Array.isArray(u)?u:[]).map(g=>Array.isArray(g)?g.map(r=>Number(r)).filter(r=>Number.isInteger(r)&&r>=0):[]).filter(g=>g.length===x),d=Array.from(new Set([...w,...h].map(g=>JSON.stringify(g)))).map(g=>JSON.parse(g));return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,columns:l,answer:{paths:d}},null,2)}case"ordering":{const i=(t.options??[]).map(l=>l.trim()).filter(Boolean);return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,options:i},null,2)}case"truefalse":return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,answer:!!t.answer},null,2);case"number":return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,answer:typeof t.answer=="number"||typeof t.answer=="string"?t.answer:""},null,2);case"date":case"text":return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,answer:String(t.answer??"")},null,2);case"selection":default:{const i=(t.options??[]).map(o=>o.trim()).filter(Boolean),l=Array.isArray(t.answer)?t.answer:[],u=Array.from(new Set(l.filter(o=>Number.isInteger(o)&&o>=0&&o<i.length))).sort((o,x)=>o-x);return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,options:i,answer:u},null,2)}}}const Ws=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}];function en(){return{sourceKind:"string",locatorValue:"",locatorAux:"",bibleBookDisplay:"",sourceUrl:"",sourceAccessedDate:"",churchDocument:null,bookMedia:null,work:null}}function Gs(t){return t==null?"":typeof t=="string"?t:JSON.stringify(t)}function Ys(t,a){if(!t||typeof t!="object")return a;const s=t,i=s.definition&&typeof s.definition=="object"?s.definition:null,l=[s.label,s.name,s.title,s.text,s.orcid,s.email,s.number];i&&l.unshift(i.title,i.question);for(const u of l)if(typeof u=="string"&&u.trim())return u.trim();return a}function Xs(t,a){var i;if(!(t instanceof ks))return a;const s=(i=t.message)==null?void 0:i.trim();if(!s)return a;try{const l=JSON.parse(s);if(typeof l.error=="string"&&l.error.trim())return l.error.trim()}catch{}return s}function no(t){const a=t.trim();if(!a)return null;try{const s=JSON.parse(a);return s&&typeof s=="object"&&!Array.isArray(s)?s:null}catch{return null}}function ga(t,a){const s=t==null?void 0:t[a];return typeof s=="string"?s:""}function so(t,a){return a?t==="book"&&a.infoType==="media"?{bookMedia:a}:t==="work"&&a.infoType==="work"?{work:a}:t==="number_document"&&a.infoType==="work"?{churchDocument:a}:{}:{}}function io(t,a){const s=en(),i=(t.sourceKind??"").trim()||s.sourceKind,l=t.locator??"",u=no(l);let o="",x="",h="",w="",d="";return i==="website"?(w=ga(u,"url"),d=ga(u,"accessedDate"),o=ga(u,"value")):i==="bible"?(o=ga(u,"book")||l.trim(),x=ga(u,"passage")||ga(u,"rest"),h=ga(u,"bookDisplay")):u?(o=ga(u,"value")||ga(u,"locator"),x=ga(u,"aux")):o=l,{...s,sourceKind:i,locatorValue:o,locatorAux:x,bibleBookDisplay:h,sourceUrl:w,sourceAccessedDate:d,...so(i,a)}}function Yn(t){return t.sourceKind==="book"?t.bookMedia:t.sourceKind==="work"?t.work:t.sourceKind==="number_document"?t.churchDocument:null}function Xn(t){const a=t.locatorValue.trim(),s=t.locatorAux.trim(),i=t.sourceUrl.trim(),l=t.sourceAccessedDate.trim();switch(t.sourceKind){case"website":return{url:i,accessedDate:l};case"bible":return{book:a,bookDisplay:t.bibleBookDisplay.trim(),passage:s};case"book":case"work":case"number_document":return s?{value:a,aux:s}:a;default:return s?{value:a,aux:s}:a}}function Zs(t){var l,u,o;const a=t.locatorValue.trim(),s=t.locatorAux.trim(),i=[a,s].filter(Boolean).join(" ");switch(t.sourceKind){case"website":return t.sourceUrl.trim()||"website";case"bible":return i||"bible";case"book":return[(l=t.bookMedia)==null?void 0:l.label,i].filter(Boolean).join(" · ")||"book";case"work":return[(u=t.work)==null?void 0:u.label,i].filter(Boolean).join(" · ")||"work";case"number_document":return[(o=t.churchDocument)==null?void 0:o.label,i].filter(Boolean).join(" · ")||"number_document";default:return i||t.sourceKind||"source"}}function ei(t){return t.sourceKind.trim()?t.sourceKind==="website"?!!t.sourceUrl.trim():t.sourceKind==="bible"?!!(t.locatorValue.trim()&&t.locatorAux.trim()):t.sourceKind==="book"?!!t.bookMedia:t.sourceKind==="work"?!!t.work:t.sourceKind==="number_document"?!!(t.churchDocument&&t.locatorValue.trim()):!!t.locatorValue.trim():!1}function ro({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,editInfoId:g}){var ke,we,Le;const{libraryName:r}=xa(d),c=!!g,[j,y]=n.useState([]),[k,C]=n.useState("word"),[v,b]=n.useState({}),[Z,P]=n.useState({}),[f,q]=n.useState({}),[E,ie]=n.useState({}),[$,B]=n.useState(null),[A,J]=n.useState("idle"),[fe,De]=n.useState(en),[Ce,H]=n.useState({}),[Ne,Y]=n.useState({}),[me,Je]=n.useState({}),[qe,K]=n.useState(null),[G,je]=n.useState(()=>Da(JSON.parse(Xa))??pn()),[O,Se]=n.useState(Xa),[Me,Fe]=n.useState([]),[Ze,D]=n.useState(0),ce=n.useMemo(()=>j.find(R=>R.infoType===k),[k,j]),He=n.useMemo(()=>j.find(R=>R.infoType==="source"),[j]),Ee=n.useMemo(()=>j.map(R=>({value:R.infoType,label:bt(t,R.infoType)})),[t,j]),se=R=>{const _=Da(R)??pn(),z=Gn(_);je(_),b(W=>({...W,definition:z}))};n.useEffect(()=>{let R=!1;return Ui({libraryId:d}).then(_=>{var z;if(!R&&(y(_),!c)){const W=(z=_[0])==null?void 0:z.infoType;W&&C(W)}}).catch(()=>{R||y([])}),()=>{R=!0}},[c,d]),n.useEffect(()=>{if(c||!ce)return;const R={},_={},z={},W={};for(const ee of ce.payloadFields)ce.infoType==="question"&&ee.key==="definition"&&ee.inputType==="json"?R[ee.key]=Xa:R[ee.key]="";for(const ee of ce.linkFields)ee.multiple?z[ee.key]=[]:_[ee.key]=null,ee.targetTypes.length>0&&(W[ee.key]=ee.targetTypes[0]);b(R),P(_),q(z),ie(W)},[ce==null?void 0:ce.infoType,c]),n.useEffect(()=>{if(k!=="question")return;const R=v.definition??"";if(!R.trim()){const _=Da(JSON.parse(Xa))??pn();je(_),Se(Xa);return}try{const _=JSON.parse(R),z=Da(_);if(!z)return;je(z),Me.length===0&&Se(JSON.stringify(_,null,2))}catch{}},[v.definition,Me.length,k]),n.useEffect(()=>{if(!c||!g||j.length===0)return;let R=!1;return J("loading"),B(null),(async()=>{const z=await la({libraryId:d,infoId:g});if(R)return;const W=z.infoType;C(W);const ee=j.find(ve=>ve.infoType===W);if(!ee){J("idle");return}const ue=z.payload??{},I={};for(const ve of ee.payloadFields)I[ve.key]=Gs(ue[ve.key]);b(I);const N=z.links??{}??{},ae={},F={},U={},re=[];for(const ve of ee.linkFields){ve.targetTypes.length>0&&(U[ve.key]=ve.targetTypes[0]);const X=N[ve.key];if(ve.multiple){const de=Array.isArray(X)?X.filter($e=>typeof $e=="string"):[];F[ve.key]=[];for(const $e of de)re.push(la({libraryId:d,infoId:$e}).then(at=>{if(R)return;const st={id:$e,infoType:at.infoType,label:Ys(at.payload,$e)};U[ve.key]=st.infoType,F[ve.key]=[...F[ve.key],st]}).catch(()=>{}))}else{const de=typeof X=="string"?X:null;ae[ve.key]=null,de&&re.push(la({libraryId:d,infoId:de}).then($e=>{if(R)return;const at={id:de,infoType:$e.infoType,label:Ys($e.payload,de)};U[ve.key]=at.infoType,ae[ve.key]=at}).catch(()=>{}))}}await Promise.all(re),!R&&(P(ae),q(F),ie(U),J("idle"))})().catch(()=>{R||(B("Failed to load info details."),J("idle"))}),()=>{R=!0}},[g,c,d,j]),n.useEffect(()=>{k==="source"&&De(io(v,Z.resource??null))},[k,v.sourceKind,v.locator,(ke=Z.resource)==null?void 0:ke.id,(we=Z.resource)==null?void 0:we.infoType,(Le=Z.resource)==null?void 0:Le.label]);const Xe=R=>{var ee,ue;const _=((ee=He==null?void 0:He.payloadFields.find(I=>I.key==="sourceKind"))==null?void 0:ee.keepOnCreate)??!1,z=((ue=He==null?void 0:He.linkFields.find(I=>I.key==="resource"))==null?void 0:ue.keepOnCreate)??!1,W=en();return W.sourceKind=_?R.sourceKind:W.sourceKind,z&&(W.work=R.work,W.bookMedia=R.bookMedia,W.churchDocument=R.churchDocument),_&&R.sourceKind==="bible"&&(W.locatorValue=R.locatorValue,W.bibleBookDisplay=R.bibleBookDisplay),_&&R.sourceKind==="website"&&(W.sourceUrl=R.sourceUrl,W.sourceAccessedDate=R.sourceAccessedDate),W},pt=n.useMemo(()=>({sourceKindLabel:t.cogita.library.add.info.sourceKindLabel,bibleBookLabel:t.cogita.library.add.info.sourceBibleBookLabel,bibleBookPlaceholder:t.cogita.library.add.info.sourceBibleBookPlaceholder,bibleRestLabel:t.cogita.library.add.info.sourceBibleRestLabel,bibleRestPlaceholder:t.cogita.library.add.info.sourceBibleRestPlaceholder,churchDocumentLabel:t.cogita.library.add.info.sourceResourceLabel,churchDocumentPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,workLabel:t.cogita.library.add.info.sourceResourceLabel,workPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,bookLabel:t.cogita.library.add.info.sourceResourceLabel,bookPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,locatorLabel:t.cogita.library.list.typeFilterLocator,locatorPlaceholder:t.cogita.library.list.typeFilterLocator}),[t]),xt=async R=>{const _=Ne[R]??en();if(!ei(_)){Je(z=>({...z,[R]:t.cogita.library.add.info.referenceMissingSource}));return}K(R),Je(z=>({...z,[R]:null}));try{const z=Yn(_),W=z?{resource:z.id}:{},ee={label:Zs(_),sourceKind:_.sourceKind.trim(),locator:Xn(_)},I={id:(await cs({libraryId:d,infoType:"source",payload:ee,links:W})).infoId,infoType:"source",label:ee.label};if(q(N=>{const ae=N[R]??[];return ae.some(F=>F.id===I.id)?N:{...N,[R]:[...ae,I]}}),c&&g){const N=await la({libraryId:d,infoId:g}),ae=N.links&&typeof N.links=="object"?{...N.links}:{},F=ae[R],U=Array.isArray(F)?F.filter(re=>typeof re=="string"):typeof F=="string"?[F]:[];U.includes(I.id)||(ae[R]=[...U,I.id],await $s({libraryId:d,infoId:g,payload:N.payload,links:ae}))}Y(N=>({...N,[R]:Xe(_)})),Je(N=>({...N,[R]:null}))}catch(z){Je(W=>({...W,[R]:Xs(z,t.cogita.library.lookup.createFailed)}))}finally{K(z=>z===R?null:z)}},Ve=async()=>{var z;if(!ce)return;const R={};for(const W of ce.payloadFields){if(k==="source"&&(W.key==="sourceKind"||W.key==="locator"))continue;const ee=(v[W.key]??"").trim();if(!ee){if(W.required){B(`Field '${W.label}' is required.`);return}continue}if(W.inputType==="json")try{R[W.key]=JSON.parse(ee)}catch{B(`Field '${W.label}' must be valid JSON.`);return}else R[W.key]=ee}const _={};for(const W of ce.linkFields)if(!(k==="source"&&W.key==="resource"))if(W.multiple){const ee=(f[W.key]??[]).map(ue=>ue.id);if(W.required&&ee.length===0){B(`Link '${W.label}' is required.`);return}ee.length>0&&(_[W.key]=ee)}else{const ee=((z=Z[W.key])==null?void 0:z.id)??null;if(W.required&&!ee){B(`Link '${W.label}' is required.`);return}ee&&(_[W.key]=ee)}if(k==="source"){if(!ei(fe)){B(t.cogita.library.add.info.referenceMissingSource);return}const W=fe.sourceKind.trim();R.sourceKind=W,R.locator=Xn(fe),(typeof R.label!="string"||!R.label.trim())&&(R.label=Zs(fe));const ee=Yn(fe);ee&&(_.resource=ee.id)}J("saving"),B(null);try{if(c&&g)await $s({libraryId:d,infoId:g,payload:R,links:_}),B("Info updated.");else{await cs({libraryId:d,infoType:k,payload:R,links:_});const W=k==="question"&&Me.length>0&&Ze<Me.length-1;if(W){const N=Ze+1,ae=Me[N]??null;if(ae){const F=Gn(ae);D(N),je(ae),b(U=>({...U,definition:F})),B(`Info saved. Loaded next question (${N+1}/${Me.length}).`)}else B("Info saved.")}else k==="question"&&Me.length>0&&(Fe([]),D(0)),B("Info saved.");const ee={};for(const N of ce.payloadFields)ee[N.key]=N.keepOnCreate?v[N.key]??"":"";if(W){const N=Me[Math.min(Ze+1,Me.length-1)];N&&(ee.definition=Gn(N))}b(ee);const ue={},I={};for(const N of ce.linkFields)N.multiple?I[N.key]=N.keepOnCreate?f[N.key]??[]:[]:ue[N.key]=N.keepOnCreate?Z[N.key]??null:null;P(N=>({...N,...ue})),q(N=>({...N,...I})),k==="source"&&De(N=>{const ae=Xe(N),F=Yn(ae);return b(U=>({...U,sourceKind:ae.sourceKind,locator:Gs(Xn(ae))})),P(U=>({...U,resource:F})),F&&ie(U=>({...U,resource:F.infoType})),ae})}}catch(W){B(Xs(W,"Failed to save info."))}finally{J("idle")}},ye=R=>{const _=v[R.key]??"";if(k==="question"&&R.key==="definition"&&R.inputType==="json"){const W=G.type,ee=re=>{const ve=G.title??"",X=G.question??"";se({...pn(re),title:ve,question:X})},ue=re=>re.length===0?[""]:re[re.length-1].trim()?[...re,""]:re,I=re=>{const ve=(re.length?re:[[""],[""]]).map(X=>ue(X));return ve.length>=2?ve:[...ve,[""]]},N=(re,ve)=>{const X=re.map($e=>Array.from({length:ve},(at,st)=>$e[st]??"")).filter($e=>$e.some(at=>at.trim())||$e===re[re.length-1]);return X.length===0?[new Array(ve).fill("")]:X[X.length-1].some($e=>$e.trim())?[...X,new Array(ve).fill("")]:X},ae=Array.isArray(G.answer)?G.answer:[],F=I(G.columns??[[""],[""]]),U=N(G.matchingPaths??[[]],F.length);return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:R.label}),e.jsxs("div",{className:"cogita-library-panel",style:{display:"grid",gap:"0.8rem"},children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Question type"}),e.jsxs("select",{value:W,onChange:re=>ee(re.target.value),children:[e.jsx("option",{value:"selection",children:"Selection"}),e.jsx("option",{value:"truefalse",children:"True / false"}),e.jsx("option",{value:"text",children:"Text answer"}),e.jsx("option",{value:"number",children:"Number answer"}),e.jsx("option",{value:"date",children:"Date answer"}),e.jsx("option",{value:"matching",children:"Matching"}),e.jsx("option",{value:"ordering",children:"Right order"})]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Title"}),e.jsx("input",{type:"text",value:G.title??"",onChange:re=>se({...G,title:re.target.value}),placeholder:"Optional title"})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Question"}),e.jsx("textarea",{rows:3,value:G.question??"",onChange:re=>se({...G,question:re.target.value}),placeholder:"Question text"})]}),W==="selection"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Options / correct indices"}),ue(G.options??[""]).map((re,ve,X)=>{const de=new Set(ae.filter(at=>Number.isInteger(at))),$e=ve===X.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:de.has(ve),disabled:!re.trim(),onChange:at=>{const st=at.target.checked?[...de,ve]:[...de].filter(it=>it!==ve);se({...G,answer:st})}}),e.jsx("input",{type:"text",value:re,placeholder:`Answer ${ve+1}`,onChange:at=>{const st=[...G.options??[""]];st[ve]=at.target.value;const it=ue(st),ut=it.length-1,yt=ae.filter(ht=>ht>=0&&ht<ut);se({...G,options:it,answer:yt})}}),$e?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const st=(G.options??[""]).filter((ut,yt)=>yt!==ve),it=ae.filter(ut=>ut!==ve).map(ut=>ut>ve?ut-1:ut);se({...G,options:ue(st),answer:it})},children:"Remove"})]},`question-option:${ve}`)})]}):null,W==="text"||W==="date"||W==="number"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Answer"}),e.jsx("input",{type:W==="date"?"date":"text",value:typeof G.answer=="string"||typeof G.answer=="number"?String(G.answer):"",onChange:re=>se({...G,answer:re.target.value})})]}):null,W==="truefalse"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Answer"}),e.jsxs("select",{value:String(!!G.answer),onChange:re=>se({...G,answer:re.target.value==="true"}),children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]}):null,W==="matching"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Columns"}),F.map((re,ve)=>e.jsxs("div",{style:{display:"grid",gap:"0.35rem",border:"1px solid rgba(120,170,220,0.22)",borderRadius:"0.6rem",padding:"0.55rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{fontSize:"0.8rem",color:"rgba(184,209,234,0.85)"},children:["Column ",ve+1]}),F.length>2?e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const X=F.filter(($e,at)=>at!==ve),de=U.map($e=>$e.filter((at,st)=>st!==ve));se({...G,columns:I(X),matchingPaths:N(de,Math.max(2,X.length))})},children:"Remove column"}):null]}),re.map((X,de)=>{const $e=de===re.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"0.4rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:X,placeholder:`Option ${de+1}`,onChange:at=>{const st=F.map(it=>[...it]);st[ve][de]=at.target.value,se({...G,columns:I(st),matchingPaths:N(U,F.length)})}}),$e?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const at=F.map(st=>[...st]);at[ve]=at[ve].filter((st,it)=>it!==de),se({...G,columns:I(at),matchingPaths:N(U,F.length)})},children:"Remove"})]},`question-column:${ve}:row:${de}`)})]},`question-column:${ve}`)),e.jsx("div",{className:"cogita-form-actions",style:{justifyContent:"flex-start"},children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>{const re=[...F.map(X=>[...X]),[""]],ve=U.map(X=>[...X,""]);se({...G,columns:I(re),matchingPaths:N(ve,re.length)})},children:"Add column"})}),e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Correct paths (0-based indices)"}),U.map((re,ve)=>{const X=ve===U.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(${F.length}, minmax(0,1fr)) auto`,gap:"0.35rem",alignItems:"center"},children:[re.map((de,$e)=>e.jsx("input",{type:"number",min:0,step:1,value:de,placeholder:`${$e}`,onChange:at=>{const st=U.map(yt=>[...yt]);st[ve][$e]=at.target.value;const it=N(st,F.length),ut=it.map(yt=>yt.map(ht=>ht.trim())).filter(yt=>yt.every(ht=>ht!=="")).map(yt=>yt.map(ht=>Number(ht))).filter(yt=>yt.every(ht=>Number.isInteger(ht)&&ht>=0));se({...G,matchingPaths:it,answer:{paths:ut}})}},`question-path:${ve}:${$e}`)),X?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const de=U.filter((st,it)=>it!==ve),$e=N(de,F.length),at=$e.map(st=>st.map(it=>it.trim())).filter(st=>st.every(it=>it!=="")).map(st=>st.map(it=>Number(it))).filter(st=>st.every(it=>Number.isInteger(it)&&it>=0));se({...G,matchingPaths:$e,answer:{paths:at}})},children:"Remove"})]},`question-path:${ve}`)})]}):null,W==="ordering"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Ordered options (correct order = listed order)"}),ue(G.options??[""]).map((re,ve,X)=>{const de=ve===X.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"0.5rem",alignItems:"center"},children:[e.jsxs("span",{style:{color:"rgba(184,209,234,0.75)",minWidth:"1.5rem"},children:[ve+1,"."]}),e.jsx("input",{type:"text",value:re,placeholder:`Step ${ve+1}`,onChange:$e=>{const at=[...G.options??[""]];at[ve]=$e.target.value,se({...G,options:ue(at)})}}),de?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>se({...G,options:ue((G.options??[]).filter(($e,at)=>at!==ve))}),children:"Remove"})]},`question-order:${ve}`)})]}):null,e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"JSON import"}),e.jsx("textarea",{rows:8,value:O,onChange:re=>Se(re.target.value),placeholder:"Paste question JSON"}),e.jsxs("div",{className:"cogita-form-actions",style:{justifyContent:"flex-start"},children:[e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>{try{const re=JSON.parse(O);if(Array.isArray(re)){const X=re.map($e=>Da($e)).filter($e=>!!$e);if(X.length===0){B("Question JSON array must contain at least one valid question object.");return}const de=X[0];Fe(X),D(0),se(de),B(`Loaded question array (${X.length} items).`);return}const ve=Da(re);if(!ve){B("Question JSON must be an object or an array of question objects.");return}Fe([]),D(0),se(ve),B(null)}catch{B("Question JSON is invalid.")}},children:"Interpret JSON"}),Me.length>0?e.jsxs("span",{className:"cogita-library-hint",children:["Queue: ",Math.min(Ze+1,Me.length)," / ",Me.length]}):null]})]})]})]},`payload:${R.key}`)}const z=R.inputType==="textarea"||R.inputType==="json";return e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:R.label}),z?e.jsx("textarea",{rows:R.inputType==="json"?8:4,value:_,onChange:W=>b(ee=>({...ee,[R.key]:W.target.value})),placeholder:R.key}):e.jsx("input",{type:"text",value:_,onChange:W=>b(ee=>({...ee,[R.key]:W.target.value})),placeholder:R.key})]},`payload:${R.key}`)},Qe=R=>{const _=E[R.key]??R.targetTypes[0],z=R.key==="references"&&R.multiple&&R.targetTypes.includes("source"),W=Ne[R.key]??en(),ee=Ce[R.key]??!1,ue=me[R.key];return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:R.label}),R.targetTypes.length>1?e.jsx("select",{value:_,onChange:I=>ie(N=>({...N,[R.key]:I.target.value})),children:R.targetTypes.map(I=>e.jsx("option",{value:I,children:bt(t,I)},`${R.key}:${I}`))}):null,R.multiple?e.jsx(va,{libraryId:d,infoType:_,label:R.label,placeholder:R.key,multiple:!0,values:f[R.key]??[],onChangeMultiple:I=>q(N=>({...N,[R.key]:I})),allowCreate:!z,searchFailedText:"Search failed",createFailedText:"Create failed"}):e.jsx(va,{libraryId:d,infoType:_,label:R.label,placeholder:R.key,value:Z[R.key]??null,onChange:I=>P(N=>({...N,[R.key]:I})),searchFailedText:"Search failed",createFailedText:"Create failed"}),z?e.jsxs("div",{children:[e.jsxs("label",{className:"cogita-field",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:ee,onChange:I=>H(N=>({...N,[R.key]:I.target.checked}))}),e.jsx("span",{children:t.cogita.library.add.info.referenceToggle})]}),ee?e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.add.info.referenceTitle}),e.jsx(Hs,{libraryId:d,copy:t,language:h,sourceKindOptions:[...Ws],value:W,onChange:I=>Y(N=>({...N,[R.key]:I})),labels:pt}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>xt(R.key),disabled:qe===R.key,children:qe===R.key?t.cogita.library.lookup.saving:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.source)})}),ue?e.jsx("p",{className:"cogita-library-subtitle",children:ue}):null]}):null]}):null]},`link:${R.key}`)},Ue=()=>e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.add.info.referenceTitle}),e.jsx(Hs,{libraryId:d,copy:t,language:h,sourceKindOptions:[...Ws],value:fe,onChange:De,labels:pt})]});return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:c?"Edit info":"Create info"}),e.jsx("h1",{className:"cogita-library-title",children:r}),e.jsx("p",{className:"cogita-library-subtitle",children:"Specification-driven editor"})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:`/#/cogita/library/${d}/infos`,children:"Back to list"})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-panel",children:[c?null:e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Info type"}),e.jsx("select",{value:k,onChange:R=>C(R.target.value),children:Ee.map(R=>e.jsx("option",{value:R.value,children:R.label},R.value))})]}),A==="loading"&&c?e.jsx("p",{children:"Loading..."}):null,ce&&!(A==="loading"&&c)?e.jsxs("div",{className:"cogita-form-grid",children:[ce.payloadFields.filter(R=>!(k==="source"&&(R.key==="sourceKind"||R.key==="locator"))).map(ye),k==="source"?Ue():null,ce.linkFields.filter(R=>!(k==="source"&&R.key==="resource")).map(Qe)]}):A==="loading"&&c?null:e.jsx("p",{children:"No specification found for this info type."}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:Ve,disabled:A==="saving"||!ce,children:A==="saving"?"Saving...":c?"Update info":"Create info"})}),$?e.jsx("p",{className:"cogita-library-subtitle",children:$}):null]})})})]})})}const ti=t=>/\s/.test(t),kn=t=>/[\p{L}\p{N}]/u.test(t),ai=(t,a)=>{const s=a>0?t[a-1]:"",i=a<t.length?t[a]:"";if(!s||!i)return 0;const l=ti(s),u=ti(i);if(l||u)return 3;const o=kn(s),x=kn(i);return o!==x?2:!o&&!x?1:0},Zn=(t,a,s,i,l)=>{const u=Math.max(i-a,s-i);for(let o=0;o<=u;o+=1){const x=i-o;if(x>=a&&x<=s&&ai(t,x)>=l)return x;const h=i+o;if(h>=a&&h<=s&&ai(t,h)>=l)return h}return null},es=(t,a)=>{const s=a>0?t[a-1]:"",i=a<t.length?t[a]:"";return!s||!i?!0:kn(s)!==kn(i)},oo=(t,a,s,i)=>{const l=s-a,u=a+i,o=s-i;if(l<=i*2||o<=u)return null;const x=Math.floor((a+s)/2),h=Zn(t,u,o,x,3);if(h!==null&&es(t,h))return h;const w=Zn(t,u,o,x,2);if(w!==null&&es(t,w))return w;const d=Zn(t,u,o,x,1);return d!==null&&es(t,d)?d:null},Ma=(t,a)=>{const s=Math.max(1,(a==null?void 0:a.minLen)??7),i=Math.max(s,(a==null?void 0:a.maxLen)??13),l={},u=(h,w,d,g,r)=>{const c=String(g),j={id:c,start:h,end:w,text:t.slice(h,w),depth:d,index:g,parentId:r};if(l[c]=j,w-h>i){let k=oo(t,h,w,s);if(k!==null&&k>h&&k<w){const C=u(h,k,d+1,g*2+1,c),v=u(k,w,d+1,g*2+2,c);j.leftId=C.id,j.rightId=v.id}}return j},o=u(0,t.length,0,0),x=Object.values(l).sort((h,w)=>w.depth-h.depth||h.start-w.start).map(h=>h.id);return{text:t,rootId:o.id,nodes:l,order:x}},Ba=(t,a,s,i,l,u,o)=>{const x=u==="reverse"?t.order.slice().sort((h,w)=>t.nodes[w].start-t.nodes[h].start||t.nodes[w].depth-t.nodes[h].depth):t.order;for(const h of x){if(o&&h===o||a.has(h))continue;const w=t.nodes[h];if(w){if(l&&(w.leftId||w.rightId)){const d=w.leftId?s[w.leftId]??0:i,g=w.rightId?s[w.rightId]??0:i;if((d+g)/2<i)continue}return w}}return null},Pn=(t,a)=>({before:t.slice(0,a.start),fragment:t.slice(a.start,a.end),after:t.slice(a.end)});function lo({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d}){const g=`/#/cogita/library/${d}`,[r,c,j]=pi([]),[y,k,C]=fi([]),[v,b]=n.useState(null),[Z,P]=n.useState(null),[f,q]=n.useState(null),[E,ie]=n.useState(null),$=n.useMemo(()=>r.find(H=>H.id===v)??null,[r,v]);n.useEffect(()=>{let H=!0;return Ji({libraryId:d}).then(Ne=>{if(!H)return;const Y=Ne.nodes.map(me=>{var Je,qe,K;return{id:me.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:me.payload&&typeof me.payload=="object"&&"label"in me.payload?String(me.payload.label):"Item",nodeType:me.nodeType,itemType:((Je=me.payload)==null?void 0:Je.itemType)??"info",itemId:((qe=me.payload)==null?void 0:qe.itemId)??null,infoType:((K=me.payload)==null?void 0:K.infoType)??null}}});c(Y),k(Ne.edges.map(me=>({id:me.edgeId,source:me.fromNodeId,target:me.toNodeId})))}).catch(()=>{H&&(c([]),k([]))}),()=>{H=!1}},[d]),n.useEffect(()=>{Qi({libraryId:d}).then(P).catch(()=>P(null))},[d,r,y]);const B=n.useCallback(H=>{k(Ne=>bi(H,Ne))},[]),A=()=>{const H=crypto.randomUUID();c(Ne=>[...Ne,{id:H,type:"default",position:{x:140+Ne.length*40,y:120+Ne.length*30},data:{label:t.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},J=()=>{const H=crypto.randomUUID();c(Ne=>[...Ne,{id:H,type:"default",position:{x:180+Ne.length*40,y:160+Ne.length*30},data:{label:t.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},fe=async()=>{q(null);try{const H=r.map(Y=>({nodeId:Y.id,nodeType:Y.data.nodeType,payload:{itemType:Y.data.itemType,itemId:Y.data.itemId??null,label:Y.data.label,infoType:Y.data.infoType??null}})),Ne=y.map(Y=>({edgeId:Y.id,fromNodeId:Y.source,toNodeId:Y.target}));await Hi({libraryId:d,nodes:H,edges:Ne}),q(t.cogita.library.graph.saveSuccess)}catch{q(t.cogita.library.graph.saveFail)}},De=H=>{$&&c(Ne=>Ne.map(Y=>Y.id===$.id?{...Y,data:{...Y.data,itemId:(H==null?void 0:H.infoId)??null,itemType:"collection",infoType:"collection",label:(H==null?void 0:H.label)??t.cogita.library.infoTypes.collection}}:Y))},Ce=H=>{$&&c(Ne=>Ne.map(Y=>Y.id===$.id?{...Y,data:{...Y.data,itemId:(H==null?void 0:H.infoId)??null,itemType:"info",infoType:(H==null?void 0:H.infoType)??null,label:(H==null?void 0:H.label)??t.cogita.library.infoTypes.any}}:Y))};return n.useEffect(()=>{if(!$||$.data.nodeType!=="info"||$.data.infoType!=="citation"||!$.data.itemId){ie(null);return}let H=!0;return la({libraryId:d,infoId:$.data.itemId}).then(Ne=>{if(!H)return;const Y=Ne.payload,me=(Y==null?void 0:Y.text)??"";if(!me){ie(null);return}const Je=Ma(me),qe=Object.values(Je.nodes).sort((K,G)=>K.depth-G.depth||K.start-G.start).map(K=>({id:K.id,text:K.text,depth:K.depth}));ie({title:(Y==null?void 0:Y.title)??$.data.label,fragments:qe})}).catch(()=>ie(null)),()=>{H=!1}},[d,$]),e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:t.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:g,children:t.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:fe,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:A,children:t.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:J,children:t.cogita.library.actions.addInfo}),Z?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(Z.totalCollections))})}):null,f?e.jsx("p",{className:"cogita-help",children:f}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(bs,{nodes:r,edges:y,onNodesChange:j,onEdgesChange:C,onConnect:B,onNodeClick:(H,Ne)=>b(Ne.id),fitView:!0,children:[e.jsx(ys,{gap:18,size:1}),e.jsx(vs,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),$?e.jsxs("div",{className:"cogita-graph-inspector",children:[$.data.nodeType==="collection"?e.jsx(va,{libraryId:d,infoType:"collection",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:$.data.itemId?{id:$.data.itemId,label:$.data.label,infoType:"collection"}:null,onChange:De,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.collection),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}):e.jsx(va,{libraryId:d,infoType:"any",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:$.data.itemId?{id:$.data.itemId,label:$.data.label,infoType:$.data.infoType??void 0}:null,onChange:Ce,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.any),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),E?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:E.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:E.fragments.map(H=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:H.id}),e.jsx("span",{children:H.text})]},H.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}function Qa({children:t,flashState:a,flashTick:s=0,feedbackToken:i,className:l}){const u=i??(a?`${a}-${s}`:"idle"),[o,x]=n.useState("a"),h=n.useRef(u);return n.useEffect(()=>{h.current!==u&&(h.current=u,x(w=>w==="a"?"b":"a"))},[u]),e.jsx("section",{className:l?`cogita-revision-card ${l}`:"cogita-revision-card","data-feedback":u,"data-feedback-variant":o,children:t})}const co={answerLabel:"Answer",correctAnswerLabel:"Correct answer",trueLabel:"True",falseLabel:"False",fragmentLabel:"Fragment",correctFragmentLabel:"Correct fragment",participantAnswerPlaceholder:"",unsupportedPromptType:"Unsupported prompt type",waitingForReveal:"Waiting for reveal.",selectedPaths:"Selected paths",removePath:"Remove",columnPrefix:"Column"};function En({prompt:t,revealExpected:a,mode:s,labels:i,answers:l,onTextChange:u,onSelectionToggle:o,onBooleanChange:x,onOrderingMove:h,onMatchingPick:w,onMatchingRemovePath:d}){var v;if(!t)return null;const g={...co,...i??{}},r=typeof a<"u",c=String(t.kind??""),j=Array.isArray(a)?a.map(b=>Number(b)).filter(Number.isFinite):[],y=(b,Z,P)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:r?g.correctAnswerLabel:g.answerLabel}),e.jsx("input",{type:b==="number"?"number":b==="date"?"date":"text",value:Z??"",onChange:f=>P==null?void 0:P(f.target.value),readOnly:s==="readonly"||r,placeholder:g.participantAnswerPlaceholder})]}),k=(b,Z)=>Z.map((P,f)=>{const q=Array.isArray(b[f])?b[f]:[];return`${f>0?" -> ":""}${String(q[P]??P)}`}).join(""),C=b=>e.jsx("div",{className:"cogita-live-card-surface","data-state":r?"correct":"idle",children:b});if(c==="citation-fragment")return C(e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{style:{opacity:.7},children:String(t.before??"")}),e.jsx("strong",{children:" [ ... ] "}),e.jsx("span",{style:{opacity:.7},children:String(t.after??"")})]}),y("text",r?String(a??""):(l==null?void 0:l.text)??"",u)]}));if(c==="text")return C(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:String(t.prompt??"")}),y(String(t.inputType??"text"),r?String(a??""):(l==null?void 0:l.text)??"",u)]}));if(c==="boolean"){const b=!!a,Z=l==null?void 0:l.booleanAnswer;return C(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:String(t.prompt??"")}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:`cta ghost ${r&&b?"live-correct-answer":""}`,"data-active":!r&&Z===!0?"true":void 0,onClick:()=>x==null?void 0:x(!0),disabled:s==="readonly"||r,children:g.trueLabel}),e.jsx("button",{type:"button",className:`cta ghost ${r&&!b?"live-correct-answer":""}`,"data-active":!r&&Z===!1?"true":void 0,onClick:()=>x==null?void 0:x(!1),disabled:s==="readonly"||r,children:g.falseLabel})]})]}))}if(c==="selection"){const b=Array.isArray(t.options)?t.options:[],Z=!!t.multiple,P=(l==null?void 0:l.selection)??[];return C(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:String(t.prompt??"")}),e.jsx("div",{className:"cogita-share-list",children:b.map((f,q)=>e.jsxs("label",{className:"cogita-share-row","data-state":r&&j.includes(q)?"correct":void 0,children:[e.jsx("span",{children:f}),e.jsx("input",{type:Z?"checkbox":"radio",name:"live-selection",checked:r?j.includes(q):P.includes(q),onChange:()=>o==null?void 0:o(q),disabled:s==="readonly"||r})]},`${q}-${f}`))})]}))}if(c==="ordering"){const b=Array.isArray(r?a:l==null?void 0:l.ordering)?(r?a:(l==null?void 0:l.ordering)??[]).map(String):[];return C(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:String(t.prompt??"")}),e.jsx("div",{className:"cogita-share-list",children:b.map((Z,P)=>e.jsxs("div",{className:"cogita-share-row","data-state":r?"correct":void 0,children:[e.jsx("span",{children:Z}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>h==null?void 0:h(P,-1),disabled:s==="readonly"||r,children:"↑"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>h==null?void 0:h(P,1),disabled:s==="readonly"||r,children:"↓"})]})]},`${P}-${Z}`))})]}))}if(c==="matching"){const b=Array.isArray(t.columns)?t.columns:[],Z=(a==null?void 0:a.paths)??[],P=Math.max(2,b.length),f=Array.from({length:P},(q,E)=>(l==null?void 0:l.matchingSelection[E])??null);return C(e.jsxs(e.Fragment,{children:[e.jsx("p",{children:String(t.prompt??"")}),e.jsx("div",{style:{display:"grid",gap:"0.65rem",gridTemplateColumns:`repeat(${P}, minmax(0, 1fr))`,alignItems:"start"},children:b.map((q,E)=>e.jsxs("div",{className:"cogita-library-panel",style:{display:"grid",gap:"0.35rem",padding:"0.6rem"},children:[e.jsx("p",{className:"cogita-user-kicker",children:`${g.columnPrefix} ${E+1}`}),q.map((ie,$)=>e.jsxs("button",{type:"button",className:"ghost cogita-checkcard-row",style:{textAlign:"left"},"data-active":!r&&f[E]===$?"true":void 0,onClick:()=>w==null?void 0:w(E,$),disabled:s==="readonly"||r,children:[e.jsx("span",{children:ie}),e.jsx("small",{children:$})]},`live-col:${E}:${$}`))]},`live-col:${E}`))}),e.jsxs("div",{style:{display:"grid",gap:"0.4rem",marginTop:"0.65rem"},children:[e.jsx("p",{className:"cogita-user-kicker",children:g.selectedPaths}),r?e.jsx("div",{className:"cogita-share-list",children:Z.map((q,E)=>e.jsx("div",{className:"cogita-share-row","data-state":"correct",children:e.jsx("span",{children:k(b,q)})},`path-${E}`))}):(((v=l==null?void 0:l.matchingRows)==null?void 0:v.length)??0)>0?e.jsx("div",{className:"cogita-share-list",children:((l==null?void 0:l.matchingRows)??[]).map((q,E)=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("span",{children:k(b,q)}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>d==null?void 0:d(E),disabled:s==="readonly",children:g.removePath})]},`path-${E}`))}):e.jsx("p",{className:"cogita-library-hint",children:g.waitingForReveal})]})]}))}return e.jsx("p",{className:"cogita-help",children:g.unsupportedPromptType})}function Ss({copy:t,currentCard:a,currentTypeLabel:s,prompt:i,languages:l,answer:u,onAnswerChange:o,computedExpected:x,computedAnswers:h,onComputedAnswerChange:w,answerTemplate:d,outputVariables:g,variableValues:r,computedFieldFeedback:c,feedback:j,canAdvance:y,quoteContext:k,quotePlaceholder:C,onCheckAnswer:v,onSkip:b,onLanguageSelect:Z,onMarkReviewed:P,onAdvance:f,showCorrectAnswer:q,setShowCorrectAnswer:E,onRevealCorrect:ie,answerMask:$,expectedAnswer:B,hasExpectedAnswer:A,handleComputedKeyDown:J,answerInputRef:fe,computedInputRefs:De,scriptMode:Ce,setScriptMode:H,matchPairs:Ne,matchLeftOrder:Y,matchRightOrder:me,matchSelection:Je,matchActiveLeft:qe,matchActiveRight:K,matchFeedback:G,onMatchLeftSelect:je,onMatchRightSelect:O,questionPrompt:Se,questionAnswers:Me,questionRevealExpected:Fe,onQuestionTextChange:Ze,onQuestionSelectionToggle:D,onQuestionBooleanChange:ce,onQuestionOrderingMove:He,onQuestionMatchingPick:Ee,onQuestionMatchingRemovePath:se,disableCheckAnswer:Xe=!1,hideSkipAction:pt=!1,allowRevealBeforeCheck:xt=!1,autoRevealAfterAnswer:Ve=!1,disableCheckAfterAnswer:ye=!1}){const Qe=n.useMemo(()=>{var st;const I=!d&&x.length===2?`The {${x[0].key}} is of type {${x[1].key}}`:null,N=d??I;if(!N)return null;const ae=new Map(x.map(it=>[it.key,it.expected])),F=new Set,U=[],re=/\{([^}]+)\}/g;let ve=0,X,de=null;for(;(X=re.exec(N))!==null;){const it=N.slice(ve,X.index);it&&U.push({type:"text",value:it});const ut=((st=X[1])==null?void 0:st.trim())??"",yt=ut&&ae.has(ut)?ut:ut&&g&&g[ut]?g[ut]:null;ut&&F.add(ut),yt&&F.add(yt),yt&&ae.has(yt)?(U.push({type:"input",value:yt}),de||(de=yt)):ut&&r&&r[ut]!==void 0?U.push({type:"text",value:r[ut]}):U.push({type:"text",value:X[0]}),ve=X.index+X[0].length}const $e=N.slice(ve);return $e&&U.push({type:"text",value:$e}),x.filter(it=>!F.has(it.key)).length>0?null:{parts:U,expectedByKey:ae,firstInputKey:de}},[d,x,g,r]),Ue=()=>{if(!Qe)return null;const{parts:I,expectedByKey:N,firstInputKey:ae}=Qe;return e.jsx("div",{className:"cogita-revision-inline-answer",children:I.map((F,U)=>{var re,ve;return F.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:F.value},`text-${U}`):e.jsx("input",{ref:X=>{De.current[F.value]=X},autoFocus:F.value===ae,value:h[F.value]??"",onChange:X=>w(F.value,X.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":c[F.value]??(j==="correct"?"correct":j==="incorrect"?"incorrect":void 0),onKeyDown:X=>R(X)||J(X),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((re=h[F.value])==null?void 0:re.length)??0,((ve=N.get(F.value))==null?void 0:ve.length)??6)}ch`}},`input-${F.value}-${U}`)})})},ke=n.useMemo(()=>{const I=new Map;return(Ne??[]).forEach(N=>I.set(N.leftId,N)),I},[Ne]),we=n.useMemo(()=>{const I=new Map;return(Ne??[]).forEach(N=>I.set(N.rightId,N)),I},[Ne]);n.useEffect(()=>{var U;if(a.cardType!=="info"||a.infoType!=="computed"||x.length===0)return;const I=typeof document<"u"?document.activeElement:null;if(I&&(I.tagName==="INPUT"||I.tagName==="TEXTAREA"))return;const N=(Qe==null?void 0:Qe.firstInputKey)??((U=x[0])==null?void 0:U.key);if(!N)return;const ae=De.current[N];if(!ae)return;const F=requestAnimationFrame(()=>{ae.focus()});return()=>cancelAnimationFrame(F)},[a,x,Qe]);const Le=(()=>{const I=[B??"",...x.map(F=>F.expected??"")].join(""),N=[u,...Object.values(h)].join(""),ae=`${I}${N}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(ae)})(),R=I=>I.ctrlKey&&(I.key==="^"||I.key==="6")?(I.preventDefault(),H(N=>N==="super"?null:"super"),!0):I.ctrlKey&&(I.key==="_"||I.key==="-")?(I.preventDefault(),H(N=>N==="sub"?null:"sub"),!0):!1,_=()=>{if(!B||!$)return B??"";const I=B.split(""),N=Array.from($),ae=N.length>0?N.reduce((F,U)=>F+U,0)/N.length:127;return I.map((F,U)=>{const re=N[U]??ae,ve=Math.max(0,Math.min(255,Math.round(re)));let X=255,de=0;return ve<=127?de=Math.round(ve/127*255):(de=255,X=Math.round(255*(1-(ve-127)/128))),e.jsx("span",{style:{color:`rgb(${X}, ${de}, 0)`},children:F},`mask-${U}`)})},z=a.cardType==="info"&&a.infoType==="citation"?(k==null?void 0:k.title)||a.label:a.description,W=q||Ve&&j!==null,ee=Xe||ye&&(j!==null||W),ue=A&&(xt||j==="incorrect"||W);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[s?e.jsx("span",{children:s}):null,e.jsx("strong",{children:z})]}),a.cardType==="vocab"&&a.checkType==="translation-match"&&Ne?e.jsxs("div",{className:"cogita-revision-body",children:[i?e.jsx("h2",{children:i}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(Y??[]).map(I=>{const N=ke.get(I);if(!N)return null;const ae=(Je==null?void 0:Je[I])??null,F=(G==null?void 0:G[I])??null,U=qe===I;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":U,"data-state":F??void 0,"data-locked":ae?"true":void 0,onClick:()=>je==null?void 0:je(I),children:[e.jsx("span",{children:N.leftLabel}),ae&&q?e.jsx("em",{children:"✓"}):null]},I)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(me??[]).map(I=>{const N=we.get(I);if(!N)return null;const ae=Object.values(Je??{}).includes(I),F=K===I;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":ae||F,"data-locked":ae?"true":void 0,onClick:()=>O==null?void 0:O(I),children:e.jsx("span",{children:N.rightLabel})},I)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:a.checkType==="translation-match"||ee,children:t.cogita.library.revision.checkAnswer}),pt?null:e.jsx("button",{type:"button",className:"ghost",onClick:b,children:t.cogita.library.revision.skip})]})]}):a.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:fe,value:u,onChange:I=>o(I.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":j==="correct"?"correct":j==="incorrect"?"incorrect":void 0,onKeyDown:I=>{if(I.key==="Enter")if(I.preventDefault(),I.stopPropagation(),y)f();else{if(ee)return;v()}}})]}),Le?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":Ce==="super",onClick:()=>H(I=>I==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":Ce==="sub",onClick:()=>H(I=>I==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:ee,children:t.cogita.library.revision.checkAnswer}),pt?null:e.jsx("button",{type:"button",className:"ghost",onClick:b,children:t.cogita.library.revision.skip})]})]}):a.cardType==="info"&&a.infoType==="question"?e.jsxs("div",{className:"cogita-revision-body",children:[Se?e.jsx(En,{prompt:Se,revealExpected:Fe,mode:"interactive",labels:{answerLabel:t.cogita.library.revision.answerLabel,correctAnswerLabel:t.cogita.library.revision.correctAnswerLabel,participantAnswerPlaceholder:t.cogita.library.revision.answerPlaceholder},answers:Me,onTextChange:Ze,onSelectionToggle:D,onBooleanChange:ce,onOrderingMove:He,onMatchingPick:Ee,onMatchingRemovePath:se}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:i}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:fe,value:u,onChange:I=>o(I.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":j==="correct"?"correct":j==="incorrect"?"incorrect":void 0,onKeyDown:I=>{if(I.key==="Enter")if(I.preventDefault(),I.stopPropagation(),y)f();else{if(ee)return;v()}}})]})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:ee,children:t.cogita.library.revision.checkAnswer}),pt?null:e.jsx("button",{type:"button",className:"ghost",onClick:b,children:t.cogita.library.revision.skip})]})]}):a.cardType==="info"&&a.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[a.label?e.jsx("p",{className:"cogita-revision-hint",children:a.label}):null,d?null:e.jsx(Wi,{value:i??"",mode:"auto"}),x.length>0?(()=>{const I=Ue();return I?e.jsx("div",{className:"cogita-inline-answer-wrap",children:I}):e.jsx("div",{className:"cogita-form-grid",children:x.map((N,ae)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:N.key}),e.jsx("textarea",{ref:F=>{De.current[N.key]=F},autoFocus:ae===0,value:h[N.key]??"",onChange:F=>w(N.key,F.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":c[N.key]??(j==="correct"?"correct":j==="incorrect"?"incorrect":void 0),onKeyDown:F=>R(F)||J(F)})]},N.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:fe,value:u,onChange:I=>o(I.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":j==="correct"?"correct":j==="incorrect"?"incorrect":void 0,onKeyDown:I=>{if(!R(I)&&I.key==="Enter")if(I.preventDefault(),I.stopPropagation(),y)f();else{if(ee)return;v()}}})]})}),Le?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":Ce==="super",onClick:()=>H(I=>I==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":Ce==="sub",onClick:()=>H(I=>I==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:ee,children:t.cogita.library.revision.checkAnswer}),pt?null:e.jsx("button",{type:"button",className:"ghost",onClick:b,children:t.cogita.library.revision.skip})]})]}):a.cardType==="info"&&a.infoType==="citation"&&k?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.quoteProgress.replace("{done}",String(k.completed)).replace("{total}",String(k.total))}),e.jsx("p",{className:"cogita-quote-text",children:k.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:fe,value:u,onChange:I=>o(I.target.value),placeholder:C??t.cogita.library.revision.quoteMissingPlaceholder,"data-state":j==="correct"?"correct":j==="incorrect"?"incorrect":void 0,onKeyDown:I=>{if(I.key==="Enter")if(I.preventDefault(),I.stopPropagation(),y)f();else{if(ee)return;v()}}})]}),e.jsx("p",{className:"cogita-quote-text",children:k.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:ee,children:t.cogita.library.revision.checkAnswer}),pt?null:e.jsx("button",{type:"button",className:"ghost",onClick:b,children:t.cogita.library.revision.skip})]})]}):a.cardType==="info"&&a.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:l.length?l.map(I=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>Z(I.label),children:I.label},I.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:t.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:b,children:t.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:P,children:t.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:b,children:t.cogita.library.revision.skip})]})]}),j&&e.jsx("div",{className:"cogita-revision-feedback","data-state":j,children:j==="correct"?t.cogita.library.revision.correct:t.cogita.library.revision.tryAgain}),ue?e.jsxs("div",{className:"cogita-revision-reveal",children:[W?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>E(I=>{const N=!I;return N&&ie(),N}),children:t.cogita.library.revision.showAnswer}),W?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),x.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[x.map(I=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:I.key}),e.jsx("span",{children:I.expected})]},I.key)),B?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:B})]}):null]}):e.jsx("p",{children:$?_():B})]}):null]}):null,y?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:f,children:t.cogita.library.revision.nextQuestion})}):null]})}const ni={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},uo=(t,a)=>{const s=Math.max(t.length,a.length,1),i=Math.abs(t.length-a.length);return Math.max(0,1-i/s)},ho=(t,a)=>{const s=new Uint8Array(t.length),i=uo(t,a);for(let l=0;l<t.length;l+=1){const u=t[l]===(a[l]??"")?128:0,o=t.length-1-l,x=a.length-1-l,h=t[o]===(a[x]??"")?127:0,w=Math.round((u+h)*i);s[l]=Math.max(0,Math.min(255,w))}return s},mo=(t,a)=>t===a||(ni[t]??[]).includes(a)?!0:(ni[a]??[]).includes(t),fn=(t,a,s)=>s?mo(t,a):t===a,Nn=(t,a,s)=>{const i=new Uint8Array(t.length);if(!t.length)return i;const l=(s==null?void 0:s.allowSimilarChars)??!0,u=[];for(let x=0;x<=t.length-3;x+=1)u.push({index:x,text:t.slice(x,x+3)});let o=!1;return u.forEach(x=>{for(let h=0;h<=a.length-3;h+=1){const w=a.slice(h,h+3);let d=0;for(let y=0;y<3;y+=1)fn(x.text[y],w[y],l)&&(d+=1);if(d<2)continue;let g=x.index-1,r=h-1;for(;g>=0&&r>=0;){const y=t[g],k=a[r];if(y===k){i[g]=Math.max(i[g],255),g-=1,r-=1,o=!0;continue}if(fn(y,k,l)&&y!==k){i[g]=Math.max(i[g],127),g-=1,r-=1,o=!0;continue}if(g>0&&t[g-1]===k){i[g]=Math.max(i[g],0),g-=1,o=!0;continue}if(r>0&&t[g]===a[r-1]){r-=1,o=!0;continue}break}for(let y=0;y<3;y+=1){const k=x.index+y,C=x.text[y],v=w[y],b=C===v?255:fn(C,v,l)?127:0;i[k]=Math.max(i[k],b),o=!0}let c=x.index+3,j=h+3;for(;c<t.length&&j<a.length;){const y=t[c],k=a[j];if(y===k){i[c]=Math.max(i[c],255),c+=1,j+=1,o=!0;continue}if(fn(y,k,l)&&y!==k){i[c]=Math.max(i[c],127),c+=1,j+=1,o=!0;continue}if(c+1<t.length&&t[c+1]===k){i[c]=Math.max(i[c],0),c+=1,o=!0;continue}if(j+1<a.length&&t[c]===a[j+1]){j+=1,o=!0;continue}break}}}),o?i:ho(t,a)},ts=t=>/[\p{L}\p{N}]/u.test(t),si=t=>t.trim().toLowerCase(),ya=(t,a)=>{if(t.length===0)return 100;const s=(a==null?void 0:a.treatSimilarCharsAsSame)??!1,i=Array.from(t).reduce((l,u)=>s&&u===127?l+255:l+u,0);return Math.round(i/(t.length*255)*100)},nn=(t,a,s)=>{const i=Math.max(0,Math.min(100,(s==null?void 0:s.thresholdPercent)??100)),l=(s==null?void 0:s.treatSimilarCharsAsSame)??!0,u=(s==null?void 0:s.ignorePunctuationAndSpacing)??!1,o=si(t),x=si(a);if(!u){const v=Nn(o,x,{allowSimilarChars:l}),b=ya(v,{treatSimilarCharsAsSame:l});return{mask:v,percent:b,isCorrect:b>=i,normalizedExpected:o,normalizedAnswer:x}}const h=Array.from(o),w=Array.from(x),d=[],g=[],r=[];h.forEach((v,b)=>{ts(v)&&(d.push(v),g.push(b))}),w.forEach(v=>{ts(v)&&r.push(v)});const c=d.join(""),j=r.join(""),y=Nn(c,j,{allowSimilarChars:l}),k=new Uint8Array(h.length);for(let v=0;v<k.length;v+=1)k[v]=ts(h[v]??"")?0:255;for(let v=0;v<y.length;v+=1){const b=g[v];b!==void 0&&(k[b]=y[v])}const C=ya(y,{treatSimilarCharsAsSame:l});return{mask:k,percent:C,isCorrect:C>=i,normalizedExpected:c,normalizedAnswer:j}},za=(t,a,s)=>{const i=t.trim().toLowerCase(),l=a.trim().toLowerCase();return s==="prefix"||s==="bidirectional"?Nn(i,l,{allowSimilarChars:!0}):Nn(i,l,{allowSimilarChars:!0})},go=t=>{if(typeof t!="string")return"";const a=t.trim().toLowerCase();return a==="selection"||a==="truefalse"||a==="text"||a==="number"||a==="date"||a==="ordering"||a==="matching"?a:""};function Ts(t){if(!t||typeof t!="object")return null;const a=t,s=a.definition&&typeof a.definition=="object"?a.definition:a,i=go(s.type);if(!i)return null;const l=typeof s.title=="string"?s.title:void 0,u=typeof s.question=="string"?s.question:"";if(!u.trim())return null;const o=Array.isArray(s.options)?s.options.map(w=>typeof w=="string"?w:"").filter(Boolean):void 0,x=Array.isArray(s.columns)?s.columns.map(w=>Array.isArray(w)?w.map(d=>typeof d=="string"?d:"").filter(Boolean):[]).filter(w=>w.length>0):void 0,h=(()=>{if(i==="selection")return(Array.isArray(s.answer)?s.answer:[]).map(d=>Number(d)).filter(d=>Number.isInteger(d)&&d>=0).sort((d,g)=>d-g);if(i==="truefalse")return typeof s.answer=="boolean"?s.answer:!1;if(i==="matching"){const w=s.answer&&typeof s.answer=="object"?s.answer:null;return{paths:(Array.isArray(w==null?void 0:w.paths)?w.paths:[]).map(r=>Array.isArray(r)?r.map(c=>Number(c)).filter(c=>Number.isInteger(c)&&c>=0):[]).filter(r=>r.length>0)}}if(typeof s.answer=="string"||typeof s.answer=="number")return s.answer})();return{type:i,title:l,question:u,options:o,answer:h,columns:x}}function ii(t){const a=t.map((l,u)=>({value:l,oldIndex:u}));for(let l=a.length-1;l>0;l-=1){const u=Math.floor(Math.random()*(l+1));[a[l],a[u]]=[a[u],a[l]]}const s=a.map(l=>l.value),i=new Map;return a.forEach((l,u)=>i.set(l.oldIndex,u)),{values:s,oldToNew:i}}function Ai(t){if(t.type==="selection"){const a=t.options??[],s=ii(a),i=Array.isArray(t.answer)?t.answer:[];return{...t,options:s.values,answer:i.map(l=>s.oldToNew.get(l)).filter(l=>Number.isInteger(l)).sort((l,u)=>l-u)}}if(t.type==="matching"){const s=(t.columns??[]).map(u=>ii(u)),l=(t.answer&&typeof t.answer=="object"&&"paths"in t.answer?t.answer.paths:[]).map(u=>u.map((o,x)=>{var h;return((h=s[x])==null?void 0:h.oldToNew.get(o))??o}));return{...t,columns:s.map(u=>u.values),answer:{paths:l}}}return t}function bn(t){return t.map(a=>Number(a)).filter(a=>Number.isInteger(a)&&a>=0).sort((a,s)=>a-s)}function ri(t){return t.join("|")}function Xt(t){const{prompt:a,expected:s,answer:i}=t;if(a.kind==="selection"){const h=Array.isArray(s)?bn(s):[],w=bn(i.selection??[]);return{correct:h.length===w.length&&h.every((g,r)=>g===w[r]),mask:null}}if(a.kind==="boolean")return{correct:typeof s=="boolean"&&i.booleanAnswer!=null&&s===i.booleanAnswer,mask:null};if(a.kind==="ordering"){const h=Array.isArray(s)?s.map(String).join(`
`):Array.isArray(a.options)?a.options.map(String).join(`
`):"",w=Array.isArray(i.ordering)?i.ordering.map(String).join(`
`):"",d=nn(h,w,{thresholdPercent:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!1});return{correct:d.isCorrect,mask:d.mask}}if(a.kind==="matching"){const h=s&&typeof s=="object"&&"paths"in s&&Array.isArray(s.paths)?s.paths.map(c=>Array.isArray(c)?bn(c):[]).filter(c=>c.length>0).map(ri):[],w=(i.matchingPaths??[]).map(c=>Array.isArray(c)?bn(c):[]).filter(c=>c.length>0).map(ri),d=Array.from(new Set(h)).sort(),g=Array.from(new Set(w)).sort();return{correct:d.length===g.length&&d.every((c,j)=>c===g[j]),mask:null}}if(a.kind==="text"&&a.inputType==="number"){const h=Number(s),w=Number(i.text??"");return{correct:Number.isFinite(h)&&Number.isFinite(w)&&Math.abs(h-w)<1e-9,mask:null}}const l=typeof s=="string"||typeof s=="number"?String(s):"",u=String(i.text??""),o=a.kind==="citation-fragment",x=nn(l,u,{thresholdPercent:o?90:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:o});return{correct:x.isCorrect,mask:x.mask}}function po(t){const a=[...t];for(let s=a.length-1;s>0;s-=1){const i=Math.floor(Math.random()*(s+1));[a[s],a[i]]=[a[i],a[s]]}return a}function pa(t){return[t.cardId,t.checkType??"",t.direction??""].join("|")}function oi(t){return[t.parentItemId,t.parentCheckType??"",t.parentDirection??""].join("|")}function li(t){const a=t.checkType??"info",s=a.startsWith("question-")?`question / ${a.slice(9)}`:a;return t.direction?`${s} / ${t.direction}`:s}function fo({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,infoId:g,selectedReviewerRoleId:r}){const[c,j]=n.useState(g),[y,k]=n.useState([]),[C,v]=n.useState([]),[b,Z]=n.useState("loading"),[P,f]=n.useState(null),[q,E]=n.useState(null),[ie,$]=n.useState(null),[B,A]=n.useState(null),[J,fe]=n.useState(""),[De,Ce]=n.useState(null),[H,Ne]=n.useState(1),[Y,me]=n.useState(null),[Je,qe]=n.useState(0),[K,G]=n.useState(!1),[je,O]=n.useState(null),[Se,Me]=n.useState({}),[Fe,Ze]=n.useState({}),[D]=n.useState({}),[ce,He]=n.useState(null),[Ee,se]=n.useState({selection:[],booleanAnswer:null,ordering:[],matchingRows:[],matchingSelection:[]}),Xe=n.useRef(null),pt=n.useRef({}),xt=rn();n.useEffect(()=>{let I=!1;return Z("loading"),Promise.all([la({libraryId:d,infoId:g}).catch(()=>null),xn({libraryId:d,infoId:g}),wn({libraryId:d,infoId:g})]).then(([N,ae,F])=>{if(I)return;const U=(N==null?void 0:N.payload)??{},re=typeof U.title=="string"&&U.title||typeof U.label=="string"&&U.label||typeof U.name=="string"&&U.name||g;j(re),E(U),$((N==null?void 0:N.infoType)??null),k(ae.items),v(F.items),Z("ready")}).catch(()=>{I||(E(null),$(null),k([]),v([]),Z("error"))}),()=>{I=!0}},[d,g]),n.useEffect(()=>{if(ie!=="translation"){A(null);return}ji({libraryId:d,infoId:g,approachKey:"vocab-card"}).then(I=>A(I.projection??null)).catch(()=>A(null))},[ie,g,d]);const Ve=n.useMemo(()=>{var ve;const I=new Map(y.map(X=>[pa(X),X])),N=new Map,ae=new Map;for(const X of y)N.set(pa(X),0),ae.set(pa(X),[]);for(const X of C){const de=oi({parentItemId:X.parentItemId,parentCheckType:X.parentCheckType,parentDirection:X.parentDirection}),$e=[X.childItemId,X.childCheckType??"",X.childDirection??""].join("|");!I.has(de)||!I.has($e)||((ve=ae.get(de))==null||ve.push($e),N.set($e,(N.get($e)??0)+1))}const F=Array.from(N.entries()).filter(([,X])=>X===0).map(([X])=>X),U=new Map;for(const X of F)U.set(X,0);for(;F.length;){const X=F.shift(),de=U.get(X)??0;for(const $e of ae.get(X)??[]){const at=Math.max(U.get($e)??0,de+1);U.set($e,at),N.set($e,(N.get($e)??1)-1),(N.get($e)??0)<=0&&F.push($e)}}const re=new Map;for(const X of y){const de=pa(X),$e=U.get(de)??0,at=re.get($e)??[];at.push(de),re.set($e,at)}return y.map(X=>{const de=pa(X),$e=U.get(de)??0,at=re.get($e)??[de],st=Math.max(0,at.indexOf(de));return{id:de,position:{x:40+st*290+($e%2?18:0),y:30+$e*120},draggable:!1,selectable:!0,data:{label:X.label,subtitle:li(X),checkType:X.checkType??"info",direction:X.direction??null},style:{width:250,borderRadius:10,border:"1px solid rgba(120,170,220,0.22)",background:"rgba(8,20,34,0.88)",color:"#e8f2ff",padding:8}}})},[y,C]),ye=n.useMemo(()=>new Map(y.map(I=>[pa(I),I])),[y]),Qe=n.useMemo(()=>{const I=[];for(const N of C){const ae=oi({parentItemId:N.parentItemId,parentCheckType:N.parentCheckType,parentDirection:N.parentDirection}),F=[N.childItemId,N.childCheckType??"",N.childDirection??""].join("|");!ye.has(ae)||!ye.has(F)||I.push({id:`${ae}->${F}`,source:ae,target:F,selectable:!1,animated:!1,style:{stroke:"rgba(148, 202, 248, 0.7)"}})}return I},[ye,C]),Ue=n.useMemo(()=>P?ye.get(P)??null:null,[ye,P]);n.useEffect(()=>{fe(""),me(null),qe(0),G(!1),O(null),Ce(null),Ze({}),se({selection:[],booleanAnswer:null,ordering:[],matchingRows:[],matchingSelection:[]})},[P]);const ke=n.useMemo(()=>{var U,re;if(!Ue)return null;const I=ie??Ue.infoType??null,N=Ue.checkType??"info",ae=Ue.direction??null,F=q??{};if(Ue.cardType==="vocab"&&B&&Array.isArray(B.words)){const ve=B.words,X=((U=ve[0])==null?void 0:U.label)??"?",de=((re=ve[1])==null?void 0:re.label)??"?";return ae==="a-to-b"?{kind:"vocab",prompt:String(X),expected:String(de)}:ae==="b-to-a"?{kind:"vocab",prompt:String(de),expected:String(X)}:{kind:"generic",prompt:`${X} ↔ ${de}`,expected:`${X} ↔ ${de}`}}if(I==="citation"&&N==="quote-fragment"&&ae&&typeof F.text=="string"){const ve=ae,X=Ma(F.text),de=X.nodes[ve];if(de){const $e=Pn(F.text,de);return{kind:"citation-fragment",expected:de.text,quoteContext:{title:c,before:$e.before,after:$e.after,total:Object.keys(X.nodes).length,completed:0},quotePlaceholder:de.text.length>0?".".repeat(Math.max(4,Math.min(18,de.text.length))):"..."}}}if(I==="question"){const ve=Ts(F);if(ve)return{kind:"question",definition:Ai(ve)}}return{kind:"generic",prompt:Ue.description||Ue.label,expected:Ue.label}},[ie,q,Ue,c,B]);n.useEffect(()=>{var N;if(!ke||ke.kind!=="question")return;const I=ke.definition;se({selection:[],booleanAnswer:null,ordering:I.type==="ordering"?po(I.options??[]):[],matchingRows:[],matchingSelection:I.type==="matching"?new Array(Math.max(2,((N=I.columns)==null?void 0:N.length)??2)).fill(null):[]})},[ke,P]);const we=async I=>{if(Ue&&r)try{await Gi({libraryId:d,outcome:{itemType:"info",itemId:Ue.cardId,checkType:Ue.checkType??"info",direction:Ue.direction??null,revisionType:"direct",evalType:"direct-check",correct:I,clientId:"cogita-info-checkcards",clientSequence:H,personRoleId:r}}),Ne(N=>N+1),Ce(I?"Saved as correct.":"Saved as incorrect.")}catch{Ce("Failed to save answer.")}},Le=Ue?pa(Ue):null,R=Le?!!Se[Le]:!1,_=async()=>{if(!Ue||!ke)return;const I=pa(Ue);if(Se[I]){Ce("This card was already checked.");return}const N=ke.kind==="question"?ke.definition.type==="selection"?{kind:"selection",options:ke.definition.options??[]}:ke.definition.type==="truefalse"?{kind:"boolean"}:ke.definition.type==="ordering"?{kind:"ordering",options:ke.definition.options??[]}:ke.definition.type==="matching"?{kind:"matching",columns:ke.definition.columns??[]}:{kind:"text",inputType:ke.definition.type==="number"?"number":ke.definition.type==="date"?"date":"text"}:{kind:ke.kind==="citation-fragment"?"citation-fragment":"text",inputType:"text"},ae=ke.kind==="question"?ke.definition.answer:ke.expected,F=Xt({prompt:N,expected:ae,answer:{text:J,selection:Ee.selection,booleanAnswer:Ee.booleanAnswer,ordering:Ee.ordering,matchingPaths:Ee.matchingRows}}),U=F.correct;O(F.mask),G(!0),me(U?"correct":"incorrect"),qe(re=>re+1),Ce(r?null:"Answer checked locally (not saved: no person selected)."),Me(re=>({...re,[I]:!0})),r&&await we(U)},z=()=>{if(!Ue||!ke)return;const I=pa(Ue);if(Se[I]||(Me(ae=>({...ae,[I]:!0})),Ce("Answer revealed (not saved).")),ke.kind==="question"){O(null);return}const N=nn(ke.expected,ke.expected,{thresholdPercent:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:ke.kind==="citation-fragment"});O(N.mask)},W=n.useMemo(()=>Ue?Ue.infoType==="question"?{...Ue,description:Ue.label}:Ue.infoType==="citation"?{...Ue,description:c}:{...Ue,description:Ue.label}:null,[Ue,c]),ee=I=>{var yt,ht;const N=I.definition,ae=R||K,F=Array.isArray(N.answer)?N.answer:[],U=N.answer&&typeof N.answer=="object"&&"paths"in N.answer?N.answer.paths:[],re=Math.max(2,((yt=N.columns)==null?void 0:yt.length)??2),ve=N.type==="matching"?Ee.matchingRows.filter(Ge=>Ge.length===re&&Ge.every(We=>Number.isInteger(We)&&We>=0)):[],X=Array.from({length:re},(Ge,We)=>Ee.matchingSelection[We]??null),de=Ge=>Ge.join("|"),$e=new Map;for(const Ge of U){const We=de(Ge);$e.set(We,($e.get(We)??0)+1)}const at=new Map;for(const Ge of ve){const We=de(Ge);at.set(We,(at.get(We)??0)+1)}const st=U.filter(Ge=>{const We=de(Ge),vt=at.get(We)??0;return vt>0?(at.set(We,vt-1),!1):!0}),it=new Map;for(const Ge of st)Ge.forEach((We,vt)=>{const Oe=it.get(vt)??new Map;Oe.set(We,(Oe.get(We)??0)+1),it.set(vt,Oe)});const ut=(Ge,We)=>{ae||se(vt=>{var Bt;const Oe=Math.max(2,((Bt=N.columns)==null?void 0:Bt.length)??2),ct=Array.from({length:Oe},(kt,zt)=>vt.matchingSelection[zt]??null);if(ct[Ge]=ct[Ge]===We?null:We,ct.some(kt=>kt==null))return{...vt,matchingSelection:ct};const $t=ct.map(kt=>Number(kt)),Mt=de($t),ft=vt.matchingRows.filter(kt=>de(kt)===Mt).length;return($e.get(Mt)??0)>ft?(me("correct"),qe(kt=>kt+1),Ce(null),{...vt,matchingRows:[...vt.matchingRows,$t],matchingSelection:new Array(Oe).fill(null)}):(me("incorrect"),qe(kt=>kt+1),Ce("This path is not valid or has already been used."),{...vt,matchingSelection:new Array(Oe).fill(null)})})};return e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:N.question||(Ue==null?void 0:Ue.label)}),N.title?e.jsx("p",{className:"cogita-revision-hint",children:N.title}):null,N.type==="selection"?e.jsx("div",{className:"cogita-choice-grid",style:{gridTemplateColumns:"1fr"},children:(N.options??[]).map((Ge,We)=>e.jsxs("label",{className:"cogita-field",style:{display:"flex",alignItems:"center",gap:"0.6rem"},children:[e.jsx("input",{type:"checkbox",checked:Ee.selection.includes(We),disabled:ae,onChange:vt=>se(Oe=>({...Oe,selection:vt.target.checked?Array.from(new Set([...Oe.selection,We])):Oe.selection.filter(ct=>ct!==We)}))}),e.jsx("span",{children:Ge})]},`q-opt:${We}`))}):null,N.type==="truefalse"?e.jsxs("div",{className:"cogita-form-actions",style:{justifyContent:"flex-start"},children:[e.jsx("button",{type:"button",className:"ghost","data-active":Ee.booleanAnswer===!0,disabled:ae,onClick:()=>se(Ge=>({...Ge,booleanAnswer:!0})),children:"True"}),e.jsx("button",{type:"button",className:"ghost","data-active":Ee.booleanAnswer===!1,disabled:ae,onClick:()=>se(Ge=>({...Ge,booleanAnswer:!1})),children:"False"})]}):null,N.type==="text"||N.type==="number"||N.type==="date"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:Xe,type:N.type==="date"?"date":"text",value:J,onChange:Ge=>fe(Ge.target.value),disabled:ae,"data-state":Y==="correct"?"correct":Y==="incorrect"?"incorrect":void 0})]}):null,N.type==="ordering"?e.jsx("div",{style:{display:"grid",gap:"0.45rem"},children:Ee.ordering.map((Ge,We)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto auto",gap:"0.5rem",alignItems:"center"},children:[e.jsxs("span",{style:{color:"rgba(184,209,234,0.75)"},children:[We+1,"."]}),e.jsx("span",{children:Ge}),e.jsx("button",{type:"button",className:"ghost",disabled:ae||We===0,onClick:()=>se(vt=>{const Oe=[...vt.ordering];return[Oe[We-1],Oe[We]]=[Oe[We],Oe[We-1]],{...vt,ordering:Oe}}),children:"Up"}),e.jsx("button",{type:"button",className:"ghost",disabled:ae||We>=Ee.ordering.length-1,onClick:()=>se(vt=>{const Oe=[...vt.ordering];return[Oe[We+1],Oe[We]]=[Oe[We],Oe[We+1]],{...vt,ordering:Oe}}),children:"Down"})]},`q-order:${We}:${Ge}`))}):null,N.type==="matching"?e.jsxs("div",{style:{display:"grid",gap:"0.65rem"},children:[e.jsx("div",{style:{display:"grid",gap:"0.65rem",gridTemplateColumns:`repeat(${Math.max(2,((ht=N.columns)==null?void 0:ht.length)??2)}, minmax(0, 1fr))`,alignItems:"start"},children:(N.columns??[]).map((Ge,We)=>e.jsxs("div",{className:"cogita-library-panel",style:{display:"grid",gap:"0.35rem",padding:"0.6rem"},children:[e.jsx("p",{className:"cogita-user-kicker",children:`Column ${We+1}`}),Ge.map((vt,Oe)=>{var ct;return e.jsxs("button",{type:"button",className:"ghost cogita-checkcard-row",style:{textAlign:"left"},disabled:ae||X[We]!==Oe&&(((ct=it.get(We))==null?void 0:ct.get(Oe))??0)<=0,"data-active":X[We]===Oe?"true":void 0,onClick:()=>ut(We,Oe),children:[e.jsx("span",{children:vt}),e.jsx("small",{children:Oe})]},`q-col:${We}:${Oe}`)})]},`q-col:${We}`))}),e.jsxs("div",{style:{display:"grid",gap:"0.4rem"},children:[e.jsx("p",{className:"cogita-user-kicker",children:"Selected paths"}),ve.length?ve.map((Ge,We)=>e.jsxs("div",{className:"cogita-share-row",style:{alignItems:"center"},children:[e.jsx("span",{children:Ge.map((vt,Oe)=>{var $t,Mt;const ct=String(((Mt=($t=N.columns)==null?void 0:$t[Oe])==null?void 0:Mt[vt])??vt);return`${Oe>0?" -> ":""}${ct}`})}),ae?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>se(vt=>({...vt,matchingRows:vt.matchingRows.filter((Oe,ct)=>ct!==We)})),children:"Remove"})]},`q-path:${We}`)):e.jsx("p",{className:"cogita-library-hint",children:"Choose one option in each column. After the last column is selected, the path is checked automatically."})]})]}):null,e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>void _(),disabled:ae,children:t.cogita.library.revision.checkAnswer})}),K?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),N.type==="selection"?e.jsx("p",{children:F.length?F.map(Ge=>{var We;return`${Ge}${(We=N.options)!=null&&We[Ge]?`: ${N.options[Ge]}`:""}`}).join(", "):"-"}):N.type==="truefalse"?e.jsx("p",{children:String(!!N.answer)}):N.type==="ordering"?e.jsx("ol",{children:(N.options??[]).map((Ge,We)=>e.jsx("li",{children:Ge},`ans-order:${We}`))}):N.type==="matching"?e.jsx("div",{style:{display:"grid",gap:"0.35rem"},children:U.length?U.map((Ge,We)=>e.jsx("p",{children:Ge.join(" → ")},`ans-path:${We}`)):e.jsx("p",{children:"-"})}):e.jsx("p",{children:String(N.answer??"")})]}):e.jsx("div",{className:"cogita-revision-reveal",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{G(!0),z()},children:t.cogita.library.revision.showAnswer})})]})},ue=n.useMemo(()=>ie?bt(t,ie):t.cogita.library.infoTypes.any,[t,ie]);return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-info-checkcards-page",children:[e.jsxs("header",{className:"cogita-info-checkcards-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:ue}),e.jsx("h2",{className:"cogita-card-title",children:c}),e.jsx("p",{className:"cogita-card-subtitle",children:g})]}),e.jsxs("div",{className:"cogita-selection-overview",children:[e.jsx("span",{className:"cogita-tag-chip",children:`Cards: ${y.length}`}),e.jsx("span",{className:"cogita-tag-chip",children:`Dependencies: ${C.length}`}),e.jsx("button",{type:"button",className:"cta",disabled:y.length===0,onClick:()=>xt(`/cogita/library/${d}/revisions/run?scope=info&infoId=${encodeURIComponent(g)}`),children:"Start revision"})]})]}),b==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading checkcards..."})}):b==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load checkcards."})}):e.jsxs("div",{className:"cogita-info-checkcards-layout",children:[e.jsxs("div",{className:"cogita-info-checkcards-main",children:[e.jsx("div",{className:"cogita-info-checkcards-graph",children:e.jsxs(bs,{nodes:Ve,edges:Qe,fitView:!0,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!0,onNodeClick:(I,N)=>f(N.id),panOnDrag:!0,children:[e.jsx(ys,{}),e.jsx(vs,{showInteractive:!1})]})}),Ue?e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[ke&&W?e.jsx(Qa,{flashState:Y,flashTick:Je,children:ke.kind==="question"?ee(ke):e.jsx(Ss,{copy:t,currentCard:W,currentTypeLabel:"",prompt:ke.kind==="citation-fragment"?null:ke.prompt,languages:[],answer:J,onAnswerChange:fe,computedExpected:[],computedAnswers:Fe,onComputedAnswerChange:(I,N)=>Ze(ae=>({...ae,[I]:N})),answerTemplate:null,outputVariables:null,variableValues:null,computedFieldFeedback:D,feedback:Y,canAdvance:!1,quoteContext:ke.kind==="citation-fragment"?ke.quoteContext:null,quotePlaceholder:ke.kind==="citation-fragment"?ke.quotePlaceholder:null,onCheckAnswer:()=>void _(),onSkip:()=>f(null),onLanguageSelect:()=>{},onMarkReviewed:()=>{},onAdvance:()=>{},showCorrectAnswer:K,setShowCorrectAnswer:G,onRevealCorrect:z,answerMask:je,expectedAnswer:ke.expected,hasExpectedAnswer:!0,handleComputedKeyDown:()=>{},answerInputRef:Xe,computedInputRefs:pt,scriptMode:ce,setScriptMode:He,matchPairs:void 0,matchLeftOrder:void 0,matchRightOrder:void 0,matchSelection:void 0,matchActiveLeft:null,matchActiveRight:null,matchFeedback:void 0,onMatchLeftSelect:void 0,onMatchRightSelect:void 0,disableCheckAnswer:R||K,hideSkipAction:!0,allowRevealBeforeCheck:!0,autoRevealAfterAnswer:!0,disableCheckAfterAnswer:!0})}):null,r?null:e.jsx("p",{className:"cogita-library-hint",children:"Result can be checked without a person; saving knowness requires a selected person in the header."}),De?e.jsx("p",{className:"cogita-library-hint",children:De}):null]}):e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[e.jsx("h4",{children:"Select a checking card"}),e.jsx("p",{className:"cogita-card-subtitle",children:"Choose a node in the dependency tree to preview and answer it."})]})]}),e.jsxs("aside",{className:"cogita-info-checkcards-panel",children:[e.jsx("h3",{children:"Checking cards"}),e.jsx("div",{className:"cogita-info-tree",children:y.map(I=>{const N=pa(I),ae=P===N;return e.jsxs("button",{type:"button",className:`ghost cogita-checkcard-row ${ae?"active":""}`,onClick:()=>f(N),children:[e.jsx("span",{children:I.label}),e.jsx("small",{children:li(I)})]},N)})})]})]})]})})})})})}function yn(t,a){var s,i;return((i=(s=t.fields.find(l=>l.fieldType===a))==null?void 0:s.plainValue)==null?void 0:i.trim())??""}function bo(t){return yn(t,"role_kind").toLowerCase()==="person"}function yo(t){return yn(t,"label")||yn(t,"display_name")||yn(t,"name")||t.roleId}function vo({copy:t,onPersonCreated:a}){const[s,i]=n.useState([]),[l,u]=n.useState("loading"),[o,x]=n.useState(null),[h,w]=n.useState(!1),[d,g]=n.useState(""),r=async()=>{u("loading");try{const y=await ki();i(y),u("ready")}catch{i([]),u("error")}};n.useEffect(()=>{r()},[]);const c=n.useMemo(()=>s.filter(bo).map(y=>({roleId:y.roleId,label:yo(y)})).sort((y,k)=>y.label.localeCompare(k.label)),[s]),j=async()=>{const y=d.trim();if(!y){x("Name is required.");return}w(!0),x(null);try{const k=await Yi({fields:[{fieldType:"nick",plainValue:y},{fieldType:"role_kind",plainValue:"person"},{fieldType:"label",plainValue:y},{fieldType:"display_name",plainValue:y}]});g(""),x("Person role created."),a==null||a(k.roleId),await r()}catch{x("Failed to create person role.")}finally{w(!1)}};return e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-browser-panel",children:[e.jsx("div",{className:"cogita-info-overview-head",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Cogita"}),e.jsx("h2",{className:"cogita-card-title",children:"Persons"}),e.jsx("p",{className:"cogita-card-subtitle",children:"Select reviewer persons in the header and create new person roles here."})]})}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("article",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Create"}),e.jsx("h3",{className:"cogita-detail-title",children:"New person role"})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{type:"text",value:d,onChange:y=>g(y.target.value),placeholder:"e.g. Anna Kowalska",disabled:h})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:j,disabled:h,children:h?"Creating...":"Create person"})}),o?e.jsx("p",{className:"cogita-library-hint",children:o}):null]})]}),e.jsxs("article",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Overview"}),e.jsx("h3",{className:"cogita-detail-title",children:"All person roles"})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[l==="loading"?e.jsx("p",{children:"Loading persons..."}):null,l==="error"?e.jsx("p",{children:"Failed to load persons."}):null,l==="ready"&&c.length===0?e.jsx("p",{children:"No person roles found."}):null,l==="ready"&&c.length>0?e.jsxs("div",{className:"cogita-details-grid",children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:"Name"}),e.jsx("span",{children:"Type"}),e.jsx("span",{children:"Role ID"}),e.jsx("span",{})]}),c.map(y=>e.jsxs("div",{className:"cogita-details-row",role:"row",children:[e.jsx("span",{}),e.jsx("span",{title:y.label,children:y.label}),e.jsx("span",{children:"person"}),e.jsx("span",{title:y.roleId,children:y.roleId}),e.jsx("span",{})]},y.roleId))]}):null]})]})]})]})})})})}function xo({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d}){const{libraryName:g}=xa(d),[r,c]=n.useState(null),[j,y]=n.useState(null),[k,C]=n.useState(null),[v,b]=n.useState(null),[Z,P]=n.useState(null),[f,q]=n.useState(null),E=n.useRef(null),ie=A=>{if(!Number.isFinite(A))return"0 B";if(A<1024)return`${A} B`;const J=A/1024;if(J<1024)return`${J.toFixed(1)} KB`;const fe=J/1024;return fe<1024?`${fe.toFixed(1)} MB`:`${(fe/1024).toFixed(1)} GB`},$=async()=>{c(null),P({loadedBytes:0,totalBytes:null,percent:null});try{c(t.cogita.library.overview.exporting);const A=await Xi(d,P),J=URL.createObjectURL(A),fe=document.createElement("a");fe.href=J,fe.download=`cogita-library-${g||d}.json`,fe.click(),URL.revokeObjectURL(J),c(t.cogita.library.overview.exportReady)}catch{c(t.cogita.library.overview.exportFail)}finally{P(A=>A??{loadedBytes:0,totalBytes:null,percent:null})}},B=async A=>{var fe;y(null),C(null),b(null);const J=(fe=A.target.files)==null?void 0:fe[0];if(J)try{y(t.cogita.library.overview.importing),q({loadedBytes:0,totalBytes:J.size,percent:0});const De=await Zi(d,J,q,Ce=>{const H=Ce.stage==="infos"?t.cogita.library.overview.importStageInfos:Ce.stage==="connections"?t.cogita.library.overview.importStageConnections:t.cogita.library.overview.importStageCollections;b(t.cogita.library.overview.importLiveProgress.replace("{stage}",H).replace("{done}",String(Ce.processed)).replace("{total}",String(Ce.total)).replace("{infos}",String(Ce.infos)).replace("{connections}",String(Ce.connections)).replace("{collections}",String(Ce.collections)))});C({infos:De.infosImported,connections:De.connectionsImported,collections:De.collectionsImported}),y(t.cogita.library.overview.importDone)}catch(De){const Ce=De instanceof ks&&De.message?` ${De.message}`:"";y(`${t.cogita.library.overview.importFail}${Ce}`)}finally{E.current&&(E.current.value="")}};return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:g}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:$,children:t.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[t.cogita.library.overview.import,e.jsx("input",{ref:E,type:"file",accept:"application/json",onChange:B})]})]}),Z?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:Z.percent??void 0,max:Z.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.exportProgress.replace("{loaded}",ie(Z.loadedBytes)).replace("{total}",Z.totalBytes?ie(Z.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,f?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:f.percent??void 0,max:f.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.importProgress.replace("{loaded}",ie(f.loadedBytes)).replace("{total}",f.totalBytes?ie(f.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,r?e.jsx("p",{className:"cogita-help",children:r}):null,j?e.jsx("p",{className:"cogita-help",children:j}):null,v?e.jsx("p",{className:"cogita-help",children:v}):null,k?e.jsx("p",{className:"cogita-help",children:t.cogita.library.overview.importSummary.replace("{infos}",String(k.infos)).replace("{connections}",String(k.connections)).replace("{collections}",String(k.collections))}):null]})]})})})]})})}function wo({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d}){const{libraryName:g}=xa(d),[r,c]=n.useState(""),[j,y]=n.useState([]),k=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:g}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:r,onChange:C=>c(C.target.value),placeholder:t.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const C=r.trim();C&&(y(v=>[{id:k(),name:C},...v]),c(""))},children:t.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[j.length===0?e.jsx("p",{children:t.cogita.library.modules.storyboardsEmpty}):null,j.map(C=>e.jsx("button",{type:"button",className:"ghost",children:C.name},C.id))]})]})]})})})]})})}function jo({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d}){const{libraryName:g}=xa(d),[r,c]=n.useState(""),[j,y]=n.useState([]),k=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:g}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:r,onChange:C=>c(C.target.value),placeholder:t.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const C=r.trim();C&&(y(v=>[{id:k(),name:C},...v]),c(""))},children:t.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[j.length===0?e.jsx("p",{children:t.cogita.library.modules.textsEmpty}):null,j.map(C=>e.jsx("button",{type:"button",className:"ghost",children:C.name},C.id))]})]})]})})})]})})}function ko({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d}){const{libraryName:g}=xa(d),r=`/#/cogita/library/${d}`,[c,j]=n.useState(""),[y,k]=n.useState([]),[C,v]=n.useState("idle"),[b,Z]=n.useState(0),[P,f]=n.useState(null);n.useEffect(()=>{v("loading");const E=window.setTimeout(()=>{Oa({libraryId:d,query:c.trim()||void 0,limit:30}).then(ie=>{k(ie.items),Z(ie.total),f(ie.nextCursor??null),v("ready")}).catch(()=>{k([]),Z(0),f(null),v("ready")})},240);return()=>window.clearTimeout(E)},[d,c]);const q=async()=>{if(P){v("loading");try{const E=await Oa({libraryId:d,query:c.trim()||void 0,limit:30,cursor:P});k(ie=>[...ie,...E.items]),f(E.nextCursor??null),Z(E.total),v("ready")}catch{v("ready")}}};return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:g}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:r,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${r}/collections/new`,children:t.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:c,onChange:E=>j(E.target.value),placeholder:t.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:t.cogita.library.collections.countLabel.replace("{shown}",String(y.length)).replace("{total}",String(b||y.length))}),e.jsx("span",{children:C==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:y.length?y.map(E=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${r}/collections/${E.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:E.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.collections.itemCountLabel.replace("{count}",String(E.itemCount))," ·"," ",E.notes||t.cogita.library.collections.noNotes]})]})},E.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${r}/collections/new`,children:t.cogita.library.collections.emptyAction})]})}),P?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:q,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const Ie=t=>`${t.cardType}:${t.cardId}:${t.checkType??""}:${t.direction??""}`,oa=(t,a,s,i)=>`${t}:${a}:${s??""}:${i??""}`;function No({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,collectionId:g}){xa(d);const r=`/#/cogita/library/${d}`,[c,j]=n.useState(t.cogita.library.collections.defaultName),[y,k]=n.useState(null),[C,v]=n.useState(0),[b,Z]=n.useState([]),[P,f]=n.useState("idle"),[q,E]=n.useState(null),ie=n.useMemo(()=>t.cogita.library.list.cardCount.replace("{shown}",String(b.length)).replace("{total}",String(C||b.length)),[t,b.length,C]);n.useEffect(()=>{Rn(d,g).then(B=>{j(B.name),k(B.notes??null),v(B.itemCount)}).catch(()=>{j(t.cogita.library.collections.defaultName),k(null)})},[d,g]),n.useEffect(()=>{f("loading"),an({libraryId:d,collectionId:g,limit:40}).then(B=>{Z(B.items),E(B.nextCursor??null),v(B.total),f("ready")}).catch(()=>{Z([]),E(null),f("ready")})},[d,g]);const $=async()=>{if(q){f("loading");try{const B=await an({libraryId:d,collectionId:g,limit:40,cursor:q});Z(A=>[...A,...B.items]),E(B.nextCursor??null),v(B.total),f("ready")}catch{f("ready")}}};return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:y||t.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:r,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${r}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${r}/collections/${g}/edit`,children:t.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${r}/revisions`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ie}),e.jsx("span",{children:P==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:b.length?b.map(B=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:B.cardType==="vocab"?t.cogita.library.list.cardTypeVocab:B.cardType==="connection"?t.cogita.library.list.cardTypeConnection:t.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:B.label}),e.jsx("p",{className:"cogita-card-subtitle",children:B.description})]})},Ie(B))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.collections.noCards})})}),q?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:$,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${r}/revisions`,children:t.cogita.library.actions.startRevision})})]})})]})})})]})})}const as=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],So={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},To=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Co=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function ci({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,collectionId:g,onCreated:r}){const c=Ja(),{libraryName:j}=xa(d),y=`/#/cogita/library/${d}`,[k,C]=n.useState(g??null),[v,b]=n.useState(""),[Z,P]=n.useState(""),[f,q,E]=pi([]),[ie,$,B]=fi([]),[A,J]=n.useState(null),[fe,De]=n.useState(null),Ce=n.useRef(null),H=n.useMemo(()=>f.find(K=>K.id===A)??null,[f,A]),Ne=!!k;n.useEffect(()=>{C(g??null)},[g]),n.useEffect(()=>{if(!g)return;let K=!1;return Promise.all([Rn(d,g),er({libraryId:d,collectionId:g})]).then(([G,je])=>{if(!K){if(b(G.name??""),P(G.notes??""),!je.graphId||je.graphId==="00000000-0000-0000-0000-000000000000"){q([]),$([]);return}q(je.nodes.map(O=>{var Me;const Se=O.payload??{};return{id:O.nodeId,type:"default",position:Se.position??{x:120,y:120},data:{nodeType:O.nodeType,label:((Me=as.find(Fe=>Fe.type===O.nodeType))==null?void 0:Me.label)??O.nodeType,params:Se.params??{}}}})),$(je.edges.map(O=>({id:O.edgeId,source:O.fromNodeId,target:O.toNodeId,sourceHandle:O.fromPort??void 0,targetHandle:O.toPort??void 0})))}}).catch(()=>{K||De(t.cogita.library.collections.saveFail)}),()=>{K=!0}},[g,t.cogita.library.collections.saveFail,d,$,q]),n.useEffect(()=>{if(g)return;const K=new URLSearchParams(c.search),G=(K.get("draft")??"").trim(),je=(K.get("draftType")??"").trim();if(!G||je!=="info-selection"||Ce.current===G)return;const O=Wr(d,G);if(!O||O.infoIds.length===0)return;const Se=crypto.randomUUID(),Me=O.infoIds.length>1?crypto.randomUUID():null,Fe=O.infoIds.map((He,Ee)=>({id:crypto.randomUUID(),type:"default",position:{x:80,y:80+Ee*100},data:{nodeType:"source.info",label:"Selected info",params:{infoId:He,infoType:"any"}}})),Ze=Me?[{id:Me,type:"default",position:{x:360,y:120+Math.max(0,(O.infoIds.length-1)*50)},data:{nodeType:"logic.or",label:"Selected infos",params:{}}}]:[],D={id:Se,type:"default",position:{x:660,y:140+Math.max(0,(O.infoIds.length-1)*35)},data:{nodeType:"output.collection",label:"Collection output",params:{}}},ce=Fe.map(He=>({id:crypto.randomUUID(),source:He.id,target:Me??Se}));Me&&ce.push({id:crypto.randomUUID(),source:Me,target:Se}),q([...Fe,...Ze,D]),$(ce),J(Se),De(`Draft loaded from ${O.infoIds.length} selected infos. Set name and save to create collection.`),Ce.current=G},[g,d,c.search,$,q]);const Y=K=>{var Se;const G=crypto.randomUUID(),je=((Se=as.find(Me=>Me.type===K))==null?void 0:Se.label)??K,O={...So[K]};q(Me=>[...Me,{id:G,type:"default",position:{x:120+Me.length*40,y:120+Me.length*40},data:{nodeType:K,label:je,params:O}}]),J(G)},me=n.useCallback(K=>{$(G=>bi({...K,id:crypto.randomUUID()},G))},[$]),Je=K=>{H&&q(G=>G.map(je=>je.id===H.id?{...je,data:{...je.data,params:K}}:je))},qe=async()=>{if(De(null),!v.trim()){De(t.cogita.library.collections.saveRequiredName);return}try{const K={nodes:f.map(O=>({nodeId:O.id,nodeType:O.data.nodeType,payload:{position:O.position,params:O.data.params}})),edges:ie.map(O=>({edgeId:O.id,fromNodeId:O.source,fromPort:O.sourceHandle??null,toNodeId:O.target,toPort:O.targetHandle??null}))};let G=k,je=!1;if(G)await ar({libraryId:d,collectionId:G,name:v.trim(),notes:Z.trim()||null}),await nr({libraryId:d,collectionId:G,nodes:K.nodes,edges:K.edges});else{const O=await tr({libraryId:d,name:v.trim(),notes:Z.trim()||void 0,items:[],graph:K});G=O.collectionId,je=!0,C(O.collectionId)}De(je?t.cogita.library.collections.saveSuccess:t.cogita.library.graph.saveSuccess),je&&r(G)}catch{De(k?t.cogita.library.graph.saveFail:t.cogita.library.collections.saveFail)}};return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:Ne?t.cogita.library.collections.detailKicker:t.cogita.library.collections.createKicker}),e.jsx("h1",{className:"cogita-library-title",children:Ne?v||t.cogita.library.collections.defaultName:j}),e.jsx("p",{className:"cogita-library-subtitle",children:Ne?t.cogita.library.collections.detailSubtitle:t.cogita.library.collections.createSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:y,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${y}/collections`,children:t.cogita.library.actions.collections}),k?e.jsx("a",{className:"cta ghost",href:`${y}/collections/${k}`,children:t.cogita.library.actions.collectionDetail}):null,e.jsx("button",{type:"button",className:"cta",onClick:qe,children:t.cogita.library.actions.saveCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.collectionInfoTitle}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{value:v,onChange:K=>b(K.target.value),placeholder:t.cogita.library.collections.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.collections.notesLabel}),e.jsx("textarea",{value:Z,onChange:K=>P(K.target.value),placeholder:t.cogita.library.collections.notesPlaceholder})]}),fe?e.jsx("p",{className:"cogita-help",children:fe}):null,e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:as.map(K=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>Y(K.type),children:K.label},K.type))})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(bs,{nodes:f,edges:ie,onNodesChange:E,onEdgesChange:B,onConnect:me,onNodeClick:(K,G)=>J(G.id),fitView:!0,children:[e.jsx(ys,{color:"rgba(120,160,200,0.2)"}),e.jsx(vs,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),H?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:H.data.label}),H.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(va,{libraryId:d,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:H.data.params.tagId?{id:H.data.params.tagId,label:H.data.params.tagLabel??"",infoType:"topic"}:null,onChange:K=>Je({...H.data.params,tagId:(K==null?void 0:K.id)??null,tagLabel:(K==null?void 0:K.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:H.data.params.scope??"any",onChange:K=>Je({...H.data.params,scope:K.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),H.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(va,{libraryId:d,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:H.data.params.languageId?{id:H.data.params.languageId,label:H.data.params.languageLabel??"",infoType:"language"}:null,onChange:K=>Je({...H.data.params,languageId:(K==null?void 0:K.id)??null,languageLabel:(K==null?void 0:K.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:H.data.params.scope??"any",onChange:K=>Je({...H.data.params,scope:K.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),H.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:H.data.params.infoType??"word",onChange:K=>Je({...H.data.params,infoType:K.target.value}),children:Co.map(K=>e.jsx("option",{value:K.value,children:K.label},K.value))})]}),e.jsx(va,{libraryId:d,infoType:H.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:H.data.params.infoId?{id:H.data.params.infoId,label:H.data.params.infoLabel??"",infoType:H.data.params.infoType??"word"}:null,onChange:K=>Je({...H.data.params,infoId:(K==null?void 0:K.id)??null,infoLabel:(K==null?void 0:K.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),H.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:H.data.params.connectionType??"translation",onChange:K=>Je({...H.data.params,connectionType:K.target.value}),children:To.map(K=>e.jsx("option",{value:K.value,children:K.label},K.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:H.data.params.connectionId??"",onChange:K=>Je({...H.data.params,connectionId:K.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(H.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const fa=t=>{if(!t.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const a=t.length,s=t.filter(u=>u.correct).length,i=Kn(Cs(t));return{score:Math.round(Math.max(0,Math.min(100,i.knowness*100))*100)/100,total:a,correct:s,lastReviewedUtc:i.lastReviewedUtc??null}},Io=t=>{if(t.maskBase64)try{const a=sr(t.maskBase64);if(!a.length)return t.correct?1:0;const s=a.reduce((i,l)=>i+l,0);return Math.max(0,Math.min(1,s/a.length/255))}catch{return t.correct?1:0}return t.correct?1:0},Cs=t=>t.map(a=>({correctness:Io(a),createdUtc:a.createdUtc})),Kn=(t,a=Date.now())=>{var C;if(!t.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const i=t.slice().sort((v,b)=>v.createdUtc.localeCompare(b.createdUtc)).slice(-5),l=i.reduce((v,b)=>v+b.correctness,0)/i.length,u=5,o=2,x=.15;let h=0,w=0;for(let v=0;v<i.length;v+=1){const b=new Date(i[v].createdUtc).getTime(),Z=v===i.length-1?a:new Date(i[v+1].createdUtc).getTime(),P=Math.max(0,(Z-b)/(1e3*60)),f=1-Math.exp(-P/u);h+=f,i[v].correctness>.5&&(w+=x)}let d=l*h*o+w;const g=((C=i[i.length-1])==null?void 0:C.createdUtc)??null,r=g?Math.max(0,(a-new Date(g).getTime())/(1e3*60)):0,j=1/(1+Math.log1p(r/60));return d*=j,i.length===1&&i[0].correctness>.5&&(d+=5.44*Math.exp(-r/2)),{knowness:d,avgCorrectness:l,lastReviewedUtc:g}},Ua=t=>{const a=t.slice();for(let s=a.length-1;s>0;s-=1){const i=Math.floor(Math.random()*(s+1));[a[s],a[i]]=[a[i],a[s]]}return a},vn=t=>t[Math.floor(Math.random()*t.length)],Mo=(t,a)=>{const s=new Map;return t.forEach(i=>s.set(i,Math.random())),t.sort((i,l)=>{const u=a(i)-a(l);return u!==0?u:(s.get(i)??0)-(s.get(l)??0)})},Fn=(t,a,s,i,l)=>{if(!t.length)return null;const u=t.filter(x=>!(l!=null&&l.has(Ie(x))));if(u.length===0)return null;const o=u.filter(x=>Ie(x)!==s);return vn(o.length?o:u)},Lo=(t,a,s,i,l)=>{if(!t.length)return null;let u=Number.POSITIVE_INFINITY;for(const w of t){const d=Ie(w);if(s.has(d))continue;const g=a[d]??1;g<u&&(u=g)}if(!Number.isFinite(u))return null;const o=t.filter(w=>{const d=Ie(w);return!s.has(d)&&(a[d]??1)===u}),x=o.filter(w=>!l||Ie(w)!==l),h=i?x.filter(w=>!i.has(Ie(w))):x;return h.length>0?vn(h):x.length>0?vn(x):l&&o.some(w=>Ie(w)===l)?o.find(w=>Ie(w)===l)??null:o.length?vn(o):null},Ri=(t,a,s,i,l)=>{const u=[],o=t.filter(h=>!l.has(Ie(h))&&!s.has(Ie(h))&&(a[Ie(h)]??0)<1),x=Mo(o,h=>a[Ie(h)]??0);for(const h of x){if(u.length>=i)break;u.push(h),l.add(Ie(h))}if(u.length<i){const h=Ua(t.filter(w=>!l.has(Ie(w))&&s.has(Ie(w))));for(const w of h){if(u.length>=i)break;u.push(w),l.add(Ie(w))}}return u},Ao=(t,a,s,i)=>Ri(t,a,s,i,new Set),Is=(t,a,s,i,l,u)=>{const o=Math.max(1,s.stackSize??a),h=Ua(t).filter((j,y,k)=>k.findIndex(C=>Ie(C)===Ie(j))===y),w=Ao(h,i,l,o),d=new Set,g=new Set,r=Fn(w,{},null,d,g),c=r?[r]:[];return r&&g.add(Ie(r)),{queue:c,meta:{pool:h,active:w,knownessMap:i,unknownSet:l,outcomesById:u,asked:d,queued:g}}},ps={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:t=>t,prepare:(t,a)=>{const i=Ua(t).filter((l,u,o)=>o.findIndex(x=>Ie(x)===Ie(l))===u);return{queue:i.slice(0,Math.min(a,i.length)),meta:{}}},applyOutcome:t=>t},Ro={id:"random-once",labelKey:"modeValueRandomOnce",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:()=>Number.MAX_SAFE_INTEGER,prepare:t=>({queue:Ua(t).filter((i,l,u)=>u.findIndex(o=>Ie(o)===Ie(i))===l),meta:{}}),applyOutcome:t=>t},Ms=(t,a,s,i)=>{const l=Math.max(1,s.stackSize??a),o=Ua(t).filter((y,k,C)=>C.findIndex(v=>Ie(v)===Ie(y))===k),x={},h=new Set,w=new Set,d=new Set,g=Math.max(1,s.levels??1);o.forEach(y=>{const k=Ie(y),C=i==null?void 0:i[k],v=typeof C=="number"&&Number.isFinite(C)?C:1;x[k]=Math.min(g,Math.max(1,Math.round(v)))});const r=[];if(o.length>0){const y=new Map;o.forEach(C=>{var b;const v=x[Ie(C)]??1;y.has(v)||y.set(v,[]),(b=y.get(v))==null||b.push(C)});const k=Array.from(y.keys()).sort((C,v)=>C-v);for(const C of k){if(r.length>=l)break;const v=Ua(y.get(C)??[]);for(const b of v){if(r.length>=l)break;r.push(b)}}}const c=Fn(r,x,null,h,w),j=c?[c]:[];return c&&w.add(Ie(c)),{queue:j,meta:{pool:o,active:r,levelMap:x,asked:h,queued:w,wrongSinceCorrect:d}}},$o={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,a)=>Math.max(1,a.stackSize??t),getProgressTotal:()=>null,prepare:(t,a,s)=>Ms(t,a,s),applyOutcome:(t,a,s,i,l)=>{if(!a)return t;const u=Math.max(1,i.levels??1),o=t.meta.pool??[],x=t.meta.active??[],h={...t.meta.levelMap??{}},w=new Set(t.meta.asked??[]),d=new Set(t.meta.queued??[]),g=new Set(t.meta.wrongSinceCorrect??[]),r=Ie(a);d.delete(r),w.add(r);const c=h[r]??1;l.correct?(h[r]=g.has(r)?1:Math.min(c+1,u),g.delete(r)):(h[r]=1,g.add(r));const j=l.correct?x.filter(C=>Ie(C)!==r):x.slice();if(l.correct&&j.length<Math.max(1,i.stackSize??1)){const C=new Set(j.map(b=>Ie(b))),v=Lo(o,h,C,w,r);v&&j.push(v)}const y=t.queue.slice(),k=Fn(j,h,r,w,d);return k&&(y.push(k),d.add(Ie(k))),{queue:y,meta:{pool:o,active:j,levelMap:h,asked:w,queued:d,wrongSinceCorrect:g}}}},Po={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,a)=>Math.max(1,a.stackSize??t),getProgressTotal:()=>null,prepare:(t,a,s)=>Is(t,a,s,{},new Set,{}),applyOutcome:(t,a,s,i,l)=>{if(!a)return t;const u=t.meta.pool??[],o=t.meta.active??[],x={...t.meta.knownessMap??{}},h=new Set(t.meta.unknownSet??[]),w={...t.meta.outcomesById??{}},d=new Set(t.meta.asked??[]),g=new Set(t.meta.queued??[]),r=Ie(a);g.delete(r),d.add(r);const c={correctness:Math.max(0,Math.min(1,l.correctness??(l.correct?1:0))),createdUtc:l.createdUtc??new Date().toISOString()},y=(w[r]??[]).concat(c).sort((P,f)=>P.createdUtc.localeCompare(f.createdUtc)).slice(-5);w[r]=y,h.delete(r);const k=Date.now();u.forEach(P=>{const f=Ie(P),q=w[f]??[];if(q.length===0){x[f]=0,h.add(f);return}const E=Kn(q,k);x[f]=E.knowness});const C=o.slice();if((x[r]??0)>=1){const P=C.filter(f=>Ie(f)!==r);C.length=0,C.push(...P)}const b=Math.max(1,i.stackSize??s);if(C.length<b){const P=new Set(C.map(q=>Ie(q))),f=Ri(u,x,h,b-C.length,P);C.push(...f)}const Z=t.queue.slice();if(Z.length===0||Ie(Z[Z.length-1])===r){const P=Fn(C,{},r,d,g);P&&(Z.push(P),g.add(Ie(P)))}return{queue:Z,meta:{pool:u,active:C,knownessMap:x,unknownSet:h,outcomesById:w,asked:d,queued:g}}}},fs={random:ps,"random-once":Ro,levels:$o,temporal:Po},Eo=Object.values(fs),sn=t=>{if(!t)return ps;const a=t.trim().toLowerCase();return a==="random"||a==="levels"||a==="temporal"||a==="random-once"?fs[a]:a==="random_once"?fs["random-once"]:ps},_n=(t,a)=>{const s={...t.defaultSettings};return a&&Object.entries(a).forEach(([i,l])=>{typeof l=="number"&&Number.isFinite(l)&&(s[i]=l),typeof l=="string"&&(s[i]=l)}),t.settingsFields.forEach(i=>{var u;const l=s[i.key];if(i.type==="number"){if(typeof l!="number"||Number.isNaN(l)){s[i.key]=t.defaultSettings[i.key]??0;return}i.min!==void 0&&(s[i.key]=Math.max(i.min,s[i.key])),i.max!==void 0&&(s[i.key]=Math.min(i.max,s[i.key]));return}if(i.type==="select"){const o=((u=i.options)==null?void 0:u.map(x=>x.value))??[];(typeof l!="string"||o.length>0&&!o.includes(l))&&(s[i.key]=t.defaultSettings[i.key]??o[0]??"")}}),s},$i=(t,a)=>{const s={};return t.settingsFields.forEach(i=>{const l=a.get(i.key);if(l){if(i.type==="number"){const u=Number(l);Number.isNaN(u)||(s[i.key]=u);return}s[i.key]=l}}),_n(t,s)},Ko=(t,a)=>{const s=new URLSearchParams;return t.settingsFields.forEach(i=>{const l=a[i.key];(typeof l=="number"||typeof l=="string")&&s.set(i.key,String(l))}),s};function di({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,collectionId:g}){const{libraryName:r}=xa(d),c=`/#/cogita/library/${d}`,[j,y]=n.useState(""),[k,C]=n.useState("all"),[v,b]=n.useState([]),[Z,P]=n.useState("idle"),[f,q]=n.useState(""),[E,ie]=n.useState({});n.useEffect(()=>{if(!g){q("");return}Rn(d,g).then(J=>q(J.name)).catch(()=>q(""))},[d,g]),n.useEffect(()=>{_r(d).then(J=>{const fe=J.reduce((De,Ce)=>(De[Ce.collectionId]=Ce.name,De),{});ie(fe)}).catch(()=>ie({}))},[d]),n.useEffect(()=>{P("loading"),xs({libraryId:d,collectionId:g}).then(J=>{b(J),P("ready")}).catch(()=>{b([]),P("ready")})},[d,g]);const $=n.useMemo(()=>{const J=new Set,fe=[];return v.forEach(De=>{const Ce=(De.revisionType??De.mode??"random").toLowerCase();J.has(Ce)||(J.add(Ce),fe.push(Ce))}),fe},[v]),B=n.useMemo(()=>{const J=j.trim().toLocaleLowerCase();return v.filter(fe=>{const De=(fe.revisionType??fe.mode??"random").toLowerCase();if(k!=="all"&&De!==k)return!1;if(!J)return!0;const Ce=E[fe.collectionId]??"";return fe.name.toLocaleLowerCase().includes(J)||De.includes(J)||Ce.toLocaleLowerCase().includes(J)})},[E,j,v,k]),A=`${c}/revisions/new`;return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.infoMode.search}),e.jsx("h1",{className:"cogita-library-title",children:f||r}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.workspace.targets.allRevisions})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),g?e.jsx("a",{className:"cta ghost",href:`${c}/collections/${g}`,children:t.cogita.workspace.targets.allCollections}):null,e.jsx("a",{className:"cta",href:A,children:t.cogita.workspace.revisionForm.createAction})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.infoMode.search}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:j,onChange:J=>y(J.target.value),placeholder:t.cogita.workspace.revisionForm.namePlaceholder})}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsxs("select",{value:k,onChange:J=>C(J.target.value),children:[e.jsx("option",{value:"all",children:t.cogita.library.infoTypes.any}),$.map(J=>e.jsx("option",{value:J,children:t.cogita.library.revision[sn(J).labelKey]},`type:${J}`))]})]})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:`${B.length} / ${v.length}`}),e.jsx("span",{children:Z==="loading"?t.cogita.library.revision.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:B.length?B.map(J=>{const fe=(J.revisionType??J.mode??"random").toLowerCase(),De=`${c}/revisions/${encodeURIComponent(J.revisionId)}`;return e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:De,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.revision[sn(fe).labelKey]}),e.jsx("h3",{className:"cogita-card-title",children:J.name}),e.jsx("p",{className:"cogita-card-subtitle",children:E[J.collectionId]??J.collectionId})]})},J.revisionId)}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.workspace.status.noRevisions}),e.jsx("a",{className:"ghost",href:A,children:t.cogita.workspace.revisionForm.createAction})]})})]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.targets.allRevisions}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.workspace.infoMode.search})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.previewBody1}),e.jsx("p",{children:t.cogita.library.revision.previewBody2})]})]})})]})})})]})})}function Fo({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,collectionId:g,revisionId:r}){const c=rn(),{libraryName:j}=xa(d),y=`/#/cogita/library/${d}`,[k,C]=n.useState([]),[v,b]=n.useState(g??""),[Z,P]=n.useState(""),[f,q]=n.useState(20),[E,ie]=n.useState("random"),[$,B]=n.useState({}),[A]=n.useState("exact"),[J,fe]=n.useState([]),[De,Ce]=n.useState(null),[H,Ne]=n.useState("idle"),[Y,me]=n.useState(null),[Je,qe]=n.useState("idle"),[K,G]=n.useState("idle"),je=!r,O=n.useMemo(()=>sn(E),[E]),Se=n.useMemo(()=>_n(O,$),[O,$]),Me=n.useMemo(()=>Ko(O,Se).toString(),[O,Se]),Fe=n.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]);n.useEffect(()=>{b(g??"")},[g]),n.useEffect(()=>{Oa({libraryId:d,limit:200}).then(se=>{C(se.items.map(Xe=>({collectionId:Xe.collectionId,name:Xe.name}))),!v&&se.items.length>0&&b(se.items[0].collectionId)}).catch(()=>C([]))},[d,v]),n.useEffect(()=>{Ni({libraryId:d}).then(se=>{fe(se),!De&&se.length>0&&Ce(se[0].roleId)}).catch(()=>fe([]))},[d,De]),n.useEffect(()=>{if(!r){P(""),ie("random"),q(20),B({}),me(null);return}$n({libraryId:d,revisionId:r}).then(se=>{b(se.collectionId),P(se.name),ie(se.mode||"random"),q(se.limit||20),B(se.revisionSettings??{})}).catch(()=>{P("")}),ir({libraryId:d}).then(se=>{const Xe=se.find(pt=>pt.revisionId===r&&!pt.revokedUtc)??null;me(Xe)}).catch(()=>me(null))},[d,r]);const Ze=n.useMemo(()=>Y!=null&&Y.shareCode?`${Fe}/${Y.shareCode}${Me?`?${Me}`:""}`:null,[Y==null?void 0:Y.shareCode,Me,Fe]),D=async()=>{if(!v){Ne("error");return}if(!Z.trim()){Ne("error");return}Ne("saving");try{if(r){await rr({libraryId:d,collectionId:v,revisionId:r,targetCollectionId:v,name:Z.trim(),revisionType:O.id,revisionSettings:Se,mode:E,check:A,limit:f}),Ne("saved");return}const se=await or({libraryId:d,collectionId:v,name:Z.trim(),revisionType:O.id,revisionSettings:Se,mode:E,check:A,limit:f});Ne("saved"),c(`/cogita/library/${d}/revisions/${encodeURIComponent(se.revisionId)}`,{replace:!0})}catch{Ne("error")}},ce=async()=>{if(r){qe("working"),G("idle");try{const se=await lr({libraryId:d,revisionId:r});me({shareId:se.shareId,revisionId:se.revisionId,revisionName:se.revisionName,collectionId:se.collectionId,collectionName:se.collectionName,shareCode:se.shareCode,revisionType:se.revisionType??null,revisionSettings:se.revisionSettings??null,mode:se.mode,check:se.check,limit:se.limit,createdUtc:se.createdUtc,revokedUtc:null}),qe("ready")}catch{qe("error")}}},He=async()=>{if(Y)try{await cr({libraryId:d,shareId:Y.shareId}),me(null),qe("idle"),G("idle")}catch{qe("error")}},Ee=async()=>{if(Ze)try{await navigator.clipboard.writeText(Ze),G("copied")}catch{G("failed")}};return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:Z||(je?t.cogita.workspace.revisionForm.createAction:j)}),e.jsx("p",{className:"cogita-library-subtitle",children:j})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:y,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${y}/revisions`,children:t.cogita.workspace.targets.allRevisions}),!je&&r?e.jsx("a",{className:"cta",href:`${y}/revisions/${encodeURIComponent(r)}/run`,children:t.cogita.library.actions.startRevision}):null]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:je?t.cogita.workspace.revisionForm.createAction:t.cogita.workspace.infoActions.edit}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.actions.collections}),e.jsxs("select",{value:v,onChange:se=>b(se.target.value),children:[e.jsx("option",{value:"",children:t.cogita.workspace.selectCollectionOption}),k.map(se=>e.jsx("option",{value:se.collectionId,children:se.name},se.collectionId))]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:Z,onChange:se=>P(se.target.value),placeholder:t.cogita.workspace.revisionForm.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsx("select",{value:E,onChange:se=>ie(se.target.value),children:Eo.map(se=>e.jsx("option",{value:se.id,children:t.cogita.library.revision[se.labelKey]},se.id))})]}),O.settingsFields.map(se=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision[se.labelKey]}),se.type==="select"?e.jsx("select",{value:String(Se[se.key]??""),onChange:Xe=>B(pt=>({...pt,[se.key]:Xe.target.value})),children:(se.options??[]).map(Xe=>e.jsx("option",{value:Xe.value,children:t.cogita.library.revision[Xe.labelKey]},Xe.value))}):e.jsx("input",{type:"number",min:se.min,max:se.max,step:se.step,value:Number(Se[se.key]??0),onChange:Xe=>B(pt=>({...pt,[se.key]:Number(Xe.target.value||0)}))})]},se.key)),O.id==="random"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:f,onChange:se=>q(Number(se.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:De??"",onChange:se=>Ce(se.target.value||null),children:J.map(se=>e.jsx("option",{value:se.roleId,children:se.label},se.roleId))})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:D,disabled:H==="saving",children:H==="saving"?"...":je?t.cogita.workspace.revisionForm.createAction:t.cogita.workspace.infoActions.edit})}),H==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.error}):null]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[!je&&r?e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.shareBody}),Ze?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:Ze,readOnly:!0})]}):e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}),Je==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareError}):null,K==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):K==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:ce,disabled:Je==="working",children:Je==="working"?t.cogita.library.revision.shareWorking:t.cogita.library.revision.shareAction}),Ze?e.jsx("button",{type:"button",className:"cta ghost",onClick:Ee,children:t.cogita.library.revision.shareCopyAction}):null,Y?e.jsx("button",{type:"button",className:"cta ghost",onClick:He,children:t.cogita.library.revision.shareRevokeAction}):null]})]}):null,!je&&r?e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.revisions.live}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.workspace.infoMode.search})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.revision.live.hostTitle})}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("a",{className:"cta ghost",href:`${y}/revisions/${encodeURIComponent(r)}/live-sessions`,children:t.cogita.workspace.revisions.live}),e.jsx("a",{className:"cta ghost",href:`/#/cogita/live-revision-host/${encodeURIComponent(d)}/${encodeURIComponent(r)}`,children:t.cogita.library.revision.live.hostTitle})]})]}):null]})]})})})]})})}const ns=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function Pi(t,a,s){if(!t)return null;const i=new Map(t.nodes.map(P=>[P.id,P])),l=new Map,u=new Set,o=P=>{if(typeof P=="number")return P;if(typeof P=="string"){const f=Number(P);return Number.isFinite(f)?f:0}return 0},x=P=>{if(l.has(P))return l.get(P);if(u.has(P))return 0;const f=i.get(P);if(!f)return 0;u.add(P);const q=ie=>{var B,A;return(ie?((B=f.inputsByHandle)==null?void 0:B[ie])??[]:f.inputs??((A=f.inputsByHandle)==null?void 0:A.in)??[]).map(J=>x(J))};let E=0;switch(f.type){case"input.random":{const ie=f.min??0,$=f.max??ie+10,B=Math.min(ie,$),A=Math.max(ie,$);E=Math.floor(Math.random()*(A-B+1))+B;break}case"input.const":{E=f.value??0;break}case"input.list":{const ie=(f.list??[]).filter(Boolean),$=Math.round(o(q("index")[0]));E=ie.length?ie[Math.max(0,Math.min(ie.length-1,$))]:String($);break}case"compute.add":{E=q("in").map($=>o($)).reduce(($,B)=>$+B,0);break}case"compute.sub":{const ie=q("add").map(B=>o(B)),$=q("sub").map(B=>o(B));E=ie.reduce((B,A)=>B+A,0)-$.reduce((B,A)=>B+A,0);break}case"compute.mul":{const ie=q("in").map($=>o($));E=ie.length?ie.reduce(($,B)=>$*B,1):0;break}case"compute.div":{const ie=o(q("num")[0]),$=q("den").map(B=>o(B)).reduce((B,A)=>B+A,0);E=Math.abs($)<Number.EPSILON?0:ie/$;break}case"compute.pow":{const ie=o(q("base")[0]),$=o(q("exp")[0]);E=Math.pow(ie,$);break}case"compute.exp":{const ie=o(q("base")[0]),$=o(q("exp")[0]);E=Math.pow(ie,$);break}case"compute.log":{const ie=o(q("value")[0]),$=o(q("base")[0]),B=Math.max(ie,Number.EPSILON);E=Math.abs($)<Number.EPSILON?Math.log(B):Math.log(B)/Math.log($);break}case"compute.abs":{E=Math.abs(o(q("in")[0]));break}case"compute.min":{const ie=q("in").map($=>o($));E=ie.length?Math.min(...ie):0;break}case"compute.max":{const ie=q("in").map($=>o($));E=ie.length?Math.max(...ie):0;break}case"compute.floor":{E=Math.floor(o(q("in")[0]));break}case"compute.ceil":{E=Math.ceil(o(q("in")[0]));break}case"compute.round":{E=Math.round(o(q("in")[0]));break}case"compute.mod":{const ie=o(q("a")[0]),$=o(q("b")[0]);E=Math.abs($)<Number.EPSILON?0:ie%$;break}case"compute.concat":{const $=["in1","in2","in3","in4","in5","in6"].flatMap(fe=>q(fe)),B=$.length?$:q("in");E=(B.length?B:q()).map(fe=>fe==null?"":String(fe)).join("");break}case"compute.trim":{const ie=q("text")[0]??q("in")[0]??"",$=ie==null?"":String(ie),B=Math.max(0,Math.round(o(q("start")[0]))),A=Math.max(0,Math.round(o(q("end")[0])));B+A>=$.length?E="":E=$.substring(B,$.length-A);break}case"output":{E=q("in")[0]??0;break}default:E=0}return u.delete(P),l.set(P,E),E},h=t.outputs&&t.outputs.length>0?t.outputs:t.output?[t.output]:t.nodes.filter(P=>P.type==="output").map(P=>P.id);t.nodes.forEach(P=>x(P.id)),h.forEach(P=>x(P));const w=P=>Math.abs(P%1)<1e-5?String(Math.round(P)):P.toFixed(3).replace(/\.?0+$/,""),d=P=>typeof P=="number"?w(P):P??"",g=new Map;h.forEach(P=>{var $,B,A,J;const f=i.get(P);if(!f)return;const q=(B=($=f.inputsByHandle)==null?void 0:$.name)==null?void 0:B[0],E=q?d(l.get(q)):"",ie=(E==null?void 0:E.toString().trim())||((A=f.outputLabel)==null?void 0:A.trim())||((J=f.name)==null?void 0:J.trim())||P;g.set(P,ie)});const r={},c={},j={};h.forEach(P=>{var E,ie;const f=i.get(P);if(!f)return;const q=g.get(P)??(((E=f.outputLabel)==null?void 0:E.trim())||((ie=f.name)==null?void 0:ie.trim())||P);r[q]=d(l.get(P)),f.name&&(c[f.name.trim()]=q),c[P]=q});const y=(P,f)=>{let q=P;return t.nodes.forEach(E=>{var J,fe;const ie=d(l.get(E.id)),$=h.includes(E.id),B=$?g.get(E.id)??((J=E.outputLabel)==null?void 0:J.trim())??((fe=E.name)==null?void 0:fe.trim())??E.id:"",A=$&&f?B:ie;q=q.replace(new RegExp(`\\{\\s*${ns(E.id)}\\s*\\}`,"gi"),A),E.name&&(q=q.replace(new RegExp(`\\{\\s*${ns(E.name)}\\s*\\}`,"gi"),A)),$&&E.outputLabel&&(q=q.replace(new RegExp(`\\{\\s*${ns(E.outputLabel)}\\s*\\}`,"gi"),B))}),q},k=a;let C=k.trim().length>0?k:"";C||(C=h.length?`Compute ${h.join(", ")}`:"Compute"),C=y(C,!0);const v=(s==null?void 0:s.trim())??"",b=v?y(v,!1):"",Z={};return l.forEach((P,f)=>{Z[f]=P,j[f]=d(P);const q=i.get(f);q!=null&&q.name&&(j[q.name.trim()]=d(P))}),{prompt:C,answers:r,values:Z,answerText:b,outputVariables:c,variableValues:j}}function Ei(t){var s;const a=Object.entries(t.answers);return{prompt:t.prompt,expectedAnswer:t.answerText??((s=a[0])==null?void 0:s[1])??"",expectedAnswers:t.answers,values:t.values,expectedAnswerIsSentence:!!(t.answerText&&t.answerText.trim().length>0),outputVariables:t.outputVariables,variableValues:t.variableValues}}const ss=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function Ki({outcomes:t}){const[a,s]=n.useState("day"),i=n.useMemo(()=>{const l=ss.find(x=>x.id===a)??ss[1],u=Date.now()-l.ms,o=t.filter(x=>new Date(x.createdUtc).getTime()>=u);return fa(o)},[t,a]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:ss.map(l=>e.jsx("button",{type:"button",className:"ghost","data-active":a===l.id,onClick:()=>s(l.id),children:l.label},l.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[i.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[i.correct," / ",i.total]})]})}const _o="cogita-revision",Vo=1,Sn="outcomes",qo=()=>new Promise((t,a)=>{const s=indexedDB.open(_o,Vo);s.onupgradeneeded=()=>{const i=s.result;if(!i.objectStoreNames.contains(Sn)){const l=i.createObjectStore(Sn,{keyPath:"id"});l.createIndex("byItem","itemKey",{unique:!1}),l.createIndex("byPending","pending",{unique:!1})}},s.onerror=()=>a(s.error),s.onsuccess=()=>t(s.result)}),on=async(t,a)=>{const s=await qo();return new Promise((i,l)=>{const u=s.transaction(Sn,t),o=u.objectStore(Sn);a(o).then(i).catch(l),u.onerror=()=>l(u.error)})},Fi=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const t=new Uint8Array(16);crypto.getRandomValues(t);const a=Array.from(t).map(s=>s.toString(16).padStart(2,"0"));return`${a.slice(0,4).join("")}-${a.slice(4,6).join("")}-${a.slice(6,8).join("")}-${a.slice(8,10).join("")}-${a.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Do=()=>{const t="cogita_revision_client_id",a=localStorage.getItem(t);if(a)return a;const s=Fi();return localStorage.setItem(t,s),s},Bo=()=>{const t="cogita_revision_client_seq",a=Number(localStorage.getItem(t)??"0"),s=Number.isFinite(a)?a+1:1;return localStorage.setItem(t,String(s)),s},_i=(t,a,s,i)=>oa(t,a,s,i),Tn=async t=>{const a=Do(),s=Bo(),i=new Date().toISOString(),l={...t,clientId:a,clientSequence:s,createdUtc:i,id:Fi(),pending:!0};return await on("readwrite",u=>new Promise((o,x)=>{const h={...l,itemKey:_i(l.itemType,l.itemId,l.checkType,l.direction)},w=u.add(h);w.onsuccess=()=>o(),w.onerror=()=>x(w.error)})),l},Cn=async(t,a,s,i)=>{if(!a)return[];try{const l=_i(t,a,s,i);return await on("readonly",u=>new Promise((o,x)=>{const w=u.index("byItem").getAll(l);w.onsuccess=()=>{const g=(w.result??[]).map(r=>({itemType:r.itemType,itemId:r.itemId,checkType:r.checkType??null,direction:r.direction??null,revisionType:r.revisionType,evalType:r.evalType,correct:r.correct,createdUtc:r.createdUtc,maskBase64:r.maskBase64,payloadBase64:r.payloadBase64,payloadHashBase64:r.payloadHashBase64,clientId:r.clientId,clientSequence:r.clientSequence,personRoleId:r.personRoleId??null})).sort((r,c)=>r.createdUtc.localeCompare(c.createdUtc));o(g)},w.onerror=()=>x(w.error)}))}catch{return[]}},ba=async()=>{try{return await on("readonly",t=>new Promise((a,s)=>{const i=t.getAll();i.onsuccess=()=>{const u=(i.result??[]).map(o=>({itemType:o.itemType,itemId:o.itemId,checkType:o.checkType??null,direction:o.direction??null,revisionType:o.revisionType,evalType:o.evalType,correct:o.correct,createdUtc:o.createdUtc,maskBase64:o.maskBase64,payloadBase64:o.payloadBase64,payloadHashBase64:o.payloadHashBase64,clientId:o.clientId,clientSequence:o.clientSequence,personRoleId:o.personRoleId??null}));a(u)},i.onerror=()=>s(i.error)}))}catch{return[]}},zo=async(t=100)=>{try{return await on("readonly",a=>new Promise((s,i)=>{const u=a.index("byPending").getAll(!0);u.onsuccess=()=>{const o=u.result??[];s(o.slice(0,t))},u.onerror=()=>i(u.error)}))}catch{return[]}},Oo=async t=>{if(t.length!==0)try{await on("readwrite",a=>new Promise((s,i)=>{let l=t.length;t.forEach(u=>{const o=a.get(u);o.onsuccess=()=>{const x=o.result;if(x){x.pending=!1;const h=a.put(x);h.onsuccess=()=>{l-=1,l===0&&s()},h.onerror=()=>i(h.error)}else l-=1,l===0&&s()},o.onerror=()=>i(o.error)})}))}catch{}},is=async(t,a)=>{const s=await zo(200);if(s.length===0)return;const i=new Map;s.forEach(l=>{var o;const u=l.personRoleId??a??"";i.has(u)||i.set(u,[]),(o=i.get(u))==null||o.push(l)});for(const[l,u]of i.entries()){const o=u.map(x=>({itemType:x.itemType,itemId:x.itemId,checkType:x.checkType??null,direction:x.direction??null,revisionType:x.revisionType,evalType:x.evalType,correct:x.correct,clientId:x.clientId,clientSequence:x.clientSequence,maskBase64:x.maskBase64??null,payloadHashBase64:x.payloadHashBase64??null,payloadBase64:x.payloadBase64??null,personRoleId:l||null}));try{await dr({libraryId:t,outcomes:o}),await Oo(u.map(x=>x.id))}catch{}}},aa=()=>({text:"",selection:[],booleanAnswer:null,ordering:[],matchingRows:[],matchingSelection:[]});function Uo(t){const a=[...t];for(let s=a.length-1;s>0;s-=1){const i=Math.floor(Math.random()*(s+1));[a[s],a[i]]=[a[i],a[s]]}return a}function In(t,a){const s=Ts(t);if(!s)return null;const i=Ai(s),l=(i.question||i.title||a||"").trim();if(i.type==="selection"){const x=i.options??[],h=Array.isArray(i.answer)?i.answer:[];return{promptText:l,promptModel:{kind:"selection",options:x},expectedModel:h,promptPayload:{kind:"selection",prompt:l,options:x,multiple:h.length!==1},initialAnswers:aa()}}if(i.type==="truefalse"){const x=typeof i.answer=="boolean"?i.answer:!1;return{promptText:l,promptModel:{kind:"boolean"},expectedModel:x,promptPayload:{kind:"boolean",prompt:l},initialAnswers:aa()}}if(i.type==="ordering"){const x=i.options??[];return{promptText:l,promptModel:{kind:"ordering",options:x},expectedModel:x,promptPayload:{kind:"ordering",prompt:l,options:x},initialAnswers:{...aa(),ordering:Uo(x)}}}if(i.type==="matching"){const x=i.columns??[],h=i.answer&&typeof i.answer=="object"&&"paths"in i.answer?{paths:Array.isArray(i.answer.paths)?i.answer.paths:[]}:{paths:[]};return{promptText:l,promptModel:{kind:"matching",columns:x},expectedModel:h,promptPayload:{kind:"matching",prompt:l,columns:x},initialAnswers:{...aa(),matchingSelection:new Array(Math.max(2,x.length)).fill(null)}}}const u=typeof i.answer=="string"||typeof i.answer=="number"?i.answer:"",o=i.type==="number"?"number":i.type==="date"?"date":"text";return{promptText:l,promptModel:{kind:"text",inputType:o},expectedModel:u,promptPayload:{kind:"text",prompt:l,inputType:o},initialAnswers:aa()}}const Qt=t=>t.trim().toLowerCase(),Zt=t=>{const a=t==null?void 0:t.trim();return a?{fragmentId:a}:null},Mn=(t,a)=>{const s=Zt(a);if(!s)return!0;const i=Zt(t);return(i==null?void 0:i.fragmentId)===s.fragmentId},At=t=>{const a=t==null?void 0:t.trim().toLowerCase();return a||null},Vi=(t,a)=>{if((At(t.childItemType)??"info")!==(a.cardType??"").toLowerCase()||t.childItemId!==a.cardId)return!1;const i=At(t.childCheckType),l=At(t.childDirection),u=At(a.checkType),o=At(a.direction);return!(i&&i!==u||l&&l!==o)},Jo={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Qo={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},Ln=(t,a,s)=>{if(!s||!a.startsWith(t))return a;const i=a.slice(t.length);if(!i)return a;const l=s==="super"?Jo:Qo,u=i.split("").map(o=>l[o]??o).join("");return t+u},An=(t,a,s)=>{var o,x,h;if(!t)return((o=a[0])==null?void 0:o.key)??null;const i=new Set(a.map(w=>w.key)),l=/\{([^}]+)\}/g;let u;for(;(u=l.exec(t))!==null;){const w=((x=u[1])==null?void 0:x.trim())??"";if(!w)continue;if(i.has(w))return w;const d=s==null?void 0:s[w];if(d&&i.has(d))return d}return((h=a[0])==null?void 0:h.key)??null},tn=t=>(()=>{const a=new Set;return t.flatMap(s=>{if(s.cardType!=="info"||s.infoType!=="citation")return[s];const i=s.description??"";if(!i.trim())return[s];const l=Ma(i),u=Object.keys(l.nodes);return u.length===0?[s]:u.map(o=>({...s,checkType:"quote-fragment",direction:o})).filter(o=>{const x=[o.cardId,o.checkType??"",o.direction??""].join("|");return a.has(x)?!1:(a.add(x),!0)})})})();function Ho({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,collectionId:g,revisionId:r}){const c=Ja(),j=`/#/cogita/library/${d}`,y=n.useMemo(()=>new URLSearchParams(c.search),[c.search]),k=Math.max(1,Number(y.get("limit")??20)),C=y.get("mode")??"random",v=n.useMemo(()=>sn(C),[C]),b=n.useMemo(()=>_n(v,$i(v,y)),[v,y]),Z=y.get("check")??"exact",P=y.get("reviewer"),f=(y.get("scope")??"").trim(),q=f==="info"||f==="info-selection"?f:"collection",E=q==="info"?(y.get("infoId")??"").trim():"",ie=q==="info-selection"?(y.get("seed")??"").trim():"",[$,B]=n.useState(null),A=g??$??void 0,J=q==="collection"&&!!A,fe=n.useMemo(()=>t.cogita.library.revision[v.labelKey]??C,[t,C,v]),De=n.useMemo(()=>Z==="exact"?t.cogita.library.revision.checkValue:Z,[t,Z]),[Ce,H]=n.useState(t.cogita.library.collections.defaultName),[Ne,Y]=n.useState([]),[me,Je]=n.useState([]),[qe,K]=n.useState("idle"),[G,je]=n.useState({current:0,total:0}),[O,Se]=n.useState(0),[Me,Fe]=n.useState(""),[Ze,D]=n.useState(null),[ce,He]=n.useState(null),[Ee,se]=n.useState(null),[Xe,pt]=n.useState(null),[xt,Ve]=n.useState(null),[ye,Qe]=n.useState(null),[Ue,ke]=n.useState(()=>aa()),[we,Le]=n.useState(null),[R,_]=n.useState([]),[z,W]=n.useState({}),[ee,ue]=n.useState({}),[I,N]=n.useState(null),[ae,F]=n.useState(null),[U,re]=n.useState(null),[ve,X]=n.useState(null),[de,$e]=n.useState(null),[at,st]=n.useState({}),it=n.useRef(0),[ut,yt]=n.useState(null),ht=n.useRef(null),Ge=n.useRef(null),[We,vt]=n.useState(null),[Oe,ct]=n.useState(!1),[$t,Mt]=n.useState(null),[ft,Kt]=n.useState([]),[Bt,kt]=n.useState(null),zt=n.useRef(null),ea=n.useRef(null),[Na,Lt]=n.useState(null),[ca,It]=n.useState(0),lt=n.useRef(null),Vt=n.useRef({}),[qt,ot]=n.useState(!1),[S,Te]=n.useState({}),[nt,p]=n.useState([]),be=n.useRef(new Map),[L,dt]=n.useState(new Set),[et,gt]=n.useState(!1),wt=n.useRef(null),St=n.useRef(new Set),Ut=n.useRef({});n.useEffect(()=>{if(!r||g){B(null);return}$n({libraryId:d,revisionId:r}).then(m=>B(m.collectionId)).catch(()=>B(null))},[g,d,r]);const Ae=Ne[O]??null,Gt=(Ae==null?void 0:Ae.checkType)==="translation-match"&&de,ta=n.useRef(new Map),Jt=n.useRef(new Map),Pt=n.useRef(new Map),na=n.useRef(new Map),Ot=n.useMemo(()=>Ae?Ae.cardType==="vocab"?t.cogita.library.revision.vocabLabel:Ae.infoType?bt(t,Ae.infoType):t.cogita.library.revision.infoLabel:"",[t,Ae]),da=n.useMemo(()=>{var T;return v.id!=="levels"?Ne.length:((T=S.pool)==null?void 0:T.length)??v.getFetchLimit(k,b)},[S,b,v,Ne.length,k]),La=v.getProgressTotal?v.getProgressTotal(Ne,S,k,b):v.id==="levels"?Math.min(k,da):Ne.length,ln=La?Math.min(O+1,La):0,sa=Math.max(1,Number(b.tries??1)),Sa=b.compare??"anchors",cn=Math.max(0,Math.min(100,Number(b.minCorrectness??0))),Ft=(b.considerDependencies??"on")==="on",ua=Math.max(0,Math.min(100,Number(b.dependencyThreshold??85))),ia=m=>{const T=m.slice();for(let V=T.length-1;V>0;V-=1){const oe=Math.floor(Math.random()*(V+1));[T[V],T[oe]]=[T[oe],T[V]]}return T},Aa=m=>ya(m,{treatSimilarCharsAsSame:!0})>=cn,dn=async()=>{const m=await ba(),T=new Map,V=new Map,oe=new Map;m.forEach(te=>{const ge=`${te.itemType}:${te.itemId}`,ze=oa(te.itemType,te.itemId,te.checkType,te.direction);if(T.has(ge)||T.set(ge,[]),T.get(ge).push(te),V.has(ze)||V.set(ze,[]),V.get(ze).push(te),te.itemType==="info"&&te.checkType==="quote-fragment"&&te.direction){const tt=`${te.itemId}:${te.direction}`;oe.has(tt)||oe.set(tt,[]),oe.get(tt).push(te)}});const le=new Map,ne=new Map,pe=new Map;return T.forEach((te,ge)=>le.set(ge,fa(te).score)),V.forEach((te,ge)=>ne.set(ge,fa(te).score)),oe.forEach((te,ge)=>pe.set(ge,fa(te).score)),{itemKnowness:le,cardKnowness:ne,fragmentKnowness:pe}},Ht=async m=>{const T=[];let V=null;for(;;){const oe=await an({libraryId:d,collectionId:m,limit:200,cursor:V});if(T.push(...oe.items),!oe.nextCursor)break;V=oe.nextCursor}return tn(T)},Pa=async(m,T)=>{if(be.current.has(m))return be.current.get(m)??0;const V=await Ht(m);if(V.length===0)return be.current.set(m,0),0;const le=V.reduce((ne,pe)=>{const te=Ie(pe);return ne+(T.get(te)??0)},0)/V.length;return be.current.set(m,le),le},Ea=(m,T)=>{if(!Ft||m.cardType!=="info"||m.infoType!=="citation"||m.checkType!=="quote-fragment")return!0;const V=Zt(m.direction);if(!(V!=null&&V.fragmentId))return!0;const oe=m.description??"";if(!oe.trim())return!0;const ne=Ma(oe).nodes[V.fragmentId];if(!ne||!ne.leftId&&!ne.rightId)return!0;const pe=[ne.leftId,ne.rightId].filter(ze=>!!ze);if(pe.length===0)return!0;const te=pe.map(ze=>{const tt=oa("info",m.cardId,"quote-fragment",ze);return T.get(tt)??0});return te.reduce((ze,tt)=>ze+tt,0)/te.length>=ua},Ha=async m=>{const T=S,V=m.concat(T.active??[]).concat(T.pool??[]).filter((te,ge,ze)=>ze.findIndex(tt=>Ie(tt)===Ie(te))===ge);if(!Ft){dt(new Set(V.map(Ie)));return}const{itemKnowness:oe,cardKnowness:le}=await dn(),ne=nt.filter(te=>At(te.childItemType)==="collection"&&te.childItemId===g&&!At(te.childCheckType)&&!At(te.childDirection)),pe=new Set;for(const te of V){if(te.cardType!=="info"){pe.add(Ie(te));continue}if(!Ea(te,le))continue;const ge=nt.filter(rt=>Vi(rt,te)).concat(ne);if(ge.length===0){pe.add(Ie(te));continue}let ze=0;for(const rt of ge)if(At(rt.parentItemType)==="collection")ze+=await Pa(rt.parentItemId,le);else if(At(rt.parentCheckType)||At(rt.parentDirection)){const mt=At(rt.parentCheckType),jt=At(rt.parentDirection),Nt=oa(rt.parentItemType,rt.parentItemId,mt,jt);ze+=le.get(Nt)??0}else{const mt=`${rt.parentItemType}:${rt.parentItemId}`;ze+=oe.get(mt)??0}ze/ge.length>=ua&&pe.add(Ie(te))}dt(pe)},un=m=>{for(let T=m;T<Ne.length;T+=1){const V=Ne[T];if(V&&(!Ft||V.cardType!=="info"||L.has(Ie(V))))return T}return-1},Wa=m=>!Ft||m.cardType!=="info"||L.has(Ie(m)),Vn=m=>{if(v.id!=="temporal"&&v.id!=="levels")return null;const T=S,V=(T.active??[]).concat(T.pool??[]),oe=new Set;for(const le of V){const ne=Ie(le);if(!(oe.has(ne)||m.has(ne))&&(oe.add(ne),Wa(le)))return le}return null},ha=n.useMemo(()=>{if(v.id!=="levels")return null;const m=S,T=m.pool??[],V=m.active??[],oe=m.levelMap??{},le=Math.max(1,Number(b.levels??1)),ne=Array.from({length:le},()=>0),pe=new Set(V.map(tt=>Ie(tt)));T.forEach(tt=>{const rt=Math.min(le,Math.max(1,oe[Ie(tt)]??1));ne[rt-1]+=1});const te=T.length||1,ge=ne.map(tt=>tt/te*100),ze=Ae?oe[Ie(Ae)]??1:null;return{counts:ne,percentages:ge,currentLevel:ze,levelsCount:le,activeCount:V.length,poolCount:T.length,activeSet:pe}},[S,b,v,Ae]),Ka=n.useMemo(()=>{if(v.id!=="temporal")return null;const m=S,T=m.pool??[],V=m.active??[],oe=m.knownessMap??{},le=new Set(m.unknownSet??[]);let ne=0;T.forEach(ge=>{(oe[Ie(ge)]??0)>1&&(ne+=1)});const pe=le.size,te=V.map(ge=>({id:Ie(ge),value:le.has(Ie(ge))?0:Math.max(0,Math.min(1,oe[Ie(ge)]??0))}));return{knownCount:ne,unknownCount:pe,dots:te}},[S,v]),qn=n.useMemo(()=>{if(!Ft)return 0;const m=S;return Ne.concat(m.active??[]).concat(m.pool??[]).filter((V,oe,le)=>le.findIndex(ne=>Ie(ne)===Ie(V))===oe).filter(V=>V.cardType==="info"&&!L.has(Ie(V))).length},[Ft,S,Ne,L]);n.useEffect(()=>{if(!Ft||qe!=="ready")return;const m=S,V=Ne.concat(m.active??[]).concat(m.pool??[]).filter((ne,pe,te)=>te.findIndex(ge=>Ie(ge)===Ie(ne))===pe).filter(ne=>ne.cardType!=="info"||L.has(Ie(ne))).length,oe=zt.current;if(zt.current=V,oe===null||V<=oe)return;const le=V-oe;kt(`New card available (+${le})`),ea.current&&window.clearTimeout(ea.current),ea.current=window.setTimeout(()=>kt(null),2200)},[Ft,qe,S,Ne,L]),n.useEffect(()=>()=>{ea.current&&window.clearTimeout(ea.current)},[]);const Dt=(m,T)=>{const V=v.applyOutcome({queue:Ne,meta:S},Ae,k,b,{correct:m,correctness:T,createdUtc:new Date().toISOString()});Y(V.queue),Te(V.meta);const oe=V.queue[O+1];oe&&wa(oe,O+1)};n.useEffect(()=>{if(J&&A){Rn(d,A).then(m=>H(m.name)).catch(()=>H(t.cogita.library.collections.defaultName));return}if(q==="info"&&E){la({libraryId:d,infoId:E}).then(m=>{const T=m.payload??{};H(T.title||T.label||T.name||E)}).catch(()=>H(E||t.cogita.library.revision.runKicker));return}if(q==="info-selection"){const m=ie?qs(d,ie):null,T=(m==null?void 0:m.infoIds.length)??0;H(T>0?`Selected infos (${T})`:"Selected infos");return}H(t.cogita.library.collections.defaultName)},[t,A,J,d,q,E,ie]),n.useEffect(()=>{js({libraryId:d,type:"language"}).then(m=>Je(m)).catch(()=>Je([]))},[d]),n.useEffect(()=>{J&&ws({libraryId:d}).then(m=>p(m.items??[])).catch(()=>p([]))},[J,d]),n.useEffect(()=>{is(d,P)},[d,P]),n.useEffect(()=>{Ha(Ne)},[Ne,nt,Ft,ua,A]),n.useEffect(()=>{if(!Ae||!Ft){gt(!1);return}if(Ae.cardType!=="info"||L.has(Ie(Ae))){gt(!1);return}const m=un(O+1);if(m>=0){gt(!1),Se(m);return}if(v.id==="temporal"||v.id==="levels"){const T=Ne.slice(0,O+1),V=Ne.slice(O+1).filter(Wa),oe=T.concat(V),le=new Set(oe.map(Ie)),ne=Vn(le);if(ne){const te=Ie(ne);le.has(te)||(oe.push(ne),le.add(te),Te(ge=>{const ze=ge,tt=new Set(ze.queued??[]);return tt.add(te),{...ze,queued:tt}}))}const pe=oe.findIndex((te,ge)=>ge!==O&&Wa(te));if(pe>=0){Y(oe),Se(pe),gt(!1);return}}gt(!0)},[Ae,L,Ft,O,Ne,S,v.id]),n.useEffect(()=>{let m=!0;return(async()=>{K("loading"),je({current:0,total:v.id==="levels"||v.id==="random-once"?0:v.getFetchLimit(k,b)});try{if(!J){if(p([]),q==="info"){if(!E){m&&(Y([]),p([]),Te({}),Se(0),K("ready"));return}const[rt,mt]=await Promise.all([xn({libraryId:d,infoId:E}),wn({libraryId:d,infoId:E})]);if(!m)return;const jt=tn(rt.items??[]);p(mt.items??[]);const Nt=v.prepare(jt,k,b);Y(Nt.queue),Te(Nt.meta),Se(0),K("ready"),je({current:jt.length,total:jt.length});return}if(q==="info-selection"){const rt=ie?qs(d,ie):null,mt=(rt==null?void 0:rt.infoIds)??[];if(!mt.length){m&&(Y([]),p([]),Te({}),Se(0),K("ready"));return}const jt=await Promise.all(mt.map(async Ca=>{const[Yt,mn]=await Promise.all([xn({libraryId:d,infoId:Ca}),wn({libraryId:d,infoId:Ca})]);return{cards:Yt.items??[],deps:mn.items??[]}}));if(!m)return;const Nt=new Map;jt.forEach(Ca=>{tn(Ca.cards).forEach(Yt=>{Nt.set(Ie(Yt),Yt)})});const Tt=Array.from(Nt.values()),Ct=new Set(Tt.map(Ie)),_t=new Map;jt.forEach(Ca=>{(Ca.deps??[]).forEach(Yt=>{const mn=oa(Yt.parentItemType,Yt.parentItemId,At(Yt.parentCheckType),At(Yt.parentDirection)),Ls=oa(Yt.childItemType,Yt.childItemId,At(Yt.childCheckType),At(Yt.childDirection));if(!Ct.has(mn)||!Ct.has(Ls))return;const As=`${mn}->${Ls}`;_t.has(As)||_t.set(As,Yt)})}),p(Array.from(_t.values()));const Ra=v.prepare(Tt,k,b);Y(Ra.queue),Te(Ra.meta),Se(0),K("ready"),je({current:Tt.length,total:Tt.length});return}}const V=[];let oe=null,le=null;do{const rt=await an({libraryId:d,collectionId:A,limit:300,cursor:oe});if(V.push(...rt.items),(v.id==="levels"||v.id==="temporal"||v.id==="random-once")&&rt.total&&(le=rt.total),je(mt=>({current:V.length,total:mt.total||rt.total||v.getFetchLimit(k,b)})),oe=rt.nextCursor??null,le!==null&&V.length>=le||v.id!=="levels"&&v.id!=="temporal"&&v.id!=="random-once"&&V.length>=v.getFetchLimit(k,b))break}while(oe);if(!m)return;const ne=tn(V);let pe;if(v.id==="levels"){const rt=Math.max(1,Number(b.levels??1)),jt=(await ba()).reduce((Nt,Tt)=>{const Ct=oa(Tt.itemType,Tt.itemId,Tt.checkType,Tt.direction);return Nt[Ct]||(Nt[Ct]=[]),Nt[Ct].push(Tt),Nt},{});pe={},ne.forEach(Nt=>{const Tt=Ie(Nt),Ct=jt[Tt]??[],_t=Ct.length>0?fa(Ct).score:0,Ra=Math.max(1,Math.min(rt,Math.ceil(_t/100*rt)));pe[Tt]=Ra})}let te=null,ge=null,ze=null;if(v.id==="temporal"){const rt=await ba(),mt=new Set(ne.map(Tt=>Ie(Tt))),jt=rt.reduce((Tt,Ct)=>{const _t=oa(Ct.itemType,Ct.itemId,Ct.checkType,Ct.direction);return mt.has(_t)&&(Tt[_t]||(Tt[_t]=[]),Tt[_t].push(Ct)),Tt},{});te={},ge=new Set,ze={};const Nt=Date.now();ne.forEach(Tt=>{const Ct=Ie(Tt),_t=jt[Ct]??[];if(_t.length===0){te[Ct]=0,ge.add(Ct),ze[Ct]=[];return}const Ra=Cs(_t);ze[Ct]=Ra;const Ca=Kn(Ra,Nt);te[Ct]=Ca.knowness})}const tt=v.id==="levels"?Ms(ne,k,b,pe):v.id==="temporal"?Is(ne,k,b,te??{},ge??new Set,ze??{}):v.prepare(ne,k,b);Y(tt.queue),Te(tt.meta),Se(0),K("ready"),je(rt=>({current:Math.min(rt.current,rt.total),total:rt.total}))}catch{m&&K("error")}})(),()=>{m=!1}},[A,J,d,k,q,b,v,P,E,ie]),n.useEffect(()=>{if(Fe(""),D(null),Lt(null),It(0),_([]),W({}),ue({}),F(null),re(null),X(null),pt(null),Ve(null),Qe(null),ke(aa()),ct(!1),ot(!1),vt(null),$e(null),st({}),!Ae){He(null),se(null),N(null),pt(null),Ve(null),Qe(null),ke(aa()),Mt(null);return}Ae.cardType==="info"&&Ae.infoType==="computed"&&He(t.cogita.library.revision.loadingComputed);let m=!0;return wa(Ae,O).then(T=>{!m||!T||(He(T.prompt),se(T.expectedAnswer),_(T.computedExpected),W(T.computedAnswers),N(T.computedValues),F(T.answerTemplate),re(T.outputVariables),X(T.variableValues),pt(T.questionPrompt),Ve(T.questionPromptModel),Qe(T.questionExpectedModel),ke(T.questionInitialAnswers))}),()=>{m=!1}},[Ae,t]),n.useEffect(()=>{if(!Ae||Ae.cardType!=="info"||Ae.infoType!=="citation"){wt.current=null,St.current=new Set,Le(null);return}const m=Ae.description??"",T=(Ae.label??"").trim(),V=T.replace(/\s+/g," ").trim(),oe=m.replace(/\s+/g," ").trim(),le=V&&V!==oe?T:t.cogita.library.infoTypes.citation;if(!m){Le(null),se(null);return}const ne=Ma(m);wt.current=ne,He(le);let pe=!0;return dn().then(({fragmentKnowness:te})=>{if(!pe)return;const ge=new Set,ze={};te.forEach((mt,jt)=>{const[Nt,Tt]=jt.split(":",2);if(Nt!==Ae.cardId)return;const Ct=Zt(Tt);if(!Ct)return;const{fragmentId:_t}=Ct;ze[_t]=mt,mt>=ua&&ge.add(_t)}),St.current=ge,Ut.current=ze;const tt=Zt(Ae.direction);if(tt!=null&&tt.fragmentId&&ne.nodes[tt.fragmentId]){M(ne,tt.fragmentId,le);return}const rt=Ba(ne,ge,ze,ua,Ft,Ae.direction);M(ne,(rt==null?void 0:rt.id)??null,le)}).catch(()=>{St.current=new Set,Ut.current={};const te=Zt(Ae.direction);if(te!=null&&te.fragmentId&&ne.nodes[te.fragmentId]){M(ne,te.fragmentId,le);return}const ge=Ba(ne,St.current,{},ua,Ft,Ae.direction);M(ne,(ge==null?void 0:ge.id)??null,le)}),()=>{pe=!1}},[Ae,t,Ft,ua]),n.useEffect(()=>{if(!Ae||Ae.cardType!=="vocab"||Ae.checkType!=="translation-match"){$e(null),st({});return}const V=(S.pool??S.active??Ne).filter(te=>te.cardType==="vocab"&&te.checkType==="translation-match").filter((te,ge,ze)=>ze.findIndex(tt=>tt.cardId===te.cardId)===ge);V.some(te=>te.cardId===Ae.cardId)||V.unshift(Ae);const le=ia(V).slice(0,6).map(te=>{const ge=te.label.split("↔").map(rt=>rt.trim()).filter(Boolean);if(ge.length<2)return null;const ze=`${te.cardId}:L`,tt=`${te.cardId}:R`;return{cardId:te.cardId,leftId:ze,rightId:tt,leftLabel:ge[0],rightLabel:ge[1]}}).filter(Boolean),ne=le.map(te=>te.leftId),pe=ia(le.map(te=>te.rightId));$e({pairs:le,leftOrder:ne,rightOrder:pe,selection:{},activeLeft:null,activeRight:null,locked:{}})},[Ae,Ne,S]),n.useEffect(()=>()=>{ht.current&&window.clearTimeout(ht.current),Ge.current&&window.clearTimeout(Ge.current)},[]);const Wt=n.useRef(null);n.useEffect(()=>{if(!Ae)return;const m=Ie(Ae),T=typeof document<"u"?document.activeElement:null;if(Wt.current===m&&T&&(T.tagName==="INPUT"||T.tagName==="TEXTAREA"))return;let V=0;const oe=()=>{if(Ae){if(Ae.cardType==="info"&&Ae.infoType==="computed"){if(R.length>0){const ne=An(ae,R,U),pe=ne?Vt.current[ne]:null;if(pe&&(pe.focus(),document.activeElement===pe)){Wt.current=m;return}}if(lt.current&&(lt.current.focus(),document.activeElement===lt.current)){Wt.current=m;return}}else if(Ae.cardType==="vocab"&&lt.current&&(lt.current.focus(),document.activeElement===lt.current)){Wt.current=m;return}V<6&&(V+=1,window.setTimeout(oe,40))}},le=window.setTimeout(oe,40);return()=>window.clearTimeout(le)},[Ae,R,ae,U]),n.useEffect(()=>{if(!qt)return;const m=T=>{T.key==="Enter"&&(T.preventDefault(),qa())};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[qt]);const Fa=m=>{Kt(m),Mt(fa(m))};n.useEffect(()=>{if(!Ae){Mt(null),Kt([]);return}const m=Ae.cardType==="info"?"info":"connection";if(Ae.cardType==="info"&&Ae.infoType==="citation"){ba().then(T=>{const V=T.filter(oe=>oe.itemType==="info"&&oe.itemId===Ae.cardId&&oe.checkType==="quote-fragment"&&Mn(oe.direction,Ae.direction));Fa(V)}).catch(()=>{Mt(null),Kt([])});return}Cn(m,Ae.cardId,Ae.checkType,Ae.direction).then(T=>Fa(T)).catch(()=>{Mt(null),Kt([])})},[d,Ae,P]);const _a=(m,T,V,oe)=>{if(m==="info"&&V==="quote-fragment"){ba().then(le=>{const ne=le.filter(pe=>pe.itemType==="info"&&pe.itemId===T&&pe.checkType==="quote-fragment"&&Mn(pe.direction,oe));Fa(ne)}).catch(()=>{Mt(null),Kt([])});return}Cn(m,T,V,oe).then(le=>Fa(le)).catch(()=>{Mt(null),Kt([])})},Ta=(m,T,V)=>{var pe;const oe=((pe=V.pairs.find(te=>te.leftId===m))==null?void 0:pe.rightId)??null;if(!oe)return V;const le=oe===T;st(te=>({...te,[m]:le?"correct":"incorrect"})),ht.current&&window.clearTimeout(ht.current),Ge.current&&window.clearTimeout(Ge.current),it.current+=1;const ne={kind:le?"correct":"incorrect",tick:it.current};if(yt(null),ht.current=window.setTimeout(()=>yt(ne),0),Ge.current=window.setTimeout(()=>yt(null),420),le){const te={...V.locked,[m]:!0};return Object.keys(te).length>=V.pairs.length?(D("correct"),ot(!0)):D("correct"),{...V,selection:{...V.selection,[m]:T},activeLeft:null,activeRight:null,locked:te}}return D("incorrect"),{...V,activeLeft:null,activeRight:null}},Dn=m=>{$e(T=>!T||T.locked[m]?T:T.activeRight?Ta(m,T.activeRight,T):{...T,activeLeft:T.activeLeft===m?null:m})},Va=m=>{$e(T=>T&&(T.activeLeft?Ta(T.activeLeft,m,T):{...T,activeRight:T.activeRight===m?null:m}))},hn=m=>{ke(T=>{if(Xe!=null&&Xe.multiple){const V=T.selection.includes(m)?T.selection.filter(oe=>oe!==m):Array.from(new Set([...T.selection,m]));return{...T,selection:V}}return{...T,selection:T.selection[0]===m?[]:[m]}})},Bn=(m,T)=>{ke(V=>{var ge;const oe=Math.max(2,((ge=Xe==null?void 0:Xe.columns)==null?void 0:ge.length)??2),le=Array.from({length:oe},(ze,tt)=>V.matchingSelection[tt]??null);if(le[m]=le[m]===T?null:T,le.some(ze=>ze==null))return{...V,matchingSelection:le};const ne=le.map(ze=>Number(ze)),pe=ne.join("|"),te=V.matchingRows.some(ze=>ze.join("|")===pe);return{...V,matchingRows:te?V.matchingRows:[...V.matchingRows,ne],matchingSelection:new Array(oe).fill(null)}})},zn=(m,T)=>{ke(V=>{const oe=[...V.ordering],le=m+T;return le<0||le>=oe.length?V:([oe[m],oe[le]]=[oe[le],oe[m]],{...V,ordering:oe})})},qa=()=>{var m;if(Ae&&Ae.cardType==="info"&&Ae.infoType==="citation"&&wt.current&&we&&!((m=Zt(Ae.direction))!=null&&m.fragmentId)){const T=Ba(wt.current,St.current,Ut.current,ua,Ft,Ae.direction,we.fragmentId);if(T){D(null),Fe(""),ct(!1),ue({}),ot(!1),Lt(null),It(0),M(wt.current,T.id,we.title);return}}D(null),Fe(""),ct(!1),ue({}),ot(!1),Lt(null),It(0),Se(T=>Math.min(T+1,Ne.length))},ra=m=>{if(!Ae)return;const T=m.expected??null,V=m.answer??"";let oe=T??"",le=V;if(!T&&m.expectedMap&&m.answerMap){const rt=Object.keys(m.expectedMap).sort((mt,jt)=>mt.localeCompare(jt));oe=rt.map(mt=>{var jt;return((jt=m.expectedMap)==null?void 0:jt[mt])??""}).join("|"),le=rt.map(mt=>{var jt;return((jt=m.answerMap)==null?void 0:jt[mt])??""}).join("|")}const ne=oe?za(oe,le,Sa):new Uint8Array,pe={revisionType:v.id,evalType:m.evalType,direction:m.direction,prompt:ce??"",expected:T,answer:V,expectedAnswers:m.expectedMap??null,answers:m.answerMap??null,correct:m.correct,maskBase64:ne.length?Ia(ne):null,values:I??null,checkMode:Z,compareMode:Sa,minCorrectness:cn},te=new TextEncoder().encode(JSON.stringify(pe)),ge=Ae.cardType==="info"?"info":"connection",ze=m.overrideCheckType??Ae.checkType??null,tt=m.overrideDirection??Ae.direction??null;Tn({itemType:ge,itemId:Ae.cardId,checkType:ze,direction:tt,revisionType:v.id,evalType:m.evalType,correct:m.correct,maskBase64:ne.length?Ia(ne):null,payloadBase64:Ia(te),personRoleId:P??null}).then(()=>{_a(ge,Ae.cardId,ze,tt),Ha(Ne),is(d,P)}).catch(()=>{})},On=(m,T)=>{const V=ta.current.get(T);if(V)return Promise.resolve(V);const oe=Jt.current.get(T);if(oe)return oe;const le=la({libraryId:d,infoId:m}).then(ne=>{var rt,mt;const pe=ne.payload,te=((rt=pe.definition)==null?void 0:rt.graph)??null,ge="",ze=((mt=pe.definition)==null?void 0:mt.answerTemplate)??"",tt=Pi(te,ge,ze);if(tt){const Nt={sample:Ei(tt),answerTemplate:ze||null};return ta.current.set(T,Nt),Nt}return ds({libraryId:d,infoId:m}).then(jt=>{const Nt={sample:jt,answerTemplate:null};return ta.current.set(T,Nt),Nt})}).catch(()=>ds({libraryId:d,infoId:m}).then(ne=>{const pe={sample:ne,answerTemplate:null};return ta.current.set(T,pe),pe}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Jt.current.delete(T)});return Jt.current.set(T,le),le},wa=(m,T)=>{var te;const V=`${Ie(m)}:${T}`,oe=Pt.current.get(V);if(oe)return Promise.resolve(oe);const le=na.current.get(V);if(le)return le;const ne=ge=>{const ze={...ge,questionPrompt:ge.questionPrompt??null,questionPromptModel:ge.questionPromptModel??null,questionExpectedModel:ge.questionExpectedModel??null,questionInitialAnswers:ge.questionInitialAnswers??aa()};return Pt.current.set(V,ze),ze};let pe;if(m.cardType==="vocab"){if(m.checkType==="translation-match")return pe=Promise.resolve(ne({prompt:m.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),pe;const ge=m.label.split("↔").map(ze=>ze.trim()).filter(Boolean);if(ge.length>=2){const tt=(m.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",rt=tt?ge[0]:ge[1],mt=tt?ge[1]:ge[0];pe=Promise.resolve(ne({prompt:rt,expectedAnswer:mt,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else pe=Promise.resolve(ne({prompt:m.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(m.cardType==="info"&&m.infoType==="word"){const ge=(te=m.description)!=null&&te.startsWith("Language: ")?m.description.replace("Language: ",""):null;pe=Promise.resolve(ne({prompt:m.label,expectedAnswer:ge,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(m.cardType==="info"&&m.infoType==="question"){const ge=In(m.payload??null,m.label);ge?pe=Promise.resolve(ne({prompt:ge.promptText,expectedAnswer:ge.promptModel.kind==="text"&&(typeof ge.expectedModel=="string"||typeof ge.expectedModel=="number")?String(ge.expectedModel):null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null,questionPrompt:ge.promptPayload,questionPromptModel:ge.promptModel,questionExpectedModel:ge.expectedModel,questionInitialAnswers:ge.initialAnswers})):pe=la({libraryId:d,infoId:m.cardId}).then(ze=>{const tt=In(ze.payload??{},m.label);return ne(tt?{prompt:tt.promptText,expectedAnswer:tt.promptModel.kind==="text"&&(typeof tt.expectedModel=="string"||typeof tt.expectedModel=="number")?String(tt.expectedModel):null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null,questionPrompt:tt.promptPayload,questionPromptModel:tt.promptModel,questionExpectedModel:tt.expectedModel,questionInitialAnswers:tt.initialAnswers}:{prompt:m.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})}).catch(()=>ne({prompt:m.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{na.current.delete(V)})}else m.cardType==="info"&&m.infoType==="computed"?pe=On(m.cardId,V).then(ge=>{var jt,Nt;if(!ge.sample)return ne({prompt:m.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ze=ge.sample,tt=ze.expectedAnswers?Object.entries(ze.expectedAnswers).map(([Tt,Ct])=>({key:Tt,expected:Ct})):[],rt=tt.reduce((Tt,Ct)=>(Tt[Ct.key]="",Tt),{}),mt=ze.expectedAnswerIsSentence&&((jt=ze.expectedAnswer)==null?void 0:jt.trim())||null;return ne({prompt:ze.prompt,expectedAnswer:tt.length>0?mt:((Nt=ze.expectedAnswer)==null?void 0:Nt.trim())||null,computedExpected:tt,computedAnswers:rt,computedValues:ze.values??null,answerTemplate:ge.answerTemplate,outputVariables:ze.outputVariables??null,variableValues:ze.variableValues??null})}).catch(()=>ne({prompt:m.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{na.current.delete(V)}):pe=Promise.resolve(ne({prompt:m.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return na.current.set(V,pe),pe},M=(m,T,V)=>{const oe=Object.keys(m.nodes).length,le=St.current.size;if(!T){Le({title:V,before:m.text,after:"",fragmentId:null,total:oe,completed:le}),se(null),ot(!0);return}const ne=m.nodes[T];if(!ne)return;const pe=Pn(m.text,ne);Le({title:V,before:pe.before,after:pe.after,fragmentId:ne.id,total:oe,completed:le}),se(pe.fragment),ot(!1)},Q=()=>{const m=wt.current;m&&Le(T=>T&&{...T,total:Object.keys(m.nodes).length,completed:St.current.size})},he=()=>{const m=Ne[O+1];m&&wa(m,O+1)},_e=()=>{if(he(),Ae&&Ae.cardType==="vocab"&&Ae.checkType==="translation-match"&&de){if(de.pairs.length===0){D("incorrect"),ot(!0);return}const ne=de.pairs.reduce((mt,jt)=>(mt[jt.rightId]=jt.rightLabel,mt),{});let pe=0;const te={};de.pairs.forEach(mt=>{const Nt=de.selection[mt.leftId]===mt.rightId;te[mt.leftId]=Nt?"correct":"incorrect",Nt&&(pe+=1)});const ge=de.pairs.length||1,ze=pe/ge,tt=pe===de.pairs.length;st(mt=>({...mt,...te})),tt?(D("correct"),ot(!0),It(0)):(D("incorrect"),ot(!1),It(mt=>{const jt=mt+1;return jt>=sa&&(ct(!0),ot(!0),$e(Nt=>{if(!Nt)return Nt;const Tt=Nt.pairs.reduce((Ct,_t)=>(Ct[_t.leftId]=_t.rightId,Ct),{});return{...Nt,selection:Tt}})),jt})),Dt(tt,ze);const rt="connection";Promise.all(de.pairs.map(mt=>{const jt=de.selection[mt.leftId]??null,Nt=jt?ne[jt]:"",Tt={left:mt.leftLabel,expected:mt.rightLabel,answer:Nt,checkType:"translation-match"},Ct=new TextEncoder().encode(JSON.stringify(Tt));return Tn({itemType:rt,itemId:mt.cardId,checkType:"translation-match",direction:null,revisionType:v.id,evalType:"translation-match",correct:jt===mt.rightId,maskBase64:null,payloadBase64:Ia(Ct),personRoleId:P??null})})).then(()=>{_a(rt,Ae.cardId,Ae.checkType,Ae.direction),is(d,P)}).catch(()=>{});return}if(Ae&&Ae.cardType==="info"&&Ae.infoType==="question"&&xt){const ne={text:Ue.text,selection:Ue.selection,booleanAnswer:Ue.booleanAnswer,ordering:Ue.ordering,matchingPaths:Ue.matchingRows},pe=Xt({prompt:xt,expected:ye,answer:ne}),te=pe.mask?ya(pe.mask):pe.correct?100:0;Lt(pe.mask),pe.correct?(D("correct"),ue({}),ot(!0),It(0),Dt(!0,te/100)):(D("incorrect"),ue({}),ot(!1),It(ge=>{const ze=ge+1;return ze>=sa&&(ct(!0),ot(!0)),ze}),Dt(!1,te/100)),ra({correct:pe.correct,direction:ce?`${ce} -> question`:"question",expected:JSON.stringify(ye??null),answer:JSON.stringify(ne),evalType:`question:${xt.kind}`});return}if(R.length>0){const ne=R.reduce((te,ge)=>{const ze=z[ge.key]??"";return te[ge.key]=Qt(ze)===Qt(ge.expected)?"correct":"incorrect",te},{});R.every(({key:te,expected:ge})=>{const ze=z[te]??"";return Z==="exact"&&Qt(ze)===Qt(ge)})?(D("correct"),ue(ne),ot(!0),It(0),Dt(!0,1),ra({correct:!0,direction:ce?`${ce} -> computed`:"computed",expectedMap:R.reduce((te,ge)=>(te[ge.key]=ge.expected,te),{}),answerMap:z,evalType:"computed"})):(D("incorrect"),ue(ne),ot(!1),It(te=>{const ge=te+1;return ge>=sa&&Ye&&(ct(!0),ot(!0)),ge}),Dt(!1,0),window.setTimeout(()=>{var ge;const te=An(ae,R,U);te&&Vt.current[te]&&((ge=Vt.current[te])==null||ge.focus())},40),ra({correct:!1,direction:ce?`${ce} -> computed`:"computed",expectedMap:R.reduce((te,ge)=>(te[ge.key]=ge.expected,te),{}),answerMap:z,evalType:"computed"}));return}if(Ae&&Ae.cardType==="info"&&Ae.infoType==="citation"&&(we!=null&&we.fragmentId)){if(!Ee)return;const ne=Zt(Ae.direction),pe=(ne==null?void 0:ne.fragmentId)??we.fragmentId,te=nn(Ee,Me,{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}),ge=te.mask,ze=te.isCorrect,tt=te.percent;ze?(Ut.current[we.fragmentId]=Math.max(Ut.current[we.fragmentId]??0,tt),(Ut.current[we.fragmentId]??0)>=ua&&St.current.add(we.fragmentId),Q(),D("correct"),ue({}),ot(!0),Lt(ge),It(0),tt<100&&sa<=1&&ct(!0),Dt(!0,tt/100),ra({correct:!0,direction:`quote:${we.fragmentId}`,expected:Ee,answer:Me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:pe})):(D("incorrect"),ue({}),ot(!1),Lt(ge),It(rt=>{const mt=rt+1;return mt>=sa&&Ye&&(ct(!0),ot(!0)),mt}),Dt(!1,tt/100),window.setTimeout(()=>{var rt;return(rt=lt.current)==null?void 0:rt.focus()},40),ra({correct:!1,direction:`quote:${we.fragmentId}`,expected:Ee,answer:Me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:pe}));return}if(!Ee)return;const m=za(Ee,Me,Sa),T=Z==="exact"&&Qt(Me)===Qt(Ee),V=Aa(m),oe=T||V,le=ya(m);oe?(D("correct"),ue({}),ot(!0),Lt(m),It(0),le<100&&sa<=1&&ct(!0),Dt(!0,le/100),ra({correct:!0,direction:ce?`${ce} -> ${Ee}`:null,expected:Ee,answer:Me,evalType:"text"})):(D("incorrect"),ue({}),ot(!1),Lt(m),It(ne=>{const pe=ne+1;return pe>=sa&&Ye&&(ct(!0),ot(!0)),pe}),Dt(!1,le/100),window.setTimeout(()=>{var ne;return(ne=lt.current)==null?void 0:ne.focus()},40),ra({correct:!1,direction:ce?`${ce} -> ${Ee}`:null,expected:Ee,answer:Me,evalType:"text"}))},Be=m=>{if(he(),!Ee)return;const T=za(Ee,m,Sa),V=Qt(m)===Qt(Ee),oe=Aa(T),le=V||oe,ne=ya(T);le?(D("correct"),ue({}),ot(!0),Lt(T),It(0),ne<100&&sa<=1&&ct(!0),Dt(!0,ne/100),ra({correct:!0,direction:"word->language",expected:Ee,answer:m,evalType:"language-select"})):(D("incorrect"),ue({}),ot(!1),Lt(T),It(pe=>{const te=pe+1;return te>=sa&&Ye&&(ct(!0),ot(!0)),te}),Dt(!1,ne/100),ra({correct:!1,direction:"word->language",expected:Ee,answer:m,evalType:"language-select"}))},xe=()=>{he(),D("correct"),ot(!0),It(0),Dt(!0,1),Ee&&ra({correct:!0,direction:"manual",expected:Ee,answer:Me,evalType:"manual"})},Ke=()=>{if(Dt(!1,0),Ae&&Ae.cardType==="info"&&Ae.infoType==="citation"){D(null),Fe(""),ct(!1),ue({}),ot(!1),Lt(null),It(0),Se(m=>Math.min(m+1,Ne.length));return}qa()};n.useEffect(()=>{he()},[O,Ne]);const Pe=m=>{var V;if(m.key!=="Enter")return;if(m.preventDefault(),m.stopPropagation(),qt){qa();return}const T=R.find(oe=>!(z[oe.key]??"").trim());if(T){(V=Vt.current[T.key])==null||V.focus();return}_e()},Re=t.cogita.library.revision.revealModeAfterIncorrect,Ye=R.length>0||!!Ee||(Ae==null?void 0:Ae.cardType)==="info"&&Ae.infoType==="question"&&xt!==null;return e.jsxs(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:[qe==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${G.total?Math.min(100,Math.max(0,G.current/G.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:G.total?`${Math.min(G.current,G.total)} / ${G.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:Ce}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",fe).replace("{check}",De)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:t.cogita.library.actions.libraryOverview}),J?e.jsxs(e.Fragment,{children:[e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${j}/collections/${A}`,children:t.cogita.library.actions.collectionDetail})]}):e.jsx("a",{className:"cta ghost",href:`${j}/infos`,children:t.cogita.library.actions.allCards})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:$t?`${$t.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[ha?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",ha.currentLevel??"-"," / ",ha.levelsCount]}):null,$t?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String($t.correct)).replace("{total}",String($t.total))}),$t.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date($t.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(Ki,{outcomes:ft})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Bt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Bt})}):null,e.jsx(Qa,{feedbackToken:ut?`${ut.kind}-${ut.tick}`:Gt?"idle":Ze?`${Ze}-${O}-${ca}`:"idle",children:Ae?e.jsx(e.Fragment,{children:et?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(Ss,{copy:t,currentCard:Ae,currentTypeLabel:Ot,prompt:ce,languages:me,answer:Me,onAnswerChange:m=>Fe(T=>Ln(T,m,We)),computedExpected:R,computedAnswers:z,onComputedAnswerChange:(m,T)=>W(V=>({...V,[m]:Ln(V[m]??"",T,We)})),answerTemplate:ae,outputVariables:U,variableValues:ve,computedFieldFeedback:ee,feedback:Ze,canAdvance:qt,quoteContext:we,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:_e,onSkip:Ke,onLanguageSelect:Be,onMarkReviewed:xe,onAdvance:qa,showCorrectAnswer:Oe,setShowCorrectAnswer:ct,onRevealCorrect:()=>ot(!0),answerMask:Na,expectedAnswer:Ee,hasExpectedAnswer:Ye,handleComputedKeyDown:Pe,answerInputRef:lt,computedInputRefs:Vt,scriptMode:We,setScriptMode:vt,matchPairs:de==null?void 0:de.pairs,matchLeftOrder:de==null?void 0:de.leftOrder,matchRightOrder:de==null?void 0:de.rightOrder,matchSelection:de==null?void 0:de.selection,matchActiveLeft:de==null?void 0:de.activeLeft,matchActiveRight:de==null?void 0:de.activeRight,matchFeedback:at,onMatchLeftSelect:Dn,onMatchRightSelect:Va,questionPrompt:Xe,questionAnswers:Ue,questionRevealExpected:Oe?ye:void 0,onQuestionTextChange:m=>{Fe(m),ke(T=>({...T,text:m}))},onQuestionSelectionToggle:hn,onQuestionBooleanChange:m=>ke(T=>({...T,booleanAnswer:m})),onQuestionOrderingMove:zn,onQuestionMatchingPick:Bn,onQuestionMatchingRemovePath:m=>ke(T=>({...T,matchingRows:T.matchingRows.filter((V,oe)=>oe!==m)}))})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:J?`${j}/collections/${A}`:`${j}/infos`,children:J?t.cogita.library.actions.collectionDetail:t.cogita.library.actions.allCards})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:La?`${ln} / ${La}`:t.cogita.library.revision.progressUnlimited}),qe==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),qe==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),qe==="ready"&&Ne.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Re}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",sa]})]})]}),ha?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",ha.activeCount," / ",ha.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:ha.counts.map((m,T)=>{const V=T+1,oe=ha.currentLevel===V,le=ha.percentages[T]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":oe,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:V}),e.jsx("strong",{children:m})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,le))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[le.toFixed(1),"%"]})]},`level-${V}`)})})]}):null,Ka?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:Ka.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:Ka.dots.map(m=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,m.value*100))}%`,background:`rgba(${Math.round(255*(1-m.value))}, ${Math.round(200*m.value)}, 80, 0.9)`}},m.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:Ka.knownCount})]})]}):null,Ft?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:qn})]})}):null]})]})]})})})]})]})}function Wo(t){if(t==null)return"";try{return JSON.stringify(t,null,2)}catch{return""}}function ui(t){const a=t.trim();if(!a)return{value:null,error:null};try{const s=JSON.parse(a);return!s||typeof s!="object"||Array.isArray(s)?{value:null,error:"Settings JSON must be an object."}:{value:s,error:null}}catch{return{value:null,error:"Invalid settings JSON."}}}function Go({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:d,revisionId:g,mode:r="search",sessionId:c,onCreated:j,onOpenSession:y,onRequestEdit:k,onRequestOverview:C}){const[v,b]=n.useState(""),[Z,P]=n.useState(""),[f,q]=n.useState("all"),[E,ie]=n.useState([]),[$,B]=n.useState("loading"),[A,J]=n.useState(""),[fe,De]=n.useState("simultaneous"),[Ce,H]=n.useState("panel"),[Ne,Y]=n.useState("question"),[me,Je]=n.useState(""),[qe,K]=n.useState("idle"),[G,je]=n.useState(null),[O,Se]=n.useState("none"),[Me,Fe]=n.useState(null),Ze=`/#/cogita/library/${d}`,D=async()=>{B("loading");try{const ye=await Si({libraryId:d,revisionId:g});ie(ye),B("ready")}catch{ie([]),B("error")}};n.useEffect(()=>{$n({libraryId:d,revisionId:g}).then(ye=>{b(ye.name),A.trim()||J(ye.name)}).catch(()=>b(g))},[A,d,g]),n.useEffect(()=>{D()},[d,g]);const ce=n.useMemo(()=>c?E.find(ye=>ye.sessionId===c)??null:null,[E,c]);n.useEffect(()=>{if(!c||r!=="detail"&&r!=="edit"){je(null),K("idle");return}let ye=!1;return K("loading"),Ns({libraryId:d,sessionId:c}).then(Qe=>{if(ye)return;je(Qe);const Ue=Qe.sessionSettings&&typeof Qe.sessionSettings=="object"?Qe.sessionSettings:null,ke=typeof(Ue==null?void 0:Ue.title)=="string"?Ue.title:null;J(ke??(ce==null?void 0:ce.title)??v),De(Qe.sessionMode==="asynchronous"?"asynchronous":"simultaneous"),H(Qe.hostViewMode==="question"||Qe.hostViewMode==="score"?Qe.hostViewMode:"panel"),Y(Qe.participantViewMode==="score"||Qe.participantViewMode==="fullscreen"?Qe.participantViewMode:"question"),Je(Wo(Qe.sessionSettings)),K("ready")}).catch(()=>{ye||(je(null),K("error"))}),()=>{ye=!0}},[d,r,v,ce==null?void 0:ce.title,c]),n.useEffect(()=>{r==="create"&&(Fe(null),De("simultaneous"),H("panel"),Y("question"),Je(""),A.trim()||J(v||t.cogita.library.revision.live.hostKicker))},[t.cogita.library.revision.live.hostKicker,A,r,v]);const He=n.useMemo(()=>{const ye=new Set;return E.forEach(Qe=>ye.add(Qe.status)),Array.from(ye).sort((Qe,Ue)=>Qe.localeCompare(Ue))},[E]),Ee=n.useMemo(()=>{const ye=Z.trim().toLocaleLowerCase();return E.filter(Qe=>f!=="all"&&Qe.status!==f?!1:ye?`${Qe.title??""} ${Qe.sessionId} ${Qe.status}`.toLocaleLowerCase().includes(ye):!0)},[E,Z,f]),se=async()=>{const ye=ui(me);if(ye.error){Fe(ye.error);return}Se("create"),Fe(null);try{const Qe=await us({libraryId:d,revisionId:g,title:A.trim()||null,sessionMode:fe,hostViewMode:Ce,participantViewMode:Ne,sessionSettings:ye.value});await D(),j==null||j(Qe.sessionId)}catch{Fe(t.cogita.library.revision.live.createSessionError)}finally{Se("none")}},Xe=async()=>{if(!c)return;const ye=ui(me);if(ye.error){Fe(ye.error);return}Se("save"),Fe(null);try{await ur({libraryId:d,revisionId:g,sessionId:c,title:A.trim()||null,sessionMode:fe,hostViewMode:Ce,participantViewMode:Ne,sessionSettings:ye.value}),await D(),r==="edit"&&(C==null||C(c))}catch{Fe(t.cogita.library.revision.shareError)}finally{Se("none")}},pt=G!=null&&G.code&&typeof window<"u"?`${window.location.origin}/#/cogita/public/live-revision/${encodeURIComponent(G.code)}`:"",xt=G!=null&&G.code&&typeof window<"u"?`${window.location.origin}/#/cogita/public/live-revision-screen/${encodeURIComponent(G.code)}`:"",Ve=G!=null&&G.sessionId&&(G!=null&&G.hostSecret)&&typeof window<"u"?`${window.location.origin}/#/cogita/live-revision-host/${encodeURIComponent(d)}/${encodeURIComponent(g)}?sessionId=${encodeURIComponent(G.sessionId)}&hostSecret=${encodeURIComponent(G.hostSecret)}&code=${encodeURIComponent(G.code)}`:"";return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.revisions.live}),e.jsx("h1",{className:"cogita-library-title",children:v||g}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.live.hostKicker})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${Ze}/revisions/${encodeURIComponent(g)}`,children:t.cogita.workspace.infoActions.edit}),e.jsx("a",{className:"cta ghost",href:`${Ze}/revisions/${encodeURIComponent(g)}/live-sessions`,children:t.cogita.workspace.infoMode.search}),e.jsx("a",{className:"cta",href:`${Ze}/revisions/${encodeURIComponent(g)}/live-sessions/new`,children:t.cogita.workspace.infoMode.create})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[r==="search"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.infoMode.search}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:Z,onChange:ye=>P(ye.target.value),placeholder:t.cogita.workspace.revisionForm.namePlaceholder})}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.live.statusLabel}),e.jsxs("select",{value:f,onChange:ye=>q(ye.target.value),children:[e.jsx("option",{value:"all",children:t.cogita.library.infoTypes.any}),He.map(ye=>e.jsx("option",{value:ye,children:ye},`status:${ye}`))]})]})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:`${Ee.length} / ${E.length}`}),e.jsx("span",{children:$==="loading"?t.cogita.library.collections.loading:$==="error"?t.cogita.library.revision.shareError:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:Ee.length?Ee.map(ye=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${Ze}/revisions/${encodeURIComponent(g)}/live-sessions/${encodeURIComponent(ye.sessionId)}`,onClick:Qe=>{Qe.metaKey||Qe.ctrlKey||Qe.shiftKey||Qe.altKey||Qe.button!==0||(Qe.preventDefault(),y==null||y(ye.sessionId))},children:[e.jsx("div",{className:"cogita-card-type",children:ye.status}),e.jsx("h3",{className:"cogita-card-title",children:ye.title||ye.sessionId}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.revision.live.participantsTitle,": ",ye.participantCount]})]})},ye.sessionId)):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.revision.shareListEmpty})})})]}):null,r==="create"||r==="edit"?e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.revisions.live}),e.jsx("h3",{className:"cogita-detail-title",children:r==="create"?t.cogita.workspace.infoMode.create:t.cogita.workspace.infoActions.edit})]})}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.nameLabel}),e.jsx("input",{value:A,onChange:ye=>J(ye.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.live.sessionModeLabel}),e.jsxs("select",{value:fe,onChange:ye=>De(ye.target.value),children:[e.jsx("option",{value:"simultaneous",children:t.cogita.library.revision.live.modeSimultaneous}),e.jsx("option",{value:"asynchronous",children:t.cogita.library.revision.live.modeAsynchronous})]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.live.hostViewModeLabel}),e.jsxs("select",{value:Ce,onChange:ye=>H(ye.target.value),children:[e.jsx("option",{value:"panel",children:t.cogita.library.revision.live.hostViewPanel}),e.jsx("option",{value:"question",children:t.cogita.library.revision.live.hostViewQuestion}),e.jsx("option",{value:"score",children:t.cogita.library.revision.live.hostViewScore})]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.live.participantViewModeLabel}),e.jsxs("select",{value:Ne,onChange:ye=>Y(ye.target.value),children:[e.jsx("option",{value:"question",children:t.cogita.library.revision.live.participantViewQuestion}),e.jsx("option",{value:"score",children:t.cogita.library.revision.live.participantViewScore}),e.jsx("option",{value:"fullscreen",children:t.cogita.library.revision.live.participantViewFullscreen})]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.live.sessionSettingsLabel}),e.jsx("textarea",{value:me,onChange:ye=>Je(ye.target.value),rows:6})]}),Me?e.jsx("p",{className:"cogita-form-error",children:Me}):null,e.jsx("div",{className:"cogita-form-actions",children:r==="create"?e.jsx("button",{type:"button",className:"cta",onClick:()=>void se(),disabled:O!=="none",children:t.cogita.workspace.infoMode.create}):e.jsx("button",{type:"button",className:"cta",onClick:()=>void Xe(),disabled:O!=="none"||!c,children:t.cogita.workspace.infoActions.edit})})]}):null,r==="detail"?e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.infoActions.overview}),e.jsx("h3",{className:"cogita-detail-title",children:(ce==null?void 0:ce.title)||c||""})]})}),qe==="loading"?e.jsx("p",{children:t.cogita.library.collections.loading}):null,qe==="error"?e.jsx("p",{className:"cogita-form-error",children:t.cogita.library.revision.shareError}):null,qe==="ready"&&G?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-info-tree",children:[e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:t.cogita.library.revision.live.statusLabel}),e.jsx("div",{className:"cogita-info-tree-value",children:(ce==null?void 0:ce.status)??G.status})]}),e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:t.cogita.library.revision.live.participantsTitle}),e.jsx("div",{className:"cogita-info-tree-value",children:G.participants.length})]}),e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:t.cogita.library.revision.live.joinCodeLabel}),e.jsx("div",{className:"cogita-info-tree-value",children:G.code})]})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>k==null?void 0:k(G.sessionId),children:t.cogita.workspace.infoActions.edit}),Ve?e.jsx("a",{className:"ghost",href:Ve,children:"Host"}):null,xt?e.jsx("a",{className:"ghost",href:xt,target:"_blank",rel:"noreferrer",children:"Screen"}):null,pt?e.jsx("a",{className:"ghost",href:pt,target:"_blank",rel:"noreferrer",children:"Login"}):null]})]}):null]}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.workspace.revisions.live}),e.jsx("h3",{className:"cogita-detail-title",children:r==="search"?t.cogita.workspace.infoMode.search:r==="create"?t.cogita.workspace.infoMode.create:r==="edit"?t.cogita.workspace.infoActions.edit:t.cogita.workspace.infoActions.overview})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.live.hostTitle}),e.jsx("p",{children:t.cogita.library.revision.live.participantsTitle})]})]})})]})})})]})})}const rs="cogita.preferences",os="cogita.reviewer.preferences",qi=["library_overview","all_cards","all_collections","all_revisions","storyboards","texts","dependencies","transfer"],ls={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},all_revisions:{requiresCollection:!1,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},Yo=["settings","run","shared","live"],ja=30,hi=42;function ma(t,a){const s=(t??"").trim();return s.length<=a?s:a<=1?s.slice(0,a):`${s.slice(0,Math.max(1,a-1)).trimEnd()}…`}function Xo(t){const a=t.split("/").filter(Boolean);if(a[0]!=="cogita"||a[1]!=="library")return{};const s=a[2];if(!s)return{};if(!a[3])return{libraryId:s,target:"library_overview"};if(a[3]==="infos"){const l=a[4];return l?l==="new"?{libraryId:s,target:"new_card"}:a[5]==="edit"?{libraryId:s,target:"new_card",infoId:l}:a[5]==="checkcards"?{libraryId:s,target:"all_cards",cardMode:"list",infoId:l,infoView:"cards"}:a[5]==="collections"?{libraryId:s,target:"all_cards",cardMode:"list",infoId:l,infoView:"collections"}:{libraryId:s,target:"all_cards",cardMode:"list",infoId:l,infoView:"overview"}:{libraryId:s,target:"all_cards",cardMode:"list"}}if(a[3]==="revisions"){const l=a[4];if(!l)return{libraryId:s,target:"all_revisions"};if(l==="new")return{libraryId:s,target:"all_revisions",revisionView:"new"};if(l==="run")return{libraryId:s,target:"all_revisions",revisionView:"run"};if(a[5]==="run")return{libraryId:s,target:"all_revisions",revisionId:l,revisionView:"run"};if(a[5]==="shared")return{libraryId:s,target:"all_revisions",revisionId:l,revisionView:"shared"};if(a[5]==="live-sessions"){const u=a[6];return u?u==="new"?{libraryId:s,target:"all_revisions",revisionId:l,revisionView:"live",liveSessionView:"new"}:a[7]==="edit"?{libraryId:s,target:"all_revisions",revisionId:l,revisionView:"live",liveSessionId:u,liveSessionView:"edit"}:{libraryId:s,target:"all_revisions",revisionId:l,revisionView:"live",liveSessionId:u,liveSessionView:"detail"}:{libraryId:s,target:"all_revisions",revisionId:l,revisionView:"live",liveSessionView:"list"}}return{libraryId:s,target:"all_revisions",revisionId:l,revisionView:"settings"}}if(a[3]==="dependencies")return{libraryId:s,target:"dependencies"};if(a[3]==="transfer")return{libraryId:s,target:"transfer"};if(a[3]==="storyboards")return a[4]==="new"?{libraryId:s,target:"new_storyboard"}:{libraryId:s,target:"storyboards"};if(a[3]==="texts")return a[4]==="new"?{libraryId:s,target:"new_text"}:{libraryId:s,target:"texts"};if(a[3]!=="collections")return{libraryId:s,target:"library_overview"};const i=a[4];return i?i==="new"?{libraryId:s,target:"new_collection"}:a[5]==="edit"?{libraryId:s,target:"all_collections",collectionId:i,revisionView:"graph"}:a[5]==="infos"?{libraryId:s,target:"all_collections",collectionId:i,revisionView:"detail",collectionView:"infos"}:{libraryId:s,target:"all_collections",collectionId:i,revisionView:"detail",collectionView:"overview"}:{libraryId:s,target:"all_collections"}}function Rt(t,a="library_overview",s,i,l,u,o="list",x,h="overview",w="infos"){const d=(g,r)=>g?r==="run"?`/cogita/library/${t}/revisions/${g}/run`:r==="shared"?`/cogita/library/${t}/revisions/${g}/shared`:r==="live"?o==="new"?`/cogita/library/${t}/revisions/${g}/live-sessions/new`:u?o==="edit"?`/cogita/library/${t}/revisions/${g}/live-sessions/${u}/edit`:`/cogita/library/${t}/revisions/${g}/live-sessions/${u}`:`/cogita/library/${t}/revisions/${g}/live-sessions`:`/cogita/library/${t}/revisions/${g}`:r==="new"||r==="run"?`/cogita/library/${t}/revisions/${r}`:`/cogita/library/${t}/revisions`;return t?a==="library_overview"?`/cogita/library/${t}`:a==="all_cards"?x?h==="cards"?`/cogita/library/${t}/infos/${x}/checkcards`:h==="collections"?`/cogita/library/${t}/infos/${x}/collections`:`/cogita/library/${t}/infos/${x}`:`/cogita/library/${t}/infos`:a==="new_card"?x?`/cogita/library/${t}/infos/${x}/edit`:`/cogita/library/${t}/infos/new`:a==="all_revisions"?d(l,i):a==="all_collections"?i==="settings"||i==="run"||i==="shared"||i==="live"||i==="new"?d(l,i):s?i==="graph"?`/cogita/library/${t}/collections/${s}/edit`:w==="infos"?`/cogita/library/${t}/collections/${s}/infos`:`/cogita/library/${t}/collections/${s}`:`/cogita/library/${t}/collections`:a==="new_collection"?`/cogita/library/${t}/collections/new`:a==="transfer"?`/cogita/library/${t}/transfer`:a==="storyboards"?`/cogita/library/${t}/storyboards`:a==="new_storyboard"?`/cogita/library/${t}/storyboards/new`:a==="texts"?`/cogita/library/${t}/texts`:a==="new_text"?`/cogita/library/${t}/texts/new`:a==="dependencies"?`/cogita/library/${t}/dependencies`:`/cogita/library/${t}`:"/cogita"}function ka(t){return t.length>1&&t.endsWith("/")?t.slice(0,-1):t}function Zo(t){return typeof t=="string"&&qi.includes(t)}function el(t,a){var x;if(!t.length)return null;const s=t.filter(h=>a.has(h.roleId)),i=s.length>0?s:t,l=i.map(h=>{var d,g;const w=((g=(d=h.fields.find(r=>r.fieldType==="role_kind"))==null?void 0:d.plainValue)==null?void 0:g.toLowerCase())??"";return{roleId:h.roleId,roleKind:w}}),u=l.find(h=>h.roleKind.includes("master"));if(u)return u.roleId;const o=l.find(h=>h.roleKind.includes("account")||h.roleKind.includes("user"));return o?o.roleId:((x=i[0])==null?void 0:x.roleId)??null}function tl(t){if(!t)return{version:1,byLibrary:{}};try{const a=JSON.parse(t);return!a||typeof a!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:a.lastLibraryId,byLibrary:a.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function al({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w}){const d=rn(),g=Ja(),r=n.useMemo(()=>Xo(g.pathname),[g.pathname]),c=t.cogita.workspace,[j,y]=n.useState([]),[k,C]=n.useState([]),[v,b]=n.useState([]),[Z,P]=n.useState([]),[f,q]=n.useState(void 0),[E,ie]=n.useState("library_overview"),[$,B]=n.useState(void 0),[A,J]=n.useState(void 0),[fe,De]=n.useState("detail"),[Ce,H]=n.useState(void 0),[Ne,Y]=n.useState(!1),[me,Je]=n.useState(!0),[qe,K]=n.useState(null),[G,je]=n.useState(0),[O,Se]=n.useState(""),[Me,Fe]=n.useState([]),[Ze,D]=n.useState(""),[ce,He]=n.useState(0),[Ee,se]=n.useState([]),[Xe,pt]=n.useState([]),[xt,Ve]=n.useState(null),[ye,Qe]=n.useState(null),Ue=n.useRef({version:1,byLibrary:{}}),ke=n.useRef({}),we=n.useRef({}),Le=n.useRef({}),R=n.useRef({}),_=n.useRef(!1),z=n.useRef(!1),W=n.useRef(null),ee=n.useMemo(()=>j.find(p=>p.libraryId===f)??null,[j,f]),ue=n.useMemo(()=>k.find(p=>p.collectionId===$)??null,[k,$]),I=ka(g.pathname)==="/cogita/persons";n.useEffect(()=>{if(!f){Fe([]),D("");return}let p=!1;return Ni({libraryId:f}).then(be=>{if(p)return;const L=be.filter(dt=>(dt.roleKind??"").trim().toLowerCase()==="person");Fe(L);try{const dt=window.localStorage.getItem(os),gt=(dt?JSON.parse(dt):{})[f]??"",wt=gt&&L.some(St=>St.roleId===gt)?gt:"";D(wt)}catch{D("")}}).catch(()=>{p||(Fe([]),D(""))}),()=>{p=!0}},[f,ce]),n.useEffect(()=>{if(!f){se([]);return}let p=!1;return Ti({libraryId:f}).then(be=>{p||se(be)}).catch(()=>{p||se([])}),()=>{p=!0}},[f,ce]),n.useEffect(()=>{if(f)try{const p=window.localStorage.getItem(os),be=p?JSON.parse(p):{};Ze?be[f]=Ze:delete be[f],window.localStorage.setItem(os,JSON.stringify(be))}catch{}},[f,Ze]);const N=n.useMemo(()=>Z.find(p=>p.revisionId===A)??null,[Z,A]),ae=n.useMemo(()=>Xe.find(p=>p.sessionId===r.liveSessionId)??null,[r.liveSessionId,Xe]),F=n.useMemo(()=>E==="new_card"?"all_cards":E==="new_collection"?"all_collections":E==="new_storyboard"?"storyboards":E==="new_text"?"texts":E,[E]),U=n.useMemo(()=>fe==="new"?"settings":fe,[fe]),re=n.useMemo(()=>E==="new_collection"?"create":E==="all_collections"&&$?"selected":"search",[$,E]),ve=n.useMemo(()=>r.infoId?"selected":E==="new_card"?"create":"search",[r.infoId,E]),X=n.useMemo(()=>fe==="new"?"create":!A&&U==="shared"?"shared":A?"selected":"search",[U,A,fe]),de=n.useMemo(()=>U!=="live"?"search":r.liveSessionView==="new"?"create":r.liveSessionId?"selected":"search",[U,r.liveSessionId,r.liveSessionView]),$e=n.useMemo(()=>v.find(p=>p.infoId===r.infoId)??null,[v,r.infoId]),at=n.useMemo(()=>({library_overview:c.targets.libraryOverview,all_cards:c.targets.allCards,new_card:c.targets.newCard,all_collections:c.targets.allCollections,all_revisions:c.targets.allRevisions,new_collection:c.targets.newCollection,transfer:c.targets.transfer,storyboards:c.targets.storyboards,new_storyboard:c.targets.newStoryboard,texts:c.targets.texts,new_text:c.targets.newText,dependencies:c.targets.dependencies}),[c.targets]),st=n.useMemo(()=>at[F]??F,[F,at]),it=!!f,ut=n.useMemo(()=>{const p=h==="pl"?"Ruch na teraz: utwórz bibliotekę i wpisz pierwszy element wiedzy.":h==="de"?"Nächster Schritt: Erstelle eine Bibliothek und füge den ersten Wissenseintrag hinzu.":"Next action: create one library and add your first knowledge item.";return h==="pl"?[{step:"Krok 1",title:"Czym jest Cogita?",lead:"To centrum budowania i prowadzenia procesu nauki po zalogowaniu.",passages:["W jednym miejscu łączysz treści, ćwiczenia i współpracę zespołu.","Zamiast luźnych notatek dostajesz spójny przepływ: biblioteka → kolekcja → powtórka."],focus:["Jedna przestrzeń robocza","Spójny proces"],action:p},{step:"Krok 2",title:"Zacznij od biblioteki",lead:"Biblioteka jest bazą dla całego tematu.",passages:["Nazwij bibliotekę jasno: np. „Historia Kościoła – semestr 1”.","Każdy kolejny moduł korzysta z tej samej biblioteki jako źródła."],focus:["Nazwa tematyczna","Jeden punkt startowy"],action:p},{step:"Krok 3",title:"Dodawaj informacje",lead:"Twórz krótkie, konkretne jednostki wiedzy.",passages:["Wpisy typu info opisują pojęcia, osoby, źródła i cytaty.","Małe jednostki łatwiej łączyć, powtarzać i aktualizować."],focus:["Krótko i konkretnie","Łatwe aktualizacje"],action:p},{step:"Krok 4",title:"Pracuj na typach",lead:"Formularze dostosowują się do rodzaju informacji.",passages:["Każdy typ pokazuje właściwe pola i porządkuje dane.","To zmniejsza chaos i poprawia jakość wyszukiwania."],focus:["Lepsza struktura","Mniej błędów"],action:p},{step:"Krok 5",title:"Łącz wiedzę linkami",lead:"Buduj kontekst przez relacje między wpisami.",passages:["Połącz temat z definicją, źródłem i przykładem.","Graf relacji pomaga zobaczyć, czego brakuje przed kolejnym etapem."],focus:["Relacje między wpisami","Pełniejszy kontekst"],action:p},{step:"Krok 6",title:"Twórz kolekcje celu",lead:"Kolekcja grupuje wpisy pod konkretny scenariusz.",passages:["Osobna kolekcja dla lekcji, osobna dla quizu lub egzaminu.","Nie duplikujesz treści — tylko wybierasz, co jest potrzebne."],focus:["Celowe grupowanie","Bez duplikatów"],action:p},{step:"Krok 7",title:"Dodawaj powtórki",lead:"Powtórka definiuje jak przebiega sprawdzanie.",passages:["Ustaw tempo, kolejność i zakres materiału.","Dla jednej kolekcji możesz mieć kilka powtórek o różnych poziomach."],focus:["Kontrola tempa","Różne poziomy"],action:p},{step:"Krok 8",title:"Info vs karta",lead:"Rozróżniaj źródło wiedzy i widok ćwiczeniowy.",passages:["Info to rekord bazowy, który przechowuje treść.","Karta to forma pytania/utrwalenia generowana z info."],focus:["Źródło danych","Widok ćwiczeń"],action:p},{step:"Krok 9",title:"Uruchamiaj sesję",lead:"Tryb Run prowadzi uczestników krok po kroku.",passages:["Prowadzący kontroluje rytm i przejścia między etapami.","Uczestnicy mają jasny przebieg bez zgadywania, co dalej."],focus:["Płynny przebieg","Lepsza dynamika grupy"],action:p},{step:"Krok 10",title:"Czytaj graf zależności",lead:"Graf pokazuje priorytety nauki.",passages:["Węzły centralne oznaczają tematy, które wpływają na wiele innych.","Najpierw utrwal fundamenty, potem przechodź do warstw zaawansowanych."],focus:["Priorytety materiału","Lepsza kolejność"],action:p},{step:"Krok 11",title:"Storyboard i teksty",lead:"Plan i notatki trzymaj blisko wiedzy źródłowej.",passages:["Storyboard układa narrację i przebieg spotkania.","Teksty zbierają komentarze, wnioski i gotowe treści do publikacji."],focus:["Lepsze przygotowanie","Notatki w kontekście"],action:p},{step:"Krok 12",title:"Udostępniaj bezpiecznie",lead:"Dziel się materiałem bez utraty kontroli.",passages:["Możesz dać dostęp tylko do odczytu dla wybranych osób.","Edycja pozostaje po stronie autora lub zespołu prowadzącego."],focus:["Kontrola uprawnień","Bezpieczne współdzielenie"],action:p},{step:"Krok 13",title:"Nawiguj warstwowo",lead:"Sidebar i breadcrumb prowadzą przez poziomy.",passages:["Zawsze widzisz, czy pracujesz na bibliotece, kolekcji czy powtórce.","Mniej kliknięć „w ciemno”, więcej świadomej nawigacji."],focus:["Orientacja w systemie","Szybsze decyzje"],action:p},{step:"Krok 14",title:"Plan wdrożenia 30 minut",lead:"Najpierw prosty pilot, potem rozwijaj.",passages:["Plan: 1 biblioteka, 10 wpisów info, 1 kolekcja, 1 powtórka testowa.","Po pierwszej sesji popraw strukturę i dodaj kolejne scenariusze."],focus:["Szybki start","Iteracyjne doskonalenie"],action:"Gotowe? Załóż bibliotekę po prawej i przejdź do pierwszego wpisu."}]:h==="de"?[{step:"Schritt 1",title:"Was ist Cogita?",lead:"Ein zentraler Workspace für Lernen und Moderation nach dem Login.",passages:["Du verbindest Inhalte, Übungen und Teamarbeit in einem Ablauf.","Der Prozess bleibt klar: Bibliothek → Sammlung → Wiederholung."],focus:["Ein Workspace","Klarer Ablauf"],action:p},{step:"Schritt 2",title:"Mit Bibliothek starten",lead:"Die Bibliothek ist der Startpunkt für dein Thema.",passages:["Vergib einen klaren Namen für Kurs oder Modul.","Alle weiteren Bereiche greifen auf diese Basis zu."],focus:["Sauberer Start","Gemeinsame Basis"],action:p},{step:"Schritt 3",title:"Infos anlegen",lead:"Erfasse Wissen in kleinen, klaren Einträgen.",passages:["Info-Einträge enthalten Begriffe, Personen, Quellen und Zitate.","Kleinere Einheiten lassen sich besser verknüpfen und trainieren."],focus:["Kleine Einheiten","Leicht wartbar"],action:p},{step:"Schritt 4",title:"Typbasierte Eingabe",lead:"Formulare passen sich automatisch dem Info-Typ an.",passages:["Dadurch bleiben Daten strukturiert und konsistent.","Das verbessert Qualität und Auffindbarkeit."],focus:["Konsistenz","Bessere Suche"],action:p},{step:"Schritt 5",title:"Wissen verlinken",lead:"Verbinde Einträge zu einem Kontextnetz.",passages:["Thema, Quelle und Beispiel werden als Beziehung sichtbar.","So erkennst du Lücken vor der nächsten Lernphase."],focus:["Kontextnetz","Lücken erkennen"],action:p},{step:"Schritt 6",title:"Ziel-Sammlungen bauen",lead:"Eine Sammlung bündelt Inhalte für einen konkreten Zweck.",passages:["Nutze getrennte Sammlungen für Unterricht, Quiz oder Prüfung.","Du wählst Inhalte aus statt sie zu kopieren."],focus:["Zielorientierung","Keine Duplikate"],action:p},{step:"Schritt 7",title:"Wiederholungen erstellen",lead:"Wiederholungen definieren den Prüfungsablauf.",passages:["Tempo, Reihenfolge und Umfang sind pro Wiederholung steuerbar.","Mehrere Wiederholungen pro Sammlung sind möglich."],focus:["Ablaufsteuerung","Mehrere Niveaus"],action:p},{step:"Schritt 8",title:"Info und Karte",lead:"Datenobjekt und Trainingsansicht sind getrennt.",passages:["Info ist die Quelle der Inhalte.","Die Karte ist die Übungsansicht für Frage und Antwort."],focus:["Sauberes Modell","Wiederverwendbar"],action:p},{step:"Schritt 9",title:"Sitzung durchführen",lead:"Im Run-Modus führst du die Gruppe Schritt für Schritt.",passages:["Moderation steuert Übergänge und Timing.","Teilnehmende folgen einem klaren Ablauf."],focus:["Klare Moderation","Stabile Dynamik"],action:p},{step:"Schritt 10",title:"Abhängigkeitsgraph lesen",lead:"Der Graph zeigt Lernprioritäten.",passages:["Zentrale Knoten beeinflussen viele weitere Themen.","Starte mit Grundlagen und baue danach auf."],focus:["Priorisierung","Lernreihenfolge"],action:p},{step:"Schritt 11",title:"Storyboard & Texte",lead:"Plane Ablauf und sammle Notizen im selben Kontext.",passages:["Storyboards strukturieren Sequenzen und Rollen.","Texte halten Erkenntnisse und veröffentlichungsreife Inhalte fest."],focus:["Planung","Dokumentation"],action:p},{step:"Schritt 12",title:"Sicher teilen",lead:"Teile Inhalte ohne Kontrollverlust.",passages:["Leserechte sind separat von Bearbeitungsrechten steuerbar.","So bleibt der Kernbestand geschützt."],focus:["Rechtekontrolle","Sicheres Teilen"],action:p},{step:"Schritt 13",title:"Ebenen-Navigation",lead:"Sidebar und Breadcrumb zeigen deinen aktuellen Kontext.",passages:["Du siehst sofort, auf welcher Ebene du arbeitest.","Das spart Zeit und reduziert Fehlklicks."],focus:["Orientierung","Effizienz"],action:p},{step:"Schritt 14",title:"30-Minuten-Startplan",lead:"Starte klein und erweitere iterativ.",passages:["Plan: 1 Bibliothek, 10 Infos, 1 Sammlung, 1 Test-Wiederholung.","Nach der ersten Runde verbesserst du Struktur und Ablauf."],focus:["Schneller Einstieg","Iteratives Vorgehen"],action:"Jetzt starten: Bibliothek rechts anlegen und den ersten Eintrag erfassen."}]:[{step:"Step 1",title:"What is Cogita?",lead:"A post-login workspace to design, run, and improve knowledge journeys.",passages:["You can keep content, training flow, and collaboration in one place.","The path stays explicit: library → collection → revision → session."],focus:["Single workspace","Clear learning flow"],action:p},{step:"Step 2",title:"Start with a library",lead:"Your library is the root container for one domain or program.",passages:["Name it after your course, cohort, or topic scope.","Every next module reuses this foundation."],focus:["Root container","Consistent base"],action:p},{step:"Step 3",title:"Add information units",lead:"Build knowledge from small, reusable info entries.",passages:["Capture terms, references, people, concepts, and citations.","Smaller entries are easier to link, review, and update."],focus:["Reusable units","Easy maintenance"],action:p},{step:"Step 4",title:"Use type-based forms",lead:"Each info type has a matching data structure and fields.",passages:["Form layouts adapt automatically to the selected type.","This improves consistency and lowers input mistakes."],focus:["Structured input","Fewer errors"],action:p},{step:"Step 5",title:"Link the knowledge graph",lead:"Relationships turn isolated facts into usable context.",passages:["Connect topics, sources, and supporting examples.","Dependency links show what must be learned first."],focus:["Context building","Better sequencing"],action:p},{step:"Step 6",title:"Build goal collections",lead:"Collections package selected infos for a concrete objective.",passages:["Create separate collections for class, quiz, exam, or workshop.","You curate from existing entries instead of duplicating content."],focus:["Goal-oriented sets","No duplication"],action:p},{step:"Step 7",title:"Create revisions",lead:"Revisions define how practice and checking should run.",passages:["Set pacing, order, and scope for each session style.","One collection can host multiple revision strategies."],focus:["Practice design","Multiple modes"],action:p},{step:"Step 8",title:"Understand info vs card",lead:"Data objects and practice views are intentionally separate.",passages:["Info is the canonical source object.","Card is the generated training/checking view."],focus:["Clear model","Reusable content"],action:p},{step:"Step 9",title:"Run live sessions",lead:"Run mode helps facilitators guide each step with control.",passages:["Move through prompts, responses, and timing intentionally.","Participants get a predictable and focused session rhythm."],focus:["Facilitator control","Group clarity"],action:p},{step:"Step 10",title:"Read dependency graphs",lead:"Graph views expose prerequisites and high-impact nodes.",passages:["Central nodes usually deserve priority in onboarding.","Use this to plan revision order and reduce confusion."],focus:["Priority mapping","Smarter progression"],action:p},{step:"Step 11",title:"Use storyboards and texts",lead:"Plan narratives and keep notes near source knowledge.",passages:["Storyboards model session structure and transitions.","Texts capture outcomes, drafts, and reusable explanations."],focus:["Planning layer","Contextual notes"],action:p},{step:"Step 12",title:"Share safely",lead:"Share read access without losing editorial control.",passages:["Keep editing rights restricted to owners or maintainers.","Collaborators can consume material while core data stays protected."],focus:["Access control","Safe collaboration"],action:p},{step:"Step 13",title:"Navigate by layers",lead:"Sidebar and breadcrumb make system depth understandable.",passages:["You always know whether you are at library, collection, or revision level.","Clear location awareness reduces wrong actions."],focus:["Fast orientation","Lower friction"],action:p},{step:"Step 14",title:"30-minute launch plan",lead:"Start with a minimum viable setup, then iterate.",passages:["Plan: create 1 library, add 10 infos, build 1 collection, run 1 revision.","After the first run, refine structure and scale by scenario."],focus:["Immediate execution","Iterative improvement"],action:"Ready now? Create your first library on the right and start adding knowledge."}]},[h]),yt=ut.length,ht=Math.max(0,Math.min(G,yt-1)),Ge=ut[ht],We=!!$,vt=it&&F==="all_collections",Oe=vt&&E==="all_collections"&&We,ct=it&&(F==="all_revisions"||F==="all_collections"&&We&&(fe==="new"||!!A||U==="settings"||U==="run"||U==="shared"||U==="live")),$t=ct,Mt=ct&&!!A,ft=n.useCallback(p=>{const be=!!p.libraryId;let L=p.target,dt=p.collectionId,et=p.revisionId,gt=p.revisionView,wt=p.liveSessionId,St=p.liveSessionView??r.liveSessionView??"list",Ut=p.infoId,Ae=p.infoView??r.infoView??"overview",Gt=p.collectionView??r.collectionView??"infos";be?ls[L].requiresCollection&&!dt?(L=L==="all_revisions"?"all_revisions":"all_collections",et=void 0,gt="detail",wt=void 0,St="list"):L!=="all_collections"&&L!=="all_revisions"?(dt=void 0,et=void 0,wt=void 0,St="list",L!=="new_card"&&L!=="all_cards"&&(Ut=void 0,Ae="overview"),L!=="new_collection"&&(Gt="infos")):ls[L].allowsRevision?Yo.includes(gt)||(et=void 0,wt=void 0,St="list"):gt="detail":(L="library_overview",dt=void 0,et=void 0,gt="detail",wt=void 0,St="list",Ut=void 0,Ae="overview",Gt="infos"),gt!=="live"&&(wt=void 0,St="list"),!et&&gt==="live"&&(gt="settings",wt=void 0,St="list"),q(p.libraryId),ie(L),B(dt),J(et),De(gt),Y(!1);const ta=ka(Rt(p.libraryId,L,dt,gt,et,wt,St,Ut,Ae,Gt));ka(g.pathname)!==ta&&(W.current=ta,d(ta))},[g.pathname,d,r.collectionView,r.infoView,r.liveSessionView]),Kt=n.useMemo(()=>[{key:"library",label:c.layers.library,visible:!0,value:f??"",selectedLabel:(ee==null?void 0:ee.name)??c.path.noLibrarySelected,disabled:me||j.length===0,options:j.map(p=>({value:p.libraryId,label:p.name})),emptyOption:c.noLibraryOption,onSelect:p=>{const be=p||void 0;ft({libraryId:be,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:c.layers.target,visible:it,value:F,selectedLabel:st,disabled:!it,options:qi.map(p=>({value:p,label:at[p]})),onSelect:p=>{const be=p;ft({libraryId:f,target:be,collectionId:$,revisionId:A,revisionView:fe,infoId:be==="new_card"?r.infoId:void 0})}},{key:"info_mode",label:c.layers.target,visible:F==="all_cards",value:ve,selectedLabel:ve==="create"?c.infoMode.create:ve==="selected"?($e==null?void 0:$e.label)??Ce??t.cogita.library.list.selectedEmpty:c.infoMode.search,disabled:!it,options:[{value:"search",label:c.infoMode.search},{value:"create",label:c.infoMode.create},...r.infoId?[{value:"selected",label:($e==null?void 0:$e.label)??Ce??t.cogita.library.list.selectedEmpty}]:[]],onSelect:p=>{if(p==="selected"){if(!r.infoId)return;ft({libraryId:f,target:"all_cards",collectionId:$,revisionId:A,revisionView:fe,infoId:r.infoId,infoView:"overview"});return}if(p==="create"){ft({libraryId:f,target:"new_card",collectionId:$,revisionId:A,revisionView:fe,infoId:void 0});return}ft({libraryId:f,target:"all_cards",collectionId:$,revisionId:A,revisionView:fe,infoId:void 0,infoView:"overview"})}},{key:"info_selected_action",label:c.layers.target,visible:F==="all_cards"&&!!r.infoId,value:E==="new_card"&&r.infoId?"edit":r.infoView==="cards"?"cards":r.infoView==="collections"?"collections":"overview",selectedLabel:E==="new_card"&&r.infoId?c.infoActions.edit:r.infoView==="cards"?c.infoActions.seeCards:r.infoView==="collections"?"Kolekcje":c.infoActions.overview,disabled:!it||!r.infoId,options:[{value:"overview",label:c.infoActions.overview},{value:"edit",label:c.infoActions.edit},{value:"cards",label:c.infoActions.seeCards},{value:"collections",label:"Kolekcje"}],onSelect:p=>{if(r.infoId){if(p==="edit"){ft({libraryId:f,target:"new_card",collectionId:$,revisionId:A,revisionView:fe,infoId:r.infoId});return}if(p==="cards"){ft({libraryId:f,target:"all_cards",collectionId:$,revisionId:A,revisionView:fe,infoId:r.infoId,infoView:"cards"});return}ft({libraryId:f,target:"all_cards",collectionId:$,revisionId:A,revisionView:fe,infoId:r.infoId,infoView:"overview"})}}},{key:"collection_mode",label:c.layers.collection,visible:vt,value:re,selectedLabel:re==="create"?t.cogita.library.actions.createCollection:re==="selected"?(ue==null?void 0:ue.name)??c.path.noCollectionSelected:c.infoMode.search,disabled:!it,options:[{value:"search",label:c.infoMode.search},{value:"create",label:t.cogita.library.actions.createCollection},...$?[{value:"selected",label:(ue==null?void 0:ue.name)??c.path.noCollectionSelected}]:[]],onSelect:p=>{if(p==="selected"&&$){ft({libraryId:f,target:"all_collections",collectionId:$,revisionId:void 0,revisionView:"detail"});return}if(p==="create"){ft({libraryId:f,target:"new_collection",collectionId:void 0,revisionId:void 0,revisionView:"detail"});return}ft({libraryId:f,target:"all_collections",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_selected_action",label:c.layers.collection,visible:Oe,value:U==="graph"?"edit":U==="settings"||U==="run"||U==="shared"||U==="live"?"revisions":(r.collectionView??"infos")==="overview"?"overview":"infos",selectedLabel:U==="graph"?c.infoActions.edit:U==="settings"||U==="run"||U==="shared"||U==="live"?c.targets.allRevisions:(r.collectionView??"infos")==="overview"?c.infoActions.overview:c.targets.allCards,disabled:!$,options:[{value:"overview",label:c.infoActions.overview},{value:"edit",label:c.infoActions.edit},{value:"infos",label:c.targets.allCards},{value:"revisions",label:c.targets.allRevisions}],onSelect:p=>{if($){if(p==="edit"){ft({libraryId:f,target:"all_collections",collectionId:$,revisionId:void 0,revisionView:"graph"});return}if(p==="revisions"){ft({libraryId:f,target:"all_collections",collectionId:$,revisionId:void 0,revisionView:"settings"});return}ft({libraryId:f,target:"all_collections",collectionId:$,revisionId:void 0,revisionView:"detail",infoId:r.infoId,infoView:r.infoView,collectionView:p==="overview"?"overview":"infos"})}}},{key:"revision_mode",label:c.layers.revision,visible:$t,value:X,selectedLabel:X==="create"?c.revisionForm.createAction:X==="shared"?c.targets.sharedRevisions:X==="selected"?(N==null?void 0:N.name)??c.status.noRevisions:c.infoMode.search,disabled:F==="all_revisions"?!it:!We,options:[{value:"search",label:c.infoMode.search},{value:"create",label:c.revisionForm.createAction},{value:"shared",label:c.targets.sharedRevisions},...A?[{value:"selected",label:(N==null?void 0:N.name)??c.status.noRevisions}]:[]],onSelect:p=>{const be=F==="all_revisions",L=be?"all_revisions":"all_collections",dt=be?void 0:$;if(p==="selected"&&A){ft({libraryId:f,target:L,collectionId:dt,revisionId:A,revisionView:U==="run"||U==="shared"||U==="live"?U:"settings"});return}ft({libraryId:f,target:L,collectionId:dt,revisionId:void 0,revisionView:p==="create"?"new":p==="shared"?"shared":"settings"})}},{key:"revision_selected_action",label:c.layers.revision,visible:Mt,value:U==="run"?"run":U==="shared"?"shared":U==="live"?"live":"settings",selectedLabel:U==="run"?c.revisions.run:U==="shared"?c.targets.sharedRevisions:U==="live"?c.revisions.live:c.infoActions.edit,disabled:!A,options:[{value:"settings",label:c.infoActions.edit},{value:"run",label:c.revisions.run},{value:"shared",label:c.targets.sharedRevisions},{value:"live",label:c.revisions.live}],onSelect:p=>{if(!A)return;const be=F==="all_revisions";ft({libraryId:f,target:be?"all_revisions":"all_collections",collectionId:be?void 0:$,revisionId:A,revisionView:p==="run"?"run":p==="shared"?"shared":p==="live"?"live":"settings"})}},{key:"live_mode",label:c.revisions.live,visible:Mt&&U==="live",value:de,selectedLabel:de==="create"?c.infoMode.create:de==="selected"?(ae==null?void 0:ae.title)??r.liveSessionId??c.status.noRevisions:c.infoMode.search,disabled:!A,options:[{value:"search",label:c.infoMode.search},{value:"create",label:c.infoMode.create},...r.liveSessionId?[{value:"selected",label:(ae==null?void 0:ae.title)??r.liveSessionId}]:[]],onSelect:p=>{if(!A)return;const be=F==="all_revisions";if(p==="create"){ft({libraryId:f,target:be?"all_revisions":"all_collections",collectionId:be?void 0:$,revisionId:A,revisionView:"live",liveSessionId:void 0,liveSessionView:"new"});return}if(p==="selected"&&r.liveSessionId){ft({libraryId:f,target:be?"all_revisions":"all_collections",collectionId:be?void 0:$,revisionId:A,revisionView:"live",liveSessionId:r.liveSessionId,liveSessionView:"detail"});return}ft({libraryId:f,target:be?"all_revisions":"all_collections",collectionId:be?void 0:$,revisionId:A,revisionView:"live",liveSessionId:void 0,liveSessionView:"list"})}},{key:"live_selected_action",label:c.revisions.live,visible:Mt&&U==="live"&&!!r.liveSessionId,value:r.liveSessionView==="edit"?"edit":"overview",selectedLabel:r.liveSessionView==="edit"?c.infoActions.edit:c.infoActions.overview,disabled:!A||!r.liveSessionId,options:[{value:"overview",label:c.infoActions.overview},{value:"edit",label:c.infoActions.edit}],onSelect:p=>{if(!A||!r.liveSessionId)return;const be=F==="all_revisions";ft({libraryId:f,target:be?"all_revisions":"all_collections",collectionId:be?void 0:$,revisionId:A,revisionView:"live",liveSessionId:r.liveSessionId,liveSessionView:p==="edit"?"edit":"detail"})}}],[k,ve,v,j,me,ft,Z,ue,$,$e,N,A,ae,Ce,We,it,ee,f,fe,E,U,F,st,vt,Oe,$t,Mt,at,t.cogita.library.list.selectedEmpty,r.infoId,r.infoView,r.collectionView,r.liveSessionId,r.liveSessionView,c.infoActions.edit,c.infoActions.overview,c.infoActions.seeCards,c.layers.collection,c.layers.library,c.layers.revision,c.layers.target,c.noLibraryOption,c.path.noCollectionSelected,c.path.noLibrarySelected,c.targets.allCards,c.targets.allRevisions,c.infoMode.search,c.revisionForm.createAction,c.revisions.run,c.revisions.live,c.targets.sharedRevisions,re,X,de]),Bt=n.useMemo(()=>Kt.filter(p=>p.visible),[Kt]),kt=n.useMemo(()=>Bt.filter(p=>p.key!=="library"&&p.key!=="collection"),[Bt]),zt=n.useMemo(()=>kt.find(p=>p.key==="target")??null,[kt]),ea=n.useMemo(()=>kt.find(p=>p.key==="info_mode")??null,[kt]),Na=n.useMemo(()=>kt.find(p=>p.key==="info_selected_action")??null,[kt]),Lt=n.useMemo(()=>kt.find(p=>p.key==="collection_mode")??null,[kt]),ca=n.useMemo(()=>kt.find(p=>p.key==="revision_mode")??null,[kt]),It=n.useMemo(()=>kt.find(p=>p.key==="collection_selected_action")??null,[kt]),lt=n.useMemo(()=>kt.find(p=>p.key==="revision_selected_action")??null,[kt]),Vt=n.useMemo(()=>kt.find(p=>p.key==="live_mode")??null,[kt]),qt=n.useMemo(()=>kt.find(p=>p.key==="live_selected_action")??null,[kt]),ot=n.useCallback((p,be)=>p?e.jsx("div",{className:"cogita-sidebar-actions",children:p.options.map(L=>{const dt=ka((()=>{if(p.key==="library")return Rt(L.value||void 0,"library_overview",void 0,"detail");if(p.key==="target"){const et=L.value;return Rt(f,et,$,fe,A,r.liveSessionId,r.liveSessionView??"list",et==="new_card"?r.infoId:void 0,r.infoView??"overview",r.collectionView??"infos")}if(p.key==="info_mode")return L.value==="create"?Rt(f,"new_card",$,fe,A):L.value==="selected"&&r.infoId?Rt(f,"all_cards",$,fe,A,r.liveSessionId,r.liveSessionView??"list",r.infoId,"overview"):Rt(f,"all_cards",$,fe,A);if(p.key==="info_selected_action"&&r.infoId)return L.value==="edit"?Rt(f,"new_card",$,fe,A,r.liveSessionId,r.liveSessionView??"list",r.infoId):Rt(f,"all_cards",$,fe,A,r.liveSessionId,r.liveSessionView??"list",r.infoId,L.value==="cards"?"cards":L.value==="collections"?"collections":"overview");if(p.key==="collection_mode")return L.value==="create"?Rt(f,"new_collection",void 0,"detail"):L.value==="selected"&&$?Rt(f,"all_collections",$,"detail"):Rt(f,"all_collections",void 0,"detail");if(p.key==="collection_selected_action"&&$)return L.value==="edit"?Rt(f,"all_collections",$,"graph"):L.value==="revisions"?Rt(f,"all_collections",$,"settings"):Rt(f,"all_collections",$,"detail",void 0,void 0,"list",r.infoId,r.infoView??"overview",L.value==="overview"?"overview":"infos");if(p.key==="revision_mode"){const et=F==="all_revisions",gt=et?"all_revisions":"all_collections",wt=et?void 0:$;return L.value==="create"?Rt(f,gt,wt,"new"):L.value==="shared"?Rt(f,gt,wt,"shared"):L.value==="selected"&&A?Rt(f,gt,wt,U==="run"||U==="shared"||U==="live"?U:"settings",A):Rt(f,gt,wt,"settings")}if(p.key==="revision_selected_action"&&A){const et=F==="all_revisions";return Rt(f,et?"all_revisions":"all_collections",et?void 0:$,L.value==="run"?"run":L.value==="shared"?"shared":L.value==="live"?"live":"settings",A,r.liveSessionId,r.liveSessionView??"list")}if(p.key==="live_mode"&&A){const et=F==="all_revisions",gt=et?"all_revisions":"all_collections",wt=et?void 0:$;return L.value==="create"?Rt(f,gt,wt,"live",A,void 0,"new"):L.value==="selected"&&r.liveSessionId?Rt(f,gt,wt,"live",A,r.liveSessionId,"detail"):Rt(f,gt,wt,"live",A)}if(p.key==="live_selected_action"&&A&&r.liveSessionId){const et=F==="all_revisions";return Rt(f,et?"all_revisions":"all_collections",et?void 0:$,"live",A,r.liveSessionId,L.value==="edit"?"edit":"detail")}return ka(g.pathname)})());return e.jsx("a",{href:`/#${dt}`,className:`ghost ${String(p.value)===L.value?"active":""}`,onClick:et=>{if(p.disabled){et.preventDefault();return}et.metaKey||et.ctrlKey||et.shiftKey||et.altKey||et.button!==0||(et.preventDefault(),p.onSelect(L.value))},"aria-disabled":p.disabled,title:L.label,children:ma(L.label,ja)},`${be}:${p.key}:${L.value}`)})}):null,[U,F,g.pathname,r.collectionView,r.infoId,r.infoView,r.liveSessionId,r.liveSessionView,$,f,A,fe]),S=n.useMemo(()=>f?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:c.sidebar.revisionLiveSessionsHint}),Ee.length>0?e.jsx("div",{className:"cogita-sidebar-actions",children:Ee.map(p=>e.jsx("a",{className:`ghost ${A===p.revisionId?"active":""}`,title:p.title||p.sessionId,href:`/#/cogita/library/${encodeURIComponent(f)}/revisions/${encodeURIComponent(p.revisionId)}/live-sessions/${encodeURIComponent(p.sessionId)}`,onClick:be=>{be.metaKey||be.ctrlKey||be.shiftKey||be.altKey||be.button!==0||(be.preventDefault(),d(`/cogita/library/${encodeURIComponent(f)}/revisions/${encodeURIComponent(p.revisionId)}/live-sessions/${encodeURIComponent(p.sessionId)}`),Y(!1))},children:ma(p.title||p.sessionId,ja)},`sidebar:live:${p.sessionId}`))}):e.jsx("p",{className:"cogita-sidebar-note",children:c.sidebar.noRevisionLiveSessions})]}):null,[d,Ee,f,A,c.sidebar.noRevisionLiveSessions,c.sidebar.revisionLiveSessionsHint]),Te=n.useMemo(()=>{const p=r.libraryId;if(!p||!g.pathname.startsWith("/cogita/library/"))return null;const be={copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,libraryId:p};if(r.target==="library_overview")return e.jsx(Vr,{...be});if(r.target==="all_cards")return r.infoId&&r.infoView==="cards"?e.jsx(fo,{...be,infoId:r.infoId,selectedReviewerRoleId:Ze||null}):e.jsx(Yr,{...be,mode:r.cardMode??"list"});if(r.target==="new_card")return e.jsx(ro,{...be,editInfoId:r.infoId});if(r.target==="dependencies")return e.jsx(lo,{...be});if(r.target==="transfer")return e.jsx(xo,{...be});if(r.target==="storyboards"||r.target==="new_storyboard")return e.jsx(wo,{...be});if(r.target==="texts"||r.target==="new_text")return e.jsx(jo,{...be});if(r.target==="all_revisions")return!r.revisionId&&!r.revisionView?e.jsx(di,{...be}):r.revisionView==="run"?e.jsx(Ho,{...be,revisionId:r.revisionId}):r.revisionView==="live"&&r.revisionId?e.jsx(Go,{...be,revisionId:r.revisionId,mode:r.liveSessionView==="new"?"create":r.liveSessionView==="edit"?"edit":r.liveSessionView==="detail"?"detail":"search",sessionId:r.liveSessionId,onCreated:L=>{ft({libraryId:p,target:r.target??"all_revisions",collectionId:$,revisionId:r.revisionId,revisionView:"live",liveSessionId:L,liveSessionView:"detail"})},onOpenSession:L=>{ft({libraryId:p,target:r.target??"all_revisions",collectionId:$,revisionId:r.revisionId,revisionView:"live",liveSessionId:L,liveSessionView:"detail"})},onRequestEdit:L=>{ft({libraryId:p,target:r.target??"all_revisions",collectionId:$,revisionId:r.revisionId,revisionView:"live",liveSessionId:L,liveSessionView:"edit"})},onRequestOverview:L=>{ft({libraryId:p,target:r.target??"all_revisions",collectionId:$,revisionId:r.revisionId,revisionView:"live",liveSessionId:L,liveSessionView:"detail"})}}):!r.revisionId&&(r.revisionView==="settings"||r.revisionView==="live"||r.revisionView==="shared")?e.jsx(di,{...be}):e.jsx(Fo,{...be,revisionId:r.revisionId});if(r.target==="all_collections"){if(r.collectionId){const L={...be,collectionId:r.collectionId};return r.revisionView==="graph"?e.jsx(ci,{...L,collectionId:r.collectionId,onCreated:()=>{}}):e.jsx(No,{...L})}return e.jsx(ko,{...be})}return r.target==="new_collection"?e.jsx(ci,{...be,onCreated:L=>{ft({libraryId:p,target:"all_collections",collectionId:L,revisionId:void 0,revisionView:"graph"})}}):null},[a,ft,t,h,g.pathname,d,w,u,x,i,l,r.cardMode,r.collectionId,r.infoId,r.libraryId,r.liveSessionId,r.liveSessionView,r.revisionId,r.revisionView,r.target,o,s,$,E,Ze]);n.useEffect(()=>{let p=!1;return(async()=>{var L,dt,et;Je(!0);try{await hr();const[gt,wt,St]=await Promise.all([wi(),ki(),mr()]);if(p)return;y(gt);const Ut=new Set(St.nodes.filter(Pt=>Pt.nodeType==="role"&&Pt.canLink).map(Pt=>Pt.roleId??"")),Ae=el(wt,Ut);if(Ve(Ae),Ae){const Pt=St.nodes.find(na=>na.nodeType==="data"&&na.roleId===Ae&&(na.fieldType===rs||na.label===rs));Qe((Pt==null?void 0:Pt.dataKeyId)??null),Ue.current=tl(Pt==null?void 0:Pt.value)}const Gt=(L=gt.find(Pt=>Pt.libraryId===r.libraryId))==null?void 0:L.libraryId,ta=Gt?(et=(dt=Ue.current.byLibrary)==null?void 0:dt[Gt])==null?void 0:et.lastTarget:void 0,Jt=Zo(ta)?ta:"library_overview";q(Gt),ie(r.target??Jt),J(r.revisionId),De(r.revisionView??"detail"),_.current=!0}catch{p||K(c.status.loadFailed)}finally{p||Je(!1)}})(),()=>{p=!0}},[c.status.loadFailed]),n.useLayoutEffect(()=>{if(_.current){if(!r.libraryId){q(void 0),ie(r.target??"library_overview"),B(void 0),J(void 0),De("detail");return}r.libraryId&&j.some(p=>p.libraryId===r.libraryId)&&q(r.libraryId),r.target&&ie(r.target),B(r.collectionId),J(r.revisionId),r.revisionView&&De(r.revisionView)}},[j,r.collectionId,r.libraryId,r.revisionId,r.revisionView,r.target]),n.useEffect(()=>{var L;if(!f){C([]),B(void 0),b([]),P([]),J(void 0);return}const p=ke.current[f];if(p){C(p),Fs(f,p);const dt=(L=p.find(et=>et.collectionId===r.collectionId))==null?void 0:L.collectionId;if(B(dt),!r.collectionId||dt)return}let be=!1;return Oa({libraryId:f,limit:200}).then(dt=>{var wt;if(be)return;const et=dt.items;ke.current[f]=et,Fs(f,et),C(et);const gt=(wt=et.find(St=>St.collectionId===r.collectionId))==null?void 0:wt.collectionId;B(gt)}).catch(()=>{be||(C([]),B(void 0))}),()=>{be=!0}},[r.collectionId,f]),n.useEffect(()=>{if(!f){b([]);return}if(F!=="all_cards"&&E!=="new_card")return;const p=we.current[f];if(p&&(b(p),!r.infoId||p.some(L=>L.infoId===r.infoId)))return;let be=!1;return js({libraryId:f,limit:200}).then(L=>{be||(we.current[f]=L,b(L))}).catch(()=>{be||b([])}),()=>{be=!0}},[F,r.infoId,f,E]),n.useEffect(()=>{var dt;if(!f||E!=="all_revisions"&&!$){P([]),E!=="all_revisions"&&J(void 0);return}const p=`${f}:${E==="all_revisions"?"__library__":$??"__none__"}`,be=Le.current[p];if(be){P(be);const et=(dt=be.find(gt=>gt.revisionId===r.revisionId))==null?void 0:dt.revisionId;if(J(et),!r.revisionId||et)return}let L=!1;return xs({libraryId:f,collectionId:E==="all_revisions"?void 0:$}).then(et=>{var wt;if(L)return;Le.current[p]=et,P(et);const gt=(wt=et.find(St=>St.revisionId===r.revisionId))==null?void 0:wt.revisionId;J(gt)}).catch(()=>{L||(P([]),J(void 0))}),()=>{L=!0}},[r.revisionId,$,f,E]),n.useEffect(()=>{if(!f||!A||U!=="live"){pt([]);return}const p=`${f}:${A}`,be=R.current[p];if(be&&(pt(be),!r.liveSessionId||be.some(dt=>dt.sessionId===r.liveSessionId)))return;let L=!1;return Si({libraryId:f,revisionId:A}).then(dt=>{L||(R.current[p]=dt,pt(dt))}).catch(()=>{L||pt([])}),()=>{L=!0}},[U,r.liveSessionId,f,A]),n.useEffect(()=>{const p=r.infoId;if(!f||!p){H(void 0);return}let be=!1;return la({libraryId:f,infoId:p}).then(L=>{if(be)return;const dt=L.payload??{},et=dt.definition&&typeof dt.definition=="object"?dt.definition:null,gt=typeof(et==null?void 0:et.title)=="string"?et.title:void 0,wt=typeof(et==null?void 0:et.question)=="string"?et.question:void 0,St=typeof dt.label=="string"?dt.label:void 0,Ut=typeof dt.name=="string"?dt.name:void 0,Ae=typeof dt.title=="string"?dt.title:void 0;H(gt??wt??St??Ut??Ae??L.infoId)}).catch(()=>{be||H(p)}),()=>{be=!0}},[r.infoId,f]),n.useEffect(()=>{if(!_.current||r.libraryId&&j.some(dt=>dt.libraryId===r.libraryId)&&r.libraryId!==f||r.target&&r.target!==E||r.revisionView&&r.revisionView!==fe||r.revisionId&&r.revisionId!==A||ls[E].requiresCollection&&!$&&(r.target==="all_collections"||r.target==="all_revisions")&&r.collectionId)return;const p=ka(g.pathname);if(ka(g.pathname)==="/cogita"&&!r.libraryId&&!f){W.current=null;return}if(ka(g.pathname)==="/cogita/persons"){W.current=null;return}const L=ka(Rt(f,E,$,fe,A,r.liveSessionId,r.liveSessionView??"list",r.infoId,r.infoView??"overview",r.collectionView??"infos"));if(p===L){W.current=null;return}W.current!==L&&(W.current=L,d(L,{replace:!0}))},[j,g.pathname,d,r.collectionId,r.infoId,r.infoView,r.collectionView,r.liveSessionId,r.liveSessionView,r.libraryId,r.revisionId,r.revisionView,r.target,$,f,A,fe,E]),n.useEffect(()=>{if(typeof window>"u")return;const p=()=>{window.innerWidth>920&&Y(!1)};return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]),n.useEffect(()=>{if(!_.current||!xt||!f||z.current)return;const p=Ue.current,be={...p.byLibrary??{}},L={...be[f]??{},lastCollectionId:$,lastRevisionId:A,lastRevisionView:fe,lastTarget:E},dt={version:1,lastLibraryId:f,byLibrary:{...be,[f]:L}},et=JSON.stringify(p),gt=JSON.stringify(dt);if(et===gt)return;Ue.current=dt,z.current=!0,(async()=>{try{if(ye)await gr(ye,{plainValue:gt});else{const St=await pr(xt,{itemName:rs,itemType:"data",plainValue:gt});Qe(St.dataItemId)}}catch{K(c.status.savePrefsFailed)}finally{z.current=!1}})()},[ye,xt,$,f,A,fe,E,c.status.savePrefsFailed]);const nt=async()=>{const p=O.trim();if(!p){K(t.cogita.user.libraryNameRequired);return}K(null);try{const be=await fr({name:p});y(L=>[be,...L]),q(be.libraryId),ie("library_overview"),B(void 0),Se("")}catch{K(t.cogita.user.libraryCreateFailed)}};return e.jsx(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,headerExtra:e.jsxs("div",{className:"cogita-header-reviewer-actions",children:[e.jsxs("label",{className:"cogita-header-reviewer",children:[e.jsx("span",{children:"Person"}),e.jsxs("select",{value:Ze,disabled:!f,onChange:p=>{const be=p.target.value;if(be==="__new_person__"){d("/cogita/persons");return}D(be)},children:[e.jsx("option",{value:"",children:f?"No person":"Select library first"}),Me.map(p=>e.jsx("option",{value:p.roleId,children:p.label},p.roleId)),e.jsx("option",{value:"__new_person__",children:"+ Create new person"})]})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>d("/cogita/persons"),children:"Persons"})]}),children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${Ne?"open":""}`,"aria-label":c.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{title:(ee==null?void 0:ee.name)??c.path.noLibrarySelected,children:ma((ee==null?void 0:ee.name)??c.path.noLibrarySelected,ja)}),e.jsx("p",{className:"cogita-sidebar-note",children:ee?c.sidebar.libraryActionsHint:c.status.selectLibraryFirst}),ot(zt,"sidebar"),E==="all_revisions"&&ca?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:c.targets.allRevisions}),ot(ca,"sidebar"),lt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:(N==null?void 0:N.name)??c.status.noRevisions,children:ma((N==null?void 0:N.name)??c.status.noRevisions,ja)}),ot(lt,"sidebar"),Vt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:c.revisions.live}),ot(Vt,"sidebar"),qt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:(ae==null?void 0:ae.title)??r.liveSessionId??"",children:ma((ae==null?void 0:ae.title)??r.liveSessionId??"",ja)}),ot(qt,"sidebar")]}):null]}):null]}):null,S]}):null,ea?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:c.sidebar.infoActionsHint}),ot(ea,"sidebar"),Na?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:($e==null?void 0:$e.label)??Ce??t.cogita.library.list.selectedEmpty,children:ma(($e==null?void 0:$e.label)??Ce??t.cogita.library.list.selectedEmpty,ja)}),e.jsx("p",{className:"cogita-sidebar-note",children:c.sidebar.selectedInfoActionsHint}),ot(Na,"sidebar")]}):null]}):null,Lt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:c.sidebar.collectionActionsHint}),ot(Lt,"sidebar"),ue&&It?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:ue.name,children:ma(ue.name,ja)}),ot(It,"sidebar"),E!=="all_revisions"&&ca?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:c.targets.allRevisions}),ot(ca,"sidebar"),lt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:(N==null?void 0:N.name)??c.status.noRevisions,children:ma((N==null?void 0:N.name)??c.status.noRevisions,ja)}),ot(lt,"sidebar"),Vt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:c.revisions.live}),ot(Vt,"sidebar"),qt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:(ae==null?void 0:ae.title)??r.liveSessionId??"",children:ma((ae==null?void 0:ae.title)??r.liveSessionId??"",ja)}),ot(qt,"sidebar")]}):null]}):null]}):null,S]}):null]}):null]}):null]}),e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:c.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("a",{href:"/#/account",className:"ghost",onClick:p=>{p.metaKey||p.ctrlKey||p.shiftKey||p.altKey||p.button!==0||(p.preventDefault(),i())},children:c.sidebar.accountSettings}),e.jsx("a",{href:"/#/cogita",className:"ghost",onClick:p=>{p.metaKey||p.ctrlKey||p.shiftKey||p.altKey||p.button!==0||(p.preventDefault(),x("cogita"),Y(!1))},children:c.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:l,children:o?t.account.secureModeDisable:t.account.secureModeEnable})]})]})]}),Ne?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":c.sidebar.closeMenu,onClick:()=>Y(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":c.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>Y(p=>!p),"aria-label":Ne?c.sidebar.closeMenu:c.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),Bt.map((p,be)=>e.jsxs("div",{className:"cogita-browser-segment",children:[be>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,p.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":p.label,title:p.selectedLabel,children:ma(p.selectedLabel,hi)}):e.jsxs("select",{"aria-label":p.label,value:p.value,onChange:L=>p.onSelect(L.target.value),disabled:p.disabled,children:[p.emptyOption?e.jsx("option",{value:"",children:p.emptyOption}):null,p.options.map(L=>e.jsx("option",{value:L.value,title:L.label,children:ma(L.label,hi)},`${p.key}:${L.value}`))]})]},`menu:${p.key}`))]}),Te?e.jsx(e.Fragment,{children:e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Ci.Provider,{value:!0,children:Te})})}):null,Te?null:e.jsxs(e.Fragment,{children:[I?e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(vo,{copy:t,onPersonCreated:p=>{He(be=>be+1)}})}):null,!f&&!I?e.jsxs("section",{className:"cogita-browser-intro",children:[e.jsx("div",{className:"cogita-browser-intro-main",children:e.jsxs("article",{className:"cogita-browser-panel cogita-browser-tutorial",children:[e.jsxs("div",{className:"cogita-browser-tutorial-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-browser-tutorial-step",children:Ge.step}),e.jsx("h2",{children:Ge.title})]}),e.jsxs("p",{children:[ht+1," / ",yt]})]}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-lead",children:Ge.lead}),e.jsx("div",{className:"cogita-browser-tutorial-passages",children:Ge.passages.map(p=>e.jsx("p",{children:p},p))}),e.jsx("div",{className:"cogita-browser-tutorial-focus",children:Ge.focus.map(p=>e.jsx("span",{children:p},p))}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-action",children:Ge.action}),e.jsx("div",{className:"cogita-browser-tutorial-progress",role:"list","aria-label":"Tutorial progress",children:ut.map((p,be)=>e.jsx("button",{type:"button",className:`ghost ${be===ht?"active":""}`,onClick:()=>je(be),"aria-label":`${be+1}`,children:be+1},`tutorial:${p.title}:${be}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:ht===0,onClick:()=>je(p=>Math.max(0,p-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"cta",disabled:ht===yt-1,onClick:()=>je(p=>Math.min(yt-1,p+1)),children:"Next"})]})]})}),e.jsxs("div",{className:"cogita-browser-intro-side",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.createLibraryTitle}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:O,onChange:p=>Se(p.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:nt,children:t.cogita.user.createLibraryAction}),qe?e.jsx("p",{className:"cogita-form-error",children:qe}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.availableLibraries}),j.length===0?e.jsx("p",{className:"cogita-browser-note",children:t.cogita.user.noLibraries}):null,j.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:j.map(p=>e.jsxs("button",{type:"button",className:"cogita-card-item",onClick:()=>{ft({libraryId:p.libraryId,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.user.libraryRoleLabel}),e.jsx("h3",{className:"cogita-card-title",children:p.name})]},p.libraryId))}):null]})]})]}):null]})]})]})})}const yl=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:al},Symbol.toStringTag,{value:"Module"}));function nl({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,shareId:d}){const[g,r]=n.useState(null),[c,j]=n.useState("loading"),[y,k]=n.useState(t.cogita.library.collections.defaultName),[C,v]=n.useState("Cogita Library"),[b,Z]=n.useState([]),[P,f]=n.useState([]),[q,E]=n.useState("idle"),[ie,$]=n.useState({current:0,total:0}),[B,A]=n.useState(0),[J,fe]=n.useState(""),[De,Ce]=n.useState(null),[H,Ne]=n.useState(null),[Y,me]=n.useState(null),[Je,qe]=n.useState(null),[K,G]=n.useState(null),[je,O]=n.useState(null),[Se,Me]=n.useState(()=>aa()),[Fe,Ze]=n.useState(null),[D,ce]=n.useState([]),[He,Ee]=n.useState({}),[se,Xe]=n.useState({}),[pt,xt]=n.useState(null),[Ve,ye]=n.useState(null),[Qe,Ue]=n.useState(null),[ke,we]=n.useState(null),[Le,R]=n.useState({}),_=n.useRef(0),[z,W]=n.useState(null),ee=n.useRef(null),ue=n.useRef(null),[I,N]=n.useState(null),[ae,F]=n.useState(!1),[U,re]=n.useState(null),[ve,X]=n.useState([]),[de,$e]=n.useState(null),at=n.useRef(null),st=n.useRef(null),[it,ut]=n.useState(null),[yt,ht]=n.useState(0),Ge=n.useRef(null),We=n.useRef({}),[vt,Oe]=n.useState(!1),[ct,$t]=n.useState({}),Mt=n.useRef(null),ft=n.useRef(new Set),Kt=n.useRef({}),[Bt,kt]=n.useState([]),[zt,ea]=n.useState(new Set),[Na,Lt]=n.useState(!1),ca=Ja(),It=n.useMemo(()=>new URLSearchParams(ca.search),[ca.search]),lt=n.useMemo(()=>It.get("key")??"",[It]),Vt=(g==null?void 0:g.mode)??"random",qt=(g==null?void 0:g.check)??"exact",ot=(g==null?void 0:g.limit)??20,S=n.useMemo(()=>sn((g==null?void 0:g.revisionType)??Vt),[g,Vt]),Te=n.useMemo(()=>{const M=g==null?void 0:g.revisionSettings,Q=$i(S,It);return _n(S,M??Q)},[g,It,S]),nt=n.useMemo(()=>t.cogita.library.revision[S.labelKey]??Vt,[t,Vt,S]),p=n.useMemo(()=>qt==="exact"?t.cogita.library.revision.checkValue:qt,[t,qt]),L=c==="ready"?b[B]??null:null,dt=(L==null?void 0:L.checkType)==="translation-match"&&ke,et=n.useRef(new Map),gt=n.useRef(new Map),wt=n.useRef(new Map),St=n.useRef(new Map),Ut=n.useMemo(()=>L?L.cardType==="vocab"?t.cogita.library.revision.vocabLabel:L.infoType?bt(t,L.infoType):t.cogita.library.revision.infoLabel:"",[t,L]),Ae=n.useMemo(()=>{var Q;return S.id!=="levels"?b.length:((Q=ct.pool)==null?void 0:Q.length)??S.getFetchLimit(ot,Te)},[ct,Te,S,b.length,ot]),Gt=S.getProgressTotal?S.getProgressTotal(b,ct,ot,Te):S.id==="levels"?Math.min(ot,Ae):b.length,ta=Gt?Math.min(B+1,Gt):0,Jt=Math.max(1,Number(Te.tries??1)),Pt=Te.compare??"anchors",na=Math.max(0,Math.min(100,Number(Te.minCorrectness??0))),Ot=(Te.considerDependencies??"on")==="on",da=Math.max(0,Math.min(100,Number(Te.dependencyThreshold??85))),La=M=>{const Q=M.slice();for(let he=Q.length-1;he>0;he-=1){const _e=Math.floor(Math.random()*(he+1));[Q[he],Q[_e]]=[Q[_e],Q[he]]}return Q},ln=M=>ya(M,{treatSimilarCharsAsSame:!0})>=na,sa=async()=>{const M=await ba(),Q=new Map,he=new Map;M.forEach(xe=>{const Ke=`${xe.itemType}:${xe.itemId}`,Pe=oa(xe.itemType,xe.itemId,xe.checkType,xe.direction);Q.has(Ke)||Q.set(Ke,[]),Q.get(Ke).push(xe),he.has(Pe)||he.set(Pe,[]),he.get(Pe).push(xe)});const _e=new Map,Be=new Map;return Q.forEach((xe,Ke)=>_e.set(Ke,fa(xe).score)),he.forEach((xe,Ke)=>Be.set(Ke,fa(xe).score)),{itemKnowness:_e,cardKnowness:Be}},Sa=async M=>{const Q=ct,he=M.concat(Q.active??[]).concat(Q.pool??[]).filter((m,T,V)=>V.findIndex(oe=>Ie(oe)===Ie(m))===T);if(!Ot){ea(new Set(he.map(Ie)));return}const{itemKnowness:_e,cardKnowness:Be}=await sa(),xe=m=>{if(m.cardType!=="info"||m.infoType!=="citation"||m.checkType!=="quote-fragment")return!0;const T=Zt(m.direction);if(!(T!=null&&T.fragmentId))return!0;const V=m.description??"";if(!V.trim())return!0;const le=Ma(V).nodes[T.fragmentId];if(!le||!le.leftId&&!le.rightId)return!0;const ne=[le.leftId,le.rightId].filter(ge=>!!ge);if(ne.length===0)return!0;const pe=ne.map(ge=>{const ze=oa("info",m.cardId,"quote-fragment",ge);return Be.get(ze)??0});return pe.reduce((ge,ze)=>ge+ze,0)/pe.length>=da},Ke=(g==null?void 0:g.collectionId)??null,Pe=Ke?Bt.filter(m=>At(m.childItemType)==="collection"&&m.childItemId===Ke&&!At(m.childCheckType)&&!At(m.childDirection)):[],Re=Ke&&he.length>0?he.reduce((m,T)=>m+(Be.get(Ie(T))??0),0)/he.length:0,Ye=new Set;for(const m of he){if(m.cardType!=="info"){Ye.add(Ie(m));continue}if(!xe(m))continue;const T=Bt.filter(le=>Vi(le,m)).concat(Pe);if(T.length===0){Ye.add(Ie(m));continue}let V=0;for(const le of T)if(At(le.parentItemType)==="collection")V+=le.parentItemId===Ke?Re:0;else if(At(le.parentCheckType)||At(le.parentDirection)){const ne=At(le.parentCheckType),pe=At(le.parentDirection),te=oa(le.parentItemType,le.parentItemId,ne,pe);V+=Be.get(te)??0}else{const ne=`${le.parentItemType}:${le.parentItemId}`;V+=_e.get(ne)??0}V/T.length>=da&&Ye.add(Ie(m))}ea(Ye)},cn=M=>{for(let Q=M;Q<b.length;Q+=1){const he=b[Q];if(he&&(!Ot||he.cardType!=="info"||zt.has(Ie(he))))return Q}return-1},Ft=M=>!Ot||M.cardType!=="info"||zt.has(Ie(M)),ua=M=>{if(S.id!=="temporal"&&S.id!=="levels")return null;const Q=ct,he=(Q.active??[]).concat(Q.pool??[]),_e=new Set;for(const Be of he){const xe=Ie(Be);if(!(_e.has(xe)||M.has(xe))&&(_e.add(xe),Ft(Be)))return Be}return null},ia=n.useMemo(()=>{if(S.id!=="levels")return null;const M=ct,Q=M.pool??[],he=M.active??[],_e=M.levelMap??{},Be=Math.max(1,Number(Te.levels??1)),xe=Array.from({length:Be},()=>0),Ke=new Set(he.map(m=>Ie(m)));Q.forEach(m=>{const T=Math.min(Be,Math.max(1,_e[Ie(m)]??1));xe[T-1]+=1});const Pe=Q.length||1,Re=xe.map(m=>m/Pe*100),Ye=L?_e[Ie(L)]??1:null;return{counts:xe,percentages:Re,currentLevel:Ye,levelsCount:Be,activeCount:he.length,poolCount:Q.length,activeSet:Ke}},[ct,Te,S,L]),Aa=n.useMemo(()=>{if(S.id!=="temporal")return null;const M=ct,Q=M.pool??[],he=M.active??[],_e=M.knownessMap??{},Be=new Set(M.unknownSet??[]);let xe=0;Q.forEach(Re=>{(_e[Ie(Re)]??0)>1&&(xe+=1)});const Ke=Be.size,Pe=he.map(Re=>({id:Ie(Re),value:Be.has(Ie(Re))?0:Math.max(0,Math.min(1,_e[Ie(Re)]??0))}));return{knownCount:xe,unknownCount:Ke,dots:Pe}},[ct,S]),dn=n.useMemo(()=>{if(!Ot)return 0;const M=ct;return b.concat(M.active??[]).concat(M.pool??[]).filter((he,_e,Be)=>Be.findIndex(xe=>Ie(xe)===Ie(he))===_e).filter(he=>he.cardType==="info"&&!zt.has(Ie(he))).length},[Ot,ct,b,zt]);n.useEffect(()=>{if(!Ot||q!=="ready")return;const M=ct,he=b.concat(M.active??[]).concat(M.pool??[]).filter((xe,Ke,Pe)=>Pe.findIndex(Re=>Ie(Re)===Ie(xe))===Ke).filter(xe=>xe.cardType!=="info"||zt.has(Ie(xe))).length,_e=at.current;if(at.current=he,_e===null||he<=_e)return;const Be=he-_e;$e(`New card available (+${Be})`),st.current&&window.clearTimeout(st.current),st.current=window.setTimeout(()=>$e(null),2200)},[Ot,q,ct,b,zt]),n.useEffect(()=>()=>{st.current&&window.clearTimeout(st.current)},[]);const Ht=(M,Q)=>{const he=S.applyOutcome({queue:b,meta:ct},L,ot,Te,{correct:M,correctness:Q,createdUtc:new Date().toISOString()});Z(he.queue),$t(he.meta);const _e=he.queue[B+1];_e&&_a(_e,B+1)};n.useEffect(()=>{if(!d){j("error");return}j("loading"),br({shareId:d,key:lt}).then(M=>{r(M),k(M.collectionName),v(M.libraryName),j("ready")}).catch(()=>{j("error")})},[d,lt]),n.useEffect(()=>{d&&yr({shareId:d,key:lt,type:"language"}).then(M=>f(M)).catch(()=>f([]))},[d,lt]),n.useEffect(()=>{!d||c!=="ready"||vr({shareId:d,key:lt}).then(M=>kt(M.items??[])).catch(()=>kt([]))},[d,lt,c]),n.useEffect(()=>{if(!d||c!=="ready")return;let M=!0;return(async()=>{E("loading"),$({current:0,total:S.id==="levels"||S.id==="random-once"?0:S.getFetchLimit(ot,Te)});try{const he=[];let _e=null,Be=null;do{const T=await xr({shareId:d,key:lt,limit:300,cursor:_e});if(he.push(...T.items),(S.id==="levels"||S.id==="temporal"||S.id==="random-once")&&T.total&&(Be=T.total),$(V=>({current:he.length,total:V.total||T.total||S.getFetchLimit(ot,Te)})),_e=T.nextCursor??null,Be!==null&&he.length>=Be||S.id!=="levels"&&S.id!=="temporal"&&S.id!=="random-once"&&he.length>=S.getFetchLimit(ot,Te))break}while(_e);if(!M)return;const xe=tn(he);let Ke;if(S.id==="levels"){const T=Math.max(1,Number(Te.levels??1));Ke={},xe.forEach(V=>{const oe=Ie(V);Ke[oe]=Math.max(1,Math.min(T,1))})}let Pe=null,Re=null,Ye=null;if(S.id==="temporal"){const T=await ba(),V=new Set(xe.map(ne=>Ie(ne))),oe=T.reduce((ne,pe)=>{const te=oa(pe.itemType,pe.itemId,pe.checkType,pe.direction);return V.has(te)&&(ne[te]||(ne[te]=[]),ne[te].push(pe)),ne},{});Pe={},Re=new Set,Ye={};const le=Date.now();xe.forEach(ne=>{const pe=Ie(ne),te=oe[pe]??[];if(te.length===0){Pe[pe]=0,Re.add(pe),Ye[pe]=[];return}const ge=Cs(te);Ye[pe]=ge;const ze=Kn(ge,le);Pe[pe]=ze.knowness})}const m=S.id==="levels"?Ms(xe,ot,Te,Ke):S.id==="temporal"?Is(xe,ot,Te,Pe??{},Re??new Set,Ye??{}):S.prepare(xe,ot,Te);Z(m.queue),$t(m.meta),A(0),E("ready"),$(T=>({current:Math.min(T.current,T.total),total:T.total}))}catch{M&&E("error")}})(),()=>{M=!1}},[d,lt,ot,S,Te,c]),n.useEffect(()=>{Sa(b)},[b,Bt,Ot,da,g==null?void 0:g.collectionId]),n.useEffect(()=>{if(!L||!Ot){Lt(!1);return}if(L.cardType!=="info"||zt.has(Ie(L))){Lt(!1);return}const M=cn(B+1);if(M>=0){Lt(!1),A(M);return}if(S.id==="temporal"||S.id==="levels"){const Q=b.slice(0,B+1),he=b.slice(B+1).filter(Ft),_e=Q.concat(he),Be=new Set(_e.map(Ie)),xe=ua(Be);if(xe){const Pe=Ie(xe);Be.has(Pe)||(_e.push(xe),Be.add(Pe),$t(Re=>{const Ye=Re,m=new Set(Ye.queued??[]);return m.add(Pe),{...Ye,queued:m}}))}const Ke=_e.findIndex((Pe,Re)=>Re!==B&&Ft(Pe));if(Ke>=0){Z(_e),A(Ke),Lt(!1);return}}Lt(!0)},[L,zt,Ot,B,b,ct,S.id]),n.useEffect(()=>{if(fe(""),Ce(null),ut(null),ht(0),ce([]),Ee({}),Xe({}),xt(null),ye(null),Ue(null),qe(null),G(null),O(null),Me(aa()),F(!1),Oe(!1),N(null),we(null),R({}),!L){Ne(null),me(null),qe(null),G(null),O(null),Me(aa());return}L.cardType==="info"&&L.infoType==="computed"&&Ne(t.cogita.library.revision.loadingComputed);let M=!0;return _a(L,B).then(Q=>{!M||!Q||(Ne(Q.prompt),me(Q.expectedAnswer),ce(Q.computedExpected),Ee(Q.computedAnswers),xt(Q.answerTemplate),ye(Q.outputVariables),Ue(Q.variableValues),qe(Q.questionPrompt),G(Q.questionPromptModel),O(Q.questionExpectedModel),Me(Q.questionInitialAnswers))}),()=>{M=!1}},[L,d,t]),n.useEffect(()=>{if(!L||L.cardType!=="info"||L.infoType!=="citation"){Mt.current=null,ft.current=new Set,Ze(null);return}const M=L.description??"",Q=(L.label??"").trim(),he=Q.replace(/\s+/g," ").trim(),_e=M.replace(/\s+/g," ").trim(),Be=he&&he!==_e?Q:t.cogita.library.infoTypes.citation;if(!M){Ze(null),me(null);return}const xe=Ma(M);Mt.current=xe,Ne(Be);let Ke=!0;return ba().then(Pe=>{if(!Ke)return;const Re=new Map;Pe.forEach(oe=>{if(oe.itemType!=="info"||oe.checkType!=="quote-fragment"||!oe.direction)return;const le=Zt(oe.direction);if(!le)return;const ne=`${oe.itemId}:${le.fragmentId}`;Re.has(ne)||Re.set(ne,[]),Re.get(ne).push(oe)});const Ye={},m=new Set;Re.forEach((oe,le)=>{const[ne,pe]=le.split(":",2);if(ne!==L.cardId)return;const te=fa(oe).score;Ye[pe]=te,te>=da&&m.add(pe)}),ft.current=m,Kt.current=Ye;const T=Zt(L.direction);if(T!=null&&T.fragmentId&&xe.nodes[T.fragmentId]){Ta(xe,T.fragmentId,Be);return}const V=Ba(xe,m,Ye,da,Ot,L.direction);Ta(xe,(V==null?void 0:V.id)??null,Be)}).catch(()=>{ft.current=new Set,Kt.current={};const Pe=Zt(L.direction);if(Pe!=null&&Pe.fragmentId&&xe.nodes[Pe.fragmentId]){Ta(xe,Pe.fragmentId,Be);return}const Re=Ba(xe,ft.current,{},da,Ot,L.direction);Ta(xe,(Re==null?void 0:Re.id)??null,Be)}),()=>{Ke=!1}},[L,t,Ot,da]),n.useEffect(()=>{if(!L||L.cardType!=="vocab"||L.checkType!=="translation-match"){we(null),R({});return}const he=(ct.pool??ct.active??b).filter(Pe=>Pe.cardType==="vocab"&&Pe.checkType==="translation-match").filter((Pe,Re,Ye)=>Ye.findIndex(m=>m.cardId===Pe.cardId)===Re);he.some(Pe=>Pe.cardId===L.cardId)||he.unshift(L);const Be=La(he).slice(0,6).map(Pe=>{const Re=Pe.label.split("↔").map(T=>T.trim()).filter(Boolean);if(Re.length<2)return null;const Ye=`${Pe.cardId}:L`,m=`${Pe.cardId}:R`;return{cardId:Pe.cardId,leftId:Ye,rightId:m,leftLabel:Re[0],rightLabel:Re[1]}}).filter(Boolean),xe=Be.map(Pe=>Pe.leftId),Ke=La(Be.map(Pe=>Pe.rightId));we({pairs:Be,leftOrder:xe,rightOrder:Ke,selection:{},activeLeft:null,activeRight:null,locked:{}})},[L,b,ct]),n.useEffect(()=>()=>{ee.current&&window.clearTimeout(ee.current),ue.current&&window.clearTimeout(ue.current)},[]);const Pa=n.useRef(null);n.useEffect(()=>{if(!L)return;const M=Ie(L),Q=typeof document<"u"?document.activeElement:null;if(Pa.current===M&&Q&&(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"))return;let he=0;const _e=()=>{if(L){if(L.cardType==="info"&&L.infoType==="computed"){if(D.length>0){const xe=An(pt,D,Ve),Ke=xe?We.current[xe]:null;if(Ke&&(Ke.focus(),document.activeElement===Ke)){Pa.current=M;return}}if(Ge.current&&(Ge.current.focus(),document.activeElement===Ge.current)){Pa.current=M;return}}else if(L.cardType==="vocab"&&Ge.current&&(Ge.current.focus(),document.activeElement===Ge.current)){Pa.current=M;return}he<6&&(he+=1,window.setTimeout(_e,40))}},Be=window.setTimeout(_e,40);return()=>window.clearTimeout(Be)},[L,D,pt,Ve]),n.useEffect(()=>{if(!vt)return;const M=Q=>{Q.key==="Enter"&&(Q.preventDefault(),Dt())};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[vt]);const Ea=M=>{X(M),re(fa(M))};n.useEffect(()=>{if(!L){re(null),X([]);return}const M=L.cardType==="info"?"info":"connection";if(L.cardType==="info"&&L.infoType==="citation"){ba().then(Q=>{const he=Q.filter(_e=>_e.itemType==="info"&&_e.itemId===L.cardId&&_e.checkType==="quote-fragment"&&Mn(_e.direction,L.direction));Ea(he)}).catch(()=>{re(null),X([])});return}Cn(M,L.cardId,L.checkType,L.direction).then(Q=>Ea(Q)).catch(()=>{re(null),X([])})},[L]);const Ha=(M,Q,he,_e)=>{if(M==="info"&&he==="quote-fragment"){ba().then(Be=>{const xe=Be.filter(Ke=>Ke.itemType==="info"&&Ke.itemId===Q&&Ke.checkType==="quote-fragment"&&Mn(Ke.direction,_e));Ea(xe)}).catch(()=>{re(null),X([])});return}Cn(M,Q,he,_e).then(Be=>Ea(Be)).catch(()=>{re(null),X([])})},un=(M,Q,he)=>{var Ke;const _e=((Ke=he.pairs.find(Pe=>Pe.leftId===M))==null?void 0:Ke.rightId)??null;if(!_e)return he;const Be=_e===Q;R(Pe=>({...Pe,[M]:Be?"correct":"incorrect"})),ee.current&&window.clearTimeout(ee.current),ue.current&&window.clearTimeout(ue.current),_.current+=1;const xe={kind:Be?"correct":"incorrect",tick:_.current};if(W(null),ee.current=window.setTimeout(()=>W(xe),0),ue.current=window.setTimeout(()=>W(null),420),Be){const Pe={...he.locked,[M]:!0};return Object.keys(Pe).length>=he.pairs.length?(Ce("correct"),Oe(!0)):Ce("correct"),{...he,selection:{...he.selection,[M]:Q},activeLeft:null,activeRight:null,locked:Pe}}return Ce("incorrect"),{...he,activeLeft:null,activeRight:null}},Wa=M=>{we(Q=>!Q||Q.locked[M]?Q:Q.activeRight?un(M,Q.activeRight,Q):{...Q,activeLeft:Q.activeLeft===M?null:M})},Vn=M=>{we(Q=>Q&&(Q.activeLeft?un(Q.activeLeft,M,Q):{...Q,activeRight:Q.activeRight===M?null:M}))},ha=M=>{Me(Q=>{if(Je!=null&&Je.multiple){const he=Q.selection.includes(M)?Q.selection.filter(_e=>_e!==M):Array.from(new Set([...Q.selection,M]));return{...Q,selection:he}}return{...Q,selection:Q.selection[0]===M?[]:[M]}})},Ka=(M,Q)=>{Me(he=>{var Re;const _e=Math.max(2,((Re=Je==null?void 0:Je.columns)==null?void 0:Re.length)??2),Be=Array.from({length:_e},(Ye,m)=>he.matchingSelection[m]??null);if(Be[M]=Be[M]===Q?null:Q,Be.some(Ye=>Ye==null))return{...he,matchingSelection:Be};const xe=Be.map(Ye=>Number(Ye)),Ke=xe.join("|"),Pe=he.matchingRows.some(Ye=>Ye.join("|")===Ke);return{...he,matchingRows:Pe?he.matchingRows:[...he.matchingRows,xe],matchingSelection:new Array(_e).fill(null)}})},qn=(M,Q)=>{Me(he=>{const _e=[...he.ordering],Be=M+Q;return Be<0||Be>=_e.length?he:([_e[M],_e[Be]]=[_e[Be],_e[M]],{...he,ordering:_e})})},Dt=()=>{var M;if(L&&L.cardType==="info"&&L.infoType==="citation"&&Mt.current&&Fe&&!((M=Zt(L.direction))!=null&&M.fragmentId)){const Q=Ba(Mt.current,ft.current,Kt.current,da,Ot,L.direction,Fe.fragmentId);if(Q){Ce(null),fe(""),F(!1),Xe({}),Oe(!1),ut(null),ht(0),Ta(Mt.current,Q.id,Fe.title);return}}Ce(null),fe(""),F(!1),Xe({}),Oe(!1),ut(null),ht(0),A(Q=>Math.min(Q+1,b.length))},Wt=M=>{if(!L)return;const Q=M.expected??null,he=M.answer??"";let _e=Q??"",Be=he;if(!Q&&M.expectedMap&&M.answerMap){const T=Object.keys(M.expectedMap).sort((V,oe)=>V.localeCompare(oe));_e=T.map(V=>{var oe;return((oe=M.expectedMap)==null?void 0:oe[V])??""}).join("|"),Be=T.map(V=>{var oe;return((oe=M.answerMap)==null?void 0:oe[V])??""}).join("|")}const xe=_e?za(_e,Be,Pt):new Uint8Array,Ke={revisionType:S.id,evalType:M.evalType,direction:M.direction,prompt:H??"",expected:Q,answer:he,expectedAnswers:M.expectedMap??null,answers:M.answerMap??null,correct:M.correct,maskBase64:xe.length?Ia(xe):null,checkMode:qt,compareMode:Pt,minCorrectness:na},Pe=new TextEncoder().encode(JSON.stringify(Ke)),Re=L.cardType==="info"?"info":"connection",Ye=M.overrideCheckType??L.checkType??null,m=M.overrideDirection??L.direction??null;Tn({itemType:Re,itemId:L.cardId,checkType:Ye,direction:m,revisionType:S.id,evalType:M.evalType,correct:M.correct,maskBase64:xe.length?Ia(xe):null,payloadBase64:Ia(Pe)}).then(()=>{Ha(Re,L.cardId,Ye,m),Sa(b)}).catch(()=>{})},Fa=(M,Q)=>{const he=et.current.get(Q);if(he)return Promise.resolve(he);const _e=gt.current.get(Q);if(_e)return _e;const Be=Ps({shareCode:d,infoId:M,key:lt}).then(xe=>{var T,V;const Ke=xe.payload,Pe=((T=Ke.definition)==null?void 0:T.graph)??null,Re="",Ye=((V=Ke.definition)==null?void 0:V.answerTemplate)??"",m=Pi(Pe,Re,Ye);if(m){const le={sample:Ei(m),answerTemplate:Ye||null};return et.current.set(Q,le),le}return Es({shareId:d,infoId:M,key:lt}).then(oe=>{const le={sample:oe,answerTemplate:null};return et.current.set(Q,le),le})}).catch(()=>Es({shareId:d,infoId:M,key:lt}).then(xe=>{const Ke={sample:xe,answerTemplate:null};return et.current.set(Q,Ke),Ke}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{gt.current.delete(Q)});return gt.current.set(Q,Be),Be},_a=(M,Q)=>{var Pe;const he=`${Ie(M)}:${Q}`,_e=wt.current.get(he);if(_e)return Promise.resolve(_e);const Be=St.current.get(he);if(Be)return Be;const xe=Re=>{const Ye={...Re,questionPrompt:Re.questionPrompt??null,questionPromptModel:Re.questionPromptModel??null,questionExpectedModel:Re.questionExpectedModel??null,questionInitialAnswers:Re.questionInitialAnswers??aa()};return wt.current.set(he,Ye),Ye};let Ke;if(M.cardType==="vocab"){if(M.checkType==="translation-match")return Ke=Promise.resolve(xe({prompt:M.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),Ke;const Re=M.label.split("↔").map(Ye=>Ye.trim()).filter(Boolean);if(Re.length>=2){const m=(M.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",T=m?Re[0]:Re[1],V=m?Re[1]:Re[0];Ke=Promise.resolve(xe({prompt:T,expectedAnswer:V,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else Ke=Promise.resolve(xe({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(M.cardType==="info"&&M.infoType==="word"){const Re=(Pe=M.description)!=null&&Pe.startsWith("Language: ")?M.description.replace("Language: ",""):null;Ke=Promise.resolve(xe({prompt:M.label,expectedAnswer:Re,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(M.cardType==="info"&&M.infoType==="question"){const Re=In(M.payload??null,M.label);Re?Ke=Promise.resolve(xe({prompt:Re.promptText,expectedAnswer:Re.promptModel.kind==="text"&&(typeof Re.expectedModel=="string"||typeof Re.expectedModel=="number")?String(Re.expectedModel):null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null,questionPrompt:Re.promptPayload,questionPromptModel:Re.promptModel,questionExpectedModel:Re.expectedModel,questionInitialAnswers:Re.initialAnswers})):Ke=Ps({shareCode:d,infoId:M.cardId,key:lt}).then(Ye=>{const m=In(Ye.payload??{},M.label);return xe(m?{prompt:m.promptText,expectedAnswer:m.promptModel.kind==="text"&&(typeof m.expectedModel=="string"||typeof m.expectedModel=="number")?String(m.expectedModel):null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null,questionPrompt:m.promptPayload,questionPromptModel:m.promptModel,questionExpectedModel:m.expectedModel,questionInitialAnswers:m.initialAnswers}:{prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})}).catch(()=>xe({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{St.current.delete(he)})}else M.cardType==="info"&&M.infoType==="computed"?Ke=Fa(M.cardId,he).then(Re=>{var oe,le;if(!Re.sample)return xe({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const Ye=Re.sample,m=Ye.expectedAnswers?Object.entries(Ye.expectedAnswers).map(([ne,pe])=>({key:ne,expected:pe})):[],T=m.reduce((ne,pe)=>(ne[pe.key]="",ne),{}),V=Ye.expectedAnswerIsSentence&&((oe=Ye.expectedAnswer)==null?void 0:oe.trim())||null;return xe({prompt:Ye.prompt,expectedAnswer:m.length>0?V:((le=Ye.expectedAnswer)==null?void 0:le.trim())||null,computedExpected:m,computedAnswers:T,computedValues:Ye.values??null,answerTemplate:Re.answerTemplate,outputVariables:Ye.outputVariables??null,variableValues:Ye.variableValues??null})}).catch(()=>xe({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{St.current.delete(he)}):Ke=Promise.resolve(xe({prompt:M.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return St.current.set(he,Ke),Ke},Ta=(M,Q,he)=>{const _e=Object.keys(M.nodes).length,Be=ft.current.size;if(!Q){Ze({title:he,before:M.text,after:"",fragmentId:null,total:_e,completed:Be}),me(null),Oe(!0);return}const xe=M.nodes[Q];if(!xe)return;const Ke=Pn(M.text,xe);Ze({title:he,before:Ke.before,after:Ke.after,fragmentId:xe.id,total:_e,completed:Be}),me(Ke.fragment),Oe(!1)},Dn=()=>{const M=Mt.current;M&&Ze(Q=>Q&&{...Q,total:Object.keys(M.nodes).length,completed:ft.current.size})},Va=()=>{const M=b[B+1];M&&_a(M,B+1)},hn=()=>{if(Va(),L&&L.cardType==="vocab"&&L.checkType==="translation-match"&&ke){if(ke.pairs.length===0){Ce("incorrect"),Oe(!0);return}const xe=ke.pairs.reduce((V,oe)=>(V[oe.rightId]=oe.rightLabel,V),{});let Ke=0;const Pe={};ke.pairs.forEach(V=>{const le=ke.selection[V.leftId]===V.rightId;Pe[V.leftId]=le?"correct":"incorrect",le&&(Ke+=1)});const Re=ke.pairs.length||1,Ye=Ke/Re,m=Ke===ke.pairs.length;R(V=>({...V,...Pe})),m?(Ce("correct"),Oe(!0),ht(0)):(Ce("incorrect"),Oe(!1),ht(V=>{const oe=V+1;return oe>=Jt&&(F(!0),Oe(!0),we(le=>{if(!le)return le;const ne=le.pairs.reduce((pe,te)=>(pe[te.leftId]=te.rightId,pe),{});return{...le,selection:ne}})),oe})),Ht(m,Ye);const T="connection";Promise.all(ke.pairs.map(V=>{const oe=ke.selection[V.leftId]??null,le=oe?xe[oe]:"",ne={left:V.leftLabel,expected:V.rightLabel,answer:le,checkType:"translation-match"},pe=new TextEncoder().encode(JSON.stringify(ne));return Tn({itemType:T,itemId:V.cardId,checkType:"translation-match",direction:null,revisionType:S.id,evalType:"translation-match",correct:oe===V.rightId,maskBase64:null,payloadBase64:Ia(pe)})})).then(()=>{Ha(T,L.cardId,L.checkType,L.direction),Sa(b)}).catch(()=>{});return}if(L&&L.cardType==="info"&&L.infoType==="question"&&K){const xe={text:Se.text,selection:Se.selection,booleanAnswer:Se.booleanAnswer,ordering:Se.ordering,matchingPaths:Se.matchingRows},Ke=Xt({prompt:K,expected:je,answer:xe}),Pe=Ke.mask?ya(Ke.mask):Ke.correct?100:0;ut(Ke.mask),Ke.correct?(Ce("correct"),Xe({}),Oe(!0),ht(0),Ht(!0,Pe/100)):(Ce("incorrect"),Xe({}),Oe(!1),ht(Re=>{const Ye=Re+1;return Ye>=Jt&&(F(!0),Oe(!0)),Ye}),Ht(!1,Pe/100)),Wt({correct:Ke.correct,direction:H?`${H} -> question`:"question",expected:JSON.stringify(je??null),answer:JSON.stringify(xe),evalType:`question:${K.kind}`});return}if(D.length>0){const xe=D.reduce((Pe,Re)=>{const Ye=He[Re.key]??"";return Pe[Re.key]=Qt(Ye)===Qt(Re.expected)?"correct":"incorrect",Pe},{});D.every(({key:Pe,expected:Re})=>{const Ye=He[Pe]??"";return qt==="exact"&&Qt(Ye)===Qt(Re)})?(Ce("correct"),Xe(xe),Oe(!0),ht(0),Ht(!0,1),Wt({correct:!0,direction:H?`${H} -> computed`:"computed",expectedMap:D.reduce((Pe,Re)=>(Pe[Re.key]=Re.expected,Pe),{}),answerMap:He,evalType:"computed"})):(Ce("incorrect"),Xe(xe),Oe(!1),ht(Pe=>{const Re=Pe+1;return Re>=Jt&&wa&&(F(!0),Oe(!0)),Re}),Ht(!1,0),window.setTimeout(()=>{var Re;const Pe=An(pt,D,Ve);Pe&&We.current[Pe]&&((Re=We.current[Pe])==null||Re.focus())},40),Wt({correct:!1,direction:H?`${H} -> computed`:"computed",expectedMap:D.reduce((Pe,Re)=>(Pe[Re.key]=Re.expected,Pe),{}),answerMap:He,evalType:"computed"}));return}if(L&&L.cardType==="info"&&L.infoType==="citation"&&(Fe!=null&&Fe.fragmentId)){if(!Y)return;const xe=Zt(L.direction),Ke=(xe==null?void 0:xe.fragmentId)??Fe.fragmentId,Pe=nn(Y,J,{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}),Re=Pe.mask,Ye=Pe.isCorrect,m=Pe.percent;Ye?(Kt.current[Fe.fragmentId]=Math.max(Kt.current[Fe.fragmentId]??0,m),(Kt.current[Fe.fragmentId]??0)>=da&&ft.current.add(Fe.fragmentId),Dn(),Ce("correct"),Xe({}),Oe(!0),ut(Re),ht(0),m<100&&Jt<=1&&F(!0),Ht(!0,m/100),Wt({correct:!0,direction:`quote:${Fe.fragmentId}`,expected:Y,answer:J,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:Ke})):(Ce("incorrect"),Xe({}),Oe(!1),ut(Re),ht(T=>{const V=T+1;return V>=Jt&&wa&&(F(!0),Oe(!0)),V}),Ht(!1,m/100),window.setTimeout(()=>{var T;return(T=Ge.current)==null?void 0:T.focus()},40),Wt({correct:!1,direction:`quote:${Fe.fragmentId}`,expected:Y,answer:J,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:Ke}));return}if(!Y)return;const M=za(Y,J,Pt),Q=qt==="exact"&&Qt(J)===Qt(Y),he=ln(M),_e=Q||he,Be=ya(M);_e?(Ce("correct"),Xe({}),Oe(!0),ut(M),ht(0),Be<100&&Jt<=1&&F(!0),Ht(!0,Be/100),Wt({correct:!0,direction:H?`${H} -> ${Y}`:null,expected:Y,answer:J,evalType:"text"})):(Ce("incorrect"),Xe({}),Oe(!1),ut(M),ht(xe=>{const Ke=xe+1;return Ke>=Jt&&wa&&(F(!0),Oe(!0)),Ke}),Ht(!1,Be/100),window.setTimeout(()=>{var xe;return(xe=Ge.current)==null?void 0:xe.focus()},40),Wt({correct:!1,direction:H?`${H} -> ${Y}`:null,expected:Y,answer:J,evalType:"text"}))},Bn=M=>{if(Va(),!Y)return;const Q=za(Y,M,Pt),he=Qt(M)===Qt(Y),_e=ln(Q),Be=he||_e,xe=ya(Q);Be?(Ce("correct"),Xe({}),Oe(!0),ut(Q),ht(0),xe<100&&Jt<=1&&F(!0),Ht(!0,xe/100),Wt({correct:!0,direction:"word->language",expected:Y,answer:M,evalType:"language-select"})):(Ce("incorrect"),Xe({}),Oe(!1),ut(Q),ht(Ke=>{const Pe=Ke+1;return Pe>=Jt&&wa&&(F(!0),Oe(!0)),Pe}),Ht(!1,xe/100),Wt({correct:!1,direction:"word->language",expected:Y,answer:M,evalType:"language-select"}))},zn=M=>{var he;if(M.key!=="Enter")return;if(M.preventDefault(),M.stopPropagation(),vt){Dt();return}const Q=D.find(_e=>!(He[_e.key]??"").trim());if(Q){(he=We.current[Q.key])==null||he.focus();return}hn()},qa=()=>{Va(),Ce("correct"),Oe(!0),ht(0),Ht(!0,1),Y&&Wt({correct:!0,direction:"manual",expected:Y,answer:J,evalType:"manual"})},ra=()=>{if(Ht(!1,0),L&&L.cardType==="info"&&L.infoType==="citation"){Ce(null),fe(""),F(!1),Xe({}),Oe(!1),ut(null),ht(0),A(M=>Math.min(M+1,b.length));return}Dt()};n.useEffect(()=>{Va()},[B,b]);const On=t.cogita.library.revision.revealModeAfterIncorrect,wa=D.length>0||!!Y||(L==null?void 0:L.cardType)==="info"&&L.infoType==="question"&&K!==null;return e.jsxs(Et,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:l,onLogout:u,secureMode:o,onNavigate:x,language:h,onLanguageChange:w,children:[(c==="loading"||q==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:c==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ie.total?Math.min(100,Math.max(0,ie.current/ie.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ie.total?`${Math.min(ie.current,ie.total)} / ${ie.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:y}),e.jsx("p",{className:"cogita-library-subtitle",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",nt).replace("{check}",p)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:U?`${U.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[ia?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",ia.currentLevel??"-"," / ",ia.levelsCount]}):null,U?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(U.correct)).replace("{total}",String(U.total))}),U.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(U.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(Ki,{outcomes:ve})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[de?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:de})}):null,e.jsx(Qa,{feedbackToken:z?`${z.kind}-${z.tick}`:dt?"idle":De?`${De}-${B}-${yt}`:"idle",children:c!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:c==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}):L?e.jsx(e.Fragment,{children:Na?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(Ss,{copy:t,currentCard:L,currentTypeLabel:Ut,prompt:H,languages:P,answer:J,onAnswerChange:M=>fe(Q=>Ln(Q,M,I)),computedExpected:D,computedAnswers:He,onComputedAnswerChange:(M,Q)=>Ee(he=>({...he,[M]:Ln(he[M]??"",Q,I)})),answerTemplate:pt,outputVariables:Ve,variableValues:Qe,computedFieldFeedback:se,feedback:De,canAdvance:vt,quoteContext:Fe,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:hn,onSkip:ra,onLanguageSelect:Bn,onMarkReviewed:qa,onAdvance:Dt,showCorrectAnswer:ae,setShowCorrectAnswer:F,onRevealCorrect:()=>Oe(!0),answerMask:it,expectedAnswer:Y,hasExpectedAnswer:wa,handleComputedKeyDown:zn,answerInputRef:Ge,computedInputRefs:We,scriptMode:I,setScriptMode:N,matchPairs:ke==null?void 0:ke.pairs,matchLeftOrder:ke==null?void 0:ke.leftOrder,matchRightOrder:ke==null?void 0:ke.rightOrder,matchSelection:ke==null?void 0:ke.selection,matchActiveLeft:ke==null?void 0:ke.activeLeft,matchActiveRight:ke==null?void 0:ke.activeRight,matchFeedback:Le,onMatchLeftSelect:Wa,onMatchRightSelect:Vn,questionPrompt:Je,questionAnswers:Se,questionRevealExpected:ae?je:void 0,onQuestionTextChange:M=>{fe(M),Me(Q=>({...Q,text:M}))},onQuestionSelectionToggle:ha,onQuestionBooleanChange:M=>Me(Q=>({...Q,booleanAnswer:M})),onQuestionOrderingMove:qn,onQuestionMatchingPick:Ka,onQuestionMatchingRemovePath:M=>Me(Q=>({...Q,matchingRows:Q.matchingRows.filter((he,_e)=>_e!==M)}))})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Gt?`${ta} / ${Gt}`:t.cogita.library.revision.progressUnlimited}),c==="error"&&e.jsx("p",{children:t.cogita.library.revision.shareInvalid}),c==="loading"&&e.jsx("p",{children:t.cogita.library.revision.shareLoading}),c==="ready"&&q==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),c==="ready"&&q==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),c==="ready"&&q==="ready"&&b.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:On}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",Jt]})]})]}),ia?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",ia.activeCount," / ",ia.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:ia.counts.map((M,Q)=>{const he=Q+1,_e=ia.currentLevel===he,Be=ia.percentages[Q]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":_e,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:he}),e.jsx("strong",{children:M})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,Be))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[Be.toFixed(1),"%"]})]},`level-${he}`)})})]}):null,Aa?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:Aa.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:Aa.dots.map(M=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-M.value))}, ${Math.round(200*M.value)}, 80, 0.9)`}},M.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:Aa.knownCount})]})]}):null,Ot?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:dn})]})}):null]})]})]})})})]})]})}const vl=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:nl},Symbol.toStringTag,{value:"Module"})),sl=t=>Array.from(new Set(t.map(a=>Number(a)).filter(Number.isFinite))).sort((a,s)=>a-s);function il(t){const a=[...t];for(let s=a.length-1;s>0;s-=1){const i=Math.floor(Math.random()*(s+1));[a[s],a[i]]=[a[i],a[s]]}return a}function mi(t){const a=t.map((l,u)=>({value:l,oldIndex:u}));for(let l=a.length-1;l>0;l-=1){const u=Math.floor(Math.random()*(l+1));[a[l],a[u]]=[a[u],a[l]]}const s=a.map(l=>l.value),i=new Map;return a.forEach((l,u)=>i.set(l.oldIndex,u)),{values:s,oldToNew:i}}function rl(t){const a=t.split("↔").map(s=>s.trim()).filter(Boolean);return a.length>=2?[a[0],a[1]]:null}function ol(t){if(!t)return null;const a=t.indexOf(":");return a>=0?t.slice(a+1).trim():t.trim()}function ll(t,a,s,i){const l=typeof s.title=="string"&&s.title.trim()?s.title.trim():a,u=typeof s.question=="string"?s.question:a,o=s.type;if(!u)return null;if(o==="selection"){const x=Array.isArray(s.options)?s.options.filter(r=>typeof r=="string"):[],h=Array.isArray(s.answer)?sl(s.answer):[],w=h.length!==1,d=mi(x),g=h.map(r=>d.oldToNew.get(r)).filter(r=>Number.isInteger(r)).sort((r,c)=>r-c);return{roundIndex:i,cardKey:`info:${t}:question-selection`,publicPrompt:{kind:"selection",title:l,prompt:u,options:d.values,multiple:w,cardLabel:"question"},reveal:{kind:"selection",expected:g,title:l},grade:r=>Xt({prompt:{kind:"selection",options:d.values},expected:g,answer:{selection:Array.isArray(r)?r:[]}}).correct}}if(o==="truefalse"){const x=!!s.answer;return{roundIndex:i,cardKey:`info:${t}:question-truefalse`,publicPrompt:{kind:"boolean",title:l,prompt:u,cardLabel:"question"},reveal:{kind:"boolean",expected:x,title:l},grade:h=>Xt({prompt:{kind:"boolean"},expected:x,answer:{booleanAnswer:h==null?null:!!h}}).correct}}if(o==="text"||o==="number"||o==="date"){const x=String(s.answer??"");return{roundIndex:i,cardKey:`info:${t}:question-${o}`,publicPrompt:{kind:"text",title:l,prompt:u,inputType:o==="number"?"number":o==="date"?"date":"text",cardLabel:"question"},reveal:{kind:"text",expected:x,title:l},grade:h=>Xt({prompt:{kind:"text",inputType:o==="number"?"number":o==="date"?"date":"text"},expected:x,answer:{text:String(h??"")}}).correct}}if(o==="ordering"){const x=Array.isArray(s.options)?s.options.filter(w=>typeof w=="string"):[],h=il(x);return{roundIndex:i,cardKey:`info:${t}:question-ordering`,publicPrompt:{kind:"ordering",title:l,prompt:u,options:h,cardLabel:"question"},reveal:{kind:"ordering",expected:x,title:l},grade:w=>Xt({prompt:{kind:"ordering",options:x},expected:x,answer:{ordering:Array.isArray(w)?w.map(String):[]}}).correct}}if(o==="matching"){const h=(Array.isArray(s.columns)?s.columns.map(r=>Array.isArray(r)?r.filter(c=>typeof c=="string"):[]):[]).map(r=>mi(r)),w=s.answer??{},g=(Array.isArray(w.paths)?w.paths.map(r=>Array.isArray(r)?r.map(c=>Number(c)).filter(Number.isFinite):null).filter(r=>Array.isArray(r)):[]).map(r=>r.map((c,j)=>{var y;return((y=h[j])==null?void 0:y.oldToNew.get(c))??c}));return{roundIndex:i,cardKey:`info:${t}:question-matching`,publicPrompt:{kind:"matching",title:l,prompt:u,columns:h.map(r=>r.values),cardLabel:"question"},reveal:{kind:"matching",expected:{paths:g},title:l},grade:r=>{const c=r??{},j=Array.isArray(c.paths)?c.paths.map(y=>Array.isArray(y)?y.map(k=>Number(k)).filter(Number.isFinite):null).filter(y=>Array.isArray(y)):[];return Xt({prompt:{kind:"matching",columns:h.map(y=>y.values)},expected:{paths:g},answer:{matchingPaths:j}}).correct}}}return null}async function cl(t){var g,r;const a=await $n({libraryId:t.libraryId,revisionId:t.revisionId}),i=(await an({libraryId:t.libraryId,collectionId:a.collectionId,limit:1e3})).items,l=Array.from(new Set(i.filter(c=>c.cardType==="info").map(c=>c.cardId))),u=new Map;await Promise.all(l.map(async c=>{try{const j=await la({libraryId:t.libraryId,infoId:c});u.set(c,{infoType:j.infoType,payload:j.payload})}catch{}}));const o=new Map;await Promise.all(Array.from(u.entries()).filter(([,c])=>c.infoType==="computed").map(async([c])=>{try{const j=await ds({libraryId:t.libraryId,infoId:c});o.set(c,j)}catch{}}));const x=Array.from(new Set(i.filter(c=>c.cardType==="vocab").map(c=>c.label))).filter(Boolean),h={selectMatchingPairPrompt:((g=t.labels)==null?void 0:g.selectMatchingPairPrompt)??"Select the matching pair",wordLanguagePromptPrefix:((r=t.labels)==null?void 0:r.wordLanguagePromptPrefix)??"Language of"},w=[],d=new Set;for(const c of i){if(c.cardType==="vocab"){const y=rl(c.label);if(!y)continue;if(c.checkType==="translation"&&c.direction==="a-to-b"){const[k,C]=y;w.push({roundIndex:w.length,cardKey:`connection:${c.cardId}:translation:a-to-b`,publicPrompt:{kind:"text",title:c.label,prompt:k,cardLabel:c.description??void 0},reveal:{kind:"text",expected:C,title:c.label},grade:v=>Xt({prompt:{kind:"text",inputType:"text"},expected:C,answer:{text:String(v??"")}}).correct})}else if(c.checkType==="translation"&&c.direction==="b-to-a"){const[k,C]=y;w.push({roundIndex:w.length,cardKey:`connection:${c.cardId}:translation:b-to-a`,publicPrompt:{kind:"text",title:c.label,prompt:C,cardLabel:c.description??void 0},reveal:{kind:"text",expected:k,title:c.label},grade:v=>Xt({prompt:{kind:"text",inputType:"text"},expected:k,answer:{text:String(v??"")}}).correct})}else if(c.checkType==="translation-match"){const k=Array.from(new Set([c.label,...x.filter(v=>v!==c.label).slice(0,3)])),C=k.findIndex(v=>v===c.label);w.push({roundIndex:w.length,cardKey:`connection:${c.cardId}:translation-match`,publicPrompt:{kind:"selection",title:c.label,prompt:h.selectMatchingPairPrompt,options:k,multiple:!1,cardLabel:c.description??void 0},reveal:{kind:"selection",expected:[C],title:c.label},grade:v=>Xt({prompt:{kind:"selection",options:k},expected:[C],answer:{selection:Array.isArray(v)?v.map(b=>Number(b)).filter(Number.isFinite):[Number(v)].filter(Number.isFinite)}}).correct})}continue}if(c.cardType!=="info")continue;const j=u.get(c.cardId);if(j){if(j.infoType==="word"&&c.checkType==="word-language"){const y=ol(c.description);if(!y)continue;w.push({roundIndex:w.length,cardKey:`info:${c.cardId}:word-language:${c.direction??""}`,publicPrompt:{kind:"text",title:c.label,prompt:`${h.wordLanguagePromptPrefix}: ${c.label}`,cardLabel:"word-language"},reveal:{kind:"text",expected:y,title:c.label},grade:k=>Xt({prompt:{kind:"text",inputType:"text"},expected:y,answer:{text:String(k??"")}}).correct});continue}if(j.infoType==="computed"&&c.checkType==="computed"){const y=o.get(c.cardId);if(!y)continue;w.push({roundIndex:w.length,cardKey:`info:${c.cardId}:computed`,publicPrompt:{kind:"text",title:c.label,prompt:y.prompt,multiLine:!1,cardLabel:"computed"},reveal:{kind:"text",expected:y.expectedAnswer,title:c.label},grade:k=>Xt({prompt:{kind:"text",inputType:"text"},expected:y.expectedAnswer,answer:{text:String(k??"")}}).correct});continue}if(j.infoType==="question"){const y=Ts(j.payload),k=y?ll(c.cardId,c.label,y,w.length):null;k&&(k.roundIndex=w.length,w.push(k));continue}if(j.infoType==="citation"&&!d.has(c.cardId)){d.add(c.cardId);const y=j.payload,k=typeof y.text=="string"?y.text:"",C=typeof y.title=="string"&&y.title.trim()?y.title.trim():c.label;if(!k.trim())continue;const v=Ma(k,{minLen:7,maxLen:13});for(const b of v.order){const Z=v.nodes[b];if(!Z)continue;const P=Pn(k,Z);w.push({roundIndex:w.length,cardKey:`info:${c.cardId}:quote-fragment:${b}`,publicPrompt:{kind:"citation-fragment",title:C,before:P.before,after:P.after,fragmentId:b,cardLabel:"quote-fragment"},reveal:{kind:"citation-fragment",expected:P.fragment,title:C},grade:f=>Xt({prompt:{kind:"citation-fragment"},expected:P.fragment,answer:{text:String(f??"")}}).correct})}continue}}}return w.map((c,j)=>({...c,roundIndex:j}))}function dl(t){var Ze;const{libraryId:a,revisionId:s}=t,i=Ja(),l=t.copy.cogita.library.revision,u=l.live,[o,x]=n.useState(null),[h,w]=n.useState([]),[d,g]=n.useState("loading"),[r,c]=n.useState(null),[j,y]=n.useState("simultaneous"),[k,C]=n.useState("panel"),[v,b]=n.useState("question"),Z=`cogita.live.host.${a}.${s}`,P=o?h[o.currentRoundIndex]??null:null,f=o!=null&&o.status&&o.status!=="lobby"?o.currentPrompt??null:null,q=(o==null?void 0:o.currentReveal)??null,E=n.useMemo(()=>o!=null&&o.code&&typeof window<"u"?`${window.location.origin}/#/cogita/public/live-revision/${encodeURIComponent(o.code)}`:"",[o==null?void 0:o.code]),ie=n.useMemo(()=>o!=null&&o.code&&typeof window<"u"?`${window.location.origin}/#/cogita/public/live-revision-screen/${encodeURIComponent(o.code)}`:"",[o==null?void 0:o.code]),$=n.useMemo(()=>{if(!(o!=null&&o.sessionId)||!(o!=null&&o.hostSecret)||typeof window>"u")return"";const D=`${window.location.origin}/#/cogita/live-revision-host/${encodeURIComponent(a)}/${encodeURIComponent(s)}`,ce=new URLSearchParams({sessionId:o.sessionId,hostSecret:o.hostSecret,code:o.code});return`${D}?${ce.toString()}`},[a,s,o==null?void 0:o.code,o==null?void 0:o.hostSecret,o==null?void 0:o.sessionId]),B=(o==null?void 0:o.status)==="finished"||(o==null?void 0:o.status)==="closed"?"finished":o!=null&&o.status&&o.status!=="lobby"?"active":"lobby",A=k==="panel",J=k==="panel"||k==="question",fe=k==="panel"||k==="score",De=(D,ce)=>D.replace(/\{(\w+)\}/g,(He,Ee)=>String(ce[Ee]??"")),Ce={lobby:u.statusLobby,running:u.statusRunning,revealed:u.statusRevealed,finished:u.statusFinished,closed:"Closed"},H=(D,ce,He)=>({...D,hostSecret:D.hostSecret||(ce==null?void 0:ce.hostSecret)||(He==null?void 0:He.hostSecret)||"",code:D.code||(ce==null?void 0:ce.code)||(He==null?void 0:He.code)||""}),Ne=n.useRef(null),Y=async()=>{const D=await us({libraryId:a,revisionId:s,title:u.hostKicker,sessionMode:j,hostViewMode:k,participantViewMode:v,sessionSettings:{mode:j,hostViewMode:k,participantViewMode:v}});x(D),typeof localStorage<"u"&&localStorage.setItem(Z,JSON.stringify({sessionId:D.sessionId,hostSecret:D.hostSecret,code:D.code}))};n.useEffect(()=>{o!=null&&o.sessionId&&(y(o.sessionMode==="asynchronous"?"asynchronous":"simultaneous"),C(o.hostViewMode==="question"||o.hostViewMode==="score"?o.hostViewMode:"panel"),b(o.participantViewMode==="score"||o.participantViewMode==="fullscreen"?o.participantViewMode:"question"))},[o==null?void 0:o.sessionId]),n.useEffect(()=>{let D=!1;return cl({libraryId:a,revisionId:s,labels:{selectMatchingPairPrompt:u.selectMatchingPairPrompt,wordLanguagePromptPrefix:u.wordLanguagePromptPrefix}}).then(ce=>{D||w(ce)}).catch(()=>{D||(c(u.loadRoundsError),g("error"))}),()=>{D=!0}},[a,u.selectMatchingPairPrompt,u.wordLanguagePromptPrefix,s]),n.useEffect(()=>{let D=!1;async function ce(){try{const He=new URLSearchParams(i.search),Ee=He.get("sessionId"),se=He.get("hostSecret"),Xe=He.get("code");if(!!(Ee&&se)&&Ee&&se){const Ve=await Ks({libraryId:a,sessionId:Ee,hostSecret:se});if(D)return;const ye=H(Ve,null,{hostSecret:se,code:Xe??void 0});x(ye),typeof localStorage<"u"&&localStorage.setItem(Z,JSON.stringify({sessionId:ye.sessionId,hostSecret:ye.hostSecret,code:ye.code})),g("ready");return}const xt=await us({libraryId:a,revisionId:s,title:u.hostKicker,sessionMode:j,hostViewMode:k,participantViewMode:v,sessionSettings:{mode:j,hostViewMode:k,participantViewMode:v}});if(D)return;x(xt),localStorage.setItem(Z,JSON.stringify({sessionId:xt.sessionId,hostSecret:xt.hostSecret,code:xt.code})),g("ready")}catch{if(D)return;c(u.createSessionError),g("error")}}return ce(),()=>{D=!0}},[a,u.hostKicker,i.search,s,Z]),n.useEffect(()=>{if(!o)return;const D=window.setInterval(async()=>{try{const ce=await Ks({libraryId:a,sessionId:o.sessionId,hostSecret:o.hostSecret});x(He=>H(ce,He))}catch{}},1200);return()=>window.clearInterval(D)},[a,o]),n.useEffect(()=>{if(!o||!P||o.status!=="running"||o.sessionMode!=="simultaneous")return;const D=o.participants.filter(se=>se.isConnected);if(D.length===0)return;const ce=new Set(o.currentRoundAnswers.filter(se=>se.roundIndex===o.currentRoundIndex&&(se.cardKey??"")===P.cardKey).map(se=>se.participantId));if(!D.every(se=>ce.has(se.participantId)))return;const Ee=`${o.sessionId}:${o.currentRoundIndex}:${P.cardKey}:running`;Ne.current!==Ee&&(Ne.current=Ee,K().catch(()=>{Ne.current=null}))},[P,o]);const me=async D=>{if(!o)return;const ce=Object.prototype.hasOwnProperty.call(D,"currentPrompt"),He=Object.prototype.hasOwnProperty.call(D,"currentReveal"),Ee=await jr({libraryId:a,sessionId:o.sessionId,hostSecret:o.hostSecret,status:D.status??o.status,currentRoundIndex:D.currentRoundIndex??o.currentRoundIndex,revealVersion:D.revealVersion??o.revealVersion,currentPrompt:ce?D.currentPrompt??null:o.currentPrompt??null,currentReveal:He?D.currentReveal??null:o.currentReveal??null});x(se=>H(Ee,se))},Je=async D=>{const ce=h[D];!ce||!o||await me({status:"running",currentRoundIndex:D,revealVersion:o.revealVersion+1,currentReveal:null,currentPrompt:{...ce.publicPrompt,roundIndex:D,cardKey:ce.cardKey}})},qe=async()=>{h.length&&await Je((o==null?void 0:o.currentRoundIndex)??0)},K=async()=>{if(!o||!P)return;const D=new Map(o.currentRoundAnswers.filter(Ee=>Ee.roundIndex===o.currentRoundIndex&&(Ee.cardKey??"")===P.cardKey).map(Ee=>[Ee.participantId,Ee.answer])),ce=o.participants.map(Ee=>{const se=D.get(Ee.participantId),Xe=P.grade(se);return{participantId:Ee.participantId,isCorrect:Xe,pointsAwarded:Xe?1:0}}),He=await wr({libraryId:a,sessionId:o.sessionId,hostSecret:o.hostSecret,scores:ce});x(Ee=>H(He,Ee)),await me({status:"revealed",revealVersion:He.revealVersion+1,currentReveal:P.reveal})},G=async()=>{if(!o)return;const D=o.currentRoundIndex+1;if(D>=h.length){await me({status:"finished",currentReveal:null});return}await Je(D)},je=async()=>{if(o){if(o.status==="running"){await K();return}if(o.status==="revealed"){await G();return}o.status==="lobby"&&await qe()}},O=async D=>{if(o!=null&&o.hostSecret)try{const ce=await Nr({libraryId:a,sessionId:o.sessionId,hostSecret:o.hostSecret,requestId:D});x(He=>H(ce,He))}catch{}},Se=async()=>{if(o)try{const D=await Ns({libraryId:a,sessionId:o.sessionId});x(D),typeof localStorage<"u"&&localStorage.setItem(Z,JSON.stringify({sessionId:D.sessionId,hostSecret:D.hostSecret,code:D.code}))}catch{}},Me=async()=>{try{g("loading"),await Y(),g("ready")}catch{c(u.createSessionError),g("error")}},Fe=async()=>{if(o)try{const D=await kr({libraryId:a,sessionId:o.sessionId,hostSecret:o.hostSecret});x(ce=>H(D,ce))}catch{}};return e.jsx(Et,{...t,children:e.jsx("section",{className:"cogita-library-dashboard",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid cogita-live-session-layout","data-stage":B,children:[A?e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:u.hostKicker}),e.jsx("h2",{className:"cogita-detail-title",children:u.hostTitle}),d==="loading"?e.jsx("p",{children:u.loading}):null,r?e.jsx("p",{className:"cogita-help",children:r}):null,o?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Session mode"}),e.jsxs("select",{value:j,onChange:D=>y(D.target.value),children:[e.jsx("option",{value:"simultaneous",children:"Simultaneous"}),e.jsx("option",{value:"asynchronous",children:"Asynchronous"})]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Host view"}),e.jsxs("select",{value:k,onChange:D=>C(D.target.value),children:[e.jsx("option",{value:"panel",children:"Panel"}),e.jsx("option",{value:"question",children:"Question"}),e.jsx("option",{value:"score",children:"Score"})]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Participant view"}),e.jsxs("select",{value:v,onChange:D=>b(D.target.value),children:[e.jsx("option",{value:"question",children:"Question"}),e.jsx("option",{value:"score",children:"Score"}),e.jsx("option",{value:"fullscreen",children:"Fullscreen"})]})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:u.joinCodeLabel}),e.jsx("input",{readOnly:!0,value:o.code})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:u.joinUrlLabel}),e.jsx("input",{readOnly:!0,value:E})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:"Host URL"}),e.jsx("input",{readOnly:!0,value:$})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:"Presenter URL"}),e.jsx("input",{readOnly:!0,value:ie})]}),E?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:u.qrLabel}),e.jsx("div",{style:{display:"inline-flex",padding:"0.75rem",borderRadius:"12px",background:"#fff"},children:e.jsx(yi,{value:E,size:176,marginSize:2})})]}):null,e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:u.statusLabel}),e.jsx("input",{readOnly:!0,value:Ce[o.status]??o.status})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:qe,disabled:!h.length,children:u.publishCurrentRound}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Me,children:"New session"}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Se,children:"Refresh links"}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Fe,disabled:o.status==="closed",children:"Close session"})]}),e.jsx("p",{className:"cogita-help",children:De(u.roundsLabel,{count:h.length})})]}):null]}):null,J?e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:u.currentRoundTitle}),e.jsx("h3",{className:"cogita-detail-title",children:f&&typeof f.title=="string"?f.title:(o==null?void 0:o.status)==="lobby"?u.sessionNotStarted:u.waitingForPublishedRound}),(o==null?void 0:o.status)==="lobby"?e.jsx("p",{className:"cogita-help",children:u.hiddenBeforeStart}):e.jsx(Qa,{className:"cogita-live-card-container",feedbackToken:q?`correct-${(o==null?void 0:o.revealVersion)??0}`:"idle",children:e.jsx(En,{prompt:f,revealExpected:q==null?void 0:q.expected,mode:"readonly",labels:{answerLabel:l.answerLabel,correctAnswerLabel:l.correctAnswerLabel,trueLabel:u.trueLabel,falseLabel:u.falseLabel,fragmentLabel:u.fragmentLabel,correctFragmentLabel:u.correctFragmentLabel,participantAnswerPlaceholder:u.participantAnswerPlaceholder,unsupportedPromptType:u.unsupportedPromptType,waitingForReveal:"Waiting for reveal.",selectedPaths:"Selected paths",removePath:"Remove",columnPrefix:"Column"}})}),B!=="lobby"?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:je,disabled:!h.length||!P||o.status==="finished"||o.status==="closed",children:o.status==="revealed"?l.nextQuestion:l.checkAnswer})}):null,B!=="finished"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-user-kicker",children:u.participantsTitle}),e.jsxs("div",{className:"cogita-share-list",children:[o==null?void 0:o.participants.map(D=>{const ce=o.currentRoundAnswers.find(He=>He.participantId===D.participantId);return e.jsx("div",{className:"cogita-share-row",children:e.jsxs("div",{children:[e.jsx("strong",{children:D.displayName}),e.jsxs("div",{className:"cogita-share-meta",children:[ce?u.answerStatusAnswered:u.answerStatusWaiting,(ce==null?void 0:ce.isCorrect)===!0?` · ${u.answerStatusCorrect}`:"",(ce==null?void 0:ce.isCorrect)===!1?` · ${u.answerStatusIncorrect}`:""]})]})},D.participantId)}),o&&o.participants.length===0?e.jsx("p",{className:"cogita-help",children:u.noParticipants}):null]}),o&&(((Ze=o.pendingReloginRequests)==null?void 0:Ze.length)??0)>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Relogin requests"}),e.jsx("div",{className:"cogita-share-list",children:(o.pendingReloginRequests??[]).map(D=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsxs("div",{children:[e.jsx("strong",{children:D.displayName}),e.jsx("div",{className:"cogita-share-meta",children:new Date(D.requestedUtc).toLocaleTimeString()})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>O(D.requestId),children:"Allow relogin"})]},D.requestId))})]}):null]}):null]}):null,B!=="lobby"&&fe?e.jsxs("div",{className:"cogita-library-panel cogita-live-scoreboard-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:B==="finished"?u.finalScoreTitle:u.pointsTitle}),e.jsx("div",{className:"cogita-share-list",children:((o==null?void 0:o.scoreboard)??[]).map(D=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("div",{children:e.jsx("strong",{children:D.displayName})}),e.jsxs("div",{className:"cogita-share-meta",children:[D.score," ",u.scoreUnit]})]},`score:${D.participantId}`))})]}):null]})})})})})}const xl=Object.freeze(Object.defineProperty({__proto__:null,CogitaLiveRevisionHostPage:dl},Symbol.toStringTag,{value:"Module"}));function gi(t){return`cogita.live.join.${t}`}function ul(t){const{code:a}=t,s=t.copy.cogita.library.revision,i=s.live,[l,u]=n.useState(""),[o,x]=n.useState(()=>typeof localStorage>"u"?null:localStorage.getItem(gi(a))),[h,w]=n.useState(null),[d,g]=n.useState("idle"),[r,c]=n.useState(""),[j,y]=n.useState([]),[k,C]=n.useState(null),[v,b]=n.useState([]),[Z,P]=n.useState([]),[f,q]=n.useState([]),[E,ie]=n.useState(null),[$,B]=n.useState(!1),A=(h==null?void 0:h.currentPrompt)??null,J=(h==null?void 0:h.currentReveal)??null,fe=J==null?void 0:J.expected,De=(h==null?void 0:h.status)==="finished"||(h==null?void 0:h.status)==="closed"?"finished":h!=null&&h.status&&h.status!=="lobby"?"active":"lobby",Ce=(h==null?void 0:h.participantViewMode)??"question",H=Ce!=="fullscreen"||De==="lobby"||!o,Ne=Ce!=="score",Y=Ce!=="question"||De==="finished",me=n.useMemo(()=>`${(h==null?void 0:h.currentRoundIndex)??0}:${(h==null?void 0:h.revealVersion)??0}:${String((A==null?void 0:A.cardKey)??"")}`,[A==null?void 0:A.cardKey,h==null?void 0:h.currentRoundIndex,h==null?void 0:h.revealVersion]);n.useEffect(()=>{c(""),y([]),C(null),b(Array.isArray(A==null?void 0:A.options)?[...A.options??[]]:[]);const O=Array.isArray(A==null?void 0:A.columns)?Math.max(2,A.columns.length):0;P([]),q(O>0?new Array(O).fill(null):[])},[me]),n.useEffect(()=>{let O=!0;const Se=async()=>{try{const Fe=await hs({code:a,participantToken:o});if(!O)return;w(Fe),o&&g("ready")}catch{O&&d!=="joining"&&g("error")}};Se();const Me=window.setInterval(Se,1200);return()=>{O=!1,window.clearInterval(Me)}},[a,o,d]),n.useEffect(()=>{if(!E||!$||o)return;let O=!1;const Se=window.setInterval(async()=>{try{const Me=await Sr({code:a,requestId:E});if(O)return;Me.status==="approved"&&(B(!1),g("idle"))}catch{}},1200);return()=>{O=!0,window.clearInterval(Se)}},[a,o,$,E]);const Je=async()=>{g("joining");try{const O=await Tr({code:a,name:l});x(O.participantToken),localStorage.setItem(gi(a),O.participantToken),B(!1),ie(null),g("ready")}catch(O){if(O instanceof ks&&O.status===409)try{const Se=await Cr({code:a,name:l});ie(Se.requestId),B(!0),g("ready");return}catch{g("error");return}g("error")}},qe=O=>{if(!!(A!=null&&A.multiple)){y(Me=>Me.includes(O)?Me.filter(Fe=>Fe!==O):[...Me,O].sort((Fe,Ze)=>Fe-Ze));return}y([O])},K=(O,Se)=>{b(Me=>{const Fe=[...Me],Ze=O+Se;return Ze<0||Ze>=Fe.length?Me:([Fe[O],Fe[Ze]]=[Fe[Ze],Fe[O]],Fe)})},G=(O,Se)=>{const Me=Array.isArray(A==null?void 0:A.columns)?A.columns:[],Fe=Math.max(2,Me.length);q(Ze=>{const D=Array.from({length:Fe},(He,Ee)=>Ze[Ee]??null);if(D[O]=D[O]===Se?null:Se,D.some(He=>He==null))return D;const ce=D.map(He=>Number(He));return P(He=>[...He,ce]),new Array(Fe).fill(null)})},je=async()=>{if(!o||!A||typeof A.cardKey!="string")return;let O=null;switch(A.kind){case"selection":O=j;break;case"boolean":O=k;break;case"ordering":O=v;break;case"matching":O={paths:Z};break;case"citation-fragment":case"text":default:O=r;break}try{await Ir({code:a,participantToken:o,roundIndex:Number(A.roundIndex??(h==null?void 0:h.currentRoundIndex)??0),cardKey:A.cardKey,answer:O});const Se=await hs({code:a,participantToken:o});w(Se),g("ready")}catch{g("error")}};return e.jsx(Et,{...t,children:e.jsx("section",{className:"cogita-library-dashboard",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid cogita-live-session-layout","data-stage":De,"data-participant-view":Ce,children:[H?e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:i.joinKicker}),e.jsx("h2",{className:"cogita-detail-title",children:i.joinTitle}),o?e.jsx("p",{className:"cogita-help",children:i.joinedWaiting}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:i.participantNameLabel}),e.jsx("input",{value:l,onChange:O=>u(O.target.value)})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:Je,disabled:!l.trim()||d==="joining",children:d==="joining"?i.joiningAction:i.joinAction})})]}),$?e.jsx("p",{className:"cogita-help",children:"Relogin request sent. Wait for host approval and join again."}):null,d==="error"?e.jsx("p",{className:"cogita-help",children:i.connectionError}):null,De==="lobby"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-user-kicker",children:i.scoreboardTitle}),e.jsxs("div",{className:"cogita-share-list",children:[h==null?void 0:h.scoreboard.map(O=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("div",{children:e.jsx("strong",{children:O.displayName})}),e.jsxs("div",{className:"cogita-share-meta",children:[O.score," ",i.scoreUnit]})]},O.participantId)),h&&h.scoreboard.length===0?e.jsx("p",{className:"cogita-help",children:i.noParticipants}):null]})]}):null]}):null,Ne?e.jsxs("div",{className:`cogita-library-panel ${Ce==="fullscreen"?"cogita-live-fullscreen-panel":""}`,children:[e.jsx("p",{className:"cogita-user-kicker",children:i.questionTitle}),e.jsx("h3",{className:"cogita-detail-title",children:typeof(A==null?void 0:A.title)=="string"?A.title:i.waitingForPublishedRound}),A?e.jsxs(e.Fragment,{children:[e.jsx(Qa,{className:"cogita-live-card-container",feedbackToken:J?`correct-${(h==null?void 0:h.revealVersion)??0}`:"idle",children:e.jsx(En,{prompt:A,revealExpected:fe,mode:"interactive",labels:{answerLabel:s.answerLabel,correctAnswerLabel:s.correctAnswerLabel,trueLabel:i.trueLabel,falseLabel:i.falseLabel,fragmentLabel:i.fragmentLabel,correctFragmentLabel:i.correctFragmentLabel,participantAnswerPlaceholder:i.participantAnswerPlaceholder,unsupportedPromptType:i.unsupportedPromptType,waitingForReveal:"Waiting for reveal.",selectedPaths:"Selected paths",removePath:"Remove",columnPrefix:"Column"},answers:{text:r,selection:j,booleanAnswer:k,ordering:v,matchingRows:Z,matchingSelection:f},onTextChange:c,onSelectionToggle:qe,onBooleanChange:C,onOrderingMove:K,onMatchingPick:G,onMatchingRemovePath:O=>P(Se=>Se.filter((Me,Fe)=>Fe!==O))})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:je,disabled:!o||!A.cardKey||(h==null?void 0:h.answerSubmitted),children:h!=null&&h.answerSubmitted?i.submitted:i.submitAnswer})})]}):e.jsx("p",{className:"cogita-help",children:i.waitingForHostQuestion})]}):null,De!=="lobby"&&Y?e.jsxs("div",{className:"cogita-library-panel cogita-live-scoreboard-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:De==="finished"?i.finalScoreTitle:i.pointsTitle}),e.jsxs("div",{className:"cogita-share-list",children:[h==null?void 0:h.scoreboard.map(O=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("div",{children:e.jsx("strong",{children:O.displayName})}),e.jsxs("div",{className:"cogita-share-meta",children:[O.score," ",i.scoreUnit]})]},`score:${O.participantId}`)),h&&h.scoreboard.length===0?e.jsx("p",{className:"cogita-help",children:i.noParticipants}):null]})]}):null]})})})})})}const wl=Object.freeze(Object.defineProperty({__proto__:null,CogitaLiveRevisionJoinPage:ul},Symbol.toStringTag,{value:"Module"}));function hl(t){const{code:a}=t,s=t.copy.cogita.library.revision.live,[i,l]=n.useState(null),[u,o]=n.useState("loading"),x=(i==null?void 0:i.currentPrompt)??null,h=(i==null?void 0:i.currentReveal)??null,w=h==null?void 0:h.expected,d=(i==null?void 0:i.participantViewMode)??"question",g=(i==null?void 0:i.status)==="finished"||(i==null?void 0:i.status)==="closed"?"finished":i!=null&&i.status&&i.status!=="lobby"?"active":"lobby",r=d!=="score",c=d!=="question"||g==="finished",j=n.useMemo(()=>typeof window<"u"?`${window.location.origin}/#/cogita/public/live-revision/${encodeURIComponent(a)}`:"",[a]);return n.useEffect(()=>{let y=!0;const k=async()=>{try{const v=await hs({code:a});if(!y)return;l(v),o("ready")}catch{if(!y)return;o("error")}};k();const C=window.setInterval(k,1200);return()=>{y=!1,window.clearInterval(C)}},[a]),e.jsx(Et,{...t,children:e.jsx("section",{className:"cogita-library-dashboard",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid cogita-live-session-layout","data-stage":g,"data-participant-view":d,children:[r?e.jsxs("div",{className:`cogita-library-panel ${d==="fullscreen"?"cogita-live-fullscreen-panel":""}`,children:[e.jsx("p",{className:"cogita-user-kicker",children:s.hostKicker}),e.jsx("h2",{className:"cogita-detail-title",children:u==="error"?s.connectionError:s.statusLobby}),(i==null?void 0:i.status)==="lobby"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:s.joinCodeLabel}),e.jsx("input",{readOnly:!0,value:a})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:s.joinUrlLabel}),e.jsx("input",{readOnly:!0,value:j})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:s.qrLabel}),e.jsx("div",{style:{display:"inline-flex",padding:"0.75rem",borderRadius:"12px",background:"#fff"},children:e.jsx(yi,{value:j,size:176,marginSize:2})})]})]}):e.jsx(Qa,{className:"cogita-live-card-container",feedbackToken:h?`correct-${(i==null?void 0:i.revealVersion)??0}`:"idle",children:e.jsx(En,{prompt:x,revealExpected:w,mode:"readonly",labels:{answerLabel:t.copy.cogita.library.revision.answerLabel,correctAnswerLabel:t.copy.cogita.library.revision.correctAnswerLabel,trueLabel:s.trueLabel,falseLabel:s.falseLabel,fragmentLabel:s.fragmentLabel,correctFragmentLabel:s.correctFragmentLabel,participantAnswerPlaceholder:s.participantAnswerPlaceholder,unsupportedPromptType:s.unsupportedPromptType,waitingForReveal:"Waiting for reveal.",selectedPaths:"Selected paths",removePath:"Remove",columnPrefix:"Column"}})})]}):null,c?e.jsxs("div",{className:"cogita-library-panel cogita-live-scoreboard-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:(i==null?void 0:i.status)==="finished"?s.finalScoreTitle:s.pointsTitle}),e.jsxs("div",{className:"cogita-share-list",children:[((i==null?void 0:i.scoreboard)??[]).map(y=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("div",{children:e.jsx("strong",{children:y.displayName})}),e.jsxs("div",{className:"cogita-share-meta",children:[y.score," ",s.scoreUnit]})]},`presenter-score:${y.participantId}`)),i&&i.scoreboard.length===0?e.jsx("p",{className:"cogita-help",children:s.noParticipants}):null]})]}):null]})})})})})}const jl=Object.freeze(Object.defineProperty({__proto__:null,CogitaLiveRevisionPresenterPage:hl},Symbol.toStringTag,{value:"Module"}));function ml(t){const a=rn(),s=t.copy.cogita.library.revision.live,{libraryId:i}=t,[l,u]=n.useState([]),[o,x]=n.useState([]),[h,w]=n.useState("loading"),[d,g]=n.useState(null),[r,c]=n.useState({}),j=n.useMemo(()=>({lobby:s.statusLobby,running:s.statusRunning,revealed:s.statusRevealed,finished:s.statusFinished,closed:"Closed"}),[s.statusFinished,s.statusLobby,s.statusRevealed,s.statusRunning]),y=async()=>{w("loading");try{const[C,v]=await Promise.all([Mr({libraryId:i}),Ti({libraryId:i})]);u(C),x(v),w("ready")}catch{u([]),x([]),w("error")}};n.useEffect(()=>{y()},[i]);const k=async(C,v)=>{g(C.sessionId);try{const b=r[C.sessionId]??await Ns({libraryId:i,sessionId:C.sessionId});r[C.sessionId]||c(f=>({...f,[C.sessionId]:{sessionId:b.sessionId,code:b.code,hostSecret:b.hostSecret}}));const Z=encodeURIComponent(b.code);if(v==="host"){a(`/cogita/live-revision-host/${encodeURIComponent(i)}/${encodeURIComponent(C.revisionId)}?sessionId=${encodeURIComponent(b.sessionId)}&hostSecret=${encodeURIComponent(b.hostSecret)}&code=${Z}`);return}const P=v==="presenter"?`${window.location.origin}/#/cogita/public/live-revision-screen/${Z}`:`${window.location.origin}/#/cogita/public/live-revision/${Z}`;window.open(P,"_blank","noopener")}finally{g(null)}};return e.jsx(Et,{...t,children:e.jsx("section",{className:"cogita-library-dashboard",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:s.hostKicker}),e.jsx("h2",{className:"cogita-detail-title",children:"Active live sessions"})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:y,children:"Refresh"})})]}),h==="loading"?e.jsx("p",{children:s.loading}):null,h==="error"?e.jsx("p",{className:"cogita-help",children:s.connectionError}):null,h==="ready"&&l.length===0?e.jsx("p",{className:"cogita-help",children:"No active sessions."}):null,e.jsx("div",{className:"cogita-share-list",children:l.map(C=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsxs("div",{children:[e.jsx("strong",{children:C.title||C.sessionId}),e.jsxs("div",{className:"cogita-share-meta",children:[j[C.status]??C.status," · ",s.participantsTitle,": ",C.participantCount]})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>k(C,"host"),disabled:d===C.sessionId,children:"Host"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>k(C,"presenter"),disabled:d===C.sessionId,children:"Screen"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>k(C,"login"),disabled:d===C.sessionId,children:"Login panel"})]})]},C.sessionId))}),e.jsx("div",{className:"cogita-detail-header",style:{marginTop:"1rem"},children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Participant sessions"}),e.jsx("h3",{className:"cogita-detail-title",children:"Sessions where you participate"})]})}),h==="ready"&&o.length===0?e.jsx("p",{className:"cogita-help",children:"No participant sessions."}):null,e.jsx("div",{className:"cogita-share-list",children:o.map(C=>e.jsx("div",{className:"cogita-share-row",children:e.jsxs("div",{children:[e.jsx("strong",{children:C.title||C.sessionId}),e.jsxs("div",{className:"cogita-share-meta",children:[j[C.status]??C.status," · ",s.participantsTitle,": ",C.participantCount]}),e.jsxs("div",{className:"cogita-share-meta",children:["Score: ",C.participantScore," · ",C.isConnected?"Connected":"Disconnected"]})]})},`participating:${C.sessionId}`))})]})})})})})}const kl=Object.freeze(Object.defineProperty({__proto__:null,CogitaLiveSessionsPage:ml},Symbol.toStringTag,{value:"Module"}));export{bl as C,yl as a,vl as b,xl as c,wl as d,jl as e,kl as f};
