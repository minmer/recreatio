import{r as a,j as e,u as $s,a as Rs,b as Es,c as As,R as Fs,B as Ps,C as zs,d as ds}from"./vendor-B-s_ukyJ.js";import{L as Ks,A as Bs,g as _s,a as cn,b as va,c as Ds,s as fs,d as qs,e as bs,f as us,h as Vs,i as dn,j as ua,u as un,k as hn,p as gn,l as mn,m as Os,r as Us,n as pn,o as fn,q as bn,t as _a,v as $a,w as yn,x as xn,y as vn,z as wn,B as jn,C as kn,D as Nn,E as ys,F as Qt,G as Tn,H as Sn,I as Cn,J as Mn,K as In,M as Ln,N as $n,O as Rn,P as En,Q as An,R as Fn,S as Pn,T as zn,U as Kn,V as Bn,W as _n,X as xs}from"./recreatio-core-B7V_U7t3.js";import"./vendor-cogita-ui-BuvhRVJJ.js";const xa={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},ya={moveMs:900,pauseMs:220,errorMs:900},Dn=(t=11)=>{let s=t;const n=()=>(s=(s*1664525+1013904223)%4294967296,s/4294967296),{width:r,height:l,paddingX:p,paddingY:y,levels:x}=xa,E=(l-y*2)/(x.length-1),k=[],d=[],N=[];x.forEach((w,g)=>{const re=l-y-g*E,z=r-p*2,m=[];for(let U=0;U<w;U+=1){const L=p+(U+1)*z/(w+1),G=(n()-.5)*18,S=Math.max(p,Math.min(r-p,L+G)),R=g===0?3:g<2?2.1:1.4,ee=g===0?"root":`l${g}-${U}`;m.push({id:ee,x:g===0?r/2:S,y:re,r:R,level:g,role:g===0?"root":void 0})}N.push(m),k.push(...m)});const c=N[N.length-1];if(c!=null&&c.length){const w=c[Math.floor(c.length/2)];w.role="goal",w.r=2}for(let w=1;w<N.length;w+=1){const g=N[w-1];N[w].forEach(z=>{const m=[...g].sort((S,R)=>Math.abs(S.x-z.x)-Math.abs(R.x-z.x)),U=m[0],L=m[1]&&n()<.45?m[1]:null;(L?[U,L]:[U]).forEach(S=>{d.push({from:S.id,to:z.id,key:`${S.id}-${z.id}`})}),n()<.2&&m[2]&&d.push({from:m[2].id,to:z.id,key:`${m[2].id}-${z.id}`})})}const o=new Map;d.forEach(w=>{const g=o.get(w.to)??[];g.push(w.from),o.set(w.to,g)});const O=new Map,de=new Map,Y=new Map;d.forEach(w=>{const g=O.get(w.from)??[];g.push(w.key),O.set(w.from,g);const re=de.get(w.from)??[];re.push(w.to),de.set(w.from,re);const z=Y.get(w.from)??[];z.push(w.to),Y.set(w.from,z);const m=Y.get(w.to)??[];m.push(w.from),Y.set(w.to,m)});const W=new Map;return k.forEach(w=>{W.set(w.id,w)}),{nodes:k,links:d,parentsById:o,linksByFrom:O,childrenByFrom:de,neighborsById:Y,nodesById:W}};function qn({slides:t,activeIndex:s,introOpen:n,prefersReducedMotion:r,onNext:l,onPrev:p,onSelect:y,onExit:x,onOpen:E,onRegister:k}){const d=s===t.length-1,N=n&&s===0?"entry":"docked",c=t[t.length-1],[o,O]=a.useState(!1),de=a.useMemo(()=>Array.from({length:20},(I,X)=>({src:`/cogita/logo/Cogita${String(X).padStart(2,"0")}.png`,kind:X<=11?"bubble":X<=17?"text":"recreatio"})),[]),Y=n&&s===0;a.useEffect(()=>{if(!n){O(!1);return}s>0&&!o&&O(!0)},[s,n,o]);const W=a.useRef(0),w=a.useRef(null),g=a.useMemo(()=>{const I={x:40,y:160},X={x:260,y:48},we=6,$=X.x-I.x,V=I.y-X.y,fe=$/we,Ce=[.3,.45,.6,.65,1.4,2.2],xe=Ce.reduce((Ee,Ne)=>Ee+Ne,0),$e=Ce.map(Ee=>V*Ee/xe),Ue=[I];let We=I.x,Re=I.y;for(let Ee=1;Ee<=we;Ee+=1){const Ne=(Math.random()-.5)*14,st=(Math.random()-.5)*28;We=Math.max(I.x+Ee*14,Math.min(X.x-(we-Ee)*14,We+fe+Ne));const Qe=$e[Ee-1]??$e[$e.length-1];Re=Re-Qe+st;const Ge=Math.max(X.y,Math.min(I.y-4,Re));Ue.push({x:Math.round(We),y:Math.round(Ge)})}return Ue[Ue.length-1]=X,Ue},[]),re=a.useMemo(()=>{const V=(xe,$e,Ue)=>Math.min(Ue,Math.max($e,xe)),fe=g.map(xe=>{const $e=10+Math.random()*36;return{x:V(xe.x,40,260),y:V(xe.y-$e,40,140)}}),Ce=g.map((xe,$e)=>{var Re;const Ue=12+Math.random()*40,We=((Re=fe[$e])==null?void 0:Re.y)??xe.y;return{x:V(xe.x,40,260),y:V(Math.max(We+10,xe.y+Ue),60,170)}});return{upper:fe,lower:Ce}},[g]),z=a.useMemo(()=>{var X;const I=((X=g[4])==null?void 0:X.x)??260;return Math.max(0,Math.min(240,I-40))},[g]),m=a.useMemo(()=>{var $e,Ue;const I=(We,Re,Ee)=>Math.min(Ee,Math.max(Re,We)),X=(We,Re,Ee)=>g.map((Ne,st)=>{var ht,ot;const Qe=((ht=re.upper[st])==null?void 0:ht.y)??Ne.y,Ge=((ot=re.lower[st])==null?void 0:ot.y)??Ne.y,mt=(Math.random()-.5)*70,jt=Ne.y+We+mt,Ye=I(Ne.y+Re,Qe+6,Ge-6),Ze=I(Ne.y+Ee,Qe+6,Ge-6);return{x:Ne.x,y:I(jt,Math.min(Ye,Ze),Math.max(Ye,Ze))}}),we=-14+Math.random()*28,$=14+Math.random()*28,V=X(we,-80,12),fe=X($,-12,80);for(let We=4;We<g.length;We+=1){const Re=g[We],Ee=(($e=re.upper[We])==null?void 0:$e.y)??Re.y,Ne=((Ue=re.lower[We])==null?void 0:Ue.y)??Re.y;V[We]={x:Re.x,y:I(Re.y-12,Ee+6,Ne-6)},fe[We]={x:Re.x,y:I(Re.y+12,Ee+6,Ne-6)}}const Ce=re.upper.length?re.upper[re.upper.length-1].y:40,xe=re.lower.length?re.lower[re.lower.length-1].y:170;return V[V.length-1]={x:g[g.length-1].x,y:I(g[g.length-1].y-14,Ce,xe)},fe[fe.length-1]={x:g[g.length-1].x,y:I(g[g.length-1].y+12,Ce,xe)},{higher:V,lower:fe}},[g,re]),U=1e4,L=a.useMemo(()=>{let I=17;const X=()=>(I=(I*1664525+1013904223)%4294967296,I/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map(($,V)=>{const fe=(X()-.5)*240,Ce=(X()-.5)*180,xe=(X()-.5)*24;return{id:`card-${V+1}`,throw:{x:`${fe.toFixed(0)}px`,y:`${Ce.toFixed(0)}px`,rot:`${xe.toFixed(1)}deg`},grid:{x:`${$.x}px`,y:`${$.y}px`},delay:`${V*.12}s`}})},[]),G=a.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[S,R]=a.useState([]),ee=a.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),te=a.useMemo(()=>{const X=[],$=(fe,Ce)=>fe+Math.random()*(Ce-fe);for(let fe=0;fe<6;fe+=1){let Ce=!1;for(let xe=0;xe<80;xe+=1){const $e=$(14,86),Ue=$(10,34);if(X.every(Re=>{const Ee=Re.x-$e,Ne=Re.y-Ue;return Math.hypot(Ee,Ne)>=12})){X.push({x:$e,y:Ue}),Ce=!0;break}}Ce||X.push({x:$(16,84),y:$(12,32)})}return X.map((fe,Ce)=>({id:`p${Ce+1}`,x:`${fe.x.toFixed(1)}%`,y:`${fe.y.toFixed(1)}%`,xNum:fe.x,yNum:fe.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ae,Pe]=a.useState(0),[ue,C]=a.useState(0),[pe,v]=a.useState([]),D=1e4,he=a.useMemo(()=>{if(te.length<2)return[];const I=Ce=>{let xe=Ce+1831565813;return xe=Math.imul(xe^xe>>>15,xe|1),xe^=xe+Math.imul(xe^xe>>>7,xe|61),((xe^xe>>>14)>>>0)/4294967296},X=(Ce,xe)=>Math.floor(I(Ce)*xe),we=new Set,$=[],V=Math.min(3,te.length);let fe=0;for(;$.length<V&&fe<30;){fe+=1;const Ce=X(ae*13+fe*5,te.length),xe=X(ae*29+fe*7,te.length);if(Ce===xe)continue;const $e=Ce<xe?`${Ce}-${xe}`:`${xe}-${Ce}`;we.has($e)||(we.add($e),$.push({id:`link-${$e}`,from:te[Ce],to:te[xe],delay:`${(fe*.35).toFixed(2)}s`}))}return $},[ae,te]);a.useEffect(()=>{if(!n||s!==2)return;const I=()=>{const we=L.map($=>$.id);for(let $=we.length-1;$>0;$-=1){const V=Math.floor(Math.random()*($+1));[we[$],we[V]]=[we[V],we[$]]}return we.slice(0,4)};R(I());const X=window.setInterval(()=>{R(I())},U);return()=>window.clearInterval(X)},[s,n,L,U]),a.useEffect(()=>{if(!n||s!==3)return;const I=()=>{C(Math.floor(Math.random()*ee.length)),v(te.map(()=>Math.random()<.6?"good":"bad")),Pe(we=>we+1)};I();const X=window.setInterval(I,D);return()=>window.clearInterval(X)},[s,n,ee.length,te,D]);const Q=a.useMemo(()=>Dn(11),[]),[q,ye]=a.useState(new Set(["root"])),[Ie,be]=a.useState(new Set),[Ae,je]=a.useState(new Set),[ze,Ke]=a.useState({fromId:"root",toId:"root",key:0}),ke=a.useRef(q),Be=a.useRef("root"),Je=a.useRef(0),He=a.useRef(null),K=a.useRef(null),H=a.useRef([]);a.useEffect(()=>{ke.current=q},[q]);const qe=a.useMemo(()=>{const I=new Set;return q.forEach(X=>{const we=Q.linksByFrom.get(X);we&&we.forEach($=>I.add($))}),I},[q,Q]),Se=Q.nodesById.get(ze.toId)??Q.nodesById.get("root"),le=Se?`${Se.x/xa.width*100}%`:"50%",Le=Se?`${Se.y/xa.height*100}%`:"90%";a.useEffect(()=>{if(!n||s!==1||r)return;(()=>{ye(new Set(["root"])),be(new Set),je(new Set),Ke({fromId:"root",toId:"root",key:0}),K.current=null,Je.current=0,Be.current="root",H.current=[]})();const X=()=>{const $=Be.current,V=ke.current,Ce=(Q.childrenByFrom.get($)??[]).filter(Ne=>!V.has(Ne));if(Ce.length)return Ce[Math.floor(Math.random()*Ce.length)];if(V.size>=Q.nodes.length){const Ne=Q.neighborsById.get($)??[];return Ne.length?Ne[Math.floor(Math.random()*Ne.length)]:null}const xe=Ne=>(Q.childrenByFrom.get(Ne)??[]).some(Qe=>!V.has(Qe)),$e=[$],Ue=new Set([$]),We=new Map;let Re=null;for(;$e.length;){const Ne=$e.shift();if(!Ne)break;if(Ne!==$&&xe(Ne)){Re=Ne;break}(Q.neighborsById.get(Ne)??[]).forEach(Qe=>{Ue.has(Qe)||(Ue.add(Qe),We.set(Qe,Ne),$e.push(Qe))})}if(!Re)return null;let Ee=Re;for(;We.get(Ee)&&We.get(Ee)!==$;)Ee=We.get(Ee)??Ee;return Ee},we=($,V)=>{if($===V){const fe=X();fe&&we($,fe);return}Je.current+=1,Ke({fromId:$,toId:V,key:Je.current}),Be.current=V,He.current=window.setTimeout(()=>{const fe=Q.parentsById.get(V)??[],Ce=ke.current,xe=fe.filter(Re=>!Ce.has(Re));if(!xe.length){const Re=new Set(Ce);Re.add(V),ye(Re),He.current=window.setTimeout(()=>{for(;H.current.length;){const Ne=H.current[H.current.length-1];if(!Re.has(Ne)){if(Ne!==V){we(V,Ne);return}break}H.current.pop()}const Ee=X();Ee&&we(V,Ee)},ya.pauseMs);return}const $e=new Set([V,...xe]),Ue=new Set(xe.map(Re=>`${Re}-${V}`));be($e),je(Ue),H.current.includes(V)||H.current.push(V);const We=xe[Math.floor(Math.random()*xe.length)];K.current={fromId:V,toId:We},He.current=window.setTimeout(()=>{be(new Set),je(new Set);const Re=K.current;Re&&we(Re.fromId,Re.toId)},ya.errorMs)},ya.moveMs)};return He.current=window.setTimeout(()=>{const $=X();$&&we(Be.current,$)},ya.pauseMs),()=>{He.current&&window.clearTimeout(He.current)}},[s,n,Q,r]);const _e=I=>{if(!n)return;const X=Date.now();X-W.current<520||Math.abs(I.deltaY)<10||(W.current=X,I.deltaY>0?l():p(),I.preventDefault())},B=I=>{if(!n)return;const X=I.touches[0];X&&(w.current={x:X.clientX,y:X.clientY})},ge=I=>{if(!n)return;const X=w.current;if(w.current=null,!X)return;const we=I.changedTouches[0];if(!we)return;const $=we.clientX-X.x,V=we.clientY-X.y;Math.abs(V)<40||Math.abs(V)<Math.abs($)||(V<0?l():p())};return e.jsxs("div",{className:`cogita-intro ${n?"is-open":"is-closed"} ${r?"is-reduced":""} ${d?"is-final":""}`,"data-slide":s+1,onWheel:_e,onTouchStart:B,onTouchEnd:ge,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":N,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${Y&&!o?"is-entry":""}`,children:de.map((I,X)=>e.jsx("img",{src:I.src,alt:"",className:`cogita-logo-layer ${X===0?"is-base":""} ${I.kind==="text"?"is-text":I.kind==="recreatio"?"is-recreatio":""} ${I.kind==="bubble"?"is-bubble":""}`},I.src))})}),n&&t.map((I,X)=>{const we=X===s;return e.jsxs("section",{className:`cogita-intro-slide slide-${X+1} ${we?"is-active":""}`,"aria-hidden":!we,children:[e.jsxs("div",{className:"cogita-intro-text",children:[I.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:I.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:I.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:I.title}),I.body&&e.jsx("p",{children:I.body.split(`
`).map(($,V)=>e.jsxs("span",{children:[$,V===0&&e.jsx("br",{})]},String(V)))})]}),I.micro&&e.jsx("p",{className:"cogita-intro-micro",children:I.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:d?k:l,children:I.cta}),d&&I.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>y(0),children:I.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[X===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${xa.width} ${xa.height}`,preserveAspectRatio:"none",children:[Q.links.map($=>{const V=Q.nodesById.get($.from),fe=Q.nodesById.get($.to);if(!V||!fe)return null;const Ce=qe.has($.key),xe=Ae.has($.key);return e.jsx("line",{className:`map-link ${Ce?"is-active":""} ${xe?"is-error":""}`,x1:V.x,y1:V.y,x2:fe.x,y2:fe.y},$.key)}),Q.nodes.map($=>{const V=q.has($.id),fe=Ie.has($.id);return e.jsx("circle",{className:`map-node ${$.role?`is-${$.role}`:""} ${V?"is-active":""} ${fe?"is-error":""}`,cx:$.x,cy:$.y,r:$.r},$.id)})]}),Se&&e.jsx("span",{className:"map-explorer-dot",style:{left:le,top:Le,"--move":`${ya.moveMs}ms`}})]}),X===2&&e.jsx("div",{className:"cogita-index-cards",children:L.map($=>{const V=S.indexOf($.id),fe=V>=0?G[V]:null,Ce=(fe==null?void 0:fe.x)??"140px",xe=(fe==null?void 0:fe.y)??"140px",$e=V>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":$.throw.x,"--throw-y":$.throw.y,"--throw-rot":$.throw.rot,"--grid-x":$.grid.x,"--grid-y":$.grid.y,"--stack-x":Ce,"--stack-y":xe,"--stack-opacity":$e,"--delay":$.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},$.id)})}),X===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ee.map(($,V)=>e.jsxs("div",{className:`round-card ${V===ue?"is-active":""}`,style:{"--card-x":$.x,"--card-y":$.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},$.id)),ee[ue]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ee[ue].x,"--card-y":`calc(${ee[ue].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:te.map($=>e.jsx("span",{className:"player-dot",style:{left:$.x,top:$.y,"--jitter-x":$.jitterX,"--jitter-y":$.jitterY,"--breath-delay":$.delay}},$.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:he.map($=>e.jsx("line",{className:"round-link",x1:$.from.xNum,y1:$.from.yNum,x2:$.to.xNum,y2:$.to.yNum,style:{"--delay":$.delay}},$.id))}),e.jsx("div",{className:"round-flows",children:te.map(($,V)=>{const fe=pe[V]??"good",Ce=ee[ue];if(!Ce)return null;const xe=`calc(${Ce.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":$.x,"--from-y":$.y,"--to-x":Ce.x,"--to-y":xe,"--delay":`${V*.12}s`}}),e.jsx("span",{className:`return-dot is-${fe}`,style:{"--from-x":Ce.x,"--from-y":xe,"--to-x":$.x,"--to-y":$.y,"--delay":`${V*.12}s`}}),e.jsx("span",{className:`result-pop is-${fe}`,style:{"--at-x":$.x,"--at-y":$.y,"--delay":`${V*.12}s`}})]},`${$.id}-${ae}`)})})]},`round-${ae}`),X===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${g[0].x} ${g[0].y} L${g[1].x} ${g[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${g[1].x} ${g[1].y} L${g[2].x} ${g[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${g[2].x} ${g[2].y} L${g[3].x} ${g[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${g[3].x} ${g[3].y} L${g[4].x} ${g[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${g[4].x} ${g[4].y} L${g[5].x} ${g[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${g[5].x} ${g[5].y} L${g[6].x} ${g[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${z};${z};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${re.upper.map(($,V)=>`${V===0?"M":"L"}${$.x} ${$.y}`).join(" ")} ${re.lower.slice().reverse().map($=>`L${$.x} ${$.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${re.upper.map(($,V)=>`${V===0?"M":"L"}${$.x} ${$.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${re.lower.map(($,V)=>`${V===0?"M":"L"}${$.x} ${$.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[m.higher.slice(0,6).map(($,V)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${V+1}`,d:`M${$.x} ${$.y} L${m.higher[V+1].x} ${m.higher[V+1].y}`,pathLength:"100"},`peer-1-${V}`)),m.lower.slice(0,6).map(($,V)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${V+1}`,d:`M${$.x} ${$.y} L${m.lower[V+1].x} ${m.lower[V+1].y}`,pathLength:"100"},`peer-2-${V}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${g[0].x/300*100}%`,"--p0y":`${g[0].y/200*100}%`,"--p1x":`${g[1].x/300*100}%`,"--p1y":`${g[1].y/200*100}%`,"--p2x":`${g[2].x/300*100}%`,"--p2y":`${g[2].y/200*100}%`,"--p3x":`${g[3].x/300*100}%`,"--p3y":`${g[3].y/200*100}%`,"--p4x":`${g[4].x/300*100}%`,"--p4y":`${g[4].y/200*100}%`,"--p5x":`${g[5].x/300*100}%`,"--p5y":`${g[5].y/200*100}%`,"--p6x":`${g[6].x/300*100}%`,"--p6y":`${g[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${m.higher[0].x/300*100}%`,"--q0y":`${m.higher[0].y/200*100}%`,"--q1x":`${m.higher[1].x/300*100}%`,"--q1y":`${m.higher[1].y/200*100}%`,"--q2x":`${m.higher[2].x/300*100}%`,"--q2y":`${m.higher[2].y/200*100}%`,"--q3x":`${m.higher[3].x/300*100}%`,"--q3y":`${m.higher[3].y/200*100}%`,"--q4x":`${m.higher[4].x/300*100}%`,"--q4y":`${m.higher[4].y/200*100}%`,"--q5x":`${m.higher[5].x/300*100}%`,"--q5y":`${m.higher[5].y/200*100}%`,"--q6x":`${m.higher[6].x/300*100}%`,"--q6y":`${m.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${m.lower[0].x/300*100}%`,"--q0y":`${m.lower[0].y/200*100}%`,"--q1x":`${m.lower[1].x/300*100}%`,"--q1y":`${m.lower[1].y/200*100}%`,"--q2x":`${m.lower[2].x/300*100}%`,"--q2y":`${m.lower[2].y/200*100}%`,"--q3x":`${m.lower[3].x/300*100}%`,"--q3y":`${m.lower[3].y/200*100}%`,"--q4x":`${m.lower[4].x/300*100}%`,"--q4y":`${m.lower[4].y/200*100}%`,"--q5x":`${m.lower[5].x/300*100}%`,"--q5y":`${m.lower[5].y/200*100}%`,"--q6x":`${m.lower[6].x/300*100}%`,"--q6y":`${m.lower[6].y/200*100}%`}})]})})}),X===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),X===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},I.id)}),!n&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:c.title}),c.body&&e.jsx("p",{children:c.body}),c.micro&&e.jsx("p",{className:"cogita-intro-micro",children:c.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:k,children:c.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:E,children:"Otwórz pokaz"})]})]})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:t.map((I,X)=>e.jsx("button",{type:"button",className:`dot ${s===X?"active":""}`,"aria-label":I.title,onClick:()=>y(X)},I.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:x,children:"Pomiń"})]})]})}const Vn=6,On=4;function Un({copy:t,onAuthAction:s,authLabel:n,showProfileMenu:r,onProfileNavigate:l,onToggleSecureMode:p,onLogout:y,secureMode:x,onNavigate:E,language:k,onLanguageChange:d}){const N=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}E("home")},c=a.useRef(null),o=a.useRef([]),O=a.useMemo(()=>{let v=Date.now()%2147483647;const D=()=>(v=v*48271%2147483647,v/2147483647);return Array.from({length:Vn},(he,Q)=>{const q=6+D()*8,ye=7+D()*10,Ie=6+D()*9,be=-D()*q,Ae=-D()*ye,je=-D()*Ie,ze=.18+D()*.28,Ke=12+D()*18,ke=4+D()*8,Be=(D()-.5)*3.2,Je=(D()-.5)*3.8,He=D()>.5?"alternate":"alternate-reverse",K=D()>.5?"alternate":"alternate-reverse",H=D()>.5?"alternate":"alternate-reverse",qe=.18+D()*.42,Se=30+D()*60,le=-45-D()*38,Le=188+D()*32,_e=.1+D()*.2;return{id:`wave-${Q+1}`,style:{"--wave-sway-duration":`${q}s`,"--wave-scale-duration":`${ye}s`,"--wave-drift-duration":`${Ie}s`,"--wave-sway-delay":`${be}s`,"--wave-scale-delay":`${Ae}s`,"--wave-drift-delay":`${je}s`,"--wave-sway-dir":He,"--wave-scale-dir":K,"--wave-drift-dir":H,"--wave-scale":`${ze}`,"--wave-shift":`${Ke}%`,"--wave-xshift":`${ke}%`,"--wave-x0":`${Be}%`,"--wave-y0":`${Je}%`,"--wave-opacity":`${qe}`,"--wave-blur":`${Se}px`,"--wave-bottom":`${le}%`,"--wave-hue":`${Le}`,"--wave-glow":`${_e}`}}})},[]),de=a.useMemo(()=>{let v=Date.now()*3%2147483647;const D=()=>(v=v*48271%2147483647,v/2147483647);return Array.from({length:On},(he,Q)=>{const q=180+D()*220,ye=220+D()*280,Ie=-D()*q,be=-D()*ye,Ae=.12+D()*.22,je=3+D()*7,ze=1+D()*3,Ke=(D()-.5)*2.8,ke=(D()-.5)*2.2;return{id:`mesh-${Q+1}`,seed:1e3+Q*991+Math.floor(D()*999),style:{"--mesh-sway-duration":`${q}s`,"--mesh-drift-duration":`${ye}s`,"--mesh-sway-delay":`${Ie}s`,"--mesh-drift-delay":`${be}s`,"--mesh-scale":`${Ae}`,"--mesh-shift":`${je}%`,"--mesh-xshift":`${ze}%`,"--mesh-x0":`${ke}%`,"--mesh-y0":`${Ke}%`}}})},[]),Y=a.useMemo(()=>{const v=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],D=t.cogita.introSlides,he=new Map(D.map(Q=>[Q.id,Q]));return v.map(Q=>{var ye;const q=he.get(Q.id);return{...Q,...q,title:(q==null?void 0:q.title)??"Cogita",cta:(q==null?void 0:q.cta)??((ye=t.cogita.introSlides[0])==null?void 0:ye.cta)??t.cogita.loginCta,secondary:q==null?void 0:q.secondary}})},[t.cogita.introSlides]),[W,w]=a.useState(0),[g,re]=a.useState(!0),[z,m]=a.useState(!1),U=Y.length-1,L=a.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),G=a.useCallback(()=>{L(),s()},[L,s]),S=a.useCallback(()=>{re(!0),w(0)},[]),R=a.useCallback(()=>{re(!1),w(U)},[U]),ee=a.useCallback(v=>{w(Math.max(0,Math.min(U,v)))},[U]),te=a.useCallback(()=>{W>=U?G():ee(W+1)},[W,ee,G,U]),ae=a.useCallback(()=>{ee(W-1)},[W,ee]);a.useEffect(()=>{var he;const v=(he=window.matchMedia)==null?void 0:he.call(window,"(prefers-reduced-motion: reduce)");if(!v)return;const D=()=>m(v.matches);return D(),v.addEventListener?(v.addEventListener("change",D),()=>v.removeEventListener("change",D)):(v.addListener(D),()=>v.removeListener(D))},[]),a.useEffect(()=>{if(!g)return;const v=D=>{const he=D.target;if(!he)return;const Q=he.tagName;if(!(he.isContentEditable||Q==="INPUT"||Q==="TEXTAREA"||Q==="SELECT"||Q==="BUTTON"||Q==="A"||he.closest('button, a, [role="button"], [role="link"]'))){if(D.key==="Escape"){R();return}if(D.key==="ArrowLeft"||D.key==="ArrowUp"){ae();return}(D.key==="ArrowRight"||D.key==="ArrowDown"||D.code==="Space"||D.key===" ")&&(D.preventDefault(),te())}};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[R,te,ae,g]),a.useEffect(()=>{g&&W===U&&L()},[W,g,U,L]),a.useEffect(()=>{const v=c.current;if(!v)return;const D=o.current.filter(le=>!!le);if(!D.length)return;const he=1,Q=.6,q=.6,ye=Math.max(1,Math.min(he,window.devicePixelRatio||1));let Ie=0,be=0,Ae=Q,je=0,ze=0;const Ke=le=>{let Le=le%2147483647;return Le<=0&&(Le+=2147483646),(_e,B)=>{Le=Le*48271%2147483647;const ge=Le/2147483647;return _e+ge*(B-_e)}},ke={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},Be=le=>{const Le=Math.sin(le*12.9898)*43758.5453;return Le-Math.floor(Le)},Je=le=>{const Le=Be(le+.1)||1e-4,_e=Be(le+.7)||1e-4;return Math.sqrt(-2*Math.log(Le))*Math.cos(2*Math.PI*_e)},He=(le,Le)=>{const _e=Math.floor(le),B=_e+1,ge=le-_e,I=ge*ge*(3-2*ge),X=Be(_e*12.9898+Le*78.233),we=Be(B*12.9898+Le*78.233);return X+(we-X)*I},K=le=>{const Le=Ke(le),_e=Math.min(4,Math.max(4,Math.floor(Ie/1200*ke.filamentCount)));return Array.from({length:_e},(B,ge)=>{const I=Math.max(-1,Math.min(1,Je(le+ge*.37))),X=Math.min(1,Math.max(0,Be(le+ge*1.31))),we=Math.min(ke.depthLayers-1,Math.floor(X*ke.depthLayers));return{seed:Le(0,Math.PI*2)+le*.01,offset:I,freqA:ke.freq1*(.75+Le(0,.5)),freqB:ke.freq2*(.75+Le(0,.5)),ampA:ke.amp1*(.6+Le(0,.7)),ampB:ke.amp2*(.6+Le(0,.7)),width:2+ge%5*.32,depth:X,layer:we}})},H=(le,Le,_e)=>{const B=Math.max(30,Math.floor(Ie*be/14e4));le.save(),le.globalAlpha=.6;for(let ge=0;ge<B;ge+=1){const I=Be(ge*9.1+Ie*.11)*Le+_e,X=Be(ge*3.7+be*.23)*be,we=1.2+Be(ge*5.9)*2.4,$=le.createRadialGradient(I,X,0,I,X,we*2);$.addColorStop(0,"rgba(10, 30, 60, 0.45)"),$.addColorStop(1,"rgba(10, 30, 60, 0)"),le.fillStyle=$,le.beginPath(),le.arc(I,X,we*2,0,Math.PI*2),le.fill()}le.restore()},qe=(le,Le)=>{le.clearRect(0,0,Ie,be);const _e=be*ke.waveCenter,B=ke.waveBandPx,ge=ke.segments,I=ke.colors.filaments,X=je||Ie,we=0;H(le,X,we),le.strokeStyle=I,le.lineCap="round",le.lineJoin="round";for(let $=0;$<Le.length;$+=1){const V=Le[$],fe=V.offset*B*(.85+Be(V.seed)*.4),Ce=1-Math.min(1,Math.abs(fe)/B),xe=Math.exp(-Math.pow(fe/ke.crestThickness,2)),$e=V.layer===0?1.1:V.layer===1?.85:.6,Ue=.35+(1-V.depth)*.65,We=Ce*Ue*$e*(.34+xe*.45);le.globalAlpha=We,le.lineWidth=V.width*(1+(1-V.depth)*.8);const Re=[];for(let Ne=0;Ne<=ge;Ne+=1){const st=Ne/ge*X+we,Qe=(He(st*.012,V.seed)-.5)*ke.xJitter,Ge=st+Qe,mt=(He(Ge*V.freqA,V.seed)-.5)*ke.jitterA,jt=(He(Ge*V.freqB,V.seed*1.7)-.5)*ke.jitterB,Ye=_e+Math.sin(Ge*V.freqA+V.seed)*V.ampA+Math.sin(Ge*V.freqB+V.seed*1.3)*V.ampB+fe+mt+jt;Re.push({x:Ge,y:Ye})}le.beginPath(),le.moveTo(Re[0].x,Re[0].y);for(let Ne=1;Ne<Re.length-1;Ne+=1){const st=(Re[Ne].x+Re[Ne+1].x)/2,Qe=(Re[Ne].y+Re[Ne+1].y)/2;le.quadraticCurveTo(Re[Ne].x,Re[Ne].y,st,Qe)}const Ee=Re[Re.length-1];le.quadraticCurveTo(Ee.x,Ee.y,Ee.x,Ee.y),le.stroke()}le.save(),le.globalCompositeOperation="lighter",le.strokeStyle=ke.colors.glow,le.lineCap="round",le.lineJoin="round";for(let $=0;$<Le.length;$+=1){const V=Le[$];if(Math.abs(V.offset)*B>ke.crestThickness)continue;const fe=ke.glowAlpha*(.7+(1-V.depth)*.6);le.globalAlpha=fe,le.lineWidth=1.6+(1-V.depth)*1.2;const Ce=[];for(let $e=0;$e<=ge;$e+=1){const Ue=$e/ge*X+we,We=Math.sin(Ue*.02+V.seed)*3,Re=_e+Math.sin(Ue*V.freqA+V.seed)*V.ampA+Math.sin(Ue*V.freqB+V.seed*1.3)*V.ampB+V.offset*B*.35+We;Ce.push({x:Ue,y:Re})}le.beginPath(),le.moveTo(Ce[0].x,Ce[0].y);for(let $e=1;$e<Ce.length-1;$e+=1){const Ue=(Ce[$e].x+Ce[$e+1].x)/2,We=(Ce[$e].y+Ce[$e+1].y)/2;le.quadraticCurveTo(Ce[$e].x,Ce[$e].y,Ue,We)}const xe=Ce[Ce.length-1];le.quadraticCurveTo(xe.x,xe.y,xe.x,xe.y),le.stroke()}le.restore()},Se=()=>{Ie=Math.floor(v.clientWidth),be=Math.floor(v.clientHeight),je=Math.floor(Ie*1.8),ze=be,Ae=Ie<820?q:Q,D.forEach(le=>{const Le=le.getContext("2d");if(!Le)return;le.width=Math.floor(je*ye*Ae),le.height=Math.floor(ze*ye*Ae),le.style.width=`${je}px`,le.style.height=`${ze}px`,le.style.left=`${-(je-Ie)/2}px`,Le.setTransform(ye*Ae,0,0,ye*Ae,0,0);const _e=Number(le.dataset.seed||1),B=K(_e);qe(Le,B)})};return Se(),window.addEventListener("resize",Se,{passive:!0}),()=>window.removeEventListener("resize",Se)},[de]);const Pe=Y[Math.min(W,Y.length-1)],ue=g?Pe:Y[Y.length-1],C=(ue==null?void 0:ue.theme)??Y[0].theme,pe={"--cogita-bg0":C.bg0,"--cogita-bg1":C.bg1,"--cogita-bg2":C.bg2,"--cogita-bloom":C.bloom,"--cogita-sat":C.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:N,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Ks,{value:k,onChange:d}),e.jsx(Bs,{copy:t,label:n,isAuthenticated:r,secureMode:x,onLogin:s,onProfileNavigate:l,onToggleSecureMode:p,onLogout:y,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:c,className:"cogita-section cogita-home",style:pe,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[de.map((v,D)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:v.style,"data-seed":v.seed,ref:he=>{o.current[D]=he}},v.id)),O.map(v=>e.jsx("div",{className:"cogita-home-wave",style:v.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},v.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(qn,{slides:Y,activeIndex:W,introOpen:g,prefersReducedMotion:z,onNext:te,onPrev:ae,onSelect:ee,onExit:R,onOpen:S,onRegister:G})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const Oi=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Un},Symbol.toStringTag,{value:"Module"})),Ws=a.createContext(!1);function Tt({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:d}){if(a.useContext(Ws))return e.jsx(e.Fragment,{children:d});const c=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}x("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:c,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Ks,{value:E,onChange:k}),e.jsx(Bs,{copy:t,label:s,isAuthenticated:n,secureMode:y,onLogin:()=>x("home"),onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:d}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}function Vt(t){const[s,n]=a.useState("Cogita library"),[r,l]=a.useState(null);return a.useEffect(()=>{let p=!1;return _s().then(y=>{if(p)return;const x=y.find(E=>E.libraryId===t);x&&n(x.name)}).catch(()=>{p||n("Cogita library")}),()=>{p=!0}},[t]),a.useEffect(()=>{let p=!1;return cn(t).then(y=>{p||l(y)}).catch(()=>{p||l(null)}),()=>{p=!0}},[t]),{libraryName:s,stats:r}}function vs({slices:t}){const s=t.reduce((r,l)=>r+Math.max(0,l.value),0),n=a.useMemo(()=>{if(s<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let r=0;return`conic-gradient(${t.map(p=>{const x=Math.max(0,p.value)/s*360,E=r,k=r+x;return r=k,`${p.color} ${E}deg ${k}deg`}).join(",")})`},[t,s]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:n}}),e.jsx("div",{className:"cogita-overview-legend",children:t.map(r=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:r.color}}),e.jsx("strong",{children:r.value}),e.jsx("small",{children:r.label})]},r.label))})]})}function Wn({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d}){const{libraryName:N,stats:c}=Vt(d),[o,O]=a.useState("infos"),[de,Y]=a.useState(0),[W,w]=a.useState(0),[g,re]=a.useState(0),z=(c==null?void 0:c.totalInfos)??0,m=(c==null?void 0:c.totalCollections)??0,U=0,L=0,G=0,S=Math.max(0,z-G-W),R=Math.max(0,z-W-g);a.useEffect(()=>{let te=!1;return(async()=>{try{const Pe=await va({libraryId:d,limit:200}),ue=await Promise.all(Pe.items.map(C=>Ds({libraryId:d,collectionId:C.collectionId}).catch(()=>[])));if(te)return;Y(ue.reduce((C,pe)=>C+pe.length,0))}catch{te||Y(0)}})(),()=>{te=!0}},[d]),a.useEffect(()=>{let te=!1;return(async()=>{try{const[Pe,ue,C]=await Promise.all([fs({libraryId:d,type:"computed",limit:1}).catch(()=>({total:0})),fs({libraryId:d,type:"source",limit:1}).catch(()=>({total:0})),qs({libraryId:d}).catch(()=>({items:[]}))]);if(te)return;w((Pe.total??0)+(ue.total??0));const pe=new Set(C.items.filter(v=>v.childItemType.toLowerCase()==="info").map(v=>v.childItemId).filter(Boolean));re(pe.size)}catch{te||(w(0),re(0))}})(),()=>{te=!0}},[d]);const ee=[{key:"infos",label:t.cogita.library.overview.stats.totalInfos,value:z},{key:"collections",label:t.cogita.library.overview.stats.collections,value:m},{key:"revisions",label:t.cogita.library.overview.stats.revisions,value:de},{key:"storyboards",label:t.cogita.library.overview.stats.storyboards,value:U},{key:"texts",label:t.cogita.library.overview.stats.texts,value:L}];return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:N})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ee.map(te=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${o===te.key?"active":""}`,onClick:()=>O(te.key),children:[e.jsx("span",{children:te.label}),e.jsx("strong",{children:te.value})]},te.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:t.cogita.library.overview.statsCardTitle})}),o==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.knownChartTitle}),e.jsx(vs,{slices:[{label:t.cogita.library.overview.known,value:G,color:"#75d79a"},{label:t.cogita.library.overview.unknown,value:S,color:"#85b9ff"},{label:t.cogita.library.overview.excluded,value:W,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.checksChartTitle}),e.jsx(vs,{slices:[{label:t.cogita.library.overview.availableChecks,value:g,color:"#75d79a"},{label:t.cogita.library.overview.unavailableChecks,value:R,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:t.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]})]})})]})})}const Oe=(t,s)=>{const n=t.cogita.library.infoTypes,r=t.cogita.library.connectionTypes,l=t.cogita.library.groupTypes;return{any:n.any,vocab:n.vocab,book:l.book,citation:l.citation,language:n.language,word:n.word,sentence:n.sentence,topic:n.topic,collection:n.collection,person:n.person,institution:n.institution,collective:n.collective,orcid:n.orcid,address:n.address,email:n.email,phone:n.phone,media:n.media,work:n.work,geo:n.geo,music_piece:n.musicPiece,music_fragment:n.musicFragment,source:n.source,quote:n.quote,computed:n.computed,"word-language":r.wordLanguage,"quote-language":r.quoteLanguage,"language-sentence":r.languageSentence,translation:r.translation,"word-topic":r.wordTopic,reference:r.reference,"source-resource":r.sourceResource,"work-contributor":r.workContributor,"work-medium":r.workMedium,"orcid-link":r.orcidLink}[s]??String(s)},Qn=t=>[{value:"any",label:Oe(t,"any")},{value:"language",label:Oe(t,"language")},{value:"word",label:Oe(t,"word")},{value:"sentence",label:Oe(t,"sentence")},{value:"topic",label:Oe(t,"topic")},{value:"collection",label:Oe(t,"collection")},{value:"person",label:Oe(t,"person")},{value:"institution",label:Oe(t,"institution")},{value:"collective",label:Oe(t,"collective")},{value:"orcid",label:Oe(t,"orcid")},{value:"address",label:Oe(t,"address")},{value:"email",label:Oe(t,"email")},{value:"phone",label:Oe(t,"phone")},{value:"media",label:Oe(t,"media")},{value:"work",label:Oe(t,"work")},{value:"geo",label:Oe(t,"geo")},{value:"music_piece",label:Oe(t,"music_piece")},{value:"music_fragment",label:Oe(t,"music_fragment")},{value:"source",label:Oe(t,"source")},{value:"quote",label:Oe(t,"quote")},{value:"citation",label:Oe(t,"citation")},{value:"computed",label:Oe(t,"computed")},{value:"vocab",label:Oe(t,"vocab")},{value:"book",label:Oe(t,"book")},{value:"word-language",label:Oe(t,"word-language")},{value:"quote-language",label:Oe(t,"quote-language")},{value:"language-sentence",label:Oe(t,"language-sentence")},{value:"translation",label:Oe(t,"translation")},{value:"word-topic",label:Oe(t,"word-topic")},{value:"reference",label:Oe(t,"reference")},{value:"source-resource",label:Oe(t,"source-resource")},{value:"work-contributor",label:Oe(t,"work-contributor")},{value:"work-medium",label:Oe(t,"work-medium")},{value:"orcid-link",label:Oe(t,"orcid-link")}],Hn=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}],Ga={key:"languageId",labelKey:"language",kind:"select",path:"languageId",optionsSource:"languages",matcher:"equals"},Yn={language:{infoType:"language",entityKind:"single",structure:{payloadFields:["label","name","code","notes"]},filterFields:[]},word:{infoType:"word",entityKind:"single",structure:{payloadFields:["label","lemma","notes","languageId"],connections:[{relationType:"word-language",role:"language",targetType:"language"}]},filterFields:[Ga]},sentence:{infoType:"sentence",entityKind:"single",structure:{payloadFields:["label","text","notes","languageId"],connections:[{relationType:"language-sentence",role:"language",targetType:"language"}]},filterFields:[Ga]},topic:{infoType:"topic",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},collection:{infoType:"collection",entityKind:"complex",structure:{payloadFields:["label","name","notes"]},filterFields:[]},person:{infoType:"person",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},institution:{infoType:"institution",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},collective:{infoType:"collective",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},orcid:{infoType:"orcid",entityKind:"single",structure:{payloadFields:["label","orcid","notes"]},filterFields:[{key:"orcid",label:"ORCID",kind:"text",path:"orcid",matcher:"contains"}]},address:{infoType:"address",entityKind:"single",structure:{payloadFields:["label","street","city","postalCode","country","notes"]},filterFields:[]},email:{infoType:"email",entityKind:"single",structure:{payloadFields:["label","email","address","notes"]},filterFields:[]},phone:{infoType:"phone",entityKind:"single",structure:{payloadFields:["label","phone","number","notes"]},filterFields:[]},media:{infoType:"media",entityKind:"single",structure:{payloadFields:["label","name","url","kind","notes"]},filterFields:[]},work:{infoType:"work",entityKind:"single",structure:{payloadFields:["label","title","subtitle","doi","isbn","issn","languageId","originalLanguageId","notes"]},filterFields:[Ga,{key:"originalLanguageId",labelKey:"originalLanguage",kind:"select",path:"originalLanguageId",optionsSource:"languages",matcher:"equals"},{key:"doi",labelKey:"doi",kind:"text",path:"doi",matcher:"contains"}]},geo:{infoType:"geo",entityKind:"single",structure:{payloadFields:["label","name","country","region","city","notes"]},filterFields:[]},music_piece:{infoType:"music_piece",entityKind:"single",structure:{payloadFields:["label","title","composer","notes"]},filterFields:[]},music_fragment:{infoType:"music_fragment",entityKind:"single",structure:{payloadFields:["label","title","text","notes"]},filterFields:[]},source:{infoType:"source",entityKind:"single",structure:{payloadFields:["label","title","sourceKind","locator","notes"],connections:[{relationType:"source-resource",role:"resource",targetType:"work"}]},filterFields:[{key:"sourceKind",labelKey:"sourceKind",kind:"select",path:"sourceKind",optionsSource:"sourceKinds",matcher:"equals"},{key:"locator",labelKey:"locator",kind:"text",path:"locator",matcher:"locator_contains"}]},quote:{infoType:"quote",entityKind:"single",structure:{payloadFields:["title","text","notes"],connections:[{relationType:"quote-language",role:"language",targetType:"language"},{relationType:"reference",role:"source",targetType:"source"}]},filterFields:[{key:"text",labelKey:"quote",kind:"text",path:"text",matcher:"contains"}]},computed:{infoType:"computed",entityKind:"complex",structure:{payloadFields:["label","title","definition","notes"]},filterFields:[]},translation:{infoType:"translation",entityKind:"connection",structure:{payloadFields:["note","tagIds"],connections:[{relationType:"translation",role:"wordA",targetType:"word"},{relationType:"translation",role:"wordB",targetType:"word"},{relationType:"word-language",role:"languageA",targetType:"language"},{relationType:"word-language",role:"languageB",targetType:"language"}]},filterFields:[{key:"languageAId",labelKey:"languageA",kind:"select",optionsSource:"languages",matcher:"equals"},{key:"languageBId",labelKey:"languageB",kind:"select",optionsSource:"languages",matcher:"equals"}]}},ws={infoType:"default",entityKind:"single",structure:{payloadFields:["label","notes"]},filterFields:[]};function Gn(t){return t?Yn[t]??ws:ws}function Xn(t,s){return t.optionsSource==="languages"?s.languages.map(n=>({value:n.infoId,label:n.label})):t.optionsSource==="sourceKinds"?Hn:[]}const Xa=60,Jn=500;function Qs(t){return`cogita.info-selection:${t}`}function js(t){if(typeof window>"u")return{};const s=window.localStorage.getItem(Qs(t));if(!s)return{};try{const n=JSON.parse(s);return!n||typeof n!="object"?{}:n}catch{return{}}}function Zn({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d,mode:N}){var _e;const c=$s(),o=t.cogita.library.list,[O,de]=a.useState("any"),[Y,W]=a.useState(""),[w,g]=a.useState("relevance"),[re,z]=a.useState("details"),[m,U]=a.useState(!1),[L,G]=a.useState("idle"),[S,R]=a.useState([]),[ee,te]=a.useState(Xa),[ae,Pe]=a.useState(null),[ue,C]=a.useState(()=>js(d)),[pe,v]=a.useState({}),[D,he]=a.useState([]),Q=a.useMemo(()=>Qn(t),[t]),q=a.useMemo(()=>[{value:"relevance",label:o.sortRelevance},{value:"label_asc",label:o.sortLabelAsc},{value:"label_desc",label:o.sortLabelDesc},{value:"type_asc",label:o.sortTypeAsc},{value:"type_desc",label:o.sortTypeDesc}],[o.sortLabelAsc,o.sortLabelDesc,o.sortRelevance,o.sortTypeAsc,o.sortTypeDesc]);a.useEffect(()=>{C(js(d)),v({}),U(!1)},[d]),a.useEffect(()=>{bs({libraryId:d,type:"language",filters:{sourceKind:"info"},limit:200}).then(B=>{const ge=B.map(I=>({infoId:I.infoId??"",infoType:I.entityType,label:I.title})).filter(I=>I.infoId.length>0);he(ge)}).catch(()=>he([]))},[d]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Qs(d),JSON.stringify(ue))},[d,ue]);const ye=a.useMemo(()=>Gn(O==="any"?null:O),[O]),Ie=a.useMemo(()=>({language:o.typeFilterLanguage,languageA:o.typeFilterLanguageA,languageB:o.typeFilterLanguageB,originalLanguage:o.typeFilterOriginalLanguage,doi:o.typeFilterDoi,sourceKind:o.typeFilterSourceKind,locator:o.typeFilterLocator,quote:o.typeFilterQuote}),[o.typeFilterDoi,o.typeFilterLanguage,o.typeFilterLanguageA,o.typeFilterLanguageB,o.typeFilterLocator,o.typeFilterOriginalLanguage,o.typeFilterQuote,o.typeFilterSourceKind]),be=a.useMemo(()=>ye.filterFields.map(B=>({...B,label:B.labelKey?Ie[B.labelKey]:B.label??B.key,options:Xn(B,{languages:D})})),[Ie,D,ye.filterFields]),Ae=a.useMemo(()=>be.some(B=>(pe[B.key]??"").trim().length>0),[be,pe]);a.useEffect(()=>{v({})},[O]),a.useEffect(()=>{const B={sourceKind:"info"};if(Ae)for(const I of be){const X=(pe[I.key]??"").trim();X&&(B[I.path??I.key]=X)}G("loading");const ge=window.setTimeout(()=>{bs({libraryId:d,type:O==="any"?void 0:O,query:Y.trim()||void 0,filters:B,limit:Jn}).then(I=>{const X=I.map(we=>({infoId:we.infoId??"",infoType:we.entityType,label:we.title})).filter(we=>we.infoId.length>0);R(X),G("ready")}).catch(()=>{R([]),G("ready")})},240);return()=>window.clearTimeout(ge)},[Ae,d,Y,O,be,pe]);const je=a.useMemo(()=>{const B=S.slice(),ge=I=>Oe(t,I);return w==="relevance"?B:w==="label_asc"?B.sort((I,X)=>I.label.localeCompare(X.label)):w==="label_desc"?B.sort((I,X)=>X.label.localeCompare(I.label)):w==="type_asc"?B.sort((I,X)=>I.infoType===X.infoType?I.label.localeCompare(X.label):ge(I.infoType).localeCompare(ge(X.infoType))):B.sort((I,X)=>I.infoType===X.infoType?I.label.localeCompare(X.label):ge(X.infoType).localeCompare(ge(I.infoType)))},[t,S,w]),ze=a.useMemo(()=>je.slice(0,ee),[je,ee]),Ke=ze.length<je.length,ke=a.useMemo(()=>new Set(Object.keys(ue)),[ue]),Be=a.useMemo(()=>Object.values(ue),[ue]),Je=a.useMemo(()=>{const B=new Map;for(const ge of Be)B.set(ge.infoType,(B.get(ge.infoType)??0)+1);return Array.from(B.entries()).sort((ge,I)=>I[1]-ge[1]||ge[0].localeCompare(I[0]))},[Be]);a.useEffect(()=>{te(Xa);const B=new Set(S.map(ge=>ge.infoId));Pe(ge=>ge&&B.has(ge)?ge:null)},[S]);const He=B=>{C(ge=>({...ge,[B.infoId]:{infoId:B.infoId,infoType:B.infoType,label:B.label}}))},K=B=>{C(ge=>{if(!ge[B])return ge;const I={...ge};return delete I[B],I})},H=(B,ge)=>{if(ge){He(B);return}K(B.infoId)},qe=B=>{c(`/cogita/library/${d}/list?infoId=${encodeURIComponent(B)}&infoView=overview`,{replace:!0})},Se=Be.length===1?((_e=Be[0])==null?void 0:_e.infoId)??null:null,le=o.selectionCount.replace("{count}",String(Be.length)),Le=N==="collection"?"grid":N==="detail"?"wide":re;return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":Le,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-search-surface",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":o.typeLabel,value:O,onChange:B=>de(B.target.value),children:Q.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))}),e.jsx("input",{type:"text",value:Y,onChange:B=>W(B.target.value),placeholder:o.searchPlaceholder}),e.jsx("select",{"aria-label":o.sortLabel,value:w,onChange:B=>g(B.target.value),children:q.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))}),e.jsxs("select",{"aria-label":o.viewLabel,value:re,onChange:B=>z(B.target.value),children:[e.jsx("option",{value:"details",children:o.viewDetails}),e.jsx("option",{value:"wide",children:o.viewWide}),e.jsx("option",{value:"grid",children:o.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:o.cardCount.replace("{shown}",String(ze.length)).replace("{total}",String(je.length))}),e.jsx("span",{children:L==="loading"?o.loading:o.ready})]}),e.jsxs("div",{className:"cogita-filters-toggle-row",children:[e.jsx("button",{type:"button",className:"ghost cogita-filters-toggle",onClick:()=>U(B=>!B),children:m?o.hideFilters:o.showFilters}),e.jsx("span",{className:"cogita-sidebar-note",children:o.filtersOptionalHint})]}),m&&be.length>0?e.jsx("section",{className:"cogita-library-filters cogita-library-filters--compact",children:e.jsx("div",{className:"cogita-filter-grid",children:be.map(B=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:B.label}),B.kind==="select"?e.jsxs("select",{value:pe[B.key]??"",onChange:ge=>v(I=>({...I,[B.key]:ge.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),(B.options??[]).map(ge=>e.jsx("option",{value:ge.value,children:ge.label},`${B.key}:${ge.value}`))]}):e.jsx("input",{type:"text",value:pe[B.key]??"",onChange:ge=>v(I=>({...I,[B.key]:ge.target.value}))})]},`type-filter:${B.key}`))})}):null,e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:le}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{C(B=>{const ge={...B};for(const I of ze)ge[I.infoId]={infoId:I.infoId,infoType:I.infoType,label:I.label};return ge})},disabled:ze.length===0,children:o.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>C({}),disabled:Be.length===0,children:o.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Se&&qe(Se),disabled:!Se,title:Se?void 0:o.openSelectedDisabled,children:o.openSelected})]})]}),Be.length>0?e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:o.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:o.selectedStackHint}),e.jsx("div",{className:"cogita-selection-overview",children:Je.map(([B,ge])=>e.jsxs("span",{className:"cogita-tag-chip",children:[e.jsx("span",{children:Oe(t,B)}),e.jsx("span",{className:"cogita-tag-count",children:ge})]},`stack:type:${B}`))})]}):null,Le==="details"?e.jsxs("div",{className:"cogita-details-grid",role:"table","aria-label":o.searchTitle,children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:o.detailColumnName}),e.jsx("span",{children:o.detailColumnType}),e.jsx("span",{children:o.detailColumnId}),e.jsx("span",{})]}),ze.length?ze.map(B=>{const ge=Oe(t,B.infoType),I=ke.has(B.infoId),X=ae===B.infoId;return e.jsxs("div",{className:`cogita-details-row ${X||I?"active":""}`,role:"row",onClick:()=>Pe(B.infoId),children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:we=>H(B,we.target.checked),onClick:we=>we.stopPropagation()}),e.jsx("span",{})]}),e.jsx("span",{title:B.label,children:B.label}),e.jsx("span",{title:ge,children:ge}),e.jsx("span",{title:B.infoId,children:B.infoId}),e.jsx("button",{type:"button",className:"ghost cogita-details-open",onClick:we=>{we.stopPropagation(),qe(B.infoId)},"aria-label":o.editInfo,children:">"})]},B.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:o.noMatch})})]}):e.jsx("div",{className:`cogita-card-list cogita-card-list--${Le}`,"data-view":Le,children:ze.length?ze.map(B=>{const ge=Oe(t,B.infoType),I=ke.has(B.infoId),X=ae===B.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":X||I,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:we=>H(B,we.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>Pe(B.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:ge}),e.jsx("h3",{className:"cogita-card-title",children:B.label}),e.jsx("p",{className:"cogita-card-subtitle",children:B.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>qe(B.infoId),children:o.editInfo})]})},B.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:o.noMatch})})}),Ke?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>te(B=>B+Xa),children:o.loadMore})}):null]})})})})})}const aa=5,ks=50,Ns=2,Ts=[];function sa({libraryId:t,infoType:s,label:n,placeholder:r,value:l,onChange:p,values:y,onChangeMultiple:x,helperText:E,searchFailedText:k,createFailedText:d,createLabel:N,savingLabel:c,loadMoreLabel:o,inputRef:O,autoAdvance:de,onCommit:Y,multiple:W}){const w=W?y??Ts:Ts,[g,re]=a.useState(W?"":(l==null?void 0:l.label)??""),[z,m]=a.useState([]),[U,L]=a.useState(aa),[G,S]=a.useState(-1),[R,ee]=a.useState(!1),[te,ae]=a.useState(!1),[Pe,ue]=a.useState(null),C=a.useRef(0),pe=a.useRef(new Map),v=a.useMemo(()=>W?g.trim().length>0:g.trim().length>0&&!l,[g,l,W]);a.useEffect(()=>{W||re((l==null?void 0:l.label)??"")},[l,W]),a.useEffect(()=>{const Q=g.trim();if(!Q||Q.length<Ns){m([]),ee(!1),L(aa),S(-1),ae(!1),ue(null);return}const q=Q.toLowerCase(),ye=`${t}:${s}:${q}`,Ie=pe.current.get(ye);if(Ie){if(W&&w.length>0){const Ae=new Set(w.map(je=>je.id));m(Ie.filter(je=>!Ae.has(je.id)))}else m(Ie);L(aa),S(-1),ee(Ie.length>0),ae(!1),ue(null);return}const be=window.setTimeout(async()=>{const Ae=Date.now();C.current=Ae,ae(!0),ue(null);try{const je=await us({libraryId:t,type:s,query:Q,limit:ks});if(C.current!==Ae)return;const ze=je.slice(0,ks).map(Ke=>({id:Ke.infoId,label:Ke.label,infoType:Ke.infoType}));if(pe.current.set(ye,ze),W&&w.length>0){const Ke=new Set(w.map(ke=>ke.id));m(ze.filter(ke=>!Ke.has(ke.id)))}else m(ze);L(aa),S(-1),ee(!0)}catch{if(C.current!==Ae)return;ue(k??"Search failed.")}finally{C.current===Ae&&ae(!1)}},250);return()=>window.clearTimeout(be)},[t,s,g,w]);const D=Q=>{if(W){const q=w.some(ye=>ye.id===Q.id)?w:[...w,Q];x==null||x(q),re(""),ee(!1),S(-1);return}p==null||p(Q),re(Q.label),ee(!1),S(-1),de&&(Y==null||Y())},he=async()=>{const Q=g.trim();if(Q){ae(!0),ue(null);try{const q=await Vs({libraryId:t,infoType:s,payload:{label:Q}}),ye={id:q.infoId,label:Q,infoType:q.infoType};if(Q.length>=Ns){const Ie=`${t}:${s}:${Q.toLowerCase()}`,be=pe.current.get(Ie)??[];pe.current.set(Ie,[ye,...be])}if(W){x==null||x([...w,ye]),re(""),ee(!1),S(-1);return}p==null||p(ye),ee(!1),S(-1),de&&(Y==null||Y())}catch{ue(d??"Create failed.")}finally{ae(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:n}),e.jsx("input",{value:g,placeholder:r,onChange:Q=>{re(Q.target.value),!W&&l&&(p==null||p(null))},onKeyDown:Q=>{if(Q.key==="ArrowDown"){if(Q.preventDefault(),!z.length)return;ee(!0),S(q=>{const ye=Math.min(z.length,U)-1,Ie=q<0?0:Math.min(q+1,ye);return Ie===ye&&z.length>U?(L(be=>Math.min(be+aa,z.length)),Math.min(q+1,Math.min(z.length,U+aa)-1)):Ie});return}if(Q.key==="ArrowUp"){if(Q.preventDefault(),!z.length)return;ee(!0),S(q=>q<=0?0:q-1);return}if(Q.key==="Enter"){if(Q.preventDefault(),G>=0&&z[G]){D(z[G]);return}if(v){he();return}}},onFocus:()=>{z.length>0&&ee(!0)},autoComplete:"off",ref:O})]}),W&&w.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:w.map(Q=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>x==null?void 0:x(w.filter(q=>q.id!==Q.id)),children:[Q.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},Q.id))}),E&&e.jsx("p",{className:"cogita-help",children:E}),Pe&&e.jsx("p",{className:"cogita-error",children:Pe}),R&&z.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[z.slice(0,U).map((Q,q)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":q===G,onClick:()=>D(Q),children:[e.jsx("strong",{children:Q.label}),e.jsx("span",{children:Q.infoType})]},Q.id)),U<z.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>L(Q=>Math.min(Q+aa,z.length)),children:o??"Load more"})]}),v&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:he,disabled:te,children:te?c??"Saving...":N??`Create new ${s}`})]})}function ei(t){return t==null?"":typeof t=="string"?t:JSON.stringify(t)}function Ss(t,s){if(!t||typeof t!="object")return s;const n=t,r=[n.label,n.name,n.title,n.text,n.orcid,n.email,n.number];for(const l of r)if(typeof l=="string"&&l.trim())return l.trim();return s}function ti({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d,editInfoId:N}){const{libraryName:c}=Vt(d),o=!!N,[O,de]=a.useState([]),[Y,W]=a.useState("word"),[w,g]=a.useState({}),[re,z]=a.useState({}),[m,U]=a.useState({}),[L,G]=a.useState({}),[S,R]=a.useState(null),[ee,te]=a.useState("idle"),ae=a.useMemo(()=>O.find(v=>v.infoType===Y),[Y,O]),Pe=a.useMemo(()=>O.map(v=>({value:v.infoType,label:Oe(t,v.infoType)})),[t,O]);a.useEffect(()=>{let v=!1;return dn({libraryId:d}).then(D=>{var he;if(!v&&(de(D),!o)){const Q=(he=D[0])==null?void 0:he.infoType;Q&&W(Q)}}).catch(()=>{v||de([])}),()=>{v=!0}},[o,d]),a.useEffect(()=>{if(!ae)return;const v={},D={},he={},Q={};for(const q of ae.payloadFields)v[q.key]="";for(const q of ae.linkFields)q.multiple?he[q.key]=[]:D[q.key]=null,q.targetTypes.length>0&&(Q[q.key]=q.targetTypes[0]);g(v),z(D),U(he),G(Q)},[ae==null?void 0:ae.infoType]),a.useEffect(()=>{if(!o||!N||O.length===0)return;let v=!1;return te("loading"),R(null),(async()=>{const he=await ua({libraryId:d,infoId:N});if(v)return;const Q=he.infoType;W(Q);const q=O.find(ke=>ke.infoType===Q);if(!q){te("idle");return}const ye=he.payload??{},Ie={};for(const ke of q.payloadFields)Ie[ke.key]=ei(ye[ke.key]);g(Ie);const be=he.links??{}??{},Ae={},je={},ze={},Ke=[];for(const ke of q.linkFields){ke.targetTypes.length>0&&(ze[ke.key]=ke.targetTypes[0]);const Be=be[ke.key];if(ke.multiple){const Je=Array.isArray(Be)?Be.filter(He=>typeof He=="string"):[];je[ke.key]=[];for(const He of Je)Ke.push(ua({libraryId:d,infoId:He}).then(K=>{if(v)return;const H={id:He,infoType:K.infoType,label:Ss(K.payload,He)};je[ke.key]=[...je[ke.key],H]}).catch(()=>{}))}else{const Je=typeof Be=="string"?Be:null;Ae[ke.key]=null,Je&&Ke.push(ua({libraryId:d,infoId:Je}).then(He=>{v||(Ae[ke.key]={id:Je,infoType:He.infoType,label:Ss(He.payload,Je)})}).catch(()=>{}))}}await Promise.all(Ke),!v&&(z(Ae),U(je),G(ke=>({...ke,...ze})),te("idle"))})().catch(()=>{v||(R("Failed to load info details."),te("idle"))}),()=>{v=!0}},[N,o,d,O]);const ue=async()=>{var Q;if(!ae)return;const v={};for(const q of ae.payloadFields){const ye=(w[q.key]??"").trim();if(!ye){if(q.required){R(`Field '${q.label}' is required.`);return}continue}if(q.inputType==="json")try{v[q.key]=JSON.parse(ye)}catch{R(`Field '${q.label}' must be valid JSON.`);return}else v[q.key]=ye}const D={};for(const q of ae.linkFields)if(q.multiple){const ye=(m[q.key]??[]).map(Ie=>Ie.id);if(q.required&&ye.length===0){R(`Link '${q.label}' is required.`);return}ye.length>0&&(D[q.key]=ye)}else{const ye=((Q=re[q.key])==null?void 0:Q.id)??null;if(q.required&&!ye){R(`Link '${q.label}' is required.`);return}ye&&(D[q.key]=ye)}const he=Object.keys(D).length>0;te("saving"),R(null);try{if(o&&N)await un({libraryId:d,infoId:N,payload:v,links:he?D:void 0}),R("Info updated.");else{await Vs({libraryId:d,infoType:Y,payload:v,links:he?D:void 0}),R("Info saved.");const q={};for(const be of ae.payloadFields)q[be.key]="";g(q);const ye={},Ie={};for(const be of ae.linkFields)be.multiple?Ie[be.key]=[]:ye[be.key]=null;z(be=>({...be,...ye})),U(be=>({...be,...Ie}))}}catch{R("Failed to save info.")}finally{te("idle")}},C=v=>{const D=w[v.key]??"",he=v.inputType==="textarea"||v.inputType==="json";return e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.label}),he?e.jsx("textarea",{rows:v.inputType==="json"?8:4,value:D,onChange:Q=>g(q=>({...q,[v.key]:Q.target.value})),placeholder:v.key}):e.jsx("input",{type:"text",value:D,onChange:Q=>g(q=>({...q,[v.key]:Q.target.value})),placeholder:v.key})]},`payload:${v.key}`)},pe=v=>{const D=L[v.key]??v.targetTypes[0];return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:v.label}),v.targetTypes.length>1?e.jsx("select",{value:D,onChange:he=>G(Q=>({...Q,[v.key]:he.target.value})),children:v.targetTypes.map(he=>e.jsx("option",{value:he,children:Oe(t,he)},`${v.key}:${he}`))}):null,v.multiple?e.jsx(sa,{libraryId:d,infoType:D,label:v.label,placeholder:v.key,multiple:!0,values:m[v.key]??[],onChangeMultiple:he=>U(Q=>({...Q,[v.key]:he})),searchFailedText:"Search failed",createFailedText:"Create failed"}):e.jsx(sa,{libraryId:d,infoType:D,label:v.label,placeholder:v.key,value:re[v.key]??null,onChange:he=>z(Q=>({...Q,[v.key]:he})),searchFailedText:"Search failed",createFailedText:"Create failed"})]},`link:${v.key}`)};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:o?"Edit info":"Create info"}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:"Specification-driven editor"})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:`/#/cogita/library/${d}/list`,children:"Back to list"})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-panel",children:[o?null:e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Info type"}),e.jsx("select",{value:Y,onChange:v=>W(v.target.value),children:Pe.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))})]}),ee==="loading"?e.jsx("p",{children:"Loading..."}):null,ae?e.jsxs("div",{className:"cogita-form-grid",children:[ae.payloadFields.map(C),ae.linkFields.map(pe)]}):e.jsx("p",{children:"No specification found for this info type."}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:ue,disabled:ee==="saving"||!ae,children:ee==="saving"?"Saving...":o?"Update info":"Create info"})}),S?e.jsx("p",{className:"cogita-library-subtitle",children:S}):null]})})})]})})}const Cs=t=>/\s/.test(t),Ra=t=>/[\p{L}\p{N}]/u.test(t),Ms=(t,s)=>{const n=s>0?t[s-1]:"",r=s<t.length?t[s]:"";if(!n||!r)return 0;const l=Cs(n),p=Cs(r);if(l||p)return 3;const y=Ra(n),x=Ra(r);return y!==x?2:!y&&!x?1:0},Ja=(t,s,n,r,l)=>{const p=Math.max(r-s,n-r);for(let y=0;y<=p;y+=1){const x=r-y;if(x>=s&&x<=n&&Ms(t,x)>=l)return x;const E=r+y;if(E>=s&&E<=n&&Ms(t,E)>=l)return E}return null},Za=(t,s)=>{const n=s>0?t[s-1]:"",r=s<t.length?t[s]:"";return!n||!r?!0:Ra(n)!==Ra(r)},ai=(t,s,n,r)=>{const l=n-s,p=s+r,y=n-r;if(l<=r*2||y<=p)return null;const x=Math.floor((s+n)/2),E=Ja(t,p,y,x,3);if(E!==null&&Za(t,E))return E;const k=Ja(t,p,y,x,2);if(k!==null&&Za(t,k))return k;const d=Ja(t,p,y,x,1);return d!==null&&Za(t,d)?d:null},ma=(t,s)=>{const n=Math.max(1,7),r=Math.max(n,13),l={},p=(E,k,d,N,c)=>{const o=String(N),O={id:o,start:E,end:k,text:t.slice(E,k),depth:d,index:N,parentId:c};if(l[o]=O,k-E>r){let Y=ai(t,E,k,n);if(Y!==null&&Y>E&&Y<k){const W=p(E,Y,d+1,N*2+1,o),w=p(Y,k,d+1,N*2+2,o);O.leftId=W.id,O.rightId=w.id}}return O},y=p(0,t.length,0,0),x=Object.values(l).sort((E,k)=>k.depth-E.depth||E.start-k.start).map(E=>E.id);return{text:t,rootId:y.id,nodes:l,order:x}},ha=(t,s,n,r,l,p,y)=>{const x=p==="reverse"?t.order.slice().sort((E,k)=>t.nodes[k].start-t.nodes[E].start||t.nodes[k].depth-t.nodes[E].depth):t.order;for(const E of x){if(y&&E===y||s.has(E))continue;const k=t.nodes[E];if(k){if(l&&(k.leftId||k.rightId)){const d=k.leftId?n[k.leftId]??0:r,N=k.rightId?n[k.rightId]??0:r;if((d+N)/2<r)continue}return k}}return null},Hs=(t,s)=>({before:t.slice(0,s.start),fragment:t.slice(s.start,s.end),after:t.slice(s.end)});function si({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d}){const N=`/#/cogita/library/${d}`,[c,o,O]=Rs([]),[de,Y,W]=Es([]),[w,g]=a.useState(null),[re,z]=a.useState(null),[m,U]=a.useState(null),[L,G]=a.useState(null),S=a.useMemo(()=>c.find(C=>C.id===w)??null,[c,w]);a.useEffect(()=>{let C=!0;return hn({libraryId:d}).then(pe=>{if(!C)return;const v=pe.nodes.map(D=>{var he,Q,q;return{id:D.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:D.payload&&typeof D.payload=="object"&&"label"in D.payload?String(D.payload.label):"Item",nodeType:D.nodeType,itemType:((he=D.payload)==null?void 0:he.itemType)??"info",itemId:((Q=D.payload)==null?void 0:Q.itemId)??null,infoType:((q=D.payload)==null?void 0:q.infoType)??null}}});o(v),Y(pe.edges.map(D=>({id:D.edgeId,source:D.fromNodeId,target:D.toNodeId})))}).catch(()=>{C&&(o([]),Y([]))}),()=>{C=!1}},[d]),a.useEffect(()=>{gn({libraryId:d}).then(z).catch(()=>z(null))},[d,c,de]);const R=a.useCallback(C=>{Y(pe=>As(C,pe))},[]),ee=()=>{const C=crypto.randomUUID();o(pe=>[...pe,{id:C,type:"default",position:{x:140+pe.length*40,y:120+pe.length*30},data:{label:t.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},te=()=>{const C=crypto.randomUUID();o(pe=>[...pe,{id:C,type:"default",position:{x:180+pe.length*40,y:160+pe.length*30},data:{label:t.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ae=async()=>{U(null);try{const C=c.map(v=>({nodeId:v.id,nodeType:v.data.nodeType,payload:{itemType:v.data.itemType,itemId:v.data.itemId??null,label:v.data.label,infoType:v.data.infoType??null}})),pe=de.map(v=>({edgeId:v.id,fromNodeId:v.source,toNodeId:v.target}));await mn({libraryId:d,nodes:C,edges:pe}),U(t.cogita.library.graph.saveSuccess)}catch{U(t.cogita.library.graph.saveFail)}},Pe=C=>{S&&o(pe=>pe.map(v=>v.id===S.id?{...v,data:{...v.data,itemId:(C==null?void 0:C.infoId)??null,itemType:"collection",infoType:"collection",label:(C==null?void 0:C.label)??t.cogita.library.infoTypes.collection}}:v))},ue=C=>{S&&o(pe=>pe.map(v=>v.id===S.id?{...v,data:{...v.data,itemId:(C==null?void 0:C.infoId)??null,itemType:"info",infoType:(C==null?void 0:C.infoType)??null,label:(C==null?void 0:C.label)??t.cogita.library.infoTypes.any}}:v))};return a.useEffect(()=>{if(!S||S.data.nodeType!=="info"||S.data.infoType!=="quote"||!S.data.itemId){G(null);return}let C=!0;return ua({libraryId:d,infoId:S.data.itemId}).then(pe=>{if(!C)return;const v=pe.payload,D=(v==null?void 0:v.text)??"";if(!D){G(null);return}const he=ma(D),Q=Object.values(he.nodes).sort((q,ye)=>q.depth-ye.depth||q.start-ye.start).map(q=>({id:q.id,text:q.text,depth:q.depth}));G({title:(v==null?void 0:v.title)??S.data.label,fragments:Q})}).catch(()=>G(null)),()=>{C=!1}},[d,S]),e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:t.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:N,children:t.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ae,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ee,children:t.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:te,children:t.cogita.library.actions.addInfo}),re?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(re.totalCollections))})}):null,m?e.jsx("p",{className:"cogita-help",children:m}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Fs,{nodes:c,edges:de,onNodesChange:O,onEdgesChange:W,onConnect:R,onNodeClick:(C,pe)=>g(pe.id),fitView:!0,children:[e.jsx(Ps,{gap:18,size:1}),e.jsx(zs,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),S?e.jsxs("div",{className:"cogita-graph-inspector",children:[S.data.nodeType==="collection"?e.jsx(sa,{libraryId:d,infoType:"collection",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:S.data.itemId?{id:S.data.itemId,label:S.data.label,infoType:"collection"}:null,onChange:Pe,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.collection),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}):e.jsx(sa,{libraryId:d,infoType:"any",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:S.data.itemId?{id:S.data.itemId,label:S.data.label,infoType:S.data.infoType??void 0}:null,onChange:ue,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.any),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),L?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:L.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:L.fragments.map(C=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:C.id}),e.jsx("span",{children:C.text})]},C.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}function ni({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d,collectionId:N}){const{libraryName:c}=Vt(d),[o,O]=a.useState([]),[de,Y]=a.useState("loading"),[W,w]=a.useState("idle"),g=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),re=`/#/cogita/library/${d}`,z=()=>{Y("loading"),Os({libraryId:d}).then(L=>{O(L),Y("idle")}).catch(()=>{O([]),Y("error")})};a.useEffect(()=>{z()},[d]);const m=async L=>{try{await Us({libraryId:d,shareId:L}),z()}catch{z()}},U=async L=>{const G=`${g}/${L}`;try{await navigator.clipboard.writeText(G),w("copied")}catch{w("failed")}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:re,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${re}/collections`,children:t.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[de==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):de==="error"?e.jsx("p",{children:t.cogita.library.revision.shareError}):o.filter(L=>!N||L.collectionId===N).length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:o.filter(L=>!N||L.collectionId===N).map(L=>e.jsxs("div",{className:"cogita-share-row","data-state":L.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:L.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(L.createdUtc).toLocaleString(),L.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]}),L.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${g}/${L.shareCode}`}):null]}),L.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[L.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>U(L.shareCode),children:t.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>m(L.shareId),children:t.cogita.library.revision.shareRevokeAction})]})]},L.shareId))}),W==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):W==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function ii({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d}){const{libraryName:N}=Vt(d),[c,o]=a.useState(null),[O,de]=a.useState(null),[Y,W]=a.useState(null),[w,g]=a.useState(null),[re,z]=a.useState(null),[m,U]=a.useState(null),L=a.useRef(null),G=ee=>{if(!Number.isFinite(ee))return"0 B";if(ee<1024)return`${ee} B`;const te=ee/1024;if(te<1024)return`${te.toFixed(1)} KB`;const ae=te/1024;return ae<1024?`${ae.toFixed(1)} MB`:`${(ae/1024).toFixed(1)} GB`},S=async()=>{o(null),z({loadedBytes:0,totalBytes:null,percent:null});try{o(t.cogita.library.overview.exporting);const ee=await pn(d,z),te=URL.createObjectURL(ee),ae=document.createElement("a");ae.href=te,ae.download=`cogita-library-${N||d}.json`,ae.click(),URL.revokeObjectURL(te),o(t.cogita.library.overview.exportReady)}catch{o(t.cogita.library.overview.exportFail)}finally{z(ee=>ee??{loadedBytes:0,totalBytes:null,percent:null})}},R=async ee=>{var ae;de(null),W(null),g(null);const te=(ae=ee.target.files)==null?void 0:ae[0];if(te)try{de(t.cogita.library.overview.importing),U({loadedBytes:0,totalBytes:te.size,percent:0});const Pe=await fn(d,te,U,ue=>{const C=ue.stage==="infos"?t.cogita.library.overview.importStageInfos:ue.stage==="connections"?t.cogita.library.overview.importStageConnections:t.cogita.library.overview.importStageCollections;g(t.cogita.library.overview.importLiveProgress.replace("{stage}",C).replace("{done}",String(ue.processed)).replace("{total}",String(ue.total)).replace("{infos}",String(ue.infos)).replace("{connections}",String(ue.connections)).replace("{collections}",String(ue.collections)))});W({infos:Pe.infosImported,connections:Pe.connectionsImported,collections:Pe.collectionsImported}),de(t.cogita.library.overview.importDone)}catch(Pe){const ue=Pe instanceof bn&&Pe.message?` ${Pe.message}`:"";de(`${t.cogita.library.overview.importFail}${ue}`)}finally{L.current&&(L.current.value="")}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:N}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:t.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[t.cogita.library.overview.import,e.jsx("input",{ref:L,type:"file",accept:"application/json",onChange:R})]})]}),re?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:re.percent??void 0,max:re.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.exportProgress.replace("{loaded}",G(re.loadedBytes)).replace("{total}",re.totalBytes?G(re.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,m?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:m.percent??void 0,max:m.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.importProgress.replace("{loaded}",G(m.loadedBytes)).replace("{total}",m.totalBytes?G(m.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,c?e.jsx("p",{className:"cogita-help",children:c}):null,O?e.jsx("p",{className:"cogita-help",children:O}):null,w?e.jsx("p",{className:"cogita-help",children:w}):null,Y?e.jsx("p",{className:"cogita-help",children:t.cogita.library.overview.importSummary.replace("{infos}",String(Y.infos)).replace("{connections}",String(Y.connections)).replace("{collections}",String(Y.collections))}):null]})]})})})]})})}function ri({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d}){const{libraryName:N}=Vt(d),[c,o]=a.useState(""),[O,de]=a.useState([]),Y=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:N}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:c,onChange:W=>o(W.target.value),placeholder:t.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const W=c.trim();W&&(de(w=>[{id:Y(),name:W},...w]),o(""))},children:t.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[O.length===0?e.jsx("p",{children:t.cogita.library.modules.storyboardsEmpty}):null,O.map(W=>e.jsx("button",{type:"button",className:"ghost",children:W.name},W.id))]})]})]})})})]})})}function oi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d}){const{libraryName:N}=Vt(d),[c,o]=a.useState(""),[O,de]=a.useState([]),Y=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:N}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:c,onChange:W=>o(W.target.value),placeholder:t.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const W=c.trim();W&&(de(w=>[{id:Y(),name:W},...w]),o(""))},children:t.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[O.length===0?e.jsx("p",{children:t.cogita.library.modules.textsEmpty}):null,O.map(W=>e.jsx("button",{type:"button",className:"ghost",children:W.name},W.id))]})]})]})})})]})})}function Is({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d}){const{libraryName:N}=Vt(d),c=`/#/cogita/library/${d}`,[o,O]=a.useState(""),[de,Y]=a.useState([]),[W,w]=a.useState("idle"),[g,re]=a.useState(0),[z,m]=a.useState(null);a.useEffect(()=>{w("loading");const L=window.setTimeout(()=>{va({libraryId:d,query:o.trim()||void 0,limit:30}).then(G=>{Y(G.items),re(G.total),m(G.nextCursor??null),w("ready")}).catch(()=>{Y([]),re(0),m(null),w("ready")})},240);return()=>window.clearTimeout(L)},[d,o]);const U=async()=>{if(z){w("loading");try{const L=await va({libraryId:d,query:o.trim()||void 0,limit:30,cursor:z});Y(G=>[...G,...L.items]),m(L.nextCursor??null),re(L.total),w("ready")}catch{w("ready")}}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:N}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${c}/collections/new`,children:t.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:o,onChange:L=>O(L.target.value),placeholder:t.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:t.cogita.library.collections.countLabel.replace("{shown}",String(de.length)).replace("{total}",String(g||de.length))}),e.jsx("span",{children:W==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:de.length?de.map(L=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${c}/collections/${L.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:L.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.collections.itemCountLabel.replace("{count}",String(L.itemCount))," ·"," ",L.notes||t.cogita.library.collections.noNotes]})]})},L.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${c}/collections/new`,children:t.cogita.library.collections.emptyAction})]})}),z?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:U,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const ie=t=>`${t.cardType}:${t.cardId}:${t.checkType??""}:${t.direction??""}`,Bt=(t,s,n,r)=>`${t}:${s}:${n??""}:${r??""}`;function li({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d,collectionId:N}){Vt(d);const c=`/#/cogita/library/${d}`,[o,O]=a.useState(t.cogita.library.collections.defaultName),[de,Y]=a.useState(null),[W,w]=a.useState(0),[g,re]=a.useState([]),[z,m]=a.useState("idle"),[U,L]=a.useState(null),G=a.useMemo(()=>t.cogita.library.list.cardCount.replace("{shown}",String(g.length)).replace("{total}",String(W||g.length)),[t,g.length,W]);a.useEffect(()=>{_a(d,N).then(R=>{O(R.name),Y(R.notes??null),w(R.itemCount)}).catch(()=>{O(t.cogita.library.collections.defaultName),Y(null)})},[d,N]),a.useEffect(()=>{m("loading"),$a({libraryId:d,collectionId:N,limit:40}).then(R=>{re(R.items),L(R.nextCursor??null),w(R.total),m("ready")}).catch(()=>{re([]),L(null),m("ready")})},[d,N]);const S=async()=>{if(U){m("loading");try{const R=await $a({libraryId:d,collectionId:N,limit:40,cursor:U});re(ee=>[...ee,...R.items]),L(R.nextCursor??null),w(R.total),m("ready")}catch{m("ready")}}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:o}),e.jsx("p",{className:"cogita-library-subtitle",children:de||t.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${c}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${c}/collections/${N}/graph`,children:t.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${c}/collections/${N}/revision`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:G}),e.jsx("span",{children:z==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:g.length?g.map(R=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:R.cardType==="vocab"?t.cogita.library.list.cardTypeVocab:R.cardType==="connection"?t.cogita.library.list.cardTypeConnection:t.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:R.label}),e.jsx("p",{className:"cogita-card-subtitle",children:R.description})]})},ie(R))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.collections.noCards})})}),U?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:S,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${c}/collections/${N}/revision`,children:t.cogita.library.actions.startRevision})})]})})]})})})]})})}const _t=t=>{if(!t.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const s=t.length,n=t.filter(p=>p.correct).length,r=Da(hs(t));return{score:Math.round(Math.max(0,Math.min(100,r.knowness*100))*100)/100,total:s,correct:n,lastReviewedUtc:r.lastReviewedUtc??null}},ci=t=>{if(t.maskBase64)try{const s=yn(t.maskBase64);if(!s.length)return t.correct?1:0;const n=s.reduce((r,l)=>r+l,0);return Math.max(0,Math.min(1,n/s.length/255))}catch{return t.correct?1:0}return t.correct?1:0},hs=t=>t.map(s=>({correctness:ci(s),createdUtc:s.createdUtc})),Da=(t,s=Date.now())=>{var W;if(!t.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const r=t.slice().sort((w,g)=>w.createdUtc.localeCompare(g.createdUtc)).slice(-5),l=r.reduce((w,g)=>w+g.correctness,0)/r.length,p=5,y=2,x=.15;let E=0,k=0;for(let w=0;w<r.length;w+=1){const g=new Date(r[w].createdUtc).getTime(),re=w===r.length-1?s:new Date(r[w+1].createdUtc).getTime(),z=Math.max(0,(re-g)/(1e3*60)),m=1-Math.exp(-z/p);E+=m,r[w].correctness>.5&&(k+=x)}let d=l*E*y+k;const N=((W=r[r.length-1])==null?void 0:W.createdUtc)??null,c=N?Math.max(0,(s-new Date(N).getTime())/(1e3*60)):0,O=1/(1+Math.log1p(c/60));return d*=O,r.length===1&&r[0].correctness>.5&&(d+=5.44*Math.exp(-c/2)),{knowness:d,avgCorrectness:l,lastReviewedUtc:N}},wa=t=>{const s=t.slice();for(let n=s.length-1;n>0;n-=1){const r=Math.floor(Math.random()*(n+1));[s[n],s[r]]=[s[r],s[n]]}return s},La=t=>t[Math.floor(Math.random()*t.length)],di=(t,s)=>{const n=new Map;return t.forEach(r=>n.set(r,Math.random())),t.sort((r,l)=>{const p=s(r)-s(l);return p!==0?p:(n.get(r)??0)-(n.get(l)??0)})},qa=(t,s,n,r,l)=>{if(!t.length)return null;const p=t.filter(x=>!(l!=null&&l.has(ie(x))));if(p.length===0)return null;const y=p.filter(x=>ie(x)!==n);return La(y.length?y:p)},ui=(t,s,n,r,l)=>{if(!t.length)return null;let p=Number.POSITIVE_INFINITY;for(const k of t){const d=ie(k);if(n.has(d))continue;const N=s[d]??1;N<p&&(p=N)}if(!Number.isFinite(p))return null;const y=t.filter(k=>{const d=ie(k);return!n.has(d)&&(s[d]??1)===p}),x=y.filter(k=>!l||ie(k)!==l),E=r?x.filter(k=>!r.has(ie(k))):x;return E.length>0?La(E):x.length>0?La(x):l&&y.some(k=>ie(k)===l)?y.find(k=>ie(k)===l)??null:y.length?La(y):null},Ys=(t,s,n,r,l)=>{const p=[],y=t.filter(E=>!l.has(ie(E))&&!n.has(ie(E))&&(s[ie(E)]??0)<1),x=di(y,E=>s[ie(E)]??0);for(const E of x){if(p.length>=r)break;p.push(E),l.add(ie(E))}if(p.length<r){const E=wa(t.filter(k=>!l.has(ie(k))&&n.has(ie(k))));for(const k of E){if(p.length>=r)break;p.push(k),l.add(ie(k))}}return p},hi=(t,s,n,r)=>Ys(t,s,n,r,new Set),gs=(t,s,n,r,l,p)=>{const y=Math.max(1,n.stackSize??s),E=wa(t).filter((O,de,Y)=>Y.findIndex(W=>ie(W)===ie(O))===de),k=hi(E,r,l,y),d=new Set,N=new Set,c=qa(k,{},null,d,N),o=c?[c]:[];return c&&N.add(ie(c)),{queue:o,meta:{pool:E,active:k,knownessMap:r,unknownSet:l,outcomesById:p,asked:d,queued:N}}},ls={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:t=>t,prepare:(t,s)=>{const r=wa(t).filter((l,p,y)=>y.findIndex(x=>ie(x)===ie(l))===p);return{queue:r.slice(0,Math.min(s,r.length)),meta:{}}},applyOutcome:t=>t},ms=(t,s,n,r)=>{const l=Math.max(1,n.stackSize??s),y=wa(t).filter((de,Y,W)=>W.findIndex(w=>ie(w)===ie(de))===Y),x={},E=new Set,k=new Set,d=new Set,N=Math.max(1,n.levels??1);y.forEach(de=>{const Y=ie(de),W=r==null?void 0:r[Y],w=typeof W=="number"&&Number.isFinite(W)?W:1;x[Y]=Math.min(N,Math.max(1,Math.round(w)))});const c=[];if(y.length>0){const de=new Map;y.forEach(W=>{var g;const w=x[ie(W)]??1;de.has(w)||de.set(w,[]),(g=de.get(w))==null||g.push(W)});const Y=Array.from(de.keys()).sort((W,w)=>W-w);for(const W of Y){if(c.length>=l)break;const w=wa(de.get(W)??[]);for(const g of w){if(c.length>=l)break;c.push(g)}}}const o=qa(c,x,null,E,k),O=o?[o]:[];return o&&k.add(ie(o)),{queue:O,meta:{pool:y,active:c,levelMap:x,asked:E,queued:k,wrongSinceCorrect:d}}},gi={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,s)=>Math.max(1,s.stackSize??t),getProgressTotal:()=>null,prepare:(t,s,n)=>ms(t,s,n),applyOutcome:(t,s,n,r,l)=>{if(!s)return t;const p=Math.max(1,r.levels??1),y=t.meta.pool??[],x=t.meta.active??[],E={...t.meta.levelMap??{}},k=new Set(t.meta.asked??[]),d=new Set(t.meta.queued??[]),N=new Set(t.meta.wrongSinceCorrect??[]),c=ie(s);d.delete(c),k.add(c);const o=E[c]??1;l.correct?(E[c]=N.has(c)?1:Math.min(o+1,p),N.delete(c)):(E[c]=1,N.add(c));const O=l.correct?x.filter(W=>ie(W)!==c):x.slice();if(l.correct&&O.length<Math.max(1,r.stackSize??1)){const W=new Set(O.map(g=>ie(g))),w=ui(y,E,W,k,c);w&&O.push(w)}const de=t.queue.slice(),Y=qa(O,E,c,k,d);return Y&&(de.push(Y),d.add(ie(Y))),{queue:de,meta:{pool:y,active:O,levelMap:E,asked:k,queued:d,wrongSinceCorrect:N}}}},mi={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,s)=>Math.max(1,s.stackSize??t),getProgressTotal:()=>null,prepare:(t,s,n)=>gs(t,s,n,{},new Set,{}),applyOutcome:(t,s,n,r,l)=>{if(!s)return t;const p=t.meta.pool??[],y=t.meta.active??[],x={...t.meta.knownessMap??{}},E=new Set(t.meta.unknownSet??[]),k={...t.meta.outcomesById??{}},d=new Set(t.meta.asked??[]),N=new Set(t.meta.queued??[]),c=ie(s);N.delete(c),d.add(c);const o={correctness:Math.max(0,Math.min(1,l.correctness??(l.correct?1:0))),createdUtc:l.createdUtc??new Date().toISOString()},de=(k[c]??[]).concat(o).sort((z,m)=>z.createdUtc.localeCompare(m.createdUtc)).slice(-5);k[c]=de,E.delete(c);const Y=Date.now();p.forEach(z=>{const m=ie(z),U=k[m]??[];if(U.length===0){x[m]=0,E.add(m);return}const L=Da(U,Y);x[m]=L.knowness});const W=y.slice();if((x[c]??0)>=1){const z=W.filter(m=>ie(m)!==c);W.length=0,W.push(...z)}const g=Math.max(1,r.stackSize??n);if(W.length<g){const z=new Set(W.map(U=>ie(U))),m=Ys(p,x,E,g-W.length,z);W.push(...m)}const re=t.queue.slice();if(re.length===0||ie(re[re.length-1])===c){const z=qa(W,{},c,d,N);z&&(re.push(z),N.add(ie(z)))}return{queue:re,meta:{pool:p,active:W,knownessMap:x,unknownSet:E,outcomesById:k,asked:d,queued:N}}}},Gs={random:ls,levels:gi,temporal:mi},pi=Object.values(Gs),ps=t=>{if(!t)return ls;const s=t.trim().toLowerCase();return s==="random"||s==="levels"||s==="temporal"?Gs[s]:ls},Va=(t,s)=>{const n={...t.defaultSettings};return s&&Object.entries(s).forEach(([r,l])=>{typeof l=="number"&&Number.isFinite(l)&&(n[r]=l),typeof l=="string"&&(n[r]=l)}),t.settingsFields.forEach(r=>{var p;const l=n[r.key];if(r.type==="number"){if(typeof l!="number"||Number.isNaN(l)){n[r.key]=t.defaultSettings[r.key]??0;return}r.min!==void 0&&(n[r.key]=Math.max(r.min,n[r.key])),r.max!==void 0&&(n[r.key]=Math.min(r.max,n[r.key]));return}if(r.type==="select"){const y=((p=r.options)==null?void 0:p.map(x=>x.value))??[];(typeof l!="string"||y.length>0&&!y.includes(l))&&(n[r.key]=t.defaultSettings[r.key]??y[0]??"")}}),n},Xs=(t,s)=>{const n={};return t.settingsFields.forEach(r=>{const l=s.get(r.key);if(l){if(r.type==="number"){const p=Number(l);Number.isNaN(p)||(n[r.key]=p);return}n[r.key]=l}}),Va(t,n)},fi=(t,s)=>{const n=new URLSearchParams;return t.settingsFields.forEach(r=>{const l=s[r.key];(typeof l=="number"||typeof l=="string")&&n.set(r.key,String(l))}),n};function bi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d,collectionId:N,revisionId:c}){const{libraryName:o}=Vt(d),O=`/#/cogita/library/${d}`,[de,Y]=a.useState(t.cogita.library.collections.defaultName),[W,w]=a.useState(""),[g,re]=a.useState(20),[z,m]=a.useState("random"),[U,L]=a.useState({}),[G,S]=a.useState("exact"),[R,ee]=a.useState([]),[te,ae]=a.useState(null),[Pe,ue]=a.useState([]),[C,pe]=a.useState("idle"),[v,D]=a.useState(null),[he,Q]=a.useState("idle"),[q,ye]=a.useState("idle"),[Ie,be]=a.useState("idle"),Ae=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),je=a.useMemo(()=>ps(z),[z]),ze=a.useMemo(()=>Va(je,U),[je,U]),Ke=a.useMemo(()=>fi(je,ze).toString(),[je,ze]);a.useEffect(()=>{_a(d,N).then(H=>Y(H.name)).catch(()=>Y(t.cogita.library.collections.defaultName))},[d,N]),a.useEffect(()=>{c&&xn({libraryId:d,collectionId:N,revisionId:c}).then(H=>{w(H.name),m(H.mode||"random"),S(H.check||"exact"),re(H.limit||20),L(H.revisionSettings??{})}).catch(()=>{w("")})},[N,d,c]),a.useEffect(()=>{vn({libraryId:d}).then(H=>{ee(H),!te&&H.length>0&&ae(H[0].roleId)}).catch(()=>{ee([])})},[d]);const ke=()=>{ye("loading"),Os({libraryId:d}).then(H=>{ue(H),ye("idle")}).catch(()=>{ue([]),ye("error")})};a.useEffect(()=>{ke()},[d]);const Be=async()=>{pe("working"),Q("idle");try{const H=await jn({libraryId:d,collectionId:N,revisionType:je.id,revisionSettings:ze,mode:z,check:G,limit:g});D(`${Ae}/${H.shareCode}${Ke?`?${Ke}`:""}`),pe("ready"),ke()}catch{pe("error")}},Je=async()=>{if(c){be("saving");try{await wn({libraryId:d,collectionId:N,revisionId:c,name:W||de,revisionType:je.id,revisionSettings:ze,mode:z,check:G,limit:g}),be("saved")}catch{be("error")}}},He=async()=>{if(v)try{await navigator.clipboard.writeText(v),Q("copied")}catch{Q("failed")}},K=async H=>{try{await Us({libraryId:d,shareId:H}),ke()}catch{ke()}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:de}),e.jsx("p",{className:"cogita-library-subtitle",children:o})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:O,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${O}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${O}/collections/${N}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${O}/collections/${N}/revision/run?mode=${encodeURIComponent(z)}&check=${encodeURIComponent(G)}&limit=${g}${Ke?`&${Ke}`:""}${te?`&reviewer=${encodeURIComponent(te)}`:""}${c?`&revisionId=${encodeURIComponent(c)}`:""}`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:W,onChange:H=>w(H.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsx("select",{value:z,onChange:H=>m(H.target.value),children:pi.map(H=>e.jsx("option",{value:H.id,children:t.cogita.library.revision[H.labelKey]},H.id))})]}),je.settingsFields.map(H=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision[H.labelKey]}),H.type==="select"?e.jsx("select",{value:String(ze[H.key]??""),onChange:qe=>L(Se=>({...Se,[H.key]:qe.target.value})),children:(H.options??[]).map(qe=>e.jsx("option",{value:qe.value,children:t.cogita.library.revision[qe.labelKey]},qe.value))}):e.jsx("input",{type:"number",min:H.min,max:H.max,step:H.step,value:ze[H.key]??0,onChange:qe=>L(Se=>({...Se,[H.key]:Number(qe.target.value||0)}))})]},H.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.checkLabel}),e.jsx("input",{value:t.cogita.library.revision.checkValue,disabled:!0})]}),je.id!=="levels"&&je.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:g,onChange:H=>re(Number(H.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:te??"",onChange:H=>ae(H.target.value||null),children:R.map(H=>e.jsx("option",{value:H.roleId,children:H.label},H.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.previewBody1}),e.jsx("p",{children:t.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[c?e.jsx("button",{type:"button",className:"cta ghost",onClick:Je,disabled:Ie==="saving",children:Ie==="saving"?"...":t.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${O}/collections/${N}/revision/run?mode=${encodeURIComponent(z)}&check=${encodeURIComponent(G)}&limit=${g}${Ke?`&${Ke}`:""}${te?`&reviewer=${encodeURIComponent(te)}`:""}${c?`&revisionId=${encodeURIComponent(c)}`:""}`,children:t.cogita.library.actions.startRevision})]}),Ie==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.shareBody}),v?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:v,readOnly:!0})]}):null,C==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareError}):null,he==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):he==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:Be,disabled:C==="working",children:C==="working"?t.cogita.library.revision.shareWorking:t.cogita.library.revision.shareAction}),v?e.jsx("button",{type:"button",className:"cta ghost",onClick:He,children:t.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),q==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):Pe.length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:Pe.map(H=>e.jsxs("div",{className:"cogita-share-row","data-state":H.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:H.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(H.createdUtc).toLocaleString(),H.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]})]}),H.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>K(H.shareId),children:t.cogita.library.revision.shareRevokeAction})]},H.shareId))})]})]})]})]})})})]})})}const es=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function Js(t,s,n){if(!t)return null;const r=new Map(t.nodes.map(z=>[z.id,z])),l=new Map,p=new Set,y=z=>{if(typeof z=="number")return z;if(typeof z=="string"){const m=Number(z);return Number.isFinite(m)?m:0}return 0},x=z=>{if(l.has(z))return l.get(z);if(p.has(z))return 0;const m=r.get(z);if(!m)return 0;p.add(z);const U=G=>{var R,ee;return(G?((R=m.inputsByHandle)==null?void 0:R[G])??[]:m.inputs??((ee=m.inputsByHandle)==null?void 0:ee.in)??[]).map(te=>x(te))};let L=0;switch(m.type){case"input.random":{const G=m.min??0,S=m.max??G+10,R=Math.min(G,S),ee=Math.max(G,S);L=Math.floor(Math.random()*(ee-R+1))+R;break}case"input.const":{L=m.value??0;break}case"input.list":{const G=(m.list??[]).filter(Boolean),S=Math.round(y(U("index")[0]));L=G.length?G[Math.max(0,Math.min(G.length-1,S))]:String(S);break}case"compute.add":{L=U("in").map(S=>y(S)).reduce((S,R)=>S+R,0);break}case"compute.sub":{const G=U("add").map(R=>y(R)),S=U("sub").map(R=>y(R));L=G.reduce((R,ee)=>R+ee,0)-S.reduce((R,ee)=>R+ee,0);break}case"compute.mul":{const G=U("in").map(S=>y(S));L=G.length?G.reduce((S,R)=>S*R,1):0;break}case"compute.div":{const G=y(U("num")[0]),S=U("den").map(R=>y(R)).reduce((R,ee)=>R+ee,0);L=Math.abs(S)<Number.EPSILON?0:G/S;break}case"compute.pow":{const G=y(U("base")[0]),S=y(U("exp")[0]);L=Math.pow(G,S);break}case"compute.exp":{const G=y(U("base")[0]),S=y(U("exp")[0]);L=Math.pow(G,S);break}case"compute.log":{const G=y(U("value")[0]),S=y(U("base")[0]),R=Math.max(G,Number.EPSILON);L=Math.abs(S)<Number.EPSILON?Math.log(R):Math.log(R)/Math.log(S);break}case"compute.abs":{L=Math.abs(y(U("in")[0]));break}case"compute.min":{const G=U("in").map(S=>y(S));L=G.length?Math.min(...G):0;break}case"compute.max":{const G=U("in").map(S=>y(S));L=G.length?Math.max(...G):0;break}case"compute.floor":{L=Math.floor(y(U("in")[0]));break}case"compute.ceil":{L=Math.ceil(y(U("in")[0]));break}case"compute.round":{L=Math.round(y(U("in")[0]));break}case"compute.mod":{const G=y(U("a")[0]),S=y(U("b")[0]);L=Math.abs(S)<Number.EPSILON?0:G%S;break}case"compute.concat":{const S=["in1","in2","in3","in4","in5","in6"].flatMap(ae=>U(ae)),R=S.length?S:U("in");L=(R.length?R:U()).map(ae=>ae==null?"":String(ae)).join("");break}case"compute.trim":{const G=U("text")[0]??U("in")[0]??"",S=G==null?"":String(G),R=Math.max(0,Math.round(y(U("start")[0]))),ee=Math.max(0,Math.round(y(U("end")[0])));R+ee>=S.length?L="":L=S.substring(R,S.length-ee);break}case"output":{L=U("in")[0]??0;break}default:L=0}return p.delete(z),l.set(z,L),L},E=t.outputs&&t.outputs.length>0?t.outputs:t.output?[t.output]:t.nodes.filter(z=>z.type==="output").map(z=>z.id);t.nodes.forEach(z=>x(z.id)),E.forEach(z=>x(z));const k=z=>Math.abs(z%1)<1e-5?String(Math.round(z)):z.toFixed(3).replace(/\.?0+$/,""),d=z=>typeof z=="number"?k(z):z??"",N=new Map;E.forEach(z=>{var S,R,ee,te;const m=r.get(z);if(!m)return;const U=(R=(S=m.inputsByHandle)==null?void 0:S.name)==null?void 0:R[0],L=U?d(l.get(U)):"",G=(L==null?void 0:L.toString().trim())||((ee=m.outputLabel)==null?void 0:ee.trim())||((te=m.name)==null?void 0:te.trim())||z;N.set(z,G)});const c={},o={},O={};E.forEach(z=>{var L,G;const m=r.get(z);if(!m)return;const U=N.get(z)??(((L=m.outputLabel)==null?void 0:L.trim())||((G=m.name)==null?void 0:G.trim())||z);c[U]=d(l.get(z)),m.name&&(o[m.name.trim()]=U),o[z]=U});const de=(z,m)=>{let U=z;return t.nodes.forEach(L=>{var te,ae;const G=d(l.get(L.id)),S=E.includes(L.id),R=S?N.get(L.id)??((te=L.outputLabel)==null?void 0:te.trim())??((ae=L.name)==null?void 0:ae.trim())??L.id:"",ee=S&&m?R:G;U=U.replace(new RegExp(`\\{\\s*${es(L.id)}\\s*\\}`,"gi"),ee),L.name&&(U=U.replace(new RegExp(`\\{\\s*${es(L.name)}\\s*\\}`,"gi"),ee)),S&&L.outputLabel&&(U=U.replace(new RegExp(`\\{\\s*${es(L.outputLabel)}\\s*\\}`,"gi"),R))}),U},Y=s;let W=Y.trim().length>0?Y:"";W||(W=E.length?`Compute ${E.join(", ")}`:"Compute"),W=de(W,!0);const w=(n==null?void 0:n.trim())??"",g=w?de(w,!1):"",re={};return l.forEach((z,m)=>{re[m]=z,O[m]=d(z);const U=r.get(m);U!=null&&U.name&&(O[U.name.trim()]=d(z))}),{prompt:W,answers:c,values:re,answerText:g,outputVariables:o,variableValues:O}}function Zs(t){var n;const s=Object.entries(t.answers);return{prompt:t.prompt,expectedAnswer:t.answerText??((n=s[0])==null?void 0:n[1])??"",expectedAnswers:t.answers,values:t.values,expectedAnswerIsSentence:!!(t.answerText&&t.answerText.trim().length>0),outputVariables:t.outputVariables,variableValues:t.variableValues}}function en({copy:t,currentCard:s,currentTypeLabel:n,prompt:r,languages:l,answer:p,onAnswerChange:y,computedExpected:x,computedAnswers:E,onComputedAnswerChange:k,answerTemplate:d,outputVariables:N,variableValues:c,computedFieldFeedback:o,feedback:O,canAdvance:de,quoteContext:Y,quotePlaceholder:W,onCheckAnswer:w,onSkip:g,onLanguageSelect:re,onMarkReviewed:z,onAdvance:m,showCorrectAnswer:U,setShowCorrectAnswer:L,onRevealCorrect:G,answerMask:S,expectedAnswer:R,hasExpectedAnswer:ee,handleComputedKeyDown:te,answerInputRef:ae,computedInputRefs:Pe,scriptMode:ue,setScriptMode:C,matchPairs:pe,matchLeftOrder:v,matchRightOrder:D,matchSelection:he,matchActiveLeft:Q,matchActiveRight:q,matchFeedback:ye,onMatchLeftSelect:Ie,onMatchRightSelect:be}){const Ae=a.useMemo(()=>{var we;const K=!d&&x.length===2?`The {${x[0].key}} is of type {${x[1].key}}`:null,H=d??K;if(!H)return null;const qe=new Map(x.map($=>[$.key,$.expected])),Se=new Set,le=[],Le=/\{([^}]+)\}/g;let _e=0,B,ge=null;for(;(B=Le.exec(H))!==null;){const $=H.slice(_e,B.index);$&&le.push({type:"text",value:$});const V=((we=B[1])==null?void 0:we.trim())??"",fe=V&&qe.has(V)?V:V&&N&&N[V]?N[V]:null;V&&Se.add(V),fe&&Se.add(fe),fe&&qe.has(fe)?(le.push({type:"input",value:fe}),ge||(ge=fe)):V&&c&&c[V]!==void 0?le.push({type:"text",value:c[V]}):le.push({type:"text",value:B[0]}),_e=B.index+B[0].length}const I=H.slice(_e);return I&&le.push({type:"text",value:I}),x.filter($=>!Se.has($.key)).length>0?null:{parts:le,expectedByKey:qe,firstInputKey:ge}},[d,x,N,c]),je=()=>{if(!Ae)return null;const{parts:K,expectedByKey:H,firstInputKey:qe}=Ae;return e.jsx("div",{className:"cogita-revision-inline-answer",children:K.map((Se,le)=>{var Le,_e;return Se.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Se.value},`text-${le}`):e.jsx("input",{ref:B=>{Pe.current[Se.value]=B},autoFocus:Se.value===qe,value:E[Se.value]??"",onChange:B=>k(Se.value,B.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":o[Se.value]??(O==="correct"?"correct":O==="incorrect"?"incorrect":void 0),onKeyDown:B=>Be(B)||te(B),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Le=E[Se.value])==null?void 0:Le.length)??0,((_e=H.get(Se.value))==null?void 0:_e.length)??6)}ch`}},`input-${Se.value}-${le}`)})})},ze=a.useMemo(()=>{const K=new Map;return(pe??[]).forEach(H=>K.set(H.leftId,H)),K},[pe]),Ke=a.useMemo(()=>{const K=new Map;return(pe??[]).forEach(H=>K.set(H.rightId,H)),K},[pe]);a.useEffect(()=>{var le;if(s.cardType!=="info"||s.infoType!=="computed"||x.length===0)return;const K=typeof document<"u"?document.activeElement:null;if(K&&(K.tagName==="INPUT"||K.tagName==="TEXTAREA"))return;const H=(Ae==null?void 0:Ae.firstInputKey)??((le=x[0])==null?void 0:le.key);if(!H)return;const qe=Pe.current[H];if(!qe)return;const Se=requestAnimationFrame(()=>{qe.focus()});return()=>cancelAnimationFrame(Se)},[s,x,Ae]);const ke=(()=>{const K=[R??"",...x.map(Se=>Se.expected??"")].join(""),H=[p,...Object.values(E)].join(""),qe=`${K}${H}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(qe)})(),Be=K=>K.ctrlKey&&(K.key==="^"||K.key==="6")?(K.preventDefault(),C(H=>H==="super"?null:"super"),!0):K.ctrlKey&&(K.key==="_"||K.key==="-")?(K.preventDefault(),C(H=>H==="sub"?null:"sub"),!0):!1,Je=()=>{if(!R||!S)return R??"";const K=R.split(""),H=Array.from(S),qe=H.length>0?H.reduce((Se,le)=>Se+le,0)/H.length:127;return K.map((Se,le)=>{const Le=H[le]??qe,_e=Math.max(0,Math.min(255,Math.round(Le)));let B=255,ge=0;return _e<=127?ge=Math.round(_e/127*255):(ge=255,B=Math.round(255*(1-(_e-127)/128))),e.jsx("span",{style:{color:`rgb(${B}, ${ge}, 0)`},children:Se},`mask-${le}`)})},He=s.cardType==="info"&&s.infoType==="quote"?(Y==null?void 0:Y.title)||s.label:s.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:n}),e.jsx("strong",{children:He})]}),s.cardType==="vocab"&&s.checkType==="translation-match"&&pe?e.jsxs("div",{className:"cogita-revision-body",children:[r?e.jsx("h2",{children:r}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(v??[]).map(K=>{const H=ze.get(K);if(!H)return null;const qe=(he==null?void 0:he[K])??null,Se=(ye==null?void 0:ye[K])??null,le=Q===K;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":le,"data-state":Se??void 0,"data-locked":qe?"true":void 0,onClick:()=>Ie==null?void 0:Ie(K),children:[e.jsx("span",{children:H.leftLabel}),qe&&U?e.jsx("em",{children:"✓"}):null]},K)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(D??[]).map(K=>{const H=Ke.get(K);if(!H)return null;const qe=Object.values(he??{}).includes(K),Se=q===K;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":qe||Se,"data-locked":qe?"true":void 0,onClick:()=>be==null?void 0:be(K),children:e.jsx("span",{children:H.rightLabel})},K)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,disabled:s.checkType==="translation-match",children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ae,value:p,onChange:K=>y(K.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":O==="correct"?"correct":O==="incorrect"?"incorrect":void 0,onKeyDown:K=>{K.key==="Enter"&&(K.preventDefault(),K.stopPropagation(),de?m():w())}})]}),ke?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ue==="super",onClick:()=>C(K=>K==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ue==="sub",onClick:()=>C(K=>K==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[s.label?e.jsx("p",{className:"cogita-revision-hint",children:s.label}):null,d?null:e.jsx(kn,{value:r??"",mode:"auto"}),x.length>0?(()=>{const K=je();return K?e.jsx("div",{className:"cogita-inline-answer-wrap",children:K}):e.jsx("div",{className:"cogita-form-grid",children:x.map((H,qe)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:H.key}),e.jsx("textarea",{ref:Se=>{Pe.current[H.key]=Se},autoFocus:qe===0,value:E[H.key]??"",onChange:Se=>k(H.key,Se.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":o[H.key]??(O==="correct"?"correct":O==="incorrect"?"incorrect":void 0),onKeyDown:Se=>Be(Se)||te(Se)})]},H.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ae,value:p,onChange:K=>y(K.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":O==="correct"?"correct":O==="incorrect"?"incorrect":void 0,onKeyDown:K=>{Be(K)||K.key==="Enter"&&(K.preventDefault(),K.stopPropagation(),de?m():w())}})]})}),ke?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ue==="super",onClick:()=>C(K=>K==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ue==="sub",onClick:()=>C(K=>K==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="quote"&&Y?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.quoteProgress.replace("{done}",String(Y.completed)).replace("{total}",String(Y.total))}),e.jsx("p",{className:"cogita-quote-text",children:Y.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ae,value:p,onChange:K=>y(K.target.value),placeholder:W??t.cogita.library.revision.quoteMissingPlaceholder,"data-state":O==="correct"?"correct":O==="incorrect"?"incorrect":void 0,onKeyDown:K=>{K.key==="Enter"&&(K.preventDefault(),K.stopPropagation(),de?m():w())}})]}),e.jsx("p",{className:"cogita-quote-text",children:Y.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:l.length?l.map(K=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>re(K.label),children:K.label},K.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:t.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:z,children:t.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}),O&&e.jsx("div",{className:"cogita-revision-feedback","data-state":O,children:O==="correct"?t.cogita.library.revision.correct:t.cogita.library.revision.tryAgain}),O==="incorrect"&&ee?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>L(K=>{const H=!K;return H&&G(),H}),children:t.cogita.library.revision.showAnswer}),U?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),x.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[x.map(K=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:K.key}),e.jsx("span",{children:K.expected})]},K.key)),R?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:R})]}):null]}):e.jsx("p",{children:S?Je():R})]}):null]}):null,de?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:m,children:t.cogita.library.revision.nextQuestion})}):null]})}const ts=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function tn({outcomes:t}){const[s,n]=a.useState("day"),r=a.useMemo(()=>{const l=ts.find(x=>x.id===s)??ts[1],p=Date.now()-l.ms,y=t.filter(x=>new Date(x.createdUtc).getTime()>=p);return _t(y)},[t,s]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:ts.map(l=>e.jsx("button",{type:"button",className:"ghost","data-active":s===l.id,onClick:()=>n(l.id),children:l.label},l.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[r.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[r.correct," / ",r.total]})]})}const yi="cogita-revision",xi=1,Ea="outcomes",vi=()=>new Promise((t,s)=>{const n=indexedDB.open(yi,xi);n.onupgradeneeded=()=>{const r=n.result;if(!r.objectStoreNames.contains(Ea)){const l=r.createObjectStore(Ea,{keyPath:"id"});l.createIndex("byItem","itemKey",{unique:!1}),l.createIndex("byPending","pending",{unique:!1})}},n.onerror=()=>s(n.error),n.onsuccess=()=>t(n.result)}),ka=async(t,s)=>{const n=await vi();return new Promise((r,l)=>{const p=n.transaction(Ea,t),y=p.objectStore(Ea);s(y).then(r).catch(l),p.onerror=()=>l(p.error)})},an=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const t=new Uint8Array(16);crypto.getRandomValues(t);const s=Array.from(t).map(n=>n.toString(16).padStart(2,"0"));return`${s.slice(0,4).join("")}-${s.slice(4,6).join("")}-${s.slice(6,8).join("")}-${s.slice(8,10).join("")}-${s.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},wi=()=>{const t="cogita_revision_client_id",s=localStorage.getItem(t);if(s)return s;const n=an();return localStorage.setItem(t,n),n},ji=()=>{const t="cogita_revision_client_seq",s=Number(localStorage.getItem(t)??"0"),n=Number.isFinite(s)?s+1:1;return localStorage.setItem(t,String(n)),n},sn=(t,s,n,r)=>Bt(t,s,n,r),Aa=async t=>{const s=wi(),n=ji(),r=new Date().toISOString(),l={...t,clientId:s,clientSequence:n,createdUtc:r,id:an(),pending:!0};return await ka("readwrite",p=>new Promise((y,x)=>{const E={...l,itemKey:sn(l.itemType,l.itemId,l.checkType,l.direction)},k=p.add(E);k.onsuccess=()=>y(),k.onerror=()=>x(k.error)})),l},Fa=async(t,s,n,r)=>{if(!s)return[];try{const l=sn(t,s,n,r);return await ka("readonly",p=>new Promise((y,x)=>{const k=p.index("byItem").getAll(l);k.onsuccess=()=>{const N=(k.result??[]).map(c=>({itemType:c.itemType,itemId:c.itemId,checkType:c.checkType??null,direction:c.direction??null,revisionType:c.revisionType,evalType:c.evalType,correct:c.correct,createdUtc:c.createdUtc,maskBase64:c.maskBase64,payloadBase64:c.payloadBase64,payloadHashBase64:c.payloadHashBase64,clientId:c.clientId,clientSequence:c.clientSequence,personRoleId:c.personRoleId??null})).sort((c,o)=>c.createdUtc.localeCompare(o.createdUtc));y(N)},k.onerror=()=>x(k.error)}))}catch{return[]}},Dt=async()=>{try{return await ka("readonly",t=>new Promise((s,n)=>{const r=t.getAll();r.onsuccess=()=>{const p=(r.result??[]).map(y=>({itemType:y.itemType,itemId:y.itemId,checkType:y.checkType??null,direction:y.direction??null,revisionType:y.revisionType,evalType:y.evalType,correct:y.correct,createdUtc:y.createdUtc,maskBase64:y.maskBase64,payloadBase64:y.payloadBase64,payloadHashBase64:y.payloadHashBase64,clientId:y.clientId,clientSequence:y.clientSequence,personRoleId:y.personRoleId??null}));s(p)},r.onerror=()=>n(r.error)}))}catch{return[]}},ki=async(t=100)=>{try{return await ka("readonly",s=>new Promise((n,r)=>{const p=s.index("byPending").getAll(!0);p.onsuccess=()=>{const y=p.result??[];n(y.slice(0,t))},p.onerror=()=>r(p.error)}))}catch{return[]}},Ni=async t=>{if(t.length!==0)try{await ka("readwrite",s=>new Promise((n,r)=>{let l=t.length;t.forEach(p=>{const y=s.get(p);y.onsuccess=()=>{const x=y.result;if(x){x.pending=!1;const E=s.put(x);E.onsuccess=()=>{l-=1,l===0&&n()},E.onerror=()=>r(E.error)}else l-=1,l===0&&n()},y.onerror=()=>r(y.error)})}))}catch{}},as=async(t,s)=>{const n=await ki(200);if(n.length===0)return;const r=new Map;n.forEach(l=>{var y;const p=l.personRoleId??s??"";r.has(p)||r.set(p,[]),(y=r.get(p))==null||y.push(l)});for(const[l,p]of r.entries()){const y=p.map(x=>({itemType:x.itemType,itemId:x.itemId,checkType:x.checkType??null,direction:x.direction??null,revisionType:x.revisionType,evalType:x.evalType,correct:x.correct,clientId:x.clientId,clientSequence:x.clientSequence,maskBase64:x.maskBase64??null,payloadHashBase64:x.payloadHashBase64??null,payloadBase64:x.payloadBase64??null,personRoleId:l||null}));try{await Nn({libraryId:t,outcomes:y}),await Ni(p.map(x=>x.id))}catch{}}},Ls={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Ti=(t,s)=>{const n=Math.max(t.length,s.length,1),r=Math.abs(t.length-s.length);return Math.max(0,1-r/n)},Si=(t,s)=>{const n=new Uint8Array(t.length),r=Ti(t,s);for(let l=0;l<t.length;l+=1){const p=t[l]===(s[l]??"")?128:0,y=t.length-1-l,x=s.length-1-l,E=t[y]===(s[x]??"")?127:0,k=Math.round((p+E)*r);n[l]=Math.max(0,Math.min(255,k))}return n},Ma=(t,s)=>t===s||(Ls[t]??[]).includes(s)?!0:(Ls[s]??[]).includes(t),Pa=(t,s)=>{const n=new Uint8Array(t.length);if(!t.length)return n;const r=[];for(let p=0;p<=t.length-3;p+=1)r.push({index:p,text:t.slice(p,p+3)});let l=!1;return r.forEach(p=>{for(let y=0;y<=s.length-3;y+=1){const x=s.slice(y,y+3);let E=0;for(let o=0;o<3;o+=1)Ma(p.text[o],x[o])&&(E+=1);if(E<2)continue;let k=p.index-1,d=y-1;for(;k>=0&&d>=0;){const o=t[k],O=s[d];if(o===O){n[k]=Math.max(n[k],255),k-=1,d-=1,l=!0;continue}if(Ma(o,O)){n[k]=Math.max(n[k],127),k-=1,d-=1,l=!0;continue}if(k>0&&t[k-1]===O){n[k]=Math.max(n[k],0),k-=1,l=!0;continue}if(d>0&&t[k]===s[d-1]){d-=1,l=!0;continue}break}for(let o=0;o<3;o+=1){const O=p.index+o,de=p.text[o],Y=x[o],W=de===Y?255:Ma(de,Y)?127:0;n[O]=Math.max(n[O],W),l=!0}let N=p.index+3,c=y+3;for(;N<t.length&&c<s.length;){const o=t[N],O=s[c];if(o===O){n[N]=Math.max(n[N],255),N+=1,c+=1,l=!0;continue}if(Ma(o,O)){n[N]=Math.max(n[N],127),N+=1,c+=1,l=!0;continue}if(N+1<t.length&&t[N+1]===O){n[N]=Math.max(n[N],0),N+=1,l=!0;continue}if(c+1<s.length&&t[N]===s[c+1]){c+=1,l=!0;continue}break}}}),l?n:Si(t,s)},ga=(t,s,n)=>{const r=t.trim().toLowerCase(),l=s.trim().toLowerCase();return Pa(r,l)},pa=t=>t.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),nn=(t,s,n)=>{const r=pa(t),l=pa(s);return Pa(r,l)},wt=t=>t.trim().toLowerCase(),Ci=t=>t==="reverse"?"reverse":"forward",ja=(t,s)=>`${t}|${s}`,Nt=t=>{if(!t)return null;const[s,n]=t.split("|",2);return(s==="forward"||s==="reverse")&&n?{mode:s,fragmentId:n}:{mode:"forward",fragmentId:t}},za=(t,s)=>{var r;const n=Nt(s);return n?n.fragmentId&&s?(t??null)===s:(((r=Nt(t))==null?void 0:r.mode)??"forward")===n.mode:!0},ut=t=>{const s=t==null?void 0:t.trim().toLowerCase();return s||null},rn=(t,s)=>{if((ut(t.childItemType)??"info")!==(s.cardType??"").toLowerCase()||t.childItemId!==s.cardId)return!1;const r=ut(t.childCheckType),l=ut(t.childDirection),p=ut(s.checkType),y=ut(s.direction);return!(r&&r!==p||l&&l!==y)},Mi={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Ii={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},Ka=(t,s,n)=>{if(!n||!s.startsWith(t))return s;const r=s.slice(t.length);if(!r)return s;const l=n==="super"?Mi:Ii,p=r.split("").map(y=>l[y]??y).join("");return t+p},Ba=(t,s,n)=>{var y,x,E;if(!t)return((y=s[0])==null?void 0:y.key)??null;const r=new Set(s.map(k=>k.key)),l=/\{([^}]+)\}/g;let p;for(;(p=l.exec(t))!==null;){const k=((x=p[1])==null?void 0:x.trim())??"";if(!k)continue;if(r.has(k))return k;const d=n==null?void 0:n[k];if(d&&r.has(d))return d}return((E=s[0])==null?void 0:E.key)??null},cs=t=>t.flatMap(s=>{if(s.cardType!=="info"||s.infoType!=="quote")return[s];const n=s.description??"";if(!n.trim())return[s];const r=Nt(s.direction),l=(r==null?void 0:r.mode)??Ci(s.direction),p=ma(n),y=Object.keys(p.nodes);return y.length===0?[s]:y.map(x=>({...s,checkType:"quote-fragment",direction:ja(l,x)}))});function Li({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d,collectionId:N,revisionId:c}){const o=ds(),O=`/#/cogita/library/${d}`,de=a.useMemo(()=>new URLSearchParams(o.search),[o.search]),Y=Math.max(1,Number(de.get("limit")??20)),W=de.get("mode")??"random",w=a.useMemo(()=>ps(W),[W]),g=a.useMemo(()=>Va(w,Xs(w,de)),[w,de]),re=de.get("check")??"exact",z=de.get("reviewer"),m=a.useMemo(()=>t.cogita.library.revision[w.labelKey]??W,[t,W,w]),U=a.useMemo(()=>re==="exact"?t.cogita.library.revision.checkValue:re,[t,re]),[L,G]=a.useState(t.cogita.library.collections.defaultName),[S,R]=a.useState([]),[ee,te]=a.useState([]),[ae,Pe]=a.useState("idle"),[ue,C]=a.useState({current:0,total:0}),[pe,v]=a.useState(0),[D,he]=a.useState(""),[Q,q]=a.useState(null),[ye,Ie]=a.useState(null),[be,Ae]=a.useState(null),[je,ze]=a.useState(null),[Ke,ke]=a.useState([]),[Be,Je]=a.useState({}),[He,K]=a.useState({}),[H,qe]=a.useState(null),[Se,le]=a.useState(null),[Le,_e]=a.useState(null),[B,ge]=a.useState(null),[I,X]=a.useState(null),[we,$]=a.useState({}),V=a.useRef(0),[fe,Ce]=a.useState(null),xe=a.useRef(null),$e=a.useRef(null),[Ue,We]=a.useState(null),[Re,Ee]=a.useState(!1),[Ne,st]=a.useState(null),[Qe,Ge]=a.useState([]),[mt,jt]=a.useState(null),Ye=a.useRef(null),Ze=a.useRef(null),[ht,ot]=a.useState(null),[Lt,tt]=a.useState(0),lt=a.useRef(null),Ft=a.useRef({}),[bt,Xe]=a.useState(!1),[ct,St]=a.useState({}),[Pt,zt]=a.useState([]),gt=a.useRef(new Map),[yt,u]=a.useState(new Set),[ve,me]=a.useState(!1),Fe=a.useRef(null),et=a.useRef(new Set),at=a.useRef({}),oe=S[pe]??null,se=(oe==null?void 0:oe.checkType)==="translation-match"&&I,pt=a.useRef(new Map),kt=a.useRef(new Map),Ot=a.useRef(new Map),qt=a.useRef(new Map),Ht=a.useMemo(()=>oe?oe.cardType==="vocab"?t.cogita.library.revision.vocabLabel:oe.infoType?Oe(t,oe.infoType):t.cogita.library.revision.infoLabel:"",[t,oe]),Yt=a.useMemo(()=>{var h;return w.id!=="levels"?S.length:((h=ct.pool)==null?void 0:h.length)??w.getFetchLimit(Y,g)},[ct,g,w,S.length,Y]),Ut=w.getProgressTotal?w.getProgressTotal(S,ct,Y,g):w.id==="levels"?Math.min(Y,Yt):S.length,$t=Ut?Math.min(pe+1,Ut):0,Ct=Math.max(1,Number(g.tries??1)),ft=g.compare??"anchors",it=Math.max(0,Math.min(100,Number(g.minCorrectness??0))),rt=(g.considerDependencies??"on")==="on",nt=Math.max(0,Math.min(100,Number(g.dependencyThreshold??85))),Rt=i=>{const h=i.slice();for(let j=h.length-1;j>0;j-=1){const f=Math.floor(Math.random()*(j+1));[h[j],h[f]]=[h[f],h[j]]}return h},Gt=i=>i.length?i.reduce((j,f)=>j+f,0)/i.length/255*100:0,Wt=i=>Gt(i)>=it,na=async()=>{const i=await Dt(),h=new Map,j=new Map,f=new Map;i.forEach(M=>{const F=`${M.itemType}:${M.itemId}`,J=Bt(M.itemType,M.itemId,M.checkType,M.direction);if(h.has(F)||h.set(F,[]),h.get(F).push(M),j.has(J)||j.set(J,[]),j.get(J).push(M),M.itemType==="info"&&M.checkType==="quote-fragment"&&M.direction){const Z=`${M.itemId}:${M.direction}`;f.has(Z)||f.set(Z,[]),f.get(Z).push(M)}});const P=new Map,b=new Map,A=new Map;return h.forEach((M,F)=>P.set(F,_t(M).score)),j.forEach((M,F)=>b.set(F,_t(M).score)),f.forEach((M,F)=>A.set(F,_t(M).score)),{itemKnowness:P,cardKnowness:b,fragmentKnowness:A}},Oa=async i=>{const h=[];let j=null;for(;;){const f=await $a({libraryId:d,collectionId:i,limit:200,cursor:j});if(h.push(...f.items),!f.nextCursor)break;j=f.nextCursor}return cs(h)},fa=async(i,h)=>{if(gt.current.has(i))return gt.current.get(i)??0;const j=await Oa(i);if(j.length===0)return gt.current.set(i,0),0;const P=j.reduce((b,A)=>{const M=ie(A);return b+(h.get(M)??0)},0)/j.length;return gt.current.set(i,P),P},Ua=(i,h)=>{if(!rt||i.cardType!=="info"||i.infoType!=="quote"||i.checkType!=="quote-fragment")return!0;const j=Nt(i.direction);if(!(j!=null&&j.fragmentId))return!0;const f=i.description??"";if(!f.trim())return!0;const b=ma(f).nodes[j.fragmentId];if(!b||!b.leftId&&!b.rightId)return!0;const A=[b.leftId,b.rightId].filter(J=>!!J);if(A.length===0)return!0;const M=A.map(J=>{const Z=Bt("info",i.cardId,"quote-fragment",ja(j.mode,J));return h.get(Z)??0});return M.reduce((J,Z)=>J+Z,0)/M.length>=nt},ia=async i=>{const h=ct,j=i.concat(h.active??[]).concat(h.pool??[]).filter((M,F,J)=>J.findIndex(Z=>ie(Z)===ie(M))===F);if(!rt){u(new Set(j.map(ie)));return}const{itemKnowness:f,cardKnowness:P}=await na(),b=Pt.filter(M=>ut(M.childItemType)==="collection"&&M.childItemId===N&&!ut(M.childCheckType)&&!ut(M.childDirection)),A=new Set;for(const M of j){if(M.cardType!=="info"){A.add(ie(M));continue}if(!Ua(M,P))continue;const F=Pt.filter(ce=>rn(ce,M)).concat(b);if(F.length===0){A.add(ie(M));continue}let J=0;for(const ce of F)if(ut(ce.parentItemType)==="collection")J+=await fa(ce.parentItemId,P);else if(ut(ce.parentCheckType)||ut(ce.parentDirection)){const ne=ut(ce.parentCheckType),Te=ut(ce.parentDirection),Me=Bt(ce.parentItemType,ce.parentItemId,ne,Te);J+=P.get(Me)??0}else{const ne=`${ce.parentItemType}:${ce.parentItemId}`;J+=f.get(ne)??0}J/F.length>=nt&&A.add(ie(M))}u(A)},Wa=i=>{for(let h=i;h<S.length;h+=1){const j=S[h];if(j&&(!rt||j.cardType!=="info"||yt.has(ie(j))))return h}return-1},Mt=i=>!rt||i.cardType!=="info"||yt.has(ie(i)),ra=i=>{if(w.id!=="temporal"&&w.id!=="levels")return null;const h=ct,j=(h.active??[]).concat(h.pool??[]),f=new Set;for(const P of j){const b=ie(P);if(!(f.has(b)||i.has(b))&&(f.add(b),Mt(P)))return P}return null},Et=a.useMemo(()=>{if(w.id!=="levels")return null;const i=ct,h=i.pool??[],j=i.active??[],f=i.levelMap??{},P=Math.max(1,Number(g.levels??1)),b=Array.from({length:P},()=>0),A=new Set(j.map(Z=>ie(Z)));h.forEach(Z=>{const ce=Math.min(P,Math.max(1,f[ie(Z)]??1));b[ce-1]+=1});const M=h.length||1,F=b.map(Z=>Z/M*100),J=oe?f[ie(oe)]??1:null;return{counts:b,percentages:F,currentLevel:J,levelsCount:P,activeCount:j.length,poolCount:h.length,activeSet:A}},[ct,g,w,oe]),xt=a.useMemo(()=>{if(w.id!=="temporal")return null;const i=ct,h=i.pool??[],j=i.active??[],f=i.knownessMap??{},P=new Set(i.unknownSet??[]);let b=0;h.forEach(F=>{(f[ie(F)]??0)>1&&(b+=1)});const A=P.size,M=j.map(F=>({id:ie(F),value:P.has(ie(F))?0:Math.max(0,Math.min(1,f[ie(F)]??0))}));return{knownCount:b,unknownCount:A,dots:M}},[ct,w]),oa=a.useMemo(()=>{if(!rt)return 0;const i=ct;return S.concat(i.active??[]).concat(i.pool??[]).filter((j,f,P)=>P.findIndex(b=>ie(b)===ie(j))===f).filter(j=>j.cardType==="info"&&!yt.has(ie(j))).length},[rt,ct,S,yt]);a.useEffect(()=>{if(!rt||ae!=="ready")return;const i=ct,j=S.concat(i.active??[]).concat(i.pool??[]).filter((b,A,M)=>M.findIndex(F=>ie(F)===ie(b))===A).filter(b=>b.cardType!=="info"||yt.has(ie(b))).length,f=Ye.current;if(Ye.current=j,f===null||j<=f)return;const P=j-f;jt(`New card available (+${P})`),Ze.current&&window.clearTimeout(Ze.current),Ze.current=window.setTimeout(()=>jt(null),2200)},[rt,ae,ct,S,yt]),a.useEffect(()=>()=>{Ze.current&&window.clearTimeout(Ze.current)},[]);const vt=(i,h)=>{const j=w.applyOutcome({queue:S,meta:ct},oe,Y,g,{correct:i,correctness:h,createdUtc:new Date().toISOString()});R(j.queue),St(j.meta);const f=j.queue[pe+1];f&&ba(f,pe+1)};a.useEffect(()=>{_a(d,N).then(i=>G(i.name)).catch(()=>G(t.cogita.library.collections.defaultName))},[d,N]),a.useEffect(()=>{us({libraryId:d,type:"language"}).then(i=>te(i)).catch(()=>te([]))},[d]),a.useEffect(()=>{qs({libraryId:d}).then(i=>zt(i.items??[])).catch(()=>zt([]))},[d]),a.useEffect(()=>{as(d,z)},[d,z]),a.useEffect(()=>{ia(S)},[S,Pt,rt,nt,N]),a.useEffect(()=>{if(!oe||!rt){me(!1);return}if(oe.cardType!=="info"||yt.has(ie(oe))){me(!1);return}const i=Wa(pe+1);if(i>=0){me(!1),v(i);return}if(w.id==="temporal"||w.id==="levels"){const h=S.slice(0,pe+1),j=S.slice(pe+1).filter(Mt),f=h.concat(j),P=new Set(f.map(ie)),b=ra(P);if(b){const M=ie(b);P.has(M)||(f.push(b),P.add(M),St(F=>{const J=F,Z=new Set(J.queued??[]);return Z.add(M),{...J,queued:Z}}))}const A=f.findIndex((M,F)=>F!==pe&&Mt(M));if(A>=0){R(f),v(A),me(!1);return}}me(!0)},[oe,yt,rt,pe,S,ct,w.id]),a.useEffect(()=>{let i=!0;return(async()=>{Pe("loading"),C({current:0,total:w.id==="levels"?0:w.getFetchLimit(Y,g)});try{const j=[];let f=null,P=null;do{const ce=await $a({libraryId:d,collectionId:N,limit:300,cursor:f});if(j.push(...ce.items),(w.id==="levels"||w.id==="temporal")&&ce.total&&(P=ce.total),C(ne=>({current:j.length,total:ne.total||ce.total||w.getFetchLimit(Y,g)})),f=ce.nextCursor??null,P!==null&&j.length>=P||w.id!=="levels"&&w.id!=="temporal"&&j.length>=w.getFetchLimit(Y,g))break}while(f);if(!i)return;const b=cs(j);let A;if(w.id==="levels"){const ce=Math.max(1,Number(g.levels??1)),Te=(await Dt()).reduce((Me,De)=>{const Ve=Bt(De.itemType,De.itemId,De.checkType,De.direction);return Me[Ve]||(Me[Ve]=[]),Me[Ve].push(De),Me},{});A={},b.forEach(Me=>{const De=ie(Me),Ve=Te[De]??[],dt=Ve.length>0?_t(Ve).score:0,ta=Math.max(1,Math.min(ce,Math.ceil(dt/100*ce)));A[De]=ta})}let M=null,F=null,J=null;if(w.id==="temporal"){const ce=await Dt(),ne=new Set(b.map(De=>ie(De))),Te=ce.reduce((De,Ve)=>{const dt=Bt(Ve.itemType,Ve.itemId,Ve.checkType,Ve.direction);return ne.has(dt)&&(De[dt]||(De[dt]=[]),De[dt].push(Ve)),De},{});M={},F=new Set,J={};const Me=Date.now();b.forEach(De=>{const Ve=ie(De),dt=Te[Ve]??[];if(dt.length===0){M[Ve]=0,F.add(Ve),J[Ve]=[];return}const ta=hs(dt);J[Ve]=ta;const ln=Da(ta,Me);M[Ve]=ln.knowness})}const Z=w.id==="levels"?ms(b,Y,g,A):w.id==="temporal"?gs(b,Y,g,M??{},F??new Set,J??{}):w.prepare(b,Y,g);R(Z.queue),St(Z.meta),v(0),Pe("ready"),C(ce=>({current:Math.min(ce.current,ce.total),total:ce.total}))}catch{i&&Pe("error")}})(),()=>{i=!1}},[d,N,Y,g,w,z]),a.useEffect(()=>{if(he(""),q(null),ot(null),tt(0),ke([]),Je({}),K({}),le(null),_e(null),ge(null),Ee(!1),Xe(!1),We(null),X(null),$({}),!oe){Ie(null),Ae(null),qe(null),st(null);return}oe.cardType==="info"&&oe.infoType==="computed"&&Ie(t.cogita.library.revision.loadingComputed);let i=!0;return ba(oe,pe).then(h=>{!i||!h||(Ie(h.prompt),Ae(h.expectedAnswer),ke(h.computedExpected),Je(h.computedAnswers),qe(h.computedValues),le(h.answerTemplate),_e(h.outputVariables),ge(h.variableValues))}),()=>{i=!1}},[oe,t]),a.useEffect(()=>{if(!oe||oe.cardType!=="info"||oe.infoType!=="quote"){Fe.current=null,et.current=new Set,ze(null);return}const i=oe.description??"",h=(oe.label??"").trim(),j=h.replace(/\s+/g," ").trim(),f=i.replace(/\s+/g," ").trim(),P=j&&j!==f?h:t.cogita.library.infoTypes.quote;if(!i){ze(null),Ae(null);return}const b=ma(i);Fe.current=b,Ie(P);let A=!0;return na().then(({fragmentKnowness:M})=>{if(!A)return;const F=getQuoteMode(oe.direction),J=new Set,Z={};M.forEach((Te,Me)=>{const[De,Ve]=Me.split(":",2);if(De!==oe.cardId)return;const dt=Nt(Ve);if(!dt||dt.mode!==F)return;const ta=dt.fragmentId;Z[ta]=Te,Te>=nt&&J.add(ta)}),et.current=J,at.current=Z;const ce=Nt(oe.direction);if(ce!=null&&ce.fragmentId&&b.nodes[ce.fragmentId]){Kt(b,ce.fragmentId,P);return}const ne=ha(b,J,Z,nt,rt,oe.direction);Kt(b,(ne==null?void 0:ne.id)??null,P)}).catch(()=>{et.current=new Set,at.current={};const M=Nt(oe.direction);if(M!=null&&M.fragmentId&&b.nodes[M.fragmentId]){Kt(b,M.fragmentId,P);return}const F=ha(b,et.current,{},nt,rt,oe.direction);Kt(b,(F==null?void 0:F.id)??null,P)}),()=>{A=!1}},[oe,t,rt,nt]),a.useEffect(()=>{if(!oe||oe.cardType!=="vocab"||oe.checkType!=="translation-match"){X(null),$({});return}const j=(ct.pool??ct.active??S).filter(M=>M.cardType==="vocab"&&M.checkType==="translation-match").filter((M,F,J)=>J.findIndex(Z=>Z.cardId===M.cardId)===F);j.some(M=>M.cardId===oe.cardId)||j.unshift(oe);const P=Rt(j).slice(0,6).map(M=>{const F=M.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(F.length<2)return null;const J=`${M.cardId}:L`,Z=`${M.cardId}:R`;return{cardId:M.cardId,leftId:J,rightId:Z,leftLabel:F[0],rightLabel:F[1]}}).filter(Boolean),b=P.map(M=>M.leftId),A=Rt(P.map(M=>M.rightId));X({pairs:P,leftOrder:b,rightOrder:A,selection:{},activeLeft:null,activeRight:null,locked:{}})},[oe,S,ct]),a.useEffect(()=>()=>{xe.current&&window.clearTimeout(xe.current),$e.current&&window.clearTimeout($e.current)},[]);const Xt=a.useRef(null);a.useEffect(()=>{if(!oe)return;const i=ie(oe),h=typeof document<"u"?document.activeElement:null;if(Xt.current===i&&h&&(h.tagName==="INPUT"||h.tagName==="TEXTAREA"))return;let j=0;const f=()=>{if(oe){if(oe.cardType==="info"&&oe.infoType==="computed"){if(Ke.length>0){const b=Ba(Se,Ke,Le),A=b?Ft.current[b]:null;if(A&&(A.focus(),document.activeElement===A)){Xt.current=i;return}}if(lt.current&&(lt.current.focus(),document.activeElement===lt.current)){Xt.current=i;return}}else if(oe.cardType==="vocab"&&lt.current&&(lt.current.focus(),document.activeElement===lt.current)){Xt.current=i;return}j<6&&(j+=1,window.setTimeout(f,40))}},P=window.setTimeout(f,40);return()=>window.clearTimeout(P)},[oe,Ke,Se,Le]),a.useEffect(()=>{if(!bt)return;const i=h=>{h.key==="Enter"&&(h.preventDefault(),ca())};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[bt]);const Jt=i=>{Ge(i),st(_t(i))};a.useEffect(()=>{if(!oe){st(null),Ge([]);return}const i=oe.cardType==="info"?"info":"connection";if(oe.cardType==="info"&&oe.infoType==="quote"){Dt().then(h=>{const j=h.filter(f=>f.itemType==="info"&&f.itemId===oe.cardId&&f.checkType==="quote-fragment"&&za(f.direction,oe.direction));Jt(j)}).catch(()=>{st(null),Ge([])});return}Fa(i,oe.cardId,oe.checkType,oe.direction).then(h=>Jt(h)).catch(()=>{st(null),Ge([])})},[d,oe,z]);const Na=(i,h,j,f)=>{if(i==="info"&&j==="quote-fragment"){Dt().then(P=>{const b=P.filter(A=>A.itemType==="info"&&A.itemId===h&&A.checkType==="quote-fragment"&&za(A.direction,f));Jt(b)}).catch(()=>{st(null),Ge([])});return}Fa(i,h,j,f).then(P=>Jt(P)).catch(()=>{st(null),Ge([])})},Ta=(i,h,j)=>{var A;const f=((A=j.pairs.find(M=>M.leftId===i))==null?void 0:A.rightId)??null;if(!f)return j;const P=f===h;$(M=>({...M,[i]:P?"correct":"incorrect"})),xe.current&&window.clearTimeout(xe.current),$e.current&&window.clearTimeout($e.current),V.current+=1;const b={kind:P?"correct":"incorrect",tick:V.current};if(Ce(null),xe.current=window.setTimeout(()=>Ce(b),0),$e.current=window.setTimeout(()=>Ce(null),420),P){const M={...j.locked,[i]:!0};return Object.keys(M).length>=j.pairs.length?(q("correct"),Xe(!0)):q("correct"),{...j,selection:{...j.selection,[i]:h},activeLeft:null,activeRight:null,locked:M}}return q("incorrect"),{...j,activeLeft:null,activeRight:null}},la=i=>{X(h=>!h||h.locked[i]?h:h.activeRight?Ta(i,h.activeRight,h):{...h,activeLeft:h.activeLeft===i?null:i})},At=i=>{X(h=>h&&(h.activeLeft?Ta(h.activeLeft,i,h):{...h,activeRight:h.activeRight===i?null:i}))},ca=()=>{var i;if(oe&&oe.cardType==="info"&&oe.infoType==="quote"&&Fe.current&&je&&!((i=Nt(oe.direction))!=null&&i.fragmentId)){const h=ha(Fe.current,et.current,at.current,nt,rt,oe.direction,je.fragmentId);if(h){q(null),he(""),Ee(!1),K({}),Xe(!1),ot(null),tt(0),Kt(Fe.current,h.id,je.title);return}}q(null),he(""),Ee(!1),K({}),Xe(!1),ot(null),tt(0),v(h=>Math.min(h+1,S.length))},It=i=>{if(!oe)return;const h=i.expected??null,j=i.answer??"";let f=h??"",P=j;if(!h&&i.expectedMap&&i.answerMap){const ce=Object.keys(i.expectedMap).sort((ne,Te)=>ne.localeCompare(Te));f=ce.map(ne=>{var Te;return((Te=i.expectedMap)==null?void 0:Te[ne])??""}).join("|"),P=ce.map(ne=>{var Te;return((Te=i.answerMap)==null?void 0:Te[ne])??""}).join("|")}const b=f?ga(f,P,ft):new Uint8Array,A={revisionType:w.id,evalType:i.evalType,direction:i.direction,prompt:ye??"",expected:h,answer:j,expectedAnswers:i.expectedMap??null,answers:i.answerMap??null,correct:i.correct,maskBase64:b.length?Qt(b):null,values:H??null,checkMode:re,compareMode:ft,minCorrectness:it},M=new TextEncoder().encode(JSON.stringify(A)),F=oe.cardType==="info"?"info":"connection",J=i.overrideCheckType??oe.checkType??null,Z=i.overrideDirection??oe.direction??null;Aa({itemType:F,itemId:oe.cardId,checkType:J,direction:Z,revisionType:w.id,evalType:i.evalType,correct:i.correct,maskBase64:b.length?Qt(b):null,payloadBase64:Qt(M),personRoleId:z??null}).then(()=>{Na(F,oe.cardId,J,Z),ia(S),as(d,z)}).catch(()=>{})},Zt=(i,h)=>{const j=pt.current.get(h);if(j)return Promise.resolve(j);const f=kt.current.get(h);if(f)return f;const P=ua({libraryId:d,infoId:i}).then(b=>{var ce,ne;const A=b.payload,M=((ce=A.definition)==null?void 0:ce.graph)??null,F="",J=((ne=A.definition)==null?void 0:ne.answerTemplate)??"",Z=Js(M,F,J);if(Z){const Me={sample:Zs(Z),answerTemplate:J||null};return pt.current.set(h,Me),Me}return ys({libraryId:d,infoId:i}).then(Te=>{const Me={sample:Te,answerTemplate:null};return pt.current.set(h,Me),Me})}).catch(()=>ys({libraryId:d,infoId:i}).then(b=>{const A={sample:b,answerTemplate:null};return pt.current.set(h,A),A}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{kt.current.delete(h)});return kt.current.set(h,P),P},ba=(i,h)=>{var M;const j=`${ie(i)}:${h}`,f=Ot.current.get(j);if(f)return Promise.resolve(f);const P=qt.current.get(j);if(P)return P;const b=F=>(Ot.current.set(j,F),F);let A;if(i.cardType==="vocab"){if(i.checkType==="translation-match")return A=Promise.resolve(b({prompt:i.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),A;const F=i.label.split("↔").map(J=>J.trim()).filter(Boolean);if(F.length>=2){const Z=(i.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ce=Z?F[0]:F[1],ne=Z?F[1]:F[0];A=Promise.resolve(b({prompt:ce,expectedAnswer:ne,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else A=Promise.resolve(b({prompt:i.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(i.cardType==="info"&&i.infoType==="word"){const F=(M=i.description)!=null&&M.startsWith("Language: ")?i.description.replace("Language: ",""):null;A=Promise.resolve(b({prompt:i.label,expectedAnswer:F,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else i.cardType==="info"&&i.infoType==="computed"?A=Zt(i.cardId,j).then(F=>{var Te,Me;if(!F.sample)return b({prompt:i.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const J=F.sample,Z=J.expectedAnswers?Object.entries(J.expectedAnswers).map(([De,Ve])=>({key:De,expected:Ve})):[],ce=Z.reduce((De,Ve)=>(De[Ve.key]="",De),{}),ne=J.expectedAnswerIsSentence&&((Te=J.expectedAnswer)==null?void 0:Te.trim())||null;return b({prompt:J.prompt,expectedAnswer:Z.length>0?ne:((Me=J.expectedAnswer)==null?void 0:Me.trim())||null,computedExpected:Z,computedAnswers:ce,computedValues:J.values??null,answerTemplate:F.answerTemplate,outputVariables:J.outputVariables??null,variableValues:J.variableValues??null})}).catch(()=>b({prompt:i.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{qt.current.delete(j)}):A=Promise.resolve(b({prompt:i.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return qt.current.set(j,A),A},Kt=(i,h,j)=>{const f=Object.keys(i.nodes).length,P=et.current.size;if(!h){ze({title:j,before:i.text,after:"",fragmentId:null,total:f,completed:P}),Ae(null),Xe(!0);return}const b=i.nodes[h];if(!b)return;const A=Hs(i.text,b);ze({title:j,before:A.before,after:A.after,fragmentId:b.id,total:f,completed:P}),Ae(A.fragment),Xe(!1)},Sa=()=>{const i=Fe.current;i&&ze(h=>h&&{...h,total:Object.keys(i.nodes).length,completed:et.current.size})},da=()=>{const i=S[pe+1];i&&ba(i,pe+1)},Ca=()=>{if(da(),oe&&oe.cardType==="vocab"&&oe.checkType==="translation-match"&&I){if(I.pairs.length===0){q("incorrect"),Xe(!0);return}const b=I.pairs.reduce((ne,Te)=>(ne[Te.rightId]=Te.rightLabel,ne),{});let A=0;const M={};I.pairs.forEach(ne=>{const Me=I.selection[ne.leftId]===ne.rightId;M[ne.leftId]=Me?"correct":"incorrect",Me&&(A+=1)});const F=I.pairs.length||1,J=A/F,Z=A===I.pairs.length;$(ne=>({...ne,...M})),Z?(q("correct"),Xe(!0),tt(0)):(q("incorrect"),Xe(!1),tt(ne=>{const Te=ne+1;return Te>=Ct&&(Ee(!0),Xe(!0),X(Me=>{if(!Me)return Me;const De=Me.pairs.reduce((Ve,dt)=>(Ve[dt.leftId]=dt.rightId,Ve),{});return{...Me,selection:De}})),Te})),vt(Z,J);const ce="connection";Promise.all(I.pairs.map(ne=>{const Te=I.selection[ne.leftId]??null,Me=Te?b[Te]:"",De={left:ne.leftLabel,expected:ne.rightLabel,answer:Me,checkType:"translation-match"},Ve=new TextEncoder().encode(JSON.stringify(De));return Aa({itemType:ce,itemId:ne.cardId,checkType:"translation-match",direction:null,revisionType:w.id,evalType:"translation-match",correct:Te===ne.rightId,maskBase64:null,payloadBase64:Qt(Ve),personRoleId:z??null})})).then(()=>{Na(ce,oe.cardId,oe.checkType,oe.direction),as(d,z)}).catch(()=>{});return}if(Ke.length>0){const b=Ke.reduce((M,F)=>{const J=Be[F.key]??"";return M[F.key]=wt(J)===wt(F.expected)?"correct":"incorrect",M},{});Ke.every(({key:M,expected:F})=>{const J=Be[M]??"";return re==="exact"&&wt(J)===wt(F)})?(q("correct"),K(b),Xe(!0),tt(0),vt(!0,1),It({correct:!0,direction:ye?`${ye} -> computed`:"computed",expectedMap:Ke.reduce((M,F)=>(M[F.key]=F.expected,M),{}),answerMap:Be,evalType:"computed"})):(q("incorrect"),K(b),Xe(!1),tt(M=>{const F=M+1;return F>=Ct&&_&&(Ee(!0),Xe(!0)),F}),vt(!1,0),window.setTimeout(()=>{var F;const M=Ba(Se,Ke,Le);M&&Ft.current[M]&&((F=Ft.current[M])==null||F.focus())},40),It({correct:!1,direction:ye?`${ye} -> computed`:"computed",expectedMap:Ke.reduce((M,F)=>(M[F.key]=F.expected,M),{}),answerMap:Be,evalType:"computed"}));return}if(oe&&oe.cardType==="info"&&oe.infoType==="quote"&&(je!=null&&je.fragmentId)){if(!be)return;const b=Nt(oe.direction),A=(b==null?void 0:b.mode)??getQuoteMode(oe.direction),M=b!=null&&b.fragmentId&&oe.direction?oe.direction:ja(A,je.fragmentId),F=nn(be,D,ft),J=re==="exact"&&pa(D)===pa(be),Z=Wt(F),ce=J||Z,ne=Gt(F);ce?(at.current[je.fragmentId]=Math.max(at.current[je.fragmentId]??0,ne),(at.current[je.fragmentId]??0)>=nt&&et.current.add(je.fragmentId),Sa(),q("correct"),K({}),Xe(!0),ot(F),tt(0),ne<100&&Ct<=1&&Ee(!0),vt(!0,ne/100),It({correct:!0,direction:`quote:${je.fragmentId}`,expected:be,answer:D,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:M})):(q("incorrect"),K({}),Xe(!1),ot(F),tt(Te=>{const Me=Te+1;return Me>=Ct&&_&&(Ee(!0),Xe(!0)),Me}),vt(!1,ne/100),window.setTimeout(()=>{var Te;return(Te=lt.current)==null?void 0:Te.focus()},40),It({correct:!1,direction:`quote:${je.fragmentId}`,expected:be,answer:D,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:M}));return}if(!be)return;const i=ga(be,D,ft),h=re==="exact"&&wt(D)===wt(be),j=Wt(i),f=h||j,P=Gt(i);f?(q("correct"),K({}),Xe(!0),ot(i),tt(0),P<100&&Ct<=1&&Ee(!0),vt(!0,P/100),It({correct:!0,direction:ye?`${ye} -> ${be}`:null,expected:be,answer:D,evalType:"text"})):(q("incorrect"),K({}),Xe(!1),ot(i),tt(b=>{const A=b+1;return A>=Ct&&_&&(Ee(!0),Xe(!0)),A}),vt(!1,P/100),window.setTimeout(()=>{var b;return(b=lt.current)==null?void 0:b.focus()},40),It({correct:!1,direction:ye?`${ye} -> ${be}`:null,expected:be,answer:D,evalType:"text"}))},Qa=i=>{if(da(),!be)return;const h=ga(be,i,ft),j=wt(i)===wt(be),f=Wt(h),P=j||f,b=Gt(h);P?(q("correct"),K({}),Xe(!0),ot(h),tt(0),b<100&&Ct<=1&&Ee(!0),vt(!0,b/100),It({correct:!0,direction:"word->language",expected:be,answer:i,evalType:"language-select"})):(q("incorrect"),K({}),Xe(!1),ot(h),tt(A=>{const M=A+1;return M>=Ct&&_&&(Ee(!0),Xe(!0)),M}),vt(!1,b/100),It({correct:!1,direction:"word->language",expected:be,answer:i,evalType:"language-select"}))},Ha=()=>{da(),q("correct"),Xe(!0),tt(0),vt(!0,1),be&&It({correct:!0,direction:"manual",expected:be,answer:D,evalType:"manual"})},Ya=()=>{if(vt(!1,0),oe&&oe.cardType==="info"&&oe.infoType==="quote"){q(null),he(""),Ee(!1),K({}),Xe(!1),ot(null),tt(0),v(i=>Math.min(i+1,S.length));return}ca()};a.useEffect(()=>{da()},[pe,S]);const ea=i=>{var j;if(i.key!=="Enter")return;if(i.preventDefault(),i.stopPropagation(),bt){ca();return}const h=Ke.find(f=>!(Be[f.key]??"").trim());if(h){(j=Ft.current[h.key])==null||j.focus();return}Ca()},T=t.cogita.library.revision.revealModeAfterIncorrect,_=Ke.length>0||!!be;return e.jsxs(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:[ae==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ue.total?Math.min(100,Math.max(0,ue.current/ue.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ue.total?`${Math.min(ue.current,ue.total)} / ${ue.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:L}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",m).replace("{check}",U)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:O,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${O}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${O}/collections/${N}`,children:t.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Ne?`${Ne.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Et?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Et.currentLevel??"-"," / ",Et.levelsCount]}):null,Ne?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(Ne.correct)).replace("{total}",String(Ne.total))}),Ne.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(Ne.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(tn,{outcomes:Qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[mt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:mt})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":fe?`${fe.kind}-${fe.tick}`:se?"idle":Q??"idle",children:oe?e.jsx(e.Fragment,{children:ve?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(en,{copy:t,currentCard:oe,currentTypeLabel:Ht,prompt:ye,languages:ee,answer:D,onAnswerChange:i=>he(h=>Ka(h,i,Ue)),computedExpected:Ke,computedAnswers:Be,onComputedAnswerChange:(i,h)=>Je(j=>({...j,[i]:Ka(j[i]??"",h,Ue)})),answerTemplate:Se,outputVariables:Le,variableValues:B,computedFieldFeedback:He,feedback:Q,canAdvance:bt,quoteContext:je,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ca,onSkip:Ya,onLanguageSelect:Qa,onMarkReviewed:Ha,onAdvance:ca,showCorrectAnswer:Re,setShowCorrectAnswer:Ee,onRevealCorrect:()=>Xe(!0),answerMask:ht,expectedAnswer:be,hasExpectedAnswer:_,handleComputedKeyDown:ea,answerInputRef:lt,computedInputRefs:Ft,scriptMode:Ue,setScriptMode:We,matchPairs:I==null?void 0:I.pairs,matchLeftOrder:I==null?void 0:I.leftOrder,matchRightOrder:I==null?void 0:I.rightOrder,matchSelection:I==null?void 0:I.selection,matchActiveLeft:I==null?void 0:I.activeLeft,matchActiveRight:I==null?void 0:I.activeRight,matchFeedback:we,onMatchLeftSelect:la,onMatchRightSelect:At})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${O}/collections/${N}`,children:t.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Ut?`${$t} / ${Ut}`:t.cogita.library.revision.progressUnlimited}),ae==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),ae==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),ae==="ready"&&S.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:T}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",Ct]})]})]}),Et?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Et.activeCount," / ",Et.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Et.counts.map((i,h)=>{const j=h+1,f=Et.currentLevel===j,P=Et.percentages[h]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":f,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:j}),e.jsx("strong",{children:i})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,P))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[P.toFixed(1),"%"]})]},`level-${j}`)})})]}):null,xt?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:xt.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:xt.dots.map(i=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,i.value*100))}%`,background:`rgba(${Math.round(255*(1-i.value))}, ${Math.round(200*i.value)}, 80, 0.9)`}},i.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:xt.knownCount})]})]}):null,rt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:oa})]})}):null]})]})]})})})]})]})}const ss=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],$i={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Ri=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Ei=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Ai({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:d,collectionId:N}){const[c,o]=a.useState(""),[O,de,Y]=Rs([]),[W,w,g]=Es([]),[re,z]=a.useState(null),[m,U]=a.useState(null),[L,G]=a.useState(null),S=`/#/cogita/library/${d}`;a.useEffect(()=>{_a(d,N).then(C=>o(C.name)).catch(()=>o(t.cogita.library.collections.defaultName))},[d,N,t]),a.useEffect(()=>{Tn({libraryId:d,collectionId:N}).then(C=>{if(!C.graphId||C.graphId==="00000000-0000-0000-0000-000000000000"){de([]),w([]);return}const pe=C.nodes.map(D=>{var ye;const he=D.payload??{},Q=he.position??{x:120,y:120},q=he.params??{};return{id:D.nodeId,type:"default",position:Q,data:{nodeType:D.nodeType,label:((ye=ss.find(Ie=>Ie.type===D.nodeType))==null?void 0:ye.label)??D.nodeType,params:q}}}),v=C.edges.map(D=>({id:D.edgeId,source:D.fromNodeId,target:D.toNodeId,sourceHandle:D.fromPort??void 0,targetHandle:D.toPort??void 0}));de(pe),w(v)}).catch(()=>{de([]),w([])})},[d,N,w,de]);const R=a.useMemo(()=>O.find(C=>C.id===re)??null,[O,re]),ee=C=>{var he;const pe=crypto.randomUUID(),v=((he=ss.find(Q=>Q.type===C))==null?void 0:he.label)??C,D={...$i[C]};de(Q=>[...Q,{id:pe,type:"default",position:{x:120+Q.length*40,y:120+Q.length*40},data:{nodeType:C,label:v,params:D}}]),z(pe)},te=a.useCallback(C=>{w(pe=>As({...C,id:crypto.randomUUID()},pe))},[w]),ae=async()=>{U(null);try{await Cn({libraryId:d,collectionId:N,nodes:O.map(C=>({nodeId:C.id,nodeType:C.data.nodeType,payload:{position:C.position,params:C.data.params}})),edges:W.map(C=>({edgeId:C.id,fromNodeId:C.source,fromPort:C.sourceHandle??null,toNodeId:C.target,toPort:C.targetHandle??null}))}),U(t.cogita.library.graph.saveSuccess)}catch{U(t.cogita.library.graph.saveFail)}},Pe=async()=>{try{const C=await Sn({libraryId:d,collectionId:N});G(C)}catch{G(null)}},ue=C=>{R&&de(pe=>pe.map(v=>v.id===R.id?{...v,data:{...v.data,params:C}}:v))};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${S}/collections/${N}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Pe,children:t.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ae,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:ss.map(C=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ee(C.type),children:C.label},C.type))}),m?e.jsx("p",{className:"cogita-help",children:m}):null,L&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(L.total))}),e.jsx("p",{children:t.cogita.library.graph.previewBreakdown.replace("{connections}",String(L.connections)).replace("{infos}",String(L.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Fs,{nodes:O,edges:W,onNodesChange:Y,onEdgesChange:g,onConnect:te,onNodeClick:(C,pe)=>z(pe.id),fitView:!0,children:[e.jsx(Ps,{color:"rgba(120,160,200,0.2)"}),e.jsx(zs,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),R?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:R.data.label}),R.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(sa,{libraryId:d,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:R.data.params.tagId?{id:R.data.params.tagId,label:R.data.params.tagLabel??"",infoType:"topic"}:null,onChange:C=>ue({...R.data.params,tagId:(C==null?void 0:C.id)??null,tagLabel:(C==null?void 0:C.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:R.data.params.scope??"any",onChange:C=>ue({...R.data.params,scope:C.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),R.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(sa,{libraryId:d,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:R.data.params.languageId?{id:R.data.params.languageId,label:R.data.params.languageLabel??"",infoType:"language"}:null,onChange:C=>ue({...R.data.params,languageId:(C==null?void 0:C.id)??null,languageLabel:(C==null?void 0:C.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:R.data.params.scope??"any",onChange:C=>ue({...R.data.params,scope:C.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),R.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:R.data.params.infoType??"word",onChange:C=>ue({...R.data.params,infoType:C.target.value}),children:Ei.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))})]}),e.jsx(sa,{libraryId:d,infoType:R.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:R.data.params.infoId?{id:R.data.params.infoId,label:R.data.params.infoLabel??"",infoType:R.data.params.infoType??"word"}:null,onChange:C=>ue({...R.data.params,infoId:(C==null?void 0:C.id)??null,infoLabel:(C==null?void 0:C.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),R.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:R.data.params.connectionType??"translation",onChange:C=>ue({...R.data.params,connectionType:C.target.value}),children:Ri.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:R.data.params.connectionId??"",onChange:C=>ue({...R.data.params,connectionId:C.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(R.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const ns="cogita.preferences",on=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],is={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},rs=["settings","run","shared"];function Fi(t,s=""){const n=t.split("/").filter(Boolean);if(n[0]!=="cogita"||n[1]!=="library")return{};const r=n[2];if(!r)return{};if(!n[3])return{libraryId:r,target:"library_overview"};const l=new URLSearchParams(s),p=l.get("revisionId")??void 0,y=l.get("infoId")??void 0,x=l.get("infoView")==="cards"?"cards":"overview",E=l.get("collectionAction"),k=l.get("libraryAction");if(n[3]==="list")return{libraryId:r,target:k==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:p,infoId:y,infoView:x,libraryAction:k==="new-info"?"new-info":void 0};if(n[3]==="detail"||n[3]==="collection")return{libraryId:r,target:"all_cards",cardMode:n[3],revisionId:p,infoId:y,infoView:x};if(n[3]==="new"||n[3]==="add")return{libraryId:r,target:"new_card",revisionId:p,libraryAction:"new-info"};if(n[3]==="edit")return{libraryId:r,target:"new_card",revisionId:p,infoId:n[4]};if(n[3]==="shared-revisions")return{libraryId:r,target:"all_collections",revisionId:p};if(n[3]==="dependencies")return{libraryId:r,target:"dependencies"};if(n[3]==="transfer")return{libraryId:r,target:"transfer"};if(n[3]==="storyboards")return n[4]==="new"?{libraryId:r,target:"new_storyboard"}:{libraryId:r,target:"storyboards"};if(n[3]==="texts")return n[4]==="new"?{libraryId:r,target:"new_text"}:{libraryId:r,target:"texts"};if(n[3]!=="collections")return{libraryId:r,target:"library_overview"};if(n[4]==="new")return{libraryId:r,target:"new_collection",revisionId:p};const d=n[4];return d?n[5]==="graph"?{libraryId:r,target:"all_collections",collectionId:d,revisionId:p,revisionView:"graph"}:n[5]==="shared-revisions"?{libraryId:r,target:"all_collections",collectionId:d,revisionId:p,revisionView:"shared"}:n[5]==="revision"?{libraryId:r,target:"all_collections",collectionId:d,revisionId:p,revisionView:n[6]==="run"?"run":"settings"}:E==="new-revision"?{libraryId:r,target:"all_collections",collectionId:d,revisionId:p,revisionView:"new"}:{libraryId:r,target:"all_collections",collectionId:d,revisionId:p,revisionView:"detail"}:E==="new-collection"?{libraryId:r,target:"new_collection",collectionAction:"new-collection"}:{libraryId:r,target:"all_collections"}}function os(t,s="library_overview",n,r,l,p,y="overview"){const x=(E,k)=>{const d=new URLSearchParams;k!=null&&k.revisionId&&d.set("revisionId",k.revisionId),k!=null&&k.collectionAction&&d.set("collectionAction",k.collectionAction),k!=null&&k.libraryAction&&d.set("libraryAction",k.libraryAction),k!=null&&k.infoId&&d.set("infoId",k.infoId),k!=null&&k.infoView&&(k!=null&&k.infoId)&&d.set("infoView",k.infoView);const N=d.toString();return N?`${E}?${N}`:E};return t?s==="library_overview"?x(`/cogita/library/${t}`,{revisionId:l}):s==="all_cards"?x(`/cogita/library/${t}/list`,{revisionId:l,infoId:p,infoView:y}):s==="new_card"?p?x(`/cogita/library/${t}/edit/${p}`,{revisionId:l}):x(`/cogita/library/${t}/list`,{revisionId:l,libraryAction:"new-info"}):s==="all_collections"?n?r==="graph"?x(`/cogita/library/${t}/collections/${n}/graph`,{revisionId:l}):r==="settings"?x(`/cogita/library/${t}/collections/${n}/revision`,{revisionId:l}):r==="run"?x(`/cogita/library/${t}/collections/${n}/revision/run`,{revisionId:l}):r==="shared"?x(`/cogita/library/${t}/collections/${n}/shared-revisions`,{revisionId:l}):r==="new"?x(`/cogita/library/${t}/collections/${n}`,{revisionId:l,collectionAction:"new-revision"}):x(`/cogita/library/${t}/collections/${n}`,{revisionId:l}):x(`/cogita/library/${t}/collections`,{revisionId:l}):s==="new_collection"?x(`/cogita/library/${t}/collections`,{revisionId:l,collectionAction:"new-collection"}):s==="transfer"?x(`/cogita/library/${t}/transfer`,{revisionId:l}):s==="storyboards"?x(`/cogita/library/${t}/storyboards`,{revisionId:l}):s==="new_storyboard"?x(`/cogita/library/${t}/storyboards/new`,{revisionId:l}):s==="texts"?x(`/cogita/library/${t}/texts`,{revisionId:l}):s==="new_text"?x(`/cogita/library/${t}/texts/new`,{revisionId:l}):s==="dependencies"?x(`/cogita/library/${t}/dependencies`,{revisionId:l}):x(`/cogita/library/${t}`,{revisionId:l}):"/cogita"}function Ia(t){return t.length>1&&t.endsWith("/")?t.slice(0,-1):t}function Pi(t){return typeof t=="string"&&on.includes(t)}function zi(t,s){var x;if(!t.length)return null;const n=t.filter(E=>s.has(E.roleId)),r=n.length>0?n:t,l=r.map(E=>{var d,N;const k=((N=(d=E.fields.find(c=>c.fieldType==="role_kind"))==null?void 0:d.plainValue)==null?void 0:N.toLowerCase())??"";return{roleId:E.roleId,roleKind:k}}),p=l.find(E=>E.roleKind.includes("master"));if(p)return p.roleId;const y=l.find(E=>E.roleKind.includes("account")||E.roleKind.includes("user"));return y?y.roleId:((x=r[0])==null?void 0:x.roleId)??null}function Ki(t){if(!t)return{version:1,byLibrary:{}};try{const s=JSON.parse(t);return!s||typeof s!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:s.lastLibraryId,byLibrary:s.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Bi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k}){const d=$s(),N=ds(),c=a.useMemo(()=>Fi(N.pathname,N.search),[N.pathname,N.search]),o=t.cogita.workspace,[O,de]=a.useState([]),[Y,W]=a.useState([]),[w,g]=a.useState([]),[re,z]=a.useState([]),[m,U]=a.useState(void 0),[L,G]=a.useState("library_overview"),[S,R]=a.useState(void 0),[ee,te]=a.useState(void 0),[ae,Pe]=a.useState("detail"),[ue,C]=a.useState(void 0),[pe,v]=a.useState(!1),[D,he]=a.useState(!0),[Q,q]=a.useState(!1),[ye,Ie]=a.useState(!1),[be,Ae]=a.useState(null),[je,ze]=a.useState(0),[Ke,ke]=a.useState(""),[Be,Je]=a.useState(""),[He,K]=a.useState(""),[H,qe]=a.useState(null),[Se,le]=a.useState(null),Le=a.useRef({version:1,byLibrary:{}}),_e=a.useRef(!1),B=a.useRef(!1),ge=a.useRef(null),I=a.useMemo(()=>O.find(u=>u.libraryId===m)??null,[O,m]),X=a.useMemo(()=>Y.find(u=>u.collectionId===S)??null,[Y,S]),we=a.useMemo(()=>re.find(u=>u.revisionId===ee)??null,[re,ee]),$=a.useMemo(()=>({detail:o.revisions.detail,graph:o.revisions.graph,settings:o.revisions.settings,run:o.revisions.run,shared:o.targets.sharedRevisions,new:o.revisionForm.createAction}),[o.revisions.detail,o.revisions.graph,o.revisions.run,o.revisions.settings,o.targets.sharedRevisions,o.revisionForm.createAction]),V=a.useMemo(()=>[{value:"detail",label:$.detail},{value:"graph",label:$.graph},{value:"settings",label:o.targets.allRevisions},{value:"run",label:$.run},{value:"shared",label:$.shared}],[$.detail,$.graph,$.run,$.shared,o.targets.allRevisions]),fe=a.useMemo(()=>L==="new_card"?"all_cards":L==="new_collection"?"all_collections":L==="new_storyboard"?"storyboards":L==="new_text"?"texts":L,[L]),Ce=a.useMemo(()=>ae==="new"?"settings":ae,[ae]),xe=a.useMemo(()=>c.infoId?"selected":L==="new_card"?"create":"search",[c.infoId,L]),$e=a.useMemo(()=>w.find(u=>u.infoId===c.infoId)??null,[w,c.infoId]),Ue=a.useMemo(()=>({library_overview:o.targets.libraryOverview,all_cards:o.targets.allCards,new_card:o.targets.newCard,all_collections:o.targets.allCollections,new_collection:o.targets.newCollection,transfer:o.targets.transfer,storyboards:o.targets.storyboards,new_storyboard:o.targets.newStoryboard,texts:o.targets.texts,new_text:o.targets.newText,dependencies:o.targets.dependencies}),[o.targets]),We=a.useMemo(()=>Ue[fe]??fe,[fe,Ue]),Re=$[Ce],Ee=!!m,Ne=a.useMemo(()=>{const u=E==="pl"?"Ruch na teraz: utwórz bibliotekę i wpisz pierwszy element wiedzy.":E==="de"?"Nächster Schritt: Erstelle eine Bibliothek und füge den ersten Wissenseintrag hinzu.":"Next action: create one library and add your first knowledge item.";return E==="pl"?[{step:"Krok 1",title:"Czym jest Cogita?",lead:"To centrum budowania i prowadzenia procesu nauki po zalogowaniu.",passages:["W jednym miejscu łączysz treści, ćwiczenia i współpracę zespołu.","Zamiast luźnych notatek dostajesz spójny przepływ: biblioteka → kolekcja → powtórka."],focus:["Jedna przestrzeń robocza","Spójny proces"],action:u},{step:"Krok 2",title:"Zacznij od biblioteki",lead:"Biblioteka jest bazą dla całego tematu.",passages:["Nazwij bibliotekę jasno: np. „Historia Kościoła – semestr 1”.","Każdy kolejny moduł korzysta z tej samej biblioteki jako źródła."],focus:["Nazwa tematyczna","Jeden punkt startowy"],action:u},{step:"Krok 3",title:"Dodawaj informacje",lead:"Twórz krótkie, konkretne jednostki wiedzy.",passages:["Wpisy typu info opisują pojęcia, osoby, źródła i cytaty.","Małe jednostki łatwiej łączyć, powtarzać i aktualizować."],focus:["Krótko i konkretnie","Łatwe aktualizacje"],action:u},{step:"Krok 4",title:"Pracuj na typach",lead:"Formularze dostosowują się do rodzaju informacji.",passages:["Każdy typ pokazuje właściwe pola i porządkuje dane.","To zmniejsza chaos i poprawia jakość wyszukiwania."],focus:["Lepsza struktura","Mniej błędów"],action:u},{step:"Krok 5",title:"Łącz wiedzę linkami",lead:"Buduj kontekst przez relacje między wpisami.",passages:["Połącz temat z definicją, źródłem i przykładem.","Graf relacji pomaga zobaczyć, czego brakuje przed kolejnym etapem."],focus:["Relacje między wpisami","Pełniejszy kontekst"],action:u},{step:"Krok 6",title:"Twórz kolekcje celu",lead:"Kolekcja grupuje wpisy pod konkretny scenariusz.",passages:["Osobna kolekcja dla lekcji, osobna dla quizu lub egzaminu.","Nie duplikujesz treści — tylko wybierasz, co jest potrzebne."],focus:["Celowe grupowanie","Bez duplikatów"],action:u},{step:"Krok 7",title:"Dodawaj powtórki",lead:"Powtórka definiuje jak przebiega sprawdzanie.",passages:["Ustaw tempo, kolejność i zakres materiału.","Dla jednej kolekcji możesz mieć kilka powtórek o różnych poziomach."],focus:["Kontrola tempa","Różne poziomy"],action:u},{step:"Krok 8",title:"Info vs karta",lead:"Rozróżniaj źródło wiedzy i widok ćwiczeniowy.",passages:["Info to rekord bazowy, który przechowuje treść.","Karta to forma pytania/utrwalenia generowana z info."],focus:["Źródło danych","Widok ćwiczeń"],action:u},{step:"Krok 9",title:"Uruchamiaj sesję",lead:"Tryb Run prowadzi uczestników krok po kroku.",passages:["Prowadzący kontroluje rytm i przejścia między etapami.","Uczestnicy mają jasny przebieg bez zgadywania, co dalej."],focus:["Płynny przebieg","Lepsza dynamika grupy"],action:u},{step:"Krok 10",title:"Czytaj graf zależności",lead:"Graf pokazuje priorytety nauki.",passages:["Węzły centralne oznaczają tematy, które wpływają na wiele innych.","Najpierw utrwal fundamenty, potem przechodź do warstw zaawansowanych."],focus:["Priorytety materiału","Lepsza kolejność"],action:u},{step:"Krok 11",title:"Storyboard i teksty",lead:"Plan i notatki trzymaj blisko wiedzy źródłowej.",passages:["Storyboard układa narrację i przebieg spotkania.","Teksty zbierają komentarze, wnioski i gotowe treści do publikacji."],focus:["Lepsze przygotowanie","Notatki w kontekście"],action:u},{step:"Krok 12",title:"Udostępniaj bezpiecznie",lead:"Dziel się materiałem bez utraty kontroli.",passages:["Możesz dać dostęp tylko do odczytu dla wybranych osób.","Edycja pozostaje po stronie autora lub zespołu prowadzącego."],focus:["Kontrola uprawnień","Bezpieczne współdzielenie"],action:u},{step:"Krok 13",title:"Nawiguj warstwowo",lead:"Sidebar i breadcrumb prowadzą przez poziomy.",passages:["Zawsze widzisz, czy pracujesz na bibliotece, kolekcji czy powtórce.","Mniej kliknięć „w ciemno”, więcej świadomej nawigacji."],focus:["Orientacja w systemie","Szybsze decyzje"],action:u},{step:"Krok 14",title:"Plan wdrożenia 30 minut",lead:"Najpierw prosty pilot, potem rozwijaj.",passages:["Plan: 1 biblioteka, 10 wpisów info, 1 kolekcja, 1 powtórka testowa.","Po pierwszej sesji popraw strukturę i dodaj kolejne scenariusze."],focus:["Szybki start","Iteracyjne doskonalenie"],action:"Gotowe? Załóż bibliotekę po prawej i przejdź do pierwszego wpisu."}]:E==="de"?[{step:"Schritt 1",title:"Was ist Cogita?",lead:"Ein zentraler Workspace für Lernen und Moderation nach dem Login.",passages:["Du verbindest Inhalte, Übungen und Teamarbeit in einem Ablauf.","Der Prozess bleibt klar: Bibliothek → Sammlung → Wiederholung."],focus:["Ein Workspace","Klarer Ablauf"],action:u},{step:"Schritt 2",title:"Mit Bibliothek starten",lead:"Die Bibliothek ist der Startpunkt für dein Thema.",passages:["Vergib einen klaren Namen für Kurs oder Modul.","Alle weiteren Bereiche greifen auf diese Basis zu."],focus:["Sauberer Start","Gemeinsame Basis"],action:u},{step:"Schritt 3",title:"Infos anlegen",lead:"Erfasse Wissen in kleinen, klaren Einträgen.",passages:["Info-Einträge enthalten Begriffe, Personen, Quellen und Zitate.","Kleinere Einheiten lassen sich besser verknüpfen und trainieren."],focus:["Kleine Einheiten","Leicht wartbar"],action:u},{step:"Schritt 4",title:"Typbasierte Eingabe",lead:"Formulare passen sich automatisch dem Info-Typ an.",passages:["Dadurch bleiben Daten strukturiert und konsistent.","Das verbessert Qualität und Auffindbarkeit."],focus:["Konsistenz","Bessere Suche"],action:u},{step:"Schritt 5",title:"Wissen verlinken",lead:"Verbinde Einträge zu einem Kontextnetz.",passages:["Thema, Quelle und Beispiel werden als Beziehung sichtbar.","So erkennst du Lücken vor der nächsten Lernphase."],focus:["Kontextnetz","Lücken erkennen"],action:u},{step:"Schritt 6",title:"Ziel-Sammlungen bauen",lead:"Eine Sammlung bündelt Inhalte für einen konkreten Zweck.",passages:["Nutze getrennte Sammlungen für Unterricht, Quiz oder Prüfung.","Du wählst Inhalte aus statt sie zu kopieren."],focus:["Zielorientierung","Keine Duplikate"],action:u},{step:"Schritt 7",title:"Wiederholungen erstellen",lead:"Wiederholungen definieren den Prüfungsablauf.",passages:["Tempo, Reihenfolge und Umfang sind pro Wiederholung steuerbar.","Mehrere Wiederholungen pro Sammlung sind möglich."],focus:["Ablaufsteuerung","Mehrere Niveaus"],action:u},{step:"Schritt 8",title:"Info und Karte",lead:"Datenobjekt und Trainingsansicht sind getrennt.",passages:["Info ist die Quelle der Inhalte.","Die Karte ist die Übungsansicht für Frage und Antwort."],focus:["Sauberes Modell","Wiederverwendbar"],action:u},{step:"Schritt 9",title:"Sitzung durchführen",lead:"Im Run-Modus führst du die Gruppe Schritt für Schritt.",passages:["Moderation steuert Übergänge und Timing.","Teilnehmende folgen einem klaren Ablauf."],focus:["Klare Moderation","Stabile Dynamik"],action:u},{step:"Schritt 10",title:"Abhängigkeitsgraph lesen",lead:"Der Graph zeigt Lernprioritäten.",passages:["Zentrale Knoten beeinflussen viele weitere Themen.","Starte mit Grundlagen und baue danach auf."],focus:["Priorisierung","Lernreihenfolge"],action:u},{step:"Schritt 11",title:"Storyboard & Texte",lead:"Plane Ablauf und sammle Notizen im selben Kontext.",passages:["Storyboards strukturieren Sequenzen und Rollen.","Texte halten Erkenntnisse und veröffentlichungsreife Inhalte fest."],focus:["Planung","Dokumentation"],action:u},{step:"Schritt 12",title:"Sicher teilen",lead:"Teile Inhalte ohne Kontrollverlust.",passages:["Leserechte sind separat von Bearbeitungsrechten steuerbar.","So bleibt der Kernbestand geschützt."],focus:["Rechtekontrolle","Sicheres Teilen"],action:u},{step:"Schritt 13",title:"Ebenen-Navigation",lead:"Sidebar und Breadcrumb zeigen deinen aktuellen Kontext.",passages:["Du siehst sofort, auf welcher Ebene du arbeitest.","Das spart Zeit und reduziert Fehlklicks."],focus:["Orientierung","Effizienz"],action:u},{step:"Schritt 14",title:"30-Minuten-Startplan",lead:"Starte klein und erweitere iterativ.",passages:["Plan: 1 Bibliothek, 10 Infos, 1 Sammlung, 1 Test-Wiederholung.","Nach der ersten Runde verbesserst du Struktur und Ablauf."],focus:["Schneller Einstieg","Iteratives Vorgehen"],action:"Jetzt starten: Bibliothek rechts anlegen und den ersten Eintrag erfassen."}]:[{step:"Step 1",title:"What is Cogita?",lead:"A post-login workspace to design, run, and improve knowledge journeys.",passages:["You can keep content, training flow, and collaboration in one place.","The path stays explicit: library → collection → revision → session."],focus:["Single workspace","Clear learning flow"],action:u},{step:"Step 2",title:"Start with a library",lead:"Your library is the root container for one domain or program.",passages:["Name it after your course, cohort, or topic scope.","Every next module reuses this foundation."],focus:["Root container","Consistent base"],action:u},{step:"Step 3",title:"Add information units",lead:"Build knowledge from small, reusable info entries.",passages:["Capture terms, references, people, concepts, and citations.","Smaller entries are easier to link, review, and update."],focus:["Reusable units","Easy maintenance"],action:u},{step:"Step 4",title:"Use type-based forms",lead:"Each info type has a matching data structure and fields.",passages:["Form layouts adapt automatically to the selected type.","This improves consistency and lowers input mistakes."],focus:["Structured input","Fewer errors"],action:u},{step:"Step 5",title:"Link the knowledge graph",lead:"Relationships turn isolated facts into usable context.",passages:["Connect topics, sources, and supporting examples.","Dependency links show what must be learned first."],focus:["Context building","Better sequencing"],action:u},{step:"Step 6",title:"Build goal collections",lead:"Collections package selected infos for a concrete objective.",passages:["Create separate collections for class, quiz, exam, or workshop.","You curate from existing entries instead of duplicating content."],focus:["Goal-oriented sets","No duplication"],action:u},{step:"Step 7",title:"Create revisions",lead:"Revisions define how practice and checking should run.",passages:["Set pacing, order, and scope for each session style.","One collection can host multiple revision strategies."],focus:["Practice design","Multiple modes"],action:u},{step:"Step 8",title:"Understand info vs card",lead:"Data objects and practice views are intentionally separate.",passages:["Info is the canonical source object.","Card is the generated training/checking view."],focus:["Clear model","Reusable content"],action:u},{step:"Step 9",title:"Run live sessions",lead:"Run mode helps facilitators guide each step with control.",passages:["Move through prompts, responses, and timing intentionally.","Participants get a predictable and focused session rhythm."],focus:["Facilitator control","Group clarity"],action:u},{step:"Step 10",title:"Read dependency graphs",lead:"Graph views expose prerequisites and high-impact nodes.",passages:["Central nodes usually deserve priority in onboarding.","Use this to plan revision order and reduce confusion."],focus:["Priority mapping","Smarter progression"],action:u},{step:"Step 11",title:"Use storyboards and texts",lead:"Plan narratives and keep notes near source knowledge.",passages:["Storyboards model session structure and transitions.","Texts capture outcomes, drafts, and reusable explanations."],focus:["Planning layer","Contextual notes"],action:u},{step:"Step 12",title:"Share safely",lead:"Share read access without losing editorial control.",passages:["Keep editing rights restricted to owners or maintainers.","Collaborators can consume material while core data stays protected."],focus:["Access control","Safe collaboration"],action:u},{step:"Step 13",title:"Navigate by layers",lead:"Sidebar and breadcrumb make system depth understandable.",passages:["You always know whether you are at library, collection, or revision level.","Clear location awareness reduces wrong actions."],focus:["Fast orientation","Lower friction"],action:u},{step:"Step 14",title:"30-minute launch plan",lead:"Start with a minimum viable setup, then iterate.",passages:["Plan: create 1 library, add 10 infos, build 1 collection, run 1 revision.","After the first run, refine structure and scale by scenario."],focus:["Immediate execution","Iterative improvement"],action:"Ready now? Create your first library on the right and start adding knowledge."}]},[E]),st=Ne.length,Qe=Math.max(0,Math.min(je,st-1)),Ge=Ne[Qe],mt=!!S,jt=Ee&&L==="all_collections",Ye=mt&&L==="all_collections",Ze=mt&&L==="all_collections"&&rs.includes(ae),ht=a.useCallback(u=>{const ve=!!u.libraryId;let me=u.target,Fe=u.collectionId,et=u.revisionId,at=u.revisionView,oe=u.infoId,se=u.infoView??c.infoView??"overview";ve?is[me].requiresCollection&&!Fe?(me="all_collections",et=void 0,at="detail"):me!=="all_collections"?(Fe=void 0,et=void 0,me!=="new_card"&&me!=="all_cards"&&(oe=void 0,se="overview")):is[me].allowsRevision?rs.includes(at)||(et=void 0):at="detail":(me="library_overview",Fe=void 0,et=void 0,at="detail",oe=void 0,se="overview"),U(u.libraryId),G(me),R(Fe),te(et),Pe(at),v(!1);const pt=Ia(os(u.libraryId,me,Fe,at,et,oe,se));Ia(`${N.pathname}${N.search}`)!==pt&&(ge.current=pt,d(pt))},[N.pathname,N.search,d,c.infoView]),ot=u=>{ht({libraryId:m,target:"all_collections",collectionId:S,revisionId:rs.includes(u)?ee:void 0,revisionView:u})},Lt=a.useMemo(()=>[{key:"library",label:o.layers.library,visible:!0,value:m??"",selectedLabel:(I==null?void 0:I.name)??o.path.noLibrarySelected,disabled:D||O.length===0,options:O.map(u=>({value:u.libraryId,label:u.name})),emptyOption:o.noLibraryOption,onSelect:u=>{const ve=u||void 0;ht({libraryId:ve,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:o.layers.target,visible:Ee,value:fe,selectedLabel:We,disabled:!Ee,options:on.map(u=>({value:u,label:Ue[u]})),onSelect:u=>{const ve=u;ht({libraryId:m,target:ve,collectionId:S,revisionId:ee,revisionView:ae,infoId:ve==="new_card"?c.infoId:void 0})}},{key:"info_mode",label:o.layers.target,visible:fe==="all_cards",value:xe,selectedLabel:xe==="create"?o.infoMode.create:xe==="selected"?($e==null?void 0:$e.label)??ue??t.cogita.library.list.selectedEmpty:o.infoMode.search,disabled:!Ee,options:[{value:"search",label:o.infoMode.search},{value:"create",label:o.infoMode.create},...c.infoId?[{value:"selected",label:($e==null?void 0:$e.label)??ue??t.cogita.library.list.selectedEmpty}]:[]],onSelect:u=>{if(u!=="selected"){if(u==="create"){ht({libraryId:m,target:"new_card",collectionId:S,revisionId:ee,revisionView:ae,infoId:void 0});return}ht({libraryId:m,target:"all_cards",collectionId:S,revisionId:ee,revisionView:ae,infoId:void 0,infoView:"overview"})}}},{key:"info_selected_action",label:o.layers.target,visible:fe==="all_cards"&&!!c.infoId,value:L==="new_card"&&c.infoId?"edit":c.infoView==="cards"?"cards":"overview",selectedLabel:L==="new_card"&&c.infoId?o.infoActions.edit:c.infoView==="cards"?o.infoActions.seeCards:o.infoActions.overview,disabled:!Ee||!c.infoId,options:[{value:"overview",label:o.infoActions.overview},{value:"edit",label:o.infoActions.edit},{value:"cards",label:o.infoActions.seeCards}],onSelect:u=>{if(c.infoId){if(u==="edit"){ht({libraryId:m,target:"new_card",collectionId:S,revisionId:ee,revisionView:ae,infoId:c.infoId});return}if(u==="cards"){ht({libraryId:m,target:"all_cards",collectionId:S,revisionId:ee,revisionView:ae,infoId:c.infoId,infoView:"cards"});return}ht({libraryId:m,target:"all_cards",collectionId:S,revisionId:ee,revisionView:ae,infoId:c.infoId,infoView:"overview"})}}},{key:"collection",label:o.layers.collection,visible:jt,value:S??"",selectedLabel:(X==null?void 0:X.name)??o.path.noCollectionSelected,disabled:!Ee||Q||Y.length===0,options:Y.map(u=>({value:u.collectionId,label:u.name})),emptyOption:o.selectCollectionOption,onSelect:u=>{ht({libraryId:m,target:"all_collections",collectionId:u||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:o.layers.revision,visible:Ye,value:Ce,selectedLabel:Re,disabled:!S,options:V.map(u=>({value:u.value,label:u.label})),onSelect:u=>{ot(u)}},{key:"revision_entry",label:o.layers.revision,visible:Ze,value:ee??"",selectedLabel:(we==null?void 0:we.name)??o.status.noRevisions,disabled:!mt||ye||re.length===0,options:re.map(u=>({value:u.revisionId,label:u.name})),emptyOption:o.status.noRevisions,onSelect:u=>{ht({libraryId:m,target:"all_collections",collectionId:S,revisionId:u||void 0,revisionView:ae})}}],[V,Y,Q,xe,w,O,D,ht,re,ye,X,S,$e,we,ee,ue,mt,Ee,I,m,Re,ae,L,Ce,fe,We,jt,Ye,Ze,Ue,t.cogita.library.list.selectedEmpty,c.infoId,c.infoView,o.infoActions.edit,o.infoActions.overview,o.infoActions.seeCards,o.layers.collection,o.layers.library,o.layers.revision,o.layers.target,o.noLibraryOption,o.path.noCollectionSelected,o.path.noLibrarySelected,o.selectCollectionOption]),tt=a.useMemo(()=>Lt.filter(u=>u.visible),[Lt]),lt=a.useMemo(()=>tt.filter(u=>u.key!=="library"&&u.key!=="collection"&&u.key!=="revision_entry"),[tt]),Ft=a.useMemo(()=>lt.find(u=>u.key==="target")??null,[lt]),bt=a.useMemo(()=>lt.find(u=>u.key==="info_mode")??null,[lt]),Xe=a.useMemo(()=>lt.find(u=>u.key==="info_selected_action")??null,[lt]),ct=a.useMemo(()=>lt.find(u=>u.key==="collection_action")??null,[lt]),St=a.useCallback((u,ve)=>u?e.jsx("div",{className:"cogita-sidebar-actions",children:u.options.map(me=>e.jsx("button",{type:"button",className:`ghost ${String(u.value)===me.value?"active":""}`,onClick:()=>u.onSelect(me.value),disabled:u.disabled,children:me.label},`${ve}:${u.key}:${me.value}`))}):null,[]),Pt=a.useMemo(()=>{const u=c.libraryId;if(!u||!N.pathname.startsWith("/cogita/library/"))return null;const ve={copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,libraryId:u};if(c.target==="library_overview")return e.jsx(Wn,{...ve});if(c.target==="all_cards")return e.jsx(Zn,{...ve,mode:c.cardMode??"list"});if(c.target==="new_card")return e.jsx(ti,{...ve,editInfoId:c.infoId});if(c.target==="dependencies")return e.jsx(si,{...ve});if(c.target==="transfer")return e.jsx(ii,{...ve});if(c.target==="storyboards"||c.target==="new_storyboard")return e.jsx(ri,{...ve});if(c.target==="texts"||c.target==="new_text")return e.jsx(oi,{...ve});if(c.target==="all_collections"){if(c.collectionId){const me={...ve,collectionId:c.collectionId};return c.revisionView==="graph"?e.jsx(Ai,{...me}):c.revisionView==="shared"?e.jsx(ni,{...ve,collectionId:c.collectionId}):c.revisionView==="settings"?e.jsx(bi,{...me,revisionId:c.revisionId}):c.revisionView==="run"?e.jsx(Li,{...me,revisionId:c.revisionId}):e.jsx(li,{...me})}return e.jsx(Is,{...ve})}return c.target==="new_collection"?e.jsx(Is,{...ve}):null},[s,t,E,N.pathname,d,k,p,x,r,l,c.cardMode,c.collectionId,c.infoId,c.libraryId,c.revisionId,c.revisionView,c.target,y,n]);a.useEffect(()=>{let u=!1;return(async()=>{var me,Fe,et,at,oe,se,pt;he(!0);try{await Mn();const[kt,Ot,qt]=await Promise.all([_s(),In(),Ln()]);if(u)return;de(kt);const Ht=new Set(qt.nodes.filter(it=>it.nodeType==="role"&&it.canLink).map(it=>it.roleId??"")),Yt=zi(Ot,Ht);if(qe(Yt),Yt){const it=qt.nodes.find(rt=>rt.nodeType==="data"&&rt.roleId===Yt&&(rt.fieldType===ns||rt.label===ns));le((it==null?void 0:it.dataKeyId)??null),Le.current=Ki(it==null?void 0:it.value)}const Ut=Le.current.lastLibraryId,$t=((me=kt.find(it=>it.libraryId===c.libraryId))==null?void 0:me.libraryId)??(kt.length===1?kt[0].libraryId:void 0)??((Fe=kt.find(it=>it.libraryId===Ut))==null?void 0:Fe.libraryId)??((et=kt[0])==null?void 0:et.libraryId),Ct=$t?(oe=(at=Le.current.byLibrary)==null?void 0:at[$t])==null?void 0:oe.lastTarget:void 0,ft=Pi(Ct)?Ct:"library_overview";U($t),G(c.target??ft),te(c.revisionId??($t?(pt=(se=Le.current.byLibrary)==null?void 0:se[$t])==null?void 0:pt.lastRevisionId:void 0)),Pe(c.revisionView??"detail"),_e.current=!0}catch{u||Ae(o.status.loadFailed)}finally{u||he(!1)}})(),()=>{u=!0}},[o.status.loadFailed]),a.useLayoutEffect(()=>{_e.current&&(c.libraryId&&O.some(u=>u.libraryId===c.libraryId)&&U(c.libraryId),c.target&&G(c.target),R(c.collectionId),te(c.revisionId),c.revisionView&&Pe(c.revisionView))},[O,c.collectionId,c.libraryId,c.revisionId,c.revisionView,c.target]),a.useEffect(()=>{if(!m){W([]),R(void 0),g([]),z([]),te(void 0);return}let u=!1;return q(!0),va({libraryId:m,limit:200}).then(ve=>{var et;if(u)return;const me=ve.items;W(me);const Fe=(et=me.find(at=>at.collectionId===c.collectionId))==null?void 0:et.collectionId;R(Fe)}).catch(()=>{u||(W([]),R(void 0))}).finally(()=>{u||q(!1)}),()=>{u=!0}},[c.collectionId,m]),a.useEffect(()=>{if(!m||fe!=="all_cards"&&L!=="new_card"){g([]);return}let u=!1;return us({libraryId:m,limit:200}).then(ve=>{u||g(ve)}).catch(()=>{u||g([])}),()=>{u=!0}},[fe,m,L]),a.useEffect(()=>{if(!m||!S){z([]),te(void 0);return}let u=!1;return Ie(!0),Ds({libraryId:m,collectionId:S}).then(ve=>{var et,at,oe,se;if(u)return;z(ve);const me=(at=(et=Le.current.byLibrary)==null?void 0:et[m])==null?void 0:at.lastRevisionId,Fe=((oe=ve.find(pt=>pt.revisionId===c.revisionId))==null?void 0:oe.revisionId)??((se=ve.find(pt=>pt.revisionId===me))==null?void 0:se.revisionId);te(Fe)}).catch(()=>{u||(z([]),te(void 0))}).finally(()=>{u||Ie(!1)}),()=>{u=!0}},[c.revisionId,S,m]),a.useEffect(()=>{const u=c.infoId;if(!m||!u){C(void 0);return}let ve=!1;return ua({libraryId:m,infoId:u}).then(me=>{if(ve)return;const Fe=me.payload;C((Fe==null?void 0:Fe.label)??(Fe==null?void 0:Fe.name)??(Fe==null?void 0:Fe.title)??me.infoId)}).catch(()=>{ve||C(u)}),()=>{ve=!0}},[c.infoId,m]),a.useEffect(()=>{if(!_e.current||c.libraryId&&O.some(me=>me.libraryId===c.libraryId)&&c.libraryId!==m||c.target&&c.target!==L||c.revisionView&&c.revisionView!==ae||c.revisionId&&c.revisionId!==ee||is[L].requiresCollection&&!S&&c.target==="all_collections"&&c.collectionId)return;const u=Ia(`${N.pathname}${N.search}`),ve=Ia(os(m,L,S,ae,ee,c.infoId,c.infoView??"overview"));if(u===ve){ge.current=null;return}ge.current!==ve&&(ge.current=ve,d(ve,{replace:!0}))},[O,N.pathname,N.search,d,c.collectionId,c.infoId,c.infoView,c.libraryId,c.revisionId,c.revisionView,c.target,S,m,ee,ae,L]),a.useEffect(()=>{if(typeof window>"u")return;const u=()=>{window.innerWidth>920&&v(!1)};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),a.useEffect(()=>{if(!_e.current||!H||!m||B.current)return;const u=Le.current,ve={...u.byLibrary??{}},me={...ve[m]??{},lastCollectionId:S,lastRevisionId:ee,lastRevisionView:ae,lastTarget:L},Fe={version:1,lastLibraryId:m,byLibrary:{...ve,[m]:me}},et=JSON.stringify(u),at=JSON.stringify(Fe);if(et===at)return;Le.current=Fe,B.current=!0,(async()=>{try{if(Se)await $n(Se,{plainValue:at});else{const se=await Rn(H,{itemName:ns,itemType:"data",plainValue:at});le(se.dataItemId)}}catch{Ae(o.status.savePrefsFailed)}finally{B.current=!1}})()},[Se,H,S,m,ee,ae,L,o.status.savePrefsFailed]);const zt=async()=>{const u=Ke.trim();if(!u){Ae(t.cogita.user.libraryNameRequired);return}Ae(null);try{const ve=await Fn({name:u});de(me=>[ve,...me]),U(ve.libraryId),G("library_overview"),R(void 0),ke("")}catch{Ae(t.cogita.user.libraryCreateFailed)}},gt=async()=>{if(!m){Ae(o.status.selectLibraryFirst);return}const u=Be.trim();if(!u){Ae(t.cogita.library.collections.saveRequiredName);return}Ae(null);try{const ve=await En({libraryId:m,name:u,items:[]}),me=await va({libraryId:m,limit:200});W(me.items),R(ve.collectionId),te(void 0),G("all_collections"),Pe("detail"),Je("")}catch{Ae(t.cogita.library.collections.saveFail)}},yt=async()=>{if(!m||!S){Ae(o.status.selectLibraryFirst);return}const u=He.trim();if(!u){Ae(o.revisionForm.nameLabel);return}Ae(null);try{const ve=await An({libraryId:m,collectionId:S,name:u,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});z(me=>[ve,...me]),te(ve.revisionId),G("all_collections"),Pe("settings"),K("")}catch{Ae(o.status.loadFailed)}};return e.jsx(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${pe?"open":""}`,"aria-label":o.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(I==null?void 0:I.name)??o.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:I?o.sidebar.libraryActionsHint:o.status.selectLibraryFirst}),St(Ft,"sidebar")]}),bt?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:o.sidebar.infoActionsHint}),St(bt,"sidebar"),Xe?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:($e==null?void 0:$e.label)??ue??t.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:o.sidebar.selectedInfoActionsHint}),St(Xe,"sidebar")]}):null]}):null,X?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:X.name}),e.jsx("p",{className:"cogita-sidebar-note",children:o.sidebar.collectionActionsHint}),St(ct,"sidebar")]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:o.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:r,children:o.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{x("cogita"),v(!1)},children:o.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:l,children:y?t.account.secureModeDisable:t.account.secureModeEnable})]})]})]}),pe?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":o.sidebar.closeMenu,onClick:()=>v(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":o.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>v(u=>!u),"aria-label":pe?o.sidebar.closeMenu:o.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),tt.map((u,ve)=>e.jsxs("div",{className:"cogita-browser-segment",children:[ve>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,u.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":u.label,children:u.selectedLabel}):e.jsxs("select",{"aria-label":u.label,value:u.value,onChange:me=>u.onSelect(me.target.value),disabled:u.disabled,children:[u.emptyOption?e.jsx("option",{value:"",children:u.emptyOption}):null,u.options.map(me=>e.jsx("option",{value:me.value,children:me.label},`${u.key}:${me.value}`))]})]},`menu:${u.key}`))]}),Pt?e.jsxs(e.Fragment,{children:[L==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Be,onChange:u=>Je(u.target.value),placeholder:t.cogita.library.collections.namePlaceholder,disabled:!m})]}),e.jsx("button",{type:"button",className:"cta",onClick:gt,disabled:!m,children:t.cogita.library.actions.createCollection}),be?e.jsx("p",{className:"cogita-form-error",children:be}):null]}):null,L==="all_collections"&&S&&ae==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:o.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:u=>K(u.target.value),placeholder:o.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:yt,children:o.revisionForm.createAction}),be?e.jsx("p",{className:"cogita-form-error",children:be}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Ws.Provider,{value:!0,children:Pt})})]}):null,Pt?null:e.jsxs(e.Fragment,{children:[m?null:e.jsxs("section",{className:"cogita-browser-intro",children:[e.jsx("div",{className:"cogita-browser-intro-main",children:e.jsxs("article",{className:"cogita-browser-panel cogita-browser-tutorial",children:[e.jsxs("div",{className:"cogita-browser-tutorial-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-browser-tutorial-step",children:Ge.step}),e.jsx("h2",{children:Ge.title})]}),e.jsxs("p",{children:[Qe+1," / ",st]})]}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-lead",children:Ge.lead}),e.jsx("div",{className:"cogita-browser-tutorial-passages",children:Ge.passages.map(u=>e.jsx("p",{children:u},u))}),e.jsx("div",{className:"cogita-browser-tutorial-focus",children:Ge.focus.map(u=>e.jsx("span",{children:u},u))}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-action",children:Ge.action}),e.jsx("div",{className:"cogita-browser-tutorial-progress",role:"list","aria-label":"Tutorial progress",children:Ne.map((u,ve)=>e.jsx("button",{type:"button",className:`ghost ${ve===Qe?"active":""}`,onClick:()=>ze(ve),"aria-label":`${ve+1}`,children:ve+1},`tutorial:${u.title}:${ve}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:Qe===0,onClick:()=>ze(u=>Math.max(0,u-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"cta",disabled:Qe===st-1,onClick:()=>ze(u=>Math.min(st-1,u+1)),children:"Next"})]})]})}),e.jsxs("div",{className:"cogita-browser-intro-side",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.createLibraryTitle}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:u=>ke(u.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:zt,children:t.cogita.user.createLibraryAction}),be?e.jsx("p",{className:"cogita-form-error",children:be}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.availableLibraries}),O.length===0?e.jsx("p",{className:"cogita-browser-note",children:t.cogita.user.noLibraries}):null,O.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:O.map(u=>e.jsxs("button",{type:"button",className:"cogita-card-item",onClick:()=>{U(u.libraryId),G("library_overview"),R(void 0),te(void 0),Pe("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.user.libraryRoleLabel}),e.jsx("h3",{className:"cogita-card-title",children:u.name})]},u.libraryId))}):null]})]})]}),m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:o.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[tt.map((u,ve)=>e.jsxs("span",{children:[ve>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:u.selectedLabel})]},`path:${u.key}`)),jt?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:o.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[o.path.currentRoute," ",e.jsx("code",{children:os(m,L,S,ae,ee,c.infoId,c.infoView??"overview")})]}),m?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${m}`,children:o.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${m}/list`,children:o.links.allCards}),S?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${m}/collections/${S}/shared-revisions`,children:o.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:o.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:u=>ke(u.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:zt,children:t.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Be,onChange:u=>Je(u.target.value),placeholder:t.cogita.library.collections.namePlaceholder,disabled:!m})]}),e.jsx("button",{type:"button",className:"cta",onClick:gt,disabled:!m,children:t.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:u=>K(u.target.value),placeholder:o.revisionForm.namePlaceholder,disabled:!S})]}),e.jsx("button",{type:"button",className:"cta",onClick:yt,disabled:!S,children:o.revisionForm.createAction}),be?e.jsx("p",{className:"cogita-form-error",children:be}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:o.panels.collections}),Q?e.jsx("p",{className:"cogita-library-subtitle",children:o.status.loadingCollections}):null,!Q&&Y.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:o.status.noCollections}):null,Y.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:Y.map(u=>e.jsxs("button",{type:"button",className:`cogita-card-item ${u.collectionId===S?"active":""}`,onClick:()=>{R(u.collectionId),te(void 0),Pe("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:o.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:u.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[u.itemCount," ",o.cards.itemsSuffix]})]},u.collectionId))}):null]})]}):null]})]})]})})}const Ui=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Bi},Symbol.toStringTag,{value:"Module"}));function _i({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,shareId:d}){const[N,c]=a.useState(null),[o,O]=a.useState("loading"),[de,Y]=a.useState(t.cogita.library.collections.defaultName),[W,w]=a.useState("Cogita Library"),[g,re]=a.useState([]),[z,m]=a.useState([]),[U,L]=a.useState("idle"),[G,S]=a.useState({current:0,total:0}),[R,ee]=a.useState(0),[te,ae]=a.useState(""),[Pe,ue]=a.useState(null),[C,pe]=a.useState(null),[v,D]=a.useState(null),[he,Q]=a.useState(null),[q,ye]=a.useState([]),[Ie,be]=a.useState({}),[Ae,je]=a.useState({}),[ze,Ke]=a.useState(null),[ke,Be]=a.useState(null),[Je,He]=a.useState(null),[K,H]=a.useState(null),[qe,Se]=a.useState({}),le=a.useRef(0),[Le,_e]=a.useState(null),B=a.useRef(null),ge=a.useRef(null),[I,X]=a.useState(null),[we,$]=a.useState(!1),[V,fe]=a.useState(null),[Ce,xe]=a.useState([]),[$e,Ue]=a.useState(null),We=a.useRef(null),Re=a.useRef(null),[Ee,Ne]=a.useState(null),[st,Qe]=a.useState(0),Ge=a.useRef(null),mt=a.useRef({}),[jt,Ye]=a.useState(!1),[Ze,ht]=a.useState({}),ot=a.useRef(null),Lt=a.useRef(new Set),tt=a.useRef({}),[lt,Ft]=a.useState([]),[bt,Xe]=a.useState(new Set),[ct,St]=a.useState(!1),Pt=ds(),zt=a.useMemo(()=>new URLSearchParams(Pt.search),[Pt.search]),gt=a.useMemo(()=>zt.get("key")??"",[zt]),yt=(N==null?void 0:N.mode)??"random",u=(N==null?void 0:N.check)??"exact",ve=(N==null?void 0:N.limit)??20,me=a.useMemo(()=>ps((N==null?void 0:N.revisionType)??yt),[N,yt]),Fe=a.useMemo(()=>{const T=N==null?void 0:N.revisionSettings,_=Xs(me,zt);return Va(me,T??_)},[N,zt,me]),et=a.useMemo(()=>t.cogita.library.revision[me.labelKey]??yt,[t,yt,me]),at=a.useMemo(()=>u==="exact"?t.cogita.library.revision.checkValue:u,[t,u]),se=o==="ready"?g[R]??null:null,pt=(se==null?void 0:se.checkType)==="translation-match"&&K,kt=a.useRef(new Map),Ot=a.useRef(new Map),qt=a.useRef(new Map),Ht=a.useRef(new Map),Yt=a.useMemo(()=>se?se.cardType==="vocab"?t.cogita.library.revision.vocabLabel:se.infoType?Oe(t,se.infoType):t.cogita.library.revision.infoLabel:"",[t,se]),Ut=a.useMemo(()=>{var _;return me.id!=="levels"?g.length:((_=Ze.pool)==null?void 0:_.length)??me.getFetchLimit(ve,Fe)},[Ze,Fe,me,g.length,ve]),$t=me.getProgressTotal?me.getProgressTotal(g,Ze,ve,Fe):me.id==="levels"?Math.min(ve,Ut):g.length,Ct=$t?Math.min(R+1,$t):0,ft=Math.max(1,Number(Fe.tries??1)),it=Fe.compare??"anchors",rt=Math.max(0,Math.min(100,Number(Fe.minCorrectness??0))),nt=(Fe.considerDependencies??"on")==="on",Rt=Math.max(0,Math.min(100,Number(Fe.dependencyThreshold??85))),Gt=T=>{const _=T.slice();for(let i=_.length-1;i>0;i-=1){const h=Math.floor(Math.random()*(i+1));[_[i],_[h]]=[_[h],_[i]]}return _},Wt=T=>T.length?T.reduce((i,h)=>i+h,0)/T.length/255*100:0,na=T=>Wt(T)>=rt,Oa=async()=>{const T=await Dt(),_=new Map,i=new Map;T.forEach(f=>{const P=`${f.itemType}:${f.itemId}`,b=Bt(f.itemType,f.itemId,f.checkType,f.direction);_.has(P)||_.set(P,[]),_.get(P).push(f),i.has(b)||i.set(b,[]),i.get(b).push(f)});const h=new Map,j=new Map;return _.forEach((f,P)=>h.set(P,_t(f).score)),i.forEach((f,P)=>j.set(P,_t(f).score)),{itemKnowness:h,cardKnowness:j}},fa=async T=>{const _=Ze,i=T.concat(_.active??[]).concat(_.pool??[]).filter((F,J,Z)=>Z.findIndex(ce=>ie(ce)===ie(F))===J);if(!nt){Xe(new Set(i.map(ie)));return}const{itemKnowness:h,cardKnowness:j}=await Oa(),f=F=>{if(F.cardType!=="info"||F.infoType!=="quote"||F.checkType!=="quote-fragment")return!0;const J=Nt(F.direction);if(!(J!=null&&J.fragmentId))return!0;const Z=F.description??"";if(!Z.trim())return!0;const ne=ma(Z).nodes[J.fragmentId];if(!ne||!ne.leftId&&!ne.rightId)return!0;const Te=[ne.leftId,ne.rightId].filter(Ve=>!!Ve);if(Te.length===0)return!0;const Me=Te.map(Ve=>{const dt=Bt("info",F.cardId,"quote-fragment",ja(J.mode,Ve));return j.get(dt)??0});return Me.reduce((Ve,dt)=>Ve+dt,0)/Me.length>=Rt},P=(N==null?void 0:N.collectionId)??null,b=P?lt.filter(F=>ut(F.childItemType)==="collection"&&F.childItemId===P&&!ut(F.childCheckType)&&!ut(F.childDirection)):[],A=P&&i.length>0?i.reduce((F,J)=>F+(j.get(ie(J))??0),0)/i.length:0,M=new Set;for(const F of i){if(F.cardType!=="info"){M.add(ie(F));continue}if(!f(F))continue;const J=lt.filter(ne=>rn(ne,F)).concat(b);if(J.length===0){M.add(ie(F));continue}let Z=0;for(const ne of J)if(ut(ne.parentItemType)==="collection")Z+=ne.parentItemId===P?A:0;else if(ut(ne.parentCheckType)||ut(ne.parentDirection)){const Te=ut(ne.parentCheckType),Me=ut(ne.parentDirection),De=Bt(ne.parentItemType,ne.parentItemId,Te,Me);Z+=j.get(De)??0}else{const Te=`${ne.parentItemType}:${ne.parentItemId}`;Z+=h.get(Te)??0}Z/J.length>=Rt&&M.add(ie(F))}Xe(M)},Ua=T=>{for(let _=T;_<g.length;_+=1){const i=g[_];if(i&&(!nt||i.cardType!=="info"||bt.has(ie(i))))return _}return-1},ia=T=>!nt||T.cardType!=="info"||bt.has(ie(T)),Wa=T=>{if(me.id!=="temporal"&&me.id!=="levels")return null;const _=Ze,i=(_.active??[]).concat(_.pool??[]),h=new Set;for(const j of i){const f=ie(j);if(!(h.has(f)||T.has(f))&&(h.add(f),ia(j)))return j}return null},Mt=a.useMemo(()=>{if(me.id!=="levels")return null;const T=Ze,_=T.pool??[],i=T.active??[],h=T.levelMap??{},j=Math.max(1,Number(Fe.levels??1)),f=Array.from({length:j},()=>0),P=new Set(i.map(F=>ie(F)));_.forEach(F=>{const J=Math.min(j,Math.max(1,h[ie(F)]??1));f[J-1]+=1});const b=_.length||1,A=f.map(F=>F/b*100),M=se?h[ie(se)]??1:null;return{counts:f,percentages:A,currentLevel:M,levelsCount:j,activeCount:i.length,poolCount:_.length,activeSet:P}},[Ze,Fe,me,se]),ra=a.useMemo(()=>{if(me.id!=="temporal")return null;const T=Ze,_=T.pool??[],i=T.active??[],h=T.knownessMap??{},j=new Set(T.unknownSet??[]);let f=0;_.forEach(A=>{(h[ie(A)]??0)>1&&(f+=1)});const P=j.size,b=i.map(A=>({id:ie(A),value:j.has(ie(A))?0:Math.max(0,Math.min(1,h[ie(A)]??0))}));return{knownCount:f,unknownCount:P,dots:b}},[Ze,me]),Et=a.useMemo(()=>{if(!nt)return 0;const T=Ze;return g.concat(T.active??[]).concat(T.pool??[]).filter((i,h,j)=>j.findIndex(f=>ie(f)===ie(i))===h).filter(i=>i.cardType==="info"&&!bt.has(ie(i))).length},[nt,Ze,g,bt]);a.useEffect(()=>{if(!nt||U!=="ready")return;const T=Ze,i=g.concat(T.active??[]).concat(T.pool??[]).filter((f,P,b)=>b.findIndex(A=>ie(A)===ie(f))===P).filter(f=>f.cardType!=="info"||bt.has(ie(f))).length,h=We.current;if(We.current=i,h===null||i<=h)return;const j=i-h;Ue(`New card available (+${j})`),Re.current&&window.clearTimeout(Re.current),Re.current=window.setTimeout(()=>Ue(null),2200)},[nt,U,Ze,g,bt]),a.useEffect(()=>()=>{Re.current&&window.clearTimeout(Re.current)},[]);const xt=(T,_)=>{const i=me.applyOutcome({queue:g,meta:Ze},se,ve,Fe,{correct:T,correctness:_,createdUtc:new Date().toISOString()});re(i.queue),ht(i.meta);const h=i.queue[R+1];h&&It(h,R+1)};a.useEffect(()=>{if(!d){O("error");return}O("loading"),Pn({shareId:d,key:gt}).then(T=>{c(T),Y(T.collectionName),w(T.libraryName),O("ready")}).catch(()=>{O("error")})},[d,gt]),a.useEffect(()=>{d&&zn({shareId:d,key:gt,type:"language"}).then(T=>m(T)).catch(()=>m([]))},[d,gt]),a.useEffect(()=>{!d||o!=="ready"||Kn({shareId:d,key:gt}).then(T=>Ft(T.items??[])).catch(()=>Ft([]))},[d,gt,o]),a.useEffect(()=>{if(!d||o!=="ready")return;let T=!0;return(async()=>{L("loading"),S({current:0,total:me.id==="levels"?0:me.getFetchLimit(ve,Fe)});try{const i=[];let h=null,j=null;do{const J=await Bn({shareId:d,key:gt,limit:300,cursor:h});if(i.push(...J.items),(me.id==="levels"||me.id==="temporal")&&J.total&&(j=J.total),S(Z=>({current:i.length,total:Z.total||J.total||me.getFetchLimit(ve,Fe)})),h=J.nextCursor??null,j!==null&&i.length>=j||me.id!=="levels"&&me.id!=="temporal"&&i.length>=me.getFetchLimit(ve,Fe))break}while(h);if(!T)return;const f=cs(i);let P;if(me.id==="levels"){const J=Math.max(1,Number(Fe.levels??1));P={},f.forEach(Z=>{const ce=ie(Z);P[ce]=Math.max(1,Math.min(J,1))})}let b=null,A=null,M=null;if(me.id==="temporal"){const J=await Dt(),Z=new Set(f.map(Te=>ie(Te))),ce=J.reduce((Te,Me)=>{const De=Bt(Me.itemType,Me.itemId,Me.checkType,Me.direction);return Z.has(De)&&(Te[De]||(Te[De]=[]),Te[De].push(Me)),Te},{});b={},A=new Set,M={};const ne=Date.now();f.forEach(Te=>{const Me=ie(Te),De=ce[Me]??[];if(De.length===0){b[Me]=0,A.add(Me),M[Me]=[];return}const Ve=hs(De);M[Me]=Ve;const dt=Da(Ve,ne);b[Me]=dt.knowness})}const F=me.id==="levels"?ms(f,ve,Fe,P):me.id==="temporal"?gs(f,ve,Fe,b??{},A??new Set,M??{}):me.prepare(f,ve,Fe);re(F.queue),ht(F.meta),ee(0),L("ready"),S(J=>({current:Math.min(J.current,J.total),total:J.total}))}catch{T&&L("error")}})(),()=>{T=!1}},[d,gt,ve,me,Fe,o]),a.useEffect(()=>{fa(g)},[g,lt,nt,Rt,N==null?void 0:N.collectionId]),a.useEffect(()=>{if(!se||!nt){St(!1);return}if(se.cardType!=="info"||bt.has(ie(se))){St(!1);return}const T=Ua(R+1);if(T>=0){St(!1),ee(T);return}if(me.id==="temporal"||me.id==="levels"){const _=g.slice(0,R+1),i=g.slice(R+1).filter(ia),h=_.concat(i),j=new Set(h.map(ie)),f=Wa(j);if(f){const b=ie(f);j.has(b)||(h.push(f),j.add(b),ht(A=>{const M=A,F=new Set(M.queued??[]);return F.add(b),{...M,queued:F}}))}const P=h.findIndex((b,A)=>A!==R&&ia(b));if(P>=0){re(h),ee(P),St(!1);return}}St(!0)},[se,bt,nt,R,g,Ze,me.id]),a.useEffect(()=>{if(ae(""),ue(null),Ne(null),Qe(0),ye([]),be({}),je({}),Ke(null),Be(null),He(null),$(!1),Ye(!1),X(null),H(null),Se({}),!se){pe(null),D(null);return}se.cardType==="info"&&se.infoType==="computed"&&pe(t.cogita.library.revision.loadingComputed);let T=!0;return It(se,R).then(_=>{!T||!_||(pe(_.prompt),D(_.expectedAnswer),ye(_.computedExpected),be(_.computedAnswers),Ke(_.answerTemplate),Be(_.outputVariables),He(_.variableValues))}),()=>{T=!1}},[se,d,t]),a.useEffect(()=>{if(!se||se.cardType!=="info"||se.infoType!=="quote"){ot.current=null,Lt.current=new Set,Q(null);return}const T=se.description??"",_=(se.label??"").trim(),i=_.replace(/\s+/g," ").trim(),h=T.replace(/\s+/g," ").trim(),j=i&&i!==h?_:t.cogita.library.infoTypes.quote;if(!T){Q(null),D(null);return}const f=ma(T);ot.current=f,pe(j);let P=!0;return Dt().then(b=>{if(!P)return;const A=getQuoteMode(se.direction),M=new Map;b.forEach(ne=>{if(ne.itemType!=="info"||ne.checkType!=="quote-fragment"||!ne.direction)return;const Te=Nt(ne.direction);if(!Te||Te.mode!==A)return;const Me=`${ne.itemId}:${Te.fragmentId}`;M.has(Me)||M.set(Me,[]),M.get(Me).push(ne)});const F={},J=new Set;M.forEach((ne,Te)=>{const[Me,De]=Te.split(":",2);if(Me!==se.cardId)return;const Ve=_t(ne).score;F[De]=Ve,Ve>=Rt&&J.add(De)}),Lt.current=J,tt.current=F;const Z=Nt(se.direction);if(Z!=null&&Z.fragmentId&&f.nodes[Z.fragmentId]){Zt(f,Z.fragmentId,j);return}const ce=ha(f,J,F,Rt,nt,se.direction);Zt(f,(ce==null?void 0:ce.id)??null,j)}).catch(()=>{Lt.current=new Set,tt.current={};const b=Nt(se.direction);if(b!=null&&b.fragmentId&&f.nodes[b.fragmentId]){Zt(f,b.fragmentId,j);return}const A=ha(f,Lt.current,{},Rt,nt,se.direction);Zt(f,(A==null?void 0:A.id)??null,j)}),()=>{P=!1}},[se,t,nt,Rt]),a.useEffect(()=>{if(!se||se.cardType!=="vocab"||se.checkType!=="translation-match"){H(null),Se({});return}const i=(Ze.pool??Ze.active??g).filter(b=>b.cardType==="vocab"&&b.checkType==="translation-match").filter((b,A,M)=>M.findIndex(F=>F.cardId===b.cardId)===A);i.some(b=>b.cardId===se.cardId)||i.unshift(se);const j=Gt(i).slice(0,6).map(b=>{const A=b.label.split("↔").map(J=>J.trim()).filter(Boolean);if(A.length<2)return null;const M=`${b.cardId}:L`,F=`${b.cardId}:R`;return{cardId:b.cardId,leftId:M,rightId:F,leftLabel:A[0],rightLabel:A[1]}}).filter(Boolean),f=j.map(b=>b.leftId),P=Gt(j.map(b=>b.rightId));H({pairs:j,leftOrder:f,rightOrder:P,selection:{},activeLeft:null,activeRight:null,locked:{}})},[se,g,Ze]),a.useEffect(()=>()=>{B.current&&window.clearTimeout(B.current),ge.current&&window.clearTimeout(ge.current)},[]);const oa=a.useRef(null);a.useEffect(()=>{if(!se)return;const T=ie(se),_=typeof document<"u"?document.activeElement:null;if(oa.current===T&&_&&(_.tagName==="INPUT"||_.tagName==="TEXTAREA"))return;let i=0;const h=()=>{if(se){if(se.cardType==="info"&&se.infoType==="computed"){if(q.length>0){const f=Ba(ze,q,ke),P=f?mt.current[f]:null;if(P&&(P.focus(),document.activeElement===P)){oa.current=T;return}}if(Ge.current&&(Ge.current.focus(),document.activeElement===Ge.current)){oa.current=T;return}}else if(se.cardType==="vocab"&&Ge.current&&(Ge.current.focus(),document.activeElement===Ge.current)){oa.current=T;return}i<6&&(i+=1,window.setTimeout(h,40))}},j=window.setTimeout(h,40);return()=>window.clearTimeout(j)},[se,q,ze,ke]),a.useEffect(()=>{if(!jt)return;const T=_=>{_.key==="Enter"&&(_.preventDefault(),la())};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[jt]);const vt=T=>{xe(T),fe(_t(T))};a.useEffect(()=>{if(!se){fe(null),xe([]);return}const T=se.cardType==="info"?"info":"connection";if(se.cardType==="info"&&se.infoType==="quote"){Dt().then(_=>{const i=_.filter(h=>h.itemType==="info"&&h.itemId===se.cardId&&h.checkType==="quote-fragment"&&za(h.direction,se.direction));vt(i)}).catch(()=>{fe(null),xe([])});return}Fa(T,se.cardId,se.checkType,se.direction).then(_=>vt(_)).catch(()=>{fe(null),xe([])})},[se]);const Xt=(T,_,i,h)=>{if(T==="info"&&i==="quote-fragment"){Dt().then(j=>{const f=j.filter(P=>P.itemType==="info"&&P.itemId===_&&P.checkType==="quote-fragment"&&za(P.direction,h));vt(f)}).catch(()=>{fe(null),xe([])});return}Fa(T,_,i,h).then(j=>vt(j)).catch(()=>{fe(null),xe([])})},Jt=(T,_,i)=>{var P;const h=((P=i.pairs.find(b=>b.leftId===T))==null?void 0:P.rightId)??null;if(!h)return i;const j=h===_;Se(b=>({...b,[T]:j?"correct":"incorrect"})),B.current&&window.clearTimeout(B.current),ge.current&&window.clearTimeout(ge.current),le.current+=1;const f={kind:j?"correct":"incorrect",tick:le.current};if(_e(null),B.current=window.setTimeout(()=>_e(f),0),ge.current=window.setTimeout(()=>_e(null),420),j){const b={...i.locked,[T]:!0};return Object.keys(b).length>=i.pairs.length?(ue("correct"),Ye(!0)):ue("correct"),{...i,selection:{...i.selection,[T]:_},activeLeft:null,activeRight:null,locked:b}}return ue("incorrect"),{...i,activeLeft:null,activeRight:null}},Na=T=>{H(_=>!_||_.locked[T]?_:_.activeRight?Jt(T,_.activeRight,_):{..._,activeLeft:_.activeLeft===T?null:T})},Ta=T=>{H(_=>_&&(_.activeLeft?Jt(_.activeLeft,T,_):{..._,activeRight:_.activeRight===T?null:T}))},la=()=>{var T;if(se&&se.cardType==="info"&&se.infoType==="quote"&&ot.current&&he&&!((T=Nt(se.direction))!=null&&T.fragmentId)){const _=ha(ot.current,Lt.current,tt.current,Rt,nt,se.direction,he.fragmentId);if(_){ue(null),ae(""),$(!1),je({}),Ye(!1),Ne(null),Qe(0),Zt(ot.current,_.id,he.title);return}}ue(null),ae(""),$(!1),je({}),Ye(!1),Ne(null),Qe(0),ee(_=>Math.min(_+1,g.length))},At=T=>{if(!se)return;const _=T.expected??null,i=T.answer??"";let h=_??"",j=i;if(!_&&T.expectedMap&&T.answerMap){const J=Object.keys(T.expectedMap).sort((Z,ce)=>Z.localeCompare(ce));h=J.map(Z=>{var ce;return((ce=T.expectedMap)==null?void 0:ce[Z])??""}).join("|"),j=J.map(Z=>{var ce;return((ce=T.answerMap)==null?void 0:ce[Z])??""}).join("|")}const f=h?ga(h,j,it):new Uint8Array,P={revisionType:me.id,evalType:T.evalType,direction:T.direction,prompt:C??"",expected:_,answer:i,expectedAnswers:T.expectedMap??null,answers:T.answerMap??null,correct:T.correct,maskBase64:f.length?Qt(f):null,checkMode:u,compareMode:it,minCorrectness:rt},b=new TextEncoder().encode(JSON.stringify(P)),A=se.cardType==="info"?"info":"connection",M=T.overrideCheckType??se.checkType??null,F=T.overrideDirection??se.direction??null;Aa({itemType:A,itemId:se.cardId,checkType:M,direction:F,revisionType:me.id,evalType:T.evalType,correct:T.correct,maskBase64:f.length?Qt(f):null,payloadBase64:Qt(b)}).then(()=>{Xt(A,se.cardId,M,F),fa(g)}).catch(()=>{})},ca=(T,_)=>{const i=kt.current.get(_);if(i)return Promise.resolve(i);const h=Ot.current.get(_);if(h)return h;const j=_n({shareCode:d,infoId:T,key:gt}).then(f=>{var J,Z;const P=f.payload,b=((J=P.definition)==null?void 0:J.graph)??null,A="",M=((Z=P.definition)==null?void 0:Z.answerTemplate)??"",F=Js(b,A,M);if(F){const ne={sample:Zs(F),answerTemplate:M||null};return kt.current.set(_,ne),ne}return xs({shareId:d,infoId:T,key:gt}).then(ce=>{const ne={sample:ce,answerTemplate:null};return kt.current.set(_,ne),ne})}).catch(()=>xs({shareId:d,infoId:T,key:gt}).then(f=>{const P={sample:f,answerTemplate:null};return kt.current.set(_,P),P}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Ot.current.delete(_)});return Ot.current.set(_,j),j},It=(T,_)=>{var b;const i=`${ie(T)}:${_}`,h=qt.current.get(i);if(h)return Promise.resolve(h);const j=Ht.current.get(i);if(j)return j;const f=A=>(qt.current.set(i,A),A);let P;if(T.cardType==="vocab"){if(T.checkType==="translation-match")return P=Promise.resolve(f({prompt:T.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),P;const A=T.label.split("↔").map(M=>M.trim()).filter(Boolean);if(A.length>=2){const F=(T.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",J=F?A[0]:A[1],Z=F?A[1]:A[0];P=Promise.resolve(f({prompt:J,expectedAnswer:Z,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else P=Promise.resolve(f({prompt:T.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(T.cardType==="info"&&T.infoType==="word"){const A=(b=T.description)!=null&&b.startsWith("Language: ")?T.description.replace("Language: ",""):null;P=Promise.resolve(f({prompt:T.label,expectedAnswer:A,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else T.cardType==="info"&&T.infoType==="computed"?P=ca(T.cardId,i).then(A=>{var ce,ne;if(!A.sample)return f({prompt:T.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const M=A.sample,F=M.expectedAnswers?Object.entries(M.expectedAnswers).map(([Te,Me])=>({key:Te,expected:Me})):[],J=F.reduce((Te,Me)=>(Te[Me.key]="",Te),{}),Z=M.expectedAnswerIsSentence&&((ce=M.expectedAnswer)==null?void 0:ce.trim())||null;return f({prompt:M.prompt,expectedAnswer:F.length>0?Z:((ne=M.expectedAnswer)==null?void 0:ne.trim())||null,computedExpected:F,computedAnswers:J,answerTemplate:A.answerTemplate,outputVariables:M.outputVariables??null,variableValues:M.variableValues??null})}).catch(()=>f({prompt:T.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Ht.current.delete(i)}):P=Promise.resolve(f({prompt:T.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return Ht.current.set(i,P),P},Zt=(T,_,i)=>{const h=Object.keys(T.nodes).length,j=Lt.current.size;if(!_){Q({title:i,before:T.text,after:"",fragmentId:null,total:h,completed:j}),D(null),Ye(!0);return}const f=T.nodes[_];if(!f)return;const P=Hs(T.text,f);Q({title:i,before:P.before,after:P.after,fragmentId:f.id,total:h,completed:j}),D(P.fragment),Ye(!1)},ba=()=>{const T=ot.current;T&&Q(_=>_&&{..._,total:Object.keys(T.nodes).length,completed:Lt.current.size})},Kt=()=>{const T=g[R+1];T&&It(T,R+1)},Sa=()=>{if(Kt(),se&&se.cardType==="vocab"&&se.checkType==="translation-match"&&K){if(K.pairs.length===0){ue("incorrect"),Ye(!0);return}const f=K.pairs.reduce((Z,ce)=>(Z[ce.rightId]=ce.rightLabel,Z),{});let P=0;const b={};K.pairs.forEach(Z=>{const ne=K.selection[Z.leftId]===Z.rightId;b[Z.leftId]=ne?"correct":"incorrect",ne&&(P+=1)});const A=K.pairs.length||1,M=P/A,F=P===K.pairs.length;Se(Z=>({...Z,...b})),F?(ue("correct"),Ye(!0),Qe(0)):(ue("incorrect"),Ye(!1),Qe(Z=>{const ce=Z+1;return ce>=ft&&($(!0),Ye(!0),H(ne=>{if(!ne)return ne;const Te=ne.pairs.reduce((Me,De)=>(Me[De.leftId]=De.rightId,Me),{});return{...ne,selection:Te}})),ce})),xt(F,M);const J="connection";Promise.all(K.pairs.map(Z=>{const ce=K.selection[Z.leftId]??null,ne=ce?f[ce]:"",Te={left:Z.leftLabel,expected:Z.rightLabel,answer:ne,checkType:"translation-match"},Me=new TextEncoder().encode(JSON.stringify(Te));return Aa({itemType:J,itemId:Z.cardId,checkType:"translation-match",direction:null,revisionType:me.id,evalType:"translation-match",correct:ce===Z.rightId,maskBase64:null,payloadBase64:Qt(Me)})})).then(()=>{Xt(J,se.cardId,se.checkType,se.direction),fa(g)}).catch(()=>{});return}if(q.length>0){const f=q.reduce((b,A)=>{const M=Ie[A.key]??"";return b[A.key]=wt(M)===wt(A.expected)?"correct":"incorrect",b},{});q.every(({key:b,expected:A})=>{const M=Ie[b]??"";return u==="exact"&&wt(M)===wt(A)})?(ue("correct"),je(f),Ye(!0),Qe(0),xt(!0,1),At({correct:!0,direction:C?`${C} -> computed`:"computed",expectedMap:q.reduce((b,A)=>(b[A.key]=A.expected,b),{}),answerMap:Ie,evalType:"computed"})):(ue("incorrect"),je(f),Ye(!1),Qe(b=>{const A=b+1;return A>=ft&&ea&&($(!0),Ye(!0)),A}),xt(!1,0),window.setTimeout(()=>{var A;const b=Ba(ze,q,ke);b&&mt.current[b]&&((A=mt.current[b])==null||A.focus())},40),At({correct:!1,direction:C?`${C} -> computed`:"computed",expectedMap:q.reduce((b,A)=>(b[A.key]=A.expected,b),{}),answerMap:Ie,evalType:"computed"}));return}if(se&&se.cardType==="info"&&se.infoType==="quote"&&(he!=null&&he.fragmentId)){if(!v)return;const f=Nt(se.direction),P=(f==null?void 0:f.mode)??getQuoteMode(se.direction),b=f!=null&&f.fragmentId&&se.direction?se.direction:ja(P,he.fragmentId),A=nn(v,te,it),M=u==="exact"&&pa(te)===pa(v),F=na(A),J=M||F,Z=Wt(A);J?(tt.current[he.fragmentId]=Math.max(tt.current[he.fragmentId]??0,Z),(tt.current[he.fragmentId]??0)>=Rt&&Lt.current.add(he.fragmentId),ba(),ue("correct"),je({}),Ye(!0),Ne(A),Qe(0),Z<100&&ft<=1&&$(!0),xt(!0,Z/100),At({correct:!0,direction:`quote:${he.fragmentId}`,expected:v,answer:te,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:b})):(ue("incorrect"),je({}),Ye(!1),Ne(A),Qe(ce=>{const ne=ce+1;return ne>=ft&&ea&&($(!0),Ye(!0)),ne}),xt(!1,Z/100),window.setTimeout(()=>{var ce;return(ce=Ge.current)==null?void 0:ce.focus()},40),At({correct:!1,direction:`quote:${he.fragmentId}`,expected:v,answer:te,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:b}));return}if(!v)return;const T=ga(v,te,it),_=u==="exact"&&wt(te)===wt(v),i=na(T),h=_||i,j=Wt(T);h?(ue("correct"),je({}),Ye(!0),Ne(T),Qe(0),j<100&&ft<=1&&$(!0),xt(!0,j/100),At({correct:!0,direction:C?`${C} -> ${v}`:null,expected:v,answer:te,evalType:"text"})):(ue("incorrect"),je({}),Ye(!1),Ne(T),Qe(f=>{const P=f+1;return P>=ft&&ea&&($(!0),Ye(!0)),P}),xt(!1,j/100),window.setTimeout(()=>{var f;return(f=Ge.current)==null?void 0:f.focus()},40),At({correct:!1,direction:C?`${C} -> ${v}`:null,expected:v,answer:te,evalType:"text"}))},da=T=>{if(Kt(),!v)return;const _=ga(v,T,it),i=wt(T)===wt(v),h=na(_),j=i||h,f=Wt(_);j?(ue("correct"),je({}),Ye(!0),Ne(_),Qe(0),f<100&&ft<=1&&$(!0),xt(!0,f/100),At({correct:!0,direction:"word->language",expected:v,answer:T,evalType:"language-select"})):(ue("incorrect"),je({}),Ye(!1),Ne(_),Qe(P=>{const b=P+1;return b>=ft&&ea&&($(!0),Ye(!0)),b}),xt(!1,f/100),At({correct:!1,direction:"word->language",expected:v,answer:T,evalType:"language-select"}))},Ca=T=>{var i;if(T.key!=="Enter")return;if(T.preventDefault(),T.stopPropagation(),jt){la();return}const _=q.find(h=>!(Ie[h.key]??"").trim());if(_){(i=mt.current[_.key])==null||i.focus();return}Sa()},Qa=()=>{Kt(),ue("correct"),Ye(!0),Qe(0),xt(!0,1),v&&At({correct:!0,direction:"manual",expected:v,answer:te,evalType:"manual"})},Ha=()=>{if(xt(!1,0),se&&se.cardType==="info"&&se.infoType==="quote"){ue(null),ae(""),$(!1),je({}),Ye(!1),Ne(null),Qe(0),ee(T=>Math.min(T+1,g.length));return}la()};a.useEffect(()=>{Kt()},[R,g]);const Ya=t.cogita.library.revision.revealModeAfterIncorrect,ea=q.length>0||!!v;return e.jsxs(Tt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:p,secureMode:y,onNavigate:x,language:E,onLanguageChange:k,children:[(o==="loading"||U==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:o==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${G.total?Math.min(100,Math.max(0,G.current/G.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:G.total?`${Math.min(G.current,G.total)} / ${G.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:de}),e.jsx("p",{className:"cogita-library-subtitle",children:W}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",et).replace("{check}",at)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:V?`${V.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Mt?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Mt.currentLevel??"-"," / ",Mt.levelsCount]}):null,V?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(V.correct)).replace("{total}",String(V.total))}),V.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(V.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(tn,{outcomes:Ce})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[$e?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:$e})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Le?`${Le.kind}-${Le.tick}`:pt?"idle":Pe??"idle",children:o!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:o==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}):se?e.jsx(e.Fragment,{children:ct?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(en,{copy:t,currentCard:se,currentTypeLabel:Yt,prompt:C,languages:z,answer:te,onAnswerChange:T=>ae(_=>Ka(_,T,I)),computedExpected:q,computedAnswers:Ie,onComputedAnswerChange:(T,_)=>be(i=>({...i,[T]:Ka(i[T]??"",_,I)})),answerTemplate:ze,outputVariables:ke,variableValues:Je,computedFieldFeedback:Ae,feedback:Pe,canAdvance:jt,quoteContext:he,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Sa,onSkip:Ha,onLanguageSelect:da,onMarkReviewed:Qa,onAdvance:la,showCorrectAnswer:we,setShowCorrectAnswer:$,onRevealCorrect:()=>Ye(!0),answerMask:Ee,expectedAnswer:v,hasExpectedAnswer:ea,handleComputedKeyDown:Ca,answerInputRef:Ge,computedInputRefs:mt,scriptMode:I,setScriptMode:X,matchPairs:K==null?void 0:K.pairs,matchLeftOrder:K==null?void 0:K.leftOrder,matchRightOrder:K==null?void 0:K.rightOrder,matchSelection:K==null?void 0:K.selection,matchActiveLeft:K==null?void 0:K.activeLeft,matchActiveRight:K==null?void 0:K.activeRight,matchFeedback:qe,onMatchLeftSelect:Na,onMatchRightSelect:Ta})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:$t?`${Ct} / ${$t}`:t.cogita.library.revision.progressUnlimited}),o==="error"&&e.jsx("p",{children:t.cogita.library.revision.shareInvalid}),o==="loading"&&e.jsx("p",{children:t.cogita.library.revision.shareLoading}),o==="ready"&&U==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),o==="ready"&&U==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),o==="ready"&&U==="ready"&&g.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Ya}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",ft]})]})]}),Mt?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Mt.activeCount," / ",Mt.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Mt.counts.map((T,_)=>{const i=_+1,h=Mt.currentLevel===i,j=Mt.percentages[_]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":h,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:i}),e.jsx("strong",{children:T})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,j))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[j.toFixed(1),"%"]})]},`level-${i}`)})})]}):null,ra?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ra.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ra.dots.map(T=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-T.value))}, ${Math.round(200*T.value)}, 80, 0.9)`}},T.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ra.knownCount})]})]}):null,nt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Et})]})}):null]})]})]})})})]})]})}const Wi=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:_i},Symbol.toStringTag,{value:"Module"}));export{Oi as C,Ui as a,Wi as b};
