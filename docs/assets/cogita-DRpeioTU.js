import{r as a,j as e,u as $s,a as Rs,b as Es,c as As,R as Fs,B as Ps,C as zs,d as cs}from"./vendor-B-s_ukyJ.js";import{L as Ks,A as Bs,g as _s,a as cn,b as wa,c as Ds,s as ps,d as qs,e as fs,f as ds,h as Vs,i as dn,j as ua,u as un,k as hn,p as gn,l as mn,m as Os,r as Us,n as pn,o as fn,q as bn,t as _a,v as $a,w as yn,x as xn,y as vn,z as wn,B as jn,C as kn,D as Nn,E as bs,F as Ht,G as Tn,H as Sn,I as Cn,J as Mn,K as In,M as Ln,N as $n,O as Rn,P as En,Q as An,R as Fn,S as Pn,T as zn,U as Kn,V as Bn,W as _n,X as ys}from"./recreatio-core-B7V_U7t3.js";import"./vendor-cogita-ui-BuvhRVJJ.js";const va={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},ya={moveMs:900,pauseMs:220,errorMs:900},Dn=(t=11)=>{let s=t;const n=()=>(s=(s*1664525+1013904223)%4294967296,s/4294967296),{width:r,height:l,paddingX:m,paddingY:y,levels:x}=va,E=(l-y*2)/(x.length-1),N=[],d=[],k=[];x.forEach((w,g)=>{const re=l-y-g*E,z=r-m*2,p=[];for(let U=0;U<w;U+=1){const $=m+(U+1)*z/(w+1),G=(n()-.5)*18,I=Math.max(m,Math.min(r-m,$+G)),R=g===0?3:g<2?2.1:1.4,ee=g===0?"root":`l${g}-${U}`;p.push({id:ee,x:g===0?r/2:I,y:re,r:R,level:g,role:g===0?"root":void 0})}k.push(p),N.push(...p)});const c=k[k.length-1];if(c!=null&&c.length){const w=c[Math.floor(c.length/2)];w.role="goal",w.r=2}for(let w=1;w<k.length;w+=1){const g=k[w-1];k[w].forEach(z=>{const p=[...g].sort((I,R)=>Math.abs(I.x-z.x)-Math.abs(R.x-z.x)),U=p[0],$=p[1]&&n()<.45?p[1]:null;($?[U,$]:[U]).forEach(I=>{d.push({from:I.id,to:z.id,key:`${I.id}-${z.id}`})}),n()<.2&&p[2]&&d.push({from:p[2].id,to:z.id,key:`${p[2].id}-${z.id}`})})}const o=new Map;d.forEach(w=>{const g=o.get(w.to)??[];g.push(w.from),o.set(w.to,g)});const O=new Map,ue=new Map,Y=new Map;d.forEach(w=>{const g=O.get(w.from)??[];g.push(w.key),O.set(w.from,g);const re=ue.get(w.from)??[];re.push(w.to),ue.set(w.from,re);const z=Y.get(w.from)??[];z.push(w.to),Y.set(w.from,z);const p=Y.get(w.to)??[];p.push(w.from),Y.set(w.to,p)});const W=new Map;return N.forEach(w=>{W.set(w.id,w)}),{nodes:N,links:d,parentsById:o,linksByFrom:O,childrenByFrom:ue,neighborsById:Y,nodesById:W}};function qn({slides:t,activeIndex:s,introOpen:n,prefersReducedMotion:r,onNext:l,onPrev:m,onSelect:y,onExit:x,onOpen:E,onRegister:N}){const d=s===t.length-1,k=n&&s===0?"entry":"docked",c=t[t.length-1],[o,O]=a.useState(!1),ue=a.useMemo(()=>Array.from({length:20},(M,X)=>({src:`/cogita/logo/Cogita${String(X).padStart(2,"0")}.png`,kind:X<=11?"bubble":X<=17?"text":"recreatio"})),[]),Y=n&&s===0;a.useEffect(()=>{if(!n){O(!1);return}s>0&&!o&&O(!0)},[s,n,o]);const W=a.useRef(0),w=a.useRef(null),g=a.useMemo(()=>{const M={x:40,y:160},X={x:260,y:48},ve=6,L=X.x-M.x,V=M.y-X.y,fe=L/ve,Ce=[.3,.45,.6,.65,1.4,2.2],xe=Ce.reduce((Ee,ke)=>Ee+ke,0),$e=Ce.map(Ee=>V*Ee/xe),Ue=[M];let We=M.x,Re=M.y;for(let Ee=1;Ee<=ve;Ee+=1){const ke=(Math.random()-.5)*14,st=(Math.random()-.5)*28;We=Math.max(M.x+Ee*14,Math.min(X.x-(ve-Ee)*14,We+fe+ke));const Qe=$e[Ee-1]??$e[$e.length-1];Re=Re-Qe+st;const Ge=Math.max(X.y,Math.min(M.y-4,Re));Ue.push({x:Math.round(We),y:Math.round(Ge)})}return Ue[Ue.length-1]=X,Ue},[]),re=a.useMemo(()=>{const V=(xe,$e,Ue)=>Math.min(Ue,Math.max($e,xe)),fe=g.map(xe=>{const $e=10+Math.random()*36;return{x:V(xe.x,40,260),y:V(xe.y-$e,40,140)}}),Ce=g.map((xe,$e)=>{var Re;const Ue=12+Math.random()*40,We=((Re=fe[$e])==null?void 0:Re.y)??xe.y;return{x:V(xe.x,40,260),y:V(Math.max(We+10,xe.y+Ue),60,170)}});return{upper:fe,lower:Ce}},[g]),z=a.useMemo(()=>{var X;const M=((X=g[4])==null?void 0:X.x)??260;return Math.max(0,Math.min(240,M-40))},[g]),p=a.useMemo(()=>{var $e,Ue;const M=(We,Re,Ee)=>Math.min(Ee,Math.max(Re,We)),X=(We,Re,Ee)=>g.map((ke,st)=>{var ct,it;const Qe=((ct=re.upper[st])==null?void 0:ct.y)??ke.y,Ge=((it=re.lower[st])==null?void 0:it.y)??ke.y,mt=(Math.random()-.5)*70,Tt=ke.y+We+mt,He=M(ke.y+Re,Qe+6,Ge-6),Je=M(ke.y+Ee,Qe+6,Ge-6);return{x:ke.x,y:M(Tt,Math.min(He,Je),Math.max(He,Je))}}),ve=-14+Math.random()*28,L=14+Math.random()*28,V=X(ve,-80,12),fe=X(L,-12,80);for(let We=4;We<g.length;We+=1){const Re=g[We],Ee=(($e=re.upper[We])==null?void 0:$e.y)??Re.y,ke=((Ue=re.lower[We])==null?void 0:Ue.y)??Re.y;V[We]={x:Re.x,y:M(Re.y-12,Ee+6,ke-6)},fe[We]={x:Re.x,y:M(Re.y+12,Ee+6,ke-6)}}const Ce=re.upper.length?re.upper[re.upper.length-1].y:40,xe=re.lower.length?re.lower[re.lower.length-1].y:170;return V[V.length-1]={x:g[g.length-1].x,y:M(g[g.length-1].y-14,Ce,xe)},fe[fe.length-1]={x:g[g.length-1].x,y:M(g[g.length-1].y+12,Ce,xe)},{higher:V,lower:fe}},[g,re]),U=1e4,$=a.useMemo(()=>{let M=17;const X=()=>(M=(M*1664525+1013904223)%4294967296,M/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((L,V)=>{const fe=(X()-.5)*240,Ce=(X()-.5)*180,xe=(X()-.5)*24;return{id:`card-${V+1}`,throw:{x:`${fe.toFixed(0)}px`,y:`${Ce.toFixed(0)}px`,rot:`${xe.toFixed(1)}deg`},grid:{x:`${L.x}px`,y:`${L.y}px`},delay:`${V*.12}s`}})},[]),G=a.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[I,R]=a.useState([]),ee=a.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),te=a.useMemo(()=>{const X=[],L=(fe,Ce)=>fe+Math.random()*(Ce-fe);for(let fe=0;fe<6;fe+=1){let Ce=!1;for(let xe=0;xe<80;xe+=1){const $e=L(14,86),Ue=L(10,34);if(X.every(Re=>{const Ee=Re.x-$e,ke=Re.y-Ue;return Math.hypot(Ee,ke)>=12})){X.push({x:$e,y:Ue}),Ce=!0;break}}Ce||X.push({x:L(16,84),y:L(12,32)})}return X.map((fe,Ce)=>({id:`p${Ce+1}`,x:`${fe.x.toFixed(1)}%`,y:`${fe.y.toFixed(1)}%`,xNum:fe.x,yNum:fe.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ae,Pe]=a.useState(0),[ge,S]=a.useState(0),[pe,v]=a.useState([]),D=1e4,me=a.useMemo(()=>{if(te.length<2)return[];const M=Ce=>{let xe=Ce+1831565813;return xe=Math.imul(xe^xe>>>15,xe|1),xe^=xe+Math.imul(xe^xe>>>7,xe|61),((xe^xe>>>14)>>>0)/4294967296},X=(Ce,xe)=>Math.floor(M(Ce)*xe),ve=new Set,L=[],V=Math.min(3,te.length);let fe=0;for(;L.length<V&&fe<30;){fe+=1;const Ce=X(ae*13+fe*5,te.length),xe=X(ae*29+fe*7,te.length);if(Ce===xe)continue;const $e=Ce<xe?`${Ce}-${xe}`:`${xe}-${Ce}`;ve.has($e)||(ve.add($e),L.push({id:`link-${$e}`,from:te[Ce],to:te[xe],delay:`${(fe*.35).toFixed(2)}s`}))}return L},[ae,te]);a.useEffect(()=>{if(!n||s!==2)return;const M=()=>{const ve=$.map(L=>L.id);for(let L=ve.length-1;L>0;L-=1){const V=Math.floor(Math.random()*(L+1));[ve[L],ve[V]]=[ve[V],ve[L]]}return ve.slice(0,4)};R(M());const X=window.setInterval(()=>{R(M())},U);return()=>window.clearInterval(X)},[s,n,$,U]),a.useEffect(()=>{if(!n||s!==3)return;const M=()=>{S(Math.floor(Math.random()*ee.length)),v(te.map(()=>Math.random()<.6?"good":"bad")),Pe(ve=>ve+1)};M();const X=window.setInterval(M,D);return()=>window.clearInterval(X)},[s,n,ee.length,te,D]);const Q=a.useMemo(()=>Dn(11),[]),[q,ye]=a.useState(new Set(["root"])),[Ie,be]=a.useState(new Set),[Ae,we]=a.useState(new Set),[ze,Ke]=a.useState({fromId:"root",toId:"root",key:0}),je=a.useRef(q),Be=a.useRef("root"),Ze=a.useRef(0),Ye=a.useRef(null),B=a.useRef(null),H=a.useRef([]);a.useEffect(()=>{je.current=q},[q]);const qe=a.useMemo(()=>{const M=new Set;return q.forEach(X=>{const ve=Q.linksByFrom.get(X);ve&&ve.forEach(L=>M.add(L))}),M},[q,Q]),Se=Q.nodesById.get(ze.toId)??Q.nodesById.get("root"),le=Se?`${Se.x/va.width*100}%`:"50%",Le=Se?`${Se.y/va.height*100}%`:"90%";a.useEffect(()=>{if(!n||s!==1||r)return;(()=>{ye(new Set(["root"])),be(new Set),we(new Set),Ke({fromId:"root",toId:"root",key:0}),B.current=null,Ze.current=0,Be.current="root",H.current=[]})();const X=()=>{const L=Be.current,V=je.current,Ce=(Q.childrenByFrom.get(L)??[]).filter(ke=>!V.has(ke));if(Ce.length)return Ce[Math.floor(Math.random()*Ce.length)];if(V.size>=Q.nodes.length){const ke=Q.neighborsById.get(L)??[];return ke.length?ke[Math.floor(Math.random()*ke.length)]:null}const xe=ke=>(Q.childrenByFrom.get(ke)??[]).some(Qe=>!V.has(Qe)),$e=[L],Ue=new Set([L]),We=new Map;let Re=null;for(;$e.length;){const ke=$e.shift();if(!ke)break;if(ke!==L&&xe(ke)){Re=ke;break}(Q.neighborsById.get(ke)??[]).forEach(Qe=>{Ue.has(Qe)||(Ue.add(Qe),We.set(Qe,ke),$e.push(Qe))})}if(!Re)return null;let Ee=Re;for(;We.get(Ee)&&We.get(Ee)!==L;)Ee=We.get(Ee)??Ee;return Ee},ve=(L,V)=>{if(L===V){const fe=X();fe&&ve(L,fe);return}Ze.current+=1,Ke({fromId:L,toId:V,key:Ze.current}),Be.current=V,Ye.current=window.setTimeout(()=>{const fe=Q.parentsById.get(V)??[],Ce=je.current,xe=fe.filter(Re=>!Ce.has(Re));if(!xe.length){const Re=new Set(Ce);Re.add(V),ye(Re),Ye.current=window.setTimeout(()=>{for(;H.current.length;){const ke=H.current[H.current.length-1];if(!Re.has(ke)){if(ke!==V){ve(V,ke);return}break}H.current.pop()}const Ee=X();Ee&&ve(V,Ee)},ya.pauseMs);return}const $e=new Set([V,...xe]),Ue=new Set(xe.map(Re=>`${Re}-${V}`));be($e),we(Ue),H.current.includes(V)||H.current.push(V);const We=xe[Math.floor(Math.random()*xe.length)];B.current={fromId:V,toId:We},Ye.current=window.setTimeout(()=>{be(new Set),we(new Set);const Re=B.current;Re&&ve(Re.fromId,Re.toId)},ya.errorMs)},ya.moveMs)};return Ye.current=window.setTimeout(()=>{const L=X();L&&ve(Be.current,L)},ya.pauseMs),()=>{Ye.current&&window.clearTimeout(Ye.current)}},[s,n,Q,r]);const _e=M=>{if(!n)return;const X=Date.now();X-W.current<520||Math.abs(M.deltaY)<10||(W.current=X,M.deltaY>0?l():m(),M.preventDefault())},K=M=>{if(!n)return;const X=M.touches[0];X&&(w.current={x:X.clientX,y:X.clientY})},he=M=>{if(!n)return;const X=w.current;if(w.current=null,!X)return;const ve=M.changedTouches[0];if(!ve)return;const L=ve.clientX-X.x,V=ve.clientY-X.y;Math.abs(V)<40||Math.abs(V)<Math.abs(L)||(V<0?l():m())};return e.jsxs("div",{className:`cogita-intro ${n?"is-open":"is-closed"} ${r?"is-reduced":""} ${d?"is-final":""}`,"data-slide":s+1,onWheel:_e,onTouchStart:K,onTouchEnd:he,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":k,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${Y&&!o?"is-entry":""}`,children:ue.map((M,X)=>e.jsx("img",{src:M.src,alt:"",className:`cogita-logo-layer ${X===0?"is-base":""} ${M.kind==="text"?"is-text":M.kind==="recreatio"?"is-recreatio":""} ${M.kind==="bubble"?"is-bubble":""}`},M.src))})}),n&&t.map((M,X)=>{const ve=X===s;return e.jsxs("section",{className:`cogita-intro-slide slide-${X+1} ${ve?"is-active":""}`,"aria-hidden":!ve,children:[e.jsxs("div",{className:"cogita-intro-text",children:[M.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:M.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:M.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:M.title}),M.body&&e.jsx("p",{children:M.body.split(`
`).map((L,V)=>e.jsxs("span",{children:[L,V===0&&e.jsx("br",{})]},String(V)))})]}),M.micro&&e.jsx("p",{className:"cogita-intro-micro",children:M.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:d?N:l,children:M.cta}),d&&M.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>y(0),children:M.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[X===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${va.width} ${va.height}`,preserveAspectRatio:"none",children:[Q.links.map(L=>{const V=Q.nodesById.get(L.from),fe=Q.nodesById.get(L.to);if(!V||!fe)return null;const Ce=qe.has(L.key),xe=Ae.has(L.key);return e.jsx("line",{className:`map-link ${Ce?"is-active":""} ${xe?"is-error":""}`,x1:V.x,y1:V.y,x2:fe.x,y2:fe.y},L.key)}),Q.nodes.map(L=>{const V=q.has(L.id),fe=Ie.has(L.id);return e.jsx("circle",{className:`map-node ${L.role?`is-${L.role}`:""} ${V?"is-active":""} ${fe?"is-error":""}`,cx:L.x,cy:L.y,r:L.r},L.id)})]}),Se&&e.jsx("span",{className:"map-explorer-dot",style:{left:le,top:Le,"--move":`${ya.moveMs}ms`}})]}),X===2&&e.jsx("div",{className:"cogita-index-cards",children:$.map(L=>{const V=I.indexOf(L.id),fe=V>=0?G[V]:null,Ce=(fe==null?void 0:fe.x)??"140px",xe=(fe==null?void 0:fe.y)??"140px",$e=V>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":L.throw.x,"--throw-y":L.throw.y,"--throw-rot":L.throw.rot,"--grid-x":L.grid.x,"--grid-y":L.grid.y,"--stack-x":Ce,"--stack-y":xe,"--stack-opacity":$e,"--delay":L.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},L.id)})}),X===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ee.map((L,V)=>e.jsxs("div",{className:`round-card ${V===ge?"is-active":""}`,style:{"--card-x":L.x,"--card-y":L.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},L.id)),ee[ge]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ee[ge].x,"--card-y":`calc(${ee[ge].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:te.map(L=>e.jsx("span",{className:"player-dot",style:{left:L.x,top:L.y,"--jitter-x":L.jitterX,"--jitter-y":L.jitterY,"--breath-delay":L.delay}},L.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:me.map(L=>e.jsx("line",{className:"round-link",x1:L.from.xNum,y1:L.from.yNum,x2:L.to.xNum,y2:L.to.yNum,style:{"--delay":L.delay}},L.id))}),e.jsx("div",{className:"round-flows",children:te.map((L,V)=>{const fe=pe[V]??"good",Ce=ee[ge];if(!Ce)return null;const xe=`calc(${Ce.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":L.x,"--from-y":L.y,"--to-x":Ce.x,"--to-y":xe,"--delay":`${V*.12}s`}}),e.jsx("span",{className:`return-dot is-${fe}`,style:{"--from-x":Ce.x,"--from-y":xe,"--to-x":L.x,"--to-y":L.y,"--delay":`${V*.12}s`}}),e.jsx("span",{className:`result-pop is-${fe}`,style:{"--at-x":L.x,"--at-y":L.y,"--delay":`${V*.12}s`}})]},`${L.id}-${ae}`)})})]},`round-${ae}`),X===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${g[0].x} ${g[0].y} L${g[1].x} ${g[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${g[1].x} ${g[1].y} L${g[2].x} ${g[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${g[2].x} ${g[2].y} L${g[3].x} ${g[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${g[3].x} ${g[3].y} L${g[4].x} ${g[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${g[4].x} ${g[4].y} L${g[5].x} ${g[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${g[5].x} ${g[5].y} L${g[6].x} ${g[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${z};${z};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${re.upper.map((L,V)=>`${V===0?"M":"L"}${L.x} ${L.y}`).join(" ")} ${re.lower.slice().reverse().map(L=>`L${L.x} ${L.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${re.upper.map((L,V)=>`${V===0?"M":"L"}${L.x} ${L.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${re.lower.map((L,V)=>`${V===0?"M":"L"}${L.x} ${L.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[p.higher.slice(0,6).map((L,V)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${V+1}`,d:`M${L.x} ${L.y} L${p.higher[V+1].x} ${p.higher[V+1].y}`,pathLength:"100"},`peer-1-${V}`)),p.lower.slice(0,6).map((L,V)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${V+1}`,d:`M${L.x} ${L.y} L${p.lower[V+1].x} ${p.lower[V+1].y}`,pathLength:"100"},`peer-2-${V}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${g[0].x/300*100}%`,"--p0y":`${g[0].y/200*100}%`,"--p1x":`${g[1].x/300*100}%`,"--p1y":`${g[1].y/200*100}%`,"--p2x":`${g[2].x/300*100}%`,"--p2y":`${g[2].y/200*100}%`,"--p3x":`${g[3].x/300*100}%`,"--p3y":`${g[3].y/200*100}%`,"--p4x":`${g[4].x/300*100}%`,"--p4y":`${g[4].y/200*100}%`,"--p5x":`${g[5].x/300*100}%`,"--p5y":`${g[5].y/200*100}%`,"--p6x":`${g[6].x/300*100}%`,"--p6y":`${g[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${p.higher[0].x/300*100}%`,"--q0y":`${p.higher[0].y/200*100}%`,"--q1x":`${p.higher[1].x/300*100}%`,"--q1y":`${p.higher[1].y/200*100}%`,"--q2x":`${p.higher[2].x/300*100}%`,"--q2y":`${p.higher[2].y/200*100}%`,"--q3x":`${p.higher[3].x/300*100}%`,"--q3y":`${p.higher[3].y/200*100}%`,"--q4x":`${p.higher[4].x/300*100}%`,"--q4y":`${p.higher[4].y/200*100}%`,"--q5x":`${p.higher[5].x/300*100}%`,"--q5y":`${p.higher[5].y/200*100}%`,"--q6x":`${p.higher[6].x/300*100}%`,"--q6y":`${p.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${p.lower[0].x/300*100}%`,"--q0y":`${p.lower[0].y/200*100}%`,"--q1x":`${p.lower[1].x/300*100}%`,"--q1y":`${p.lower[1].y/200*100}%`,"--q2x":`${p.lower[2].x/300*100}%`,"--q2y":`${p.lower[2].y/200*100}%`,"--q3x":`${p.lower[3].x/300*100}%`,"--q3y":`${p.lower[3].y/200*100}%`,"--q4x":`${p.lower[4].x/300*100}%`,"--q4y":`${p.lower[4].y/200*100}%`,"--q5x":`${p.lower[5].x/300*100}%`,"--q5y":`${p.lower[5].y/200*100}%`,"--q6x":`${p.lower[6].x/300*100}%`,"--q6y":`${p.lower[6].y/200*100}%`}})]})})}),X===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),X===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},M.id)}),!n&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:c.title}),c.body&&e.jsx("p",{children:c.body}),c.micro&&e.jsx("p",{className:"cogita-intro-micro",children:c.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:N,children:c.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:E,children:"Otwórz pokaz"})]})]})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:t.map((M,X)=>e.jsx("button",{type:"button",className:`dot ${s===X?"active":""}`,"aria-label":M.title,onClick:()=>y(X)},M.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:x,children:"Pomiń"})]})]})}const Vn=6,On=4;function Un({copy:t,onAuthAction:s,authLabel:n,showProfileMenu:r,onProfileNavigate:l,onToggleSecureMode:m,onLogout:y,secureMode:x,onNavigate:E,language:N,onLanguageChange:d}){const k=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}E("home")},c=a.useRef(null),o=a.useRef([]),O=a.useMemo(()=>{let v=Date.now()%2147483647;const D=()=>(v=v*48271%2147483647,v/2147483647);return Array.from({length:Vn},(me,Q)=>{const q=6+D()*8,ye=7+D()*10,Ie=6+D()*9,be=-D()*q,Ae=-D()*ye,we=-D()*Ie,ze=.18+D()*.28,Ke=12+D()*18,je=4+D()*8,Be=(D()-.5)*3.2,Ze=(D()-.5)*3.8,Ye=D()>.5?"alternate":"alternate-reverse",B=D()>.5?"alternate":"alternate-reverse",H=D()>.5?"alternate":"alternate-reverse",qe=.18+D()*.42,Se=30+D()*60,le=-45-D()*38,Le=188+D()*32,_e=.1+D()*.2;return{id:`wave-${Q+1}`,style:{"--wave-sway-duration":`${q}s`,"--wave-scale-duration":`${ye}s`,"--wave-drift-duration":`${Ie}s`,"--wave-sway-delay":`${be}s`,"--wave-scale-delay":`${Ae}s`,"--wave-drift-delay":`${we}s`,"--wave-sway-dir":Ye,"--wave-scale-dir":B,"--wave-drift-dir":H,"--wave-scale":`${ze}`,"--wave-shift":`${Ke}%`,"--wave-xshift":`${je}%`,"--wave-x0":`${Be}%`,"--wave-y0":`${Ze}%`,"--wave-opacity":`${qe}`,"--wave-blur":`${Se}px`,"--wave-bottom":`${le}%`,"--wave-hue":`${Le}`,"--wave-glow":`${_e}`}}})},[]),ue=a.useMemo(()=>{let v=Date.now()*3%2147483647;const D=()=>(v=v*48271%2147483647,v/2147483647);return Array.from({length:On},(me,Q)=>{const q=180+D()*220,ye=220+D()*280,Ie=-D()*q,be=-D()*ye,Ae=.12+D()*.22,we=3+D()*7,ze=1+D()*3,Ke=(D()-.5)*2.8,je=(D()-.5)*2.2;return{id:`mesh-${Q+1}`,seed:1e3+Q*991+Math.floor(D()*999),style:{"--mesh-sway-duration":`${q}s`,"--mesh-drift-duration":`${ye}s`,"--mesh-sway-delay":`${Ie}s`,"--mesh-drift-delay":`${be}s`,"--mesh-scale":`${Ae}`,"--mesh-shift":`${we}%`,"--mesh-xshift":`${ze}%`,"--mesh-x0":`${je}%`,"--mesh-y0":`${Ke}%`}}})},[]),Y=a.useMemo(()=>{const v=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],D=t.cogita.introSlides,me=new Map(D.map(Q=>[Q.id,Q]));return v.map(Q=>{var ye;const q=me.get(Q.id);return{...Q,...q,title:(q==null?void 0:q.title)??"Cogita",cta:(q==null?void 0:q.cta)??((ye=t.cogita.introSlides[0])==null?void 0:ye.cta)??t.cogita.loginCta,secondary:q==null?void 0:q.secondary}})},[t.cogita.introSlides]),[W,w]=a.useState(0),[g,re]=a.useState(!0),[z,p]=a.useState(!1),U=Y.length-1,$=a.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),G=a.useCallback(()=>{$(),s()},[$,s]),I=a.useCallback(()=>{re(!0),w(0)},[]),R=a.useCallback(()=>{re(!1),w(U)},[U]),ee=a.useCallback(v=>{w(Math.max(0,Math.min(U,v)))},[U]),te=a.useCallback(()=>{W>=U?G():ee(W+1)},[W,ee,G,U]),ae=a.useCallback(()=>{ee(W-1)},[W,ee]);a.useEffect(()=>{var me;const v=(me=window.matchMedia)==null?void 0:me.call(window,"(prefers-reduced-motion: reduce)");if(!v)return;const D=()=>p(v.matches);return D(),v.addEventListener?(v.addEventListener("change",D),()=>v.removeEventListener("change",D)):(v.addListener(D),()=>v.removeListener(D))},[]),a.useEffect(()=>{if(!g)return;const v=D=>{const me=D.target;if(!me)return;const Q=me.tagName;if(!(me.isContentEditable||Q==="INPUT"||Q==="TEXTAREA"||Q==="SELECT"||Q==="BUTTON"||Q==="A"||me.closest('button, a, [role="button"], [role="link"]'))){if(D.key==="Escape"){R();return}if(D.key==="ArrowLeft"||D.key==="ArrowUp"){ae();return}(D.key==="ArrowRight"||D.key==="ArrowDown"||D.code==="Space"||D.key===" ")&&(D.preventDefault(),te())}};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[R,te,ae,g]),a.useEffect(()=>{g&&W===U&&$()},[W,g,U,$]),a.useEffect(()=>{const v=c.current;if(!v)return;const D=o.current.filter(le=>!!le);if(!D.length)return;const me=1,Q=.6,q=.6,ye=Math.max(1,Math.min(me,window.devicePixelRatio||1));let Ie=0,be=0,Ae=Q,we=0,ze=0;const Ke=le=>{let Le=le%2147483647;return Le<=0&&(Le+=2147483646),(_e,K)=>{Le=Le*48271%2147483647;const he=Le/2147483647;return _e+he*(K-_e)}},je={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},Be=le=>{const Le=Math.sin(le*12.9898)*43758.5453;return Le-Math.floor(Le)},Ze=le=>{const Le=Be(le+.1)||1e-4,_e=Be(le+.7)||1e-4;return Math.sqrt(-2*Math.log(Le))*Math.cos(2*Math.PI*_e)},Ye=(le,Le)=>{const _e=Math.floor(le),K=_e+1,he=le-_e,M=he*he*(3-2*he),X=Be(_e*12.9898+Le*78.233),ve=Be(K*12.9898+Le*78.233);return X+(ve-X)*M},B=le=>{const Le=Ke(le),_e=Math.min(4,Math.max(4,Math.floor(Ie/1200*je.filamentCount)));return Array.from({length:_e},(K,he)=>{const M=Math.max(-1,Math.min(1,Ze(le+he*.37))),X=Math.min(1,Math.max(0,Be(le+he*1.31))),ve=Math.min(je.depthLayers-1,Math.floor(X*je.depthLayers));return{seed:Le(0,Math.PI*2)+le*.01,offset:M,freqA:je.freq1*(.75+Le(0,.5)),freqB:je.freq2*(.75+Le(0,.5)),ampA:je.amp1*(.6+Le(0,.7)),ampB:je.amp2*(.6+Le(0,.7)),width:2+he%5*.32,depth:X,layer:ve}})},H=(le,Le,_e)=>{const K=Math.max(30,Math.floor(Ie*be/14e4));le.save(),le.globalAlpha=.6;for(let he=0;he<K;he+=1){const M=Be(he*9.1+Ie*.11)*Le+_e,X=Be(he*3.7+be*.23)*be,ve=1.2+Be(he*5.9)*2.4,L=le.createRadialGradient(M,X,0,M,X,ve*2);L.addColorStop(0,"rgba(10, 30, 60, 0.45)"),L.addColorStop(1,"rgba(10, 30, 60, 0)"),le.fillStyle=L,le.beginPath(),le.arc(M,X,ve*2,0,Math.PI*2),le.fill()}le.restore()},qe=(le,Le)=>{le.clearRect(0,0,Ie,be);const _e=be*je.waveCenter,K=je.waveBandPx,he=je.segments,M=je.colors.filaments,X=we||Ie,ve=0;H(le,X,ve),le.strokeStyle=M,le.lineCap="round",le.lineJoin="round";for(let L=0;L<Le.length;L+=1){const V=Le[L],fe=V.offset*K*(.85+Be(V.seed)*.4),Ce=1-Math.min(1,Math.abs(fe)/K),xe=Math.exp(-Math.pow(fe/je.crestThickness,2)),$e=V.layer===0?1.1:V.layer===1?.85:.6,Ue=.35+(1-V.depth)*.65,We=Ce*Ue*$e*(.34+xe*.45);le.globalAlpha=We,le.lineWidth=V.width*(1+(1-V.depth)*.8);const Re=[];for(let ke=0;ke<=he;ke+=1){const st=ke/he*X+ve,Qe=(Ye(st*.012,V.seed)-.5)*je.xJitter,Ge=st+Qe,mt=(Ye(Ge*V.freqA,V.seed)-.5)*je.jitterA,Tt=(Ye(Ge*V.freqB,V.seed*1.7)-.5)*je.jitterB,He=_e+Math.sin(Ge*V.freqA+V.seed)*V.ampA+Math.sin(Ge*V.freqB+V.seed*1.3)*V.ampB+fe+mt+Tt;Re.push({x:Ge,y:He})}le.beginPath(),le.moveTo(Re[0].x,Re[0].y);for(let ke=1;ke<Re.length-1;ke+=1){const st=(Re[ke].x+Re[ke+1].x)/2,Qe=(Re[ke].y+Re[ke+1].y)/2;le.quadraticCurveTo(Re[ke].x,Re[ke].y,st,Qe)}const Ee=Re[Re.length-1];le.quadraticCurveTo(Ee.x,Ee.y,Ee.x,Ee.y),le.stroke()}le.save(),le.globalCompositeOperation="lighter",le.strokeStyle=je.colors.glow,le.lineCap="round",le.lineJoin="round";for(let L=0;L<Le.length;L+=1){const V=Le[L];if(Math.abs(V.offset)*K>je.crestThickness)continue;const fe=je.glowAlpha*(.7+(1-V.depth)*.6);le.globalAlpha=fe,le.lineWidth=1.6+(1-V.depth)*1.2;const Ce=[];for(let $e=0;$e<=he;$e+=1){const Ue=$e/he*X+ve,We=Math.sin(Ue*.02+V.seed)*3,Re=_e+Math.sin(Ue*V.freqA+V.seed)*V.ampA+Math.sin(Ue*V.freqB+V.seed*1.3)*V.ampB+V.offset*K*.35+We;Ce.push({x:Ue,y:Re})}le.beginPath(),le.moveTo(Ce[0].x,Ce[0].y);for(let $e=1;$e<Ce.length-1;$e+=1){const Ue=(Ce[$e].x+Ce[$e+1].x)/2,We=(Ce[$e].y+Ce[$e+1].y)/2;le.quadraticCurveTo(Ce[$e].x,Ce[$e].y,Ue,We)}const xe=Ce[Ce.length-1];le.quadraticCurveTo(xe.x,xe.y,xe.x,xe.y),le.stroke()}le.restore()},Se=()=>{Ie=Math.floor(v.clientWidth),be=Math.floor(v.clientHeight),we=Math.floor(Ie*1.8),ze=be,Ae=Ie<820?q:Q,D.forEach(le=>{const Le=le.getContext("2d");if(!Le)return;le.width=Math.floor(we*ye*Ae),le.height=Math.floor(ze*ye*Ae),le.style.width=`${we}px`,le.style.height=`${ze}px`,le.style.left=`${-(we-Ie)/2}px`,Le.setTransform(ye*Ae,0,0,ye*Ae,0,0);const _e=Number(le.dataset.seed||1),K=B(_e);qe(Le,K)})};return Se(),window.addEventListener("resize",Se,{passive:!0}),()=>window.removeEventListener("resize",Se)},[ue]);const Pe=Y[Math.min(W,Y.length-1)],ge=g?Pe:Y[Y.length-1],S=(ge==null?void 0:ge.theme)??Y[0].theme,pe={"--cogita-bg0":S.bg0,"--cogita-bg1":S.bg1,"--cogita-bg2":S.bg2,"--cogita-bloom":S.bloom,"--cogita-sat":S.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:k,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Ks,{value:N,onChange:d}),e.jsx(Bs,{copy:t,label:n,isAuthenticated:r,secureMode:x,onLogin:s,onProfileNavigate:l,onToggleSecureMode:m,onLogout:y,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:c,className:"cogita-section cogita-home",style:pe,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[ue.map((v,D)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:v.style,"data-seed":v.seed,ref:me=>{o.current[D]=me}},v.id)),O.map(v=>e.jsx("div",{className:"cogita-home-wave",style:v.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},v.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(qn,{slides:Y,activeIndex:W,introOpen:g,prefersReducedMotion:z,onNext:te,onPrev:ae,onSelect:ee,onExit:R,onOpen:I,onRegister:G})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const Oi=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Un},Symbol.toStringTag,{value:"Module"})),Ws=a.createContext(!1);function Nt({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:d}){if(a.useContext(Ws))return e.jsx(e.Fragment,{children:d});const c=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}x("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:c,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Ks,{value:E,onChange:N}),e.jsx(Bs,{copy:t,label:s,isAuthenticated:n,secureMode:y,onLogin:()=>x("home"),onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:d}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}function Vt(t){const[s,n]=a.useState("Cogita library"),[r,l]=a.useState(null);return a.useEffect(()=>{let m=!1;return _s().then(y=>{if(m)return;const x=y.find(E=>E.libraryId===t);x&&n(x.name)}).catch(()=>{m||n("Cogita library")}),()=>{m=!0}},[t]),a.useEffect(()=>{let m=!1;return cn(t).then(y=>{m||l(y)}).catch(()=>{m||l(null)}),()=>{m=!0}},[t]),{libraryName:s,stats:r}}function xs({slices:t}){const s=t.reduce((r,l)=>r+Math.max(0,l.value),0),n=a.useMemo(()=>{if(s<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let r=0;return`conic-gradient(${t.map(m=>{const x=Math.max(0,m.value)/s*360,E=r,N=r+x;return r=N,`${m.color} ${E}deg ${N}deg`}).join(",")})`},[t,s]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:n}}),e.jsx("div",{className:"cogita-overview-legend",children:t.map(r=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:r.color}}),e.jsx("strong",{children:r.value}),e.jsx("small",{children:r.label})]},r.label))})]})}function Wn({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d}){const{libraryName:k,stats:c}=Vt(d),[o,O]=a.useState("infos"),[ue,Y]=a.useState(0),[W,w]=a.useState(0),[g,re]=a.useState(0),z=(c==null?void 0:c.totalInfos)??0,p=(c==null?void 0:c.totalCollections)??0,U=0,$=0,G=0,I=Math.max(0,z-G-W),R=Math.max(0,z-W-g);a.useEffect(()=>{let te=!1;return(async()=>{try{const Pe=await wa({libraryId:d,limit:200}),ge=await Promise.all(Pe.items.map(S=>Ds({libraryId:d,collectionId:S.collectionId}).catch(()=>[])));if(te)return;Y(ge.reduce((S,pe)=>S+pe.length,0))}catch{te||Y(0)}})(),()=>{te=!0}},[d]),a.useEffect(()=>{let te=!1;return(async()=>{try{const[Pe,ge,S]=await Promise.all([ps({libraryId:d,type:"computed",limit:1}).catch(()=>({total:0})),ps({libraryId:d,type:"source",limit:1}).catch(()=>({total:0})),qs({libraryId:d}).catch(()=>({items:[]}))]);if(te)return;w((Pe.total??0)+(ge.total??0));const pe=new Set(S.items.filter(v=>v.childItemType.toLowerCase()==="info").map(v=>v.childItemId).filter(Boolean));re(pe.size)}catch{te||(w(0),re(0))}})(),()=>{te=!0}},[d]);const ee=[{key:"infos",label:t.cogita.library.overview.stats.totalInfos,value:z},{key:"collections",label:t.cogita.library.overview.stats.collections,value:p},{key:"revisions",label:t.cogita.library.overview.stats.revisions,value:ue},{key:"storyboards",label:t.cogita.library.overview.stats.storyboards,value:U},{key:"texts",label:t.cogita.library.overview.stats.texts,value:$}];return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:k})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ee.map(te=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${o===te.key?"active":""}`,onClick:()=>O(te.key),children:[e.jsx("span",{children:te.label}),e.jsx("strong",{children:te.value})]},te.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:t.cogita.library.overview.statsCardTitle})}),o==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.knownChartTitle}),e.jsx(xs,{slices:[{label:t.cogita.library.overview.known,value:G,color:"#75d79a"},{label:t.cogita.library.overview.unknown,value:I,color:"#85b9ff"},{label:t.cogita.library.overview.excluded,value:W,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.checksChartTitle}),e.jsx(xs,{slices:[{label:t.cogita.library.overview.availableChecks,value:g,color:"#75d79a"},{label:t.cogita.library.overview.unavailableChecks,value:R,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:t.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]})]})})]})})}const Oe=(t,s)=>{const n=t.cogita.library.infoTypes,r=t.cogita.library.connectionTypes,l=t.cogita.library.groupTypes;return{any:n.any,vocab:n.vocab,book:l.book,citation:l.citation,language:n.language,word:n.word,sentence:n.sentence,topic:n.topic,collection:n.collection,person:n.person,institution:n.institution,collective:n.collective,orcid:n.orcid,address:n.address,email:n.email,phone:n.phone,media:n.media,work:n.work,geo:n.geo,music_piece:n.musicPiece,music_fragment:n.musicFragment,source:n.source,quote:n.quote,computed:n.computed,"word-language":r.wordLanguage,"quote-language":r.quoteLanguage,"language-sentence":r.languageSentence,translation:r.translation,"word-topic":r.wordTopic,reference:r.reference,"source-resource":r.sourceResource,"work-contributor":r.workContributor,"work-medium":r.workMedium,"orcid-link":r.orcidLink}[s]??String(s)},Qn=t=>[{value:"any",label:Oe(t,"any")},{value:"language",label:Oe(t,"language")},{value:"word",label:Oe(t,"word")},{value:"sentence",label:Oe(t,"sentence")},{value:"topic",label:Oe(t,"topic")},{value:"collection",label:Oe(t,"collection")},{value:"person",label:Oe(t,"person")},{value:"institution",label:Oe(t,"institution")},{value:"collective",label:Oe(t,"collective")},{value:"orcid",label:Oe(t,"orcid")},{value:"address",label:Oe(t,"address")},{value:"email",label:Oe(t,"email")},{value:"phone",label:Oe(t,"phone")},{value:"media",label:Oe(t,"media")},{value:"work",label:Oe(t,"work")},{value:"geo",label:Oe(t,"geo")},{value:"music_piece",label:Oe(t,"music_piece")},{value:"music_fragment",label:Oe(t,"music_fragment")},{value:"source",label:Oe(t,"source")},{value:"quote",label:Oe(t,"quote")},{value:"citation",label:Oe(t,"citation")},{value:"computed",label:Oe(t,"computed")},{value:"vocab",label:Oe(t,"vocab")},{value:"book",label:Oe(t,"book")},{value:"word-language",label:Oe(t,"word-language")},{value:"quote-language",label:Oe(t,"quote-language")},{value:"language-sentence",label:Oe(t,"language-sentence")},{value:"translation",label:Oe(t,"translation")},{value:"word-topic",label:Oe(t,"word-topic")},{value:"reference",label:Oe(t,"reference")},{value:"source-resource",label:Oe(t,"source-resource")},{value:"work-contributor",label:Oe(t,"work-contributor")},{value:"work-medium",label:Oe(t,"work-medium")},{value:"orcid-link",label:Oe(t,"orcid-link")}],Hn=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}],Ga={key:"languageId",labelKey:"language",kind:"select",path:"languageId",optionsSource:"languages",matcher:"equals"},Yn={language:{infoType:"language",entityKind:"single",structure:{payloadFields:["label","name","code","notes"]},filterFields:[]},word:{infoType:"word",entityKind:"single",structure:{payloadFields:["label","lemma","notes","languageId"],connections:[{relationType:"word-language",role:"language",targetType:"language"}]},filterFields:[Ga]},sentence:{infoType:"sentence",entityKind:"single",structure:{payloadFields:["label","text","notes","languageId"],connections:[{relationType:"language-sentence",role:"language",targetType:"language"}]},filterFields:[Ga]},topic:{infoType:"topic",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},collection:{infoType:"collection",entityKind:"complex",structure:{payloadFields:["label","name","notes"]},filterFields:[]},person:{infoType:"person",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},institution:{infoType:"institution",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},collective:{infoType:"collective",entityKind:"single",structure:{payloadFields:["label","name","notes"]},filterFields:[]},orcid:{infoType:"orcid",entityKind:"single",structure:{payloadFields:["label","orcid","notes"]},filterFields:[{key:"orcid",label:"ORCID",kind:"text",path:"orcid",matcher:"contains"}]},address:{infoType:"address",entityKind:"single",structure:{payloadFields:["label","street","city","postalCode","country","notes"]},filterFields:[]},email:{infoType:"email",entityKind:"single",structure:{payloadFields:["label","email","address","notes"]},filterFields:[]},phone:{infoType:"phone",entityKind:"single",structure:{payloadFields:["label","phone","number","notes"]},filterFields:[]},media:{infoType:"media",entityKind:"single",structure:{payloadFields:["label","name","url","kind","notes"]},filterFields:[]},work:{infoType:"work",entityKind:"single",structure:{payloadFields:["label","title","subtitle","doi","isbn","issn","languageId","originalLanguageId","notes"]},filterFields:[Ga,{key:"originalLanguageId",labelKey:"originalLanguage",kind:"select",path:"originalLanguageId",optionsSource:"languages",matcher:"equals"},{key:"doi",labelKey:"doi",kind:"text",path:"doi",matcher:"contains"}]},geo:{infoType:"geo",entityKind:"single",structure:{payloadFields:["label","name","country","region","city","notes"]},filterFields:[]},music_piece:{infoType:"music_piece",entityKind:"single",structure:{payloadFields:["label","title","composer","notes"]},filterFields:[]},music_fragment:{infoType:"music_fragment",entityKind:"single",structure:{payloadFields:["label","title","text","notes"]},filterFields:[]},source:{infoType:"source",entityKind:"single",structure:{payloadFields:["label","title","sourceKind","locator","notes"],connections:[{relationType:"source-resource",role:"resource",targetType:"work"}]},filterFields:[{key:"sourceKind",labelKey:"sourceKind",kind:"select",path:"sourceKind",optionsSource:"sourceKinds",matcher:"equals"},{key:"locator",labelKey:"locator",kind:"text",path:"locator",matcher:"locator_contains"}]},quote:{infoType:"quote",entityKind:"single",structure:{payloadFields:["title","text","notes"],connections:[{relationType:"quote-language",role:"language",targetType:"language"},{relationType:"reference",role:"source",targetType:"source"}]},filterFields:[{key:"text",labelKey:"quote",kind:"text",path:"text",matcher:"contains"}]},computed:{infoType:"computed",entityKind:"complex",structure:{payloadFields:["label","title","definition","notes"]},filterFields:[]},translation:{infoType:"translation",entityKind:"connection",structure:{payloadFields:["note","tagIds"],connections:[{relationType:"translation",role:"wordA",targetType:"word"},{relationType:"translation",role:"wordB",targetType:"word"},{relationType:"word-language",role:"languageA",targetType:"language"},{relationType:"word-language",role:"languageB",targetType:"language"}]},filterFields:[{key:"languageAId",labelKey:"languageA",kind:"select",optionsSource:"languages",matcher:"equals"},{key:"languageBId",labelKey:"languageB",kind:"select",optionsSource:"languages",matcher:"equals"}]}},vs={infoType:"default",entityKind:"single",structure:{payloadFields:["label","notes"]},filterFields:[]};function Gn(t){return t?Yn[t]??vs:vs}function Xn(t,s){return t.optionsSource==="languages"?s.languages.map(n=>({value:n.infoId,label:n.label})):t.optionsSource==="sourceKinds"?Hn:[]}const Xa=60,Jn=500;function Qs(t){return`cogita.info-selection:${t}`}function ws(t){if(typeof window>"u")return{};const s=window.localStorage.getItem(Qs(t));if(!s)return{};try{const n=JSON.parse(s);return!n||typeof n!="object"?{}:n}catch{return{}}}function Zn({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d,mode:k}){var _e;const c=$s(),o=t.cogita.library.list,[O,ue]=a.useState("any"),[Y,W]=a.useState(""),[w,g]=a.useState("relevance"),[re,z]=a.useState("details"),[p,U]=a.useState(!1),[$,G]=a.useState("idle"),[I,R]=a.useState([]),[ee,te]=a.useState(Xa),[ae,Pe]=a.useState(null),[ge,S]=a.useState(()=>ws(d)),[pe,v]=a.useState({}),[D,me]=a.useState([]),Q=a.useMemo(()=>Qn(t),[t]),q=a.useMemo(()=>[{value:"relevance",label:o.sortRelevance},{value:"label_asc",label:o.sortLabelAsc},{value:"label_desc",label:o.sortLabelDesc},{value:"type_asc",label:o.sortTypeAsc},{value:"type_desc",label:o.sortTypeDesc}],[o.sortLabelAsc,o.sortLabelDesc,o.sortRelevance,o.sortTypeAsc,o.sortTypeDesc]);a.useEffect(()=>{S(ws(d)),v({}),U(!1)},[d]),a.useEffect(()=>{fs({libraryId:d,type:"language",filters:{sourceKind:"info"},limit:200}).then(K=>{const he=K.map(M=>({infoId:M.infoId??"",infoType:M.entityType,label:M.title})).filter(M=>M.infoId.length>0);me(he)}).catch(()=>me([]))},[d]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Qs(d),JSON.stringify(ge))},[d,ge]);const ye=a.useMemo(()=>Gn(O==="any"?null:O),[O]),Ie=a.useMemo(()=>({language:o.typeFilterLanguage,languageA:o.typeFilterLanguageA,languageB:o.typeFilterLanguageB,originalLanguage:o.typeFilterOriginalLanguage,doi:o.typeFilterDoi,sourceKind:o.typeFilterSourceKind,locator:o.typeFilterLocator,quote:o.typeFilterQuote}),[o.typeFilterDoi,o.typeFilterLanguage,o.typeFilterLanguageA,o.typeFilterLanguageB,o.typeFilterLocator,o.typeFilterOriginalLanguage,o.typeFilterQuote,o.typeFilterSourceKind]),be=a.useMemo(()=>ye.filterFields.map(K=>({...K,label:K.labelKey?Ie[K.labelKey]:K.label??K.key,options:Xn(K,{languages:D})})),[Ie,D,ye.filterFields]),Ae=a.useMemo(()=>be.some(K=>(pe[K.key]??"").trim().length>0),[be,pe]);a.useEffect(()=>{v({})},[O]),a.useEffect(()=>{const K={sourceKind:"info"};if(Ae)for(const M of be){const X=(pe[M.key]??"").trim();X&&(K[M.path??M.key]=X)}G("loading");const he=window.setTimeout(()=>{fs({libraryId:d,type:O==="any"?void 0:O,query:Y.trim()||void 0,filters:K,limit:Jn}).then(M=>{const X=M.map(ve=>({infoId:ve.infoId??"",infoType:ve.entityType,label:ve.title})).filter(ve=>ve.infoId.length>0);R(X),G("ready")}).catch(()=>{R([]),G("ready")})},240);return()=>window.clearTimeout(he)},[Ae,d,Y,O,be,pe]);const we=a.useMemo(()=>{const K=I.slice(),he=M=>Oe(t,M);return w==="relevance"?K:w==="label_asc"?K.sort((M,X)=>M.label.localeCompare(X.label)):w==="label_desc"?K.sort((M,X)=>X.label.localeCompare(M.label)):w==="type_asc"?K.sort((M,X)=>M.infoType===X.infoType?M.label.localeCompare(X.label):he(M.infoType).localeCompare(he(X.infoType))):K.sort((M,X)=>M.infoType===X.infoType?M.label.localeCompare(X.label):he(X.infoType).localeCompare(he(M.infoType)))},[t,I,w]),ze=a.useMemo(()=>we.slice(0,ee),[we,ee]),Ke=ze.length<we.length,je=a.useMemo(()=>new Set(Object.keys(ge)),[ge]),Be=a.useMemo(()=>Object.values(ge),[ge]),Ze=a.useMemo(()=>{const K=new Map;for(const he of Be)K.set(he.infoType,(K.get(he.infoType)??0)+1);return Array.from(K.entries()).sort((he,M)=>M[1]-he[1]||he[0].localeCompare(M[0]))},[Be]);a.useEffect(()=>{te(Xa);const K=new Set(I.map(he=>he.infoId));Pe(he=>he&&K.has(he)?he:null)},[I]);const Ye=K=>{S(he=>({...he,[K.infoId]:{infoId:K.infoId,infoType:K.infoType,label:K.label}}))},B=K=>{S(he=>{if(!he[K])return he;const M={...he};return delete M[K],M})},H=(K,he)=>{if(he){Ye(K);return}B(K.infoId)},qe=K=>{c(`/cogita/library/${d}/list?infoId=${encodeURIComponent(K)}&infoView=overview`,{replace:!0})},Se=Be.length===1?((_e=Be[0])==null?void 0:_e.infoId)??null:null,le=o.selectionCount.replace("{count}",String(Be.length)),Le=k==="collection"?"grid":k==="detail"?"wide":re;return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":Le,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-search-surface",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":o.typeLabel,value:O,onChange:K=>ue(K.target.value),children:Q.map(K=>e.jsx("option",{value:K.value,children:K.label},K.value))}),e.jsx("input",{type:"text",value:Y,onChange:K=>W(K.target.value),placeholder:o.searchPlaceholder}),e.jsx("select",{"aria-label":o.sortLabel,value:w,onChange:K=>g(K.target.value),children:q.map(K=>e.jsx("option",{value:K.value,children:K.label},K.value))}),e.jsxs("select",{"aria-label":o.viewLabel,value:re,onChange:K=>z(K.target.value),children:[e.jsx("option",{value:"details",children:o.viewDetails}),e.jsx("option",{value:"wide",children:o.viewWide}),e.jsx("option",{value:"grid",children:o.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:o.cardCount.replace("{shown}",String(ze.length)).replace("{total}",String(we.length))}),e.jsx("span",{children:$==="loading"?o.loading:o.ready})]}),e.jsxs("div",{className:"cogita-filters-toggle-row",children:[e.jsx("button",{type:"button",className:"ghost cogita-filters-toggle",onClick:()=>U(K=>!K),children:p?o.hideFilters:o.showFilters}),e.jsx("span",{className:"cogita-sidebar-note",children:o.filtersOptionalHint})]}),p&&be.length>0?e.jsx("section",{className:"cogita-library-filters cogita-library-filters--compact",children:e.jsx("div",{className:"cogita-filter-grid",children:be.map(K=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:K.label}),K.kind==="select"?e.jsxs("select",{value:pe[K.key]??"",onChange:he=>v(M=>({...M,[K.key]:he.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),(K.options??[]).map(he=>e.jsx("option",{value:he.value,children:he.label},`${K.key}:${he.value}`))]}):e.jsx("input",{type:"text",value:pe[K.key]??"",onChange:he=>v(M=>({...M,[K.key]:he.target.value}))})]},`type-filter:${K.key}`))})}):null,e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:le}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{S(K=>{const he={...K};for(const M of ze)he[M.infoId]={infoId:M.infoId,infoType:M.infoType,label:M.label};return he})},disabled:ze.length===0,children:o.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>S({}),disabled:Be.length===0,children:o.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Se&&qe(Se),disabled:!Se,title:Se?void 0:o.openSelectedDisabled,children:o.openSelected})]})]}),Be.length>0?e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:o.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:o.selectedStackHint}),e.jsx("div",{className:"cogita-selection-overview",children:Ze.map(([K,he])=>e.jsxs("span",{className:"cogita-tag-chip",children:[e.jsx("span",{children:Oe(t,K)}),e.jsx("span",{className:"cogita-tag-count",children:he})]},`stack:type:${K}`))})]}):null,Le==="details"?e.jsxs("div",{className:"cogita-details-grid",role:"table","aria-label":o.searchTitle,children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:o.detailColumnName}),e.jsx("span",{children:o.detailColumnType}),e.jsx("span",{children:o.detailColumnId}),e.jsx("span",{})]}),ze.length?ze.map(K=>{const he=Oe(t,K.infoType),M=je.has(K.infoId),X=ae===K.infoId;return e.jsxs("div",{className:`cogita-details-row ${X||M?"active":""}`,role:"row",onClick:()=>Pe(K.infoId),children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:ve=>H(K,ve.target.checked),onClick:ve=>ve.stopPropagation()}),e.jsx("span",{})]}),e.jsx("span",{title:K.label,children:K.label}),e.jsx("span",{title:he,children:he}),e.jsx("span",{title:K.infoId,children:K.infoId}),e.jsx("button",{type:"button",className:"ghost cogita-details-open",onClick:ve=>{ve.stopPropagation(),qe(K.infoId)},"aria-label":o.editInfo,children:">"})]},K.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:o.noMatch})})]}):e.jsx("div",{className:`cogita-card-list cogita-card-list--${Le}`,"data-view":Le,children:ze.length?ze.map(K=>{const he=Oe(t,K.infoType),M=je.has(K.infoId),X=ae===K.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":X||M,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:ve=>H(K,ve.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>Pe(K.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:he}),e.jsx("h3",{className:"cogita-card-title",children:K.label}),e.jsx("p",{className:"cogita-card-subtitle",children:K.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>qe(K.infoId),children:o.editInfo})]})},K.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:o.noMatch})})}),Ke?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>te(K=>K+Xa),children:o.loadMore})}):null]})})})})})}const ta=5,js=50,ks=2,Ns=[];function aa({libraryId:t,infoType:s,label:n,placeholder:r,value:l,onChange:m,values:y,onChangeMultiple:x,helperText:E,searchFailedText:N,createFailedText:d,createLabel:k,savingLabel:c,loadMoreLabel:o,inputRef:O,autoAdvance:ue,onCommit:Y,multiple:W}){const w=W?y??Ns:Ns,[g,re]=a.useState(W?"":(l==null?void 0:l.label)??""),[z,p]=a.useState([]),[U,$]=a.useState(ta),[G,I]=a.useState(-1),[R,ee]=a.useState(!1),[te,ae]=a.useState(!1),[Pe,ge]=a.useState(null),S=a.useRef(0),pe=a.useRef(new Map),v=a.useMemo(()=>W?g.trim().length>0:g.trim().length>0&&!l,[g,l,W]);a.useEffect(()=>{W||re((l==null?void 0:l.label)??"")},[l,W]),a.useEffect(()=>{const Q=g.trim();if(!Q||Q.length<ks){p([]),ee(!1),$(ta),I(-1),ae(!1),ge(null);return}const q=Q.toLowerCase(),ye=`${t}:${s}:${q}`,Ie=pe.current.get(ye);if(Ie){if(W&&w.length>0){const Ae=new Set(w.map(we=>we.id));p(Ie.filter(we=>!Ae.has(we.id)))}else p(Ie);$(ta),I(-1),ee(Ie.length>0),ae(!1),ge(null);return}const be=window.setTimeout(async()=>{const Ae=Date.now();S.current=Ae,ae(!0),ge(null);try{const we=await ds({libraryId:t,type:s,query:Q,limit:js});if(S.current!==Ae)return;const ze=we.slice(0,js).map(Ke=>({id:Ke.infoId,label:Ke.label,infoType:Ke.infoType}));if(pe.current.set(ye,ze),W&&w.length>0){const Ke=new Set(w.map(je=>je.id));p(ze.filter(je=>!Ke.has(je.id)))}else p(ze);$(ta),I(-1),ee(!0)}catch{if(S.current!==Ae)return;ge(N??"Search failed.")}finally{S.current===Ae&&ae(!1)}},250);return()=>window.clearTimeout(be)},[t,s,g,w]);const D=Q=>{if(W){const q=w.some(ye=>ye.id===Q.id)?w:[...w,Q];x==null||x(q),re(""),ee(!1),I(-1);return}m==null||m(Q),re(Q.label),ee(!1),I(-1),ue&&(Y==null||Y())},me=async()=>{const Q=g.trim();if(Q){ae(!0),ge(null);try{const q=await Vs({libraryId:t,infoType:s,payload:{label:Q}}),ye={id:q.infoId,label:Q,infoType:q.infoType};if(Q.length>=ks){const Ie=`${t}:${s}:${Q.toLowerCase()}`,be=pe.current.get(Ie)??[];pe.current.set(Ie,[ye,...be])}if(W){x==null||x([...w,ye]),re(""),ee(!1),I(-1);return}m==null||m(ye),ee(!1),I(-1),ue&&(Y==null||Y())}catch{ge(d??"Create failed.")}finally{ae(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:n}),e.jsx("input",{value:g,placeholder:r,onChange:Q=>{re(Q.target.value),!W&&l&&(m==null||m(null))},onKeyDown:Q=>{if(Q.key==="ArrowDown"){if(Q.preventDefault(),!z.length)return;ee(!0),I(q=>{const ye=Math.min(z.length,U)-1,Ie=q<0?0:Math.min(q+1,ye);return Ie===ye&&z.length>U?($(be=>Math.min(be+ta,z.length)),Math.min(q+1,Math.min(z.length,U+ta)-1)):Ie});return}if(Q.key==="ArrowUp"){if(Q.preventDefault(),!z.length)return;ee(!0),I(q=>q<=0?0:q-1);return}if(Q.key==="Enter"){if(Q.preventDefault(),G>=0&&z[G]){D(z[G]);return}if(v){me();return}}},onFocus:()=>{z.length>0&&ee(!0)},autoComplete:"off",ref:O})]}),W&&w.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:w.map(Q=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>x==null?void 0:x(w.filter(q=>q.id!==Q.id)),children:[Q.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},Q.id))}),E&&e.jsx("p",{className:"cogita-help",children:E}),Pe&&e.jsx("p",{className:"cogita-error",children:Pe}),R&&z.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[z.slice(0,U).map((Q,q)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":q===G,onClick:()=>D(Q),children:[e.jsx("strong",{children:Q.label}),e.jsx("span",{children:Q.infoType})]},Q.id)),U<z.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>$(Q=>Math.min(Q+ta,z.length)),children:o??"Load more"})]}),v&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:me,disabled:te,children:te?c??"Saving...":k??`Create new ${s}`})]})}function ei(t){return t==null?"":typeof t=="string"?t:JSON.stringify(t)}function Ts(t,s){if(!t||typeof t!="object")return s;const n=t,r=[n.label,n.name,n.title,n.text,n.orcid,n.email,n.number];for(const l of r)if(typeof l=="string"&&l.trim())return l.trim();return s}function ti({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d,editInfoId:k}){const{libraryName:c}=Vt(d),o=!!k,[O,ue]=a.useState([]),[Y,W]=a.useState("word"),[w,g]=a.useState({}),[re,z]=a.useState({}),[p,U]=a.useState({}),[$,G]=a.useState({}),[I,R]=a.useState(null),[ee,te]=a.useState("idle"),ae=a.useMemo(()=>O.find(v=>v.infoType===Y),[Y,O]),Pe=a.useMemo(()=>O.map(v=>({value:v.infoType,label:Oe(t,v.infoType)})),[t,O]);a.useEffect(()=>{let v=!1;return dn({libraryId:d}).then(D=>{var me;if(!v&&(ue(D),!o)){const Q=(me=D[0])==null?void 0:me.infoType;Q&&W(Q)}}).catch(()=>{v||ue([])}),()=>{v=!0}},[o,d]),a.useEffect(()=>{if(!ae)return;const v={},D={},me={},Q={};for(const q of ae.payloadFields)v[q.key]="";for(const q of ae.linkFields)q.multiple?me[q.key]=[]:D[q.key]=null,q.targetTypes.length>0&&(Q[q.key]=q.targetTypes[0]);g(v),z(D),U(me),G(Q)},[ae==null?void 0:ae.infoType]),a.useEffect(()=>{if(!o||!k||O.length===0)return;let v=!1;return te("loading"),R(null),(async()=>{const me=await ua({libraryId:d,infoId:k});if(v)return;const Q=me.infoType;W(Q);const q=O.find(je=>je.infoType===Q);if(!q){te("idle");return}const ye=me.payload??{},Ie={};for(const je of q.payloadFields)Ie[je.key]=ei(ye[je.key]);g(Ie);const be=me.links??{}??{},Ae={},we={},ze={},Ke=[];for(const je of q.linkFields){je.targetTypes.length>0&&(ze[je.key]=je.targetTypes[0]);const Be=be[je.key];if(je.multiple){const Ze=Array.isArray(Be)?Be.filter(Ye=>typeof Ye=="string"):[];we[je.key]=[];for(const Ye of Ze)Ke.push(ua({libraryId:d,infoId:Ye}).then(B=>{if(v)return;const H={id:Ye,infoType:B.infoType,label:Ts(B.payload,Ye)};we[je.key]=[...we[je.key],H]}).catch(()=>{}))}else{const Ze=typeof Be=="string"?Be:null;Ae[je.key]=null,Ze&&Ke.push(ua({libraryId:d,infoId:Ze}).then(Ye=>{v||(Ae[je.key]={id:Ze,infoType:Ye.infoType,label:Ts(Ye.payload,Ze)})}).catch(()=>{}))}}await Promise.all(Ke),!v&&(z(Ae),U(we),G(je=>({...je,...ze})),te("idle"))})().catch(()=>{v||(R("Failed to load info details."),te("idle"))}),()=>{v=!0}},[k,o,d,O]);const ge=async()=>{var Q;if(!ae)return;const v={};for(const q of ae.payloadFields){const ye=(w[q.key]??"").trim();if(!ye){if(q.required){R(`Field '${q.label}' is required.`);return}continue}if(q.inputType==="json")try{v[q.key]=JSON.parse(ye)}catch{R(`Field '${q.label}' must be valid JSON.`);return}else v[q.key]=ye}const D={};for(const q of ae.linkFields)if(q.multiple){const ye=(p[q.key]??[]).map(Ie=>Ie.id);if(q.required&&ye.length===0){R(`Link '${q.label}' is required.`);return}ye.length>0&&(D[q.key]=ye)}else{const ye=((Q=re[q.key])==null?void 0:Q.id)??null;if(q.required&&!ye){R(`Link '${q.label}' is required.`);return}ye&&(D[q.key]=ye)}const me=Object.keys(D).length>0;te("saving"),R(null);try{if(o&&k)await un({libraryId:d,infoId:k,payload:v,links:me?D:void 0}),R("Info updated.");else{await Vs({libraryId:d,infoType:Y,payload:v,links:me?D:void 0}),R("Info saved.");const q={};for(const be of ae.payloadFields)q[be.key]="";g(q);const ye={},Ie={};for(const be of ae.linkFields)be.multiple?Ie[be.key]=[]:ye[be.key]=null;z(be=>({...be,...ye})),U(be=>({...be,...Ie}))}}catch{R("Failed to save info.")}finally{te("idle")}},S=v=>{const D=w[v.key]??"",me=v.inputType==="textarea"||v.inputType==="json";return e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.label}),me?e.jsx("textarea",{rows:v.inputType==="json"?8:4,value:D,onChange:Q=>g(q=>({...q,[v.key]:Q.target.value})),placeholder:v.key}):e.jsx("input",{type:"text",value:D,onChange:Q=>g(q=>({...q,[v.key]:Q.target.value})),placeholder:v.key})]},`payload:${v.key}`)},pe=v=>{const D=$[v.key]??v.targetTypes[0];return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:v.label}),v.targetTypes.length>1?e.jsx("select",{value:D,onChange:me=>G(Q=>({...Q,[v.key]:me.target.value})),children:v.targetTypes.map(me=>e.jsx("option",{value:me,children:Oe(t,me)},`${v.key}:${me}`))}):null,v.multiple?e.jsx(aa,{libraryId:d,infoType:D,label:v.label,placeholder:v.key,multiple:!0,values:p[v.key]??[],onChangeMultiple:me=>U(Q=>({...Q,[v.key]:me})),searchFailedText:"Search failed",createFailedText:"Create failed"}):e.jsx(aa,{libraryId:d,infoType:D,label:v.label,placeholder:v.key,value:re[v.key]??null,onChange:me=>z(Q=>({...Q,[v.key]:me})),searchFailedText:"Search failed",createFailedText:"Create failed"})]},`link:${v.key}`)};return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:o?"Edit info":"Create info"}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:"Specification-driven editor"})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:`/#/cogita/library/${d}/list`,children:"Back to list"})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-panel",children:[o?null:e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Info type"}),e.jsx("select",{value:Y,onChange:v=>W(v.target.value),children:Pe.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))})]}),ee==="loading"?e.jsx("p",{children:"Loading..."}):null,ae?e.jsxs("div",{className:"cogita-form-grid",children:[ae.payloadFields.map(S),ae.linkFields.map(pe)]}):e.jsx("p",{children:"No specification found for this info type."}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:ge,disabled:ee==="saving"||!ae,children:ee==="saving"?"Saving...":o?"Update info":"Create info"})}),I?e.jsx("p",{className:"cogita-library-subtitle",children:I}):null]})})})]})})}const Ss=t=>/\s/.test(t),Ra=t=>/[\p{L}\p{N}]/u.test(t),Cs=(t,s)=>{const n=s>0?t[s-1]:"",r=s<t.length?t[s]:"";if(!n||!r)return 0;const l=Ss(n),m=Ss(r);if(l||m)return 3;const y=Ra(n),x=Ra(r);return y!==x?2:!y&&!x?1:0},Ja=(t,s,n,r,l)=>{const m=Math.max(r-s,n-r);for(let y=0;y<=m;y+=1){const x=r-y;if(x>=s&&x<=n&&Cs(t,x)>=l)return x;const E=r+y;if(E>=s&&E<=n&&Cs(t,E)>=l)return E}return null},Za=(t,s)=>{const n=s>0?t[s-1]:"",r=s<t.length?t[s]:"";return!n||!r?!0:Ra(n)!==Ra(r)},ai=(t,s,n,r)=>{const l=n-s,m=s+r,y=n-r;if(l<=r*2||y<=m)return null;const x=Math.floor((s+n)/2),E=Ja(t,m,y,x,3);if(E!==null&&Za(t,E))return E;const N=Ja(t,m,y,x,2);if(N!==null&&Za(t,N))return N;const d=Ja(t,m,y,x,1);return d!==null&&Za(t,d)?d:null},ma=(t,s)=>{const n=Math.max(1,7),r=Math.max(n,13),l={},m=(E,N,d,k,c)=>{const o=String(k),O={id:o,start:E,end:N,text:t.slice(E,N),depth:d,index:k,parentId:c};if(l[o]=O,N-E>r){let Y=ai(t,E,N,n);if(Y!==null&&Y>E&&Y<N){const W=m(E,Y,d+1,k*2+1,o),w=m(Y,N,d+1,k*2+2,o);O.leftId=W.id,O.rightId=w.id}}return O},y=m(0,t.length,0,0),x=Object.values(l).sort((E,N)=>N.depth-E.depth||E.start-N.start).map(E=>E.id);return{text:t,rootId:y.id,nodes:l,order:x}},ha=(t,s,n,r,l,m,y)=>{const x=m==="reverse"?t.order.slice().sort((E,N)=>t.nodes[N].start-t.nodes[E].start||t.nodes[N].depth-t.nodes[E].depth):t.order;for(const E of x){if(y&&E===y||s.has(E))continue;const N=t.nodes[E];if(N){if(l&&(N.leftId||N.rightId)){const d=N.leftId?n[N.leftId]??0:r,k=N.rightId?n[N.rightId]??0:r;if((d+k)/2<r)continue}return N}}return null},Hs=(t,s)=>({before:t.slice(0,s.start),fragment:t.slice(s.start,s.end),after:t.slice(s.end)});function si({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d}){const k=`/#/cogita/library/${d}`,[c,o,O]=Rs([]),[ue,Y,W]=Es([]),[w,g]=a.useState(null),[re,z]=a.useState(null),[p,U]=a.useState(null),[$,G]=a.useState(null),I=a.useMemo(()=>c.find(S=>S.id===w)??null,[c,w]);a.useEffect(()=>{let S=!0;return hn({libraryId:d}).then(pe=>{if(!S)return;const v=pe.nodes.map(D=>{var me,Q,q;return{id:D.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:D.payload&&typeof D.payload=="object"&&"label"in D.payload?String(D.payload.label):"Item",nodeType:D.nodeType,itemType:((me=D.payload)==null?void 0:me.itemType)??"info",itemId:((Q=D.payload)==null?void 0:Q.itemId)??null,infoType:((q=D.payload)==null?void 0:q.infoType)??null}}});o(v),Y(pe.edges.map(D=>({id:D.edgeId,source:D.fromNodeId,target:D.toNodeId})))}).catch(()=>{S&&(o([]),Y([]))}),()=>{S=!1}},[d]),a.useEffect(()=>{gn({libraryId:d}).then(z).catch(()=>z(null))},[d,c,ue]);const R=a.useCallback(S=>{Y(pe=>As(S,pe))},[]),ee=()=>{const S=crypto.randomUUID();o(pe=>[...pe,{id:S,type:"default",position:{x:140+pe.length*40,y:120+pe.length*30},data:{label:t.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},te=()=>{const S=crypto.randomUUID();o(pe=>[...pe,{id:S,type:"default",position:{x:180+pe.length*40,y:160+pe.length*30},data:{label:t.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ae=async()=>{U(null);try{const S=c.map(v=>({nodeId:v.id,nodeType:v.data.nodeType,payload:{itemType:v.data.itemType,itemId:v.data.itemId??null,label:v.data.label,infoType:v.data.infoType??null}})),pe=ue.map(v=>({edgeId:v.id,fromNodeId:v.source,toNodeId:v.target}));await mn({libraryId:d,nodes:S,edges:pe}),U(t.cogita.library.graph.saveSuccess)}catch{U(t.cogita.library.graph.saveFail)}},Pe=S=>{I&&o(pe=>pe.map(v=>v.id===I.id?{...v,data:{...v.data,itemId:(S==null?void 0:S.infoId)??null,itemType:"collection",infoType:"collection",label:(S==null?void 0:S.label)??t.cogita.library.infoTypes.collection}}:v))},ge=S=>{I&&o(pe=>pe.map(v=>v.id===I.id?{...v,data:{...v.data,itemId:(S==null?void 0:S.infoId)??null,itemType:"info",infoType:(S==null?void 0:S.infoType)??null,label:(S==null?void 0:S.label)??t.cogita.library.infoTypes.any}}:v))};return a.useEffect(()=>{if(!I||I.data.nodeType!=="info"||I.data.infoType!=="quote"||!I.data.itemId){G(null);return}let S=!0;return ua({libraryId:d,infoId:I.data.itemId}).then(pe=>{if(!S)return;const v=pe.payload,D=(v==null?void 0:v.text)??"";if(!D){G(null);return}const me=ma(D),Q=Object.values(me.nodes).sort((q,ye)=>q.depth-ye.depth||q.start-ye.start).map(q=>({id:q.id,text:q.text,depth:q.depth}));G({title:(v==null?void 0:v.title)??I.data.label,fragments:Q})}).catch(()=>G(null)),()=>{S=!1}},[d,I]),e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:t.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:k,children:t.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ae,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ee,children:t.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:te,children:t.cogita.library.actions.addInfo}),re?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(re.totalCollections))})}):null,p?e.jsx("p",{className:"cogita-help",children:p}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Fs,{nodes:c,edges:ue,onNodesChange:O,onEdgesChange:W,onConnect:R,onNodeClick:(S,pe)=>g(pe.id),fitView:!0,children:[e.jsx(Ps,{gap:18,size:1}),e.jsx(zs,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),I?e.jsxs("div",{className:"cogita-graph-inspector",children:[I.data.nodeType==="collection"?e.jsx(aa,{libraryId:d,infoType:"collection",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:I.data.itemId?{id:I.data.itemId,label:I.data.label,infoType:"collection"}:null,onChange:Pe,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.collection),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}):e.jsx(aa,{libraryId:d,infoType:"any",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:I.data.itemId?{id:I.data.itemId,label:I.data.label,infoType:I.data.infoType??void 0}:null,onChange:ge,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.any),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),$?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:$.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:$.fragments.map(S=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:S.id}),e.jsx("span",{children:S.text})]},S.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}function ni({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d,collectionId:k}){const{libraryName:c}=Vt(d),[o,O]=a.useState([]),[ue,Y]=a.useState("loading"),[W,w]=a.useState("idle"),g=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),re=`/#/cogita/library/${d}`,z=()=>{Y("loading"),Os({libraryId:d}).then($=>{O($),Y("idle")}).catch(()=>{O([]),Y("error")})};a.useEffect(()=>{z()},[d]);const p=async $=>{try{await Us({libraryId:d,shareId:$}),z()}catch{z()}},U=async $=>{const G=`${g}/${$}`;try{await navigator.clipboard.writeText(G),w("copied")}catch{w("failed")}};return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:re,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${re}/collections`,children:t.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[ue==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):ue==="error"?e.jsx("p",{children:t.cogita.library.revision.shareError}):o.filter($=>!k||$.collectionId===k).length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:o.filter($=>!k||$.collectionId===k).map($=>e.jsxs("div",{className:"cogita-share-row","data-state":$.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:$.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date($.createdUtc).toLocaleString(),$.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]}),$.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${g}/${$.shareCode}`}):null]}),$.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[$.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>U($.shareCode),children:t.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>p($.shareId),children:t.cogita.library.revision.shareRevokeAction})]})]},$.shareId))}),W==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):W==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function ii({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d}){const{libraryName:k}=Vt(d),[c,o]=a.useState(null),[O,ue]=a.useState(null),[Y,W]=a.useState(null),[w,g]=a.useState(null),[re,z]=a.useState(null),[p,U]=a.useState(null),$=a.useRef(null),G=ee=>{if(!Number.isFinite(ee))return"0 B";if(ee<1024)return`${ee} B`;const te=ee/1024;if(te<1024)return`${te.toFixed(1)} KB`;const ae=te/1024;return ae<1024?`${ae.toFixed(1)} MB`:`${(ae/1024).toFixed(1)} GB`},I=async()=>{o(null),z({loadedBytes:0,totalBytes:null,percent:null});try{o(t.cogita.library.overview.exporting);const ee=await pn(d,z),te=URL.createObjectURL(ee),ae=document.createElement("a");ae.href=te,ae.download=`cogita-library-${k||d}.json`,ae.click(),URL.revokeObjectURL(te),o(t.cogita.library.overview.exportReady)}catch{o(t.cogita.library.overview.exportFail)}finally{z(ee=>ee??{loadedBytes:0,totalBytes:null,percent:null})}},R=async ee=>{var ae;ue(null),W(null),g(null);const te=(ae=ee.target.files)==null?void 0:ae[0];if(te)try{ue(t.cogita.library.overview.importing),U({loadedBytes:0,totalBytes:te.size,percent:0});const Pe=await fn(d,te,U,ge=>{const S=ge.stage==="infos"?t.cogita.library.overview.importStageInfos:ge.stage==="connections"?t.cogita.library.overview.importStageConnections:t.cogita.library.overview.importStageCollections;g(t.cogita.library.overview.importLiveProgress.replace("{stage}",S).replace("{done}",String(ge.processed)).replace("{total}",String(ge.total)).replace("{infos}",String(ge.infos)).replace("{connections}",String(ge.connections)).replace("{collections}",String(ge.collections)))});W({infos:Pe.infosImported,connections:Pe.connectionsImported,collections:Pe.collectionsImported}),ue(t.cogita.library.overview.importDone)}catch(Pe){const ge=Pe instanceof bn&&Pe.message?` ${Pe.message}`:"";ue(`${t.cogita.library.overview.importFail}${ge}`)}finally{$.current&&($.current.value="")}};return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:k}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:I,children:t.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[t.cogita.library.overview.import,e.jsx("input",{ref:$,type:"file",accept:"application/json",onChange:R})]})]}),re?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:re.percent??void 0,max:re.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.exportProgress.replace("{loaded}",G(re.loadedBytes)).replace("{total}",re.totalBytes?G(re.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,p?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:p.percent??void 0,max:p.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.importProgress.replace("{loaded}",G(p.loadedBytes)).replace("{total}",p.totalBytes?G(p.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,c?e.jsx("p",{className:"cogita-help",children:c}):null,O?e.jsx("p",{className:"cogita-help",children:O}):null,w?e.jsx("p",{className:"cogita-help",children:w}):null,Y?e.jsx("p",{className:"cogita-help",children:t.cogita.library.overview.importSummary.replace("{infos}",String(Y.infos)).replace("{connections}",String(Y.connections)).replace("{collections}",String(Y.collections))}):null]})]})})})]})})}function ri({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d}){const{libraryName:k}=Vt(d),[c,o]=a.useState(""),[O,ue]=a.useState([]),Y=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:k}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:c,onChange:W=>o(W.target.value),placeholder:t.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const W=c.trim();W&&(ue(w=>[{id:Y(),name:W},...w]),o(""))},children:t.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[O.length===0?e.jsx("p",{children:t.cogita.library.modules.storyboardsEmpty}):null,O.map(W=>e.jsx("button",{type:"button",className:"ghost",children:W.name},W.id))]})]})]})})})]})})}function oi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d}){const{libraryName:k}=Vt(d),[c,o]=a.useState(""),[O,ue]=a.useState([]),Y=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:k}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:c,onChange:W=>o(W.target.value),placeholder:t.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const W=c.trim();W&&(ue(w=>[{id:Y(),name:W},...w]),o(""))},children:t.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[O.length===0?e.jsx("p",{children:t.cogita.library.modules.textsEmpty}):null,O.map(W=>e.jsx("button",{type:"button",className:"ghost",children:W.name},W.id))]})]})]})})})]})})}function Ms({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d}){const{libraryName:k}=Vt(d),c=`/#/cogita/library/${d}`,[o,O]=a.useState(""),[ue,Y]=a.useState([]),[W,w]=a.useState("idle"),[g,re]=a.useState(0),[z,p]=a.useState(null);a.useEffect(()=>{w("loading");const $=window.setTimeout(()=>{wa({libraryId:d,query:o.trim()||void 0,limit:30}).then(G=>{Y(G.items),re(G.total),p(G.nextCursor??null),w("ready")}).catch(()=>{Y([]),re(0),p(null),w("ready")})},240);return()=>window.clearTimeout($)},[d,o]);const U=async()=>{if(z){w("loading");try{const $=await wa({libraryId:d,query:o.trim()||void 0,limit:30,cursor:z});Y(G=>[...G,...$.items]),p($.nextCursor??null),re($.total),w("ready")}catch{w("ready")}}};return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:k}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${c}/collections/new`,children:t.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:o,onChange:$=>O($.target.value),placeholder:t.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:t.cogita.library.collections.countLabel.replace("{shown}",String(ue.length)).replace("{total}",String(g||ue.length))}),e.jsx("span",{children:W==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:ue.length?ue.map($=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${c}/collections/${$.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:$.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.collections.itemCountLabel.replace("{count}",String($.itemCount))," ·"," ",$.notes||t.cogita.library.collections.noNotes]})]})},$.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${c}/collections/new`,children:t.cogita.library.collections.emptyAction})]})}),z?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:U,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const ie=t=>`${t.cardType}:${t.cardId}:${t.checkType??""}:${t.direction??""}`,Bt=(t,s,n,r)=>`${t}:${s}:${n??""}:${r??""}`;function li({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d,collectionId:k}){Vt(d);const c=`/#/cogita/library/${d}`,[o,O]=a.useState(t.cogita.library.collections.defaultName),[ue,Y]=a.useState(null),[W,w]=a.useState(0),[g,re]=a.useState([]),[z,p]=a.useState("idle"),[U,$]=a.useState(null),G=a.useMemo(()=>t.cogita.library.list.cardCount.replace("{shown}",String(g.length)).replace("{total}",String(W||g.length)),[t,g.length,W]);a.useEffect(()=>{_a(d,k).then(R=>{O(R.name),Y(R.notes??null),w(R.itemCount)}).catch(()=>{O(t.cogita.library.collections.defaultName),Y(null)})},[d,k]),a.useEffect(()=>{p("loading"),$a({libraryId:d,collectionId:k,limit:40}).then(R=>{re(R.items),$(R.nextCursor??null),w(R.total),p("ready")}).catch(()=>{re([]),$(null),p("ready")})},[d,k]);const I=async()=>{if(U){p("loading");try{const R=await $a({libraryId:d,collectionId:k,limit:40,cursor:U});re(ee=>[...ee,...R.items]),$(R.nextCursor??null),w(R.total),p("ready")}catch{p("ready")}}};return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:o}),e.jsx("p",{className:"cogita-library-subtitle",children:ue||t.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${c}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${c}/collections/${k}/graph`,children:t.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${c}/collections/${k}/revision`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:G}),e.jsx("span",{children:z==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:g.length?g.map(R=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:R.cardType==="vocab"?t.cogita.library.list.cardTypeVocab:R.cardType==="connection"?t.cogita.library.list.cardTypeConnection:t.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:R.label}),e.jsx("p",{className:"cogita-card-subtitle",children:R.description})]})},ie(R))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.collections.noCards})})}),U?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:I,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${c}/collections/${k}/revision`,children:t.cogita.library.actions.startRevision})})]})})]})})})]})})}const _t=t=>{if(!t.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const s=t.length,n=t.filter(m=>m.correct).length,r=Da(us(t));return{score:Math.round(Math.max(0,Math.min(100,r.knowness*100))*100)/100,total:s,correct:n,lastReviewedUtc:r.lastReviewedUtc??null}},ci=t=>{if(t.maskBase64)try{const s=yn(t.maskBase64);if(!s.length)return t.correct?1:0;const n=s.reduce((r,l)=>r+l,0);return Math.max(0,Math.min(1,n/s.length/255))}catch{return t.correct?1:0}return t.correct?1:0},us=t=>t.map(s=>({correctness:ci(s),createdUtc:s.createdUtc})),Da=(t,s=Date.now())=>{var W;if(!t.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const r=t.slice().sort((w,g)=>w.createdUtc.localeCompare(g.createdUtc)).slice(-5),l=r.reduce((w,g)=>w+g.correctness,0)/r.length,m=5,y=2,x=.15;let E=0,N=0;for(let w=0;w<r.length;w+=1){const g=new Date(r[w].createdUtc).getTime(),re=w===r.length-1?s:new Date(r[w+1].createdUtc).getTime(),z=Math.max(0,(re-g)/(1e3*60)),p=1-Math.exp(-z/m);E+=p,r[w].correctness>.5&&(N+=x)}let d=l*E*y+N;const k=((W=r[r.length-1])==null?void 0:W.createdUtc)??null,c=k?Math.max(0,(s-new Date(k).getTime())/(1e3*60)):0,O=1/(1+Math.log1p(c/60));return d*=O,r.length===1&&r[0].correctness>.5&&(d+=5.44*Math.exp(-c/2)),{knowness:d,avgCorrectness:l,lastReviewedUtc:k}},ja=t=>{const s=t.slice();for(let n=s.length-1;n>0;n-=1){const r=Math.floor(Math.random()*(n+1));[s[n],s[r]]=[s[r],s[n]]}return s},La=t=>t[Math.floor(Math.random()*t.length)],di=(t,s)=>{const n=new Map;return t.forEach(r=>n.set(r,Math.random())),t.sort((r,l)=>{const m=s(r)-s(l);return m!==0?m:(n.get(r)??0)-(n.get(l)??0)})},qa=(t,s,n,r,l)=>{if(!t.length)return null;const m=t.filter(x=>!(l!=null&&l.has(ie(x))));if(m.length===0)return null;const y=m.filter(x=>ie(x)!==n);return La(y.length?y:m)},ui=(t,s,n,r,l)=>{if(!t.length)return null;let m=Number.POSITIVE_INFINITY;for(const N of t){const d=ie(N);if(n.has(d))continue;const k=s[d]??1;k<m&&(m=k)}if(!Number.isFinite(m))return null;const y=t.filter(N=>{const d=ie(N);return!n.has(d)&&(s[d]??1)===m}),x=y.filter(N=>!l||ie(N)!==l),E=r?x.filter(N=>!r.has(ie(N))):x;return E.length>0?La(E):x.length>0?La(x):l&&y.some(N=>ie(N)===l)?y.find(N=>ie(N)===l)??null:y.length?La(y):null},Ys=(t,s,n,r,l)=>{const m=[],y=t.filter(E=>!l.has(ie(E))&&!n.has(ie(E))&&(s[ie(E)]??0)<1),x=di(y,E=>s[ie(E)]??0);for(const E of x){if(m.length>=r)break;m.push(E),l.add(ie(E))}if(m.length<r){const E=ja(t.filter(N=>!l.has(ie(N))&&n.has(ie(N))));for(const N of E){if(m.length>=r)break;m.push(N),l.add(ie(N))}}return m},hi=(t,s,n,r)=>Ys(t,s,n,r,new Set),hs=(t,s,n,r,l,m)=>{const y=Math.max(1,n.stackSize??s),E=ja(t).filter((O,ue,Y)=>Y.findIndex(W=>ie(W)===ie(O))===ue),N=hi(E,r,l,y),d=new Set,k=new Set,c=qa(N,{},null,d,k),o=c?[c]:[];return c&&k.add(ie(c)),{queue:o,meta:{pool:E,active:N,knownessMap:r,unknownSet:l,outcomesById:m,asked:d,queued:k}}},os={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:t=>t,prepare:(t,s)=>{const r=ja(t).filter((l,m,y)=>y.findIndex(x=>ie(x)===ie(l))===m);return{queue:r.slice(0,Math.min(s,r.length)),meta:{}}},applyOutcome:t=>t},gs=(t,s,n,r)=>{const l=Math.max(1,n.stackSize??s),y=ja(t).filter((ue,Y,W)=>W.findIndex(w=>ie(w)===ie(ue))===Y),x={},E=new Set,N=new Set,d=new Set,k=Math.max(1,n.levels??1);y.forEach(ue=>{const Y=ie(ue),W=r==null?void 0:r[Y],w=typeof W=="number"&&Number.isFinite(W)?W:1;x[Y]=Math.min(k,Math.max(1,Math.round(w)))});const c=[];if(y.length>0){const ue=new Map;y.forEach(W=>{var g;const w=x[ie(W)]??1;ue.has(w)||ue.set(w,[]),(g=ue.get(w))==null||g.push(W)});const Y=Array.from(ue.keys()).sort((W,w)=>W-w);for(const W of Y){if(c.length>=l)break;const w=ja(ue.get(W)??[]);for(const g of w){if(c.length>=l)break;c.push(g)}}}const o=qa(c,x,null,E,N),O=o?[o]:[];return o&&N.add(ie(o)),{queue:O,meta:{pool:y,active:c,levelMap:x,asked:E,queued:N,wrongSinceCorrect:d}}},gi={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,s)=>Math.max(1,s.stackSize??t),getProgressTotal:()=>null,prepare:(t,s,n)=>gs(t,s,n),applyOutcome:(t,s,n,r,l)=>{if(!s)return t;const m=Math.max(1,r.levels??1),y=t.meta.pool??[],x=t.meta.active??[],E={...t.meta.levelMap??{}},N=new Set(t.meta.asked??[]),d=new Set(t.meta.queued??[]),k=new Set(t.meta.wrongSinceCorrect??[]),c=ie(s);d.delete(c),N.add(c);const o=E[c]??1;l.correct?(E[c]=k.has(c)?1:Math.min(o+1,m),k.delete(c)):(E[c]=1,k.add(c));const O=l.correct?x.filter(W=>ie(W)!==c):x.slice();if(l.correct&&O.length<Math.max(1,r.stackSize??1)){const W=new Set(O.map(g=>ie(g))),w=ui(y,E,W,N,c);w&&O.push(w)}const ue=t.queue.slice(),Y=qa(O,E,c,N,d);return Y&&(ue.push(Y),d.add(ie(Y))),{queue:ue,meta:{pool:y,active:O,levelMap:E,asked:N,queued:d,wrongSinceCorrect:k}}}},mi={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,s)=>Math.max(1,s.stackSize??t),getProgressTotal:()=>null,prepare:(t,s,n)=>hs(t,s,n,{},new Set,{}),applyOutcome:(t,s,n,r,l)=>{if(!s)return t;const m=t.meta.pool??[],y=t.meta.active??[],x={...t.meta.knownessMap??{}},E=new Set(t.meta.unknownSet??[]),N={...t.meta.outcomesById??{}},d=new Set(t.meta.asked??[]),k=new Set(t.meta.queued??[]),c=ie(s);k.delete(c),d.add(c);const o={correctness:Math.max(0,Math.min(1,l.correctness??(l.correct?1:0))),createdUtc:l.createdUtc??new Date().toISOString()},ue=(N[c]??[]).concat(o).sort((z,p)=>z.createdUtc.localeCompare(p.createdUtc)).slice(-5);N[c]=ue,E.delete(c);const Y=Date.now();m.forEach(z=>{const p=ie(z),U=N[p]??[];if(U.length===0){x[p]=0,E.add(p);return}const $=Da(U,Y);x[p]=$.knowness});const W=y.slice();if((x[c]??0)>=1){const z=W.filter(p=>ie(p)!==c);W.length=0,W.push(...z)}const g=Math.max(1,r.stackSize??n);if(W.length<g){const z=new Set(W.map(U=>ie(U))),p=Ys(m,x,E,g-W.length,z);W.push(...p)}const re=t.queue.slice();if(re.length===0||ie(re[re.length-1])===c){const z=qa(W,{},c,d,k);z&&(re.push(z),k.add(ie(z)))}return{queue:re,meta:{pool:m,active:W,knownessMap:x,unknownSet:E,outcomesById:N,asked:d,queued:k}}}},Gs={random:os,levels:gi,temporal:mi},pi=Object.values(Gs),ms=t=>{if(!t)return os;const s=t.trim().toLowerCase();return s==="random"||s==="levels"||s==="temporal"?Gs[s]:os},Va=(t,s)=>{const n={...t.defaultSettings};return s&&Object.entries(s).forEach(([r,l])=>{typeof l=="number"&&Number.isFinite(l)&&(n[r]=l),typeof l=="string"&&(n[r]=l)}),t.settingsFields.forEach(r=>{var m;const l=n[r.key];if(r.type==="number"){if(typeof l!="number"||Number.isNaN(l)){n[r.key]=t.defaultSettings[r.key]??0;return}r.min!==void 0&&(n[r.key]=Math.max(r.min,n[r.key])),r.max!==void 0&&(n[r.key]=Math.min(r.max,n[r.key]));return}if(r.type==="select"){const y=((m=r.options)==null?void 0:m.map(x=>x.value))??[];(typeof l!="string"||y.length>0&&!y.includes(l))&&(n[r.key]=t.defaultSettings[r.key]??y[0]??"")}}),n},Xs=(t,s)=>{const n={};return t.settingsFields.forEach(r=>{const l=s.get(r.key);if(l){if(r.type==="number"){const m=Number(l);Number.isNaN(m)||(n[r.key]=m);return}n[r.key]=l}}),Va(t,n)},fi=(t,s)=>{const n=new URLSearchParams;return t.settingsFields.forEach(r=>{const l=s[r.key];(typeof l=="number"||typeof l=="string")&&n.set(r.key,String(l))}),n};function bi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d,collectionId:k,revisionId:c}){const{libraryName:o}=Vt(d),O=`/#/cogita/library/${d}`,[ue,Y]=a.useState(t.cogita.library.collections.defaultName),[W,w]=a.useState(""),[g,re]=a.useState(20),[z,p]=a.useState("random"),[U,$]=a.useState({}),[G,I]=a.useState("exact"),[R,ee]=a.useState([]),[te,ae]=a.useState(null),[Pe,ge]=a.useState([]),[S,pe]=a.useState("idle"),[v,D]=a.useState(null),[me,Q]=a.useState("idle"),[q,ye]=a.useState("idle"),[Ie,be]=a.useState("idle"),Ae=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),we=a.useMemo(()=>ms(z),[z]),ze=a.useMemo(()=>Va(we,U),[we,U]),Ke=a.useMemo(()=>fi(we,ze).toString(),[we,ze]);a.useEffect(()=>{_a(d,k).then(H=>Y(H.name)).catch(()=>Y(t.cogita.library.collections.defaultName))},[d,k]),a.useEffect(()=>{c&&xn({libraryId:d,collectionId:k,revisionId:c}).then(H=>{w(H.name),p(H.mode||"random"),I(H.check||"exact"),re(H.limit||20),$(H.revisionSettings??{})}).catch(()=>{w("")})},[k,d,c]),a.useEffect(()=>{vn({libraryId:d}).then(H=>{ee(H),!te&&H.length>0&&ae(H[0].roleId)}).catch(()=>{ee([])})},[d]);const je=()=>{ye("loading"),Os({libraryId:d}).then(H=>{ge(H),ye("idle")}).catch(()=>{ge([]),ye("error")})};a.useEffect(()=>{je()},[d]);const Be=async()=>{pe("working"),Q("idle");try{const H=await jn({libraryId:d,collectionId:k,revisionType:we.id,revisionSettings:ze,mode:z,check:G,limit:g});D(`${Ae}/${H.shareCode}${Ke?`?${Ke}`:""}`),pe("ready"),je()}catch{pe("error")}},Ze=async()=>{if(c){be("saving");try{await wn({libraryId:d,collectionId:k,revisionId:c,name:W||ue,revisionType:we.id,revisionSettings:ze,mode:z,check:G,limit:g}),be("saved")}catch{be("error")}}},Ye=async()=>{if(v)try{await navigator.clipboard.writeText(v),Q("copied")}catch{Q("failed")}},B=async H=>{try{await Us({libraryId:d,shareId:H}),je()}catch{je()}};return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:ue}),e.jsx("p",{className:"cogita-library-subtitle",children:o})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:O,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${O}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${O}/collections/${k}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${O}/collections/${k}/revision/run?mode=${encodeURIComponent(z)}&check=${encodeURIComponent(G)}&limit=${g}${Ke?`&${Ke}`:""}${te?`&reviewer=${encodeURIComponent(te)}`:""}${c?`&revisionId=${encodeURIComponent(c)}`:""}`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:W,onChange:H=>w(H.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsx("select",{value:z,onChange:H=>p(H.target.value),children:pi.map(H=>e.jsx("option",{value:H.id,children:t.cogita.library.revision[H.labelKey]},H.id))})]}),we.settingsFields.map(H=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision[H.labelKey]}),H.type==="select"?e.jsx("select",{value:String(ze[H.key]??""),onChange:qe=>$(Se=>({...Se,[H.key]:qe.target.value})),children:(H.options??[]).map(qe=>e.jsx("option",{value:qe.value,children:t.cogita.library.revision[qe.labelKey]},qe.value))}):e.jsx("input",{type:"number",min:H.min,max:H.max,step:H.step,value:ze[H.key]??0,onChange:qe=>$(Se=>({...Se,[H.key]:Number(qe.target.value||0)}))})]},H.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.checkLabel}),e.jsx("input",{value:t.cogita.library.revision.checkValue,disabled:!0})]}),we.id!=="levels"&&we.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:g,onChange:H=>re(Number(H.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:te??"",onChange:H=>ae(H.target.value||null),children:R.map(H=>e.jsx("option",{value:H.roleId,children:H.label},H.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.previewBody1}),e.jsx("p",{children:t.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[c?e.jsx("button",{type:"button",className:"cta ghost",onClick:Ze,disabled:Ie==="saving",children:Ie==="saving"?"...":t.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${O}/collections/${k}/revision/run?mode=${encodeURIComponent(z)}&check=${encodeURIComponent(G)}&limit=${g}${Ke?`&${Ke}`:""}${te?`&reviewer=${encodeURIComponent(te)}`:""}${c?`&revisionId=${encodeURIComponent(c)}`:""}`,children:t.cogita.library.actions.startRevision})]}),Ie==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.shareBody}),v?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:v,readOnly:!0})]}):null,S==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareError}):null,me==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):me==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:Be,disabled:S==="working",children:S==="working"?t.cogita.library.revision.shareWorking:t.cogita.library.revision.shareAction}),v?e.jsx("button",{type:"button",className:"cta ghost",onClick:Ye,children:t.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),q==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):Pe.length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:Pe.map(H=>e.jsxs("div",{className:"cogita-share-row","data-state":H.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:H.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(H.createdUtc).toLocaleString(),H.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]})]}),H.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>B(H.shareId),children:t.cogita.library.revision.shareRevokeAction})]},H.shareId))})]})]})]})]})})})]})})}const es=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function Js(t,s,n){if(!t)return null;const r=new Map(t.nodes.map(z=>[z.id,z])),l=new Map,m=new Set,y=z=>{if(typeof z=="number")return z;if(typeof z=="string"){const p=Number(z);return Number.isFinite(p)?p:0}return 0},x=z=>{if(l.has(z))return l.get(z);if(m.has(z))return 0;const p=r.get(z);if(!p)return 0;m.add(z);const U=G=>{var R,ee;return(G?((R=p.inputsByHandle)==null?void 0:R[G])??[]:p.inputs??((ee=p.inputsByHandle)==null?void 0:ee.in)??[]).map(te=>x(te))};let $=0;switch(p.type){case"input.random":{const G=p.min??0,I=p.max??G+10,R=Math.min(G,I),ee=Math.max(G,I);$=Math.floor(Math.random()*(ee-R+1))+R;break}case"input.const":{$=p.value??0;break}case"input.list":{const G=(p.list??[]).filter(Boolean),I=Math.round(y(U("index")[0]));$=G.length?G[Math.max(0,Math.min(G.length-1,I))]:String(I);break}case"compute.add":{$=U("in").map(I=>y(I)).reduce((I,R)=>I+R,0);break}case"compute.sub":{const G=U("add").map(R=>y(R)),I=U("sub").map(R=>y(R));$=G.reduce((R,ee)=>R+ee,0)-I.reduce((R,ee)=>R+ee,0);break}case"compute.mul":{const G=U("in").map(I=>y(I));$=G.length?G.reduce((I,R)=>I*R,1):0;break}case"compute.div":{const G=y(U("num")[0]),I=U("den").map(R=>y(R)).reduce((R,ee)=>R+ee,0);$=Math.abs(I)<Number.EPSILON?0:G/I;break}case"compute.pow":{const G=y(U("base")[0]),I=y(U("exp")[0]);$=Math.pow(G,I);break}case"compute.exp":{const G=y(U("base")[0]),I=y(U("exp")[0]);$=Math.pow(G,I);break}case"compute.log":{const G=y(U("value")[0]),I=y(U("base")[0]),R=Math.max(G,Number.EPSILON);$=Math.abs(I)<Number.EPSILON?Math.log(R):Math.log(R)/Math.log(I);break}case"compute.abs":{$=Math.abs(y(U("in")[0]));break}case"compute.min":{const G=U("in").map(I=>y(I));$=G.length?Math.min(...G):0;break}case"compute.max":{const G=U("in").map(I=>y(I));$=G.length?Math.max(...G):0;break}case"compute.floor":{$=Math.floor(y(U("in")[0]));break}case"compute.ceil":{$=Math.ceil(y(U("in")[0]));break}case"compute.round":{$=Math.round(y(U("in")[0]));break}case"compute.mod":{const G=y(U("a")[0]),I=y(U("b")[0]);$=Math.abs(I)<Number.EPSILON?0:G%I;break}case"compute.concat":{const I=["in1","in2","in3","in4","in5","in6"].flatMap(ae=>U(ae)),R=I.length?I:U("in");$=(R.length?R:U()).map(ae=>ae==null?"":String(ae)).join("");break}case"compute.trim":{const G=U("text")[0]??U("in")[0]??"",I=G==null?"":String(G),R=Math.max(0,Math.round(y(U("start")[0]))),ee=Math.max(0,Math.round(y(U("end")[0])));R+ee>=I.length?$="":$=I.substring(R,I.length-ee);break}case"output":{$=U("in")[0]??0;break}default:$=0}return m.delete(z),l.set(z,$),$},E=t.outputs&&t.outputs.length>0?t.outputs:t.output?[t.output]:t.nodes.filter(z=>z.type==="output").map(z=>z.id);t.nodes.forEach(z=>x(z.id)),E.forEach(z=>x(z));const N=z=>Math.abs(z%1)<1e-5?String(Math.round(z)):z.toFixed(3).replace(/\.?0+$/,""),d=z=>typeof z=="number"?N(z):z??"",k=new Map;E.forEach(z=>{var I,R,ee,te;const p=r.get(z);if(!p)return;const U=(R=(I=p.inputsByHandle)==null?void 0:I.name)==null?void 0:R[0],$=U?d(l.get(U)):"",G=($==null?void 0:$.toString().trim())||((ee=p.outputLabel)==null?void 0:ee.trim())||((te=p.name)==null?void 0:te.trim())||z;k.set(z,G)});const c={},o={},O={};E.forEach(z=>{var $,G;const p=r.get(z);if(!p)return;const U=k.get(z)??((($=p.outputLabel)==null?void 0:$.trim())||((G=p.name)==null?void 0:G.trim())||z);c[U]=d(l.get(z)),p.name&&(o[p.name.trim()]=U),o[z]=U});const ue=(z,p)=>{let U=z;return t.nodes.forEach($=>{var te,ae;const G=d(l.get($.id)),I=E.includes($.id),R=I?k.get($.id)??((te=$.outputLabel)==null?void 0:te.trim())??((ae=$.name)==null?void 0:ae.trim())??$.id:"",ee=I&&p?R:G;U=U.replace(new RegExp(`\\{\\s*${es($.id)}\\s*\\}`,"gi"),ee),$.name&&(U=U.replace(new RegExp(`\\{\\s*${es($.name)}\\s*\\}`,"gi"),ee)),I&&$.outputLabel&&(U=U.replace(new RegExp(`\\{\\s*${es($.outputLabel)}\\s*\\}`,"gi"),R))}),U},Y=s;let W=Y.trim().length>0?Y:"";W||(W=E.length?`Compute ${E.join(", ")}`:"Compute"),W=ue(W,!0);const w=(n==null?void 0:n.trim())??"",g=w?ue(w,!1):"",re={};return l.forEach((z,p)=>{re[p]=z,O[p]=d(z);const U=r.get(p);U!=null&&U.name&&(O[U.name.trim()]=d(z))}),{prompt:W,answers:c,values:re,answerText:g,outputVariables:o,variableValues:O}}function Zs(t){var n;const s=Object.entries(t.answers);return{prompt:t.prompt,expectedAnswer:t.answerText??((n=s[0])==null?void 0:n[1])??"",expectedAnswers:t.answers,values:t.values,expectedAnswerIsSentence:!!(t.answerText&&t.answerText.trim().length>0),outputVariables:t.outputVariables,variableValues:t.variableValues}}function en({copy:t,currentCard:s,currentTypeLabel:n,prompt:r,languages:l,answer:m,onAnswerChange:y,computedExpected:x,computedAnswers:E,onComputedAnswerChange:N,answerTemplate:d,outputVariables:k,variableValues:c,computedFieldFeedback:o,feedback:O,canAdvance:ue,quoteContext:Y,quotePlaceholder:W,onCheckAnswer:w,onSkip:g,onLanguageSelect:re,onMarkReviewed:z,onAdvance:p,showCorrectAnswer:U,setShowCorrectAnswer:$,onRevealCorrect:G,answerMask:I,expectedAnswer:R,hasExpectedAnswer:ee,handleComputedKeyDown:te,answerInputRef:ae,computedInputRefs:Pe,scriptMode:ge,setScriptMode:S,matchPairs:pe,matchLeftOrder:v,matchRightOrder:D,matchSelection:me,matchActiveLeft:Q,matchActiveRight:q,matchFeedback:ye,onMatchLeftSelect:Ie,onMatchRightSelect:be}){const Ae=a.useMemo(()=>{var ve;const B=!d&&x.length===2?`The {${x[0].key}} is of type {${x[1].key}}`:null,H=d??B;if(!H)return null;const qe=new Map(x.map(L=>[L.key,L.expected])),Se=new Set,le=[],Le=/\{([^}]+)\}/g;let _e=0,K,he=null;for(;(K=Le.exec(H))!==null;){const L=H.slice(_e,K.index);L&&le.push({type:"text",value:L});const V=((ve=K[1])==null?void 0:ve.trim())??"",fe=V&&qe.has(V)?V:V&&k&&k[V]?k[V]:null;V&&Se.add(V),fe&&Se.add(fe),fe&&qe.has(fe)?(le.push({type:"input",value:fe}),he||(he=fe)):V&&c&&c[V]!==void 0?le.push({type:"text",value:c[V]}):le.push({type:"text",value:K[0]}),_e=K.index+K[0].length}const M=H.slice(_e);return M&&le.push({type:"text",value:M}),x.filter(L=>!Se.has(L.key)).length>0?null:{parts:le,expectedByKey:qe,firstInputKey:he}},[d,x,k,c]),we=()=>{if(!Ae)return null;const{parts:B,expectedByKey:H,firstInputKey:qe}=Ae;return e.jsx("div",{className:"cogita-revision-inline-answer",children:B.map((Se,le)=>{var Le,_e;return Se.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Se.value},`text-${le}`):e.jsx("input",{ref:K=>{Pe.current[Se.value]=K},autoFocus:Se.value===qe,value:E[Se.value]??"",onChange:K=>N(Se.value,K.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":o[Se.value]??(O==="correct"?"correct":O==="incorrect"?"incorrect":void 0),onKeyDown:K=>Be(K)||te(K),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Le=E[Se.value])==null?void 0:Le.length)??0,((_e=H.get(Se.value))==null?void 0:_e.length)??6)}ch`}},`input-${Se.value}-${le}`)})})},ze=a.useMemo(()=>{const B=new Map;return(pe??[]).forEach(H=>B.set(H.leftId,H)),B},[pe]),Ke=a.useMemo(()=>{const B=new Map;return(pe??[]).forEach(H=>B.set(H.rightId,H)),B},[pe]);a.useEffect(()=>{var le;if(s.cardType!=="info"||s.infoType!=="computed"||x.length===0)return;const B=typeof document<"u"?document.activeElement:null;if(B&&(B.tagName==="INPUT"||B.tagName==="TEXTAREA"))return;const H=(Ae==null?void 0:Ae.firstInputKey)??((le=x[0])==null?void 0:le.key);if(!H)return;const qe=Pe.current[H];if(!qe)return;const Se=requestAnimationFrame(()=>{qe.focus()});return()=>cancelAnimationFrame(Se)},[s,x,Ae]);const je=(()=>{const B=[R??"",...x.map(Se=>Se.expected??"")].join(""),H=[m,...Object.values(E)].join(""),qe=`${B}${H}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(qe)})(),Be=B=>B.ctrlKey&&(B.key==="^"||B.key==="6")?(B.preventDefault(),S(H=>H==="super"?null:"super"),!0):B.ctrlKey&&(B.key==="_"||B.key==="-")?(B.preventDefault(),S(H=>H==="sub"?null:"sub"),!0):!1,Ze=()=>{if(!R||!I)return R??"";const B=R.split(""),H=Array.from(I),qe=H.length>0?H.reduce((Se,le)=>Se+le,0)/H.length:127;return B.map((Se,le)=>{const Le=H[le]??qe,_e=Math.max(0,Math.min(255,Math.round(Le)));let K=255,he=0;return _e<=127?he=Math.round(_e/127*255):(he=255,K=Math.round(255*(1-(_e-127)/128))),e.jsx("span",{style:{color:`rgb(${K}, ${he}, 0)`},children:Se},`mask-${le}`)})},Ye=s.cardType==="info"&&s.infoType==="quote"?(Y==null?void 0:Y.title)||s.label:s.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:n}),e.jsx("strong",{children:Ye})]}),s.cardType==="vocab"&&s.checkType==="translation-match"&&pe?e.jsxs("div",{className:"cogita-revision-body",children:[r?e.jsx("h2",{children:r}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(v??[]).map(B=>{const H=ze.get(B);if(!H)return null;const qe=(me==null?void 0:me[B])??null,Se=(ye==null?void 0:ye[B])??null,le=Q===B;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":le,"data-state":Se??void 0,"data-locked":qe?"true":void 0,onClick:()=>Ie==null?void 0:Ie(B),children:[e.jsx("span",{children:H.leftLabel}),qe&&U?e.jsx("em",{children:"✓"}):null]},B)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(D??[]).map(B=>{const H=Ke.get(B);if(!H)return null;const qe=Object.values(me??{}).includes(B),Se=q===B;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":qe||Se,"data-locked":qe?"true":void 0,onClick:()=>be==null?void 0:be(B),children:e.jsx("span",{children:H.rightLabel})},B)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,disabled:s.checkType==="translation-match",children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ae,value:m,onChange:B=>y(B.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":O==="correct"?"correct":O==="incorrect"?"incorrect":void 0,onKeyDown:B=>{B.key==="Enter"&&(B.preventDefault(),B.stopPropagation(),ue?p():w())}})]}),je?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>S(B=>B==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>S(B=>B==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[s.label?e.jsx("p",{className:"cogita-revision-hint",children:s.label}):null,d?null:e.jsx(kn,{value:r??"",mode:"auto"}),x.length>0?(()=>{const B=we();return B?e.jsx("div",{className:"cogita-inline-answer-wrap",children:B}):e.jsx("div",{className:"cogita-form-grid",children:x.map((H,qe)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:H.key}),e.jsx("textarea",{ref:Se=>{Pe.current[H.key]=Se},autoFocus:qe===0,value:E[H.key]??"",onChange:Se=>N(H.key,Se.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":o[H.key]??(O==="correct"?"correct":O==="incorrect"?"incorrect":void 0),onKeyDown:Se=>Be(Se)||te(Se)})]},H.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ae,value:m,onChange:B=>y(B.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":O==="correct"?"correct":O==="incorrect"?"incorrect":void 0,onKeyDown:B=>{Be(B)||B.key==="Enter"&&(B.preventDefault(),B.stopPropagation(),ue?p():w())}})]})}),je?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>S(B=>B==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>S(B=>B==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="quote"&&Y?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.quoteProgress.replace("{done}",String(Y.completed)).replace("{total}",String(Y.total))}),e.jsx("p",{className:"cogita-quote-text",children:Y.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ae,value:m,onChange:B=>y(B.target.value),placeholder:W??t.cogita.library.revision.quoteMissingPlaceholder,"data-state":O==="correct"?"correct":O==="incorrect"?"incorrect":void 0,onKeyDown:B=>{B.key==="Enter"&&(B.preventDefault(),B.stopPropagation(),ue?p():w())}})]}),e.jsx("p",{className:"cogita-quote-text",children:Y.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:w,children:t.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}):s.cardType==="info"&&s.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:l.length?l.map(B=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>re(B.label),children:B.label},B.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:t.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:z,children:t.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:t.cogita.library.revision.skip})]})]}),O&&e.jsx("div",{className:"cogita-revision-feedback","data-state":O,children:O==="correct"?t.cogita.library.revision.correct:t.cogita.library.revision.tryAgain}),O==="incorrect"&&ee?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>$(B=>{const H=!B;return H&&G(),H}),children:t.cogita.library.revision.showAnswer}),U?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),x.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[x.map(B=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:B.key}),e.jsx("span",{children:B.expected})]},B.key)),R?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:R})]}):null]}):e.jsx("p",{children:I?Ze():R})]}):null]}):null,ue?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:p,children:t.cogita.library.revision.nextQuestion})}):null]})}const ts=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function tn({outcomes:t}){const[s,n]=a.useState("day"),r=a.useMemo(()=>{const l=ts.find(x=>x.id===s)??ts[1],m=Date.now()-l.ms,y=t.filter(x=>new Date(x.createdUtc).getTime()>=m);return _t(y)},[t,s]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:ts.map(l=>e.jsx("button",{type:"button",className:"ghost","data-active":s===l.id,onClick:()=>n(l.id),children:l.label},l.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[r.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[r.correct," / ",r.total]})]})}const yi="cogita-revision",xi=1,Ea="outcomes",vi=()=>new Promise((t,s)=>{const n=indexedDB.open(yi,xi);n.onupgradeneeded=()=>{const r=n.result;if(!r.objectStoreNames.contains(Ea)){const l=r.createObjectStore(Ea,{keyPath:"id"});l.createIndex("byItem","itemKey",{unique:!1}),l.createIndex("byPending","pending",{unique:!1})}},n.onerror=()=>s(n.error),n.onsuccess=()=>t(n.result)}),Na=async(t,s)=>{const n=await vi();return new Promise((r,l)=>{const m=n.transaction(Ea,t),y=m.objectStore(Ea);s(y).then(r).catch(l),m.onerror=()=>l(m.error)})},an=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const t=new Uint8Array(16);crypto.getRandomValues(t);const s=Array.from(t).map(n=>n.toString(16).padStart(2,"0"));return`${s.slice(0,4).join("")}-${s.slice(4,6).join("")}-${s.slice(6,8).join("")}-${s.slice(8,10).join("")}-${s.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},wi=()=>{const t="cogita_revision_client_id",s=localStorage.getItem(t);if(s)return s;const n=an();return localStorage.setItem(t,n),n},ji=()=>{const t="cogita_revision_client_seq",s=Number(localStorage.getItem(t)??"0"),n=Number.isFinite(s)?s+1:1;return localStorage.setItem(t,String(n)),n},sn=(t,s,n,r)=>Bt(t,s,n,r),Aa=async t=>{const s=wi(),n=ji(),r=new Date().toISOString(),l={...t,clientId:s,clientSequence:n,createdUtc:r,id:an(),pending:!0};return await Na("readwrite",m=>new Promise((y,x)=>{const E={...l,itemKey:sn(l.itemType,l.itemId,l.checkType,l.direction)},N=m.add(E);N.onsuccess=()=>y(),N.onerror=()=>x(N.error)})),l},Fa=async(t,s,n,r)=>{if(!s)return[];try{const l=sn(t,s,n,r);return await Na("readonly",m=>new Promise((y,x)=>{const N=m.index("byItem").getAll(l);N.onsuccess=()=>{const k=(N.result??[]).map(c=>({itemType:c.itemType,itemId:c.itemId,checkType:c.checkType??null,direction:c.direction??null,revisionType:c.revisionType,evalType:c.evalType,correct:c.correct,createdUtc:c.createdUtc,maskBase64:c.maskBase64,payloadBase64:c.payloadBase64,payloadHashBase64:c.payloadHashBase64,clientId:c.clientId,clientSequence:c.clientSequence,personRoleId:c.personRoleId??null})).sort((c,o)=>c.createdUtc.localeCompare(o.createdUtc));y(k)},N.onerror=()=>x(N.error)}))}catch{return[]}},Dt=async()=>{try{return await Na("readonly",t=>new Promise((s,n)=>{const r=t.getAll();r.onsuccess=()=>{const m=(r.result??[]).map(y=>({itemType:y.itemType,itemId:y.itemId,checkType:y.checkType??null,direction:y.direction??null,revisionType:y.revisionType,evalType:y.evalType,correct:y.correct,createdUtc:y.createdUtc,maskBase64:y.maskBase64,payloadBase64:y.payloadBase64,payloadHashBase64:y.payloadHashBase64,clientId:y.clientId,clientSequence:y.clientSequence,personRoleId:y.personRoleId??null}));s(m)},r.onerror=()=>n(r.error)}))}catch{return[]}},ki=async(t=100)=>{try{return await Na("readonly",s=>new Promise((n,r)=>{const m=s.index("byPending").getAll(!0);m.onsuccess=()=>{const y=m.result??[];n(y.slice(0,t))},m.onerror=()=>r(m.error)}))}catch{return[]}},Ni=async t=>{if(t.length!==0)try{await Na("readwrite",s=>new Promise((n,r)=>{let l=t.length;t.forEach(m=>{const y=s.get(m);y.onsuccess=()=>{const x=y.result;if(x){x.pending=!1;const E=s.put(x);E.onsuccess=()=>{l-=1,l===0&&n()},E.onerror=()=>r(E.error)}else l-=1,l===0&&n()},y.onerror=()=>r(y.error)})}))}catch{}},as=async(t,s)=>{const n=await ki(200);if(n.length===0)return;const r=new Map;n.forEach(l=>{var y;const m=l.personRoleId??s??"";r.has(m)||r.set(m,[]),(y=r.get(m))==null||y.push(l)});for(const[l,m]of r.entries()){const y=m.map(x=>({itemType:x.itemType,itemId:x.itemId,checkType:x.checkType??null,direction:x.direction??null,revisionType:x.revisionType,evalType:x.evalType,correct:x.correct,clientId:x.clientId,clientSequence:x.clientSequence,maskBase64:x.maskBase64??null,payloadHashBase64:x.payloadHashBase64??null,payloadBase64:x.payloadBase64??null,personRoleId:l||null}));try{await Nn({libraryId:t,outcomes:y}),await Ni(m.map(x=>x.id))}catch{}}},Is={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Ti=(t,s)=>{const n=Math.max(t.length,s.length,1),r=Math.abs(t.length-s.length);return Math.max(0,1-r/n)},Si=(t,s)=>{const n=new Uint8Array(t.length),r=Ti(t,s);for(let l=0;l<t.length;l+=1){const m=t[l]===(s[l]??"")?128:0,y=t.length-1-l,x=s.length-1-l,E=t[y]===(s[x]??"")?127:0,N=Math.round((m+E)*r);n[l]=Math.max(0,Math.min(255,N))}return n},Ia=(t,s)=>t===s||(Is[t]??[]).includes(s)?!0:(Is[s]??[]).includes(t),Pa=(t,s)=>{const n=new Uint8Array(t.length);if(!t.length)return n;const r=[];for(let m=0;m<=t.length-3;m+=1)r.push({index:m,text:t.slice(m,m+3)});let l=!1;return r.forEach(m=>{for(let y=0;y<=s.length-3;y+=1){const x=s.slice(y,y+3);let E=0;for(let o=0;o<3;o+=1)Ia(m.text[o],x[o])&&(E+=1);if(E<2)continue;let N=m.index-1,d=y-1;for(;N>=0&&d>=0;){const o=t[N],O=s[d];if(o===O){n[N]=Math.max(n[N],255),N-=1,d-=1,l=!0;continue}if(Ia(o,O)){n[N]=Math.max(n[N],127),N-=1,d-=1,l=!0;continue}if(N>0&&t[N-1]===O){n[N]=Math.max(n[N],0),N-=1,l=!0;continue}if(d>0&&t[N]===s[d-1]){d-=1,l=!0;continue}break}for(let o=0;o<3;o+=1){const O=m.index+o,ue=m.text[o],Y=x[o],W=ue===Y?255:Ia(ue,Y)?127:0;n[O]=Math.max(n[O],W),l=!0}let k=m.index+3,c=y+3;for(;k<t.length&&c<s.length;){const o=t[k],O=s[c];if(o===O){n[k]=Math.max(n[k],255),k+=1,c+=1,l=!0;continue}if(Ia(o,O)){n[k]=Math.max(n[k],127),k+=1,c+=1,l=!0;continue}if(k+1<t.length&&t[k+1]===O){n[k]=Math.max(n[k],0),k+=1,l=!0;continue}if(c+1<s.length&&t[k]===s[c+1]){c+=1,l=!0;continue}break}}}),l?n:Si(t,s)},ga=(t,s,n)=>{const r=t.trim().toLowerCase(),l=s.trim().toLowerCase();return Pa(r,l)},pa=t=>t.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),nn=(t,s,n)=>{const r=pa(t),l=pa(s);return Pa(r,l)},vt=t=>t.trim().toLowerCase(),Ci=t=>t==="reverse"?"reverse":"forward",ka=(t,s)=>`${t}|${s}`,kt=t=>{if(!t)return null;const[s,n]=t.split("|",2);return(s==="forward"||s==="reverse")&&n?{mode:s,fragmentId:n}:{mode:"forward",fragmentId:t}},za=(t,s)=>{var r;const n=kt(s);return n?n.fragmentId&&s?(t??null)===s:(((r=kt(t))==null?void 0:r.mode)??"forward")===n.mode:!0},dt=t=>{const s=t==null?void 0:t.trim().toLowerCase();return s||null},rn=(t,s)=>{if((dt(t.childItemType)??"info")!==(s.cardType??"").toLowerCase()||t.childItemId!==s.cardId)return!1;const r=dt(t.childCheckType),l=dt(t.childDirection),m=dt(s.checkType),y=dt(s.direction);return!(r&&r!==m||l&&l!==y)},Mi={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Ii={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},Ka=(t,s,n)=>{if(!n||!s.startsWith(t))return s;const r=s.slice(t.length);if(!r)return s;const l=n==="super"?Mi:Ii,m=r.split("").map(y=>l[y]??y).join("");return t+m},Ba=(t,s,n)=>{var y,x,E;if(!t)return((y=s[0])==null?void 0:y.key)??null;const r=new Set(s.map(N=>N.key)),l=/\{([^}]+)\}/g;let m;for(;(m=l.exec(t))!==null;){const N=((x=m[1])==null?void 0:x.trim())??"";if(!N)continue;if(r.has(N))return N;const d=n==null?void 0:n[N];if(d&&r.has(d))return d}return((E=s[0])==null?void 0:E.key)??null},ls=t=>t.flatMap(s=>{if(s.cardType!=="info"||s.infoType!=="quote")return[s];const n=s.description??"";if(!n.trim())return[s];const r=kt(s.direction),l=(r==null?void 0:r.mode)??Ci(s.direction),m=ma(n),y=Object.keys(m.nodes);return y.length===0?[s]:y.map(x=>({...s,checkType:"quote-fragment",direction:ka(l,x)}))});function Li({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d,collectionId:k,revisionId:c}){const o=cs(),O=`/#/cogita/library/${d}`,ue=a.useMemo(()=>new URLSearchParams(o.search),[o.search]),Y=Math.max(1,Number(ue.get("limit")??20)),W=ue.get("mode")??"random",w=a.useMemo(()=>ms(W),[W]),g=a.useMemo(()=>Va(w,Xs(w,ue)),[w,ue]),re=ue.get("check")??"exact",z=ue.get("reviewer"),p=a.useMemo(()=>t.cogita.library.revision[w.labelKey]??W,[t,W,w]),U=a.useMemo(()=>re==="exact"?t.cogita.library.revision.checkValue:re,[t,re]),[$,G]=a.useState(t.cogita.library.collections.defaultName),[I,R]=a.useState([]),[ee,te]=a.useState([]),[ae,Pe]=a.useState("idle"),[ge,S]=a.useState({current:0,total:0}),[pe,v]=a.useState(0),[D,me]=a.useState(""),[Q,q]=a.useState(null),[ye,Ie]=a.useState(null),[be,Ae]=a.useState(null),[we,ze]=a.useState(null),[Ke,je]=a.useState([]),[Be,Ze]=a.useState({}),[Ye,B]=a.useState({}),[H,qe]=a.useState(null),[Se,le]=a.useState(null),[Le,_e]=a.useState(null),[K,he]=a.useState(null),[M,X]=a.useState(null),[ve,L]=a.useState({}),V=a.useRef(0),[fe,Ce]=a.useState(null),xe=a.useRef(null),$e=a.useRef(null),[Ue,We]=a.useState(null),[Re,Ee]=a.useState(!1),[ke,st]=a.useState(null),[Qe,Ge]=a.useState([]),[mt,Tt]=a.useState(null),He=a.useRef(null),Je=a.useRef(null),[ct,it]=a.useState(null),[It,at]=a.useState(0),rt=a.useRef(null),Ft=a.useRef({}),[pt,Xe]=a.useState(!1),[ot,St]=a.useState({}),[Pt,qt]=a.useState([]),gt=a.useRef(new Map),[wt,h]=a.useState(new Set),[Ne,ce]=a.useState(!1),Fe=a.useRef(null),et=a.useRef(new Set),tt=a.useRef({}),oe=I[pe]??null,se=(oe==null?void 0:oe.checkType)==="translation-match"&&M,ft=a.useRef(new Map),$t=a.useRef(new Map),Ot=a.useRef(new Map),zt=a.useRef(new Map),Rt=a.useMemo(()=>oe?oe.cardType==="vocab"?t.cogita.library.revision.vocabLabel:oe.infoType?Oe(t,oe.infoType):t.cogita.library.revision.infoLabel:"",[t,oe]),sa=a.useMemo(()=>{var u;return w.id!=="levels"?I.length:((u=ot.pool)==null?void 0:u.length)??w.getFetchLimit(Y,g)},[ot,g,w,I.length,Y]),Ut=w.getProgressTotal?w.getProgressTotal(I,ot,Y,g):w.id==="levels"?Math.min(Y,sa):I.length,ut=Ut?Math.min(pe+1,Ut):0,bt=Math.max(1,Number(g.tries??1)),jt=g.compare??"anchors",Wt=Math.max(0,Math.min(100,Number(g.minCorrectness??0))),ht=(g.considerDependencies??"on")==="on",nt=Math.max(0,Math.min(100,Number(g.dependencyThreshold??85))),Lt=i=>{const u=i.slice();for(let j=u.length-1;j>0;j-=1){const f=Math.floor(Math.random()*(j+1));[u[j],u[f]]=[u[f],u[j]]}return u},Yt=i=>i.length?i.reduce((j,f)=>j+f,0)/i.length/255*100:0,Qt=i=>Yt(i)>=Wt,na=async()=>{const i=await Dt(),u=new Map,j=new Map,f=new Map;i.forEach(C=>{const F=`${C.itemType}:${C.itemId}`,J=Bt(C.itemType,C.itemId,C.checkType,C.direction);if(u.has(F)||u.set(F,[]),u.get(F).push(C),j.has(J)||j.set(J,[]),j.get(J).push(C),C.itemType==="info"&&C.checkType==="quote-fragment"&&C.direction){const Z=`${C.itemId}:${C.direction}`;f.has(Z)||f.set(Z,[]),f.get(Z).push(C)}});const P=new Map,b=new Map,A=new Map;return u.forEach((C,F)=>P.set(F,_t(C).score)),j.forEach((C,F)=>b.set(F,_t(C).score)),f.forEach((C,F)=>A.set(F,_t(C).score)),{itemKnowness:P,cardKnowness:b,fragmentKnowness:A}},Oa=async i=>{const u=[];let j=null;for(;;){const f=await $a({libraryId:d,collectionId:i,limit:200,cursor:j});if(u.push(...f.items),!f.nextCursor)break;j=f.nextCursor}return ls(u)},fa=async(i,u)=>{if(gt.current.has(i))return gt.current.get(i)??0;const j=await Oa(i);if(j.length===0)return gt.current.set(i,0),0;const P=j.reduce((b,A)=>{const C=ie(A);return b+(u.get(C)??0)},0)/j.length;return gt.current.set(i,P),P},Ua=(i,u)=>{if(!ht||i.cardType!=="info"||i.infoType!=="quote"||i.checkType!=="quote-fragment")return!0;const j=kt(i.direction);if(!(j!=null&&j.fragmentId))return!0;const f=i.description??"";if(!f.trim())return!0;const b=ma(f).nodes[j.fragmentId];if(!b||!b.leftId&&!b.rightId)return!0;const A=[b.leftId,b.rightId].filter(J=>!!J);if(A.length===0)return!0;const C=A.map(J=>{const Z=Bt("info",i.cardId,"quote-fragment",ka(j.mode,J));return u.get(Z)??0});return C.reduce((J,Z)=>J+Z,0)/C.length>=nt},ia=async i=>{const u=ot,j=i.concat(u.active??[]).concat(u.pool??[]).filter((C,F,J)=>J.findIndex(Z=>ie(Z)===ie(C))===F);if(!ht){h(new Set(j.map(ie)));return}const{itemKnowness:f,cardKnowness:P}=await na(),b=Pt.filter(C=>dt(C.childItemType)==="collection"&&C.childItemId===k&&!dt(C.childCheckType)&&!dt(C.childDirection)),A=new Set;for(const C of j){if(C.cardType!=="info"){A.add(ie(C));continue}if(!Ua(C,P))continue;const F=Pt.filter(de=>rn(de,C)).concat(b);if(F.length===0){A.add(ie(C));continue}let J=0;for(const de of F)if(dt(de.parentItemType)==="collection")J+=await fa(de.parentItemId,P);else if(dt(de.parentCheckType)||dt(de.parentDirection)){const ne=dt(de.parentCheckType),Te=dt(de.parentDirection),Me=Bt(de.parentItemType,de.parentItemId,ne,Te);J+=P.get(Me)??0}else{const ne=`${de.parentItemType}:${de.parentItemId}`;J+=f.get(ne)??0}J/F.length>=nt&&A.add(ie(C))}h(A)},Wa=i=>{for(let u=i;u<I.length;u+=1){const j=I[u];if(j&&(!ht||j.cardType!=="info"||wt.has(ie(j))))return u}return-1},Ct=i=>!ht||i.cardType!=="info"||wt.has(ie(i)),ra=i=>{if(w.id!=="temporal"&&w.id!=="levels")return null;const u=ot,j=(u.active??[]).concat(u.pool??[]),f=new Set;for(const P of j){const b=ie(P);if(!(f.has(b)||i.has(b))&&(f.add(b),Ct(P)))return P}return null},Et=a.useMemo(()=>{if(w.id!=="levels")return null;const i=ot,u=i.pool??[],j=i.active??[],f=i.levelMap??{},P=Math.max(1,Number(g.levels??1)),b=Array.from({length:P},()=>0),A=new Set(j.map(Z=>ie(Z)));u.forEach(Z=>{const de=Math.min(P,Math.max(1,f[ie(Z)]??1));b[de-1]+=1});const C=u.length||1,F=b.map(Z=>Z/C*100),J=oe?f[ie(oe)]??1:null;return{counts:b,percentages:F,currentLevel:J,levelsCount:P,activeCount:j.length,poolCount:u.length,activeSet:A}},[ot,g,w,oe]),yt=a.useMemo(()=>{if(w.id!=="temporal")return null;const i=ot,u=i.pool??[],j=i.active??[],f=i.knownessMap??{},P=new Set(i.unknownSet??[]);let b=0;u.forEach(F=>{(f[ie(F)]??0)>1&&(b+=1)});const A=P.size,C=j.map(F=>({id:ie(F),value:P.has(ie(F))?0:Math.max(0,Math.min(1,f[ie(F)]??0))}));return{knownCount:b,unknownCount:A,dots:C}},[ot,w]),oa=a.useMemo(()=>{if(!ht)return 0;const i=ot;return I.concat(i.active??[]).concat(i.pool??[]).filter((j,f,P)=>P.findIndex(b=>ie(b)===ie(j))===f).filter(j=>j.cardType==="info"&&!wt.has(ie(j))).length},[ht,ot,I,wt]);a.useEffect(()=>{if(!ht||ae!=="ready")return;const i=ot,j=I.concat(i.active??[]).concat(i.pool??[]).filter((b,A,C)=>C.findIndex(F=>ie(F)===ie(b))===A).filter(b=>b.cardType!=="info"||wt.has(ie(b))).length,f=He.current;if(He.current=j,f===null||j<=f)return;const P=j-f;Tt(`New card available (+${P})`),Je.current&&window.clearTimeout(Je.current),Je.current=window.setTimeout(()=>Tt(null),2200)},[ht,ae,ot,I,wt]),a.useEffect(()=>()=>{Je.current&&window.clearTimeout(Je.current)},[]);const xt=(i,u)=>{const j=w.applyOutcome({queue:I,meta:ot},oe,Y,g,{correct:i,correctness:u,createdUtc:new Date().toISOString()});R(j.queue),St(j.meta);const f=j.queue[pe+1];f&&ba(f,pe+1)};a.useEffect(()=>{_a(d,k).then(i=>G(i.name)).catch(()=>G(t.cogita.library.collections.defaultName))},[d,k]),a.useEffect(()=>{ds({libraryId:d,type:"language"}).then(i=>te(i)).catch(()=>te([]))},[d]),a.useEffect(()=>{qs({libraryId:d}).then(i=>qt(i.items??[])).catch(()=>qt([]))},[d]),a.useEffect(()=>{as(d,z)},[d,z]),a.useEffect(()=>{ia(I)},[I,Pt,ht,nt,k]),a.useEffect(()=>{if(!oe||!ht){ce(!1);return}if(oe.cardType!=="info"||wt.has(ie(oe))){ce(!1);return}const i=Wa(pe+1);if(i>=0){ce(!1),v(i);return}if(w.id==="temporal"||w.id==="levels"){const u=I.slice(0,pe+1),j=I.slice(pe+1).filter(Ct),f=u.concat(j),P=new Set(f.map(ie)),b=ra(P);if(b){const C=ie(b);P.has(C)||(f.push(b),P.add(C),St(F=>{const J=F,Z=new Set(J.queued??[]);return Z.add(C),{...J,queued:Z}}))}const A=f.findIndex((C,F)=>F!==pe&&Ct(C));if(A>=0){R(f),v(A),ce(!1);return}}ce(!0)},[oe,wt,ht,pe,I,ot,w.id]),a.useEffect(()=>{let i=!0;return(async()=>{Pe("loading"),S({current:0,total:w.id==="levels"?0:w.getFetchLimit(Y,g)});try{const j=[];let f=null,P=null;do{const de=await $a({libraryId:d,collectionId:k,limit:300,cursor:f});if(j.push(...de.items),(w.id==="levels"||w.id==="temporal")&&de.total&&(P=de.total),S(ne=>({current:j.length,total:ne.total||de.total||w.getFetchLimit(Y,g)})),f=de.nextCursor??null,P!==null&&j.length>=P||w.id!=="levels"&&w.id!=="temporal"&&j.length>=w.getFetchLimit(Y,g))break}while(f);if(!i)return;const b=ls(j);let A;if(w.id==="levels"){const de=Math.max(1,Number(g.levels??1)),Te=(await Dt()).reduce((Me,De)=>{const Ve=Bt(De.itemType,De.itemId,De.checkType,De.direction);return Me[Ve]||(Me[Ve]=[]),Me[Ve].push(De),Me},{});A={},b.forEach(Me=>{const De=ie(Me),Ve=Te[De]??[],lt=Ve.length>0?_t(Ve).score:0,ea=Math.max(1,Math.min(de,Math.ceil(lt/100*de)));A[De]=ea})}let C=null,F=null,J=null;if(w.id==="temporal"){const de=await Dt(),ne=new Set(b.map(De=>ie(De))),Te=de.reduce((De,Ve)=>{const lt=Bt(Ve.itemType,Ve.itemId,Ve.checkType,Ve.direction);return ne.has(lt)&&(De[lt]||(De[lt]=[]),De[lt].push(Ve)),De},{});C={},F=new Set,J={};const Me=Date.now();b.forEach(De=>{const Ve=ie(De),lt=Te[Ve]??[];if(lt.length===0){C[Ve]=0,F.add(Ve),J[Ve]=[];return}const ea=us(lt);J[Ve]=ea;const ln=Da(ea,Me);C[Ve]=ln.knowness})}const Z=w.id==="levels"?gs(b,Y,g,A):w.id==="temporal"?hs(b,Y,g,C??{},F??new Set,J??{}):w.prepare(b,Y,g);R(Z.queue),St(Z.meta),v(0),Pe("ready"),S(de=>({current:Math.min(de.current,de.total),total:de.total}))}catch{i&&Pe("error")}})(),()=>{i=!1}},[d,k,Y,g,w,z]),a.useEffect(()=>{if(me(""),q(null),it(null),at(0),je([]),Ze({}),B({}),le(null),_e(null),he(null),Ee(!1),Xe(!1),We(null),X(null),L({}),!oe){Ie(null),Ae(null),qe(null),st(null);return}oe.cardType==="info"&&oe.infoType==="computed"&&Ie(t.cogita.library.revision.loadingComputed);let i=!0;return ba(oe,pe).then(u=>{!i||!u||(Ie(u.prompt),Ae(u.expectedAnswer),je(u.computedExpected),Ze(u.computedAnswers),qe(u.computedValues),le(u.answerTemplate),_e(u.outputVariables),he(u.variableValues))}),()=>{i=!1}},[oe,t]),a.useEffect(()=>{if(!oe||oe.cardType!=="info"||oe.infoType!=="quote"){Fe.current=null,et.current=new Set,ze(null);return}const i=oe.description??"",u=(oe.label??"").trim(),j=u.replace(/\s+/g," ").trim(),f=i.replace(/\s+/g," ").trim(),P=j&&j!==f?u:t.cogita.library.infoTypes.quote;if(!i){ze(null),Ae(null);return}const b=ma(i);Fe.current=b,Ie(P);let A=!0;return na().then(({fragmentKnowness:C})=>{if(!A)return;const F=getQuoteMode(oe.direction),J=new Set,Z={};C.forEach((Te,Me)=>{const[De,Ve]=Me.split(":",2);if(De!==oe.cardId)return;const lt=kt(Ve);if(!lt||lt.mode!==F)return;const ea=lt.fragmentId;Z[ea]=Te,Te>=nt&&J.add(ea)}),et.current=J,tt.current=Z;const de=kt(oe.direction);if(de!=null&&de.fragmentId&&b.nodes[de.fragmentId]){Kt(b,de.fragmentId,P);return}const ne=ha(b,J,Z,nt,ht,oe.direction);Kt(b,(ne==null?void 0:ne.id)??null,P)}).catch(()=>{et.current=new Set,tt.current={};const C=kt(oe.direction);if(C!=null&&C.fragmentId&&b.nodes[C.fragmentId]){Kt(b,C.fragmentId,P);return}const F=ha(b,et.current,{},nt,ht,oe.direction);Kt(b,(F==null?void 0:F.id)??null,P)}),()=>{A=!1}},[oe,t,ht,nt]),a.useEffect(()=>{if(!oe||oe.cardType!=="vocab"||oe.checkType!=="translation-match"){X(null),L({});return}const j=(ot.pool??ot.active??I).filter(C=>C.cardType==="vocab"&&C.checkType==="translation-match").filter((C,F,J)=>J.findIndex(Z=>Z.cardId===C.cardId)===F);j.some(C=>C.cardId===oe.cardId)||j.unshift(oe);const P=Lt(j).slice(0,6).map(C=>{const F=C.label.split("↔").map(de=>de.trim()).filter(Boolean);if(F.length<2)return null;const J=`${C.cardId}:L`,Z=`${C.cardId}:R`;return{cardId:C.cardId,leftId:J,rightId:Z,leftLabel:F[0],rightLabel:F[1]}}).filter(Boolean),b=P.map(C=>C.leftId),A=Lt(P.map(C=>C.rightId));X({pairs:P,leftOrder:b,rightOrder:A,selection:{},activeLeft:null,activeRight:null,locked:{}})},[oe,I,ot]),a.useEffect(()=>()=>{xe.current&&window.clearTimeout(xe.current),$e.current&&window.clearTimeout($e.current)},[]);const Gt=a.useRef(null);a.useEffect(()=>{if(!oe)return;const i=ie(oe),u=typeof document<"u"?document.activeElement:null;if(Gt.current===i&&u&&(u.tagName==="INPUT"||u.tagName==="TEXTAREA"))return;let j=0;const f=()=>{if(oe){if(oe.cardType==="info"&&oe.infoType==="computed"){if(Ke.length>0){const b=Ba(Se,Ke,Le),A=b?Ft.current[b]:null;if(A&&(A.focus(),document.activeElement===A)){Gt.current=i;return}}if(rt.current&&(rt.current.focus(),document.activeElement===rt.current)){Gt.current=i;return}}else if(oe.cardType==="vocab"&&rt.current&&(rt.current.focus(),document.activeElement===rt.current)){Gt.current=i;return}j<6&&(j+=1,window.setTimeout(f,40))}},P=window.setTimeout(f,40);return()=>window.clearTimeout(P)},[oe,Ke,Se,Le]),a.useEffect(()=>{if(!pt)return;const i=u=>{u.key==="Enter"&&(u.preventDefault(),ca())};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[pt]);const Xt=i=>{Ge(i),st(_t(i))};a.useEffect(()=>{if(!oe){st(null),Ge([]);return}const i=oe.cardType==="info"?"info":"connection";if(oe.cardType==="info"&&oe.infoType==="quote"){Dt().then(u=>{const j=u.filter(f=>f.itemType==="info"&&f.itemId===oe.cardId&&f.checkType==="quote-fragment"&&za(f.direction,oe.direction));Xt(j)}).catch(()=>{st(null),Ge([])});return}Fa(i,oe.cardId,oe.checkType,oe.direction).then(u=>Xt(u)).catch(()=>{st(null),Ge([])})},[d,oe,z]);const Ta=(i,u,j,f)=>{if(i==="info"&&j==="quote-fragment"){Dt().then(P=>{const b=P.filter(A=>A.itemType==="info"&&A.itemId===u&&A.checkType==="quote-fragment"&&za(A.direction,f));Xt(b)}).catch(()=>{st(null),Ge([])});return}Fa(i,u,j,f).then(P=>Xt(P)).catch(()=>{st(null),Ge([])})},Sa=(i,u,j)=>{var A;const f=((A=j.pairs.find(C=>C.leftId===i))==null?void 0:A.rightId)??null;if(!f)return j;const P=f===u;L(C=>({...C,[i]:P?"correct":"incorrect"})),xe.current&&window.clearTimeout(xe.current),$e.current&&window.clearTimeout($e.current),V.current+=1;const b={kind:P?"correct":"incorrect",tick:V.current};if(Ce(null),xe.current=window.setTimeout(()=>Ce(b),0),$e.current=window.setTimeout(()=>Ce(null),420),P){const C={...j.locked,[i]:!0};return Object.keys(C).length>=j.pairs.length?(q("correct"),Xe(!0)):q("correct"),{...j,selection:{...j.selection,[i]:u},activeLeft:null,activeRight:null,locked:C}}return q("incorrect"),{...j,activeLeft:null,activeRight:null}},la=i=>{X(u=>!u||u.locked[i]?u:u.activeRight?Sa(i,u.activeRight,u):{...u,activeLeft:u.activeLeft===i?null:i})},At=i=>{X(u=>u&&(u.activeLeft?Sa(u.activeLeft,i,u):{...u,activeRight:u.activeRight===i?null:i}))},ca=()=>{var i;if(oe&&oe.cardType==="info"&&oe.infoType==="quote"&&Fe.current&&we&&!((i=kt(oe.direction))!=null&&i.fragmentId)){const u=ha(Fe.current,et.current,tt.current,nt,ht,oe.direction,we.fragmentId);if(u){q(null),me(""),Ee(!1),B({}),Xe(!1),it(null),at(0),Kt(Fe.current,u.id,we.title);return}}q(null),me(""),Ee(!1),B({}),Xe(!1),it(null),at(0),v(u=>Math.min(u+1,I.length))},Mt=i=>{if(!oe)return;const u=i.expected??null,j=i.answer??"";let f=u??"",P=j;if(!u&&i.expectedMap&&i.answerMap){const de=Object.keys(i.expectedMap).sort((ne,Te)=>ne.localeCompare(Te));f=de.map(ne=>{var Te;return((Te=i.expectedMap)==null?void 0:Te[ne])??""}).join("|"),P=de.map(ne=>{var Te;return((Te=i.answerMap)==null?void 0:Te[ne])??""}).join("|")}const b=f?ga(f,P,jt):new Uint8Array,A={revisionType:w.id,evalType:i.evalType,direction:i.direction,prompt:ye??"",expected:u,answer:j,expectedAnswers:i.expectedMap??null,answers:i.answerMap??null,correct:i.correct,maskBase64:b.length?Ht(b):null,values:H??null,checkMode:re,compareMode:jt,minCorrectness:Wt},C=new TextEncoder().encode(JSON.stringify(A)),F=oe.cardType==="info"?"info":"connection",J=i.overrideCheckType??oe.checkType??null,Z=i.overrideDirection??oe.direction??null;Aa({itemType:F,itemId:oe.cardId,checkType:J,direction:Z,revisionType:w.id,evalType:i.evalType,correct:i.correct,maskBase64:b.length?Ht(b):null,payloadBase64:Ht(C),personRoleId:z??null}).then(()=>{Ta(F,oe.cardId,J,Z),ia(I),as(d,z)}).catch(()=>{})},Jt=(i,u)=>{const j=ft.current.get(u);if(j)return Promise.resolve(j);const f=$t.current.get(u);if(f)return f;const P=ua({libraryId:d,infoId:i}).then(b=>{var de,ne;const A=b.payload,C=((de=A.definition)==null?void 0:de.graph)??null,F="",J=((ne=A.definition)==null?void 0:ne.answerTemplate)??"",Z=Js(C,F,J);if(Z){const Me={sample:Zs(Z),answerTemplate:J||null};return ft.current.set(u,Me),Me}return bs({libraryId:d,infoId:i}).then(Te=>{const Me={sample:Te,answerTemplate:null};return ft.current.set(u,Me),Me})}).catch(()=>bs({libraryId:d,infoId:i}).then(b=>{const A={sample:b,answerTemplate:null};return ft.current.set(u,A),A}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{$t.current.delete(u)});return $t.current.set(u,P),P},ba=(i,u)=>{var C;const j=`${ie(i)}:${u}`,f=Ot.current.get(j);if(f)return Promise.resolve(f);const P=zt.current.get(j);if(P)return P;const b=F=>(Ot.current.set(j,F),F);let A;if(i.cardType==="vocab"){if(i.checkType==="translation-match")return A=Promise.resolve(b({prompt:i.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),A;const F=i.label.split("↔").map(J=>J.trim()).filter(Boolean);if(F.length>=2){const Z=(i.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",de=Z?F[0]:F[1],ne=Z?F[1]:F[0];A=Promise.resolve(b({prompt:de,expectedAnswer:ne,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else A=Promise.resolve(b({prompt:i.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(i.cardType==="info"&&i.infoType==="word"){const F=(C=i.description)!=null&&C.startsWith("Language: ")?i.description.replace("Language: ",""):null;A=Promise.resolve(b({prompt:i.label,expectedAnswer:F,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else i.cardType==="info"&&i.infoType==="computed"?A=Jt(i.cardId,j).then(F=>{var Te,Me;if(!F.sample)return b({prompt:i.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const J=F.sample,Z=J.expectedAnswers?Object.entries(J.expectedAnswers).map(([De,Ve])=>({key:De,expected:Ve})):[],de=Z.reduce((De,Ve)=>(De[Ve.key]="",De),{}),ne=J.expectedAnswerIsSentence&&((Te=J.expectedAnswer)==null?void 0:Te.trim())||null;return b({prompt:J.prompt,expectedAnswer:Z.length>0?ne:((Me=J.expectedAnswer)==null?void 0:Me.trim())||null,computedExpected:Z,computedAnswers:de,computedValues:J.values??null,answerTemplate:F.answerTemplate,outputVariables:J.outputVariables??null,variableValues:J.variableValues??null})}).catch(()=>b({prompt:i.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{zt.current.delete(j)}):A=Promise.resolve(b({prompt:i.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return zt.current.set(j,A),A},Kt=(i,u,j)=>{const f=Object.keys(i.nodes).length,P=et.current.size;if(!u){ze({title:j,before:i.text,after:"",fragmentId:null,total:f,completed:P}),Ae(null),Xe(!0);return}const b=i.nodes[u];if(!b)return;const A=Hs(i.text,b);ze({title:j,before:A.before,after:A.after,fragmentId:b.id,total:f,completed:P}),Ae(A.fragment),Xe(!1)},Ca=()=>{const i=Fe.current;i&&ze(u=>u&&{...u,total:Object.keys(i.nodes).length,completed:et.current.size})},da=()=>{const i=I[pe+1];i&&ba(i,pe+1)},Ma=()=>{if(da(),oe&&oe.cardType==="vocab"&&oe.checkType==="translation-match"&&M){if(M.pairs.length===0){q("incorrect"),Xe(!0);return}const b=M.pairs.reduce((ne,Te)=>(ne[Te.rightId]=Te.rightLabel,ne),{});let A=0;const C={};M.pairs.forEach(ne=>{const Me=M.selection[ne.leftId]===ne.rightId;C[ne.leftId]=Me?"correct":"incorrect",Me&&(A+=1)});const F=M.pairs.length||1,J=A/F,Z=A===M.pairs.length;L(ne=>({...ne,...C})),Z?(q("correct"),Xe(!0),at(0)):(q("incorrect"),Xe(!1),at(ne=>{const Te=ne+1;return Te>=bt&&(Ee(!0),Xe(!0),X(Me=>{if(!Me)return Me;const De=Me.pairs.reduce((Ve,lt)=>(Ve[lt.leftId]=lt.rightId,Ve),{});return{...Me,selection:De}})),Te})),xt(Z,J);const de="connection";Promise.all(M.pairs.map(ne=>{const Te=M.selection[ne.leftId]??null,Me=Te?b[Te]:"",De={left:ne.leftLabel,expected:ne.rightLabel,answer:Me,checkType:"translation-match"},Ve=new TextEncoder().encode(JSON.stringify(De));return Aa({itemType:de,itemId:ne.cardId,checkType:"translation-match",direction:null,revisionType:w.id,evalType:"translation-match",correct:Te===ne.rightId,maskBase64:null,payloadBase64:Ht(Ve),personRoleId:z??null})})).then(()=>{Ta(de,oe.cardId,oe.checkType,oe.direction),as(d,z)}).catch(()=>{});return}if(Ke.length>0){const b=Ke.reduce((C,F)=>{const J=Be[F.key]??"";return C[F.key]=vt(J)===vt(F.expected)?"correct":"incorrect",C},{});Ke.every(({key:C,expected:F})=>{const J=Be[C]??"";return re==="exact"&&vt(J)===vt(F)})?(q("correct"),B(b),Xe(!0),at(0),xt(!0,1),Mt({correct:!0,direction:ye?`${ye} -> computed`:"computed",expectedMap:Ke.reduce((C,F)=>(C[F.key]=F.expected,C),{}),answerMap:Be,evalType:"computed"})):(q("incorrect"),B(b),Xe(!1),at(C=>{const F=C+1;return F>=bt&&_&&(Ee(!0),Xe(!0)),F}),xt(!1,0),window.setTimeout(()=>{var F;const C=Ba(Se,Ke,Le);C&&Ft.current[C]&&((F=Ft.current[C])==null||F.focus())},40),Mt({correct:!1,direction:ye?`${ye} -> computed`:"computed",expectedMap:Ke.reduce((C,F)=>(C[F.key]=F.expected,C),{}),answerMap:Be,evalType:"computed"}));return}if(oe&&oe.cardType==="info"&&oe.infoType==="quote"&&(we!=null&&we.fragmentId)){if(!be)return;const b=kt(oe.direction),A=(b==null?void 0:b.mode)??getQuoteMode(oe.direction),C=b!=null&&b.fragmentId&&oe.direction?oe.direction:ka(A,we.fragmentId),F=nn(be,D,jt),J=re==="exact"&&pa(D)===pa(be),Z=Qt(F),de=J||Z,ne=Yt(F);de?(tt.current[we.fragmentId]=Math.max(tt.current[we.fragmentId]??0,ne),(tt.current[we.fragmentId]??0)>=nt&&et.current.add(we.fragmentId),Ca(),q("correct"),B({}),Xe(!0),it(F),at(0),ne<100&&bt<=1&&Ee(!0),xt(!0,ne/100),Mt({correct:!0,direction:`quote:${we.fragmentId}`,expected:be,answer:D,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:C})):(q("incorrect"),B({}),Xe(!1),it(F),at(Te=>{const Me=Te+1;return Me>=bt&&_&&(Ee(!0),Xe(!0)),Me}),xt(!1,ne/100),window.setTimeout(()=>{var Te;return(Te=rt.current)==null?void 0:Te.focus()},40),Mt({correct:!1,direction:`quote:${we.fragmentId}`,expected:be,answer:D,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:C}));return}if(!be)return;const i=ga(be,D,jt),u=re==="exact"&&vt(D)===vt(be),j=Qt(i),f=u||j,P=Yt(i);f?(q("correct"),B({}),Xe(!0),it(i),at(0),P<100&&bt<=1&&Ee(!0),xt(!0,P/100),Mt({correct:!0,direction:ye?`${ye} -> ${be}`:null,expected:be,answer:D,evalType:"text"})):(q("incorrect"),B({}),Xe(!1),it(i),at(b=>{const A=b+1;return A>=bt&&_&&(Ee(!0),Xe(!0)),A}),xt(!1,P/100),window.setTimeout(()=>{var b;return(b=rt.current)==null?void 0:b.focus()},40),Mt({correct:!1,direction:ye?`${ye} -> ${be}`:null,expected:be,answer:D,evalType:"text"}))},Qa=i=>{if(da(),!be)return;const u=ga(be,i,jt),j=vt(i)===vt(be),f=Qt(u),P=j||f,b=Yt(u);P?(q("correct"),B({}),Xe(!0),it(u),at(0),b<100&&bt<=1&&Ee(!0),xt(!0,b/100),Mt({correct:!0,direction:"word->language",expected:be,answer:i,evalType:"language-select"})):(q("incorrect"),B({}),Xe(!1),it(u),at(A=>{const C=A+1;return C>=bt&&_&&(Ee(!0),Xe(!0)),C}),xt(!1,b/100),Mt({correct:!1,direction:"word->language",expected:be,answer:i,evalType:"language-select"}))},Ha=()=>{da(),q("correct"),Xe(!0),at(0),xt(!0,1),be&&Mt({correct:!0,direction:"manual",expected:be,answer:D,evalType:"manual"})},Ya=()=>{if(xt(!1,0),oe&&oe.cardType==="info"&&oe.infoType==="quote"){q(null),me(""),Ee(!1),B({}),Xe(!1),it(null),at(0),v(i=>Math.min(i+1,I.length));return}ca()};a.useEffect(()=>{da()},[pe,I]);const Zt=i=>{var j;if(i.key!=="Enter")return;if(i.preventDefault(),i.stopPropagation(),pt){ca();return}const u=Ke.find(f=>!(Be[f.key]??"").trim());if(u){(j=Ft.current[u.key])==null||j.focus();return}Ma()},T=t.cogita.library.revision.revealModeAfterIncorrect,_=Ke.length>0||!!be;return e.jsxs(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:[ae==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ge.total?Math.min(100,Math.max(0,ge.current/ge.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ge.total?`${Math.min(ge.current,ge.total)} / ${ge.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:$}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",p).replace("{check}",U)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:O,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${O}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${O}/collections/${k}`,children:t.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ke?`${ke.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Et?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Et.currentLevel??"-"," / ",Et.levelsCount]}):null,ke?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(ke.correct)).replace("{total}",String(ke.total))}),ke.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(ke.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(tn,{outcomes:Qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[mt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:mt})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":fe?`${fe.kind}-${fe.tick}`:se?"idle":Q??"idle",children:oe?e.jsx(e.Fragment,{children:Ne?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(en,{copy:t,currentCard:oe,currentTypeLabel:Rt,prompt:ye,languages:ee,answer:D,onAnswerChange:i=>me(u=>Ka(u,i,Ue)),computedExpected:Ke,computedAnswers:Be,onComputedAnswerChange:(i,u)=>Ze(j=>({...j,[i]:Ka(j[i]??"",u,Ue)})),answerTemplate:Se,outputVariables:Le,variableValues:K,computedFieldFeedback:Ye,feedback:Q,canAdvance:pt,quoteContext:we,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ma,onSkip:Ya,onLanguageSelect:Qa,onMarkReviewed:Ha,onAdvance:ca,showCorrectAnswer:Re,setShowCorrectAnswer:Ee,onRevealCorrect:()=>Xe(!0),answerMask:ct,expectedAnswer:be,hasExpectedAnswer:_,handleComputedKeyDown:Zt,answerInputRef:rt,computedInputRefs:Ft,scriptMode:Ue,setScriptMode:We,matchPairs:M==null?void 0:M.pairs,matchLeftOrder:M==null?void 0:M.leftOrder,matchRightOrder:M==null?void 0:M.rightOrder,matchSelection:M==null?void 0:M.selection,matchActiveLeft:M==null?void 0:M.activeLeft,matchActiveRight:M==null?void 0:M.activeRight,matchFeedback:ve,onMatchLeftSelect:la,onMatchRightSelect:At})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${O}/collections/${k}`,children:t.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Ut?`${ut} / ${Ut}`:t.cogita.library.revision.progressUnlimited}),ae==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),ae==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),ae==="ready"&&I.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:T}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",bt]})]})]}),Et?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Et.activeCount," / ",Et.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Et.counts.map((i,u)=>{const j=u+1,f=Et.currentLevel===j,P=Et.percentages[u]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":f,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:j}),e.jsx("strong",{children:i})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,P))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[P.toFixed(1),"%"]})]},`level-${j}`)})})]}):null,yt?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:yt.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:yt.dots.map(i=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,i.value*100))}%`,background:`rgba(${Math.round(255*(1-i.value))}, ${Math.round(200*i.value)}, 80, 0.9)`}},i.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:yt.knownCount})]})]}):null,ht?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:oa})]})}):null]})]})]})})})]})]})}const ss=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],$i={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Ri=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Ei=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Ai({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:d,collectionId:k}){const[c,o]=a.useState(""),[O,ue,Y]=Rs([]),[W,w,g]=Es([]),[re,z]=a.useState(null),[p,U]=a.useState(null),[$,G]=a.useState(null),I=`/#/cogita/library/${d}`;a.useEffect(()=>{_a(d,k).then(S=>o(S.name)).catch(()=>o(t.cogita.library.collections.defaultName))},[d,k,t]),a.useEffect(()=>{Tn({libraryId:d,collectionId:k}).then(S=>{if(!S.graphId||S.graphId==="00000000-0000-0000-0000-000000000000"){ue([]),w([]);return}const pe=S.nodes.map(D=>{var ye;const me=D.payload??{},Q=me.position??{x:120,y:120},q=me.params??{};return{id:D.nodeId,type:"default",position:Q,data:{nodeType:D.nodeType,label:((ye=ss.find(Ie=>Ie.type===D.nodeType))==null?void 0:ye.label)??D.nodeType,params:q}}}),v=S.edges.map(D=>({id:D.edgeId,source:D.fromNodeId,target:D.toNodeId,sourceHandle:D.fromPort??void 0,targetHandle:D.toPort??void 0}));ue(pe),w(v)}).catch(()=>{ue([]),w([])})},[d,k,w,ue]);const R=a.useMemo(()=>O.find(S=>S.id===re)??null,[O,re]),ee=S=>{var me;const pe=crypto.randomUUID(),v=((me=ss.find(Q=>Q.type===S))==null?void 0:me.label)??S,D={...$i[S]};ue(Q=>[...Q,{id:pe,type:"default",position:{x:120+Q.length*40,y:120+Q.length*40},data:{nodeType:S,label:v,params:D}}]),z(pe)},te=a.useCallback(S=>{w(pe=>As({...S,id:crypto.randomUUID()},pe))},[w]),ae=async()=>{U(null);try{await Cn({libraryId:d,collectionId:k,nodes:O.map(S=>({nodeId:S.id,nodeType:S.data.nodeType,payload:{position:S.position,params:S.data.params}})),edges:W.map(S=>({edgeId:S.id,fromNodeId:S.source,fromPort:S.sourceHandle??null,toNodeId:S.target,toPort:S.targetHandle??null}))}),U(t.cogita.library.graph.saveSuccess)}catch{U(t.cogita.library.graph.saveFail)}},Pe=async()=>{try{const S=await Sn({libraryId:d,collectionId:k});G(S)}catch{G(null)}},ge=S=>{R&&ue(pe=>pe.map(v=>v.id===R.id?{...v,data:{...v.data,params:S}}:v))};return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${I}/collections/${k}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Pe,children:t.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ae,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:ss.map(S=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ee(S.type),children:S.label},S.type))}),p?e.jsx("p",{className:"cogita-help",children:p}):null,$&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String($.total))}),e.jsx("p",{children:t.cogita.library.graph.previewBreakdown.replace("{connections}",String($.connections)).replace("{infos}",String($.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Fs,{nodes:O,edges:W,onNodesChange:Y,onEdgesChange:g,onConnect:te,onNodeClick:(S,pe)=>z(pe.id),fitView:!0,children:[e.jsx(Ps,{color:"rgba(120,160,200,0.2)"}),e.jsx(zs,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),R?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:R.data.label}),R.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(aa,{libraryId:d,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:R.data.params.tagId?{id:R.data.params.tagId,label:R.data.params.tagLabel??"",infoType:"topic"}:null,onChange:S=>ge({...R.data.params,tagId:(S==null?void 0:S.id)??null,tagLabel:(S==null?void 0:S.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:R.data.params.scope??"any",onChange:S=>ge({...R.data.params,scope:S.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),R.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(aa,{libraryId:d,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:R.data.params.languageId?{id:R.data.params.languageId,label:R.data.params.languageLabel??"",infoType:"language"}:null,onChange:S=>ge({...R.data.params,languageId:(S==null?void 0:S.id)??null,languageLabel:(S==null?void 0:S.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:R.data.params.scope??"any",onChange:S=>ge({...R.data.params,scope:S.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),R.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:R.data.params.infoType??"word",onChange:S=>ge({...R.data.params,infoType:S.target.value}),children:Ei.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))})]}),e.jsx(aa,{libraryId:d,infoType:R.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:R.data.params.infoId?{id:R.data.params.infoId,label:R.data.params.infoLabel??"",infoType:R.data.params.infoType??"word"}:null,onChange:S=>ge({...R.data.params,infoId:(S==null?void 0:S.id)??null,infoLabel:(S==null?void 0:S.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),R.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:R.data.params.connectionType??"translation",onChange:S=>ge({...R.data.params,connectionType:S.target.value}),children:Ri.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:R.data.params.connectionId??"",onChange:S=>ge({...R.data.params,connectionId:S.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(R.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const ns="cogita.preferences",on=["library_overview","all_cards","all_collections","storyboards","texts","dependencies","transfer"],is={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},rs=["settings","run","shared"];function Fi(t,s=""){const n=t.split("/").filter(Boolean);if(n[0]!=="cogita"||n[1]!=="library")return{};const r=n[2];if(!r)return{};if(!n[3])return{libraryId:r,target:"library_overview"};const l=new URLSearchParams(s),m=l.get("revisionId")??void 0,y=l.get("infoId")??void 0,x=l.get("infoView")==="cards"?"cards":"overview",E=l.get("collectionAction"),N=l.get("libraryAction");if(n[3]==="list")return{libraryId:r,target:N==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:m,infoId:y,infoView:x,libraryAction:N==="new-info"?"new-info":void 0};if(n[3]==="detail"||n[3]==="collection")return{libraryId:r,target:"all_cards",cardMode:n[3],revisionId:m,infoId:y,infoView:x};if(n[3]==="new"||n[3]==="add")return{libraryId:r,target:"new_card",revisionId:m,libraryAction:"new-info"};if(n[3]==="edit")return{libraryId:r,target:"new_card",revisionId:m,infoId:n[4]};if(n[3]==="shared-revisions")return{libraryId:r,target:"all_collections",revisionId:m};if(n[3]==="dependencies")return{libraryId:r,target:"dependencies"};if(n[3]==="transfer")return{libraryId:r,target:"transfer"};if(n[3]==="storyboards")return n[4]==="new"?{libraryId:r,target:"new_storyboard"}:{libraryId:r,target:"storyboards"};if(n[3]==="texts")return n[4]==="new"?{libraryId:r,target:"new_text"}:{libraryId:r,target:"texts"};if(n[3]!=="collections")return{libraryId:r,target:"library_overview"};if(n[4]==="new")return{libraryId:r,target:"new_collection",revisionId:m};const d=n[4];return d?n[5]==="graph"?{libraryId:r,target:"all_collections",collectionId:d,revisionId:m,revisionView:"graph"}:n[5]==="shared-revisions"?{libraryId:r,target:"all_collections",collectionId:d,revisionId:m,revisionView:"shared"}:n[5]==="revision"?{libraryId:r,target:"all_collections",collectionId:d,revisionId:m,revisionView:n[6]==="run"?"run":"settings"}:E==="new-revision"?{libraryId:r,target:"all_collections",collectionId:d,revisionId:m,revisionView:"new"}:{libraryId:r,target:"all_collections",collectionId:d,revisionId:m,revisionView:"detail"}:E==="new-collection"?{libraryId:r,target:"new_collection",collectionAction:"new-collection"}:{libraryId:r,target:"all_collections"}}function Ls(t,s="library_overview",n,r,l,m,y="overview"){const x=(E,N)=>{const d=new URLSearchParams;N!=null&&N.revisionId&&d.set("revisionId",N.revisionId),N!=null&&N.collectionAction&&d.set("collectionAction",N.collectionAction),N!=null&&N.libraryAction&&d.set("libraryAction",N.libraryAction),N!=null&&N.infoId&&d.set("infoId",N.infoId),N!=null&&N.infoView&&(N!=null&&N.infoId)&&d.set("infoView",N.infoView);const k=d.toString();return k?`${E}?${k}`:E};return t?s==="library_overview"?x(`/cogita/library/${t}`,{revisionId:l}):s==="all_cards"?x(`/cogita/library/${t}/list`,{revisionId:l,infoId:m,infoView:y}):s==="new_card"?m?x(`/cogita/library/${t}/edit/${m}`,{revisionId:l}):x(`/cogita/library/${t}/list`,{revisionId:l,libraryAction:"new-info"}):s==="all_collections"?n?r==="graph"?x(`/cogita/library/${t}/collections/${n}/graph`,{revisionId:l}):r==="settings"?x(`/cogita/library/${t}/collections/${n}/revision`,{revisionId:l}):r==="run"?x(`/cogita/library/${t}/collections/${n}/revision/run`,{revisionId:l}):r==="shared"?x(`/cogita/library/${t}/collections/${n}/shared-revisions`,{revisionId:l}):r==="new"?x(`/cogita/library/${t}/collections/${n}`,{revisionId:l,collectionAction:"new-revision"}):x(`/cogita/library/${t}/collections/${n}`,{revisionId:l}):x(`/cogita/library/${t}/collections`,{revisionId:l}):s==="new_collection"?x(`/cogita/library/${t}/collections`,{revisionId:l,collectionAction:"new-collection"}):s==="transfer"?x(`/cogita/library/${t}/transfer`,{revisionId:l}):s==="storyboards"?x(`/cogita/library/${t}/storyboards`,{revisionId:l}):s==="new_storyboard"?x(`/cogita/library/${t}/storyboards/new`,{revisionId:l}):s==="texts"?x(`/cogita/library/${t}/texts`,{revisionId:l}):s==="new_text"?x(`/cogita/library/${t}/texts/new`,{revisionId:l}):s==="dependencies"?x(`/cogita/library/${t}/dependencies`,{revisionId:l}):x(`/cogita/library/${t}`,{revisionId:l}):"/cogita"}function xa(t){return t.length>1&&t.endsWith("/")?t.slice(0,-1):t}function Pi(t){return typeof t=="string"&&on.includes(t)}function zi(t,s){var x;if(!t.length)return null;const n=t.filter(E=>s.has(E.roleId)),r=n.length>0?n:t,l=r.map(E=>{var d,k;const N=((k=(d=E.fields.find(c=>c.fieldType==="role_kind"))==null?void 0:d.plainValue)==null?void 0:k.toLowerCase())??"";return{roleId:E.roleId,roleKind:N}}),m=l.find(E=>E.roleKind.includes("master"));if(m)return m.roleId;const y=l.find(E=>E.roleKind.includes("account")||E.roleKind.includes("user"));return y?y.roleId:((x=r[0])==null?void 0:x.roleId)??null}function Ki(t){if(!t)return{version:1,byLibrary:{}};try{const s=JSON.parse(t);return!s||typeof s!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:s.lastLibraryId,byLibrary:s.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Bi({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N}){const d=$s(),k=cs(),c=a.useMemo(()=>Fi(k.pathname,k.search),[k.pathname,k.search]),o=t.cogita.workspace,[O,ue]=a.useState([]),[Y,W]=a.useState([]),[w,g]=a.useState([]),[re,z]=a.useState([]),[p,U]=a.useState(void 0),[$,G]=a.useState("library_overview"),[I,R]=a.useState(void 0),[ee,te]=a.useState(void 0),[ae,Pe]=a.useState("detail"),[ge,S]=a.useState(void 0),[pe,v]=a.useState(!1),[D,me]=a.useState(!0),[Q,q]=a.useState(!1),[ye,Ie]=a.useState(!1),[be,Ae]=a.useState(null),[we,ze]=a.useState(0),[Ke,je]=a.useState(""),[Be,Ze]=a.useState(""),[Ye,B]=a.useState(""),[H,qe]=a.useState(null),[Se,le]=a.useState(null),Le=a.useRef({version:1,byLibrary:{}}),_e=a.useRef(!1),K=a.useRef(!1),he=a.useRef(null),M=a.useMemo(()=>O.find(h=>h.libraryId===p)??null,[O,p]),X=a.useMemo(()=>Y.find(h=>h.collectionId===I)??null,[Y,I]),ve=a.useMemo(()=>re.find(h=>h.revisionId===ee)??null,[re,ee]),L=a.useMemo(()=>({detail:o.revisions.detail,graph:o.revisions.graph,settings:o.revisions.settings,run:o.revisions.run,shared:o.targets.sharedRevisions,new:o.revisionForm.createAction}),[o.revisions.detail,o.revisions.graph,o.revisions.run,o.revisions.settings,o.targets.sharedRevisions,o.revisionForm.createAction]),V=a.useMemo(()=>[{value:"detail",label:L.detail},{value:"graph",label:L.graph},{value:"settings",label:o.targets.allRevisions},{value:"run",label:L.run},{value:"shared",label:L.shared}],[L.detail,L.graph,L.run,L.shared,o.targets.allRevisions]),fe=a.useMemo(()=>$==="new_card"?"all_cards":$==="new_collection"?"all_collections":$==="new_storyboard"?"storyboards":$==="new_text"?"texts":$,[$]),Ce=a.useMemo(()=>ae==="new"?"settings":ae,[ae]),xe=a.useMemo(()=>c.infoId?"selected":$==="new_card"?"create":"search",[c.infoId,$]),$e=a.useMemo(()=>w.find(h=>h.infoId===c.infoId)??null,[w,c.infoId]),Ue=a.useMemo(()=>({library_overview:o.targets.libraryOverview,all_cards:o.targets.allCards,new_card:o.targets.newCard,all_collections:o.targets.allCollections,new_collection:o.targets.newCollection,transfer:o.targets.transfer,storyboards:o.targets.storyboards,new_storyboard:o.targets.newStoryboard,texts:o.targets.texts,new_text:o.targets.newText,dependencies:o.targets.dependencies}),[o.targets]),We=a.useMemo(()=>Ue[fe]??fe,[fe,Ue]),Re=L[Ce],Ee=!!p,ke=a.useMemo(()=>{const h=E==="pl"?"Ruch na teraz: utwórz bibliotekę i wpisz pierwszy element wiedzy.":E==="de"?"Nächster Schritt: Erstelle eine Bibliothek und füge den ersten Wissenseintrag hinzu.":"Next action: create one library and add your first knowledge item.";return E==="pl"?[{step:"Krok 1",title:"Czym jest Cogita?",lead:"To centrum budowania i prowadzenia procesu nauki po zalogowaniu.",passages:["W jednym miejscu łączysz treści, ćwiczenia i współpracę zespołu.","Zamiast luźnych notatek dostajesz spójny przepływ: biblioteka → kolekcja → powtórka."],focus:["Jedna przestrzeń robocza","Spójny proces"],action:h},{step:"Krok 2",title:"Zacznij od biblioteki",lead:"Biblioteka jest bazą dla całego tematu.",passages:["Nazwij bibliotekę jasno: np. „Historia Kościoła – semestr 1”.","Każdy kolejny moduł korzysta z tej samej biblioteki jako źródła."],focus:["Nazwa tematyczna","Jeden punkt startowy"],action:h},{step:"Krok 3",title:"Dodawaj informacje",lead:"Twórz krótkie, konkretne jednostki wiedzy.",passages:["Wpisy typu info opisują pojęcia, osoby, źródła i cytaty.","Małe jednostki łatwiej łączyć, powtarzać i aktualizować."],focus:["Krótko i konkretnie","Łatwe aktualizacje"],action:h},{step:"Krok 4",title:"Pracuj na typach",lead:"Formularze dostosowują się do rodzaju informacji.",passages:["Każdy typ pokazuje właściwe pola i porządkuje dane.","To zmniejsza chaos i poprawia jakość wyszukiwania."],focus:["Lepsza struktura","Mniej błędów"],action:h},{step:"Krok 5",title:"Łącz wiedzę linkami",lead:"Buduj kontekst przez relacje między wpisami.",passages:["Połącz temat z definicją, źródłem i przykładem.","Graf relacji pomaga zobaczyć, czego brakuje przed kolejnym etapem."],focus:["Relacje między wpisami","Pełniejszy kontekst"],action:h},{step:"Krok 6",title:"Twórz kolekcje celu",lead:"Kolekcja grupuje wpisy pod konkretny scenariusz.",passages:["Osobna kolekcja dla lekcji, osobna dla quizu lub egzaminu.","Nie duplikujesz treści — tylko wybierasz, co jest potrzebne."],focus:["Celowe grupowanie","Bez duplikatów"],action:h},{step:"Krok 7",title:"Dodawaj powtórki",lead:"Powtórka definiuje jak przebiega sprawdzanie.",passages:["Ustaw tempo, kolejność i zakres materiału.","Dla jednej kolekcji możesz mieć kilka powtórek o różnych poziomach."],focus:["Kontrola tempa","Różne poziomy"],action:h},{step:"Krok 8",title:"Info vs karta",lead:"Rozróżniaj źródło wiedzy i widok ćwiczeniowy.",passages:["Info to rekord bazowy, który przechowuje treść.","Karta to forma pytania/utrwalenia generowana z info."],focus:["Źródło danych","Widok ćwiczeń"],action:h},{step:"Krok 9",title:"Uruchamiaj sesję",lead:"Tryb Run prowadzi uczestników krok po kroku.",passages:["Prowadzący kontroluje rytm i przejścia między etapami.","Uczestnicy mają jasny przebieg bez zgadywania, co dalej."],focus:["Płynny przebieg","Lepsza dynamika grupy"],action:h},{step:"Krok 10",title:"Czytaj graf zależności",lead:"Graf pokazuje priorytety nauki.",passages:["Węzły centralne oznaczają tematy, które wpływają na wiele innych.","Najpierw utrwal fundamenty, potem przechodź do warstw zaawansowanych."],focus:["Priorytety materiału","Lepsza kolejność"],action:h},{step:"Krok 11",title:"Storyboard i teksty",lead:"Plan i notatki trzymaj blisko wiedzy źródłowej.",passages:["Storyboard układa narrację i przebieg spotkania.","Teksty zbierają komentarze, wnioski i gotowe treści do publikacji."],focus:["Lepsze przygotowanie","Notatki w kontekście"],action:h},{step:"Krok 12",title:"Udostępniaj bezpiecznie",lead:"Dziel się materiałem bez utraty kontroli.",passages:["Możesz dać dostęp tylko do odczytu dla wybranych osób.","Edycja pozostaje po stronie autora lub zespołu prowadzącego."],focus:["Kontrola uprawnień","Bezpieczne współdzielenie"],action:h},{step:"Krok 13",title:"Nawiguj warstwowo",lead:"Sidebar i breadcrumb prowadzą przez poziomy.",passages:["Zawsze widzisz, czy pracujesz na bibliotece, kolekcji czy powtórce.","Mniej kliknięć „w ciemno”, więcej świadomej nawigacji."],focus:["Orientacja w systemie","Szybsze decyzje"],action:h},{step:"Krok 14",title:"Plan wdrożenia 30 minut",lead:"Najpierw prosty pilot, potem rozwijaj.",passages:["Plan: 1 biblioteka, 10 wpisów info, 1 kolekcja, 1 powtórka testowa.","Po pierwszej sesji popraw strukturę i dodaj kolejne scenariusze."],focus:["Szybki start","Iteracyjne doskonalenie"],action:"Gotowe? Załóż bibliotekę po prawej i przejdź do pierwszego wpisu."}]:E==="de"?[{step:"Schritt 1",title:"Was ist Cogita?",lead:"Ein zentraler Workspace für Lernen und Moderation nach dem Login.",passages:["Du verbindest Inhalte, Übungen und Teamarbeit in einem Ablauf.","Der Prozess bleibt klar: Bibliothek → Sammlung → Wiederholung."],focus:["Ein Workspace","Klarer Ablauf"],action:h},{step:"Schritt 2",title:"Mit Bibliothek starten",lead:"Die Bibliothek ist der Startpunkt für dein Thema.",passages:["Vergib einen klaren Namen für Kurs oder Modul.","Alle weiteren Bereiche greifen auf diese Basis zu."],focus:["Sauberer Start","Gemeinsame Basis"],action:h},{step:"Schritt 3",title:"Infos anlegen",lead:"Erfasse Wissen in kleinen, klaren Einträgen.",passages:["Info-Einträge enthalten Begriffe, Personen, Quellen und Zitate.","Kleinere Einheiten lassen sich besser verknüpfen und trainieren."],focus:["Kleine Einheiten","Leicht wartbar"],action:h},{step:"Schritt 4",title:"Typbasierte Eingabe",lead:"Formulare passen sich automatisch dem Info-Typ an.",passages:["Dadurch bleiben Daten strukturiert und konsistent.","Das verbessert Qualität und Auffindbarkeit."],focus:["Konsistenz","Bessere Suche"],action:h},{step:"Schritt 5",title:"Wissen verlinken",lead:"Verbinde Einträge zu einem Kontextnetz.",passages:["Thema, Quelle und Beispiel werden als Beziehung sichtbar.","So erkennst du Lücken vor der nächsten Lernphase."],focus:["Kontextnetz","Lücken erkennen"],action:h},{step:"Schritt 6",title:"Ziel-Sammlungen bauen",lead:"Eine Sammlung bündelt Inhalte für einen konkreten Zweck.",passages:["Nutze getrennte Sammlungen für Unterricht, Quiz oder Prüfung.","Du wählst Inhalte aus statt sie zu kopieren."],focus:["Zielorientierung","Keine Duplikate"],action:h},{step:"Schritt 7",title:"Wiederholungen erstellen",lead:"Wiederholungen definieren den Prüfungsablauf.",passages:["Tempo, Reihenfolge und Umfang sind pro Wiederholung steuerbar.","Mehrere Wiederholungen pro Sammlung sind möglich."],focus:["Ablaufsteuerung","Mehrere Niveaus"],action:h},{step:"Schritt 8",title:"Info und Karte",lead:"Datenobjekt und Trainingsansicht sind getrennt.",passages:["Info ist die Quelle der Inhalte.","Die Karte ist die Übungsansicht für Frage und Antwort."],focus:["Sauberes Modell","Wiederverwendbar"],action:h},{step:"Schritt 9",title:"Sitzung durchführen",lead:"Im Run-Modus führst du die Gruppe Schritt für Schritt.",passages:["Moderation steuert Übergänge und Timing.","Teilnehmende folgen einem klaren Ablauf."],focus:["Klare Moderation","Stabile Dynamik"],action:h},{step:"Schritt 10",title:"Abhängigkeitsgraph lesen",lead:"Der Graph zeigt Lernprioritäten.",passages:["Zentrale Knoten beeinflussen viele weitere Themen.","Starte mit Grundlagen und baue danach auf."],focus:["Priorisierung","Lernreihenfolge"],action:h},{step:"Schritt 11",title:"Storyboard & Texte",lead:"Plane Ablauf und sammle Notizen im selben Kontext.",passages:["Storyboards strukturieren Sequenzen und Rollen.","Texte halten Erkenntnisse und veröffentlichungsreife Inhalte fest."],focus:["Planung","Dokumentation"],action:h},{step:"Schritt 12",title:"Sicher teilen",lead:"Teile Inhalte ohne Kontrollverlust.",passages:["Leserechte sind separat von Bearbeitungsrechten steuerbar.","So bleibt der Kernbestand geschützt."],focus:["Rechtekontrolle","Sicheres Teilen"],action:h},{step:"Schritt 13",title:"Ebenen-Navigation",lead:"Sidebar und Breadcrumb zeigen deinen aktuellen Kontext.",passages:["Du siehst sofort, auf welcher Ebene du arbeitest.","Das spart Zeit und reduziert Fehlklicks."],focus:["Orientierung","Effizienz"],action:h},{step:"Schritt 14",title:"30-Minuten-Startplan",lead:"Starte klein und erweitere iterativ.",passages:["Plan: 1 Bibliothek, 10 Infos, 1 Sammlung, 1 Test-Wiederholung.","Nach der ersten Runde verbesserst du Struktur und Ablauf."],focus:["Schneller Einstieg","Iteratives Vorgehen"],action:"Jetzt starten: Bibliothek rechts anlegen und den ersten Eintrag erfassen."}]:[{step:"Step 1",title:"What is Cogita?",lead:"A post-login workspace to design, run, and improve knowledge journeys.",passages:["You can keep content, training flow, and collaboration in one place.","The path stays explicit: library → collection → revision → session."],focus:["Single workspace","Clear learning flow"],action:h},{step:"Step 2",title:"Start with a library",lead:"Your library is the root container for one domain or program.",passages:["Name it after your course, cohort, or topic scope.","Every next module reuses this foundation."],focus:["Root container","Consistent base"],action:h},{step:"Step 3",title:"Add information units",lead:"Build knowledge from small, reusable info entries.",passages:["Capture terms, references, people, concepts, and citations.","Smaller entries are easier to link, review, and update."],focus:["Reusable units","Easy maintenance"],action:h},{step:"Step 4",title:"Use type-based forms",lead:"Each info type has a matching data structure and fields.",passages:["Form layouts adapt automatically to the selected type.","This improves consistency and lowers input mistakes."],focus:["Structured input","Fewer errors"],action:h},{step:"Step 5",title:"Link the knowledge graph",lead:"Relationships turn isolated facts into usable context.",passages:["Connect topics, sources, and supporting examples.","Dependency links show what must be learned first."],focus:["Context building","Better sequencing"],action:h},{step:"Step 6",title:"Build goal collections",lead:"Collections package selected infos for a concrete objective.",passages:["Create separate collections for class, quiz, exam, or workshop.","You curate from existing entries instead of duplicating content."],focus:["Goal-oriented sets","No duplication"],action:h},{step:"Step 7",title:"Create revisions",lead:"Revisions define how practice and checking should run.",passages:["Set pacing, order, and scope for each session style.","One collection can host multiple revision strategies."],focus:["Practice design","Multiple modes"],action:h},{step:"Step 8",title:"Understand info vs card",lead:"Data objects and practice views are intentionally separate.",passages:["Info is the canonical source object.","Card is the generated training/checking view."],focus:["Clear model","Reusable content"],action:h},{step:"Step 9",title:"Run live sessions",lead:"Run mode helps facilitators guide each step with control.",passages:["Move through prompts, responses, and timing intentionally.","Participants get a predictable and focused session rhythm."],focus:["Facilitator control","Group clarity"],action:h},{step:"Step 10",title:"Read dependency graphs",lead:"Graph views expose prerequisites and high-impact nodes.",passages:["Central nodes usually deserve priority in onboarding.","Use this to plan revision order and reduce confusion."],focus:["Priority mapping","Smarter progression"],action:h},{step:"Step 11",title:"Use storyboards and texts",lead:"Plan narratives and keep notes near source knowledge.",passages:["Storyboards model session structure and transitions.","Texts capture outcomes, drafts, and reusable explanations."],focus:["Planning layer","Contextual notes"],action:h},{step:"Step 12",title:"Share safely",lead:"Share read access without losing editorial control.",passages:["Keep editing rights restricted to owners or maintainers.","Collaborators can consume material while core data stays protected."],focus:["Access control","Safe collaboration"],action:h},{step:"Step 13",title:"Navigate by layers",lead:"Sidebar and breadcrumb make system depth understandable.",passages:["You always know whether you are at library, collection, or revision level.","Clear location awareness reduces wrong actions."],focus:["Fast orientation","Lower friction"],action:h},{step:"Step 14",title:"30-minute launch plan",lead:"Start with a minimum viable setup, then iterate.",passages:["Plan: create 1 library, add 10 infos, build 1 collection, run 1 revision.","After the first run, refine structure and scale by scenario."],focus:["Immediate execution","Iterative improvement"],action:"Ready now? Create your first library on the right and start adding knowledge."}]},[E]),st=ke.length,Qe=Math.max(0,Math.min(we,st-1)),Ge=ke[Qe],mt=!!I,Tt=Ee&&$==="all_collections",He=mt&&$==="all_collections",Je=mt&&$==="all_collections"&&rs.includes(ae),ct=a.useCallback(h=>{const Ne=!!h.libraryId;let ce=h.target,Fe=h.collectionId,et=h.revisionId,tt=h.revisionView,oe=h.infoId,se=h.infoView??c.infoView??"overview";Ne?is[ce].requiresCollection&&!Fe?(ce="all_collections",et=void 0,tt="detail"):ce!=="all_collections"?(Fe=void 0,et=void 0,ce!=="new_card"&&ce!=="all_cards"&&(oe=void 0,se="overview")):is[ce].allowsRevision?rs.includes(tt)||(et=void 0):tt="detail":(ce="library_overview",Fe=void 0,et=void 0,tt="detail",oe=void 0,se="overview"),U(h.libraryId),G(ce),R(Fe),te(et),Pe(tt),v(!1);const ft=xa(Ls(h.libraryId,ce,Fe,tt,et,oe,se));xa(`${k.pathname}${k.search}`)!==ft&&(he.current=ft,d(ft))},[k.pathname,k.search,d,c.infoView]),it=h=>{ct({libraryId:p,target:"all_collections",collectionId:I,revisionId:rs.includes(h)?ee:void 0,revisionView:h})},It=a.useMemo(()=>[{key:"library",label:o.layers.library,visible:!0,value:p??"",selectedLabel:(M==null?void 0:M.name)??o.path.noLibrarySelected,disabled:D||O.length===0,options:O.map(h=>({value:h.libraryId,label:h.name})),emptyOption:o.noLibraryOption,onSelect:h=>{const Ne=h||void 0;ct({libraryId:Ne,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:o.layers.target,visible:Ee,value:fe,selectedLabel:We,disabled:!Ee,options:on.map(h=>({value:h,label:Ue[h]})),onSelect:h=>{const Ne=h;ct({libraryId:p,target:Ne,collectionId:I,revisionId:ee,revisionView:ae,infoId:Ne==="new_card"?c.infoId:void 0})}},{key:"info_mode",label:o.layers.target,visible:fe==="all_cards",value:xe,selectedLabel:xe==="create"?o.infoMode.create:xe==="selected"?($e==null?void 0:$e.label)??ge??t.cogita.library.list.selectedEmpty:o.infoMode.search,disabled:!Ee,options:[{value:"search",label:o.infoMode.search},{value:"create",label:o.infoMode.create},...c.infoId?[{value:"selected",label:($e==null?void 0:$e.label)??ge??t.cogita.library.list.selectedEmpty}]:[]],onSelect:h=>{if(h!=="selected"){if(h==="create"){ct({libraryId:p,target:"new_card",collectionId:I,revisionId:ee,revisionView:ae,infoId:void 0});return}ct({libraryId:p,target:"all_cards",collectionId:I,revisionId:ee,revisionView:ae,infoId:void 0,infoView:"overview"})}}},{key:"info_selected_action",label:o.layers.target,visible:fe==="all_cards"&&!!c.infoId,value:$==="new_card"&&c.infoId?"edit":c.infoView==="cards"?"cards":"overview",selectedLabel:$==="new_card"&&c.infoId?o.infoActions.edit:c.infoView==="cards"?o.infoActions.seeCards:o.infoActions.overview,disabled:!Ee||!c.infoId,options:[{value:"overview",label:o.infoActions.overview},{value:"edit",label:o.infoActions.edit},{value:"cards",label:o.infoActions.seeCards}],onSelect:h=>{if(c.infoId){if(h==="edit"){ct({libraryId:p,target:"new_card",collectionId:I,revisionId:ee,revisionView:ae,infoId:c.infoId});return}if(h==="cards"){ct({libraryId:p,target:"all_cards",collectionId:I,revisionId:ee,revisionView:ae,infoId:c.infoId,infoView:"cards"});return}ct({libraryId:p,target:"all_cards",collectionId:I,revisionId:ee,revisionView:ae,infoId:c.infoId,infoView:"overview"})}}},{key:"collection",label:o.layers.collection,visible:Tt,value:I??"",selectedLabel:(X==null?void 0:X.name)??o.path.noCollectionSelected,disabled:!Ee||Q||Y.length===0,options:Y.map(h=>({value:h.collectionId,label:h.name})),emptyOption:o.selectCollectionOption,onSelect:h=>{ct({libraryId:p,target:"all_collections",collectionId:h||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:o.layers.revision,visible:He,value:Ce,selectedLabel:Re,disabled:!I,options:V.map(h=>({value:h.value,label:h.label})),onSelect:h=>{it(h)}},{key:"revision_entry",label:o.layers.revision,visible:Je,value:ee??"",selectedLabel:(ve==null?void 0:ve.name)??o.status.noRevisions,disabled:!mt||ye||re.length===0,options:re.map(h=>({value:h.revisionId,label:h.name})),emptyOption:o.status.noRevisions,onSelect:h=>{ct({libraryId:p,target:"all_collections",collectionId:I,revisionId:h||void 0,revisionView:ae})}}],[V,Y,Q,xe,w,O,D,ct,re,ye,X,I,$e,ve,ee,ge,mt,Ee,M,p,Re,ae,$,Ce,fe,We,Tt,He,Je,Ue,t.cogita.library.list.selectedEmpty,c.infoId,c.infoView,o.infoActions.edit,o.infoActions.overview,o.infoActions.seeCards,o.layers.collection,o.layers.library,o.layers.revision,o.layers.target,o.noLibraryOption,o.path.noCollectionSelected,o.path.noLibrarySelected,o.selectCollectionOption]),at=a.useMemo(()=>It.filter(h=>h.visible),[It]),rt=a.useMemo(()=>at.filter(h=>h.key!=="library"&&h.key!=="collection"&&h.key!=="revision_entry"),[at]),Ft=a.useMemo(()=>rt.find(h=>h.key==="target")??null,[rt]),pt=a.useMemo(()=>rt.find(h=>h.key==="info_mode")??null,[rt]),Xe=a.useMemo(()=>rt.find(h=>h.key==="info_selected_action")??null,[rt]),ot=a.useMemo(()=>rt.find(h=>h.key==="collection_action")??null,[rt]),St=a.useCallback((h,Ne)=>h?e.jsx("div",{className:"cogita-sidebar-actions",children:h.options.map(ce=>e.jsx("button",{type:"button",className:`ghost ${String(h.value)===ce.value?"active":""}`,onClick:()=>h.onSelect(ce.value),disabled:h.disabled,children:ce.label},`${Ne}:${h.key}:${ce.value}`))}):null,[]),Pt=a.useMemo(()=>{const h=c.libraryId;if(!h||!k.pathname.startsWith("/cogita/library/"))return null;const Ne={copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,libraryId:h};if(c.target==="library_overview")return e.jsx(Wn,{...Ne});if(c.target==="all_cards")return e.jsx(Zn,{...Ne,mode:c.cardMode??"list"});if(c.target==="new_card")return e.jsx(ti,{...Ne,editInfoId:c.infoId});if(c.target==="dependencies")return e.jsx(si,{...Ne});if(c.target==="transfer")return e.jsx(ii,{...Ne});if(c.target==="storyboards"||c.target==="new_storyboard")return e.jsx(ri,{...Ne});if(c.target==="texts"||c.target==="new_text")return e.jsx(oi,{...Ne});if(c.target==="all_collections"){if(c.collectionId){const ce={...Ne,collectionId:c.collectionId};return c.revisionView==="graph"?e.jsx(Ai,{...ce}):c.revisionView==="shared"?e.jsx(ni,{...Ne,collectionId:c.collectionId}):c.revisionView==="settings"?e.jsx(bi,{...ce,revisionId:c.revisionId}):c.revisionView==="run"?e.jsx(Li,{...ce,revisionId:c.revisionId}):e.jsx(li,{...ce})}return e.jsx(Ms,{...Ne})}return c.target==="new_collection"?e.jsx(Ms,{...Ne}):null},[s,t,E,k.pathname,d,N,m,x,r,l,c.cardMode,c.collectionId,c.infoId,c.libraryId,c.revisionId,c.revisionView,c.target,y,n]);a.useEffect(()=>{let h=!1;return(async()=>{var ce,Fe,et,tt,oe;me(!0);try{await Mn();const[se,ft,$t]=await Promise.all([_s(),In(),Ln()]);if(h)return;ue(se);const Ot=new Set($t.nodes.filter(ut=>ut.nodeType==="role"&&ut.canLink).map(ut=>ut.roleId??"")),zt=zi(ft,Ot);if(qe(zt),zt){const ut=$t.nodes.find(bt=>bt.nodeType==="data"&&bt.roleId===zt&&(bt.fieldType===ns||bt.label===ns));le((ut==null?void 0:ut.dataKeyId)??null),Le.current=Ki(ut==null?void 0:ut.value)}const Rt=(ce=se.find(ut=>ut.libraryId===c.libraryId))==null?void 0:ce.libraryId,sa=Rt?(et=(Fe=Le.current.byLibrary)==null?void 0:Fe[Rt])==null?void 0:et.lastTarget:void 0,Ut=Pi(sa)?sa:"library_overview";U(Rt),G(c.target??Ut),te(c.revisionId??(Rt?(oe=(tt=Le.current.byLibrary)==null?void 0:tt[Rt])==null?void 0:oe.lastRevisionId:void 0)),Pe(c.revisionView??"detail"),_e.current=!0}catch{h||Ae(o.status.loadFailed)}finally{h||me(!1)}})(),()=>{h=!0}},[o.status.loadFailed]),a.useLayoutEffect(()=>{if(_e.current){if(!c.libraryId){U(void 0),G(c.target??"library_overview"),R(void 0),te(void 0),Pe("detail");return}c.libraryId&&O.some(h=>h.libraryId===c.libraryId)&&U(c.libraryId),c.target&&G(c.target),R(c.collectionId),te(c.revisionId),c.revisionView&&Pe(c.revisionView)}},[O,c.collectionId,c.libraryId,c.revisionId,c.revisionView,c.target]),a.useEffect(()=>{if(!p){W([]),R(void 0),g([]),z([]),te(void 0);return}let h=!1;return q(!0),wa({libraryId:p,limit:200}).then(Ne=>{var et;if(h)return;const ce=Ne.items;W(ce);const Fe=(et=ce.find(tt=>tt.collectionId===c.collectionId))==null?void 0:et.collectionId;R(Fe)}).catch(()=>{h||(W([]),R(void 0))}).finally(()=>{h||q(!1)}),()=>{h=!0}},[c.collectionId,p]),a.useEffect(()=>{if(!p||fe!=="all_cards"&&$!=="new_card"){g([]);return}let h=!1;return ds({libraryId:p,limit:200}).then(Ne=>{h||g(Ne)}).catch(()=>{h||g([])}),()=>{h=!0}},[fe,p,$]),a.useEffect(()=>{if(!p||!I){z([]),te(void 0);return}let h=!1;return Ie(!0),Ds({libraryId:p,collectionId:I}).then(Ne=>{var et,tt,oe,se;if(h)return;z(Ne);const ce=(tt=(et=Le.current.byLibrary)==null?void 0:et[p])==null?void 0:tt.lastRevisionId,Fe=((oe=Ne.find(ft=>ft.revisionId===c.revisionId))==null?void 0:oe.revisionId)??((se=Ne.find(ft=>ft.revisionId===ce))==null?void 0:se.revisionId);te(Fe)}).catch(()=>{h||(z([]),te(void 0))}).finally(()=>{h||Ie(!1)}),()=>{h=!0}},[c.revisionId,I,p]),a.useEffect(()=>{const h=c.infoId;if(!p||!h){S(void 0);return}let Ne=!1;return ua({libraryId:p,infoId:h}).then(ce=>{if(Ne)return;const Fe=ce.payload;S((Fe==null?void 0:Fe.label)??(Fe==null?void 0:Fe.name)??(Fe==null?void 0:Fe.title)??ce.infoId)}).catch(()=>{Ne||S(h)}),()=>{Ne=!0}},[c.infoId,p]),a.useEffect(()=>{if(!_e.current||c.libraryId&&O.some(Fe=>Fe.libraryId===c.libraryId)&&c.libraryId!==p||c.target&&c.target!==$||c.revisionView&&c.revisionView!==ae||c.revisionId&&c.revisionId!==ee||is[$].requiresCollection&&!I&&c.target==="all_collections"&&c.collectionId)return;const h=xa(`${k.pathname}${k.search}`);if(xa(k.pathname)==="/cogita"&&!c.libraryId&&!p){he.current=null;return}const ce=xa(Ls(p,$,I,ae,ee,c.infoId,c.infoView??"overview"));if(h===ce){he.current=null;return}he.current!==ce&&(he.current=ce,d(ce,{replace:!0}))},[O,k.pathname,k.search,d,c.collectionId,c.infoId,c.infoView,c.libraryId,c.revisionId,c.revisionView,c.target,I,p,ee,ae,$]),a.useEffect(()=>{if(typeof window>"u")return;const h=()=>{window.innerWidth>920&&v(!1)};return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]),a.useEffect(()=>{if(!_e.current||!H||!p||K.current)return;const h=Le.current,Ne={...h.byLibrary??{}},ce={...Ne[p]??{},lastCollectionId:I,lastRevisionId:ee,lastRevisionView:ae,lastTarget:$},Fe={version:1,lastLibraryId:p,byLibrary:{...Ne,[p]:ce}},et=JSON.stringify(h),tt=JSON.stringify(Fe);if(et===tt)return;Le.current=Fe,K.current=!0,(async()=>{try{if(Se)await $n(Se,{plainValue:tt});else{const se=await Rn(H,{itemName:ns,itemType:"data",plainValue:tt});le(se.dataItemId)}}catch{Ae(o.status.savePrefsFailed)}finally{K.current=!1}})()},[Se,H,I,p,ee,ae,$,o.status.savePrefsFailed]);const qt=async()=>{const h=Ke.trim();if(!h){Ae(t.cogita.user.libraryNameRequired);return}Ae(null);try{const Ne=await Fn({name:h});ue(ce=>[Ne,...ce]),U(Ne.libraryId),G("library_overview"),R(void 0),je("")}catch{Ae(t.cogita.user.libraryCreateFailed)}},gt=async()=>{if(!p){Ae(o.status.selectLibraryFirst);return}const h=Be.trim();if(!h){Ae(t.cogita.library.collections.saveRequiredName);return}Ae(null);try{const Ne=await En({libraryId:p,name:h,items:[]}),ce=await wa({libraryId:p,limit:200});W(ce.items),R(Ne.collectionId),te(void 0),G("all_collections"),Pe("detail"),Ze("")}catch{Ae(t.cogita.library.collections.saveFail)}},wt=async()=>{if(!p||!I){Ae(o.status.selectLibraryFirst);return}const h=Ye.trim();if(!h){Ae(o.revisionForm.nameLabel);return}Ae(null);try{const Ne=await An({libraryId:p,collectionId:I,name:h,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});z(ce=>[Ne,...ce]),te(Ne.revisionId),G("all_collections"),Pe("settings"),B("")}catch{Ae(o.status.loadFailed)}};return e.jsx(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${pe?"open":""}`,"aria-label":o.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(M==null?void 0:M.name)??o.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:M?o.sidebar.libraryActionsHint:o.status.selectLibraryFirst}),St(Ft,"sidebar")]}),pt?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:o.sidebar.infoActionsHint}),St(pt,"sidebar"),Xe?e.jsxs("div",{className:"cogita-sidebar-actions-nested",children:[e.jsx("p",{className:"cogita-sidebar-note",children:($e==null?void 0:$e.label)??ge??t.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:o.sidebar.selectedInfoActionsHint}),St(Xe,"sidebar")]}):null]}):null,X?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:X.name}),e.jsx("p",{className:"cogita-sidebar-note",children:o.sidebar.collectionActionsHint}),St(ot,"sidebar")]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:o.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:r,children:o.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{x("cogita"),v(!1)},children:o.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:l,children:y?t.account.secureModeDisable:t.account.secureModeEnable})]})]})]}),pe?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":o.sidebar.closeMenu,onClick:()=>v(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":o.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>v(h=>!h),"aria-label":pe?o.sidebar.closeMenu:o.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),at.map((h,Ne)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Ne>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,h.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":h.label,children:h.selectedLabel}):e.jsxs("select",{"aria-label":h.label,value:h.value,onChange:ce=>h.onSelect(ce.target.value),disabled:h.disabled,children:[h.emptyOption?e.jsx("option",{value:"",children:h.emptyOption}):null,h.options.map(ce=>e.jsx("option",{value:ce.value,children:ce.label},`${h.key}:${ce.value}`))]})]},`menu:${h.key}`))]}),Pt?e.jsxs(e.Fragment,{children:[$==="new_collection"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.library.actions.createCollection}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Be,onChange:h=>Ze(h.target.value),placeholder:t.cogita.library.collections.namePlaceholder,disabled:!p})]}),e.jsx("button",{type:"button",className:"cta",onClick:gt,disabled:!p,children:t.cogita.library.actions.createCollection}),be?e.jsx("p",{className:"cogita-form-error",children:be}):null]}):null,$==="all_collections"&&I&&ae==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:o.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:o.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:Ye,onChange:h=>B(h.target.value),placeholder:o.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:wt,children:o.revisionForm.createAction}),be?e.jsx("p",{className:"cogita-form-error",children:be}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Ws.Provider,{value:!0,children:Pt})})]}):null,Pt?null:e.jsx(e.Fragment,{children:p?null:e.jsxs("section",{className:"cogita-browser-intro",children:[e.jsx("div",{className:"cogita-browser-intro-main",children:e.jsxs("article",{className:"cogita-browser-panel cogita-browser-tutorial",children:[e.jsxs("div",{className:"cogita-browser-tutorial-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-browser-tutorial-step",children:Ge.step}),e.jsx("h2",{children:Ge.title})]}),e.jsxs("p",{children:[Qe+1," / ",st]})]}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-lead",children:Ge.lead}),e.jsx("div",{className:"cogita-browser-tutorial-passages",children:Ge.passages.map(h=>e.jsx("p",{children:h},h))}),e.jsx("div",{className:"cogita-browser-tutorial-focus",children:Ge.focus.map(h=>e.jsx("span",{children:h},h))}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-action",children:Ge.action}),e.jsx("div",{className:"cogita-browser-tutorial-progress",role:"list","aria-label":"Tutorial progress",children:ke.map((h,Ne)=>e.jsx("button",{type:"button",className:`ghost ${Ne===Qe?"active":""}`,onClick:()=>ze(Ne),"aria-label":`${Ne+1}`,children:Ne+1},`tutorial:${h.title}:${Ne}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:Qe===0,onClick:()=>ze(h=>Math.max(0,h-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"cta",disabled:Qe===st-1,onClick:()=>ze(h=>Math.min(st-1,h+1)),children:"Next"})]})]})}),e.jsxs("div",{className:"cogita-browser-intro-side",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.createLibraryTitle}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ke,onChange:h=>je(h.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:qt,children:t.cogita.user.createLibraryAction}),be?e.jsx("p",{className:"cogita-form-error",children:be}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.availableLibraries}),O.length===0?e.jsx("p",{className:"cogita-browser-note",children:t.cogita.user.noLibraries}):null,O.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:O.map(h=>e.jsxs("button",{type:"button",className:"cogita-card-item",onClick:()=>{ct({libraryId:h.libraryId,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.user.libraryRoleLabel}),e.jsx("h3",{className:"cogita-card-title",children:h.name})]},h.libraryId))}):null]})]})]})})]})]})})}const Ui=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Bi},Symbol.toStringTag,{value:"Module"}));function _i({copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,shareId:d}){const[k,c]=a.useState(null),[o,O]=a.useState("loading"),[ue,Y]=a.useState(t.cogita.library.collections.defaultName),[W,w]=a.useState("Cogita Library"),[g,re]=a.useState([]),[z,p]=a.useState([]),[U,$]=a.useState("idle"),[G,I]=a.useState({current:0,total:0}),[R,ee]=a.useState(0),[te,ae]=a.useState(""),[Pe,ge]=a.useState(null),[S,pe]=a.useState(null),[v,D]=a.useState(null),[me,Q]=a.useState(null),[q,ye]=a.useState([]),[Ie,be]=a.useState({}),[Ae,we]=a.useState({}),[ze,Ke]=a.useState(null),[je,Be]=a.useState(null),[Ze,Ye]=a.useState(null),[B,H]=a.useState(null),[qe,Se]=a.useState({}),le=a.useRef(0),[Le,_e]=a.useState(null),K=a.useRef(null),he=a.useRef(null),[M,X]=a.useState(null),[ve,L]=a.useState(!1),[V,fe]=a.useState(null),[Ce,xe]=a.useState([]),[$e,Ue]=a.useState(null),We=a.useRef(null),Re=a.useRef(null),[Ee,ke]=a.useState(null),[st,Qe]=a.useState(0),Ge=a.useRef(null),mt=a.useRef({}),[Tt,He]=a.useState(!1),[Je,ct]=a.useState({}),it=a.useRef(null),It=a.useRef(new Set),at=a.useRef({}),[rt,Ft]=a.useState([]),[pt,Xe]=a.useState(new Set),[ot,St]=a.useState(!1),Pt=cs(),qt=a.useMemo(()=>new URLSearchParams(Pt.search),[Pt.search]),gt=a.useMemo(()=>qt.get("key")??"",[qt]),wt=(k==null?void 0:k.mode)??"random",h=(k==null?void 0:k.check)??"exact",Ne=(k==null?void 0:k.limit)??20,ce=a.useMemo(()=>ms((k==null?void 0:k.revisionType)??wt),[k,wt]),Fe=a.useMemo(()=>{const T=k==null?void 0:k.revisionSettings,_=Xs(ce,qt);return Va(ce,T??_)},[k,qt,ce]),et=a.useMemo(()=>t.cogita.library.revision[ce.labelKey]??wt,[t,wt,ce]),tt=a.useMemo(()=>h==="exact"?t.cogita.library.revision.checkValue:h,[t,h]),se=o==="ready"?g[R]??null:null,ft=(se==null?void 0:se.checkType)==="translation-match"&&B,$t=a.useRef(new Map),Ot=a.useRef(new Map),zt=a.useRef(new Map),Rt=a.useRef(new Map),sa=a.useMemo(()=>se?se.cardType==="vocab"?t.cogita.library.revision.vocabLabel:se.infoType?Oe(t,se.infoType):t.cogita.library.revision.infoLabel:"",[t,se]),Ut=a.useMemo(()=>{var _;return ce.id!=="levels"?g.length:((_=Je.pool)==null?void 0:_.length)??ce.getFetchLimit(Ne,Fe)},[Je,Fe,ce,g.length,Ne]),ut=ce.getProgressTotal?ce.getProgressTotal(g,Je,Ne,Fe):ce.id==="levels"?Math.min(Ne,Ut):g.length,bt=ut?Math.min(R+1,ut):0,jt=Math.max(1,Number(Fe.tries??1)),Wt=Fe.compare??"anchors",ht=Math.max(0,Math.min(100,Number(Fe.minCorrectness??0))),nt=(Fe.considerDependencies??"on")==="on",Lt=Math.max(0,Math.min(100,Number(Fe.dependencyThreshold??85))),Yt=T=>{const _=T.slice();for(let i=_.length-1;i>0;i-=1){const u=Math.floor(Math.random()*(i+1));[_[i],_[u]]=[_[u],_[i]]}return _},Qt=T=>T.length?T.reduce((i,u)=>i+u,0)/T.length/255*100:0,na=T=>Qt(T)>=ht,Oa=async()=>{const T=await Dt(),_=new Map,i=new Map;T.forEach(f=>{const P=`${f.itemType}:${f.itemId}`,b=Bt(f.itemType,f.itemId,f.checkType,f.direction);_.has(P)||_.set(P,[]),_.get(P).push(f),i.has(b)||i.set(b,[]),i.get(b).push(f)});const u=new Map,j=new Map;return _.forEach((f,P)=>u.set(P,_t(f).score)),i.forEach((f,P)=>j.set(P,_t(f).score)),{itemKnowness:u,cardKnowness:j}},fa=async T=>{const _=Je,i=T.concat(_.active??[]).concat(_.pool??[]).filter((F,J,Z)=>Z.findIndex(de=>ie(de)===ie(F))===J);if(!nt){Xe(new Set(i.map(ie)));return}const{itemKnowness:u,cardKnowness:j}=await Oa(),f=F=>{if(F.cardType!=="info"||F.infoType!=="quote"||F.checkType!=="quote-fragment")return!0;const J=kt(F.direction);if(!(J!=null&&J.fragmentId))return!0;const Z=F.description??"";if(!Z.trim())return!0;const ne=ma(Z).nodes[J.fragmentId];if(!ne||!ne.leftId&&!ne.rightId)return!0;const Te=[ne.leftId,ne.rightId].filter(Ve=>!!Ve);if(Te.length===0)return!0;const Me=Te.map(Ve=>{const lt=Bt("info",F.cardId,"quote-fragment",ka(J.mode,Ve));return j.get(lt)??0});return Me.reduce((Ve,lt)=>Ve+lt,0)/Me.length>=Lt},P=(k==null?void 0:k.collectionId)??null,b=P?rt.filter(F=>dt(F.childItemType)==="collection"&&F.childItemId===P&&!dt(F.childCheckType)&&!dt(F.childDirection)):[],A=P&&i.length>0?i.reduce((F,J)=>F+(j.get(ie(J))??0),0)/i.length:0,C=new Set;for(const F of i){if(F.cardType!=="info"){C.add(ie(F));continue}if(!f(F))continue;const J=rt.filter(ne=>rn(ne,F)).concat(b);if(J.length===0){C.add(ie(F));continue}let Z=0;for(const ne of J)if(dt(ne.parentItemType)==="collection")Z+=ne.parentItemId===P?A:0;else if(dt(ne.parentCheckType)||dt(ne.parentDirection)){const Te=dt(ne.parentCheckType),Me=dt(ne.parentDirection),De=Bt(ne.parentItemType,ne.parentItemId,Te,Me);Z+=j.get(De)??0}else{const Te=`${ne.parentItemType}:${ne.parentItemId}`;Z+=u.get(Te)??0}Z/J.length>=Lt&&C.add(ie(F))}Xe(C)},Ua=T=>{for(let _=T;_<g.length;_+=1){const i=g[_];if(i&&(!nt||i.cardType!=="info"||pt.has(ie(i))))return _}return-1},ia=T=>!nt||T.cardType!=="info"||pt.has(ie(T)),Wa=T=>{if(ce.id!=="temporal"&&ce.id!=="levels")return null;const _=Je,i=(_.active??[]).concat(_.pool??[]),u=new Set;for(const j of i){const f=ie(j);if(!(u.has(f)||T.has(f))&&(u.add(f),ia(j)))return j}return null},Ct=a.useMemo(()=>{if(ce.id!=="levels")return null;const T=Je,_=T.pool??[],i=T.active??[],u=T.levelMap??{},j=Math.max(1,Number(Fe.levels??1)),f=Array.from({length:j},()=>0),P=new Set(i.map(F=>ie(F)));_.forEach(F=>{const J=Math.min(j,Math.max(1,u[ie(F)]??1));f[J-1]+=1});const b=_.length||1,A=f.map(F=>F/b*100),C=se?u[ie(se)]??1:null;return{counts:f,percentages:A,currentLevel:C,levelsCount:j,activeCount:i.length,poolCount:_.length,activeSet:P}},[Je,Fe,ce,se]),ra=a.useMemo(()=>{if(ce.id!=="temporal")return null;const T=Je,_=T.pool??[],i=T.active??[],u=T.knownessMap??{},j=new Set(T.unknownSet??[]);let f=0;_.forEach(A=>{(u[ie(A)]??0)>1&&(f+=1)});const P=j.size,b=i.map(A=>({id:ie(A),value:j.has(ie(A))?0:Math.max(0,Math.min(1,u[ie(A)]??0))}));return{knownCount:f,unknownCount:P,dots:b}},[Je,ce]),Et=a.useMemo(()=>{if(!nt)return 0;const T=Je;return g.concat(T.active??[]).concat(T.pool??[]).filter((i,u,j)=>j.findIndex(f=>ie(f)===ie(i))===u).filter(i=>i.cardType==="info"&&!pt.has(ie(i))).length},[nt,Je,g,pt]);a.useEffect(()=>{if(!nt||U!=="ready")return;const T=Je,i=g.concat(T.active??[]).concat(T.pool??[]).filter((f,P,b)=>b.findIndex(A=>ie(A)===ie(f))===P).filter(f=>f.cardType!=="info"||pt.has(ie(f))).length,u=We.current;if(We.current=i,u===null||i<=u)return;const j=i-u;Ue(`New card available (+${j})`),Re.current&&window.clearTimeout(Re.current),Re.current=window.setTimeout(()=>Ue(null),2200)},[nt,U,Je,g,pt]),a.useEffect(()=>()=>{Re.current&&window.clearTimeout(Re.current)},[]);const yt=(T,_)=>{const i=ce.applyOutcome({queue:g,meta:Je},se,Ne,Fe,{correct:T,correctness:_,createdUtc:new Date().toISOString()});re(i.queue),ct(i.meta);const u=i.queue[R+1];u&&Mt(u,R+1)};a.useEffect(()=>{if(!d){O("error");return}O("loading"),Pn({shareId:d,key:gt}).then(T=>{c(T),Y(T.collectionName),w(T.libraryName),O("ready")}).catch(()=>{O("error")})},[d,gt]),a.useEffect(()=>{d&&zn({shareId:d,key:gt,type:"language"}).then(T=>p(T)).catch(()=>p([]))},[d,gt]),a.useEffect(()=>{!d||o!=="ready"||Kn({shareId:d,key:gt}).then(T=>Ft(T.items??[])).catch(()=>Ft([]))},[d,gt,o]),a.useEffect(()=>{if(!d||o!=="ready")return;let T=!0;return(async()=>{$("loading"),I({current:0,total:ce.id==="levels"?0:ce.getFetchLimit(Ne,Fe)});try{const i=[];let u=null,j=null;do{const J=await Bn({shareId:d,key:gt,limit:300,cursor:u});if(i.push(...J.items),(ce.id==="levels"||ce.id==="temporal")&&J.total&&(j=J.total),I(Z=>({current:i.length,total:Z.total||J.total||ce.getFetchLimit(Ne,Fe)})),u=J.nextCursor??null,j!==null&&i.length>=j||ce.id!=="levels"&&ce.id!=="temporal"&&i.length>=ce.getFetchLimit(Ne,Fe))break}while(u);if(!T)return;const f=ls(i);let P;if(ce.id==="levels"){const J=Math.max(1,Number(Fe.levels??1));P={},f.forEach(Z=>{const de=ie(Z);P[de]=Math.max(1,Math.min(J,1))})}let b=null,A=null,C=null;if(ce.id==="temporal"){const J=await Dt(),Z=new Set(f.map(Te=>ie(Te))),de=J.reduce((Te,Me)=>{const De=Bt(Me.itemType,Me.itemId,Me.checkType,Me.direction);return Z.has(De)&&(Te[De]||(Te[De]=[]),Te[De].push(Me)),Te},{});b={},A=new Set,C={};const ne=Date.now();f.forEach(Te=>{const Me=ie(Te),De=de[Me]??[];if(De.length===0){b[Me]=0,A.add(Me),C[Me]=[];return}const Ve=us(De);C[Me]=Ve;const lt=Da(Ve,ne);b[Me]=lt.knowness})}const F=ce.id==="levels"?gs(f,Ne,Fe,P):ce.id==="temporal"?hs(f,Ne,Fe,b??{},A??new Set,C??{}):ce.prepare(f,Ne,Fe);re(F.queue),ct(F.meta),ee(0),$("ready"),I(J=>({current:Math.min(J.current,J.total),total:J.total}))}catch{T&&$("error")}})(),()=>{T=!1}},[d,gt,Ne,ce,Fe,o]),a.useEffect(()=>{fa(g)},[g,rt,nt,Lt,k==null?void 0:k.collectionId]),a.useEffect(()=>{if(!se||!nt){St(!1);return}if(se.cardType!=="info"||pt.has(ie(se))){St(!1);return}const T=Ua(R+1);if(T>=0){St(!1),ee(T);return}if(ce.id==="temporal"||ce.id==="levels"){const _=g.slice(0,R+1),i=g.slice(R+1).filter(ia),u=_.concat(i),j=new Set(u.map(ie)),f=Wa(j);if(f){const b=ie(f);j.has(b)||(u.push(f),j.add(b),ct(A=>{const C=A,F=new Set(C.queued??[]);return F.add(b),{...C,queued:F}}))}const P=u.findIndex((b,A)=>A!==R&&ia(b));if(P>=0){re(u),ee(P),St(!1);return}}St(!0)},[se,pt,nt,R,g,Je,ce.id]),a.useEffect(()=>{if(ae(""),ge(null),ke(null),Qe(0),ye([]),be({}),we({}),Ke(null),Be(null),Ye(null),L(!1),He(!1),X(null),H(null),Se({}),!se){pe(null),D(null);return}se.cardType==="info"&&se.infoType==="computed"&&pe(t.cogita.library.revision.loadingComputed);let T=!0;return Mt(se,R).then(_=>{!T||!_||(pe(_.prompt),D(_.expectedAnswer),ye(_.computedExpected),be(_.computedAnswers),Ke(_.answerTemplate),Be(_.outputVariables),Ye(_.variableValues))}),()=>{T=!1}},[se,d,t]),a.useEffect(()=>{if(!se||se.cardType!=="info"||se.infoType!=="quote"){it.current=null,It.current=new Set,Q(null);return}const T=se.description??"",_=(se.label??"").trim(),i=_.replace(/\s+/g," ").trim(),u=T.replace(/\s+/g," ").trim(),j=i&&i!==u?_:t.cogita.library.infoTypes.quote;if(!T){Q(null),D(null);return}const f=ma(T);it.current=f,pe(j);let P=!0;return Dt().then(b=>{if(!P)return;const A=getQuoteMode(se.direction),C=new Map;b.forEach(ne=>{if(ne.itemType!=="info"||ne.checkType!=="quote-fragment"||!ne.direction)return;const Te=kt(ne.direction);if(!Te||Te.mode!==A)return;const Me=`${ne.itemId}:${Te.fragmentId}`;C.has(Me)||C.set(Me,[]),C.get(Me).push(ne)});const F={},J=new Set;C.forEach((ne,Te)=>{const[Me,De]=Te.split(":",2);if(Me!==se.cardId)return;const Ve=_t(ne).score;F[De]=Ve,Ve>=Lt&&J.add(De)}),It.current=J,at.current=F;const Z=kt(se.direction);if(Z!=null&&Z.fragmentId&&f.nodes[Z.fragmentId]){Jt(f,Z.fragmentId,j);return}const de=ha(f,J,F,Lt,nt,se.direction);Jt(f,(de==null?void 0:de.id)??null,j)}).catch(()=>{It.current=new Set,at.current={};const b=kt(se.direction);if(b!=null&&b.fragmentId&&f.nodes[b.fragmentId]){Jt(f,b.fragmentId,j);return}const A=ha(f,It.current,{},Lt,nt,se.direction);Jt(f,(A==null?void 0:A.id)??null,j)}),()=>{P=!1}},[se,t,nt,Lt]),a.useEffect(()=>{if(!se||se.cardType!=="vocab"||se.checkType!=="translation-match"){H(null),Se({});return}const i=(Je.pool??Je.active??g).filter(b=>b.cardType==="vocab"&&b.checkType==="translation-match").filter((b,A,C)=>C.findIndex(F=>F.cardId===b.cardId)===A);i.some(b=>b.cardId===se.cardId)||i.unshift(se);const j=Yt(i).slice(0,6).map(b=>{const A=b.label.split("↔").map(J=>J.trim()).filter(Boolean);if(A.length<2)return null;const C=`${b.cardId}:L`,F=`${b.cardId}:R`;return{cardId:b.cardId,leftId:C,rightId:F,leftLabel:A[0],rightLabel:A[1]}}).filter(Boolean),f=j.map(b=>b.leftId),P=Yt(j.map(b=>b.rightId));H({pairs:j,leftOrder:f,rightOrder:P,selection:{},activeLeft:null,activeRight:null,locked:{}})},[se,g,Je]),a.useEffect(()=>()=>{K.current&&window.clearTimeout(K.current),he.current&&window.clearTimeout(he.current)},[]);const oa=a.useRef(null);a.useEffect(()=>{if(!se)return;const T=ie(se),_=typeof document<"u"?document.activeElement:null;if(oa.current===T&&_&&(_.tagName==="INPUT"||_.tagName==="TEXTAREA"))return;let i=0;const u=()=>{if(se){if(se.cardType==="info"&&se.infoType==="computed"){if(q.length>0){const f=Ba(ze,q,je),P=f?mt.current[f]:null;if(P&&(P.focus(),document.activeElement===P)){oa.current=T;return}}if(Ge.current&&(Ge.current.focus(),document.activeElement===Ge.current)){oa.current=T;return}}else if(se.cardType==="vocab"&&Ge.current&&(Ge.current.focus(),document.activeElement===Ge.current)){oa.current=T;return}i<6&&(i+=1,window.setTimeout(u,40))}},j=window.setTimeout(u,40);return()=>window.clearTimeout(j)},[se,q,ze,je]),a.useEffect(()=>{if(!Tt)return;const T=_=>{_.key==="Enter"&&(_.preventDefault(),la())};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[Tt]);const xt=T=>{xe(T),fe(_t(T))};a.useEffect(()=>{if(!se){fe(null),xe([]);return}const T=se.cardType==="info"?"info":"connection";if(se.cardType==="info"&&se.infoType==="quote"){Dt().then(_=>{const i=_.filter(u=>u.itemType==="info"&&u.itemId===se.cardId&&u.checkType==="quote-fragment"&&za(u.direction,se.direction));xt(i)}).catch(()=>{fe(null),xe([])});return}Fa(T,se.cardId,se.checkType,se.direction).then(_=>xt(_)).catch(()=>{fe(null),xe([])})},[se]);const Gt=(T,_,i,u)=>{if(T==="info"&&i==="quote-fragment"){Dt().then(j=>{const f=j.filter(P=>P.itemType==="info"&&P.itemId===_&&P.checkType==="quote-fragment"&&za(P.direction,u));xt(f)}).catch(()=>{fe(null),xe([])});return}Fa(T,_,i,u).then(j=>xt(j)).catch(()=>{fe(null),xe([])})},Xt=(T,_,i)=>{var P;const u=((P=i.pairs.find(b=>b.leftId===T))==null?void 0:P.rightId)??null;if(!u)return i;const j=u===_;Se(b=>({...b,[T]:j?"correct":"incorrect"})),K.current&&window.clearTimeout(K.current),he.current&&window.clearTimeout(he.current),le.current+=1;const f={kind:j?"correct":"incorrect",tick:le.current};if(_e(null),K.current=window.setTimeout(()=>_e(f),0),he.current=window.setTimeout(()=>_e(null),420),j){const b={...i.locked,[T]:!0};return Object.keys(b).length>=i.pairs.length?(ge("correct"),He(!0)):ge("correct"),{...i,selection:{...i.selection,[T]:_},activeLeft:null,activeRight:null,locked:b}}return ge("incorrect"),{...i,activeLeft:null,activeRight:null}},Ta=T=>{H(_=>!_||_.locked[T]?_:_.activeRight?Xt(T,_.activeRight,_):{..._,activeLeft:_.activeLeft===T?null:T})},Sa=T=>{H(_=>_&&(_.activeLeft?Xt(_.activeLeft,T,_):{..._,activeRight:_.activeRight===T?null:T}))},la=()=>{var T;if(se&&se.cardType==="info"&&se.infoType==="quote"&&it.current&&me&&!((T=kt(se.direction))!=null&&T.fragmentId)){const _=ha(it.current,It.current,at.current,Lt,nt,se.direction,me.fragmentId);if(_){ge(null),ae(""),L(!1),we({}),He(!1),ke(null),Qe(0),Jt(it.current,_.id,me.title);return}}ge(null),ae(""),L(!1),we({}),He(!1),ke(null),Qe(0),ee(_=>Math.min(_+1,g.length))},At=T=>{if(!se)return;const _=T.expected??null,i=T.answer??"";let u=_??"",j=i;if(!_&&T.expectedMap&&T.answerMap){const J=Object.keys(T.expectedMap).sort((Z,de)=>Z.localeCompare(de));u=J.map(Z=>{var de;return((de=T.expectedMap)==null?void 0:de[Z])??""}).join("|"),j=J.map(Z=>{var de;return((de=T.answerMap)==null?void 0:de[Z])??""}).join("|")}const f=u?ga(u,j,Wt):new Uint8Array,P={revisionType:ce.id,evalType:T.evalType,direction:T.direction,prompt:S??"",expected:_,answer:i,expectedAnswers:T.expectedMap??null,answers:T.answerMap??null,correct:T.correct,maskBase64:f.length?Ht(f):null,checkMode:h,compareMode:Wt,minCorrectness:ht},b=new TextEncoder().encode(JSON.stringify(P)),A=se.cardType==="info"?"info":"connection",C=T.overrideCheckType??se.checkType??null,F=T.overrideDirection??se.direction??null;Aa({itemType:A,itemId:se.cardId,checkType:C,direction:F,revisionType:ce.id,evalType:T.evalType,correct:T.correct,maskBase64:f.length?Ht(f):null,payloadBase64:Ht(b)}).then(()=>{Gt(A,se.cardId,C,F),fa(g)}).catch(()=>{})},ca=(T,_)=>{const i=$t.current.get(_);if(i)return Promise.resolve(i);const u=Ot.current.get(_);if(u)return u;const j=_n({shareCode:d,infoId:T,key:gt}).then(f=>{var J,Z;const P=f.payload,b=((J=P.definition)==null?void 0:J.graph)??null,A="",C=((Z=P.definition)==null?void 0:Z.answerTemplate)??"",F=Js(b,A,C);if(F){const ne={sample:Zs(F),answerTemplate:C||null};return $t.current.set(_,ne),ne}return ys({shareId:d,infoId:T,key:gt}).then(de=>{const ne={sample:de,answerTemplate:null};return $t.current.set(_,ne),ne})}).catch(()=>ys({shareId:d,infoId:T,key:gt}).then(f=>{const P={sample:f,answerTemplate:null};return $t.current.set(_,P),P}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Ot.current.delete(_)});return Ot.current.set(_,j),j},Mt=(T,_)=>{var b;const i=`${ie(T)}:${_}`,u=zt.current.get(i);if(u)return Promise.resolve(u);const j=Rt.current.get(i);if(j)return j;const f=A=>(zt.current.set(i,A),A);let P;if(T.cardType==="vocab"){if(T.checkType==="translation-match")return P=Promise.resolve(f({prompt:T.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),P;const A=T.label.split("↔").map(C=>C.trim()).filter(Boolean);if(A.length>=2){const F=(T.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",J=F?A[0]:A[1],Z=F?A[1]:A[0];P=Promise.resolve(f({prompt:J,expectedAnswer:Z,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else P=Promise.resolve(f({prompt:T.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(T.cardType==="info"&&T.infoType==="word"){const A=(b=T.description)!=null&&b.startsWith("Language: ")?T.description.replace("Language: ",""):null;P=Promise.resolve(f({prompt:T.label,expectedAnswer:A,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else T.cardType==="info"&&T.infoType==="computed"?P=ca(T.cardId,i).then(A=>{var de,ne;if(!A.sample)return f({prompt:T.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const C=A.sample,F=C.expectedAnswers?Object.entries(C.expectedAnswers).map(([Te,Me])=>({key:Te,expected:Me})):[],J=F.reduce((Te,Me)=>(Te[Me.key]="",Te),{}),Z=C.expectedAnswerIsSentence&&((de=C.expectedAnswer)==null?void 0:de.trim())||null;return f({prompt:C.prompt,expectedAnswer:F.length>0?Z:((ne=C.expectedAnswer)==null?void 0:ne.trim())||null,computedExpected:F,computedAnswers:J,answerTemplate:A.answerTemplate,outputVariables:C.outputVariables??null,variableValues:C.variableValues??null})}).catch(()=>f({prompt:T.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Rt.current.delete(i)}):P=Promise.resolve(f({prompt:T.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return Rt.current.set(i,P),P},Jt=(T,_,i)=>{const u=Object.keys(T.nodes).length,j=It.current.size;if(!_){Q({title:i,before:T.text,after:"",fragmentId:null,total:u,completed:j}),D(null),He(!0);return}const f=T.nodes[_];if(!f)return;const P=Hs(T.text,f);Q({title:i,before:P.before,after:P.after,fragmentId:f.id,total:u,completed:j}),D(P.fragment),He(!1)},ba=()=>{const T=it.current;T&&Q(_=>_&&{..._,total:Object.keys(T.nodes).length,completed:It.current.size})},Kt=()=>{const T=g[R+1];T&&Mt(T,R+1)},Ca=()=>{if(Kt(),se&&se.cardType==="vocab"&&se.checkType==="translation-match"&&B){if(B.pairs.length===0){ge("incorrect"),He(!0);return}const f=B.pairs.reduce((Z,de)=>(Z[de.rightId]=de.rightLabel,Z),{});let P=0;const b={};B.pairs.forEach(Z=>{const ne=B.selection[Z.leftId]===Z.rightId;b[Z.leftId]=ne?"correct":"incorrect",ne&&(P+=1)});const A=B.pairs.length||1,C=P/A,F=P===B.pairs.length;Se(Z=>({...Z,...b})),F?(ge("correct"),He(!0),Qe(0)):(ge("incorrect"),He(!1),Qe(Z=>{const de=Z+1;return de>=jt&&(L(!0),He(!0),H(ne=>{if(!ne)return ne;const Te=ne.pairs.reduce((Me,De)=>(Me[De.leftId]=De.rightId,Me),{});return{...ne,selection:Te}})),de})),yt(F,C);const J="connection";Promise.all(B.pairs.map(Z=>{const de=B.selection[Z.leftId]??null,ne=de?f[de]:"",Te={left:Z.leftLabel,expected:Z.rightLabel,answer:ne,checkType:"translation-match"},Me=new TextEncoder().encode(JSON.stringify(Te));return Aa({itemType:J,itemId:Z.cardId,checkType:"translation-match",direction:null,revisionType:ce.id,evalType:"translation-match",correct:de===Z.rightId,maskBase64:null,payloadBase64:Ht(Me)})})).then(()=>{Gt(J,se.cardId,se.checkType,se.direction),fa(g)}).catch(()=>{});return}if(q.length>0){const f=q.reduce((b,A)=>{const C=Ie[A.key]??"";return b[A.key]=vt(C)===vt(A.expected)?"correct":"incorrect",b},{});q.every(({key:b,expected:A})=>{const C=Ie[b]??"";return h==="exact"&&vt(C)===vt(A)})?(ge("correct"),we(f),He(!0),Qe(0),yt(!0,1),At({correct:!0,direction:S?`${S} -> computed`:"computed",expectedMap:q.reduce((b,A)=>(b[A.key]=A.expected,b),{}),answerMap:Ie,evalType:"computed"})):(ge("incorrect"),we(f),He(!1),Qe(b=>{const A=b+1;return A>=jt&&Zt&&(L(!0),He(!0)),A}),yt(!1,0),window.setTimeout(()=>{var A;const b=Ba(ze,q,je);b&&mt.current[b]&&((A=mt.current[b])==null||A.focus())},40),At({correct:!1,direction:S?`${S} -> computed`:"computed",expectedMap:q.reduce((b,A)=>(b[A.key]=A.expected,b),{}),answerMap:Ie,evalType:"computed"}));return}if(se&&se.cardType==="info"&&se.infoType==="quote"&&(me!=null&&me.fragmentId)){if(!v)return;const f=kt(se.direction),P=(f==null?void 0:f.mode)??getQuoteMode(se.direction),b=f!=null&&f.fragmentId&&se.direction?se.direction:ka(P,me.fragmentId),A=nn(v,te,Wt),C=h==="exact"&&pa(te)===pa(v),F=na(A),J=C||F,Z=Qt(A);J?(at.current[me.fragmentId]=Math.max(at.current[me.fragmentId]??0,Z),(at.current[me.fragmentId]??0)>=Lt&&It.current.add(me.fragmentId),ba(),ge("correct"),we({}),He(!0),ke(A),Qe(0),Z<100&&jt<=1&&L(!0),yt(!0,Z/100),At({correct:!0,direction:`quote:${me.fragmentId}`,expected:v,answer:te,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:b})):(ge("incorrect"),we({}),He(!1),ke(A),Qe(de=>{const ne=de+1;return ne>=jt&&Zt&&(L(!0),He(!0)),ne}),yt(!1,Z/100),window.setTimeout(()=>{var de;return(de=Ge.current)==null?void 0:de.focus()},40),At({correct:!1,direction:`quote:${me.fragmentId}`,expected:v,answer:te,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:b}));return}if(!v)return;const T=ga(v,te,Wt),_=h==="exact"&&vt(te)===vt(v),i=na(T),u=_||i,j=Qt(T);u?(ge("correct"),we({}),He(!0),ke(T),Qe(0),j<100&&jt<=1&&L(!0),yt(!0,j/100),At({correct:!0,direction:S?`${S} -> ${v}`:null,expected:v,answer:te,evalType:"text"})):(ge("incorrect"),we({}),He(!1),ke(T),Qe(f=>{const P=f+1;return P>=jt&&Zt&&(L(!0),He(!0)),P}),yt(!1,j/100),window.setTimeout(()=>{var f;return(f=Ge.current)==null?void 0:f.focus()},40),At({correct:!1,direction:S?`${S} -> ${v}`:null,expected:v,answer:te,evalType:"text"}))},da=T=>{if(Kt(),!v)return;const _=ga(v,T,Wt),i=vt(T)===vt(v),u=na(_),j=i||u,f=Qt(_);j?(ge("correct"),we({}),He(!0),ke(_),Qe(0),f<100&&jt<=1&&L(!0),yt(!0,f/100),At({correct:!0,direction:"word->language",expected:v,answer:T,evalType:"language-select"})):(ge("incorrect"),we({}),He(!1),ke(_),Qe(P=>{const b=P+1;return b>=jt&&Zt&&(L(!0),He(!0)),b}),yt(!1,f/100),At({correct:!1,direction:"word->language",expected:v,answer:T,evalType:"language-select"}))},Ma=T=>{var i;if(T.key!=="Enter")return;if(T.preventDefault(),T.stopPropagation(),Tt){la();return}const _=q.find(u=>!(Ie[u.key]??"").trim());if(_){(i=mt.current[_.key])==null||i.focus();return}Ca()},Qa=()=>{Kt(),ge("correct"),He(!0),Qe(0),yt(!0,1),v&&At({correct:!0,direction:"manual",expected:v,answer:te,evalType:"manual"})},Ha=()=>{if(yt(!1,0),se&&se.cardType==="info"&&se.infoType==="quote"){ge(null),ae(""),L(!1),we({}),He(!1),ke(null),Qe(0),ee(T=>Math.min(T+1,g.length));return}la()};a.useEffect(()=>{Kt()},[R,g]);const Ya=t.cogita.library.revision.revealModeAfterIncorrect,Zt=q.length>0||!!v;return e.jsxs(Nt,{copy:t,authLabel:s,showProfileMenu:n,onProfileNavigate:r,onToggleSecureMode:l,onLogout:m,secureMode:y,onNavigate:x,language:E,onLanguageChange:N,children:[(o==="loading"||U==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:o==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${G.total?Math.min(100,Math.max(0,G.current/G.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:G.total?`${Math.min(G.current,G.total)} / ${G.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:ue}),e.jsx("p",{className:"cogita-library-subtitle",children:W}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",et).replace("{check}",tt)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:V?`${V.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ct?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Ct.currentLevel??"-"," / ",Ct.levelsCount]}):null,V?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(V.correct)).replace("{total}",String(V.total))}),V.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(V.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(tn,{outcomes:Ce})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[$e?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:$e})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Le?`${Le.kind}-${Le.tick}`:ft?"idle":Pe??"idle",children:o!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:o==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}):se?e.jsx(e.Fragment,{children:ot?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(en,{copy:t,currentCard:se,currentTypeLabel:sa,prompt:S,languages:z,answer:te,onAnswerChange:T=>ae(_=>Ka(_,T,M)),computedExpected:q,computedAnswers:Ie,onComputedAnswerChange:(T,_)=>be(i=>({...i,[T]:Ka(i[T]??"",_,M)})),answerTemplate:ze,outputVariables:je,variableValues:Ze,computedFieldFeedback:Ae,feedback:Pe,canAdvance:Tt,quoteContext:me,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ca,onSkip:Ha,onLanguageSelect:da,onMarkReviewed:Qa,onAdvance:la,showCorrectAnswer:ve,setShowCorrectAnswer:L,onRevealCorrect:()=>He(!0),answerMask:Ee,expectedAnswer:v,hasExpectedAnswer:Zt,handleComputedKeyDown:Ma,answerInputRef:Ge,computedInputRefs:mt,scriptMode:M,setScriptMode:X,matchPairs:B==null?void 0:B.pairs,matchLeftOrder:B==null?void 0:B.leftOrder,matchRightOrder:B==null?void 0:B.rightOrder,matchSelection:B==null?void 0:B.selection,matchActiveLeft:B==null?void 0:B.activeLeft,matchActiveRight:B==null?void 0:B.activeRight,matchFeedback:qe,onMatchLeftSelect:Ta,onMatchRightSelect:Sa})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ut?`${bt} / ${ut}`:t.cogita.library.revision.progressUnlimited}),o==="error"&&e.jsx("p",{children:t.cogita.library.revision.shareInvalid}),o==="loading"&&e.jsx("p",{children:t.cogita.library.revision.shareLoading}),o==="ready"&&U==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),o==="ready"&&U==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),o==="ready"&&U==="ready"&&g.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Ya}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",jt]})]})]}),Ct?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Ct.activeCount," / ",Ct.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ct.counts.map((T,_)=>{const i=_+1,u=Ct.currentLevel===i,j=Ct.percentages[_]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":u,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:i}),e.jsx("strong",{children:T})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,j))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[j.toFixed(1),"%"]})]},`level-${i}`)})})]}):null,ra?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ra.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ra.dots.map(T=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-T.value))}, ${Math.round(200*T.value)}, 80, 0.9)`}},T.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ra.knownCount})]})]}):null,nt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Et})]})}):null]})]})]})})})]})]})}const Wi=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:_i},Symbol.toStringTag,{value:"Module"}));export{Oi as C,Ui as a,Wi as b};
