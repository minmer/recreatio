import{r as i,j as e,R as Ut,B as Wt,C as zt,H as Cr,P as Mr,a as jt,b as si,c as ci,u as yr,d as vr,e as jr,f as di}from"./vendor-DrCXrCXJ.js";import{L as Or,A as Vr,g as qr,a as ui,c as gi,e as hi,i as bi,b as mi,s as _r,d as Xa,f as Sr,h as mr,j as $t,k as pr,l as pi,m as ir,n as Za,u as fi,o as da,p as xi,q as yi,r as vi,t as Ur,v as Wr,w as Rt,x as zr,y as Hr,z as Ht,B as Et,C as ji,D as ki,E as wi,F as Ti,G as Ni,H as Li,I as Ci,J as _a,K as Mi,M as Si,N as Ii,O as Pi,P as $i,Q as Ri,R as Ei,S as Fi,T as Ai,U as Bi,V as Di,W as Ki,X as Oi,Y as Vi,Z as qi,_ as Ir}from"./recreatio-core-DRYZWQ3t.js";import"./vendor-cogita-ui-DLgJCpO3.js";const vt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},yt={moveMs:900,pauseMs:220,errorMs:900},_i=(a=11)=>{let n=a;const s=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:h,height:g,paddingX:k,paddingY:f,levels:P}=vt,A=(g-f*2)/(P.length-1),K=[],l=[],S=[];P.forEach((b,p)=>{const ae=g-f-p*A,B=h-k*2,j=[];for(let Y=0;Y<b;Y+=1){const $=k+(Y+1)*B/(b+1),oe=(s()-.5)*18,D=Math.max(k,Math.min(h-k,$+oe)),O=p===0?3:p<2?2.1:1.4,be=p===0?"root":`l${p}-${Y}`;j.push({id:be,x:p===0?h/2:D,y:ae,r:O,level:p,role:p===0?"root":void 0})}S.push(j),K.push(...j)});const m=S[S.length-1];if(m!=null&&m.length){const b=m[Math.floor(m.length/2)];b.role="goal",b.r=2}for(let b=1;b<S.length;b+=1){const p=S[b-1];S[b].forEach(B=>{const j=[...p].sort((D,O)=>Math.abs(D.x-B.x)-Math.abs(O.x-B.x)),Y=j[0],$=j[1]&&s()<.45?j[1]:null;($?[Y,$]:[Y]).forEach(D=>{l.push({from:D.id,to:B.id,key:`${D.id}-${B.id}`})}),s()<.2&&j[2]&&l.push({from:j[2].id,to:B.id,key:`${j[2].id}-${B.id}`})})}const y=new Map;l.forEach(b=>{const p=y.get(b.to)??[];p.push(b.from),y.set(b.to,p)});const _=new Map,G=new Map,U=new Map;l.forEach(b=>{const p=_.get(b.from)??[];p.push(b.key),_.set(b.from,p);const ae=G.get(b.from)??[];ae.push(b.to),G.set(b.from,ae);const B=U.get(b.from)??[];B.push(b.to),U.set(b.from,B);const j=U.get(b.to)??[];j.push(b.from),U.set(b.to,j)});const d=new Map;return K.forEach(b=>{d.set(b.id,b)}),{nodes:K,links:l,parentsById:y,linksByFrom:_,childrenByFrom:G,neighborsById:U,nodesById:d}};function Ui({slides:a,activeIndex:n,introOpen:s,prefersReducedMotion:h,onNext:g,onPrev:k,onSelect:f,onExit:P,onOpen:A,onRegister:K}){const l=n===a.length-1,S=s&&n===0?"entry":"docked",m=a[a.length-1],[y,_]=i.useState(!1),G=i.useMemo(()=>Array.from({length:20},(v,T)=>({src:`/cogita/logo/Cogita${String(T).padStart(2,"0")}.png`,kind:T<=11?"bubble":T<=17?"text":"recreatio"})),[]),U=s&&n===0;i.useEffect(()=>{if(!s){_(!1);return}n>0&&!y&&_(!0)},[n,s,y]);const d=i.useRef(0),b=i.useRef(null),p=i.useMemo(()=>{const v={x:40,y:160},T={x:260,y:48},Q=6,t=T.x-v.x,r=v.y-T.y,u=t/Q,N=[.3,.45,.6,.65,1.4,2.2],V=N.reduce((se,ve)=>se+ve,0),te=N.map(se=>r*se/V),re=[v];let ne=v.x,ue=v.y;for(let se=1;se<=Q;se+=1){const ve=(Math.random()-.5)*14,Ze=(Math.random()-.5)*28;ne=Math.max(v.x+se*14,Math.min(T.x-(Q-se)*14,ne+u+ve));const Je=te[se-1]??te[te.length-1];ue=ue-Je+Ze;const ta=Math.max(T.y,Math.min(v.y-4,ue));re.push({x:Math.round(ne),y:Math.round(ta)})}return re[re.length-1]=T,re},[]),ae=i.useMemo(()=>{const r=(V,te,re)=>Math.min(re,Math.max(te,V)),u=p.map(V=>{const te=10+Math.random()*36;return{x:r(V.x,40,260),y:r(V.y-te,40,140)}}),N=p.map((V,te)=>{var ue;const re=12+Math.random()*40,ne=((ue=u[te])==null?void 0:ue.y)??V.y;return{x:r(V.x,40,260),y:r(Math.max(ne+10,V.y+re),60,170)}});return{upper:u,lower:N}},[p]),B=i.useMemo(()=>{var T;const v=((T=p[4])==null?void 0:T.x)??260;return Math.max(0,Math.min(240,v-40))},[p]),j=i.useMemo(()=>{var te,re;const v=(ne,ue,se)=>Math.min(se,Math.max(ue,ne)),T=(ne,ue,se)=>p.map((ve,Ze)=>{var Ae,Ie;const Je=((Ae=ae.upper[Ze])==null?void 0:Ae.y)??ve.y,ta=((Ie=ae.lower[Ze])==null?void 0:Ie.y)??ve.y,_e=(Math.random()-.5)*70,Ye=ve.y+ne+_e,Ue=v(ve.y+ue,Je+6,ta-6),E=v(ve.y+se,Je+6,ta-6);return{x:ve.x,y:v(Ye,Math.min(Ue,E),Math.max(Ue,E))}}),Q=-14+Math.random()*28,t=14+Math.random()*28,r=T(Q,-80,12),u=T(t,-12,80);for(let ne=4;ne<p.length;ne+=1){const ue=p[ne],se=((te=ae.upper[ne])==null?void 0:te.y)??ue.y,ve=((re=ae.lower[ne])==null?void 0:re.y)??ue.y;r[ne]={x:ue.x,y:v(ue.y-12,se+6,ve-6)},u[ne]={x:ue.x,y:v(ue.y+12,se+6,ve-6)}}const N=ae.upper.length?ae.upper[ae.upper.length-1].y:40,V=ae.lower.length?ae.lower[ae.lower.length-1].y:170;return r[r.length-1]={x:p[p.length-1].x,y:v(p[p.length-1].y-14,N,V)},u[u.length-1]={x:p[p.length-1].x,y:v(p[p.length-1].y+12,N,V)},{higher:r,lower:u}},[p,ae]),Y=1e4,$=i.useMemo(()=>{let v=17;const T=()=>(v=(v*1664525+1013904223)%4294967296,v/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const u=(T()-.5)*240,N=(T()-.5)*180,V=(T()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${u.toFixed(0)}px`,y:`${N.toFixed(0)}px`,rot:`${V.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),oe=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[D,O]=i.useState([]),be=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),ke=i.useMemo(()=>{const T=[],t=(u,N)=>u+Math.random()*(N-u);for(let u=0;u<6;u+=1){let N=!1;for(let V=0;V<80;V+=1){const te=t(14,86),re=t(10,34);if(T.every(ue=>{const se=ue.x-te,ve=ue.y-re;return Math.hypot(se,ve)>=12})){T.push({x:te,y:re}),N=!0;break}}N||T.push({x:t(16,84),y:t(12,32)})}return T.map((u,N)=>({id:`p${N+1}`,x:`${u.x.toFixed(1)}%`,y:`${u.y.toFixed(1)}%`,xNum:u.x,yNum:u.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ce,q]=i.useState(0),[ge,o]=i.useState(0),[ee,w]=i.useState([]),M=1e4,ye=i.useMemo(()=>{if(ke.length<2)return[];const v=N=>{let V=N+1831565813;return V=Math.imul(V^V>>>15,V|1),V^=V+Math.imul(V^V>>>7,V|61),((V^V>>>14)>>>0)/4294967296},T=(N,V)=>Math.floor(v(N)*V),Q=new Set,t=[],r=Math.min(3,ke.length);let u=0;for(;t.length<r&&u<30;){u+=1;const N=T(ce*13+u*5,ke.length),V=T(ce*29+u*7,ke.length);if(N===V)continue;const te=N<V?`${N}-${V}`:`${V}-${N}`;Q.has(te)||(Q.add(te),t.push({id:`link-${te}`,from:ke[N],to:ke[V],delay:`${(u*.35).toFixed(2)}s`}))}return t},[ce,ke]);i.useEffect(()=>{if(!s||n!==2)return;const v=()=>{const Q=$.map(t=>t.id);for(let t=Q.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[Q[t],Q[r]]=[Q[r],Q[t]]}return Q.slice(0,4)};O(v());const T=window.setInterval(()=>{O(v())},Y);return()=>window.clearInterval(T)},[n,s,$,Y]),i.useEffect(()=>{if(!s||n!==3)return;const v=()=>{o(Math.floor(Math.random()*be.length)),w(ke.map(()=>Math.random()<.6?"good":"bad")),q(Q=>Q+1)};v();const T=window.setInterval(v,M);return()=>window.clearInterval(T)},[n,s,be.length,ke,M]);const ie=i.useMemo(()=>_i(11),[]),[le,we]=i.useState(new Set(["root"])),[Le,Ne]=i.useState(new Set),[De,Me]=i.useState(new Set),[Qe,Oe]=i.useState({fromId:"root",toId:"root",key:0}),Fe=i.useRef(le),ze=i.useRef("root"),oa=i.useRef(0),Re=i.useRef(null),W=i.useRef(null),X=i.useRef([]);i.useEffect(()=>{Fe.current=le},[le]);const Ke=i.useMemo(()=>{const v=new Set;return le.forEach(T=>{const Q=ie.linksByFrom.get(T);Q&&Q.forEach(t=>v.add(t))}),v},[le,ie]),Ce=ie.nodesById.get(Qe.toId)??ie.nodesById.get("root"),pe=Ce?`${Ce.x/vt.width*100}%`:"50%",Pe=Ce?`${Ce.y/vt.height*100}%`:"90%";i.useEffect(()=>{if(!s||n!==1||h)return;(()=>{we(new Set(["root"])),Ne(new Set),Me(new Set),Oe({fromId:"root",toId:"root",key:0}),W.current=null,oa.current=0,ze.current="root",X.current=[]})();const T=()=>{const t=ze.current,r=Fe.current,N=(ie.childrenByFrom.get(t)??[]).filter(ve=>!r.has(ve));if(N.length)return N[Math.floor(Math.random()*N.length)];if(r.size>=ie.nodes.length){const ve=ie.neighborsById.get(t)??[];return ve.length?ve[Math.floor(Math.random()*ve.length)]:null}const V=ve=>(ie.childrenByFrom.get(ve)??[]).some(Je=>!r.has(Je)),te=[t],re=new Set([t]),ne=new Map;let ue=null;for(;te.length;){const ve=te.shift();if(!ve)break;if(ve!==t&&V(ve)){ue=ve;break}(ie.neighborsById.get(ve)??[]).forEach(Je=>{re.has(Je)||(re.add(Je),ne.set(Je,ve),te.push(Je))})}if(!ue)return null;let se=ue;for(;ne.get(se)&&ne.get(se)!==t;)se=ne.get(se)??se;return se},Q=(t,r)=>{if(t===r){const u=T();u&&Q(t,u);return}oa.current+=1,Oe({fromId:t,toId:r,key:oa.current}),ze.current=r,Re.current=window.setTimeout(()=>{const u=ie.parentsById.get(r)??[],N=Fe.current,V=u.filter(ue=>!N.has(ue));if(!V.length){const ue=new Set(N);ue.add(r),we(ue),Re.current=window.setTimeout(()=>{for(;X.current.length;){const ve=X.current[X.current.length-1];if(!ue.has(ve)){if(ve!==r){Q(r,ve);return}break}X.current.pop()}const se=T();se&&Q(r,se)},yt.pauseMs);return}const te=new Set([r,...V]),re=new Set(V.map(ue=>`${ue}-${r}`));Ne(te),Me(re),X.current.includes(r)||X.current.push(r);const ne=V[Math.floor(Math.random()*V.length)];W.current={fromId:r,toId:ne},Re.current=window.setTimeout(()=>{Ne(new Set),Me(new Set);const ue=W.current;ue&&Q(ue.fromId,ue.toId)},yt.errorMs)},yt.moveMs)};return Re.current=window.setTimeout(()=>{const t=T();t&&Q(ze.current,t)},yt.pauseMs),()=>{Re.current&&window.clearTimeout(Re.current)}},[n,s,ie,h]);const Ve=v=>{if(!s)return;const T=Date.now();T-d.current<520||Math.abs(v.deltaY)<10||(d.current=T,v.deltaY>0?g():k(),v.preventDefault())},qe=v=>{if(!s)return;const T=v.touches[0];T&&(b.current={x:T.clientX,y:T.clientY})},Be=v=>{if(!s)return;const T=b.current;if(b.current=null,!T)return;const Q=v.changedTouches[0];if(!Q)return;const t=Q.clientX-T.x,r=Q.clientY-T.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?g():k())};return e.jsxs("div",{className:`cogita-intro ${s?"is-open":"is-closed"} ${h?"is-reduced":""} ${l?"is-final":""}`,"data-slide":n+1,onWheel:Ve,onTouchStart:qe,onTouchEnd:Be,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":S,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${U&&!y?"is-entry":""}`,children:G.map((v,T)=>e.jsx("img",{src:v.src,alt:"",className:`cogita-logo-layer ${T===0?"is-base":""} ${v.kind==="text"?"is-text":v.kind==="recreatio"?"is-recreatio":""} ${v.kind==="bubble"?"is-bubble":""}`},v.src))})}),s&&a.map((v,T)=>{const Q=T===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${T+1} ${Q?"is-active":""}`,"aria-hidden":!Q,children:[e.jsxs("div",{className:"cogita-intro-text",children:[v.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:v.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:v.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:v.title}),v.body&&e.jsx("p",{children:v.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),v.micro&&e.jsx("p",{className:"cogita-intro-micro",children:v.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:l?K:g,children:v.cta}),l&&v.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>f(0),children:v.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[T===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${vt.width} ${vt.height}`,preserveAspectRatio:"none",children:[ie.links.map(t=>{const r=ie.nodesById.get(t.from),u=ie.nodesById.get(t.to);if(!r||!u)return null;const N=Ke.has(t.key),V=De.has(t.key);return e.jsx("line",{className:`map-link ${N?"is-active":""} ${V?"is-error":""}`,x1:r.x,y1:r.y,x2:u.x,y2:u.y},t.key)}),ie.nodes.map(t=>{const r=le.has(t.id),u=Le.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${u?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Ce&&e.jsx("span",{className:"map-explorer-dot",style:{left:pe,top:Pe,"--move":`${yt.moveMs}ms`}})]}),T===2&&e.jsx("div",{className:"cogita-index-cards",children:$.map(t=>{const r=D.indexOf(t.id),u=r>=0?oe[r]:null,N=(u==null?void 0:u.x)??"140px",V=(u==null?void 0:u.y)??"140px",te=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":N,"--stack-y":V,"--stack-opacity":te,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),T===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[be.map((t,r)=>e.jsxs("div",{className:`round-card ${r===ge?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),be[ge]&&e.jsx("span",{className:"round-ring",style:{"--card-x":be[ge].x,"--card-y":`calc(${be[ge].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:ke.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:ye.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:ke.map((t,r)=>{const u=ee[r]??"good",N=be[ge];if(!N)return null;const V=`calc(${N.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":N.x,"--to-y":V,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${u}`,style:{"--from-x":N.x,"--from-y":V,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${u}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${ce}`)})})]},`round-${ce}`),T===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${p[0].x} ${p[0].y} L${p[1].x} ${p[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${p[1].x} ${p[1].y} L${p[2].x} ${p[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${p[2].x} ${p[2].y} L${p[3].x} ${p[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${p[3].x} ${p[3].y} L${p[4].x} ${p[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${p[4].x} ${p[4].y} L${p[5].x} ${p[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${p[5].x} ${p[5].y} L${p[6].x} ${p[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${B};${B};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${ae.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${ae.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${ae.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${ae.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[j.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${j.higher[r+1].x} ${j.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),j.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${j.lower[r+1].x} ${j.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${p[0].x/300*100}%`,"--p0y":`${p[0].y/200*100}%`,"--p1x":`${p[1].x/300*100}%`,"--p1y":`${p[1].y/200*100}%`,"--p2x":`${p[2].x/300*100}%`,"--p2y":`${p[2].y/200*100}%`,"--p3x":`${p[3].x/300*100}%`,"--p3y":`${p[3].y/200*100}%`,"--p4x":`${p[4].x/300*100}%`,"--p4y":`${p[4].y/200*100}%`,"--p5x":`${p[5].x/300*100}%`,"--p5y":`${p[5].y/200*100}%`,"--p6x":`${p[6].x/300*100}%`,"--p6y":`${p[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${j.higher[0].x/300*100}%`,"--q0y":`${j.higher[0].y/200*100}%`,"--q1x":`${j.higher[1].x/300*100}%`,"--q1y":`${j.higher[1].y/200*100}%`,"--q2x":`${j.higher[2].x/300*100}%`,"--q2y":`${j.higher[2].y/200*100}%`,"--q3x":`${j.higher[3].x/300*100}%`,"--q3y":`${j.higher[3].y/200*100}%`,"--q4x":`${j.higher[4].x/300*100}%`,"--q4y":`${j.higher[4].y/200*100}%`,"--q5x":`${j.higher[5].x/300*100}%`,"--q5y":`${j.higher[5].y/200*100}%`,"--q6x":`${j.higher[6].x/300*100}%`,"--q6y":`${j.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${j.lower[0].x/300*100}%`,"--q0y":`${j.lower[0].y/200*100}%`,"--q1x":`${j.lower[1].x/300*100}%`,"--q1y":`${j.lower[1].y/200*100}%`,"--q2x":`${j.lower[2].x/300*100}%`,"--q2y":`${j.lower[2].y/200*100}%`,"--q3x":`${j.lower[3].x/300*100}%`,"--q3y":`${j.lower[3].y/200*100}%`,"--q4x":`${j.lower[4].x/300*100}%`,"--q4y":`${j.lower[4].y/200*100}%`,"--q5x":`${j.lower[5].x/300*100}%`,"--q5y":`${j.lower[5].y/200*100}%`,"--q6x":`${j.lower[6].x/300*100}%`,"--q6y":`${j.lower[6].y/200*100}%`}})]})})}),T===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),T===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},v.id)}),!s&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:m.title}),m.body&&e.jsx("p",{children:m.body}),m.micro&&e.jsx("p",{className:"cogita-intro-micro",children:m.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:K,children:m.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:A,children:"Otwórz pokaz"})]})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((v,T)=>e.jsx("button",{type:"button",className:`dot ${n===T?"active":""}`,"aria-label":v.title,onClick:()=>f(T)},v.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:P,children:"Pomiń"})]})]})}const Wi=6,zi=4;function Hi({copy:a,onAuthAction:n,authLabel:s,showProfileMenu:h,onProfileNavigate:g,onToggleSecureMode:k,onLogout:f,secureMode:P,onNavigate:A,language:K,onLanguageChange:l}){const S=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}A("home")},m=i.useRef(null),y=i.useRef([]),_=i.useMemo(()=>{let w=Date.now()%2147483647;const M=()=>(w=w*48271%2147483647,w/2147483647);return Array.from({length:Wi},(ye,ie)=>{const le=6+M()*8,we=7+M()*10,Le=6+M()*9,Ne=-M()*le,De=-M()*we,Me=-M()*Le,Qe=.18+M()*.28,Oe=12+M()*18,Fe=4+M()*8,ze=(M()-.5)*3.2,oa=(M()-.5)*3.8,Re=M()>.5?"alternate":"alternate-reverse",W=M()>.5?"alternate":"alternate-reverse",X=M()>.5?"alternate":"alternate-reverse",Ke=.18+M()*.42,Ce=30+M()*60,pe=-45-M()*38,Pe=188+M()*32,Ve=.1+M()*.2;return{id:`wave-${ie+1}`,style:{"--wave-sway-duration":`${le}s`,"--wave-scale-duration":`${we}s`,"--wave-drift-duration":`${Le}s`,"--wave-sway-delay":`${Ne}s`,"--wave-scale-delay":`${De}s`,"--wave-drift-delay":`${Me}s`,"--wave-sway-dir":Re,"--wave-scale-dir":W,"--wave-drift-dir":X,"--wave-scale":`${Qe}`,"--wave-shift":`${Oe}%`,"--wave-xshift":`${Fe}%`,"--wave-x0":`${ze}%`,"--wave-y0":`${oa}%`,"--wave-opacity":`${Ke}`,"--wave-blur":`${Ce}px`,"--wave-bottom":`${pe}%`,"--wave-hue":`${Pe}`,"--wave-glow":`${Ve}`}}})},[]),G=i.useMemo(()=>{let w=Date.now()*3%2147483647;const M=()=>(w=w*48271%2147483647,w/2147483647);return Array.from({length:zi},(ye,ie)=>{const le=180+M()*220,we=220+M()*280,Le=-M()*le,Ne=-M()*we,De=.12+M()*.22,Me=3+M()*7,Qe=1+M()*3,Oe=(M()-.5)*2.8,Fe=(M()-.5)*2.2;return{id:`mesh-${ie+1}`,seed:1e3+ie*991+Math.floor(M()*999),style:{"--mesh-sway-duration":`${le}s`,"--mesh-drift-duration":`${we}s`,"--mesh-sway-delay":`${Le}s`,"--mesh-drift-delay":`${Ne}s`,"--mesh-scale":`${De}`,"--mesh-shift":`${Me}%`,"--mesh-xshift":`${Qe}%`,"--mesh-x0":`${Fe}%`,"--mesh-y0":`${Oe}%`}}})},[]),U=i.useMemo(()=>{const w=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],M=a.cogita.introSlides,ye=new Map(M.map(ie=>[ie.id,ie]));return w.map(ie=>{var we;const le=ye.get(ie.id);return{...ie,...le,title:(le==null?void 0:le.title)??"Cogita",cta:(le==null?void 0:le.cta)??((we=a.cogita.introSlides[0])==null?void 0:we.cta)??a.cogita.loginCta,secondary:le==null?void 0:le.secondary}})},[a.cogita.introSlides]),[d,b]=i.useState(0),[p,ae]=i.useState(!0),[B,j]=i.useState(!1),Y=U.length-1,$=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),oe=i.useCallback(()=>{$(),n()},[$,n]),D=i.useCallback(()=>{ae(!0),b(0)},[]),O=i.useCallback(()=>{ae(!1),b(Y)},[Y]),be=i.useCallback(w=>{b(Math.max(0,Math.min(Y,w)))},[Y]),ke=i.useCallback(()=>{d>=Y?oe():be(d+1)},[d,be,oe,Y]),ce=i.useCallback(()=>{be(d-1)},[d,be]);i.useEffect(()=>{var ye;const w=(ye=window.matchMedia)==null?void 0:ye.call(window,"(prefers-reduced-motion: reduce)");if(!w)return;const M=()=>j(w.matches);return M(),w.addEventListener?(w.addEventListener("change",M),()=>w.removeEventListener("change",M)):(w.addListener(M),()=>w.removeListener(M))},[]),i.useEffect(()=>{if(!p)return;const w=M=>{const ye=M.target;if(!ye)return;const ie=ye.tagName;if(!(ye.isContentEditable||ie==="INPUT"||ie==="TEXTAREA"||ie==="SELECT"||ie==="BUTTON"||ie==="A"||ye.closest('button, a, [role="button"], [role="link"]'))){if(M.key==="Escape"){O();return}if(M.key==="ArrowLeft"||M.key==="ArrowUp"){ce();return}(M.key==="ArrowRight"||M.key==="ArrowDown"||M.code==="Space"||M.key===" ")&&(M.preventDefault(),ke())}};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[O,ke,ce,p]),i.useEffect(()=>{p&&d===Y&&$()},[d,p,Y,$]),i.useEffect(()=>{const w=m.current;if(!w)return;const M=y.current.filter(pe=>!!pe);if(!M.length)return;const ye=1,ie=.6,le=.6,we=Math.max(1,Math.min(ye,window.devicePixelRatio||1));let Le=0,Ne=0,De=ie,Me=0,Qe=0;const Oe=pe=>{let Pe=pe%2147483647;return Pe<=0&&(Pe+=2147483646),(Ve,qe)=>{Pe=Pe*48271%2147483647;const Be=Pe/2147483647;return Ve+Be*(qe-Ve)}},Fe={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},ze=pe=>{const Pe=Math.sin(pe*12.9898)*43758.5453;return Pe-Math.floor(Pe)},oa=pe=>{const Pe=ze(pe+.1)||1e-4,Ve=ze(pe+.7)||1e-4;return Math.sqrt(-2*Math.log(Pe))*Math.cos(2*Math.PI*Ve)},Re=(pe,Pe)=>{const Ve=Math.floor(pe),qe=Ve+1,Be=pe-Ve,v=Be*Be*(3-2*Be),T=ze(Ve*12.9898+Pe*78.233),Q=ze(qe*12.9898+Pe*78.233);return T+(Q-T)*v},W=pe=>{const Pe=Oe(pe),Ve=Math.min(4,Math.max(4,Math.floor(Le/1200*Fe.filamentCount)));return Array.from({length:Ve},(qe,Be)=>{const v=Math.max(-1,Math.min(1,oa(pe+Be*.37))),T=Math.min(1,Math.max(0,ze(pe+Be*1.31))),Q=Math.min(Fe.depthLayers-1,Math.floor(T*Fe.depthLayers));return{seed:Pe(0,Math.PI*2)+pe*.01,offset:v,freqA:Fe.freq1*(.75+Pe(0,.5)),freqB:Fe.freq2*(.75+Pe(0,.5)),ampA:Fe.amp1*(.6+Pe(0,.7)),ampB:Fe.amp2*(.6+Pe(0,.7)),width:2+Be%5*.32,depth:T,layer:Q}})},X=(pe,Pe,Ve)=>{const qe=Math.max(30,Math.floor(Le*Ne/14e4));pe.save(),pe.globalAlpha=.6;for(let Be=0;Be<qe;Be+=1){const v=ze(Be*9.1+Le*.11)*Pe+Ve,T=ze(Be*3.7+Ne*.23)*Ne,Q=1.2+ze(Be*5.9)*2.4,t=pe.createRadialGradient(v,T,0,v,T,Q*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),pe.fillStyle=t,pe.beginPath(),pe.arc(v,T,Q*2,0,Math.PI*2),pe.fill()}pe.restore()},Ke=(pe,Pe)=>{pe.clearRect(0,0,Le,Ne);const Ve=Ne*Fe.waveCenter,qe=Fe.waveBandPx,Be=Fe.segments,v=Fe.colors.filaments,T=Me||Le,Q=0;X(pe,T,Q),pe.strokeStyle=v,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<Pe.length;t+=1){const r=Pe[t],u=r.offset*qe*(.85+ze(r.seed)*.4),N=1-Math.min(1,Math.abs(u)/qe),V=Math.exp(-Math.pow(u/Fe.crestThickness,2)),te=r.layer===0?1.1:r.layer===1?.85:.6,re=.35+(1-r.depth)*.65,ne=N*re*te*(.34+V*.45);pe.globalAlpha=ne,pe.lineWidth=r.width*(1+(1-r.depth)*.8);const ue=[];for(let ve=0;ve<=Be;ve+=1){const Ze=ve/Be*T+Q,Je=(Re(Ze*.012,r.seed)-.5)*Fe.xJitter,ta=Ze+Je,_e=(Re(ta*r.freqA,r.seed)-.5)*Fe.jitterA,Ye=(Re(ta*r.freqB,r.seed*1.7)-.5)*Fe.jitterB,Ue=Ve+Math.sin(ta*r.freqA+r.seed)*r.ampA+Math.sin(ta*r.freqB+r.seed*1.3)*r.ampB+u+_e+Ye;ue.push({x:ta,y:Ue})}pe.beginPath(),pe.moveTo(ue[0].x,ue[0].y);for(let ve=1;ve<ue.length-1;ve+=1){const Ze=(ue[ve].x+ue[ve+1].x)/2,Je=(ue[ve].y+ue[ve+1].y)/2;pe.quadraticCurveTo(ue[ve].x,ue[ve].y,Ze,Je)}const se=ue[ue.length-1];pe.quadraticCurveTo(se.x,se.y,se.x,se.y),pe.stroke()}pe.save(),pe.globalCompositeOperation="lighter",pe.strokeStyle=Fe.colors.glow,pe.lineCap="round",pe.lineJoin="round";for(let t=0;t<Pe.length;t+=1){const r=Pe[t];if(Math.abs(r.offset)*qe>Fe.crestThickness)continue;const u=Fe.glowAlpha*(.7+(1-r.depth)*.6);pe.globalAlpha=u,pe.lineWidth=1.6+(1-r.depth)*1.2;const N=[];for(let te=0;te<=Be;te+=1){const re=te/Be*T+Q,ne=Math.sin(re*.02+r.seed)*3,ue=Ve+Math.sin(re*r.freqA+r.seed)*r.ampA+Math.sin(re*r.freqB+r.seed*1.3)*r.ampB+r.offset*qe*.35+ne;N.push({x:re,y:ue})}pe.beginPath(),pe.moveTo(N[0].x,N[0].y);for(let te=1;te<N.length-1;te+=1){const re=(N[te].x+N[te+1].x)/2,ne=(N[te].y+N[te+1].y)/2;pe.quadraticCurveTo(N[te].x,N[te].y,re,ne)}const V=N[N.length-1];pe.quadraticCurveTo(V.x,V.y,V.x,V.y),pe.stroke()}pe.restore()},Ce=()=>{Le=Math.floor(w.clientWidth),Ne=Math.floor(w.clientHeight),Me=Math.floor(Le*1.8),Qe=Ne,De=Le<820?le:ie,M.forEach(pe=>{const Pe=pe.getContext("2d");if(!Pe)return;pe.width=Math.floor(Me*we*De),pe.height=Math.floor(Qe*we*De),pe.style.width=`${Me}px`,pe.style.height=`${Qe}px`,pe.style.left=`${-(Me-Le)/2}px`,Pe.setTransform(we*De,0,0,we*De,0,0);const Ve=Number(pe.dataset.seed||1),qe=W(Ve);Ke(Pe,qe)})};return Ce(),window.addEventListener("resize",Ce,{passive:!0}),()=>window.removeEventListener("resize",Ce)},[G]);const q=U[Math.min(d,U.length-1)],ge=p?q:U[U.length-1],o=(ge==null?void 0:ge.theme)??U[0].theme,ee={"--cogita-bg0":o.bg0,"--cogita-bg1":o.bg1,"--cogita-bg2":o.bg2,"--cogita-bloom":o.bloom,"--cogita-sat":o.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:S,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Or,{value:K,onChange:l}),e.jsx(Vr,{copy:a,label:s,isAuthenticated:h,secureMode:P,onLogin:n,onProfileNavigate:g,onToggleSecureMode:k,onLogout:f,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:m,className:"cogita-section cogita-home",style:ee,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[G.map((w,M)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:w.style,"data-seed":w.seed,ref:ye=>{y.current[M]=ye}},w.id)),_.map(w=>e.jsx("div",{className:"cogita-home-wave",style:w.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},w.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Ui,{slides:U,activeIndex:d,introOpen:p,prefersReducedMotion:B,onNext:ke,onPrev:ce,onSelect:be,onExit:O,onOpen:D,onRegister:oe})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Hi},Symbol.toStringTag,{value:"Module"})),Jr=i.createContext(!1);function La({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:l}){if(i.useContext(Jr))return e.jsx(e.Fragment,{children:l});const m=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}P("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:m,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Or,{value:A,onChange:K}),e.jsx(Vr,{copy:a,label:n,isAuthenticated:s,secureMode:f,onLogin:()=>P("home"),onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:l}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function Ua(a){const[n,s]=i.useState("Cogita library"),[h,g]=i.useState(null);return i.useEffect(()=>{let k=!1;return qr().then(f=>{if(k)return;const P=f.find(A=>A.libraryId===a);P&&s(P.name)}).catch(()=>{k||s("Cogita library")}),()=>{k=!0}},[a]),i.useEffect(()=>{let k=!1;return ui(a).then(f=>{k||g(f)}).catch(()=>{k||g(null)}),()=>{k=!0}},[a]),{libraryName:n,stats:h}}function Ji({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l}){const{libraryName:S,stats:m}=Ua(l),[y,_]=i.useState(null),[G,U]=i.useState(null),[d,b]=i.useState(null),[p,ae]=i.useState(null),[B,j]=i.useState(null),[Y,$]=i.useState(null),[oe,D]=i.useState(null),O=i.useRef(null),be=`/#/cogita/library/${l}`,ke=o=>{if(!Number.isFinite(o))return"0 B";if(o<1024)return`${o} B`;const ee=o/1024;if(ee<1024)return`${ee.toFixed(1)} KB`;const w=ee/1024;return w<1024?`${w.toFixed(1)} MB`:`${(w/1024).toFixed(1)} GB`},ce=async()=>{_(null);try{const o=await gi(l);_(a.cogita.library.overview.seedSuccess.replace("{languages}",String(o.languages)).replace("{translations}",String(o.translations)))}catch{_(a.cogita.library.overview.seedFail)}},q=async()=>{U(null),$({loadedBytes:0,totalBytes:null,percent:null});try{U(a.cogita.library.overview.exporting);const o=await hi(l,$),ee=URL.createObjectURL(o),w=document.createElement("a");w.href=ee,w.download=`cogita-library-${S||l}.json`,w.click(),URL.revokeObjectURL(ee),U(a.cogita.library.overview.exportReady)}catch{U(a.cogita.library.overview.exportFail)}finally{$(o=>o??{loadedBytes:0,totalBytes:null,percent:null})}},ge=async o=>{var w;b(null),ae(null),j(null);const ee=(w=o.target.files)==null?void 0:w[0];if(ee)try{b(a.cogita.library.overview.importing),D({loadedBytes:0,totalBytes:ee.size,percent:0});const M=await bi(l,ee,D,ye=>{const ie=ye.stage==="infos"?a.cogita.library.overview.importStageInfos:ye.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;j(a.cogita.library.overview.importLiveProgress.replace("{stage}",ie).replace("{done}",String(ye.processed)).replace("{total}",String(ye.total)).replace("{infos}",String(ye.infos)).replace("{connections}",String(ye.connections)).replace("{collections}",String(ye.collections)))});ae({infos:M.infosImported,connections:M.connectionsImported,collections:M.collectionsImported}),b(a.cogita.library.overview.importDone)}catch(M){const ye=M instanceof mi&&M.message?` ${M.message}`:"";b(`${a.cogita.library.overview.importFail}${ye}`)}finally{O.current&&(O.current.value="")}};return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h1",{className:"cogita-library-title",children:S}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${be}/list`,children:a.cogita.library.actions.openList}),e.jsx("a",{className:"cta ghost",href:`${be}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${be}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsxs("div",{className:"cogita-library-stats",children:[e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.totalInfos}),e.jsx("strong",{children:(m==null?void 0:m.totalInfos)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.connections}),e.jsx("strong",{children:(m==null?void 0:m.totalConnections)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.words}),e.jsx("strong",{children:(m==null?void 0:m.totalWords)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.sentences}),e.jsx("strong",{children:(m==null?void 0:m.totalSentences)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.languages}),e.jsx("strong",{children:(m==null?void 0:m.totalLanguages)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.collections}),e.jsx("strong",{children:(m==null?void 0:m.totalCollections)??0})]})]}),e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.quickActionsTitle}),e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.overview.quickActionsText}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("a",{className:"cta ghost",href:`${be}/list`,children:a.cogita.library.overview.browseList}),e.jsx("a",{className:"cta ghost",href:`${be}/collections`,children:a.cogita.library.overview.viewCollections}),e.jsx("a",{className:"cta",href:`${be}/new`,children:a.cogita.library.overview.addInfo})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta ghost",onClick:ce,children:a.cogita.library.overview.seedMock}),y?e.jsx("p",{className:"cogita-help",children:y}):null]})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.focusTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.focusBody1}),e.jsx("p",{children:a.cogita.library.overview.focusBody2})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:q,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:O,type:"file",accept:"application/json",onChange:ge})]})]}),Y?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:Y.percent??void 0,max:Y.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ke(Y.loadedBytes)).replace("{total}",Y.totalBytes?ke(Y.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,oe?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:oe.percent??void 0,max:oe.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ke(oe.loadedBytes)).replace("{total}",oe.totalBytes?ke(oe.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,G?e.jsx("p",{className:"cogita-help",children:G}):null,d?e.jsx("p",{className:"cogita-help",children:d}):null,B?e.jsx("p",{className:"cogita-help",children:B}):null,p?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(p.infos)).replace("{connections}",String(p.connections)).replace("{collections}",String(p.collections))}):null]})]})]})]})]})})]})})}const me=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ea=(a,n,s,h)=>`${a}:${n}:${s??""}:${h??""}`,ra=(a,n)=>{const s=a.cogita.library.infoTypes;return{any:s.any,vocab:s.vocab,language:s.language,word:s.word,sentence:s.sentence,topic:s.topic,collection:s.collection,person:s.person,institution:s.institution,collective:s.collective,orcid:s.orcid,address:s.address,email:s.email,phone:s.phone,media:s.media,work:s.work,geo:s.geo,music_piece:s.musicPiece,music_fragment:s.musicFragment,source:s.source,quote:s.quote,computed:s.computed}[n]??String(n)},Yr=a=>[{value:"any",label:ra(a,"any")},{value:"language",label:ra(a,"language")},{value:"word",label:ra(a,"word")},{value:"sentence",label:ra(a,"sentence")},{value:"topic",label:ra(a,"topic")},{value:"collection",label:ra(a,"collection")},{value:"person",label:ra(a,"person")},{value:"institution",label:ra(a,"institution")},{value:"collective",label:ra(a,"collective")},{value:"orcid",label:ra(a,"orcid")},{value:"address",label:ra(a,"address")},{value:"email",label:ra(a,"email")},{value:"phone",label:ra(a,"phone")},{value:"media",label:ra(a,"media")},{value:"work",label:ra(a,"work")},{value:"geo",label:ra(a,"geo")},{value:"music_piece",label:ra(a,"music_piece")},{value:"music_fragment",label:ra(a,"music_fragment")},{value:"source",label:ra(a,"source")},{value:"quote",label:ra(a,"quote")},{value:"computed",label:ra(a,"computed")}],Yi=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Qi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],Gi=a=>[{value:"any",label:ra(a,"any")},{value:"vocab",label:ra(a,"vocab")},...Yr(a).filter(n=>n.value!=="any")],Ga=5,Pr=50,$r=2,Rr=[];function We({libraryId:a,infoType:n,label:s,placeholder:h,value:g,onChange:k,values:f,onChangeMultiple:P,helperText:A,searchFailedText:K,createFailedText:l,createLabel:S,savingLabel:m,loadMoreLabel:y,inputRef:_,autoAdvance:G,onCommit:U,multiple:d}){const b=d?f??Rr:Rr,[p,ae]=i.useState(d?"":(g==null?void 0:g.label)??""),[B,j]=i.useState([]),[Y,$]=i.useState(Ga),[oe,D]=i.useState(-1),[O,be]=i.useState(!1),[ke,ce]=i.useState(!1),[q,ge]=i.useState(null),o=i.useRef(0),ee=i.useRef(new Map),w=i.useMemo(()=>d?p.trim().length>0:p.trim().length>0&&!g,[p,g,d]);i.useEffect(()=>{d||ae((g==null?void 0:g.label)??"")},[g,d]),i.useEffect(()=>{const ie=p.trim();if(!ie||ie.length<$r){j([]),be(!1),$(Ga),D(-1),ce(!1),ge(null);return}const le=ie.toLowerCase(),we=`${a}:${n}:${le}`,Le=ee.current.get(we);if(Le){if(d&&b.length>0){const De=new Set(b.map(Me=>Me.id));j(Le.filter(Me=>!De.has(Me.id)))}else j(Le);$(Ga),D(-1),be(Le.length>0),ce(!1),ge(null);return}const Ne=window.setTimeout(async()=>{const De=Date.now();o.current=De,ce(!0),ge(null);try{const Me=await _r({libraryId:a,type:n,query:ie,limit:Pr});if(o.current!==De)return;const Qe=Me.slice(0,Pr).map(Oe=>({id:Oe.infoId,label:Oe.label,infoType:Oe.infoType}));if(ee.current.set(we,Qe),d&&b.length>0){const Oe=new Set(b.map(Fe=>Fe.id));j(Qe.filter(Fe=>!Oe.has(Fe.id)))}else j(Qe);$(Ga),D(-1),be(!0)}catch{if(o.current!==De)return;ge(K??"Search failed.")}finally{o.current===De&&ce(!1)}},250);return()=>window.clearTimeout(Ne)},[a,n,p,b]);const M=ie=>{if(d){const le=b.some(we=>we.id===ie.id)?b:[...b,ie];P==null||P(le),ae(""),be(!1),D(-1);return}k==null||k(ie),ae(ie.label),be(!1),D(-1),G&&(U==null||U())},ye=async()=>{const ie=p.trim();if(ie){ce(!0),ge(null);try{const le=await Xa({libraryId:a,infoType:n,payload:{label:ie}}),we={id:le.infoId,label:ie,infoType:le.infoType};if(ie.length>=$r){const Le=`${a}:${n}:${ie.toLowerCase()}`,Ne=ee.current.get(Le)??[];ee.current.set(Le,[we,...Ne])}if(d){P==null||P([...b,we]),ae(""),be(!1),D(-1);return}k==null||k(we),be(!1),D(-1),G&&(U==null||U())}catch{ge(l??"Create failed.")}finally{ce(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:s}),e.jsx("input",{value:p,placeholder:h,onChange:ie=>{ae(ie.target.value),!d&&g&&(k==null||k(null))},onKeyDown:ie=>{if(ie.key==="ArrowDown"){if(ie.preventDefault(),!B.length)return;be(!0),D(le=>{const we=Math.min(B.length,Y)-1,Le=le<0?0:Math.min(le+1,we);return Le===we&&B.length>Y?($(Ne=>Math.min(Ne+Ga,B.length)),Math.min(le+1,Math.min(B.length,Y+Ga)-1)):Le});return}if(ie.key==="ArrowUp"){if(ie.preventDefault(),!B.length)return;be(!0),D(le=>le<=0?0:le-1);return}if(ie.key==="Enter"){if(ie.preventDefault(),oe>=0&&B[oe]){M(B[oe]);return}if(w){ye();return}}},onFocus:()=>{B.length>0&&be(!0)},autoComplete:"off",ref:_})]}),d&&b.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:b.map(ie=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>P==null?void 0:P(b.filter(le=>le.id!==ie.id)),children:[ie.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},ie.id))}),A&&e.jsx("p",{className:"cogita-help",children:A}),q&&e.jsx("p",{className:"cogita-error",children:q}),O&&B.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[B.slice(0,Y).map((ie,le)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":le===oe,onClick:()=>M(ie),children:[e.jsx("strong",{children:ie.label}),e.jsx("span",{children:ie.infoType})]},ie.id)),Y<B.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>$(ie=>Math.min(ie+Ga,B.length)),children:y??"Load more"})]}),w&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:ye,disabled:ke,children:ke?m??"Saving...":S??`Create new ${n}`})]})}function Xi({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l,mode:S}){const{libraryName:m}=Ua(l),y=`/#/cogita/library/${l}`,[_,G]=i.useState("any"),[U,d]=i.useState(""),[b,p]=i.useState([]),[ae,B]=i.useState("idle"),[j,Y]=i.useState(null),[$,oe]=i.useState(null),[D,O]=i.useState("idle"),[be,ke]=i.useState(0),[ce,q]=i.useState(null),[ge,o]=i.useState("idle"),[ee,w]=i.useState(null),[M,ye]=i.useState(null),[ie,le]=i.useState(null),[we,Le]=i.useState(null),Ne=i.useMemo(()=>({languageAId:(ee==null?void 0:ee.id)??void 0,languageBId:(M==null?void 0:M.id)??void 0,topicId:(ie==null?void 0:ie.id)??void 0,levelId:(we==null?void 0:we.id)??void 0}),[ee,M,ie,we]),De=i.useMemo(()=>_==="vocab"||_==="any",[_]);i.useEffect(()=>{B("loading");const Re=window.setTimeout(()=>{Sr({libraryId:l,type:_==="any"?void 0:_,query:U.trim()||void 0,limit:30,languageAId:De?Ne.languageAId:void 0,languageBId:De?Ne.languageBId:void 0,topicId:De?Ne.topicId:void 0,levelId:De?Ne.levelId:void 0}).then(W=>{p(W.items),ke(W.total),q(W.nextCursor??null),B("ready"),Y(W.items[0]??null)}).catch(()=>{p([]),ke(0),q(null),B("ready")})},240);return()=>window.clearTimeout(Re)},[l,U,_,De,Ne]),i.useEffect(()=>{if(!j||j.cardType!=="info"||j.infoType!=="computed"){oe(null),O("idle"),o("idle");return}O("loading"),mr({libraryId:l,infoId:j.cardId}).then(Re=>{oe(Re),O("ready")}).catch(()=>{oe(null),O("ready")})},[l,j]);const Me=async()=>{if(ce){B("loading");try{const Re=await Sr({libraryId:l,type:_==="any"?void 0:_,query:U.trim()||void 0,limit:30,cursor:ce,languageAId:De?Ne.languageAId:void 0,languageBId:De?Ne.languageBId:void 0,topicId:De?Ne.topicId:void 0,levelId:De?Ne.levelId:void 0});p(W=>[...W,...Re.items]),q(Re.nextCursor??null),ke(Re.total),B("ready")}catch{B("ready")}}},Qe=async()=>{if(!(!j||j.cardType!=="connection"&&j.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){o("loading");try{await pi({libraryId:l,connectionId:j.cardId});let W=null;p(X=>{const Ke=X.filter(Ce=>Ce.cardId!==j.cardId);return W=Ke[0]??null,Ke}),ke(X=>Math.max(0,X-(j.cardType==="vocab"?3:1))),Y(X=>X&&X.cardId===j.cardId?W:X),o("idle")}catch{o("error")}}},Oe=i.useMemo(()=>S==="collection"?"grid":S==="list"?"list":"detail",[S]),Fe=j?me(j):null,ze=i.useMemo(()=>Gi(a),[a]),oa=i.useMemo(()=>{const Re=be||b.length;return a.cogita.library.list.cardCount.replace("{shown}",String(b.length)).replace("{total}",String(Re))},[a,b.length,be]);return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Oe,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:y,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${y}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${y}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(Re=>e.jsx("a",{className:"ghost","data-active":S===Re,href:`${y}/${Re}`,children:Re==="detail"?a.cogita.library.list.modes.detail:Re==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},Re))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:_,onChange:Re=>G(Re.target.value),children:ze.map(Re=>e.jsx("option",{value:Re.value,children:Re.label},Re.value))}),e.jsx("input",{type:"text",value:U,onChange:Re=>d(Re.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(_==="vocab"||_==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:ee,onChange:w,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:M,onChange:ye,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:ie,onChange:le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:we,onChange:Le,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(ee||M||ie||we)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{w(null),ye(null),le(null),Le(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:oa}),e.jsx("span",{children:ae==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":S==="collection"?"grid":"list",children:b.length?b.map(Re=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":Fe===me(Re),onClick:()=>Y(Re),children:[e.jsx("div",{className:"cogita-card-type",children:Re.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:Re.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:Re.label}),e.jsx("p",{className:"cogita-card-subtitle",children:Re.description})]},me(Re))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${y}/new`,children:a.cogita.library.list.addInfo})]})}),ce?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Me,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(j==null?void 0:j.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(j==null?void 0:j.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${y}/edit/${j.cardId}`,children:a.cogita.library.list.editInfo}):null,(j==null?void 0:j.cardType)==="connection"||(j==null?void 0:j.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:Qe,disabled:ge==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${y}/new`,children:a.cogita.library.actions.addInfo})]})]}),j?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:j.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:j.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),ge==="error"&&(j.cardType==="connection"||j.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,j.cardType==="info"&&j.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),D==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),D!=="loading"&&$?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx($t,{value:$.prompt,mode:"auto"}),$.expectedAnswers&&Object.keys($.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries($.expectedAnswers).map(([Re,W])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Re}),e.jsx(pr,{value:W,mode:"auto"})]},Re))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(pr,{value:$.expectedAnswer,mode:"auto"})]})]}):D!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Ft=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Er=8;function Fr({libraryId:a,copy:n,language:s,sourceKindOptions:h,value:g,onChange:k,labels:f}){const[P,A]=i.useState(!1),[K,l]=i.useState(-1),S=i.useMemo(()=>{const G=s;return Ft.map(U=>{var p;const d=(U==null?void 0:U[G])??(U==null?void 0:U.en)??(U==null?void 0:U.la);return{label:`${d.abbr} — ${d.name}`,latin:((p=U==null?void 0:U.la)==null?void 0:p.abbr)??d.abbr}})},[s]),m=(G,U=!1)=>{const d=G.trim().toLowerCase();return d?S.filter(b=>b.label.toLowerCase().includes(d)).slice(0,Er):U?S.slice(0,Er):[]},y=(G,U)=>{const d=G.trim().toLowerCase();if(!d)return null;const b=Ft;for(const p of b){const ae=p==null?void 0:p.la,B=(p==null?void 0:p[U])??(p==null?void 0:p.en)??ae,j=(B==null?void 0:B.abbr)??"",Y=(B==null?void 0:B.name)??"";if(j.toLowerCase()===d||Y.toLowerCase()===d||`${j} — ${Y}`.toLowerCase()===d)return{book:p,entry:B,la:ae}}return null};i.useEffect(()=>{if(g.sourceKind==="bible"&&g.locatorValue&&!P){const G=y(g.locatorValue,s);if(G){const U=`${G.entry.abbr} — ${G.entry.name}`;U!==g.bibleBookDisplay&&k({...g,bibleBookDisplay:U})}}},[s,g,P,k]);const _=G=>k({...g,...G});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.sourceKindLabel}),e.jsx("select",{value:g.sourceKind,onChange:G=>_({sourceKind:G.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:h.map(G=>e.jsx("option",{value:G.value,children:G.label},G.value))})]}),g.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.bibleBookLabel}),e.jsx("input",{type:"text",value:g.bibleBookDisplay,onChange:G=>{const U=G.target.value;_({bibleBookDisplay:U,locatorValue:""}),A(!0),l(-1)},onKeyDown:G=>{var d;const U=m(g.bibleBookDisplay);if(U.length){if(G.key==="ArrowDown")G.preventDefault(),l(b=>Math.min(b+1,U.length-1));else if(G.key==="ArrowUp")G.preventDefault(),l(b=>Math.max(b-1,0));else if((G.key==="Enter"||G.key==="Tab")&&K>=0&&U[K]){const b=U[K],p=y(b.label,s);if(!p)return;_({bibleBookDisplay:b.label,locatorValue:((d=p.la)==null?void 0:d.abbr)??g.locatorValue}),A(!1)}}},onFocus:()=>A(!0),onBlur:()=>window.setTimeout(()=>A(!1),100),placeholder:f.bibleBookPlaceholder})]}),P&&m(g.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:m(g.bibleBookDisplay,!0).map((G,U)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":U===K,tabIndex:-1,onMouseDown:()=>{var b;const d=y(G.label,s);d&&_({bibleBookDisplay:G.label,locatorValue:((b=d.la)==null?void 0:b.abbr)??g.locatorValue})},children:e.jsx("strong",{children:G.label})},G.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.bibleRestLabel}),e.jsx("input",{type:"text",value:g.locatorAux,onChange:G=>_({locatorAux:G.target.value}),placeholder:f.bibleRestPlaceholder})]})]}),g.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:g.sourceUrl,onChange:G=>_({sourceUrl:G.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:g.sourceAccessedDate,onChange:G=>_({sourceAccessedDate:G.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),g.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:a,infoType:"work",label:f.churchDocumentLabel,placeholder:f.churchDocumentPlaceholder,value:g.churchDocument,onChange:G=>_({churchDocument:G}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:G=>_({locatorValue:G.target.value}),placeholder:f.locatorPlaceholder})]})]}),g.sourceKind==="work"&&e.jsx(We,{libraryId:a,infoType:"work",label:f.workLabel,placeholder:f.workPlaceholder,value:g.work,onChange:G=>_({work:G}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),g.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:a,infoType:"media",label:f.bookLabel,placeholder:f.bookPlaceholder,value:g.bookMedia,onChange:G=>_({bookMedia:G}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:G=>_({locatorValue:G.target.value}),placeholder:f.locatorPlaceholder})]})]}),g.sourceKind!=="website"&&g.sourceKind!=="bible"&&g.sourceKind!=="book"&&g.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:f.locatorLabel}),e.jsx("input",{type:"text",value:g.locatorValue,onChange:G=>_({locatorValue:G.target.value}),placeholder:f.locatorPlaceholder})]})]})}const Zi=[],en=[];function an({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),s=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),h=a.handles.length,g=h>1?(h-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+g,paddingBottom:12+g*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),s?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((k,f)=>e.jsx(Cr,{type:"target",id:k.id,position:Mr.Left,style:{top:46+f*28},children:k.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:k.label}):null},k.id)),a.output!==!1?e.jsx(Cr,{type:"source",id:"out",position:Mr.Right}):null]})}function tn({copy:a,value:n,onChange:s}){var Oe,Fe,ze,oa,Re,W,X,Ke,Ce,pe,Pe,Ve,qe,Be;const h=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),g=v=>!v||v.nodes.length===0?Zi:v.nodes.map((T,Q)=>{var t,r,u,N;return{id:T.id,type:"computed",position:T.position??{x:40+Q*160,y:60+Q%3*80},data:{title:T.name||((t=h[T.type])==null?void 0:t.label)||T.type,subtitle:((r=h[T.type])==null?void 0:r.label)||T.type,type:T.type,name:T.name,outputLabel:T.outputLabel,min:T.min,max:T.max,value:T.type==="input.const"?T.value:void 0,list:T.list,handles:((u=h[T.type])==null?void 0:u.handles)??[],output:((N=h[T.type])==null?void 0:N.output)??!0}}}),k=v=>{if(!v||v.nodes.length===0)return en;const T=new Set(v.nodes.map(r=>r.id)),Q=[];let t=0;return v.nodes.forEach(r=>{const u=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(u).forEach(([N,V])=>{V.forEach(te=>{T.has(te)&&Q.push({id:`${r.id}-${N}-${te}-${t++}`,source:te,target:r.id,targetHandle:N==="in"?void 0:N})})})}),Q},f=i.useMemo(()=>g(n),[n,h]),P=i.useMemo(()=>k(n),[n]),A=(v,T)=>{if(!v)return"null";const Q=v.nodes.map(r=>{const u=(r.list??[]).join(","),N=r.inputs?r.inputs.join(","):"",V=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([re,ne])=>`${re}:${[...ne].sort().join(",")}`).sort().join("|"):"",te=T&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",u,N,V,te].join(":")}).sort().join("||"),t=v.outputs?[...v.outputs].sort().join(","):v.output??"";return`${Q}::${t}`},K=i.useMemo(()=>{var T;const v=!!((T=n==null?void 0:n.nodes)!=null&&T.some(Q=>!!Q.position));return A(n,v)},[n]),[l,S]=i.useState(f),[m,y]=i.useState(P),[_,G]=i.useState(null),[U,d]=i.useState([]),[b,p]=i.useState(null),[ae,B]=i.useState(null),[j,Y]=i.useState({}),[$,oe]=i.useState(0),D=i.useRef(s),O=i.useRef(K),be=i.useRef(K),ke=i.useRef(A(n,!1)),ce=i.useMemo(()=>_?l.find(v=>v.id===_)??null:null,[l,_]),q=i.useMemo(()=>{const v=["in1","in2","in3","in4","in5","in6"],T=new Map;return m.forEach(Q=>{if(!Q.target)return;const t=Q.targetHandle??"in1";T.has(Q.target)||T.set(Q.target,new Set),T.get(Q.target).add(t)}),l.map(Q=>{var t;if(((t=Q.data)==null?void 0:t.type)==="compute.concat"){const r=T.get(Q.id)??new Set,u=[];let N=!1;return v.forEach(V=>{var te,re;if(r.has(V)||!N){const ne=(re=(te=h["compute.concat"])==null?void 0:te.handles)==null?void 0:re.find(ue=>ue.id===V);ne&&u.push(ne),r.has(V)||(N=!0)}}),{...Q,selected:Q.id===_,data:{...Q.data,handles:u}}}return{...Q,selected:Q.id===_}})},[l,_,m,h]);i.useEffect(()=>{p(null),B(null)},[_]),i.useEffect(()=>{if(U.length===0)return;const v=T=>{if(T.key!=="Delete"&&T.key!=="Backspace")return;const Q=T.target;Q&&(Q.tagName==="INPUT"||Q.tagName==="TEXTAREA"||Q.isContentEditable)||(T.preventDefault(),y(t=>t.filter(r=>!U.includes(r.id))),d([]))};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[U,y]),i.useEffect(()=>{D.current=s},[s]),i.useEffect(()=>{if(O.current!==K){if(be.current===K||ke.current===K){O.current=K;return}O.current=K,S(f),y(P),G(null),p(null),B(null),Y({}),oe(v=>v+1)}},[f,P,y,S,K]),i.useEffect(()=>{const v=l.filter(u=>{var N;return((N=u.data)==null?void 0:N.type)==="output"}).map(u=>u.id).sort(),T=new Map;m.forEach(u=>{let N=T.get(u.target);N||(N={},T.set(u.target,N));const V=u.targetHandle||"in";N[V]||(N[V]=[]),N[V].push(u.source)}),T.forEach(u=>{Object.values(u).forEach(N=>N.sort())});const Q={nodes:l.map(u=>{var N,V,te,re,ne,ue,se,ve,Ze;return{id:u.id,type:((N=u.data)==null?void 0:N.type)??"compute.add",position:u.position,name:(V=u.data)==null?void 0:V.name,outputLabel:(te=u.data)==null?void 0:te.outputLabel,min:(re=u.data)==null?void 0:re.min,max:(ne=u.data)==null?void 0:ne.max,value:((ue=u.data)==null?void 0:ue.type)==="input.const"?(se=u.data)==null?void 0:se.value:void 0,list:(ve=u.data)==null?void 0:ve.list,inputs:(Ze=T.get(u.id))==null?void 0:Ze.in,inputsByHandle:T.get(u.id)}}),output:v[0]??null,outputs:v},t=A(Q,!0),r=A(Q,!1);t===be.current||r===ke.current||(be.current=t,ke.current=r,D.current(Q))},[l,m]),i.useEffect(()=>{const v={};let T=!1;l.forEach(Q=>{var V,te,re,ne,ue;if(((V=Q.data)==null?void 0:V.type)!=="input.random")return;if(j[Q.id]!==void 0){v[Q.id]=j[Q.id];return}const t=Number.isFinite((te=Q.data)==null?void 0:te.min)?Number((re=Q.data)==null?void 0:re.min):0,r=Number.isFinite((ne=Q.data)==null?void 0:ne.max)?Number((ue=Q.data)==null?void 0:ue.max):t+10,u=Math.min(t,r),N=Math.max(t,r);v[Q.id]=Math.floor(Math.random()*(N-u+1))+u,T=!0}),(T||Object.keys(v).length!==Object.keys(j).length)&&Y(v)},[l,j,$]);const ge=i.useMemo(()=>l.map(T=>{var t,r,u,N,V;const Q=(((t=T.data)==null?void 0:t.list)??[]).join(",");return[T.id,((r=T.data)==null?void 0:r.type)??"",((u=T.data)==null?void 0:u.name)??"",((N=T.data)==null?void 0:N.min)??"",((V=T.data)==null?void 0:V.max)??"",Q].join(":")}).sort().join("|"),[l]),o=i.useMemo(()=>m.map(T=>`${T.source}:${T.target}:${T.targetHandle??""}`).sort().join("|"),[m]),ee=i.useMemo(()=>{const v=new Map(l.map(re=>[re.id,re])),T=new Map;m.forEach(re=>{let ne=T.get(re.target);ne||(ne={},T.set(re.target,ne));const ue=re.targetHandle||"in";ne[ue]||(ne[ue]=[]),ne[ue].push(re.source)});const Q=new Map,t=new Set,r=re=>{if(typeof re=="number")return re;if(typeof re=="string"){const ne=Number(re);return Number.isFinite(ne)?ne:0}return 0},u=(re,ne)=>{var ue,se;return ne?((ue=T.get(re.id))==null?void 0:ue[ne])??[]:((se=T.get(re.id))==null?void 0:se.in)??[]},N=(re,ne)=>u(re,ne).map(ue=>r(te(ue))),V=(re,ne)=>u(re,ne).map(ue=>te(ue)),te=re=>{var ve,Ze,Je,ta;if(Q.has(re))return Q.get(re);if(t.has(re))return 0;const ne=v.get(re);if(!ne)return 0;t.add(re);const ue=((ve=ne.data)==null?void 0:ve.type)??"";let se=0;switch(ue){case"input.random":{se=j[re]??0;break}case"input.const":{se=Number.isFinite((Ze=ne.data)==null?void 0:Ze.value)?Number((Je=ne.data)==null?void 0:Je.value):0;break}case"input.list":{const _e=(((ta=ne.data)==null?void 0:ta.list)??[]).filter(Boolean),Ye=Math.round(N(ne,"index")[0]??0);se=(_e.length?_e[Math.max(0,Math.min(_e.length-1,Ye))]:"")||String(Ye);break}case"compute.add":{se=N(ne,"in").reduce((_e,Ye)=>_e+Ye,0);break}case"compute.sub":{se=N(ne,"add").reduce((_e,Ye)=>_e+Ye,0)-N(ne,"sub").reduce((_e,Ye)=>_e+Ye,0);break}case"compute.mul":{const _e=N(ne,"in");se=_e.length?_e.reduce((Ye,Ue)=>Ye*Ue,1):0;break}case"compute.div":{const _e=N(ne,"num")[0]??0,Ye=N(ne,"den").reduce((Ue,E)=>Ue+E,0);se=Math.abs(Ye)<Number.EPSILON?0:_e/Ye;break}case"compute.pow":{const _e=N(ne,"base")[0]??0,Ye=N(ne,"exp")[0]??0;se=Math.pow(_e,Ye);break}case"compute.exp":{const _e=N(ne,"base")[0]??0,Ye=N(ne,"exp")[0]??0;se=Math.pow(_e,Ye);break}case"compute.log":{const _e=N(ne,"value")[0]??0,Ye=N(ne,"base")[0]??0,Ue=Math.max(_e,Number.EPSILON);se=Math.abs(Ye)<Number.EPSILON?Math.log(Ue):Math.log(Ue)/Math.log(Ye);break}case"compute.abs":{se=Math.abs(N(ne,"in")[0]??0);break}case"compute.min":{const _e=N(ne,"in");se=_e.length?Math.min(..._e):0;break}case"compute.max":{const _e=N(ne,"in");se=_e.length?Math.max(..._e):0;break}case"compute.floor":{se=Math.floor(N(ne,"in")[0]??0);break}case"compute.ceil":{se=Math.ceil(N(ne,"in")[0]??0);break}case"compute.round":{se=Math.round(N(ne,"in")[0]??0);break}case"compute.mod":{const _e=N(ne,"a")[0]??0,Ye=N(ne,"b")[0]??0;se=Math.abs(Ye)<Number.EPSILON?0:_e%Ye;break}case"compute.concat":{const Ye=["in1","in2","in3","in4","in5","in6"].flatMap(Ie=>V(ne,Ie)),Ue=Ye.length?Ye:V(ne,"in");se=(Ue.length?Ue:V(ne)).map(Ie=>Ie==null?"":String(Ie)).join("");break}case"compute.trim":{const _e=V(ne,"text")[0]??V(ne,"in")[0]??"",Ye=_e==null?"":String(_e),Ue=Math.max(0,Math.round(N(ne,"start")[0]??0)),E=Math.max(0,Math.round(N(ne,"end")[0]??0));se=Ue+E>=Ye.length?"":Ye.substring(Ue,Ye.length-E);break}case"output":{const _e=u(ne,"in")[0];se=_e?te(_e):0;break}default:se=0}return t.delete(re),Q.set(re,se),se};return l.forEach(re=>te(re.id)),Q},[ge,o,j]),w=i.useRef(ee);i.useEffect(()=>{w.current=ee},[ee]);const M=i.useCallback(v=>{const T=w.current.get(v.id);return e.jsx(an,{data:{...v.data,value:T}})},[]),ye=i.useMemo(()=>({computed:M}),[M]),ie=v=>{var r;if(!v.target||!v.targetHandle){y(u=>jt(v,u));return}const T=l.find(u=>u.id===v.target),Q=T?h[((r=T.data)==null?void 0:r.type)??""]:null,t=Q==null?void 0:Q.handles.find(u=>u.id===v.targetHandle);y(u=>{let N=u;return t!=null&&t.limitOne&&(N=u.filter(V=>!(V.target===v.target&&V.targetHandle===v.targetHandle))),jt(v,N)})},le=v=>{const T=crypto.randomUUID(),Q=h[v]??{label:v,handles:[]},t=Q.label;S(r=>[...r,{id:T,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:Q.label,type:v,name:"",handles:Q.handles,list:v==="input.list"?[]:void 0,output:Q.output??!0}}])},we=v=>{if(_){if(v.name!==void 0){const T=v.name.trim(),Q=T===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(T);if(B(Q?null:a.cogita.library.graph.invalidName),!T)p(null);else{const t=l.find(r=>{var u;return r.id!==_&&((u=r.data)==null?void 0:u.name)&&r.data.name.trim().toLowerCase()===T.toLowerCase()});p(t?a.cogita.library.graph.duplicateName:null)}}S(T=>T.map(Q=>{var t,r,u,N;return Q.id===_?{...Q,data:{...Q.data,...v,title:v.name?v.name:(t=Q.data)==null?void 0:t.title,subtitle:((u=h[v.type??((r=Q.data)==null?void 0:r.type)??""])==null?void 0:u.label)??((N=Q.data)==null?void 0:N.subtitle)}}:Q}))}},Le=()=>{_&&(S(v=>v.filter(T=>T.id!==_)),y(v=>v.filter(T=>T.source!==_&&T.target!==_)),Y(v=>{const T={...v};return delete T[_],T}),G(null),p(null))},Ne=i.useRef({nodeId:null,edgeIds:[]}),De=v=>{var N;const T=((N=v.nodes[0])==null?void 0:N.id)??null,Q=v.edges.map(V=>V.id),t=Ne.current,r=t.nodeId===T,u=t.edgeIds.length===Q.length&&t.edgeIds.every((V,te)=>V===Q[te]);r&&u||(Ne.current={nodeId:T,edgeIds:Q},G(T),d(Q))},Me=v=>{const T=v.filter(Q=>Q.type!=="select"&&Q.type!=="dimensions");T.length!==0&&S(Q=>ci(T,Q))},Qe=v=>{const T=v.filter(Q=>Q.type!=="select");T.length!==0&&y(Q=>si(T,Q))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Ut,{nodeTypes:ye,nodes:q,edges:m,onNodesChange:Me,onEdgesChange:Qe,onConnect:ie,onNodeClick:(v,T)=>G(T.id),onSelectionChange:De,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(Wt,{gap:18,size:1}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>le("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>le("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>le("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>le("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>le("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>le("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>le("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>le("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>le("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>le("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>le("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>le("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>le("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>le("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>le("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>le("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>le("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>le("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>le("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>le("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),ce?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Oe=ce.data)==null?void 0:Oe.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:v=>we({name:v.target.value})}),b?e.jsx("em",{className:"cogita-help",children:b}):null,ae?e.jsx("em",{className:"cogita-help",children:ae}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((ze=h[((Fe=ce.data)==null?void 0:Fe.type)??""])==null?void 0:ze.label)??((oa=ce.data)==null?void 0:oa.type)]}),((Re=ce.data)==null?void 0:Re.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((W=ce.data)==null?void 0:W.outputLabel)??"",onChange:v=>we({outputLabel:v.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((X=ce.data)==null?void 0:X.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Ke=ce.data)==null?void 0:Ke.min)??0,onChange:v=>we({min:Number(v.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Ce=ce.data)==null?void 0:Ce.max)??10,onChange:v=>we({max:Number(v.target.value)})})]})]}),((pe=ce.data)==null?void 0:pe.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:((Pe=ce.data)==null?void 0:Pe.value)??0,onChange:v=>we({value:Number(v.target.value)})})]}),((Ve=ce.data)==null?void 0:Ve.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((qe=ce.data)==null?void 0:qe.list)??[]).join(`
`),onChange:v=>we({list:v.target.value.split(`
`).map(T=>T.replace(/\r$/,"")).filter(T=>T.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((Be=ce.data)==null?void 0:Be.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{_&&(Y(v=>{var u,N,V,te;const T=Number.isFinite((u=ce.data)==null?void 0:u.min)?Number((N=ce.data)==null?void 0:N.min):0,Q=Number.isFinite((V=ce.data)==null?void 0:V.max)?Number((te=ce.data)==null?void 0:te.max):T+10,t=Math.min(T,Q),r=Math.max(T,Q);return{...v,[_]:Math.floor(Math.random()*(r-t+1))+t}}),oe(v=>v+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Le,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const nr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function kr(a,n,s){if(!a)return null;const h=new Map(a.nodes.map(B=>[B.id,B])),g=new Map,k=new Set,f=B=>{if(typeof B=="number")return B;if(typeof B=="string"){const j=Number(B);return Number.isFinite(j)?j:0}return 0},P=B=>{if(g.has(B))return g.get(B);if(k.has(B))return 0;const j=h.get(B);if(!j)return 0;k.add(B);const Y=oe=>{var O,be;return(oe?((O=j.inputsByHandle)==null?void 0:O[oe])??[]:j.inputs??((be=j.inputsByHandle)==null?void 0:be.in)??[]).map(ke=>P(ke))};let $=0;switch(j.type){case"input.random":{const oe=j.min??0,D=j.max??oe+10,O=Math.min(oe,D),be=Math.max(oe,D);$=Math.floor(Math.random()*(be-O+1))+O;break}case"input.const":{$=j.value??0;break}case"input.list":{const oe=(j.list??[]).filter(Boolean),D=Math.round(f(Y("index")[0]));$=oe.length?oe[Math.max(0,Math.min(oe.length-1,D))]:String(D);break}case"compute.add":{$=Y("in").map(D=>f(D)).reduce((D,O)=>D+O,0);break}case"compute.sub":{const oe=Y("add").map(O=>f(O)),D=Y("sub").map(O=>f(O));$=oe.reduce((O,be)=>O+be,0)-D.reduce((O,be)=>O+be,0);break}case"compute.mul":{const oe=Y("in").map(D=>f(D));$=oe.length?oe.reduce((D,O)=>D*O,1):0;break}case"compute.div":{const oe=f(Y("num")[0]),D=Y("den").map(O=>f(O)).reduce((O,be)=>O+be,0);$=Math.abs(D)<Number.EPSILON?0:oe/D;break}case"compute.pow":{const oe=f(Y("base")[0]),D=f(Y("exp")[0]);$=Math.pow(oe,D);break}case"compute.exp":{const oe=f(Y("base")[0]),D=f(Y("exp")[0]);$=Math.pow(oe,D);break}case"compute.log":{const oe=f(Y("value")[0]),D=f(Y("base")[0]),O=Math.max(oe,Number.EPSILON);$=Math.abs(D)<Number.EPSILON?Math.log(O):Math.log(O)/Math.log(D);break}case"compute.abs":{$=Math.abs(f(Y("in")[0]));break}case"compute.min":{const oe=Y("in").map(D=>f(D));$=oe.length?Math.min(...oe):0;break}case"compute.max":{const oe=Y("in").map(D=>f(D));$=oe.length?Math.max(...oe):0;break}case"compute.floor":{$=Math.floor(f(Y("in")[0]));break}case"compute.ceil":{$=Math.ceil(f(Y("in")[0]));break}case"compute.round":{$=Math.round(f(Y("in")[0]));break}case"compute.mod":{const oe=f(Y("a")[0]),D=f(Y("b")[0]);$=Math.abs(D)<Number.EPSILON?0:oe%D;break}case"compute.concat":{const D=["in1","in2","in3","in4","in5","in6"].flatMap(ce=>Y(ce)),O=D.length?D:Y("in");$=(O.length?O:Y()).map(ce=>ce==null?"":String(ce)).join("");break}case"compute.trim":{const oe=Y("text")[0]??Y("in")[0]??"",D=oe==null?"":String(oe),O=Math.max(0,Math.round(f(Y("start")[0]))),be=Math.max(0,Math.round(f(Y("end")[0])));O+be>=D.length?$="":$=D.substring(O,D.length-be);break}case"output":{$=Y("in")[0]??0;break}default:$=0}return k.delete(B),g.set(B,$),$},A=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(B=>B.type==="output").map(B=>B.id);a.nodes.forEach(B=>P(B.id)),A.forEach(B=>P(B));const K=B=>Math.abs(B%1)<1e-5?String(Math.round(B)):B.toFixed(3).replace(/\.?0+$/,""),l=B=>typeof B=="number"?K(B):B??"",S=new Map;A.forEach(B=>{var D,O,be,ke;const j=h.get(B);if(!j)return;const Y=(O=(D=j.inputsByHandle)==null?void 0:D.name)==null?void 0:O[0],$=Y?l(g.get(Y)):"",oe=($==null?void 0:$.toString().trim())||((be=j.outputLabel)==null?void 0:be.trim())||((ke=j.name)==null?void 0:ke.trim())||B;S.set(B,oe)});const m={},y={},_={};A.forEach(B=>{var $,oe;const j=h.get(B);if(!j)return;const Y=S.get(B)??((($=j.outputLabel)==null?void 0:$.trim())||((oe=j.name)==null?void 0:oe.trim())||B);m[Y]=l(g.get(B)),j.name&&(y[j.name.trim()]=Y),y[B]=Y});const G=(B,j)=>{let Y=B;return a.nodes.forEach($=>{var ke,ce;const oe=l(g.get($.id)),D=A.includes($.id),O=D?S.get($.id)??((ke=$.outputLabel)==null?void 0:ke.trim())??((ce=$.name)==null?void 0:ce.trim())??$.id:"",be=D&&j?O:oe;Y=Y.replace(new RegExp(`\\{\\s*${nr($.id)}\\s*\\}`,"gi"),be),$.name&&(Y=Y.replace(new RegExp(`\\{\\s*${nr($.name)}\\s*\\}`,"gi"),be)),D&&$.outputLabel&&(Y=Y.replace(new RegExp(`\\{\\s*${nr($.outputLabel)}\\s*\\}`,"gi"),O))}),Y},U=n;let d=U.trim().length>0?U:"";d||(d=A.length?`Compute ${A.join(", ")}`:"Compute"),d=G(d,!0);const b=(s==null?void 0:s.trim())??"",p=b?G(b,!1):"",ae={};return g.forEach((B,j)=>{ae[j]=B,_[j]=l(B);const Y=h.get(j);Y!=null&&Y.name&&(_[Y.name.trim()]=l(B))}),{prompt:d,answers:m,values:ae,answerText:p,outputVariables:y,variableValues:_}}function Qr(a){var s;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((s=n[0])==null?void 0:s[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function rn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l,editInfoId:S}){const{libraryName:m}=Ua(l),y=!!S,_=`/#/cogita/library/${l}`,[G,U]=i.useState("info"),[d,b]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[p,ae]=i.useState(""),[B,j]=i.useState(null),[Y,$]=i.useState(null),[oe,D]=i.useState("idle"),[O,be]=i.useState(null),[ke,ce]=i.useState(-1),[q,ge]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[o,ee]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[w,M]=i.useState(null),[ye,ie]=i.useState("idle"),[le,we]=i.useState(null),[Le,Ne]=i.useState(null),[De,Me]=i.useState(null),Qe=i.useRef(null),Oe=i.useRef(null),Fe=i.useRef(null),ze=i.useMemo(()=>Yr(a),[a]),oa=i.useMemo(()=>Yi(a),[a]),Re=i.useMemo(()=>Qi(a),[a]),W=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),X=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Ke=i.useMemo(()=>ze.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[ze]),Ce=i.useMemo(()=>{const t=A;return Ft.map(r=>{var V;const u=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${u.abbr} — ${u.name}`,latin:((V=r==null?void 0:r.la)==null?void 0:V.abbr)??u.abbr}})},[A]),pe=(t,r=!1)=>{const u=t.trim().toLowerCase();return u?Ce.filter(N=>N.label.toLowerCase().includes(u)).slice(0,8):r?Ce.slice(0,8):[]},Pe=(t,r)=>{const u=t.trim().toLowerCase();if(!u)return null;const N=Ft;for(const V of N){const te=V==null?void 0:V.la,re=(V==null?void 0:V[r])??(V==null?void 0:V.en)??te;if([re==null?void 0:re.abbr,re==null?void 0:re.name,te==null?void 0:te.abbr,te==null?void 0:te.name,`${re==null?void 0:re.abbr} — ${re==null?void 0:re.name}`].filter(Boolean).map(ue=>ue.toLowerCase()).some(ue=>ue===u))return{book:V,entry:re,la:te}}return null};i.useEffect(()=>{if(!q.language||!q.word){we(null);return}const t=window.setTimeout(()=>{ir({libraryId:l,languageId:q.language.id,wordId:q.word.id}).then(r=>{we(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{we(null)})},200);return()=>window.clearTimeout(t)},[l,q.language,q.word]),i.useEffect(()=>{if(!o.languageA||!o.wordA){Ne(null);return}const t=window.setTimeout(()=>{ir({libraryId:l,languageId:o.languageA.id,wordId:o.wordA.id}).then(r=>{Ne(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Ne(null)})},200);return()=>window.clearTimeout(t)},[l,o.languageA,o.wordA]),i.useEffect(()=>{if(!o.languageB||!o.wordB){Me(null);return}const t=window.setTimeout(()=>{ir({libraryId:l,languageId:o.languageB.id,wordId:o.wordB.id}).then(r=>{Me(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Me(null)})},200);return()=>window.clearTimeout(t)},[l,o.languageB,o.wordB]),i.useEffect(()=>{if(!y||!S)return;let t=!1;return ie("loading"),M(null),Za({libraryId:l,infoId:S}).then(async r=>{var N,V;if(t)return;const u=r.payload??{};if(b(te=>({...te,infoType:r.infoType,label:u.label??"",notes:u.notes??"",language:u.languageId?{id:u.languageId,label:u.languageId,infoType:"language"}:null,sourceKind:u.sourceKind??"string",sourceResourceType:te.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:u.text??"",workLanguage:u.languageId?{id:u.languageId,label:u.languageId,infoType:"language"}:null,workOriginalLanguage:u.originalLanguageId?{id:u.originalLanguageId,label:u.originalLanguageId,infoType:"language"}:null,workDoi:u.doi??"",mediaType:u.mediaType??"book",mediaPublisher:u.publisher??"",mediaPublicationPlace:u.publicationPlace??"",mediaPublicationYear:u.publicationYear??"",mediaPages:u.pages??"",mediaIsbn:u.isbn??"",mediaCover:u.cover??"",mediaHeight:u.height??"",mediaLength:u.length??"",mediaWidth:u.width??"",mediaWeight:u.weight??"",mediaCollection:u.collection??"",mediaLocation:u.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&u.locator&&typeof u.locator=="object"){const te=u.locator;if(u.sourceKind==="website")b(re=>({...re,sourceUrl:typeof te.url=="string"?te.url:"",sourceAccessedDate:typeof te.date=="string"?te.date:""}));else if(u.sourceKind==="bible"){const re=typeof te.book=="string"?te.book:"",ne=re?Pe(re,A):null,ue=ne?`${ne.entry.abbr} — ${ne.entry.name}`:re;b(se=>({...se,sourceLocatorValue:re,sourceLocatorAux:typeof te.rest=="string"?te.rest:"",sourceBibleBookDisplay:ue}))}else u.sourceKind==="book"?b(re=>({...re,sourceLocatorValue:typeof te.page=="string"?te.page:""})):u.sourceKind==="number_document"?b(re=>({...re,sourceLocatorValue:typeof te.number=="string"?te.number:""})):typeof te.text=="string"&&b(re=>({...re,sourceLocatorValue:te.text}))}if(u.languageId&&r.infoType!=="work")try{const te=await Za({libraryId:l,infoId:u.languageId});if(t)return;b(re=>{var ne;return{...re,language:{id:u.languageId,label:((ne=te.payload)==null?void 0:ne.label)??u.languageId,infoType:"language"}}})}catch{}if(u.languageId&&r.infoType==="work")try{const te=await Za({libraryId:l,infoId:u.languageId});if(t)return;b(re=>{var ne;return{...re,workLanguage:{id:u.languageId,label:((ne=te.payload)==null?void 0:ne.label)??u.languageId,infoType:"language"}}})}catch{}if(u.originalLanguageId)try{const te=await Za({libraryId:l,infoId:u.originalLanguageId});if(t)return;b(re=>{var ne;return{...re,workOriginalLanguage:{id:u.originalLanguageId,label:((ne=te.payload)==null?void 0:ne.label)??u.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(ae(((N=u.definition)==null?void 0:N.answerTemplate)??""),j(((V=u.definition)==null?void 0:V.graph)??null),$(null),D("idle")):(ae(""),j(null),$(null),D("idle")),U("info")}).catch(()=>{t||M(a.cogita.library.add.info.failed)}).finally(()=>{t||ie("idle")}),()=>{t=!0}},[a,S,y,l]),i.useEffect(()=>{if(d.sourceKind==="bible"&&d.sourceLocatorValue&&O!=="source"){const t=Pe(d.sourceLocatorValue,A);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==d.sourceBibleBookDisplay&&b(u=>({...u,sourceBibleBookDisplay:r}))}}},[A,d.sourceKind,d.sourceLocatorValue,d.sourceBibleBookDisplay]);const Ve=async()=>{var t,r;M(null);try{const u={label:d.infoType==="quote"||d.infoType==="source"?"":d.label,notes:d.infoType==="computed"?"":d.notes};if(d.language&&(d.infoType==="word"||d.infoType==="sentence")&&(u.languageId=d.language.id),d.infoType==="source"&&(u.sourceKind=d.sourceKind,d.sourceKind==="website"?u.locator={url:d.sourceUrl.trim(),date:d.sourceAccessedDate.trim()}:d.sourceKind==="bible"?u.locator={book:d.sourceLocatorValue.trim(),rest:d.sourceLocatorAux.trim()}:d.sourceKind==="book"?u.locator={page:d.sourceLocatorValue.trim()}:d.sourceKind==="number_document"?u.locator={number:d.sourceLocatorValue.trim()}:u.locator={text:d.sourceLocatorValue.trim()}),d.infoType==="quote"&&(u.text=d.quoteText),d.infoType==="work"&&(u.languageId=((t=d.workLanguage)==null?void 0:t.id)??null,u.originalLanguageId=((r=d.workOriginalLanguage)==null?void 0:r.id)??null,u.doi=d.workDoi.trim()),d.infoType==="media"&&(u.mediaType=d.mediaType,u.publisher=d.mediaPublisher.trim(),u.publicationPlace=d.mediaPublicationPlace.trim(),u.publicationYear=d.mediaPublicationYear.trim(),u.pages=d.mediaPages.trim(),u.isbn=d.mediaIsbn.trim(),u.cover=d.mediaCover.trim(),u.height=d.mediaHeight.trim(),u.length=d.mediaLength.trim(),u.width=d.mediaWidth.trim(),u.weight=d.mediaWeight.trim(),u.collection=d.mediaCollection.trim(),u.location=d.mediaLocation.trim()),d.infoType==="computed"){if(!B){M(a.cogita.library.add.info.computedRequired);return}if(!p.trim()){M(a.cogita.library.add.info.computedAnswerRequired);return}if(B.nodes.find(se=>se.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(se.name))){M(a.cogita.library.add.info.computedInvalidName);return}const V=B.nodes.map(se=>{var ve;return(ve=se.name)==null?void 0:ve.trim()}).filter(Boolean),te=new Set;for(const se of V){const ve=se.toLowerCase();if(te.has(ve)){M(a.cogita.library.add.info.computedDuplicateName);return}te.add(ve)}const re=B.nodes.filter(se=>se.type==="output"),ne=re.map(se=>{var ve;return(ve=se.name)==null?void 0:ve.trim()}).filter(Boolean);if(ne.length!==re.length){M(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!ne.every(se=>new RegExp(`\\{\\s*${se}\\s*\\}`,"i").test(p))){M(a.cogita.library.add.info.computedAnswerMissingOutput);return}u.definition={answerTemplate:p,graph:B}}if(y&&S)ie("saving"),await fi({libraryId:l,infoId:S,payload:u}),M(a.cogita.library.add.info.updated),ie("idle");else{let N=null;if(d.referenceEnabled){const se={sourceKind:d.referenceSourceKind,locatorValue:d.referenceLocatorValue,locatorAux:d.referenceLocatorAux,bibleBookDisplay:d.referenceBibleBookDisplay,sourceUrl:d.referenceSourceUrl,sourceAccessedDate:d.referenceSourceAccessedDate,churchDocument:d.referenceChurchDocument,bookMedia:d.referenceBookMedia,work:d.referenceWork},{payload:ve,resourceInfoId:Ze,error:Je}=qe(se);if(Je){M(a.cogita.library.add.info.referenceMissingSource);return}N={payload:ve,resourceInfoId:Ze}}const V=await Xa({libraryId:l,infoType:d.infoType,payload:u});if(d.infoType==="source"&&d.sourceResource&&await da({libraryId:l,connectionType:"source-resource",infoIds:[V.infoId,d.sourceResource.id]}),d.infoType==="quote"&&d.language&&await da({libraryId:l,connectionType:"quote-language",infoIds:[V.infoId,d.language.id]}),N){const se=await Xa({libraryId:l,infoType:"source",payload:N.payload});N.resourceInfoId&&await da({libraryId:l,connectionType:"source-resource",infoIds:[se.infoId,N.resourceInfoId]}),await da({libraryId:l,connectionType:"reference",infoIds:[V.infoId,se.infoId]})}M(a.cogita.library.add.info.saved);const te=d.infoType==="word"||d.infoType==="sentence",re=d.referenceEnabled,ne=d.referenceSourceKind,ue={referenceEnabled:re,referenceSourceKind:re?ne:"string",referenceSourceUrl:re&&ne==="website"?d.referenceSourceUrl:"",referenceSourceAccessedDate:re&&ne==="website"?d.referenceSourceAccessedDate:"",referenceChurchDocument:re&&ne==="number_document"?d.referenceChurchDocument:null,referenceBookMedia:re&&ne==="book"?d.referenceBookMedia:null,referenceWork:re&&ne==="work"?d.referenceWork:null,referenceLocatorValue:re&&ne==="bible"?d.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:re&&ne==="bible"?d.referenceBibleBookDisplay:""};b({infoType:d.infoType,label:"",language:te?d.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:d.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...ue}),d.infoType==="computed"&&(ae(""),j(null),$(null),D("idle"))}}catch{M(a.cogita.library.add.info.failed)}},qe=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const u={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const N=t.sourceUrl.trim();return N?(u.locator={url:N,date:t.sourceAccessedDate.trim()},{payload:u,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(u.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:u,resourceInfoId:r}):(t.sourceKind==="book"?u.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?u.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(u.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:u,resourceInfoId:r})},Be=()=>{if(D("idle"),!B){$(null),D("error");return}const t=kr(B,"",p);if(!t){$(null),D("error");return}$({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),D("ready")},v=async()=>{M(null);try{if(q.connectionType==="reference"){if(!q.referencedInfo||!q.source){M(a.cogita.library.add.connection.selectReference);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.referencedInfo.id,q.source.id]})}else if(q.connectionType==="source-resource"){if(!q.source||!q.sourceResource){M(a.cogita.library.add.connection.selectSourceResource);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.source.id,q.sourceResource.id]})}else if(q.connectionType==="quote-language"){if(!q.quote||!q.language){M(a.cogita.library.add.connection.selectQuoteLanguage);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.quote.id,q.language.id]})}else if(q.connectionType==="work-contributor"){if(!q.work||!q.contributor||!q.contributorRole.trim()){M(a.cogita.library.add.connection.selectWorkContributor);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.work.id,q.contributor.id],payload:{role:q.contributorRole.trim()}})}else if(q.connectionType==="work-medium"){if(!q.work||!q.medium){M(a.cogita.library.add.connection.selectWorkMedium);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.work.id,q.medium.id]})}else if(q.connectionType==="orcid-link"){if(!q.orcidEntity||!q.orcid){M(a.cogita.library.add.connection.selectOrcidLink);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.orcidEntity.id,q.orcid.id]})}else if(q.connectionType==="word-language"){if(!q.language||!q.word){M(a.cogita.library.add.connection.selectWordLanguage);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.language.id,q.word.id],payload:{note:q.note}})}else if(q.connectionType==="word-topic"){if(!q.word||!q.topic){M(a.cogita.library.add.connection.selectWordTopic);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.word.id,q.topic.id],payload:{note:q.note}})}else if(q.connectionType==="translation"){if(!q.wordA||!q.wordB){M(a.cogita.library.add.connection.selectTwoWords);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.wordA.id,q.wordB.id],payload:{note:q.note}})}else if(q.connectionType==="language-sentence"){if(!q.language||!q.sentence){M(a.cogita.library.add.connection.selectLanguageSentence);return}await da({libraryId:l,connectionType:q.connectionType,infoIds:[q.language.id,q.sentence.id],payload:{note:q.note}})}M(a.cogita.library.add.connection.saved),ge(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{M(a.cogita.library.add.connection.failed)}},T=async()=>{var t,r;M(null);try{if(o.groupType==="citation"){const N=o.citationTitle.trim(),V=o.citationQuoteText.trim();if(!V){M(a.cogita.library.add.group.citationMissingQuote);return}let te=null;if(o.citationReferenceEnabled){const ue={sourceKind:o.citationSourceKind,locatorValue:o.citationLocatorValue,locatorAux:o.citationLocatorAux,bibleBookDisplay:o.citationBibleBookDisplay,sourceUrl:o.citationSourceUrl,sourceAccessedDate:o.citationSourceAccessedDate,churchDocument:o.citationChurchDocument,bookMedia:o.citationBookMedia,work:o.citationWork},{payload:se,resourceInfoId:ve,error:Ze}=qe(ue);if(Ze){M(a.cogita.library.add.info.referenceMissingSource);return}te={payload:se,resourceInfoId:ve}}const re={text:V};N&&(re.title=N);const ne=await Xa({libraryId:l,infoType:"quote",payload:re});if(o.citationLanguage&&await da({libraryId:l,connectionType:"quote-language",infoIds:[ne.infoId,o.citationLanguage.id]}),te){const ue=await Xa({libraryId:l,infoType:"source",payload:te.payload});te.resourceInfoId&&await da({libraryId:l,connectionType:"source-resource",infoIds:[ue.infoId,te.resourceInfoId]}),await da({libraryId:l,connectionType:"reference",infoIds:[ne.infoId,ue.infoId]})}M(a.cogita.library.add.group.savedCitation),ee(ue=>({...ue,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:ue.citationReferenceEnabled,citationSourceKind:ue.citationReferenceEnabled?ue.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:ue.citationReferenceEnabled?ue.citationChurchDocument:null,citationBookMedia:ue.citationReferenceEnabled?ue.citationBookMedia:null,citationWork:ue.citationReferenceEnabled?ue.citationWork:null}));return}if(o.groupType==="book"){const N=o.bookTitle.trim();if(!N){M(a.cogita.library.add.group.bookMissingTitle);return}const V=o.bookWorkTitle.trim();if(!V){M(a.cogita.library.add.group.bookMissingWork);return}if(o.bookContributors.find(se=>se.contributor&&!se.role.trim()||!se.contributor&&se.role.trim())){M(a.cogita.library.add.group.bookMissingContributor);return}const re=await Xa({libraryId:l,infoType:"media",payload:{label:N,mediaType:"book",publisher:o.bookPublisher.trim(),publicationPlace:o.bookPublicationPlace.trim(),publicationYear:o.bookPublicationYear.trim(),pages:o.bookPages.trim(),isbn:o.bookIsbn.trim(),cover:o.bookCover.trim(),height:o.bookHeight.trim(),length:o.bookLength.trim(),width:o.bookWidth.trim(),weight:o.bookWeight.trim(),collection:o.bookCollection.trim(),location:o.bookLocation.trim()}}),ne=await Xa({libraryId:l,infoType:"work",payload:{label:V,languageId:((t=o.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=o.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:o.bookWorkDoi.trim()}});await da({libraryId:l,connectionType:"work-medium",infoIds:[ne.infoId,re.infoId]});const ue=o.bookContributors.filter(se=>se.contributor&&se.role.trim());for(const se of ue)await da({libraryId:l,connectionType:"work-contributor",infoIds:[ne.infoId,se.contributor.id],payload:{role:se.role.trim()}});M(a.cogita.library.add.group.savedBook),ee(se=>({...se,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!o.languageA||!o.wordA||!o.languageB||!o.wordB){M(a.cogita.library.add.group.selectBoth);return}const u=N=>Array.from(new Map(N.map(V=>[V.id,V])).values());Le||await da({libraryId:l,connectionType:"word-language",infoIds:[o.languageA.id,o.wordA.id]}),De||await da({libraryId:l,connectionType:"word-language",infoIds:[o.languageB.id,o.wordB.id]});for(const N of u(o.wordATags))await da({libraryId:l,connectionType:"word-topic",infoIds:[o.wordA.id,N.id]});for(const N of u(o.wordBTags))await da({libraryId:l,connectionType:"word-topic",infoIds:[o.wordB.id,N.id]});await da({libraryId:l,connectionType:"translation",infoIds:[o.wordA.id,o.wordB.id],payload:{tagIds:u(o.translationTags).map(N=>N.id)}}),M(a.cogita.library.add.group.savedVocab),ee(N=>({...N,groupType:o.groupType,languageA:o.languageA,wordA:null,languageB:o.languageB,wordB:null,wordATags:o.wordATags,wordBTags:o.wordBTags,translationTags:o.translationTags})),requestAnimationFrame(()=>{var N;return(N=Qe.current)==null?void 0:N.focus()})}catch{M(a.cogita.library.add.group.failed)}},Q=o.groupType==="citation"?a.cogita.library.add.group.saveCitation:o.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:_,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${_}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":G===t,onClick:()=>{y||U(t)},disabled:y&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[G==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:d.infoType,onChange:t=>{y||b(r=>({...r,infoType:t.target.value}))},disabled:y,children:ze.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.infoType!=="quote"&&d.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:d.label,onChange:t=>b(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(d.infoType==="word"||d.infoType==="sentence"||d.infoType==="quote")&&e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:d.language,onChange:t=>b(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),d.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:d.workLanguage,onChange:t=>b(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:d.workOriginalLanguage,onChange:t=>b(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:d.workDoi,onChange:t=>b(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),d.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:d.mediaType,onChange:t=>b(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:d.mediaPublisher,onChange:t=>b(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:d.mediaPublicationPlace,onChange:t=>b(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:d.mediaPublicationYear,onChange:t=>b(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:d.mediaPages,onChange:t=>b(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:d.mediaIsbn,onChange:t=>b(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:d.mediaCover,onChange:t=>b(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:d.mediaHeight,onChange:t=>b(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:d.mediaLength,onChange:t=>b(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:d.mediaWidth,onChange:t=>b(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:d.mediaWeight,onChange:t=>b(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:d.mediaCollection,onChange:t=>b(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:d.mediaLocation,onChange:t=>b(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),d.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:d.quoteText,onChange:t=>b(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),d.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:d.sourceKind,onChange:t=>{const r=t.target.value,u=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":d.sourceResourceType;b(N=>({...N,sourceKind:r,sourceResourceType:u,sourceResource:null,sourceLocatorValue:r==="bible"?"":N.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":N.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?N.sourceBibleBookDisplay:""}))},children:W.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:d.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;b(u=>({...u,sourceBibleBookDisplay:r,sourceLocatorValue:""})),be("source"),ce(-1)},onKeyDown:t=>{const r=pe(d.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),ce(u=>Math.min(u+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),ce(u=>Math.max(u-1,0));else if((t.key==="Enter"||t.key==="Tab")&&ke>=0&&r[ke]){const u=r[ke],N=Pe(u.label,A);if(!N)return;b(V=>{var te;return{...V,sourceBibleBookDisplay:u.label,sourceLocatorValue:((te=N.la)==null?void 0:te.abbr)??V.sourceLocatorValue}}),be(null)}}},onFocus:()=>be("source"),onBlur:()=>window.setTimeout(()=>be(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),O==="source"&&pe(d.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:pe(d.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===ke,tabIndex:-1,onMouseDown:()=>{const u=Pe(t.label,A);u&&b(N=>{var V;return{...N,sourceBibleBookDisplay:t.label,sourceLocatorValue:((V=u.la)==null?void 0:V.abbr)??N.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:d.sourceLocatorAux,onChange:t=>b(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),d.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:d.sourceUrl,onChange:t=>b(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:d.sourceAccessedDate,onChange:t=>b(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),d.sourceKind!=="website"&&d.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:d.sourceLocatorValue,onChange:t=>b(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),d.sourceKind!=="string"&&d.sourceKind!=="website"&&d.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:d.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(d.sourceKind),onChange:t=>b(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ke.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(We,{libraryId:l,infoType:d.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:d.sourceResource,onChange:t=>b(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,d.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),d.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:d.notes,onChange:t=>b(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,d.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:p,onChange:t=>ae(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(tn,{copy:a,value:B,onChange:t=>j(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Be,children:a.cogita.library.add.info.computedPreview})}),Y&&oe==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx($t,{value:Y.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(Y.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(pr,{value:r,mode:"auto"})]},t))}),Y.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx($t,{value:Y.answerText,mode:"auto"})]}):null]}):oe==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:d.referenceEnabled,onChange:t=>b(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),d.referenceEnabled&&e.jsx(Fr,{libraryId:l,copy:a,language:A,sourceKindOptions:W,labels:X,value:{sourceKind:d.referenceSourceKind,locatorValue:d.referenceLocatorValue,locatorAux:d.referenceLocatorAux,bibleBookDisplay:d.referenceBibleBookDisplay,sourceUrl:d.referenceSourceUrl,sourceAccessedDate:d.referenceSourceAccessedDate,churchDocument:d.referenceChurchDocument,bookMedia:d.referenceBookMedia,work:d.referenceWork},onChange:t=>b(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:Ve,disabled:ye==="saving"||ye==="loading",children:y?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,G==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:q.connectionType,onChange:t=>ge(r=>({...r,connectionType:t.target.value})),children:oa.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),q.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:q.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:q.word,onChange:t=>ge(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),le&&e.jsx("p",{className:"cogita-help",children:le})]}),q.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:q.word,onChange:t=>ge(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:q.topic,onChange:t=>ge(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),q.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:q.wordA,onChange:t=>ge(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:q.wordB,onChange:t=>ge(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),q.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:q.quote,onChange:t=>ge(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:q.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),q.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:q.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:q.sentence,onChange:t=>ge(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),q.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:q.referencedInfoType,onChange:t=>ge(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:ze.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(We,{libraryId:l,infoType:q.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:q.referencedInfo,onChange:t=>ge(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,q.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:q.source,onChange:t=>ge(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),q.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:q.source,onChange:t=>ge(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:q.sourceResourceType,onChange:t=>ge(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Ke.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(We,{libraryId:l,infoType:q.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:q.sourceResource,onChange:t=>ge(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,q.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),q.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:q.work,onChange:t=>ge(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:q.contributorType,onChange:t=>ge(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ra(a,t)},t))})]}),e.jsx(We,{libraryId:l,infoType:q.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:q.contributor,onChange:t=>ge(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,q.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:q.contributorRole,onChange:t=>ge(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),q.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:q.work,onChange:t=>ge(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:q.medium,onChange:t=>ge(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),q.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:q.orcidEntityType,onChange:t=>ge(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:ra(a,t)},t))})]}),e.jsx(We,{libraryId:l,infoType:q.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:q.orcidEntity,onChange:t=>ge(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,q.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(We,{libraryId:l,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:q.orcid,onChange:t=>ge(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:q.note,onChange:t=>ge(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:v,children:a.cogita.library.add.connection.save})})]}):null,G==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:o.groupType,onChange:t=>ee(r=>({...r,groupType:t.target.value})),children:Re.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),o.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:o.citationLanguage,onChange:t=>ee(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:o.citationTitle,onChange:t=>ee(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:o.citationQuoteText,onChange:t=>ee(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:o.citationReferenceEnabled,onChange:t=>ee(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),o.citationReferenceEnabled&&e.jsx(Fr,{libraryId:l,copy:a,language:A,sourceKindOptions:W,labels:X,value:{sourceKind:o.citationSourceKind,locatorValue:o.citationLocatorValue,locatorAux:o.citationLocatorAux,bibleBookDisplay:o.citationBibleBookDisplay,sourceUrl:o.citationSourceUrl,sourceAccessedDate:o.citationSourceAccessedDate,churchDocument:o.citationChurchDocument,bookMedia:o.citationBookMedia,work:o.citationWork},onChange:t=>ee(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),o.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:o.bookTitle,onChange:t=>ee(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:o.bookPublisher,onChange:t=>ee(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:o.bookPublicationPlace,onChange:t=>ee(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:o.bookPublicationYear,onChange:t=>ee(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:o.bookPages,onChange:t=>ee(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:o.bookIsbn,onChange:t=>ee(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:o.bookCover,onChange:t=>ee(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:o.bookHeight,onChange:t=>ee(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:o.bookLength,onChange:t=>ee(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:o.bookWidth,onChange:t=>ee(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:o.bookWeight,onChange:t=>ee(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:o.bookCollection,onChange:t=>ee(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:o.bookLocation,onChange:t=>ee(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:o.bookWorkTitle,onChange:t=>ee(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:o.bookWorkLanguage,onChange:t=>ee(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:o.bookWorkOriginalLanguage,onChange:t=>ee(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:o.bookWorkDoi,onChange:t=>ee(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>ee(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),o.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:u=>ee(N=>({...N,bookContributors:N.bookContributors.map((V,te)=>te===r?{...V,contributorType:u.target.value,contributor:null}:V)})),children:["person","institution","collective"].map(u=>e.jsx("option",{value:u,children:ra(a,u)},u))})]}),e.jsx(We,{libraryId:l,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:u=>ee(N=>({...N,bookContributors:N.bookContributors.map((V,te)=>te===r?{...V,contributor:u}:V)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",ra(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:u=>ee(N=>({...N,bookContributors:N.bookContributors.map((V,te)=>te===r?{...V,role:u.target.value}:V)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>ee(u=>{const N=u.bookContributors.filter((V,te)=>te!==r);return N.length===0?{...u,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...u,bookContributors:N}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),o.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:o.languageA,onChange:t=>ee(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:o.languageB,onChange:t=>ee(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:o.wordA,onChange:t=>ee(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Qe,autoAdvance:!0,onCommit:()=>{var t;return(t=Oe.current)==null?void 0:t.focus()}}),e.jsx(We,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:o.wordB,onChange:t=>ee(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Oe,autoAdvance:!0,onCommit:()=>{var t;return(t=Fe.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:o.translationTags,onChangeMultiple:t=>ee(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:o.wordATags,onChangeMultiple:t=>ee(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:o.wordBTags,onChangeMultiple:t=>ee(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),o.groupType==="vocab"&&Le&&e.jsx("p",{className:"cogita-help",children:Le}),o.groupType==="vocab"&&De&&e.jsx("p",{className:"cogita-help",children:De}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:T,ref:Fe,children:Q})})]}):null,w?e.jsx("p",{className:"cogita-form-error",children:w}):null]})})})})})]})})}const Ar=a=>/\s/.test(a),At=a=>/[\p{L}\p{N}]/u.test(a),Br=(a,n)=>{const s=n>0?a[n-1]:"",h=n<a.length?a[n]:"";if(!s||!h)return 0;const g=Ar(s),k=Ar(h);if(g||k)return 3;const f=At(s),P=At(h);return f!==P?2:!f&&!P?1:0},lr=(a,n,s,h,g)=>{const k=Math.max(h-n,s-h);for(let f=0;f<=k;f+=1){const P=h-f;if(P>=n&&P<=s&&Br(a,P)>=g)return P;const A=h+f;if(A>=n&&A<=s&&Br(a,A)>=g)return A}return null},or=(a,n)=>{const s=n>0?a[n-1]:"",h=n<a.length?a[n]:"";return!s||!h?!0:At(s)!==At(h)},nn=(a,n,s,h)=>{const g=s-n,k=n+h,f=s-h;if(g<=h*2||f<=k)return null;const P=Math.floor((n+s)/2),A=lr(a,k,f,P,3);if(A!==null&&or(a,A))return A;const K=lr(a,k,f,P,2);if(K!==null&&or(a,K))return K;const l=lr(a,k,f,P,1);return l!==null&&or(a,l)?l:null},bt=(a,n)=>{const s=Math.max(1,7),h=Math.max(s,13),g={},k=(A,K,l,S,m)=>{const y=String(S),_={id:y,start:A,end:K,text:a.slice(A,K),depth:l,index:S,parentId:m};if(g[y]=_,K-A>h){let U=nn(a,A,K,s);if(U!==null&&U>A&&U<K){const d=k(A,U,l+1,S*2+1,y),b=k(U,K,l+1,S*2+2,y);_.leftId=d.id,_.rightId=b.id}}return _},f=k(0,a.length,0,0),P=Object.values(g).sort((A,K)=>K.depth-A.depth||A.start-K.start).map(A=>A.id);return{text:a,rootId:f.id,nodes:g,order:P}},gt=(a,n,s,h,g,k,f)=>{const P=k==="reverse"?a.order.slice().sort((A,K)=>a.nodes[K].start-a.nodes[A].start||a.nodes[K].depth-a.nodes[A].depth):a.order;for(const A of P){if(f&&A===f||n.has(A))continue;const K=a.nodes[A];if(K){if(g&&(K.leftId||K.rightId)){const l=K.leftId?s[K.leftId]??0:h,S=K.rightId?s[K.rightId]??0:h;if((l+S)/2<h)continue}return K}}return null},Gr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function ln({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l}){const S=`/#/cogita/library/${l}`,[m,y,_]=yr([]),[G,U,d]=vr([]),[b,p]=i.useState(null),[ae,B]=i.useState(null),[j,Y]=i.useState(null),[$,oe]=i.useState(null),D=i.useMemo(()=>m.find(o=>o.id===b)??null,[m,b]);i.useEffect(()=>{let o=!0;return xi({libraryId:l}).then(ee=>{if(!o)return;const w=ee.nodes.map(M=>{var ye,ie,le;return{id:M.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:M.payload&&typeof M.payload=="object"&&"label"in M.payload?String(M.payload.label):"Item",nodeType:M.nodeType,itemType:((ye=M.payload)==null?void 0:ye.itemType)??"info",itemId:((ie=M.payload)==null?void 0:ie.itemId)??null,infoType:((le=M.payload)==null?void 0:le.infoType)??null}}});y(w),U(ee.edges.map(M=>({id:M.edgeId,source:M.fromNodeId,target:M.toNodeId})))}).catch(()=>{o&&(y([]),U([]))}),()=>{o=!1}},[l]),i.useEffect(()=>{yi({libraryId:l}).then(B).catch(()=>B(null))},[l,m,G]);const O=i.useCallback(o=>{U(ee=>jt(o,ee))},[]),be=()=>{const o=crypto.randomUUID();y(ee=>[...ee,{id:o,type:"default",position:{x:140+ee.length*40,y:120+ee.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},ke=()=>{const o=crypto.randomUUID();y(ee=>[...ee,{id:o,type:"default",position:{x:180+ee.length*40,y:160+ee.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ce=async()=>{Y(null);try{const o=m.map(w=>({nodeId:w.id,nodeType:w.data.nodeType,payload:{itemType:w.data.itemType,itemId:w.data.itemId??null,label:w.data.label,infoType:w.data.infoType??null}})),ee=G.map(w=>({edgeId:w.id,fromNodeId:w.source,toNodeId:w.target}));await vi({libraryId:l,nodes:o,edges:ee}),Y(a.cogita.library.graph.saveSuccess)}catch{Y(a.cogita.library.graph.saveFail)}},q=o=>{D&&y(ee=>ee.map(w=>w.id===D.id?{...w,data:{...w.data,itemId:(o==null?void 0:o.infoId)??null,itemType:"collection",infoType:"collection",label:(o==null?void 0:o.label)??a.cogita.library.infoTypes.collection}}:w))},ge=o=>{D&&y(ee=>ee.map(w=>w.id===D.id?{...w,data:{...w.data,itemId:(o==null?void 0:o.infoId)??null,itemType:"info",infoType:(o==null?void 0:o.infoType)??null,label:(o==null?void 0:o.label)??a.cogita.library.infoTypes.any}}:w))};return i.useEffect(()=>{if(!D||D.data.nodeType!=="info"||D.data.infoType!=="quote"||!D.data.itemId){oe(null);return}let o=!0;return Za({libraryId:l,infoId:D.data.itemId}).then(ee=>{if(!o)return;const w=ee.payload,M=(w==null?void 0:w.text)??"";if(!M){oe(null);return}const ye=bt(M),ie=Object.values(ye.nodes).sort((le,we)=>le.depth-we.depth||le.start-we.start).map(le=>({id:le.id,text:le.text,depth:le.depth}));oe({title:(w==null?void 0:w.title)??D.data.label,fragments:ie})}).catch(()=>oe(null)),()=>{o=!1}},[l,D]),e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:S,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ce,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:be,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ke,children:a.cogita.library.actions.addInfo}),ae?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(ae.totalCollections))})}):null,j?e.jsx("p",{className:"cogita-help",children:j}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Ut,{nodes:m,edges:G,onNodesChange:_,onEdgesChange:d,onConnect:O,onNodeClick:(o,ee)=>p(ee.id),fitView:!0,children:[e.jsx(Wt,{gap:18,size:1}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),D?e.jsxs("div",{className:"cogita-graph-inspector",children:[D.data.nodeType==="collection"?e.jsx(We,{libraryId:l,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:D.data.itemId?{id:D.data.itemId,label:D.data.label,infoType:"collection"}:null,onChange:q,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(We,{libraryId:l,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:D.data.itemId?{id:D.data.itemId,label:D.data.label,infoType:D.data.infoType??void 0}:null,onChange:ge,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),$?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:$.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:$.fragments.map(o=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:o.id}),e.jsx("span",{children:o.text})]},o.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function on({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l,collectionId:S}){const{libraryName:m}=Ua(l),[y,_]=i.useState([]),[G,U]=i.useState("loading"),[d,b]=i.useState("idle"),p=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ae=`/#/cogita/library/${l}`,B=()=>{U("loading"),Ur({libraryId:l}).then($=>{_($),U("idle")}).catch(()=>{_([]),U("error")})};i.useEffect(()=>{B()},[l]);const j=async $=>{try{await Wr({libraryId:l,shareId:$}),B()}catch{B()}},Y=async $=>{const oe=`${p}/${$}`;try{await navigator.clipboard.writeText(oe),b("copied")}catch{b("failed")}};return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:ae,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${ae}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[G==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):G==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):y.filter($=>!S||$.collectionId===S).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:y.filter($=>!S||$.collectionId===S).map($=>e.jsxs("div",{className:"cogita-share-row","data-state":$.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:$.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date($.createdUtc).toLocaleString(),$.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),$.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${p}/${$.shareCode}`}):null]}),$.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[$.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>Y($.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>j($.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},$.shareId))}),d==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):d==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function sn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l}){const{libraryName:S}=Ua(l),m=`/#/cogita/library/${l}`,[y,_]=i.useState(""),[G,U]=i.useState([]),[d,b]=i.useState("idle"),[p,ae]=i.useState(0),[B,j]=i.useState(null);i.useEffect(()=>{b("loading");const $=window.setTimeout(()=>{Rt({libraryId:l,query:y.trim()||void 0,limit:30}).then(oe=>{U(oe.items),ae(oe.total),j(oe.nextCursor??null),b("ready")}).catch(()=>{U([]),ae(0),j(null),b("ready")})},240);return()=>window.clearTimeout($)},[l,y]);const Y=async()=>{if(B){b("loading");try{const $=await Rt({libraryId:l,query:y.trim()||void 0,limit:30,cursor:B});U(oe=>[...oe,...$.items]),j($.nextCursor??null),ae($.total),b("ready")}catch{b("ready")}}};return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:S}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${m}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:y,onChange:$=>_($.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(G.length)).replace("{total}",String(p||G.length))}),e.jsx("span",{children:d==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:G.length?G.map($=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${m}/collections/${$.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:$.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String($.itemCount))," ·"," ",$.notes||a.cogita.library.collections.noNotes]})]})},$.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${m}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),B?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Y,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const Dr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],cn={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},dn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],un=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function gn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l,onCreated:S}){const{libraryName:m}=Ua(l),y=`/#/cogita/library/${l}`,[_,G]=i.useState(null),[U,d]=i.useState(""),[b,p]=i.useState(""),[ae,B,j]=yr([]),[Y,$,oe]=vr([]),[D,O]=i.useState(null),[be,ke]=i.useState(null),ce=i.useMemo(()=>ae.find(w=>w.id===D)??null,[ae,D]),q=w=>{var le;const M=crypto.randomUUID(),ye=((le=Dr.find(we=>we.type===w))==null?void 0:le.label)??w,ie={...cn[w]};B(we=>[...we,{id:M,type:"default",position:{x:120+we.length*40,y:120+we.length*40},data:{nodeType:w,label:ye,params:ie}}]),O(M)},ge=i.useCallback(w=>{$(M=>jt({...w,id:crypto.randomUUID()},M))},[$]),o=w=>{ce&&B(M=>M.map(ye=>ye.id===ce.id?{...ye,data:{...ye.data,params:w}}:ye))},ee=async()=>{if(ke(null),!U.trim()){ke(a.cogita.library.collections.saveRequiredName);return}try{const w={nodes:ae.map(ie=>({nodeId:ie.id,nodeType:ie.data.nodeType,payload:{position:ie.position,params:ie.data.params}})),edges:Y.map(ie=>({edgeId:ie.id,fromNodeId:ie.source,fromPort:ie.sourceHandle??null,toNodeId:ie.target,toPort:ie.targetHandle??null}))};let M=_,ye=!1;if(M)await Hr({libraryId:l,collectionId:M,nodes:w.nodes,edges:w.edges});else{const ie=await zr({libraryId:l,name:U.trim(),notes:b.trim()||void 0,items:[],graph:w});M=ie.collectionId,ye=!0,G(ie.collectionId)}ke(ye?a.cogita.library.collections.saveSuccess:a.cogita.library.graph.saveSuccess),S(M)}catch{ke(_?a.cogita.library.graph.saveFail:a.cogita.library.collections.saveFail)}};return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.createKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.createSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:y,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${y}/collections`,children:a.cogita.library.actions.collections}),e.jsx("button",{type:"button",className:"cta",onClick:ee,children:a.cogita.library.actions.saveCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.collectionInfoTitle}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{value:U,onChange:w=>d(w.target.value),placeholder:a.cogita.library.collections.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.notesLabel}),e.jsx("textarea",{value:b,onChange:w=>p(w.target.value),placeholder:a.cogita.library.collections.notesPlaceholder})]}),be?e.jsx("p",{className:"cogita-help",children:be}):null,e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:Dr.map(w=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>q(w.type),children:w.label},w.type))})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Ut,{nodes:ae,edges:Y,onNodesChange:j,onEdgesChange:oe,onConnect:ge,onNodeClick:(w,M)=>O(M.id),fitView:!0,children:[e.jsx(Wt,{color:"rgba(120,160,200,0.2)"}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),ce?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:ce.data.label}),ce.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:ce.data.params.tagId?{id:ce.data.params.tagId,label:ce.data.params.tagLabel??"",infoType:"topic"}:null,onChange:w=>o({...ce.data.params,tagId:(w==null?void 0:w.id)??null,tagLabel:(w==null?void 0:w.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:ce.data.params.scope??"any",onChange:w=>o({...ce.data.params,scope:w.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),ce.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:ce.data.params.languageId?{id:ce.data.params.languageId,label:ce.data.params.languageLabel??"",infoType:"language"}:null,onChange:w=>o({...ce.data.params,languageId:(w==null?void 0:w.id)??null,languageLabel:(w==null?void 0:w.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:ce.data.params.scope??"any",onChange:w=>o({...ce.data.params,scope:w.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),ce.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:ce.data.params.infoType??"word",onChange:w=>o({...ce.data.params,infoType:w.target.value}),children:un.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),e.jsx(We,{libraryId:l,infoType:ce.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:ce.data.params.infoId?{id:ce.data.params.infoId,label:ce.data.params.infoLabel??"",infoType:ce.data.params.infoType??"word"}:null,onChange:w=>o({...ce.data.params,infoId:(w==null?void 0:w.id)??null,infoLabel:(w==null?void 0:w.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),ce.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:ce.data.params.connectionType??"translation",onChange:w=>o({...ce.data.params,connectionType:w.target.value}),children:dn.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:ce.data.params.connectionId??"",onChange:w=>o({...ce.data.params,connectionId:w.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(ce.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function hn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l,collectionId:S}){Ua(l);const m=`/#/cogita/library/${l}`,[y,_]=i.useState(a.cogita.library.collections.defaultName),[G,U]=i.useState(null),[d,b]=i.useState(0),[p,ae]=i.useState([]),[B,j]=i.useState("idle"),[Y,$]=i.useState(null),oe=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(p.length)).replace("{total}",String(d||p.length)),[a,p.length,d]);i.useEffect(()=>{Ht(l,S).then(O=>{_(O.name),U(O.notes??null),b(O.itemCount)}).catch(()=>{_(a.cogita.library.collections.defaultName),U(null)})},[l,S]),i.useEffect(()=>{j("loading"),Et({libraryId:l,collectionId:S,limit:40}).then(O=>{ae(O.items),$(O.nextCursor??null),b(O.total),j("ready")}).catch(()=>{ae([]),$(null),j("ready")})},[l,S]);const D=async()=>{if(Y){j("loading");try{const O=await Et({libraryId:l,collectionId:S,limit:40,cursor:Y});ae(be=>[...be,...O.items]),$(O.nextCursor??null),b(O.total),j("ready")}catch{j("ready")}}};return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:y}),e.jsx("p",{className:"cogita-library-subtitle",children:G||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${m}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${m}/collections/${S}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${m}/collections/${S}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:oe}),e.jsx("span",{children:B==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:p.length?p.map(O=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:O.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:O.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:O.label}),e.jsx("p",{className:"cogita-card-subtitle",children:O.description})]})},me(O))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),Y?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:D,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${m}/collections/${S}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Fa=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,s=a.filter(k=>k.correct).length,h=Jt(wr(a));return{score:Math.round(Math.max(0,Math.min(100,h.knowness*100))*100)/100,total:n,correct:s,lastReviewedUtc:h.lastReviewedUtc??null}},bn=a=>{if(a.maskBase64)try{const n=ji(a.maskBase64);if(!n.length)return a.correct?1:0;const s=n.reduce((h,g)=>h+g,0);return Math.max(0,Math.min(1,s/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},wr=a=>a.map(n=>({correctness:bn(n),createdUtc:n.createdUtc})),Jt=(a,n=Date.now())=>{var d;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const h=a.slice().sort((b,p)=>b.createdUtc.localeCompare(p.createdUtc)).slice(-5),g=h.reduce((b,p)=>b+p.correctness,0)/h.length,k=5,f=2,P=.15;let A=0,K=0;for(let b=0;b<h.length;b+=1){const p=new Date(h[b].createdUtc).getTime(),ae=b===h.length-1?n:new Date(h[b+1].createdUtc).getTime(),B=Math.max(0,(ae-p)/(1e3*60)),j=1-Math.exp(-B/k);A+=j,h[b].correctness>.5&&(K+=P)}let l=g*A*f+K;const S=((d=h[h.length-1])==null?void 0:d.createdUtc)??null,m=S?Math.max(0,(n-new Date(S).getTime())/(1e3*60)):0,_=1/(1+Math.log1p(m/60));return l*=_,h.length===1&&h[0].correctness>.5&&(l+=5.44*Math.exp(-m/2)),{knowness:l,avgCorrectness:g,lastReviewedUtc:S}},kt=a=>{const n=a.slice();for(let s=n.length-1;s>0;s-=1){const h=Math.floor(Math.random()*(s+1));[n[s],n[h]]=[n[h],n[s]]}return n},Pt=a=>a[Math.floor(Math.random()*a.length)],mn=(a,n)=>{const s=new Map;return a.forEach(h=>s.set(h,Math.random())),a.sort((h,g)=>{const k=n(h)-n(g);return k!==0?k:(s.get(h)??0)-(s.get(g)??0)})},Yt=(a,n,s,h,g)=>{if(!a.length)return null;const k=a.filter(P=>!(g!=null&&g.has(me(P))));if(k.length===0)return null;const f=k.filter(P=>me(P)!==s);return Pt(f.length?f:k)},pn=(a,n,s,h,g)=>{if(!a.length)return null;let k=Number.POSITIVE_INFINITY;for(const K of a){const l=me(K);if(s.has(l))continue;const S=n[l]??1;S<k&&(k=S)}if(!Number.isFinite(k))return null;const f=a.filter(K=>{const l=me(K);return!s.has(l)&&(n[l]??1)===k}),P=f.filter(K=>!g||me(K)!==g),A=h?P.filter(K=>!h.has(me(K))):P;return A.length>0?Pt(A):P.length>0?Pt(P):g&&f.some(K=>me(K)===g)?f.find(K=>me(K)===g)??null:f.length?Pt(f):null},Xr=(a,n,s,h,g)=>{const k=[],f=a.filter(A=>!g.has(me(A))&&!s.has(me(A))&&(n[me(A)]??0)<1),P=mn(f,A=>n[me(A)]??0);for(const A of P){if(k.length>=h)break;k.push(A),g.add(me(A))}if(k.length<h){const A=kt(a.filter(K=>!g.has(me(K))&&s.has(me(K))));for(const K of A){if(k.length>=h)break;k.push(K),g.add(me(K))}}return k},fn=(a,n,s,h)=>Xr(a,n,s,h,new Set),Tr=(a,n,s,h,g,k)=>{const f=Math.max(1,s.stackSize??n),A=kt(a).filter((_,G,U)=>U.findIndex(d=>me(d)===me(_))===G),K=fn(A,h,g,f),l=new Set,S=new Set,m=Yt(K,{},null,l,S),y=m?[m]:[];return m&&S.add(me(m)),{queue:y,meta:{pool:A,active:K,knownessMap:h,unknownSet:g,outcomesById:k,asked:l,queued:S}}},fr={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const h=kt(a).filter((g,k,f)=>f.findIndex(P=>me(P)===me(g))===k);return{queue:h.slice(0,Math.min(n,h.length)),meta:{}}},applyOutcome:a=>a},Nr=(a,n,s,h)=>{const g=Math.max(1,s.stackSize??n),f=kt(a).filter((G,U,d)=>d.findIndex(b=>me(b)===me(G))===U),P={},A=new Set,K=new Set,l=new Set,S=Math.max(1,s.levels??1);f.forEach(G=>{const U=me(G),d=h==null?void 0:h[U],b=typeof d=="number"&&Number.isFinite(d)?d:1;P[U]=Math.min(S,Math.max(1,Math.round(b)))});const m=[];if(f.length>0){const G=new Map;f.forEach(d=>{var p;const b=P[me(d)]??1;G.has(b)||G.set(b,[]),(p=G.get(b))==null||p.push(d)});const U=Array.from(G.keys()).sort((d,b)=>d-b);for(const d of U){if(m.length>=g)break;const b=kt(G.get(d)??[]);for(const p of b){if(m.length>=g)break;m.push(p)}}}const y=Yt(m,P,null,A,K),_=y?[y]:[];return y&&K.add(me(y)),{queue:_,meta:{pool:f,active:m,levelMap:P,asked:A,queued:K,wrongSinceCorrect:l}}},xn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,s)=>Nr(a,n,s),applyOutcome:(a,n,s,h,g)=>{if(!n)return a;const k=Math.max(1,h.levels??1),f=a.meta.pool??[],P=a.meta.active??[],A={...a.meta.levelMap??{}},K=new Set(a.meta.asked??[]),l=new Set(a.meta.queued??[]),S=new Set(a.meta.wrongSinceCorrect??[]),m=me(n);l.delete(m),K.add(m);const y=A[m]??1;g.correct?(A[m]=S.has(m)?1:Math.min(y+1,k),S.delete(m)):(A[m]=1,S.add(m));const _=g.correct?P.filter(d=>me(d)!==m):P.slice();if(g.correct&&_.length<Math.max(1,h.stackSize??1)){const d=new Set(_.map(p=>me(p))),b=pn(f,A,d,K,m);b&&_.push(b)}const G=a.queue.slice(),U=Yt(_,A,m,K,l);return U&&(G.push(U),l.add(me(U))),{queue:G,meta:{pool:f,active:_,levelMap:A,asked:K,queued:l,wrongSinceCorrect:S}}}},yn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,s)=>Tr(a,n,s,{},new Set,{}),applyOutcome:(a,n,s,h,g)=>{if(!n)return a;const k=a.meta.pool??[],f=a.meta.active??[],P={...a.meta.knownessMap??{}},A=new Set(a.meta.unknownSet??[]),K={...a.meta.outcomesById??{}},l=new Set(a.meta.asked??[]),S=new Set(a.meta.queued??[]),m=me(n);S.delete(m),l.add(m);const y={correctness:Math.max(0,Math.min(1,g.correctness??(g.correct?1:0))),createdUtc:g.createdUtc??new Date().toISOString()},G=(K[m]??[]).concat(y).sort((B,j)=>B.createdUtc.localeCompare(j.createdUtc)).slice(-5);K[m]=G,A.delete(m);const U=Date.now();k.forEach(B=>{const j=me(B),Y=K[j]??[];if(Y.length===0){P[j]=0,A.add(j);return}const $=Jt(Y,U);P[j]=$.knowness});const d=f.slice();if((P[m]??0)>=1){const B=d.filter(j=>me(j)!==m);d.length=0,d.push(...B)}const p=Math.max(1,h.stackSize??s);if(d.length<p){const B=new Set(d.map(Y=>me(Y))),j=Xr(k,P,A,p-d.length,B);d.push(...j)}const ae=a.queue.slice();if(ae.length===0||me(ae[ae.length-1])===m){const B=Yt(d,{},m,l,S);B&&(ae.push(B),S.add(me(B)))}return{queue:ae,meta:{pool:k,active:d,knownessMap:P,unknownSet:A,outcomesById:K,asked:l,queued:S}}}},Zr={random:fr,levels:xn,temporal:yn},vn=Object.values(Zr),Lr=a=>{if(!a)return fr;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?Zr[n]:fr},Qt=(a,n)=>{const s={...a.defaultSettings};return n&&Object.entries(n).forEach(([h,g])=>{typeof g=="number"&&Number.isFinite(g)&&(s[h]=g),typeof g=="string"&&(s[h]=g)}),a.settingsFields.forEach(h=>{var k;const g=s[h.key];if(h.type==="number"){if(typeof g!="number"||Number.isNaN(g)){s[h.key]=a.defaultSettings[h.key]??0;return}h.min!==void 0&&(s[h.key]=Math.max(h.min,s[h.key])),h.max!==void 0&&(s[h.key]=Math.min(h.max,s[h.key]));return}if(h.type==="select"){const f=((k=h.options)==null?void 0:k.map(P=>P.value))??[];(typeof g!="string"||f.length>0&&!f.includes(g))&&(s[h.key]=a.defaultSettings[h.key]??f[0]??"")}}),s},ei=(a,n)=>{const s={};return a.settingsFields.forEach(h=>{const g=n.get(h.key);if(g){if(h.type==="number"){const k=Number(g);Number.isNaN(k)||(s[h.key]=k);return}s[h.key]=g}}),Qt(a,s)},jn=(a,n)=>{const s=new URLSearchParams;return a.settingsFields.forEach(h=>{const g=n[h.key];(typeof g=="number"||typeof g=="string")&&s.set(h.key,String(g))}),s};function kn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l,collectionId:S,revisionId:m}){const{libraryName:y}=Ua(l),_=`/#/cogita/library/${l}`,[G,U]=i.useState(a.cogita.library.collections.defaultName),[d,b]=i.useState(""),[p,ae]=i.useState(20),[B,j]=i.useState("random"),[Y,$]=i.useState({}),[oe,D]=i.useState("exact"),[O,be]=i.useState([]),[ke,ce]=i.useState(null),[q,ge]=i.useState([]),[o,ee]=i.useState("idle"),[w,M]=i.useState(null),[ye,ie]=i.useState("idle"),[le,we]=i.useState("idle"),[Le,Ne]=i.useState("idle"),De=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Me=i.useMemo(()=>Lr(B),[B]),Qe=i.useMemo(()=>Qt(Me,Y),[Me,Y]),Oe=i.useMemo(()=>jn(Me,Qe).toString(),[Me,Qe]);i.useEffect(()=>{Ht(l,S).then(X=>U(X.name)).catch(()=>U(a.cogita.library.collections.defaultName))},[l,S]),i.useEffect(()=>{m&&ki({libraryId:l,collectionId:S,revisionId:m}).then(X=>{b(X.name),j(X.mode||"random"),D(X.check||"exact"),ae(X.limit||20),$(X.revisionSettings??{})}).catch(()=>{b("")})},[S,l,m]),i.useEffect(()=>{wi({libraryId:l}).then(X=>{be(X),!ke&&X.length>0&&ce(X[0].roleId)}).catch(()=>{be([])})},[l]);const Fe=()=>{we("loading"),Ur({libraryId:l}).then(X=>{ge(X),we("idle")}).catch(()=>{ge([]),we("error")})};i.useEffect(()=>{Fe()},[l]);const ze=async()=>{ee("working"),ie("idle");try{const X=await Ni({libraryId:l,collectionId:S,revisionType:Me.id,revisionSettings:Qe,mode:B,check:oe,limit:p});M(`${De}/${X.shareCode}${Oe?`?${Oe}`:""}`),ee("ready"),Fe()}catch{ee("error")}},oa=async()=>{if(m){Ne("saving");try{await Ti({libraryId:l,collectionId:S,revisionId:m,name:d||G,revisionType:Me.id,revisionSettings:Qe,mode:B,check:oe,limit:p}),Ne("saved")}catch{Ne("error")}}},Re=async()=>{if(w)try{await navigator.clipboard.writeText(w),ie("copied")}catch{ie("failed")}},W=async X=>{try{await Wr({libraryId:l,shareId:X}),Fe()}catch{Fe()}};return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:G}),e.jsx("p",{className:"cogita-library-subtitle",children:y})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:_,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${_}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${_}/collections/${S}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${_}/collections/${S}/revision/run?mode=${encodeURIComponent(B)}&check=${encodeURIComponent(oe)}&limit=${p}${Oe?`&${Oe}`:""}${ke?`&reviewer=${encodeURIComponent(ke)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:d,onChange:X=>b(X.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:B,onChange:X=>j(X.target.value),children:vn.map(X=>e.jsx("option",{value:X.id,children:a.cogita.library.revision[X.labelKey]},X.id))})]}),Me.settingsFields.map(X=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[X.labelKey]}),X.type==="select"?e.jsx("select",{value:String(Qe[X.key]??""),onChange:Ke=>$(Ce=>({...Ce,[X.key]:Ke.target.value})),children:(X.options??[]).map(Ke=>e.jsx("option",{value:Ke.value,children:a.cogita.library.revision[Ke.labelKey]},Ke.value))}):e.jsx("input",{type:"number",min:X.min,max:X.max,step:X.step,value:Qe[X.key]??0,onChange:Ke=>$(Ce=>({...Ce,[X.key]:Number(Ke.target.value||0)}))})]},X.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),Me.id!=="levels"&&Me.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:p,onChange:X=>ae(Number(X.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:ke??"",onChange:X=>ce(X.target.value||null),children:O.map(X=>e.jsx("option",{value:X.roleId,children:X.label},X.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[m?e.jsx("button",{type:"button",className:"cta ghost",onClick:oa,disabled:Le==="saving",children:Le==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${_}/collections/${S}/revision/run?mode=${encodeURIComponent(B)}&check=${encodeURIComponent(oe)}&limit=${p}${Oe?`&${Oe}`:""}${ke?`&reviewer=${encodeURIComponent(ke)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Le==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),w?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:w,readOnly:!0})]}):null,o==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,ye==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):ye==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:ze,disabled:o==="working",children:o==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),w?e.jsx("button",{type:"button",className:"cta ghost",onClick:Re,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),le==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):q.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:q.map(X=>e.jsxs("div",{className:"cogita-share-row","data-state":X.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:X.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(X.createdUtc).toLocaleString(),X.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),X.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>W(X.shareId),children:a.cogita.library.revision.shareRevokeAction})]},X.shareId))})]})]})]})]})})})]})})}function ai({copy:a,currentCard:n,currentTypeLabel:s,prompt:h,languages:g,answer:k,onAnswerChange:f,computedExpected:P,computedAnswers:A,onComputedAnswerChange:K,answerTemplate:l,outputVariables:S,variableValues:m,computedFieldFeedback:y,feedback:_,canAdvance:G,quoteContext:U,quotePlaceholder:d,onCheckAnswer:b,onSkip:p,onLanguageSelect:ae,onMarkReviewed:B,onAdvance:j,showCorrectAnswer:Y,setShowCorrectAnswer:$,onRevealCorrect:oe,answerMask:D,expectedAnswer:O,hasExpectedAnswer:be,handleComputedKeyDown:ke,answerInputRef:ce,computedInputRefs:q,scriptMode:ge,setScriptMode:o,matchPairs:ee,matchLeftOrder:w,matchRightOrder:M,matchSelection:ye,matchActiveLeft:ie,matchActiveRight:le,matchFeedback:we,onMatchLeftSelect:Le,onMatchRightSelect:Ne}){const De=i.useMemo(()=>{var Q;const W=!l&&P.length===2?`The {${P[0].key}} is of type {${P[1].key}}`:null,X=l??W;if(!X)return null;const Ke=new Map(P.map(t=>[t.key,t.expected])),Ce=new Set,pe=[],Pe=/\{([^}]+)\}/g;let Ve=0,qe,Be=null;for(;(qe=Pe.exec(X))!==null;){const t=X.slice(Ve,qe.index);t&&pe.push({type:"text",value:t});const r=((Q=qe[1])==null?void 0:Q.trim())??"",u=r&&Ke.has(r)?r:r&&S&&S[r]?S[r]:null;r&&Ce.add(r),u&&Ce.add(u),u&&Ke.has(u)?(pe.push({type:"input",value:u}),Be||(Be=u)):r&&m&&m[r]!==void 0?pe.push({type:"text",value:m[r]}):pe.push({type:"text",value:qe[0]}),Ve=qe.index+qe[0].length}const v=X.slice(Ve);return v&&pe.push({type:"text",value:v}),P.filter(t=>!Ce.has(t.key)).length>0?null:{parts:pe,expectedByKey:Ke,firstInputKey:Be}},[l,P,S,m]),Me=()=>{if(!De)return null;const{parts:W,expectedByKey:X,firstInputKey:Ke}=De;return e.jsx("div",{className:"cogita-revision-inline-answer",children:W.map((Ce,pe)=>{var Pe,Ve;return Ce.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Ce.value},`text-${pe}`):e.jsx("input",{ref:qe=>{q.current[Ce.value]=qe},autoFocus:Ce.value===Ke,value:A[Ce.value]??"",onChange:qe=>K(Ce.value,qe.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":y[Ce.value]??(_==="correct"?"correct":_==="incorrect"?"incorrect":void 0),onKeyDown:qe=>ze(qe)||ke(qe),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Pe=A[Ce.value])==null?void 0:Pe.length)??0,((Ve=X.get(Ce.value))==null?void 0:Ve.length)??6)}ch`}},`input-${Ce.value}-${pe}`)})})},Qe=i.useMemo(()=>{const W=new Map;return(ee??[]).forEach(X=>W.set(X.leftId,X)),W},[ee]),Oe=i.useMemo(()=>{const W=new Map;return(ee??[]).forEach(X=>W.set(X.rightId,X)),W},[ee]);i.useEffect(()=>{var pe;if(n.cardType!=="info"||n.infoType!=="computed"||P.length===0)return;const W=typeof document<"u"?document.activeElement:null;if(W&&(W.tagName==="INPUT"||W.tagName==="TEXTAREA"))return;const X=(De==null?void 0:De.firstInputKey)??((pe=P[0])==null?void 0:pe.key);if(!X)return;const Ke=q.current[X];if(!Ke)return;const Ce=requestAnimationFrame(()=>{Ke.focus()});return()=>cancelAnimationFrame(Ce)},[n,P,De]);const Fe=(()=>{const W=[O??"",...P.map(Ce=>Ce.expected??"")].join(""),X=[k,...Object.values(A)].join(""),Ke=`${W}${X}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Ke)})(),ze=W=>W.ctrlKey&&(W.key==="^"||W.key==="6")?(W.preventDefault(),o(X=>X==="super"?null:"super"),!0):W.ctrlKey&&(W.key==="_"||W.key==="-")?(W.preventDefault(),o(X=>X==="sub"?null:"sub"),!0):!1,oa=()=>{if(!O||!D)return O??"";const W=O.split(""),X=Array.from(D),Ke=X.length>0?X.reduce((Ce,pe)=>Ce+pe,0)/X.length:127;return W.map((Ce,pe)=>{const Pe=X[pe]??Ke,Ve=Math.max(0,Math.min(255,Math.round(Pe)));let qe=255,Be=0;return Ve<=127?Be=Math.round(Ve/127*255):(Be=255,qe=Math.round(255*(1-(Ve-127)/128))),e.jsx("span",{style:{color:`rgb(${qe}, ${Be}, 0)`},children:Ce},`mask-${pe}`)})},Re=n.cardType==="info"&&n.infoType==="quote"?(U==null?void 0:U.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:s}),e.jsx("strong",{children:Re})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&ee?e.jsxs("div",{className:"cogita-revision-body",children:[h?e.jsx("h2",{children:h}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(w??[]).map(W=>{const X=Qe.get(W);if(!X)return null;const Ke=(ye==null?void 0:ye[W])??null,Ce=(we==null?void 0:we[W])??null,pe=ie===W;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":pe,"data-state":Ce??void 0,"data-locked":Ke?"true":void 0,onClick:()=>Le==null?void 0:Le(W),children:[e.jsx("span",{children:X.leftLabel}),Ke&&Y?e.jsx("em",{children:"✓"}):null]},W)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(M??[]).map(W=>{const X=Oe.get(W);if(!X)return null;const Ke=Object.values(ye??{}).includes(W),Ce=le===W;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Ke||Ce,"data-locked":Ke?"true":void 0,onClick:()=>Ne==null?void 0:Ne(W),children:e.jsx("span",{children:X.rightLabel})},W)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:h}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ce,value:k,onChange:W=>f(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":_==="correct"?"correct":_==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),G?j():b())}})]}),Fe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>o(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>o(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,l?null:e.jsx($t,{value:h??"",mode:"auto"}),P.length>0?(()=>{const W=Me();return W?e.jsx("div",{className:"cogita-inline-answer-wrap",children:W}):e.jsx("div",{className:"cogita-form-grid",children:P.map((X,Ke)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:X.key}),e.jsx("textarea",{ref:Ce=>{q.current[X.key]=Ce},autoFocus:Ke===0,value:A[X.key]??"",onChange:Ce=>K(X.key,Ce.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":y[X.key]??(_==="correct"?"correct":_==="incorrect"?"incorrect":void 0),onKeyDown:Ce=>ze(Ce)||ke(Ce)})]},X.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ce,value:k,onChange:W=>f(W.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":_==="correct"?"correct":_==="incorrect"?"incorrect":void 0,onKeyDown:W=>{ze(W)||W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),G?j():b())}})]})}),Fe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>o(W=>W==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>o(W=>W==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&U?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(U.completed)).replace("{total}",String(U.total))}),e.jsx("p",{className:"cogita-quote-text",children:U.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ce,value:k,onChange:W=>f(W.target.value),placeholder:d??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":_==="correct"?"correct":_==="incorrect"?"incorrect":void 0,onKeyDown:W=>{W.key==="Enter"&&(W.preventDefault(),W.stopPropagation(),G?j():b())}})]}),e.jsx("p",{className:"cogita-quote-text",children:U.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:h}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:g.length?g.map(W=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ae(W.label),children:W.label},W.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:h}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:B,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}),_&&e.jsx("div",{className:"cogita-revision-feedback","data-state":_,children:_==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),_==="incorrect"&&be?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>$(W=>{const X=!W;return X&&oe(),X}),children:a.cogita.library.revision.showAnswer}),Y?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),P.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[P.map(W=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:W.key}),e.jsx("span",{children:W.expected})]},W.key)),O?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:O})]}):null]}):e.jsx("p",{children:D?oa():O})]}):null]}):null,G?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:j,children:a.cogita.library.revision.nextQuestion})}):null]})}const sr=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ti({outcomes:a}){const[n,s]=i.useState("day"),h=i.useMemo(()=>{const g=sr.find(P=>P.id===n)??sr[1],k=Date.now()-g.ms,f=a.filter(P=>new Date(P.createdUtc).getTime()>=k);return Fa(f)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:sr.map(g=>e.jsx("button",{type:"button",className:"ghost","data-active":n===g.id,onClick:()=>s(g.id),children:g.label},g.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[h.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[h.correct," / ",h.total]})]})}const wn="cogita-revision",Tn=1,Bt="outcomes",Nn=()=>new Promise((a,n)=>{const s=indexedDB.open(wn,Tn);s.onupgradeneeded=()=>{const h=s.result;if(!h.objectStoreNames.contains(Bt)){const g=h.createObjectStore(Bt,{keyPath:"id"});g.createIndex("byItem","itemKey",{unique:!1}),g.createIndex("byPending","pending",{unique:!1})}},s.onerror=()=>n(s.error),s.onsuccess=()=>a(s.result)}),Tt=async(a,n)=>{const s=await Nn();return new Promise((h,g)=>{const k=s.transaction(Bt,a),f=k.objectStore(Bt);n(f).then(h).catch(g),k.onerror=()=>g(k.error)})},ri=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(s=>s.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Ln=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const s=ri();return localStorage.setItem(a,s),s},Cn=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),s=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(s)),s},ii=(a,n,s,h)=>Ea(a,n,s,h),Dt=async a=>{const n=Ln(),s=Cn(),h=new Date().toISOString(),g={...a,clientId:n,clientSequence:s,createdUtc:h,id:ri(),pending:!0};return await Tt("readwrite",k=>new Promise((f,P)=>{const A={...g,itemKey:ii(g.itemType,g.itemId,g.checkType,g.direction)},K=k.add(A);K.onsuccess=()=>f(),K.onerror=()=>P(K.error)})),g},Kt=async(a,n,s,h)=>{if(!n)return[];try{const g=ii(a,n,s,h);return await Tt("readonly",k=>new Promise((f,P)=>{const K=k.index("byItem").getAll(g);K.onsuccess=()=>{const S=(K.result??[]).map(m=>({itemType:m.itemType,itemId:m.itemId,checkType:m.checkType??null,direction:m.direction??null,revisionType:m.revisionType,evalType:m.evalType,correct:m.correct,createdUtc:m.createdUtc,maskBase64:m.maskBase64,payloadBase64:m.payloadBase64,payloadHashBase64:m.payloadHashBase64,clientId:m.clientId,clientSequence:m.clientSequence,personRoleId:m.personRoleId??null})).sort((m,y)=>m.createdUtc.localeCompare(y.createdUtc));f(S)},K.onerror=()=>P(K.error)}))}catch{return[]}},Aa=async()=>{try{return await Tt("readonly",a=>new Promise((n,s)=>{const h=a.getAll();h.onsuccess=()=>{const k=(h.result??[]).map(f=>({itemType:f.itemType,itemId:f.itemId,checkType:f.checkType??null,direction:f.direction??null,revisionType:f.revisionType,evalType:f.evalType,correct:f.correct,createdUtc:f.createdUtc,maskBase64:f.maskBase64,payloadBase64:f.payloadBase64,payloadHashBase64:f.payloadHashBase64,clientId:f.clientId,clientSequence:f.clientSequence,personRoleId:f.personRoleId??null}));n(k)},h.onerror=()=>s(h.error)}))}catch{return[]}},Mn=async(a=100)=>{try{return await Tt("readonly",n=>new Promise((s,h)=>{const k=n.index("byPending").getAll(!0);k.onsuccess=()=>{const f=k.result??[];s(f.slice(0,a))},k.onerror=()=>h(k.error)}))}catch{return[]}},Sn=async a=>{if(a.length!==0)try{await Tt("readwrite",n=>new Promise((s,h)=>{let g=a.length;a.forEach(k=>{const f=n.get(k);f.onsuccess=()=>{const P=f.result;if(P){P.pending=!1;const A=n.put(P);A.onsuccess=()=>{g-=1,g===0&&s()},A.onerror=()=>h(A.error)}else g-=1,g===0&&s()},f.onerror=()=>h(f.error)})}))}catch{}},cr=async(a,n)=>{const s=await Mn(200);if(s.length===0)return;const h=new Map;s.forEach(g=>{var f;const k=g.personRoleId??n??"";h.has(k)||h.set(k,[]),(f=h.get(k))==null||f.push(g)});for(const[g,k]of h.entries()){const f=k.map(P=>({itemType:P.itemType,itemId:P.itemId,checkType:P.checkType??null,direction:P.direction??null,revisionType:P.revisionType,evalType:P.evalType,correct:P.correct,clientId:P.clientId,clientSequence:P.clientSequence,maskBase64:P.maskBase64??null,payloadHashBase64:P.payloadHashBase64??null,payloadBase64:P.payloadBase64??null,personRoleId:g||null}));try{await Li({libraryId:a,outcomes:f}),await Sn(k.map(P=>P.id))}catch{}}},Kr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},In=(a,n)=>{const s=Math.max(a.length,n.length,1),h=Math.abs(a.length-n.length);return Math.max(0,1-h/s)},Pn=(a,n)=>{const s=new Uint8Array(a.length),h=In(a,n);for(let g=0;g<a.length;g+=1){const k=a[g]===(n[g]??"")?128:0,f=a.length-1-g,P=n.length-1-g,A=a[f]===(n[P]??"")?127:0,K=Math.round((k+A)*h);s[g]=Math.max(0,Math.min(255,K))}return s},St=(a,n)=>a===n||(Kr[a]??[]).includes(n)?!0:(Kr[n]??[]).includes(a),Ot=(a,n)=>{const s=new Uint8Array(a.length);if(!a.length)return s;const h=[];for(let k=0;k<=a.length-3;k+=1)h.push({index:k,text:a.slice(k,k+3)});let g=!1;return h.forEach(k=>{for(let f=0;f<=n.length-3;f+=1){const P=n.slice(f,f+3);let A=0;for(let y=0;y<3;y+=1)St(k.text[y],P[y])&&(A+=1);if(A<2)continue;let K=k.index-1,l=f-1;for(;K>=0&&l>=0;){const y=a[K],_=n[l];if(y===_){s[K]=Math.max(s[K],255),K-=1,l-=1,g=!0;continue}if(St(y,_)){s[K]=Math.max(s[K],127),K-=1,l-=1,g=!0;continue}if(K>0&&a[K-1]===_){s[K]=Math.max(s[K],0),K-=1,g=!0;continue}if(l>0&&a[K]===n[l-1]){l-=1,g=!0;continue}break}for(let y=0;y<3;y+=1){const _=k.index+y,G=k.text[y],U=P[y],d=G===U?255:St(G,U)?127:0;s[_]=Math.max(s[_],d),g=!0}let S=k.index+3,m=f+3;for(;S<a.length&&m<n.length;){const y=a[S],_=n[m];if(y===_){s[S]=Math.max(s[S],255),S+=1,m+=1,g=!0;continue}if(St(y,_)){s[S]=Math.max(s[S],127),S+=1,m+=1,g=!0;continue}if(S+1<a.length&&a[S+1]===_){s[S]=Math.max(s[S],0),S+=1,g=!0;continue}if(m+1<n.length&&a[S]===n[m+1]){m+=1,g=!0;continue}break}}}),g?s:Pn(a,n)},ht=(a,n,s)=>{const h=a.trim().toLowerCase(),g=n.trim().toLowerCase();return Ot(h,g)},mt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),ni=(a,n,s)=>{const h=mt(a),g=mt(n);return Ot(h,g)},va=a=>a.trim().toLowerCase(),$n=a=>a==="reverse"?"reverse":"forward",wt=(a,n)=>`${a}|${n}`,wa=a=>{if(!a)return null;const[n,s]=a.split("|",2);return(n==="forward"||n==="reverse")&&s?{mode:n,fragmentId:s}:{mode:"forward",fragmentId:a}},Vt=(a,n)=>{var h;const s=wa(n);return s?s.fragmentId&&n?(a??null)===n:(((h=wa(a))==null?void 0:h.mode)??"forward")===s.mode:!0},ga=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},li=(a,n)=>{if((ga(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const h=ga(a.childCheckType),g=ga(a.childDirection),k=ga(n.checkType),f=ga(n.direction);return!(h&&h!==k||g&&g!==f)},Rn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},En={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},qt=(a,n,s)=>{if(!s||!n.startsWith(a))return n;const h=n.slice(a.length);if(!h)return n;const g=s==="super"?Rn:En,k=h.split("").map(f=>g[f]??f).join("");return a+k},_t=(a,n,s)=>{var f,P,A;if(!a)return((f=n[0])==null?void 0:f.key)??null;const h=new Set(n.map(K=>K.key)),g=/\{([^}]+)\}/g;let k;for(;(k=g.exec(a))!==null;){const K=((P=k[1])==null?void 0:P.trim())??"";if(!K)continue;if(h.has(K))return K;const l=s==null?void 0:s[K];if(l&&h.has(l))return l}return((A=n[0])==null?void 0:A.key)??null},xr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const s=n.description??"";if(!s.trim())return[n];const h=wa(n.direction),g=(h==null?void 0:h.mode)??$n(n.direction),k=bt(s),f=Object.keys(k.nodes);return f.length===0?[n]:f.map(P=>({...n,checkType:"quote-fragment",direction:wt(g,P)}))});function Fn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l,collectionId:S,revisionId:m}){const y=jr(),_=`/#/cogita/library/${l}`,G=i.useMemo(()=>new URLSearchParams(y.search),[y.search]),U=Math.max(1,Number(G.get("limit")??20)),d=G.get("mode")??"random",b=i.useMemo(()=>Lr(d),[d]),p=i.useMemo(()=>Qt(b,ei(b,G)),[b,G]),ae=G.get("check")??"exact",B=G.get("reviewer"),j=i.useMemo(()=>a.cogita.library.revision[b.labelKey]??d,[a,d,b]),Y=i.useMemo(()=>ae==="exact"?a.cogita.library.revision.checkValue:ae,[a,ae]),[$,oe]=i.useState(a.cogita.library.collections.defaultName),[D,O]=i.useState([]),[be,ke]=i.useState([]),[ce,q]=i.useState("idle"),[ge,o]=i.useState({current:0,total:0}),[ee,w]=i.useState(0),[M,ye]=i.useState(""),[ie,le]=i.useState(null),[we,Le]=i.useState(null),[Ne,De]=i.useState(null),[Me,Qe]=i.useState(null),[Oe,Fe]=i.useState([]),[ze,oa]=i.useState({}),[Re,W]=i.useState({}),[X,Ke]=i.useState(null),[Ce,pe]=i.useState(null),[Pe,Ve]=i.useState(null),[qe,Be]=i.useState(null),[v,T]=i.useState(null),[Q,t]=i.useState({}),r=i.useRef(0),[u,N]=i.useState(null),V=i.useRef(null),te=i.useRef(null),[re,ne]=i.useState(null),[ue,se]=i.useState(!1),[ve,Ze]=i.useState(null),[Je,ta]=i.useState([]),[_e,Ye]=i.useState(null),Ue=i.useRef(null),E=i.useRef(null),[Ae,Ie]=i.useState(null),[ea,Xe]=i.useState(0),ia=i.useRef(null),ba=i.useRef({}),[sa,aa]=i.useState(!1),[la,Ma]=i.useState({}),[Ba,Da]=i.useState([]),ha=i.useRef(new Map),[ja,pa]=i.useState(new Set),[fa,Ee]=i.useState(!1),na=i.useRef(null),$a=i.useRef(new Set),Ka=i.useRef({}),Te=D[ee]??null,je=(Te==null?void 0:Te.checkType)==="translation-match"&&v,et=i.useRef(new Map),Oa=i.useRef(new Map),at=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useMemo(()=>Te?Te.cardType==="vocab"?a.cogita.library.revision.vocabLabel:Te.infoType?ra(a,Te.infoType):a.cogita.library.revision.infoLabel:"",[a,Te]),Gt=i.useMemo(()=>{var x;return b.id!=="levels"?D.length:((x=la.pool)==null?void 0:x.length)??b.getFetchLimit(U,p)},[la,p,b,D.length,U]),rt=b.getProgressTotal?b.getProgressTotal(D,la,U,p):b.id==="levels"?Math.min(U,Gt):D.length,it=rt?Math.min(ee+1,rt):0,Sa=Math.max(1,Number(p.tries??1)),ka=p.compare??"anchors",Va=Math.max(0,Math.min(100,Number(p.minCorrectness??0))),ma=(p.considerDependencies??"on")==="on",ca=Math.max(0,Math.min(100,Number(p.dependencyThreshold??85))),Ca=c=>{const x=c.slice();for(let I=x.length-1;I>0;I-=1){const L=Math.floor(Math.random()*(I+1));[x[I],x[L]]=[x[L],x[I]]}return x},Wa=c=>c.length?c.reduce((I,L)=>I+L,0)/c.length/255*100:0,qa=c=>Wa(c)>=Va,nt=async()=>{const c=await Aa(),x=new Map,I=new Map,L=new Map;c.forEach(F=>{const H=`${F.itemType}:${F.itemId}`,de=Ea(F.itemType,F.itemId,F.checkType,F.direction);if(x.has(H)||x.set(H,[]),x.get(H).push(F),I.has(de)||I.set(de,[]),I.get(de).push(F),F.itemType==="info"&&F.checkType==="quote-fragment"&&F.direction){const he=`${F.itemId}:${F.direction}`;L.has(he)||L.set(he,[]),L.get(he).push(F)}});const J=new Map,C=new Map,z=new Map;return x.forEach((F,H)=>J.set(H,Fa(F).score)),I.forEach((F,H)=>C.set(H,Fa(F).score)),L.forEach((F,H)=>z.set(H,Fa(F).score)),{itemKnowness:J,cardKnowness:C,fragmentKnowness:z}},Xt=async c=>{const x=[];let I=null;for(;;){const L=await Et({libraryId:l,collectionId:c,limit:200,cursor:I});if(x.push(...L.items),!L.nextCursor)break;I=L.nextCursor}return xr(x)},ft=async(c,x)=>{if(ha.current.has(c))return ha.current.get(c)??0;const I=await Xt(c);if(I.length===0)return ha.current.set(c,0),0;const J=I.reduce((C,z)=>{const F=me(z);return C+(x.get(F)??0)},0)/I.length;return ha.current.set(c,J),J},Zt=(c,x)=>{if(!ma||c.cardType!=="info"||c.infoType!=="quote"||c.checkType!=="quote-fragment")return!0;const I=wa(c.direction);if(!(I!=null&&I.fragmentId))return!0;const L=c.description??"";if(!L.trim())return!0;const C=bt(L).nodes[I.fragmentId];if(!C||!C.leftId&&!C.rightId)return!0;const z=[C.leftId,C.rightId].filter(de=>!!de);if(z.length===0)return!0;const F=z.map(de=>{const he=Ea("info",c.cardId,"quote-fragment",wt(I.mode,de));return x.get(he)??0});return F.reduce((de,he)=>de+he,0)/F.length>=ca},lt=async c=>{const x=la,I=c.concat(x.active??[]).concat(x.pool??[]).filter((F,H,de)=>de.findIndex(he=>me(he)===me(F))===H);if(!ma){pa(new Set(I.map(me)));return}const{itemKnowness:L,cardKnowness:J}=await nt(),C=Ba.filter(F=>ga(F.childItemType)==="collection"&&F.childItemId===S&&!ga(F.childCheckType)&&!ga(F.childDirection)),z=new Set;for(const F of I){if(F.cardType!=="info"){z.add(me(F));continue}if(!Zt(F,J))continue;const H=Ba.filter(xe=>li(xe,F)).concat(C);if(H.length===0){z.add(me(F));continue}let de=0;for(const xe of H)if(ga(xe.parentItemType)==="collection")de+=await ft(xe.parentItemId,J);else if(ga(xe.parentCheckType)||ga(xe.parentDirection)){const fe=ga(xe.parentCheckType),Se=ga(xe.parentDirection),$e=Ea(xe.parentItemType,xe.parentItemId,fe,Se);de+=J.get($e)??0}else{const fe=`${xe.parentItemType}:${xe.parentItemId}`;de+=L.get(fe)??0}de/H.length>=ca&&z.add(me(F))}pa(z)},er=c=>{for(let x=c;x<D.length;x+=1){const I=D[x];if(I&&(!ma||I.cardType!=="info"||ja.has(me(I))))return x}return-1},Ta=c=>!ma||c.cardType!=="info"||ja.has(me(c)),ot=c=>{if(b.id!=="temporal"&&b.id!=="levels")return null;const x=la,I=(x.active??[]).concat(x.pool??[]),L=new Set;for(const J of I){const C=me(J);if(!(L.has(C)||c.has(C))&&(L.add(C),Ta(J)))return J}return null},Ia=i.useMemo(()=>{if(b.id!=="levels")return null;const c=la,x=c.pool??[],I=c.active??[],L=c.levelMap??{},J=Math.max(1,Number(p.levels??1)),C=Array.from({length:J},()=>0),z=new Set(I.map(he=>me(he)));x.forEach(he=>{const xe=Math.min(J,Math.max(1,L[me(he)]??1));C[xe-1]+=1});const F=x.length||1,H=C.map(he=>he/F*100),de=Te?L[me(Te)]??1:null;return{counts:C,percentages:H,currentLevel:de,levelsCount:J,activeCount:I.length,poolCount:x.length,activeSet:z}},[la,p,b,Te]),xa=i.useMemo(()=>{if(b.id!=="temporal")return null;const c=la,x=c.pool??[],I=c.active??[],L=c.knownessMap??{},J=new Set(c.unknownSet??[]);let C=0;x.forEach(H=>{(L[me(H)]??0)>1&&(C+=1)});const z=J.size,F=I.map(H=>({id:me(H),value:J.has(me(H))?0:Math.max(0,Math.min(1,L[me(H)]??0))}));return{knownCount:C,unknownCount:z,dots:F}},[la,b]),st=i.useMemo(()=>{if(!ma)return 0;const c=la;return D.concat(c.active??[]).concat(c.pool??[]).filter((I,L,J)=>J.findIndex(C=>me(C)===me(I))===L).filter(I=>I.cardType==="info"&&!ja.has(me(I))).length},[ma,la,D,ja]);i.useEffect(()=>{if(!ma||ce!=="ready")return;const c=la,I=D.concat(c.active??[]).concat(c.pool??[]).filter((C,z,F)=>F.findIndex(H=>me(H)===me(C))===z).filter(C=>C.cardType!=="info"||ja.has(me(C))).length,L=Ue.current;if(Ue.current=I,L===null||I<=L)return;const J=I-L;Ye(`New card available (+${J})`),E.current&&window.clearTimeout(E.current),E.current=window.setTimeout(()=>Ye(null),2200)},[ma,ce,la,D,ja]),i.useEffect(()=>()=>{E.current&&window.clearTimeout(E.current)},[]);const ya=(c,x)=>{const I=b.applyOutcome({queue:D,meta:la},Te,U,p,{correct:c,correctness:x,createdUtc:new Date().toISOString()});O(I.queue),Ma(I.meta);const L=I.queue[ee+1];L&&xt(L,ee+1)};i.useEffect(()=>{Ht(l,S).then(c=>oe(c.name)).catch(()=>oe(a.cogita.library.collections.defaultName))},[l,S]),i.useEffect(()=>{_r({libraryId:l,type:"language"}).then(c=>ke(c)).catch(()=>ke([]))},[l]),i.useEffect(()=>{Ci({libraryId:l}).then(c=>Da(c.items??[])).catch(()=>Da([]))},[l]),i.useEffect(()=>{cr(l,B)},[l,B]),i.useEffect(()=>{lt(D)},[D,Ba,ma,ca,S]),i.useEffect(()=>{if(!Te||!ma){Ee(!1);return}if(Te.cardType!=="info"||ja.has(me(Te))){Ee(!1);return}const c=er(ee+1);if(c>=0){Ee(!1),w(c);return}if(b.id==="temporal"||b.id==="levels"){const x=D.slice(0,ee+1),I=D.slice(ee+1).filter(Ta),L=x.concat(I),J=new Set(L.map(me)),C=ot(J);if(C){const F=me(C);J.has(F)||(L.push(C),J.add(F),Ma(H=>{const de=H,he=new Set(de.queued??[]);return he.add(F),{...de,queued:he}}))}const z=L.findIndex((F,H)=>H!==ee&&Ta(F));if(z>=0){O(L),w(z),Ee(!1);return}}Ee(!0)},[Te,ja,ma,ee,D,la,b.id]),i.useEffect(()=>{let c=!0;return(async()=>{q("loading"),o({current:0,total:b.id==="levels"?0:b.getFetchLimit(U,p)});try{const I=[];let L=null,J=null;do{const xe=await Et({libraryId:l,collectionId:S,limit:300,cursor:L});if(I.push(...xe.items),(b.id==="levels"||b.id==="temporal")&&xe.total&&(J=xe.total),o(fe=>({current:I.length,total:fe.total||xe.total||b.getFetchLimit(U,p)})),L=xe.nextCursor??null,J!==null&&I.length>=J||b.id!=="levels"&&b.id!=="temporal"&&I.length>=b.getFetchLimit(U,p))break}while(L);if(!c)return;const C=xr(I);let z;if(b.id==="levels"){const xe=Math.max(1,Number(p.levels??1)),Se=(await Aa()).reduce(($e,He)=>{const Ge=Ea(He.itemType,He.itemId,He.checkType,He.direction);return $e[Ge]||($e[Ge]=[]),$e[Ge].push(He),$e},{});z={},C.forEach($e=>{const He=me($e),Ge=Se[He]??[],ua=Ge.length>0?Fa(Ge).score:0,Qa=Math.max(1,Math.min(xe,Math.ceil(ua/100*xe)));z[He]=Qa})}let F=null,H=null,de=null;if(b.id==="temporal"){const xe=await Aa(),fe=new Set(C.map(He=>me(He))),Se=xe.reduce((He,Ge)=>{const ua=Ea(Ge.itemType,Ge.itemId,Ge.checkType,Ge.direction);return fe.has(ua)&&(He[ua]||(He[ua]=[]),He[ua].push(Ge)),He},{});F={},H=new Set,de={};const $e=Date.now();C.forEach(He=>{const Ge=me(He),ua=Se[Ge]??[];if(ua.length===0){F[Ge]=0,H.add(Ge),de[Ge]=[];return}const Qa=wr(ua);de[Ge]=Qa;const oi=Jt(Qa,$e);F[Ge]=oi.knowness})}const he=b.id==="levels"?Nr(C,U,p,z):b.id==="temporal"?Tr(C,U,p,F??{},H??new Set,de??{}):b.prepare(C,U,p);O(he.queue),Ma(he.meta),w(0),q("ready"),o(xe=>({current:Math.min(xe.current,xe.total),total:xe.total}))}catch{c&&q("error")}})(),()=>{c=!1}},[l,S,U,p,b,B]),i.useEffect(()=>{if(ye(""),le(null),Ie(null),Xe(0),Fe([]),oa({}),W({}),pe(null),Ve(null),Be(null),se(!1),aa(!1),ne(null),T(null),t({}),!Te){Le(null),De(null),Ke(null),Ze(null);return}Te.cardType==="info"&&Te.infoType==="computed"&&Le(a.cogita.library.revision.loadingComputed);let c=!0;return xt(Te,ee).then(x=>{!c||!x||(Le(x.prompt),De(x.expectedAnswer),Fe(x.computedExpected),oa(x.computedAnswers),Ke(x.computedValues),pe(x.answerTemplate),Ve(x.outputVariables),Be(x.variableValues))}),()=>{c=!1}},[Te,a]),i.useEffect(()=>{if(!Te||Te.cardType!=="info"||Te.infoType!=="quote"){na.current=null,$a.current=new Set,Qe(null);return}const c=Te.description??"",x=(Te.label??"").trim(),I=x.replace(/\s+/g," ").trim(),L=c.replace(/\s+/g," ").trim(),J=I&&I!==L?x:a.cogita.library.infoTypes.quote;if(!c){Qe(null),De(null);return}const C=bt(c);na.current=C,Le(J);let z=!0;return nt().then(({fragmentKnowness:F})=>{if(!z)return;const H=getQuoteMode(Te.direction),de=new Set,he={};F.forEach((Se,$e)=>{const[He,Ge]=$e.split(":",2);if(He!==Te.cardId)return;const ua=wa(Ge);if(!ua||ua.mode!==H)return;const Qa=ua.fragmentId;he[Qa]=Se,Se>=ca&&de.add(Qa)}),$a.current=de,Ka.current=he;const xe=wa(Te.direction);if(xe!=null&&xe.fragmentId&&C.nodes[xe.fragmentId]){Ra(C,xe.fragmentId,J);return}const fe=gt(C,de,he,ca,ma,Te.direction);Ra(C,(fe==null?void 0:fe.id)??null,J)}).catch(()=>{$a.current=new Set,Ka.current={};const F=wa(Te.direction);if(F!=null&&F.fragmentId&&C.nodes[F.fragmentId]){Ra(C,F.fragmentId,J);return}const H=gt(C,$a.current,{},ca,ma,Te.direction);Ra(C,(H==null?void 0:H.id)??null,J)}),()=>{z=!1}},[Te,a,ma,ca]),i.useEffect(()=>{if(!Te||Te.cardType!=="vocab"||Te.checkType!=="translation-match"){T(null),t({});return}const I=(la.pool??la.active??D).filter(F=>F.cardType==="vocab"&&F.checkType==="translation-match").filter((F,H,de)=>de.findIndex(he=>he.cardId===F.cardId)===H);I.some(F=>F.cardId===Te.cardId)||I.unshift(Te);const J=Ca(I).slice(0,6).map(F=>{const H=F.label.split("↔").map(xe=>xe.trim()).filter(Boolean);if(H.length<2)return null;const de=`${F.cardId}:L`,he=`${F.cardId}:R`;return{cardId:F.cardId,leftId:de,rightId:he,leftLabel:H[0],rightLabel:H[1]}}).filter(Boolean),C=J.map(F=>F.leftId),z=Ca(J.map(F=>F.rightId));T({pairs:J,leftOrder:C,rightOrder:z,selection:{},activeLeft:null,activeRight:null,locked:{}})},[Te,D,la]),i.useEffect(()=>()=>{V.current&&window.clearTimeout(V.current),te.current&&window.clearTimeout(te.current)},[]);const za=i.useRef(null);i.useEffect(()=>{if(!Te)return;const c=me(Te),x=typeof document<"u"?document.activeElement:null;if(za.current===c&&x&&(x.tagName==="INPUT"||x.tagName==="TEXTAREA"))return;let I=0;const L=()=>{if(Te){if(Te.cardType==="info"&&Te.infoType==="computed"){if(Oe.length>0){const C=_t(Ce,Oe,Pe),z=C?ba.current[C]:null;if(z&&(z.focus(),document.activeElement===z)){za.current=c;return}}if(ia.current&&(ia.current.focus(),document.activeElement===ia.current)){za.current=c;return}}else if(Te.cardType==="vocab"&&ia.current&&(ia.current.focus(),document.activeElement===ia.current)){za.current=c;return}I<6&&(I+=1,window.setTimeout(L,40))}},J=window.setTimeout(L,40);return()=>window.clearTimeout(J)},[Te,Oe,Ce,Pe]),i.useEffect(()=>{if(!sa)return;const c=x=>{x.key==="Enter"&&(x.preventDefault(),dt())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[sa]);const Ha=c=>{ta(c),Ze(Fa(c))};i.useEffect(()=>{if(!Te){Ze(null),ta([]);return}const c=Te.cardType==="info"?"info":"connection";if(Te.cardType==="info"&&Te.infoType==="quote"){Aa().then(x=>{const I=x.filter(L=>L.itemType==="info"&&L.itemId===Te.cardId&&L.checkType==="quote-fragment"&&Vt(L.direction,Te.direction));Ha(I)}).catch(()=>{Ze(null),ta([])});return}Kt(c,Te.cardId,Te.checkType,Te.direction).then(x=>Ha(x)).catch(()=>{Ze(null),ta([])})},[l,Te,B]);const Nt=(c,x,I,L)=>{if(c==="info"&&I==="quote-fragment"){Aa().then(J=>{const C=J.filter(z=>z.itemType==="info"&&z.itemId===x&&z.checkType==="quote-fragment"&&Vt(z.direction,L));Ha(C)}).catch(()=>{Ze(null),ta([])});return}Kt(c,x,I,L).then(J=>Ha(J)).catch(()=>{Ze(null),ta([])})},Lt=(c,x,I)=>{var z;const L=((z=I.pairs.find(F=>F.leftId===c))==null?void 0:z.rightId)??null;if(!L)return I;const J=L===x;t(F=>({...F,[c]:J?"correct":"incorrect"})),V.current&&window.clearTimeout(V.current),te.current&&window.clearTimeout(te.current),r.current+=1;const C={kind:J?"correct":"incorrect",tick:r.current};if(N(null),V.current=window.setTimeout(()=>N(C),0),te.current=window.setTimeout(()=>N(null),420),J){const F={...I.locked,[c]:!0};return Object.keys(F).length>=I.pairs.length?(le("correct"),aa(!0)):le("correct"),{...I,selection:{...I.selection,[c]:x},activeLeft:null,activeRight:null,locked:F}}return le("incorrect"),{...I,activeLeft:null,activeRight:null}},ct=c=>{T(x=>!x||x.locked[c]?x:x.activeRight?Lt(c,x.activeRight,x):{...x,activeLeft:x.activeLeft===c?null:c})},Pa=c=>{T(x=>x&&(x.activeLeft?Lt(x.activeLeft,c,x):{...x,activeRight:x.activeRight===c?null:c}))},dt=()=>{var c;if(Te&&Te.cardType==="info"&&Te.infoType==="quote"&&na.current&&Me&&!((c=wa(Te.direction))!=null&&c.fragmentId)){const x=gt(na.current,$a.current,Ka.current,ca,ma,Te.direction,Me.fragmentId);if(x){le(null),ye(""),se(!1),W({}),aa(!1),Ie(null),Xe(0),Ra(na.current,x.id,Me.title);return}}le(null),ye(""),se(!1),W({}),aa(!1),Ie(null),Xe(0),w(x=>Math.min(x+1,D.length))},Na=c=>{if(!Te)return;const x=c.expected??null,I=c.answer??"";let L=x??"",J=I;if(!x&&c.expectedMap&&c.answerMap){const xe=Object.keys(c.expectedMap).sort((fe,Se)=>fe.localeCompare(Se));L=xe.map(fe=>{var Se;return((Se=c.expectedMap)==null?void 0:Se[fe])??""}).join("|"),J=xe.map(fe=>{var Se;return((Se=c.answerMap)==null?void 0:Se[fe])??""}).join("|")}const C=L?ht(L,J,ka):new Uint8Array,z={revisionType:b.id,evalType:c.evalType,direction:c.direction,prompt:we??"",expected:x,answer:I,expectedAnswers:c.expectedMap??null,answers:c.answerMap??null,correct:c.correct,maskBase64:C.length?_a(C):null,values:X??null,checkMode:ae,compareMode:ka,minCorrectness:Va},F=new TextEncoder().encode(JSON.stringify(z)),H=Te.cardType==="info"?"info":"connection",de=c.overrideCheckType??Te.checkType??null,he=c.overrideDirection??Te.direction??null;Dt({itemType:H,itemId:Te.cardId,checkType:de,direction:he,revisionType:b.id,evalType:c.evalType,correct:c.correct,maskBase64:C.length?_a(C):null,payloadBase64:_a(F),personRoleId:B??null}).then(()=>{Nt(H,Te.cardId,de,he),lt(D),cr(l,B)}).catch(()=>{})},Ja=(c,x)=>{const I=et.current.get(x);if(I)return Promise.resolve(I);const L=Oa.current.get(x);if(L)return L;const J=Za({libraryId:l,infoId:c}).then(C=>{var xe,fe;const z=C.payload,F=((xe=z.definition)==null?void 0:xe.graph)??null,H="",de=((fe=z.definition)==null?void 0:fe.answerTemplate)??"",he=kr(F,H,de);if(he){const $e={sample:Qr(he),answerTemplate:de||null};return et.current.set(x,$e),$e}return mr({libraryId:l,infoId:c}).then(Se=>{const $e={sample:Se,answerTemplate:null};return et.current.set(x,$e),$e})}).catch(()=>mr({libraryId:l,infoId:c}).then(C=>{const z={sample:C,answerTemplate:null};return et.current.set(x,z),z}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Oa.current.delete(x)});return Oa.current.set(x,J),J},xt=(c,x)=>{var F;const I=`${me(c)}:${x}`,L=at.current.get(I);if(L)return Promise.resolve(L);const J=tt.current.get(I);if(J)return J;const C=H=>(at.current.set(I,H),H);let z;if(c.cardType==="vocab"){if(c.checkType==="translation-match")return z=Promise.resolve(C({prompt:c.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),z;const H=c.label.split("↔").map(de=>de.trim()).filter(Boolean);if(H.length>=2){const he=(c.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",xe=he?H[0]:H[1],fe=he?H[1]:H[0];z=Promise.resolve(C({prompt:xe,expectedAnswer:fe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else z=Promise.resolve(C({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(c.cardType==="info"&&c.infoType==="word"){const H=(F=c.description)!=null&&F.startsWith("Language: ")?c.description.replace("Language: ",""):null;z=Promise.resolve(C({prompt:c.label,expectedAnswer:H,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else c.cardType==="info"&&c.infoType==="computed"?z=Ja(c.cardId,I).then(H=>{var Se,$e;if(!H.sample)return C({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const de=H.sample,he=de.expectedAnswers?Object.entries(de.expectedAnswers).map(([He,Ge])=>({key:He,expected:Ge})):[],xe=he.reduce((He,Ge)=>(He[Ge.key]="",He),{}),fe=de.expectedAnswerIsSentence&&((Se=de.expectedAnswer)==null?void 0:Se.trim())||null;return C({prompt:de.prompt,expectedAnswer:he.length>0?fe:(($e=de.expectedAnswer)==null?void 0:$e.trim())||null,computedExpected:he,computedAnswers:xe,computedValues:de.values??null,answerTemplate:H.answerTemplate,outputVariables:de.outputVariables??null,variableValues:de.variableValues??null})}).catch(()=>C({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{tt.current.delete(I)}):z=Promise.resolve(C({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return tt.current.set(I,z),z},Ra=(c,x,I)=>{const L=Object.keys(c.nodes).length,J=$a.current.size;if(!x){Qe({title:I,before:c.text,after:"",fragmentId:null,total:L,completed:J}),De(null),aa(!0);return}const C=c.nodes[x];if(!C)return;const z=Gr(c.text,C);Qe({title:I,before:z.before,after:z.after,fragmentId:C.id,total:L,completed:J}),De(z.fragment),aa(!1)},Ct=()=>{const c=na.current;c&&Qe(x=>x&&{...x,total:Object.keys(c.nodes).length,completed:$a.current.size})},ut=()=>{const c=D[ee+1];c&&xt(c,ee+1)},Mt=()=>{if(ut(),Te&&Te.cardType==="vocab"&&Te.checkType==="translation-match"&&v){if(v.pairs.length===0){le("incorrect"),aa(!0);return}const C=v.pairs.reduce((fe,Se)=>(fe[Se.rightId]=Se.rightLabel,fe),{});let z=0;const F={};v.pairs.forEach(fe=>{const $e=v.selection[fe.leftId]===fe.rightId;F[fe.leftId]=$e?"correct":"incorrect",$e&&(z+=1)});const H=v.pairs.length||1,de=z/H,he=z===v.pairs.length;t(fe=>({...fe,...F})),he?(le("correct"),aa(!0),Xe(0)):(le("incorrect"),aa(!1),Xe(fe=>{const Se=fe+1;return Se>=Sa&&(se(!0),aa(!0),T($e=>{if(!$e)return $e;const He=$e.pairs.reduce((Ge,ua)=>(Ge[ua.leftId]=ua.rightId,Ge),{});return{...$e,selection:He}})),Se})),ya(he,de);const xe="connection";Promise.all(v.pairs.map(fe=>{const Se=v.selection[fe.leftId]??null,$e=Se?C[Se]:"",He={left:fe.leftLabel,expected:fe.rightLabel,answer:$e,checkType:"translation-match"},Ge=new TextEncoder().encode(JSON.stringify(He));return Dt({itemType:xe,itemId:fe.cardId,checkType:"translation-match",direction:null,revisionType:b.id,evalType:"translation-match",correct:Se===fe.rightId,maskBase64:null,payloadBase64:_a(Ge),personRoleId:B??null})})).then(()=>{Nt(xe,Te.cardId,Te.checkType,Te.direction),cr(l,B)}).catch(()=>{});return}if(Oe.length>0){const C=Oe.reduce((F,H)=>{const de=ze[H.key]??"";return F[H.key]=va(de)===va(H.expected)?"correct":"incorrect",F},{});Oe.every(({key:F,expected:H})=>{const de=ze[F]??"";return ae==="exact"&&va(de)===va(H)})?(le("correct"),W(C),aa(!0),Xe(0),ya(!0,1),Na({correct:!0,direction:we?`${we} -> computed`:"computed",expectedMap:Oe.reduce((F,H)=>(F[H.key]=H.expected,F),{}),answerMap:ze,evalType:"computed"})):(le("incorrect"),W(C),aa(!1),Xe(F=>{const H=F+1;return H>=Sa&&Z&&(se(!0),aa(!0)),H}),ya(!1,0),window.setTimeout(()=>{var H;const F=_t(Ce,Oe,Pe);F&&ba.current[F]&&((H=ba.current[F])==null||H.focus())},40),Na({correct:!1,direction:we?`${we} -> computed`:"computed",expectedMap:Oe.reduce((F,H)=>(F[H.key]=H.expected,F),{}),answerMap:ze,evalType:"computed"}));return}if(Te&&Te.cardType==="info"&&Te.infoType==="quote"&&(Me!=null&&Me.fragmentId)){if(!Ne)return;const C=wa(Te.direction),z=(C==null?void 0:C.mode)??getQuoteMode(Te.direction),F=C!=null&&C.fragmentId&&Te.direction?Te.direction:wt(z,Me.fragmentId),H=ni(Ne,M,ka),de=ae==="exact"&&mt(M)===mt(Ne),he=qa(H),xe=de||he,fe=Wa(H);xe?(Ka.current[Me.fragmentId]=Math.max(Ka.current[Me.fragmentId]??0,fe),(Ka.current[Me.fragmentId]??0)>=ca&&$a.current.add(Me.fragmentId),Ct(),le("correct"),W({}),aa(!0),Ie(H),Xe(0),fe<100&&Sa<=1&&se(!0),ya(!0,fe/100),Na({correct:!0,direction:`quote:${Me.fragmentId}`,expected:Ne,answer:M,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:F})):(le("incorrect"),W({}),aa(!1),Ie(H),Xe(Se=>{const $e=Se+1;return $e>=Sa&&Z&&(se(!0),aa(!0)),$e}),ya(!1,fe/100),window.setTimeout(()=>{var Se;return(Se=ia.current)==null?void 0:Se.focus()},40),Na({correct:!1,direction:`quote:${Me.fragmentId}`,expected:Ne,answer:M,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:F}));return}if(!Ne)return;const c=ht(Ne,M,ka),x=ae==="exact"&&va(M)===va(Ne),I=qa(c),L=x||I,J=Wa(c);L?(le("correct"),W({}),aa(!0),Ie(c),Xe(0),J<100&&Sa<=1&&se(!0),ya(!0,J/100),Na({correct:!0,direction:we?`${we} -> ${Ne}`:null,expected:Ne,answer:M,evalType:"text"})):(le("incorrect"),W({}),aa(!1),Ie(c),Xe(C=>{const z=C+1;return z>=Sa&&Z&&(se(!0),aa(!0)),z}),ya(!1,J/100),window.setTimeout(()=>{var C;return(C=ia.current)==null?void 0:C.focus()},40),Na({correct:!1,direction:we?`${we} -> ${Ne}`:null,expected:Ne,answer:M,evalType:"text"}))},ar=c=>{if(ut(),!Ne)return;const x=ht(Ne,c,ka),I=va(c)===va(Ne),L=qa(x),J=I||L,C=Wa(x);J?(le("correct"),W({}),aa(!0),Ie(x),Xe(0),C<100&&Sa<=1&&se(!0),ya(!0,C/100),Na({correct:!0,direction:"word->language",expected:Ne,answer:c,evalType:"language-select"})):(le("incorrect"),W({}),aa(!1),Ie(x),Xe(z=>{const F=z+1;return F>=Sa&&Z&&(se(!0),aa(!0)),F}),ya(!1,C/100),Na({correct:!1,direction:"word->language",expected:Ne,answer:c,evalType:"language-select"}))},tr=()=>{ut(),le("correct"),aa(!0),Xe(0),ya(!0,1),Ne&&Na({correct:!0,direction:"manual",expected:Ne,answer:M,evalType:"manual"})},rr=()=>{if(ya(!1,0),Te&&Te.cardType==="info"&&Te.infoType==="quote"){le(null),ye(""),se(!1),W({}),aa(!1),Ie(null),Xe(0),w(c=>Math.min(c+1,D.length));return}dt()};i.useEffect(()=>{ut()},[ee,D]);const Ya=c=>{var I;if(c.key!=="Enter")return;if(c.preventDefault(),c.stopPropagation(),sa){dt();return}const x=Oe.find(L=>!(ze[L.key]??"").trim());if(x){(I=ba.current[x.key])==null||I.focus();return}Mt()},R=a.cogita.library.revision.revealModeAfterIncorrect,Z=Oe.length>0||!!Ne;return e.jsxs(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:[ce==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ge.total?Math.min(100,Math.max(0,ge.current/ge.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ge.total?`${Math.min(ge.current,ge.total)} / ${ge.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:$}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",j).replace("{check}",Y)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:_,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${_}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${_}/collections/${S}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ve?`${ve.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ia?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Ia.currentLevel??"-"," / ",Ia.levelsCount]}):null,ve?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(ve.correct)).replace("{total}",String(ve.total))}),ve.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(ve.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ti,{outcomes:Je})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[_e?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:_e})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":u?`${u.kind}-${u.tick}`:je?"idle":ie??"idle",children:Te?e.jsx(e.Fragment,{children:fa?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ai,{copy:a,currentCard:Te,currentTypeLabel:pt,prompt:we,languages:be,answer:M,onAnswerChange:c=>ye(x=>qt(x,c,re)),computedExpected:Oe,computedAnswers:ze,onComputedAnswerChange:(c,x)=>oa(I=>({...I,[c]:qt(I[c]??"",x,re)})),answerTemplate:Ce,outputVariables:Pe,variableValues:qe,computedFieldFeedback:Re,feedback:ie,canAdvance:sa,quoteContext:Me,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:rr,onLanguageSelect:ar,onMarkReviewed:tr,onAdvance:dt,showCorrectAnswer:ue,setShowCorrectAnswer:se,onRevealCorrect:()=>aa(!0),answerMask:Ae,expectedAnswer:Ne,hasExpectedAnswer:Z,handleComputedKeyDown:Ya,answerInputRef:ia,computedInputRefs:ba,scriptMode:re,setScriptMode:ne,matchPairs:v==null?void 0:v.pairs,matchLeftOrder:v==null?void 0:v.leftOrder,matchRightOrder:v==null?void 0:v.rightOrder,matchSelection:v==null?void 0:v.selection,matchActiveLeft:v==null?void 0:v.activeLeft,matchActiveRight:v==null?void 0:v.activeRight,matchFeedback:Q,onMatchLeftSelect:ct,onMatchRightSelect:Pa})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${_}/collections/${S}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:rt?`${it} / ${rt}`:a.cogita.library.revision.progressUnlimited}),ce==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ce==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ce==="ready"&&D.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:R}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Sa]})]})]}),Ia?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Ia.activeCount," / ",Ia.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ia.counts.map((c,x)=>{const I=x+1,L=Ia.currentLevel===I,J=Ia.percentages[x]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":L,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:I}),e.jsx("strong",{children:c})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,J))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[J.toFixed(1),"%"]})]},`level-${I}`)})})]}):null,xa?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:xa.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:xa.dots.map(c=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,c.value*100))}%`,background:`rgba(${Math.round(255*(1-c.value))}, ${Math.round(200*c.value)}, 80, 0.9)`}},c.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:xa.knownCount})]})]}):null,ma?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:st})]})}):null]})]})]})})})]})]})}const dr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],An={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Bn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Dn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Kn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:l,collectionId:S}){const[m,y]=i.useState(""),[_,G,U]=yr([]),[d,b,p]=vr([]),[ae,B]=i.useState(null),[j,Y]=i.useState(null),[$,oe]=i.useState(null),D=`/#/cogita/library/${l}`;i.useEffect(()=>{Ht(l,S).then(o=>y(o.name)).catch(()=>y(a.cogita.library.collections.defaultName))},[l,S,a]),i.useEffect(()=>{Mi({libraryId:l,collectionId:S}).then(o=>{if(!o.graphId||o.graphId==="00000000-0000-0000-0000-000000000000"){G([]),b([]);return}const ee=o.nodes.map(M=>{var we;const ye=M.payload??{},ie=ye.position??{x:120,y:120},le=ye.params??{};return{id:M.nodeId,type:"default",position:ie,data:{nodeType:M.nodeType,label:((we=dr.find(Le=>Le.type===M.nodeType))==null?void 0:we.label)??M.nodeType,params:le}}}),w=o.edges.map(M=>({id:M.edgeId,source:M.fromNodeId,target:M.toNodeId,sourceHandle:M.fromPort??void 0,targetHandle:M.toPort??void 0}));G(ee),b(w)}).catch(()=>{G([]),b([])})},[l,S,b,G]);const O=i.useMemo(()=>_.find(o=>o.id===ae)??null,[_,ae]),be=o=>{var ye;const ee=crypto.randomUUID(),w=((ye=dr.find(ie=>ie.type===o))==null?void 0:ye.label)??o,M={...An[o]};G(ie=>[...ie,{id:ee,type:"default",position:{x:120+ie.length*40,y:120+ie.length*40},data:{nodeType:o,label:w,params:M}}]),B(ee)},ke=i.useCallback(o=>{b(ee=>jt({...o,id:crypto.randomUUID()},ee))},[b]),ce=async()=>{Y(null);try{await Hr({libraryId:l,collectionId:S,nodes:_.map(o=>({nodeId:o.id,nodeType:o.data.nodeType,payload:{position:o.position,params:o.data.params}})),edges:d.map(o=>({edgeId:o.id,fromNodeId:o.source,fromPort:o.sourceHandle??null,toNodeId:o.target,toPort:o.targetHandle??null}))}),Y(a.cogita.library.graph.saveSuccess)}catch{Y(a.cogita.library.graph.saveFail)}},q=async()=>{try{const o=await Si({libraryId:l,collectionId:S});oe(o)}catch{oe(null)}},ge=o=>{O&&G(ee=>ee.map(w=>w.id===O.id?{...w,data:{...w.data,params:o}}:w))};return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${D}/collections/${S}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:q,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ce,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:dr.map(o=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>be(o.type),children:o.label},o.type))}),j?e.jsx("p",{className:"cogita-help",children:j}):null,$&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String($.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String($.connections)).replace("{infos}",String($.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Ut,{nodes:_,edges:d,onNodesChange:U,onEdgesChange:p,onConnect:ke,onNodeClick:(o,ee)=>B(ee.id),fitView:!0,children:[e.jsx(Wt,{color:"rgba(120,160,200,0.2)"}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),O?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:O.data.label}),O.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:O.data.params.tagId?{id:O.data.params.tagId,label:O.data.params.tagLabel??"",infoType:"topic"}:null,onChange:o=>ge({...O.data.params,tagId:(o==null?void 0:o.id)??null,tagLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:O.data.params.scope??"any",onChange:o=>ge({...O.data.params,scope:o.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),O.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(We,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:O.data.params.languageId?{id:O.data.params.languageId,label:O.data.params.languageLabel??"",infoType:"language"}:null,onChange:o=>ge({...O.data.params,languageId:(o==null?void 0:o.id)??null,languageLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:O.data.params.scope??"any",onChange:o=>ge({...O.data.params,scope:o.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),O.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:O.data.params.infoType??"word",onChange:o=>ge({...O.data.params,infoType:o.target.value}),children:Dn.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsx(We,{libraryId:l,infoType:O.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:O.data.params.infoId?{id:O.data.params.infoId,label:O.data.params.infoLabel??"",infoType:O.data.params.infoType??"word"}:null,onChange:o=>ge({...O.data.params,infoId:(o==null?void 0:o.id)??null,infoLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),O.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:O.data.params.connectionType??"translation",onChange:o=>ge({...O.data.params,connectionType:o.target.value}),children:Bn.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:O.data.params.connectionId??"",onChange:o=>ge({...O.data.params,connectionId:o.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(O.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const ur="cogita.preferences",On=["library_overview","all_cards","new_card","all_collections","new_collection","dependencies"],gr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},hr=["settings","run","shared"];function Vn(a,n=""){const s=a.split("/").filter(Boolean);if(s[0]!=="cogita"||s[1]!=="library")return{};const h=s[2];if(!h)return{};if(!s[3])return{libraryId:h,target:"library_overview"};const g=new URLSearchParams(n),k=g.get("revisionId")??void 0,f=g.get("collectionAction");if(s[3]==="list")return{libraryId:h,target:"all_cards",cardMode:"list",revisionId:k};if(s[3]==="detail"||s[3]==="collection")return{libraryId:h,target:"all_cards",cardMode:s[3],revisionId:k};if(s[3]==="new"||s[3]==="add")return{libraryId:h,target:"new_card",revisionId:k};if(s[3]==="edit")return{libraryId:h,target:"new_card",revisionId:k,infoId:s[4]};if(s[3]==="shared-revisions")return{libraryId:h,target:"all_collections",revisionId:k};if(s[3]==="dependencies")return{libraryId:h,target:"dependencies"};if(s[3]!=="collections")return{libraryId:h,target:"library_overview"};if(s[4]==="new")return{libraryId:h,target:"new_collection",revisionId:k};const P=s[4];return P?s[5]==="graph"?{libraryId:h,target:"all_collections",collectionId:P,revisionId:k,revisionView:"graph"}:s[5]==="shared-revisions"?{libraryId:h,target:"all_collections",collectionId:P,revisionId:k,revisionView:"shared"}:s[5]==="revision"?{libraryId:h,target:"all_collections",collectionId:P,revisionId:k,revisionView:s[6]==="run"?"run":"settings"}:f==="new-revision"?{libraryId:h,target:"all_collections",collectionId:P,revisionId:k,revisionView:"new"}:{libraryId:h,target:"all_collections",collectionId:P,revisionId:k,revisionView:"detail"}:{libraryId:h,target:"all_collections"}}function br(a,n="library_overview",s,h,g,k){const f=(P,A)=>{const K=new URLSearchParams;A!=null&&A.revisionId&&K.set("revisionId",A.revisionId),A!=null&&A.collectionAction&&K.set("collectionAction",A.collectionAction);const l=K.toString();return l?`${P}?${l}`:P};return a?n==="library_overview"?f(`/cogita/library/${a}`,{revisionId:g}):n==="all_cards"?f(`/cogita/library/${a}/list`,{revisionId:g}):n==="new_card"?k?f(`/cogita/library/${a}/edit/${k}`,{revisionId:g}):f(`/cogita/library/${a}/add`,{revisionId:g}):n==="all_collections"?s?h==="graph"?f(`/cogita/library/${a}/collections/${s}/graph`,{revisionId:g}):h==="settings"?f(`/cogita/library/${a}/collections/${s}/revision`,{revisionId:g}):h==="run"?f(`/cogita/library/${a}/collections/${s}/revision/run`,{revisionId:g}):h==="shared"?f(`/cogita/library/${a}/collections/${s}/shared-revisions`,{revisionId:g}):h==="new"?f(`/cogita/library/${a}/collections/${s}`,{revisionId:g,collectionAction:"new-revision"}):f(`/cogita/library/${a}/collections/${s}`,{revisionId:g}):f(`/cogita/library/${a}/collections`,{revisionId:g}):n==="new_collection"?f(`/cogita/library/${a}/collections/new`,{revisionId:g}):n==="dependencies"?f(`/cogita/library/${a}/dependencies`,{revisionId:g}):f(`/cogita/library/${a}`,{revisionId:g}):"/cogita"}function It(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function qn(a,n){var P;if(!a.length)return null;const s=a.filter(A=>n.has(A.roleId)),h=s.length>0?s:a,g=h.map(A=>{var l,S;const K=((S=(l=A.fields.find(m=>m.fieldType==="role_kind"))==null?void 0:l.plainValue)==null?void 0:S.toLowerCase())??"";return{roleId:A.roleId,roleKind:K}}),k=g.find(A=>A.roleKind.includes("master"));if(k)return k.roleId;const f=g.find(A=>A.roleKind.includes("account")||A.roleKind.includes("user"));return f?f.roleId:((P=h[0])==null?void 0:P.roleId)??null}function _n(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Un({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K}){const l=di(),S=jr(),m=i.useMemo(()=>Vn(S.pathname,S.search),[S.pathname,S.search]),y=a.cogita.workspace,[_,G]=i.useState([]),[U,d]=i.useState([]),[b,p]=i.useState([]),[ae,B]=i.useState(void 0),[j,Y]=i.useState("library_overview"),[$,oe]=i.useState(void 0),[D,O]=i.useState(void 0),[be,ke]=i.useState("detail"),[ce,q]=i.useState(void 0),[ge,o]=i.useState(!1),[ee,w]=i.useState(!0),[M,ye]=i.useState(!1),[ie,le]=i.useState(!1),[we,Le]=i.useState(null),[Ne,De]=i.useState(""),[Me,Qe]=i.useState(""),[Oe,Fe]=i.useState(""),[ze,oa]=i.useState(null),[Re,W]=i.useState(null),X=i.useRef({version:1,byLibrary:{}}),Ke=i.useRef(!1),Ce=i.useRef(!1),pe=i.useRef(null),Pe=i.useMemo(()=>_.find(E=>E.libraryId===ae)??null,[_,ae]),Ve=i.useMemo(()=>U.find(E=>E.collectionId===$)??null,[U,$]),qe=i.useMemo(()=>b.find(E=>E.revisionId===D)??null,[b,D]),Be=i.useMemo(()=>({detail:y.revisions.detail,graph:y.revisions.graph,settings:y.revisions.settings,run:y.revisions.run,shared:y.targets.sharedRevisions,new:y.revisionForm.createAction}),[y.revisions.detail,y.revisions.graph,y.revisions.run,y.revisions.settings,y.targets.sharedRevisions,y.revisionForm.createAction]),v=i.useMemo(()=>[{value:"detail",label:Be.detail},{value:"graph",label:Be.graph},{value:"settings",label:y.targets.allRevisions},{value:"new",label:Be.new},{value:"run",label:Be.run},{value:"shared",label:Be.shared}],[Be.detail,Be.graph,Be.new,Be.run,Be.shared,y.targets.allRevisions]),T=i.useMemo(()=>({library_overview:y.targets.libraryOverview,all_cards:y.targets.allCards,new_card:y.targets.newCard,all_collections:y.targets.allCollections,new_collection:y.targets.newCollection,dependencies:y.targets.dependencies}),[y.targets]),Q=i.useMemo(()=>T[j]??j,[j,T]),t=Be[be],r=!!ae,u=!!$,N=r&&j==="all_collections",V=u&&j==="all_collections",te=u&&j==="all_collections"&&hr.includes(be),re=i.useCallback(E=>{const Ae=!!E.libraryId;let Ie=E.target,ea=E.collectionId,Xe=E.revisionId,ia=E.revisionView,ba=E.infoId;Ae?gr[Ie].requiresCollection&&!ea?(Ie="all_collections",Xe=void 0,ia="detail"):Ie!=="all_collections"?(ea=void 0,Xe=void 0,Ie!=="new_card"&&(ba=void 0)):gr[Ie].allowsRevision?hr.includes(ia)||(Xe=void 0):ia="detail":(Ie="library_overview",ea=void 0,Xe=void 0,ia="detail",ba=void 0),B(E.libraryId),Y(Ie),oe(ea),O(Xe),ke(ia),o(!1);const sa=It(br(E.libraryId,Ie,ea,ia,Xe,ba));It(`${S.pathname}${S.search}`)!==sa&&(pe.current=sa,l(sa))},[S.pathname,S.search,l]),ne=E=>{re({libraryId:ae,target:"all_collections",collectionId:$,revisionId:hr.includes(E)?D:void 0,revisionView:E})},ue=i.useMemo(()=>[{key:"library",label:y.layers.library,visible:!0,value:ae??"",selectedLabel:(Pe==null?void 0:Pe.name)??y.path.noLibrarySelected,disabled:ee||_.length===0,options:_.map(E=>({value:E.libraryId,label:E.name})),emptyOption:y.noLibraryOption,onSelect:E=>{const Ae=E||void 0;re({libraryId:Ae,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:y.layers.target,visible:r,value:j,selectedLabel:Q,disabled:!r,options:On.map(E=>({value:E,label:T[E]})),onSelect:E=>{const Ae=E;re({libraryId:ae,target:Ae,collectionId:$,revisionId:D,revisionView:be,infoId:Ae==="new_card"?m.infoId:void 0})}},{key:"collection",label:y.layers.collection,visible:N,value:$??"",selectedLabel:(Ve==null?void 0:Ve.name)??y.path.noCollectionSelected,disabled:!r||M||U.length===0,options:U.map(E=>({value:E.collectionId,label:E.name})),emptyOption:y.selectCollectionOption,onSelect:E=>{re({libraryId:ae,target:"all_collections",collectionId:E||void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection_action",label:y.layers.revision,visible:V,value:be,selectedLabel:t,disabled:!$,options:v.map(E=>({value:E.value,label:E.label})),onSelect:E=>{ne(E)}},{key:"revision_entry",label:y.layers.revision,visible:te,value:D??"",selectedLabel:(qe==null?void 0:qe.name)??y.status.noRevisions,disabled:!u||ie||b.length===0,options:b.map(E=>({value:E.revisionId,label:E.name})),emptyOption:y.status.noRevisions,onSelect:E=>{re({libraryId:ae,target:"all_collections",collectionId:$,revisionId:E||void 0,revisionView:be})}},{key:"selected_info",label:a.cogita.library.list.selectedTitle,visible:!!m.infoId,value:m.infoId??"",selectedLabel:ce??m.infoId??"",disabled:!0,options:[],onSelect:E=>{}}],[v,U,M,_,ee,re,b,ie,Ve,$,qe,D,ce,u,r,Pe,ae,t,be,j,Q,N,V,te,T,a.cogita.library.list.selectedTitle,m.infoId,y.layers.collection,y.layers.library,y.layers.revision,y.layers.target,y.noLibraryOption,y.path.noCollectionSelected,y.path.noLibrarySelected,y.selectCollectionOption]),se=i.useMemo(()=>ue.filter(E=>E.visible),[ue]),ve=i.useMemo(()=>se.filter(E=>E.key!=="library"&&E.key!=="collection"&&E.key!=="revision_entry"&&E.key!=="selected_info"),[se]),Ze=i.useMemo(()=>ve.find(E=>E.key==="target")??null,[ve]),Je=i.useMemo(()=>ve.find(E=>E.key==="collection_action")??null,[ve]),ta=i.useMemo(()=>{const E=m.libraryId;if(!E||!S.pathname.startsWith("/cogita/library/"))return null;const Ae={copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,libraryId:E};if(m.target==="library_overview")return e.jsx(Ji,{...Ae});if(m.target==="all_cards")return e.jsx(Xi,{...Ae,mode:m.cardMode??"list"});if(m.target==="new_card")return e.jsx(rn,{...Ae,editInfoId:m.infoId});if(m.target==="dependencies")return e.jsx(ln,{...Ae});if(m.target==="all_collections"){if(m.collectionId){const Ie={...Ae,collectionId:m.collectionId};return m.revisionView==="graph"?e.jsx(Kn,{...Ie}):m.revisionView==="shared"?e.jsx(on,{...Ae,collectionId:m.collectionId}):m.revisionView==="settings"?e.jsx(kn,{...Ie,revisionId:m.revisionId}):m.revisionView==="run"?e.jsx(Fn,{...Ie,revisionId:m.revisionId}):e.jsx(hn,{...Ie})}return e.jsx(sn,{...Ae})}return m.target==="new_collection"?e.jsx(gn,{...Ae,onCreated:Ie=>l(`/cogita/library/${E}/collections/${Ie}/graph`)}):null},[n,a,A,S.pathname,l,K,k,P,h,g,m.cardMode,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,f,s]);i.useEffect(()=>{let E=!1;return(async()=>{var Ie,ea,Xe,ia,ba,sa,aa;w(!0);try{await Pi();const[la,Ma,Ba]=await Promise.all([qr(),$i(),Ri()]);if(E)return;G(la);const Da=new Set(Ba.nodes.filter(Ee=>Ee.nodeType==="role"&&Ee.canLink).map(Ee=>Ee.roleId??"")),ha=qn(Ma,Da);if(oa(ha),ha){const Ee=Ba.nodes.find(na=>na.nodeType==="data"&&na.roleId===ha&&(na.fieldType===ur||na.label===ur));W((Ee==null?void 0:Ee.dataKeyId)??null),X.current=_n(Ee==null?void 0:Ee.value)}const ja=X.current.lastLibraryId,pa=((Ie=la.find(Ee=>Ee.libraryId===m.libraryId))==null?void 0:Ie.libraryId)??(la.length===1?la[0].libraryId:void 0)??((ea=la.find(Ee=>Ee.libraryId===ja))==null?void 0:ea.libraryId)??((Xe=la[0])==null?void 0:Xe.libraryId),fa=(pa&&((ba=(ia=X.current.byLibrary)==null?void 0:ia[pa])==null?void 0:ba.lastTarget))??"library_overview";B(pa),Y(m.target??fa),O(m.revisionId??(pa?(aa=(sa=X.current.byLibrary)==null?void 0:sa[pa])==null?void 0:aa.lastRevisionId:void 0)),ke(m.revisionView??"detail"),Ke.current=!0}catch{E||Le(y.status.loadFailed)}finally{E||w(!1)}})(),()=>{E=!0}},[y.status.loadFailed]),i.useLayoutEffect(()=>{Ke.current&&(m.libraryId&&_.some(E=>E.libraryId===m.libraryId)&&B(m.libraryId),m.target&&Y(m.target),oe(m.collectionId),O(m.revisionId),m.revisionView&&ke(m.revisionView))},[_,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target]),i.useEffect(()=>{if(!ae){d([]),oe(void 0),p([]),O(void 0);return}let E=!1;return ye(!0),Rt({libraryId:ae,limit:200}).then(Ae=>{var Xe;if(E)return;const Ie=Ae.items;d(Ie);const ea=(Xe=Ie.find(ia=>ia.collectionId===m.collectionId))==null?void 0:Xe.collectionId;oe(ea)}).catch(()=>{E||(d([]),oe(void 0))}).finally(()=>{E||ye(!1)}),()=>{E=!0}},[m.collectionId,ae]),i.useEffect(()=>{if(!ae||!$){p([]),O(void 0);return}let E=!1;return le(!0),Ii({libraryId:ae,collectionId:$}).then(Ae=>{var Xe,ia,ba,sa;if(E)return;p(Ae);const Ie=(ia=(Xe=X.current.byLibrary)==null?void 0:Xe[ae])==null?void 0:ia.lastRevisionId,ea=((ba=Ae.find(aa=>aa.revisionId===m.revisionId))==null?void 0:ba.revisionId)??((sa=Ae.find(aa=>aa.revisionId===Ie))==null?void 0:sa.revisionId);O(ea)}).catch(()=>{E||(p([]),O(void 0))}).finally(()=>{E||le(!1)}),()=>{E=!0}},[m.revisionId,$,ae]),i.useEffect(()=>{const E=m.infoId;if(!ae||!E){q(void 0);return}let Ae=!1;return Za({libraryId:ae,infoId:E}).then(Ie=>{if(Ae)return;const ea=Ie.payload;q((ea==null?void 0:ea.label)??(ea==null?void 0:ea.name)??(ea==null?void 0:ea.title)??Ie.infoId)}).catch(()=>{Ae||q(E)}),()=>{Ae=!0}},[m.infoId,ae]),i.useEffect(()=>{if(!Ke.current||m.libraryId&&_.some(Ie=>Ie.libraryId===m.libraryId)&&m.libraryId!==ae||m.target&&m.target!==j||m.revisionView&&m.revisionView!==be||m.revisionId&&m.revisionId!==D||gr[j].requiresCollection&&!$&&m.target==="all_collections"&&m.collectionId)return;const E=It(`${S.pathname}${S.search}`),Ae=It(br(ae,j,$,be,D,m.infoId));if(E===Ae){pe.current=null;return}pe.current!==Ae&&(pe.current=Ae,l(Ae,{replace:!0}))},[_,S.pathname,S.search,l,m.collectionId,m.infoId,m.libraryId,m.revisionId,m.revisionView,m.target,$,ae,D,be,j]),i.useEffect(()=>{if(typeof window>"u")return;const E=()=>{window.innerWidth>920&&o(!1)};return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]),i.useEffect(()=>{if(!Ke.current||!ze||!ae||Ce.current)return;const E=X.current,Ae={...E.byLibrary??{}},Ie={...Ae[ae]??{},lastCollectionId:$,lastRevisionId:D,lastRevisionView:be,lastTarget:j},ea={version:1,lastLibraryId:ae,byLibrary:{...Ae,[ae]:Ie}},Xe=JSON.stringify(E),ia=JSON.stringify(ea);if(Xe===ia)return;X.current=ea,Ce.current=!0,(async()=>{try{if(Re)await Ei(Re,{plainValue:ia});else{const sa=await Fi(ze,{itemName:ur,itemType:"data",plainValue:ia});W(sa.dataItemId)}}catch{Le(y.status.savePrefsFailed)}finally{Ce.current=!1}})()},[Re,ze,$,ae,D,be,j,y.status.savePrefsFailed]);const _e=async()=>{const E=Ne.trim();if(!E){Le(a.cogita.user.libraryNameRequired);return}Le(null);try{const Ae=await Bi({name:E});G(Ie=>[Ae,...Ie]),B(Ae.libraryId),Y("library_overview"),oe(void 0),De("")}catch{Le(a.cogita.user.libraryCreateFailed)}},Ye=async()=>{if(!ae){Le(y.status.selectLibraryFirst);return}const E=Me.trim();if(!E){Le(a.cogita.library.collections.saveRequiredName);return}Le(null);try{const Ae=await zr({libraryId:ae,name:E,items:[]}),Ie=await Rt({libraryId:ae,limit:200});d(Ie.items),oe(Ae.collectionId),O(void 0),Y("all_collections"),ke("detail"),Qe("")}catch{Le(a.cogita.library.collections.saveFail)}},Ue=async()=>{if(!ae||!$){Le(y.status.selectLibraryFirst);return}const E=Oe.trim();if(!E){Le(y.revisionForm.nameLabel);return}Le(null);try{const Ae=await Ai({libraryId:ae,collectionId:$,name:E,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});p(Ie=>[Ae,...Ie]),O(Ae.revisionId),Y("all_collections"),ke("settings"),Fe("")}catch{Le(y.status.loadFailed)}};return e.jsx(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${ge?"open":""}`,"aria-label":y.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Pe==null?void 0:Pe.name)??y.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Pe?y.sidebar.libraryActionsHint:y.status.selectLibraryFirst}),Ze?e.jsx("div",{className:"cogita-sidebar-actions",children:Ze.options.map(E=>e.jsx("button",{type:"button",className:`ghost ${String(Ze.value)===E.value?"active":""}`,onClick:()=>Ze.onSelect(E.value),disabled:Ze.disabled,children:E.label},`sidebar:target:${E.value}`))}):null]}),Ve?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:Ve.name}),e.jsx("p",{className:"cogita-sidebar-note",children:y.sidebar.collectionActionsHint}),Je?e.jsx("div",{className:"cogita-sidebar-actions",children:Je.options.map(E=>e.jsx("button",{type:"button",className:`ghost ${String(Je.value)===E.value?"active":""}`,onClick:()=>Je.onSelect(E.value),disabled:Je.disabled,children:E.label},`sidebar:revision:${E.value}`))}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:y.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:h,children:y.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{P("cogita"),o(!1)},children:y.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:g,children:f?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),ge?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":y.sidebar.closeMenu,onClick:()=>o(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":y.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>o(E=>!E),"aria-label":ge?y.sidebar.closeMenu:y.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),se.map((E,Ae)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Ae>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,E.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":E.label,children:E.selectedLabel}):e.jsxs("select",{"aria-label":E.label,value:E.value,onChange:Ie=>E.onSelect(Ie.target.value),disabled:E.disabled,children:[E.emptyOption?e.jsx("option",{value:"",children:E.emptyOption}):null,E.options.map(Ie=>e.jsx("option",{value:Ie.value,children:Ie.label},`${E.key}:${Ie.value}`))]})]},`menu:${E.key}`))]}),ta?e.jsxs(e.Fragment,{children:[j==="all_collections"&&$&&be==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:y.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:y.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:Oe,onChange:E=>Fe(E.target.value),placeholder:y.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ue,children:y.revisionForm.createAction}),we?e.jsx("p",{className:"cogita-form-error",children:we}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Jr.Provider,{value:!0,children:ta})})]}):null,ta?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:y.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[se.map((E,Ae)=>e.jsxs("span",{children:[Ae>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:E.selectedLabel})]},`path:${E.key}`)),N?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:y.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[y.path.currentRoute," ",e.jsx("code",{children:br(ae,j,$,be,D,m.infoId)})]}),ae?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${ae}`,children:y.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${ae}/list`,children:y.links.allCards}),$?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${ae}/collections/${$}/shared-revisions`,children:y.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:y.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ne,onChange:E=>De(E.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:_e,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Me,onChange:E=>Qe(E.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!ae})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ye,disabled:!ae,children:a.cogita.library.collections.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:y.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:Oe,onChange:E=>Fe(E.target.value),placeholder:y.revisionForm.namePlaceholder,disabled:!$})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ue,disabled:!$,children:y.revisionForm.createAction}),we?e.jsx("p",{className:"cogita-form-error",children:we}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:y.panels.collections}),M?e.jsx("p",{className:"cogita-library-subtitle",children:y.status.loadingCollections}):null,!M&&U.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:y.status.noCollections}):null,U.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:U.map(E=>e.jsxs("button",{type:"button",className:`cogita-card-item ${E.collectionId===$?"active":""}`,onClick:()=>{oe(E.collectionId),O(void 0),ke("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:y.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:E.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[E.itemCount," ",y.cards.itemsSuffix]})]},E.collectionId))}):null]})]})]})]})})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Un},Symbol.toStringTag,{value:"Module"}));function Wn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,shareId:l}){const[S,m]=i.useState(null),[y,_]=i.useState("loading"),[G,U]=i.useState(a.cogita.library.collections.defaultName),[d,b]=i.useState("Cogita Library"),[p,ae]=i.useState([]),[B,j]=i.useState([]),[Y,$]=i.useState("idle"),[oe,D]=i.useState({current:0,total:0}),[O,be]=i.useState(0),[ke,ce]=i.useState(""),[q,ge]=i.useState(null),[o,ee]=i.useState(null),[w,M]=i.useState(null),[ye,ie]=i.useState(null),[le,we]=i.useState([]),[Le,Ne]=i.useState({}),[De,Me]=i.useState({}),[Qe,Oe]=i.useState(null),[Fe,ze]=i.useState(null),[oa,Re]=i.useState(null),[W,X]=i.useState(null),[Ke,Ce]=i.useState({}),pe=i.useRef(0),[Pe,Ve]=i.useState(null),qe=i.useRef(null),Be=i.useRef(null),[v,T]=i.useState(null),[Q,t]=i.useState(!1),[r,u]=i.useState(null),[N,V]=i.useState([]),[te,re]=i.useState(null),ne=i.useRef(null),ue=i.useRef(null),[se,ve]=i.useState(null),[Ze,Je]=i.useState(0),ta=i.useRef(null),_e=i.useRef({}),[Ye,Ue]=i.useState(!1),[E,Ae]=i.useState({}),Ie=i.useRef(null),ea=i.useRef(new Set),Xe=i.useRef({}),[ia,ba]=i.useState([]),[sa,aa]=i.useState(new Set),[la,Ma]=i.useState(!1),Ba=jr(),Da=i.useMemo(()=>new URLSearchParams(Ba.search),[Ba.search]),ha=i.useMemo(()=>Da.get("key")??"",[Da]),ja=(S==null?void 0:S.mode)??"random",pa=(S==null?void 0:S.check)??"exact",fa=(S==null?void 0:S.limit)??20,Ee=i.useMemo(()=>Lr((S==null?void 0:S.revisionType)??ja),[S,ja]),na=i.useMemo(()=>{const R=S==null?void 0:S.revisionSettings,Z=ei(Ee,Da);return Qt(Ee,R??Z)},[S,Da,Ee]),$a=i.useMemo(()=>a.cogita.library.revision[Ee.labelKey]??ja,[a,ja,Ee]),Ka=i.useMemo(()=>pa==="exact"?a.cogita.library.revision.checkValue:pa,[a,pa]),je=y==="ready"?p[O]??null:null,et=(je==null?void 0:je.checkType)==="translation-match"&&W,Oa=i.useRef(new Map),at=i.useRef(new Map),tt=i.useRef(new Map),pt=i.useRef(new Map),Gt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?ra(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),rt=i.useMemo(()=>{var Z;return Ee.id!=="levels"?p.length:((Z=E.pool)==null?void 0:Z.length)??Ee.getFetchLimit(fa,na)},[E,na,Ee,p.length,fa]),it=Ee.getProgressTotal?Ee.getProgressTotal(p,E,fa,na):Ee.id==="levels"?Math.min(fa,rt):p.length,Sa=it?Math.min(O+1,it):0,ka=Math.max(1,Number(na.tries??1)),Va=na.compare??"anchors",ma=Math.max(0,Math.min(100,Number(na.minCorrectness??0))),ca=(na.considerDependencies??"on")==="on",Ca=Math.max(0,Math.min(100,Number(na.dependencyThreshold??85))),Wa=R=>{const Z=R.slice();for(let c=Z.length-1;c>0;c-=1){const x=Math.floor(Math.random()*(c+1));[Z[c],Z[x]]=[Z[x],Z[c]]}return Z},qa=R=>R.length?R.reduce((c,x)=>c+x,0)/R.length/255*100:0,nt=R=>qa(R)>=ma,Xt=async()=>{const R=await Aa(),Z=new Map,c=new Map;R.forEach(L=>{const J=`${L.itemType}:${L.itemId}`,C=Ea(L.itemType,L.itemId,L.checkType,L.direction);Z.has(J)||Z.set(J,[]),Z.get(J).push(L),c.has(C)||c.set(C,[]),c.get(C).push(L)});const x=new Map,I=new Map;return Z.forEach((L,J)=>x.set(J,Fa(L).score)),c.forEach((L,J)=>I.set(J,Fa(L).score)),{itemKnowness:x,cardKnowness:I}},ft=async R=>{const Z=E,c=R.concat(Z.active??[]).concat(Z.pool??[]).filter((H,de,he)=>he.findIndex(xe=>me(xe)===me(H))===de);if(!ca){aa(new Set(c.map(me)));return}const{itemKnowness:x,cardKnowness:I}=await Xt(),L=H=>{if(H.cardType!=="info"||H.infoType!=="quote"||H.checkType!=="quote-fragment")return!0;const de=wa(H.direction);if(!(de!=null&&de.fragmentId))return!0;const he=H.description??"";if(!he.trim())return!0;const fe=bt(he).nodes[de.fragmentId];if(!fe||!fe.leftId&&!fe.rightId)return!0;const Se=[fe.leftId,fe.rightId].filter(Ge=>!!Ge);if(Se.length===0)return!0;const $e=Se.map(Ge=>{const ua=Ea("info",H.cardId,"quote-fragment",wt(de.mode,Ge));return I.get(ua)??0});return $e.reduce((Ge,ua)=>Ge+ua,0)/$e.length>=Ca},J=(S==null?void 0:S.collectionId)??null,C=J?ia.filter(H=>ga(H.childItemType)==="collection"&&H.childItemId===J&&!ga(H.childCheckType)&&!ga(H.childDirection)):[],z=J&&c.length>0?c.reduce((H,de)=>H+(I.get(me(de))??0),0)/c.length:0,F=new Set;for(const H of c){if(H.cardType!=="info"){F.add(me(H));continue}if(!L(H))continue;const de=ia.filter(fe=>li(fe,H)).concat(C);if(de.length===0){F.add(me(H));continue}let he=0;for(const fe of de)if(ga(fe.parentItemType)==="collection")he+=fe.parentItemId===J?z:0;else if(ga(fe.parentCheckType)||ga(fe.parentDirection)){const Se=ga(fe.parentCheckType),$e=ga(fe.parentDirection),He=Ea(fe.parentItemType,fe.parentItemId,Se,$e);he+=I.get(He)??0}else{const Se=`${fe.parentItemType}:${fe.parentItemId}`;he+=x.get(Se)??0}he/de.length>=Ca&&F.add(me(H))}aa(F)},Zt=R=>{for(let Z=R;Z<p.length;Z+=1){const c=p[Z];if(c&&(!ca||c.cardType!=="info"||sa.has(me(c))))return Z}return-1},lt=R=>!ca||R.cardType!=="info"||sa.has(me(R)),er=R=>{if(Ee.id!=="temporal"&&Ee.id!=="levels")return null;const Z=E,c=(Z.active??[]).concat(Z.pool??[]),x=new Set;for(const I of c){const L=me(I);if(!(x.has(L)||R.has(L))&&(x.add(L),lt(I)))return I}return null},Ta=i.useMemo(()=>{if(Ee.id!=="levels")return null;const R=E,Z=R.pool??[],c=R.active??[],x=R.levelMap??{},I=Math.max(1,Number(na.levels??1)),L=Array.from({length:I},()=>0),J=new Set(c.map(H=>me(H)));Z.forEach(H=>{const de=Math.min(I,Math.max(1,x[me(H)]??1));L[de-1]+=1});const C=Z.length||1,z=L.map(H=>H/C*100),F=je?x[me(je)]??1:null;return{counts:L,percentages:z,currentLevel:F,levelsCount:I,activeCount:c.length,poolCount:Z.length,activeSet:J}},[E,na,Ee,je]),ot=i.useMemo(()=>{if(Ee.id!=="temporal")return null;const R=E,Z=R.pool??[],c=R.active??[],x=R.knownessMap??{},I=new Set(R.unknownSet??[]);let L=0;Z.forEach(z=>{(x[me(z)]??0)>1&&(L+=1)});const J=I.size,C=c.map(z=>({id:me(z),value:I.has(me(z))?0:Math.max(0,Math.min(1,x[me(z)]??0))}));return{knownCount:L,unknownCount:J,dots:C}},[E,Ee]),Ia=i.useMemo(()=>{if(!ca)return 0;const R=E;return p.concat(R.active??[]).concat(R.pool??[]).filter((c,x,I)=>I.findIndex(L=>me(L)===me(c))===x).filter(c=>c.cardType==="info"&&!sa.has(me(c))).length},[ca,E,p,sa]);i.useEffect(()=>{if(!ca||Y!=="ready")return;const R=E,c=p.concat(R.active??[]).concat(R.pool??[]).filter((L,J,C)=>C.findIndex(z=>me(z)===me(L))===J).filter(L=>L.cardType!=="info"||sa.has(me(L))).length,x=ne.current;if(ne.current=c,x===null||c<=x)return;const I=c-x;re(`New card available (+${I})`),ue.current&&window.clearTimeout(ue.current),ue.current=window.setTimeout(()=>re(null),2200)},[ca,Y,E,p,sa]),i.useEffect(()=>()=>{ue.current&&window.clearTimeout(ue.current)},[]);const xa=(R,Z)=>{const c=Ee.applyOutcome({queue:p,meta:E},je,fa,na,{correct:R,correctness:Z,createdUtc:new Date().toISOString()});ae(c.queue),Ae(c.meta);const x=c.queue[O+1];x&&Na(x,O+1)};i.useEffect(()=>{if(!l){_("error");return}_("loading"),Di({shareId:l,key:ha}).then(R=>{m(R),U(R.collectionName),b(R.libraryName),_("ready")}).catch(()=>{_("error")})},[l,ha]),i.useEffect(()=>{l&&Ki({shareId:l,key:ha,type:"language"}).then(R=>j(R)).catch(()=>j([]))},[l,ha]),i.useEffect(()=>{!l||y!=="ready"||Oi({shareId:l,key:ha}).then(R=>ba(R.items??[])).catch(()=>ba([]))},[l,ha,y]),i.useEffect(()=>{if(!l||y!=="ready")return;let R=!0;return(async()=>{$("loading"),D({current:0,total:Ee.id==="levels"?0:Ee.getFetchLimit(fa,na)});try{const c=[];let x=null,I=null;do{const de=await Vi({shareId:l,key:ha,limit:300,cursor:x});if(c.push(...de.items),(Ee.id==="levels"||Ee.id==="temporal")&&de.total&&(I=de.total),D(he=>({current:c.length,total:he.total||de.total||Ee.getFetchLimit(fa,na)})),x=de.nextCursor??null,I!==null&&c.length>=I||Ee.id!=="levels"&&Ee.id!=="temporal"&&c.length>=Ee.getFetchLimit(fa,na))break}while(x);if(!R)return;const L=xr(c);let J;if(Ee.id==="levels"){const de=Math.max(1,Number(na.levels??1));J={},L.forEach(he=>{const xe=me(he);J[xe]=Math.max(1,Math.min(de,1))})}let C=null,z=null,F=null;if(Ee.id==="temporal"){const de=await Aa(),he=new Set(L.map(Se=>me(Se))),xe=de.reduce((Se,$e)=>{const He=Ea($e.itemType,$e.itemId,$e.checkType,$e.direction);return he.has(He)&&(Se[He]||(Se[He]=[]),Se[He].push($e)),Se},{});C={},z=new Set,F={};const fe=Date.now();L.forEach(Se=>{const $e=me(Se),He=xe[$e]??[];if(He.length===0){C[$e]=0,z.add($e),F[$e]=[];return}const Ge=wr(He);F[$e]=Ge;const ua=Jt(Ge,fe);C[$e]=ua.knowness})}const H=Ee.id==="levels"?Nr(L,fa,na,J):Ee.id==="temporal"?Tr(L,fa,na,C??{},z??new Set,F??{}):Ee.prepare(L,fa,na);ae(H.queue),Ae(H.meta),be(0),$("ready"),D(de=>({current:Math.min(de.current,de.total),total:de.total}))}catch{R&&$("error")}})(),()=>{R=!1}},[l,ha,fa,Ee,na,y]),i.useEffect(()=>{ft(p)},[p,ia,ca,Ca,S==null?void 0:S.collectionId]),i.useEffect(()=>{if(!je||!ca){Ma(!1);return}if(je.cardType!=="info"||sa.has(me(je))){Ma(!1);return}const R=Zt(O+1);if(R>=0){Ma(!1),be(R);return}if(Ee.id==="temporal"||Ee.id==="levels"){const Z=p.slice(0,O+1),c=p.slice(O+1).filter(lt),x=Z.concat(c),I=new Set(x.map(me)),L=er(I);if(L){const C=me(L);I.has(C)||(x.push(L),I.add(C),Ae(z=>{const F=z,H=new Set(F.queued??[]);return H.add(C),{...F,queued:H}}))}const J=x.findIndex((C,z)=>z!==O&&lt(C));if(J>=0){ae(x),be(J),Ma(!1);return}}Ma(!0)},[je,sa,ca,O,p,E,Ee.id]),i.useEffect(()=>{if(ce(""),ge(null),ve(null),Je(0),we([]),Ne({}),Me({}),Oe(null),ze(null),Re(null),t(!1),Ue(!1),T(null),X(null),Ce({}),!je){ee(null),M(null);return}je.cardType==="info"&&je.infoType==="computed"&&ee(a.cogita.library.revision.loadingComputed);let R=!0;return Na(je,O).then(Z=>{!R||!Z||(ee(Z.prompt),M(Z.expectedAnswer),we(Z.computedExpected),Ne(Z.computedAnswers),Oe(Z.answerTemplate),ze(Z.outputVariables),Re(Z.variableValues))}),()=>{R=!1}},[je,l,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){Ie.current=null,ea.current=new Set,ie(null);return}const R=je.description??"",Z=(je.label??"").trim(),c=Z.replace(/\s+/g," ").trim(),x=R.replace(/\s+/g," ").trim(),I=c&&c!==x?Z:a.cogita.library.infoTypes.quote;if(!R){ie(null),M(null);return}const L=bt(R);Ie.current=L,ee(I);let J=!0;return Aa().then(C=>{if(!J)return;const z=getQuoteMode(je.direction),F=new Map;C.forEach(fe=>{if(fe.itemType!=="info"||fe.checkType!=="quote-fragment"||!fe.direction)return;const Se=wa(fe.direction);if(!Se||Se.mode!==z)return;const $e=`${fe.itemId}:${Se.fragmentId}`;F.has($e)||F.set($e,[]),F.get($e).push(fe)});const H={},de=new Set;F.forEach((fe,Se)=>{const[$e,He]=Se.split(":",2);if($e!==je.cardId)return;const Ge=Fa(fe).score;H[He]=Ge,Ge>=Ca&&de.add(He)}),ea.current=de,Xe.current=H;const he=wa(je.direction);if(he!=null&&he.fragmentId&&L.nodes[he.fragmentId]){Ja(L,he.fragmentId,I);return}const xe=gt(L,de,H,Ca,ca,je.direction);Ja(L,(xe==null?void 0:xe.id)??null,I)}).catch(()=>{ea.current=new Set,Xe.current={};const C=wa(je.direction);if(C!=null&&C.fragmentId&&L.nodes[C.fragmentId]){Ja(L,C.fragmentId,I);return}const z=gt(L,ea.current,{},Ca,ca,je.direction);Ja(L,(z==null?void 0:z.id)??null,I)}),()=>{J=!1}},[je,a,ca,Ca]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){X(null),Ce({});return}const c=(E.pool??E.active??p).filter(C=>C.cardType==="vocab"&&C.checkType==="translation-match").filter((C,z,F)=>F.findIndex(H=>H.cardId===C.cardId)===z);c.some(C=>C.cardId===je.cardId)||c.unshift(je);const I=Wa(c).slice(0,6).map(C=>{const z=C.label.split("↔").map(de=>de.trim()).filter(Boolean);if(z.length<2)return null;const F=`${C.cardId}:L`,H=`${C.cardId}:R`;return{cardId:C.cardId,leftId:F,rightId:H,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),L=I.map(C=>C.leftId),J=Wa(I.map(C=>C.rightId));X({pairs:I,leftOrder:L,rightOrder:J,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,p,E]),i.useEffect(()=>()=>{qe.current&&window.clearTimeout(qe.current),Be.current&&window.clearTimeout(Be.current)},[]);const st=i.useRef(null);i.useEffect(()=>{if(!je)return;const R=me(je),Z=typeof document<"u"?document.activeElement:null;if(st.current===R&&Z&&(Z.tagName==="INPUT"||Z.tagName==="TEXTAREA"))return;let c=0;const x=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(le.length>0){const L=_t(Qe,le,Fe),J=L?_e.current[L]:null;if(J&&(J.focus(),document.activeElement===J)){st.current=R;return}}if(ta.current&&(ta.current.focus(),document.activeElement===ta.current)){st.current=R;return}}else if(je.cardType==="vocab"&&ta.current&&(ta.current.focus(),document.activeElement===ta.current)){st.current=R;return}c<6&&(c+=1,window.setTimeout(x,40))}},I=window.setTimeout(x,40);return()=>window.clearTimeout(I)},[je,le,Qe,Fe]),i.useEffect(()=>{if(!Ye)return;const R=Z=>{Z.key==="Enter"&&(Z.preventDefault(),ct())};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[Ye]);const ya=R=>{V(R),u(Fa(R))};i.useEffect(()=>{if(!je){u(null),V([]);return}const R=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Aa().then(Z=>{const c=Z.filter(x=>x.itemType==="info"&&x.itemId===je.cardId&&x.checkType==="quote-fragment"&&Vt(x.direction,je.direction));ya(c)}).catch(()=>{u(null),V([])});return}Kt(R,je.cardId,je.checkType,je.direction).then(Z=>ya(Z)).catch(()=>{u(null),V([])})},[je]);const za=(R,Z,c,x)=>{if(R==="info"&&c==="quote-fragment"){Aa().then(I=>{const L=I.filter(J=>J.itemType==="info"&&J.itemId===Z&&J.checkType==="quote-fragment"&&Vt(J.direction,x));ya(L)}).catch(()=>{u(null),V([])});return}Kt(R,Z,c,x).then(I=>ya(I)).catch(()=>{u(null),V([])})},Ha=(R,Z,c)=>{var J;const x=((J=c.pairs.find(C=>C.leftId===R))==null?void 0:J.rightId)??null;if(!x)return c;const I=x===Z;Ce(C=>({...C,[R]:I?"correct":"incorrect"})),qe.current&&window.clearTimeout(qe.current),Be.current&&window.clearTimeout(Be.current),pe.current+=1;const L={kind:I?"correct":"incorrect",tick:pe.current};if(Ve(null),qe.current=window.setTimeout(()=>Ve(L),0),Be.current=window.setTimeout(()=>Ve(null),420),I){const C={...c.locked,[R]:!0};return Object.keys(C).length>=c.pairs.length?(ge("correct"),Ue(!0)):ge("correct"),{...c,selection:{...c.selection,[R]:Z},activeLeft:null,activeRight:null,locked:C}}return ge("incorrect"),{...c,activeLeft:null,activeRight:null}},Nt=R=>{X(Z=>!Z||Z.locked[R]?Z:Z.activeRight?Ha(R,Z.activeRight,Z):{...Z,activeLeft:Z.activeLeft===R?null:R})},Lt=R=>{X(Z=>Z&&(Z.activeLeft?Ha(Z.activeLeft,R,Z):{...Z,activeRight:Z.activeRight===R?null:R}))},ct=()=>{var R;if(je&&je.cardType==="info"&&je.infoType==="quote"&&Ie.current&&ye&&!((R=wa(je.direction))!=null&&R.fragmentId)){const Z=gt(Ie.current,ea.current,Xe.current,Ca,ca,je.direction,ye.fragmentId);if(Z){ge(null),ce(""),t(!1),Me({}),Ue(!1),ve(null),Je(0),Ja(Ie.current,Z.id,ye.title);return}}ge(null),ce(""),t(!1),Me({}),Ue(!1),ve(null),Je(0),be(Z=>Math.min(Z+1,p.length))},Pa=R=>{if(!je)return;const Z=R.expected??null,c=R.answer??"";let x=Z??"",I=c;if(!Z&&R.expectedMap&&R.answerMap){const de=Object.keys(R.expectedMap).sort((he,xe)=>he.localeCompare(xe));x=de.map(he=>{var xe;return((xe=R.expectedMap)==null?void 0:xe[he])??""}).join("|"),I=de.map(he=>{var xe;return((xe=R.answerMap)==null?void 0:xe[he])??""}).join("|")}const L=x?ht(x,I,Va):new Uint8Array,J={revisionType:Ee.id,evalType:R.evalType,direction:R.direction,prompt:o??"",expected:Z,answer:c,expectedAnswers:R.expectedMap??null,answers:R.answerMap??null,correct:R.correct,maskBase64:L.length?_a(L):null,checkMode:pa,compareMode:Va,minCorrectness:ma},C=new TextEncoder().encode(JSON.stringify(J)),z=je.cardType==="info"?"info":"connection",F=R.overrideCheckType??je.checkType??null,H=R.overrideDirection??je.direction??null;Dt({itemType:z,itemId:je.cardId,checkType:F,direction:H,revisionType:Ee.id,evalType:R.evalType,correct:R.correct,maskBase64:L.length?_a(L):null,payloadBase64:_a(C)}).then(()=>{za(z,je.cardId,F,H),ft(p)}).catch(()=>{})},dt=(R,Z)=>{const c=Oa.current.get(Z);if(c)return Promise.resolve(c);const x=at.current.get(Z);if(x)return x;const I=qi({shareCode:l,infoId:R,key:ha}).then(L=>{var de,he;const J=L.payload,C=((de=J.definition)==null?void 0:de.graph)??null,z="",F=((he=J.definition)==null?void 0:he.answerTemplate)??"",H=kr(C,z,F);if(H){const fe={sample:Qr(H),answerTemplate:F||null};return Oa.current.set(Z,fe),fe}return Ir({shareId:l,infoId:R,key:ha}).then(xe=>{const fe={sample:xe,answerTemplate:null};return Oa.current.set(Z,fe),fe})}).catch(()=>Ir({shareId:l,infoId:R,key:ha}).then(L=>{const J={sample:L,answerTemplate:null};return Oa.current.set(Z,J),J}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{at.current.delete(Z)});return at.current.set(Z,I),I},Na=(R,Z)=>{var C;const c=`${me(R)}:${Z}`,x=tt.current.get(c);if(x)return Promise.resolve(x);const I=pt.current.get(c);if(I)return I;const L=z=>(tt.current.set(c,z),z);let J;if(R.cardType==="vocab"){if(R.checkType==="translation-match")return J=Promise.resolve(L({prompt:R.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),J;const z=R.label.split("↔").map(F=>F.trim()).filter(Boolean);if(z.length>=2){const H=(R.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",de=H?z[0]:z[1],he=H?z[1]:z[0];J=Promise.resolve(L({prompt:de,expectedAnswer:he,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else J=Promise.resolve(L({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(R.cardType==="info"&&R.infoType==="word"){const z=(C=R.description)!=null&&C.startsWith("Language: ")?R.description.replace("Language: ",""):null;J=Promise.resolve(L({prompt:R.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else R.cardType==="info"&&R.infoType==="computed"?J=dt(R.cardId,c).then(z=>{var xe,fe;if(!z.sample)return L({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const F=z.sample,H=F.expectedAnswers?Object.entries(F.expectedAnswers).map(([Se,$e])=>({key:Se,expected:$e})):[],de=H.reduce((Se,$e)=>(Se[$e.key]="",Se),{}),he=F.expectedAnswerIsSentence&&((xe=F.expectedAnswer)==null?void 0:xe.trim())||null;return L({prompt:F.prompt,expectedAnswer:H.length>0?he:((fe=F.expectedAnswer)==null?void 0:fe.trim())||null,computedExpected:H,computedAnswers:de,answerTemplate:z.answerTemplate,outputVariables:F.outputVariables??null,variableValues:F.variableValues??null})}).catch(()=>L({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{pt.current.delete(c)}):J=Promise.resolve(L({prompt:R.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return pt.current.set(c,J),J},Ja=(R,Z,c)=>{const x=Object.keys(R.nodes).length,I=ea.current.size;if(!Z){ie({title:c,before:R.text,after:"",fragmentId:null,total:x,completed:I}),M(null),Ue(!0);return}const L=R.nodes[Z];if(!L)return;const J=Gr(R.text,L);ie({title:c,before:J.before,after:J.after,fragmentId:L.id,total:x,completed:I}),M(J.fragment),Ue(!1)},xt=()=>{const R=Ie.current;R&&ie(Z=>Z&&{...Z,total:Object.keys(R.nodes).length,completed:ea.current.size})},Ra=()=>{const R=p[O+1];R&&Na(R,O+1)},Ct=()=>{if(Ra(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&W){if(W.pairs.length===0){ge("incorrect"),Ue(!0);return}const L=W.pairs.reduce((he,xe)=>(he[xe.rightId]=xe.rightLabel,he),{});let J=0;const C={};W.pairs.forEach(he=>{const fe=W.selection[he.leftId]===he.rightId;C[he.leftId]=fe?"correct":"incorrect",fe&&(J+=1)});const z=W.pairs.length||1,F=J/z,H=J===W.pairs.length;Ce(he=>({...he,...C})),H?(ge("correct"),Ue(!0),Je(0)):(ge("incorrect"),Ue(!1),Je(he=>{const xe=he+1;return xe>=ka&&(t(!0),Ue(!0),X(fe=>{if(!fe)return fe;const Se=fe.pairs.reduce(($e,He)=>($e[He.leftId]=He.rightId,$e),{});return{...fe,selection:Se}})),xe})),xa(H,F);const de="connection";Promise.all(W.pairs.map(he=>{const xe=W.selection[he.leftId]??null,fe=xe?L[xe]:"",Se={left:he.leftLabel,expected:he.rightLabel,answer:fe,checkType:"translation-match"},$e=new TextEncoder().encode(JSON.stringify(Se));return Dt({itemType:de,itemId:he.cardId,checkType:"translation-match",direction:null,revisionType:Ee.id,evalType:"translation-match",correct:xe===he.rightId,maskBase64:null,payloadBase64:_a($e)})})).then(()=>{za(de,je.cardId,je.checkType,je.direction),ft(p)}).catch(()=>{});return}if(le.length>0){const L=le.reduce((C,z)=>{const F=Le[z.key]??"";return C[z.key]=va(F)===va(z.expected)?"correct":"incorrect",C},{});le.every(({key:C,expected:z})=>{const F=Le[C]??"";return pa==="exact"&&va(F)===va(z)})?(ge("correct"),Me(L),Ue(!0),Je(0),xa(!0,1),Pa({correct:!0,direction:o?`${o} -> computed`:"computed",expectedMap:le.reduce((C,z)=>(C[z.key]=z.expected,C),{}),answerMap:Le,evalType:"computed"})):(ge("incorrect"),Me(L),Ue(!1),Je(C=>{const z=C+1;return z>=ka&&Ya&&(t(!0),Ue(!0)),z}),xa(!1,0),window.setTimeout(()=>{var z;const C=_t(Qe,le,Fe);C&&_e.current[C]&&((z=_e.current[C])==null||z.focus())},40),Pa({correct:!1,direction:o?`${o} -> computed`:"computed",expectedMap:le.reduce((C,z)=>(C[z.key]=z.expected,C),{}),answerMap:Le,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(ye!=null&&ye.fragmentId)){if(!w)return;const L=wa(je.direction),J=(L==null?void 0:L.mode)??getQuoteMode(je.direction),C=L!=null&&L.fragmentId&&je.direction?je.direction:wt(J,ye.fragmentId),z=ni(w,ke,Va),F=pa==="exact"&&mt(ke)===mt(w),H=nt(z),de=F||H,he=qa(z);de?(Xe.current[ye.fragmentId]=Math.max(Xe.current[ye.fragmentId]??0,he),(Xe.current[ye.fragmentId]??0)>=Ca&&ea.current.add(ye.fragmentId),xt(),ge("correct"),Me({}),Ue(!0),ve(z),Je(0),he<100&&ka<=1&&t(!0),xa(!0,he/100),Pa({correct:!0,direction:`quote:${ye.fragmentId}`,expected:w,answer:ke,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:C})):(ge("incorrect"),Me({}),Ue(!1),ve(z),Je(xe=>{const fe=xe+1;return fe>=ka&&Ya&&(t(!0),Ue(!0)),fe}),xa(!1,he/100),window.setTimeout(()=>{var xe;return(xe=ta.current)==null?void 0:xe.focus()},40),Pa({correct:!1,direction:`quote:${ye.fragmentId}`,expected:w,answer:ke,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:C}));return}if(!w)return;const R=ht(w,ke,Va),Z=pa==="exact"&&va(ke)===va(w),c=nt(R),x=Z||c,I=qa(R);x?(ge("correct"),Me({}),Ue(!0),ve(R),Je(0),I<100&&ka<=1&&t(!0),xa(!0,I/100),Pa({correct:!0,direction:o?`${o} -> ${w}`:null,expected:w,answer:ke,evalType:"text"})):(ge("incorrect"),Me({}),Ue(!1),ve(R),Je(L=>{const J=L+1;return J>=ka&&Ya&&(t(!0),Ue(!0)),J}),xa(!1,I/100),window.setTimeout(()=>{var L;return(L=ta.current)==null?void 0:L.focus()},40),Pa({correct:!1,direction:o?`${o} -> ${w}`:null,expected:w,answer:ke,evalType:"text"}))},ut=R=>{if(Ra(),!w)return;const Z=ht(w,R,Va),c=va(R)===va(w),x=nt(Z),I=c||x,L=qa(Z);I?(ge("correct"),Me({}),Ue(!0),ve(Z),Je(0),L<100&&ka<=1&&t(!0),xa(!0,L/100),Pa({correct:!0,direction:"word->language",expected:w,answer:R,evalType:"language-select"})):(ge("incorrect"),Me({}),Ue(!1),ve(Z),Je(J=>{const C=J+1;return C>=ka&&Ya&&(t(!0),Ue(!0)),C}),xa(!1,L/100),Pa({correct:!1,direction:"word->language",expected:w,answer:R,evalType:"language-select"}))},Mt=R=>{var c;if(R.key!=="Enter")return;if(R.preventDefault(),R.stopPropagation(),Ye){ct();return}const Z=le.find(x=>!(Le[x.key]??"").trim());if(Z){(c=_e.current[Z.key])==null||c.focus();return}Ct()},ar=()=>{Ra(),ge("correct"),Ue(!0),Je(0),xa(!0,1),w&&Pa({correct:!0,direction:"manual",expected:w,answer:ke,evalType:"manual"})},tr=()=>{if(xa(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){ge(null),ce(""),t(!1),Me({}),Ue(!1),ve(null),Je(0),be(R=>Math.min(R+1,p.length));return}ct()};i.useEffect(()=>{Ra()},[O,p]);const rr=a.cogita.library.revision.revealModeAfterIncorrect,Ya=le.length>0||!!w;return e.jsxs(La,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:h,onToggleSecureMode:g,onLogout:k,secureMode:f,onNavigate:P,language:A,onLanguageChange:K,children:[(y==="loading"||Y==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:y==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${oe.total?Math.min(100,Math.max(0,oe.current/oe.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:oe.total?`${Math.min(oe.current,oe.total)} / ${oe.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:G}),e.jsx("p",{className:"cogita-library-subtitle",children:d}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",$a).replace("{check}",Ka)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Ta?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Ta.currentLevel??"-"," / ",Ta.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ti,{outcomes:N})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[te?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:te})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Pe?`${Pe.kind}-${Pe.tick}`:et?"idle":q??"idle",children:y!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:y==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):je?e.jsx(e.Fragment,{children:la?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ai,{copy:a,currentCard:je,currentTypeLabel:Gt,prompt:o,languages:B,answer:ke,onAnswerChange:R=>ce(Z=>qt(Z,R,v)),computedExpected:le,computedAnswers:Le,onComputedAnswerChange:(R,Z)=>Ne(c=>({...c,[R]:qt(c[R]??"",Z,v)})),answerTemplate:Qe,outputVariables:Fe,variableValues:oa,computedFieldFeedback:De,feedback:q,canAdvance:Ye,quoteContext:ye,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ct,onSkip:tr,onLanguageSelect:ut,onMarkReviewed:ar,onAdvance:ct,showCorrectAnswer:Q,setShowCorrectAnswer:t,onRevealCorrect:()=>Ue(!0),answerMask:se,expectedAnswer:w,hasExpectedAnswer:Ya,handleComputedKeyDown:Mt,answerInputRef:ta,computedInputRefs:_e,scriptMode:v,setScriptMode:T,matchPairs:W==null?void 0:W.pairs,matchLeftOrder:W==null?void 0:W.leftOrder,matchRightOrder:W==null?void 0:W.rightOrder,matchSelection:W==null?void 0:W.selection,matchActiveLeft:W==null?void 0:W.activeLeft,matchActiveRight:W==null?void 0:W.activeRight,matchFeedback:Ke,onMatchLeftSelect:Nt,onMatchRightSelect:Lt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:it?`${Sa} / ${it}`:a.cogita.library.revision.progressUnlimited}),y==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),y==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),y==="ready"&&Y==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),y==="ready"&&Y==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),y==="ready"&&Y==="ready"&&p.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:rr}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",ka]})]})]}),Ta?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Ta.activeCount," / ",Ta.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Ta.counts.map((R,Z)=>{const c=Z+1,x=Ta.currentLevel===c,I=Ta.percentages[Z]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":x,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:c}),e.jsx("strong",{children:R})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,I))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[I.toFixed(1),"%"]})]},`level-${c}`)})})]}):null,ot?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ot.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ot.dots.map(R=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-R.value))}, ${Math.round(200*R.value)}, 80, 0.9)`}},R.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ot.knownCount})]})]}):null,ca?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Ia})]})}):null]})]})]})})})]})]})}const Gn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Wn},Symbol.toStringTag,{value:"Module"}));export{Yn as C,Qn as a,Gn as b};
