import{r as n,j as e,u as Qa,a as Ea,b as Gn,c as Yn,d as Xn,R as fn,B as bn,C as yn,Q as Hs}from"./vendor-CAC2WLor.js";import{L as Qs,A as Ws,g as Gs,a as xr,b as Ua,c as Zn,s as us,d as es,e as vr,f as Mn,h as aa,i as jr,j as wr,k as nn,l as sn,m as Ys,n as ts,o as Jn,p as kr,u as hs,q as as,r as Nr,t as Sr,v as Tr,w as Cr,x as Ir,y as Xs,z as Mr,B as Zs,C as er,D as Lr,E as Ar,F as xn,G as Ja,H as $r,I as tr,J as Rr,K as ns,M as ar,N as Pr,O as Er,P as Fr,Q as Hn,R as ya,S as Kr,T as _r,U as Dr,V as Br,W as zr,X as Or,Y as Vr,Z as qr,_ as Ur,$ as Jr,a0 as Hr,a1 as gs,a2 as Qr,a3 as ms,a4 as ps,a5 as Wr,a6 as nr,a7 as Gr,a8 as Yr,a9 as Xr,aa as Zr,ab as Qn,ac as ei,ad as ti,ae as ai,af as ni}from"./recreatio-core-R1dGNl-U.js";import"./vendor-cogita-ui-DTaQ_FiW.js";const Oa={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},Ba={moveMs:900,pauseMs:220,errorMs:900},si=(t=11)=>{let a=t;const s=()=>(a=(a*1664525+1013904223)%4294967296,a/4294967296),{width:r,height:i,paddingX:u,paddingY:c,levels:y}=Oa,m=(i-c*2)/(y.length-1),j=[],d=[],b=[];y.forEach((v,x)=>{const Z=i-c-x*m,_=r-u*2,k=[];for(let H=0;H<v;H+=1){const T=u+(H+1)*_/(v+1),ee=(s()-.5)*18,C=Math.max(u,Math.min(r-u,T+ee)),$=x===0?3:x<2?2.1:1.4,ie=x===0?"root":`l${x}-${H}`;k.push({id:ie,x:x===0?r/2:C,y:Z,r:$,level:x,role:x===0?"root":void 0})}b.push(k),j.push(...k)});const o=b[b.length-1];if(o!=null&&o.length){const v=o[Math.floor(o.length/2)];v.role="goal",v.r=2}for(let v=1;v<b.length;v+=1){const x=b[v-1];b[v].forEach(_=>{const k=[...x].sort((C,$)=>Math.abs(C.x-_.x)-Math.abs($.x-_.x)),H=k[0],T=k[1]&&s()<.45?k[1]:null;(T?[H,T]:[H]).forEach(C=>{d.push({from:C.id,to:_.id,key:`${C.id}-${_.id}`})}),s()<.2&&k[2]&&d.push({from:k[2].id,to:_.id,key:`${k[2].id}-${_.id}`})})}const l=new Map;d.forEach(v=>{const x=l.get(v.to)??[];x.push(v.from),l.set(v.to,x)});const w=new Map,h=new Map,N=new Map;d.forEach(v=>{const x=w.get(v.from)??[];x.push(v.key),w.set(v.from,x);const Z=h.get(v.from)??[];Z.push(v.to),h.set(v.from,Z);const _=N.get(v.from)??[];_.push(v.to),N.set(v.from,_);const k=N.get(v.to)??[];k.push(v.from),N.set(v.to,k)});const A=new Map;return j.forEach(v=>{A.set(v.id,v)}),{nodes:j,links:d,parentsById:l,linksByFrom:w,childrenByFrom:h,neighborsById:N,nodesById:A}};function ri({slides:t,activeIndex:a,introOpen:s,prefersReducedMotion:r,onNext:i,onPrev:u,onSelect:c,onExit:y,onOpen:m,onRegister:j}){const d=a===t.length-1,b=s&&a===0?"entry":"docked",o=t[t.length-1],[l,w]=n.useState(!1),h=n.useMemo(()=>Array.from({length:20},(te,be)=>({src:`/cogita/logo/Cogita${String(be).padStart(2,"0")}.png`,kind:be<=11?"bubble":be<=17?"text":"recreatio"})),[]),N=s&&a===0;n.useEffect(()=>{if(!s){w(!1);return}a>0&&!l&&w(!0)},[a,s,l]);const A=n.useRef(0),v=n.useRef(null),x=n.useMemo(()=>{const te={x:40,y:160},be={x:260,y:48},p=6,S=be.x-te.x,E=te.y-be.y,q=S/p,X=[.3,.45,.6,.65,1.4,2.2],ye=X.reduce((Y,W)=>Y+W,0),Q=X.map(Y=>E*Y/ye),M=[te];let ke=te.x,ne=te.y;for(let Y=1;Y<=p;Y+=1){const W=(Math.random()-.5)*14,pe=(Math.random()-.5)*28;ke=Math.max(te.x+Y*14,Math.min(be.x-(p-Y)*14,ke+q+W));const ce=Q[Y-1]??Q[Q.length-1];ne=ne-ce+pe;const de=Math.max(be.y,Math.min(te.y-4,ne));M.push({x:Math.round(ke),y:Math.round(de)})}return M[M.length-1]=be,M},[]),Z=n.useMemo(()=>{const E=(ye,Q,M)=>Math.min(M,Math.max(Q,ye)),q=x.map(ye=>{const Q=10+Math.random()*36;return{x:E(ye.x,40,260),y:E(ye.y-Q,40,140)}}),X=x.map((ye,Q)=>{var ne;const M=12+Math.random()*40,ke=((ne=q[Q])==null?void 0:ne.y)??ye.y;return{x:E(ye.x,40,260),y:E(Math.max(ke+10,ye.y+M),60,170)}});return{upper:q,lower:X}},[x]),_=n.useMemo(()=>{var be;const te=((be=x[4])==null?void 0:be.x)??260;return Math.max(0,Math.min(240,te-40))},[x]),k=n.useMemo(()=>{var Q,M;const te=(ke,ne,Y)=>Math.min(Y,Math.max(ne,ke)),be=(ke,ne,Y)=>x.map((W,pe)=>{var bt,dt;const ce=((bt=Z.upper[pe])==null?void 0:bt.y)??W.y,de=((dt=Z.lower[pe])==null?void 0:dt.y)??W.y,Ce=(Math.random()-.5)*70,Be=W.y+ke+Ce,Ke=te(W.y+ne,ce+6,de-6),Ee=te(W.y+Y,ce+6,de-6);return{x:W.x,y:te(Be,Math.min(Ke,Ee),Math.max(Ke,Ee))}}),p=-14+Math.random()*28,S=14+Math.random()*28,E=be(p,-80,12),q=be(S,-12,80);for(let ke=4;ke<x.length;ke+=1){const ne=x[ke],Y=((Q=Z.upper[ke])==null?void 0:Q.y)??ne.y,W=((M=Z.lower[ke])==null?void 0:M.y)??ne.y;E[ke]={x:ne.x,y:te(ne.y-12,Y+6,W-6)},q[ke]={x:ne.x,y:te(ne.y+12,Y+6,W-6)}}const X=Z.upper.length?Z.upper[Z.upper.length-1].y:40,ye=Z.lower.length?Z.lower[Z.lower.length-1].y:170;return E[E.length-1]={x:x[x.length-1].x,y:te(x[x.length-1].y-14,X,ye)},q[q.length-1]={x:x[x.length-1].x,y:te(x[x.length-1].y+12,X,ye)},{higher:E,lower:q}},[x,Z]),H=1e4,T=n.useMemo(()=>{let te=17;const be=()=>(te=(te*1664525+1013904223)%4294967296,te/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((S,E)=>{const q=(be()-.5)*240,X=(be()-.5)*180,ye=(be()-.5)*24;return{id:`card-${E+1}`,throw:{x:`${q.toFixed(0)}px`,y:`${X.toFixed(0)}px`,rot:`${ye.toFixed(1)}deg`},grid:{x:`${S.x}px`,y:`${S.y}px`},delay:`${E*.12}s`}})},[]),ee=n.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[C,$]=n.useState([]),ie=n.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),he=n.useMemo(()=>{const be=[],S=(q,X)=>q+Math.random()*(X-q);for(let q=0;q<6;q+=1){let X=!1;for(let ye=0;ye<80;ye+=1){const Q=S(14,86),M=S(10,34);if(be.every(ne=>{const Y=ne.x-Q,W=ne.y-M;return Math.hypot(Y,W)>=12})){be.push({x:Q,y:M}),X=!0;break}}X||be.push({x:S(16,84),y:S(12,32)})}return be.map((q,X)=>({id:`p${X+1}`,x:`${q.x.toFixed(1)}%`,y:`${q.y.toFixed(1)}%`,xNum:q.x,yNum:q.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[Ne,Ge]=n.useState(0),[ge,R]=n.useState(0),[F,L]=n.useState([]),G=1e4,D=n.useMemo(()=>{if(he.length<2)return[];const te=X=>{let ye=X+1831565813;return ye=Math.imul(ye^ye>>>15,ye|1),ye^=ye+Math.imul(ye^ye>>>7,ye|61),((ye^ye>>>14)>>>0)/4294967296},be=(X,ye)=>Math.floor(te(X)*ye),p=new Set,S=[],E=Math.min(3,he.length);let q=0;for(;S.length<E&&q<30;){q+=1;const X=be(Ne*13+q*5,he.length),ye=be(Ne*29+q*7,he.length);if(X===ye)continue;const Q=X<ye?`${X}-${ye}`:`${ye}-${X}`;p.has(Q)||(p.add(Q),S.push({id:`link-${Q}`,from:he[X],to:he[ye],delay:`${(q*.35).toFixed(2)}s`}))}return S},[Ne,he]);n.useEffect(()=>{if(!s||a!==2)return;const te=()=>{const p=T.map(S=>S.id);for(let S=p.length-1;S>0;S-=1){const E=Math.floor(Math.random()*(S+1));[p[S],p[E]]=[p[E],p[S]]}return p.slice(0,4)};$(te());const be=window.setInterval(()=>{$(te())},H);return()=>window.clearInterval(be)},[a,s,T,H]),n.useEffect(()=>{if(!s||a!==3)return;const te=()=>{R(Math.floor(Math.random()*ie.length)),L(he.map(()=>Math.random()<.6?"good":"bad")),Ge(p=>p+1)};te();const be=window.setInterval(te,G);return()=>window.clearInterval(be)},[a,s,ie.length,he,G]);const P=n.useMemo(()=>si(11),[]),[J,z]=n.useState(new Set(["root"])),[le,xe]=n.useState(new Set),[Ie,Me]=n.useState(new Set),[Xe,it]=n.useState({fromId:"root",toId:"root",key:0}),$e=n.useRef(J),Ve=n.useRef("root"),kt=n.useRef(0),He=n.useRef(null),Re=n.useRef(null),rt=n.useRef([]);n.useEffect(()=>{$e.current=J},[J]);const gt=n.useMemo(()=>{const te=new Set;return J.forEach(be=>{const p=P.linksByFrom.get(be);p&&p.forEach(S=>te.add(S))}),te},[J,P]),at=P.nodesById.get(Xe.toId)??P.nodesById.get("root"),Le=at?`${at.x/Oa.width*100}%`:"50%",Ue=at?`${at.y/Oa.height*100}%`:"90%";n.useEffect(()=>{if(!s||a!==1||r)return;(()=>{z(new Set(["root"])),xe(new Set),Me(new Set),it({fromId:"root",toId:"root",key:0}),Re.current=null,kt.current=0,Ve.current="root",rt.current=[]})();const be=()=>{const S=Ve.current,E=$e.current,X=(P.childrenByFrom.get(S)??[]).filter(W=>!E.has(W));if(X.length)return X[Math.floor(Math.random()*X.length)];if(E.size>=P.nodes.length){const W=P.neighborsById.get(S)??[];return W.length?W[Math.floor(Math.random()*W.length)]:null}const ye=W=>(P.childrenByFrom.get(W)??[]).some(ce=>!E.has(ce)),Q=[S],M=new Set([S]),ke=new Map;let ne=null;for(;Q.length;){const W=Q.shift();if(!W)break;if(W!==S&&ye(W)){ne=W;break}(P.neighborsById.get(W)??[]).forEach(ce=>{M.has(ce)||(M.add(ce),ke.set(ce,W),Q.push(ce))})}if(!ne)return null;let Y=ne;for(;ke.get(Y)&&ke.get(Y)!==S;)Y=ke.get(Y)??Y;return Y},p=(S,E)=>{if(S===E){const q=be();q&&p(S,q);return}kt.current+=1,it({fromId:S,toId:E,key:kt.current}),Ve.current=E,He.current=window.setTimeout(()=>{const q=P.parentsById.get(E)??[],X=$e.current,ye=q.filter(ne=>!X.has(ne));if(!ye.length){const ne=new Set(X);ne.add(E),z(ne),He.current=window.setTimeout(()=>{for(;rt.current.length;){const W=rt.current[rt.current.length-1];if(!ne.has(W)){if(W!==E){p(E,W);return}break}rt.current.pop()}const Y=be();Y&&p(E,Y)},Ba.pauseMs);return}const Q=new Set([E,...ye]),M=new Set(ye.map(ne=>`${ne}-${E}`));xe(Q),Me(M),rt.current.includes(E)||rt.current.push(E);const ke=ye[Math.floor(Math.random()*ye.length)];Re.current={fromId:E,toId:ke},He.current=window.setTimeout(()=>{xe(new Set),Me(new Set);const ne=Re.current;ne&&p(ne.fromId,ne.toId)},Ba.errorMs)},Ba.moveMs)};return He.current=window.setTimeout(()=>{const S=be();S&&p(Ve.current,S)},Ba.pauseMs),()=>{He.current&&window.clearTimeout(He.current)}},[a,s,P,r]);const tt=te=>{if(!s)return;const be=Date.now();be-A.current<520||Math.abs(te.deltaY)<10||(A.current=be,te.deltaY>0?i():u(),te.preventDefault())},qe=te=>{if(!s)return;const be=te.touches[0];be&&(v.current={x:be.clientX,y:be.clientY})},V=te=>{if(!s)return;const be=v.current;if(v.current=null,!be)return;const p=te.changedTouches[0];if(!p)return;const S=p.clientX-be.x,E=p.clientY-be.y;Math.abs(E)<40||Math.abs(E)<Math.abs(S)||(E<0?i():u())};return e.jsxs("div",{className:`cogita-intro ${s?"is-open":"is-closed"} ${r?"is-reduced":""} ${d?"is-final":""}`,"data-slide":a+1,onWheel:tt,onTouchStart:qe,onTouchEnd:V,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":b,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${N&&!l?"is-entry":""}`,children:h.map((te,be)=>e.jsx("img",{src:te.src,alt:"",className:`cogita-logo-layer ${be===0?"is-base":""} ${te.kind==="text"?"is-text":te.kind==="recreatio"?"is-recreatio":""} ${te.kind==="bubble"?"is-bubble":""}`},te.src))})}),s&&t.map((te,be)=>{const p=be===a;return e.jsxs("section",{className:`cogita-intro-slide slide-${be+1} ${p?"is-active":""}`,"aria-hidden":!p,children:[e.jsxs("div",{className:"cogita-intro-text",children:[te.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:te.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:te.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:te.title}),te.body&&e.jsx("p",{children:te.body.split(`
`).map((S,E)=>e.jsxs("span",{children:[S,E===0&&e.jsx("br",{})]},String(E)))})]}),te.micro&&e.jsx("p",{className:"cogita-intro-micro",children:te.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:d?j:i,children:te.cta}),d&&te.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>c(0),children:te.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[be===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${Oa.width} ${Oa.height}`,preserveAspectRatio:"none",children:[P.links.map(S=>{const E=P.nodesById.get(S.from),q=P.nodesById.get(S.to);if(!E||!q)return null;const X=gt.has(S.key),ye=Ie.has(S.key);return e.jsx("line",{className:`map-link ${X?"is-active":""} ${ye?"is-error":""}`,x1:E.x,y1:E.y,x2:q.x,y2:q.y},S.key)}),P.nodes.map(S=>{const E=J.has(S.id),q=le.has(S.id);return e.jsx("circle",{className:`map-node ${S.role?`is-${S.role}`:""} ${E?"is-active":""} ${q?"is-error":""}`,cx:S.x,cy:S.y,r:S.r},S.id)})]}),at&&e.jsx("span",{className:"map-explorer-dot",style:{left:Le,top:Ue,"--move":`${Ba.moveMs}ms`}})]}),be===2&&e.jsx("div",{className:"cogita-index-cards",children:T.map(S=>{const E=C.indexOf(S.id),q=E>=0?ee[E]:null,X=(q==null?void 0:q.x)??"140px",ye=(q==null?void 0:q.y)??"140px",Q=E>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":S.throw.x,"--throw-y":S.throw.y,"--throw-rot":S.throw.rot,"--grid-x":S.grid.x,"--grid-y":S.grid.y,"--stack-x":X,"--stack-y":ye,"--stack-opacity":Q,"--delay":S.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},S.id)})}),be===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[ie.map((S,E)=>e.jsxs("div",{className:`round-card ${E===ge?"is-active":""}`,style:{"--card-x":S.x,"--card-y":S.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},S.id)),ie[ge]&&e.jsx("span",{className:"round-ring",style:{"--card-x":ie[ge].x,"--card-y":`calc(${ie[ge].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:he.map(S=>e.jsx("span",{className:"player-dot",style:{left:S.x,top:S.y,"--jitter-x":S.jitterX,"--jitter-y":S.jitterY,"--breath-delay":S.delay}},S.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:D.map(S=>e.jsx("line",{className:"round-link",x1:S.from.xNum,y1:S.from.yNum,x2:S.to.xNum,y2:S.to.yNum,style:{"--delay":S.delay}},S.id))}),e.jsx("div",{className:"round-flows",children:he.map((S,E)=>{const q=F[E]??"good",X=ie[ge];if(!X)return null;const ye=`calc(${X.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":S.x,"--from-y":S.y,"--to-x":X.x,"--to-y":ye,"--delay":`${E*.12}s`}}),e.jsx("span",{className:`return-dot is-${q}`,style:{"--from-x":X.x,"--from-y":ye,"--to-x":S.x,"--to-y":S.y,"--delay":`${E*.12}s`}}),e.jsx("span",{className:`result-pop is-${q}`,style:{"--at-x":S.x,"--at-y":S.y,"--delay":`${E*.12}s`}})]},`${S.id}-${Ne}`)})})]},`round-${Ne}`),be===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${x[0].x} ${x[0].y} L${x[1].x} ${x[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${x[1].x} ${x[1].y} L${x[2].x} ${x[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${x[2].x} ${x[2].y} L${x[3].x} ${x[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${x[3].x} ${x[3].y} L${x[4].x} ${x[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${x[4].x} ${x[4].y} L${x[5].x} ${x[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${x[5].x} ${x[5].y} L${x[6].x} ${x[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${_};${_};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${Z.upper.map((S,E)=>`${E===0?"M":"L"}${S.x} ${S.y}`).join(" ")} ${Z.lower.slice().reverse().map(S=>`L${S.x} ${S.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${Z.upper.map((S,E)=>`${E===0?"M":"L"}${S.x} ${S.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${Z.lower.map((S,E)=>`${E===0?"M":"L"}${S.x} ${S.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[k.higher.slice(0,6).map((S,E)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${E+1}`,d:`M${S.x} ${S.y} L${k.higher[E+1].x} ${k.higher[E+1].y}`,pathLength:"100"},`peer-1-${E}`)),k.lower.slice(0,6).map((S,E)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${E+1}`,d:`M${S.x} ${S.y} L${k.lower[E+1].x} ${k.lower[E+1].y}`,pathLength:"100"},`peer-2-${E}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${x[0].x/300*100}%`,"--p0y":`${x[0].y/200*100}%`,"--p1x":`${x[1].x/300*100}%`,"--p1y":`${x[1].y/200*100}%`,"--p2x":`${x[2].x/300*100}%`,"--p2y":`${x[2].y/200*100}%`,"--p3x":`${x[3].x/300*100}%`,"--p3y":`${x[3].y/200*100}%`,"--p4x":`${x[4].x/300*100}%`,"--p4y":`${x[4].y/200*100}%`,"--p5x":`${x[5].x/300*100}%`,"--p5y":`${x[5].y/200*100}%`,"--p6x":`${x[6].x/300*100}%`,"--p6y":`${x[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${k.higher[0].x/300*100}%`,"--q0y":`${k.higher[0].y/200*100}%`,"--q1x":`${k.higher[1].x/300*100}%`,"--q1y":`${k.higher[1].y/200*100}%`,"--q2x":`${k.higher[2].x/300*100}%`,"--q2y":`${k.higher[2].y/200*100}%`,"--q3x":`${k.higher[3].x/300*100}%`,"--q3y":`${k.higher[3].y/200*100}%`,"--q4x":`${k.higher[4].x/300*100}%`,"--q4y":`${k.higher[4].y/200*100}%`,"--q5x":`${k.higher[5].x/300*100}%`,"--q5y":`${k.higher[5].y/200*100}%`,"--q6x":`${k.higher[6].x/300*100}%`,"--q6y":`${k.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${k.lower[0].x/300*100}%`,"--q0y":`${k.lower[0].y/200*100}%`,"--q1x":`${k.lower[1].x/300*100}%`,"--q1y":`${k.lower[1].y/200*100}%`,"--q2x":`${k.lower[2].x/300*100}%`,"--q2y":`${k.lower[2].y/200*100}%`,"--q3x":`${k.lower[3].x/300*100}%`,"--q3y":`${k.lower[3].y/200*100}%`,"--q4x":`${k.lower[4].x/300*100}%`,"--q4y":`${k.lower[4].y/200*100}%`,"--q5x":`${k.lower[5].x/300*100}%`,"--q5y":`${k.lower[5].y/200*100}%`,"--q6x":`${k.lower[6].x/300*100}%`,"--q6y":`${k.lower[6].y/200*100}%`}})]})})}),be===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),be===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},te.id)}),!s&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:o.title}),o.body&&e.jsx("p",{children:o.body}),o.micro&&e.jsx("p",{className:"cogita-intro-micro",children:o.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:j,children:o.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:m,children:"Otwórz pokaz"})]})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:t.map((te,be)=>e.jsx("button",{type:"button",className:`dot ${a===be?"active":""}`,"aria-label":te.title,onClick:()=>c(be)},te.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:y,children:"Pomiń"})]})]})}const ii=6,oi=4;function li({copy:t,onAuthAction:a,authLabel:s,showProfileMenu:r,onProfileNavigate:i,onToggleSecureMode:u,onLogout:c,secureMode:y,onNavigate:m,language:j,onLanguageChange:d}){const b=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}m("home")},o=n.useRef(null),l=n.useRef([]),w=n.useMemo(()=>{let L=Date.now()%2147483647;const G=()=>(L=L*48271%2147483647,L/2147483647);return Array.from({length:ii},(D,P)=>{const J=6+G()*8,z=7+G()*10,le=6+G()*9,xe=-G()*J,Ie=-G()*z,Me=-G()*le,Xe=.18+G()*.28,it=12+G()*18,$e=4+G()*8,Ve=(G()-.5)*3.2,kt=(G()-.5)*3.8,He=G()>.5?"alternate":"alternate-reverse",Re=G()>.5?"alternate":"alternate-reverse",rt=G()>.5?"alternate":"alternate-reverse",gt=.18+G()*.42,at=30+G()*60,Le=-45-G()*38,Ue=188+G()*32,tt=.1+G()*.2;return{id:`wave-${P+1}`,style:{"--wave-sway-duration":`${J}s`,"--wave-scale-duration":`${z}s`,"--wave-drift-duration":`${le}s`,"--wave-sway-delay":`${xe}s`,"--wave-scale-delay":`${Ie}s`,"--wave-drift-delay":`${Me}s`,"--wave-sway-dir":He,"--wave-scale-dir":Re,"--wave-drift-dir":rt,"--wave-scale":`${Xe}`,"--wave-shift":`${it}%`,"--wave-xshift":`${$e}%`,"--wave-x0":`${Ve}%`,"--wave-y0":`${kt}%`,"--wave-opacity":`${gt}`,"--wave-blur":`${at}px`,"--wave-bottom":`${Le}%`,"--wave-hue":`${Ue}`,"--wave-glow":`${tt}`}}})},[]),h=n.useMemo(()=>{let L=Date.now()*3%2147483647;const G=()=>(L=L*48271%2147483647,L/2147483647);return Array.from({length:oi},(D,P)=>{const J=180+G()*220,z=220+G()*280,le=-G()*J,xe=-G()*z,Ie=.12+G()*.22,Me=3+G()*7,Xe=1+G()*3,it=(G()-.5)*2.8,$e=(G()-.5)*2.2;return{id:`mesh-${P+1}`,seed:1e3+P*991+Math.floor(G()*999),style:{"--mesh-sway-duration":`${J}s`,"--mesh-drift-duration":`${z}s`,"--mesh-sway-delay":`${le}s`,"--mesh-drift-delay":`${xe}s`,"--mesh-scale":`${Ie}`,"--mesh-shift":`${Me}%`,"--mesh-xshift":`${Xe}%`,"--mesh-x0":`${$e}%`,"--mesh-y0":`${it}%`}}})},[]),N=n.useMemo(()=>{const L=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],G=t.cogita.introSlides,D=new Map(G.map(P=>[P.id,P]));return L.map(P=>{var z;const J=D.get(P.id);return{...P,...J,title:(J==null?void 0:J.title)??"Cogita",cta:(J==null?void 0:J.cta)??((z=t.cogita.introSlides[0])==null?void 0:z.cta)??t.cogita.loginCta,secondary:J==null?void 0:J.secondary}})},[t.cogita.introSlides]),[A,v]=n.useState(0),[x,Z]=n.useState(!0),[_,k]=n.useState(!1),H=N.length-1,T=n.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),ee=n.useCallback(()=>{T(),a()},[T,a]),C=n.useCallback(()=>{Z(!0),v(0)},[]),$=n.useCallback(()=>{Z(!1),v(H)},[H]),ie=n.useCallback(L=>{v(Math.max(0,Math.min(H,L)))},[H]),he=n.useCallback(()=>{A>=H?ee():ie(A+1)},[A,ie,ee,H]),Ne=n.useCallback(()=>{ie(A-1)},[A,ie]);n.useEffect(()=>{var D;const L=(D=window.matchMedia)==null?void 0:D.call(window,"(prefers-reduced-motion: reduce)");if(!L)return;const G=()=>k(L.matches);return G(),L.addEventListener?(L.addEventListener("change",G),()=>L.removeEventListener("change",G)):(L.addListener(G),()=>L.removeListener(G))},[]),n.useEffect(()=>{if(!x)return;const L=G=>{const D=G.target;if(!D)return;const P=D.tagName;if(!(D.isContentEditable||P==="INPUT"||P==="TEXTAREA"||P==="SELECT"||P==="BUTTON"||P==="A"||D.closest('button, a, [role="button"], [role="link"]'))){if(G.key==="Escape"){$();return}if(G.key==="ArrowLeft"||G.key==="ArrowUp"){Ne();return}(G.key==="ArrowRight"||G.key==="ArrowDown"||G.code==="Space"||G.key===" ")&&(G.preventDefault(),he())}};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[$,he,Ne,x]),n.useEffect(()=>{x&&A===H&&T()},[A,x,H,T]),n.useEffect(()=>{const L=o.current;if(!L)return;const G=l.current.filter(Le=>!!Le);if(!G.length)return;const D=1,P=.6,J=.6,z=Math.max(1,Math.min(D,window.devicePixelRatio||1));let le=0,xe=0,Ie=P,Me=0,Xe=0;const it=Le=>{let Ue=Le%2147483647;return Ue<=0&&(Ue+=2147483646),(tt,qe)=>{Ue=Ue*48271%2147483647;const V=Ue/2147483647;return tt+V*(qe-tt)}},$e={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},Ve=Le=>{const Ue=Math.sin(Le*12.9898)*43758.5453;return Ue-Math.floor(Ue)},kt=Le=>{const Ue=Ve(Le+.1)||1e-4,tt=Ve(Le+.7)||1e-4;return Math.sqrt(-2*Math.log(Ue))*Math.cos(2*Math.PI*tt)},He=(Le,Ue)=>{const tt=Math.floor(Le),qe=tt+1,V=Le-tt,te=V*V*(3-2*V),be=Ve(tt*12.9898+Ue*78.233),p=Ve(qe*12.9898+Ue*78.233);return be+(p-be)*te},Re=Le=>{const Ue=it(Le),tt=Math.min(4,Math.max(4,Math.floor(le/1200*$e.filamentCount)));return Array.from({length:tt},(qe,V)=>{const te=Math.max(-1,Math.min(1,kt(Le+V*.37))),be=Math.min(1,Math.max(0,Ve(Le+V*1.31))),p=Math.min($e.depthLayers-1,Math.floor(be*$e.depthLayers));return{seed:Ue(0,Math.PI*2)+Le*.01,offset:te,freqA:$e.freq1*(.75+Ue(0,.5)),freqB:$e.freq2*(.75+Ue(0,.5)),ampA:$e.amp1*(.6+Ue(0,.7)),ampB:$e.amp2*(.6+Ue(0,.7)),width:2+V%5*.32,depth:be,layer:p}})},rt=(Le,Ue,tt)=>{const qe=Math.max(30,Math.floor(le*xe/14e4));Le.save(),Le.globalAlpha=.6;for(let V=0;V<qe;V+=1){const te=Ve(V*9.1+le*.11)*Ue+tt,be=Ve(V*3.7+xe*.23)*xe,p=1.2+Ve(V*5.9)*2.4,S=Le.createRadialGradient(te,be,0,te,be,p*2);S.addColorStop(0,"rgba(10, 30, 60, 0.45)"),S.addColorStop(1,"rgba(10, 30, 60, 0)"),Le.fillStyle=S,Le.beginPath(),Le.arc(te,be,p*2,0,Math.PI*2),Le.fill()}Le.restore()},gt=(Le,Ue)=>{Le.clearRect(0,0,le,xe);const tt=xe*$e.waveCenter,qe=$e.waveBandPx,V=$e.segments,te=$e.colors.filaments,be=Me||le,p=0;rt(Le,be,p),Le.strokeStyle=te,Le.lineCap="round",Le.lineJoin="round";for(let S=0;S<Ue.length;S+=1){const E=Ue[S],q=E.offset*qe*(.85+Ve(E.seed)*.4),X=1-Math.min(1,Math.abs(q)/qe),ye=Math.exp(-Math.pow(q/$e.crestThickness,2)),Q=E.layer===0?1.1:E.layer===1?.85:.6,M=.35+(1-E.depth)*.65,ke=X*M*Q*(.34+ye*.45);Le.globalAlpha=ke,Le.lineWidth=E.width*(1+(1-E.depth)*.8);const ne=[];for(let W=0;W<=V;W+=1){const pe=W/V*be+p,ce=(He(pe*.012,E.seed)-.5)*$e.xJitter,de=pe+ce,Ce=(He(de*E.freqA,E.seed)-.5)*$e.jitterA,Be=(He(de*E.freqB,E.seed*1.7)-.5)*$e.jitterB,Ke=tt+Math.sin(de*E.freqA+E.seed)*E.ampA+Math.sin(de*E.freqB+E.seed*1.3)*E.ampB+q+Ce+Be;ne.push({x:de,y:Ke})}Le.beginPath(),Le.moveTo(ne[0].x,ne[0].y);for(let W=1;W<ne.length-1;W+=1){const pe=(ne[W].x+ne[W+1].x)/2,ce=(ne[W].y+ne[W+1].y)/2;Le.quadraticCurveTo(ne[W].x,ne[W].y,pe,ce)}const Y=ne[ne.length-1];Le.quadraticCurveTo(Y.x,Y.y,Y.x,Y.y),Le.stroke()}Le.save(),Le.globalCompositeOperation="lighter",Le.strokeStyle=$e.colors.glow,Le.lineCap="round",Le.lineJoin="round";for(let S=0;S<Ue.length;S+=1){const E=Ue[S];if(Math.abs(E.offset)*qe>$e.crestThickness)continue;const q=$e.glowAlpha*(.7+(1-E.depth)*.6);Le.globalAlpha=q,Le.lineWidth=1.6+(1-E.depth)*1.2;const X=[];for(let Q=0;Q<=V;Q+=1){const M=Q/V*be+p,ke=Math.sin(M*.02+E.seed)*3,ne=tt+Math.sin(M*E.freqA+E.seed)*E.ampA+Math.sin(M*E.freqB+E.seed*1.3)*E.ampB+E.offset*qe*.35+ke;X.push({x:M,y:ne})}Le.beginPath(),Le.moveTo(X[0].x,X[0].y);for(let Q=1;Q<X.length-1;Q+=1){const M=(X[Q].x+X[Q+1].x)/2,ke=(X[Q].y+X[Q+1].y)/2;Le.quadraticCurveTo(X[Q].x,X[Q].y,M,ke)}const ye=X[X.length-1];Le.quadraticCurveTo(ye.x,ye.y,ye.x,ye.y),Le.stroke()}Le.restore()},at=()=>{le=Math.floor(L.clientWidth),xe=Math.floor(L.clientHeight),Me=Math.floor(le*1.8),Xe=xe,Ie=le<820?J:P,G.forEach(Le=>{const Ue=Le.getContext("2d");if(!Ue)return;Le.width=Math.floor(Me*z*Ie),Le.height=Math.floor(Xe*z*Ie),Le.style.width=`${Me}px`,Le.style.height=`${Xe}px`,Le.style.left=`${-(Me-le)/2}px`,Ue.setTransform(z*Ie,0,0,z*Ie,0,0);const tt=Number(Le.dataset.seed||1),qe=Re(tt);gt(Ue,qe)})};return at(),window.addEventListener("resize",at,{passive:!0}),()=>window.removeEventListener("resize",at)},[h]);const Ge=N[Math.min(A,N.length-1)],ge=x?Ge:N[N.length-1],R=(ge==null?void 0:ge.theme)??N[0].theme,F={"--cogita-bg0":R.bg0,"--cogita-bg1":R.bg1,"--cogita-bg2":R.bg2,"--cogita-bloom":R.bloom,"--cogita-sat":R.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:b,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Qs,{value:j,onChange:d}),e.jsx(Ws,{copy:t,label:s,isAuthenticated:r,secureMode:y,onLogin:a,onProfileNavigate:i,onToggleSecureMode:u,onLogout:c,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:o,className:"cogita-section cogita-home",style:F,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[h.map((L,G)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:L.style,"data-seed":L.seed,ref:D=>{l.current[G]=D}},L.id)),w.map(L=>e.jsx("div",{className:"cogita-home-wave",style:L.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},L.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(ri,{slides:N,activeIndex:A,introOpen:x,prefersReducedMotion:_,onNext:he,onPrev:Ne,onSelect:ie,onExit:$,onOpen:C,onRegister:ee})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const zo=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:li},Symbol.toStringTag,{value:"Module"})),sr=n.createContext(!1);function Rt({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,headerExtra:d,children:b}){if(n.useContext(sr))return e.jsx(e.Fragment,{children:b});const l=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}y("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:l,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Qs,{value:m,onChange:j}),e.jsxs("div",{className:"cogita-header-right",children:[d,e.jsx(Ws,{copy:t,label:a,isAuthenticated:s,secureMode:c,onLogin:()=>y("home"),onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,variant:"ghost"})]})]}),e.jsx("main",{className:"cogita-main",children:b}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}function ua(t){const[a,s]=n.useState("Cogita library"),[r,i]=n.useState(null);return n.useEffect(()=>{let u=!1;return Gs().then(c=>{if(u)return;const y=c.find(m=>m.libraryId===t);y&&s(y.name)}).catch(()=>{u||s("Cogita library")}),()=>{u=!0}},[t]),n.useEffect(()=>{let u=!1;return xr(t).then(c=>{u||i(c)}).catch(()=>{u||i(null)}),()=>{u=!0}},[t]),{libraryName:a,stats:r}}function fs({slices:t}){const a=t.reduce((r,i)=>r+Math.max(0,i.value),0),s=n.useMemo(()=>{if(a<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let r=0;return`conic-gradient(${t.map(u=>{const y=Math.max(0,u.value)/a*360,m=r,j=r+y;return r=j,`${u.color} ${m}deg ${j}deg`}).join(",")})`},[t,a]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:s}}),e.jsx("div",{className:"cogita-overview-legend",children:t.map(r=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:r.color}}),e.jsx("strong",{children:r.value}),e.jsx("small",{children:r.label})]},r.label))})]})}function ci({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d}){const{libraryName:b,stats:o}=ua(d),[l,w]=n.useState("infos"),[h,N]=n.useState(0),[A,v]=n.useState(0),[x,Z]=n.useState(0),_=(o==null?void 0:o.totalInfos)??0,k=(o==null?void 0:o.totalCollections)??0,H=0,T=0,ee=0,C=Math.max(0,_-ee-A),$=Math.max(0,_-A-x);n.useEffect(()=>{let he=!1;return(async()=>{try{const Ge=await Ua({libraryId:d,limit:200}),ge=await Promise.all(Ge.items.map(R=>Zn({libraryId:d,collectionId:R.collectionId}).catch(()=>[])));if(he)return;N(ge.reduce((R,F)=>R+F.length,0))}catch{he||N(0)}})(),()=>{he=!0}},[d]),n.useEffect(()=>{let he=!1;return(async()=>{try{const[Ge,ge,R]=await Promise.all([us({libraryId:d,type:"computed",limit:1}).catch(()=>({total:0})),us({libraryId:d,type:"source",limit:1}).catch(()=>({total:0})),es({libraryId:d}).catch(()=>({items:[]}))]);if(he)return;v((Ge.total??0)+(ge.total??0));const F=new Set(R.items.filter(L=>L.childItemType.toLowerCase()==="info").map(L=>L.childItemId).filter(Boolean));Z(F.size)}catch{he||(v(0),Z(0))}})(),()=>{he=!0}},[d]);const ie=[{key:"infos",label:t.cogita.library.overview.stats.totalInfos,value:_},{key:"collections",label:t.cogita.library.overview.stats.collections,value:k},{key:"revisions",label:t.cogita.library.overview.stats.revisions,value:h},{key:"storyboards",label:t.cogita.library.overview.stats.storyboards,value:H},{key:"texts",label:t.cogita.library.overview.stats.texts,value:T}];return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:b})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:ie.map(he=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${l===he.key?"active":""}`,onClick:()=>w(he.key),children:[e.jsx("span",{children:he.label}),e.jsx("strong",{children:he.value})]},he.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:t.cogita.library.overview.statsCardTitle})}),l==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.knownChartTitle}),e.jsx(fs,{slices:[{label:t.cogita.library.overview.known,value:ee,color:"#75d79a"},{label:t.cogita.library.overview.unknown,value:C,color:"#85b9ff"},{label:t.cogita.library.overview.excluded,value:A,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.checksChartTitle}),e.jsx(fs,{slices:[{label:t.cogita.library.overview.availableChecks,value:x,color:"#75d79a"},{label:t.cogita.library.overview.unavailableChecks,value:$,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:t.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]})]})})]})})}const ot=(t,a)=>{const s=t.cogita.library.infoTypes,r=t.cogita.library.connectionTypes,i=t.cogita.library.groupTypes;return{any:s.any,vocab:s.vocab,book:i.book,citation:i.citation,language:s.language,word:s.word,sentence:s.sentence,topic:s.topic,collection:s.collection,person:s.person,institution:s.institution,collective:s.collective,orcid:s.orcid,address:s.address,email:s.email,phone:s.phone,media:s.media,work:s.work,geo:s.geo,music_piece:s.musicPiece,music_fragment:s.musicFragment,source:s.source,question:s.question,computed:s.computed,"word-language":r.wordLanguage,"citation-language":r.citationLanguage,"language-sentence":r.languageSentence,translation:r.translation,"word-topic":r.wordTopic,reference:r.reference,"source-resource":r.sourceResource,"work-contributor":r.workContributor,"work-medium":r.workMedium,"orcid-link":r.orcidLink}[a]??String(a)},di=t=>[{value:"any",label:ot(t,"any")},{value:"language",label:ot(t,"language")},{value:"word",label:ot(t,"word")},{value:"sentence",label:ot(t,"sentence")},{value:"topic",label:ot(t,"topic")},{value:"collection",label:ot(t,"collection")},{value:"person",label:ot(t,"person")},{value:"institution",label:ot(t,"institution")},{value:"collective",label:ot(t,"collective")},{value:"orcid",label:ot(t,"orcid")},{value:"address",label:ot(t,"address")},{value:"email",label:ot(t,"email")},{value:"phone",label:ot(t,"phone")},{value:"media",label:ot(t,"media")},{value:"work",label:ot(t,"work")},{value:"geo",label:ot(t,"geo")},{value:"music_piece",label:ot(t,"music_piece")},{value:"music_fragment",label:ot(t,"music_fragment")},{value:"source",label:ot(t,"source")},{value:"question",label:ot(t,"question")},{value:"citation",label:ot(t,"citation")},{value:"computed",label:ot(t,"computed")},{value:"vocab",label:ot(t,"vocab")},{value:"book",label:ot(t,"book")},{value:"word-language",label:ot(t,"word-language")},{value:"citation-language",label:ot(t,"citation-language")},{value:"language-sentence",label:ot(t,"language-sentence")},{value:"translation",label:ot(t,"translation")},{value:"word-topic",label:ot(t,"word-topic")},{value:"reference",label:ot(t,"reference")},{value:"source-resource",label:ot(t,"source-resource")},{value:"work-contributor",label:ot(t,"work-contributor")},{value:"work-medium",label:ot(t,"work-medium")},{value:"orcid-link",label:ot(t,"orcid-link")}],ui=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}],Ln={key:"languageId",labelKey:"language",kind:"select",path:"languageId",optionsSource:"languages",matcher:"equals"},hi={language:{infoType:"language",entityKind:"single",structure:{payloadFields:["label","name","code"]},filterFields:[]},word:{infoType:"word",entityKind:"single",structure:{payloadFields:["label","lemma","languageId"],connections:[{relationType:"word-language",role:"language",targetType:"language"}]},filterFields:[Ln]},sentence:{infoType:"sentence",entityKind:"single",structure:{payloadFields:["label","text","languageId"],connections:[{relationType:"language-sentence",role:"language",targetType:"language"}]},filterFields:[Ln]},topic:{infoType:"topic",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},collection:{infoType:"collection",entityKind:"complex",structure:{payloadFields:["label","name"]},filterFields:[]},person:{infoType:"person",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},institution:{infoType:"institution",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},collective:{infoType:"collective",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},orcid:{infoType:"orcid",entityKind:"single",structure:{payloadFields:["label","orcid"]},filterFields:[{key:"orcid",label:"ORCID",kind:"text",path:"orcid",matcher:"contains"}]},address:{infoType:"address",entityKind:"single",structure:{payloadFields:["label","street","city","postalCode","country"]},filterFields:[]},email:{infoType:"email",entityKind:"single",structure:{payloadFields:["label","email","address"]},filterFields:[]},phone:{infoType:"phone",entityKind:"single",structure:{payloadFields:["label","phone","number"]},filterFields:[]},media:{infoType:"media",entityKind:"single",structure:{payloadFields:["label","name","url","kind"]},filterFields:[]},work:{infoType:"work",entityKind:"single",structure:{payloadFields:["label","title","subtitle","doi","isbn","issn","languageId","originalLanguageId"]},filterFields:[Ln,{key:"originalLanguageId",labelKey:"originalLanguage",kind:"select",path:"originalLanguageId",optionsSource:"languages",matcher:"equals"},{key:"doi",labelKey:"doi",kind:"text",path:"doi",matcher:"contains"}]},geo:{infoType:"geo",entityKind:"single",structure:{payloadFields:["label","name","country","region","city"]},filterFields:[]},music_piece:{infoType:"music_piece",entityKind:"single",structure:{payloadFields:["label","title","composer"]},filterFields:[]},music_fragment:{infoType:"music_fragment",entityKind:"single",structure:{payloadFields:["label","title","text"]},filterFields:[]},source:{infoType:"source",entityKind:"single",structure:{payloadFields:["label","title","sourceKind","locator"],connections:[{relationType:"source-resource",role:"resource",targetType:"work"}]},filterFields:[{key:"sourceKind",labelKey:"sourceKind",kind:"select",path:"sourceKind",optionsSource:"sourceKinds",matcher:"equals"},{key:"locator",labelKey:"locator",kind:"text",path:"locator",matcher:"locator_contains"}]},citation:{infoType:"citation",entityKind:"single",structure:{payloadFields:["title","text"],connections:[{relationType:"citation-language",role:"language",targetType:"language"},{relationType:"reference",role:"source",targetType:"source"}]},filterFields:[{key:"text",labelKey:"citationText",kind:"text",path:"text",matcher:"contains"}]},question:{infoType:"question",entityKind:"single",structure:{payloadFields:["definition"]},filterFields:[{key:"questionType",labelKey:"type",kind:"text",path:"definition.type",matcher:"contains"},{key:"questionText",labelKey:"text",kind:"text",path:"definition.question",matcher:"contains"}]},computed:{infoType:"computed",entityKind:"complex",structure:{payloadFields:["label","title","definition"]},filterFields:[]},translation:{infoType:"translation",entityKind:"connection",structure:{payloadFields:["note","tagIds"],connections:[{relationType:"translation",role:"wordA",targetType:"word"},{relationType:"translation",role:"wordB",targetType:"word"},{relationType:"word-language",role:"languageA",targetType:"language"},{relationType:"word-language",role:"languageB",targetType:"language"}]},filterFields:[{key:"languageAId",labelKey:"languageA",kind:"select",optionsSource:"languages",matcher:"equals"},{key:"languageBId",labelKey:"languageB",kind:"select",optionsSource:"languages",matcher:"equals"}]}},bs={infoType:"default",entityKind:"single",structure:{payloadFields:["label"]},filterFields:[]};function gi(t){return t?hi[t]??bs:bs}function mi(t,a){return t.optionsSource==="languages"?a.languages.map(s=>({value:s.infoId,label:s.label})):t.optionsSource==="sourceKinds"?ui:[]}const pi="cogita.revision.seed:";function rr(t){return`${pi}${t}`}function fi(t,a){if(typeof window>"u")return null;const s=Array.from(new Set(a.map(u=>u.trim()).filter(Boolean)));if(!s.length)return null;const r=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,i={kind:"info-selection",libraryId:t,infoIds:s,createdAt:new Date().toISOString()};return window.localStorage.setItem(rr(r),JSON.stringify(i)),r}function ys(t,a){if(typeof window>"u")return null;const s=window.localStorage.getItem(rr(a));if(!s)return null;try{const r=JSON.parse(s);if(r.kind!=="info-selection"||r.libraryId!==t||!Array.isArray(r.infoIds))return null;const i=r.infoIds.map(u=>String(u??"").trim()).filter(Boolean);return i.length?{infoIds:i}:null}catch{return null}}const bi="cogita.collection-draft:";function ir(t){return`${bi}${t}`}function yi(t,a){if(typeof window>"u")return null;const s=Array.from(new Set(a.map(u=>u.trim()).filter(Boolean)));if(!s.length)return null;const r=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,i={kind:"info-selection",libraryId:t,infoIds:s,createdAt:new Date().toISOString()};return window.localStorage.setItem(ir(r),JSON.stringify(i)),r}function xi(t,a){if(typeof window>"u")return null;const s=window.localStorage.getItem(ir(a));if(!s)return null;try{const r=JSON.parse(s);if(r.kind!=="info-selection"||r.libraryId!==t||!Array.isArray(r.infoIds))return null;const i=r.infoIds.map(u=>String(u??"").trim()).filter(Boolean);return i.length?{infoIds:i}:null}catch{return null}}const An=60,vi=500;function or(t){return`cogita.info-selection:${t}`}function xs(t){if(typeof window>"u")return{};const a=window.localStorage.getItem(or(t));if(!a)return{};try{const s=JSON.parse(a);return!s||typeof s!="object"?{}:s}catch{return{}}}function ji({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,mode:b}){var Ut;const o=Qa(),l=Ea(),w=t.cogita.library.list,[h,N]=n.useState("any"),[A,v]=n.useState(""),[x,Z]=n.useState("relevance"),[_,k]=n.useState("details"),[H,T]=n.useState(!1),[ee,C]=n.useState("idle"),[$,ie]=n.useState([]),[he,Ne]=n.useState(An),[Ge,ge]=n.useState(null),[R,F]=n.useState(()=>xs(d)),[L,G]=n.useState({}),[D,P]=n.useState([]),[J,z]=n.useState([]),[le,xe]=n.useState(null),[Ie,Me]=n.useState(null),[Xe,it]=n.useState(null),[$e,Ve]=n.useState("idle"),[kt,He]=n.useState([]),[Re,rt]=n.useState(""),[gt,at]=n.useState(null),[Le,Ue]=n.useState("idle"),[tt,qe]=n.useState(null),[V,te]=n.useState(null),[be,p]=n.useState("idle"),[S,E]=n.useState([]),[q,X]=n.useState("idle"),ye=n.useMemo(()=>di(t),[t]),Q=n.useMemo(()=>[{value:"relevance",label:w.sortRelevance},{value:"label_asc",label:w.sortLabelAsc},{value:"label_desc",label:w.sortLabelDesc},{value:"type_asc",label:w.sortTypeAsc},{value:"type_desc",label:w.sortTypeDesc}],[w.sortLabelAsc,w.sortLabelDesc,w.sortRelevance,w.sortTypeAsc,w.sortTypeDesc]);n.useEffect(()=>{F(xs(d)),G({}),T(!1)},[d]),n.useEffect(()=>{es({libraryId:d}).then(B=>it(B)).catch(()=>it({items:[]}))},[d]),n.useEffect(()=>{vr({libraryId:d}).then(B=>He(B)).catch(()=>He([]))},[d]),n.useEffect(()=>{Mn({libraryId:d,type:"language",filters:{sourceKind:"info"},limit:200}).then(B=>{const g=B.map(se=>({infoId:se.infoId??"",infoType:se.entityType,label:se.title})).filter(se=>se.infoId.length>0);P(g)}).catch(()=>P([]))},[d]),n.useEffect(()=>{Mn({libraryId:d,type:"source",filters:{sourceKind:"info"},limit:200}).then(B=>{const g=B.map(se=>({infoId:se.infoId??"",infoType:se.entityType,label:se.title})).filter(se=>se.infoId.length>0);z(g)}).catch(()=>z([]))},[d]),n.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(or(d),JSON.stringify(R))},[d,R]);const M=n.useMemo(()=>gi(h==="any"?null:h),[h]),ke=n.useMemo(()=>new URLSearchParams(l.search),[l.search]),ne=n.useMemo(()=>l.pathname.split("/").filter(Boolean),[l.pathname]),Y=ne.findIndex(B=>B==="infos"),W=Y>=0&&(ne[Y+1]??"").trim()||null,pe=Y>=0?(ne[Y+2]??"").trim():"",ce=Y>=0?pe==="checkcards"?"cards":pe==="collections"?"collections":"overview":"",de=W??((ke.get("infoId")??"").trim()||null),Ce=W?ce:(ke.get("infoView")??"overview").trim(),Be=Ce==="overview"&&!!de,Ke=Ce==="collections"&&!!de,Ee=n.useMemo(()=>({language:w.typeFilterLanguage,languageA:w.typeFilterLanguageA,languageB:w.typeFilterLanguageB,originalLanguage:w.typeFilterOriginalLanguage,doi:w.typeFilterDoi,sourceKind:w.typeFilterSourceKind,locator:w.typeFilterLocator,citationText:w.typeFilterCitationText}),[w.typeFilterDoi,w.typeFilterLanguage,w.typeFilterLanguageA,w.typeFilterLanguageB,w.typeFilterLocator,w.typeFilterOriginalLanguage,w.typeFilterCitationText,w.typeFilterSourceKind]),bt=n.useMemo(()=>M.filterFields.map(B=>({...B,label:B.labelKey?Ee[B.labelKey]:B.label??B.key,options:mi(B,{languages:D})})),[Ee,D,M.filterFields]),dt=n.useMemo(()=>bt.some(B=>(L[B.key]??"").trim().length>0),[bt,L]);n.useEffect(()=>{G({})},[h]),n.useEffect(()=>{const B={sourceKind:"info"};if(dt)for(const U of bt){const et=(L[U.key]??"").trim();et&&(B[U.path??U.key]=et)}const g=(L.__referenceId??"").trim();g&&(B["link.references"]=g),C("loading");const se=window.setTimeout(()=>{Mn({libraryId:d,type:h==="any"?void 0:h,query:A.trim()||void 0,filters:B,limit:vi}).then(U=>{const et=U.map(ht=>({infoId:ht.infoId??"",infoType:ht.entityType,label:ht.title})).filter(ht=>ht.infoId.length>0);ie(et),C("ready")}).catch(()=>{ie([]),C("ready")})},240);return()=>window.clearTimeout(se)},[dt,d,A,h,bt,L]),n.useEffect(()=>{if(!de||Ce!=="overview"&&Ce!=="collections"){xe(null),Me(null),Ve("idle");return}let B=!1;return Ve("loading"),Promise.all([aa({libraryId:d,infoId:de}),jr({libraryId:d,itemType:"info",itemId:de}).catch(()=>null)]).then(([g,se])=>{B||(xe(g),Me(se),Ve("ready"))}).catch(()=>{B||(xe(null),Me(null),Ve("error"))}),()=>{B=!0}},[d,de,Ce]),n.useEffect(()=>{if(!de||Ce!=="collections"){E([]),X("idle");return}let B=!1;return X("loading"),wr({libraryId:d,infoId:de}).then(g=>{B||(E(g),X("ready"))}).catch(()=>{B||(E([]),X("error"))}),()=>{B=!0}},[d,de,Ce]),n.useEffect(()=>{if(!de||Ce!=="overview"){qe(null),te(null),p("idle");return}let B=!1;return p("loading"),Promise.all([nn({libraryId:d,infoId:de}),sn({libraryId:d,infoId:de})]).then(([g,se])=>{B||(qe(g),te(se),p("ready"))}).catch(()=>{B||(qe(null),te(null),p("error"))}),()=>{B=!0}},[d,de,Ce]);const yt=n.useMemo(()=>le?kt.filter(B=>B.sourceInfoTypes.some(g=>g.toLowerCase()===le.infoType.toLowerCase())):[],[kt,le]);n.useEffect(()=>{if(!le){rt("");return}rt(B=>{var g;return B&&yt.some(se=>se.approachKey===B)?B:((g=yt[0])==null?void 0:g.approachKey)??""})},[yt,le]),n.useEffect(()=>{if(!le||!Re){at(null),Ue("idle");return}let B=!1;return Ue("loading"),Ys({libraryId:d,infoId:le.infoId,approachKey:Re}).then(g=>{B||(at(g),Ue("ready"))}).catch(()=>{B||(at(null),Ue("error"))}),()=>{B=!0}},[d,Re,le]);const Je=n.useMemo(()=>{const B=$.slice(),g=se=>ot(t,se);return x==="relevance"?B:x==="label_asc"?B.sort((se,U)=>se.label.localeCompare(U.label)):x==="label_desc"?B.sort((se,U)=>U.label.localeCompare(se.label)):x==="type_asc"?B.sort((se,U)=>se.infoType===U.infoType?se.label.localeCompare(U.label):g(se.infoType).localeCompare(g(U.infoType))):B.sort((se,U)=>se.infoType===U.infoType?se.label.localeCompare(U.label):g(U.infoType).localeCompare(g(se.infoType)))},[t,$,x]),_e=n.useMemo(()=>Je.slice(0,he),[Je,he]),mt=_e.length<Je.length,nt=n.useMemo(()=>new Set(Object.keys(R)),[R]),pt=n.useMemo(()=>Object.values(R),[R]),zt=n.useMemo(()=>{const B=new Map;for(const g of pt)B.set(g.infoType,(B.get(g.infoType)??0)+1);return Array.from(B.entries()).sort((g,se)=>se[1]-g[1]||g[0].localeCompare(se[0]))},[pt]),It=n.useMemo(()=>{if(!de||!Xe)return 0;const B=new Set;for(const g of Xe.items)g.childItemType!=="info"||g.childItemId!==de||B.add([g.parentItemType,g.parentItemId,g.parentCheckType??"",g.parentDirection??""].join("|"));return B.size},[Xe,de]);n.useEffect(()=>{Ne(An);const B=new Set($.map(g=>g.infoId));ge(g=>g&&B.has(g)?g:null)},[$]);const Nt=B=>{F(g=>({...g,[B.infoId]:{infoId:B.infoId,infoType:B.infoType,label:B.label}}))},Mt=B=>{F(g=>{if(!g[B])return g;const se={...g};return delete se[B],se})},St=(B,g)=>{if(g){Nt(B);return}Mt(B.infoId)},ut=B=>{o(`/cogita/library/${d}/infos/${encodeURIComponent(B)}`,{replace:!0})},Kt=()=>{o(`/cogita/library/${d}/list`,{replace:!0})},lt=()=>{de&&o(`/cogita/library/${d}/edit/${encodeURIComponent(de)}`,{replace:!0})},Ye=()=>{const B=fi(d,pt.map(g=>g.infoId));B&&o(`/cogita/library/${d}/revision/run?libraryTarget=revisions&scope=info-selection&seed=${encodeURIComponent(B)}`)},Tt=()=>{const B=yi(d,pt.map(g=>g.infoId));B&&o(`/cogita/library/${d}/collections/new?draft=${encodeURIComponent(B)}&draftType=info-selection`)},Gt=pt.length===1?((Ut=pt[0])==null?void 0:Ut.infoId)??null:null,qt=w.selectionCount.replace("{count}",String(pt.length)),Ot=b==="collection"?"grid":b==="detail"?"wide":_,me=ki(m),Et=Ie?Math.max(0,Math.min(100,Math.round((Ie.score??0)*100))):0,Zt=Ie?Ni(Ie,me):me.noKnownnessData;return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":Ot,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[Be?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:me.kicker}),e.jsx("h2",{className:"cogita-card-title",children:le?vs(le.payload,le.infoType,le.infoId):me.loading}),le?e.jsxs("p",{className:"cogita-card-subtitle",children:[ot(t,le.infoType)," · ",le.infoId]}):null]}),e.jsxs("div",{className:"cogita-info-overview-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:Kt,children:me.backToSearch}),e.jsx("button",{type:"button",className:"cta",onClick:lt,disabled:!de||$e!=="ready",children:w.editInfo})]})]}),$e==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:me.loading})}):$e==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:me.loadError})}):le?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-info-overview-metrics",children:[e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:me.knownness}),e.jsxs("div",{className:"cogita-info-metric-value",children:[Et,"%"]}),e.jsx("div",{className:"cogita-info-progress","aria-hidden":"true",children:e.jsx("span",{style:{width:`${Et}%`}})}),e.jsx("p",{className:"cogita-library-hint",children:Zt})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:me.reviews}),e.jsx("div",{className:"cogita-info-metric-value",children:(Ie==null?void 0:Ie.totalReviews)??0}),e.jsx("p",{className:"cogita-library-hint",children:me.correct.replace("{correct}",String((Ie==null?void 0:Ie.correctReviews)??0)).replace("{total}",String((Ie==null?void 0:Ie.totalReviews)??0))}),e.jsx("p",{className:"cogita-library-hint",children:Ie!=null&&Ie.lastReviewedUtc?`${me.lastReview}: ${wi(Ie.lastReviewedUtc,m)}`:me.noLastReview})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:me.linkedCards}),e.jsx("div",{className:"cogita-info-metric-value",children:It}),e.jsx("p",{className:"cogita-library-hint",children:me.linkedCardsHint})]})]}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:me.checkcards}),be==="loading"?e.jsx("p",{className:"cogita-library-hint",children:me.loadingCheckcards}):be==="error"?e.jsx("p",{className:"cogita-library-hint",children:me.loadCheckcardsError}):e.jsxs("div",{className:"cogita-info-tree",children:[e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:me.checkcardCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(tt==null?void 0:tt.items.length)??0})]}),e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:me.dependencyCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(V==null?void 0:V.items.length)??0})]})]})]}),yt.length>0?e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsxs("div",{className:"cogita-info-approach-header",children:[e.jsx("h3",{children:me.approach}),e.jsx("select",{value:Re,onChange:B=>rt(B.target.value),"aria-label":me.approach,children:yt.map(B=>e.jsx("option",{value:B.approachKey,children:B.label},B.approachKey))})]}),Le==="loading"?e.jsx("p",{className:"cogita-library-hint",children:me.loadingApproach}):Le==="error"?e.jsx("p",{className:"cogita-library-hint",children:me.loadApproachError}):gt?e.jsx(rn,{value:gt.projection,emptyLabel:me.empty}):e.jsx("p",{className:"cogita-library-hint",children:me.noApproachData})]}):null,e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:me.payload}),e.jsx(rn,{value:le.payload,emptyLabel:me.empty})]}),e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:me.links}),e.jsx(Si,{links:le.links,emptyLabel:me.noLinks})]})]})]}):null]})}):null,Ke?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Informacja"}),e.jsx("h2",{className:"cogita-card-title",children:le?vs(le.payload,le.infoType,le.infoId):de??""}),e.jsx("p",{className:"cogita-card-subtitle",children:"Collections using this info"})]}),e.jsx("div",{className:"cogita-info-overview-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Kt,children:"Back to search"})})]}),q==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading collections..."})}):null,q==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load collections."})}):null,q==="ready"&&S.length===0?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"This info is not used in any collection yet."})}):null,q==="ready"&&S.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:S.map(B=>e.jsx("article",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`/#/cogita/library/${d}/collections/${B.collectionId}?libraryTarget=collections`,children:[e.jsx("div",{className:"cogita-card-type",children:"Collection"}),e.jsx("h3",{className:"cogita-card-title",children:B.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[B.itemCount," items"]})]})},B.collectionId))}):null]})}):null,!Be&&!Ke?e.jsxs("section",{className:"cogita-library-search-surface",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":w.typeLabel,value:h,onChange:B=>N(B.target.value),children:ye.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))}),e.jsx("input",{type:"text",value:A,onChange:B=>v(B.target.value),placeholder:w.searchPlaceholder}),e.jsx("select",{"aria-label":w.sortLabel,value:x,onChange:B=>Z(B.target.value),children:Q.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))}),e.jsxs("select",{"aria-label":w.viewLabel,value:_,onChange:B=>k(B.target.value),children:[e.jsx("option",{value:"details",children:w.viewDetails}),e.jsx("option",{value:"wide",children:w.viewWide}),e.jsx("option",{value:"grid",children:w.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:w.cardCount.replace("{shown}",String(_e.length)).replace("{total}",String(Je.length))}),e.jsx("span",{children:ee==="loading"?w.loading:w.ready})]}),e.jsxs("div",{className:"cogita-filters-toggle-row",children:[e.jsx("button",{type:"button",className:"ghost cogita-filters-toggle",onClick:()=>T(B=>!B),children:H?w.hideFilters:w.showFilters}),e.jsx("span",{className:"cogita-sidebar-note",children:w.filtersOptionalHint})]}),H?e.jsx("section",{className:"cogita-library-filters cogita-library-filters--compact",children:e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:w.typeLabel}),e.jsx("select",{value:h,onChange:B=>N(B.target.value),children:ye.map(B=>e.jsx("option",{value:B.value,children:B.label},`advanced-type:${B.value}`))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Reference"}),e.jsxs("select",{value:L.__referenceId??"",onChange:B=>G(g=>({...g,__referenceId:B.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),J.map(B=>e.jsx("option",{value:B.infoId,children:B.label},`reference:${B.infoId}`))]})]}),bt.map(B=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:B.label}),B.kind==="select"?e.jsxs("select",{value:L[B.key]??"",onChange:g=>G(se=>({...se,[B.key]:g.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),(B.options??[]).map(g=>e.jsx("option",{value:g.value,children:g.label},`${B.key}:${g.value}`))]}):e.jsx("input",{type:"text",value:L[B.key]??"",onChange:g=>G(se=>({...se,[B.key]:g.target.value}))})]},`type-filter:${B.key}`))]})}):null,e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:qt}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{F(B=>{const g={...B};for(const se of _e)g[se.infoId]={infoId:se.infoId,infoType:se.infoType,label:se.label};return g})},disabled:_e.length===0,children:w.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>F({}),disabled:pt.length===0,children:w.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Gt&&ut(Gt),disabled:!Gt,title:Gt?void 0:w.openSelectedDisabled,children:w.openSelected})]})]}),Ot==="details"?e.jsxs("div",{className:"cogita-details-grid",role:"table","aria-label":w.searchTitle,children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:w.detailColumnName}),e.jsx("span",{children:w.detailColumnType}),e.jsx("span",{children:w.detailColumnId}),e.jsx("span",{})]}),_e.length?_e.map(B=>{const g=ot(t,B.infoType),se=nt.has(B.infoId),U=Ge===B.infoId;return e.jsxs("div",{className:`cogita-details-row ${U||se?"active":""}`,role:"row",onClick:()=>ge(B.infoId),children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:se,onChange:et=>St(B,et.target.checked),onClick:et=>et.stopPropagation()}),e.jsx("span",{})]}),e.jsx("span",{title:B.label,children:B.label}),e.jsx("span",{title:g,children:g}),e.jsx("span",{title:B.infoId,children:B.infoId}),e.jsx("button",{type:"button",className:"ghost cogita-details-open",onClick:et=>{et.stopPropagation(),ut(B.infoId)},"aria-label":w.editInfo,children:">"})]},B.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:w.noMatch})})]}):e.jsx("div",{className:`cogita-card-list cogita-card-list--${Ot}`,"data-view":Ot,children:_e.length?_e.map(B=>{const g=ot(t,B.infoType),se=nt.has(B.infoId),U=Ge===B.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":U||se,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:se,onChange:et=>St(B,et.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>ge(B.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:g}),e.jsx("h3",{className:"cogita-card-title",children:B.label}),e.jsx("p",{className:"cogita-card-subtitle",children:B.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>ut(B.infoId),children:w.editInfo})]})},B.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:w.noMatch})})}),mt?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>Ne(B=>B+An),children:w.loadMore})}):null,pt.length>0?e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:w.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:w.selectedStackHint}),e.jsx("div",{className:"cogita-selection-overview",children:zt.map(([B,g])=>e.jsxs("span",{className:"cogita-tag-chip",children:[e.jsx("span",{children:ot(t,B)}),e.jsx("span",{className:"cogita-tag-count",children:g})]},`stack:type:${B}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:Ye,disabled:pt.length===0,children:"Start revision"}),e.jsx("button",{type:"button",className:"ghost",onClick:Tt,disabled:pt.length===0,children:"Create collection from selection"})]})]}):null]}):null]})})})})}function vs(t,a,s){if(t&&typeof t=="object"&&!Array.isArray(t)){const r=t,i=["title","name","label","value","text","quote","term"];for(const u of i){const c=r[u];if(typeof c=="string"&&c.trim())return c.trim()}}return`${a} · ${s}`}function wi(t,a){try{const s=a==="pl"?"pl-PL":a==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(s,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}catch{return t}}function ki(t){return t==="pl"?{kicker:"Informacja",backToSearch:"Wróć do wyszukiwania",loading:"Ładowanie informacji...",loadError:"Nie udało się wczytać informacji.",knownness:"Znajomość",reviews:"Sprawdzenia",correct:"Poprawne: {correct} / {total}",lastReview:"Ostatnie sprawdzenie",noLastReview:"Brak sprawdzeń",linkedCards:"Powiązane karty",linkedCardsHint:"Karty sprawdzające zależne od tej informacji",payload:"Treść informacji",links:"Powiązania",empty:"Brak danych",noLinks:"Brak powiązań",checkcards:"Karty sprawdzające",loadingCheckcards:"Ładowanie kart sprawdzających...",loadCheckcardsError:"Nie udało się wczytać kart sprawdzających.",noCheckcards:"Brak kart sprawdzających.",checkcardCount:"Liczba kart",dependencyCount:"Zależności (efektywne)",approach:"Podejście",loadingApproach:"Ładowanie widoku...",loadApproachError:"Nie udało się wczytać widoku.",noApproachData:"Brak danych widoku.",noKnownnessData:"Brak danych o znajomości",developmentStart:"Początek nauki",developmentGrowing:"Rozwój w toku",developmentStable:"Utrwalona wiedza",developmentStrong:"Bardzo dobra znajomość"}:t==="de"?{kicker:"Information",backToSearch:"Zur Suche",loading:"Information wird geladen...",loadError:"Information konnte nicht geladen werden.",knownness:"Kenntnisstand",reviews:"Abfragen",correct:"Richtig: {correct} / {total}",lastReview:"Letzte Abfrage",noLastReview:"Noch keine Abfragen",linkedCards:"Verknüpfte Karten",linkedCardsHint:"Prüfkarten, die von dieser Information abhängen",payload:"Inhalt",links:"Verknüpfungen",empty:"Keine Daten",noLinks:"Keine Verknüpfungen",checkcards:"Prüfkarten",loadingCheckcards:"Prüfkarten werden geladen...",loadCheckcardsError:"Prüfkarten konnten nicht geladen werden.",noCheckcards:"Keine Prüfkarten.",checkcardCount:"Anzahl Karten",dependencyCount:"Abhängigkeiten (effektiv)",approach:"Ansicht",loadingApproach:"Ansicht wird geladen...",loadApproachError:"Ansicht konnte nicht geladen werden.",noApproachData:"Keine Ansichtsdaten.",noKnownnessData:"Keine Kenntnisdaten",developmentStart:"Lernbeginn",developmentGrowing:"Aufbauphase",developmentStable:"Stabil",developmentStrong:"Sehr sicher"}:{kicker:"Info",backToSearch:"Back to search",loading:"Loading info...",loadError:"Failed to load info.",knownness:"Knownness",reviews:"Reviews",correct:"Correct: {correct} / {total}",lastReview:"Last review",noLastReview:"No reviews yet",linkedCards:"Linked checking cards",linkedCardsHint:"Checking cards depending on this info",payload:"Information",links:"Links",empty:"No data",noLinks:"No links",checkcards:"Checkcards",loadingCheckcards:"Loading checkcards...",loadCheckcardsError:"Failed to load checkcards.",noCheckcards:"No checkcards.",checkcardCount:"Checkcard count",dependencyCount:"Dependencies (effective)",approach:"Approach",loadingApproach:"Loading view...",loadApproachError:"Failed to load view.",noApproachData:"No view data.",noKnownnessData:"No knownness data",developmentStart:"Just started",developmentGrowing:"In progress",developmentStable:"Stable",developmentStrong:"Strong"}}function Ni(t,a){return t.totalReviews<=0?a.noKnownnessData:t.totalReviews<3||t.score<.35?a.developmentStart:t.totalReviews<8||t.score<.65?a.developmentGrowing:t.score<.85?a.developmentStable:a.developmentStrong}function Si({links:t,emptyLabel:a}){return!t||Object.keys(t).length===0?e.jsx("p",{className:"cogita-library-hint",children:a}):e.jsx("div",{className:"cogita-info-tree",children:Object.entries(t).map(([s,r])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:s}),e.jsx("div",{className:"cogita-info-tree-value",children:Array.isArray(r)?r.length?e.jsx("div",{className:"cogita-selection-overview",children:r.map(i=>e.jsx("span",{className:"cogita-tag-chip",children:i},`${s}:${i}`))}):e.jsx("span",{className:"cogita-library-hint",children:"[]"}):r?e.jsx("span",{className:"cogita-tag-chip",children:r}):e.jsx("span",{className:"cogita-library-hint",children:"null"})})]},s))})}function rn({value:t,emptyLabel:a}){if(t==null)return e.jsx("p",{className:"cogita-library-hint",children:a});if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)});if(Array.isArray(t))return t.length===0?e.jsx("p",{className:"cogita-library-hint",children:"[]"}):e.jsx("div",{className:"cogita-info-tree",children:t.map((s,r)=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:r+1}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(rn,{value:s,emptyLabel:a})})]},r))});if(typeof t=="object"){const s=Object.entries(t);return s.length===0?e.jsx("p",{className:"cogita-library-hint",children:a}):e.jsx("div",{className:"cogita-info-tree",children:s.map(([r,i])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:r}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(rn,{value:i,emptyLabel:a})})]},r))})}return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)})}const Na=5,js=50,ws=2,ks=[];function Xt({libraryId:t,infoType:a,label:s,placeholder:r,value:i,onChange:u,values:c,onChangeMultiple:y,helperText:m,searchFailedText:j,createFailedText:d,createLabel:b,savingLabel:o,loadMoreLabel:l,allowCreate:w=!0,inputRef:h,autoAdvance:N,onCommit:A,multiple:v}){const x=v?c??ks:ks,[Z,_]=n.useState(v?"":(i==null?void 0:i.label)??""),[k,H]=n.useState([]),[T,ee]=n.useState(Na),[C,$]=n.useState(-1),[ie,he]=n.useState(!1),[Ne,Ge]=n.useState(!1),[ge,R]=n.useState(null),F=n.useRef(0),L=n.useRef(new Map),G=n.useMemo(()=>w?v?Z.trim().length>0:Z.trim().length>0&&!i:!1,[w,Z,i,v]);n.useEffect(()=>{v||_((i==null?void 0:i.label)??"")},[i,v]),n.useEffect(()=>{const J=Z.trim();if(!J||J.length<ws){H([]),he(!1),ee(Na),$(-1),Ge(!1),R(null);return}const z=J.toLowerCase(),le=`${t}:${a}:${z}`,xe=L.current.get(le);if(xe){if(v&&x.length>0){const Me=new Set(x.map(Xe=>Xe.id));H(xe.filter(Xe=>!Me.has(Xe.id)))}else H(xe);ee(Na),$(-1),he(xe.length>0),Ge(!1),R(null);return}const Ie=window.setTimeout(async()=>{const Me=Date.now();F.current=Me,Ge(!0),R(null);try{const Xe=await ts({libraryId:t,type:a,query:J,limit:js});if(F.current!==Me)return;const it=Xe.slice(0,js).map($e=>({id:$e.infoId,label:$e.label,infoType:$e.infoType}));if(L.current.set(le,it),v&&x.length>0){const $e=new Set(x.map(Ve=>Ve.id));H(it.filter(Ve=>!$e.has(Ve.id)))}else H(it);ee(Na),$(-1),he(!0)}catch{if(F.current!==Me)return;R(j??"Search failed.")}finally{F.current===Me&&Ge(!1)}},250);return()=>window.clearTimeout(Ie)},[t,a,Z,x]);const D=J=>{if(v){const z=x.some(le=>le.id===J.id)?x:[...x,J];y==null||y(z),_(""),he(!1),$(-1);return}u==null||u(J),_(J.label),he(!1),$(-1),N&&(A==null||A())},P=async()=>{const J=Z.trim();if(J){Ge(!0),R(null);try{const z=await Jn({libraryId:t,infoType:a,payload:{label:J}}),le={id:z.infoId,label:J,infoType:z.infoType};if(J.length>=ws){const xe=`${t}:${a}:${J.toLowerCase()}`,Ie=L.current.get(xe)??[];L.current.set(xe,[le,...Ie])}if(v){y==null||y([...x,le]),_(""),he(!1),$(-1);return}u==null||u(le),he(!1),$(-1),N&&(A==null||A())}catch{R(d??"Create failed.")}finally{Ge(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:s}),e.jsx("input",{value:Z,placeholder:r,onChange:J=>{_(J.target.value),!v&&i&&(u==null||u(null))},onKeyDown:J=>{if(J.key==="ArrowDown"){if(J.preventDefault(),!k.length)return;he(!0),$(z=>{const le=Math.min(k.length,T)-1,xe=z<0?0:Math.min(z+1,le);return xe===le&&k.length>T?(ee(Ie=>Math.min(Ie+Na,k.length)),Math.min(z+1,Math.min(k.length,T+Na)-1)):xe});return}if(J.key==="ArrowUp"){if(J.preventDefault(),!k.length)return;he(!0),$(z=>z<=0?0:z-1);return}if(J.key==="Enter"){if(J.preventDefault(),C>=0&&k[C]){D(k[C]);return}if(G){P();return}}},onFocus:()=>{k.length>0&&he(!0)},autoComplete:"off",ref:h})]}),v&&x.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:x.map(J=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>y==null?void 0:y(x.filter(z=>z.id!==J.id)),children:[J.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},J.id))}),m&&e.jsx("p",{className:"cogita-help",children:m}),ge&&e.jsx("p",{className:"cogita-error",children:ge}),ie&&k.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[k.slice(0,T).map((J,z)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":z===C,onClick:()=>D(J),children:[e.jsx("strong",{children:J.label}),e.jsx("span",{children:J.infoType})]},J.id)),T<k.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>ee(J=>Math.min(J+Na,k.length)),children:l??"Load more"})]}),G&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:P,disabled:Ne,children:Ne?o??"Saving...":b??`Create new ${a}`})]})}const Ns=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],Ss=8;function Ts({libraryId:t,copy:a,language:s,sourceKindOptions:r,value:i,onChange:u,labels:c}){const[y,m]=n.useState(!1),[j,d]=n.useState(-1),b=n.useMemo(()=>{const h=s;return Ns.map(N=>{var x;const A=(N==null?void 0:N[h])??(N==null?void 0:N.en)??(N==null?void 0:N.la);return{label:`${A.abbr} — ${A.name}`,latin:((x=N==null?void 0:N.la)==null?void 0:x.abbr)??A.abbr}})},[s]),o=(h,N=!1)=>{const A=h.trim().toLowerCase();return A?b.filter(v=>v.label.toLowerCase().includes(A)).slice(0,Ss):N?b.slice(0,Ss):[]},l=(h,N)=>{const A=h.trim().toLowerCase();if(!A)return null;const v=Ns;for(const x of v){const Z=x==null?void 0:x.la,_=(x==null?void 0:x[N])??(x==null?void 0:x.en)??Z,k=(_==null?void 0:_.abbr)??"",H=(_==null?void 0:_.name)??"";if(k.toLowerCase()===A||H.toLowerCase()===A||`${k} — ${H}`.toLowerCase()===A)return{book:x,entry:_,la:Z}}return null};n.useEffect(()=>{if(i.sourceKind==="bible"&&i.locatorValue&&!y){const h=l(i.locatorValue,s);if(h){const N=`${h.entry.abbr} — ${h.entry.name}`;N!==i.bibleBookDisplay&&u({...i,bibleBookDisplay:N})}}},[s,i,y,u]);const w=h=>u({...i,...h});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:c.sourceKindLabel}),e.jsx("select",{value:i.sourceKind,onChange:h=>w({sourceKind:h.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:r.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]}),i.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:c.bibleBookLabel}),e.jsx("input",{type:"text",value:i.bibleBookDisplay,onChange:h=>{const N=h.target.value;w({bibleBookDisplay:N,locatorValue:""}),m(!0),d(-1)},onKeyDown:h=>{var A;const N=o(i.bibleBookDisplay);if(N.length){if(h.key==="ArrowDown")h.preventDefault(),d(v=>Math.min(v+1,N.length-1));else if(h.key==="ArrowUp")h.preventDefault(),d(v=>Math.max(v-1,0));else if((h.key==="Enter"||h.key==="Tab")&&j>=0&&N[j]){const v=N[j],x=l(v.label,s);if(!x)return;w({bibleBookDisplay:v.label,locatorValue:((A=x.la)==null?void 0:A.abbr)??i.locatorValue}),m(!1)}}},onFocus:()=>m(!0),onBlur:()=>window.setTimeout(()=>m(!1),100),placeholder:c.bibleBookPlaceholder})]}),y&&o(i.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:o(i.bibleBookDisplay,!0).map((h,N)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":N===j,tabIndex:-1,onMouseDown:()=>{var v;const A=l(h.label,s);A&&w({bibleBookDisplay:h.label,locatorValue:((v=A.la)==null?void 0:v.abbr)??i.locatorValue})},children:e.jsx("strong",{children:h.label})},h.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:c.bibleRestLabel}),e.jsx("input",{type:"text",value:i.locatorAux,onChange:h=>w({locatorAux:h.target.value}),placeholder:c.bibleRestPlaceholder})]})]}),i.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:i.sourceUrl,onChange:h=>w({sourceUrl:h.target.value}),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:i.sourceAccessedDate,onChange:h=>w({sourceAccessedDate:h.target.value}),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),i.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:t,infoType:"work",label:c.churchDocumentLabel,placeholder:c.churchDocumentPlaceholder,value:i.churchDocument,onChange:h=>w({churchDocument:h}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:c.locatorLabel}),e.jsx("input",{type:"text",value:i.locatorValue,onChange:h=>w({locatorValue:h.target.value}),placeholder:c.locatorPlaceholder})]})]}),i.sourceKind==="work"&&e.jsx(Xt,{libraryId:t,infoType:"work",label:c.workLabel,placeholder:c.workPlaceholder,value:i.work,onChange:h=>w({work:h}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),i.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:t,infoType:"media",label:c.bookLabel,placeholder:c.bookPlaceholder,value:i.bookMedia,onChange:h=>w({bookMedia:h}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:c.locatorLabel}),e.jsx("input",{type:"text",value:i.locatorValue,onChange:h=>w({locatorValue:h.target.value}),placeholder:c.locatorPlaceholder})]})]}),i.sourceKind!=="website"&&i.sourceKind!=="bible"&&i.sourceKind!=="book"&&i.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:c.locatorLabel}),e.jsx("input",{type:"text",value:i.locatorValue,onChange:h=>w({locatorValue:h.target.value}),placeholder:c.locatorPlaceholder})]})]})}const za=JSON.stringify({type:"selection",title:"Question title",question:"Question text",options:["Option A","Option B","Option C"],answer:[0]},null,2);function Za(t="selection"){return t==="matching"?{type:t,title:"",question:"",columns:[[""],[""]],answer:{paths:[]},matchingPaths:[["",""]]}:t==="ordering"?{type:t,title:"",question:"",options:[""]}:t==="truefalse"?{type:t,title:"",question:"",answer:!0}:t==="text"||t==="date"?{type:t,title:"",question:"",answer:""}:t==="number"?{type:t,title:"",question:"",answer:""}:{type:t,title:"",question:"",options:[""],answer:[]}}function Ti(t){return["selection","truefalse","text","number","date","matching","ordering"].includes(t)}function Aa(t){if(!t||typeof t!="object")return null;const a=t,s=typeof a.type=="string"?a.type:typeof a.kind=="string"?a.kind:"selection",r=s==="multi_select"||s==="single_select"?"selection":s==="boolean"?"truefalse":s==="order"?"ordering":s==="short"||s==="open"||s==="short_text"?"text":s,i=Ti(r)?r:"selection",u=typeof a.title=="string"?a.title:"",c=typeof a.question=="string"?a.question:"";if(i==="matching"){let j=[];Array.isArray(a.columns)?j=a.columns.map(h=>Array.isArray(h)?h.map(N=>typeof N=="string"?N:""):[""]):Array.isArray(a.left)&&Array.isArray(a.right)&&(j=[a.left.map(h=>typeof h=="string"?h:""),a.right.map(h=>typeof h=="string"?h:"")]),j.length<2&&(j=[[""],[""]]);const d=a.answer&&typeof a.answer=="object"?a.answer:null,o=(Array.isArray(d==null?void 0:d.paths)?d==null?void 0:d.paths:Array.isArray(a.correctPairs)?a.correctPairs:[]).map(h=>Array.isArray(h)?h.map(N=>Number(N)).filter(N=>Number.isInteger(N)&&N>=0):[]).filter(h=>h.length>0),l=Array.isArray(a.matchingPaths)?a.matchingPaths.map(h=>Array.isArray(h)?Array.from({length:j.length},(N,A)=>String(h[A]??"")):new Array(j.length).fill("")):null,w=l&&l.length>0?l:[...o.map(h=>h.map(String)),new Array(j.length).fill("")];return{type:i,title:u,question:c,columns:j,answer:{paths:o},matchingPaths:w}}if(i==="ordering"){const j=Array.isArray(a.options)?a.options.map(d=>typeof d=="string"?d:""):Array.isArray(a.items)?a.items.map(d=>typeof d=="string"?d:""):[""];return{type:i,title:u,question:c,options:j.length?j:[""]}}if(i==="truefalse"){const j=typeof a.answer=="boolean"?a.answer:typeof a.expected=="boolean"?a.expected:!0;return{type:i,title:u,question:c,answer:j}}if(i==="number")return typeof a.answer=="number"?{type:i,title:u,question:c,answer:a.answer}:typeof a.answer=="string"?{type:i,title:u,question:c,answer:a.answer}:typeof a.expected=="number"?{type:i,title:u,question:c,answer:a.expected}:{type:i,title:u,question:c,answer:""};if(i==="text"||i==="date"){const j=typeof a.answer=="string"?a.answer:typeof a.expected=="string"?a.expected:"";return{type:i,title:u,question:c,answer:j}}const y=Array.isArray(a.options)?a.options.map(j=>typeof j=="string"?j:""):[""],m=Array.isArray(a.answer)?a.answer.map(j=>Number(j)).filter(j=>Number.isInteger(j)&&j>=0):Array.isArray(a.correct)?a.correct.map(j=>Number(j)).filter(j=>Number.isInteger(j)&&j>=0):[];return{type:i,title:u,question:c,options:y.length?y:[""],answer:m}}function $n(t){const a=(t.title??"").trim(),s=(t.question??"").trim();switch(t.type){case"matching":{const r=(t.columns??[[""],[""]]).map(b=>b.map(o=>o.trim()).filter(Boolean)).filter(b=>b.length>0),i=r.length>=2?r:[[""],[""]],u=t.answer&&typeof t.answer=="object"&&"paths"in t.answer?t.answer.paths:[],c=(t.matchingPaths??[]).map(b=>b.map(o=>String(o??""))),y=i.length,m=c.map(b=>b.slice(0,y).map(o=>o.trim())).filter(b=>b.some(Boolean)).map(b=>b.map(o=>Number(o))).filter(b=>b.length===y&&b.every(o=>Number.isInteger(o)&&o>=0)),j=(Array.isArray(u)?u:[]).map(b=>Array.isArray(b)?b.map(o=>Number(o)).filter(o=>Number.isInteger(o)&&o>=0):[]).filter(b=>b.length===y),d=Array.from(new Set([...j,...m].map(b=>JSON.stringify(b)))).map(b=>JSON.parse(b));return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,columns:i,answer:{paths:d}},null,2)}case"ordering":{const r=(t.options??[]).map(i=>i.trim()).filter(Boolean);return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,options:r},null,2)}case"truefalse":return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,answer:!!t.answer},null,2);case"number":return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,answer:typeof t.answer=="number"||typeof t.answer=="string"?t.answer:""},null,2);case"date":case"text":return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,answer:String(t.answer??"")},null,2);case"selection":default:{const r=(t.options??[]).map(c=>c.trim()).filter(Boolean),i=Array.isArray(t.answer)?t.answer:[],u=Array.from(new Set(i.filter(c=>Number.isInteger(c)&&c>=0&&c<r.length))).sort((c,y)=>c-y);return JSON.stringify({type:t.type,...a?{title:a}:{},question:s,options:r,answer:u},null,2)}}}const Cs=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}];function Va(){return{sourceKind:"string",locatorValue:"",locatorAux:"",bibleBookDisplay:"",sourceUrl:"",sourceAccessedDate:"",churchDocument:null,bookMedia:null,work:null}}function Is(t){return t==null?"":typeof t=="string"?t:JSON.stringify(t)}function Ms(t,a){if(!t||typeof t!="object")return a;const s=t,r=s.definition&&typeof s.definition=="object"?s.definition:null,i=[s.label,s.name,s.title,s.text,s.orcid,s.email,s.number];r&&i.unshift(r.title,r.question);for(const u of i)if(typeof u=="string"&&u.trim())return u.trim();return a}function Ls(t,a){var r;if(!(t instanceof as))return a;const s=(r=t.message)==null?void 0:r.trim();if(!s)return a;try{const i=JSON.parse(s);if(typeof i.error=="string"&&i.error.trim())return i.error.trim()}catch{}return s}function Ci(t){const a=t.trim();if(!a)return null;try{const s=JSON.parse(a);return s&&typeof s=="object"&&!Array.isArray(s)?s:null}catch{return null}}function ia(t,a){const s=t==null?void 0:t[a];return typeof s=="string"?s:""}function Ii(t,a){return a?t==="book"&&a.infoType==="media"?{bookMedia:a}:t==="work"&&a.infoType==="work"?{work:a}:t==="number_document"&&a.infoType==="work"?{churchDocument:a}:{}:{}}function Mi(t,a){const s=Va(),r=(t.sourceKind??"").trim()||s.sourceKind,i=t.locator??"",u=Ci(i);let c="",y="",m="",j="",d="";return r==="website"?(j=ia(u,"url"),d=ia(u,"accessedDate"),c=ia(u,"value")):r==="bible"?(c=ia(u,"book")||i.trim(),y=ia(u,"passage")||ia(u,"rest"),m=ia(u,"bookDisplay")):u?(c=ia(u,"value")||ia(u,"locator"),y=ia(u,"aux")):c=i,{...s,sourceKind:r,locatorValue:c,locatorAux:y,bibleBookDisplay:m,sourceUrl:j,sourceAccessedDate:d,...Ii(r,a)}}function Rn(t){return t.sourceKind==="book"?t.bookMedia:t.sourceKind==="work"?t.work:t.sourceKind==="number_document"?t.churchDocument:null}function Pn(t){const a=t.locatorValue.trim(),s=t.locatorAux.trim(),r=t.sourceUrl.trim(),i=t.sourceAccessedDate.trim();switch(t.sourceKind){case"website":return{url:r,accessedDate:i};case"bible":return{book:a,bookDisplay:t.bibleBookDisplay.trim(),passage:s};case"book":case"work":case"number_document":return s?{value:a,aux:s}:a;default:return s?{value:a,aux:s}:a}}function As(t){var i,u,c;const a=t.locatorValue.trim(),s=t.locatorAux.trim(),r=[a,s].filter(Boolean).join(" ");switch(t.sourceKind){case"website":return t.sourceUrl.trim()||"website";case"bible":return r||"bible";case"book":return[(i=t.bookMedia)==null?void 0:i.label,r].filter(Boolean).join(" · ")||"book";case"work":return[(u=t.work)==null?void 0:u.label,r].filter(Boolean).join(" · ")||"work";case"number_document":return[(c=t.churchDocument)==null?void 0:c.label,r].filter(Boolean).join(" · ")||"number_document";default:return r||t.sourceKind||"source"}}function $s(t){return t.sourceKind.trim()?t.sourceKind==="website"?!!t.sourceUrl.trim():t.sourceKind==="bible"?!!(t.locatorValue.trim()&&t.locatorAux.trim()):t.sourceKind==="book"?!!t.bookMedia:t.sourceKind==="work"?!!t.work:t.sourceKind==="number_document"?!!(t.churchDocument&&t.locatorValue.trim()):!!t.locatorValue.trim():!1}function Li({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,editInfoId:b}){var V,te,be;const{libraryName:o}=ua(d),l=!!b,[w,h]=n.useState([]),[N,A]=n.useState("word"),[v,x]=n.useState({}),[Z,_]=n.useState({}),[k,H]=n.useState({}),[T,ee]=n.useState({}),[C,$]=n.useState(null),[ie,he]=n.useState("idle"),[Ne,Ge]=n.useState(Va),[ge,R]=n.useState({}),[F,L]=n.useState({}),[G,D]=n.useState({}),[P,J]=n.useState(null),[z,le]=n.useState(()=>Aa(JSON.parse(za))??Za()),[xe,Ie]=n.useState(za),[Me,Xe]=n.useState([]),[it,$e]=n.useState(0),Ve=n.useMemo(()=>w.find(p=>p.infoType===N),[N,w]),kt=n.useMemo(()=>w.find(p=>p.infoType==="source"),[w]),He=n.useMemo(()=>w.map(p=>({value:p.infoType,label:ot(t,p.infoType)})),[t,w]),Re=p=>{const S=Aa(p)??Za(),E=$n(S);le(S),x(q=>({...q,definition:E}))};n.useEffect(()=>{let p=!1;return kr({libraryId:d}).then(S=>{var E;if(!p&&(h(S),!l)){const q=(E=S[0])==null?void 0:E.infoType;q&&A(q)}}).catch(()=>{p||h([])}),()=>{p=!0}},[l,d]),n.useEffect(()=>{if(l||!Ve)return;const p={},S={},E={},q={};for(const X of Ve.payloadFields)Ve.infoType==="question"&&X.key==="definition"&&X.inputType==="json"?p[X.key]=za:p[X.key]="";for(const X of Ve.linkFields)X.multiple?E[X.key]=[]:S[X.key]=null,X.targetTypes.length>0&&(q[X.key]=X.targetTypes[0]);x(p),_(S),H(E),ee(q)},[Ve==null?void 0:Ve.infoType,l]),n.useEffect(()=>{if(N!=="question")return;const p=v.definition??"";if(!p.trim()){const S=Aa(JSON.parse(za))??Za();le(S),Ie(za);return}try{const S=JSON.parse(p),E=Aa(S);if(!E)return;le(E),Me.length===0&&Ie(JSON.stringify(S,null,2))}catch{}},[v.definition,Me.length,N]),n.useEffect(()=>{if(!l||!b||w.length===0)return;let p=!1;return he("loading"),$(null),(async()=>{const E=await aa({libraryId:d,infoId:b});if(p)return;const q=E.infoType;A(q);const X=w.find(pe=>pe.infoType===q);if(!X){he("idle");return}const ye=E.payload??{},Q={};for(const pe of X.payloadFields)Q[pe.key]=Is(ye[pe.key]);x(Q);const M=E.links??{}??{},ke={},ne={},Y={},W=[];for(const pe of X.linkFields){pe.targetTypes.length>0&&(Y[pe.key]=pe.targetTypes[0]);const ce=M[pe.key];if(pe.multiple){const de=Array.isArray(ce)?ce.filter(Ce=>typeof Ce=="string"):[];ne[pe.key]=[];for(const Ce of de)W.push(aa({libraryId:d,infoId:Ce}).then(Be=>{if(p)return;const Ke={id:Ce,infoType:Be.infoType,label:Ms(Be.payload,Ce)};Y[pe.key]=Ke.infoType,ne[pe.key]=[...ne[pe.key],Ke]}).catch(()=>{}))}else{const de=typeof ce=="string"?ce:null;ke[pe.key]=null,de&&W.push(aa({libraryId:d,infoId:de}).then(Ce=>{if(p)return;const Be={id:de,infoType:Ce.infoType,label:Ms(Ce.payload,de)};Y[pe.key]=Be.infoType,ke[pe.key]=Be}).catch(()=>{}))}}await Promise.all(W),!p&&(_(ke),H(ne),ee(Y),he("idle"))})().catch(()=>{p||($("Failed to load info details."),he("idle"))}),()=>{p=!0}},[b,l,d,w]),n.useEffect(()=>{N==="source"&&Ge(Mi(v,Z.resource??null))},[N,v.sourceKind,v.locator,(V=Z.resource)==null?void 0:V.id,(te=Z.resource)==null?void 0:te.infoType,(be=Z.resource)==null?void 0:be.label]);const rt=p=>{var X,ye;const S=((X=kt==null?void 0:kt.payloadFields.find(Q=>Q.key==="sourceKind"))==null?void 0:X.keepOnCreate)??!1,E=((ye=kt==null?void 0:kt.linkFields.find(Q=>Q.key==="resource"))==null?void 0:ye.keepOnCreate)??!1,q=Va();return q.sourceKind=S?p.sourceKind:q.sourceKind,E&&(q.work=p.work,q.bookMedia=p.bookMedia,q.churchDocument=p.churchDocument),S&&p.sourceKind==="bible"&&(q.locatorValue=p.locatorValue,q.bibleBookDisplay=p.bibleBookDisplay),S&&p.sourceKind==="website"&&(q.sourceUrl=p.sourceUrl,q.sourceAccessedDate=p.sourceAccessedDate),q},gt=n.useMemo(()=>({sourceKindLabel:t.cogita.library.add.info.sourceKindLabel,bibleBookLabel:t.cogita.library.add.info.sourceBibleBookLabel,bibleBookPlaceholder:t.cogita.library.add.info.sourceBibleBookPlaceholder,bibleRestLabel:t.cogita.library.add.info.sourceBibleRestLabel,bibleRestPlaceholder:t.cogita.library.add.info.sourceBibleRestPlaceholder,churchDocumentLabel:t.cogita.library.add.info.sourceResourceLabel,churchDocumentPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,workLabel:t.cogita.library.add.info.sourceResourceLabel,workPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,bookLabel:t.cogita.library.add.info.sourceResourceLabel,bookPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,locatorLabel:t.cogita.library.list.typeFilterLocator,locatorPlaceholder:t.cogita.library.list.typeFilterLocator}),[t]),at=async p=>{const S=F[p]??Va();if(!$s(S)){D(E=>({...E,[p]:t.cogita.library.add.info.referenceMissingSource}));return}J(p),D(E=>({...E,[p]:null}));try{const E=Rn(S),q=E?{resource:E.id}:{},X={label:As(S),sourceKind:S.sourceKind.trim(),locator:Pn(S)},Q={id:(await Jn({libraryId:d,infoType:"source",payload:X,links:q})).infoId,infoType:"source",label:X.label};if(H(M=>{const ke=M[p]??[];return ke.some(ne=>ne.id===Q.id)?M:{...M,[p]:[...ke,Q]}}),l&&b){const M=await aa({libraryId:d,infoId:b}),ke=M.links&&typeof M.links=="object"?{...M.links}:{},ne=ke[p],Y=Array.isArray(ne)?ne.filter(W=>typeof W=="string"):typeof ne=="string"?[ne]:[];Y.includes(Q.id)||(ke[p]=[...Y,Q.id],await hs({libraryId:d,infoId:b,payload:M.payload,links:ke}))}L(M=>({...M,[p]:rt(S)})),D(M=>({...M,[p]:null}))}catch(E){D(q=>({...q,[p]:Ls(E,t.cogita.library.lookup.createFailed)}))}finally{J(E=>E===p?null:E)}},Le=async()=>{var E;if(!Ve)return;const p={};for(const q of Ve.payloadFields){if(N==="source"&&(q.key==="sourceKind"||q.key==="locator"))continue;const X=(v[q.key]??"").trim();if(!X){if(q.required){$(`Field '${q.label}' is required.`);return}continue}if(q.inputType==="json")try{p[q.key]=JSON.parse(X)}catch{$(`Field '${q.label}' must be valid JSON.`);return}else p[q.key]=X}const S={};for(const q of Ve.linkFields)if(!(N==="source"&&q.key==="resource"))if(q.multiple){const X=(k[q.key]??[]).map(ye=>ye.id);if(q.required&&X.length===0){$(`Link '${q.label}' is required.`);return}X.length>0&&(S[q.key]=X)}else{const X=((E=Z[q.key])==null?void 0:E.id)??null;if(q.required&&!X){$(`Link '${q.label}' is required.`);return}X&&(S[q.key]=X)}if(N==="source"){if(!$s(Ne)){$(t.cogita.library.add.info.referenceMissingSource);return}const q=Ne.sourceKind.trim();p.sourceKind=q,p.locator=Pn(Ne),(typeof p.label!="string"||!p.label.trim())&&(p.label=As(Ne));const X=Rn(Ne);X&&(S.resource=X.id)}he("saving"),$(null);try{if(l&&b)await hs({libraryId:d,infoId:b,payload:p,links:S}),$("Info updated.");else{await Jn({libraryId:d,infoType:N,payload:p,links:S});const q=N==="question"&&Me.length>0&&it<Me.length-1;if(q){const M=it+1,ke=Me[M]??null;if(ke){const ne=$n(ke);$e(M),le(ke),x(Y=>({...Y,definition:ne})),$(`Info saved. Loaded next question (${M+1}/${Me.length}).`)}else $("Info saved.")}else N==="question"&&Me.length>0&&(Xe([]),$e(0)),$("Info saved.");const X={};for(const M of Ve.payloadFields)X[M.key]=M.keepOnCreate?v[M.key]??"":"";if(q){const M=Me[Math.min(it+1,Me.length-1)];M&&(X.definition=$n(M))}x(X);const ye={},Q={};for(const M of Ve.linkFields)M.multiple?Q[M.key]=M.keepOnCreate?k[M.key]??[]:[]:ye[M.key]=M.keepOnCreate?Z[M.key]??null:null;_(M=>({...M,...ye})),H(M=>({...M,...Q})),N==="source"&&Ge(M=>{const ke=rt(M),ne=Rn(ke);return x(Y=>({...Y,sourceKind:ke.sourceKind,locator:Is(Pn(ke))})),_(Y=>({...Y,resource:ne})),ne&&ee(Y=>({...Y,resource:ne.infoType})),ke})}}catch(q){$(Ls(q,"Failed to save info."))}finally{he("idle")}},Ue=p=>{const S=v[p.key]??"";if(N==="question"&&p.key==="definition"&&p.inputType==="json"){const q=z.type,X=W=>{const pe=z.title??"",ce=z.question??"";Re({...Za(W),title:pe,question:ce})},ye=W=>W.length===0?[""]:W[W.length-1].trim()?[...W,""]:W,Q=W=>{const pe=(W.length?W:[[""],[""]]).map(ce=>ye(ce));return pe.length>=2?pe:[...pe,[""]]},M=(W,pe)=>{const ce=W.map(Ce=>Array.from({length:pe},(Be,Ke)=>Ce[Ke]??"")).filter(Ce=>Ce.some(Be=>Be.trim())||Ce===W[W.length-1]);return ce.length===0?[new Array(pe).fill("")]:ce[ce.length-1].some(Ce=>Ce.trim())?[...ce,new Array(pe).fill("")]:ce},ke=Array.isArray(z.answer)?z.answer:[],ne=Q(z.columns??[[""],[""]]),Y=M(z.matchingPaths??[[]],ne.length);return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:p.label}),e.jsxs("div",{className:"cogita-library-panel",style:{display:"grid",gap:"0.8rem"},children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Question type"}),e.jsxs("select",{value:q,onChange:W=>X(W.target.value),children:[e.jsx("option",{value:"selection",children:"Selection"}),e.jsx("option",{value:"truefalse",children:"True / false"}),e.jsx("option",{value:"text",children:"Text answer"}),e.jsx("option",{value:"number",children:"Number answer"}),e.jsx("option",{value:"date",children:"Date answer"}),e.jsx("option",{value:"matching",children:"Matching"}),e.jsx("option",{value:"ordering",children:"Right order"})]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Title"}),e.jsx("input",{type:"text",value:z.title??"",onChange:W=>Re({...z,title:W.target.value}),placeholder:"Optional title"})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Question"}),e.jsx("textarea",{rows:3,value:z.question??"",onChange:W=>Re({...z,question:W.target.value}),placeholder:"Question text"})]}),q==="selection"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Options / correct indices"}),ye(z.options??[""]).map((W,pe,ce)=>{const de=new Set(ke.filter(Be=>Number.isInteger(Be))),Ce=pe===ce.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:de.has(pe),disabled:!W.trim(),onChange:Be=>{const Ke=Be.target.checked?[...de,pe]:[...de].filter(Ee=>Ee!==pe);Re({...z,answer:Ke})}}),e.jsx("input",{type:"text",value:W,placeholder:`Answer ${pe+1}`,onChange:Be=>{const Ke=[...z.options??[""]];Ke[pe]=Be.target.value;const Ee=ye(Ke),bt=Ee.length-1,dt=ke.filter(yt=>yt>=0&&yt<bt);Re({...z,options:Ee,answer:dt})}}),Ce?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const Ke=(z.options??[""]).filter((bt,dt)=>dt!==pe),Ee=ke.filter(bt=>bt!==pe).map(bt=>bt>pe?bt-1:bt);Re({...z,options:ye(Ke),answer:Ee})},children:"Remove"})]},`question-option:${pe}`)})]}):null,q==="text"||q==="date"||q==="number"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Answer"}),e.jsx("input",{type:q==="date"?"date":"text",value:typeof z.answer=="string"||typeof z.answer=="number"?String(z.answer):"",onChange:W=>Re({...z,answer:W.target.value})})]}):null,q==="truefalse"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Answer"}),e.jsxs("select",{value:String(!!z.answer),onChange:W=>Re({...z,answer:W.target.value==="true"}),children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]}):null,q==="matching"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Columns"}),ne.map((W,pe)=>e.jsxs("div",{style:{display:"grid",gap:"0.35rem",border:"1px solid rgba(120,170,220,0.22)",borderRadius:"0.6rem",padding:"0.55rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{fontSize:"0.8rem",color:"rgba(184,209,234,0.85)"},children:["Column ",pe+1]}),ne.length>2?e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const ce=ne.filter((Ce,Be)=>Be!==pe),de=Y.map(Ce=>Ce.filter((Be,Ke)=>Ke!==pe));Re({...z,columns:Q(ce),matchingPaths:M(de,Math.max(2,ce.length))})},children:"Remove column"}):null]}),W.map((ce,de)=>{const Ce=de===W.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"0.4rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:ce,placeholder:`Option ${de+1}`,onChange:Be=>{const Ke=ne.map(Ee=>[...Ee]);Ke[pe][de]=Be.target.value,Re({...z,columns:Q(Ke),matchingPaths:M(Y,ne.length)})}}),Ce?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const Be=ne.map(Ke=>[...Ke]);Be[pe]=Be[pe].filter((Ke,Ee)=>Ee!==de),Re({...z,columns:Q(Be),matchingPaths:M(Y,ne.length)})},children:"Remove"})]},`question-column:${pe}:row:${de}`)})]},`question-column:${pe}`)),e.jsx("div",{className:"cogita-form-actions",style:{justifyContent:"flex-start"},children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>{const W=[...ne.map(ce=>[...ce]),[""]],pe=Y.map(ce=>[...ce,""]);Re({...z,columns:Q(W),matchingPaths:M(pe,W.length)})},children:"Add column"})}),e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Correct paths (0-based indices)"}),Y.map((W,pe)=>{const ce=pe===Y.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(${ne.length}, minmax(0,1fr)) auto`,gap:"0.35rem",alignItems:"center"},children:[W.map((de,Ce)=>e.jsx("input",{type:"number",min:0,step:1,value:de,placeholder:`${Ce}`,onChange:Be=>{const Ke=Y.map(dt=>[...dt]);Ke[pe][Ce]=Be.target.value;const Ee=M(Ke,ne.length),bt=Ee.map(dt=>dt.map(yt=>yt.trim())).filter(dt=>dt.every(yt=>yt!=="")).map(dt=>dt.map(yt=>Number(yt))).filter(dt=>dt.every(yt=>Number.isInteger(yt)&&yt>=0));Re({...z,matchingPaths:Ee,answer:{paths:bt}})}},`question-path:${pe}:${Ce}`)),ce?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const de=Y.filter((Ke,Ee)=>Ee!==pe),Ce=M(de,ne.length),Be=Ce.map(Ke=>Ke.map(Ee=>Ee.trim())).filter(Ke=>Ke.every(Ee=>Ee!=="")).map(Ke=>Ke.map(Ee=>Number(Ee))).filter(Ke=>Ke.every(Ee=>Number.isInteger(Ee)&&Ee>=0));Re({...z,matchingPaths:Ce,answer:{paths:Be}})},children:"Remove"})]},`question-path:${pe}`)})]}):null,q==="ordering"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Ordered options (correct order = listed order)"}),ye(z.options??[""]).map((W,pe,ce)=>{const de=pe===ce.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"0.5rem",alignItems:"center"},children:[e.jsxs("span",{style:{color:"rgba(184,209,234,0.75)",minWidth:"1.5rem"},children:[pe+1,"."]}),e.jsx("input",{type:"text",value:W,placeholder:`Step ${pe+1}`,onChange:Ce=>{const Be=[...z.options??[""]];Be[pe]=Ce.target.value,Re({...z,options:ye(Be)})}}),de?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>Re({...z,options:ye((z.options??[]).filter((Ce,Be)=>Be!==pe))}),children:"Remove"})]},`question-order:${pe}`)})]}):null,e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"JSON import"}),e.jsx("textarea",{rows:8,value:xe,onChange:W=>Ie(W.target.value),placeholder:"Paste question JSON"}),e.jsxs("div",{className:"cogita-form-actions",style:{justifyContent:"flex-start"},children:[e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>{try{const W=JSON.parse(xe);if(Array.isArray(W)){const ce=W.map(Ce=>Aa(Ce)).filter(Ce=>!!Ce);if(ce.length===0){$("Question JSON array must contain at least one valid question object.");return}const de=ce[0];Xe(ce),$e(0),Re(de),$(`Loaded question array (${ce.length} items).`);return}const pe=Aa(W);if(!pe){$("Question JSON must be an object or an array of question objects.");return}Xe([]),$e(0),Re(pe),$(null)}catch{$("Question JSON is invalid.")}},children:"Interpret JSON"}),Me.length>0?e.jsxs("span",{className:"cogita-library-hint",children:["Queue: ",Math.min(it+1,Me.length)," / ",Me.length]}):null]})]})]})]},`payload:${p.key}`)}const E=p.inputType==="textarea"||p.inputType==="json";return e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:p.label}),E?e.jsx("textarea",{rows:p.inputType==="json"?8:4,value:S,onChange:q=>x(X=>({...X,[p.key]:q.target.value})),placeholder:p.key}):e.jsx("input",{type:"text",value:S,onChange:q=>x(X=>({...X,[p.key]:q.target.value})),placeholder:p.key})]},`payload:${p.key}`)},tt=p=>{const S=T[p.key]??p.targetTypes[0],E=p.key==="references"&&p.multiple&&p.targetTypes.includes("source"),q=F[p.key]??Va(),X=ge[p.key]??!1,ye=G[p.key];return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:p.label}),p.targetTypes.length>1?e.jsx("select",{value:S,onChange:Q=>ee(M=>({...M,[p.key]:Q.target.value})),children:p.targetTypes.map(Q=>e.jsx("option",{value:Q,children:ot(t,Q)},`${p.key}:${Q}`))}):null,p.multiple?e.jsx(Xt,{libraryId:d,infoType:S,label:p.label,placeholder:p.key,multiple:!0,values:k[p.key]??[],onChangeMultiple:Q=>H(M=>({...M,[p.key]:Q})),allowCreate:!E,searchFailedText:"Search failed",createFailedText:"Create failed"}):e.jsx(Xt,{libraryId:d,infoType:S,label:p.label,placeholder:p.key,value:Z[p.key]??null,onChange:Q=>_(M=>({...M,[p.key]:Q})),searchFailedText:"Search failed",createFailedText:"Create failed"}),E?e.jsxs("div",{children:[e.jsxs("label",{className:"cogita-field",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:X,onChange:Q=>R(M=>({...M,[p.key]:Q.target.checked}))}),e.jsx("span",{children:t.cogita.library.add.info.referenceToggle})]}),X?e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.add.info.referenceTitle}),e.jsx(Ts,{libraryId:d,copy:t,language:m,sourceKindOptions:[...Cs],value:q,onChange:Q=>L(M=>({...M,[p.key]:Q})),labels:gt}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>at(p.key),disabled:P===p.key,children:P===p.key?t.cogita.library.lookup.saving:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.source)})}),ye?e.jsx("p",{className:"cogita-library-subtitle",children:ye}):null]}):null]}):null]},`link:${p.key}`)},qe=()=>e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.add.info.referenceTitle}),e.jsx(Ts,{libraryId:d,copy:t,language:m,sourceKindOptions:[...Cs],value:Ne,onChange:Ge,labels:gt})]});return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:l?"Edit info":"Create info"}),e.jsx("h1",{className:"cogita-library-title",children:o}),e.jsx("p",{className:"cogita-library-subtitle",children:"Specification-driven editor"})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:`/#/cogita/library/${d}/list`,children:"Back to list"})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-panel",children:[l?null:e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Info type"}),e.jsx("select",{value:N,onChange:p=>A(p.target.value),children:He.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),ie==="loading"&&l?e.jsx("p",{children:"Loading..."}):null,Ve&&!(ie==="loading"&&l)?e.jsxs("div",{className:"cogita-form-grid",children:[Ve.payloadFields.filter(p=>!(N==="source"&&(p.key==="sourceKind"||p.key==="locator"))).map(Ue),N==="source"?qe():null,Ve.linkFields.filter(p=>!(N==="source"&&p.key==="resource")).map(tt)]}):ie==="loading"&&l?null:e.jsx("p",{children:"No specification found for this info type."}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:Le,disabled:ie==="saving"||!Ve,children:ie==="saving"?"Saving...":l?"Update info":"Create info"})}),C?e.jsx("p",{className:"cogita-library-subtitle",children:C}):null]})})})]})})}const Rs=t=>/\s/.test(t),on=t=>/[\p{L}\p{N}]/u.test(t),Ps=(t,a)=>{const s=a>0?t[a-1]:"",r=a<t.length?t[a]:"";if(!s||!r)return 0;const i=Rs(s),u=Rs(r);if(i||u)return 3;const c=on(s),y=on(r);return c!==y?2:!c&&!y?1:0},En=(t,a,s,r,i)=>{const u=Math.max(r-a,s-r);for(let c=0;c<=u;c+=1){const y=r-c;if(y>=a&&y<=s&&Ps(t,y)>=i)return y;const m=r+c;if(m>=a&&m<=s&&Ps(t,m)>=i)return m}return null},Fn=(t,a)=>{const s=a>0?t[a-1]:"",r=a<t.length?t[a]:"";return!s||!r?!0:on(s)!==on(r)},Ai=(t,a,s,r)=>{const i=s-a,u=a+r,c=s-r;if(i<=r*2||c<=u)return null;const y=Math.floor((a+s)/2),m=En(t,u,c,y,3);if(m!==null&&Fn(t,m))return m;const j=En(t,u,c,y,2);if(j!==null&&Fn(t,j))return j;const d=En(t,u,c,y,1);return d!==null&&Fn(t,d)?d:null},va=(t,a)=>{const s=Math.max(1,(a==null?void 0:a.minLen)??7),r=Math.max(s,(a==null?void 0:a.maxLen)??13),i={},u=(m,j,d,b,o)=>{const l=String(b),w={id:l,start:m,end:j,text:t.slice(m,j),depth:d,index:b,parentId:o};if(i[l]=w,j-m>r){let N=Ai(t,m,j,s);if(N!==null&&N>m&&N<j){const A=u(m,N,d+1,b*2+1,l),v=u(N,j,d+1,b*2+2,l);w.leftId=A.id,w.rightId=v.id}}return w},c=u(0,t.length,0,0),y=Object.values(i).sort((m,j)=>j.depth-m.depth||m.start-j.start).map(m=>m.id);return{text:t,rootId:c.id,nodes:i,order:y}},Ra=(t,a,s,r,i,u,c)=>{const y=u==="reverse"?t.order.slice().sort((m,j)=>t.nodes[j].start-t.nodes[m].start||t.nodes[j].depth-t.nodes[m].depth):t.order;for(const m of y){if(c&&m===c||a.has(m))continue;const j=t.nodes[m];if(j){if(i&&(j.leftId||j.rightId)){const d=j.leftId?s[j.leftId]??0:r,b=j.rightId?s[j.rightId]??0:r;if((d+b)/2<r)continue}return j}}return null},vn=(t,a)=>({before:t.slice(0,a.start),fragment:t.slice(a.start,a.end),after:t.slice(a.end)});function $i({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d}){const b=`/#/cogita/library/${d}`,[o,l,w]=Gn([]),[h,N,A]=Yn([]),[v,x]=n.useState(null),[Z,_]=n.useState(null),[k,H]=n.useState(null),[T,ee]=n.useState(null),C=n.useMemo(()=>o.find(R=>R.id===v)??null,[o,v]);n.useEffect(()=>{let R=!0;return Nr({libraryId:d}).then(F=>{if(!R)return;const L=F.nodes.map(G=>{var D,P,J;return{id:G.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:G.payload&&typeof G.payload=="object"&&"label"in G.payload?String(G.payload.label):"Item",nodeType:G.nodeType,itemType:((D=G.payload)==null?void 0:D.itemType)??"info",itemId:((P=G.payload)==null?void 0:P.itemId)??null,infoType:((J=G.payload)==null?void 0:J.infoType)??null}}});l(L),N(F.edges.map(G=>({id:G.edgeId,source:G.fromNodeId,target:G.toNodeId})))}).catch(()=>{R&&(l([]),N([]))}),()=>{R=!1}},[d]),n.useEffect(()=>{Sr({libraryId:d}).then(_).catch(()=>_(null))},[d,o,h]);const $=n.useCallback(R=>{N(F=>Xn(R,F))},[]),ie=()=>{const R=crypto.randomUUID();l(F=>[...F,{id:R,type:"default",position:{x:140+F.length*40,y:120+F.length*30},data:{label:t.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},he=()=>{const R=crypto.randomUUID();l(F=>[...F,{id:R,type:"default",position:{x:180+F.length*40,y:160+F.length*30},data:{label:t.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},Ne=async()=>{H(null);try{const R=o.map(L=>({nodeId:L.id,nodeType:L.data.nodeType,payload:{itemType:L.data.itemType,itemId:L.data.itemId??null,label:L.data.label,infoType:L.data.infoType??null}})),F=h.map(L=>({edgeId:L.id,fromNodeId:L.source,toNodeId:L.target}));await Tr({libraryId:d,nodes:R,edges:F}),H(t.cogita.library.graph.saveSuccess)}catch{H(t.cogita.library.graph.saveFail)}},Ge=R=>{C&&l(F=>F.map(L=>L.id===C.id?{...L,data:{...L.data,itemId:(R==null?void 0:R.infoId)??null,itemType:"collection",infoType:"collection",label:(R==null?void 0:R.label)??t.cogita.library.infoTypes.collection}}:L))},ge=R=>{C&&l(F=>F.map(L=>L.id===C.id?{...L,data:{...L.data,itemId:(R==null?void 0:R.infoId)??null,itemType:"info",infoType:(R==null?void 0:R.infoType)??null,label:(R==null?void 0:R.label)??t.cogita.library.infoTypes.any}}:L))};return n.useEffect(()=>{if(!C||C.data.nodeType!=="info"||C.data.infoType!=="citation"||!C.data.itemId){ee(null);return}let R=!0;return aa({libraryId:d,infoId:C.data.itemId}).then(F=>{if(!R)return;const L=F.payload,G=(L==null?void 0:L.text)??"";if(!G){ee(null);return}const D=va(G),P=Object.values(D.nodes).sort((J,z)=>J.depth-z.depth||J.start-z.start).map(J=>({id:J.id,text:J.text,depth:J.depth}));ee({title:(L==null?void 0:L.title)??C.data.label,fragments:P})}).catch(()=>ee(null)),()=>{R=!1}},[d,C]),e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:t.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:b,children:t.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:Ne,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ie,children:t.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:he,children:t.cogita.library.actions.addInfo}),Z?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(Z.totalCollections))})}):null,k?e.jsx("p",{className:"cogita-help",children:k}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(fn,{nodes:o,edges:h,onNodesChange:w,onEdgesChange:A,onConnect:$,onNodeClick:(R,F)=>x(F.id),fitView:!0,children:[e.jsx(bn,{gap:18,size:1}),e.jsx(yn,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),C?e.jsxs("div",{className:"cogita-graph-inspector",children:[C.data.nodeType==="collection"?e.jsx(Xt,{libraryId:d,infoType:"collection",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:C.data.itemId?{id:C.data.itemId,label:C.data.label,infoType:"collection"}:null,onChange:Ge,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.collection),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}):e.jsx(Xt,{libraryId:d,infoType:"any",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:C.data.itemId?{id:C.data.itemId,label:C.data.label,infoType:C.data.infoType??void 0}:null,onChange:ge,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.any),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),T?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:T.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:T.fragments.map(R=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:R.id}),e.jsx("span",{children:R.text})]},R.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}function Fa({children:t,flashState:a,flashTick:s=0,feedbackToken:r,className:i}){const u=r??(a?`${a}-${s}`:"idle"),[c,y]=n.useState("a"),m=n.useRef(u);return n.useEffect(()=>{m.current!==u&&(m.current=u,y(j=>j==="a"?"b":"a"))},[u]),e.jsx("section",{className:i?`cogita-revision-card ${i}`:"cogita-revision-card","data-feedback":u,"data-feedback-variant":c,children:t})}function ss({copy:t,currentCard:a,currentTypeLabel:s,prompt:r,languages:i,answer:u,onAnswerChange:c,computedExpected:y,computedAnswers:m,onComputedAnswerChange:j,answerTemplate:d,outputVariables:b,variableValues:o,computedFieldFeedback:l,feedback:w,canAdvance:h,quoteContext:N,quotePlaceholder:A,onCheckAnswer:v,onSkip:x,onLanguageSelect:Z,onMarkReviewed:_,onAdvance:k,showCorrectAnswer:H,setShowCorrectAnswer:T,onRevealCorrect:ee,answerMask:C,expectedAnswer:$,hasExpectedAnswer:ie,handleComputedKeyDown:he,answerInputRef:Ne,computedInputRefs:Ge,scriptMode:ge,setScriptMode:R,matchPairs:F,matchLeftOrder:L,matchRightOrder:G,matchSelection:D,matchActiveLeft:P,matchActiveRight:J,matchFeedback:z,onMatchLeftSelect:le,onMatchRightSelect:xe,disableCheckAnswer:Ie=!1,hideSkipAction:Me=!1,allowRevealBeforeCheck:Xe=!1,autoRevealAfterAnswer:it=!1,disableCheckAfterAnswer:$e=!1}){const Ve=n.useMemo(()=>{var ke;const V=!d&&y.length===2?`The {${y[0].key}} is of type {${y[1].key}}`:null,te=d??V;if(!te)return null;const be=new Map(y.map(ne=>[ne.key,ne.expected])),p=new Set,S=[],E=/\{([^}]+)\}/g;let q=0,X,ye=null;for(;(X=E.exec(te))!==null;){const ne=te.slice(q,X.index);ne&&S.push({type:"text",value:ne});const Y=((ke=X[1])==null?void 0:ke.trim())??"",W=Y&&be.has(Y)?Y:Y&&b&&b[Y]?b[Y]:null;Y&&p.add(Y),W&&p.add(W),W&&be.has(W)?(S.push({type:"input",value:W}),ye||(ye=W)):Y&&o&&o[Y]!==void 0?S.push({type:"text",value:o[Y]}):S.push({type:"text",value:X[0]}),q=X.index+X[0].length}const Q=te.slice(q);return Q&&S.push({type:"text",value:Q}),y.filter(ne=>!p.has(ne.key)).length>0?null:{parts:S,expectedByKey:be,firstInputKey:ye}},[d,y,b,o]),kt=()=>{if(!Ve)return null;const{parts:V,expectedByKey:te,firstInputKey:be}=Ve;return e.jsx("div",{className:"cogita-revision-inline-answer",children:V.map((p,S)=>{var E,q;return p.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:p.value},`text-${S}`):e.jsx("input",{ref:X=>{Ge.current[p.value]=X},autoFocus:p.value===be,value:m[p.value]??"",onChange:X=>j(p.value,X.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":l[p.value]??(w==="correct"?"correct":w==="incorrect"?"incorrect":void 0),onKeyDown:X=>gt(X)||he(X),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((E=m[p.value])==null?void 0:E.length)??0,((q=te.get(p.value))==null?void 0:q.length)??6)}ch`}},`input-${p.value}-${S}`)})})},He=n.useMemo(()=>{const V=new Map;return(F??[]).forEach(te=>V.set(te.leftId,te)),V},[F]),Re=n.useMemo(()=>{const V=new Map;return(F??[]).forEach(te=>V.set(te.rightId,te)),V},[F]);n.useEffect(()=>{var S;if(a.cardType!=="info"||a.infoType!=="computed"||y.length===0)return;const V=typeof document<"u"?document.activeElement:null;if(V&&(V.tagName==="INPUT"||V.tagName==="TEXTAREA"))return;const te=(Ve==null?void 0:Ve.firstInputKey)??((S=y[0])==null?void 0:S.key);if(!te)return;const be=Ge.current[te];if(!be)return;const p=requestAnimationFrame(()=>{be.focus()});return()=>cancelAnimationFrame(p)},[a,y,Ve]);const rt=(()=>{const V=[$??"",...y.map(p=>p.expected??"")].join(""),te=[u,...Object.values(m)].join(""),be=`${V}${te}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(be)})(),gt=V=>V.ctrlKey&&(V.key==="^"||V.key==="6")?(V.preventDefault(),R(te=>te==="super"?null:"super"),!0):V.ctrlKey&&(V.key==="_"||V.key==="-")?(V.preventDefault(),R(te=>te==="sub"?null:"sub"),!0):!1,at=()=>{if(!$||!C)return $??"";const V=$.split(""),te=Array.from(C),be=te.length>0?te.reduce((p,S)=>p+S,0)/te.length:127;return V.map((p,S)=>{const E=te[S]??be,q=Math.max(0,Math.min(255,Math.round(E)));let X=255,ye=0;return q<=127?ye=Math.round(q/127*255):(ye=255,X=Math.round(255*(1-(q-127)/128))),e.jsx("span",{style:{color:`rgb(${X}, ${ye}, 0)`},children:p},`mask-${S}`)})},Le=a.cardType==="info"&&a.infoType==="citation"?(N==null?void 0:N.title)||a.label:a.description,Ue=H||it&&w!==null,tt=Ie||$e&&(w!==null||Ue),qe=ie&&(Xe||w==="incorrect"||Ue);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[s?e.jsx("span",{children:s}):null,e.jsx("strong",{children:Le})]}),a.cardType==="vocab"&&a.checkType==="translation-match"&&F?e.jsxs("div",{className:"cogita-revision-body",children:[r?e.jsx("h2",{children:r}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(L??[]).map(V=>{const te=He.get(V);if(!te)return null;const be=(D==null?void 0:D[V])??null,p=(z==null?void 0:z[V])??null,S=P===V;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":S,"data-state":p??void 0,"data-locked":be?"true":void 0,onClick:()=>le==null?void 0:le(V),children:[e.jsx("span",{children:te.leftLabel}),be&&H?e.jsx("em",{children:"✓"}):null]},V)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(G??[]).map(V=>{const te=Re.get(V);if(!te)return null;const be=Object.values(D??{}).includes(V),p=J===V;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":be||p,"data-locked":be?"true":void 0,onClick:()=>xe==null?void 0:xe(V),children:e.jsx("span",{children:te.rightLabel})},V)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:a.checkType==="translation-match"||tt,children:t.cogita.library.revision.checkAnswer}),Me?null:e.jsx("button",{type:"button",className:"ghost",onClick:x,children:t.cogita.library.revision.skip})]})]}):a.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:Ne,value:u,onChange:V=>c(V.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":w==="correct"?"correct":w==="incorrect"?"incorrect":void 0,onKeyDown:V=>{if(V.key==="Enter")if(V.preventDefault(),V.stopPropagation(),h)k();else{if(tt)return;v()}}})]}),rt?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>R(V=>V==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>R(V=>V==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:tt,children:t.cogita.library.revision.checkAnswer}),Me?null:e.jsx("button",{type:"button",className:"ghost",onClick:x,children:t.cogita.library.revision.skip})]})]}):a.cardType==="info"&&a.infoType==="question"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:Ne,value:u,onChange:V=>c(V.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":w==="correct"?"correct":w==="incorrect"?"incorrect":void 0,onKeyDown:V=>{if(V.key==="Enter")if(V.preventDefault(),V.stopPropagation(),h)k();else{if(tt)return;v()}}})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:tt,children:t.cogita.library.revision.checkAnswer}),Me?null:e.jsx("button",{type:"button",className:"ghost",onClick:x,children:t.cogita.library.revision.skip})]})]}):a.cardType==="info"&&a.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[a.label?e.jsx("p",{className:"cogita-revision-hint",children:a.label}):null,d?null:e.jsx(Cr,{value:r??"",mode:"auto"}),y.length>0?(()=>{const V=kt();return V?e.jsx("div",{className:"cogita-inline-answer-wrap",children:V}):e.jsx("div",{className:"cogita-form-grid",children:y.map((te,be)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:te.key}),e.jsx("textarea",{ref:p=>{Ge.current[te.key]=p},autoFocus:be===0,value:m[te.key]??"",onChange:p=>j(te.key,p.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":l[te.key]??(w==="correct"?"correct":w==="incorrect"?"incorrect":void 0),onKeyDown:p=>gt(p)||he(p)})]},te.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:Ne,value:u,onChange:V=>c(V.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":w==="correct"?"correct":w==="incorrect"?"incorrect":void 0,onKeyDown:V=>{if(!gt(V)&&V.key==="Enter")if(V.preventDefault(),V.stopPropagation(),h)k();else{if(tt)return;v()}}})]})}),rt?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>R(V=>V==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>R(V=>V==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:tt,children:t.cogita.library.revision.checkAnswer}),Me?null:e.jsx("button",{type:"button",className:"ghost",onClick:x,children:t.cogita.library.revision.skip})]})]}):a.cardType==="info"&&a.infoType==="citation"&&N?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.quoteProgress.replace("{done}",String(N.completed)).replace("{total}",String(N.total))}),e.jsx("p",{className:"cogita-quote-text",children:N.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:Ne,value:u,onChange:V=>c(V.target.value),placeholder:A??t.cogita.library.revision.quoteMissingPlaceholder,"data-state":w==="correct"?"correct":w==="incorrect"?"incorrect":void 0,onKeyDown:V=>{if(V.key==="Enter")if(V.preventDefault(),V.stopPropagation(),h)k();else{if(tt)return;v()}}})]}),e.jsx("p",{className:"cogita-quote-text",children:N.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:v,disabled:tt,children:t.cogita.library.revision.checkAnswer}),Me?null:e.jsx("button",{type:"button",className:"ghost",onClick:x,children:t.cogita.library.revision.skip})]})]}):a.cardType==="info"&&a.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:i.length?i.map(V=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>Z(V.label),children:V.label},V.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:t.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:x,children:t.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:r}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:_,children:t.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:t.cogita.library.revision.skip})]})]}),w&&e.jsx("div",{className:"cogita-revision-feedback","data-state":w,children:w==="correct"?t.cogita.library.revision.correct:t.cogita.library.revision.tryAgain}),qe?e.jsxs("div",{className:"cogita-revision-reveal",children:[Ue?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>T(V=>{const te=!V;return te&&ee(),te}),children:t.cogita.library.revision.showAnswer}),Ue?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),y.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[y.map(V=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:V.key}),e.jsx("span",{children:V.expected})]},V.key)),$?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:$})]}):null]}):e.jsx("p",{children:C?at():$})]}):null]}):null,h?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:k,children:t.cogita.library.revision.nextQuestion})}):null]})}const Es={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Ri=(t,a)=>{const s=Math.max(t.length,a.length,1),r=Math.abs(t.length-a.length);return Math.max(0,1-r/s)},Pi=(t,a)=>{const s=new Uint8Array(t.length),r=Ri(t,a);for(let i=0;i<t.length;i+=1){const u=t[i]===(a[i]??"")?128:0,c=t.length-1-i,y=a.length-1-i,m=t[c]===(a[y]??"")?127:0,j=Math.round((u+m)*r);s[i]=Math.max(0,Math.min(255,j))}return s},Ei=(t,a)=>t===a||(Es[t]??[]).includes(a)?!0:(Es[a]??[]).includes(t),en=(t,a,s)=>s?Ei(t,a):t===a,ln=(t,a,s)=>{const r=new Uint8Array(t.length);if(!t.length)return r;const i=(s==null?void 0:s.allowSimilarChars)??!0,u=[];for(let y=0;y<=t.length-3;y+=1)u.push({index:y,text:t.slice(y,y+3)});let c=!1;return u.forEach(y=>{for(let m=0;m<=a.length-3;m+=1){const j=a.slice(m,m+3);let d=0;for(let h=0;h<3;h+=1)en(y.text[h],j[h],i)&&(d+=1);if(d<2)continue;let b=y.index-1,o=m-1;for(;b>=0&&o>=0;){const h=t[b],N=a[o];if(h===N){r[b]=Math.max(r[b],255),b-=1,o-=1,c=!0;continue}if(en(h,N,i)&&h!==N){r[b]=Math.max(r[b],127),b-=1,o-=1,c=!0;continue}if(b>0&&t[b-1]===N){r[b]=Math.max(r[b],0),b-=1,c=!0;continue}if(o>0&&t[b]===a[o-1]){o-=1,c=!0;continue}break}for(let h=0;h<3;h+=1){const N=y.index+h,A=y.text[h],v=j[h],x=A===v?255:en(A,v,i)?127:0;r[N]=Math.max(r[N],x),c=!0}let l=y.index+3,w=m+3;for(;l<t.length&&w<a.length;){const h=t[l],N=a[w];if(h===N){r[l]=Math.max(r[l],255),l+=1,w+=1,c=!0;continue}if(en(h,N,i)&&h!==N){r[l]=Math.max(r[l],127),l+=1,w+=1,c=!0;continue}if(l+1<t.length&&t[l+1]===N){r[l]=Math.max(r[l],0),l+=1,c=!0;continue}if(w+1<a.length&&t[l]===a[w+1]){w+=1,c=!0;continue}break}}}),c?r:Pi(t,a)},Kn=t=>/[\p{L}\p{N}]/u.test(t),Fs=t=>t.trim().toLowerCase(),xa=(t,a)=>{if(t.length===0)return 100;const s=(a==null?void 0:a.treatSimilarCharsAsSame)??!1,r=Array.from(t).reduce((i,u)=>s&&u===127?i+255:i+u,0);return Math.round(r/(t.length*255)*100)},Sa=(t,a,s)=>{const r=Math.max(0,Math.min(100,(s==null?void 0:s.thresholdPercent)??100)),i=(s==null?void 0:s.treatSimilarCharsAsSame)??!0,u=(s==null?void 0:s.ignorePunctuationAndSpacing)??!1,c=Fs(t),y=Fs(a);if(!u){const v=ln(c,y,{allowSimilarChars:i}),x=xa(v,{treatSimilarCharsAsSame:i});return{mask:v,percent:x,isCorrect:x>=r,normalizedExpected:c,normalizedAnswer:y}}const m=Array.from(c),j=Array.from(y),d=[],b=[],o=[];m.forEach((v,x)=>{Kn(v)&&(d.push(v),b.push(x))}),j.forEach(v=>{Kn(v)&&o.push(v)});const l=d.join(""),w=o.join(""),h=ln(l,w,{allowSimilarChars:i}),N=new Uint8Array(m.length);for(let v=0;v<N.length;v+=1)N[v]=Kn(m[v]??"")?0:255;for(let v=0;v<h.length;v+=1){const x=b[v];x!==void 0&&(N[x]=h[v])}const A=xa(h,{treatSimilarCharsAsSame:i});return{mask:N,percent:A,isCorrect:A>=r,normalizedExpected:l,normalizedAnswer:w}},Pa=(t,a,s)=>{const r=t.trim().toLowerCase(),i=a.trim().toLowerCase();return s==="prefix"||s==="bidirectional"?ln(r,i,{allowSimilarChars:!0}):ln(r,i,{allowSimilarChars:!0})};function Fi(t){if(!t||typeof t!="object")return null;const s=t.definition;if(!s||typeof s!="object")return null;const r=s,i=typeof r.type=="string"?r.type:typeof r.kind=="string"?r.kind:"selection",u=i==="multi_select"||i==="single_select"?"selection":i==="boolean"?"truefalse":i==="order"?"ordering":i==="short"||i==="open"||i==="short_text"?"text":i;if(!["selection","truefalse","text","number","date","ordering","matching"].includes(u))return null;const c=u,y=typeof r.title=="string"?r.title:void 0,m=typeof r.question=="string"?r.question:"",j=Array.isArray(r.options)?r.options.map(o=>typeof o=="string"?o:"").filter(Boolean):void 0,d=Array.isArray(r.columns)?r.columns.map(o=>Array.isArray(o)?o.map(l=>typeof l=="string"?l:"").filter(Boolean):[]).filter(o=>o.length>0):void 0,b=(()=>{if(u==="selection")return(Array.isArray(r.answer)?r.answer:Array.isArray(r.correct)?r.correct:[]).map(l=>Number(l)).filter(l=>Number.isInteger(l)&&l>=0);if(u==="truefalse")return typeof r.answer=="boolean"?r.answer:typeof r.expected=="boolean"?r.expected:!1;if(u==="matching"){const o=r.answer&&typeof r.answer=="object"?r.answer:null;return{paths:(Array.isArray(o==null?void 0:o.paths)?o==null?void 0:o.paths:Array.isArray(r.correctPairs)?r.correctPairs:[]).map(h=>Array.isArray(h)?h.map(N=>Number(N)).filter(N=>Number.isInteger(N)&&N>=0):[]).filter(h=>h.length>0)}}if(typeof r.answer=="string"||typeof r.answer=="number")return r.answer;if(typeof r.expected=="string"||typeof r.expected=="number")return r.expected})();return{type:c,title:y,question:m,options:j,columns:d,answer:b}}function Ki(t){const a=[...t];for(let s=a.length-1;s>0;s-=1){const r=Math.floor(Math.random()*(s+1));[a[s],a[r]]=[a[r],a[s]]}return a}function Ks(t){const a=t.map((i,u)=>({value:i,oldIndex:u}));for(let i=a.length-1;i>0;i-=1){const u=Math.floor(Math.random()*(i+1));[a[i],a[u]]=[a[u],a[i]]}const s=a.map(i=>i.value),r=new Map;return a.forEach((i,u)=>r.set(i.oldIndex,u)),{values:s,oldToNew:r}}function _i(t){if(t.type==="selection"){const a=t.options??[],s=Ks(a),r=Array.isArray(t.answer)?t.answer:[];return{...t,options:s.values,answer:r.map(i=>s.oldToNew.get(i)).filter(i=>Number.isInteger(i)).sort((i,u)=>i-u)}}if(t.type==="matching"){const s=(t.columns??[]).map(u=>Ks(u??[])),i=(t.answer&&typeof t.answer=="object"&&"paths"in t.answer?t.answer.paths:[]).map(u=>u.map((c,y)=>{var m;return((m=s[y])==null?void 0:m.oldToNew.get(c))??c}));return{...t,columns:s.map(u=>u.values),answer:{paths:i}}}return t}function oa(t){return[t.cardId,t.checkType??"",t.direction??""].join("|")}function _s(t){return[t.parentItemId,t.parentCheckType??"",t.parentDirection??""].join("|")}function Ds(t){const a=t.checkType??"info",s=a.startsWith("question-")?`question / ${a.slice(9)}`:a;return t.direction?`${s} / ${t.direction}`:s}function Di({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,infoId:b,selectedReviewerRoleId:o}){const[l,w]=n.useState(b),[h,N]=n.useState([]),[A,v]=n.useState([]),[x,Z]=n.useState("loading"),[_,k]=n.useState(null),[H,T]=n.useState(null),[ee,C]=n.useState(null),[$,ie]=n.useState(null),[he,Ne]=n.useState(""),[Ge,ge]=n.useState(null),[R,F]=n.useState(1),[L,G]=n.useState(null),[D,P]=n.useState(0),[J,z]=n.useState(!1),[le,xe]=n.useState(null),[Ie,Me]=n.useState({}),[Xe,it]=n.useState({}),[$e]=n.useState({}),[Ve,kt]=n.useState(null),[He,Re]=n.useState({selection:[],booleanAnswer:null,ordering:[],matchingRows:[],matchingSelection:[]}),rt=n.useRef(null),gt=n.useRef({}),at=Qa();n.useEffect(()=>{let Q=!1;return Z("loading"),Promise.all([aa({libraryId:d,infoId:b}).catch(()=>null),nn({libraryId:d,infoId:b}),sn({libraryId:d,infoId:b})]).then(([M,ke,ne])=>{if(Q)return;const Y=(M==null?void 0:M.payload)??{},W=typeof Y.title=="string"&&Y.title||typeof Y.label=="string"&&Y.label||typeof Y.name=="string"&&Y.name||b;w(W),T(Y),C((M==null?void 0:M.infoType)??null),N(ke.items),v(ne.items),Z("ready")}).catch(()=>{Q||(T(null),C(null),N([]),v([]),Z("error"))}),()=>{Q=!0}},[d,b]),n.useEffect(()=>{if(ee!=="translation"){ie(null);return}Ys({libraryId:d,infoId:b,approachKey:"vocab-card"}).then(Q=>ie(Q.projection??null)).catch(()=>ie(null))},[ee,b,d]);const Le=n.useMemo(()=>{var pe;const Q=new Map(h.map(ce=>[oa(ce),ce])),M=new Map,ke=new Map;for(const ce of h)M.set(oa(ce),0),ke.set(oa(ce),[]);for(const ce of A){const de=_s({parentItemId:ce.parentItemId,parentCheckType:ce.parentCheckType,parentDirection:ce.parentDirection}),Ce=[ce.childItemId,ce.childCheckType??"",ce.childDirection??""].join("|");!Q.has(de)||!Q.has(Ce)||((pe=ke.get(de))==null||pe.push(Ce),M.set(Ce,(M.get(Ce)??0)+1))}const ne=Array.from(M.entries()).filter(([,ce])=>ce===0).map(([ce])=>ce),Y=new Map;for(const ce of ne)Y.set(ce,0);for(;ne.length;){const ce=ne.shift(),de=Y.get(ce)??0;for(const Ce of ke.get(ce)??[]){const Be=Math.max(Y.get(Ce)??0,de+1);Y.set(Ce,Be),M.set(Ce,(M.get(Ce)??1)-1),(M.get(Ce)??0)<=0&&ne.push(Ce)}}const W=new Map;for(const ce of h){const de=oa(ce),Ce=Y.get(de)??0,Be=W.get(Ce)??[];Be.push(de),W.set(Ce,Be)}return h.map(ce=>{const de=oa(ce),Ce=Y.get(de)??0,Be=W.get(Ce)??[de],Ke=Math.max(0,Be.indexOf(de));return{id:de,position:{x:40+Ke*290+(Ce%2?18:0),y:30+Ce*120},draggable:!1,selectable:!0,data:{label:ce.label,subtitle:Ds(ce),checkType:ce.checkType??"info",direction:ce.direction??null},style:{width:250,borderRadius:10,border:"1px solid rgba(120,170,220,0.22)",background:"rgba(8,20,34,0.88)",color:"#e8f2ff",padding:8}}})},[h,A]),Ue=n.useMemo(()=>new Map(h.map(Q=>[oa(Q),Q])),[h]),tt=n.useMemo(()=>{const Q=[];for(const M of A){const ke=_s({parentItemId:M.parentItemId,parentCheckType:M.parentCheckType,parentDirection:M.parentDirection}),ne=[M.childItemId,M.childCheckType??"",M.childDirection??""].join("|");!Ue.has(ke)||!Ue.has(ne)||Q.push({id:`${ke}->${ne}`,source:ke,target:ne,selectable:!1,animated:!1,style:{stroke:"rgba(148, 202, 248, 0.7)"}})}return Q},[Ue,A]),qe=n.useMemo(()=>_?Ue.get(_)??null:null,[Ue,_]);n.useEffect(()=>{Ne(""),G(null),P(0),z(!1),xe(null),ge(null),it({}),Re({selection:[],booleanAnswer:null,ordering:[],matchingRows:[],matchingSelection:[]})},[_]);const V=n.useMemo(()=>{var Y,W;if(!qe)return null;const Q=ee??qe.infoType??null,M=qe.checkType??"info",ke=qe.direction??null,ne=H??{};if(qe.cardType==="vocab"&&$&&Array.isArray($.words)){const pe=$.words,ce=((Y=pe[0])==null?void 0:Y.label)??"?",de=((W=pe[1])==null?void 0:W.label)??"?";return ke==="a-to-b"?{kind:"vocab",prompt:String(ce),expected:String(de)}:ke==="b-to-a"?{kind:"vocab",prompt:String(de),expected:String(ce)}:{kind:"generic",prompt:`${ce} ↔ ${de}`,expected:`${ce} ↔ ${de}`}}if(Q==="citation"&&M==="quote-fragment"&&ke&&typeof ne.text=="string"){const pe=ke,ce=va(ne.text),de=ce.nodes[pe];if(de){const Ce=vn(ne.text,de);return{kind:"citation-fragment",expected:de.text,quoteContext:{title:l,before:Ce.before,after:Ce.after,total:Object.keys(ce.nodes).length,completed:0},quotePlaceholder:de.text.length>0?".".repeat(Math.max(4,Math.min(18,de.text.length))):"..."}}}if(Q==="question"){const pe=Fi(ne);if(pe)return{kind:"question",definition:_i(pe)}}return{kind:"generic",prompt:qe.description||qe.label,expected:qe.label}},[ee,H,qe,l,$]);n.useEffect(()=>{var M;if(!V||V.kind!=="question")return;const Q=V.definition;Re({selection:[],booleanAnswer:null,ordering:Q.type==="ordering"?Ki(Q.options??[]):[],matchingRows:[],matchingSelection:Q.type==="matching"?new Array(Math.max(2,((M=Q.columns)==null?void 0:M.length)??2)).fill(null):[]})},[V,_]);const te=async Q=>{if(qe&&o)try{await Ir({libraryId:d,outcome:{itemType:"info",itemId:qe.cardId,checkType:qe.checkType??"info",direction:qe.direction??null,revisionType:"direct",evalType:"direct-check",correct:Q,clientId:"cogita-info-checkcards",clientSequence:R,personRoleId:o}}),F(M=>M+1),ge(Q?"Saved as correct.":"Saved as incorrect.")}catch{ge("Failed to save answer.")}},be=qe?oa(qe):null,p=be?!!Ie[be]:!1,S=async()=>{var ne;if(!qe||!V)return;const Q=oa(qe);if(Ie[Q]){ge("This card was already checked.");return}let M=!1,ke=null;if(V.kind==="question"){const Y=V.definition;if(Y.type==="selection"){const W=Array.isArray(Y.answer)?[...Y.answer].sort((ce,de)=>ce-de):[],pe=[...He.selection].sort((ce,de)=>ce-de);M=W.length===pe.length&&W.every((ce,de)=>ce===pe[de])}else if(Y.type==="truefalse")M=typeof Y.answer=="boolean"&&He.booleanAnswer!==null&&Y.answer===He.booleanAnswer;else if(Y.type==="ordering"){const W=(Y.options??[]).join(`
`),pe=He.ordering.join(`
`),ce=Sa(W,pe,{thresholdPercent:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!1});M=ce.isCorrect,ke=ce.mask}else if(Y.type==="matching"){const W=Math.max(2,((ne=Y.columns)==null?void 0:ne.length)??2),pe=He.matchingRows.map(Be=>Be.slice(0,W)).filter(Be=>Be.length===W&&Be.every(Ke=>Number.isInteger(Ke)&&Ke>=0)).map(Be=>JSON.stringify(Be)),ce=(Y.answer&&typeof Y.answer=="object"&&"paths"in Y.answer?Y.answer.paths:[]).map(Be=>JSON.stringify(Be)),de=Array.from(new Set(pe)).sort(),Ce=Array.from(new Set(ce)).sort();M=de.length===Ce.length&&de.every((Be,Ke)=>Be===Ce[Ke])}else{const W=String(Y.answer??""),pe=Sa(W,he,{thresholdPercent:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!1});M=pe.isCorrect,ke=pe.mask}xe(ke),z(!0)}else{const Y=V.expected,W=V.kind==="citation-fragment",pe=Sa(Y,he,{thresholdPercent:W?90:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:W});M=pe.isCorrect,xe(pe.mask),z(!0)}G(M?"correct":"incorrect"),P(Y=>Y+1),ge(o?null:"Answer checked locally (not saved: no person selected)."),Me(Y=>({...Y,[Q]:!0})),o&&await te(M)},E=()=>{if(!qe||!V)return;const Q=oa(qe);if(Ie[Q]||(Me(ke=>({...ke,[Q]:!0})),ge("Answer revealed (not saved).")),V.kind==="question"){xe(null);return}const M=Sa(V.expected,V.expected,{thresholdPercent:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:V.kind==="citation-fragment"});xe(M.mask)},q=n.useMemo(()=>qe?qe.infoType==="question"?{...qe,description:qe.label}:qe.infoType==="citation"?{...qe,description:l}:{...qe,description:qe.label}:null,[qe,l]),X=Q=>{var dt,yt;const M=Q.definition,ke=p||J,ne=Array.isArray(M.answer)?M.answer:[],Y=M.answer&&typeof M.answer=="object"&&"paths"in M.answer?M.answer.paths:[],W=Math.max(2,((dt=M.columns)==null?void 0:dt.length)??2),pe=M.type==="matching"?He.matchingRows.filter(Je=>Je.length===W&&Je.every(_e=>Number.isInteger(_e)&&_e>=0)):[],ce=Array.from({length:W},(Je,_e)=>He.matchingSelection[_e]??null),de=Je=>Je.join("|"),Ce=new Map;for(const Je of Y){const _e=de(Je);Ce.set(_e,(Ce.get(_e)??0)+1)}const Be=new Map;for(const Je of pe){const _e=de(Je);Be.set(_e,(Be.get(_e)??0)+1)}const Ke=Y.filter(Je=>{const _e=de(Je),mt=Be.get(_e)??0;return mt>0?(Be.set(_e,mt-1),!1):!0}),Ee=new Map;for(const Je of Ke)Je.forEach((_e,mt)=>{const nt=Ee.get(mt)??new Map;nt.set(_e,(nt.get(_e)??0)+1),Ee.set(mt,nt)});const bt=(Je,_e)=>{ke||Re(mt=>{var St;const nt=Math.max(2,((St=M.columns)==null?void 0:St.length)??2),pt=Array.from({length:nt},(ut,Kt)=>mt.matchingSelection[Kt]??null);if(pt[Je]=pt[Je]===_e?null:_e,pt.some(ut=>ut==null))return{...mt,matchingSelection:pt};const zt=pt.map(ut=>Number(ut)),It=de(zt),Nt=mt.matchingRows.filter(ut=>de(ut)===It).length;return(Ce.get(It)??0)>Nt?(G("correct"),P(ut=>ut+1),ge(null),{...mt,matchingRows:[...mt.matchingRows,zt],matchingSelection:new Array(nt).fill(null)}):(G("incorrect"),P(ut=>ut+1),ge("This path is not valid or has already been used."),{...mt,matchingSelection:new Array(nt).fill(null)})})};return e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:M.question||(qe==null?void 0:qe.label)}),M.title?e.jsx("p",{className:"cogita-revision-hint",children:M.title}):null,M.type==="selection"?e.jsx("div",{className:"cogita-choice-grid",style:{gridTemplateColumns:"1fr"},children:(M.options??[]).map((Je,_e)=>e.jsxs("label",{className:"cogita-field",style:{display:"flex",alignItems:"center",gap:"0.6rem"},children:[e.jsx("input",{type:"checkbox",checked:He.selection.includes(_e),disabled:ke,onChange:mt=>Re(nt=>({...nt,selection:mt.target.checked?Array.from(new Set([...nt.selection,_e])):nt.selection.filter(pt=>pt!==_e)}))}),e.jsx("span",{children:Je})]},`q-opt:${_e}`))}):null,M.type==="truefalse"?e.jsxs("div",{className:"cogita-form-actions",style:{justifyContent:"flex-start"},children:[e.jsx("button",{type:"button",className:"ghost","data-active":He.booleanAnswer===!0,disabled:ke,onClick:()=>Re(Je=>({...Je,booleanAnswer:!0})),children:"True"}),e.jsx("button",{type:"button",className:"ghost","data-active":He.booleanAnswer===!1,disabled:ke,onClick:()=>Re(Je=>({...Je,booleanAnswer:!1})),children:"False"})]}):null,M.type==="text"||M.type==="number"||M.type==="date"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:rt,type:M.type==="date"?"date":"text",value:he,onChange:Je=>Ne(Je.target.value),disabled:ke,"data-state":L==="correct"?"correct":L==="incorrect"?"incorrect":void 0})]}):null,M.type==="ordering"?e.jsx("div",{style:{display:"grid",gap:"0.45rem"},children:He.ordering.map((Je,_e)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto auto",gap:"0.5rem",alignItems:"center"},children:[e.jsxs("span",{style:{color:"rgba(184,209,234,0.75)"},children:[_e+1,"."]}),e.jsx("span",{children:Je}),e.jsx("button",{type:"button",className:"ghost",disabled:ke||_e===0,onClick:()=>Re(mt=>{const nt=[...mt.ordering];return[nt[_e-1],nt[_e]]=[nt[_e],nt[_e-1]],{...mt,ordering:nt}}),children:"Up"}),e.jsx("button",{type:"button",className:"ghost",disabled:ke||_e>=He.ordering.length-1,onClick:()=>Re(mt=>{const nt=[...mt.ordering];return[nt[_e+1],nt[_e]]=[nt[_e],nt[_e+1]],{...mt,ordering:nt}}),children:"Down"})]},`q-order:${_e}:${Je}`))}):null,M.type==="matching"?e.jsxs("div",{style:{display:"grid",gap:"0.65rem"},children:[e.jsx("div",{style:{display:"grid",gap:"0.65rem",gridTemplateColumns:`repeat(${Math.max(2,((yt=M.columns)==null?void 0:yt.length)??2)}, minmax(0, 1fr))`,alignItems:"start"},children:(M.columns??[]).map((Je,_e)=>e.jsxs("div",{className:"cogita-library-panel",style:{display:"grid",gap:"0.35rem",padding:"0.6rem"},children:[e.jsx("p",{className:"cogita-user-kicker",children:`Column ${_e+1}`}),Je.map((mt,nt)=>{var pt;return e.jsxs("button",{type:"button",className:"ghost cogita-checkcard-row",style:{textAlign:"left"},disabled:ke||ce[_e]!==nt&&(((pt=Ee.get(_e))==null?void 0:pt.get(nt))??0)<=0,"data-active":ce[_e]===nt?"true":void 0,onClick:()=>bt(_e,nt),children:[e.jsx("span",{children:mt}),e.jsx("small",{children:nt})]},`q-col:${_e}:${nt}`)})]},`q-col:${_e}`))}),e.jsxs("div",{style:{display:"grid",gap:"0.4rem"},children:[e.jsx("p",{className:"cogita-user-kicker",children:"Selected paths"}),pe.length?pe.map((Je,_e)=>e.jsxs("div",{className:"cogita-share-row",style:{alignItems:"center"},children:[e.jsx("span",{children:Je.map((mt,nt)=>{var zt,It;const pt=String(((It=(zt=M.columns)==null?void 0:zt[nt])==null?void 0:It[mt])??mt);return`${nt>0?" -> ":""}${pt}`})}),ke?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>Re(mt=>({...mt,matchingRows:mt.matchingRows.filter((nt,pt)=>pt!==_e)})),children:"Remove"})]},`q-path:${_e}`)):e.jsx("p",{className:"cogita-library-hint",children:"Choose one option in each column. After the last column is selected, the path is checked automatically."})]})]}):null,e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>void S(),disabled:ke,children:t.cogita.library.revision.checkAnswer})}),J?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),M.type==="selection"?e.jsx("p",{children:ne.length?ne.map(Je=>{var _e;return`${Je}${(_e=M.options)!=null&&_e[Je]?`: ${M.options[Je]}`:""}`}).join(", "):"-"}):M.type==="truefalse"?e.jsx("p",{children:String(!!M.answer)}):M.type==="ordering"?e.jsx("ol",{children:(M.options??[]).map((Je,_e)=>e.jsx("li",{children:Je},`ans-order:${_e}`))}):M.type==="matching"?e.jsx("div",{style:{display:"grid",gap:"0.35rem"},children:Y.length?Y.map((Je,_e)=>e.jsx("p",{children:Je.join(" → ")},`ans-path:${_e}`)):e.jsx("p",{children:"-"})}):e.jsx("p",{children:String(M.answer??"")})]}):e.jsx("div",{className:"cogita-revision-reveal",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{z(!0),E()},children:t.cogita.library.revision.showAnswer})})]})},ye=n.useMemo(()=>ee?ot(t,ee):t.cogita.library.infoTypes.any,[t,ee]);return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-info-checkcards-page",children:[e.jsxs("header",{className:"cogita-info-checkcards-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:ye}),e.jsx("h2",{className:"cogita-card-title",children:l}),e.jsx("p",{className:"cogita-card-subtitle",children:b})]}),e.jsxs("div",{className:"cogita-selection-overview",children:[e.jsx("span",{className:"cogita-tag-chip",children:`Cards: ${h.length}`}),e.jsx("span",{className:"cogita-tag-chip",children:`Dependencies: ${A.length}`}),e.jsx("button",{type:"button",className:"cta",disabled:h.length===0,onClick:()=>at(`/cogita/library/${d}/revision/run?libraryTarget=revisions&scope=info&infoId=${encodeURIComponent(b)}`),children:"Start revision"})]})]}),x==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading checkcards..."})}):x==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load checkcards."})}):e.jsxs("div",{className:"cogita-info-checkcards-layout",children:[e.jsxs("div",{className:"cogita-info-checkcards-main",children:[e.jsx("div",{className:"cogita-info-checkcards-graph",children:e.jsxs(fn,{nodes:Le,edges:tt,fitView:!0,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!0,onNodeClick:(Q,M)=>k(M.id),panOnDrag:!0,children:[e.jsx(bn,{}),e.jsx(yn,{showInteractive:!1})]})}),qe?e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[V&&q?e.jsx(Fa,{flashState:L,flashTick:D,children:V.kind==="question"?X(V):e.jsx(ss,{copy:t,currentCard:q,currentTypeLabel:"",prompt:V.kind==="citation-fragment"?null:V.prompt,languages:[],answer:he,onAnswerChange:Ne,computedExpected:[],computedAnswers:Xe,onComputedAnswerChange:(Q,M)=>it(ke=>({...ke,[Q]:M})),answerTemplate:null,outputVariables:null,variableValues:null,computedFieldFeedback:$e,feedback:L,canAdvance:!1,quoteContext:V.kind==="citation-fragment"?V.quoteContext:null,quotePlaceholder:V.kind==="citation-fragment"?V.quotePlaceholder:null,onCheckAnswer:()=>void S(),onSkip:()=>k(null),onLanguageSelect:()=>{},onMarkReviewed:()=>{},onAdvance:()=>{},showCorrectAnswer:J,setShowCorrectAnswer:z,onRevealCorrect:E,answerMask:le,expectedAnswer:V.expected,hasExpectedAnswer:!0,handleComputedKeyDown:()=>{},answerInputRef:rt,computedInputRefs:gt,scriptMode:Ve,setScriptMode:kt,matchPairs:void 0,matchLeftOrder:void 0,matchRightOrder:void 0,matchSelection:void 0,matchActiveLeft:null,matchActiveRight:null,matchFeedback:void 0,onMatchLeftSelect:void 0,onMatchRightSelect:void 0,disableCheckAnswer:p||J,hideSkipAction:!0,allowRevealBeforeCheck:!0,autoRevealAfterAnswer:!0,disableCheckAfterAnswer:!0})}):null,o?null:e.jsx("p",{className:"cogita-library-hint",children:"Result can be checked without a person; saving knowness requires a selected person in the header."}),Ge?e.jsx("p",{className:"cogita-library-hint",children:Ge}):null]}):e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[e.jsx("h4",{children:"Select a checking card"}),e.jsx("p",{className:"cogita-card-subtitle",children:"Choose a node in the dependency tree to preview and answer it."})]})]}),e.jsxs("aside",{className:"cogita-info-checkcards-panel",children:[e.jsx("h3",{children:"Checking cards"}),e.jsx("div",{className:"cogita-info-tree",children:h.map(Q=>{const M=oa(Q),ke=_===M;return e.jsxs("button",{type:"button",className:`ghost cogita-checkcard-row ${ke?"active":""}`,onClick:()=>k(M),children:[e.jsx("span",{children:Q.label}),e.jsx("small",{children:Ds(Q)})]},M)})})]})]})]})})})})})}function tn(t,a){var s,r;return((r=(s=t.fields.find(i=>i.fieldType===a))==null?void 0:s.plainValue)==null?void 0:r.trim())??""}function Bi(t){return tn(t,"role_kind").toLowerCase()==="person"}function zi(t){return tn(t,"label")||tn(t,"display_name")||tn(t,"name")||t.roleId}function Oi({copy:t,onPersonCreated:a}){const[s,r]=n.useState([]),[i,u]=n.useState("loading"),[c,y]=n.useState(null),[m,j]=n.useState(!1),[d,b]=n.useState(""),o=async()=>{u("loading");try{const h=await Xs();r(h),u("ready")}catch{r([]),u("error")}};n.useEffect(()=>{o()},[]);const l=n.useMemo(()=>s.filter(Bi).map(h=>({roleId:h.roleId,label:zi(h)})).sort((h,N)=>h.label.localeCompare(N.label)),[s]),w=async()=>{const h=d.trim();if(!h){y("Name is required.");return}j(!0),y(null);try{const N=await Mr({fields:[{fieldType:"nick",plainValue:h},{fieldType:"role_kind",plainValue:"person"},{fieldType:"label",plainValue:h},{fieldType:"display_name",plainValue:h}]});b(""),y("Person role created."),a==null||a(N.roleId),await o()}catch{y("Failed to create person role.")}finally{j(!1)}};return e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-browser-panel",children:[e.jsx("div",{className:"cogita-info-overview-head",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Cogita"}),e.jsx("h2",{className:"cogita-card-title",children:"Persons"}),e.jsx("p",{className:"cogita-card-subtitle",children:"Select reviewer persons in the header and create new person roles here."})]})}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("article",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Create"}),e.jsx("h3",{className:"cogita-detail-title",children:"New person role"})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{type:"text",value:d,onChange:h=>b(h.target.value),placeholder:"e.g. Anna Kowalska",disabled:m})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:w,disabled:m,children:m?"Creating...":"Create person"})}),c?e.jsx("p",{className:"cogita-library-hint",children:c}):null]})]}),e.jsxs("article",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Overview"}),e.jsx("h3",{className:"cogita-detail-title",children:"All person roles"})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[i==="loading"?e.jsx("p",{children:"Loading persons..."}):null,i==="error"?e.jsx("p",{children:"Failed to load persons."}):null,i==="ready"&&l.length===0?e.jsx("p",{children:"No person roles found."}):null,i==="ready"&&l.length>0?e.jsxs("div",{className:"cogita-details-grid",children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:"Name"}),e.jsx("span",{children:"Type"}),e.jsx("span",{children:"Role ID"}),e.jsx("span",{})]}),l.map(h=>e.jsxs("div",{className:"cogita-details-row",role:"row",children:[e.jsx("span",{}),e.jsx("span",{title:h.label,children:h.label}),e.jsx("span",{children:"person"}),e.jsx("span",{title:h.roleId,children:h.roleId}),e.jsx("span",{})]},h.roleId))]}):null]})]})]})]})})})})}function Vi({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,collectionId:b}){const{libraryName:o}=ua(d),[l,w]=n.useState([]),[h,N]=n.useState("loading"),[A,v]=n.useState("idle"),x=n.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Z=`/#/cogita/library/${d}`,_=()=>{N("loading"),Zs({libraryId:d}).then(T=>{w(T),N("idle")}).catch(()=>{w([]),N("error")})};n.useEffect(()=>{_()},[d]);const k=async T=>{try{await er({libraryId:d,shareId:T}),_()}catch{_()}},H=async T=>{const ee=`${x}/${T}`;try{await navigator.clipboard.writeText(ee),v("copied")}catch{v("failed")}};return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:o}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:Z,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${Z}/collections`,children:t.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[h==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):h==="error"?e.jsx("p",{children:t.cogita.library.revision.shareError}):l.filter(T=>!b||T.collectionId===b).length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:l.filter(T=>!b||T.collectionId===b).map(T=>e.jsxs("div",{className:"cogita-share-row","data-state":T.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:T.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(T.createdUtc).toLocaleString(),T.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]}),T.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${x}/${T.shareCode}`}):null]}),T.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[T.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>H(T.shareCode),children:t.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>k(T.shareId),children:t.cogita.library.revision.shareRevokeAction})]})]},T.shareId))}),A==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):A==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function qi({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d}){const{libraryName:b}=ua(d),[o,l]=n.useState(null),[w,h]=n.useState(null),[N,A]=n.useState(null),[v,x]=n.useState(null),[Z,_]=n.useState(null),[k,H]=n.useState(null),T=n.useRef(null),ee=ie=>{if(!Number.isFinite(ie))return"0 B";if(ie<1024)return`${ie} B`;const he=ie/1024;if(he<1024)return`${he.toFixed(1)} KB`;const Ne=he/1024;return Ne<1024?`${Ne.toFixed(1)} MB`:`${(Ne/1024).toFixed(1)} GB`},C=async()=>{l(null),_({loadedBytes:0,totalBytes:null,percent:null});try{l(t.cogita.library.overview.exporting);const ie=await Lr(d,_),he=URL.createObjectURL(ie),Ne=document.createElement("a");Ne.href=he,Ne.download=`cogita-library-${b||d}.json`,Ne.click(),URL.revokeObjectURL(he),l(t.cogita.library.overview.exportReady)}catch{l(t.cogita.library.overview.exportFail)}finally{_(ie=>ie??{loadedBytes:0,totalBytes:null,percent:null})}},$=async ie=>{var Ne;h(null),A(null),x(null);const he=(Ne=ie.target.files)==null?void 0:Ne[0];if(he)try{h(t.cogita.library.overview.importing),H({loadedBytes:0,totalBytes:he.size,percent:0});const Ge=await Ar(d,he,H,ge=>{const R=ge.stage==="infos"?t.cogita.library.overview.importStageInfos:ge.stage==="connections"?t.cogita.library.overview.importStageConnections:t.cogita.library.overview.importStageCollections;x(t.cogita.library.overview.importLiveProgress.replace("{stage}",R).replace("{done}",String(ge.processed)).replace("{total}",String(ge.total)).replace("{infos}",String(ge.infos)).replace("{connections}",String(ge.connections)).replace("{collections}",String(ge.collections)))});A({infos:Ge.infosImported,connections:Ge.connectionsImported,collections:Ge.collectionsImported}),h(t.cogita.library.overview.importDone)}catch(Ge){const ge=Ge instanceof as&&Ge.message?` ${Ge.message}`:"";h(`${t.cogita.library.overview.importFail}${ge}`)}finally{T.current&&(T.current.value="")}};return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:C,children:t.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[t.cogita.library.overview.import,e.jsx("input",{ref:T,type:"file",accept:"application/json",onChange:$})]})]}),Z?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:Z.percent??void 0,max:Z.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.exportProgress.replace("{loaded}",ee(Z.loadedBytes)).replace("{total}",Z.totalBytes?ee(Z.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,k?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:k.percent??void 0,max:k.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.importProgress.replace("{loaded}",ee(k.loadedBytes)).replace("{total}",k.totalBytes?ee(k.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,o?e.jsx("p",{className:"cogita-help",children:o}):null,w?e.jsx("p",{className:"cogita-help",children:w}):null,v?e.jsx("p",{className:"cogita-help",children:v}):null,N?e.jsx("p",{className:"cogita-help",children:t.cogita.library.overview.importSummary.replace("{infos}",String(N.infos)).replace("{connections}",String(N.connections)).replace("{collections}",String(N.collections))}):null]})]})})})]})})}function Ui({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d}){const{libraryName:b}=ua(d),[o,l]=n.useState(""),[w,h]=n.useState([]),N=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:o,onChange:A=>l(A.target.value),placeholder:t.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const A=o.trim();A&&(h(v=>[{id:N(),name:A},...v]),l(""))},children:t.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[w.length===0?e.jsx("p",{children:t.cogita.library.modules.storyboardsEmpty}):null,w.map(A=>e.jsx("button",{type:"button",className:"ghost",children:A.name},A.id))]})]})]})})})]})})}function Ji({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d}){const{libraryName:b}=ua(d),[o,l]=n.useState(""),[w,h]=n.useState([]),N=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:o,onChange:A=>l(A.target.value),placeholder:t.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const A=o.trim();A&&(h(v=>[{id:N(),name:A},...v]),l(""))},children:t.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[w.length===0?e.jsx("p",{children:t.cogita.library.modules.textsEmpty}):null,w.map(A=>e.jsx("button",{type:"button",className:"ghost",children:A.name},A.id))]})]})]})})})]})})}function Hi({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d}){const{libraryName:b}=ua(d),o=`/#/cogita/library/${d}`,[l,w]=n.useState(""),[h,N]=n.useState([]),[A,v]=n.useState("idle"),[x,Z]=n.useState(0),[_,k]=n.useState(null);n.useEffect(()=>{v("loading");const T=window.setTimeout(()=>{Ua({libraryId:d,query:l.trim()||void 0,limit:30}).then(ee=>{N(ee.items),Z(ee.total),k(ee.nextCursor??null),v("ready")}).catch(()=>{N([]),Z(0),k(null),v("ready")})},240);return()=>window.clearTimeout(T)},[d,l]);const H=async()=>{if(_){v("loading");try{const T=await Ua({libraryId:d,query:l.trim()||void 0,limit:30,cursor:_});N(ee=>[...ee,...T.items]),k(T.nextCursor??null),Z(T.total),v("ready")}catch{v("ready")}}};return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:b}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:o,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${o}/collections/new`,children:t.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:l,onChange:T=>w(T.target.value),placeholder:t.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:t.cogita.library.collections.countLabel.replace("{shown}",String(h.length)).replace("{total}",String(x||h.length))}),e.jsx("span",{children:A==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:h.length?h.map(T=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${o}/collections/${T.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:T.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.collections.itemCountLabel.replace("{count}",String(T.itemCount))," ·"," ",T.notes||t.cogita.library.collections.noNotes]})]})},T.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${o}/collections/new`,children:t.cogita.library.collections.emptyAction})]})}),_?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:H,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const Te=t=>`${t.cardType}:${t.cardId}:${t.checkType??""}:${t.direction??""}`,ta=(t,a,s,r)=>`${t}:${a}:${s??""}:${r??""}`;function Qi({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,collectionId:b}){ua(d);const o=`/#/cogita/library/${d}`,[l,w]=n.useState(t.cogita.library.collections.defaultName),[h,N]=n.useState(null),[A,v]=n.useState(0),[x,Z]=n.useState([]),[_,k]=n.useState("idle"),[H,T]=n.useState(null),ee=n.useMemo(()=>t.cogita.library.list.cardCount.replace("{shown}",String(x.length)).replace("{total}",String(A||x.length)),[t,x.length,A]);n.useEffect(()=>{xn(d,b).then($=>{w($.name),N($.notes??null),v($.itemCount)}).catch(()=>{w(t.cogita.library.collections.defaultName),N(null)})},[d,b]),n.useEffect(()=>{k("loading"),Ja({libraryId:d,collectionId:b,limit:40}).then($=>{Z($.items),T($.nextCursor??null),v($.total),k("ready")}).catch(()=>{Z([]),T(null),k("ready")})},[d,b]);const C=async()=>{if(H){k("loading");try{const $=await Ja({libraryId:d,collectionId:b,limit:40,cursor:H});Z(ie=>[...ie,...$.items]),T($.nextCursor??null),v($.total),k("ready")}catch{k("ready")}}};return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:h||t.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:o,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${o}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${o}/collections/${b}/graph`,children:t.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${o}/collections/${b}/revision`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ee}),e.jsx("span",{children:_==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:x.length?x.map($=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:$.cardType==="vocab"?t.cogita.library.list.cardTypeVocab:$.cardType==="connection"?t.cogita.library.list.cardTypeConnection:t.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:$.label}),e.jsx("p",{className:"cogita-card-subtitle",children:$.description})]})},Te($))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.collections.noCards})})}),H?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:C,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${o}/collections/${b}/revision`,children:t.cogita.library.actions.startRevision})})]})})]})})})]})})}const Bs=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],Wi={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Gi=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Yi=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Xi({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,onCreated:b}){const o=Ea(),{libraryName:l}=ua(d),w=`/#/cogita/library/${d}`,[h,N]=n.useState(null),[A,v]=n.useState(""),[x,Z]=n.useState(""),[_,k,H]=Gn([]),[T,ee,C]=Yn([]),[$,ie]=n.useState(null),[he,Ne]=n.useState(null),Ge=n.useRef(null),ge=n.useMemo(()=>_.find(D=>D.id===$)??null,[_,$]);n.useEffect(()=>{const D=new URLSearchParams(o.search),P=(D.get("draft")??"").trim(),J=(D.get("draftType")??"").trim();if(!P||J!=="info-selection"||Ge.current===P)return;const z=xi(d,P);if(!z||z.infoIds.length===0)return;const le=crypto.randomUUID(),xe=z.infoIds.length>1?crypto.randomUUID():null,Ie=z.infoIds.map(($e,Ve)=>({id:crypto.randomUUID(),type:"default",position:{x:80,y:80+Ve*100},data:{nodeType:"source.info",label:"Selected info",params:{infoId:$e,infoType:"any"}}})),Me=xe?[{id:xe,type:"default",position:{x:360,y:120+Math.max(0,(z.infoIds.length-1)*50)},data:{nodeType:"logic.or",label:"Selected infos",params:{}}}]:[],Xe={id:le,type:"default",position:{x:660,y:140+Math.max(0,(z.infoIds.length-1)*35)},data:{nodeType:"output.collection",label:"Collection output",params:{}}},it=Ie.map($e=>({id:crypto.randomUUID(),source:$e.id,target:xe??le}));xe&&it.push({id:crypto.randomUUID(),source:xe,target:le}),k([...Ie,...Me,Xe]),ee(it),ie(le),Ne(`Draft loaded from ${z.infoIds.length} selected infos. Set name and save to create collection.`),Ge.current=P},[d,o.search,ee,k]);const R=D=>{var le;const P=crypto.randomUUID(),J=((le=Bs.find(xe=>xe.type===D))==null?void 0:le.label)??D,z={...Wi[D]};k(xe=>[...xe,{id:P,type:"default",position:{x:120+xe.length*40,y:120+xe.length*40},data:{nodeType:D,label:J,params:z}}]),ie(P)},F=n.useCallback(D=>{ee(P=>Xn({...D,id:crypto.randomUUID()},P))},[ee]),L=D=>{ge&&k(P=>P.map(J=>J.id===ge.id?{...J,data:{...J.data,params:D}}:J))},G=async()=>{if(Ne(null),!A.trim()){Ne(t.cogita.library.collections.saveRequiredName);return}try{const D={nodes:_.map(z=>({nodeId:z.id,nodeType:z.data.nodeType,payload:{position:z.position,params:z.data.params}})),edges:T.map(z=>({edgeId:z.id,fromNodeId:z.source,fromPort:z.sourceHandle??null,toNodeId:z.target,toPort:z.targetHandle??null}))};let P=h,J=!1;if(P)await tr({libraryId:d,collectionId:P,nodes:D.nodes,edges:D.edges});else{const z=await $r({libraryId:d,name:A.trim(),notes:x.trim()||void 0,items:[],graph:D});P=z.collectionId,J=!0,N(z.collectionId)}Ne(J?t.cogita.library.collections.saveSuccess:t.cogita.library.graph.saveSuccess),b(P)}catch{Ne(h?t.cogita.library.graph.saveFail:t.cogita.library.collections.saveFail)}};return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.createKicker}),e.jsx("h1",{className:"cogita-library-title",children:l}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.createSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:w,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${w}/collections`,children:t.cogita.library.actions.collections}),e.jsx("button",{type:"button",className:"cta",onClick:G,children:t.cogita.library.actions.saveCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.collectionInfoTitle}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{value:A,onChange:D=>v(D.target.value),placeholder:t.cogita.library.collections.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.collections.notesLabel}),e.jsx("textarea",{value:x,onChange:D=>Z(D.target.value),placeholder:t.cogita.library.collections.notesPlaceholder})]}),he?e.jsx("p",{className:"cogita-help",children:he}):null,e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:Bs.map(D=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>R(D.type),children:D.label},D.type))})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(fn,{nodes:_,edges:T,onNodesChange:H,onEdgesChange:C,onConnect:F,onNodeClick:(D,P)=>ie(P.id),fitView:!0,children:[e.jsx(bn,{color:"rgba(120,160,200,0.2)"}),e.jsx(yn,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),ge?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:ge.data.label}),ge.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:d,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:ge.data.params.tagId?{id:ge.data.params.tagId,label:ge.data.params.tagLabel??"",infoType:"topic"}:null,onChange:D=>L({...ge.data.params,tagId:(D==null?void 0:D.id)??null,tagLabel:(D==null?void 0:D.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:ge.data.params.scope??"any",onChange:D=>L({...ge.data.params,scope:D.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),ge.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:d,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:ge.data.params.languageId?{id:ge.data.params.languageId,label:ge.data.params.languageLabel??"",infoType:"language"}:null,onChange:D=>L({...ge.data.params,languageId:(D==null?void 0:D.id)??null,languageLabel:(D==null?void 0:D.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:ge.data.params.scope??"any",onChange:D=>L({...ge.data.params,scope:D.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),ge.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:ge.data.params.infoType??"word",onChange:D=>L({...ge.data.params,infoType:D.target.value}),children:Yi.map(D=>e.jsx("option",{value:D.value,children:D.label},D.value))})]}),e.jsx(Xt,{libraryId:d,infoType:ge.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:ge.data.params.infoId?{id:ge.data.params.infoId,label:ge.data.params.infoLabel??"",infoType:ge.data.params.infoType??"word"}:null,onChange:D=>L({...ge.data.params,infoId:(D==null?void 0:D.id)??null,infoLabel:(D==null?void 0:D.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),ge.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:ge.data.params.connectionType??"translation",onChange:D=>L({...ge.data.params,connectionType:D.target.value}),children:Gi.map(D=>e.jsx("option",{value:D.value,children:D.label},D.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:ge.data.params.connectionId??"",onChange:D=>L({...ge.data.params,connectionId:D.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(ge.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const ca=t=>{if(!t.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const a=t.length,s=t.filter(u=>u.correct).length,r=jn(rs(t));return{score:Math.round(Math.max(0,Math.min(100,r.knowness*100))*100)/100,total:a,correct:s,lastReviewedUtc:r.lastReviewedUtc??null}},Zi=t=>{if(t.maskBase64)try{const a=Rr(t.maskBase64);if(!a.length)return t.correct?1:0;const s=a.reduce((r,i)=>r+i,0);return Math.max(0,Math.min(1,s/a.length/255))}catch{return t.correct?1:0}return t.correct?1:0},rs=t=>t.map(a=>({correctness:Zi(a),createdUtc:a.createdUtc})),jn=(t,a=Date.now())=>{var A;if(!t.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const r=t.slice().sort((v,x)=>v.createdUtc.localeCompare(x.createdUtc)).slice(-5),i=r.reduce((v,x)=>v+x.correctness,0)/r.length,u=5,c=2,y=.15;let m=0,j=0;for(let v=0;v<r.length;v+=1){const x=new Date(r[v].createdUtc).getTime(),Z=v===r.length-1?a:new Date(r[v+1].createdUtc).getTime(),_=Math.max(0,(Z-x)/(1e3*60)),k=1-Math.exp(-_/u);m+=k,r[v].correctness>.5&&(j+=y)}let d=i*m*c+j;const b=((A=r[r.length-1])==null?void 0:A.createdUtc)??null,o=b?Math.max(0,(a-new Date(b).getTime())/(1e3*60)):0,w=1/(1+Math.log1p(o/60));return d*=w,r.length===1&&r[0].correctness>.5&&(d+=5.44*Math.exp(-o/2)),{knowness:d,avgCorrectness:i,lastReviewedUtc:b}},Ha=t=>{const a=t.slice();for(let s=a.length-1;s>0;s-=1){const r=Math.floor(Math.random()*(s+1));[a[s],a[r]]=[a[r],a[s]]}return a},an=t=>t[Math.floor(Math.random()*t.length)],eo=(t,a)=>{const s=new Map;return t.forEach(r=>s.set(r,Math.random())),t.sort((r,i)=>{const u=a(r)-a(i);return u!==0?u:(s.get(r)??0)-(s.get(i)??0)})},wn=(t,a,s,r,i)=>{if(!t.length)return null;const u=t.filter(y=>!(i!=null&&i.has(Te(y))));if(u.length===0)return null;const c=u.filter(y=>Te(y)!==s);return an(c.length?c:u)},to=(t,a,s,r,i)=>{if(!t.length)return null;let u=Number.POSITIVE_INFINITY;for(const j of t){const d=Te(j);if(s.has(d))continue;const b=a[d]??1;b<u&&(u=b)}if(!Number.isFinite(u))return null;const c=t.filter(j=>{const d=Te(j);return!s.has(d)&&(a[d]??1)===u}),y=c.filter(j=>!i||Te(j)!==i),m=r?y.filter(j=>!r.has(Te(j))):y;return m.length>0?an(m):y.length>0?an(y):i&&c.some(j=>Te(j)===i)?c.find(j=>Te(j)===i)??null:c.length?an(c):null},lr=(t,a,s,r,i)=>{const u=[],c=t.filter(m=>!i.has(Te(m))&&!s.has(Te(m))&&(a[Te(m)]??0)<1),y=eo(c,m=>a[Te(m)]??0);for(const m of y){if(u.length>=r)break;u.push(m),i.add(Te(m))}if(u.length<r){const m=Ha(t.filter(j=>!i.has(Te(j))&&s.has(Te(j))));for(const j of m){if(u.length>=r)break;u.push(j),i.add(Te(j))}}return u},ao=(t,a,s,r)=>lr(t,a,s,r,new Set),is=(t,a,s,r,i,u)=>{const c=Math.max(1,s.stackSize??a),m=Ha(t).filter((w,h,N)=>N.findIndex(A=>Te(A)===Te(w))===h),j=ao(m,r,i,c),d=new Set,b=new Set,o=wn(j,{},null,d,b),l=o?[o]:[];return o&&b.add(Te(o)),{queue:l,meta:{pool:m,active:j,knownessMap:r,unknownSet:i,outcomesById:u,asked:d,queued:b}}},Wn={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:t=>t,prepare:(t,a)=>{const r=Ha(t).filter((i,u,c)=>c.findIndex(y=>Te(y)===Te(i))===u);return{queue:r.slice(0,Math.min(a,r.length)),meta:{}}},applyOutcome:t=>t},os=(t,a,s,r)=>{const i=Math.max(1,s.stackSize??a),c=Ha(t).filter((h,N,A)=>A.findIndex(v=>Te(v)===Te(h))===N),y={},m=new Set,j=new Set,d=new Set,b=Math.max(1,s.levels??1);c.forEach(h=>{const N=Te(h),A=r==null?void 0:r[N],v=typeof A=="number"&&Number.isFinite(A)?A:1;y[N]=Math.min(b,Math.max(1,Math.round(v)))});const o=[];if(c.length>0){const h=new Map;c.forEach(A=>{var x;const v=y[Te(A)]??1;h.has(v)||h.set(v,[]),(x=h.get(v))==null||x.push(A)});const N=Array.from(h.keys()).sort((A,v)=>A-v);for(const A of N){if(o.length>=i)break;const v=Ha(h.get(A)??[]);for(const x of v){if(o.length>=i)break;o.push(x)}}}const l=wn(o,y,null,m,j),w=l?[l]:[];return l&&j.add(Te(l)),{queue:w,meta:{pool:c,active:o,levelMap:y,asked:m,queued:j,wrongSinceCorrect:d}}},no={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,a)=>Math.max(1,a.stackSize??t),getProgressTotal:()=>null,prepare:(t,a,s)=>os(t,a,s),applyOutcome:(t,a,s,r,i)=>{if(!a)return t;const u=Math.max(1,r.levels??1),c=t.meta.pool??[],y=t.meta.active??[],m={...t.meta.levelMap??{}},j=new Set(t.meta.asked??[]),d=new Set(t.meta.queued??[]),b=new Set(t.meta.wrongSinceCorrect??[]),o=Te(a);d.delete(o),j.add(o);const l=m[o]??1;i.correct?(m[o]=b.has(o)?1:Math.min(l+1,u),b.delete(o)):(m[o]=1,b.add(o));const w=i.correct?y.filter(A=>Te(A)!==o):y.slice();if(i.correct&&w.length<Math.max(1,r.stackSize??1)){const A=new Set(w.map(x=>Te(x))),v=to(c,m,A,j,o);v&&w.push(v)}const h=t.queue.slice(),N=wn(w,m,o,j,d);return N&&(h.push(N),d.add(Te(N))),{queue:h,meta:{pool:c,active:w,levelMap:m,asked:j,queued:d,wrongSinceCorrect:b}}}},so={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,a)=>Math.max(1,a.stackSize??t),getProgressTotal:()=>null,prepare:(t,a,s)=>is(t,a,s,{},new Set,{}),applyOutcome:(t,a,s,r,i)=>{if(!a)return t;const u=t.meta.pool??[],c=t.meta.active??[],y={...t.meta.knownessMap??{}},m=new Set(t.meta.unknownSet??[]),j={...t.meta.outcomesById??{}},d=new Set(t.meta.asked??[]),b=new Set(t.meta.queued??[]),o=Te(a);b.delete(o),d.add(o);const l={correctness:Math.max(0,Math.min(1,i.correctness??(i.correct?1:0))),createdUtc:i.createdUtc??new Date().toISOString()},h=(j[o]??[]).concat(l).sort((_,k)=>_.createdUtc.localeCompare(k.createdUtc)).slice(-5);j[o]=h,m.delete(o);const N=Date.now();u.forEach(_=>{const k=Te(_),H=j[k]??[];if(H.length===0){y[k]=0,m.add(k);return}const T=jn(H,N);y[k]=T.knowness});const A=c.slice();if((y[o]??0)>=1){const _=A.filter(k=>Te(k)!==o);A.length=0,A.push(..._)}const x=Math.max(1,r.stackSize??s);if(A.length<x){const _=new Set(A.map(H=>Te(H))),k=lr(u,y,m,x-A.length,_);A.push(...k)}const Z=t.queue.slice();if(Z.length===0||Te(Z[Z.length-1])===o){const _=wn(A,{},o,d,b);_&&(Z.push(_),b.add(Te(_)))}return{queue:Z,meta:{pool:u,active:A,knownessMap:y,unknownSet:m,outcomesById:j,asked:d,queued:b}}}},cr={random:Wn,levels:no,temporal:so},ro=Object.values(cr),ls=t=>{if(!t)return Wn;const a=t.trim().toLowerCase();return a==="random"||a==="levels"||a==="temporal"?cr[a]:Wn},kn=(t,a)=>{const s={...t.defaultSettings};return a&&Object.entries(a).forEach(([r,i])=>{typeof i=="number"&&Number.isFinite(i)&&(s[r]=i),typeof i=="string"&&(s[r]=i)}),t.settingsFields.forEach(r=>{var u;const i=s[r.key];if(r.type==="number"){if(typeof i!="number"||Number.isNaN(i)){s[r.key]=t.defaultSettings[r.key]??0;return}r.min!==void 0&&(s[r.key]=Math.max(r.min,s[r.key])),r.max!==void 0&&(s[r.key]=Math.min(r.max,s[r.key]));return}if(r.type==="select"){const c=((u=r.options)==null?void 0:u.map(y=>y.value))??[];(typeof i!="string"||c.length>0&&!c.includes(i))&&(s[r.key]=t.defaultSettings[r.key]??c[0]??"")}}),s},dr=(t,a)=>{const s={};return t.settingsFields.forEach(r=>{const i=a.get(r.key);if(i){if(r.type==="number"){const u=Number(i);Number.isNaN(u)||(s[r.key]=u);return}s[r.key]=i}}),kn(t,s)},io=(t,a)=>{const s=new URLSearchParams;return t.settingsFields.forEach(r=>{const i=a[r.key];(typeof i=="number"||typeof i=="string")&&s.set(r.key,String(i))}),s};function zs({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,collectionId:b,revisionId:o}){const l=Qa(),{libraryName:w}=ua(d),h=`/#/cogita/library/${d}`,[N,A]=n.useState(t.cogita.library.collections.defaultName),[v,x]=n.useState([]),[Z,_]=n.useState(b??""),[k,H]=n.useState(""),[T,ee]=n.useState(20),[C,$]=n.useState("random"),[ie,he]=n.useState({}),[Ne,Ge]=n.useState("exact"),[ge,R]=n.useState([]),[F,L]=n.useState(null),[G,D]=n.useState([]),[P,J]=n.useState([]),[z,le]=n.useState(""),[xe,Ie]=n.useState("idle"),[Me,Xe]=n.useState(null),[it,$e]=n.useState("idle"),[Ve,kt]=n.useState("idle"),[He,Re]=n.useState("idle"),rt=n.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),gt=n.useMemo(()=>ls(C),[C]),at=n.useMemo(()=>kn(gt,ie),[gt,ie]),Le=n.useMemo(()=>io(gt,at).toString(),[gt,at]),Ue=n.useMemo(()=>{const p=z.trim().toLocaleLowerCase();return p?P.filter(S=>S.name.toLocaleLowerCase().includes(p)):P},[z,P]);n.useEffect(()=>{_(b??"")},[b]),n.useEffect(()=>{if(!Z){A(t.cogita.library.collections.defaultName);return}xn(d,Z).then(p=>A(p.name)).catch(()=>A(t.cogita.library.collections.defaultName))},[t.cogita.library.collections.defaultName,d,Z]),n.useEffect(()=>{Ua({libraryId:d,limit:200}).then(p=>x(p.items.map(S=>({collectionId:S.collectionId,name:S.name})))).catch(()=>x([]))},[d]),n.useEffect(()=>{Zn({libraryId:d}).then(p=>J(p)).catch(()=>J([]))},[d]),n.useEffect(()=>{o&&ns({libraryId:d,revisionId:o}).then(p=>{_(p.collectionId),H(p.name),$(p.mode||"random"),Ge(p.check||"exact"),ee(p.limit||20),he(p.revisionSettings??{})}).catch(()=>{H("")})},[d,o]),n.useEffect(()=>{ar({libraryId:d}).then(p=>{R(p),!F&&p.length>0&&L(p[0].roleId)}).catch(()=>{R([])})},[d]);const tt=()=>{kt("loading"),Zs({libraryId:d}).then(p=>{D(p),kt("idle")}).catch(()=>{D([]),kt("error")})};n.useEffect(()=>{tt()},[d]);const qe=async()=>{Ie("working"),$e("idle");try{if(!Z){Ie("error");return}const p=await Er({libraryId:d,collectionId:Z,revisionType:gt.id,revisionSettings:at,mode:C,check:Ne,limit:T});Xe(`${rt}/${p.shareCode}${Le?`?${Le}`:""}`),Ie("ready"),tt()}catch{Ie("error")}},V=async()=>{if(o){Re("saving");try{await Pr({libraryId:d,collectionId:b??Z,revisionId:o,targetCollectionId:Z,name:k||N,revisionType:gt.id,revisionSettings:at,mode:C,check:Ne,limit:T}),Re("saved"),Z&&l(`/cogita/library/${d}/revisions/${encodeURIComponent(o)}`,{replace:!0})}catch{Re("error")}}},te=async()=>{if(Me)try{await navigator.clipboard.writeText(Me),$e("copied")}catch{$e("failed")}},be=async p=>{try{await er({libraryId:d,shareId:p}),tt()}catch{tt()}};return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:N}),e.jsx("p",{className:"cogita-library-subtitle",children:w})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:h,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${h}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:Z?`${h}/collections/${Z}`:`${h}/collections`,children:t.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${h}${o?`/revisions/${encodeURIComponent(o)}/run`:Z?`/collections/${Z}/revision/run`:"/revision/run"}?mode=${encodeURIComponent(C)}&check=${encodeURIComponent(Ne)}&limit=${T}${Le?`&${Le}`:""}${F?`&reviewer=${encodeURIComponent(F)}`:""}${o?`&revisionId=${encodeURIComponent(o)}`:""}`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:z,onChange:p=>le(p.target.value),placeholder:t.cogita.workspace.revisionForm.namePlaceholder})}),e.jsxs("div",{className:"cogita-card-list","data-view":"list",children:[e.jsxs("a",{className:"cogita-card-select",href:`${h}/revisions/new`,style:{display:"block"},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.workspace.layers.revision}),e.jsx("h3",{className:"cogita-card-title",children:t.cogita.workspace.revisionForm.createAction})]}),Ue.map(p=>e.jsxs("a",{className:"cogita-card-select",href:`${h}/revisions/${encodeURIComponent(p.revisionId)}`,style:{display:"block"},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.workspace.layers.revision}),e.jsx("h3",{className:"cogita-card-title",children:p.name})]},p.revisionId))]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.actions.collections}),e.jsx("select",{value:Z,onChange:p=>_(p.target.value),children:v.map(p=>e.jsx("option",{value:p.collectionId,children:p.name},p.collectionId))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:k,onChange:p=>H(p.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsx("select",{value:C,onChange:p=>$(p.target.value),children:ro.map(p=>e.jsx("option",{value:p.id,children:t.cogita.library.revision[p.labelKey]},p.id))})]}),gt.settingsFields.map(p=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision[p.labelKey]}),p.type==="select"?e.jsx("select",{value:String(at[p.key]??""),onChange:S=>he(E=>({...E,[p.key]:S.target.value})),children:(p.options??[]).map(S=>e.jsx("option",{value:S.value,children:t.cogita.library.revision[S.labelKey]},S.value))}):e.jsx("input",{type:"number",min:p.min,max:p.max,step:p.step,value:at[p.key]??0,onChange:S=>he(E=>({...E,[p.key]:Number(S.target.value||0)}))})]},p.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.checkLabel}),e.jsx("input",{value:t.cogita.library.revision.checkValue,disabled:!0})]}),gt.id!=="levels"&&gt.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:T,onChange:p=>ee(Number(p.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:F??"",onChange:p=>L(p.target.value||null),children:ge.map(p=>e.jsx("option",{value:p.roleId,children:p.label},p.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.previewBody1}),e.jsx("p",{children:t.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[o?e.jsx("button",{type:"button",className:"cta ghost",onClick:V,disabled:He==="saving",children:He==="saving"?"...":t.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${h}${o?`/revisions/${encodeURIComponent(o)}/run`:Z?`/collections/${Z}/revision/run`:"/revision/run"}?mode=${encodeURIComponent(C)}&check=${encodeURIComponent(Ne)}&limit=${T}${Le?`&${Le}`:""}${F?`&reviewer=${encodeURIComponent(F)}`:""}${o?`&revisionId=${encodeURIComponent(o)}`:""}`,children:t.cogita.library.actions.startRevision}),o?e.jsx("a",{className:"cta ghost",href:`/#/cogita/live-revision-host/${encodeURIComponent(d)}/${encodeURIComponent(o)}`,children:"Live session"}):null,e.jsx("a",{className:"cta ghost",href:`/#/cogita/live-sessions/${encodeURIComponent(d)}`,children:"Active live sessions"})]}),He==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.shareBody}),Me?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:Me,readOnly:!0})]}):null,xe==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareError}):null,it==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):it==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:qe,disabled:xe==="working",children:xe==="working"?t.cogita.library.revision.shareWorking:t.cogita.library.revision.shareAction}),Me?e.jsx("button",{type:"button",className:"cta ghost",onClick:te,children:t.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),Ve==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):G.length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:G.map(p=>e.jsxs("div",{className:"cogita-share-row","data-state":p.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:p.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(p.createdUtc).toLocaleString(),p.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]})]}),p.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>be(p.shareId),children:t.cogita.library.revision.shareRevokeAction})]},p.shareId))})]})]})]})]})})})]})})}const _n=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function ur(t,a,s){if(!t)return null;const r=new Map(t.nodes.map(_=>[_.id,_])),i=new Map,u=new Set,c=_=>{if(typeof _=="number")return _;if(typeof _=="string"){const k=Number(_);return Number.isFinite(k)?k:0}return 0},y=_=>{if(i.has(_))return i.get(_);if(u.has(_))return 0;const k=r.get(_);if(!k)return 0;u.add(_);const H=ee=>{var $,ie;return(ee?(($=k.inputsByHandle)==null?void 0:$[ee])??[]:k.inputs??((ie=k.inputsByHandle)==null?void 0:ie.in)??[]).map(he=>y(he))};let T=0;switch(k.type){case"input.random":{const ee=k.min??0,C=k.max??ee+10,$=Math.min(ee,C),ie=Math.max(ee,C);T=Math.floor(Math.random()*(ie-$+1))+$;break}case"input.const":{T=k.value??0;break}case"input.list":{const ee=(k.list??[]).filter(Boolean),C=Math.round(c(H("index")[0]));T=ee.length?ee[Math.max(0,Math.min(ee.length-1,C))]:String(C);break}case"compute.add":{T=H("in").map(C=>c(C)).reduce((C,$)=>C+$,0);break}case"compute.sub":{const ee=H("add").map($=>c($)),C=H("sub").map($=>c($));T=ee.reduce(($,ie)=>$+ie,0)-C.reduce(($,ie)=>$+ie,0);break}case"compute.mul":{const ee=H("in").map(C=>c(C));T=ee.length?ee.reduce((C,$)=>C*$,1):0;break}case"compute.div":{const ee=c(H("num")[0]),C=H("den").map($=>c($)).reduce(($,ie)=>$+ie,0);T=Math.abs(C)<Number.EPSILON?0:ee/C;break}case"compute.pow":{const ee=c(H("base")[0]),C=c(H("exp")[0]);T=Math.pow(ee,C);break}case"compute.exp":{const ee=c(H("base")[0]),C=c(H("exp")[0]);T=Math.pow(ee,C);break}case"compute.log":{const ee=c(H("value")[0]),C=c(H("base")[0]),$=Math.max(ee,Number.EPSILON);T=Math.abs(C)<Number.EPSILON?Math.log($):Math.log($)/Math.log(C);break}case"compute.abs":{T=Math.abs(c(H("in")[0]));break}case"compute.min":{const ee=H("in").map(C=>c(C));T=ee.length?Math.min(...ee):0;break}case"compute.max":{const ee=H("in").map(C=>c(C));T=ee.length?Math.max(...ee):0;break}case"compute.floor":{T=Math.floor(c(H("in")[0]));break}case"compute.ceil":{T=Math.ceil(c(H("in")[0]));break}case"compute.round":{T=Math.round(c(H("in")[0]));break}case"compute.mod":{const ee=c(H("a")[0]),C=c(H("b")[0]);T=Math.abs(C)<Number.EPSILON?0:ee%C;break}case"compute.concat":{const C=["in1","in2","in3","in4","in5","in6"].flatMap(Ne=>H(Ne)),$=C.length?C:H("in");T=($.length?$:H()).map(Ne=>Ne==null?"":String(Ne)).join("");break}case"compute.trim":{const ee=H("text")[0]??H("in")[0]??"",C=ee==null?"":String(ee),$=Math.max(0,Math.round(c(H("start")[0]))),ie=Math.max(0,Math.round(c(H("end")[0])));$+ie>=C.length?T="":T=C.substring($,C.length-ie);break}case"output":{T=H("in")[0]??0;break}default:T=0}return u.delete(_),i.set(_,T),T},m=t.outputs&&t.outputs.length>0?t.outputs:t.output?[t.output]:t.nodes.filter(_=>_.type==="output").map(_=>_.id);t.nodes.forEach(_=>y(_.id)),m.forEach(_=>y(_));const j=_=>Math.abs(_%1)<1e-5?String(Math.round(_)):_.toFixed(3).replace(/\.?0+$/,""),d=_=>typeof _=="number"?j(_):_??"",b=new Map;m.forEach(_=>{var C,$,ie,he;const k=r.get(_);if(!k)return;const H=($=(C=k.inputsByHandle)==null?void 0:C.name)==null?void 0:$[0],T=H?d(i.get(H)):"",ee=(T==null?void 0:T.toString().trim())||((ie=k.outputLabel)==null?void 0:ie.trim())||((he=k.name)==null?void 0:he.trim())||_;b.set(_,ee)});const o={},l={},w={};m.forEach(_=>{var T,ee;const k=r.get(_);if(!k)return;const H=b.get(_)??(((T=k.outputLabel)==null?void 0:T.trim())||((ee=k.name)==null?void 0:ee.trim())||_);o[H]=d(i.get(_)),k.name&&(l[k.name.trim()]=H),l[_]=H});const h=(_,k)=>{let H=_;return t.nodes.forEach(T=>{var he,Ne;const ee=d(i.get(T.id)),C=m.includes(T.id),$=C?b.get(T.id)??((he=T.outputLabel)==null?void 0:he.trim())??((Ne=T.name)==null?void 0:Ne.trim())??T.id:"",ie=C&&k?$:ee;H=H.replace(new RegExp(`\\{\\s*${_n(T.id)}\\s*\\}`,"gi"),ie),T.name&&(H=H.replace(new RegExp(`\\{\\s*${_n(T.name)}\\s*\\}`,"gi"),ie)),C&&T.outputLabel&&(H=H.replace(new RegExp(`\\{\\s*${_n(T.outputLabel)}\\s*\\}`,"gi"),$))}),H},N=a;let A=N.trim().length>0?N:"";A||(A=m.length?`Compute ${m.join(", ")}`:"Compute"),A=h(A,!0);const v=(s==null?void 0:s.trim())??"",x=v?h(v,!1):"",Z={};return i.forEach((_,k)=>{Z[k]=_,w[k]=d(_);const H=r.get(k);H!=null&&H.name&&(w[H.name.trim()]=d(_))}),{prompt:A,answers:o,values:Z,answerText:x,outputVariables:l,variableValues:w}}function hr(t){var s;const a=Object.entries(t.answers);return{prompt:t.prompt,expectedAnswer:t.answerText??((s=a[0])==null?void 0:s[1])??"",expectedAnswers:t.answers,values:t.values,expectedAnswerIsSentence:!!(t.answerText&&t.answerText.trim().length>0),outputVariables:t.outputVariables,variableValues:t.variableValues}}const Dn=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function gr({outcomes:t}){const[a,s]=n.useState("day"),r=n.useMemo(()=>{const i=Dn.find(y=>y.id===a)??Dn[1],u=Date.now()-i.ms,c=t.filter(y=>new Date(y.createdUtc).getTime()>=u);return ca(c)},[t,a]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:Dn.map(i=>e.jsx("button",{type:"button",className:"ghost","data-active":a===i.id,onClick:()=>s(i.id),children:i.label},i.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[r.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[r.correct," / ",r.total]})]})}const oo="cogita-revision",lo=1,cn="outcomes",co=()=>new Promise((t,a)=>{const s=indexedDB.open(oo,lo);s.onupgradeneeded=()=>{const r=s.result;if(!r.objectStoreNames.contains(cn)){const i=r.createObjectStore(cn,{keyPath:"id"});i.createIndex("byItem","itemKey",{unique:!1}),i.createIndex("byPending","pending",{unique:!1})}},s.onerror=()=>a(s.error),s.onsuccess=()=>t(s.result)}),Wa=async(t,a)=>{const s=await co();return new Promise((r,i)=>{const u=s.transaction(cn,t),c=u.objectStore(cn);a(c).then(r).catch(i),u.onerror=()=>i(u.error)})},mr=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const t=new Uint8Array(16);crypto.getRandomValues(t);const a=Array.from(t).map(s=>s.toString(16).padStart(2,"0"));return`${a.slice(0,4).join("")}-${a.slice(4,6).join("")}-${a.slice(6,8).join("")}-${a.slice(8,10).join("")}-${a.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},uo=()=>{const t="cogita_revision_client_id",a=localStorage.getItem(t);if(a)return a;const s=mr();return localStorage.setItem(t,s),s},ho=()=>{const t="cogita_revision_client_seq",a=Number(localStorage.getItem(t)??"0"),s=Number.isFinite(a)?a+1:1;return localStorage.setItem(t,String(s)),s},pr=(t,a,s,r)=>ta(t,a,s,r),dn=async t=>{const a=uo(),s=ho(),r=new Date().toISOString(),i={...t,clientId:a,clientSequence:s,createdUtc:r,id:mr(),pending:!0};return await Wa("readwrite",u=>new Promise((c,y)=>{const m={...i,itemKey:pr(i.itemType,i.itemId,i.checkType,i.direction)},j=u.add(m);j.onsuccess=()=>c(),j.onerror=()=>y(j.error)})),i},un=async(t,a,s,r)=>{if(!a)return[];try{const i=pr(t,a,s,r);return await Wa("readonly",u=>new Promise((c,y)=>{const j=u.index("byItem").getAll(i);j.onsuccess=()=>{const b=(j.result??[]).map(o=>({itemType:o.itemType,itemId:o.itemId,checkType:o.checkType??null,direction:o.direction??null,revisionType:o.revisionType,evalType:o.evalType,correct:o.correct,createdUtc:o.createdUtc,maskBase64:o.maskBase64,payloadBase64:o.payloadBase64,payloadHashBase64:o.payloadHashBase64,clientId:o.clientId,clientSequence:o.clientSequence,personRoleId:o.personRoleId??null})).sort((o,l)=>o.createdUtc.localeCompare(l.createdUtc));c(b)},j.onerror=()=>y(j.error)}))}catch{return[]}},da=async()=>{try{return await Wa("readonly",t=>new Promise((a,s)=>{const r=t.getAll();r.onsuccess=()=>{const u=(r.result??[]).map(c=>({itemType:c.itemType,itemId:c.itemId,checkType:c.checkType??null,direction:c.direction??null,revisionType:c.revisionType,evalType:c.evalType,correct:c.correct,createdUtc:c.createdUtc,maskBase64:c.maskBase64,payloadBase64:c.payloadBase64,payloadHashBase64:c.payloadHashBase64,clientId:c.clientId,clientSequence:c.clientSequence,personRoleId:c.personRoleId??null}));a(u)},r.onerror=()=>s(r.error)}))}catch{return[]}},go=async(t=100)=>{try{return await Wa("readonly",a=>new Promise((s,r)=>{const u=a.index("byPending").getAll(!0);u.onsuccess=()=>{const c=u.result??[];s(c.slice(0,t))},u.onerror=()=>r(u.error)}))}catch{return[]}},mo=async t=>{if(t.length!==0)try{await Wa("readwrite",a=>new Promise((s,r)=>{let i=t.length;t.forEach(u=>{const c=a.get(u);c.onsuccess=()=>{const y=c.result;if(y){y.pending=!1;const m=a.put(y);m.onsuccess=()=>{i-=1,i===0&&s()},m.onerror=()=>r(m.error)}else i-=1,i===0&&s()},c.onerror=()=>r(c.error)})}))}catch{}},Bn=async(t,a)=>{const s=await go(200);if(s.length===0)return;const r=new Map;s.forEach(i=>{var c;const u=i.personRoleId??a??"";r.has(u)||r.set(u,[]),(c=r.get(u))==null||c.push(i)});for(const[i,u]of r.entries()){const c=u.map(y=>({itemType:y.itemType,itemId:y.itemId,checkType:y.checkType??null,direction:y.direction??null,revisionType:y.revisionType,evalType:y.evalType,correct:y.correct,clientId:y.clientId,clientSequence:y.clientSequence,maskBase64:y.maskBase64??null,payloadHashBase64:y.payloadHashBase64??null,payloadBase64:y.payloadBase64??null,personRoleId:i||null}));try{await Fr({libraryId:t,outcomes:c}),await mo(u.map(y=>y.id))}catch{}}},Bt=t=>t.trim().toLowerCase(),fr=t=>{if(typeof t!="string")return"";const a=t.trim().toLowerCase();return a==="single_select"||a==="multi_select"?"selection":a==="boolean"||a==="true_false"?"truefalse":a==="order"?"ordering":a==="short"||a==="open"||a==="short_text"?"text":a==="selection"||a==="truefalse"||a==="text"||a==="number"||a==="date"||a==="ordering"||a==="matching"?a:""},Wt=t=>{const a=t==null?void 0:t.trim();return a?{fragmentId:a}:null},hn=(t,a)=>{const s=Wt(a);if(!s)return!0;const r=Wt(t);return(r==null?void 0:r.fragmentId)===s.fragmentId},Lt=t=>{const a=t==null?void 0:t.trim().toLowerCase();return a||null},br=(t,a)=>{if((Lt(t.childItemType)??"info")!==(a.cardType??"").toLowerCase()||t.childItemId!==a.cardId)return!1;const r=Lt(t.childCheckType),i=Lt(t.childDirection),u=Lt(a.checkType),c=Lt(a.direction);return!(r&&r!==u||i&&i!==c)},po={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},fo={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},gn=(t,a,s)=>{if(!s||!a.startsWith(t))return a;const r=a.slice(t.length);if(!r)return a;const i=s==="super"?po:fo,u=r.split("").map(c=>i[c]??c).join("");return t+u},mn=(t,a,s)=>{var c,y,m;if(!t)return((c=a[0])==null?void 0:c.key)??null;const r=new Set(a.map(j=>j.key)),i=/\{([^}]+)\}/g;let u;for(;(u=i.exec(t))!==null;){const j=((y=u[1])==null?void 0:y.trim())??"";if(!j)continue;if(r.has(j))return j;const d=s==null?void 0:s[j];if(d&&r.has(d))return d}return((m=a[0])==null?void 0:m.key)??null},qa=t=>(()=>{const a=new Set;return t.flatMap(s=>{if(s.cardType!=="info"||s.infoType!=="citation")return[s];const r=s.description??"";if(!r.trim())return[s];const i=va(r),u=Object.keys(i.nodes);return u.length===0?[s]:u.map(c=>({...s,checkType:"quote-fragment",direction:c})).filter(c=>{const y=[c.cardId,c.checkType??"",c.direction??""].join("|");return a.has(y)?!1:(a.add(y),!0)})})})();function zn({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,collectionId:b,revisionId:o}){const l=Ea(),w=`/#/cogita/library/${d}`,h=n.useMemo(()=>new URLSearchParams(l.search),[l.search]),N=Math.max(1,Number(h.get("limit")??20)),A=h.get("mode")??"random",v=n.useMemo(()=>ls(A),[A]),x=n.useMemo(()=>kn(v,dr(v,h)),[v,h]),Z=h.get("check")??"exact",_=h.get("reviewer"),k=(h.get("scope")??"").trim(),H=k==="info"||k==="info-selection"?k:"collection",T=H==="info"?(h.get("infoId")??"").trim():"",ee=H==="info-selection"?(h.get("seed")??"").trim():"",[C,$]=n.useState(null),ie=b??C??void 0,he=H==="collection"&&!!ie,Ne=n.useMemo(()=>t.cogita.library.revision[v.labelKey]??A,[t,A,v]),Ge=n.useMemo(()=>Z==="exact"?t.cogita.library.revision.checkValue:Z,[t,Z]),[ge,R]=n.useState(t.cogita.library.collections.defaultName),[F,L]=n.useState([]),[G,D]=n.useState([]),[P,J]=n.useState("idle"),[z,le]=n.useState({current:0,total:0}),[xe,Ie]=n.useState(0),[Me,Xe]=n.useState(""),[it,$e]=n.useState(null),[Ve,kt]=n.useState(null),[He,Re]=n.useState(null),[rt,gt]=n.useState(null),[at,Le]=n.useState([]),[Ue,tt]=n.useState({}),[qe,V]=n.useState({}),[te,be]=n.useState(null),[p,S]=n.useState(null),[E,q]=n.useState(null),[X,ye]=n.useState(null),[Q,M]=n.useState(null),[ke,ne]=n.useState({}),Y=n.useRef(0),[W,pe]=n.useState(null),ce=n.useRef(null),de=n.useRef(null),[Ce,Be]=n.useState(null),[Ke,Ee]=n.useState(!1),[bt,dt]=n.useState(null),[yt,Je]=n.useState([]),[_e,mt]=n.useState(null),nt=n.useRef(null),pt=n.useRef(null),[zt,It]=n.useState(null),[Nt,Mt]=n.useState(0),St=n.useRef(null),ut=n.useRef({}),[Kt,lt]=n.useState(!1),[Ye,Tt]=n.useState({}),[Gt,qt]=n.useState([]),Ot=n.useRef(new Map),[me,Et]=n.useState(new Set),[Zt,Ut]=n.useState(!1),B=n.useRef(null),g=n.useRef(new Set),se=n.useRef({});n.useEffect(()=>{if(!o||b){$(null);return}ns({libraryId:d,revisionId:o}).then(f=>$(f.collectionId)).catch(()=>$(null))},[b,d,o]);const U=F[xe]??null,et=(U==null?void 0:U.checkType)==="translation-match"&&Q,ht=n.useRef(new Map),ft=n.useRef(new Map),$t=n.useRef(new Map),At=n.useRef(new Map),Ct=n.useMemo(()=>U?U.cardType==="vocab"?t.cogita.library.revision.vocabLabel:U.infoType?ot(t,U.infoType):t.cogita.library.revision.infoLabel:"",[t,U]),Pt=n.useMemo(()=>{var I;return v.id!=="levels"?F.length:((I=Ye.pool)==null?void 0:I.length)??v.getFetchLimit(N,x)},[Ye,x,v,F.length,N]),ha=v.getProgressTotal?v.getProgressTotal(F,Ye,N,x):v.id==="levels"?Math.min(N,Pt):F.length,ma=ha?Math.min(xe+1,ha):0,_t=Math.max(1,Number(x.tries??1)),na=x.compare??"anchors",Ta=Math.max(0,Math.min(100,Number(x.minCorrectness??0))),vt=(x.considerDependencies??"on")==="on",Dt=Math.max(0,Math.min(100,Number(x.dependencyThreshold??85))),ea=f=>{const I=f.slice();for(let O=I.length-1;O>0;O-=1){const ue=Math.floor(Math.random()*(O+1));[I[O],I[ue]]=[I[ue],I[O]]}return I},ja=f=>xa(f,{treatSimilarCharsAsSame:!0})>=Ta,Ga=async()=>{const f=await da(),I=new Map,O=new Map,ue=new Map;f.forEach(ae=>{const Se=`${ae.itemType}:${ae.itemId}`,Oe=ta(ae.itemType,ae.itemId,ae.checkType,ae.direction);if(I.has(Se)||I.set(Se,[]),I.get(Se).push(ae),O.has(Oe)||O.set(Oe,[]),O.get(Oe).push(ae),ae.itemType==="info"&&ae.checkType==="quote-fragment"&&ae.direction){const Qe=`${ae.itemId}:${ae.direction}`;ue.has(Qe)||ue.set(Qe,[]),ue.get(Qe).push(ae)}});const fe=new Map,re=new Map,ve=new Map;return I.forEach((ae,Se)=>fe.set(Se,ca(ae).score)),O.forEach((ae,Se)=>re.set(Se,ca(ae).score)),ue.forEach((ae,Se)=>ve.set(Se,ca(ae).score)),{itemKnowness:fe,cardKnowness:re,fragmentKnowness:ve}},Yt=async f=>{const I=[];let O=null;for(;;){const ue=await Ja({libraryId:d,collectionId:f,limit:200,cursor:O});if(I.push(...ue.items),!ue.nextCursor)break;O=ue.nextCursor}return qa(I)},Ca=async(f,I)=>{if(Ot.current.has(f))return Ot.current.get(f)??0;const O=await Yt(f);if(O.length===0)return Ot.current.set(f,0),0;const fe=O.reduce((re,ve)=>{const ae=Te(ve);return re+(I.get(ae)??0)},0)/O.length;return Ot.current.set(f,fe),fe},Ia=(f,I)=>{if(!vt||f.cardType!=="info"||f.infoType!=="citation"||f.checkType!=="quote-fragment")return!0;const O=Wt(f.direction);if(!(O!=null&&O.fragmentId))return!0;const ue=f.description??"";if(!ue.trim())return!0;const re=va(ue).nodes[O.fragmentId];if(!re||!re.leftId&&!re.rightId)return!0;const ve=[re.leftId,re.rightId].filter(Oe=>!!Oe);if(ve.length===0)return!0;const ae=ve.map(Oe=>{const Qe=ta("info",f.cardId,"quote-fragment",Oe);return I.get(Qe)??0});return ae.reduce((Oe,Qe)=>Oe+Qe,0)/ae.length>=Dt},Ka=async f=>{const I=Ye,O=f.concat(I.active??[]).concat(I.pool??[]).filter((ae,Se,Oe)=>Oe.findIndex(Qe=>Te(Qe)===Te(ae))===Se);if(!vt){Et(new Set(O.map(Te)));return}const{itemKnowness:ue,cardKnowness:fe}=await Ga(),re=Gt.filter(ae=>Lt(ae.childItemType)==="collection"&&ae.childItemId===b&&!Lt(ae.childCheckType)&&!Lt(ae.childDirection)),ve=new Set;for(const ae of O){if(ae.cardType!=="info"){ve.add(Te(ae));continue}if(!Ia(ae,fe))continue;const Se=Gt.filter(We=>br(We,ae)).concat(re);if(Se.length===0){ve.add(Te(ae));continue}let Oe=0;for(const We of Se)if(Lt(We.parentItemType)==="collection")Oe+=await Ca(We.parentItemId,fe);else if(Lt(We.parentCheckType)||Lt(We.parentDirection)){const st=Lt(We.parentCheckType),ct=Lt(We.parentDirection),xt=ta(We.parentItemType,We.parentItemId,st,ct);Oe+=fe.get(xt)??0}else{const st=`${We.parentItemType}:${We.parentItemId}`;Oe+=ue.get(st)??0}Oe/Se.length>=Dt&&ve.add(Te(ae))}Et(ve)},Ya=f=>{for(let I=f;I<F.length;I+=1){const O=F[I];if(O&&(!vt||O.cardType!=="info"||me.has(Te(O))))return I}return-1},_a=f=>!vt||f.cardType!=="info"||me.has(Te(f)),Nn=f=>{if(v.id!=="temporal"&&v.id!=="levels")return null;const I=Ye,O=(I.active??[]).concat(I.pool??[]),ue=new Set;for(const fe of O){const re=Te(fe);if(!(ue.has(re)||f.has(re))&&(ue.add(re),_a(fe)))return fe}return null},Jt=n.useMemo(()=>{if(v.id!=="levels")return null;const f=Ye,I=f.pool??[],O=f.active??[],ue=f.levelMap??{},fe=Math.max(1,Number(x.levels??1)),re=Array.from({length:fe},()=>0),ve=new Set(O.map(Qe=>Te(Qe)));I.forEach(Qe=>{const We=Math.min(fe,Math.max(1,ue[Te(Qe)]??1));re[We-1]+=1});const ae=I.length||1,Se=re.map(Qe=>Qe/ae*100),Oe=U?ue[Te(U)]??1:null;return{counts:re,percentages:Se,currentLevel:Oe,levelsCount:fe,activeCount:O.length,poolCount:I.length,activeSet:ve}},[Ye,x,v,U]),Ht=n.useMemo(()=>{if(v.id!=="temporal")return null;const f=Ye,I=f.pool??[],O=f.active??[],ue=f.knownessMap??{},fe=new Set(f.unknownSet??[]);let re=0;I.forEach(Se=>{(ue[Te(Se)]??0)>1&&(re+=1)});const ve=fe.size,ae=O.map(Se=>({id:Te(Se),value:fe.has(Te(Se))?0:Math.max(0,Math.min(1,ue[Te(Se)]??0))}));return{knownCount:re,unknownCount:ve,dots:ae}},[Ye,v]),Sn=n.useMemo(()=>{if(!vt)return 0;const f=Ye;return F.concat(f.active??[]).concat(f.pool??[]).filter((O,ue,fe)=>fe.findIndex(re=>Te(re)===Te(O))===ue).filter(O=>O.cardType==="info"&&!me.has(Te(O))).length},[vt,Ye,F,me]);n.useEffect(()=>{if(!vt||P!=="ready")return;const f=Ye,O=F.concat(f.active??[]).concat(f.pool??[]).filter((re,ve,ae)=>ae.findIndex(Se=>Te(Se)===Te(re))===ve).filter(re=>re.cardType!=="info"||me.has(Te(re))).length,ue=nt.current;if(nt.current=O,ue===null||O<=ue)return;const fe=O-ue;mt(`New card available (+${fe})`),pt.current&&window.clearTimeout(pt.current),pt.current=window.setTimeout(()=>mt(null),2200)},[vt,P,Ye,F,me]),n.useEffect(()=>()=>{pt.current&&window.clearTimeout(pt.current)},[]);const Vt=(f,I)=>{const O=v.applyOutcome({queue:F,meta:Ye},U,N,x,{correct:f,correctness:I,createdUtc:new Date().toISOString()});L(O.queue),Tt(O.meta);const ue=O.queue[xe+1];ue&&ga(ue,xe+1)};n.useEffect(()=>{if(he&&ie){xn(d,ie).then(f=>R(f.name)).catch(()=>R(t.cogita.library.collections.defaultName));return}if(H==="info"&&T){aa({libraryId:d,infoId:T}).then(f=>{const I=f.payload??{};R(I.title||I.label||I.name||T)}).catch(()=>R(T||t.cogita.library.revision.runKicker));return}if(H==="info-selection"){const f=ee?ys(d,ee):null,I=(f==null?void 0:f.infoIds.length)??0;R(I>0?`Selected infos (${I})`:"Selected infos");return}R(t.cogita.library.collections.defaultName)},[t,ie,he,d,H,T,ee]),n.useEffect(()=>{ts({libraryId:d,type:"language"}).then(f=>D(f)).catch(()=>D([]))},[d]),n.useEffect(()=>{he&&es({libraryId:d}).then(f=>qt(f.items??[])).catch(()=>qt([]))},[he,d]),n.useEffect(()=>{Bn(d,_)},[d,_]),n.useEffect(()=>{Ka(F)},[F,Gt,vt,Dt,ie]),n.useEffect(()=>{if(!U||!vt){Ut(!1);return}if(U.cardType!=="info"||me.has(Te(U))){Ut(!1);return}const f=Ya(xe+1);if(f>=0){Ut(!1),Ie(f);return}if(v.id==="temporal"||v.id==="levels"){const I=F.slice(0,xe+1),O=F.slice(xe+1).filter(_a),ue=I.concat(O),fe=new Set(ue.map(Te)),re=Nn(fe);if(re){const ae=Te(re);fe.has(ae)||(ue.push(re),fe.add(ae),Tt(Se=>{const Oe=Se,Qe=new Set(Oe.queued??[]);return Qe.add(ae),{...Oe,queued:Qe}}))}const ve=ue.findIndex((ae,Se)=>Se!==xe&&_a(ae));if(ve>=0){L(ue),Ie(ve),Ut(!1);return}}Ut(!0)},[U,me,vt,xe,F,Ye,v.id]),n.useEffect(()=>{let f=!0;return(async()=>{J("loading"),le({current:0,total:v.id==="levels"?0:v.getFetchLimit(N,x)});try{if(!he){if(qt([]),H==="info"){if(!T){f&&(L([]),qt([]),Tt({}),Ie(0),J("ready"));return}const[We,st]=await Promise.all([nn({libraryId:d,infoId:T}),sn({libraryId:d,infoId:T})]);if(!f)return;const ct=qa(We.items??[]);qt(st.items??[]);const xt=v.prepare(ct,N,x);L(xt.queue),Tt(xt.meta),Ie(0),J("ready"),le({current:ct.length,total:ct.length});return}if(H==="info-selection"){const We=ee?ys(d,ee):null,st=(We==null?void 0:We.infoIds)??[];if(!st.length){f&&(L([]),qt([]),Tt({}),Ie(0),J("ready"));return}const ct=await Promise.all(st.map(async pa=>{const[Qt,Xa]=await Promise.all([nn({libraryId:d,infoId:pa}),sn({libraryId:d,infoId:pa})]);return{cards:Qt.items??[],deps:Xa.items??[]}}));if(!f)return;const xt=new Map;ct.forEach(pa=>{qa(pa.cards).forEach(Qt=>{xt.set(Te(Qt),Qt)})});const jt=Array.from(xt.values()),wt=new Set(jt.map(Te)),Ft=new Map;ct.forEach(pa=>{(pa.deps??[]).forEach(Qt=>{const Xa=ta(Qt.parentItemType,Qt.parentItemId,Lt(Qt.parentCheckType),Lt(Qt.parentDirection)),cs=ta(Qt.childItemType,Qt.childItemId,Lt(Qt.childCheckType),Lt(Qt.childDirection));if(!wt.has(Xa)||!wt.has(cs))return;const ds=`${Xa}->${cs}`;Ft.has(ds)||Ft.set(ds,Qt)})}),qt(Array.from(Ft.values()));const ka=v.prepare(jt,N,x);L(ka.queue),Tt(ka.meta),Ie(0),J("ready"),le({current:jt.length,total:jt.length});return}}const O=[];let ue=null,fe=null;do{const We=await Ja({libraryId:d,collectionId:ie,limit:300,cursor:ue});if(O.push(...We.items),(v.id==="levels"||v.id==="temporal")&&We.total&&(fe=We.total),le(st=>({current:O.length,total:st.total||We.total||v.getFetchLimit(N,x)})),ue=We.nextCursor??null,fe!==null&&O.length>=fe||v.id!=="levels"&&v.id!=="temporal"&&O.length>=v.getFetchLimit(N,x))break}while(ue);if(!f)return;const re=qa(O);let ve;if(v.id==="levels"){const We=Math.max(1,Number(x.levels??1)),ct=(await da()).reduce((xt,jt)=>{const wt=ta(jt.itemType,jt.itemId,jt.checkType,jt.direction);return xt[wt]||(xt[wt]=[]),xt[wt].push(jt),xt},{});ve={},re.forEach(xt=>{const jt=Te(xt),wt=ct[jt]??[],Ft=wt.length>0?ca(wt).score:0,ka=Math.max(1,Math.min(We,Math.ceil(Ft/100*We)));ve[jt]=ka})}let ae=null,Se=null,Oe=null;if(v.id==="temporal"){const We=await da(),st=new Set(re.map(jt=>Te(jt))),ct=We.reduce((jt,wt)=>{const Ft=ta(wt.itemType,wt.itemId,wt.checkType,wt.direction);return st.has(Ft)&&(jt[Ft]||(jt[Ft]=[]),jt[Ft].push(wt)),jt},{});ae={},Se=new Set,Oe={};const xt=Date.now();re.forEach(jt=>{const wt=Te(jt),Ft=ct[wt]??[];if(Ft.length===0){ae[wt]=0,Se.add(wt),Oe[wt]=[];return}const ka=rs(Ft);Oe[wt]=ka;const pa=jn(ka,xt);ae[wt]=pa.knowness})}const Qe=v.id==="levels"?os(re,N,x,ve):v.id==="temporal"?is(re,N,x,ae??{},Se??new Set,Oe??{}):v.prepare(re,N,x);L(Qe.queue),Tt(Qe.meta),Ie(0),J("ready"),le(We=>({current:Math.min(We.current,We.total),total:We.total}))}catch{f&&J("error")}})(),()=>{f=!1}},[ie,he,d,N,H,x,v,_,T,ee]),n.useEffect(()=>{if(Xe(""),$e(null),It(null),Mt(0),Le([]),tt({}),V({}),S(null),q(null),ye(null),Ee(!1),lt(!1),Be(null),M(null),ne({}),!U){kt(null),Re(null),be(null),dt(null);return}U.cardType==="info"&&U.infoType==="computed"&&kt(t.cogita.library.revision.loadingComputed);let f=!0;return ga(U,xe).then(I=>{!f||!I||(kt(I.prompt),Re(I.expectedAnswer),Le(I.computedExpected),tt(I.computedAnswers),be(I.computedValues),S(I.answerTemplate),q(I.outputVariables),ye(I.variableValues))}),()=>{f=!1}},[U,t]),n.useEffect(()=>{if(!U||U.cardType!=="info"||U.infoType!=="citation"){B.current=null,g.current=new Set,gt(null);return}const f=U.description??"",I=(U.label??"").trim(),O=I.replace(/\s+/g," ").trim(),ue=f.replace(/\s+/g," ").trim(),fe=O&&O!==ue?I:t.cogita.library.infoTypes.citation;if(!f){gt(null),Re(null);return}const re=va(f);B.current=re,kt(fe);let ve=!0;return Ga().then(({fragmentKnowness:ae})=>{if(!ve)return;const Se=new Set,Oe={};ae.forEach((st,ct)=>{const[xt,jt]=ct.split(":",2);if(xt!==U.cardId)return;const wt=Wt(jt);if(!wt)return;const{fragmentId:Ft}=wt;Oe[Ft]=st,st>=Dt&&Se.add(Ft)}),g.current=Se,se.current=Oe;const Qe=Wt(U.direction);if(Qe!=null&&Qe.fragmentId&&re.nodes[Qe.fragmentId]){K(re,Qe.fragmentId,fe);return}const We=Ra(re,Se,Oe,Dt,vt,U.direction);K(re,(We==null?void 0:We.id)??null,fe)}).catch(()=>{g.current=new Set,se.current={};const ae=Wt(U.direction);if(ae!=null&&ae.fragmentId&&re.nodes[ae.fragmentId]){K(re,ae.fragmentId,fe);return}const Se=Ra(re,g.current,{},Dt,vt,U.direction);K(re,(Se==null?void 0:Se.id)??null,fe)}),()=>{ve=!1}},[U,t,vt,Dt]),n.useEffect(()=>{if(!U||U.cardType!=="vocab"||U.checkType!=="translation-match"){M(null),ne({});return}const O=(Ye.pool??Ye.active??F).filter(ae=>ae.cardType==="vocab"&&ae.checkType==="translation-match").filter((ae,Se,Oe)=>Oe.findIndex(Qe=>Qe.cardId===ae.cardId)===Se);O.some(ae=>ae.cardId===U.cardId)||O.unshift(U);const fe=ea(O).slice(0,6).map(ae=>{const Se=ae.label.split("↔").map(We=>We.trim()).filter(Boolean);if(Se.length<2)return null;const Oe=`${ae.cardId}:L`,Qe=`${ae.cardId}:R`;return{cardId:ae.cardId,leftId:Oe,rightId:Qe,leftLabel:Se[0],rightLabel:Se[1]}}).filter(Boolean),re=fe.map(ae=>ae.leftId),ve=ea(fe.map(ae=>ae.rightId));M({pairs:fe,leftOrder:re,rightOrder:ve,selection:{},activeLeft:null,activeRight:null,locked:{}})},[U,F,Ye]),n.useEffect(()=>()=>{ce.current&&window.clearTimeout(ce.current),de.current&&window.clearTimeout(de.current)},[]);const ra=n.useRef(null);n.useEffect(()=>{if(!U)return;const f=Te(U),I=typeof document<"u"?document.activeElement:null;if(ra.current===f&&I&&(I.tagName==="INPUT"||I.tagName==="TEXTAREA"))return;let O=0;const ue=()=>{if(U){if(U.cardType==="info"&&U.infoType==="computed"){if(at.length>0){const re=mn(p,at,E),ve=re?ut.current[re]:null;if(ve&&(ve.focus(),document.activeElement===ve)){ra.current=f;return}}if(St.current&&(St.current.focus(),document.activeElement===St.current)){ra.current=f;return}}else if(U.cardType==="vocab"&&St.current&&(St.current.focus(),document.activeElement===St.current)){ra.current=f;return}O<6&&(O+=1,window.setTimeout(ue,40))}},fe=window.setTimeout(ue,40);return()=>window.clearTimeout(fe)},[U,at,p,E]),n.useEffect(()=>{if(!Kt)return;const f=I=>{I.key==="Enter"&&(I.preventDefault(),La())};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[Kt]);const Ma=f=>{Je(f),dt(ca(f))};n.useEffect(()=>{if(!U){dt(null),Je([]);return}const f=U.cardType==="info"?"info":"connection";if(U.cardType==="info"&&U.infoType==="citation"){da().then(I=>{const O=I.filter(ue=>ue.itemType==="info"&&ue.itemId===U.cardId&&ue.checkType==="quote-fragment"&&hn(ue.direction,U.direction));Ma(O)}).catch(()=>{dt(null),Je([])});return}un(f,U.cardId,U.checkType,U.direction).then(I=>Ma(I)).catch(()=>{dt(null),Je([])})},[d,U,_]);const wa=(f,I,O,ue)=>{if(f==="info"&&O==="quote-fragment"){da().then(fe=>{const re=fe.filter(ve=>ve.itemType==="info"&&ve.itemId===I&&ve.checkType==="quote-fragment"&&hn(ve.direction,ue));Ma(re)}).catch(()=>{dt(null),Je([])});return}un(f,I,O,ue).then(fe=>Ma(fe)).catch(()=>{dt(null),Je([])})},Da=(f,I,O)=>{var ve;const ue=((ve=O.pairs.find(ae=>ae.leftId===f))==null?void 0:ve.rightId)??null;if(!ue)return O;const fe=ue===I;ne(ae=>({...ae,[f]:fe?"correct":"incorrect"})),ce.current&&window.clearTimeout(ce.current),de.current&&window.clearTimeout(de.current),Y.current+=1;const re={kind:fe?"correct":"incorrect",tick:Y.current};if(pe(null),ce.current=window.setTimeout(()=>pe(re),0),de.current=window.setTimeout(()=>pe(null),420),fe){const ae={...O.locked,[f]:!0};return Object.keys(ae).length>=O.pairs.length?($e("correct"),lt(!0)):$e("correct"),{...O,selection:{...O.selection,[f]:I},activeLeft:null,activeRight:null,locked:ae}}return $e("incorrect"),{...O,activeLeft:null,activeRight:null}},Tn=f=>{M(I=>!I||I.locked[f]?I:I.activeRight?Da(f,I.activeRight,I):{...I,activeLeft:I.activeLeft===f?null:f})},Cn=f=>{M(I=>I&&(I.activeLeft?Da(I.activeLeft,f,I):{...I,activeRight:I.activeRight===f?null:f}))},La=()=>{var f;if(U&&U.cardType==="info"&&U.infoType==="citation"&&B.current&&rt&&!((f=Wt(U.direction))!=null&&f.fragmentId)){const I=Ra(B.current,g.current,se.current,Dt,vt,U.direction,rt.fragmentId);if(I){$e(null),Xe(""),Ee(!1),V({}),lt(!1),It(null),Mt(0),K(B.current,I.id,rt.title);return}}$e(null),Xe(""),Ee(!1),V({}),lt(!1),It(null),Mt(0),Ie(I=>Math.min(I+1,F.length))},sa=f=>{if(!U)return;const I=f.expected??null,O=f.answer??"";let ue=I??"",fe=O;if(!I&&f.expectedMap&&f.answerMap){const We=Object.keys(f.expectedMap).sort((st,ct)=>st.localeCompare(ct));ue=We.map(st=>{var ct;return((ct=f.expectedMap)==null?void 0:ct[st])??""}).join("|"),fe=We.map(st=>{var ct;return((ct=f.answerMap)==null?void 0:ct[st])??""}).join("|")}const re=ue?Pa(ue,fe,na):new Uint8Array,ve={revisionType:v.id,evalType:f.evalType,direction:f.direction,prompt:Ve??"",expected:I,answer:O,expectedAnswers:f.expectedMap??null,answers:f.answerMap??null,correct:f.correct,maskBase64:re.length?ya(re):null,values:te??null,checkMode:Z,compareMode:na,minCorrectness:Ta},ae=new TextEncoder().encode(JSON.stringify(ve)),Se=U.cardType==="info"?"info":"connection",Oe=f.overrideCheckType??U.checkType??null,Qe=f.overrideDirection??U.direction??null;dn({itemType:Se,itemId:U.cardId,checkType:Oe,direction:Qe,revisionType:v.id,evalType:f.evalType,correct:f.correct,maskBase64:re.length?ya(re):null,payloadBase64:ya(ae),personRoleId:_??null}).then(()=>{wa(Se,U.cardId,Oe,Qe),Ka(F),Bn(d,_)}).catch(()=>{})},In=(f,I)=>{const O=ht.current.get(I);if(O)return Promise.resolve(O);const ue=ft.current.get(I);if(ue)return ue;const fe=aa({libraryId:d,infoId:f}).then(re=>{var We,st;const ve=re.payload,ae=((We=ve.definition)==null?void 0:We.graph)??null,Se="",Oe=((st=ve.definition)==null?void 0:st.answerTemplate)??"",Qe=ur(ae,Se,Oe);if(Qe){const xt={sample:hr(Qe),answerTemplate:Oe||null};return ht.current.set(I,xt),xt}return Hn({libraryId:d,infoId:f}).then(ct=>{const xt={sample:ct,answerTemplate:null};return ht.current.set(I,xt),xt})}).catch(()=>Hn({libraryId:d,infoId:f}).then(re=>{const ve={sample:re,answerTemplate:null};return ht.current.set(I,ve),ve}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{ft.current.delete(I)});return ft.current.set(I,fe),fe},ga=(f,I)=>{var ae;const O=`${Te(f)}:${I}`,ue=$t.current.get(O);if(ue)return Promise.resolve(ue);const fe=At.current.get(O);if(fe)return fe;const re=Se=>($t.current.set(O,Se),Se);let ve;if(f.cardType==="vocab"){if(f.checkType==="translation-match")return ve=Promise.resolve(re({prompt:f.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),ve;const Se=f.label.split("↔").map(Oe=>Oe.trim()).filter(Boolean);if(Se.length>=2){const Qe=(f.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",We=Qe?Se[0]:Se[1],st=Qe?Se[1]:Se[0];ve=Promise.resolve(re({prompt:We,expectedAnswer:st,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else ve=Promise.resolve(re({prompt:f.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(f.cardType==="info"&&f.infoType==="word"){const Se=(ae=f.description)!=null&&ae.startsWith("Language: ")?f.description.replace("Language: ",""):null;ve=Promise.resolve(re({prompt:f.label,expectedAnswer:Se,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else f.cardType==="info"&&f.infoType==="question"?ve=aa({libraryId:d,infoId:f.cardId}).then(Se=>{const Oe=Se.payload??{},Qe=Oe.definition??Oe??{},We=fr(Qe.type??Qe.kind),st=(typeof Qe.question=="string"&&Qe.question.trim()?Qe.question.trim():null)??(typeof Qe.title=="string"&&Qe.title.trim()?Qe.title.trim():null)??f.label,ct=Qe.answer;return re(We==="text"||We==="number"||We==="date"?{prompt:st,expectedAnswer:typeof ct=="string"||typeof ct=="number"?String(ct):null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}:{prompt:st,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})}).catch(()=>re({prompt:f.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{At.current.delete(O)}):f.cardType==="info"&&f.infoType==="computed"?ve=In(f.cardId,O).then(Se=>{var ct,xt;if(!Se.sample)return re({prompt:f.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const Oe=Se.sample,Qe=Oe.expectedAnswers?Object.entries(Oe.expectedAnswers).map(([jt,wt])=>({key:jt,expected:wt})):[],We=Qe.reduce((jt,wt)=>(jt[wt.key]="",jt),{}),st=Oe.expectedAnswerIsSentence&&((ct=Oe.expectedAnswer)==null?void 0:ct.trim())||null;return re({prompt:Oe.prompt,expectedAnswer:Qe.length>0?st:((xt=Oe.expectedAnswer)==null?void 0:xt.trim())||null,computedExpected:Qe,computedAnswers:We,computedValues:Oe.values??null,answerTemplate:Se.answerTemplate,outputVariables:Oe.outputVariables??null,variableValues:Oe.variableValues??null})}).catch(()=>re({prompt:f.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{At.current.delete(O)}):ve=Promise.resolve(re({prompt:f.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return At.current.set(O,ve),ve},K=(f,I,O)=>{const ue=Object.keys(f.nodes).length,fe=g.current.size;if(!I){gt({title:O,before:f.text,after:"",fragmentId:null,total:ue,completed:fe}),Re(null),lt(!0);return}const re=f.nodes[I];if(!re)return;const ve=vn(f.text,re);gt({title:O,before:ve.before,after:ve.after,fragmentId:re.id,total:ue,completed:fe}),Re(ve.fragment),lt(!1)},oe=()=>{const f=B.current;f&&gt(I=>I&&{...I,total:Object.keys(f.nodes).length,completed:g.current.size})},je=()=>{const f=F[xe+1];f&&ga(f,xe+1)},De=()=>{if(je(),U&&U.cardType==="vocab"&&U.checkType==="translation-match"&&Q){if(Q.pairs.length===0){$e("incorrect"),lt(!0);return}const re=Q.pairs.reduce((st,ct)=>(st[ct.rightId]=ct.rightLabel,st),{});let ve=0;const ae={};Q.pairs.forEach(st=>{const xt=Q.selection[st.leftId]===st.rightId;ae[st.leftId]=xt?"correct":"incorrect",xt&&(ve+=1)});const Se=Q.pairs.length||1,Oe=ve/Se,Qe=ve===Q.pairs.length;ne(st=>({...st,...ae})),Qe?($e("correct"),lt(!0),Mt(0)):($e("incorrect"),lt(!1),Mt(st=>{const ct=st+1;return ct>=_t&&(Ee(!0),lt(!0),M(xt=>{if(!xt)return xt;const jt=xt.pairs.reduce((wt,Ft)=>(wt[Ft.leftId]=Ft.rightId,wt),{});return{...xt,selection:jt}})),ct})),Vt(Qe,Oe);const We="connection";Promise.all(Q.pairs.map(st=>{const ct=Q.selection[st.leftId]??null,xt=ct?re[ct]:"",jt={left:st.leftLabel,expected:st.rightLabel,answer:xt,checkType:"translation-match"},wt=new TextEncoder().encode(JSON.stringify(jt));return dn({itemType:We,itemId:st.cardId,checkType:"translation-match",direction:null,revisionType:v.id,evalType:"translation-match",correct:ct===st.rightId,maskBase64:null,payloadBase64:ya(wt),personRoleId:_??null})})).then(()=>{wa(We,U.cardId,U.checkType,U.direction),Bn(d,_)}).catch(()=>{});return}if(at.length>0){const re=at.reduce((ae,Se)=>{const Oe=Ue[Se.key]??"";return ae[Se.key]=Bt(Oe)===Bt(Se.expected)?"correct":"incorrect",ae},{});at.every(({key:ae,expected:Se})=>{const Oe=Ue[ae]??"";return Z==="exact"&&Bt(Oe)===Bt(Se)})?($e("correct"),V(re),lt(!0),Mt(0),Vt(!0,1),sa({correct:!0,direction:Ve?`${Ve} -> computed`:"computed",expectedMap:at.reduce((ae,Se)=>(ae[Se.key]=Se.expected,ae),{}),answerMap:Ue,evalType:"computed"})):($e("incorrect"),V(re),lt(!1),Mt(ae=>{const Se=ae+1;return Se>=_t&&Ze&&(Ee(!0),lt(!0)),Se}),Vt(!1,0),window.setTimeout(()=>{var Se;const ae=mn(p,at,E);ae&&ut.current[ae]&&((Se=ut.current[ae])==null||Se.focus())},40),sa({correct:!1,direction:Ve?`${Ve} -> computed`:"computed",expectedMap:at.reduce((ae,Se)=>(ae[Se.key]=Se.expected,ae),{}),answerMap:Ue,evalType:"computed"}));return}if(U&&U.cardType==="info"&&U.infoType==="citation"&&(rt!=null&&rt.fragmentId)){if(!He)return;const re=Wt(U.direction),ve=(re==null?void 0:re.fragmentId)??rt.fragmentId,ae=Sa(He,Me,{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}),Se=ae.mask,Oe=ae.isCorrect,Qe=ae.percent;Oe?(se.current[rt.fragmentId]=Math.max(se.current[rt.fragmentId]??0,Qe),(se.current[rt.fragmentId]??0)>=Dt&&g.current.add(rt.fragmentId),oe(),$e("correct"),V({}),lt(!0),It(Se),Mt(0),Qe<100&&_t<=1&&Ee(!0),Vt(!0,Qe/100),sa({correct:!0,direction:`quote:${rt.fragmentId}`,expected:He,answer:Me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:ve})):($e("incorrect"),V({}),lt(!1),It(Se),Mt(We=>{const st=We+1;return st>=_t&&Ze&&(Ee(!0),lt(!0)),st}),Vt(!1,Qe/100),window.setTimeout(()=>{var We;return(We=St.current)==null?void 0:We.focus()},40),sa({correct:!1,direction:`quote:${rt.fragmentId}`,expected:He,answer:Me,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:ve}));return}if(!He)return;const f=Pa(He,Me,na),I=Z==="exact"&&Bt(Me)===Bt(He),O=ja(f),ue=I||O,fe=xa(f);ue?($e("correct"),V({}),lt(!0),It(f),Mt(0),fe<100&&_t<=1&&Ee(!0),Vt(!0,fe/100),sa({correct:!0,direction:Ve?`${Ve} -> ${He}`:null,expected:He,answer:Me,evalType:"text"})):($e("incorrect"),V({}),lt(!1),It(f),Mt(re=>{const ve=re+1;return ve>=_t&&Ze&&(Ee(!0),lt(!0)),ve}),Vt(!1,fe/100),window.setTimeout(()=>{var re;return(re=St.current)==null?void 0:re.focus()},40),sa({correct:!1,direction:Ve?`${Ve} -> ${He}`:null,expected:He,answer:Me,evalType:"text"}))},ze=f=>{if(je(),!He)return;const I=Pa(He,f,na),O=Bt(f)===Bt(He),ue=ja(I),fe=O||ue,re=xa(I);fe?($e("correct"),V({}),lt(!0),It(I),Mt(0),re<100&&_t<=1&&Ee(!0),Vt(!0,re/100),sa({correct:!0,direction:"word->language",expected:He,answer:f,evalType:"language-select"})):($e("incorrect"),V({}),lt(!1),It(I),Mt(ve=>{const ae=ve+1;return ae>=_t&&Ze&&(Ee(!0),lt(!0)),ae}),Vt(!1,re/100),sa({correct:!1,direction:"word->language",expected:He,answer:f,evalType:"language-select"}))},we=()=>{je(),$e("correct"),lt(!0),Mt(0),Vt(!0,1),He&&sa({correct:!0,direction:"manual",expected:He,answer:Me,evalType:"manual"})},Fe=()=>{if(Vt(!1,0),U&&U.cardType==="info"&&U.infoType==="citation"){$e(null),Xe(""),Ee(!1),V({}),lt(!1),It(null),Mt(0),Ie(f=>Math.min(f+1,F.length));return}La()};n.useEffect(()=>{je()},[xe,F]);const Ae=f=>{var O;if(f.key!=="Enter")return;if(f.preventDefault(),f.stopPropagation(),Kt){La();return}const I=at.find(ue=>!(Ue[ue.key]??"").trim());if(I){(O=ut.current[I.key])==null||O.focus();return}De()},Pe=t.cogita.library.revision.revealModeAfterIncorrect,Ze=at.length>0||!!He;return e.jsxs(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:[P==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${z.total?Math.min(100,Math.max(0,z.current/z.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:z.total?`${Math.min(z.current,z.total)} / ${z.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:ge}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",Ne).replace("{check}",Ge)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:w,children:t.cogita.library.actions.libraryOverview}),he?e.jsxs(e.Fragment,{children:[e.jsx("a",{className:"cta ghost",href:`${w}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${w}/collections/${ie}`,children:t.cogita.library.actions.collectionDetail})]}):e.jsx("a",{className:"cta ghost",href:`${w}/list`,children:t.cogita.library.actions.allCards})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:bt?`${bt.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Jt?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Jt.currentLevel??"-"," / ",Jt.levelsCount]}):null,bt?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(bt.correct)).replace("{total}",String(bt.total))}),bt.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(bt.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(gr,{outcomes:yt})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[_e?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:_e})}):null,e.jsx(Fa,{feedbackToken:W?`${W.kind}-${W.tick}`:et?"idle":it?`${it}-${xe}-${Nt}`:"idle",children:U?e.jsx(e.Fragment,{children:Zt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(ss,{copy:t,currentCard:U,currentTypeLabel:Ct,prompt:Ve,languages:G,answer:Me,onAnswerChange:f=>Xe(I=>gn(I,f,Ce)),computedExpected:at,computedAnswers:Ue,onComputedAnswerChange:(f,I)=>tt(O=>({...O,[f]:gn(O[f]??"",I,Ce)})),answerTemplate:p,outputVariables:E,variableValues:X,computedFieldFeedback:qe,feedback:it,canAdvance:Kt,quoteContext:rt,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:De,onSkip:Fe,onLanguageSelect:ze,onMarkReviewed:we,onAdvance:La,showCorrectAnswer:Ke,setShowCorrectAnswer:Ee,onRevealCorrect:()=>lt(!0),answerMask:zt,expectedAnswer:He,hasExpectedAnswer:Ze,handleComputedKeyDown:Ae,answerInputRef:St,computedInputRefs:ut,scriptMode:Ce,setScriptMode:Be,matchPairs:Q==null?void 0:Q.pairs,matchLeftOrder:Q==null?void 0:Q.leftOrder,matchRightOrder:Q==null?void 0:Q.rightOrder,matchSelection:Q==null?void 0:Q.selection,matchActiveLeft:Q==null?void 0:Q.activeLeft,matchActiveRight:Q==null?void 0:Q.activeRight,matchFeedback:ke,onMatchLeftSelect:Tn,onMatchRightSelect:Cn})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:he?`${w}/collections/${ie}`:`${w}/list`,children:he?t.cogita.library.actions.collectionDetail:t.cogita.library.actions.allCards})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ha?`${ma} / ${ha}`:t.cogita.library.revision.progressUnlimited}),P==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),P==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),P==="ready"&&F.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Pe}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",_t]})]})]}),Jt?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Jt.activeCount," / ",Jt.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Jt.counts.map((f,I)=>{const O=I+1,ue=Jt.currentLevel===O,fe=Jt.percentages[I]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":ue,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:O}),e.jsx("strong",{children:f})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,fe))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[fe.toFixed(1),"%"]})]},`level-${O}`)})})]}):null,Ht?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:Ht.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:Ht.dots.map(f=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,f.value*100))}%`,background:`rgba(${Math.round(255*(1-f.value))}, ${Math.round(200*f.value)}, 80, 0.9)`}},f.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:Ht.knownCount})]})]}):null,vt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Sn})]})}):null]})]})]})})})]})]})}const On=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],bo={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},yo=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],xo=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function vo({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:d,collectionId:b}){const[o,l]=n.useState(""),[w,h,N]=Gn([]),[A,v,x]=Yn([]),[Z,_]=n.useState(null),[k,H]=n.useState(null),[T,ee]=n.useState(null),C=`/#/cogita/library/${d}`;n.useEffect(()=>{xn(d,b).then(R=>l(R.name)).catch(()=>l(t.cogita.library.collections.defaultName))},[d,b,t]),n.useEffect(()=>{Kr({libraryId:d,collectionId:b}).then(R=>{if(!R.graphId||R.graphId==="00000000-0000-0000-0000-000000000000"){h([]),v([]);return}const F=R.nodes.map(G=>{var z;const D=G.payload??{},P=D.position??{x:120,y:120},J=D.params??{};return{id:G.nodeId,type:"default",position:P,data:{nodeType:G.nodeType,label:((z=On.find(le=>le.type===G.nodeType))==null?void 0:z.label)??G.nodeType,params:J}}}),L=R.edges.map(G=>({id:G.edgeId,source:G.fromNodeId,target:G.toNodeId,sourceHandle:G.fromPort??void 0,targetHandle:G.toPort??void 0}));h(F),v(L)}).catch(()=>{h([]),v([])})},[d,b,v,h]);const $=n.useMemo(()=>w.find(R=>R.id===Z)??null,[w,Z]),ie=R=>{var D;const F=crypto.randomUUID(),L=((D=On.find(P=>P.type===R))==null?void 0:D.label)??R,G={...bo[R]};h(P=>[...P,{id:F,type:"default",position:{x:120+P.length*40,y:120+P.length*40},data:{nodeType:R,label:L,params:G}}]),_(F)},he=n.useCallback(R=>{v(F=>Xn({...R,id:crypto.randomUUID()},F))},[v]),Ne=async()=>{H(null);try{await tr({libraryId:d,collectionId:b,nodes:w.map(R=>({nodeId:R.id,nodeType:R.data.nodeType,payload:{position:R.position,params:R.data.params}})),edges:A.map(R=>({edgeId:R.id,fromNodeId:R.source,fromPort:R.sourceHandle??null,toNodeId:R.target,toPort:R.targetHandle??null}))}),H(t.cogita.library.graph.saveSuccess)}catch{H(t.cogita.library.graph.saveFail)}},Ge=async()=>{try{const R=await _r({libraryId:d,collectionId:b});ee(R)}catch{ee(null)}},ge=R=>{$&&h(F=>F.map(L=>L.id===$.id?{...L,data:{...L.data,params:R}}:L))};return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:o}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${C}/collections/${b}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Ge,children:t.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:Ne,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:On.map(R=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ie(R.type),children:R.label},R.type))}),k?e.jsx("p",{className:"cogita-help",children:k}):null,T&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(T.total))}),e.jsx("p",{children:t.cogita.library.graph.previewBreakdown.replace("{connections}",String(T.connections)).replace("{infos}",String(T.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(fn,{nodes:w,edges:A,onNodesChange:N,onEdgesChange:x,onConnect:he,onNodeClick:(R,F)=>_(F.id),fitView:!0,children:[e.jsx(bn,{color:"rgba(120,160,200,0.2)"}),e.jsx(yn,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),$?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:$.data.label}),$.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:d,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:$.data.params.tagId?{id:$.data.params.tagId,label:$.data.params.tagLabel??"",infoType:"topic"}:null,onChange:R=>ge({...$.data.params,tagId:(R==null?void 0:R.id)??null,tagLabel:(R==null?void 0:R.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:$.data.params.scope??"any",onChange:R=>ge({...$.data.params,scope:R.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),$.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Xt,{libraryId:d,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:$.data.params.languageId?{id:$.data.params.languageId,label:$.data.params.languageLabel??"",infoType:"language"}:null,onChange:R=>ge({...$.data.params,languageId:(R==null?void 0:R.id)??null,languageLabel:(R==null?void 0:R.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:$.data.params.scope??"any",onChange:R=>ge({...$.data.params,scope:R.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),$.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:$.data.params.infoType??"word",onChange:R=>ge({...$.data.params,infoType:R.target.value}),children:xo.map(R=>e.jsx("option",{value:R.value,children:R.label},R.value))})]}),e.jsx(Xt,{libraryId:d,infoType:$.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:$.data.params.infoId?{id:$.data.params.infoId,label:$.data.params.infoLabel??"",infoType:$.data.params.infoType??"word"}:null,onChange:R=>ge({...$.data.params,infoId:(R==null?void 0:R.id)??null,infoLabel:(R==null?void 0:R.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),$.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:$.data.params.connectionType??"translation",onChange:R=>ge({...$.data.params,connectionType:R.target.value}),children:yo.map(R=>e.jsx("option",{value:R.value,children:R.label},R.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:$.data.params.connectionId??"",onChange:R=>ge({...$.data.params,connectionId:R.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes($.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const Vn="cogita.preferences",qn="cogita.reviewer.preferences",yr=["library_overview","all_cards","all_collections","all_revisions","storyboards","texts","dependencies","transfer"],Un={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},all_revisions:{requiresCollection:!1,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},jo=["settings","run","shared"],$a=30,Os=42;function fa(t,a){const s=(t??"").trim();return s.length<=a?s:a<=1?s.slice(0,a):`${s.slice(0,Math.max(1,a-1)).trimEnd()}…`}function wo(t,a=""){const s=t.split("/").filter(Boolean);if(s[0]!=="cogita"||s[1]!=="library")return{};const r=s[2];if(!r)return{};if(!s[3])return{libraryId:r,target:"library_overview"};const i=new URLSearchParams(a),u=i.get("revisionId")??void 0,c=i.get("infoId")??void 0,y=i.get("infoView"),m=y==="cards"?"cards":y==="collections"?"collections":"overview",j=i.get("collectionView")==="overview"?"overview":"infos",d=i.get("collectionAction"),b=i.get("libraryAction"),l=i.get("libraryTarget")==="revisions"?"all_revisions":"all_collections";if(s[3]==="list")return{libraryId:r,target:b==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:u,infoId:c,infoView:m,libraryAction:b==="new-info"?"new-info":void 0};if(s[3]==="detail"||s[3]==="collection")return{libraryId:r,target:"all_cards",cardMode:s[3],revisionId:u,infoId:c,infoView:m};if(s[3]==="new"||s[3]==="add")return{libraryId:r,target:"new_card",revisionId:u,libraryAction:"new-info"};if(s[3]==="edit")return{libraryId:r,target:"new_card",revisionId:u,infoId:s[4]};if(s[3]==="infos"){const h=s[4];return h?s[5]==="checkcards"?{libraryId:r,target:"all_cards",cardMode:"list",revisionId:u,infoId:h,infoView:"cards"}:s[5]==="collections"?{libraryId:r,target:"all_cards",cardMode:"list",revisionId:u,infoId:h,infoView:"collections"}:{libraryId:r,target:"all_cards",cardMode:"list",revisionId:u,infoId:h,infoView:"overview"}:{libraryId:r,target:"all_cards",cardMode:"list",revisionId:u}}if(s[3]==="shared-revisions")return{libraryId:r,target:l,revisionId:u};if(s[3]==="revisions"){const h=s[4];return h?h==="shared-links"?{libraryId:r,target:"all_revisions",revisionView:"shared"}:h==="new"?{libraryId:r,target:"all_revisions",revisionView:"new"}:s[5]==="run"?{libraryId:r,target:"all_revisions",revisionId:h,revisionView:"run"}:s[5]==="shared"?{libraryId:r,target:"all_revisions",revisionId:h,revisionView:"shared"}:{libraryId:r,target:"all_revisions",revisionId:h,revisionView:"settings"}:{libraryId:r,target:"all_revisions"}}if(s[3]==="revision"&&s[4]==="run")return{libraryId:r,target:l,revisionView:"run",revisionId:u,infoId:c,infoView:m};if(s[3]==="dependencies")return{libraryId:r,target:"dependencies"};if(s[3]==="transfer")return{libraryId:r,target:"transfer"};if(s[3]==="storyboards")return s[4]==="new"?{libraryId:r,target:"new_storyboard"}:{libraryId:r,target:"storyboards"};if(s[3]==="texts")return s[4]==="new"?{libraryId:r,target:"new_text"}:{libraryId:r,target:"texts"};if(s[3]!=="collections")return{libraryId:r,target:"library_overview"};if(s[4]==="new")return{libraryId:r,target:"new_collection",revisionId:u};const w=s[4];return w?s[5]==="graph"?{libraryId:r,target:l,collectionId:w,revisionId:u,revisionView:"graph"}:s[5]==="shared-revisions"?{libraryId:r,target:l,collectionId:w,revisionId:u,revisionView:"shared"}:s[5]==="revision"?{libraryId:r,target:l,collectionId:w,revisionId:u,revisionView:s[6]==="run"?"run":"settings",collectionView:j}:d==="new-revision"?{libraryId:r,target:l,collectionId:w,revisionId:u,revisionView:"new"}:{libraryId:r,target:l,collectionId:w,revisionId:u,revisionView:"detail",collectionView:j}:d==="new-collection"?{libraryId:r,target:"new_collection",collectionAction:"new-collection"}:{libraryId:r,target:l}}function Vs(t,a="library_overview",s,r,i,u,c="overview",y="infos"){const m=(j,d)=>{const b=new URLSearchParams;d!=null&&d.revisionId&&b.set("revisionId",d.revisionId),d!=null&&d.collectionAction&&b.set("collectionAction",d.collectionAction),d!=null&&d.libraryAction&&b.set("libraryAction",d.libraryAction),d!=null&&d.libraryTarget&&b.set("libraryTarget",d.libraryTarget),d!=null&&d.infoId&&b.set("infoId",d.infoId),d!=null&&d.infoView&&(d!=null&&d.infoId)&&b.set("infoView",d.infoView),d!=null&&d.collectionView&&d.collectionView!=="infos"&&b.set("collectionView",d.collectionView);const o=b.toString();return o?`${j}?${o}`:j};if(!t)return"/cogita";if(a==="library_overview")return m(`/cogita/library/${t}`,{revisionId:i});if(a==="all_cards")return u?c==="cards"?m(`/cogita/library/${t}/infos/${u}/checkcards`,{revisionId:i}):c==="collections"?m(`/cogita/library/${t}/infos/${u}/collections`,{revisionId:i}):m(`/cogita/library/${t}/infos/${u}`,{revisionId:i}):m(`/cogita/library/${t}/list`,{revisionId:i,infoId:u,infoView:c});if(a==="new_card")return u?m(`/cogita/library/${t}/edit/${u}`,{revisionId:i}):m(`/cogita/library/${t}/list`,{revisionId:i,libraryAction:"new-info"});if(a==="all_collections"||a==="all_revisions"){const j=a==="all_revisions"?"revisions":void 0;return a==="all_revisions"&&i?r==="run"?m(`/cogita/library/${t}/revisions/${i}/run`,{revisionId:i}):r==="shared"?m(`/cogita/library/${t}/revisions/${i}/shared`,{revisionId:i}):m(`/cogita/library/${t}/revisions/${i}`,{revisionId:i}):a==="all_revisions"&&r==="new"?m(`/cogita/library/${t}/revisions/new`,{revisionId:i}):a==="all_revisions"?r==="shared"?m(`/cogita/library/${t}/revisions/shared-links`,{revisionId:i}):r==="run"?m(`/cogita/library/${t}/revision/run`,{revisionId:i,libraryTarget:j}):m(`/cogita/library/${t}/revisions`,{revisionId:i}):!s&&r==="run"?m(`/cogita/library/${t}/revision/run`,{revisionId:i,libraryTarget:j}):s?r==="graph"?m(`/cogita/library/${t}/collections/${s}/graph`,{revisionId:i,libraryTarget:j}):r==="settings"?m(`/cogita/library/${t}/collections/${s}/revision`,{revisionId:i,libraryTarget:j}):r==="run"?m(`/cogita/library/${t}/collections/${s}/revision/run`,{revisionId:i,libraryTarget:j}):r==="shared"?m(`/cogita/library/${t}/collections/${s}/shared-revisions`,{revisionId:i,libraryTarget:j}):r==="new"?m(`/cogita/library/${t}/collections/${s}`,{revisionId:i,libraryTarget:j,collectionAction:"new-revision"}):m(`/cogita/library/${t}/collections/${s}`,{revisionId:i,libraryTarget:j,collectionView:y}):m(`/cogita/library/${t}/collections`,{revisionId:i,libraryTarget:j})}return a==="new_collection"?m(`/cogita/library/${t}/collections`,{revisionId:i,collectionAction:"new-collection"}):a==="transfer"?m(`/cogita/library/${t}/transfer`,{revisionId:i}):a==="storyboards"?m(`/cogita/library/${t}/storyboards`,{revisionId:i}):a==="new_storyboard"?m(`/cogita/library/${t}/storyboards/new`,{revisionId:i}):a==="texts"?m(`/cogita/library/${t}/texts`,{revisionId:i}):a==="new_text"?m(`/cogita/library/${t}/texts/new`,{revisionId:i}):a==="dependencies"?m(`/cogita/library/${t}/dependencies`,{revisionId:i}):m(`/cogita/library/${t}`,{revisionId:i})}function ba(t){return t.length>1&&t.endsWith("/")?t.slice(0,-1):t}function ko(t){return typeof t=="string"&&yr.includes(t)}function No(t,a){var y;if(!t.length)return null;const s=t.filter(m=>a.has(m.roleId)),r=s.length>0?s:t,i=r.map(m=>{var d,b;const j=((b=(d=m.fields.find(o=>o.fieldType==="role_kind"))==null?void 0:d.plainValue)==null?void 0:b.toLowerCase())??"";return{roleId:m.roleId,roleKind:j}}),u=i.find(m=>m.roleKind.includes("master"));if(u)return u.roleId;const c=i.find(m=>m.roleKind.includes("account")||m.roleKind.includes("user"));return c?c.roleId:((y=r[0])==null?void 0:y.roleId)??null}function So(t){if(!t)return{version:1,byLibrary:{}};try{const a=JSON.parse(t);return!a||typeof a!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:a.lastLibraryId,byLibrary:a.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function To({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j}){const d=Qa(),b=Ea(),o=n.useMemo(()=>wo(b.pathname,b.search),[b.pathname,b.search]),l=t.cogita.workspace,[w,h]=n.useState([]),[N,A]=n.useState([]),[v,x]=n.useState([]),[Z,_]=n.useState([]),[k,H]=n.useState(void 0),[T,ee]=n.useState("library_overview"),[C,$]=n.useState(void 0),[ie,he]=n.useState(void 0),[Ne,Ge]=n.useState("detail"),[ge,R]=n.useState(void 0),[F,L]=n.useState(!1),[G,D]=n.useState(!0),[P,J]=n.useState(!1),[z,le]=n.useState(!1),[xe,Ie]=n.useState(null),[Me,Xe]=n.useState(0),[it,$e]=n.useState(""),[Ve,kt]=n.useState(""),[He,Re]=n.useState(""),[rt,gt]=n.useState([]),[at,Le]=n.useState(""),[Ue,tt]=n.useState(0),[qe,V]=n.useState(null),[te,be]=n.useState(null),p=n.useRef({version:1,byLibrary:{}}),S=n.useRef(!1),E=n.useRef(!1),q=n.useRef(null),X=n.useMemo(()=>w.find(g=>g.libraryId===k)??null,[w,k]),ye=n.useMemo(()=>N.find(g=>g.collectionId===C)??null,[N,C]),Q=ba(b.pathname)==="/cogita/persons";n.useEffect(()=>{if(!k){gt([]),Le("");return}let g=!1;return ar({libraryId:k}).then(se=>{if(g)return;const U=se.filter(et=>(et.roleKind??"").trim().toLowerCase()==="person");gt(U);try{const et=window.localStorage.getItem(qn),ft=(et?JSON.parse(et):{})[k]??"",$t=ft&&U.some(At=>At.roleId===ft)?ft:"";Le($t)}catch{Le("")}}).catch(()=>{g||(gt([]),Le(""))}),()=>{g=!0}},[k,Ue]),n.useEffect(()=>{if(k)try{const g=window.localStorage.getItem(qn),se=g?JSON.parse(g):{};at?se[k]=at:delete se[k],window.localStorage.setItem(qn,JSON.stringify(se))}catch{}},[k,at]);const M=n.useMemo(()=>Z.find(g=>g.revisionId===ie)??null,[Z,ie]),ke=n.useMemo(()=>({detail:l.revisions.detail,graph:l.revisions.graph,settings:l.revisions.settings,run:l.revisions.run,shared:l.targets.sharedRevisions,new:l.revisionForm.createAction}),[l.revisions.detail,l.revisions.graph,l.revisions.run,l.revisions.settings,l.targets.sharedRevisions,l.revisionForm.createAction]),ne=n.useMemo(()=>T==="new_card"?"all_cards":T==="new_collection"?"all_collections":T==="new_storyboard"?"storyboards":T==="new_text"?"texts":T,[T]),Y=n.useMemo(()=>Ne==="new"?"settings":Ne,[Ne]),W=T==="all_collections"||T==="all_revisions",pe=n.useMemo(()=>T==="new_collection"?"create":T==="all_collections"&&C?"selected":"search",[C,T]),ce=n.useMemo(()=>o.infoId?"selected":T==="new_card"?"create":"search",[o.infoId,T]),de=n.useMemo(()=>v.find(g=>g.infoId===o.infoId)??null,[v,o.infoId]),Ce=n.useMemo(()=>({library_overview:l.targets.libraryOverview,all_cards:l.targets.allCards,new_card:l.targets.newCard,all_collections:l.targets.allCollections,all_revisions:l.targets.allRevisions,new_collection:l.targets.newCollection,transfer:l.targets.transfer,storyboards:l.targets.storyboards,new_storyboard:l.targets.newStoryboard,texts:l.targets.texts,new_text:l.targets.newText,dependencies:l.targets.dependencies}),[l.targets]),Be=n.useMemo(()=>Ce[ne]??ne,[ne,Ce]),Ke=ke[Y],Ee=!!k,bt=n.useMemo(()=>{const g=m==="pl"?"Ruch na teraz: utwórz bibliotekę i wpisz pierwszy element wiedzy.":m==="de"?"Nächster Schritt: Erstelle eine Bibliothek und füge den ersten Wissenseintrag hinzu.":"Next action: create one library and add your first knowledge item.";return m==="pl"?[{step:"Krok 1",title:"Czym jest Cogita?",lead:"To centrum budowania i prowadzenia procesu nauki po zalogowaniu.",passages:["W jednym miejscu łączysz treści, ćwiczenia i współpracę zespołu.","Zamiast luźnych notatek dostajesz spójny przepływ: biblioteka → kolekcja → powtórka."],focus:["Jedna przestrzeń robocza","Spójny proces"],action:g},{step:"Krok 2",title:"Zacznij od biblioteki",lead:"Biblioteka jest bazą dla całego tematu.",passages:["Nazwij bibliotekę jasno: np. „Historia Kościoła – semestr 1”.","Każdy kolejny moduł korzysta z tej samej biblioteki jako źródła."],focus:["Nazwa tematyczna","Jeden punkt startowy"],action:g},{step:"Krok 3",title:"Dodawaj informacje",lead:"Twórz krótkie, konkretne jednostki wiedzy.",passages:["Wpisy typu info opisują pojęcia, osoby, źródła i cytaty.","Małe jednostki łatwiej łączyć, powtarzać i aktualizować."],focus:["Krótko i konkretnie","Łatwe aktualizacje"],action:g},{step:"Krok 4",title:"Pracuj na typach",lead:"Formularze dostosowują się do rodzaju informacji.",passages:["Każdy typ pokazuje właściwe pola i porządkuje dane.","To zmniejsza chaos i poprawia jakość wyszukiwania."],focus:["Lepsza struktura","Mniej błędów"],action:g},{step:"Krok 5",title:"Łącz wiedzę linkami",lead:"Buduj kontekst przez relacje między wpisami.",passages:["Połącz temat z definicją, źródłem i przykładem.","Graf relacji pomaga zobaczyć, czego brakuje przed kolejnym etapem."],focus:["Relacje między wpisami","Pełniejszy kontekst"],action:g},{step:"Krok 6",title:"Twórz kolekcje celu",lead:"Kolekcja grupuje wpisy pod konkretny scenariusz.",passages:["Osobna kolekcja dla lekcji, osobna dla quizu lub egzaminu.","Nie duplikujesz treści — tylko wybierasz, co jest potrzebne."],focus:["Celowe grupowanie","Bez duplikatów"],action:g},{step:"Krok 7",title:"Dodawaj powtórki",lead:"Powtórka definiuje jak przebiega sprawdzanie.",passages:["Ustaw tempo, kolejność i zakres materiału.","Dla jednej kolekcji możesz mieć kilka powtórek o różnych poziomach."],focus:["Kontrola tempa","Różne poziomy"],action:g},{step:"Krok 8",title:"Info vs karta",lead:"Rozróżniaj źródło wiedzy i widok ćwiczeniowy.",passages:["Info to rekord bazowy, który przechowuje treść.","Karta to forma pytania/utrwalenia generowana z info."],focus:["Źródło danych","Widok ćwiczeń"],action:g},{step:"Krok 9",title:"Uruchamiaj sesję",lead:"Tryb Run prowadzi uczestników krok po kroku.",passages:["Prowadzący kontroluje rytm i przejścia między etapami.","Uczestnicy mają jasny przebieg bez zgadywania, co dalej."],focus:["Płynny przebieg","Lepsza dynamika grupy"],action:g},{step:"Krok 10",title:"Czytaj graf zależności",lead:"Graf pokazuje priorytety nauki.",passages:["Węzły centralne oznaczają tematy, które wpływają na wiele innych.","Najpierw utrwal fundamenty, potem przechodź do warstw zaawansowanych."],focus:["Priorytety materiału","Lepsza kolejność"],action:g},{step:"Krok 11",title:"Storyboard i teksty",lead:"Plan i notatki trzymaj blisko wiedzy źródłowej.",passages:["Storyboard układa narrację i przebieg spotkania.","Teksty zbierają komentarze, wnioski i gotowe treści do publikacji."],focus:["Lepsze przygotowanie","Notatki w kontekście"],action:g},{step:"Krok 12",title:"Udostępniaj bezpiecznie",lead:"Dziel się materiałem bez utraty kontroli.",passages:["Możesz dać dostęp tylko do odczytu dla wybranych osób.","Edycja pozostaje po stronie autora lub zespołu prowadzącego."],focus:["Kontrola uprawnień","Bezpieczne współdzielenie"],action:g},{step:"Krok 13",title:"Nawiguj warstwowo",lead:"Sidebar i breadcrumb prowadzą przez poziomy.",passages:["Zawsze widzisz, czy pracujesz na bibliotece, kolekcji czy powtórce.","Mniej kliknięć „w ciemno”, więcej świadomej nawigacji."],focus:["Orientacja w systemie","Szybsze decyzje"],action:g},{step:"Krok 14",title:"Plan wdrożenia 30 minut",lead:"Najpierw prosty pilot, potem rozwijaj.",passages:["Plan: 1 biblioteka, 10 wpisów info, 1 kolekcja, 1 powtórka testowa.","Po pierwszej sesji popraw strukturę i dodaj kolejne scenariusze."],focus:["Szybki start","Iteracyjne doskonalenie"],action:"Gotowe? Załóż bibliotekę po prawej i przejdź do pierwszego wpisu."}]:m==="de"?[{step:"Schritt 1",title:"Was ist Cogita?",lead:"Ein zentraler Workspace für Lernen und Moderation nach dem Login.",passages:["Du verbindest Inhalte, Übungen und Teamarbeit in einem Ablauf.","Der Prozess bleibt klar: Bibliothek → Sammlung → Wiederholung."],focus:["Ein Workspace","Klarer Ablauf"],action:g},{step:"Schritt 2",title:"Mit Bibliothek starten",lead:"Die Bibliothek ist der Startpunkt für dein Thema.",passages:["Vergib einen klaren Namen für Kurs oder Modul.","Alle weiteren Bereiche greifen auf diese Basis zu."],focus:["Sauberer Start","Gemeinsame Basis"],action:g},{step:"Schritt 3",title:"Infos anlegen",lead:"Erfasse Wissen in kleinen, klaren Einträgen.",passages:["Info-Einträge enthalten Begriffe, Personen, Quellen und Zitate.","Kleinere Einheiten lassen sich besser verknüpfen und trainieren."],focus:["Kleine Einheiten","Leicht wartbar"],action:g},{step:"Schritt 4",title:"Typbasierte Eingabe",lead:"Formulare passen sich automatisch dem Info-Typ an.",passages:["Dadurch bleiben Daten strukturiert und konsistent.","Das verbessert Qualität und Auffindbarkeit."],focus:["Konsistenz","Bessere Suche"],action:g},{step:"Schritt 5",title:"Wissen verlinken",lead:"Verbinde Einträge zu einem Kontextnetz.",passages:["Thema, Quelle und Beispiel werden als Beziehung sichtbar.","So erkennst du Lücken vor der nächsten Lernphase."],focus:["Kontextnetz","Lücken erkennen"],action:g},{step:"Schritt 6",title:"Ziel-Sammlungen bauen",lead:"Eine Sammlung bündelt Inhalte für einen konkreten Zweck.",passages:["Nutze getrennte Sammlungen für Unterricht, Quiz oder Prüfung.","Du wählst Inhalte aus statt sie zu kopieren."],focus:["Zielorientierung","Keine Duplikate"],action:g},{step:"Schritt 7",title:"Wiederholungen erstellen",lead:"Wiederholungen definieren den Prüfungsablauf.",passages:["Tempo, Reihenfolge und Umfang sind pro Wiederholung steuerbar.","Mehrere Wiederholungen pro Sammlung sind möglich."],focus:["Ablaufsteuerung","Mehrere Niveaus"],action:g},{step:"Schritt 8",title:"Info und Karte",lead:"Datenobjekt und Trainingsansicht sind getrennt.",passages:["Info ist die Quelle der Inhalte.","Die Karte ist die Übungsansicht für Frage und Antwort."],focus:["Sauberes Modell","Wiederverwendbar"],action:g},{step:"Schritt 9",title:"Sitzung durchführen",lead:"Im Run-Modus führst du die Gruppe Schritt für Schritt.",passages:["Moderation steuert Übergänge und Timing.","Teilnehmende folgen einem klaren Ablauf."],focus:["Klare Moderation","Stabile Dynamik"],action:g},{step:"Schritt 10",title:"Abhängigkeitsgraph lesen",lead:"Der Graph zeigt Lernprioritäten.",passages:["Zentrale Knoten beeinflussen viele weitere Themen.","Starte mit Grundlagen und baue danach auf."],focus:["Priorisierung","Lernreihenfolge"],action:g},{step:"Schritt 11",title:"Storyboard & Texte",lead:"Plane Ablauf und sammle Notizen im selben Kontext.",passages:["Storyboards strukturieren Sequenzen und Rollen.","Texte halten Erkenntnisse und veröffentlichungsreife Inhalte fest."],focus:["Planung","Dokumentation"],action:g},{step:"Schritt 12",title:"Sicher teilen",lead:"Teile Inhalte ohne Kontrollverlust.",passages:["Leserechte sind separat von Bearbeitungsrechten steuerbar.","So bleibt der Kernbestand geschützt."],focus:["Rechtekontrolle","Sicheres Teilen"],action:g},{step:"Schritt 13",title:"Ebenen-Navigation",lead:"Sidebar und Breadcrumb zeigen deinen aktuellen Kontext.",passages:["Du siehst sofort, auf welcher Ebene du arbeitest.","Das spart Zeit und reduziert Fehlklicks."],focus:["Orientierung","Effizienz"],action:g},{step:"Schritt 14",title:"30-Minuten-Startplan",lead:"Starte klein und erweitere iterativ.",passages:["Plan: 1 Bibliothek, 10 Infos, 1 Sammlung, 1 Test-Wiederholung.","Nach der ersten Runde verbesserst du Struktur und Ablauf."],focus:["Schneller Einstieg","Iteratives Vorgehen"],action:"Jetzt starten: Bibliothek rechts anlegen und den ersten Eintrag erfassen."}]:[{step:"Step 1",title:"What is Cogita?",lead:"A post-login workspace to design, run, and improve knowledge journeys.",passages:["You can keep content, training flow, and collaboration in one place.","The path stays explicit: library → collection → revision → session."],focus:["Single workspace","Clear learning flow"],action:g},{step:"Step 2",title:"Start with a library",lead:"Your library is the root container for one domain or program.",passages:["Name it after your course, cohort, or topic scope.","Every next module reuses this foundation."],focus:["Root container","Consistent base"],action:g},{step:"Step 3",title:"Add information units",lead:"Build knowledge from small, reusable info entries.",passages:["Capture terms, references, people, concepts, and citations.","Smaller entries are easier to link, review, and update."],focus:["Reusable units","Easy maintenance"],action:g},{step:"Step 4",title:"Use type-based forms",lead:"Each info type has a matching data structure and fields.",passages:["Form layouts adapt automatically to the selected type.","This improves consistency and lowers input mistakes."],focus:["Structured input","Fewer errors"],action:g},{step:"Step 5",title:"Link the knowledge graph",lead:"Relationships turn isolated facts into usable context.",passages:["Connect topics, sources, and supporting examples.","Dependency links show what must be learned first."],focus:["Context building","Better sequencing"],action:g},{step:"Step 6",title:"Build goal collections",lead:"Collections package selected infos for a concrete objective.",passages:["Create separate collections for class, quiz, exam, or workshop.","You curate from existing entries instead of duplicating content."],focus:["Goal-oriented sets","No duplication"],action:g},{step:"Step 7",title:"Create revisions",lead:"Revisions define how practice and checking should run.",passages:["Set pacing, order, and scope for each session style.","One collection can host multiple revision strategies."],focus:["Practice design","Multiple modes"],action:g},{step:"Step 8",title:"Understand info vs card",lead:"Data objects and practice views are intentionally separate.",passages:["Info is the canonical source object.","Card is the generated training/checking view."],focus:["Clear model","Reusable content"],action:g},{step:"Step 9",title:"Run live sessions",lead:"Run mode helps facilitators guide each step with control.",passages:["Move through prompts, responses, and timing intentionally.","Participants get a predictable and focused session rhythm."],focus:["Facilitator control","Group clarity"],action:g},{step:"Step 10",title:"Read dependency graphs",lead:"Graph views expose prerequisites and high-impact nodes.",passages:["Central nodes usually deserve priority in onboarding.","Use this to plan revision order and reduce confusion."],focus:["Priority mapping","Smarter progression"],action:g},{step:"Step 11",title:"Use storyboards and texts",lead:"Plan narratives and keep notes near source knowledge.",passages:["Storyboards model session structure and transitions.","Texts capture outcomes, drafts, and reusable explanations."],focus:["Planning layer","Contextual notes"],action:g},{step:"Step 12",title:"Share safely",lead:"Share read access without losing editorial control.",passages:["Keep editing rights restricted to owners or maintainers.","Collaborators can consume material while core data stays protected."],focus:["Access control","Safe collaboration"],action:g},{step:"Step 13",title:"Navigate by layers",lead:"Sidebar and breadcrumb make system depth understandable.",passages:["You always know whether you are at library, collection, or revision level.","Clear location awareness reduces wrong actions."],focus:["Fast orientation","Lower friction"],action:g},{step:"Step 14",title:"30-minute launch plan",lead:"Start with a minimum viable setup, then iterate.",passages:["Plan: create 1 library, add 10 infos, build 1 collection, run 1 revision.","After the first run, refine structure and scale by scenario."],focus:["Immediate execution","Iterative improvement"],action:"Ready now? Create your first library on the right and start adding knowledge."}]},[m]),dt=bt.length,yt=Math.max(0,Math.min(Me,dt-1)),Je=bt[yt],_e=!!C,mt=Ee&&T==="all_collections",nt=_e&&T==="all_collections",pt=Ee&&(T==="all_revisions"||_e&&T==="all_collections")&&(Y==="settings"||Y==="run"||Y==="shared"||T==="all_revisions"),zt=pt,It=pt&&!!ie,Nt=n.useCallback(g=>{const se=!!g.libraryId;let U=g.target,et=g.collectionId,ht=g.revisionId,ft=g.revisionView,$t=g.infoId,At=g.infoView??o.infoView??"overview",Ct=g.collectionView??o.collectionView??"infos";se?Un[U].requiresCollection&&!et?(U=U==="all_revisions"?"all_revisions":"all_collections",ht=void 0,ft="detail"):U!=="all_collections"&&U!=="all_revisions"?(et=void 0,ht=void 0,U!=="new_card"&&U!=="all_cards"&&($t=void 0,At="overview"),U!=="new_collection"&&(Ct="infos")):Un[U].allowsRevision?jo.includes(ft)||(ht=void 0):ft="detail":(U="library_overview",et=void 0,ht=void 0,ft="detail",$t=void 0,At="overview",Ct="infos"),H(g.libraryId),ee(U),$(et),he(ht),Ge(ft),L(!1);const Pt=ba(Vs(g.libraryId,U,et,ft,ht,$t,At,Ct));ba(`${b.pathname}${b.search}`)!==Pt&&(q.current=Pt,d(Pt))},[b.pathname,b.search,d,o.collectionView,o.infoView]),Mt=n.useMemo(()=>[{key:"library",label:l.layers.library,visible:!0,value:k??"",selectedLabel:(X==null?void 0:X.name)??l.path.noLibrarySelected,disabled:G||w.length===0,options:w.map(g=>({value:g.libraryId,label:g.name})),emptyOption:l.noLibraryOption,onSelect:g=>{const se=g||void 0;Nt({libraryId:se,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:l.layers.target,visible:Ee,value:ne,selectedLabel:Be,disabled:!Ee,options:yr.map(g=>({value:g,label:Ce[g]})),onSelect:g=>{const se=g;Nt({libraryId:k,target:se,collectionId:C,revisionId:ie,revisionView:Ne,infoId:se==="new_card"?o.infoId:void 0})}},{key:"info_mode",label:l.layers.target,visible:ne==="all_cards",value:ce,selectedLabel:ce==="create"?l.infoMode.create:ce==="selected"?(de==null?void 0:de.label)??ge??t.cogita.library.list.selectedEmpty:l.infoMode.search,disabled:!Ee,options:[{value:"search",label:l.infoMode.search},{value:"create",label:l.infoMode.create},...o.infoId?[{value:"selected",label:(de==null?void 0:de.label)??ge??t.cogita.library.list.selectedEmpty}]:[]],onSelect:g=>{if(g==="selected"){if(!o.infoId)return;Nt({libraryId:k,target:"all_cards",collectionId:C,revisionId:ie,revisionView:Ne,infoId:o.infoId,infoView:"overview"});return}if(g==="create"){Nt({libraryId:k,target:"new_card",collectionId:C,revisionId:ie,revisionView:Ne,infoId:void 0});return}Nt({libraryId:k,target:"all_cards",collectionId:C,revisionId:ie,revisionView:Ne,infoId:void 0,infoView:"overview"})}},{key:"info_selected_action",label:l.layers.target,visible:ne==="all_cards"&&!!o.infoId,value:T==="new_card"&&o.infoId?"edit":o.infoView==="cards"?"cards":o.infoView==="collections"?"collections":"overview",selectedLabel:T==="new_card"&&o.infoId?l.infoActions.edit:o.infoView==="cards"?l.infoActions.seeCards:o.infoView==="collections"?"Kolekcje":l.infoActions.overview,disabled:!Ee||!o.infoId,options:[{value:"overview",label:l.infoActions.overview},{value:"edit",label:l.infoActions.edit},{value:"cards",label:l.infoActions.seeCards},{value:"collections",label:"Kolekcje"}],onSelect:g=>{if(o.infoId){if(g==="edit"){Nt({libraryId:k,target:"new_card",collectionId:C,revisionId:ie,revisionView:Ne,infoId:o.infoId});return}if(g==="cards"){Nt({libraryId:k,target:"all_cards",collectionId:C,revisionId:ie,revisionView:Ne,infoId:o.infoId,infoView:"cards"});return}Nt({libraryId:k,target:"all_cards",collectionId:C,revisionId:ie,revisionView:Ne,infoId:o.infoId,infoView:"overview"})}}},{key:"collection_mode",label:l.layers.collection,visible:Ee&&(T==="all_collections"||T==="new_collection"),value:pe,selectedLabel:pe==="create"?t.cogita.library.actions.createCollection:pe==="selected"?(ye==null?void 0:ye.name)??l.path.noCollectionSelected:t.cogita.library.actions.collections,disabled:!Ee,options:[{value:"search",label:t.cogita.library.actions.collections},{value:"create",label:t.cogita.library.actions.createCollection},...C&&ye?[{value:"selected",label:ye.name}]:[]],onSelect:g=>{if(g==="create"){Nt({libraryId:k,target:"new_collection",collectionId:void 0,revisionId:void 0,revisionView:"detail"});return}if(g==="selected"&&C){const se=W?T:"all_collections";Nt({libraryId:k,target:se,collectionId:C,revisionId:ie,revisionView:se==="all_revisions"?"settings":"detail"});return}if(g==="collections"){Nt({libraryId:k,target:"all_cards",collectionId:C,revisionId:ie,revisionView:Ne,infoId:o.infoId,infoView:"collections"});return}Nt({libraryId:k,target:W?T:"all_collections",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection",label:l.layers.collection,visible:mt&&pe!=="create",value:C??"",selectedLabel:(ye==null?void 0:ye.name)??l.path.noCollectionSelected,disabled:!Ee||P||N.length===0,options:N.map(g=>({value:g.collectionId,label:g.name})),emptyOption:l.selectCollectionOption,onSelect:g=>{const se=g||void 0,U=W?T:"all_collections";Nt({libraryId:k,target:U,collectionId:se,revisionId:void 0,revisionView:U==="all_revisions"?"settings":"detail"})}},{key:"collection_selected_action",label:l.layers.revision,visible:nt,value:T==="all_revisions"?"revisions":Y==="graph"?"edit":Y==="settings"||Y==="run"||Y==="shared"?"revisions":(o.collectionView??"infos")==="overview"?"overview":"infos",selectedLabel:T==="all_revisions"?l.targets.allRevisions:Y==="graph"?"Edytuj":Y==="settings"||Y==="run"||Y==="shared"?l.targets.allRevisions:(o.collectionView??"infos")==="overview"?"Przegląd":"Informacje",disabled:!C,options:[{value:"overview",label:"Przegląd"},{value:"edit",label:"Edytuj"},{value:"infos",label:"Informacje"},{value:"revisions",label:l.targets.allRevisions}],onSelect:g=>{if(C){if(g==="edit"){Nt({libraryId:k,target:W?T:"all_collections",collectionId:C,revisionId:void 0,revisionView:"graph"});return}if(g==="revisions"){Nt({libraryId:k,target:W?T:"all_collections",collectionId:C,revisionId:ie,revisionView:"settings"});return}Nt({libraryId:k,target:W?T:"all_collections",collectionId:C,revisionId:void 0,revisionView:"detail",infoId:o.infoId,infoView:o.infoView,collectionView:g==="overview"?"overview":"infos"})}}},{key:"revision_mode",label:l.layers.revision,visible:zt,value:Ne==="new"?"create":!ie&&Y==="shared"?"shared":"search",selectedLabel:Ne==="new"?l.revisionForm.createAction:!ie&&Y==="shared"?l.targets.sharedRevisions:l.infoActions.search,disabled:T==="all_revisions"?!Ee:!_e,options:[{value:"search",label:l.infoActions.search},{value:"create",label:l.revisionForm.createAction},{value:"shared",label:l.targets.sharedRevisions}],onSelect:g=>{Nt({libraryId:k,target:W?T:"all_revisions",collectionId:T==="all_revisions"?void 0:C,revisionId:void 0,revisionView:g==="create"?"new":g==="shared"?"shared":"settings"})}},{key:"revision_entry",label:l.layers.revision,visible:zt,value:ie??"",selectedLabel:(M==null?void 0:M.name)??l.status.noRevisions,disabled:(T==="all_revisions"?!Ee:!_e)||z||Z.length===0,options:Z.map(g=>({value:g.revisionId,label:g.name})),emptyOption:l.status.noRevisions,onSelect:g=>{Nt({libraryId:k,target:W?T:"all_collections",collectionId:C,revisionId:g||void 0,revisionView:Y==="settings"||Y==="run"||Y==="shared"?Y:"settings"})}},{key:"revision_selected_action",label:l.layers.revision,visible:It,value:Y==="run"?"run":Y==="shared"?"shared":"settings",selectedLabel:Y==="run"?l.revisions.run:Y==="shared"?l.targets.sharedRevisions:l.infoActions.edit,disabled:!ie,options:[{value:"settings",label:l.infoActions.edit},{value:"run",label:l.revisions.run},{value:"shared",label:l.targets.sharedRevisions}],onSelect:g=>{ie&&Nt({libraryId:k,target:W?T:"all_collections",collectionId:C,revisionId:ie,revisionView:g==="run"?"run":g==="shared"?"shared":"settings"})}}],[N,P,ce,v,w,G,Nt,Z,z,ye,C,de,M,ie,ge,_e,Ee,X,W,k,Ke,Ne,T,Y,ne,Be,mt,nt,zt,It,Ce,t.cogita.library.list.selectedEmpty,o.infoId,o.infoView,o.collectionView,l.infoActions.edit,l.infoActions.overview,l.infoActions.seeCards,l.layers.collection,l.layers.library,l.layers.revision,l.layers.target,l.noLibraryOption,l.path.noCollectionSelected,l.path.noLibrarySelected,l.selectCollectionOption,l.targets.allRevisions,l.infoActions.search,l.revisionForm.createAction,l.revisions.run,l.targets.sharedRevisions,pe]),St=n.useMemo(()=>Mt.filter(g=>g.visible),[Mt]),ut=n.useMemo(()=>St.filter(g=>g.key!=="library"&&g.key!=="collection"),[St]),Kt=n.useMemo(()=>ut.find(g=>g.key==="target")??null,[ut]),lt=n.useMemo(()=>ut.find(g=>g.key==="info_mode")??null,[ut]),Ye=n.useMemo(()=>ut.find(g=>g.key==="info_selected_action")??null,[ut]),Tt=n.useMemo(()=>ut.find(g=>g.key==="collection_mode")??null,[ut]),Gt=n.useMemo(()=>ut.find(g=>g.key==="revision_mode")??null,[ut]),qt=n.useMemo(()=>ut.find(g=>g.key==="collection_selected_action")??null,[ut]),Ot=n.useMemo(()=>ut.find(g=>g.key==="revision_entry")??null,[ut]),me=n.useMemo(()=>ut.find(g=>g.key==="revision_selected_action")??null,[ut]),Et=n.useCallback((g,se)=>g?e.jsx("div",{className:"cogita-sidebar-actions",children:g.options.map(U=>e.jsx("button",{type:"button",className:`ghost ${String(g.value)===U.value?"active":""}`,onClick:()=>g.onSelect(U.value),disabled:g.disabled,title:U.label,children:fa(U.label,$a)},`${se}:${g.key}:${U.value}`))}):null,[]),Zt=n.useMemo(()=>{const g=o.libraryId;if(!g||!b.pathname.startsWith("/cogita/library/"))return null;const se={copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,libraryId:g};if(o.target==="library_overview")return e.jsx(ci,{...se});if(o.target==="all_cards")return o.infoId&&o.infoView==="cards"?e.jsx(Di,{...se,infoId:o.infoId,selectedReviewerRoleId:at||null}):e.jsx(ji,{...se,mode:o.cardMode??"list"});if(o.target==="new_card")return e.jsx(Li,{...se,editInfoId:o.infoId});if(o.target==="dependencies")return e.jsx($i,{...se});if(o.target==="transfer")return e.jsx(qi,{...se});if(o.target==="storyboards"||o.target==="new_storyboard")return e.jsx(Ui,{...se});if(o.target==="texts"||o.target==="new_text")return e.jsx(Ji,{...se});if(o.target==="all_collections"||o.target==="all_revisions"){if(o.target==="all_revisions"&&!o.collectionId)return o.revisionView==="run"?e.jsx(zn,{...se,revisionId:o.revisionId}):e.jsx(zs,{...se,revisionId:o.revisionId});if(!o.collectionId&&o.revisionView==="run")return e.jsx(zn,{...se,revisionId:o.revisionId});if(o.collectionId){const U={...se,collectionId:o.collectionId};return o.revisionView==="graph"?e.jsx(vo,{...U}):o.revisionView==="shared"?e.jsx(Vi,{...se,collectionId:o.collectionId}):o.revisionView==="settings"?e.jsx(zs,{...U,revisionId:o.revisionId}):o.revisionView==="run"?e.jsx(zn,{...U,revisionId:o.revisionId}):e.jsx(Qi,{...U})}return e.jsx(Hi,{...se})}return o.target==="new_collection"?e.jsx(Xi,{...se,onCreated:U=>{Nt({libraryId:g,target:T==="all_revisions"?"all_revisions":"all_collections",collectionId:U,revisionId:void 0,revisionView:"graph"})}}):null},[a,Nt,t,m,b.pathname,d,j,u,y,r,i,o.cardMode,o.collectionId,o.infoId,o.libraryId,o.revisionId,o.revisionView,o.target,c,s,T,at]);n.useEffect(()=>{let g=!1;return(async()=>{var U,et,ht,ft,$t;D(!0);try{await Dr();const[At,Ct,Pt]=await Promise.all([Gs(),Xs(),Br()]);if(g)return;h(At);const ha=new Set(Pt.nodes.filter(vt=>vt.nodeType==="role"&&vt.canLink).map(vt=>vt.roleId??"")),ma=No(Ct,ha);if(V(ma),ma){const vt=Pt.nodes.find(Dt=>Dt.nodeType==="data"&&Dt.roleId===ma&&(Dt.fieldType===Vn||Dt.label===Vn));be((vt==null?void 0:vt.dataKeyId)??null),p.current=So(vt==null?void 0:vt.value)}const _t=(U=At.find(vt=>vt.libraryId===o.libraryId))==null?void 0:U.libraryId,na=_t?(ht=(et=p.current.byLibrary)==null?void 0:et[_t])==null?void 0:ht.lastTarget:void 0,Ta=ko(na)?na:"library_overview";H(_t),ee(o.target??Ta),he(o.revisionId??(_t?($t=(ft=p.current.byLibrary)==null?void 0:ft[_t])==null?void 0:$t.lastRevisionId:void 0)),Ge(o.revisionView??"detail"),S.current=!0}catch{g||Ie(l.status.loadFailed)}finally{g||D(!1)}})(),()=>{g=!0}},[l.status.loadFailed]),n.useLayoutEffect(()=>{if(S.current){if(!o.libraryId){H(void 0),ee(o.target??"library_overview"),$(void 0),he(void 0),Ge("detail");return}o.libraryId&&w.some(g=>g.libraryId===o.libraryId)&&H(o.libraryId),o.target&&ee(o.target),$(o.collectionId),he(o.revisionId),o.revisionView&&Ge(o.revisionView)}},[w,o.collectionId,o.libraryId,o.revisionId,o.revisionView,o.target]),n.useEffect(()=>{if(!k){A([]),$(void 0),x([]),_([]),he(void 0);return}let g=!1;return J(!0),Ua({libraryId:k,limit:200}).then(se=>{var ht;if(g)return;const U=se.items;A(U);const et=(ht=U.find(ft=>ft.collectionId===o.collectionId))==null?void 0:ht.collectionId;$(et)}).catch(()=>{g||(A([]),$(void 0))}).finally(()=>{g||J(!1)}),()=>{g=!0}},[o.collectionId,k]),n.useEffect(()=>{if(!k||ne!=="all_cards"&&T!=="new_card"){x([]);return}let g=!1;return ts({libraryId:k,limit:200}).then(se=>{g||x(se)}).catch(()=>{g||x([])}),()=>{g=!0}},[ne,k,T]),n.useEffect(()=>{if(!k||T!=="all_revisions"&&!C){_([]),T!=="all_revisions"&&he(void 0);return}let g=!1;return le(!0),Zn({libraryId:k,collectionId:T==="all_revisions"?void 0:C}).then(se=>{var ht,ft,$t,At;if(g)return;_(se);const U=(ft=(ht=p.current.byLibrary)==null?void 0:ht[k])==null?void 0:ft.lastRevisionId,et=(($t=se.find(Ct=>Ct.revisionId===o.revisionId))==null?void 0:$t.revisionId)??((At=se.find(Ct=>Ct.revisionId===U))==null?void 0:At.revisionId);he(et)}).catch(()=>{g||(_([]),he(void 0))}).finally(()=>{g||le(!1)}),()=>{g=!0}},[o.revisionId,C,k,T]),n.useEffect(()=>{const g=o.infoId;if(!k||!g){R(void 0);return}let se=!1;return aa({libraryId:k,infoId:g}).then(U=>{if(se)return;const et=U.payload??{},ht=et.definition&&typeof et.definition=="object"?et.definition:null,ft=typeof(ht==null?void 0:ht.title)=="string"?ht.title:void 0,$t=typeof(ht==null?void 0:ht.question)=="string"?ht.question:void 0,At=typeof et.label=="string"?et.label:void 0,Ct=typeof et.name=="string"?et.name:void 0,Pt=typeof et.title=="string"?et.title:void 0;R(ft??$t??At??Ct??Pt??U.infoId)}).catch(()=>{se||R(g)}),()=>{se=!0}},[o.infoId,k]),n.useEffect(()=>{if(!S.current||o.libraryId&&w.some(ht=>ht.libraryId===o.libraryId)&&o.libraryId!==k||o.target&&o.target!==T||o.revisionView&&o.revisionView!==Ne||o.revisionId&&o.revisionId!==ie||Un[T].requiresCollection&&!C&&(o.target==="all_collections"||o.target==="all_revisions")&&o.collectionId)return;const g=ba(`${b.pathname}${b.search}`);if(ba(b.pathname)==="/cogita"&&!o.libraryId&&!k){q.current=null;return}if(ba(b.pathname)==="/cogita/persons"){q.current=null;return}if(ba(b.pathname)===`/cogita/library/${k}/revision/run`&&o.revisionView==="run"&&!o.collectionId&&(T==="all_collections"||T==="all_revisions")&&Ne==="run"&&!C){q.current=null;return}const et=ba(Vs(k,T,C,Ne,ie,o.infoId,o.infoView??"overview",o.collectionView??"infos"));if(g===et){q.current=null;return}q.current!==et&&(q.current=et,d(et,{replace:!0}))},[w,b.pathname,b.search,d,o.collectionId,o.infoId,o.infoView,o.collectionView,o.libraryId,o.revisionId,o.revisionView,o.target,C,k,ie,Ne,T]),n.useEffect(()=>{if(typeof window>"u")return;const g=()=>{window.innerWidth>920&&L(!1)};return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),n.useEffect(()=>{if(!S.current||!qe||!k||E.current)return;const g=p.current,se={...g.byLibrary??{}},U={...se[k]??{},lastCollectionId:C,lastRevisionId:ie,lastRevisionView:Ne,lastTarget:T},et={version:1,lastLibraryId:k,byLibrary:{...se,[k]:U}},ht=JSON.stringify(g),ft=JSON.stringify(et);if(ht===ft)return;p.current=et,E.current=!0,(async()=>{try{if(te)await zr(te,{plainValue:ft});else{const At=await Or(qe,{itemName:Vn,itemType:"data",plainValue:ft});be(At.dataItemId)}}catch{Ie(l.status.savePrefsFailed)}finally{E.current=!1}})()},[te,qe,C,k,ie,Ne,T,l.status.savePrefsFailed]);const Ut=async()=>{const g=it.trim();if(!g){Ie(t.cogita.user.libraryNameRequired);return}Ie(null);try{const se=await qr({name:g});h(U=>[se,...U]),H(se.libraryId),ee("library_overview"),$(void 0),$e("")}catch{Ie(t.cogita.user.libraryCreateFailed)}},B=async()=>{if(!k||!C){Ie(l.status.selectLibraryFirst);return}const g=He.trim();if(!g){Ie(l.revisionForm.nameLabel);return}Ie(null);try{const se=await Vr({libraryId:k,collectionId:C,name:g,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});_(U=>[se,...U]),he(se.revisionId),ee(T==="all_revisions"?"all_revisions":"all_collections"),Ge("settings"),Re("")}catch{Ie(l.status.loadFailed)}};return e.jsx(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,headerExtra:e.jsxs("div",{className:"cogita-header-reviewer-actions",children:[e.jsxs("label",{className:"cogita-header-reviewer",children:[e.jsx("span",{children:"Person"}),e.jsxs("select",{value:at,disabled:!k,onChange:g=>{const se=g.target.value;if(se==="__new_person__"){d("/cogita/persons");return}Le(se)},children:[e.jsx("option",{value:"",children:k?"No person":"Select library first"}),rt.map(g=>e.jsx("option",{value:g.roleId,children:g.label},g.roleId)),e.jsx("option",{value:"__new_person__",children:"+ Create new person"})]})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>d("/cogita/persons"),children:"Persons"})]}),children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${F?"open":""}`,"aria-label":l.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{title:(X==null?void 0:X.name)??l.path.noLibrarySelected,children:fa((X==null?void 0:X.name)??l.path.noLibrarySelected,$a)}),e.jsx("p",{className:"cogita-sidebar-note",children:X?l.sidebar.libraryActionsHint:l.status.selectLibraryFirst}),Et(Kt,"sidebar"),T==="all_revisions"&&Ot?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:l.targets.allRevisions}),Et(Gt,"sidebar"),Et(Ot,"sidebar"),me?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:(M==null?void 0:M.name)??l.status.noRevisions,children:fa((M==null?void 0:M.name)??l.status.noRevisions,$a)}),Et(me,"sidebar")]}):null]}):null,lt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:l.sidebar.infoActionsHint}),Et(lt,"sidebar"),Ye?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:(de==null?void 0:de.label)??ge??t.cogita.library.list.selectedEmpty,children:fa((de==null?void 0:de.label)??ge??t.cogita.library.list.selectedEmpty,$a)}),e.jsx("p",{className:"cogita-sidebar-note",children:l.sidebar.selectedInfoActionsHint}),Et(Ye,"sidebar")]}):null]}):null,Tt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:l.sidebar.collectionActionsHint}),Et(Tt,"sidebar"),ye&&qt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:ye.name,children:fa(ye.name,$a)}),Et(qt,"sidebar"),T!=="all_revisions"&&Ot?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:l.targets.allRevisions}),Et(Gt,"sidebar"),Et(Ot,"sidebar"),me?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",title:(M==null?void 0:M.name)??l.status.noRevisions,children:fa((M==null?void 0:M.name)??l.status.noRevisions,$a)}),Et(me,"sidebar")]}):null]}):null]}):null]}):null]}),e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:l.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:r,children:l.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{y("cogita"),L(!1)},children:l.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:i,children:c?t.account.secureModeDisable:t.account.secureModeEnable}),e.jsx("button",{type:"button",className:"ghost",disabled:!k,onClick:()=>{k&&(d(`/cogita/live-sessions/${encodeURIComponent(k)}`),L(!1))},children:t.cogita.library.revision.live.hostTitle})]})]})]}),F?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":l.sidebar.closeMenu,onClick:()=>L(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":l.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>L(g=>!g),"aria-label":F?l.sidebar.closeMenu:l.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),St.map((g,se)=>e.jsxs("div",{className:"cogita-browser-segment",children:[se>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,g.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":g.label,title:g.selectedLabel,children:fa(g.selectedLabel,Os)}):e.jsxs("select",{"aria-label":g.label,value:g.value,onChange:U=>g.onSelect(U.target.value),disabled:g.disabled,children:[g.emptyOption?e.jsx("option",{value:"",children:g.emptyOption}):null,g.options.map(U=>e.jsx("option",{value:U.value,title:U.label,children:fa(U.label,Os)},`${g.key}:${U.value}`))]})]},`menu:${g.key}`))]}),Zt?e.jsxs(e.Fragment,{children:[(T==="all_collections"||T==="all_revisions")&&Ne==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:l.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.actions.collections}),e.jsxs("select",{value:C??"",onChange:g=>$(g.target.value||void 0),children:[e.jsx("option",{value:"",children:l.selectCollectionOption}),N.map(g=>e.jsx("option",{value:g.collectionId,children:g.name},g.collectionId))]})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:l.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:He,onChange:g=>Re(g.target.value),placeholder:l.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:B,children:l.revisionForm.createAction}),xe?e.jsx("p",{className:"cogita-form-error",children:xe}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(sr.Provider,{value:!0,children:Zt})})]}):null,Zt?null:e.jsxs(e.Fragment,{children:[Q?e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Oi,{copy:t,onPersonCreated:g=>{tt(se=>se+1)}})}):null,!k&&!Q?e.jsxs("section",{className:"cogita-browser-intro",children:[e.jsx("div",{className:"cogita-browser-intro-main",children:e.jsxs("article",{className:"cogita-browser-panel cogita-browser-tutorial",children:[e.jsxs("div",{className:"cogita-browser-tutorial-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-browser-tutorial-step",children:Je.step}),e.jsx("h2",{children:Je.title})]}),e.jsxs("p",{children:[yt+1," / ",dt]})]}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-lead",children:Je.lead}),e.jsx("div",{className:"cogita-browser-tutorial-passages",children:Je.passages.map(g=>e.jsx("p",{children:g},g))}),e.jsx("div",{className:"cogita-browser-tutorial-focus",children:Je.focus.map(g=>e.jsx("span",{children:g},g))}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-action",children:Je.action}),e.jsx("div",{className:"cogita-browser-tutorial-progress",role:"list","aria-label":"Tutorial progress",children:bt.map((g,se)=>e.jsx("button",{type:"button",className:`ghost ${se===yt?"active":""}`,onClick:()=>Xe(se),"aria-label":`${se+1}`,children:se+1},`tutorial:${g.title}:${se}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:yt===0,onClick:()=>Xe(g=>Math.max(0,g-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"cta",disabled:yt===dt-1,onClick:()=>Xe(g=>Math.min(dt-1,g+1)),children:"Next"})]})]})}),e.jsxs("div",{className:"cogita-browser-intro-side",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.createLibraryTitle}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:it,onChange:g=>$e(g.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ut,children:t.cogita.user.createLibraryAction}),xe?e.jsx("p",{className:"cogita-form-error",children:xe}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.availableLibraries}),w.length===0?e.jsx("p",{className:"cogita-browser-note",children:t.cogita.user.noLibraries}):null,w.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:w.map(g=>e.jsxs("button",{type:"button",className:"cogita-card-item",onClick:()=>{Nt({libraryId:g.libraryId,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.user.libraryRoleLabel}),e.jsx("h3",{className:"cogita-card-title",children:g.name})]},g.libraryId))}):null]})]})]}):null]})]})]})})}const Oo=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:To},Symbol.toStringTag,{value:"Module"}));function Co({copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,shareId:d}){const[b,o]=n.useState(null),[l,w]=n.useState("loading"),[h,N]=n.useState(t.cogita.library.collections.defaultName),[A,v]=n.useState("Cogita Library"),[x,Z]=n.useState([]),[_,k]=n.useState([]),[H,T]=n.useState("idle"),[ee,C]=n.useState({current:0,total:0}),[$,ie]=n.useState(0),[he,Ne]=n.useState(""),[Ge,ge]=n.useState(null),[R,F]=n.useState(null),[L,G]=n.useState(null),[D,P]=n.useState(null),[J,z]=n.useState([]),[le,xe]=n.useState({}),[Ie,Me]=n.useState({}),[Xe,it]=n.useState(null),[$e,Ve]=n.useState(null),[kt,He]=n.useState(null),[Re,rt]=n.useState(null),[gt,at]=n.useState({}),Le=n.useRef(0),[Ue,tt]=n.useState(null),qe=n.useRef(null),V=n.useRef(null),[te,be]=n.useState(null),[p,S]=n.useState(!1),[E,q]=n.useState(null),[X,ye]=n.useState([]),[Q,M]=n.useState(null),ke=n.useRef(null),ne=n.useRef(null),[Y,W]=n.useState(null),[pe,ce]=n.useState(0),de=n.useRef(null),Ce=n.useRef({}),[Be,Ke]=n.useState(!1),[Ee,bt]=n.useState({}),dt=n.useRef(null),yt=n.useRef(new Set),Je=n.useRef({}),[_e,mt]=n.useState([]),[nt,pt]=n.useState(new Set),[zt,It]=n.useState(!1),Nt=Ea(),Mt=n.useMemo(()=>new URLSearchParams(Nt.search),[Nt.search]),St=n.useMemo(()=>Mt.get("key")??"",[Mt]),ut=(b==null?void 0:b.mode)??"random",Kt=(b==null?void 0:b.check)??"exact",lt=(b==null?void 0:b.limit)??20,Ye=n.useMemo(()=>ls((b==null?void 0:b.revisionType)??ut),[b,ut]),Tt=n.useMemo(()=>{const K=b==null?void 0:b.revisionSettings,oe=dr(Ye,Mt);return kn(Ye,K??oe)},[b,Mt,Ye]),Gt=n.useMemo(()=>t.cogita.library.revision[Ye.labelKey]??ut,[t,ut,Ye]),qt=n.useMemo(()=>Kt==="exact"?t.cogita.library.revision.checkValue:Kt,[t,Kt]),me=l==="ready"?x[$]??null:null,Et=(me==null?void 0:me.checkType)==="translation-match"&&Re,Zt=n.useRef(new Map),Ut=n.useRef(new Map),B=n.useRef(new Map),g=n.useRef(new Map),se=n.useMemo(()=>me?me.cardType==="vocab"?t.cogita.library.revision.vocabLabel:me.infoType?ot(t,me.infoType):t.cogita.library.revision.infoLabel:"",[t,me]),U=n.useMemo(()=>{var oe;return Ye.id!=="levels"?x.length:((oe=Ee.pool)==null?void 0:oe.length)??Ye.getFetchLimit(lt,Tt)},[Ee,Tt,Ye,x.length,lt]),et=Ye.getProgressTotal?Ye.getProgressTotal(x,Ee,lt,Tt):Ye.id==="levels"?Math.min(lt,U):x.length,ht=et?Math.min($+1,et):0,ft=Math.max(1,Number(Tt.tries??1)),$t=Tt.compare??"anchors",At=Math.max(0,Math.min(100,Number(Tt.minCorrectness??0))),Ct=(Tt.considerDependencies??"on")==="on",Pt=Math.max(0,Math.min(100,Number(Tt.dependencyThreshold??85))),ha=K=>{const oe=K.slice();for(let je=oe.length-1;je>0;je-=1){const De=Math.floor(Math.random()*(je+1));[oe[je],oe[De]]=[oe[De],oe[je]]}return oe},ma=K=>xa(K,{treatSimilarCharsAsSame:!0})>=At,_t=async()=>{const K=await da(),oe=new Map,je=new Map;K.forEach(we=>{const Fe=`${we.itemType}:${we.itemId}`,Ae=ta(we.itemType,we.itemId,we.checkType,we.direction);oe.has(Fe)||oe.set(Fe,[]),oe.get(Fe).push(we),je.has(Ae)||je.set(Ae,[]),je.get(Ae).push(we)});const De=new Map,ze=new Map;return oe.forEach((we,Fe)=>De.set(Fe,ca(we).score)),je.forEach((we,Fe)=>ze.set(Fe,ca(we).score)),{itemKnowness:De,cardKnowness:ze}},na=async K=>{const oe=Ee,je=K.concat(oe.active??[]).concat(oe.pool??[]).filter((f,I,O)=>O.findIndex(ue=>Te(ue)===Te(f))===I);if(!Ct){pt(new Set(je.map(Te)));return}const{itemKnowness:De,cardKnowness:ze}=await _t(),we=f=>{if(f.cardType!=="info"||f.infoType!=="citation"||f.checkType!=="quote-fragment")return!0;const I=Wt(f.direction);if(!(I!=null&&I.fragmentId))return!0;const O=f.description??"";if(!O.trim())return!0;const fe=va(O).nodes[I.fragmentId];if(!fe||!fe.leftId&&!fe.rightId)return!0;const re=[fe.leftId,fe.rightId].filter(Se=>!!Se);if(re.length===0)return!0;const ve=re.map(Se=>{const Oe=ta("info",f.cardId,"quote-fragment",Se);return ze.get(Oe)??0});return ve.reduce((Se,Oe)=>Se+Oe,0)/ve.length>=Pt},Fe=(b==null?void 0:b.collectionId)??null,Ae=Fe?_e.filter(f=>Lt(f.childItemType)==="collection"&&f.childItemId===Fe&&!Lt(f.childCheckType)&&!Lt(f.childDirection)):[],Pe=Fe&&je.length>0?je.reduce((f,I)=>f+(ze.get(Te(I))??0),0)/je.length:0,Ze=new Set;for(const f of je){if(f.cardType!=="info"){Ze.add(Te(f));continue}if(!we(f))continue;const I=_e.filter(fe=>br(fe,f)).concat(Ae);if(I.length===0){Ze.add(Te(f));continue}let O=0;for(const fe of I)if(Lt(fe.parentItemType)==="collection")O+=fe.parentItemId===Fe?Pe:0;else if(Lt(fe.parentCheckType)||Lt(fe.parentDirection)){const re=Lt(fe.parentCheckType),ve=Lt(fe.parentDirection),ae=ta(fe.parentItemType,fe.parentItemId,re,ve);O+=ze.get(ae)??0}else{const re=`${fe.parentItemType}:${fe.parentItemId}`;O+=De.get(re)??0}O/I.length>=Pt&&Ze.add(Te(f))}pt(Ze)},Ta=K=>{for(let oe=K;oe<x.length;oe+=1){const je=x[oe];if(je&&(!Ct||je.cardType!=="info"||nt.has(Te(je))))return oe}return-1},vt=K=>!Ct||K.cardType!=="info"||nt.has(Te(K)),Dt=K=>{if(Ye.id!=="temporal"&&Ye.id!=="levels")return null;const oe=Ee,je=(oe.active??[]).concat(oe.pool??[]),De=new Set;for(const ze of je){const we=Te(ze);if(!(De.has(we)||K.has(we))&&(De.add(we),vt(ze)))return ze}return null},ea=n.useMemo(()=>{if(Ye.id!=="levels")return null;const K=Ee,oe=K.pool??[],je=K.active??[],De=K.levelMap??{},ze=Math.max(1,Number(Tt.levels??1)),we=Array.from({length:ze},()=>0),Fe=new Set(je.map(f=>Te(f)));oe.forEach(f=>{const I=Math.min(ze,Math.max(1,De[Te(f)]??1));we[I-1]+=1});const Ae=oe.length||1,Pe=we.map(f=>f/Ae*100),Ze=me?De[Te(me)]??1:null;return{counts:we,percentages:Pe,currentLevel:Ze,levelsCount:ze,activeCount:je.length,poolCount:oe.length,activeSet:Fe}},[Ee,Tt,Ye,me]),ja=n.useMemo(()=>{if(Ye.id!=="temporal")return null;const K=Ee,oe=K.pool??[],je=K.active??[],De=K.knownessMap??{},ze=new Set(K.unknownSet??[]);let we=0;oe.forEach(Pe=>{(De[Te(Pe)]??0)>1&&(we+=1)});const Fe=ze.size,Ae=je.map(Pe=>({id:Te(Pe),value:ze.has(Te(Pe))?0:Math.max(0,Math.min(1,De[Te(Pe)]??0))}));return{knownCount:we,unknownCount:Fe,dots:Ae}},[Ee,Ye]),Ga=n.useMemo(()=>{if(!Ct)return 0;const K=Ee;return x.concat(K.active??[]).concat(K.pool??[]).filter((je,De,ze)=>ze.findIndex(we=>Te(we)===Te(je))===De).filter(je=>je.cardType==="info"&&!nt.has(Te(je))).length},[Ct,Ee,x,nt]);n.useEffect(()=>{if(!Ct||H!=="ready")return;const K=Ee,je=x.concat(K.active??[]).concat(K.pool??[]).filter((we,Fe,Ae)=>Ae.findIndex(Pe=>Te(Pe)===Te(we))===Fe).filter(we=>we.cardType!=="info"||nt.has(Te(we))).length,De=ke.current;if(ke.current=je,De===null||je<=De)return;const ze=je-De;M(`New card available (+${ze})`),ne.current&&window.clearTimeout(ne.current),ne.current=window.setTimeout(()=>M(null),2200)},[Ct,H,Ee,x,nt]),n.useEffect(()=>()=>{ne.current&&window.clearTimeout(ne.current)},[]);const Yt=(K,oe)=>{const je=Ye.applyOutcome({queue:x,meta:Ee},me,lt,Tt,{correct:K,correctness:oe,createdUtc:new Date().toISOString()});Z(je.queue),bt(je.meta);const De=je.queue[$+1];De&&Vt(De,$+1)};n.useEffect(()=>{if(!d){w("error");return}w("loading"),Ur({shareId:d,key:St}).then(K=>{o(K),N(K.collectionName),v(K.libraryName),w("ready")}).catch(()=>{w("error")})},[d,St]),n.useEffect(()=>{d&&Jr({shareId:d,key:St,type:"language"}).then(K=>k(K)).catch(()=>k([]))},[d,St]),n.useEffect(()=>{!d||l!=="ready"||Hr({shareId:d,key:St}).then(K=>mt(K.items??[])).catch(()=>mt([]))},[d,St,l]),n.useEffect(()=>{if(!d||l!=="ready")return;let K=!0;return(async()=>{T("loading"),C({current:0,total:Ye.id==="levels"?0:Ye.getFetchLimit(lt,Tt)});try{const je=[];let De=null,ze=null;do{const I=await Qr({shareId:d,key:St,limit:300,cursor:De});if(je.push(...I.items),(Ye.id==="levels"||Ye.id==="temporal")&&I.total&&(ze=I.total),C(O=>({current:je.length,total:O.total||I.total||Ye.getFetchLimit(lt,Tt)})),De=I.nextCursor??null,ze!==null&&je.length>=ze||Ye.id!=="levels"&&Ye.id!=="temporal"&&je.length>=Ye.getFetchLimit(lt,Tt))break}while(De);if(!K)return;const we=qa(je);let Fe;if(Ye.id==="levels"){const I=Math.max(1,Number(Tt.levels??1));Fe={},we.forEach(O=>{const ue=Te(O);Fe[ue]=Math.max(1,Math.min(I,1))})}let Ae=null,Pe=null,Ze=null;if(Ye.id==="temporal"){const I=await da(),O=new Set(we.map(re=>Te(re))),ue=I.reduce((re,ve)=>{const ae=ta(ve.itemType,ve.itemId,ve.checkType,ve.direction);return O.has(ae)&&(re[ae]||(re[ae]=[]),re[ae].push(ve)),re},{});Ae={},Pe=new Set,Ze={};const fe=Date.now();we.forEach(re=>{const ve=Te(re),ae=ue[ve]??[];if(ae.length===0){Ae[ve]=0,Pe.add(ve),Ze[ve]=[];return}const Se=rs(ae);Ze[ve]=Se;const Oe=jn(Se,fe);Ae[ve]=Oe.knowness})}const f=Ye.id==="levels"?os(we,lt,Tt,Fe):Ye.id==="temporal"?is(we,lt,Tt,Ae??{},Pe??new Set,Ze??{}):Ye.prepare(we,lt,Tt);Z(f.queue),bt(f.meta),ie(0),T("ready"),C(I=>({current:Math.min(I.current,I.total),total:I.total}))}catch{K&&T("error")}})(),()=>{K=!1}},[d,St,lt,Ye,Tt,l]),n.useEffect(()=>{na(x)},[x,_e,Ct,Pt,b==null?void 0:b.collectionId]),n.useEffect(()=>{if(!me||!Ct){It(!1);return}if(me.cardType!=="info"||nt.has(Te(me))){It(!1);return}const K=Ta($+1);if(K>=0){It(!1),ie(K);return}if(Ye.id==="temporal"||Ye.id==="levels"){const oe=x.slice(0,$+1),je=x.slice($+1).filter(vt),De=oe.concat(je),ze=new Set(De.map(Te)),we=Dt(ze);if(we){const Ae=Te(we);ze.has(Ae)||(De.push(we),ze.add(Ae),bt(Pe=>{const Ze=Pe,f=new Set(Ze.queued??[]);return f.add(Ae),{...Ze,queued:f}}))}const Fe=De.findIndex((Ae,Pe)=>Pe!==$&&vt(Ae));if(Fe>=0){Z(De),ie(Fe),It(!1);return}}It(!0)},[me,nt,Ct,$,x,Ee,Ye.id]),n.useEffect(()=>{if(Ne(""),ge(null),W(null),ce(0),z([]),xe({}),Me({}),it(null),Ve(null),He(null),S(!1),Ke(!1),be(null),rt(null),at({}),!me){F(null),G(null);return}me.cardType==="info"&&me.infoType==="computed"&&F(t.cogita.library.revision.loadingComputed);let K=!0;return Vt(me,$).then(oe=>{!K||!oe||(F(oe.prompt),G(oe.expectedAnswer),z(oe.computedExpected),xe(oe.computedAnswers),it(oe.answerTemplate),Ve(oe.outputVariables),He(oe.variableValues))}),()=>{K=!1}},[me,d,t]),n.useEffect(()=>{if(!me||me.cardType!=="info"||me.infoType!=="citation"){dt.current=null,yt.current=new Set,P(null);return}const K=me.description??"",oe=(me.label??"").trim(),je=oe.replace(/\s+/g," ").trim(),De=K.replace(/\s+/g," ").trim(),ze=je&&je!==De?oe:t.cogita.library.infoTypes.citation;if(!K){P(null),G(null);return}const we=va(K);dt.current=we,F(ze);let Fe=!0;return da().then(Ae=>{if(!Fe)return;const Pe=new Map;Ae.forEach(ue=>{if(ue.itemType!=="info"||ue.checkType!=="quote-fragment"||!ue.direction)return;const fe=Wt(ue.direction);if(!fe)return;const re=`${ue.itemId}:${fe.fragmentId}`;Pe.has(re)||Pe.set(re,[]),Pe.get(re).push(ue)});const Ze={},f=new Set;Pe.forEach((ue,fe)=>{const[re,ve]=fe.split(":",2);if(re!==me.cardId)return;const ae=ca(ue).score;Ze[ve]=ae,ae>=Pt&&f.add(ve)}),yt.current=f,Je.current=Ze;const I=Wt(me.direction);if(I!=null&&I.fragmentId&&we.nodes[I.fragmentId]){ra(we,I.fragmentId,ze);return}const O=Ra(we,f,Ze,Pt,Ct,me.direction);ra(we,(O==null?void 0:O.id)??null,ze)}).catch(()=>{yt.current=new Set,Je.current={};const Ae=Wt(me.direction);if(Ae!=null&&Ae.fragmentId&&we.nodes[Ae.fragmentId]){ra(we,Ae.fragmentId,ze);return}const Pe=Ra(we,yt.current,{},Pt,Ct,me.direction);ra(we,(Pe==null?void 0:Pe.id)??null,ze)}),()=>{Fe=!1}},[me,t,Ct,Pt]),n.useEffect(()=>{if(!me||me.cardType!=="vocab"||me.checkType!=="translation-match"){rt(null),at({});return}const je=(Ee.pool??Ee.active??x).filter(Ae=>Ae.cardType==="vocab"&&Ae.checkType==="translation-match").filter((Ae,Pe,Ze)=>Ze.findIndex(f=>f.cardId===Ae.cardId)===Pe);je.some(Ae=>Ae.cardId===me.cardId)||je.unshift(me);const ze=ha(je).slice(0,6).map(Ae=>{const Pe=Ae.label.split("↔").map(I=>I.trim()).filter(Boolean);if(Pe.length<2)return null;const Ze=`${Ae.cardId}:L`,f=`${Ae.cardId}:R`;return{cardId:Ae.cardId,leftId:Ze,rightId:f,leftLabel:Pe[0],rightLabel:Pe[1]}}).filter(Boolean),we=ze.map(Ae=>Ae.leftId),Fe=ha(ze.map(Ae=>Ae.rightId));rt({pairs:ze,leftOrder:we,rightOrder:Fe,selection:{},activeLeft:null,activeRight:null,locked:{}})},[me,x,Ee]),n.useEffect(()=>()=>{qe.current&&window.clearTimeout(qe.current),V.current&&window.clearTimeout(V.current)},[]);const Ca=n.useRef(null);n.useEffect(()=>{if(!me)return;const K=Te(me),oe=typeof document<"u"?document.activeElement:null;if(Ca.current===K&&oe&&(oe.tagName==="INPUT"||oe.tagName==="TEXTAREA"))return;let je=0;const De=()=>{if(me){if(me.cardType==="info"&&me.infoType==="computed"){if(J.length>0){const we=mn(Xe,J,$e),Fe=we?Ce.current[we]:null;if(Fe&&(Fe.focus(),document.activeElement===Fe)){Ca.current=K;return}}if(de.current&&(de.current.focus(),document.activeElement===de.current)){Ca.current=K;return}}else if(me.cardType==="vocab"&&de.current&&(de.current.focus(),document.activeElement===de.current)){Ca.current=K;return}je<6&&(je+=1,window.setTimeout(De,40))}},ze=window.setTimeout(De,40);return()=>window.clearTimeout(ze)},[me,J,Xe,$e]),n.useEffect(()=>{if(!Be)return;const K=oe=>{oe.key==="Enter"&&(oe.preventDefault(),Jt())};return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[Be]);const Ia=K=>{ye(K),q(ca(K))};n.useEffect(()=>{if(!me){q(null),ye([]);return}const K=me.cardType==="info"?"info":"connection";if(me.cardType==="info"&&me.infoType==="citation"){da().then(oe=>{const je=oe.filter(De=>De.itemType==="info"&&De.itemId===me.cardId&&De.checkType==="quote-fragment"&&hn(De.direction,me.direction));Ia(je)}).catch(()=>{q(null),ye([])});return}un(K,me.cardId,me.checkType,me.direction).then(oe=>Ia(oe)).catch(()=>{q(null),ye([])})},[me]);const Ka=(K,oe,je,De)=>{if(K==="info"&&je==="quote-fragment"){da().then(ze=>{const we=ze.filter(Fe=>Fe.itemType==="info"&&Fe.itemId===oe&&Fe.checkType==="quote-fragment"&&hn(Fe.direction,De));Ia(we)}).catch(()=>{q(null),ye([])});return}un(K,oe,je,De).then(ze=>Ia(ze)).catch(()=>{q(null),ye([])})},Ya=(K,oe,je)=>{var Fe;const De=((Fe=je.pairs.find(Ae=>Ae.leftId===K))==null?void 0:Fe.rightId)??null;if(!De)return je;const ze=De===oe;at(Ae=>({...Ae,[K]:ze?"correct":"incorrect"})),qe.current&&window.clearTimeout(qe.current),V.current&&window.clearTimeout(V.current),Le.current+=1;const we={kind:ze?"correct":"incorrect",tick:Le.current};if(tt(null),qe.current=window.setTimeout(()=>tt(we),0),V.current=window.setTimeout(()=>tt(null),420),ze){const Ae={...je.locked,[K]:!0};return Object.keys(Ae).length>=je.pairs.length?(ge("correct"),Ke(!0)):ge("correct"),{...je,selection:{...je.selection,[K]:oe},activeLeft:null,activeRight:null,locked:Ae}}return ge("incorrect"),{...je,activeLeft:null,activeRight:null}},_a=K=>{rt(oe=>!oe||oe.locked[K]?oe:oe.activeRight?Ya(K,oe.activeRight,oe):{...oe,activeLeft:oe.activeLeft===K?null:K})},Nn=K=>{rt(oe=>oe&&(oe.activeLeft?Ya(oe.activeLeft,K,oe):{...oe,activeRight:oe.activeRight===K?null:K}))},Jt=()=>{var K;if(me&&me.cardType==="info"&&me.infoType==="citation"&&dt.current&&D&&!((K=Wt(me.direction))!=null&&K.fragmentId)){const oe=Ra(dt.current,yt.current,Je.current,Pt,Ct,me.direction,D.fragmentId);if(oe){ge(null),Ne(""),S(!1),Me({}),Ke(!1),W(null),ce(0),ra(dt.current,oe.id,D.title);return}}ge(null),Ne(""),S(!1),Me({}),Ke(!1),W(null),ce(0),ie(oe=>Math.min(oe+1,x.length))},Ht=K=>{if(!me)return;const oe=K.expected??null,je=K.answer??"";let De=oe??"",ze=je;if(!oe&&K.expectedMap&&K.answerMap){const I=Object.keys(K.expectedMap).sort((O,ue)=>O.localeCompare(ue));De=I.map(O=>{var ue;return((ue=K.expectedMap)==null?void 0:ue[O])??""}).join("|"),ze=I.map(O=>{var ue;return((ue=K.answerMap)==null?void 0:ue[O])??""}).join("|")}const we=De?Pa(De,ze,$t):new Uint8Array,Fe={revisionType:Ye.id,evalType:K.evalType,direction:K.direction,prompt:R??"",expected:oe,answer:je,expectedAnswers:K.expectedMap??null,answers:K.answerMap??null,correct:K.correct,maskBase64:we.length?ya(we):null,checkMode:Kt,compareMode:$t,minCorrectness:At},Ae=new TextEncoder().encode(JSON.stringify(Fe)),Pe=me.cardType==="info"?"info":"connection",Ze=K.overrideCheckType??me.checkType??null,f=K.overrideDirection??me.direction??null;dn({itemType:Pe,itemId:me.cardId,checkType:Ze,direction:f,revisionType:Ye.id,evalType:K.evalType,correct:K.correct,maskBase64:we.length?ya(we):null,payloadBase64:ya(Ae)}).then(()=>{Ka(Pe,me.cardId,Ze,f),na(x)}).catch(()=>{})},Sn=(K,oe)=>{const je=Zt.current.get(oe);if(je)return Promise.resolve(je);const De=Ut.current.get(oe);if(De)return De;const ze=gs({shareCode:d,infoId:K,key:St}).then(we=>{var I,O;const Fe=we.payload,Ae=((I=Fe.definition)==null?void 0:I.graph)??null,Pe="",Ze=((O=Fe.definition)==null?void 0:O.answerTemplate)??"",f=ur(Ae,Pe,Ze);if(f){const fe={sample:hr(f),answerTemplate:Ze||null};return Zt.current.set(oe,fe),fe}return ms({shareId:d,infoId:K,key:St}).then(ue=>{const fe={sample:ue,answerTemplate:null};return Zt.current.set(oe,fe),fe})}).catch(()=>ms({shareId:d,infoId:K,key:St}).then(we=>{const Fe={sample:we,answerTemplate:null};return Zt.current.set(oe,Fe),Fe}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Ut.current.delete(oe)});return Ut.current.set(oe,ze),ze},Vt=(K,oe)=>{var Ae;const je=`${Te(K)}:${oe}`,De=B.current.get(je);if(De)return Promise.resolve(De);const ze=g.current.get(je);if(ze)return ze;const we=Pe=>(B.current.set(je,Pe),Pe);let Fe;if(K.cardType==="vocab"){if(K.checkType==="translation-match")return Fe=Promise.resolve(we({prompt:K.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),Fe;const Pe=K.label.split("↔").map(Ze=>Ze.trim()).filter(Boolean);if(Pe.length>=2){const f=(K.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",I=f?Pe[0]:Pe[1],O=f?Pe[1]:Pe[0];Fe=Promise.resolve(we({prompt:I,expectedAnswer:O,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else Fe=Promise.resolve(we({prompt:K.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(K.cardType==="info"&&K.infoType==="word"){const Pe=(Ae=K.description)!=null&&Ae.startsWith("Language: ")?K.description.replace("Language: ",""):null;Fe=Promise.resolve(we({prompt:K.label,expectedAnswer:Pe,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else K.cardType==="info"&&K.infoType==="question"?Fe=gs({shareCode:d,infoId:K.cardId,key:St}).then(Pe=>{const Ze=Pe.payload??{},f=Ze.definition??Ze??{},I=fr(f.type??f.kind),O=(typeof f.question=="string"&&f.question.trim()?f.question.trim():null)??(typeof f.title=="string"&&f.title.trim()?f.title.trim():null)??K.label,ue=f.answer;return we(I==="text"||I==="number"||I==="date"?{prompt:O,expectedAnswer:typeof ue=="string"||typeof ue=="number"?String(ue):null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}:{prompt:O,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})}).catch(()=>we({prompt:K.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{g.current.delete(je)}):K.cardType==="info"&&K.infoType==="computed"?Fe=Sn(K.cardId,je).then(Pe=>{var ue,fe;if(!Pe.sample)return we({prompt:K.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const Ze=Pe.sample,f=Ze.expectedAnswers?Object.entries(Ze.expectedAnswers).map(([re,ve])=>({key:re,expected:ve})):[],I=f.reduce((re,ve)=>(re[ve.key]="",re),{}),O=Ze.expectedAnswerIsSentence&&((ue=Ze.expectedAnswer)==null?void 0:ue.trim())||null;return we({prompt:Ze.prompt,expectedAnswer:f.length>0?O:((fe=Ze.expectedAnswer)==null?void 0:fe.trim())||null,computedExpected:f,computedAnswers:I,answerTemplate:Pe.answerTemplate,outputVariables:Ze.outputVariables??null,variableValues:Ze.variableValues??null})}).catch(()=>we({prompt:K.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{g.current.delete(je)}):Fe=Promise.resolve(we({prompt:K.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return g.current.set(je,Fe),Fe},ra=(K,oe,je)=>{const De=Object.keys(K.nodes).length,ze=yt.current.size;if(!oe){P({title:je,before:K.text,after:"",fragmentId:null,total:De,completed:ze}),G(null),Ke(!0);return}const we=K.nodes[oe];if(!we)return;const Fe=vn(K.text,we);P({title:je,before:Fe.before,after:Fe.after,fragmentId:we.id,total:De,completed:ze}),G(Fe.fragment),Ke(!1)},Ma=()=>{const K=dt.current;K&&P(oe=>oe&&{...oe,total:Object.keys(K.nodes).length,completed:yt.current.size})},wa=()=>{const K=x[$+1];K&&Vt(K,$+1)},Da=()=>{if(wa(),me&&me.cardType==="vocab"&&me.checkType==="translation-match"&&Re){if(Re.pairs.length===0){ge("incorrect"),Ke(!0);return}const we=Re.pairs.reduce((O,ue)=>(O[ue.rightId]=ue.rightLabel,O),{});let Fe=0;const Ae={};Re.pairs.forEach(O=>{const fe=Re.selection[O.leftId]===O.rightId;Ae[O.leftId]=fe?"correct":"incorrect",fe&&(Fe+=1)});const Pe=Re.pairs.length||1,Ze=Fe/Pe,f=Fe===Re.pairs.length;at(O=>({...O,...Ae})),f?(ge("correct"),Ke(!0),ce(0)):(ge("incorrect"),Ke(!1),ce(O=>{const ue=O+1;return ue>=ft&&(S(!0),Ke(!0),rt(fe=>{if(!fe)return fe;const re=fe.pairs.reduce((ve,ae)=>(ve[ae.leftId]=ae.rightId,ve),{});return{...fe,selection:re}})),ue})),Yt(f,Ze);const I="connection";Promise.all(Re.pairs.map(O=>{const ue=Re.selection[O.leftId]??null,fe=ue?we[ue]:"",re={left:O.leftLabel,expected:O.rightLabel,answer:fe,checkType:"translation-match"},ve=new TextEncoder().encode(JSON.stringify(re));return dn({itemType:I,itemId:O.cardId,checkType:"translation-match",direction:null,revisionType:Ye.id,evalType:"translation-match",correct:ue===O.rightId,maskBase64:null,payloadBase64:ya(ve)})})).then(()=>{Ka(I,me.cardId,me.checkType,me.direction),na(x)}).catch(()=>{});return}if(J.length>0){const we=J.reduce((Ae,Pe)=>{const Ze=le[Pe.key]??"";return Ae[Pe.key]=Bt(Ze)===Bt(Pe.expected)?"correct":"incorrect",Ae},{});J.every(({key:Ae,expected:Pe})=>{const Ze=le[Ae]??"";return Kt==="exact"&&Bt(Ze)===Bt(Pe)})?(ge("correct"),Me(we),Ke(!0),ce(0),Yt(!0,1),Ht({correct:!0,direction:R?`${R} -> computed`:"computed",expectedMap:J.reduce((Ae,Pe)=>(Ae[Pe.key]=Pe.expected,Ae),{}),answerMap:le,evalType:"computed"})):(ge("incorrect"),Me(we),Ke(!1),ce(Ae=>{const Pe=Ae+1;return Pe>=ft&&ga&&(S(!0),Ke(!0)),Pe}),Yt(!1,0),window.setTimeout(()=>{var Pe;const Ae=mn(Xe,J,$e);Ae&&Ce.current[Ae]&&((Pe=Ce.current[Ae])==null||Pe.focus())},40),Ht({correct:!1,direction:R?`${R} -> computed`:"computed",expectedMap:J.reduce((Ae,Pe)=>(Ae[Pe.key]=Pe.expected,Ae),{}),answerMap:le,evalType:"computed"}));return}if(me&&me.cardType==="info"&&me.infoType==="citation"&&(D!=null&&D.fragmentId)){if(!L)return;const we=Wt(me.direction),Fe=(we==null?void 0:we.fragmentId)??D.fragmentId,Ae=Sa(L,he,{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}),Pe=Ae.mask,Ze=Ae.isCorrect,f=Ae.percent;Ze?(Je.current[D.fragmentId]=Math.max(Je.current[D.fragmentId]??0,f),(Je.current[D.fragmentId]??0)>=Pt&&yt.current.add(D.fragmentId),Ma(),ge("correct"),Me({}),Ke(!0),W(Pe),ce(0),f<100&&ft<=1&&S(!0),Yt(!0,f/100),Ht({correct:!0,direction:`quote:${D.fragmentId}`,expected:L,answer:he,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:Fe})):(ge("incorrect"),Me({}),Ke(!1),W(Pe),ce(I=>{const O=I+1;return O>=ft&&ga&&(S(!0),Ke(!0)),O}),Yt(!1,f/100),window.setTimeout(()=>{var I;return(I=de.current)==null?void 0:I.focus()},40),Ht({correct:!1,direction:`quote:${D.fragmentId}`,expected:L,answer:he,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:Fe}));return}if(!L)return;const K=Pa(L,he,$t),oe=Kt==="exact"&&Bt(he)===Bt(L),je=ma(K),De=oe||je,ze=xa(K);De?(ge("correct"),Me({}),Ke(!0),W(K),ce(0),ze<100&&ft<=1&&S(!0),Yt(!0,ze/100),Ht({correct:!0,direction:R?`${R} -> ${L}`:null,expected:L,answer:he,evalType:"text"})):(ge("incorrect"),Me({}),Ke(!1),W(K),ce(we=>{const Fe=we+1;return Fe>=ft&&ga&&(S(!0),Ke(!0)),Fe}),Yt(!1,ze/100),window.setTimeout(()=>{var we;return(we=de.current)==null?void 0:we.focus()},40),Ht({correct:!1,direction:R?`${R} -> ${L}`:null,expected:L,answer:he,evalType:"text"}))},Tn=K=>{if(wa(),!L)return;const oe=Pa(L,K,$t),je=Bt(K)===Bt(L),De=ma(oe),ze=je||De,we=xa(oe);ze?(ge("correct"),Me({}),Ke(!0),W(oe),ce(0),we<100&&ft<=1&&S(!0),Yt(!0,we/100),Ht({correct:!0,direction:"word->language",expected:L,answer:K,evalType:"language-select"})):(ge("incorrect"),Me({}),Ke(!1),W(oe),ce(Fe=>{const Ae=Fe+1;return Ae>=ft&&ga&&(S(!0),Ke(!0)),Ae}),Yt(!1,we/100),Ht({correct:!1,direction:"word->language",expected:L,answer:K,evalType:"language-select"}))},Cn=K=>{var je;if(K.key!=="Enter")return;if(K.preventDefault(),K.stopPropagation(),Be){Jt();return}const oe=J.find(De=>!(le[De.key]??"").trim());if(oe){(je=Ce.current[oe.key])==null||je.focus();return}Da()},La=()=>{wa(),ge("correct"),Ke(!0),ce(0),Yt(!0,1),L&&Ht({correct:!0,direction:"manual",expected:L,answer:he,evalType:"manual"})},sa=()=>{if(Yt(!1,0),me&&me.cardType==="info"&&me.infoType==="citation"){ge(null),Ne(""),S(!1),Me({}),Ke(!1),W(null),ce(0),ie(K=>Math.min(K+1,x.length));return}Jt()};n.useEffect(()=>{wa()},[$,x]);const In=t.cogita.library.revision.revealModeAfterIncorrect,ga=J.length>0||!!L;return e.jsxs(Rt,{copy:t,authLabel:a,showProfileMenu:s,onProfileNavigate:r,onToggleSecureMode:i,onLogout:u,secureMode:c,onNavigate:y,language:m,onLanguageChange:j,children:[(l==="loading"||H==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:l==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${ee.total?Math.min(100,Math.max(0,ee.current/ee.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:ee.total?`${Math.min(ee.current,ee.total)} / ${ee.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:h}),e.jsx("p",{className:"cogita-library-subtitle",children:A}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",Gt).replace("{check}",qt)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:E?`${E.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[ea?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",ea.currentLevel??"-"," / ",ea.levelsCount]}):null,E?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(E.correct)).replace("{total}",String(E.total))}),E.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(E.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(gr,{outcomes:X})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Q?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Q})}):null,e.jsx(Fa,{feedbackToken:Ue?`${Ue.kind}-${Ue.tick}`:Et?"idle":Ge?`${Ge}-${$}-${pe}`:"idle",children:l!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:l==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}):me?e.jsx(e.Fragment,{children:zt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(ss,{copy:t,currentCard:me,currentTypeLabel:se,prompt:R,languages:_,answer:he,onAnswerChange:K=>Ne(oe=>gn(oe,K,te)),computedExpected:J,computedAnswers:le,onComputedAnswerChange:(K,oe)=>xe(je=>({...je,[K]:gn(je[K]??"",oe,te)})),answerTemplate:Xe,outputVariables:$e,variableValues:kt,computedFieldFeedback:Ie,feedback:Ge,canAdvance:Be,quoteContext:D,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Da,onSkip:sa,onLanguageSelect:Tn,onMarkReviewed:La,onAdvance:Jt,showCorrectAnswer:p,setShowCorrectAnswer:S,onRevealCorrect:()=>Ke(!0),answerMask:Y,expectedAnswer:L,hasExpectedAnswer:ga,handleComputedKeyDown:Cn,answerInputRef:de,computedInputRefs:Ce,scriptMode:te,setScriptMode:be,matchPairs:Re==null?void 0:Re.pairs,matchLeftOrder:Re==null?void 0:Re.leftOrder,matchRightOrder:Re==null?void 0:Re.rightOrder,matchSelection:Re==null?void 0:Re.selection,matchActiveLeft:Re==null?void 0:Re.activeLeft,matchActiveRight:Re==null?void 0:Re.activeRight,matchFeedback:gt,onMatchLeftSelect:_a,onMatchRightSelect:Nn})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:et?`${ht} / ${et}`:t.cogita.library.revision.progressUnlimited}),l==="error"&&e.jsx("p",{children:t.cogita.library.revision.shareInvalid}),l==="loading"&&e.jsx("p",{children:t.cogita.library.revision.shareLoading}),l==="ready"&&H==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),l==="ready"&&H==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),l==="ready"&&H==="ready"&&x.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:In}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",ft]})]})]}),ea?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",ea.activeCount," / ",ea.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:ea.counts.map((K,oe)=>{const je=oe+1,De=ea.currentLevel===je,ze=ea.percentages[oe]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":De,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:je}),e.jsx("strong",{children:K})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,ze))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[ze.toFixed(1),"%"]})]},`level-${je}`)})})]}):null,ja?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ja.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ja.dots.map(K=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-K.value))}, ${Math.round(200*K.value)}, 80, 0.9)`}},K.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ja.knownCount})]})]}):null,Ct?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Ga})]})}):null]})]})]})})})]})]})}const Vo=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Co},Symbol.toStringTag,{value:"Module"})),la=t=>String(t??"").trim().toLocaleLowerCase(),pn=t=>Array.from(new Set(t.map(a=>Number(a)).filter(Number.isFinite))).sort((a,s)=>a-s),qs=t=>t.map(a=>a.join(",")).sort().join("|");function Io(t){const a=[...t];for(let s=a.length-1;s>0;s-=1){const r=Math.floor(Math.random()*(s+1));[a[s],a[r]]=[a[r],a[s]]}return a}function Us(t){const a=t.map((i,u)=>({value:i,oldIndex:u}));for(let i=a.length-1;i>0;i-=1){const u=Math.floor(Math.random()*(i+1));[a[i],a[u]]=[a[u],a[i]]}const s=a.map(i=>i.value),r=new Map;return a.forEach((i,u)=>r.set(i.oldIndex,u)),{values:s,oldToNew:r}}function Mo(t){const a=t.split("↔").map(s=>s.trim()).filter(Boolean);return a.length>=2?[a[0],a[1]]:null}function Lo(t){if(!t)return null;const a=t.indexOf(":");return a>=0?t.slice(a+1).trim():t.trim()}function Ao(t){if(typeof t!="string")return"";const a=t.trim().toLowerCase();return a==="single_select"||a==="multi_select"?"selection":a==="boolean"||a==="true_false"?"truefalse":a==="order"?"ordering":a==="short"||a==="open"||a==="short_text"?"text":a==="selection"||a==="truefalse"||a==="text"||a==="number"||a==="date"||a==="ordering"||a==="matching"?a:""}function $o(t,a,s,r){const i=Ao(s.type),u=typeof s.title=="string"&&s.title.trim()?s.title.trim():a,c=typeof s.question=="string"?s.question:a;if(!i||!c)return null;if(i==="selection"){const y=Array.isArray(s.options)?s.options.filter(o=>typeof o=="string"):[],m=Array.isArray(s.answer)?pn(s.answer):[],j=m.length!==1,d=Us(y),b=m.map(o=>d.oldToNew.get(o)).filter(o=>Number.isInteger(o)).sort((o,l)=>o-l);return{roundIndex:r,cardKey:`info:${t}:question-selection`,publicPrompt:{kind:"selection",title:u,prompt:c,options:d.values,multiple:j,cardLabel:"question"},reveal:{kind:"selection",expected:b,title:u},grade:o=>{const l=Array.isArray(o)?pn(o):[];return JSON.stringify(l)===JSON.stringify(b)}}}if(i==="truefalse"){const y=!!s.answer;return{roundIndex:r,cardKey:`info:${t}:question-truefalse`,publicPrompt:{kind:"boolean",title:u,prompt:c,cardLabel:"question"},reveal:{kind:"boolean",expected:y,title:u},grade:m=>!!m===y}}if(i==="text"||i==="number"||i==="date"){const y=String(s.answer??"");return{roundIndex:r,cardKey:`info:${t}:question-${i}`,publicPrompt:{kind:"text",title:u,prompt:c,inputType:i==="number"?"number":i==="date"?"date":"text",cardLabel:"question"},reveal:{kind:"text",expected:y,title:u},grade:m=>{if(i==="number"){const j=Number(m),d=Number(y);return Number.isFinite(j)&&Number.isFinite(d)&&Math.abs(j-d)<1e-9}return la(m)===la(y)}}}if(i==="ordering"){const y=Array.isArray(s.options)?s.options.filter(j=>typeof j=="string"):[],m=Io(y);return{roundIndex:r,cardKey:`info:${t}:question-ordering`,publicPrompt:{kind:"ordering",title:u,prompt:c,options:m,cardLabel:"question"},reveal:{kind:"ordering",expected:y,title:u},grade:j=>JSON.stringify(Array.isArray(j)?j.map(String):[])===JSON.stringify(y)}}if(i==="matching"){const m=(Array.isArray(s.columns)?s.columns.map(o=>Array.isArray(o)?o.filter(l=>typeof l=="string"):[]):[]).map(o=>Us(o)),j=s.answer??{},b=(Array.isArray(j.paths)?j.paths.map(o=>Array.isArray(o)?o.map(l=>Number(l)).filter(Number.isFinite):null).filter(o=>Array.isArray(o)):[]).map(o=>o.map((l,w)=>{var h;return((h=m[w])==null?void 0:h.oldToNew.get(l))??l}));return{roundIndex:r,cardKey:`info:${t}:question-matching`,publicPrompt:{kind:"matching",title:u,prompt:c,columns:m.map(o=>o.values),cardLabel:"question"},reveal:{kind:"matching",expected:{paths:b},title:u},grade:o=>{const l=o??{},w=Array.isArray(l.paths)?l.paths.map(h=>Array.isArray(h)?h.map(N=>Number(N)).filter(Number.isFinite):null).filter(h=>Array.isArray(h)):[];return qs(w)===qs(b)}}}return null}async function Ro(t){var b,o;const a=await ns({libraryId:t.libraryId,revisionId:t.revisionId}),r=(await Ja({libraryId:t.libraryId,collectionId:a.collectionId,limit:1e3})).items,i=Array.from(new Set(r.filter(l=>l.cardType==="info").map(l=>l.cardId))),u=new Map;await Promise.all(i.map(async l=>{try{const w=await aa({libraryId:t.libraryId,infoId:l});u.set(l,{infoType:w.infoType,payload:w.payload})}catch{}}));const c=new Map;await Promise.all(Array.from(u.entries()).filter(([,l])=>l.infoType==="computed").map(async([l])=>{try{const w=await Hn({libraryId:t.libraryId,infoId:l});c.set(l,w)}catch{}}));const y=Array.from(new Set(r.filter(l=>l.cardType==="vocab").map(l=>l.label))).filter(Boolean),m={selectMatchingPairPrompt:((b=t.labels)==null?void 0:b.selectMatchingPairPrompt)??"Select the matching pair",wordLanguagePromptPrefix:((o=t.labels)==null?void 0:o.wordLanguagePromptPrefix)??"Language of"},j=[],d=new Set;for(const l of r){if(l.cardType==="vocab"){const h=Mo(l.label);if(!h)continue;if(l.checkType==="translation"&&l.direction==="a-to-b"){const[N,A]=h;j.push({roundIndex:j.length,cardKey:`connection:${l.cardId}:translation:a-to-b`,publicPrompt:{kind:"text",title:l.label,prompt:N,cardLabel:l.description??void 0},reveal:{kind:"text",expected:A,title:l.label},grade:v=>la(v)===la(A)})}else if(l.checkType==="translation"&&l.direction==="b-to-a"){const[N,A]=h;j.push({roundIndex:j.length,cardKey:`connection:${l.cardId}:translation:b-to-a`,publicPrompt:{kind:"text",title:l.label,prompt:A,cardLabel:l.description??void 0},reveal:{kind:"text",expected:N,title:l.label},grade:v=>la(v)===la(N)})}else if(l.checkType==="translation-match"){const N=Array.from(new Set([l.label,...y.filter(v=>v!==l.label).slice(0,3)])),A=N.findIndex(v=>v===l.label);j.push({roundIndex:j.length,cardKey:`connection:${l.cardId}:translation-match`,publicPrompt:{kind:"selection",title:l.label,prompt:m.selectMatchingPairPrompt,options:N,multiple:!1,cardLabel:l.description??void 0},reveal:{kind:"selection",expected:[A],title:l.label},grade:v=>{const x=Array.isArray(v)?pn(v):pn([v]);return x.length===1&&x[0]===A}})}continue}if(l.cardType!=="info")continue;const w=u.get(l.cardId);if(w){if(w.infoType==="word"&&l.checkType==="word-language"){const h=Lo(l.description);if(!h)continue;j.push({roundIndex:j.length,cardKey:`info:${l.cardId}:word-language:${l.direction??""}`,publicPrompt:{kind:"text",title:l.label,prompt:`${m.wordLanguagePromptPrefix}: ${l.label}`,cardLabel:"word-language"},reveal:{kind:"text",expected:h,title:l.label},grade:N=>la(N)===la(h)});continue}if(w.infoType==="computed"&&l.checkType==="computed"){const h=c.get(l.cardId);if(!h)continue;j.push({roundIndex:j.length,cardKey:`info:${l.cardId}:computed`,publicPrompt:{kind:"text",title:l.label,prompt:h.prompt,multiLine:!1,cardLabel:"computed"},reveal:{kind:"text",expected:h.expectedAnswer,title:l.label},grade:N=>la(N)===la(h.expectedAnswer)});continue}if(w.infoType==="question"){const h=w.payload,N=h.definition??h,A=$o(l.cardId,l.label,N,j.length);A&&(A.roundIndex=j.length,j.push(A));continue}if(w.infoType==="citation"&&!d.has(l.cardId)){d.add(l.cardId);const h=w.payload,N=typeof h.text=="string"?h.text:"",A=typeof h.title=="string"&&h.title.trim()?h.title.trim():l.label;if(!N.trim())continue;const v=va(N,{minLen:7,maxLen:13});for(const x of v.order){const Z=v.nodes[x];if(!Z)continue;const _=vn(N,Z);j.push({roundIndex:j.length,cardKey:`info:${l.cardId}:quote-fragment:${x}`,publicPrompt:{kind:"citation-fragment",title:A,before:_.before,after:_.after,fragmentId:x,cardLabel:"quote-fragment"},reveal:{kind:"citation-fragment",expected:_.fragment,title:A},grade:k=>Sa(_.fragment,String(k??""),{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}).isCorrect})}continue}}}return j.map((l,w)=>({...l,roundIndex:w}))}function Po(t){var R;const{libraryId:a,revisionId:s}=t,r=Ea(),i=t.copy.cogita.library.revision,u=i.live,[c,y]=n.useState(null),[m,j]=n.useState([]),[d,b]=n.useState("loading"),[o,l]=n.useState(null),w=`cogita.live.host.${a}.${s}`,h=c?m[c.currentRoundIndex]??null:null,N=c!=null&&c.status&&c.status!=="lobby"?c.currentPrompt??null:null,A=(c==null?void 0:c.currentReveal)??null,v=n.useMemo(()=>c!=null&&c.code&&typeof window<"u"?`${window.location.origin}/#/cogita/public/live-revision/${encodeURIComponent(c.code)}`:"",[c==null?void 0:c.code]),x=n.useMemo(()=>c!=null&&c.code&&typeof window<"u"?`${window.location.origin}/#/cogita/public/live-revision-screen/${encodeURIComponent(c.code)}`:"",[c==null?void 0:c.code]),Z=(c==null?void 0:c.status)==="finished"?"finished":c!=null&&c.status&&c.status!=="lobby"?"active":"lobby",_=(F,L)=>F.replace(/\{(\w+)\}/g,(G,D)=>String(L[D]??"")),k={lobby:u.statusLobby,running:u.statusRunning,revealed:u.statusRevealed,finished:u.statusFinished},H=(F,L,G)=>({...F,hostSecret:F.hostSecret||(L==null?void 0:L.hostSecret)||(G==null?void 0:G.hostSecret)||"",code:F.code||(L==null?void 0:L.code)||(G==null?void 0:G.code)||""});n.useEffect(()=>{let F=!1;return Ro({libraryId:a,revisionId:s,labels:{selectMatchingPairPrompt:u.selectMatchingPairPrompt,wordLanguagePromptPrefix:u.wordLanguagePromptPrefix}}).then(L=>{F||j(L)}).catch(()=>{F||(l(u.loadRoundsError),b("error"))}),()=>{F=!0}},[a,u.selectMatchingPairPrompt,u.wordLanguagePromptPrefix,s]),n.useEffect(()=>{let F=!1;async function L(){try{const G=new URLSearchParams(r.search),D=G.get("sessionId"),P=G.get("hostSecret"),J=G.get("code");if(!!(D&&P)&&D&&P){const xe=await ps({libraryId:a,sessionId:D,hostSecret:P});if(F)return;const Ie=H(xe,null,{hostSecret:P,code:J??void 0});y(Ie),typeof localStorage<"u"&&localStorage.setItem(w,JSON.stringify({sessionId:Ie.sessionId,hostSecret:Ie.hostSecret,code:Ie.code})),b("ready");return}const le=await Wr({libraryId:a,revisionId:s,title:u.hostKicker});if(F)return;y(le),localStorage.setItem(w,JSON.stringify({sessionId:le.sessionId,hostSecret:le.hostSecret,code:le.code})),b("ready")}catch{if(F)return;l(u.createSessionError),b("error")}}return L(),()=>{F=!0}},[a,u.hostKicker,r.search,s,w]),n.useEffect(()=>{if(!c)return;const F=window.setInterval(async()=>{try{const L=await ps({libraryId:a,sessionId:c.sessionId,hostSecret:c.hostSecret});y(G=>H(L,G))}catch{}},1200);return()=>window.clearInterval(F)},[a,c]);const T=async F=>{if(!c)return;const L=Object.prototype.hasOwnProperty.call(F,"currentPrompt"),G=Object.prototype.hasOwnProperty.call(F,"currentReveal"),D=await Xr({libraryId:a,sessionId:c.sessionId,hostSecret:c.hostSecret,status:F.status??c.status,currentRoundIndex:F.currentRoundIndex??c.currentRoundIndex,revealVersion:F.revealVersion??c.revealVersion,currentPrompt:L?F.currentPrompt??null:c.currentPrompt??null,currentReveal:G?F.currentReveal??null:c.currentReveal??null});y(P=>H(D,P))},ee=async F=>{const L=m[F];!L||!c||await T({status:"running",currentRoundIndex:F,revealVersion:c.revealVersion+1,currentReveal:null,currentPrompt:{...L.publicPrompt,roundIndex:F,cardKey:L.cardKey}})},C=async()=>{m.length&&await ee((c==null?void 0:c.currentRoundIndex)??0)},$=async()=>{if(!c||!h)return;const F=new Map(c.currentRoundAnswers.map(D=>[D.participantId,D.answer])),L=c.participants.map(D=>{const P=F.get(D.participantId),J=h.grade(P);return{participantId:D.participantId,isCorrect:J,pointsAwarded:J?1:0}}),G=await Yr({libraryId:a,sessionId:c.sessionId,hostSecret:c.hostSecret,scores:L});y(D=>H(G,D)),await T({status:"revealed",revealVersion:G.revealVersion+1,currentReveal:h.reveal})},ie=async()=>{if(!c)return;const F=c.currentRoundIndex+1;if(F>=m.length){await T({status:"finished",currentReveal:null});return}await ee(F)},he=async()=>{if(c){if(c.status==="running"){await $();return}if(c.status==="revealed"){await ie();return}c.status==="lobby"&&await C()}},Ne=async F=>{if(c!=null&&c.hostSecret)try{const L=await Gr({libraryId:a,sessionId:c.sessionId,hostSecret:c.hostSecret,requestId:F});y(G=>H(L,G))}catch{}},Ge=async()=>{if(c)try{const F=await nr({libraryId:a,sessionId:c.sessionId});y(F),typeof localStorage<"u"&&localStorage.setItem(w,JSON.stringify({sessionId:F.sessionId,hostSecret:F.hostSecret,code:F.code}))}catch{}},ge=(F,L)=>{if(!F)return e.jsx("p",{className:"cogita-help",children:u.waitingForHostQuestion});const G=String(F.kind??""),D=typeof L<"u",P=Array.isArray(L)?L.map(J=>Number(J)).filter(Number.isFinite):[];if(G==="citation-fragment")return e.jsxs("div",{className:"cogita-live-card-surface","data-state":D?"correct":"idle",children:[e.jsxs("p",{children:[e.jsx("span",{style:{opacity:.7},children:String(F.before??"")}),e.jsx("strong",{children:" [ ... ] "}),e.jsx("span",{style:{opacity:.7},children:String(F.after??"")})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:D?u.correctFragmentLabel:u.fragmentLabel}),e.jsx("input",{readOnly:!0,value:D?String(L??""):"",placeholder:u.participantAnswerPlaceholder})]})]});if(G==="text")return e.jsxs("div",{className:"cogita-live-card-surface","data-state":D?"correct":"idle",children:[e.jsx("p",{children:String(F.prompt??"")}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:D?i.correctAnswerLabel:i.answerLabel}),e.jsx("input",{readOnly:!0,value:D?String(L??""):"",placeholder:u.participantAnswerPlaceholder})]})]});if(G==="boolean"){const J=!!L;return e.jsxs("div",{className:"cogita-live-card-surface","data-state":D?"correct":"idle",children:[e.jsx("p",{children:String(F.prompt??"")}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:`cta ghost ${D&&J?"live-correct-answer":""}`,disabled:!0,children:u.trueLabel}),e.jsx("button",{type:"button",className:`cta ghost ${D&&!J?"live-correct-answer":""}`,disabled:!0,children:u.falseLabel})]})]})}if(G==="selection"){const J=Array.isArray(F.options)?F.options.map(String):[],z=!!F.multiple;return e.jsxs("div",{className:"cogita-live-card-surface","data-state":D?"correct":"idle",children:[e.jsx("p",{children:String(F.prompt??"")}),e.jsx("div",{className:"cogita-share-list",children:J.map((le,xe)=>e.jsxs("label",{className:"cogita-share-row","data-state":D&&P.includes(xe)?"correct":void 0,children:[e.jsx("span",{children:le}),e.jsx("input",{type:z?"checkbox":"radio",disabled:!0,checked:D?P.includes(xe):!1,readOnly:!0})]},`${xe}-${le}`))})]})}if(G==="ordering"){const J=Array.isArray(D?L:F.options)?(D?L:F.options).map(String):[];return e.jsxs("div",{className:"cogita-live-card-surface","data-state":D?"correct":"idle",children:[e.jsx("p",{children:String(F.prompt??"")}),e.jsx("div",{className:"cogita-share-list",children:J.map((z,le)=>e.jsxs("div",{className:"cogita-share-row","data-state":D?"correct":void 0,children:[e.jsx("span",{children:z}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:!0,children:"↑"}),e.jsx("button",{type:"button",className:"ghost",disabled:!0,children:"↓"})]})]},`${le}-${z}`))})]})}if(G==="matching"){const J=Array.isArray(F.columns)?F.columns:[],z=(L==null?void 0:L.paths)??[];return e.jsxs("div",{className:"cogita-live-card-surface","data-state":D?"correct":"idle",children:[e.jsx("p",{children:String(F.prompt??"")}),D?e.jsx("div",{className:"cogita-share-list",children:z.map((le,xe)=>e.jsx("div",{className:"cogita-share-row","data-state":"correct",children:e.jsx("span",{children:le.map((Ie,Me)=>{const Xe=Array.isArray(J[Me])?J[Me]:[],it=String(Xe[Ie]??Ie);return`${Me>0?" → ":""}${it}`})})},`path-${xe}`))}):e.jsx("div",{className:"cogita-form-actions",children:J.map((le,xe)=>e.jsx("select",{disabled:!0,children:(Array.isArray(le)?le:[]).map((Ie,Me)=>e.jsx("option",{children:String(Ie)},`${xe}-${Me}`))},`host-col-${xe}`))})]})}return e.jsx("p",{className:"cogita-help",children:u.unsupportedPromptType})};return e.jsx(Rt,{...t,children:e.jsx("section",{className:"cogita-library-dashboard",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid cogita-live-session-layout","data-stage":Z,children:[e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:u.hostKicker}),e.jsx("h2",{className:"cogita-detail-title",children:u.hostTitle}),d==="loading"?e.jsx("p",{children:u.loading}):null,o?e.jsx("p",{className:"cogita-help",children:o}):null,c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:u.joinCodeLabel}),e.jsx("input",{readOnly:!0,value:c.code})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:u.joinUrlLabel}),e.jsx("input",{readOnly:!0,value:v})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:"Presenter URL"}),e.jsx("input",{readOnly:!0,value:x})]}),v?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:u.qrLabel}),e.jsx("div",{style:{display:"inline-flex",padding:"0.75rem",borderRadius:"12px",background:"#fff"},children:e.jsx(Hs,{value:v,size:176,marginSize:2})})]}):null,e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:u.statusLabel}),e.jsx("input",{readOnly:!0,value:k[c.status]??c.status})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:C,disabled:!m.length,children:u.publishCurrentRound}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Ge,children:"Refresh links"})]}),e.jsx("p",{className:"cogita-help",children:_(u.roundsLabel,{count:m.length})})]}):null]}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:u.currentRoundTitle}),e.jsx("h3",{className:"cogita-detail-title",children:N&&typeof N.title=="string"?N.title:(c==null?void 0:c.status)==="lobby"?u.sessionNotStarted:u.waitingForPublishedRound}),(c==null?void 0:c.status)==="lobby"?e.jsx("p",{className:"cogita-help",children:u.hiddenBeforeStart}):e.jsx(Fa,{className:"cogita-live-card-container",feedbackToken:A?`correct-${(c==null?void 0:c.revealVersion)??0}`:"idle",children:ge(N,A==null?void 0:A.expected)}),Z!=="lobby"?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:he,disabled:!m.length||!h||c.status==="finished",children:c.status==="revealed"?i.nextQuestion:i.checkAnswer})}):null,Z!=="finished"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-user-kicker",children:u.participantsTitle}),e.jsxs("div",{className:"cogita-share-list",children:[c==null?void 0:c.participants.map(F=>{const L=c.currentRoundAnswers.find(G=>G.participantId===F.participantId);return e.jsx("div",{className:"cogita-share-row",children:e.jsxs("div",{children:[e.jsx("strong",{children:F.displayName}),e.jsxs("div",{className:"cogita-share-meta",children:[L?u.answerStatusAnswered:u.answerStatusWaiting,(L==null?void 0:L.isCorrect)===!0?` · ${u.answerStatusCorrect}`:"",(L==null?void 0:L.isCorrect)===!1?` · ${u.answerStatusIncorrect}`:""]})]})},F.participantId)}),c&&c.participants.length===0?e.jsx("p",{className:"cogita-help",children:u.noParticipants}):null]}),c&&(((R=c.pendingReloginRequests)==null?void 0:R.length)??0)>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Relogin requests"}),e.jsx("div",{className:"cogita-share-list",children:(c.pendingReloginRequests??[]).map(F=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsxs("div",{children:[e.jsx("strong",{children:F.displayName}),e.jsx("div",{className:"cogita-share-meta",children:new Date(F.requestedUtc).toLocaleTimeString()})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Ne(F.requestId),children:"Allow relogin"})]},F.requestId))})]}):null]}):null]}),Z!=="lobby"?e.jsxs("div",{className:"cogita-library-panel cogita-live-scoreboard-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:Z==="finished"?u.finalScoreTitle:u.pointsTitle}),e.jsx("div",{className:"cogita-share-list",children:((c==null?void 0:c.scoreboard)??[]).map(F=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("div",{children:e.jsx("strong",{children:F.displayName})}),e.jsxs("div",{className:"cogita-share-meta",children:[F.score," ",u.scoreUnit]})]},`score:${F.participantId}`))})]}):null]})})})})})}const qo=Object.freeze(Object.defineProperty({__proto__:null,CogitaLiveRevisionHostPage:Po},Symbol.toStringTag,{value:"Module"}));function Js(t){return`cogita.live.join.${t}`}function Eo(t){const{code:a}=t,s=t.copy.cogita.library.revision,r=s.live,[i,u]=n.useState(""),[c,y]=n.useState(()=>typeof localStorage>"u"?null:localStorage.getItem(Js(a))),[m,j]=n.useState(null),[d,b]=n.useState("idle"),[o,l]=n.useState(""),[w,h]=n.useState([]),[N,A]=n.useState(null),[v,x]=n.useState([]),[Z,_]=n.useState([]),[k,H]=n.useState(null),[T,ee]=n.useState(!1),C=(m==null?void 0:m.currentPrompt)??null,$=(m==null?void 0:m.currentReveal)??null,ie=$==null?void 0:$.expected,he=(m==null?void 0:m.status)==="finished"?"finished":m!=null&&m.status&&m.status!=="lobby"?"active":"lobby",Ne=n.useMemo(()=>`${(m==null?void 0:m.currentRoundIndex)??0}:${(m==null?void 0:m.revealVersion)??0}:${String((C==null?void 0:C.cardKey)??"")}`,[C==null?void 0:C.cardKey,m==null?void 0:m.currentRoundIndex,m==null?void 0:m.revealVersion]);n.useEffect(()=>{l(""),h([]),A(null),x(Array.isArray(C==null?void 0:C.options)?[...C.options??[]]:[]),_([])},[Ne]),n.useEffect(()=>{let P=!0;const J=async()=>{try{const le=await Qn({code:a,participantToken:c});if(!P)return;j(le),c&&b("ready")}catch{P&&d!=="joining"&&b("error")}};J();const z=window.setInterval(J,1200);return()=>{P=!1,window.clearInterval(z)}},[a,c,d]),n.useEffect(()=>{if(!k||!T||c)return;let P=!1;const J=window.setInterval(async()=>{try{const z=await Zr({code:a,requestId:k});if(P)return;z.status==="approved"&&(ee(!1),b("idle"))}catch{}},1200);return()=>{P=!0,window.clearInterval(J)}},[a,c,T,k]);const Ge=async()=>{b("joining");try{const P=await ei({code:a,name:i});y(P.participantToken),localStorage.setItem(Js(a),P.participantToken),ee(!1),H(null),b("ready")}catch(P){if(P instanceof as&&P.status===409)try{const J=await ti({code:a,name:i});H(J.requestId),ee(!0),b("ready");return}catch{b("error");return}b("error")}},ge=P=>{if(!!(C!=null&&C.multiple)){h(z=>z.includes(P)?z.filter(le=>le!==P):[...z,P].sort((le,xe)=>le-xe));return}h([P])},R=(P,J)=>{x(z=>{const le=[...z],xe=P+J;return xe<0||xe>=le.length?z:([le[P],le[xe]]=[le[xe],le[P]],le)})},F=()=>{const P=Array.isArray(C==null?void 0:C.columns)?C.columns:[];_(J=>[...J,P.map(()=>0)])},L=(P,J,z)=>{_(le=>le.map((xe,Ie)=>Ie!==P?xe:xe.map((Me,Xe)=>Xe===J?z:Me)))},G=async()=>{if(!c||!C||typeof C.cardKey!="string")return;let P=null;switch(C.kind){case"selection":P=w;break;case"boolean":P=N;break;case"ordering":P=v;break;case"matching":P={paths:Z};break;case"citation-fragment":case"text":default:P=o;break}try{await ai({code:a,participantToken:c,roundIndex:Number(C.roundIndex??(m==null?void 0:m.currentRoundIndex)??0),cardKey:C.cardKey,answer:P});const J=await Qn({code:a,participantToken:c});j(J),b("ready")}catch{b("error")}},D=()=>{if(!C)return e.jsx("p",{className:"cogita-help",children:r.waitingForHostQuestion});const P=!!$,J=Array.isArray(ie)?ie.map(z=>Number(z)).filter(Number.isFinite):[];if(C.kind==="citation-fragment")return e.jsxs("div",{className:"cogita-live-card-surface","data-state":P?"correct":"idle",children:[e.jsxs("p",{children:[e.jsx("span",{style:{opacity:.7},children:String(C.before??"")}),e.jsx("strong",{children:" [ ... ] "}),e.jsx("span",{style:{opacity:.7},children:String(C.after??"")})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:P?r.correctFragmentLabel:r.fragmentLabel}),e.jsx("input",{value:P?String(ie??""):o,onChange:z=>l(z.target.value),readOnly:P})]})]});if(C.kind==="text")return e.jsxs("div",{className:"cogita-live-card-surface","data-state":P?"correct":"idle",children:[e.jsx("p",{children:String(C.prompt??"")}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:P?s.correctAnswerLabel:s.answerLabel}),e.jsx("input",{type:C.inputType==="number"?"number":C.inputType==="date"?"date":"text",value:P?String(ie??""):o,onChange:z=>l(z.target.value),readOnly:P})]})]});if(C.kind==="boolean"){const z=!!ie;return e.jsxs("div",{className:"cogita-live-card-surface","data-state":P?"correct":"idle",children:[e.jsx("p",{children:String(C.prompt??"")}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:`cta ghost ${P&&z?"live-correct-answer":""}`,onClick:()=>A(!0),disabled:P,children:r.trueLabel}),e.jsx("button",{type:"button",className:`cta ghost ${P&&!z?"live-correct-answer":""}`,onClick:()=>A(!1),disabled:P,children:r.falseLabel})]})]})}if(C.kind==="selection")return e.jsxs("div",{className:"cogita-live-card-surface","data-state":P?"correct":"idle",children:[e.jsx("p",{children:String(C.prompt??"")}),e.jsx("div",{className:"cogita-share-list",children:(Array.isArray(C.options)?C.options:[]).map((z,le)=>e.jsxs("label",{className:"cogita-share-row","data-state":P&&J.includes(le)?"correct":void 0,children:[e.jsx("span",{children:z}),e.jsx("input",{type:C.multiple?"checkbox":"radio",name:"live-selection",checked:P?J.includes(le):w.includes(le),onChange:()=>ge(le),disabled:P})]},`${le}-${z}`))})]});if(C.kind==="ordering"){const z=Array.isArray(P?ie:v)?(P?ie:v).map(String):[];return e.jsxs("div",{className:"cogita-live-card-surface","data-state":P?"correct":"idle",children:[e.jsx("p",{children:String(C.prompt??"")}),e.jsx("div",{className:"cogita-share-list",children:z.map((le,xe)=>e.jsxs("div",{className:"cogita-share-row","data-state":P?"correct":void 0,children:[e.jsx("span",{children:le}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>R(xe,-1),disabled:P,children:"↑"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>R(xe,1),disabled:P,children:"↓"})]})]},`${xe}-${le}`))})]})}if(C.kind==="matching"){const z=Array.isArray(C.columns)?C.columns:[],le=(ie==null?void 0:ie.paths)??[];return e.jsxs("div",{className:"cogita-live-card-surface","data-state":P?"correct":"idle",children:[e.jsx("p",{children:String(C.prompt??"")}),P?e.jsx("div",{className:"cogita-share-list",children:le.map((xe,Ie)=>e.jsx("div",{className:"cogita-share-row","data-state":"correct",children:e.jsx("span",{children:xe.map((Me,Xe)=>{const it=Array.isArray(z[Xe])?z[Xe]:[];return`${Xe>0?" → ":""}${String(it[Me]??Me)}`})})},`path-${Ie}`))}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:F,children:r.addPathAction})}),Z.map((xe,Ie)=>e.jsx("div",{className:"cogita-form-actions",children:z.map((Me,Xe)=>e.jsx("select",{value:xe[Xe]??0,onChange:it=>L(Ie,Xe,Number(it.target.value)),children:Me.map((it,$e)=>e.jsxs("option",{value:$e,children:[$e,": ",it]},`${Xe}-${$e}`))},`path-${Ie}-col-${Xe}`))},`path-${Ie}`))]})]})}return e.jsx("p",{className:"cogita-help",children:r.unsupportedPromptType})};return e.jsx(Rt,{...t,children:e.jsx("section",{className:"cogita-library-dashboard",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid cogita-live-session-layout","data-stage":he,children:[e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:r.joinKicker}),e.jsx("h2",{className:"cogita-detail-title",children:r.joinTitle}),c?e.jsx("p",{className:"cogita-help",children:r.joinedWaiting}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:r.participantNameLabel}),e.jsx("input",{value:i,onChange:P=>u(P.target.value)})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:Ge,disabled:!i.trim()||d==="joining",children:d==="joining"?r.joiningAction:r.joinAction})})]}),T?e.jsx("p",{className:"cogita-help",children:"Relogin request sent. Wait for host approval and join again."}):null,d==="error"?e.jsx("p",{className:"cogita-help",children:r.connectionError}):null,he==="lobby"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-user-kicker",children:r.scoreboardTitle}),e.jsxs("div",{className:"cogita-share-list",children:[m==null?void 0:m.scoreboard.map(P=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("div",{children:e.jsx("strong",{children:P.displayName})}),e.jsxs("div",{className:"cogita-share-meta",children:[P.score," ",r.scoreUnit]})]},P.participantId)),m&&m.scoreboard.length===0?e.jsx("p",{className:"cogita-help",children:r.noParticipants}):null]})]}):null]}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:r.questionTitle}),e.jsx("h3",{className:"cogita-detail-title",children:typeof(C==null?void 0:C.title)=="string"?C.title:r.waitingForPublishedRound}),C?e.jsxs(e.Fragment,{children:[e.jsx(Fa,{className:"cogita-live-card-container",feedbackToken:$?`correct-${(m==null?void 0:m.revealVersion)??0}`:"idle",children:D()}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:G,disabled:!c||!C.cardKey||(m==null?void 0:m.answerSubmitted),children:m!=null&&m.answerSubmitted?r.submitted:r.submitAnswer})})]}):e.jsx("p",{className:"cogita-help",children:r.waitingForHostQuestion})]}),he!=="lobby"?e.jsxs("div",{className:"cogita-library-panel cogita-live-scoreboard-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:he==="finished"?r.finalScoreTitle:r.pointsTitle}),e.jsxs("div",{className:"cogita-share-list",children:[m==null?void 0:m.scoreboard.map(P=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("div",{children:e.jsx("strong",{children:P.displayName})}),e.jsxs("div",{className:"cogita-share-meta",children:[P.score," ",r.scoreUnit]})]},`score:${P.participantId}`)),m&&m.scoreboard.length===0?e.jsx("p",{className:"cogita-help",children:r.noParticipants}):null]})]}):null]})})})})})}const Uo=Object.freeze(Object.defineProperty({__proto__:null,CogitaLiveRevisionJoinPage:Eo},Symbol.toStringTag,{value:"Module"}));function Fo(t){const{code:a}=t,s=t.copy.cogita.library.revision.live,[r,i]=n.useState(null),[u,c]=n.useState("loading"),y=(r==null?void 0:r.currentPrompt)??null,m=(r==null?void 0:r.currentReveal)??null,j=m==null?void 0:m.expected,d=n.useMemo(()=>typeof window<"u"?`${window.location.origin}/#/cogita/public/live-revision/${encodeURIComponent(a)}`:"",[a]);n.useEffect(()=>{let o=!0;const l=async()=>{try{const h=await Qn({code:a});if(!o)return;i(h),c("ready")}catch{if(!o)return;c("error")}};l();const w=window.setInterval(l,1200);return()=>{o=!1,window.clearInterval(w)}},[a]);const b=()=>{if(!y)return e.jsx("p",{className:"cogita-help",children:s.waitingForHostQuestion});const o=String(y.kind??""),l=!!m,w=Array.isArray(j)?j.map(h=>Number(h)).filter(Number.isFinite):[];if(o==="citation-fragment")return e.jsxs("div",{className:"cogita-live-card-surface","data-state":l?"correct":"idle",children:[e.jsxs("p",{children:[e.jsx("span",{style:{opacity:.7},children:String(y.before??"")}),e.jsx("strong",{children:" [ ... ] "}),e.jsx("span",{style:{opacity:.7},children:String(y.after??"")})]}),l?e.jsx("p",{children:String(j??"")}):null]});if(o==="text")return e.jsxs("div",{className:"cogita-live-card-surface","data-state":l?"correct":"idle",children:[e.jsx("p",{children:String(y.prompt??"")}),l?e.jsx("p",{children:String(j??"")}):null]});if(o==="boolean"){const h=!!j;return e.jsxs("div",{className:"cogita-live-card-surface","data-state":l?"correct":"idle",children:[e.jsx("p",{children:String(y.prompt??"")}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:`cta ghost ${l&&h?"live-correct-answer":""}`,disabled:!0,children:s.trueLabel}),e.jsx("button",{type:"button",className:`cta ghost ${l&&!h?"live-correct-answer":""}`,disabled:!0,children:s.falseLabel})]})]})}if(o==="selection")return e.jsxs("div",{className:"cogita-live-card-surface","data-state":l?"correct":"idle",children:[e.jsx("p",{children:String(y.prompt??"")}),e.jsx("div",{className:"cogita-share-list",children:(Array.isArray(y.options)?y.options:[]).map((h,N)=>e.jsxs("label",{className:"cogita-share-row","data-state":l&&w.includes(N)?"correct":void 0,children:[e.jsx("span",{children:h}),e.jsx("input",{type:y.multiple?"checkbox":"radio",disabled:!0,checked:l?w.includes(N):!1,readOnly:!0})]},`${N}-${h}`))})]});if(o==="ordering"){const h=Array.isArray(l?j:y.options)?(l?j:y.options).map(String):[];return e.jsxs("div",{className:"cogita-live-card-surface","data-state":l?"correct":"idle",children:[e.jsx("p",{children:String(y.prompt??"")}),e.jsx("div",{className:"cogita-share-list",children:h.map((N,A)=>e.jsx("div",{className:"cogita-share-row","data-state":l?"correct":void 0,children:e.jsx("span",{children:N})},`${A}-${N}`))})]})}if(o==="matching"){const h=Array.isArray(y.columns)?y.columns:[],N=(j==null?void 0:j.paths)??[];return e.jsxs("div",{className:"cogita-live-card-surface","data-state":l?"correct":"idle",children:[e.jsx("p",{children:String(y.prompt??"")}),l?e.jsx("div",{className:"cogita-share-list",children:N.map((A,v)=>e.jsx("div",{className:"cogita-share-row","data-state":"correct",children:e.jsx("span",{children:A.map((x,Z)=>{const _=Array.isArray(h[Z])?h[Z]:[],k=String(_[x]??x);return`${Z>0?" -> ":""}${k}`})})},`path-${v}`))}):null]})}return e.jsx("p",{className:"cogita-help",children:s.unsupportedPromptType})};return e.jsx(Rt,{...t,children:e.jsx("section",{className:"cogita-library-dashboard",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid cogita-live-session-layout","data-stage":(r==null?void 0:r.status)==="lobby"?"lobby":"active",children:[e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:s.hostKicker}),e.jsx("h2",{className:"cogita-detail-title",children:u==="error"?s.connectionError:s.statusLobby}),(r==null?void 0:r.status)==="lobby"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:s.joinCodeLabel}),e.jsx("input",{readOnly:!0,value:a})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:s.joinUrlLabel}),e.jsx("input",{readOnly:!0,value:d})]}),e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:s.qrLabel}),e.jsx("div",{style:{display:"inline-flex",padding:"0.75rem",borderRadius:"12px",background:"#fff"},children:e.jsx(Hs,{value:d,size:176,marginSize:2})})]})]}):e.jsx(Fa,{className:"cogita-live-card-container",feedbackToken:m?`correct-${(r==null?void 0:r.revealVersion)??0}`:"idle",children:b()})]}),e.jsxs("div",{className:"cogita-library-panel cogita-live-scoreboard-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:(r==null?void 0:r.status)==="finished"?s.finalScoreTitle:s.pointsTitle}),e.jsxs("div",{className:"cogita-share-list",children:[((r==null?void 0:r.scoreboard)??[]).map(o=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsx("div",{children:e.jsx("strong",{children:o.displayName})}),e.jsxs("div",{className:"cogita-share-meta",children:[o.score," ",s.scoreUnit]})]},`presenter-score:${o.participantId}`)),r&&r.scoreboard.length===0?e.jsx("p",{className:"cogita-help",children:s.noParticipants}):null]})]})]})})})})})}const Jo=Object.freeze(Object.defineProperty({__proto__:null,CogitaLiveRevisionPresenterPage:Fo},Symbol.toStringTag,{value:"Module"}));function Ko(t){const a=Qa(),s=t.copy.cogita.library.revision.live,{libraryId:r}=t,[i,u]=n.useState([]),[c,y]=n.useState("loading"),[m,j]=n.useState(null),[d,b]=n.useState({}),o=n.useMemo(()=>({lobby:s.statusLobby,running:s.statusRunning,revealed:s.statusRevealed,finished:s.statusFinished}),[s.statusFinished,s.statusLobby,s.statusRevealed,s.statusRunning]),l=async()=>{y("loading");try{const h=await ni({libraryId:r});u(h),y("ready")}catch{u([]),y("error")}};n.useEffect(()=>{l()},[r]);const w=async(h,N)=>{j(h.sessionId);try{const A=d[h.sessionId]??await nr({libraryId:r,sessionId:h.sessionId});d[h.sessionId]||b(Z=>({...Z,[h.sessionId]:{sessionId:A.sessionId,code:A.code,hostSecret:A.hostSecret}}));const v=encodeURIComponent(A.code);if(N==="host"){a(`/cogita/live-revision-host/${encodeURIComponent(r)}/${encodeURIComponent(h.revisionId)}?sessionId=${encodeURIComponent(A.sessionId)}&hostSecret=${encodeURIComponent(A.hostSecret)}&code=${v}`);return}const x=N==="presenter"?`${window.location.origin}/#/cogita/public/live-revision-screen/${v}`:`${window.location.origin}/#/cogita/public/live-revision/${v}`;window.open(x,"_blank","noopener")}finally{j(null)}};return e.jsx(Rt,{...t,children:e.jsx("section",{className:"cogita-library-dashboard",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:s.hostKicker}),e.jsx("h2",{className:"cogita-detail-title",children:"Active live sessions"})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:l,children:"Refresh"})})]}),c==="loading"?e.jsx("p",{children:s.loading}):null,c==="error"?e.jsx("p",{className:"cogita-help",children:s.connectionError}):null,c==="ready"&&i.length===0?e.jsx("p",{className:"cogita-help",children:"No active sessions."}):null,e.jsx("div",{className:"cogita-share-list",children:i.map(h=>e.jsxs("div",{className:"cogita-share-row",children:[e.jsxs("div",{children:[e.jsx("strong",{children:h.title||h.sessionId}),e.jsxs("div",{className:"cogita-share-meta",children:[o[h.status]??h.status," · ",s.participantsTitle,": ",h.participantCount]})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>w(h,"host"),disabled:m===h.sessionId,children:"Host"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>w(h,"presenter"),disabled:m===h.sessionId,children:"Screen"}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>w(h,"login"),disabled:m===h.sessionId,children:"Login panel"})]})]},h.sessionId))})]})})})})})}const Ho=Object.freeze(Object.defineProperty({__proto__:null,CogitaLiveSessionsPage:Ko},Symbol.toStringTag,{value:"Module"}));export{zo as C,Oo as a,Vo as b,qo as c,Uo as d,Jo as e,Ho as f};
