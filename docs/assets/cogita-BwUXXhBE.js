import{r as i,j as e}from"./vendor-react-CfubZxc4.js";import{L as Kr,A as Or,g as qr,a as oi,c as si,e as ci,i as di,b as ui,s as Vr,d as Qa,f as Nr,h as gr,j as Pt,k as hr,l as gi,m as rr,n as tt,u as hi,o as ta,p as bi,q as mi,r as pi,t as _r,v as Ur,w as $t,x as Wr,y as zr,z as _t,B as Rt,C as fi,D as xi,E as yi,F as vi,G as ji,H as Ba,I as ki,J as wi,K as Ti,M as Ni,N as Li,O as Ci,P as Mi,Q as Si,R as Ii,S as Pi,T as $i,U as Ri,V as Ei,W as Lr}from"./recreatio-core-qKFA23S_.js";import"./vendor-cogita-ui-CWObOLS8.js";import{R as Ut,B as Wt,C as zt,H as Cr,P as Mr,a as yt,b as Fi,c as Ai,u as pr,d as fr}from"./vendor-CIYYFlAQ.js";import{u as xr,a as Bi}from"./vendor-router-Co03dAlm.js";const xt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},ft={moveMs:900,pauseMs:220,errorMs:900},Di=(a=11)=>{let l=a;const u=()=>(l=(l*1664525+1013904223)%4294967296,l/4294967296),{width:h,height:b,paddingX:M,paddingY:v,levels:E}=xt,D=(b-v*2)/(E.length-1),K=[],d=[],R=[];E.forEach((g,x)=>{const se=b-v-x*D,O=h-M*2,y=[];for(let J=0;J<g;J+=1){const B=M+(J+1)*O/(g+1),Y=(u()-.5)*18,ae=Math.max(M,Math.min(h-M,B+Y)),V=x===0?3:x<2?2.1:1.4,be=x===0?"root":`l${x}-${J}`;y.push({id:be,x:x===0?h/2:ae,y:se,r:V,level:x,role:x===0?"root":void 0})}R.push(y),K.push(...y)});const f=R[R.length-1];if(f!=null&&f.length){const g=f[Math.floor(f.length/2)];g.role="goal",g.r=2}for(let g=1;g<R.length;g+=1){const x=R[g-1];R[g].forEach(O=>{const y=[...x].sort((ae,V)=>Math.abs(ae.x-O.x)-Math.abs(V.x-O.x)),J=y[0],B=y[1]&&u()<.45?y[1]:null;(B?[J,B]:[J]).forEach(ae=>{d.push({from:ae.id,to:O.id,key:`${ae.id}-${O.id}`})}),u()<.2&&y[2]&&d.push({from:y[2].id,to:O.id,key:`${y[2].id}-${O.id}`})})}const j=new Map;d.forEach(g=>{const x=j.get(g.to)??[];x.push(g.from),j.set(g.to,x)});const U=new Map,W=new Map,H=new Map;d.forEach(g=>{const x=U.get(g.from)??[];x.push(g.key),U.set(g.from,x);const se=W.get(g.from)??[];se.push(g.to),W.set(g.from,se);const O=H.get(g.from)??[];O.push(g.to),H.set(g.from,O);const y=H.get(g.to)??[];y.push(g.from),H.set(g.to,y)});const c=new Map;return K.forEach(g=>{c.set(g.id,g)}),{nodes:K,links:d,parentsById:j,linksByFrom:U,childrenByFrom:W,neighborsById:H,nodesById:c}};function Ki({slides:a,activeIndex:l,introOpen:u,prefersReducedMotion:h,onNext:b,onPrev:M,onSelect:v,onExit:E,onOpen:D,onRegister:K}){const d=l===a.length-1,R=u&&l===0?"entry":"docked",f=a[a.length-1],[j,U]=i.useState(!1),W=i.useMemo(()=>Array.from({length:20},(N,L)=>({src:`/cogita/logo/Cogita${String(L).padStart(2,"0")}.png`,kind:L<=11?"bubble":L<=17?"text":"recreatio"})),[]),H=u&&l===0;i.useEffect(()=>{if(!u){U(!1);return}l>0&&!j&&U(!0)},[l,u,j]);const c=i.useRef(0),g=i.useRef(null),x=i.useMemo(()=>{const N={x:40,y:160},L={x:260,y:48},z=6,t=L.x-N.x,r=N.y-L.y,n=t/z,p=[.3,.45,.6,.65,1.4,2.2],T=p.reduce((le,ve)=>le+ve,0),Q=p.map(le=>r*le/T),Z=[N];let G=N.x,re=N.y;for(let le=1;le<=z;le+=1){const ve=(Math.random()-.5)*14,ea=(Math.random()-.5)*28;G=Math.max(N.x+le*14,Math.min(L.x-(z-le)*14,G+n+ve));const We=Q[le-1]??Q[Q.length-1];re=re-We+ea;const Ge=Math.max(L.y,Math.min(N.y-4,re));Z.push({x:Math.round(G),y:Math.round(Ge)})}return Z[Z.length-1]=L,Z},[]),se=i.useMemo(()=>{const r=(T,Q,Z)=>Math.min(Z,Math.max(Q,T)),n=x.map(T=>{const Q=10+Math.random()*36;return{x:r(T.x,40,260),y:r(T.y-Q,40,140)}}),p=x.map((T,Q)=>{var re;const Z=12+Math.random()*40,G=((re=n[Q])==null?void 0:re.y)??T.y;return{x:r(T.x,40,260),y:r(Math.max(G+10,T.y+Z),60,170)}});return{upper:n,lower:p}},[x]),O=i.useMemo(()=>{var L;const N=((L=x[4])==null?void 0:L.x)??260;return Math.max(0,Math.min(240,N-40))},[x]),y=i.useMemo(()=>{var Q,Z;const N=(G,re,le)=>Math.min(le,Math.max(re,G)),L=(G,re,le)=>x.map((ve,ea)=>{var ia,ua;const We=((ia=se.upper[ea])==null?void 0:ia.y)??ve.y,Ge=((ua=se.lower[ea])==null?void 0:ua.y)??ve.y,Be=(Math.random()-.5)*70,_e=ve.y+G+Be,Ae=N(ve.y+re,We+6,Ge-6),ze=N(ve.y+le,We+6,Ge-6);return{x:ve.x,y:N(_e,Math.min(Ae,ze),Math.max(Ae,ze))}}),z=-14+Math.random()*28,t=14+Math.random()*28,r=L(z,-80,12),n=L(t,-12,80);for(let G=4;G<x.length;G+=1){const re=x[G],le=((Q=se.upper[G])==null?void 0:Q.y)??re.y,ve=((Z=se.lower[G])==null?void 0:Z.y)??re.y;r[G]={x:re.x,y:N(re.y-12,le+6,ve-6)},n[G]={x:re.x,y:N(re.y+12,le+6,ve-6)}}const p=se.upper.length?se.upper[se.upper.length-1].y:40,T=se.lower.length?se.lower[se.lower.length-1].y:170;return r[r.length-1]={x:x[x.length-1].x,y:N(x[x.length-1].y-14,p,T)},n[n.length-1]={x:x[x.length-1].x,y:N(x[x.length-1].y+12,p,T)},{higher:r,lower:n}},[x,se]),J=1e4,B=i.useMemo(()=>{let N=17;const L=()=>(N=(N*1664525+1013904223)%4294967296,N/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const n=(L()-.5)*240,p=(L()-.5)*180,T=(L()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${n.toFixed(0)}px`,y:`${p.toFixed(0)}px`,rot:`${T.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),Y=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[ae,V]=i.useState([]),be=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),ke=i.useMemo(()=>{const L=[],t=(n,p)=>n+Math.random()*(p-n);for(let n=0;n<6;n+=1){let p=!1;for(let T=0;T<80;T+=1){const Q=t(14,86),Z=t(10,34);if(L.every(re=>{const le=re.x-Q,ve=re.y-Z;return Math.hypot(le,ve)>=12})){L.push({x:Q,y:Z}),p=!0;break}}p||L.push({x:t(16,84),y:t(12,32)})}return L.map((n,p)=>({id:`p${p+1}`,x:`${n.x.toFixed(1)}%`,y:`${n.y.toFixed(1)}%`,xNum:n.x,yNum:n.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[oe,A]=i.useState(0),[ge,o]=i.useState(0),[te,k]=i.useState([]),S=1e4,ye=i.useMemo(()=>{if(ke.length<2)return[];const N=p=>{let T=p+1831565813;return T=Math.imul(T^T>>>15,T|1),T^=T+Math.imul(T^T>>>7,T|61),((T^T>>>14)>>>0)/4294967296},L=(p,T)=>Math.floor(N(p)*T),z=new Set,t=[],r=Math.min(3,ke.length);let n=0;for(;t.length<r&&n<30;){n+=1;const p=L(oe*13+n*5,ke.length),T=L(oe*29+n*7,ke.length);if(p===T)continue;const Q=p<T?`${p}-${T}`:`${T}-${p}`;z.has(Q)||(z.add(Q),t.push({id:`link-${Q}`,from:ke[p],to:ke[T],delay:`${(n*.35).toFixed(2)}s`}))}return t},[oe,ke]);i.useEffect(()=>{if(!u||l!==2)return;const N=()=>{const z=B.map(t=>t.id);for(let t=z.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[z[t],z[r]]=[z[r],z[t]]}return z.slice(0,4)};V(N());const L=window.setInterval(()=>{V(N())},J);return()=>window.clearInterval(L)},[l,u,B,J]),i.useEffect(()=>{if(!u||l!==3)return;const N=()=>{o(Math.floor(Math.random()*be.length)),k(ke.map(()=>Math.random()<.6?"good":"bad")),A(z=>z+1)};N();const L=window.setInterval(N,S);return()=>window.clearInterval(L)},[l,u,be.length,ke,S]);const q=i.useMemo(()=>Di(11),[]),[ne,we]=i.useState(new Set(["root"])),[Ne,Re]=i.useState(new Set),[Se,Fe]=i.useState(new Set),[me,Je]=i.useState({fromId:"root",toId:"root",key:0}),Pe=i.useRef(ne),Ue=i.useRef("root"),ra=i.useRef(0),Le=i.useRef(null),ee=i.useRef(null),Te=i.useRef([]);i.useEffect(()=>{Pe.current=ne},[ne]);const qe=i.useMemo(()=>{const N=new Set;return ne.forEach(L=>{const z=q.linksByFrom.get(L);z&&z.forEach(t=>N.add(t))}),N},[ne,q]),Ie=q.nodesById.get(me.toId)??q.nodesById.get("root"),de=Ie?`${Ie.x/xt.width*100}%`:"50%",Ee=Ie?`${Ie.y/xt.height*100}%`:"90%";i.useEffect(()=>{if(!u||l!==1||h)return;(()=>{we(new Set(["root"])),Re(new Set),Fe(new Set),Je({fromId:"root",toId:"root",key:0}),ee.current=null,ra.current=0,Ue.current="root",Te.current=[]})();const L=()=>{const t=Ue.current,r=Pe.current,p=(q.childrenByFrom.get(t)??[]).filter(ve=>!r.has(ve));if(p.length)return p[Math.floor(Math.random()*p.length)];if(r.size>=q.nodes.length){const ve=q.neighborsById.get(t)??[];return ve.length?ve[Math.floor(Math.random()*ve.length)]:null}const T=ve=>(q.childrenByFrom.get(ve)??[]).some(We=>!r.has(We)),Q=[t],Z=new Set([t]),G=new Map;let re=null;for(;Q.length;){const ve=Q.shift();if(!ve)break;if(ve!==t&&T(ve)){re=ve;break}(q.neighborsById.get(ve)??[]).forEach(We=>{Z.has(We)||(Z.add(We),G.set(We,ve),Q.push(We))})}if(!re)return null;let le=re;for(;G.get(le)&&G.get(le)!==t;)le=G.get(le)??le;return le},z=(t,r)=>{if(t===r){const n=L();n&&z(t,n);return}ra.current+=1,Je({fromId:t,toId:r,key:ra.current}),Ue.current=r,Le.current=window.setTimeout(()=>{const n=q.parentsById.get(r)??[],p=Pe.current,T=n.filter(re=>!p.has(re));if(!T.length){const re=new Set(p);re.add(r),we(re),Le.current=window.setTimeout(()=>{for(;Te.current.length;){const ve=Te.current[Te.current.length-1];if(!re.has(ve)){if(ve!==r){z(r,ve);return}break}Te.current.pop()}const le=L();le&&z(r,le)},ft.pauseMs);return}const Q=new Set([r,...T]),Z=new Set(T.map(re=>`${re}-${r}`));Re(Q),Fe(Z),Te.current.includes(r)||Te.current.push(r);const G=T[Math.floor(Math.random()*T.length)];ee.current={fromId:r,toId:G},Le.current=window.setTimeout(()=>{Re(new Set),Fe(new Set);const re=ee.current;re&&z(re.fromId,re.toId)},ft.errorMs)},ft.moveMs)};return Le.current=window.setTimeout(()=>{const t=L();t&&z(Ue.current,t)},ft.pauseMs),()=>{Le.current&&window.clearTimeout(Le.current)}},[l,u,q,h]);const Ke=N=>{if(!u)return;const L=Date.now();L-c.current<520||Math.abs(N.deltaY)<10||(c.current=L,N.deltaY>0?b():M(),N.preventDefault())},Oe=N=>{if(!u)return;const L=N.touches[0];L&&(g.current={x:L.clientX,y:L.clientY})},Ce=N=>{if(!u)return;const L=g.current;if(g.current=null,!L)return;const z=N.changedTouches[0];if(!z)return;const t=z.clientX-L.x,r=z.clientY-L.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?b():M())};return e.jsxs("div",{className:`cogita-intro ${u?"is-open":"is-closed"} ${h?"is-reduced":""} ${d?"is-final":""}`,"data-slide":l+1,onWheel:Ke,onTouchStart:Oe,onTouchEnd:Ce,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":R,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${H&&!j?"is-entry":""}`,children:W.map((N,L)=>e.jsx("img",{src:N.src,alt:"",className:`cogita-logo-layer ${L===0?"is-base":""} ${N.kind==="text"?"is-text":N.kind==="recreatio"?"is-recreatio":""} ${N.kind==="bubble"?"is-bubble":""}`},N.src))})}),u&&a.map((N,L)=>{const z=L===l;return e.jsxs("section",{className:`cogita-intro-slide slide-${L+1} ${z?"is-active":""}`,"aria-hidden":!z,children:[e.jsxs("div",{className:"cogita-intro-text",children:[N.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:N.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:N.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:N.title}),N.body&&e.jsx("p",{children:N.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),N.micro&&e.jsx("p",{className:"cogita-intro-micro",children:N.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:d?K:b,children:N.cta}),d&&N.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>v(0),children:N.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[L===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${xt.width} ${xt.height}`,preserveAspectRatio:"none",children:[q.links.map(t=>{const r=q.nodesById.get(t.from),n=q.nodesById.get(t.to);if(!r||!n)return null;const p=qe.has(t.key),T=Se.has(t.key);return e.jsx("line",{className:`map-link ${p?"is-active":""} ${T?"is-error":""}`,x1:r.x,y1:r.y,x2:n.x,y2:n.y},t.key)}),q.nodes.map(t=>{const r=ne.has(t.id),n=Ne.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${n?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Ie&&e.jsx("span",{className:"map-explorer-dot",style:{left:de,top:Ee,"--move":`${ft.moveMs}ms`}})]}),L===2&&e.jsx("div",{className:"cogita-index-cards",children:B.map(t=>{const r=ae.indexOf(t.id),n=r>=0?Y[r]:null,p=(n==null?void 0:n.x)??"140px",T=(n==null?void 0:n.y)??"140px",Q=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":p,"--stack-y":T,"--stack-opacity":Q,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),L===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[be.map((t,r)=>e.jsxs("div",{className:`round-card ${r===ge?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),be[ge]&&e.jsx("span",{className:"round-ring",style:{"--card-x":be[ge].x,"--card-y":`calc(${be[ge].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:ke.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:ye.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:ke.map((t,r)=>{const n=te[r]??"good",p=be[ge];if(!p)return null;const T=`calc(${p.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":p.x,"--to-y":T,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${n}`,style:{"--from-x":p.x,"--from-y":T,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${n}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${oe}`)})})]},`round-${oe}`),L===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${x[0].x} ${x[0].y} L${x[1].x} ${x[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${x[1].x} ${x[1].y} L${x[2].x} ${x[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${x[2].x} ${x[2].y} L${x[3].x} ${x[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${x[3].x} ${x[3].y} L${x[4].x} ${x[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${x[4].x} ${x[4].y} L${x[5].x} ${x[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${x[5].x} ${x[5].y} L${x[6].x} ${x[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${O};${O};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${se.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${se.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${se.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${se.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[y.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${y.higher[r+1].x} ${y.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),y.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${y.lower[r+1].x} ${y.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${x[0].x/300*100}%`,"--p0y":`${x[0].y/200*100}%`,"--p1x":`${x[1].x/300*100}%`,"--p1y":`${x[1].y/200*100}%`,"--p2x":`${x[2].x/300*100}%`,"--p2y":`${x[2].y/200*100}%`,"--p3x":`${x[3].x/300*100}%`,"--p3y":`${x[3].y/200*100}%`,"--p4x":`${x[4].x/300*100}%`,"--p4y":`${x[4].y/200*100}%`,"--p5x":`${x[5].x/300*100}%`,"--p5y":`${x[5].y/200*100}%`,"--p6x":`${x[6].x/300*100}%`,"--p6y":`${x[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${y.higher[0].x/300*100}%`,"--q0y":`${y.higher[0].y/200*100}%`,"--q1x":`${y.higher[1].x/300*100}%`,"--q1y":`${y.higher[1].y/200*100}%`,"--q2x":`${y.higher[2].x/300*100}%`,"--q2y":`${y.higher[2].y/200*100}%`,"--q3x":`${y.higher[3].x/300*100}%`,"--q3y":`${y.higher[3].y/200*100}%`,"--q4x":`${y.higher[4].x/300*100}%`,"--q4y":`${y.higher[4].y/200*100}%`,"--q5x":`${y.higher[5].x/300*100}%`,"--q5y":`${y.higher[5].y/200*100}%`,"--q6x":`${y.higher[6].x/300*100}%`,"--q6y":`${y.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${y.lower[0].x/300*100}%`,"--q0y":`${y.lower[0].y/200*100}%`,"--q1x":`${y.lower[1].x/300*100}%`,"--q1y":`${y.lower[1].y/200*100}%`,"--q2x":`${y.lower[2].x/300*100}%`,"--q2y":`${y.lower[2].y/200*100}%`,"--q3x":`${y.lower[3].x/300*100}%`,"--q3y":`${y.lower[3].y/200*100}%`,"--q4x":`${y.lower[4].x/300*100}%`,"--q4y":`${y.lower[4].y/200*100}%`,"--q5x":`${y.lower[5].x/300*100}%`,"--q5y":`${y.lower[5].y/200*100}%`,"--q6x":`${y.lower[6].x/300*100}%`,"--q6y":`${y.lower[6].y/200*100}%`}})]})})}),L===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),L===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},N.id)}),!u&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:f.title}),f.body&&e.jsx("p",{children:f.body}),f.micro&&e.jsx("p",{className:"cogita-intro-micro",children:f.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:K,children:f.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:D,children:"Otwórz pokaz"})]})]})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((N,L)=>e.jsx("button",{type:"button",className:`dot ${l===L?"active":""}`,"aria-label":N.title,onClick:()=>v(L)},N.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:E,children:"Pomiń"})]})]})}const Oi=6,qi=4;function Vi({copy:a,onAuthAction:l,authLabel:u,showProfileMenu:h,onProfileNavigate:b,onToggleSecureMode:M,onLogout:v,secureMode:E,onNavigate:D,language:K,onLanguageChange:d}){const R=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}D("home")},f=i.useRef(null),j=i.useRef([]),U=i.useMemo(()=>{let k=Date.now()%2147483647;const S=()=>(k=k*48271%2147483647,k/2147483647);return Array.from({length:Oi},(ye,q)=>{const ne=6+S()*8,we=7+S()*10,Ne=6+S()*9,Re=-S()*ne,Se=-S()*we,Fe=-S()*Ne,me=.18+S()*.28,Je=12+S()*18,Pe=4+S()*8,Ue=(S()-.5)*3.2,ra=(S()-.5)*3.8,Le=S()>.5?"alternate":"alternate-reverse",ee=S()>.5?"alternate":"alternate-reverse",Te=S()>.5?"alternate":"alternate-reverse",qe=.18+S()*.42,Ie=30+S()*60,de=-45-S()*38,Ee=188+S()*32,Ke=.1+S()*.2;return{id:`wave-${q+1}`,style:{"--wave-sway-duration":`${ne}s`,"--wave-scale-duration":`${we}s`,"--wave-drift-duration":`${Ne}s`,"--wave-sway-delay":`${Re}s`,"--wave-scale-delay":`${Se}s`,"--wave-drift-delay":`${Fe}s`,"--wave-sway-dir":Le,"--wave-scale-dir":ee,"--wave-drift-dir":Te,"--wave-scale":`${me}`,"--wave-shift":`${Je}%`,"--wave-xshift":`${Pe}%`,"--wave-x0":`${Ue}%`,"--wave-y0":`${ra}%`,"--wave-opacity":`${qe}`,"--wave-blur":`${Ie}px`,"--wave-bottom":`${de}%`,"--wave-hue":`${Ee}`,"--wave-glow":`${Ke}`}}})},[]),W=i.useMemo(()=>{let k=Date.now()*3%2147483647;const S=()=>(k=k*48271%2147483647,k/2147483647);return Array.from({length:qi},(ye,q)=>{const ne=180+S()*220,we=220+S()*280,Ne=-S()*ne,Re=-S()*we,Se=.12+S()*.22,Fe=3+S()*7,me=1+S()*3,Je=(S()-.5)*2.8,Pe=(S()-.5)*2.2;return{id:`mesh-${q+1}`,seed:1e3+q*991+Math.floor(S()*999),style:{"--mesh-sway-duration":`${ne}s`,"--mesh-drift-duration":`${we}s`,"--mesh-sway-delay":`${Ne}s`,"--mesh-drift-delay":`${Re}s`,"--mesh-scale":`${Se}`,"--mesh-shift":`${Fe}%`,"--mesh-xshift":`${me}%`,"--mesh-x0":`${Pe}%`,"--mesh-y0":`${Je}%`}}})},[]),H=i.useMemo(()=>{const k=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],S=a.cogita.introSlides,ye=new Map(S.map(q=>[q.id,q]));return k.map(q=>{var we;const ne=ye.get(q.id);return{...q,...ne,title:(ne==null?void 0:ne.title)??"Cogita",cta:(ne==null?void 0:ne.cta)??((we=a.cogita.introSlides[0])==null?void 0:we.cta)??a.cogita.loginCta,secondary:ne==null?void 0:ne.secondary}})},[a.cogita.introSlides]),[c,g]=i.useState(0),[x,se]=i.useState(!0),[O,y]=i.useState(!1),J=H.length-1,B=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),Y=i.useCallback(()=>{B(),l()},[B,l]),ae=i.useCallback(()=>{se(!0),g(0)},[]),V=i.useCallback(()=>{se(!1),g(J)},[J]),be=i.useCallback(k=>{g(Math.max(0,Math.min(J,k)))},[J]),ke=i.useCallback(()=>{c>=J?Y():be(c+1)},[c,be,Y,J]),oe=i.useCallback(()=>{be(c-1)},[c,be]);i.useEffect(()=>{var ye;const k=(ye=window.matchMedia)==null?void 0:ye.call(window,"(prefers-reduced-motion: reduce)");if(!k)return;const S=()=>y(k.matches);return S(),k.addEventListener?(k.addEventListener("change",S),()=>k.removeEventListener("change",S)):(k.addListener(S),()=>k.removeListener(S))},[]),i.useEffect(()=>{if(!x)return;const k=S=>{const ye=S.target;if(!ye)return;const q=ye.tagName;if(!(ye.isContentEditable||q==="INPUT"||q==="TEXTAREA"||q==="SELECT"||q==="BUTTON"||q==="A"||ye.closest('button, a, [role="button"], [role="link"]'))){if(S.key==="Escape"){V();return}if(S.key==="ArrowLeft"||S.key==="ArrowUp"){oe();return}(S.key==="ArrowRight"||S.key==="ArrowDown"||S.code==="Space"||S.key===" ")&&(S.preventDefault(),ke())}};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[V,ke,oe,x]),i.useEffect(()=>{x&&c===J&&B()},[c,x,J,B]),i.useEffect(()=>{const k=f.current;if(!k)return;const S=j.current.filter(de=>!!de);if(!S.length)return;const ye=1,q=.6,ne=.6,we=Math.max(1,Math.min(ye,window.devicePixelRatio||1));let Ne=0,Re=0,Se=q,Fe=0,me=0;const Je=de=>{let Ee=de%2147483647;return Ee<=0&&(Ee+=2147483646),(Ke,Oe)=>{Ee=Ee*48271%2147483647;const Ce=Ee/2147483647;return Ke+Ce*(Oe-Ke)}},Pe={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},Ue=de=>{const Ee=Math.sin(de*12.9898)*43758.5453;return Ee-Math.floor(Ee)},ra=de=>{const Ee=Ue(de+.1)||1e-4,Ke=Ue(de+.7)||1e-4;return Math.sqrt(-2*Math.log(Ee))*Math.cos(2*Math.PI*Ke)},Le=(de,Ee)=>{const Ke=Math.floor(de),Oe=Ke+1,Ce=de-Ke,N=Ce*Ce*(3-2*Ce),L=Ue(Ke*12.9898+Ee*78.233),z=Ue(Oe*12.9898+Ee*78.233);return L+(z-L)*N},ee=de=>{const Ee=Je(de),Ke=Math.min(4,Math.max(4,Math.floor(Ne/1200*Pe.filamentCount)));return Array.from({length:Ke},(Oe,Ce)=>{const N=Math.max(-1,Math.min(1,ra(de+Ce*.37))),L=Math.min(1,Math.max(0,Ue(de+Ce*1.31))),z=Math.min(Pe.depthLayers-1,Math.floor(L*Pe.depthLayers));return{seed:Ee(0,Math.PI*2)+de*.01,offset:N,freqA:Pe.freq1*(.75+Ee(0,.5)),freqB:Pe.freq2*(.75+Ee(0,.5)),ampA:Pe.amp1*(.6+Ee(0,.7)),ampB:Pe.amp2*(.6+Ee(0,.7)),width:2+Ce%5*.32,depth:L,layer:z}})},Te=(de,Ee,Ke)=>{const Oe=Math.max(30,Math.floor(Ne*Re/14e4));de.save(),de.globalAlpha=.6;for(let Ce=0;Ce<Oe;Ce+=1){const N=Ue(Ce*9.1+Ne*.11)*Ee+Ke,L=Ue(Ce*3.7+Re*.23)*Re,z=1.2+Ue(Ce*5.9)*2.4,t=de.createRadialGradient(N,L,0,N,L,z*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),de.fillStyle=t,de.beginPath(),de.arc(N,L,z*2,0,Math.PI*2),de.fill()}de.restore()},qe=(de,Ee)=>{de.clearRect(0,0,Ne,Re);const Ke=Re*Pe.waveCenter,Oe=Pe.waveBandPx,Ce=Pe.segments,N=Pe.colors.filaments,L=Fe||Ne,z=0;Te(de,L,z),de.strokeStyle=N,de.lineCap="round",de.lineJoin="round";for(let t=0;t<Ee.length;t+=1){const r=Ee[t],n=r.offset*Oe*(.85+Ue(r.seed)*.4),p=1-Math.min(1,Math.abs(n)/Oe),T=Math.exp(-Math.pow(n/Pe.crestThickness,2)),Q=r.layer===0?1.1:r.layer===1?.85:.6,Z=.35+(1-r.depth)*.65,G=p*Z*Q*(.34+T*.45);de.globalAlpha=G,de.lineWidth=r.width*(1+(1-r.depth)*.8);const re=[];for(let ve=0;ve<=Ce;ve+=1){const ea=ve/Ce*L+z,We=(Le(ea*.012,r.seed)-.5)*Pe.xJitter,Ge=ea+We,Be=(Le(Ge*r.freqA,r.seed)-.5)*Pe.jitterA,_e=(Le(Ge*r.freqB,r.seed*1.7)-.5)*Pe.jitterB,Ae=Ke+Math.sin(Ge*r.freqA+r.seed)*r.ampA+Math.sin(Ge*r.freqB+r.seed*1.3)*r.ampB+n+Be+_e;re.push({x:Ge,y:Ae})}de.beginPath(),de.moveTo(re[0].x,re[0].y);for(let ve=1;ve<re.length-1;ve+=1){const ea=(re[ve].x+re[ve+1].x)/2,We=(re[ve].y+re[ve+1].y)/2;de.quadraticCurveTo(re[ve].x,re[ve].y,ea,We)}const le=re[re.length-1];de.quadraticCurveTo(le.x,le.y,le.x,le.y),de.stroke()}de.save(),de.globalCompositeOperation="lighter",de.strokeStyle=Pe.colors.glow,de.lineCap="round",de.lineJoin="round";for(let t=0;t<Ee.length;t+=1){const r=Ee[t];if(Math.abs(r.offset)*Oe>Pe.crestThickness)continue;const n=Pe.glowAlpha*(.7+(1-r.depth)*.6);de.globalAlpha=n,de.lineWidth=1.6+(1-r.depth)*1.2;const p=[];for(let Q=0;Q<=Ce;Q+=1){const Z=Q/Ce*L+z,G=Math.sin(Z*.02+r.seed)*3,re=Ke+Math.sin(Z*r.freqA+r.seed)*r.ampA+Math.sin(Z*r.freqB+r.seed*1.3)*r.ampB+r.offset*Oe*.35+G;p.push({x:Z,y:re})}de.beginPath(),de.moveTo(p[0].x,p[0].y);for(let Q=1;Q<p.length-1;Q+=1){const Z=(p[Q].x+p[Q+1].x)/2,G=(p[Q].y+p[Q+1].y)/2;de.quadraticCurveTo(p[Q].x,p[Q].y,Z,G)}const T=p[p.length-1];de.quadraticCurveTo(T.x,T.y,T.x,T.y),de.stroke()}de.restore()},Ie=()=>{Ne=Math.floor(k.clientWidth),Re=Math.floor(k.clientHeight),Fe=Math.floor(Ne*1.8),me=Re,Se=Ne<820?ne:q,S.forEach(de=>{const Ee=de.getContext("2d");if(!Ee)return;de.width=Math.floor(Fe*we*Se),de.height=Math.floor(me*we*Se),de.style.width=`${Fe}px`,de.style.height=`${me}px`,de.style.left=`${-(Fe-Ne)/2}px`,Ee.setTransform(we*Se,0,0,we*Se,0,0);const Ke=Number(de.dataset.seed||1),Oe=ee(Ke);qe(Ee,Oe)})};return Ie(),window.addEventListener("resize",Ie,{passive:!0}),()=>window.removeEventListener("resize",Ie)},[W]);const A=H[Math.min(c,H.length-1)],ge=x?A:H[H.length-1],o=(ge==null?void 0:ge.theme)??H[0].theme,te={"--cogita-bg0":o.bg0,"--cogita-bg1":o.bg1,"--cogita-bg2":o.bg2,"--cogita-bloom":o.bloom,"--cogita-sat":o.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:R,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Kr,{value:K,onChange:d}),e.jsx(Or,{copy:a,label:u,isAuthenticated:h,secureMode:E,onLogin:l,onProfileNavigate:b,onToggleSecureMode:M,onLogout:v,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:f,className:"cogita-section cogita-home",style:te,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[W.map((k,S)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:k.style,"data-seed":k.seed,ref:ye=>{j.current[S]=ye}},k.id)),U.map(k=>e.jsx("div",{className:"cogita-home-wave",style:k.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},k.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Ki,{slides:H,activeIndex:c,introOpen:x,prefersReducedMotion:O,onNext:ke,onPrev:oe,onSelect:be,onExit:V,onOpen:ae,onRegister:Y})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const zn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Vi},Symbol.toStringTag,{value:"Module"})),Hr=i.createContext(!1);function ka({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:d}){if(i.useContext(Hr))return e.jsx(e.Fragment,{children:d});const f=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}E("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:f,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Kr,{value:D,onChange:K}),e.jsx(Or,{copy:a,label:l,isAuthenticated:u,secureMode:v,onLogin:()=>E("home"),onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:d}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function Da(a){const[l,u]=i.useState("Cogita library"),[h,b]=i.useState(null);return i.useEffect(()=>{let M=!1;return qr().then(v=>{if(M)return;const E=v.find(D=>D.libraryId===a);E&&u(E.name)}).catch(()=>{M||u("Cogita library")}),()=>{M=!0}},[a]),i.useEffect(()=>{let M=!1;return oi(a).then(v=>{M||b(v)}).catch(()=>{M||b(null)}),()=>{M=!0}},[a]),{libraryName:l,stats:h}}function _i({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d}){const{libraryName:R,stats:f}=Da(d),[j,U]=i.useState(null),[W,H]=i.useState(null),[c,g]=i.useState(null),[x,se]=i.useState(null),[O,y]=i.useState(null),[J,B]=i.useState(null),[Y,ae]=i.useState(null),V=i.useRef(null),be=`/#/cogita/library/${d}`,ke=o=>{if(!Number.isFinite(o))return"0 B";if(o<1024)return`${o} B`;const te=o/1024;if(te<1024)return`${te.toFixed(1)} KB`;const k=te/1024;return k<1024?`${k.toFixed(1)} MB`:`${(k/1024).toFixed(1)} GB`},oe=async()=>{U(null);try{const o=await si(d);U(a.cogita.library.overview.seedSuccess.replace("{languages}",String(o.languages)).replace("{translations}",String(o.translations)))}catch{U(a.cogita.library.overview.seedFail)}},A=async()=>{H(null),B({loadedBytes:0,totalBytes:null,percent:null});try{H(a.cogita.library.overview.exporting);const o=await ci(d,B),te=URL.createObjectURL(o),k=document.createElement("a");k.href=te,k.download=`cogita-library-${R||d}.json`,k.click(),URL.revokeObjectURL(te),H(a.cogita.library.overview.exportReady)}catch{H(a.cogita.library.overview.exportFail)}finally{B(o=>o??{loadedBytes:0,totalBytes:null,percent:null})}},ge=async o=>{var k;g(null),se(null),y(null);const te=(k=o.target.files)==null?void 0:k[0];if(te)try{g(a.cogita.library.overview.importing),ae({loadedBytes:0,totalBytes:te.size,percent:0});const S=await di(d,te,ae,ye=>{const q=ye.stage==="infos"?a.cogita.library.overview.importStageInfos:ye.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;y(a.cogita.library.overview.importLiveProgress.replace("{stage}",q).replace("{done}",String(ye.processed)).replace("{total}",String(ye.total)).replace("{infos}",String(ye.infos)).replace("{connections}",String(ye.connections)).replace("{collections}",String(ye.collections)))});se({infos:S.infosImported,connections:S.connectionsImported,collections:S.collectionsImported}),g(a.cogita.library.overview.importDone)}catch(S){const ye=S instanceof ui&&S.message?` ${S.message}`:"";g(`${a.cogita.library.overview.importFail}${ye}`)}finally{V.current&&(V.current.value="")}};return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h1",{className:"cogita-library-title",children:R}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${be}/list`,children:a.cogita.library.actions.openList}),e.jsx("a",{className:"cta ghost",href:`${be}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${be}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsxs("div",{className:"cogita-library-stats",children:[e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.totalInfos}),e.jsx("strong",{children:(f==null?void 0:f.totalInfos)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.connections}),e.jsx("strong",{children:(f==null?void 0:f.totalConnections)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.words}),e.jsx("strong",{children:(f==null?void 0:f.totalWords)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.sentences}),e.jsx("strong",{children:(f==null?void 0:f.totalSentences)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.languages}),e.jsx("strong",{children:(f==null?void 0:f.totalLanguages)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.collections}),e.jsx("strong",{children:(f==null?void 0:f.totalCollections)??0})]})]}),e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.quickActionsTitle}),e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.overview.quickActionsText}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("a",{className:"cta ghost",href:`${be}/list`,children:a.cogita.library.overview.browseList}),e.jsx("a",{className:"cta ghost",href:`${be}/collections`,children:a.cogita.library.overview.viewCollections}),e.jsx("a",{className:"cta",href:`${be}/new`,children:a.cogita.library.overview.addInfo})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta ghost",onClick:oe,children:a.cogita.library.overview.seedMock}),j?e.jsx("p",{className:"cogita-help",children:j}):null]})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.focusTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.focusBody1}),e.jsx("p",{children:a.cogita.library.overview.focusBody2})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:A,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:V,type:"file",accept:"application/json",onChange:ge})]})]}),J?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:J.percent??void 0,max:J.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ke(J.loadedBytes)).replace("{total}",J.totalBytes?ke(J.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,Y?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:Y.percent??void 0,max:Y.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ke(Y.loadedBytes)).replace("{total}",Y.totalBytes?ke(Y.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,W?e.jsx("p",{className:"cogita-help",children:W}):null,c?e.jsx("p",{className:"cogita-help",children:c}):null,O?e.jsx("p",{className:"cogita-help",children:O}):null,x?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(x.infos)).replace("{connections}",String(x.connections)).replace("{collections}",String(x.collections))}):null]})]})]})]})]})})]})})}const ue=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Ca=(a,l,u,h)=>`${a}:${l}:${u??""}:${h??""}`,Qe=(a,l)=>{const u=a.cogita.library.infoTypes;return{any:u.any,vocab:u.vocab,language:u.language,word:u.word,sentence:u.sentence,topic:u.topic,collection:u.collection,person:u.person,institution:u.institution,collective:u.collective,orcid:u.orcid,address:u.address,email:u.email,phone:u.phone,media:u.media,work:u.work,geo:u.geo,music_piece:u.musicPiece,music_fragment:u.musicFragment,source:u.source,quote:u.quote,computed:u.computed}[l]??String(l)},Jr=a=>[{value:"any",label:Qe(a,"any")},{value:"language",label:Qe(a,"language")},{value:"word",label:Qe(a,"word")},{value:"sentence",label:Qe(a,"sentence")},{value:"topic",label:Qe(a,"topic")},{value:"collection",label:Qe(a,"collection")},{value:"person",label:Qe(a,"person")},{value:"institution",label:Qe(a,"institution")},{value:"collective",label:Qe(a,"collective")},{value:"orcid",label:Qe(a,"orcid")},{value:"address",label:Qe(a,"address")},{value:"email",label:Qe(a,"email")},{value:"phone",label:Qe(a,"phone")},{value:"media",label:Qe(a,"media")},{value:"work",label:Qe(a,"work")},{value:"geo",label:Qe(a,"geo")},{value:"music_piece",label:Qe(a,"music_piece")},{value:"music_fragment",label:Qe(a,"music_fragment")},{value:"source",label:Qe(a,"source")},{value:"quote",label:Qe(a,"quote")},{value:"computed",label:Qe(a,"computed")}],Ui=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Wi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],zi=a=>[{value:"any",label:Qe(a,"any")},{value:"vocab",label:Qe(a,"vocab")},...Jr(a).filter(l=>l.value!=="any")],Ya=5,Sr=50,Ir=2,Pr=[];function De({libraryId:a,infoType:l,label:u,placeholder:h,value:b,onChange:M,values:v,onChangeMultiple:E,helperText:D,searchFailedText:K,createFailedText:d,createLabel:R,savingLabel:f,loadMoreLabel:j,inputRef:U,autoAdvance:W,onCommit:H,multiple:c}){const g=c?v??Pr:Pr,[x,se]=i.useState(c?"":(b==null?void 0:b.label)??""),[O,y]=i.useState([]),[J,B]=i.useState(Ya),[Y,ae]=i.useState(-1),[V,be]=i.useState(!1),[ke,oe]=i.useState(!1),[A,ge]=i.useState(null),o=i.useRef(0),te=i.useRef(new Map),k=i.useMemo(()=>c?x.trim().length>0:x.trim().length>0&&!b,[x,b,c]);i.useEffect(()=>{c||se((b==null?void 0:b.label)??"")},[b,c]),i.useEffect(()=>{const q=x.trim();if(!q||q.length<Ir){y([]),be(!1),B(Ya),ae(-1),oe(!1),ge(null);return}const ne=q.toLowerCase(),we=`${a}:${l}:${ne}`,Ne=te.current.get(we);if(Ne){if(c&&g.length>0){const Se=new Set(g.map(Fe=>Fe.id));y(Ne.filter(Fe=>!Se.has(Fe.id)))}else y(Ne);B(Ya),ae(-1),be(Ne.length>0),oe(!1),ge(null);return}const Re=window.setTimeout(async()=>{const Se=Date.now();o.current=Se,oe(!0),ge(null);try{const Fe=await Vr({libraryId:a,type:l,query:q,limit:Sr});if(o.current!==Se)return;const me=Fe.slice(0,Sr).map(Je=>({id:Je.infoId,label:Je.label,infoType:Je.infoType}));if(te.current.set(we,me),c&&g.length>0){const Je=new Set(g.map(Pe=>Pe.id));y(me.filter(Pe=>!Je.has(Pe.id)))}else y(me);B(Ya),ae(-1),be(!0)}catch{if(o.current!==Se)return;ge(K??"Search failed.")}finally{o.current===Se&&oe(!1)}},250);return()=>window.clearTimeout(Re)},[a,l,x,g]);const S=q=>{if(c){const ne=g.some(we=>we.id===q.id)?g:[...g,q];E==null||E(ne),se(""),be(!1),ae(-1);return}M==null||M(q),se(q.label),be(!1),ae(-1),W&&(H==null||H())},ye=async()=>{const q=x.trim();if(q){oe(!0),ge(null);try{const ne=await Qa({libraryId:a,infoType:l,payload:{label:q}}),we={id:ne.infoId,label:q,infoType:ne.infoType};if(q.length>=Ir){const Ne=`${a}:${l}:${q.toLowerCase()}`,Re=te.current.get(Ne)??[];te.current.set(Ne,[we,...Re])}if(c){E==null||E([...g,we]),se(""),be(!1),ae(-1);return}M==null||M(we),be(!1),ae(-1),W&&(H==null||H())}catch{ge(d??"Create failed.")}finally{oe(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:u}),e.jsx("input",{value:x,placeholder:h,onChange:q=>{se(q.target.value),!c&&b&&(M==null||M(null))},onKeyDown:q=>{if(q.key==="ArrowDown"){if(q.preventDefault(),!O.length)return;be(!0),ae(ne=>{const we=Math.min(O.length,J)-1,Ne=ne<0?0:Math.min(ne+1,we);return Ne===we&&O.length>J?(B(Re=>Math.min(Re+Ya,O.length)),Math.min(ne+1,Math.min(O.length,J+Ya)-1)):Ne});return}if(q.key==="ArrowUp"){if(q.preventDefault(),!O.length)return;be(!0),ae(ne=>ne<=0?0:ne-1);return}if(q.key==="Enter"){if(q.preventDefault(),Y>=0&&O[Y]){S(O[Y]);return}if(k){ye();return}}},onFocus:()=>{O.length>0&&be(!0)},autoComplete:"off",ref:U})]}),c&&g.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:g.map(q=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>E==null?void 0:E(g.filter(ne=>ne.id!==q.id)),children:[q.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},q.id))}),D&&e.jsx("p",{className:"cogita-help",children:D}),A&&e.jsx("p",{className:"cogita-error",children:A}),V&&O.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[O.slice(0,J).map((q,ne)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":ne===Y,onClick:()=>S(q),children:[e.jsx("strong",{children:q.label}),e.jsx("span",{children:q.infoType})]},q.id)),J<O.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>B(q=>Math.min(q+Ya,O.length)),children:j??"Load more"})]}),k&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:ye,disabled:ke,children:ke?f??"Saving...":R??`Create new ${l}`})]})}function Hi({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d,mode:R}){const{libraryName:f}=Da(d),j=`/#/cogita/library/${d}`,[U,W]=i.useState("any"),[H,c]=i.useState(""),[g,x]=i.useState([]),[se,O]=i.useState("idle"),[y,J]=i.useState(null),[B,Y]=i.useState(null),[ae,V]=i.useState("idle"),[be,ke]=i.useState(0),[oe,A]=i.useState(null),[ge,o]=i.useState("idle"),[te,k]=i.useState(null),[S,ye]=i.useState(null),[q,ne]=i.useState(null),[we,Ne]=i.useState(null),Re=i.useMemo(()=>({languageAId:(te==null?void 0:te.id)??void 0,languageBId:(S==null?void 0:S.id)??void 0,topicId:(q==null?void 0:q.id)??void 0,levelId:(we==null?void 0:we.id)??void 0}),[te,S,q,we]),Se=i.useMemo(()=>U==="vocab"||U==="any",[U]);i.useEffect(()=>{O("loading");const Le=window.setTimeout(()=>{Nr({libraryId:d,type:U==="any"?void 0:U,query:H.trim()||void 0,limit:30,languageAId:Se?Re.languageAId:void 0,languageBId:Se?Re.languageBId:void 0,topicId:Se?Re.topicId:void 0,levelId:Se?Re.levelId:void 0}).then(ee=>{x(ee.items),ke(ee.total),A(ee.nextCursor??null),O("ready"),J(ee.items[0]??null)}).catch(()=>{x([]),ke(0),A(null),O("ready")})},240);return()=>window.clearTimeout(Le)},[d,H,U,Se,Re]),i.useEffect(()=>{if(!y||y.cardType!=="info"||y.infoType!=="computed"){Y(null),V("idle"),o("idle");return}V("loading"),gr({libraryId:d,infoId:y.cardId}).then(Le=>{Y(Le),V("ready")}).catch(()=>{Y(null),V("ready")})},[d,y]);const Fe=async()=>{if(oe){O("loading");try{const Le=await Nr({libraryId:d,type:U==="any"?void 0:U,query:H.trim()||void 0,limit:30,cursor:oe,languageAId:Se?Re.languageAId:void 0,languageBId:Se?Re.languageBId:void 0,topicId:Se?Re.topicId:void 0,levelId:Se?Re.levelId:void 0});x(ee=>[...ee,...Le.items]),A(Le.nextCursor??null),ke(Le.total),O("ready")}catch{O("ready")}}},me=async()=>{if(!(!y||y.cardType!=="connection"&&y.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){o("loading");try{await gi({libraryId:d,connectionId:y.cardId});let ee=null;x(Te=>{const qe=Te.filter(Ie=>Ie.cardId!==y.cardId);return ee=qe[0]??null,qe}),ke(Te=>Math.max(0,Te-(y.cardType==="vocab"?3:1))),J(Te=>Te&&Te.cardId===y.cardId?ee:Te),o("idle")}catch{o("error")}}},Je=i.useMemo(()=>R==="collection"?"grid":R==="list"?"list":"detail",[R]),Pe=y?ue(y):null,Ue=i.useMemo(()=>zi(a),[a]),ra=i.useMemo(()=>{const Le=be||g.length;return a.cogita.library.list.cardCount.replace("{shown}",String(g.length)).replace("{total}",String(Le))},[a,g.length,be]);return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Je,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${j}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(Le=>e.jsx("a",{className:"ghost","data-active":R===Le,href:`${j}/${Le}`,children:Le==="detail"?a.cogita.library.list.modes.detail:Le==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},Le))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:U,onChange:Le=>W(Le.target.value),children:Ue.map(Le=>e.jsx("option",{value:Le.value,children:Le.label},Le.value))}),e.jsx("input",{type:"text",value:H,onChange:Le=>c(Le.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(U==="vocab"||U==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:te,onChange:k,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:S,onChange:ye,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:q,onChange:ne,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:we,onChange:Ne,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(te||S||q||we)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{k(null),ye(null),ne(null),Ne(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ra}),e.jsx("span",{children:se==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":R==="collection"?"grid":"list",children:g.length?g.map(Le=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":Pe===ue(Le),onClick:()=>J(Le),children:[e.jsx("div",{className:"cogita-card-type",children:Le.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:Le.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:Le.label}),e.jsx("p",{className:"cogita-card-subtitle",children:Le.description})]},ue(Le))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${j}/new`,children:a.cogita.library.list.addInfo})]})}),oe?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Fe,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(y==null?void 0:y.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(y==null?void 0:y.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${j}/edit/${y.cardId}`,children:a.cogita.library.list.editInfo}):null,(y==null?void 0:y.cardType)==="connection"||(y==null?void 0:y.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:me,disabled:ge==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${j}/new`,children:a.cogita.library.actions.addInfo})]})]}),y?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:y.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:y.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),ge==="error"&&(y.cardType==="connection"||y.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,y.cardType==="info"&&y.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),ae==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),ae!=="loading"&&B?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(Pt,{value:B.prompt,mode:"auto"}),B.expectedAnswers&&Object.keys(B.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(B.expectedAnswers).map(([Le,ee])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Le}),e.jsx(hr,{value:ee,mode:"auto"})]},Le))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(hr,{value:B.expectedAnswer,mode:"auto"})]})]}):ae!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Et=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],$r=8;function Rr({libraryId:a,copy:l,language:u,sourceKindOptions:h,value:b,onChange:M,labels:v}){const[E,D]=i.useState(!1),[K,d]=i.useState(-1),R=i.useMemo(()=>{const W=u;return Et.map(H=>{var x;const c=(H==null?void 0:H[W])??(H==null?void 0:H.en)??(H==null?void 0:H.la);return{label:`${c.abbr} — ${c.name}`,latin:((x=H==null?void 0:H.la)==null?void 0:x.abbr)??c.abbr}})},[u]),f=(W,H=!1)=>{const c=W.trim().toLowerCase();return c?R.filter(g=>g.label.toLowerCase().includes(c)).slice(0,$r):H?R.slice(0,$r):[]},j=(W,H)=>{const c=W.trim().toLowerCase();if(!c)return null;const g=Et;for(const x of g){const se=x==null?void 0:x.la,O=(x==null?void 0:x[H])??(x==null?void 0:x.en)??se,y=(O==null?void 0:O.abbr)??"",J=(O==null?void 0:O.name)??"";if(y.toLowerCase()===c||J.toLowerCase()===c||`${y} — ${J}`.toLowerCase()===c)return{book:x,entry:O,la:se}}return null};i.useEffect(()=>{if(b.sourceKind==="bible"&&b.locatorValue&&!E){const W=j(b.locatorValue,u);if(W){const H=`${W.entry.abbr} — ${W.entry.name}`;H!==b.bibleBookDisplay&&M({...b,bibleBookDisplay:H})}}},[u,b,E,M]);const U=W=>M({...b,...W});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.sourceKindLabel}),e.jsx("select",{value:b.sourceKind,onChange:W=>U({sourceKind:W.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:h.map(W=>e.jsx("option",{value:W.value,children:W.label},W.value))})]}),b.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.bibleBookLabel}),e.jsx("input",{type:"text",value:b.bibleBookDisplay,onChange:W=>{const H=W.target.value;U({bibleBookDisplay:H,locatorValue:""}),D(!0),d(-1)},onKeyDown:W=>{var c;const H=f(b.bibleBookDisplay);if(H.length){if(W.key==="ArrowDown")W.preventDefault(),d(g=>Math.min(g+1,H.length-1));else if(W.key==="ArrowUp")W.preventDefault(),d(g=>Math.max(g-1,0));else if((W.key==="Enter"||W.key==="Tab")&&K>=0&&H[K]){const g=H[K],x=j(g.label,u);if(!x)return;U({bibleBookDisplay:g.label,locatorValue:((c=x.la)==null?void 0:c.abbr)??b.locatorValue}),D(!1)}}},onFocus:()=>D(!0),onBlur:()=>window.setTimeout(()=>D(!1),100),placeholder:v.bibleBookPlaceholder})]}),E&&f(b.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:f(b.bibleBookDisplay,!0).map((W,H)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":H===K,tabIndex:-1,onMouseDown:()=>{var g;const c=j(W.label,u);c&&U({bibleBookDisplay:W.label,locatorValue:((g=c.la)==null?void 0:g.abbr)??b.locatorValue})},children:e.jsx("strong",{children:W.label})},W.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.bibleRestLabel}),e.jsx("input",{type:"text",value:b.locatorAux,onChange:W=>U({locatorAux:W.target.value}),placeholder:v.bibleRestPlaceholder})]})]}),b.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:l.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:b.sourceUrl,onChange:W=>U({sourceUrl:W.target.value}),placeholder:l.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:l.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:b.sourceAccessedDate,onChange:W=>U({sourceAccessedDate:W.target.value}),placeholder:l.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),b.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:a,infoType:"work",label:v.churchDocumentLabel,placeholder:v.churchDocumentPlaceholder,value:b.churchDocument,onChange:W=>U({churchDocument:W}),searchFailedText:l.cogita.library.lookup.searchFailed,createFailedText:l.cogita.library.lookup.createFailed,createLabel:l.cogita.library.lookup.createNew.replace("{type}",l.cogita.library.infoTypes.work),savingLabel:l.cogita.library.lookup.saving,loadMoreLabel:l.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.locatorLabel}),e.jsx("input",{type:"text",value:b.locatorValue,onChange:W=>U({locatorValue:W.target.value}),placeholder:v.locatorPlaceholder})]})]}),b.sourceKind==="work"&&e.jsx(De,{libraryId:a,infoType:"work",label:v.workLabel,placeholder:v.workPlaceholder,value:b.work,onChange:W=>U({work:W}),searchFailedText:l.cogita.library.lookup.searchFailed,createFailedText:l.cogita.library.lookup.createFailed,createLabel:l.cogita.library.lookup.createNew.replace("{type}",l.cogita.library.infoTypes.work),savingLabel:l.cogita.library.lookup.saving,loadMoreLabel:l.cogita.library.lookup.loadMore}),b.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:a,infoType:"media",label:v.bookLabel,placeholder:v.bookPlaceholder,value:b.bookMedia,onChange:W=>U({bookMedia:W}),searchFailedText:l.cogita.library.lookup.searchFailed,createFailedText:l.cogita.library.lookup.createFailed,createLabel:l.cogita.library.lookup.createNew.replace("{type}",l.cogita.library.infoTypes.media),savingLabel:l.cogita.library.lookup.saving,loadMoreLabel:l.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.locatorLabel}),e.jsx("input",{type:"text",value:b.locatorValue,onChange:W=>U({locatorValue:W.target.value}),placeholder:v.locatorPlaceholder})]})]}),b.sourceKind!=="website"&&b.sourceKind!=="bible"&&b.sourceKind!=="book"&&b.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:v.locatorLabel}),e.jsx("input",{type:"text",value:b.locatorValue,onChange:W=>U({locatorValue:W.target.value}),placeholder:v.locatorPlaceholder})]})]})}const Ji=[],Yi=[];function Qi({data:a}){const l=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),u=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),h=a.handles.length,b=h>1?(h-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+b,paddingBottom:12+b*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),u?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,l?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((M,v)=>e.jsx(Cr,{type:"target",id:M.id,position:Mr.Left,style:{top:46+v*28},children:M.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:M.label}):null},M.id)),a.output!==!1?e.jsx(Cr,{type:"source",id:"out",position:Mr.Right}):null]})}function Gi({copy:a,value:l,onChange:u}){var Je,Pe,Ue,ra,Le,ee,Te,qe,Ie,de,Ee,Ke,Oe,Ce;const h=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),b=N=>!N||N.nodes.length===0?Ji:N.nodes.map((L,z)=>{var t,r,n,p;return{id:L.id,type:"computed",position:L.position??{x:40+z*160,y:60+z%3*80},data:{title:L.name||((t=h[L.type])==null?void 0:t.label)||L.type,subtitle:((r=h[L.type])==null?void 0:r.label)||L.type,type:L.type,name:L.name,outputLabel:L.outputLabel,min:L.min,max:L.max,value:L.type==="input.const"?L.value:void 0,list:L.list,handles:((n=h[L.type])==null?void 0:n.handles)??[],output:((p=h[L.type])==null?void 0:p.output)??!0}}}),M=N=>{if(!N||N.nodes.length===0)return Yi;const L=new Set(N.nodes.map(r=>r.id)),z=[];let t=0;return N.nodes.forEach(r=>{const n=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(n).forEach(([p,T])=>{T.forEach(Q=>{L.has(Q)&&z.push({id:`${r.id}-${p}-${Q}-${t++}`,source:Q,target:r.id,targetHandle:p==="in"?void 0:p})})})}),z},v=i.useMemo(()=>b(l),[l,h]),E=i.useMemo(()=>M(l),[l]),D=(N,L)=>{if(!N)return"null";const z=N.nodes.map(r=>{const n=(r.list??[]).join(","),p=r.inputs?r.inputs.join(","):"",T=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([Z,G])=>`${Z}:${[...G].sort().join(",")}`).sort().join("|"):"",Q=L&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",n,p,T,Q].join(":")}).sort().join("||"),t=N.outputs?[...N.outputs].sort().join(","):N.output??"";return`${z}::${t}`},K=i.useMemo(()=>{var L;const N=!!((L=l==null?void 0:l.nodes)!=null&&L.some(z=>!!z.position));return D(l,N)},[l]),[d,R]=i.useState(v),[f,j]=i.useState(E),[U,W]=i.useState(null),[H,c]=i.useState([]),[g,x]=i.useState(null),[se,O]=i.useState(null),[y,J]=i.useState({}),[B,Y]=i.useState(0),ae=i.useRef(u),V=i.useRef(K),be=i.useRef(K),ke=i.useRef(D(l,!1)),oe=i.useMemo(()=>U?d.find(N=>N.id===U)??null:null,[d,U]),A=i.useMemo(()=>{const N=["in1","in2","in3","in4","in5","in6"],L=new Map;return f.forEach(z=>{if(!z.target)return;const t=z.targetHandle??"in1";L.has(z.target)||L.set(z.target,new Set),L.get(z.target).add(t)}),d.map(z=>{var t;if(((t=z.data)==null?void 0:t.type)==="compute.concat"){const r=L.get(z.id)??new Set,n=[];let p=!1;return N.forEach(T=>{var Q,Z;if(r.has(T)||!p){const G=(Z=(Q=h["compute.concat"])==null?void 0:Q.handles)==null?void 0:Z.find(re=>re.id===T);G&&n.push(G),r.has(T)||(p=!0)}}),{...z,selected:z.id===U,data:{...z.data,handles:n}}}return{...z,selected:z.id===U}})},[d,U,f,h]);i.useEffect(()=>{x(null),O(null)},[U]),i.useEffect(()=>{if(H.length===0)return;const N=L=>{if(L.key!=="Delete"&&L.key!=="Backspace")return;const z=L.target;z&&(z.tagName==="INPUT"||z.tagName==="TEXTAREA"||z.isContentEditable)||(L.preventDefault(),j(t=>t.filter(r=>!H.includes(r.id))),c([]))};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[H,j]),i.useEffect(()=>{ae.current=u},[u]),i.useEffect(()=>{if(V.current!==K){if(be.current===K||ke.current===K){V.current=K;return}V.current=K,R(v),j(E),W(null),x(null),O(null),J({}),Y(N=>N+1)}},[v,E,j,R,K]),i.useEffect(()=>{const N=d.filter(n=>{var p;return((p=n.data)==null?void 0:p.type)==="output"}).map(n=>n.id).sort(),L=new Map;f.forEach(n=>{let p=L.get(n.target);p||(p={},L.set(n.target,p));const T=n.targetHandle||"in";p[T]||(p[T]=[]),p[T].push(n.source)}),L.forEach(n=>{Object.values(n).forEach(p=>p.sort())});const z={nodes:d.map(n=>{var p,T,Q,Z,G,re,le,ve,ea;return{id:n.id,type:((p=n.data)==null?void 0:p.type)??"compute.add",position:n.position,name:(T=n.data)==null?void 0:T.name,outputLabel:(Q=n.data)==null?void 0:Q.outputLabel,min:(Z=n.data)==null?void 0:Z.min,max:(G=n.data)==null?void 0:G.max,value:((re=n.data)==null?void 0:re.type)==="input.const"?(le=n.data)==null?void 0:le.value:void 0,list:(ve=n.data)==null?void 0:ve.list,inputs:(ea=L.get(n.id))==null?void 0:ea.in,inputsByHandle:L.get(n.id)}}),output:N[0]??null,outputs:N},t=D(z,!0),r=D(z,!1);t===be.current||r===ke.current||(be.current=t,ke.current=r,ae.current(z))},[d,f]),i.useEffect(()=>{const N={};let L=!1;d.forEach(z=>{var T,Q,Z,G,re;if(((T=z.data)==null?void 0:T.type)!=="input.random")return;if(y[z.id]!==void 0){N[z.id]=y[z.id];return}const t=Number.isFinite((Q=z.data)==null?void 0:Q.min)?Number((Z=z.data)==null?void 0:Z.min):0,r=Number.isFinite((G=z.data)==null?void 0:G.max)?Number((re=z.data)==null?void 0:re.max):t+10,n=Math.min(t,r),p=Math.max(t,r);N[z.id]=Math.floor(Math.random()*(p-n+1))+n,L=!0}),(L||Object.keys(N).length!==Object.keys(y).length)&&J(N)},[d,y,B]);const ge=i.useMemo(()=>d.map(L=>{var t,r,n,p,T;const z=(((t=L.data)==null?void 0:t.list)??[]).join(",");return[L.id,((r=L.data)==null?void 0:r.type)??"",((n=L.data)==null?void 0:n.name)??"",((p=L.data)==null?void 0:p.min)??"",((T=L.data)==null?void 0:T.max)??"",z].join(":")}).sort().join("|"),[d]),o=i.useMemo(()=>f.map(L=>`${L.source}:${L.target}:${L.targetHandle??""}`).sort().join("|"),[f]),te=i.useMemo(()=>{const N=new Map(d.map(Z=>[Z.id,Z])),L=new Map;f.forEach(Z=>{let G=L.get(Z.target);G||(G={},L.set(Z.target,G));const re=Z.targetHandle||"in";G[re]||(G[re]=[]),G[re].push(Z.source)});const z=new Map,t=new Set,r=Z=>{if(typeof Z=="number")return Z;if(typeof Z=="string"){const G=Number(Z);return Number.isFinite(G)?G:0}return 0},n=(Z,G)=>{var re,le;return G?((re=L.get(Z.id))==null?void 0:re[G])??[]:((le=L.get(Z.id))==null?void 0:le.in)??[]},p=(Z,G)=>n(Z,G).map(re=>r(Q(re))),T=(Z,G)=>n(Z,G).map(re=>Q(re)),Q=Z=>{var ve,ea,We,Ge;if(z.has(Z))return z.get(Z);if(t.has(Z))return 0;const G=N.get(Z);if(!G)return 0;t.add(Z);const re=((ve=G.data)==null?void 0:ve.type)??"";let le=0;switch(re){case"input.random":{le=y[Z]??0;break}case"input.const":{le=Number.isFinite((ea=G.data)==null?void 0:ea.value)?Number((We=G.data)==null?void 0:We.value):0;break}case"input.list":{const Be=(((Ge=G.data)==null?void 0:Ge.list)??[]).filter(Boolean),_e=Math.round(p(G,"index")[0]??0);le=(Be.length?Be[Math.max(0,Math.min(Be.length-1,_e))]:"")||String(_e);break}case"compute.add":{le=p(G,"in").reduce((Be,_e)=>Be+_e,0);break}case"compute.sub":{le=p(G,"add").reduce((Be,_e)=>Be+_e,0)-p(G,"sub").reduce((Be,_e)=>Be+_e,0);break}case"compute.mul":{const Be=p(G,"in");le=Be.length?Be.reduce((_e,Ae)=>_e*Ae,1):0;break}case"compute.div":{const Be=p(G,"num")[0]??0,_e=p(G,"den").reduce((Ae,ze)=>Ae+ze,0);le=Math.abs(_e)<Number.EPSILON?0:Be/_e;break}case"compute.pow":{const Be=p(G,"base")[0]??0,_e=p(G,"exp")[0]??0;le=Math.pow(Be,_e);break}case"compute.exp":{const Be=p(G,"base")[0]??0,_e=p(G,"exp")[0]??0;le=Math.pow(Be,_e);break}case"compute.log":{const Be=p(G,"value")[0]??0,_e=p(G,"base")[0]??0,Ae=Math.max(Be,Number.EPSILON);le=Math.abs(_e)<Number.EPSILON?Math.log(Ae):Math.log(Ae)/Math.log(_e);break}case"compute.abs":{le=Math.abs(p(G,"in")[0]??0);break}case"compute.min":{const Be=p(G,"in");le=Be.length?Math.min(...Be):0;break}case"compute.max":{const Be=p(G,"in");le=Be.length?Math.max(...Be):0;break}case"compute.floor":{le=Math.floor(p(G,"in")[0]??0);break}case"compute.ceil":{le=Math.ceil(p(G,"in")[0]??0);break}case"compute.round":{le=Math.round(p(G,"in")[0]??0);break}case"compute.mod":{const Be=p(G,"a")[0]??0,_e=p(G,"b")[0]??0;le=Math.abs(_e)<Number.EPSILON?0:Be%_e;break}case"compute.concat":{const _e=["in1","in2","in3","in4","in5","in6"].flatMap(ua=>T(G,ua)),Ae=_e.length?_e:T(G,"in");le=(Ae.length?Ae:T(G)).map(ua=>ua==null?"":String(ua)).join("");break}case"compute.trim":{const Be=T(G,"text")[0]??T(G,"in")[0]??"",_e=Be==null?"":String(Be),Ae=Math.max(0,Math.round(p(G,"start")[0]??0)),ze=Math.max(0,Math.round(p(G,"end")[0]??0));le=Ae+ze>=_e.length?"":_e.substring(Ae,_e.length-ze);break}case"output":{const Be=n(G,"in")[0];le=Be?Q(Be):0;break}default:le=0}return t.delete(Z),z.set(Z,le),le};return d.forEach(Z=>Q(Z.id)),z},[ge,o,y]),k=i.useRef(te);i.useEffect(()=>{k.current=te},[te]);const S=i.useCallback(N=>{const L=k.current.get(N.id);return e.jsx(Qi,{data:{...N.data,value:L}})},[]),ye=i.useMemo(()=>({computed:S}),[S]),q=N=>{var r;if(!N.target||!N.targetHandle){j(n=>yt(N,n));return}const L=d.find(n=>n.id===N.target),z=L?h[((r=L.data)==null?void 0:r.type)??""]:null,t=z==null?void 0:z.handles.find(n=>n.id===N.targetHandle);j(n=>{let p=n;return t!=null&&t.limitOne&&(p=n.filter(T=>!(T.target===N.target&&T.targetHandle===N.targetHandle))),yt(N,p)})},ne=N=>{const L=crypto.randomUUID(),z=h[N]??{label:N,handles:[]},t=z.label;R(r=>[...r,{id:L,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:z.label,type:N,name:"",handles:z.handles,list:N==="input.list"?[]:void 0,output:z.output??!0}}])},we=N=>{if(U){if(N.name!==void 0){const L=N.name.trim(),z=L===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(L);if(O(z?null:a.cogita.library.graph.invalidName),!L)x(null);else{const t=d.find(r=>{var n;return r.id!==U&&((n=r.data)==null?void 0:n.name)&&r.data.name.trim().toLowerCase()===L.toLowerCase()});x(t?a.cogita.library.graph.duplicateName:null)}}R(L=>L.map(z=>{var t,r,n,p;return z.id===U?{...z,data:{...z.data,...N,title:N.name?N.name:(t=z.data)==null?void 0:t.title,subtitle:((n=h[N.type??((r=z.data)==null?void 0:r.type)??""])==null?void 0:n.label)??((p=z.data)==null?void 0:p.subtitle)}}:z}))}},Ne=()=>{U&&(R(N=>N.filter(L=>L.id!==U)),j(N=>N.filter(L=>L.source!==U&&L.target!==U)),J(N=>{const L={...N};return delete L[U],L}),W(null),x(null))},Re=i.useRef({nodeId:null,edgeIds:[]}),Se=N=>{var p;const L=((p=N.nodes[0])==null?void 0:p.id)??null,z=N.edges.map(T=>T.id),t=Re.current,r=t.nodeId===L,n=t.edgeIds.length===z.length&&t.edgeIds.every((T,Q)=>T===z[Q]);r&&n||(Re.current={nodeId:L,edgeIds:z},W(L),c(z))},Fe=N=>{const L=N.filter(z=>z.type!=="select"&&z.type!=="dimensions");L.length!==0&&R(z=>Ai(L,z))},me=N=>{const L=N.filter(z=>z.type!=="select");L.length!==0&&j(z=>Fi(L,z))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Ut,{nodeTypes:ye,nodes:A,edges:f,onNodesChange:Fe,onEdgesChange:me,onConnect:q,onNodeClick:(N,L)=>W(L.id),onSelectionChange:Se,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(Wt,{gap:18,size:1}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>ne("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>ne("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>ne("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>ne("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>ne("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>ne("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>ne("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>ne("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>ne("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>ne("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>ne("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>ne("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>ne("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>ne("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>ne("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>ne("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>ne("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>ne("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>ne("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>ne("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),oe?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Je=oe.data)==null?void 0:Je.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:N=>we({name:N.target.value})}),g?e.jsx("em",{className:"cogita-help",children:g}):null,se?e.jsx("em",{className:"cogita-help",children:se}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((Ue=h[((Pe=oe.data)==null?void 0:Pe.type)??""])==null?void 0:Ue.label)??((ra=oe.data)==null?void 0:ra.type)]}),((Le=oe.data)==null?void 0:Le.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((ee=oe.data)==null?void 0:ee.outputLabel)??"",onChange:N=>we({outputLabel:N.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((Te=oe.data)==null?void 0:Te.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((qe=oe.data)==null?void 0:qe.min)??0,onChange:N=>we({min:Number(N.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Ie=oe.data)==null?void 0:Ie.max)??10,onChange:N=>we({max:Number(N.target.value)})})]})]}),((de=oe.data)==null?void 0:de.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:((Ee=oe.data)==null?void 0:Ee.value)??0,onChange:N=>we({value:Number(N.target.value)})})]}),((Ke=oe.data)==null?void 0:Ke.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((Oe=oe.data)==null?void 0:Oe.list)??[]).join(`
`),onChange:N=>we({list:N.target.value.split(`
`).map(L=>L.replace(/\r$/,"")).filter(L=>L.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((Ce=oe.data)==null?void 0:Ce.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{U&&(J(N=>{var n,p,T,Q;const L=Number.isFinite((n=oe.data)==null?void 0:n.min)?Number((p=oe.data)==null?void 0:p.min):0,z=Number.isFinite((T=oe.data)==null?void 0:T.max)?Number((Q=oe.data)==null?void 0:Q.max):L+10,t=Math.min(L,z),r=Math.max(L,z);return{...N,[U]:Math.floor(Math.random()*(r-t+1))+t}}),Y(N=>N+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Ne,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const ir=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function yr(a,l,u){if(!a)return null;const h=new Map(a.nodes.map(O=>[O.id,O])),b=new Map,M=new Set,v=O=>{if(typeof O=="number")return O;if(typeof O=="string"){const y=Number(O);return Number.isFinite(y)?y:0}return 0},E=O=>{if(b.has(O))return b.get(O);if(M.has(O))return 0;const y=h.get(O);if(!y)return 0;M.add(O);const J=Y=>{var V,be;return(Y?((V=y.inputsByHandle)==null?void 0:V[Y])??[]:y.inputs??((be=y.inputsByHandle)==null?void 0:be.in)??[]).map(ke=>E(ke))};let B=0;switch(y.type){case"input.random":{const Y=y.min??0,ae=y.max??Y+10,V=Math.min(Y,ae),be=Math.max(Y,ae);B=Math.floor(Math.random()*(be-V+1))+V;break}case"input.const":{B=y.value??0;break}case"input.list":{const Y=(y.list??[]).filter(Boolean),ae=Math.round(v(J("index")[0]));B=Y.length?Y[Math.max(0,Math.min(Y.length-1,ae))]:String(ae);break}case"compute.add":{B=J("in").map(ae=>v(ae)).reduce((ae,V)=>ae+V,0);break}case"compute.sub":{const Y=J("add").map(V=>v(V)),ae=J("sub").map(V=>v(V));B=Y.reduce((V,be)=>V+be,0)-ae.reduce((V,be)=>V+be,0);break}case"compute.mul":{const Y=J("in").map(ae=>v(ae));B=Y.length?Y.reduce((ae,V)=>ae*V,1):0;break}case"compute.div":{const Y=v(J("num")[0]),ae=J("den").map(V=>v(V)).reduce((V,be)=>V+be,0);B=Math.abs(ae)<Number.EPSILON?0:Y/ae;break}case"compute.pow":{const Y=v(J("base")[0]),ae=v(J("exp")[0]);B=Math.pow(Y,ae);break}case"compute.exp":{const Y=v(J("base")[0]),ae=v(J("exp")[0]);B=Math.pow(Y,ae);break}case"compute.log":{const Y=v(J("value")[0]),ae=v(J("base")[0]),V=Math.max(Y,Number.EPSILON);B=Math.abs(ae)<Number.EPSILON?Math.log(V):Math.log(V)/Math.log(ae);break}case"compute.abs":{B=Math.abs(v(J("in")[0]));break}case"compute.min":{const Y=J("in").map(ae=>v(ae));B=Y.length?Math.min(...Y):0;break}case"compute.max":{const Y=J("in").map(ae=>v(ae));B=Y.length?Math.max(...Y):0;break}case"compute.floor":{B=Math.floor(v(J("in")[0]));break}case"compute.ceil":{B=Math.ceil(v(J("in")[0]));break}case"compute.round":{B=Math.round(v(J("in")[0]));break}case"compute.mod":{const Y=v(J("a")[0]),ae=v(J("b")[0]);B=Math.abs(ae)<Number.EPSILON?0:Y%ae;break}case"compute.concat":{const ae=["in1","in2","in3","in4","in5","in6"].flatMap(oe=>J(oe)),V=ae.length?ae:J("in");B=(V.length?V:J()).map(oe=>oe==null?"":String(oe)).join("");break}case"compute.trim":{const Y=J("text")[0]??J("in")[0]??"",ae=Y==null?"":String(Y),V=Math.max(0,Math.round(v(J("start")[0]))),be=Math.max(0,Math.round(v(J("end")[0])));V+be>=ae.length?B="":B=ae.substring(V,ae.length-be);break}case"output":{B=J("in")[0]??0;break}default:B=0}return M.delete(O),b.set(O,B),B},D=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(O=>O.type==="output").map(O=>O.id);a.nodes.forEach(O=>E(O.id)),D.forEach(O=>E(O));const K=O=>Math.abs(O%1)<1e-5?String(Math.round(O)):O.toFixed(3).replace(/\.?0+$/,""),d=O=>typeof O=="number"?K(O):O??"",R=new Map;D.forEach(O=>{var ae,V,be,ke;const y=h.get(O);if(!y)return;const J=(V=(ae=y.inputsByHandle)==null?void 0:ae.name)==null?void 0:V[0],B=J?d(b.get(J)):"",Y=(B==null?void 0:B.toString().trim())||((be=y.outputLabel)==null?void 0:be.trim())||((ke=y.name)==null?void 0:ke.trim())||O;R.set(O,Y)});const f={},j={},U={};D.forEach(O=>{var B,Y;const y=h.get(O);if(!y)return;const J=R.get(O)??(((B=y.outputLabel)==null?void 0:B.trim())||((Y=y.name)==null?void 0:Y.trim())||O);f[J]=d(b.get(O)),y.name&&(j[y.name.trim()]=J),j[O]=J});const W=(O,y)=>{let J=O;return a.nodes.forEach(B=>{var ke,oe;const Y=d(b.get(B.id)),ae=D.includes(B.id),V=ae?R.get(B.id)??((ke=B.outputLabel)==null?void 0:ke.trim())??((oe=B.name)==null?void 0:oe.trim())??B.id:"",be=ae&&y?V:Y;J=J.replace(new RegExp(`\\{\\s*${ir(B.id)}\\s*\\}`,"gi"),be),B.name&&(J=J.replace(new RegExp(`\\{\\s*${ir(B.name)}\\s*\\}`,"gi"),be)),ae&&B.outputLabel&&(J=J.replace(new RegExp(`\\{\\s*${ir(B.outputLabel)}\\s*\\}`,"gi"),V))}),J},H=l;let c=H.trim().length>0?H:"";c||(c=D.length?`Compute ${D.join(", ")}`:"Compute"),c=W(c,!0);const g=(u==null?void 0:u.trim())??"",x=g?W(g,!1):"",se={};return b.forEach((O,y)=>{se[y]=O,U[y]=d(O);const J=h.get(y);J!=null&&J.name&&(U[J.name.trim()]=d(O))}),{prompt:c,answers:f,values:se,answerText:x,outputVariables:j,variableValues:U}}function Yr(a){var u;const l=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((u=l[0])==null?void 0:u[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function Xi({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d,editInfoId:R}){const{libraryName:f}=Da(d),j=!!R,U=`/#/cogita/library/${d}`,[W,H]=i.useState("info"),[c,g]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[x,se]=i.useState(""),[O,y]=i.useState(null),[J,B]=i.useState(null),[Y,ae]=i.useState("idle"),[V,be]=i.useState(null),[ke,oe]=i.useState(-1),[A,ge]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[o,te]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[k,S]=i.useState(null),[ye,q]=i.useState("idle"),[ne,we]=i.useState(null),[Ne,Re]=i.useState(null),[Se,Fe]=i.useState(null),me=i.useRef(null),Je=i.useRef(null),Pe=i.useRef(null),Ue=i.useMemo(()=>Jr(a),[a]),ra=i.useMemo(()=>Ui(a),[a]),Le=i.useMemo(()=>Wi(a),[a]),ee=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),Te=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),qe=i.useMemo(()=>Ue.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[Ue]),Ie=i.useMemo(()=>{const t=D;return Et.map(r=>{var T;const n=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${n.abbr} — ${n.name}`,latin:((T=r==null?void 0:r.la)==null?void 0:T.abbr)??n.abbr}})},[D]),de=(t,r=!1)=>{const n=t.trim().toLowerCase();return n?Ie.filter(p=>p.label.toLowerCase().includes(n)).slice(0,8):r?Ie.slice(0,8):[]},Ee=(t,r)=>{const n=t.trim().toLowerCase();if(!n)return null;const p=Et;for(const T of p){const Q=T==null?void 0:T.la,Z=(T==null?void 0:T[r])??(T==null?void 0:T.en)??Q;if([Z==null?void 0:Z.abbr,Z==null?void 0:Z.name,Q==null?void 0:Q.abbr,Q==null?void 0:Q.name,`${Z==null?void 0:Z.abbr} — ${Z==null?void 0:Z.name}`].filter(Boolean).map(re=>re.toLowerCase()).some(re=>re===n))return{book:T,entry:Z,la:Q}}return null};i.useEffect(()=>{if(!A.language||!A.word){we(null);return}const t=window.setTimeout(()=>{rr({libraryId:d,languageId:A.language.id,wordId:A.word.id}).then(r=>{we(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{we(null)})},200);return()=>window.clearTimeout(t)},[d,A.language,A.word]),i.useEffect(()=>{if(!o.languageA||!o.wordA){Re(null);return}const t=window.setTimeout(()=>{rr({libraryId:d,languageId:o.languageA.id,wordId:o.wordA.id}).then(r=>{Re(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Re(null)})},200);return()=>window.clearTimeout(t)},[d,o.languageA,o.wordA]),i.useEffect(()=>{if(!o.languageB||!o.wordB){Fe(null);return}const t=window.setTimeout(()=>{rr({libraryId:d,languageId:o.languageB.id,wordId:o.wordB.id}).then(r=>{Fe(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Fe(null)})},200);return()=>window.clearTimeout(t)},[d,o.languageB,o.wordB]),i.useEffect(()=>{if(!j||!R)return;let t=!1;return q("loading"),S(null),tt({libraryId:d,infoId:R}).then(async r=>{var p,T;if(t)return;const n=r.payload??{};if(g(Q=>({...Q,infoType:r.infoType,label:n.label??"",notes:n.notes??"",language:n.languageId?{id:n.languageId,label:n.languageId,infoType:"language"}:null,sourceKind:n.sourceKind??"string",sourceResourceType:Q.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:n.text??"",workLanguage:n.languageId?{id:n.languageId,label:n.languageId,infoType:"language"}:null,workOriginalLanguage:n.originalLanguageId?{id:n.originalLanguageId,label:n.originalLanguageId,infoType:"language"}:null,workDoi:n.doi??"",mediaType:n.mediaType??"book",mediaPublisher:n.publisher??"",mediaPublicationPlace:n.publicationPlace??"",mediaPublicationYear:n.publicationYear??"",mediaPages:n.pages??"",mediaIsbn:n.isbn??"",mediaCover:n.cover??"",mediaHeight:n.height??"",mediaLength:n.length??"",mediaWidth:n.width??"",mediaWeight:n.weight??"",mediaCollection:n.collection??"",mediaLocation:n.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&n.locator&&typeof n.locator=="object"){const Q=n.locator;if(n.sourceKind==="website")g(Z=>({...Z,sourceUrl:typeof Q.url=="string"?Q.url:"",sourceAccessedDate:typeof Q.date=="string"?Q.date:""}));else if(n.sourceKind==="bible"){const Z=typeof Q.book=="string"?Q.book:"",G=Z?Ee(Z,D):null,re=G?`${G.entry.abbr} — ${G.entry.name}`:Z;g(le=>({...le,sourceLocatorValue:Z,sourceLocatorAux:typeof Q.rest=="string"?Q.rest:"",sourceBibleBookDisplay:re}))}else n.sourceKind==="book"?g(Z=>({...Z,sourceLocatorValue:typeof Q.page=="string"?Q.page:""})):n.sourceKind==="number_document"?g(Z=>({...Z,sourceLocatorValue:typeof Q.number=="string"?Q.number:""})):typeof Q.text=="string"&&g(Z=>({...Z,sourceLocatorValue:Q.text}))}if(n.languageId&&r.infoType!=="work")try{const Q=await tt({libraryId:d,infoId:n.languageId});if(t)return;g(Z=>{var G;return{...Z,language:{id:n.languageId,label:((G=Q.payload)==null?void 0:G.label)??n.languageId,infoType:"language"}}})}catch{}if(n.languageId&&r.infoType==="work")try{const Q=await tt({libraryId:d,infoId:n.languageId});if(t)return;g(Z=>{var G;return{...Z,workLanguage:{id:n.languageId,label:((G=Q.payload)==null?void 0:G.label)??n.languageId,infoType:"language"}}})}catch{}if(n.originalLanguageId)try{const Q=await tt({libraryId:d,infoId:n.originalLanguageId});if(t)return;g(Z=>{var G;return{...Z,workOriginalLanguage:{id:n.originalLanguageId,label:((G=Q.payload)==null?void 0:G.label)??n.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(se(((p=n.definition)==null?void 0:p.answerTemplate)??""),y(((T=n.definition)==null?void 0:T.graph)??null),B(null),ae("idle")):(se(""),y(null),B(null),ae("idle")),H("info")}).catch(()=>{t||S(a.cogita.library.add.info.failed)}).finally(()=>{t||q("idle")}),()=>{t=!0}},[a,R,j,d]),i.useEffect(()=>{if(c.sourceKind==="bible"&&c.sourceLocatorValue&&V!=="source"){const t=Ee(c.sourceLocatorValue,D);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==c.sourceBibleBookDisplay&&g(n=>({...n,sourceBibleBookDisplay:r}))}}},[D,c.sourceKind,c.sourceLocatorValue,c.sourceBibleBookDisplay]);const Ke=async()=>{var t,r;S(null);try{const n={label:c.infoType==="quote"||c.infoType==="source"?"":c.label,notes:c.infoType==="computed"?"":c.notes};if(c.language&&(c.infoType==="word"||c.infoType==="sentence")&&(n.languageId=c.language.id),c.infoType==="source"&&(n.sourceKind=c.sourceKind,c.sourceKind==="website"?n.locator={url:c.sourceUrl.trim(),date:c.sourceAccessedDate.trim()}:c.sourceKind==="bible"?n.locator={book:c.sourceLocatorValue.trim(),rest:c.sourceLocatorAux.trim()}:c.sourceKind==="book"?n.locator={page:c.sourceLocatorValue.trim()}:c.sourceKind==="number_document"?n.locator={number:c.sourceLocatorValue.trim()}:n.locator={text:c.sourceLocatorValue.trim()}),c.infoType==="quote"&&(n.text=c.quoteText),c.infoType==="work"&&(n.languageId=((t=c.workLanguage)==null?void 0:t.id)??null,n.originalLanguageId=((r=c.workOriginalLanguage)==null?void 0:r.id)??null,n.doi=c.workDoi.trim()),c.infoType==="media"&&(n.mediaType=c.mediaType,n.publisher=c.mediaPublisher.trim(),n.publicationPlace=c.mediaPublicationPlace.trim(),n.publicationYear=c.mediaPublicationYear.trim(),n.pages=c.mediaPages.trim(),n.isbn=c.mediaIsbn.trim(),n.cover=c.mediaCover.trim(),n.height=c.mediaHeight.trim(),n.length=c.mediaLength.trim(),n.width=c.mediaWidth.trim(),n.weight=c.mediaWeight.trim(),n.collection=c.mediaCollection.trim(),n.location=c.mediaLocation.trim()),c.infoType==="computed"){if(!O){S(a.cogita.library.add.info.computedRequired);return}if(!x.trim()){S(a.cogita.library.add.info.computedAnswerRequired);return}if(O.nodes.find(le=>le.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(le.name))){S(a.cogita.library.add.info.computedInvalidName);return}const T=O.nodes.map(le=>{var ve;return(ve=le.name)==null?void 0:ve.trim()}).filter(Boolean),Q=new Set;for(const le of T){const ve=le.toLowerCase();if(Q.has(ve)){S(a.cogita.library.add.info.computedDuplicateName);return}Q.add(ve)}const Z=O.nodes.filter(le=>le.type==="output"),G=Z.map(le=>{var ve;return(ve=le.name)==null?void 0:ve.trim()}).filter(Boolean);if(G.length!==Z.length){S(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!G.every(le=>new RegExp(`\\{\\s*${le}\\s*\\}`,"i").test(x))){S(a.cogita.library.add.info.computedAnswerMissingOutput);return}n.definition={answerTemplate:x,graph:O}}if(j&&R)q("saving"),await hi({libraryId:d,infoId:R,payload:n}),S(a.cogita.library.add.info.updated),q("idle");else{let p=null;if(c.referenceEnabled){const le={sourceKind:c.referenceSourceKind,locatorValue:c.referenceLocatorValue,locatorAux:c.referenceLocatorAux,bibleBookDisplay:c.referenceBibleBookDisplay,sourceUrl:c.referenceSourceUrl,sourceAccessedDate:c.referenceSourceAccessedDate,churchDocument:c.referenceChurchDocument,bookMedia:c.referenceBookMedia,work:c.referenceWork},{payload:ve,resourceInfoId:ea,error:We}=Oe(le);if(We){S(a.cogita.library.add.info.referenceMissingSource);return}p={payload:ve,resourceInfoId:ea}}const T=await Qa({libraryId:d,infoType:c.infoType,payload:n});if(c.infoType==="source"&&c.sourceResource&&await ta({libraryId:d,connectionType:"source-resource",infoIds:[T.infoId,c.sourceResource.id]}),c.infoType==="quote"&&c.language&&await ta({libraryId:d,connectionType:"quote-language",infoIds:[T.infoId,c.language.id]}),p){const le=await Qa({libraryId:d,infoType:"source",payload:p.payload});p.resourceInfoId&&await ta({libraryId:d,connectionType:"source-resource",infoIds:[le.infoId,p.resourceInfoId]}),await ta({libraryId:d,connectionType:"reference",infoIds:[T.infoId,le.infoId]})}S(a.cogita.library.add.info.saved);const Q=c.infoType==="word"||c.infoType==="sentence",Z=c.referenceEnabled,G=c.referenceSourceKind,re={referenceEnabled:Z,referenceSourceKind:Z?G:"string",referenceSourceUrl:Z&&G==="website"?c.referenceSourceUrl:"",referenceSourceAccessedDate:Z&&G==="website"?c.referenceSourceAccessedDate:"",referenceChurchDocument:Z&&G==="number_document"?c.referenceChurchDocument:null,referenceBookMedia:Z&&G==="book"?c.referenceBookMedia:null,referenceWork:Z&&G==="work"?c.referenceWork:null,referenceLocatorValue:Z&&G==="bible"?c.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:Z&&G==="bible"?c.referenceBibleBookDisplay:""};g({infoType:c.infoType,label:"",language:Q?c.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:c.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...re}),c.infoType==="computed"&&(se(""),y(null),B(null),ae("idle"))}}catch{S(a.cogita.library.add.info.failed)}},Oe=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const n={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const p=t.sourceUrl.trim();return p?(n.locator={url:p,date:t.sourceAccessedDate.trim()},{payload:n,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(n.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:n,resourceInfoId:r}):(t.sourceKind==="book"?n.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?n.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(n.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:n,resourceInfoId:r})},Ce=()=>{if(ae("idle"),!O){B(null),ae("error");return}const t=yr(O,"",x);if(!t){B(null),ae("error");return}B({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),ae("ready")},N=async()=>{S(null);try{if(A.connectionType==="reference"){if(!A.referencedInfo||!A.source){S(a.cogita.library.add.connection.selectReference);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.referencedInfo.id,A.source.id]})}else if(A.connectionType==="source-resource"){if(!A.source||!A.sourceResource){S(a.cogita.library.add.connection.selectSourceResource);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.source.id,A.sourceResource.id]})}else if(A.connectionType==="quote-language"){if(!A.quote||!A.language){S(a.cogita.library.add.connection.selectQuoteLanguage);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.quote.id,A.language.id]})}else if(A.connectionType==="work-contributor"){if(!A.work||!A.contributor||!A.contributorRole.trim()){S(a.cogita.library.add.connection.selectWorkContributor);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.work.id,A.contributor.id],payload:{role:A.contributorRole.trim()}})}else if(A.connectionType==="work-medium"){if(!A.work||!A.medium){S(a.cogita.library.add.connection.selectWorkMedium);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.work.id,A.medium.id]})}else if(A.connectionType==="orcid-link"){if(!A.orcidEntity||!A.orcid){S(a.cogita.library.add.connection.selectOrcidLink);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.orcidEntity.id,A.orcid.id]})}else if(A.connectionType==="word-language"){if(!A.language||!A.word){S(a.cogita.library.add.connection.selectWordLanguage);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.language.id,A.word.id],payload:{note:A.note}})}else if(A.connectionType==="word-topic"){if(!A.word||!A.topic){S(a.cogita.library.add.connection.selectWordTopic);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.word.id,A.topic.id],payload:{note:A.note}})}else if(A.connectionType==="translation"){if(!A.wordA||!A.wordB){S(a.cogita.library.add.connection.selectTwoWords);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.wordA.id,A.wordB.id],payload:{note:A.note}})}else if(A.connectionType==="language-sentence"){if(!A.language||!A.sentence){S(a.cogita.library.add.connection.selectLanguageSentence);return}await ta({libraryId:d,connectionType:A.connectionType,infoIds:[A.language.id,A.sentence.id],payload:{note:A.note}})}S(a.cogita.library.add.connection.saved),ge(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{S(a.cogita.library.add.connection.failed)}},L=async()=>{var t,r;S(null);try{if(o.groupType==="citation"){const p=o.citationTitle.trim(),T=o.citationQuoteText.trim();if(!T){S(a.cogita.library.add.group.citationMissingQuote);return}let Q=null;if(o.citationReferenceEnabled){const re={sourceKind:o.citationSourceKind,locatorValue:o.citationLocatorValue,locatorAux:o.citationLocatorAux,bibleBookDisplay:o.citationBibleBookDisplay,sourceUrl:o.citationSourceUrl,sourceAccessedDate:o.citationSourceAccessedDate,churchDocument:o.citationChurchDocument,bookMedia:o.citationBookMedia,work:o.citationWork},{payload:le,resourceInfoId:ve,error:ea}=Oe(re);if(ea){S(a.cogita.library.add.info.referenceMissingSource);return}Q={payload:le,resourceInfoId:ve}}const Z={text:T};p&&(Z.title=p);const G=await Qa({libraryId:d,infoType:"quote",payload:Z});if(o.citationLanguage&&await ta({libraryId:d,connectionType:"quote-language",infoIds:[G.infoId,o.citationLanguage.id]}),Q){const re=await Qa({libraryId:d,infoType:"source",payload:Q.payload});Q.resourceInfoId&&await ta({libraryId:d,connectionType:"source-resource",infoIds:[re.infoId,Q.resourceInfoId]}),await ta({libraryId:d,connectionType:"reference",infoIds:[G.infoId,re.infoId]})}S(a.cogita.library.add.group.savedCitation),te(re=>({...re,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:re.citationReferenceEnabled,citationSourceKind:re.citationReferenceEnabled?re.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:re.citationReferenceEnabled?re.citationChurchDocument:null,citationBookMedia:re.citationReferenceEnabled?re.citationBookMedia:null,citationWork:re.citationReferenceEnabled?re.citationWork:null}));return}if(o.groupType==="book"){const p=o.bookTitle.trim();if(!p){S(a.cogita.library.add.group.bookMissingTitle);return}const T=o.bookWorkTitle.trim();if(!T){S(a.cogita.library.add.group.bookMissingWork);return}if(o.bookContributors.find(le=>le.contributor&&!le.role.trim()||!le.contributor&&le.role.trim())){S(a.cogita.library.add.group.bookMissingContributor);return}const Z=await Qa({libraryId:d,infoType:"media",payload:{label:p,mediaType:"book",publisher:o.bookPublisher.trim(),publicationPlace:o.bookPublicationPlace.trim(),publicationYear:o.bookPublicationYear.trim(),pages:o.bookPages.trim(),isbn:o.bookIsbn.trim(),cover:o.bookCover.trim(),height:o.bookHeight.trim(),length:o.bookLength.trim(),width:o.bookWidth.trim(),weight:o.bookWeight.trim(),collection:o.bookCollection.trim(),location:o.bookLocation.trim()}}),G=await Qa({libraryId:d,infoType:"work",payload:{label:T,languageId:((t=o.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=o.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:o.bookWorkDoi.trim()}});await ta({libraryId:d,connectionType:"work-medium",infoIds:[G.infoId,Z.infoId]});const re=o.bookContributors.filter(le=>le.contributor&&le.role.trim());for(const le of re)await ta({libraryId:d,connectionType:"work-contributor",infoIds:[G.infoId,le.contributor.id],payload:{role:le.role.trim()}});S(a.cogita.library.add.group.savedBook),te(le=>({...le,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!o.languageA||!o.wordA||!o.languageB||!o.wordB){S(a.cogita.library.add.group.selectBoth);return}const n=p=>Array.from(new Map(p.map(T=>[T.id,T])).values());Ne||await ta({libraryId:d,connectionType:"word-language",infoIds:[o.languageA.id,o.wordA.id]}),Se||await ta({libraryId:d,connectionType:"word-language",infoIds:[o.languageB.id,o.wordB.id]});for(const p of n(o.wordATags))await ta({libraryId:d,connectionType:"word-topic",infoIds:[o.wordA.id,p.id]});for(const p of n(o.wordBTags))await ta({libraryId:d,connectionType:"word-topic",infoIds:[o.wordB.id,p.id]});await ta({libraryId:d,connectionType:"translation",infoIds:[o.wordA.id,o.wordB.id],payload:{tagIds:n(o.translationTags).map(p=>p.id)}}),S(a.cogita.library.add.group.savedVocab),te(p=>({...p,groupType:o.groupType,languageA:o.languageA,wordA:null,languageB:o.languageB,wordB:null,wordATags:o.wordATags,wordBTags:o.wordBTags,translationTags:o.translationTags})),requestAnimationFrame(()=>{var p;return(p=me.current)==null?void 0:p.focus()})}catch{S(a.cogita.library.add.group.failed)}},z=o.groupType==="citation"?a.cogita.library.add.group.saveCitation:o.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:U,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${U}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":W===t,onClick:()=>{j||H(t)},disabled:j&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[W==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:c.infoType,onChange:t=>{j||g(r=>({...r,infoType:t.target.value}))},disabled:j,children:Ue.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),c.infoType!=="quote"&&c.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:c.label,onChange:t=>g(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(c.infoType==="word"||c.infoType==="sentence"||c.infoType==="quote")&&e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:c.language,onChange:t=>g(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),c.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:c.workLanguage,onChange:t=>g(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:c.workOriginalLanguage,onChange:t=>g(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:c.workDoi,onChange:t=>g(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),c.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:c.mediaType,onChange:t=>g(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:c.mediaPublisher,onChange:t=>g(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:c.mediaPublicationPlace,onChange:t=>g(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:c.mediaPublicationYear,onChange:t=>g(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:c.mediaPages,onChange:t=>g(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:c.mediaIsbn,onChange:t=>g(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:c.mediaCover,onChange:t=>g(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:c.mediaHeight,onChange:t=>g(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:c.mediaLength,onChange:t=>g(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:c.mediaWidth,onChange:t=>g(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:c.mediaWeight,onChange:t=>g(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:c.mediaCollection,onChange:t=>g(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:c.mediaLocation,onChange:t=>g(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),c.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:c.quoteText,onChange:t=>g(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),c.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:c.sourceKind,onChange:t=>{const r=t.target.value,n=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":c.sourceResourceType;g(p=>({...p,sourceKind:r,sourceResourceType:n,sourceResource:null,sourceLocatorValue:r==="bible"?"":p.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":p.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?p.sourceBibleBookDisplay:""}))},children:ee.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),c.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:c.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;g(n=>({...n,sourceBibleBookDisplay:r,sourceLocatorValue:""})),be("source"),oe(-1)},onKeyDown:t=>{const r=de(c.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),oe(n=>Math.min(n+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),oe(n=>Math.max(n-1,0));else if((t.key==="Enter"||t.key==="Tab")&&ke>=0&&r[ke]){const n=r[ke],p=Ee(n.label,D);if(!p)return;g(T=>{var Q;return{...T,sourceBibleBookDisplay:n.label,sourceLocatorValue:((Q=p.la)==null?void 0:Q.abbr)??T.sourceLocatorValue}}),be(null)}}},onFocus:()=>be("source"),onBlur:()=>window.setTimeout(()=>be(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),V==="source"&&de(c.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:de(c.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===ke,tabIndex:-1,onMouseDown:()=>{const n=Ee(t.label,D);n&&g(p=>{var T;return{...p,sourceBibleBookDisplay:t.label,sourceLocatorValue:((T=n.la)==null?void 0:T.abbr)??p.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:c.sourceLocatorAux,onChange:t=>g(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),c.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:c.sourceUrl,onChange:t=>g(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:c.sourceAccessedDate,onChange:t=>g(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),c.sourceKind!=="website"&&c.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:c.sourceLocatorValue,onChange:t=>g(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),c.sourceKind!=="string"&&c.sourceKind!=="website"&&c.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:c.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(c.sourceKind),onChange:t=>g(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:qe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(De,{libraryId:d,infoType:c.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:c.sourceResource,onChange:t=>g(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Qe(a,c.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),c.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:c.notes,onChange:t=>g(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,c.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:x,onChange:t=>se(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(Gi,{copy:a,value:O,onChange:t=>y(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Ce,children:a.cogita.library.add.info.computedPreview})}),J&&Y==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(Pt,{value:J.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(J.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(hr,{value:r,mode:"auto"})]},t))}),J.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(Pt,{value:J.answerText,mode:"auto"})]}):null]}):Y==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:c.referenceEnabled,onChange:t=>g(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),c.referenceEnabled&&e.jsx(Rr,{libraryId:d,copy:a,language:D,sourceKindOptions:ee,labels:Te,value:{sourceKind:c.referenceSourceKind,locatorValue:c.referenceLocatorValue,locatorAux:c.referenceLocatorAux,bibleBookDisplay:c.referenceBibleBookDisplay,sourceUrl:c.referenceSourceUrl,sourceAccessedDate:c.referenceSourceAccessedDate,churchDocument:c.referenceChurchDocument,bookMedia:c.referenceBookMedia,work:c.referenceWork},onChange:t=>g(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:Ke,disabled:ye==="saving"||ye==="loading",children:j?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,W==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:A.connectionType,onChange:t=>ge(r=>({...r,connectionType:t.target.value})),children:ra.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),A.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:A.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:A.word,onChange:t=>ge(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),ne&&e.jsx("p",{className:"cogita-help",children:ne})]}),A.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:A.word,onChange:t=>ge(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:A.topic,onChange:t=>ge(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),A.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:A.wordA,onChange:t=>ge(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:A.wordB,onChange:t=>ge(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),A.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:A.quote,onChange:t=>ge(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:A.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),A.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:A.language,onChange:t=>ge(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:A.sentence,onChange:t=>ge(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),A.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:A.referencedInfoType,onChange:t=>ge(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:Ue.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(De,{libraryId:d,infoType:A.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:A.referencedInfo,onChange:t=>ge(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Qe(a,A.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:A.source,onChange:t=>ge(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),A.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:A.source,onChange:t=>ge(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:A.sourceResourceType,onChange:t=>ge(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:qe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(De,{libraryId:d,infoType:A.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:A.sourceResource,onChange:t=>ge(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Qe(a,A.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),A.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:A.work,onChange:t=>ge(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:A.contributorType,onChange:t=>ge(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Qe(a,t)},t))})]}),e.jsx(De,{libraryId:d,infoType:A.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:A.contributor,onChange:t=>ge(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Qe(a,A.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:A.contributorRole,onChange:t=>ge(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),A.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:A.work,onChange:t=>ge(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:A.medium,onChange:t=>ge(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),A.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:A.orcidEntityType,onChange:t=>ge(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Qe(a,t)},t))})]}),e.jsx(De,{libraryId:d,infoType:A.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:A.orcidEntity,onChange:t=>ge(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Qe(a,A.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(De,{libraryId:d,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:A.orcid,onChange:t=>ge(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:A.note,onChange:t=>ge(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:N,children:a.cogita.library.add.connection.save})})]}):null,W==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:o.groupType,onChange:t=>te(r=>({...r,groupType:t.target.value})),children:Le.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),o.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:o.citationLanguage,onChange:t=>te(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:o.citationTitle,onChange:t=>te(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:o.citationQuoteText,onChange:t=>te(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:o.citationReferenceEnabled,onChange:t=>te(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),o.citationReferenceEnabled&&e.jsx(Rr,{libraryId:d,copy:a,language:D,sourceKindOptions:ee,labels:Te,value:{sourceKind:o.citationSourceKind,locatorValue:o.citationLocatorValue,locatorAux:o.citationLocatorAux,bibleBookDisplay:o.citationBibleBookDisplay,sourceUrl:o.citationSourceUrl,sourceAccessedDate:o.citationSourceAccessedDate,churchDocument:o.citationChurchDocument,bookMedia:o.citationBookMedia,work:o.citationWork},onChange:t=>te(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),o.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:o.bookTitle,onChange:t=>te(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:o.bookPublisher,onChange:t=>te(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:o.bookPublicationPlace,onChange:t=>te(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:o.bookPublicationYear,onChange:t=>te(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:o.bookPages,onChange:t=>te(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:o.bookIsbn,onChange:t=>te(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:o.bookCover,onChange:t=>te(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:o.bookHeight,onChange:t=>te(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:o.bookLength,onChange:t=>te(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:o.bookWidth,onChange:t=>te(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:o.bookWeight,onChange:t=>te(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:o.bookCollection,onChange:t=>te(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:o.bookLocation,onChange:t=>te(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:o.bookWorkTitle,onChange:t=>te(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:o.bookWorkLanguage,onChange:t=>te(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:o.bookWorkOriginalLanguage,onChange:t=>te(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:o.bookWorkDoi,onChange:t=>te(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>te(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),o.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:n=>te(p=>({...p,bookContributors:p.bookContributors.map((T,Q)=>Q===r?{...T,contributorType:n.target.value,contributor:null}:T)})),children:["person","institution","collective"].map(n=>e.jsx("option",{value:n,children:Qe(a,n)},n))})]}),e.jsx(De,{libraryId:d,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:n=>te(p=>({...p,bookContributors:p.bookContributors.map((T,Q)=>Q===r?{...T,contributor:n}:T)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Qe(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:n=>te(p=>({...p,bookContributors:p.bookContributors.map((T,Q)=>Q===r?{...T,role:n.target.value}:T)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>te(n=>{const p=n.bookContributors.filter((T,Q)=>Q!==r);return p.length===0?{...n,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...n,bookContributors:p}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),o.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:o.languageA,onChange:t=>te(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:o.languageB,onChange:t=>te(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:o.wordA,onChange:t=>te(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:me,autoAdvance:!0,onCommit:()=>{var t;return(t=Je.current)==null?void 0:t.focus()}}),e.jsx(De,{libraryId:d,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:o.wordB,onChange:t=>te(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Je,autoAdvance:!0,onCommit:()=>{var t;return(t=Pe.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(De,{libraryId:d,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:o.translationTags,onChangeMultiple:t=>te(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(De,{libraryId:d,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:o.wordATags,onChangeMultiple:t=>te(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(De,{libraryId:d,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:o.wordBTags,onChangeMultiple:t=>te(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),o.groupType==="vocab"&&Ne&&e.jsx("p",{className:"cogita-help",children:Ne}),o.groupType==="vocab"&&Se&&e.jsx("p",{className:"cogita-help",children:Se}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:L,ref:Pe,children:z})})]}):null,k?e.jsx("p",{className:"cogita-form-error",children:k}):null]})})})})})]})})}const Er=a=>/\s/.test(a),Ft=a=>/[\p{L}\p{N}]/u.test(a),Fr=(a,l)=>{const u=l>0?a[l-1]:"",h=l<a.length?a[l]:"";if(!u||!h)return 0;const b=Er(u),M=Er(h);if(b||M)return 3;const v=Ft(u),E=Ft(h);return v!==E?2:!v&&!E?1:0},nr=(a,l,u,h,b)=>{const M=Math.max(h-l,u-h);for(let v=0;v<=M;v+=1){const E=h-v;if(E>=l&&E<=u&&Fr(a,E)>=b)return E;const D=h+v;if(D>=l&&D<=u&&Fr(a,D)>=b)return D}return null},lr=(a,l)=>{const u=l>0?a[l-1]:"",h=l<a.length?a[l]:"";return!u||!h?!0:Ft(u)!==Ft(h)},Zi=(a,l,u,h)=>{const b=u-l,M=l+h,v=u-h;if(b<=h*2||v<=M)return null;const E=Math.floor((l+u)/2),D=nr(a,M,v,E,3);if(D!==null&&lr(a,D))return D;const K=nr(a,M,v,E,2);if(K!==null&&lr(a,K))return K;const d=nr(a,M,v,E,1);return d!==null&&lr(a,d)?d:null},nt=(a,l)=>{const u=Math.max(1,7),h=Math.max(u,13),b={},M=(D,K,d,R,f)=>{const j=String(R),U={id:j,start:D,end:K,text:a.slice(D,K),depth:d,index:R,parentId:f};if(b[j]=U,K-D>h){let H=Zi(a,D,K,u);if(H!==null&&H>D&&H<K){const c=M(D,H,d+1,R*2+1,j),g=M(H,K,d+1,R*2+2,j);U.leftId=c.id,U.rightId=g.id}}return U},v=M(0,a.length,0,0),E=Object.values(b).sort((D,K)=>K.depth-D.depth||D.start-K.start).map(D=>D.id);return{text:a,rootId:v.id,nodes:b,order:E}},rt=(a,l,u,h,b,M,v)=>{const E=M==="reverse"?a.order.slice().sort((D,K)=>a.nodes[K].start-a.nodes[D].start||a.nodes[K].depth-a.nodes[D].depth):a.order;for(const D of E){if(v&&D===v||l.has(D))continue;const K=a.nodes[D];if(K){if(b&&(K.leftId||K.rightId)){const d=K.leftId?u[K.leftId]??0:h,R=K.rightId?u[K.rightId]??0:h;if((d+R)/2<h)continue}return K}}return null},Qr=(a,l)=>({before:a.slice(0,l.start),fragment:a.slice(l.start,l.end),after:a.slice(l.end)});function en({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d}){const R=`/#/cogita/library/${d}`,[f,j,U]=pr([]),[W,H,c]=fr([]),[g,x]=i.useState(null),[se,O]=i.useState(null),[y,J]=i.useState(null),[B,Y]=i.useState(null),ae=i.useMemo(()=>f.find(o=>o.id===g)??null,[f,g]);i.useEffect(()=>{let o=!0;return bi({libraryId:d}).then(te=>{if(!o)return;const k=te.nodes.map(S=>{var ye,q,ne;return{id:S.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:S.payload&&typeof S.payload=="object"&&"label"in S.payload?String(S.payload.label):"Item",nodeType:S.nodeType,itemType:((ye=S.payload)==null?void 0:ye.itemType)??"info",itemId:((q=S.payload)==null?void 0:q.itemId)??null,infoType:((ne=S.payload)==null?void 0:ne.infoType)??null}}});j(k),H(te.edges.map(S=>({id:S.edgeId,source:S.fromNodeId,target:S.toNodeId})))}).catch(()=>{o&&(j([]),H([]))}),()=>{o=!1}},[d]),i.useEffect(()=>{mi({libraryId:d}).then(O).catch(()=>O(null))},[d,f,W]);const V=i.useCallback(o=>{H(te=>yt(o,te))},[]),be=()=>{const o=crypto.randomUUID();j(te=>[...te,{id:o,type:"default",position:{x:140+te.length*40,y:120+te.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},ke=()=>{const o=crypto.randomUUID();j(te=>[...te,{id:o,type:"default",position:{x:180+te.length*40,y:160+te.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},oe=async()=>{J(null);try{const o=f.map(k=>({nodeId:k.id,nodeType:k.data.nodeType,payload:{itemType:k.data.itemType,itemId:k.data.itemId??null,label:k.data.label,infoType:k.data.infoType??null}})),te=W.map(k=>({edgeId:k.id,fromNodeId:k.source,toNodeId:k.target}));await pi({libraryId:d,nodes:o,edges:te}),J(a.cogita.library.graph.saveSuccess)}catch{J(a.cogita.library.graph.saveFail)}},A=o=>{ae&&j(te=>te.map(k=>k.id===ae.id?{...k,data:{...k.data,itemId:(o==null?void 0:o.infoId)??null,itemType:"collection",infoType:"collection",label:(o==null?void 0:o.label)??a.cogita.library.infoTypes.collection}}:k))},ge=o=>{ae&&j(te=>te.map(k=>k.id===ae.id?{...k,data:{...k.data,itemId:(o==null?void 0:o.infoId)??null,itemType:"info",infoType:(o==null?void 0:o.infoType)??null,label:(o==null?void 0:o.label)??a.cogita.library.infoTypes.any}}:k))};return i.useEffect(()=>{if(!ae||ae.data.nodeType!=="info"||ae.data.infoType!=="quote"||!ae.data.itemId){Y(null);return}let o=!0;return tt({libraryId:d,infoId:ae.data.itemId}).then(te=>{if(!o)return;const k=te.payload,S=(k==null?void 0:k.text)??"";if(!S){Y(null);return}const ye=nt(S),q=Object.values(ye.nodes).sort((ne,we)=>ne.depth-we.depth||ne.start-we.start).map(ne=>({id:ne.id,text:ne.text,depth:ne.depth}));Y({title:(k==null?void 0:k.title)??ae.data.label,fragments:q})}).catch(()=>Y(null)),()=>{o=!1}},[d,ae]),e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:R,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:oe,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:be,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ke,children:a.cogita.library.actions.addInfo}),se?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(se.totalCollections))})}):null,y?e.jsx("p",{className:"cogita-help",children:y}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Ut,{nodes:f,edges:W,onNodesChange:U,onEdgesChange:c,onConnect:V,onNodeClick:(o,te)=>x(te.id),fitView:!0,children:[e.jsx(Wt,{gap:18,size:1}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),ae?e.jsxs("div",{className:"cogita-graph-inspector",children:[ae.data.nodeType==="collection"?e.jsx(De,{libraryId:d,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:ae.data.itemId?{id:ae.data.itemId,label:ae.data.label,infoType:"collection"}:null,onChange:A,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(De,{libraryId:d,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:ae.data.itemId?{id:ae.data.itemId,label:ae.data.label,infoType:ae.data.infoType??void 0}:null,onChange:ge,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),B?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:B.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:B.fragments.map(o=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:o.id}),e.jsx("span",{children:o.text})]},o.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function Ar({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d,collectionId:R}){const{libraryName:f}=Da(d),[j,U]=i.useState([]),[W,H]=i.useState("loading"),[c,g]=i.useState("idle"),x=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),se=`/#/cogita/library/${d}`,O=()=>{H("loading"),_r({libraryId:d}).then(B=>{U(B),H("idle")}).catch(()=>{U([]),H("error")})};i.useEffect(()=>{O()},[d]);const y=async B=>{try{await Ur({libraryId:d,shareId:B}),O()}catch{O()}},J=async B=>{const Y=`${x}/${B}`;try{await navigator.clipboard.writeText(Y),g("copied")}catch{g("failed")}};return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:se,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${se}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[W==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):W==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):j.filter(B=>!R||B.collectionId===R).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:j.filter(B=>!R||B.collectionId===R).map(B=>e.jsxs("div",{className:"cogita-share-row","data-state":B.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:B.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(B.createdUtc).toLocaleString(),B.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),B.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${x}/${B.shareCode}`}):null]}),B.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[B.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>J(B.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>y(B.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},B.shareId))}),c==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):c==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function an({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d}){const{libraryName:R}=Da(d),f=`/#/cogita/library/${d}`,[j,U]=i.useState(""),[W,H]=i.useState([]),[c,g]=i.useState("idle"),[x,se]=i.useState(0),[O,y]=i.useState(null);i.useEffect(()=>{g("loading");const B=window.setTimeout(()=>{$t({libraryId:d,query:j.trim()||void 0,limit:30}).then(Y=>{H(Y.items),se(Y.total),y(Y.nextCursor??null),g("ready")}).catch(()=>{H([]),se(0),y(null),g("ready")})},240);return()=>window.clearTimeout(B)},[d,j]);const J=async()=>{if(O){g("loading");try{const B=await $t({libraryId:d,query:j.trim()||void 0,limit:30,cursor:O});H(Y=>[...Y,...B.items]),y(B.nextCursor??null),se(B.total),g("ready")}catch{g("ready")}}};return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:R}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:f,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${f}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:j,onChange:B=>U(B.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(W.length)).replace("{total}",String(x||W.length))}),e.jsx("span",{children:c==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:W.length?W.map(B=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${f}/collections/${B.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:B.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(B.itemCount))," ·"," ",B.notes||a.cogita.library.collections.noNotes]})]})},B.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${f}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),O?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:J,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const Br=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],tn={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},rn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],nn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function ln({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d,onCreated:R}){const{libraryName:f}=Da(d),j=`/#/cogita/library/${d}`,[U,W]=i.useState(null),[H,c]=i.useState(""),[g,x]=i.useState(""),[se,O,y]=pr([]),[J,B,Y]=fr([]),[ae,V]=i.useState(null),[be,ke]=i.useState(null),oe=i.useMemo(()=>se.find(k=>k.id===ae)??null,[se,ae]),A=k=>{var ne;const S=crypto.randomUUID(),ye=((ne=Br.find(we=>we.type===k))==null?void 0:ne.label)??k,q={...tn[k]};O(we=>[...we,{id:S,type:"default",position:{x:120+we.length*40,y:120+we.length*40},data:{nodeType:k,label:ye,params:q}}]),V(S)},ge=i.useCallback(k=>{B(S=>yt({...k,id:crypto.randomUUID()},S))},[B]),o=k=>{oe&&O(S=>S.map(ye=>ye.id===oe.id?{...ye,data:{...ye.data,params:k}}:ye))},te=async()=>{if(ke(null),!H.trim()){ke(a.cogita.library.collections.saveRequiredName);return}try{const k={nodes:se.map(q=>({nodeId:q.id,nodeType:q.data.nodeType,payload:{position:q.position,params:q.data.params}})),edges:J.map(q=>({edgeId:q.id,fromNodeId:q.source,fromPort:q.sourceHandle??null,toNodeId:q.target,toPort:q.targetHandle??null}))};let S=U,ye=!1;if(S)await zr({libraryId:d,collectionId:S,nodes:k.nodes,edges:k.edges});else{const q=await Wr({libraryId:d,name:H.trim(),notes:g.trim()||void 0,items:[],graph:k});S=q.collectionId,ye=!0,W(q.collectionId)}ke(ye?a.cogita.library.collections.saveSuccess:a.cogita.library.graph.saveSuccess),R(S)}catch{ke(U?a.cogita.library.graph.saveFail:a.cogita.library.collections.saveFail)}};return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.createKicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.createSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("button",{type:"button",className:"cta",onClick:te,children:a.cogita.library.actions.saveCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.collectionInfoTitle}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{value:H,onChange:k=>c(k.target.value),placeholder:a.cogita.library.collections.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.notesLabel}),e.jsx("textarea",{value:g,onChange:k=>x(k.target.value),placeholder:a.cogita.library.collections.notesPlaceholder})]}),be?e.jsx("p",{className:"cogita-help",children:be}):null,e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:Br.map(k=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>A(k.type),children:k.label},k.type))})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Ut,{nodes:se,edges:J,onNodesChange:y,onEdgesChange:Y,onConnect:ge,onNodeClick:(k,S)=>V(S.id),fitView:!0,children:[e.jsx(Wt,{color:"rgba(120,160,200,0.2)"}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),oe?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:oe.data.label}),oe.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:oe.data.params.tagId?{id:oe.data.params.tagId,label:oe.data.params.tagLabel??"",infoType:"topic"}:null,onChange:k=>o({...oe.data.params,tagId:(k==null?void 0:k.id)??null,tagLabel:(k==null?void 0:k.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:oe.data.params.scope??"any",onChange:k=>o({...oe.data.params,scope:k.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),oe.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:oe.data.params.languageId?{id:oe.data.params.languageId,label:oe.data.params.languageLabel??"",infoType:"language"}:null,onChange:k=>o({...oe.data.params,languageId:(k==null?void 0:k.id)??null,languageLabel:(k==null?void 0:k.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:oe.data.params.scope??"any",onChange:k=>o({...oe.data.params,scope:k.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),oe.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:oe.data.params.infoType??"word",onChange:k=>o({...oe.data.params,infoType:k.target.value}),children:nn.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsx(De,{libraryId:d,infoType:oe.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:oe.data.params.infoId?{id:oe.data.params.infoId,label:oe.data.params.infoLabel??"",infoType:oe.data.params.infoType??"word"}:null,onChange:k=>o({...oe.data.params,infoId:(k==null?void 0:k.id)??null,infoLabel:(k==null?void 0:k.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),oe.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:oe.data.params.connectionType??"translation",onChange:k=>o({...oe.data.params,connectionType:k.target.value}),children:rn.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:oe.data.params.connectionId??"",onChange:k=>o({...oe.data.params,connectionId:k.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(oe.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function on({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d,collectionId:R}){Da(d);const f=`/#/cogita/library/${d}`,[j,U]=i.useState(a.cogita.library.collections.defaultName),[W,H]=i.useState(null),[c,g]=i.useState(0),[x,se]=i.useState([]),[O,y]=i.useState("idle"),[J,B]=i.useState(null),Y=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(x.length)).replace("{total}",String(c||x.length)),[a,x.length,c]);i.useEffect(()=>{_t(d,R).then(V=>{U(V.name),H(V.notes??null),g(V.itemCount)}).catch(()=>{U(a.cogita.library.collections.defaultName),H(null)})},[d,R]),i.useEffect(()=>{y("loading"),Rt({libraryId:d,collectionId:R,limit:40}).then(V=>{se(V.items),B(V.nextCursor??null),g(V.total),y("ready")}).catch(()=>{se([]),B(null),y("ready")})},[d,R]);const ae=async()=>{if(J){y("loading");try{const V=await Rt({libraryId:d,collectionId:R,limit:40,cursor:J});se(be=>[...be,...V.items]),B(V.nextCursor??null),g(V.total),y("ready")}catch{y("ready")}}};return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:j}),e.jsx("p",{className:"cogita-library-subtitle",children:W||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:f,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${f}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${f}/collections/${R}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${f}/collections/${R}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:Y}),e.jsx("span",{children:O==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:x.length?x.map(V=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:V.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:V.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:V.label}),e.jsx("p",{className:"cogita-card-subtitle",children:V.description})]})},ue(V))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),J?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:ae,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${f}/collections/${R}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Ma=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const l=a.length,u=a.filter(M=>M.correct).length,h=Ht(vr(a));return{score:Math.round(Math.max(0,Math.min(100,h.knowness*100))*100)/100,total:l,correct:u,lastReviewedUtc:h.lastReviewedUtc??null}},sn=a=>{if(a.maskBase64)try{const l=fi(a.maskBase64);if(!l.length)return a.correct?1:0;const u=l.reduce((h,b)=>h+b,0);return Math.max(0,Math.min(1,u/l.length/255))}catch{return a.correct?1:0}return a.correct?1:0},vr=a=>a.map(l=>({correctness:sn(l),createdUtc:l.createdUtc})),Ht=(a,l=Date.now())=>{var c;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const h=a.slice().sort((g,x)=>g.createdUtc.localeCompare(x.createdUtc)).slice(-5),b=h.reduce((g,x)=>g+x.correctness,0)/h.length,M=5,v=2,E=.15;let D=0,K=0;for(let g=0;g<h.length;g+=1){const x=new Date(h[g].createdUtc).getTime(),se=g===h.length-1?l:new Date(h[g+1].createdUtc).getTime(),O=Math.max(0,(se-x)/(1e3*60)),y=1-Math.exp(-O/M);D+=y,h[g].correctness>.5&&(K+=E)}let d=b*D*v+K;const R=((c=h[h.length-1])==null?void 0:c.createdUtc)??null,f=R?Math.max(0,(l-new Date(R).getTime())/(1e3*60)):0,U=1/(1+Math.log1p(f/60));return d*=U,h.length===1&&h[0].correctness>.5&&(d+=5.44*Math.exp(-f/2)),{knowness:d,avgCorrectness:b,lastReviewedUtc:R}},vt=a=>{const l=a.slice();for(let u=l.length-1;u>0;u-=1){const h=Math.floor(Math.random()*(u+1));[l[u],l[h]]=[l[h],l[u]]}return l},It=a=>a[Math.floor(Math.random()*a.length)],cn=(a,l)=>{const u=new Map;return a.forEach(h=>u.set(h,Math.random())),a.sort((h,b)=>{const M=l(h)-l(b);return M!==0?M:(u.get(h)??0)-(u.get(b)??0)})},Jt=(a,l,u,h,b)=>{if(!a.length)return null;const M=a.filter(E=>!(b!=null&&b.has(ue(E))));if(M.length===0)return null;const v=M.filter(E=>ue(E)!==u);return It(v.length?v:M)},dn=(a,l,u,h,b)=>{if(!a.length)return null;let M=Number.POSITIVE_INFINITY;for(const K of a){const d=ue(K);if(u.has(d))continue;const R=l[d]??1;R<M&&(M=R)}if(!Number.isFinite(M))return null;const v=a.filter(K=>{const d=ue(K);return!u.has(d)&&(l[d]??1)===M}),E=v.filter(K=>!b||ue(K)!==b),D=h?E.filter(K=>!h.has(ue(K))):E;return D.length>0?It(D):E.length>0?It(E):b&&v.some(K=>ue(K)===b)?v.find(K=>ue(K)===b)??null:v.length?It(v):null},Gr=(a,l,u,h,b)=>{const M=[],v=a.filter(D=>!b.has(ue(D))&&!u.has(ue(D))&&(l[ue(D)]??0)<1),E=cn(v,D=>l[ue(D)]??0);for(const D of E){if(M.length>=h)break;M.push(D),b.add(ue(D))}if(M.length<h){const D=vt(a.filter(K=>!b.has(ue(K))&&u.has(ue(K))));for(const K of D){if(M.length>=h)break;M.push(K),b.add(ue(K))}}return M},un=(a,l,u,h)=>Gr(a,l,u,h,new Set),jr=(a,l,u,h,b,M)=>{const v=Math.max(1,u.stackSize??l),D=vt(a).filter((U,W,H)=>H.findIndex(c=>ue(c)===ue(U))===W),K=un(D,h,b,v),d=new Set,R=new Set,f=Jt(K,{},null,d,R),j=f?[f]:[];return f&&R.add(ue(f)),{queue:j,meta:{pool:D,active:K,knownessMap:h,unknownSet:b,outcomesById:M,asked:d,queued:R}}},br={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,l)=>{const h=vt(a).filter((b,M,v)=>v.findIndex(E=>ue(E)===ue(b))===M);return{queue:h.slice(0,Math.min(l,h.length)),meta:{}}},applyOutcome:a=>a},kr=(a,l,u,h)=>{const b=Math.max(1,u.stackSize??l),v=vt(a).filter((W,H,c)=>c.findIndex(g=>ue(g)===ue(W))===H),E={},D=new Set,K=new Set,d=new Set,R=Math.max(1,u.levels??1);v.forEach(W=>{const H=ue(W),c=h==null?void 0:h[H],g=typeof c=="number"&&Number.isFinite(c)?c:1;E[H]=Math.min(R,Math.max(1,Math.round(g)))});const f=[];if(v.length>0){const W=new Map;v.forEach(c=>{var x;const g=E[ue(c)]??1;W.has(g)||W.set(g,[]),(x=W.get(g))==null||x.push(c)});const H=Array.from(W.keys()).sort((c,g)=>c-g);for(const c of H){if(f.length>=b)break;const g=vt(W.get(c)??[]);for(const x of g){if(f.length>=b)break;f.push(x)}}}const j=Jt(f,E,null,D,K),U=j?[j]:[];return j&&K.add(ue(j)),{queue:U,meta:{pool:v,active:f,levelMap:E,asked:D,queued:K,wrongSinceCorrect:d}}},gn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,l)=>Math.max(1,l.stackSize??a),getProgressTotal:()=>null,prepare:(a,l,u)=>kr(a,l,u),applyOutcome:(a,l,u,h,b)=>{if(!l)return a;const M=Math.max(1,h.levels??1),v=a.meta.pool??[],E=a.meta.active??[],D={...a.meta.levelMap??{}},K=new Set(a.meta.asked??[]),d=new Set(a.meta.queued??[]),R=new Set(a.meta.wrongSinceCorrect??[]),f=ue(l);d.delete(f),K.add(f);const j=D[f]??1;b.correct?(D[f]=R.has(f)?1:Math.min(j+1,M),R.delete(f)):(D[f]=1,R.add(f));const U=b.correct?E.filter(c=>ue(c)!==f):E.slice();if(b.correct&&U.length<Math.max(1,h.stackSize??1)){const c=new Set(U.map(x=>ue(x))),g=dn(v,D,c,K,f);g&&U.push(g)}const W=a.queue.slice(),H=Jt(U,D,f,K,d);return H&&(W.push(H),d.add(ue(H))),{queue:W,meta:{pool:v,active:U,levelMap:D,asked:K,queued:d,wrongSinceCorrect:R}}}},hn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,l)=>Math.max(1,l.stackSize??a),getProgressTotal:()=>null,prepare:(a,l,u)=>jr(a,l,u,{},new Set,{}),applyOutcome:(a,l,u,h,b)=>{if(!l)return a;const M=a.meta.pool??[],v=a.meta.active??[],E={...a.meta.knownessMap??{}},D=new Set(a.meta.unknownSet??[]),K={...a.meta.outcomesById??{}},d=new Set(a.meta.asked??[]),R=new Set(a.meta.queued??[]),f=ue(l);R.delete(f),d.add(f);const j={correctness:Math.max(0,Math.min(1,b.correctness??(b.correct?1:0))),createdUtc:b.createdUtc??new Date().toISOString()},W=(K[f]??[]).concat(j).sort((O,y)=>O.createdUtc.localeCompare(y.createdUtc)).slice(-5);K[f]=W,D.delete(f);const H=Date.now();M.forEach(O=>{const y=ue(O),J=K[y]??[];if(J.length===0){E[y]=0,D.add(y);return}const B=Ht(J,H);E[y]=B.knowness});const c=v.slice();if((E[f]??0)>=1){const O=c.filter(y=>ue(y)!==f);c.length=0,c.push(...O)}const x=Math.max(1,h.stackSize??u);if(c.length<x){const O=new Set(c.map(J=>ue(J))),y=Gr(M,E,D,x-c.length,O);c.push(...y)}const se=a.queue.slice();if(se.length===0||ue(se[se.length-1])===f){const O=Jt(c,{},f,d,R);O&&(se.push(O),R.add(ue(O)))}return{queue:se,meta:{pool:M,active:c,knownessMap:E,unknownSet:D,outcomesById:K,asked:d,queued:R}}}},Xr={random:br,levels:gn,temporal:hn},bn=Object.values(Xr),wr=a=>{if(!a)return br;const l=a.trim().toLowerCase();return l==="random"||l==="levels"||l==="temporal"?Xr[l]:br},Yt=(a,l)=>{const u={...a.defaultSettings};return l&&Object.entries(l).forEach(([h,b])=>{typeof b=="number"&&Number.isFinite(b)&&(u[h]=b),typeof b=="string"&&(u[h]=b)}),a.settingsFields.forEach(h=>{var M;const b=u[h.key];if(h.type==="number"){if(typeof b!="number"||Number.isNaN(b)){u[h.key]=a.defaultSettings[h.key]??0;return}h.min!==void 0&&(u[h.key]=Math.max(h.min,u[h.key])),h.max!==void 0&&(u[h.key]=Math.min(h.max,u[h.key]));return}if(h.type==="select"){const v=((M=h.options)==null?void 0:M.map(E=>E.value))??[];(typeof b!="string"||v.length>0&&!v.includes(b))&&(u[h.key]=a.defaultSettings[h.key]??v[0]??"")}}),u},Zr=(a,l)=>{const u={};return a.settingsFields.forEach(h=>{const b=l.get(h.key);if(b){if(h.type==="number"){const M=Number(b);Number.isNaN(M)||(u[h.key]=M);return}u[h.key]=b}}),Yt(a,u)},mn=(a,l)=>{const u=new URLSearchParams;return a.settingsFields.forEach(h=>{const b=l[h.key];(typeof b=="number"||typeof b=="string")&&u.set(h.key,String(b))}),u};function pn({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d,collectionId:R}){const{libraryName:f}=Da(d),j=`/#/cogita/library/${d}`,[U,W]=i.useState(a.cogita.library.collections.defaultName),[H,c]=i.useState(20),[g,x]=i.useState("random"),[se,O]=i.useState({}),[y]=i.useState("exact"),[J,B]=i.useState([]),[Y,ae]=i.useState(null),[V,be]=i.useState([]),[ke,oe]=i.useState("idle"),[A,ge]=i.useState(null),[o,te]=i.useState("idle"),[k,S]=i.useState("idle"),ye=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),q=i.useMemo(()=>wr(g),[g]),ne=i.useMemo(()=>Yt(q,se),[q,se]),we=i.useMemo(()=>mn(q,ne).toString(),[q,ne]);i.useEffect(()=>{_t(d,R).then(me=>W(me.name)).catch(()=>W(a.cogita.library.collections.defaultName))},[d,R]),i.useEffect(()=>{xi({libraryId:d}).then(me=>{B(me),!Y&&me.length>0&&ae(me[0].roleId)}).catch(()=>{B([])})},[d]);const Ne=()=>{S("loading"),_r({libraryId:d}).then(me=>{be(me),S("idle")}).catch(()=>{be([]),S("error")})};i.useEffect(()=>{Ne()},[d]);const Re=async()=>{oe("working"),te("idle");try{const me=await yi({libraryId:d,collectionId:R,revisionType:q.id,revisionSettings:ne,mode:g,check:y,limit:H});ge(`${ye}/${me.shareCode}${we?`?${we}`:""}`),oe("ready"),Ne()}catch{oe("error")}},Se=async()=>{if(A)try{await navigator.clipboard.writeText(A),te("copied")}catch{te("failed")}},Fe=async me=>{try{await Ur({libraryId:d,shareId:me}),Ne()}catch{Ne()}};return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:U}),e.jsx("p",{className:"cogita-library-subtitle",children:f})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${j}/collections/${R}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${j}/collections/${R}/revision/run?mode=${encodeURIComponent(g)}&check=${encodeURIComponent(y)}&limit=${H}${we?`&${we}`:""}${Y?`&reviewer=${encodeURIComponent(Y)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:g,onChange:me=>x(me.target.value),children:bn.map(me=>e.jsx("option",{value:me.id,children:a.cogita.library.revision[me.labelKey]},me.id))})]}),q.settingsFields.map(me=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[me.labelKey]}),me.type==="select"?e.jsx("select",{value:String(ne[me.key]??""),onChange:Je=>O(Pe=>({...Pe,[me.key]:Je.target.value})),children:(me.options??[]).map(Je=>e.jsx("option",{value:Je.value,children:a.cogita.library.revision[Je.labelKey]},Je.value))}):e.jsx("input",{type:"number",min:me.min,max:me.max,step:me.step,value:ne[me.key]??0,onChange:Je=>O(Pe=>({...Pe,[me.key]:Number(Je.target.value||0)}))})]},me.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),q.id!=="levels"&&q.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:H,onChange:me=>c(Number(me.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:Y??"",onChange:me=>ae(me.target.value||null),children:J.map(me=>e.jsx("option",{value:me.roleId,children:me.label},me.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${j}/collections/${R}/revision/run?mode=${encodeURIComponent(g)}&check=${encodeURIComponent(y)}&limit=${H}${we?`&${we}`:""}${Y?`&reviewer=${encodeURIComponent(Y)}`:""}`,children:a.cogita.library.actions.startRevision})})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),A?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:A,readOnly:!0})]}):null,ke==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,o==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):o==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:Re,disabled:ke==="working",children:ke==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),A?e.jsx("button",{type:"button",className:"cta ghost",onClick:Se,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),k==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):V.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:V.map(me=>e.jsxs("div",{className:"cogita-share-row","data-state":me.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:me.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(me.createdUtc).toLocaleString(),me.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),me.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>Fe(me.shareId),children:a.cogita.library.revision.shareRevokeAction})]},me.shareId))})]})]})]})]})})})]})})}function ei({copy:a,currentCard:l,currentTypeLabel:u,prompt:h,languages:b,answer:M,onAnswerChange:v,computedExpected:E,computedAnswers:D,onComputedAnswerChange:K,answerTemplate:d,outputVariables:R,variableValues:f,computedFieldFeedback:j,feedback:U,canAdvance:W,quoteContext:H,quotePlaceholder:c,onCheckAnswer:g,onSkip:x,onLanguageSelect:se,onMarkReviewed:O,onAdvance:y,showCorrectAnswer:J,setShowCorrectAnswer:B,onRevealCorrect:Y,answerMask:ae,expectedAnswer:V,hasExpectedAnswer:be,handleComputedKeyDown:ke,answerInputRef:oe,computedInputRefs:A,scriptMode:ge,setScriptMode:o,matchPairs:te,matchLeftOrder:k,matchRightOrder:S,matchSelection:ye,matchActiveLeft:q,matchActiveRight:ne,matchFeedback:we,onMatchLeftSelect:Ne,onMatchRightSelect:Re}){const Se=i.useMemo(()=>{var z;const ee=!d&&E.length===2?`The {${E[0].key}} is of type {${E[1].key}}`:null,Te=d??ee;if(!Te)return null;const qe=new Map(E.map(t=>[t.key,t.expected])),Ie=new Set,de=[],Ee=/\{([^}]+)\}/g;let Ke=0,Oe,Ce=null;for(;(Oe=Ee.exec(Te))!==null;){const t=Te.slice(Ke,Oe.index);t&&de.push({type:"text",value:t});const r=((z=Oe[1])==null?void 0:z.trim())??"",n=r&&qe.has(r)?r:r&&R&&R[r]?R[r]:null;r&&Ie.add(r),n&&Ie.add(n),n&&qe.has(n)?(de.push({type:"input",value:n}),Ce||(Ce=n)):r&&f&&f[r]!==void 0?de.push({type:"text",value:f[r]}):de.push({type:"text",value:Oe[0]}),Ke=Oe.index+Oe[0].length}const N=Te.slice(Ke);return N&&de.push({type:"text",value:N}),E.filter(t=>!Ie.has(t.key)).length>0?null:{parts:de,expectedByKey:qe,firstInputKey:Ce}},[d,E,R,f]),Fe=()=>{if(!Se)return null;const{parts:ee,expectedByKey:Te,firstInputKey:qe}=Se;return e.jsx("div",{className:"cogita-revision-inline-answer",children:ee.map((Ie,de)=>{var Ee,Ke;return Ie.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Ie.value},`text-${de}`):e.jsx("input",{ref:Oe=>{A.current[Ie.value]=Oe},autoFocus:Ie.value===qe,value:D[Ie.value]??"",onChange:Oe=>K(Ie.value,Oe.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":j[Ie.value]??(U==="correct"?"correct":U==="incorrect"?"incorrect":void 0),onKeyDown:Oe=>Ue(Oe)||ke(Oe),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((Ee=D[Ie.value])==null?void 0:Ee.length)??0,((Ke=Te.get(Ie.value))==null?void 0:Ke.length)??6)}ch`}},`input-${Ie.value}-${de}`)})})},me=i.useMemo(()=>{const ee=new Map;return(te??[]).forEach(Te=>ee.set(Te.leftId,Te)),ee},[te]),Je=i.useMemo(()=>{const ee=new Map;return(te??[]).forEach(Te=>ee.set(Te.rightId,Te)),ee},[te]);i.useEffect(()=>{var de;if(l.cardType!=="info"||l.infoType!=="computed"||E.length===0)return;const ee=typeof document<"u"?document.activeElement:null;if(ee&&(ee.tagName==="INPUT"||ee.tagName==="TEXTAREA"))return;const Te=(Se==null?void 0:Se.firstInputKey)??((de=E[0])==null?void 0:de.key);if(!Te)return;const qe=A.current[Te];if(!qe)return;const Ie=requestAnimationFrame(()=>{qe.focus()});return()=>cancelAnimationFrame(Ie)},[l,E,Se]);const Pe=(()=>{const ee=[V??"",...E.map(Ie=>Ie.expected??"")].join(""),Te=[M,...Object.values(D)].join(""),qe=`${ee}${Te}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(qe)})(),Ue=ee=>ee.ctrlKey&&(ee.key==="^"||ee.key==="6")?(ee.preventDefault(),o(Te=>Te==="super"?null:"super"),!0):ee.ctrlKey&&(ee.key==="_"||ee.key==="-")?(ee.preventDefault(),o(Te=>Te==="sub"?null:"sub"),!0):!1,ra=()=>{if(!V||!ae)return V??"";const ee=V.split(""),Te=Array.from(ae),qe=Te.length>0?Te.reduce((Ie,de)=>Ie+de,0)/Te.length:127;return ee.map((Ie,de)=>{const Ee=Te[de]??qe,Ke=Math.max(0,Math.min(255,Math.round(Ee)));let Oe=255,Ce=0;return Ke<=127?Ce=Math.round(Ke/127*255):(Ce=255,Oe=Math.round(255*(1-(Ke-127)/128))),e.jsx("span",{style:{color:`rgb(${Oe}, ${Ce}, 0)`},children:Ie},`mask-${de}`)})},Le=l.cardType==="info"&&l.infoType==="quote"?(H==null?void 0:H.title)||l.label:l.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:u}),e.jsx("strong",{children:Le})]}),l.cardType==="vocab"&&l.checkType==="translation-match"&&te?e.jsxs("div",{className:"cogita-revision-body",children:[h?e.jsx("h2",{children:h}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(k??[]).map(ee=>{const Te=me.get(ee);if(!Te)return null;const qe=(ye==null?void 0:ye[ee])??null,Ie=(we==null?void 0:we[ee])??null,de=q===ee;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":de,"data-state":Ie??void 0,"data-locked":qe?"true":void 0,onClick:()=>Ne==null?void 0:Ne(ee),children:[e.jsx("span",{children:Te.leftLabel}),qe&&J?e.jsx("em",{children:"✓"}):null]},ee)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(S??[]).map(ee=>{const Te=Je.get(ee);if(!Te)return null;const qe=Object.values(ye??{}).includes(ee),Ie=ne===ee;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":qe||Ie,"data-locked":qe?"true":void 0,onClick:()=>Re==null?void 0:Re(ee),children:e.jsx("span",{children:Te.rightLabel})},ee)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:g,disabled:l.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}):l.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:h}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:oe,value:M,onChange:ee=>v(ee.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":U==="correct"?"correct":U==="incorrect"?"incorrect":void 0,onKeyDown:ee=>{ee.key==="Enter"&&(ee.preventDefault(),ee.stopPropagation(),W?y():g())}})]}),Pe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>o(ee=>ee==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>o(ee=>ee==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:g,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}):l.cardType==="info"&&l.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[l.label?e.jsx("p",{className:"cogita-revision-hint",children:l.label}):null,d?null:e.jsx(Pt,{value:h??"",mode:"auto"}),E.length>0?(()=>{const ee=Fe();return ee?e.jsx("div",{className:"cogita-inline-answer-wrap",children:ee}):e.jsx("div",{className:"cogita-form-grid",children:E.map((Te,qe)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:Te.key}),e.jsx("textarea",{ref:Ie=>{A.current[Te.key]=Ie},autoFocus:qe===0,value:D[Te.key]??"",onChange:Ie=>K(Te.key,Ie.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":j[Te.key]??(U==="correct"?"correct":U==="incorrect"?"incorrect":void 0),onKeyDown:Ie=>Ue(Ie)||ke(Ie)})]},Te.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:oe,value:M,onChange:ee=>v(ee.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":U==="correct"?"correct":U==="incorrect"?"incorrect":void 0,onKeyDown:ee=>{Ue(ee)||ee.key==="Enter"&&(ee.preventDefault(),ee.stopPropagation(),W?y():g())}})]})}),Pe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ge==="super",onClick:()=>o(ee=>ee==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ge==="sub",onClick:()=>o(ee=>ee==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:g,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}):l.cardType==="info"&&l.infoType==="quote"&&H?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(H.completed)).replace("{total}",String(H.total))}),e.jsx("p",{className:"cogita-quote-text",children:H.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:oe,value:M,onChange:ee=>v(ee.target.value),placeholder:c??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":U==="correct"?"correct":U==="incorrect"?"incorrect":void 0,onKeyDown:ee=>{ee.key==="Enter"&&(ee.preventDefault(),ee.stopPropagation(),W?y():g())}})]}),e.jsx("p",{className:"cogita-quote-text",children:H.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:g,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}):l.cardType==="info"&&l.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:h}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:b.length?b.map(ee=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>se(ee.label),children:ee.label},ee.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:h}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:O,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:x,children:a.cogita.library.revision.skip})]})]}),U&&e.jsx("div",{className:"cogita-revision-feedback","data-state":U,children:U==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),U==="incorrect"&&be?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>B(ee=>{const Te=!ee;return Te&&Y(),Te}),children:a.cogita.library.revision.showAnswer}),J?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),E.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[E.map(ee=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:ee.key}),e.jsx("span",{children:ee.expected})]},ee.key)),V?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:V})]}):null]}):e.jsx("p",{children:ae?ra():V})]}):null]}):null,W?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:y,children:a.cogita.library.revision.nextQuestion})}):null]})}const or=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ai({outcomes:a}){const[l,u]=i.useState("day"),h=i.useMemo(()=>{const b=or.find(E=>E.id===l)??or[1],M=Date.now()-b.ms,v=a.filter(E=>new Date(E.createdUtc).getTime()>=M);return Ma(v)},[a,l]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:or.map(b=>e.jsx("button",{type:"button",className:"ghost","data-active":l===b.id,onClick:()=>u(b.id),children:b.label},b.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[h.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[h.correct," / ",h.total]})]})}const fn="cogita-revision",xn=1,At="outcomes",yn=()=>new Promise((a,l)=>{const u=indexedDB.open(fn,xn);u.onupgradeneeded=()=>{const h=u.result;if(!h.objectStoreNames.contains(At)){const b=h.createObjectStore(At,{keyPath:"id"});b.createIndex("byItem","itemKey",{unique:!1}),b.createIndex("byPending","pending",{unique:!1})}},u.onerror=()=>l(u.error),u.onsuccess=()=>a(u.result)}),kt=async(a,l)=>{const u=await yn();return new Promise((h,b)=>{const M=u.transaction(At,a),v=M.objectStore(At);l(v).then(h).catch(b),M.onerror=()=>b(M.error)})},ti=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const l=Array.from(a).map(u=>u.toString(16).padStart(2,"0"));return`${l.slice(0,4).join("")}-${l.slice(4,6).join("")}-${l.slice(6,8).join("")}-${l.slice(8,10).join("")}-${l.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},vn=()=>{const a="cogita_revision_client_id",l=localStorage.getItem(a);if(l)return l;const u=ti();return localStorage.setItem(a,u),u},jn=()=>{const a="cogita_revision_client_seq",l=Number(localStorage.getItem(a)??"0"),u=Number.isFinite(l)?l+1:1;return localStorage.setItem(a,String(u)),u},ri=(a,l,u,h)=>Ca(a,l,u,h),Bt=async a=>{const l=vn(),u=jn(),h=new Date().toISOString(),b={...a,clientId:l,clientSequence:u,createdUtc:h,id:ti(),pending:!0};return await kt("readwrite",M=>new Promise((v,E)=>{const D={...b,itemKey:ri(b.itemType,b.itemId,b.checkType,b.direction)},K=M.add(D);K.onsuccess=()=>v(),K.onerror=()=>E(K.error)})),b},Dt=async(a,l,u,h)=>{if(!l)return[];try{const b=ri(a,l,u,h);return await kt("readonly",M=>new Promise((v,E)=>{const K=M.index("byItem").getAll(b);K.onsuccess=()=>{const R=(K.result??[]).map(f=>({itemType:f.itemType,itemId:f.itemId,checkType:f.checkType??null,direction:f.direction??null,revisionType:f.revisionType,evalType:f.evalType,correct:f.correct,createdUtc:f.createdUtc,maskBase64:f.maskBase64,payloadBase64:f.payloadBase64,payloadHashBase64:f.payloadHashBase64,clientId:f.clientId,clientSequence:f.clientSequence,personRoleId:f.personRoleId??null})).sort((f,j)=>f.createdUtc.localeCompare(j.createdUtc));v(R)},K.onerror=()=>E(K.error)}))}catch{return[]}},Sa=async()=>{try{return await kt("readonly",a=>new Promise((l,u)=>{const h=a.getAll();h.onsuccess=()=>{const M=(h.result??[]).map(v=>({itemType:v.itemType,itemId:v.itemId,checkType:v.checkType??null,direction:v.direction??null,revisionType:v.revisionType,evalType:v.evalType,correct:v.correct,createdUtc:v.createdUtc,maskBase64:v.maskBase64,payloadBase64:v.payloadBase64,payloadHashBase64:v.payloadHashBase64,clientId:v.clientId,clientSequence:v.clientSequence,personRoleId:v.personRoleId??null}));l(M)},h.onerror=()=>u(h.error)}))}catch{return[]}},kn=async(a=100)=>{try{return await kt("readonly",l=>new Promise((u,h)=>{const M=l.index("byPending").getAll(!0);M.onsuccess=()=>{const v=M.result??[];u(v.slice(0,a))},M.onerror=()=>h(M.error)}))}catch{return[]}},wn=async a=>{if(a.length!==0)try{await kt("readwrite",l=>new Promise((u,h)=>{let b=a.length;a.forEach(M=>{const v=l.get(M);v.onsuccess=()=>{const E=v.result;if(E){E.pending=!1;const D=l.put(E);D.onsuccess=()=>{b-=1,b===0&&u()},D.onerror=()=>h(D.error)}else b-=1,b===0&&u()},v.onerror=()=>h(v.error)})}))}catch{}},sr=async(a,l)=>{const u=await kn(200);if(u.length===0)return;const h=new Map;u.forEach(b=>{var v;const M=b.personRoleId??l??"";h.has(M)||h.set(M,[]),(v=h.get(M))==null||v.push(b)});for(const[b,M]of h.entries()){const v=M.map(E=>({itemType:E.itemType,itemId:E.itemId,checkType:E.checkType??null,direction:E.direction??null,revisionType:E.revisionType,evalType:E.evalType,correct:E.correct,clientId:E.clientId,clientSequence:E.clientSequence,maskBase64:E.maskBase64??null,payloadHashBase64:E.payloadHashBase64??null,payloadBase64:E.payloadBase64??null,personRoleId:b||null}));try{await vi({libraryId:a,outcomes:v}),await wn(M.map(E=>E.id))}catch{}}},Dr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Tn=(a,l)=>{const u=Math.max(a.length,l.length,1),h=Math.abs(a.length-l.length);return Math.max(0,1-h/u)},Nn=(a,l)=>{const u=new Uint8Array(a.length),h=Tn(a,l);for(let b=0;b<a.length;b+=1){const M=a[b]===(l[b]??"")?128:0,v=a.length-1-b,E=l.length-1-b,D=a[v]===(l[E]??"")?127:0,K=Math.round((M+D)*h);u[b]=Math.max(0,Math.min(255,K))}return u},Ct=(a,l)=>a===l||(Dr[a]??[]).includes(l)?!0:(Dr[l]??[]).includes(a),Kt=(a,l)=>{const u=new Uint8Array(a.length);if(!a.length)return u;const h=[];for(let M=0;M<=a.length-3;M+=1)h.push({index:M,text:a.slice(M,M+3)});let b=!1;return h.forEach(M=>{for(let v=0;v<=l.length-3;v+=1){const E=l.slice(v,v+3);let D=0;for(let j=0;j<3;j+=1)Ct(M.text[j],E[j])&&(D+=1);if(D<2)continue;let K=M.index-1,d=v-1;for(;K>=0&&d>=0;){const j=a[K],U=l[d];if(j===U){u[K]=Math.max(u[K],255),K-=1,d-=1,b=!0;continue}if(Ct(j,U)){u[K]=Math.max(u[K],127),K-=1,d-=1,b=!0;continue}if(K>0&&a[K-1]===U){u[K]=Math.max(u[K],0),K-=1,b=!0;continue}if(d>0&&a[K]===l[d-1]){d-=1,b=!0;continue}break}for(let j=0;j<3;j+=1){const U=M.index+j,W=M.text[j],H=E[j],c=W===H?255:Ct(W,H)?127:0;u[U]=Math.max(u[U],c),b=!0}let R=M.index+3,f=v+3;for(;R<a.length&&f<l.length;){const j=a[R],U=l[f];if(j===U){u[R]=Math.max(u[R],255),R+=1,f+=1,b=!0;continue}if(Ct(j,U)){u[R]=Math.max(u[R],127),R+=1,f+=1,b=!0;continue}if(R+1<a.length&&a[R+1]===U){u[R]=Math.max(u[R],0),R+=1,b=!0;continue}if(f+1<l.length&&a[R]===l[f+1]){f+=1,b=!0;continue}break}}}),b?u:Nn(a,l)},it=(a,l,u)=>{const h=a.trim().toLowerCase(),b=l.trim().toLowerCase();return Kt(h,b)},lt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),ii=(a,l,u)=>{const h=lt(a),b=lt(l);return Kt(h,b)},ba=a=>a.trim().toLowerCase(),Ln=a=>a==="reverse"?"reverse":"forward",jt=(a,l)=>`${a}|${l}`,ma=a=>{if(!a)return null;const[l,u]=a.split("|",2);return(l==="forward"||l==="reverse")&&u?{mode:l,fragmentId:u}:{mode:"forward",fragmentId:a}},Ot=(a,l)=>{var h;const u=ma(l);return u?u.fragmentId&&l?(a??null)===l:(((h=ma(a))==null?void 0:h.mode)??"forward")===u.mode:!0},oa=a=>{const l=a==null?void 0:a.trim().toLowerCase();return l||null},ni=(a,l)=>{if((oa(a.childItemType)??"info")!==(l.cardType??"").toLowerCase()||a.childItemId!==l.cardId)return!1;const h=oa(a.childCheckType),b=oa(a.childDirection),M=oa(l.checkType),v=oa(l.direction);return!(h&&h!==M||b&&b!==v)},Cn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Mn={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},qt=(a,l,u)=>{if(!u||!l.startsWith(a))return l;const h=l.slice(a.length);if(!h)return l;const b=u==="super"?Cn:Mn,M=h.split("").map(v=>b[v]??v).join("");return a+M},Vt=(a,l,u)=>{var v,E,D;if(!a)return((v=l[0])==null?void 0:v.key)??null;const h=new Set(l.map(K=>K.key)),b=/\{([^}]+)\}/g;let M;for(;(M=b.exec(a))!==null;){const K=((E=M[1])==null?void 0:E.trim())??"";if(!K)continue;if(h.has(K))return K;const d=u==null?void 0:u[K];if(d&&h.has(d))return d}return((D=l[0])==null?void 0:D.key)??null},mr=a=>a.flatMap(l=>{if(l.cardType!=="info"||l.infoType!=="quote")return[l];const u=l.description??"";if(!u.trim())return[l];const h=ma(l.direction),b=(h==null?void 0:h.mode)??Ln(l.direction),M=nt(u),v=Object.keys(M.nodes);return v.length===0?[l]:v.map(E=>({...l,checkType:"quote-fragment",direction:jt(b,E)}))});function Sn({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d,collectionId:R}){const f=xr(),j=`/#/cogita/library/${d}`,U=i.useMemo(()=>new URLSearchParams(f.search),[f.search]),W=Math.max(1,Number(U.get("limit")??20)),H=U.get("mode")??"random",c=i.useMemo(()=>wr(H),[H]),g=i.useMemo(()=>Yt(c,Zr(c,U)),[c,U]),x=U.get("check")??"exact",se=U.get("reviewer"),O=i.useMemo(()=>a.cogita.library.revision[c.labelKey]??H,[a,H,c]),y=i.useMemo(()=>x==="exact"?a.cogita.library.revision.checkValue:x,[a,x]),[J,B]=i.useState(a.cogita.library.collections.defaultName),[Y,ae]=i.useState([]),[V,be]=i.useState([]),[ke,oe]=i.useState("idle"),[A,ge]=i.useState({current:0,total:0}),[o,te]=i.useState(0),[k,S]=i.useState(""),[ye,q]=i.useState(null),[ne,we]=i.useState(null),[Ne,Re]=i.useState(null),[Se,Fe]=i.useState(null),[me,Je]=i.useState([]),[Pe,Ue]=i.useState({}),[ra,Le]=i.useState({}),[ee,Te]=i.useState(null),[qe,Ie]=i.useState(null),[de,Ee]=i.useState(null),[Ke,Oe]=i.useState(null),[Ce,N]=i.useState(null),[L,z]=i.useState({}),t=i.useRef(0),[r,n]=i.useState(null),p=i.useRef(null),T=i.useRef(null),[Q,Z]=i.useState(null),[G,re]=i.useState(!1),[le,ve]=i.useState(null),[ea,We]=i.useState([]),[Ge,Be]=i.useState(null),_e=i.useRef(null),Ae=i.useRef(null),[ze,ia]=i.useState(null),[ua,aa]=i.useState(0),ga=i.useRef(null),Ia=i.useRef({}),[Ka,Ye]=i.useState(!1),[la,ot]=i.useState({}),[Pa,st]=i.useState([]),$a=i.useRef(new Map),[sa,Oa]=i.useState(new Set),[Ra,ca]=i.useState(!1),He=i.useRef(null),Xe=i.useRef(new Set),Aa=i.useRef({}),je=Y[o]??null,Tr=(je==null?void 0:je.checkType)==="translation-match"&&Ce,pe=i.useRef(new Map),ct=i.useRef(new Map),qa=i.useRef(new Map),Va=i.useRef(new Map),wt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?Qe(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),dt=i.useMemo(()=>{var m;return c.id!=="levels"?Y.length:((m=la.pool)==null?void 0:m.length)??c.getFetchLimit(W,g)},[la,g,c,Y.length,W]),Ga=c.getProgressTotal?c.getProgressTotal(Y,la,W,g):c.id==="levels"?Math.min(W,dt):Y.length,Qt=Ga?Math.min(o+1,Ga):0,pa=Math.max(1,Number(g.tries??1)),_a=g.compare??"anchors",wa=Math.max(0,Math.min(100,Number(g.minCorrectness??0))),na=(g.considerDependencies??"on")==="on",Ta=Math.max(0,Math.min(100,Number(g.dependencyThreshold??85))),da=s=>{const m=s.slice();for(let C=m.length-1;C>0;C-=1){const _=Math.floor(Math.random()*(C+1));[m[C],m[_]]=[m[_],m[C]]}return m},fa=s=>s.length?s.reduce((C,_)=>C+_,0)/s.length/255*100:0,Xa=s=>fa(s)>=wa,Ua=async()=>{const s=await Sa(),m=new Map,C=new Map,_=new Map;s.forEach(w=>{const X=`${w.itemType}:${w.itemId}`,ie=Ca(w.itemType,w.itemId,w.checkType,w.direction);if(m.has(X)||m.set(X,[]),m.get(X).push(w),C.has(ie)||C.set(ie,[]),C.get(ie).push(w),w.itemType==="info"&&w.checkType==="quote-fragment"&&w.direction){const he=`${w.itemId}:${w.direction}`;_.has(he)||_.set(he,[]),_.get(he).push(w)}});const I=new Map,P=new Map,F=new Map;return m.forEach((w,X)=>I.set(X,Ma(w).score)),C.forEach((w,X)=>P.set(X,Ma(w).score)),_.forEach((w,X)=>F.set(X,Ma(w).score)),{itemKnowness:I,cardKnowness:P,fragmentKnowness:F}},ut=async s=>{const m=[];let C=null;for(;;){const _=await Rt({libraryId:d,collectionId:s,limit:200,cursor:C});if(m.push(..._.items),!_.nextCursor)break;C=_.nextCursor}return mr(m)},Gt=async(s,m)=>{if($a.current.has(s))return $a.current.get(s)??0;const C=await ut(s);if(C.length===0)return $a.current.set(s,0),0;const I=C.reduce((P,F)=>{const w=ue(F);return P+(m.get(w)??0)},0)/C.length;return $a.current.set(s,I),I},gt=(s,m)=>{if(!na||s.cardType!=="info"||s.infoType!=="quote"||s.checkType!=="quote-fragment")return!0;const C=ma(s.direction);if(!(C!=null&&C.fragmentId))return!0;const _=s.description??"";if(!_.trim())return!0;const P=nt(_).nodes[C.fragmentId];if(!P||!P.leftId&&!P.rightId)return!0;const F=[P.leftId,P.rightId].filter(ie=>!!ie);if(F.length===0)return!0;const w=F.map(ie=>{const he=Ca("info",s.cardId,"quote-fragment",jt(C.mode,ie));return m.get(he)??0});return w.reduce((ie,he)=>ie+he,0)/w.length>=Ta},Tt=async s=>{const m=la,C=s.concat(m.active??[]).concat(m.pool??[]).filter((w,X,ie)=>ie.findIndex(he=>ue(he)===ue(w))===X);if(!na){Oa(new Set(C.map(ue)));return}const{itemKnowness:_,cardKnowness:I}=await Ua(),P=Pa.filter(w=>oa(w.childItemType)==="collection"&&w.childItemId===R&&!oa(w.childCheckType)&&!oa(w.childDirection)),F=new Set;for(const w of C){if(w.cardType!=="info"){F.add(ue(w));continue}if(!gt(w,I))continue;const X=Pa.filter(ce=>ni(ce,w)).concat(P);if(X.length===0){F.add(ue(w));continue}let ie=0;for(const ce of X)if(oa(ce.parentItemType)==="collection")ie+=await Gt(ce.parentItemId,I);else if(oa(ce.parentCheckType)||oa(ce.parentDirection)){const xe=oa(ce.parentCheckType),fe=oa(ce.parentDirection),Me=Ca(ce.parentItemType,ce.parentItemId,xe,fe);ie+=I.get(Me)??0}else{const xe=`${ce.parentItemType}:${ce.parentItemId}`;ie+=_.get(xe)??0}ie/X.length>=Ta&&F.add(ue(w))}Oa(F)},ht=s=>{for(let m=s;m<Y.length;m+=1){const C=Y[m];if(C&&(!na||C.cardType!=="info"||sa.has(ue(C))))return m}return-1},bt=s=>!na||s.cardType!=="info"||sa.has(ue(s)),Na=s=>{if(c.id!=="temporal"&&c.id!=="levels")return null;const m=la,C=(m.active??[]).concat(m.pool??[]),_=new Set;for(const I of C){const P=ue(I);if(!(_.has(P)||s.has(P))&&(_.add(P),bt(I)))return I}return null},xa=i.useMemo(()=>{if(c.id!=="levels")return null;const s=la,m=s.pool??[],C=s.active??[],_=s.levelMap??{},I=Math.max(1,Number(g.levels??1)),P=Array.from({length:I},()=>0),F=new Set(C.map(he=>ue(he)));m.forEach(he=>{const ce=Math.min(I,Math.max(1,_[ue(he)]??1));P[ce-1]+=1});const w=m.length||1,X=P.map(he=>he/w*100),ie=je?_[ue(je)]??1:null;return{counts:P,percentages:X,currentLevel:ie,levelsCount:I,activeCount:C.length,poolCount:m.length,activeSet:F}},[la,g,c,je]),Za=i.useMemo(()=>{if(c.id!=="temporal")return null;const s=la,m=s.pool??[],C=s.active??[],_=s.knownessMap??{},I=new Set(s.unknownSet??[]);let P=0;m.forEach(X=>{(_[ue(X)]??0)>1&&(P+=1)});const F=I.size,w=C.map(X=>({id:ue(X),value:I.has(ue(X))?0:Math.max(0,Math.min(1,_[ue(X)]??0))}));return{knownCount:P,unknownCount:F,dots:w}},[la,c]),va=i.useMemo(()=>{if(!na)return 0;const s=la;return Y.concat(s.active??[]).concat(s.pool??[]).filter((C,_,I)=>I.findIndex(P=>ue(P)===ue(C))===_).filter(C=>C.cardType==="info"&&!sa.has(ue(C))).length},[na,la,Y,sa]);i.useEffect(()=>{if(!na||ke!=="ready")return;const s=la,C=Y.concat(s.active??[]).concat(s.pool??[]).filter((P,F,w)=>w.findIndex(X=>ue(X)===ue(P))===F).filter(P=>P.cardType!=="info"||sa.has(ue(P))).length,_=_e.current;if(_e.current=C,_===null||C<=_)return;const I=C-_;Be(`New card available (+${I})`),Ae.current&&window.clearTimeout(Ae.current),Ae.current=window.setTimeout(()=>Be(null),2200)},[na,ke,la,Y,sa]),i.useEffect(()=>()=>{Ae.current&&window.clearTimeout(Ae.current)},[]);const ha=(s,m)=>{const C=c.applyOutcome({queue:Y,meta:la},je,W,g,{correct:s,correctness:m,createdUtc:new Date().toISOString()});ae(C.queue),ot(C.meta);const _=C.queue[o+1];_&&Fa(_,o+1)};i.useEffect(()=>{_t(d,R).then(s=>B(s.name)).catch(()=>B(a.cogita.library.collections.defaultName))},[d,R]),i.useEffect(()=>{Vr({libraryId:d,type:"language"}).then(s=>be(s)).catch(()=>be([]))},[d]),i.useEffect(()=>{ji({libraryId:d}).then(s=>st(s.items??[])).catch(()=>st([]))},[d]),i.useEffect(()=>{sr(d,se)},[d,se]),i.useEffect(()=>{Tt(Y)},[Y,Pa,na,Ta,R]),i.useEffect(()=>{if(!je||!na){ca(!1);return}if(je.cardType!=="info"||sa.has(ue(je))){ca(!1);return}const s=ht(o+1);if(s>=0){ca(!1),te(s);return}if(c.id==="temporal"||c.id==="levels"){const m=Y.slice(0,o+1),C=Y.slice(o+1).filter(bt),_=m.concat(C),I=new Set(_.map(ue)),P=Na(I);if(P){const w=ue(P);I.has(w)||(_.push(P),I.add(w),ot(X=>{const ie=X,he=new Set(ie.queued??[]);return he.add(w),{...ie,queued:he}}))}const F=_.findIndex((w,X)=>X!==o&&bt(w));if(F>=0){ae(_),te(F),ca(!1);return}}ca(!0)},[je,sa,na,o,Y,la,c.id]),i.useEffect(()=>{let s=!0;return(async()=>{oe("loading"),ge({current:0,total:c.id==="levels"?0:c.getFetchLimit(W,g)});try{const C=[];let _=null,I=null;do{const ce=await Rt({libraryId:d,collectionId:R,limit:300,cursor:_});if(C.push(...ce.items),(c.id==="levels"||c.id==="temporal")&&ce.total&&(I=ce.total),ge(xe=>({current:C.length,total:xe.total||ce.total||c.getFetchLimit(W,g)})),_=ce.nextCursor??null,I!==null&&C.length>=I||c.id!=="levels"&&c.id!=="temporal"&&C.length>=c.getFetchLimit(W,g))break}while(_);if(!s)return;const P=mr(C);let F;if(c.id==="levels"){const ce=Math.max(1,Number(g.levels??1)),fe=(await Sa()).reduce((Me,$e)=>{const Ve=Ca($e.itemType,$e.itemId,$e.checkType,$e.direction);return Me[Ve]||(Me[Ve]=[]),Me[Ve].push($e),Me},{});F={},P.forEach(Me=>{const $e=ue(Me),Ve=fe[$e]??[],Ze=Ve.length>0?Ma(Ve).score:0,ja=Math.max(1,Math.min(ce,Math.ceil(Ze/100*ce)));F[$e]=ja})}let w=null,X=null,ie=null;if(c.id==="temporal"){const ce=await Sa(),xe=new Set(P.map($e=>ue($e))),fe=ce.reduce(($e,Ve)=>{const Ze=Ca(Ve.itemType,Ve.itemId,Ve.checkType,Ve.direction);return xe.has(Ze)&&($e[Ze]||($e[Ze]=[]),$e[Ze].push(Ve)),$e},{});w={},X=new Set,ie={};const Me=Date.now();P.forEach($e=>{const Ve=ue($e),Ze=fe[Ve]??[];if(Ze.length===0){w[Ve]=0,X.add(Ve),ie[Ve]=[];return}const ja=vr(Ze);ie[Ve]=ja;const li=Ht(ja,Me);w[Ve]=li.knowness})}const he=c.id==="levels"?kr(P,W,g,F):c.id==="temporal"?jr(P,W,g,w??{},X??new Set,ie??{}):c.prepare(P,W,g);ae(he.queue),ot(he.meta),te(0),oe("ready"),ge(ce=>({current:Math.min(ce.current,ce.total),total:ce.total}))}catch{s&&oe("error")}})(),()=>{s=!1}},[d,R,W,g,c,se]),i.useEffect(()=>{if(S(""),q(null),ia(null),aa(0),Je([]),Ue({}),Le({}),Ie(null),Ee(null),Oe(null),re(!1),Ye(!1),Z(null),N(null),z({}),!je){we(null),Re(null),Te(null),ve(null);return}je.cardType==="info"&&je.infoType==="computed"&&we(a.cogita.library.revision.loadingComputed);let s=!0;return Fa(je,o).then(m=>{!s||!m||(we(m.prompt),Re(m.expectedAnswer),Je(m.computedExpected),Ue(m.computedAnswers),Te(m.computedValues),Ie(m.answerTemplate),Ee(m.outputVariables),Oe(m.variableValues))}),()=>{s=!1}},[je,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){He.current=null,Xe.current=new Set,Fe(null);return}const s=je.description??"",m=(je.label??"").trim(),C=m.replace(/\s+/g," ").trim(),_=s.replace(/\s+/g," ").trim(),I=C&&C!==_?m:a.cogita.library.infoTypes.quote;if(!s){Fe(null),Re(null);return}const P=nt(s);He.current=P,we(I);let F=!0;return Ua().then(({fragmentKnowness:w})=>{if(!F)return;const X=getQuoteMode(je.direction),ie=new Set,he={};w.forEach((fe,Me)=>{const[$e,Ve]=Me.split(":",2);if($e!==je.cardId)return;const Ze=ma(Ve);if(!Ze||Ze.mode!==X)return;const ja=Ze.fragmentId;he[ja]=fe,fe>=Ta&&ie.add(ja)}),Xe.current=ie,Aa.current=he;const ce=ma(je.direction);if(ce!=null&&ce.fragmentId&&P.nodes[ce.fragmentId]){za(P,ce.fragmentId,I);return}const xe=rt(P,ie,he,Ta,na,je.direction);za(P,(xe==null?void 0:xe.id)??null,I)}).catch(()=>{Xe.current=new Set,Aa.current={};const w=ma(je.direction);if(w!=null&&w.fragmentId&&P.nodes[w.fragmentId]){za(P,w.fragmentId,I);return}const X=rt(P,Xe.current,{},Ta,na,je.direction);za(P,(X==null?void 0:X.id)??null,I)}),()=>{F=!1}},[je,a,na,Ta]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){N(null),z({});return}const C=(la.pool??la.active??Y).filter(w=>w.cardType==="vocab"&&w.checkType==="translation-match").filter((w,X,ie)=>ie.findIndex(he=>he.cardId===w.cardId)===X);C.some(w=>w.cardId===je.cardId)||C.unshift(je);const I=da(C).slice(0,6).map(w=>{const X=w.label.split("↔").map(ce=>ce.trim()).filter(Boolean);if(X.length<2)return null;const ie=`${w.cardId}:L`,he=`${w.cardId}:R`;return{cardId:w.cardId,leftId:ie,rightId:he,leftLabel:X[0],rightLabel:X[1]}}).filter(Boolean),P=I.map(w=>w.leftId),F=da(I.map(w=>w.rightId));N({pairs:I,leftOrder:P,rightOrder:F,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,Y,la]),i.useEffect(()=>()=>{p.current&&window.clearTimeout(p.current),T.current&&window.clearTimeout(T.current)},[]);const Ea=i.useRef(null);i.useEffect(()=>{if(!je)return;const s=ue(je),m=typeof document<"u"?document.activeElement:null;if(Ea.current===s&&m&&(m.tagName==="INPUT"||m.tagName==="TEXTAREA"))return;let C=0;const _=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(me.length>0){const P=Vt(qe,me,de),F=P?Ia.current[P]:null;if(F&&(F.focus(),document.activeElement===F)){Ea.current=s;return}}if(ga.current&&(ga.current.focus(),document.activeElement===ga.current)){Ea.current=s;return}}else if(je.cardType==="vocab"&&ga.current&&(ga.current.focus(),document.activeElement===ga.current)){Ea.current=s;return}C<6&&(C+=1,window.setTimeout(_,40))}},I=window.setTimeout(_,40);return()=>window.clearTimeout(I)},[je,me,qe,de]),i.useEffect(()=>{if(!Ka)return;const s=m=>{m.key==="Enter"&&(m.preventDefault(),ya())};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[Ka]);const Wa=s=>{We(s),ve(Ma(s))};i.useEffect(()=>{if(!je){ve(null),We([]);return}const s=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Sa().then(m=>{const C=m.filter(_=>_.itemType==="info"&&_.itemId===je.cardId&&_.checkType==="quote-fragment"&&Ot(_.direction,je.direction));Wa(C)}).catch(()=>{ve(null),We([])});return}Dt(s,je.cardId,je.checkType,je.direction).then(m=>Wa(m)).catch(()=>{ve(null),We([])})},[d,je,se]);const mt=(s,m,C,_)=>{if(s==="info"&&C==="quote-fragment"){Sa().then(I=>{const P=I.filter(F=>F.itemType==="info"&&F.itemId===m&&F.checkType==="quote-fragment"&&Ot(F.direction,_));Wa(P)}).catch(()=>{ve(null),We([])});return}Dt(s,m,C,_).then(I=>Wa(I)).catch(()=>{ve(null),We([])})},Nt=(s,m,C)=>{var F;const _=((F=C.pairs.find(w=>w.leftId===s))==null?void 0:F.rightId)??null;if(!_)return C;const I=_===m;z(w=>({...w,[s]:I?"correct":"incorrect"})),p.current&&window.clearTimeout(p.current),T.current&&window.clearTimeout(T.current),t.current+=1;const P={kind:I?"correct":"incorrect",tick:t.current};if(n(null),p.current=window.setTimeout(()=>n(P),0),T.current=window.setTimeout(()=>n(null),420),I){const w={...C.locked,[s]:!0};return Object.keys(w).length>=C.pairs.length?(q("correct"),Ye(!0)):q("correct"),{...C,selection:{...C.selection,[s]:m},activeLeft:null,activeRight:null,locked:w}}return q("incorrect"),{...C,activeLeft:null,activeRight:null}},Xt=s=>{N(m=>!m||m.locked[s]?m:m.activeRight?Nt(s,m.activeRight,m):{...m,activeLeft:m.activeLeft===s?null:s})},et=s=>{N(m=>m&&(m.activeLeft?Nt(m.activeLeft,s,m):{...m,activeRight:m.activeRight===s?null:s}))},ya=()=>{var s;if(je&&je.cardType==="info"&&je.infoType==="quote"&&He.current&&Se&&!((s=ma(je.direction))!=null&&s.fragmentId)){const m=rt(He.current,Xe.current,Aa.current,Ta,na,je.direction,Se.fragmentId);if(m){q(null),S(""),re(!1),Le({}),Ye(!1),ia(null),aa(0),za(He.current,m.id,Se.title);return}}q(null),S(""),re(!1),Le({}),Ye(!1),ia(null),aa(0),te(m=>Math.min(m+1,Y.length))},La=s=>{if(!je)return;const m=s.expected??null,C=s.answer??"";let _=m??"",I=C;if(!m&&s.expectedMap&&s.answerMap){const ce=Object.keys(s.expectedMap).sort((xe,fe)=>xe.localeCompare(fe));_=ce.map(xe=>{var fe;return((fe=s.expectedMap)==null?void 0:fe[xe])??""}).join("|"),I=ce.map(xe=>{var fe;return((fe=s.answerMap)==null?void 0:fe[xe])??""}).join("|")}const P=_?it(_,I,_a):new Uint8Array,F={revisionType:c.id,evalType:s.evalType,direction:s.direction,prompt:ne??"",expected:m,answer:C,expectedAnswers:s.expectedMap??null,answers:s.answerMap??null,correct:s.correct,maskBase64:P.length?Ba(P):null,values:ee??null,checkMode:x,compareMode:_a,minCorrectness:wa},w=new TextEncoder().encode(JSON.stringify(F)),X=je.cardType==="info"?"info":"connection",ie=s.overrideCheckType??je.checkType??null,he=s.overrideDirection??je.direction??null;Bt({itemType:X,itemId:je.cardId,checkType:ie,direction:he,revisionType:c.id,evalType:s.evalType,correct:s.correct,maskBase64:P.length?Ba(P):null,payloadBase64:Ba(w),personRoleId:se??null}).then(()=>{mt(X,je.cardId,ie,he),Tt(Y),sr(d,se)}).catch(()=>{})},pt=(s,m)=>{const C=pe.current.get(m);if(C)return Promise.resolve(C);const _=ct.current.get(m);if(_)return _;const I=tt({libraryId:d,infoId:s}).then(P=>{var ce,xe;const F=P.payload,w=((ce=F.definition)==null?void 0:ce.graph)??null,X="",ie=((xe=F.definition)==null?void 0:xe.answerTemplate)??"",he=yr(w,X,ie);if(he){const Me={sample:Yr(he),answerTemplate:ie||null};return pe.current.set(m,Me),Me}return gr({libraryId:d,infoId:s}).then(fe=>{const Me={sample:fe,answerTemplate:null};return pe.current.set(m,Me),Me})}).catch(()=>gr({libraryId:d,infoId:s}).then(P=>{const F={sample:P,answerTemplate:null};return pe.current.set(m,F),F}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{ct.current.delete(m)});return ct.current.set(m,I),I},Fa=(s,m)=>{var w;const C=`${ue(s)}:${m}`,_=qa.current.get(C);if(_)return Promise.resolve(_);const I=Va.current.get(C);if(I)return I;const P=X=>(qa.current.set(C,X),X);let F;if(s.cardType==="vocab"){if(s.checkType==="translation-match")return F=Promise.resolve(P({prompt:s.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),F;const X=s.label.split("↔").map(ie=>ie.trim()).filter(Boolean);if(X.length>=2){const he=(s.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ce=he?X[0]:X[1],xe=he?X[1]:X[0];F=Promise.resolve(P({prompt:ce,expectedAnswer:xe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else F=Promise.resolve(P({prompt:s.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(s.cardType==="info"&&s.infoType==="word"){const X=(w=s.description)!=null&&w.startsWith("Language: ")?s.description.replace("Language: ",""):null;F=Promise.resolve(P({prompt:s.label,expectedAnswer:X,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else s.cardType==="info"&&s.infoType==="computed"?F=pt(s.cardId,C).then(X=>{var fe,Me;if(!X.sample)return P({prompt:s.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ie=X.sample,he=ie.expectedAnswers?Object.entries(ie.expectedAnswers).map(([$e,Ve])=>({key:$e,expected:Ve})):[],ce=he.reduce(($e,Ve)=>($e[Ve.key]="",$e),{}),xe=ie.expectedAnswerIsSentence&&((fe=ie.expectedAnswer)==null?void 0:fe.trim())||null;return P({prompt:ie.prompt,expectedAnswer:he.length>0?xe:((Me=ie.expectedAnswer)==null?void 0:Me.trim())||null,computedExpected:he,computedAnswers:ce,computedValues:ie.values??null,answerTemplate:X.answerTemplate,outputVariables:ie.outputVariables??null,variableValues:ie.variableValues??null})}).catch(()=>P({prompt:s.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{Va.current.delete(C)}):F=Promise.resolve(P({prompt:s.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return Va.current.set(C,F),F},za=(s,m,C)=>{const _=Object.keys(s.nodes).length,I=Xe.current.size;if(!m){Fe({title:C,before:s.text,after:"",fragmentId:null,total:_,completed:I}),Re(null),Ye(!0);return}const P=s.nodes[m];if(!P)return;const F=Qr(s.text,P);Fe({title:C,before:F.before,after:F.after,fragmentId:P.id,total:_,completed:I}),Re(F.fragment),Ye(!1)},at=()=>{const s=He.current;s&&Fe(m=>m&&{...m,total:Object.keys(s.nodes).length,completed:Xe.current.size})},Ha=()=>{const s=Y[o+1];s&&Fa(s,o+1)},Lt=()=>{if(Ha(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&Ce){if(Ce.pairs.length===0){q("incorrect"),Ye(!0);return}const P=Ce.pairs.reduce((xe,fe)=>(xe[fe.rightId]=fe.rightLabel,xe),{});let F=0;const w={};Ce.pairs.forEach(xe=>{const Me=Ce.selection[xe.leftId]===xe.rightId;w[xe.leftId]=Me?"correct":"incorrect",Me&&(F+=1)});const X=Ce.pairs.length||1,ie=F/X,he=F===Ce.pairs.length;z(xe=>({...xe,...w})),he?(q("correct"),Ye(!0),aa(0)):(q("incorrect"),Ye(!1),aa(xe=>{const fe=xe+1;return fe>=pa&&(re(!0),Ye(!0),N(Me=>{if(!Me)return Me;const $e=Me.pairs.reduce((Ve,Ze)=>(Ve[Ze.leftId]=Ze.rightId,Ve),{});return{...Me,selection:$e}})),fe})),ha(he,ie);const ce="connection";Promise.all(Ce.pairs.map(xe=>{const fe=Ce.selection[xe.leftId]??null,Me=fe?P[fe]:"",$e={left:xe.leftLabel,expected:xe.rightLabel,answer:Me,checkType:"translation-match"},Ve=new TextEncoder().encode(JSON.stringify($e));return Bt({itemType:ce,itemId:xe.cardId,checkType:"translation-match",direction:null,revisionType:c.id,evalType:"translation-match",correct:fe===xe.rightId,maskBase64:null,payloadBase64:Ba(Ve),personRoleId:se??null})})).then(()=>{mt(ce,je.cardId,je.checkType,je.direction),sr(d,se)}).catch(()=>{});return}if(me.length>0){const P=me.reduce((w,X)=>{const ie=Pe[X.key]??"";return w[X.key]=ba(ie)===ba(X.expected)?"correct":"incorrect",w},{});me.every(({key:w,expected:X})=>{const ie=Pe[w]??"";return x==="exact"&&ba(ie)===ba(X)})?(q("correct"),Le(P),Ye(!0),aa(0),ha(!0,1),La({correct:!0,direction:ne?`${ne} -> computed`:"computed",expectedMap:me.reduce((w,X)=>(w[X.key]=X.expected,w),{}),answerMap:Pe,evalType:"computed"})):(q("incorrect"),Le(P),Ye(!1),aa(w=>{const X=w+1;return X>=pa&&$&&(re(!0),Ye(!0)),X}),ha(!1,0),window.setTimeout(()=>{var X;const w=Vt(qe,me,de);w&&Ia.current[w]&&((X=Ia.current[w])==null||X.focus())},40),La({correct:!1,direction:ne?`${ne} -> computed`:"computed",expectedMap:me.reduce((w,X)=>(w[X.key]=X.expected,w),{}),answerMap:Pe,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(Se!=null&&Se.fragmentId)){if(!Ne)return;const P=ma(je.direction),F=(P==null?void 0:P.mode)??getQuoteMode(je.direction),w=P!=null&&P.fragmentId&&je.direction?je.direction:jt(F,Se.fragmentId),X=ii(Ne,k,_a),ie=x==="exact"&&lt(k)===lt(Ne),he=Xa(X),ce=ie||he,xe=fa(X);ce?(Aa.current[Se.fragmentId]=Math.max(Aa.current[Se.fragmentId]??0,xe),(Aa.current[Se.fragmentId]??0)>=Ta&&Xe.current.add(Se.fragmentId),at(),q("correct"),Le({}),Ye(!0),ia(X),aa(0),xe<100&&pa<=1&&re(!0),ha(!0,xe/100),La({correct:!0,direction:`quote:${Se.fragmentId}`,expected:Ne,answer:k,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:w})):(q("incorrect"),Le({}),Ye(!1),ia(X),aa(fe=>{const Me=fe+1;return Me>=pa&&$&&(re(!0),Ye(!0)),Me}),ha(!1,xe/100),window.setTimeout(()=>{var fe;return(fe=ga.current)==null?void 0:fe.focus()},40),La({correct:!1,direction:`quote:${Se.fragmentId}`,expected:Ne,answer:k,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:w}));return}if(!Ne)return;const s=it(Ne,k,_a),m=x==="exact"&&ba(k)===ba(Ne),C=Xa(s),_=m||C,I=fa(s);_?(q("correct"),Le({}),Ye(!0),ia(s),aa(0),I<100&&pa<=1&&re(!0),ha(!0,I/100),La({correct:!0,direction:ne?`${ne} -> ${Ne}`:null,expected:Ne,answer:k,evalType:"text"})):(q("incorrect"),Le({}),Ye(!1),ia(s),aa(P=>{const F=P+1;return F>=pa&&$&&(re(!0),Ye(!0)),F}),ha(!1,I/100),window.setTimeout(()=>{var P;return(P=ga.current)==null?void 0:P.focus()},40),La({correct:!1,direction:ne?`${ne} -> ${Ne}`:null,expected:Ne,answer:k,evalType:"text"}))},Zt=s=>{if(Ha(),!Ne)return;const m=it(Ne,s,_a),C=ba(s)===ba(Ne),_=Xa(m),I=C||_,P=fa(m);I?(q("correct"),Le({}),Ye(!0),ia(m),aa(0),P<100&&pa<=1&&re(!0),ha(!0,P/100),La({correct:!0,direction:"word->language",expected:Ne,answer:s,evalType:"language-select"})):(q("incorrect"),Le({}),Ye(!1),ia(m),aa(F=>{const w=F+1;return w>=pa&&$&&(re(!0),Ye(!0)),w}),ha(!1,P/100),La({correct:!1,direction:"word->language",expected:Ne,answer:s,evalType:"language-select"}))},er=()=>{Ha(),q("correct"),Ye(!0),aa(0),ha(!0,1),Ne&&La({correct:!0,direction:"manual",expected:Ne,answer:k,evalType:"manual"})},ar=()=>{if(ha(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){q(null),S(""),re(!1),Le({}),Ye(!1),ia(null),aa(0),te(s=>Math.min(s+1,Y.length));return}ya()};i.useEffect(()=>{Ha()},[o,Y]);const tr=s=>{var C;if(s.key!=="Enter")return;if(s.preventDefault(),s.stopPropagation(),Ka){ya();return}const m=me.find(_=>!(Pe[_.key]??"").trim());if(m){(C=Ia.current[m.key])==null||C.focus();return}Lt()},Ja=a.cogita.library.revision.revealModeAfterIncorrect,$=me.length>0||!!Ne;return e.jsxs(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:[ke==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${A.total?Math.min(100,Math.max(0,A.current/A.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:A.total?`${Math.min(A.current,A.total)} / ${A.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:J}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",O).replace("{check}",y)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${j}/collections/${R}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:le?`${le.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[xa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",xa.currentLevel??"-"," / ",xa.levelsCount]}):null,le?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(le.correct)).replace("{total}",String(le.total))}),le.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(le.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ai,{outcomes:ea})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Ge?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Ge})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":r?`${r.kind}-${r.tick}`:Tr?"idle":ye??"idle",children:je?e.jsx(e.Fragment,{children:Ra?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ei,{copy:a,currentCard:je,currentTypeLabel:wt,prompt:ne,languages:V,answer:k,onAnswerChange:s=>S(m=>qt(m,s,Q)),computedExpected:me,computedAnswers:Pe,onComputedAnswerChange:(s,m)=>Ue(C=>({...C,[s]:qt(C[s]??"",m,Q)})),answerTemplate:qe,outputVariables:de,variableValues:Ke,computedFieldFeedback:ra,feedback:ye,canAdvance:Ka,quoteContext:Se,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Lt,onSkip:ar,onLanguageSelect:Zt,onMarkReviewed:er,onAdvance:ya,showCorrectAnswer:G,setShowCorrectAnswer:re,onRevealCorrect:()=>Ye(!0),answerMask:ze,expectedAnswer:Ne,hasExpectedAnswer:$,handleComputedKeyDown:tr,answerInputRef:ga,computedInputRefs:Ia,scriptMode:Q,setScriptMode:Z,matchPairs:Ce==null?void 0:Ce.pairs,matchLeftOrder:Ce==null?void 0:Ce.leftOrder,matchRightOrder:Ce==null?void 0:Ce.rightOrder,matchSelection:Ce==null?void 0:Ce.selection,matchActiveLeft:Ce==null?void 0:Ce.activeLeft,matchActiveRight:Ce==null?void 0:Ce.activeRight,matchFeedback:L,onMatchLeftSelect:Xt,onMatchRightSelect:et})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${j}/collections/${R}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Ga?`${Qt} / ${Ga}`:a.cogita.library.revision.progressUnlimited}),ke==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ke==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ke==="ready"&&Y.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Ja}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",pa]})]})]}),xa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",xa.activeCount," / ",xa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:xa.counts.map((s,m)=>{const C=m+1,_=xa.currentLevel===C,I=xa.percentages[m]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":_,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:C}),e.jsx("strong",{children:s})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,I))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[I.toFixed(1),"%"]})]},`level-${C}`)})})]}):null,Za?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:Za.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:Za.dots.map(s=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,s.value*100))}%`,background:`rgba(${Math.round(255*(1-s.value))}, ${Math.round(200*s.value)}, 80, 0.9)`}},s.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:Za.knownCount})]})]}):null,na?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:va})]})}):null]})]})]})})})]})]})}const cr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],In={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Pn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],$n=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Rn({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:d,collectionId:R}){const[f,j]=i.useState(""),[U,W,H]=pr([]),[c,g,x]=fr([]),[se,O]=i.useState(null),[y,J]=i.useState(null),[B,Y]=i.useState(null),ae=`/#/cogita/library/${d}`;i.useEffect(()=>{_t(d,R).then(o=>j(o.name)).catch(()=>j(a.cogita.library.collections.defaultName))},[d,R,a]),i.useEffect(()=>{ki({libraryId:d,collectionId:R}).then(o=>{if(!o.graphId||o.graphId==="00000000-0000-0000-0000-000000000000"){W([]),g([]);return}const te=o.nodes.map(S=>{var we;const ye=S.payload??{},q=ye.position??{x:120,y:120},ne=ye.params??{};return{id:S.nodeId,type:"default",position:q,data:{nodeType:S.nodeType,label:((we=cr.find(Ne=>Ne.type===S.nodeType))==null?void 0:we.label)??S.nodeType,params:ne}}}),k=o.edges.map(S=>({id:S.edgeId,source:S.fromNodeId,target:S.toNodeId,sourceHandle:S.fromPort??void 0,targetHandle:S.toPort??void 0}));W(te),g(k)}).catch(()=>{W([]),g([])})},[d,R,g,W]);const V=i.useMemo(()=>U.find(o=>o.id===se)??null,[U,se]),be=o=>{var ye;const te=crypto.randomUUID(),k=((ye=cr.find(q=>q.type===o))==null?void 0:ye.label)??o,S={...In[o]};W(q=>[...q,{id:te,type:"default",position:{x:120+q.length*40,y:120+q.length*40},data:{nodeType:o,label:k,params:S}}]),O(te)},ke=i.useCallback(o=>{g(te=>yt({...o,id:crypto.randomUUID()},te))},[g]),oe=async()=>{J(null);try{await zr({libraryId:d,collectionId:R,nodes:U.map(o=>({nodeId:o.id,nodeType:o.data.nodeType,payload:{position:o.position,params:o.data.params}})),edges:c.map(o=>({edgeId:o.id,fromNodeId:o.source,fromPort:o.sourceHandle??null,toNodeId:o.target,toPort:o.targetHandle??null}))}),J(a.cogita.library.graph.saveSuccess)}catch{J(a.cogita.library.graph.saveFail)}},A=async()=>{try{const o=await wi({libraryId:d,collectionId:R});Y(o)}catch{Y(null)}},ge=o=>{V&&W(te=>te.map(k=>k.id===V.id?{...k,data:{...k.data,params:o}}:k))};return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${ae}/collections/${R}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:A,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:oe,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:cr.map(o=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>be(o.type),children:o.label},o.type))}),y?e.jsx("p",{className:"cogita-help",children:y}):null,B&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(B.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(B.connections)).replace("{infos}",String(B.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Ut,{nodes:U,edges:c,onNodesChange:H,onEdgesChange:x,onConnect:ke,onNodeClick:(o,te)=>O(te.id),fitView:!0,children:[e.jsx(Wt,{color:"rgba(120,160,200,0.2)"}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),V?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:V.data.label}),V.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:V.data.params.tagId?{id:V.data.params.tagId,label:V.data.params.tagLabel??"",infoType:"topic"}:null,onChange:o=>ge({...V.data.params,tagId:(o==null?void 0:o.id)??null,tagLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:V.data.params.scope??"any",onChange:o=>ge({...V.data.params,scope:o.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),V.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(De,{libraryId:d,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:V.data.params.languageId?{id:V.data.params.languageId,label:V.data.params.languageLabel??"",infoType:"language"}:null,onChange:o=>ge({...V.data.params,languageId:(o==null?void 0:o.id)??null,languageLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:V.data.params.scope??"any",onChange:o=>ge({...V.data.params,scope:o.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),V.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:V.data.params.infoType??"word",onChange:o=>ge({...V.data.params,infoType:o.target.value}),children:$n.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsx(De,{libraryId:d,infoType:V.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:V.data.params.infoId?{id:V.data.params.infoId,label:V.data.params.infoLabel??"",infoType:V.data.params.infoType??"word"}:null,onChange:o=>ge({...V.data.params,infoId:(o==null?void 0:o.id)??null,infoLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:V.data.params.connectionType??"translation",onChange:o=>ge({...V.data.params,connectionType:o.target.value}),children:Pn.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:V.data.params.connectionId??"",onChange:o=>ge({...V.data.params,connectionId:o.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(V.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const dr="cogita.preferences",En=["library_overview","all_cards","new_card","all_collections","new_collection","dependencies"],Mt={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!1,allowsRevision:!1},new_collection:{requiresCollection:!1,allowsRevision:!1},collection_revision:{requiresCollection:!0,allowsRevision:!0},shared_revisions:{requiresCollection:!0,allowsRevision:!0},dependencies:{requiresCollection:!1,allowsRevision:!1}},Fn=["detail","graph","settings","run","shared"];function An(a){const l=a.split("/").filter(Boolean);if(l[0]!=="cogita"||l[1]!=="library")return{};const u=l[2];if(!u)return{};if(!l[3])return{libraryId:u,target:"library_overview"};if(l[3]==="list")return{libraryId:u,target:"all_cards",cardMode:"list"};if(l[3]==="detail"||l[3]==="collection")return{libraryId:u,target:"all_cards",cardMode:l[3]};if(l[3]==="new"||l[3]==="add")return{libraryId:u,target:"new_card"};if(l[3]==="shared-revisions")return{libraryId:u,target:"all_collections"};if(l[3]==="dependencies")return{libraryId:u,target:"dependencies"};if(l[3]!=="collections")return{libraryId:u,target:"library_overview"};if(l[4]==="new")return{libraryId:u,target:"new_collection"};const h=l[4];return h?l[5]==="graph"?{libraryId:u,target:"collection_revision",collectionId:h,revisionView:"graph"}:l[5]==="shared-revisions"?{libraryId:u,target:"collection_revision",collectionId:h,revisionView:"shared"}:l[5]==="revision"?{libraryId:u,target:"collection_revision",collectionId:h,revisionView:l[6]==="run"?"run":"settings"}:{libraryId:u,target:"collection_revision",collectionId:h,revisionView:"detail"}:{libraryId:u,target:"all_collections"}}function ur(a,l="library_overview",u,h){return a?l==="library_overview"?`/cogita/library/${a}`:l==="all_cards"?`/cogita/library/${a}/list`:l==="new_card"?`/cogita/library/${a}/add`:l==="all_collections"?`/cogita/library/${a}/collections`:l==="new_collection"?`/cogita/library/${a}/collections/new`:l==="shared_revisions"?u?`/cogita/library/${a}/collections/${u}/shared-revisions`:`/cogita/library/${a}/collections`:l==="dependencies"?`/cogita/library/${a}/dependencies`:u?h==="graph"?`/cogita/library/${a}/collections/${u}/graph`:h==="settings"?`/cogita/library/${a}/collections/${u}/revision`:h==="run"?`/cogita/library/${a}/collections/${u}/revision/run`:h==="shared"?`/cogita/library/${a}/collections/${u}/shared-revisions`:`/cogita/library/${a}/collections/${u}`:`/cogita/library/${a}/collections`:"/cogita"}function St(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function Bn(a,l){var E;if(!a.length)return null;const u=a.filter(D=>l.has(D.roleId)),h=u.length>0?u:a,b=h.map(D=>{var d,R;const K=((R=(d=D.fields.find(f=>f.fieldType==="role_kind"))==null?void 0:d.plainValue)==null?void 0:R.toLowerCase())??"";return{roleId:D.roleId,roleKind:K}}),M=b.find(D=>D.roleKind.includes("master"));if(M)return M.roleId;const v=b.find(D=>D.roleKind.includes("account")||D.roleKind.includes("user"));return v?v.roleId:((E=h[0])==null?void 0:E.roleId)??null}function Dn(a){if(!a)return{version:1,byLibrary:{}};try{const l=JSON.parse(a);return!l||typeof l!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:l.lastLibraryId,byLibrary:l.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Kn({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K}){const d=Bi(),R=xr(),f=i.useMemo(()=>An(R.pathname),[R.pathname]),j=a.cogita.workspace,[U,W]=i.useState([]),[H,c]=i.useState([]),[g,x]=i.useState(void 0),[se,O]=i.useState("library_overview"),[y,J]=i.useState(void 0),[B,Y]=i.useState("detail"),[ae,V]=i.useState(!1),[be,ke]=i.useState(!0),[oe,A]=i.useState(!1),[ge,o]=i.useState(null),[te,k]=i.useState(""),[S,ye]=i.useState(""),[q,ne]=i.useState(null),[we,Ne]=i.useState(null),Re=i.useRef({version:1,byLibrary:{}}),Se=i.useRef(!1),Fe=i.useRef(!1),me=i.useRef(null),Je=i.useMemo(()=>U.find(n=>n.libraryId===g)??null,[U,g]),Pe=i.useMemo(()=>H.find(n=>n.collectionId===y)??null,[H,y]),Ue=i.useMemo(()=>({detail:j.revisions.detail,graph:j.revisions.graph,settings:j.revisions.settings,run:j.revisions.run,shared:j.targets.sharedRevisions}),[j.revisions.detail,j.revisions.graph,j.revisions.run,j.revisions.settings,j.targets.sharedRevisions]),ra=i.useMemo(()=>Fn.map(n=>({value:n,label:Ue[n]})),[Ue.detail,Ue.graph,Ue.run,Ue.settings,Ue.shared]),Le=i.useMemo(()=>({library_overview:j.targets.libraryOverview,all_cards:j.targets.allCards,new_card:j.targets.newCard,all_collections:j.targets.allCollections,new_collection:j.targets.newCollection,collection_revision:j.targets.collectionRevision,shared_revisions:j.targets.sharedRevisions,dependencies:j.targets.dependencies}),[j.targets]),ee=i.useMemo(()=>Le[se]??se,[se,Le]),Te=Ue[B],qe=!!g,Ie=!!y,de=qe,Ee=Ie,Ke=i.useCallback(n=>{const p=!!n.libraryId;let T=n.target,Q=n.collectionId,Z=n.revisionView;p?Mt[T].requiresCollection&&!Q?(T="all_collections",Z="detail"):Mt[T].requiresCollection?Mt[T].allowsRevision||(Z="detail"):Q=void 0:(T="library_overview",Q=void 0,Z="detail"),x(n.libraryId),O(T),J(Q),Y(Z),V(!1);const G=St(ur(n.libraryId,T,Q,Z));St(R.pathname)!==G&&(me.current=G,d(G))},[R.pathname,d]),Oe=n=>{Ke({libraryId:g,target:"collection_revision",collectionId:y,revisionView:n})},Ce=i.useMemo(()=>[{key:"library",label:j.layers.library,visible:!0,value:g??"",selectedLabel:(Je==null?void 0:Je.name)??j.path.noLibrarySelected,disabled:be||U.length===0,options:U.map(n=>({value:n.libraryId,label:n.name})),emptyOption:j.noLibraryOption,onSelect:n=>{const p=n||void 0;Ke({libraryId:p,target:"library_overview",collectionId:void 0,revisionView:"detail"})}},{key:"target",label:j.layers.target,visible:qe,value:se,selectedLabel:ee,disabled:!qe,options:En.map(n=>({value:n,label:Le[n]})),onSelect:n=>{Ke({libraryId:g,target:n,collectionId:y,revisionView:B})}},{key:"collection",label:j.layers.collection,visible:de,value:y??"",selectedLabel:(Pe==null?void 0:Pe.name)??j.path.noCollectionSelected,disabled:!qe||oe||H.length===0,options:H.map(n=>({value:n.collectionId,label:n.name})),emptyOption:j.selectCollectionOption,onSelect:n=>{const p=n||void 0;Ke({libraryId:g,target:p?"collection_revision":se,collectionId:p,revisionView:B})}},{key:"revision",label:j.layers.revision,visible:Ee,value:B,selectedLabel:Te,disabled:!y,options:ra.map(n=>({value:n.value,label:n.label})),onSelect:n=>{Oe(n)}}],[H,oe,U,be,Ke,ra,Pe,y,Ie,qe,Je,g,Te,B,se,ee,de,Ee,Le,j.layers.collection,j.layers.library,j.layers.revision,j.layers.target,j.noLibraryOption,j.path.noCollectionSelected,j.path.noLibrarySelected,j.selectCollectionOption]),N=i.useMemo(()=>Ce.filter(n=>n.visible),[Ce]),L=i.useMemo(()=>N.filter(n=>n.key!=="library"&&n.key!=="collection"),[N]),z=i.useMemo(()=>{const n=f.libraryId;if(!n||!R.pathname.startsWith("/cogita/library/"))return null;const p={copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,libraryId:n};if(f.target==="library_overview")return e.jsx(_i,{...p});if(f.target==="all_cards")return e.jsx(Hi,{...p,mode:f.cardMode??"list"});if(f.target==="new_card")return e.jsx(Xi,{...p});if(f.target==="dependencies")return e.jsx(en,{...p});if(f.target==="shared_revisions")return e.jsx(Ar,{...p});if(f.target==="all_collections")return e.jsx(an,{...p});if(f.target==="new_collection")return e.jsx(ln,{...p,onCreated:T=>d(`/cogita/library/${n}/collections/${T}/graph`)});if(f.target==="collection_revision"&&f.collectionId){const T={...p,collectionId:f.collectionId};return f.revisionView==="graph"?e.jsx(Rn,{...T}):f.revisionView==="shared"?e.jsx(Ar,{...p,collectionId:f.collectionId}):f.revisionView==="settings"?e.jsx(pn,{...T}):f.revisionView==="run"?e.jsx(Sn,{...T}):e.jsx(on,{...T})}return null},[l,a,D,R.pathname,d,K,M,E,h,b,f.cardMode,f.collectionId,f.libraryId,f.revisionView,f.target,v,u]);i.useEffect(()=>{let n=!1;return(async()=>{var T,Q,Z,G,re;ke(!0);try{await Ti();const[le,ve,ea]=await Promise.all([qr(),Ni(),Li()]);if(n)return;W(le);const We=new Set(ea.nodes.filter(ze=>ze.nodeType==="role"&&ze.canLink).map(ze=>ze.roleId??"")),Ge=Bn(ve,We);if(ne(Ge),Ge){const ze=ea.nodes.find(ia=>ia.nodeType==="data"&&ia.roleId===Ge&&(ia.fieldType===dr||ia.label===dr));Ne((ze==null?void 0:ze.dataKeyId)??null),Re.current=Dn(ze==null?void 0:ze.value)}const Be=Re.current.lastLibraryId,_e=((T=le.find(ze=>ze.libraryId===f.libraryId))==null?void 0:T.libraryId)??(le.length===1?le[0].libraryId:void 0)??((Q=le.find(ze=>ze.libraryId===Be))==null?void 0:Q.libraryId)??((Z=le[0])==null?void 0:Z.libraryId),Ae=(_e&&((re=(G=Re.current.byLibrary)==null?void 0:G[_e])==null?void 0:re.lastTarget))??"library_overview";x(_e),O(f.target??Ae),Y(f.revisionView??"detail"),Se.current=!0}catch{n||o(j.status.loadFailed)}finally{n||ke(!1)}})(),()=>{n=!0}},[j.status.loadFailed]),i.useLayoutEffect(()=>{Se.current&&(f.libraryId&&U.some(n=>n.libraryId===f.libraryId)&&x(f.libraryId),f.target&&O(f.target),J(f.collectionId),f.revisionView&&Y(f.revisionView))},[U,f.collectionId,f.libraryId,f.revisionView,f.target]),i.useEffect(()=>{if(!g){c([]),J(void 0);return}let n=!1;return A(!0),$t({libraryId:g,limit:200}).then(p=>{var Z;if(n)return;const T=p.items;c(T);const Q=(Z=T.find(G=>G.collectionId===f.collectionId))==null?void 0:Z.collectionId;J(Q)}).catch(()=>{n||(c([]),J(void 0))}).finally(()=>{n||A(!1)}),()=>{n=!0}},[f.collectionId,g]),i.useEffect(()=>{if(!Se.current||f.libraryId&&U.some(T=>T.libraryId===f.libraryId)&&f.libraryId!==g||f.target&&f.target!==se||f.revisionView&&f.revisionView!==B||Mt[se].requiresCollection&&!y&&f.target==="collection_revision"&&f.collectionId)return;const n=St(R.pathname),p=St(ur(g,se,y,B));if(n===p){me.current=null;return}me.current!==p&&(me.current=p,d(p,{replace:!0}))},[U,R.pathname,d,f.collectionId,f.libraryId,f.revisionView,f.target,y,g,B,se]),i.useEffect(()=>{if(typeof window>"u")return;const n=()=>{window.innerWidth>920&&V(!1)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),i.useEffect(()=>{if(!Se.current||!q||!g||Fe.current)return;const n=Re.current,p={...n.byLibrary??{}},T={...p[g]??{},lastCollectionId:y,lastRevisionView:B,lastTarget:se},Q={version:1,lastLibraryId:g,byLibrary:{...p,[g]:T}},Z=JSON.stringify(n),G=JSON.stringify(Q);if(Z===G)return;Re.current=Q,Fe.current=!0,(async()=>{try{if(we)await Ci(we,{plainValue:G});else{const le=await Mi(q,{itemName:dr,itemType:"data",plainValue:G});Ne(le.dataItemId)}}catch{o(j.status.savePrefsFailed)}finally{Fe.current=!1}})()},[we,q,y,g,B,se,j.status.savePrefsFailed]);const t=async()=>{const n=te.trim();if(!n){o(a.cogita.user.libraryNameRequired);return}o(null);try{const p=await Si({name:n});W(T=>[p,...T]),x(p.libraryId),O("library_overview"),J(void 0),k("")}catch{o(a.cogita.user.libraryCreateFailed)}},r=async()=>{if(!g){o(j.status.selectLibraryFirst);return}const n=S.trim();if(!n){o(a.cogita.library.collections.saveRequiredName);return}o(null);try{const p=await Wr({libraryId:g,name:n,items:[]}),T=await $t({libraryId:g,limit:200});c(T.items),J(p.collectionId),O("collection_revision"),Y("detail"),ye("")}catch{o(a.cogita.library.collections.saveFail)}};return e.jsx(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${ae?"open":""}`,"aria-label":j.sidebar.title,children:[e.jsx("div",{className:"cogita-browser-sidebar-section",children:e.jsx("h2",{children:j.sidebar.title})}),e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:j.sidebar.explore}),L.map(n=>e.jsxs("div",{className:"cogita-sidebar-level",children:[e.jsx("strong",{children:n.label}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[n.options.map(p=>e.jsx("button",{type:"button",className:`ghost ${String(n.value)===p.value?"active":""}`,onClick:()=>n.onSelect(p.value),disabled:n.disabled,children:p.label},`${n.key}:${p.value}`)),n.options.length===0?e.jsx("p",{className:"cogita-sidebar-note",children:j.sidebar.contextEmpty}):null]})]},n.key))]}),e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:j.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:h,children:j.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{E("cogita"),V(!1)},children:j.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:b,children:v?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),ae?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":j.sidebar.closeMenu,onClick:()=>V(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":j.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>V(n=>!n),"aria-label":ae?j.sidebar.closeMenu:j.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),N.map((n,p)=>e.jsxs("div",{className:"cogita-browser-segment",children:[p>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,e.jsx("span",{children:n.label}),e.jsxs("select",{value:n.value,onChange:T=>n.onSelect(T.target.value),disabled:n.disabled,children:[n.emptyOption?e.jsx("option",{value:"",children:n.emptyOption}):null,n.options.map(T=>e.jsx("option",{value:T.value,children:T.label},`${n.key}:${T.value}`))]})]},`menu:${n.key}`))]}),z?e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Hr.Provider,{value:!0,children:z})}):null,z?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:j.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[N.map((n,p)=>e.jsxs("span",{children:[p>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:n.selectedLabel})]},`path:${n.key}`)),de?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:j.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[j.path.currentRoute," ",e.jsx("code",{children:ur(g,se,y,B)})]}),g?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${g}`,children:j.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${g}/list`,children:j.links.allCards}),y?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${g}/collections/${y}/shared-revisions`,children:j.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:j.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:te,onChange:n=>k(n.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:t,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:S,onChange:n=>ye(n.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!g})]}),e.jsx("button",{type:"button",className:"cta",onClick:r,disabled:!g,children:a.cogita.library.collections.createAction}),ge?e.jsx("p",{className:"cogita-form-error",children:ge}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:j.panels.collections}),oe?e.jsx("p",{className:"cogita-library-subtitle",children:j.status.loadingCollections}):null,!oe&&H.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:j.status.noCollections}):null,H.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:H.map(n=>e.jsxs("button",{type:"button",className:`cogita-card-item ${n.collectionId===y?"active":""}`,onClick:()=>{J(n.collectionId),Y("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:j.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:n.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[n.itemCount," ",j.cards.itemsSuffix]})]},n.collectionId))}):null]})]})]})]})})}const Hn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Kn},Symbol.toStringTag,{value:"Module"}));function On({copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,shareId:d}){const[R,f]=i.useState(null),[j,U]=i.useState("loading"),[W,H]=i.useState(a.cogita.library.collections.defaultName),[c,g]=i.useState("Cogita Library"),[x,se]=i.useState([]),[O,y]=i.useState([]),[J,B]=i.useState("idle"),[Y,ae]=i.useState({current:0,total:0}),[V,be]=i.useState(0),[ke,oe]=i.useState(""),[A,ge]=i.useState(null),[o,te]=i.useState(null),[k,S]=i.useState(null),[ye,q]=i.useState(null),[ne,we]=i.useState([]),[Ne,Re]=i.useState({}),[Se,Fe]=i.useState({}),[me,Je]=i.useState(null),[Pe,Ue]=i.useState(null),[ra,Le]=i.useState(null),[ee,Te]=i.useState(null),[qe,Ie]=i.useState({}),de=i.useRef(0),[Ee,Ke]=i.useState(null),Oe=i.useRef(null),Ce=i.useRef(null),[N,L]=i.useState(null),[z,t]=i.useState(!1),[r,n]=i.useState(null),[p,T]=i.useState([]),[Q,Z]=i.useState(null),G=i.useRef(null),re=i.useRef(null),[le,ve]=i.useState(null),[ea,We]=i.useState(0),Ge=i.useRef(null),Be=i.useRef({}),[_e,Ae]=i.useState(!1),[ze,ia]=i.useState({}),ua=i.useRef(null),aa=i.useRef(new Set),ga=i.useRef({}),[Ia,Ka]=i.useState([]),[Ye,la]=i.useState(new Set),[ot,Pa]=i.useState(!1),st=xr(),$a=i.useMemo(()=>new URLSearchParams(st.search),[st.search]),sa=i.useMemo(()=>$a.get("key")??"",[$a]),Oa=(R==null?void 0:R.mode)??"random",Ra=(R==null?void 0:R.check)??"exact",ca=(R==null?void 0:R.limit)??20,He=i.useMemo(()=>wr((R==null?void 0:R.revisionType)??Oa),[R,Oa]),Xe=i.useMemo(()=>{const $=R==null?void 0:R.revisionSettings,s=Zr(He,$a);return Yt(He,$??s)},[R,$a,He]),Aa=i.useMemo(()=>a.cogita.library.revision[He.labelKey]??Oa,[a,Oa,He]),je=i.useMemo(()=>Ra==="exact"?a.cogita.library.revision.checkValue:Ra,[a,Ra]),pe=j==="ready"?x[V]??null:null,ct=(pe==null?void 0:pe.checkType)==="translation-match"&&ee,qa=i.useRef(new Map),Va=i.useRef(new Map),wt=i.useRef(new Map),dt=i.useRef(new Map),Ga=i.useMemo(()=>pe?pe.cardType==="vocab"?a.cogita.library.revision.vocabLabel:pe.infoType?Qe(a,pe.infoType):a.cogita.library.revision.infoLabel:"",[a,pe]),Qt=i.useMemo(()=>{var s;return He.id!=="levels"?x.length:((s=ze.pool)==null?void 0:s.length)??He.getFetchLimit(ca,Xe)},[ze,Xe,He,x.length,ca]),pa=He.getProgressTotal?He.getProgressTotal(x,ze,ca,Xe):He.id==="levels"?Math.min(ca,Qt):x.length,_a=pa?Math.min(V+1,pa):0,wa=Math.max(1,Number(Xe.tries??1)),na=Xe.compare??"anchors",Ta=Math.max(0,Math.min(100,Number(Xe.minCorrectness??0))),da=(Xe.considerDependencies??"on")==="on",fa=Math.max(0,Math.min(100,Number(Xe.dependencyThreshold??85))),Xa=$=>{const s=$.slice();for(let m=s.length-1;m>0;m-=1){const C=Math.floor(Math.random()*(m+1));[s[m],s[C]]=[s[C],s[m]]}return s},Ua=$=>$.length?$.reduce((m,C)=>m+C,0)/$.length/255*100:0,ut=$=>Ua($)>=Ta,Gt=async()=>{const $=await Sa(),s=new Map,m=new Map;$.forEach(I=>{const P=`${I.itemType}:${I.itemId}`,F=Ca(I.itemType,I.itemId,I.checkType,I.direction);s.has(P)||s.set(P,[]),s.get(P).push(I),m.has(F)||m.set(F,[]),m.get(F).push(I)});const C=new Map,_=new Map;return s.forEach((I,P)=>C.set(P,Ma(I).score)),m.forEach((I,P)=>_.set(P,Ma(I).score)),{itemKnowness:C,cardKnowness:_}},gt=async $=>{const s=ze,m=$.concat(s.active??[]).concat(s.pool??[]).filter((ie,he,ce)=>ce.findIndex(xe=>ue(xe)===ue(ie))===he);if(!da){la(new Set(m.map(ue)));return}const{itemKnowness:C,cardKnowness:_}=await Gt(),I=ie=>{if(ie.cardType!=="info"||ie.infoType!=="quote"||ie.checkType!=="quote-fragment")return!0;const he=ma(ie.direction);if(!(he!=null&&he.fragmentId))return!0;const ce=ie.description??"";if(!ce.trim())return!0;const fe=nt(ce).nodes[he.fragmentId];if(!fe||!fe.leftId&&!fe.rightId)return!0;const Me=[fe.leftId,fe.rightId].filter(Ze=>!!Ze);if(Me.length===0)return!0;const $e=Me.map(Ze=>{const ja=Ca("info",ie.cardId,"quote-fragment",jt(he.mode,Ze));return _.get(ja)??0});return $e.reduce((Ze,ja)=>Ze+ja,0)/$e.length>=fa},P=(R==null?void 0:R.collectionId)??null,F=P?Ia.filter(ie=>oa(ie.childItemType)==="collection"&&ie.childItemId===P&&!oa(ie.childCheckType)&&!oa(ie.childDirection)):[],w=P&&m.length>0?m.reduce((ie,he)=>ie+(_.get(ue(he))??0),0)/m.length:0,X=new Set;for(const ie of m){if(ie.cardType!=="info"){X.add(ue(ie));continue}if(!I(ie))continue;const he=Ia.filter(fe=>ni(fe,ie)).concat(F);if(he.length===0){X.add(ue(ie));continue}let ce=0;for(const fe of he)if(oa(fe.parentItemType)==="collection")ce+=fe.parentItemId===P?w:0;else if(oa(fe.parentCheckType)||oa(fe.parentDirection)){const Me=oa(fe.parentCheckType),$e=oa(fe.parentDirection),Ve=Ca(fe.parentItemType,fe.parentItemId,Me,$e);ce+=_.get(Ve)??0}else{const Me=`${fe.parentItemType}:${fe.parentItemId}`;ce+=C.get(Me)??0}ce/he.length>=fa&&X.add(ue(ie))}la(X)},Tt=$=>{for(let s=$;s<x.length;s+=1){const m=x[s];if(m&&(!da||m.cardType!=="info"||Ye.has(ue(m))))return s}return-1},ht=$=>!da||$.cardType!=="info"||Ye.has(ue($)),bt=$=>{if(He.id!=="temporal"&&He.id!=="levels")return null;const s=ze,m=(s.active??[]).concat(s.pool??[]),C=new Set;for(const _ of m){const I=ue(_);if(!(C.has(I)||$.has(I))&&(C.add(I),ht(_)))return _}return null},Na=i.useMemo(()=>{if(He.id!=="levels")return null;const $=ze,s=$.pool??[],m=$.active??[],C=$.levelMap??{},_=Math.max(1,Number(Xe.levels??1)),I=Array.from({length:_},()=>0),P=new Set(m.map(ie=>ue(ie)));s.forEach(ie=>{const he=Math.min(_,Math.max(1,C[ue(ie)]??1));I[he-1]+=1});const F=s.length||1,w=I.map(ie=>ie/F*100),X=pe?C[ue(pe)]??1:null;return{counts:I,percentages:w,currentLevel:X,levelsCount:_,activeCount:m.length,poolCount:s.length,activeSet:P}},[ze,Xe,He,pe]),xa=i.useMemo(()=>{if(He.id!=="temporal")return null;const $=ze,s=$.pool??[],m=$.active??[],C=$.knownessMap??{},_=new Set($.unknownSet??[]);let I=0;s.forEach(w=>{(C[ue(w)]??0)>1&&(I+=1)});const P=_.size,F=m.map(w=>({id:ue(w),value:_.has(ue(w))?0:Math.max(0,Math.min(1,C[ue(w)]??0))}));return{knownCount:I,unknownCount:P,dots:F}},[ze,He]),Za=i.useMemo(()=>{if(!da)return 0;const $=ze;return x.concat($.active??[]).concat($.pool??[]).filter((m,C,_)=>_.findIndex(I=>ue(I)===ue(m))===C).filter(m=>m.cardType==="info"&&!Ye.has(ue(m))).length},[da,ze,x,Ye]);i.useEffect(()=>{if(!da||J!=="ready")return;const $=ze,m=x.concat($.active??[]).concat($.pool??[]).filter((I,P,F)=>F.findIndex(w=>ue(w)===ue(I))===P).filter(I=>I.cardType!=="info"||Ye.has(ue(I))).length,C=G.current;if(G.current=m,C===null||m<=C)return;const _=m-C;Z(`New card available (+${_})`),re.current&&window.clearTimeout(re.current),re.current=window.setTimeout(()=>Z(null),2200)},[da,J,ze,x,Ye]),i.useEffect(()=>()=>{re.current&&window.clearTimeout(re.current)},[]);const va=($,s)=>{const m=He.applyOutcome({queue:x,meta:ze},pe,ca,Xe,{correct:$,correctness:s,createdUtc:new Date().toISOString()});se(m.queue),ia(m.meta);const C=m.queue[V+1];C&&pt(C,V+1)};i.useEffect(()=>{if(!d){U("error");return}U("loading"),Ii({shareId:d,key:sa}).then($=>{f($),H($.collectionName),g($.libraryName),U("ready")}).catch(()=>{U("error")})},[d,sa]),i.useEffect(()=>{d&&Pi({shareId:d,key:sa,type:"language"}).then($=>y($)).catch(()=>y([]))},[d,sa]),i.useEffect(()=>{!d||j!=="ready"||$i({shareId:d,key:sa}).then($=>Ka($.items??[])).catch(()=>Ka([]))},[d,sa,j]),i.useEffect(()=>{if(!d||j!=="ready")return;let $=!0;return(async()=>{B("loading"),ae({current:0,total:He.id==="levels"?0:He.getFetchLimit(ca,Xe)});try{const m=[];let C=null,_=null;do{const he=await Ri({shareId:d,key:sa,limit:300,cursor:C});if(m.push(...he.items),(He.id==="levels"||He.id==="temporal")&&he.total&&(_=he.total),ae(ce=>({current:m.length,total:ce.total||he.total||He.getFetchLimit(ca,Xe)})),C=he.nextCursor??null,_!==null&&m.length>=_||He.id!=="levels"&&He.id!=="temporal"&&m.length>=He.getFetchLimit(ca,Xe))break}while(C);if(!$)return;const I=mr(m);let P;if(He.id==="levels"){const he=Math.max(1,Number(Xe.levels??1));P={},I.forEach(ce=>{const xe=ue(ce);P[xe]=Math.max(1,Math.min(he,1))})}let F=null,w=null,X=null;if(He.id==="temporal"){const he=await Sa(),ce=new Set(I.map(Me=>ue(Me))),xe=he.reduce((Me,$e)=>{const Ve=Ca($e.itemType,$e.itemId,$e.checkType,$e.direction);return ce.has(Ve)&&(Me[Ve]||(Me[Ve]=[]),Me[Ve].push($e)),Me},{});F={},w=new Set,X={};const fe=Date.now();I.forEach(Me=>{const $e=ue(Me),Ve=xe[$e]??[];if(Ve.length===0){F[$e]=0,w.add($e),X[$e]=[];return}const Ze=vr(Ve);X[$e]=Ze;const ja=Ht(Ze,fe);F[$e]=ja.knowness})}const ie=He.id==="levels"?kr(I,ca,Xe,P):He.id==="temporal"?jr(I,ca,Xe,F??{},w??new Set,X??{}):He.prepare(I,ca,Xe);se(ie.queue),ia(ie.meta),be(0),B("ready"),ae(he=>({current:Math.min(he.current,he.total),total:he.total}))}catch{$&&B("error")}})(),()=>{$=!1}},[d,sa,ca,He,Xe,j]),i.useEffect(()=>{gt(x)},[x,Ia,da,fa,R==null?void 0:R.collectionId]),i.useEffect(()=>{if(!pe||!da){Pa(!1);return}if(pe.cardType!=="info"||Ye.has(ue(pe))){Pa(!1);return}const $=Tt(V+1);if($>=0){Pa(!1),be($);return}if(He.id==="temporal"||He.id==="levels"){const s=x.slice(0,V+1),m=x.slice(V+1).filter(ht),C=s.concat(m),_=new Set(C.map(ue)),I=bt(_);if(I){const F=ue(I);_.has(F)||(C.push(I),_.add(F),ia(w=>{const X=w,ie=new Set(X.queued??[]);return ie.add(F),{...X,queued:ie}}))}const P=C.findIndex((F,w)=>w!==V&&ht(F));if(P>=0){se(C),be(P),Pa(!1);return}}Pa(!0)},[pe,Ye,da,V,x,ze,He.id]),i.useEffect(()=>{if(oe(""),ge(null),ve(null),We(0),we([]),Re({}),Fe({}),Je(null),Ue(null),Le(null),t(!1),Ae(!1),L(null),Te(null),Ie({}),!pe){te(null),S(null);return}pe.cardType==="info"&&pe.infoType==="computed"&&te(a.cogita.library.revision.loadingComputed);let $=!0;return pt(pe,V).then(s=>{!$||!s||(te(s.prompt),S(s.expectedAnswer),we(s.computedExpected),Re(s.computedAnswers),Je(s.answerTemplate),Ue(s.outputVariables),Le(s.variableValues))}),()=>{$=!1}},[pe,d,a]),i.useEffect(()=>{if(!pe||pe.cardType!=="info"||pe.infoType!=="quote"){ua.current=null,aa.current=new Set,q(null);return}const $=pe.description??"",s=(pe.label??"").trim(),m=s.replace(/\s+/g," ").trim(),C=$.replace(/\s+/g," ").trim(),_=m&&m!==C?s:a.cogita.library.infoTypes.quote;if(!$){q(null),S(null);return}const I=nt($);ua.current=I,te(_);let P=!0;return Sa().then(F=>{if(!P)return;const w=getQuoteMode(pe.direction),X=new Map;F.forEach(fe=>{if(fe.itemType!=="info"||fe.checkType!=="quote-fragment"||!fe.direction)return;const Me=ma(fe.direction);if(!Me||Me.mode!==w)return;const $e=`${fe.itemId}:${Me.fragmentId}`;X.has($e)||X.set($e,[]),X.get($e).push(fe)});const ie={},he=new Set;X.forEach((fe,Me)=>{const[$e,Ve]=Me.split(":",2);if($e!==pe.cardId)return;const Ze=Ma(fe).score;ie[Ve]=Ze,Ze>=fa&&he.add(Ve)}),aa.current=he,ga.current=ie;const ce=ma(pe.direction);if(ce!=null&&ce.fragmentId&&I.nodes[ce.fragmentId]){Fa(I,ce.fragmentId,_);return}const xe=rt(I,he,ie,fa,da,pe.direction);Fa(I,(xe==null?void 0:xe.id)??null,_)}).catch(()=>{aa.current=new Set,ga.current={};const F=ma(pe.direction);if(F!=null&&F.fragmentId&&I.nodes[F.fragmentId]){Fa(I,F.fragmentId,_);return}const w=rt(I,aa.current,{},fa,da,pe.direction);Fa(I,(w==null?void 0:w.id)??null,_)}),()=>{P=!1}},[pe,a,da,fa]),i.useEffect(()=>{if(!pe||pe.cardType!=="vocab"||pe.checkType!=="translation-match"){Te(null),Ie({});return}const m=(ze.pool??ze.active??x).filter(F=>F.cardType==="vocab"&&F.checkType==="translation-match").filter((F,w,X)=>X.findIndex(ie=>ie.cardId===F.cardId)===w);m.some(F=>F.cardId===pe.cardId)||m.unshift(pe);const _=Xa(m).slice(0,6).map(F=>{const w=F.label.split("↔").map(he=>he.trim()).filter(Boolean);if(w.length<2)return null;const X=`${F.cardId}:L`,ie=`${F.cardId}:R`;return{cardId:F.cardId,leftId:X,rightId:ie,leftLabel:w[0],rightLabel:w[1]}}).filter(Boolean),I=_.map(F=>F.leftId),P=Xa(_.map(F=>F.rightId));Te({pairs:_,leftOrder:I,rightOrder:P,selection:{},activeLeft:null,activeRight:null,locked:{}})},[pe,x,ze]),i.useEffect(()=>()=>{Oe.current&&window.clearTimeout(Oe.current),Ce.current&&window.clearTimeout(Ce.current)},[]);const ha=i.useRef(null);i.useEffect(()=>{if(!pe)return;const $=ue(pe),s=typeof document<"u"?document.activeElement:null;if(ha.current===$&&s&&(s.tagName==="INPUT"||s.tagName==="TEXTAREA"))return;let m=0;const C=()=>{if(pe){if(pe.cardType==="info"&&pe.infoType==="computed"){if(ne.length>0){const I=Vt(me,ne,Pe),P=I?Be.current[I]:null;if(P&&(P.focus(),document.activeElement===P)){ha.current=$;return}}if(Ge.current&&(Ge.current.focus(),document.activeElement===Ge.current)){ha.current=$;return}}else if(pe.cardType==="vocab"&&Ge.current&&(Ge.current.focus(),document.activeElement===Ge.current)){ha.current=$;return}m<6&&(m+=1,window.setTimeout(C,40))}},_=window.setTimeout(C,40);return()=>window.clearTimeout(_)},[pe,ne,me,Pe]),i.useEffect(()=>{if(!_e)return;const $=s=>{s.key==="Enter"&&(s.preventDefault(),et())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[_e]);const Ea=$=>{T($),n(Ma($))};i.useEffect(()=>{if(!pe){n(null),T([]);return}const $=pe.cardType==="info"?"info":"connection";if(pe.cardType==="info"&&pe.infoType==="quote"){Sa().then(s=>{const m=s.filter(C=>C.itemType==="info"&&C.itemId===pe.cardId&&C.checkType==="quote-fragment"&&Ot(C.direction,pe.direction));Ea(m)}).catch(()=>{n(null),T([])});return}Dt($,pe.cardId,pe.checkType,pe.direction).then(s=>Ea(s)).catch(()=>{n(null),T([])})},[pe]);const Wa=($,s,m,C)=>{if($==="info"&&m==="quote-fragment"){Sa().then(_=>{const I=_.filter(P=>P.itemType==="info"&&P.itemId===s&&P.checkType==="quote-fragment"&&Ot(P.direction,C));Ea(I)}).catch(()=>{n(null),T([])});return}Dt($,s,m,C).then(_=>Ea(_)).catch(()=>{n(null),T([])})},mt=($,s,m)=>{var P;const C=((P=m.pairs.find(F=>F.leftId===$))==null?void 0:P.rightId)??null;if(!C)return m;const _=C===s;Ie(F=>({...F,[$]:_?"correct":"incorrect"})),Oe.current&&window.clearTimeout(Oe.current),Ce.current&&window.clearTimeout(Ce.current),de.current+=1;const I={kind:_?"correct":"incorrect",tick:de.current};if(Ke(null),Oe.current=window.setTimeout(()=>Ke(I),0),Ce.current=window.setTimeout(()=>Ke(null),420),_){const F={...m.locked,[$]:!0};return Object.keys(F).length>=m.pairs.length?(ge("correct"),Ae(!0)):ge("correct"),{...m,selection:{...m.selection,[$]:s},activeLeft:null,activeRight:null,locked:F}}return ge("incorrect"),{...m,activeLeft:null,activeRight:null}},Nt=$=>{Te(s=>!s||s.locked[$]?s:s.activeRight?mt($,s.activeRight,s):{...s,activeLeft:s.activeLeft===$?null:$})},Xt=$=>{Te(s=>s&&(s.activeLeft?mt(s.activeLeft,$,s):{...s,activeRight:s.activeRight===$?null:$}))},et=()=>{var $;if(pe&&pe.cardType==="info"&&pe.infoType==="quote"&&ua.current&&ye&&!(($=ma(pe.direction))!=null&&$.fragmentId)){const s=rt(ua.current,aa.current,ga.current,fa,da,pe.direction,ye.fragmentId);if(s){ge(null),oe(""),t(!1),Fe({}),Ae(!1),ve(null),We(0),Fa(ua.current,s.id,ye.title);return}}ge(null),oe(""),t(!1),Fe({}),Ae(!1),ve(null),We(0),be(s=>Math.min(s+1,x.length))},ya=$=>{if(!pe)return;const s=$.expected??null,m=$.answer??"";let C=s??"",_=m;if(!s&&$.expectedMap&&$.answerMap){const he=Object.keys($.expectedMap).sort((ce,xe)=>ce.localeCompare(xe));C=he.map(ce=>{var xe;return((xe=$.expectedMap)==null?void 0:xe[ce])??""}).join("|"),_=he.map(ce=>{var xe;return((xe=$.answerMap)==null?void 0:xe[ce])??""}).join("|")}const I=C?it(C,_,na):new Uint8Array,P={revisionType:He.id,evalType:$.evalType,direction:$.direction,prompt:o??"",expected:s,answer:m,expectedAnswers:$.expectedMap??null,answers:$.answerMap??null,correct:$.correct,maskBase64:I.length?Ba(I):null,checkMode:Ra,compareMode:na,minCorrectness:Ta},F=new TextEncoder().encode(JSON.stringify(P)),w=pe.cardType==="info"?"info":"connection",X=$.overrideCheckType??pe.checkType??null,ie=$.overrideDirection??pe.direction??null;Bt({itemType:w,itemId:pe.cardId,checkType:X,direction:ie,revisionType:He.id,evalType:$.evalType,correct:$.correct,maskBase64:I.length?Ba(I):null,payloadBase64:Ba(F)}).then(()=>{Wa(w,pe.cardId,X,ie),gt(x)}).catch(()=>{})},La=($,s)=>{const m=qa.current.get(s);if(m)return Promise.resolve(m);const C=Va.current.get(s);if(C)return C;const _=Ei({shareCode:d,infoId:$,key:sa}).then(I=>{var he,ce;const P=I.payload,F=((he=P.definition)==null?void 0:he.graph)??null,w="",X=((ce=P.definition)==null?void 0:ce.answerTemplate)??"",ie=yr(F,w,X);if(ie){const fe={sample:Yr(ie),answerTemplate:X||null};return qa.current.set(s,fe),fe}return Lr({shareId:d,infoId:$,key:sa}).then(xe=>{const fe={sample:xe,answerTemplate:null};return qa.current.set(s,fe),fe})}).catch(()=>Lr({shareId:d,infoId:$,key:sa}).then(I=>{const P={sample:I,answerTemplate:null};return qa.current.set(s,P),P}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Va.current.delete(s)});return Va.current.set(s,_),_},pt=($,s)=>{var F;const m=`${ue($)}:${s}`,C=wt.current.get(m);if(C)return Promise.resolve(C);const _=dt.current.get(m);if(_)return _;const I=w=>(wt.current.set(m,w),w);let P;if($.cardType==="vocab"){if($.checkType==="translation-match")return P=Promise.resolve(I({prompt:$.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),P;const w=$.label.split("↔").map(X=>X.trim()).filter(Boolean);if(w.length>=2){const ie=($.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",he=ie?w[0]:w[1],ce=ie?w[1]:w[0];P=Promise.resolve(I({prompt:he,expectedAnswer:ce,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else P=Promise.resolve(I({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if($.cardType==="info"&&$.infoType==="word"){const w=(F=$.description)!=null&&F.startsWith("Language: ")?$.description.replace("Language: ",""):null;P=Promise.resolve(I({prompt:$.label,expectedAnswer:w,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else $.cardType==="info"&&$.infoType==="computed"?P=La($.cardId,m).then(w=>{var xe,fe;if(!w.sample)return I({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const X=w.sample,ie=X.expectedAnswers?Object.entries(X.expectedAnswers).map(([Me,$e])=>({key:Me,expected:$e})):[],he=ie.reduce((Me,$e)=>(Me[$e.key]="",Me),{}),ce=X.expectedAnswerIsSentence&&((xe=X.expectedAnswer)==null?void 0:xe.trim())||null;return I({prompt:X.prompt,expectedAnswer:ie.length>0?ce:((fe=X.expectedAnswer)==null?void 0:fe.trim())||null,computedExpected:ie,computedAnswers:he,answerTemplate:w.answerTemplate,outputVariables:X.outputVariables??null,variableValues:X.variableValues??null})}).catch(()=>I({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{dt.current.delete(m)}):P=Promise.resolve(I({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return dt.current.set(m,P),P},Fa=($,s,m)=>{const C=Object.keys($.nodes).length,_=aa.current.size;if(!s){q({title:m,before:$.text,after:"",fragmentId:null,total:C,completed:_}),S(null),Ae(!0);return}const I=$.nodes[s];if(!I)return;const P=Qr($.text,I);q({title:m,before:P.before,after:P.after,fragmentId:I.id,total:C,completed:_}),S(P.fragment),Ae(!1)},za=()=>{const $=ua.current;$&&q(s=>s&&{...s,total:Object.keys($.nodes).length,completed:aa.current.size})},at=()=>{const $=x[V+1];$&&pt($,V+1)},Ha=()=>{if(at(),pe&&pe.cardType==="vocab"&&pe.checkType==="translation-match"&&ee){if(ee.pairs.length===0){ge("incorrect"),Ae(!0);return}const I=ee.pairs.reduce((ce,xe)=>(ce[xe.rightId]=xe.rightLabel,ce),{});let P=0;const F={};ee.pairs.forEach(ce=>{const fe=ee.selection[ce.leftId]===ce.rightId;F[ce.leftId]=fe?"correct":"incorrect",fe&&(P+=1)});const w=ee.pairs.length||1,X=P/w,ie=P===ee.pairs.length;Ie(ce=>({...ce,...F})),ie?(ge("correct"),Ae(!0),We(0)):(ge("incorrect"),Ae(!1),We(ce=>{const xe=ce+1;return xe>=wa&&(t(!0),Ae(!0),Te(fe=>{if(!fe)return fe;const Me=fe.pairs.reduce(($e,Ve)=>($e[Ve.leftId]=Ve.rightId,$e),{});return{...fe,selection:Me}})),xe})),va(ie,X);const he="connection";Promise.all(ee.pairs.map(ce=>{const xe=ee.selection[ce.leftId]??null,fe=xe?I[xe]:"",Me={left:ce.leftLabel,expected:ce.rightLabel,answer:fe,checkType:"translation-match"},$e=new TextEncoder().encode(JSON.stringify(Me));return Bt({itemType:he,itemId:ce.cardId,checkType:"translation-match",direction:null,revisionType:He.id,evalType:"translation-match",correct:xe===ce.rightId,maskBase64:null,payloadBase64:Ba($e)})})).then(()=>{Wa(he,pe.cardId,pe.checkType,pe.direction),gt(x)}).catch(()=>{});return}if(ne.length>0){const I=ne.reduce((F,w)=>{const X=Ne[w.key]??"";return F[w.key]=ba(X)===ba(w.expected)?"correct":"incorrect",F},{});ne.every(({key:F,expected:w})=>{const X=Ne[F]??"";return Ra==="exact"&&ba(X)===ba(w)})?(ge("correct"),Fe(I),Ae(!0),We(0),va(!0,1),ya({correct:!0,direction:o?`${o} -> computed`:"computed",expectedMap:ne.reduce((F,w)=>(F[w.key]=w.expected,F),{}),answerMap:Ne,evalType:"computed"})):(ge("incorrect"),Fe(I),Ae(!1),We(F=>{const w=F+1;return w>=wa&&Ja&&(t(!0),Ae(!0)),w}),va(!1,0),window.setTimeout(()=>{var w;const F=Vt(me,ne,Pe);F&&Be.current[F]&&((w=Be.current[F])==null||w.focus())},40),ya({correct:!1,direction:o?`${o} -> computed`:"computed",expectedMap:ne.reduce((F,w)=>(F[w.key]=w.expected,F),{}),answerMap:Ne,evalType:"computed"}));return}if(pe&&pe.cardType==="info"&&pe.infoType==="quote"&&(ye!=null&&ye.fragmentId)){if(!k)return;const I=ma(pe.direction),P=(I==null?void 0:I.mode)??getQuoteMode(pe.direction),F=I!=null&&I.fragmentId&&pe.direction?pe.direction:jt(P,ye.fragmentId),w=ii(k,ke,na),X=Ra==="exact"&&lt(ke)===lt(k),ie=ut(w),he=X||ie,ce=Ua(w);he?(ga.current[ye.fragmentId]=Math.max(ga.current[ye.fragmentId]??0,ce),(ga.current[ye.fragmentId]??0)>=fa&&aa.current.add(ye.fragmentId),za(),ge("correct"),Fe({}),Ae(!0),ve(w),We(0),ce<100&&wa<=1&&t(!0),va(!0,ce/100),ya({correct:!0,direction:`quote:${ye.fragmentId}`,expected:k,answer:ke,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:F})):(ge("incorrect"),Fe({}),Ae(!1),ve(w),We(xe=>{const fe=xe+1;return fe>=wa&&Ja&&(t(!0),Ae(!0)),fe}),va(!1,ce/100),window.setTimeout(()=>{var xe;return(xe=Ge.current)==null?void 0:xe.focus()},40),ya({correct:!1,direction:`quote:${ye.fragmentId}`,expected:k,answer:ke,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:F}));return}if(!k)return;const $=it(k,ke,na),s=Ra==="exact"&&ba(ke)===ba(k),m=ut($),C=s||m,_=Ua($);C?(ge("correct"),Fe({}),Ae(!0),ve($),We(0),_<100&&wa<=1&&t(!0),va(!0,_/100),ya({correct:!0,direction:o?`${o} -> ${k}`:null,expected:k,answer:ke,evalType:"text"})):(ge("incorrect"),Fe({}),Ae(!1),ve($),We(I=>{const P=I+1;return P>=wa&&Ja&&(t(!0),Ae(!0)),P}),va(!1,_/100),window.setTimeout(()=>{var I;return(I=Ge.current)==null?void 0:I.focus()},40),ya({correct:!1,direction:o?`${o} -> ${k}`:null,expected:k,answer:ke,evalType:"text"}))},Lt=$=>{if(at(),!k)return;const s=it(k,$,na),m=ba($)===ba(k),C=ut(s),_=m||C,I=Ua(s);_?(ge("correct"),Fe({}),Ae(!0),ve(s),We(0),I<100&&wa<=1&&t(!0),va(!0,I/100),ya({correct:!0,direction:"word->language",expected:k,answer:$,evalType:"language-select"})):(ge("incorrect"),Fe({}),Ae(!1),ve(s),We(P=>{const F=P+1;return F>=wa&&Ja&&(t(!0),Ae(!0)),F}),va(!1,I/100),ya({correct:!1,direction:"word->language",expected:k,answer:$,evalType:"language-select"}))},Zt=$=>{var m;if($.key!=="Enter")return;if($.preventDefault(),$.stopPropagation(),_e){et();return}const s=ne.find(C=>!(Ne[C.key]??"").trim());if(s){(m=Be.current[s.key])==null||m.focus();return}Ha()},er=()=>{at(),ge("correct"),Ae(!0),We(0),va(!0,1),k&&ya({correct:!0,direction:"manual",expected:k,answer:ke,evalType:"manual"})},ar=()=>{if(va(!1,0),pe&&pe.cardType==="info"&&pe.infoType==="quote"){ge(null),oe(""),t(!1),Fe({}),Ae(!1),ve(null),We(0),be($=>Math.min($+1,x.length));return}et()};i.useEffect(()=>{at()},[V,x]);const tr=a.cogita.library.revision.revealModeAfterIncorrect,Ja=ne.length>0||!!k;return e.jsxs(ka,{copy:a,authLabel:l,showProfileMenu:u,onProfileNavigate:h,onToggleSecureMode:b,onLogout:M,secureMode:v,onNavigate:E,language:D,onLanguageChange:K,children:[(j==="loading"||J==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:j==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${Y.total?Math.min(100,Math.max(0,Y.current/Y.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:Y.total?`${Math.min(Y.current,Y.total)} / ${Y.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:W}),e.jsx("p",{className:"cogita-library-subtitle",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",Aa).replace("{check}",je)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Na?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Na.currentLevel??"-"," / ",Na.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ai,{outcomes:p})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Q?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Q})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":Ee?`${Ee.kind}-${Ee.tick}`:ct?"idle":A??"idle",children:j!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:j==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):pe?e.jsx(e.Fragment,{children:ot?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ei,{copy:a,currentCard:pe,currentTypeLabel:Ga,prompt:o,languages:O,answer:ke,onAnswerChange:$=>oe(s=>qt(s,$,N)),computedExpected:ne,computedAnswers:Ne,onComputedAnswerChange:($,s)=>Re(m=>({...m,[$]:qt(m[$]??"",s,N)})),answerTemplate:me,outputVariables:Pe,variableValues:ra,computedFieldFeedback:Se,feedback:A,canAdvance:_e,quoteContext:ye,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ha,onSkip:ar,onLanguageSelect:Lt,onMarkReviewed:er,onAdvance:et,showCorrectAnswer:z,setShowCorrectAnswer:t,onRevealCorrect:()=>Ae(!0),answerMask:le,expectedAnswer:k,hasExpectedAnswer:Ja,handleComputedKeyDown:Zt,answerInputRef:Ge,computedInputRefs:Be,scriptMode:N,setScriptMode:L,matchPairs:ee==null?void 0:ee.pairs,matchLeftOrder:ee==null?void 0:ee.leftOrder,matchRightOrder:ee==null?void 0:ee.rightOrder,matchSelection:ee==null?void 0:ee.selection,matchActiveLeft:ee==null?void 0:ee.activeLeft,matchActiveRight:ee==null?void 0:ee.activeRight,matchFeedback:qe,onMatchLeftSelect:Nt,onMatchRightSelect:Xt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:pa?`${_a} / ${pa}`:a.cogita.library.revision.progressUnlimited}),j==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),j==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),j==="ready"&&J==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),j==="ready"&&J==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),j==="ready"&&J==="ready"&&x.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:tr}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",wa]})]})]}),Na?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Na.activeCount," / ",Na.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Na.counts.map(($,s)=>{const m=s+1,C=Na.currentLevel===m,_=Na.percentages[s]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":C,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:m}),e.jsx("strong",{children:$})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,_))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[_.toFixed(1),"%"]})]},`level-${m}`)})})]}):null,xa?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:xa.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:xa.dots.map($=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-$.value))}, ${Math.round(200*$.value)}, 80, 0.9)`}},$.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:xa.knownCount})]})]}):null,da?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Za})]})}):null]})]})]})})})]})]})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:On},Symbol.toStringTag,{value:"Module"}));export{zn as C,Hn as a,Jn as b};
