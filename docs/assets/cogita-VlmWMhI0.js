import{r as a,j as e,u as dn,a as Ba,b as Bn,c as Vn,d as On,R as un,B as hn,C as gn}from"./vendor-CL5v9b84.js";import{L as Rs,A as As,g as Es,a as nr,b as za,c as qn,s as as,d as Un,e as sr,f as kn,h as ua,i as rr,j as ir,k as Ga,l as Ya,m as Ps,n as Jn,o as zn,p as or,u as ns,q as Ks,r as lr,t as cr,v as dr,w as ur,x as hr,y as Fs,z as gr,B as Ds,C as zs,D as mr,E as pr,F as mn,G as Xa,H as fr,I as _s,J as br,K as Bs,M as Vs,N as yr,O as xr,P as vr,Q as ss,R as ba,S as wr,T as jr,U as kr,V as Nr,W as Sr,X as Tr,Y as Cr,Z as Ir,_ as Mr,$ as Lr,a0 as $r,a1 as Rr,a2 as Ar,a3 as rs}from"./recreatio-core-Ydb8QFim.js";import"./vendor-cogita-ui-mbCyoqV0.js";const Ka={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},Aa={moveMs:900,pauseMs:220,errorMs:900},Er=(t=11)=>{let n=t;const s=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:i,height:o,paddingX:u,paddingY:h,levels:j}=Ka,v=(o-h*2)/(j.length-1),S=[],l=[],f=[];j.forEach((b,m)=>{const ae=o-h-m*v,_=i-u*2,y=[];for(let O=0;O<b;O+=1){const k=u+(O+1)*_/(b+1),Y=(s()-.5)*18,K=Math.max(u,Math.min(i-u,k+Y)),L=m===0?3:m<2?2.1:1.4,le=m===0?"root":`l${m}-${O}`;y.push({id:le,x:m===0?i/2:K,y:ae,r:L,level:m,role:m===0?"root":void 0})}f.push(y),S.push(...y)});const c=f[f.length-1];if(c!=null&&c.length){const b=c[Math.floor(c.length/2)];b.role="goal",b.r=2}for(let b=1;b<f.length;b+=1){const m=f[b-1];f[b].forEach(_=>{const y=[...m].sort((K,L)=>Math.abs(K.x-_.x)-Math.abs(L.x-_.x)),O=y[0],k=y[1]&&s()<.45?y[1]:null;(k?[O,k]:[O]).forEach(K=>{l.push({from:K.id,to:_.id,key:`${K.id}-${_.id}`})}),s()<.2&&y[2]&&l.push({from:y[2].id,to:_.id,key:`${y[2].id}-${_.id}`})})}const d=new Map;l.forEach(b=>{const m=d.get(b.to)??[];m.push(b.from),d.set(b.to,m)});const w=new Map,p=new Map,C=new Map;l.forEach(b=>{const m=w.get(b.from)??[];m.push(b.key),w.set(b.from,m);const ae=p.get(b.from)??[];ae.push(b.to),p.set(b.from,ae);const _=C.get(b.from)??[];_.push(b.to),C.set(b.from,_);const y=C.get(b.to)??[];y.push(b.from),C.set(b.to,y)});const z=new Map;return S.forEach(b=>{z.set(b.id,b)}),{nodes:S,links:l,parentsById:d,linksByFrom:w,childrenByFrom:p,neighborsById:C,nodesById:z}};function Pr({slides:t,activeIndex:n,introOpen:s,prefersReducedMotion:i,onNext:o,onPrev:u,onSelect:h,onExit:j,onOpen:v,onRegister:S}){const l=n===t.length-1,f=s&&n===0?"entry":"docked",c=t[t.length-1],[d,w]=a.useState(!1),p=a.useMemo(()=>Array.from({length:20},(R,M)=>({src:`/cogita/logo/Cogita${String(M).padStart(2,"0")}.png`,kind:M<=11?"bubble":M<=17?"text":"recreatio"})),[]),C=s&&n===0;a.useEffect(()=>{if(!s){w(!1);return}n>0&&!d&&w(!0)},[n,s,d]);const z=a.useRef(0),b=a.useRef(null),m=a.useMemo(()=>{const R={x:40,y:160},M={x:260,y:48},x=6,N=M.x-R.x,I=R.y-M.y,F=N/x,V=[.3,.45,.6,.65,1.4,2.2],q=V.reduce((J,W)=>J+W,0),me=V.map(J=>I*J/q),ie=[R];let se=R.x,oe=R.y;for(let J=1;J<=x;J+=1){const W=(Math.random()-.5)*14,$e=(Math.random()-.5)*28;se=Math.max(R.x+J*14,Math.min(M.x-(x-J)*14,se+F+W));const Me=me[J-1]??me[me.length-1];oe=oe-Me+$e;const Ie=Math.max(M.y,Math.min(R.y-4,oe));ie.push({x:Math.round(se),y:Math.round(Ie)})}return ie[ie.length-1]=M,ie},[]),ae=a.useMemo(()=>{const I=(q,me,ie)=>Math.min(ie,Math.max(me,q)),F=m.map(q=>{const me=10+Math.random()*36;return{x:I(q.x,40,260),y:I(q.y-me,40,140)}}),V=m.map((q,me)=>{var oe;const ie=12+Math.random()*40,se=((oe=F[me])==null?void 0:oe.y)??q.y;return{x:I(q.x,40,260),y:I(Math.max(se+10,q.y+ie),60,170)}});return{upper:F,lower:V}},[m]),_=a.useMemo(()=>{var M;const R=((M=m[4])==null?void 0:M.x)??260;return Math.max(0,Math.min(240,R-40))},[m]),y=a.useMemo(()=>{var me,ie;const R=(se,oe,J)=>Math.min(J,Math.max(oe,se)),M=(se,oe,J)=>m.map((W,$e)=>{var Nt,xt;const Me=((Nt=ae.upper[$e])==null?void 0:Nt.y)??W.y,Ie=((xt=ae.lower[$e])==null?void 0:xt.y)??W.y,nt=(Math.random()-.5)*70,ht=W.y+se+nt,Ye=R(W.y+oe,Me+6,Ie-6),Qe=R(W.y+J,Me+6,Ie-6);return{x:W.x,y:R(ht,Math.min(Ye,Qe),Math.max(Ye,Qe))}}),x=-14+Math.random()*28,N=14+Math.random()*28,I=M(x,-80,12),F=M(N,-12,80);for(let se=4;se<m.length;se+=1){const oe=m[se],J=((me=ae.upper[se])==null?void 0:me.y)??oe.y,W=((ie=ae.lower[se])==null?void 0:ie.y)??oe.y;I[se]={x:oe.x,y:R(oe.y-12,J+6,W-6)},F[se]={x:oe.x,y:R(oe.y+12,J+6,W-6)}}const V=ae.upper.length?ae.upper[ae.upper.length-1].y:40,q=ae.lower.length?ae.lower[ae.lower.length-1].y:170;return I[I.length-1]={x:m[m.length-1].x,y:R(m[m.length-1].y-14,V,q)},F[F.length-1]={x:m[m.length-1].x,y:R(m[m.length-1].y+12,V,q)},{higher:I,lower:F}},[m,ae]),O=1e4,k=a.useMemo(()=>{let R=17;const M=()=>(R=(R*1664525+1013904223)%4294967296,R/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((N,I)=>{const F=(M()-.5)*240,V=(M()-.5)*180,q=(M()-.5)*24;return{id:`card-${I+1}`,throw:{x:`${F.toFixed(0)}px`,y:`${V.toFixed(0)}px`,rot:`${q.toFixed(1)}deg`},grid:{x:`${N.x}px`,y:`${N.y}px`},delay:`${I*.12}s`}})},[]),Y=a.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[K,L]=a.useState([]),le=a.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),ge=a.useMemo(()=>{const M=[],N=(F,V)=>F+Math.random()*(V-F);for(let F=0;F<6;F+=1){let V=!1;for(let q=0;q<80;q+=1){const me=N(14,86),ie=N(10,34);if(M.every(oe=>{const J=oe.x-me,W=oe.y-ie;return Math.hypot(J,W)>=12})){M.push({x:me,y:ie}),V=!0;break}}V||M.push({x:N(16,84),y:N(12,32)})}return M.map((F,V)=>({id:`p${V+1}`,x:`${F.x.toFixed(1)}%`,y:`${F.y.toFixed(1)}%`,xNum:F.x,yNum:F.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[je,Oe]=a.useState(0),[ue,$]=a.useState(0),[pe,U]=a.useState([]),ce=1e4,G=a.useMemo(()=>{if(ge.length<2)return[];const R=V=>{let q=V+1831565813;return q=Math.imul(q^q>>>15,q|1),q^=q+Math.imul(q^q>>>7,q|61),((q^q>>>14)>>>0)/4294967296},M=(V,q)=>Math.floor(R(V)*q),x=new Set,N=[],I=Math.min(3,ge.length);let F=0;for(;N.length<I&&F<30;){F+=1;const V=M(je*13+F*5,ge.length),q=M(je*29+F*7,ge.length);if(V===q)continue;const me=V<q?`${V}-${q}`:`${q}-${V}`;x.has(me)||(x.add(me),N.push({id:`link-${me}`,from:ge[V],to:ge[q],delay:`${(F*.35).toFixed(2)}s`}))}return N},[je,ge]);a.useEffect(()=>{if(!s||n!==2)return;const R=()=>{const x=k.map(N=>N.id);for(let N=x.length-1;N>0;N-=1){const I=Math.floor(Math.random()*(N+1));[x[N],x[I]]=[x[I],x[N]]}return x.slice(0,4)};L(R());const M=window.setInterval(()=>{L(R())},O);return()=>window.clearInterval(M)},[n,s,k,O]),a.useEffect(()=>{if(!s||n!==3)return;const R=()=>{$(Math.floor(Math.random()*le.length)),U(ge.map(()=>Math.random()<.6?"good":"bad")),Oe(x=>x+1)};R();const M=window.setInterval(R,ce);return()=>window.clearInterval(M)},[n,s,le.length,ge,ce]);const xe=a.useMemo(()=>Er(11),[]),[re,te]=a.useState(new Set(["root"])),[Se,Re]=a.useState(new Set),[Pe,Le]=a.useState(new Set),[Ge,it]=a.useState({fromId:"root",toId:"root",key:0}),ke=a.useRef(re),Ue=a.useRef("root"),gt=a.useRef(0),We=a.useRef(null),Be=a.useRef(null),et=a.useRef([]);a.useEffect(()=>{ke.current=re},[re]);const rt=a.useMemo(()=>{const R=new Set;return re.forEach(M=>{const x=xe.linksByFrom.get(M);x&&x.forEach(N=>R.add(N))}),R},[re,xe]),qe=xe.nodesById.get(Ge.toId)??xe.nodesById.get("root"),Ne=qe?`${qe.x/Ka.width*100}%`:"50%",Te=qe?`${qe.y/Ka.height*100}%`:"90%";a.useEffect(()=>{if(!s||n!==1||i)return;(()=>{te(new Set(["root"])),Re(new Set),Le(new Set),it({fromId:"root",toId:"root",key:0}),Be.current=null,gt.current=0,Ue.current="root",et.current=[]})();const M=()=>{const N=Ue.current,I=ke.current,V=(xe.childrenByFrom.get(N)??[]).filter(W=>!I.has(W));if(V.length)return V[Math.floor(Math.random()*V.length)];if(I.size>=xe.nodes.length){const W=xe.neighborsById.get(N)??[];return W.length?W[Math.floor(Math.random()*W.length)]:null}const q=W=>(xe.childrenByFrom.get(W)??[]).some(Me=>!I.has(Me)),me=[N],ie=new Set([N]),se=new Map;let oe=null;for(;me.length;){const W=me.shift();if(!W)break;if(W!==N&&q(W)){oe=W;break}(xe.neighborsById.get(W)??[]).forEach(Me=>{ie.has(Me)||(ie.add(Me),se.set(Me,W),me.push(Me))})}if(!oe)return null;let J=oe;for(;se.get(J)&&se.get(J)!==N;)J=se.get(J)??J;return J},x=(N,I)=>{if(N===I){const F=M();F&&x(N,F);return}gt.current+=1,it({fromId:N,toId:I,key:gt.current}),Ue.current=I,We.current=window.setTimeout(()=>{const F=xe.parentsById.get(I)??[],V=ke.current,q=F.filter(oe=>!V.has(oe));if(!q.length){const oe=new Set(V);oe.add(I),te(oe),We.current=window.setTimeout(()=>{for(;et.current.length;){const W=et.current[et.current.length-1];if(!oe.has(W)){if(W!==I){x(I,W);return}break}et.current.pop()}const J=M();J&&x(I,J)},Aa.pauseMs);return}const me=new Set([I,...q]),ie=new Set(q.map(oe=>`${oe}-${I}`));Re(me),Le(ie),et.current.includes(I)||et.current.push(I);const se=q[Math.floor(Math.random()*q.length)];Be.current={fromId:I,toId:se},We.current=window.setTimeout(()=>{Re(new Set),Le(new Set);const oe=Be.current;oe&&x(oe.fromId,oe.toId)},Aa.errorMs)},Aa.moveMs)};return We.current=window.setTimeout(()=>{const N=M();N&&x(Ue.current,N)},Aa.pauseMs),()=>{We.current&&window.clearTimeout(We.current)}},[n,s,xe,i]);const ze=R=>{if(!s)return;const M=Date.now();M-z.current<520||Math.abs(R.deltaY)<10||(z.current=M,R.deltaY>0?o():u(),R.preventDefault())},B=R=>{if(!s)return;const M=R.touches[0];M&&(b.current={x:M.clientX,y:M.clientY})},E=R=>{if(!s)return;const M=b.current;if(b.current=null,!M)return;const x=R.changedTouches[0];if(!x)return;const N=x.clientX-M.x,I=x.clientY-M.y;Math.abs(I)<40||Math.abs(I)<Math.abs(N)||(I<0?o():u())};return e.jsxs("div",{className:`cogita-intro ${s?"is-open":"is-closed"} ${i?"is-reduced":""} ${l?"is-final":""}`,"data-slide":n+1,onWheel:ze,onTouchStart:B,onTouchEnd:E,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":f,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${C&&!d?"is-entry":""}`,children:p.map((R,M)=>e.jsx("img",{src:R.src,alt:"",className:`cogita-logo-layer ${M===0?"is-base":""} ${R.kind==="text"?"is-text":R.kind==="recreatio"?"is-recreatio":""} ${R.kind==="bubble"?"is-bubble":""}`},R.src))})}),s&&t.map((R,M)=>{const x=M===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${M+1} ${x?"is-active":""}`,"aria-hidden":!x,children:[e.jsxs("div",{className:"cogita-intro-text",children:[R.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:R.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:R.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:R.title}),R.body&&e.jsx("p",{children:R.body.split(`
`).map((N,I)=>e.jsxs("span",{children:[N,I===0&&e.jsx("br",{})]},String(I)))})]}),R.micro&&e.jsx("p",{className:"cogita-intro-micro",children:R.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:l?S:o,children:R.cta}),l&&R.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>h(0),children:R.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[M===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${Ka.width} ${Ka.height}`,preserveAspectRatio:"none",children:[xe.links.map(N=>{const I=xe.nodesById.get(N.from),F=xe.nodesById.get(N.to);if(!I||!F)return null;const V=rt.has(N.key),q=Pe.has(N.key);return e.jsx("line",{className:`map-link ${V?"is-active":""} ${q?"is-error":""}`,x1:I.x,y1:I.y,x2:F.x,y2:F.y},N.key)}),xe.nodes.map(N=>{const I=re.has(N.id),F=Se.has(N.id);return e.jsx("circle",{className:`map-node ${N.role?`is-${N.role}`:""} ${I?"is-active":""} ${F?"is-error":""}`,cx:N.x,cy:N.y,r:N.r},N.id)})]}),qe&&e.jsx("span",{className:"map-explorer-dot",style:{left:Ne,top:Te,"--move":`${Aa.moveMs}ms`}})]}),M===2&&e.jsx("div",{className:"cogita-index-cards",children:k.map(N=>{const I=K.indexOf(N.id),F=I>=0?Y[I]:null,V=(F==null?void 0:F.x)??"140px",q=(F==null?void 0:F.y)??"140px",me=I>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":N.throw.x,"--throw-y":N.throw.y,"--throw-rot":N.throw.rot,"--grid-x":N.grid.x,"--grid-y":N.grid.y,"--stack-x":V,"--stack-y":q,"--stack-opacity":me,"--delay":N.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},N.id)})}),M===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[le.map((N,I)=>e.jsxs("div",{className:`round-card ${I===ue?"is-active":""}`,style:{"--card-x":N.x,"--card-y":N.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},N.id)),le[ue]&&e.jsx("span",{className:"round-ring",style:{"--card-x":le[ue].x,"--card-y":`calc(${le[ue].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:ge.map(N=>e.jsx("span",{className:"player-dot",style:{left:N.x,top:N.y,"--jitter-x":N.jitterX,"--jitter-y":N.jitterY,"--breath-delay":N.delay}},N.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:G.map(N=>e.jsx("line",{className:"round-link",x1:N.from.xNum,y1:N.from.yNum,x2:N.to.xNum,y2:N.to.yNum,style:{"--delay":N.delay}},N.id))}),e.jsx("div",{className:"round-flows",children:ge.map((N,I)=>{const F=pe[I]??"good",V=le[ue];if(!V)return null;const q=`calc(${V.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":N.x,"--from-y":N.y,"--to-x":V.x,"--to-y":q,"--delay":`${I*.12}s`}}),e.jsx("span",{className:`return-dot is-${F}`,style:{"--from-x":V.x,"--from-y":q,"--to-x":N.x,"--to-y":N.y,"--delay":`${I*.12}s`}}),e.jsx("span",{className:`result-pop is-${F}`,style:{"--at-x":N.x,"--at-y":N.y,"--delay":`${I*.12}s`}})]},`${N.id}-${je}`)})})]},`round-${je}`),M===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${m[0].x} ${m[0].y} L${m[1].x} ${m[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${m[1].x} ${m[1].y} L${m[2].x} ${m[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${m[2].x} ${m[2].y} L${m[3].x} ${m[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${m[3].x} ${m[3].y} L${m[4].x} ${m[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${m[4].x} ${m[4].y} L${m[5].x} ${m[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${m[5].x} ${m[5].y} L${m[6].x} ${m[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${_};${_};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${ae.upper.map((N,I)=>`${I===0?"M":"L"}${N.x} ${N.y}`).join(" ")} ${ae.lower.slice().reverse().map(N=>`L${N.x} ${N.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${ae.upper.map((N,I)=>`${I===0?"M":"L"}${N.x} ${N.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${ae.lower.map((N,I)=>`${I===0?"M":"L"}${N.x} ${N.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[y.higher.slice(0,6).map((N,I)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${I+1}`,d:`M${N.x} ${N.y} L${y.higher[I+1].x} ${y.higher[I+1].y}`,pathLength:"100"},`peer-1-${I}`)),y.lower.slice(0,6).map((N,I)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${I+1}`,d:`M${N.x} ${N.y} L${y.lower[I+1].x} ${y.lower[I+1].y}`,pathLength:"100"},`peer-2-${I}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${m[0].x/300*100}%`,"--p0y":`${m[0].y/200*100}%`,"--p1x":`${m[1].x/300*100}%`,"--p1y":`${m[1].y/200*100}%`,"--p2x":`${m[2].x/300*100}%`,"--p2y":`${m[2].y/200*100}%`,"--p3x":`${m[3].x/300*100}%`,"--p3y":`${m[3].y/200*100}%`,"--p4x":`${m[4].x/300*100}%`,"--p4y":`${m[4].y/200*100}%`,"--p5x":`${m[5].x/300*100}%`,"--p5y":`${m[5].y/200*100}%`,"--p6x":`${m[6].x/300*100}%`,"--p6y":`${m[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${y.higher[0].x/300*100}%`,"--q0y":`${y.higher[0].y/200*100}%`,"--q1x":`${y.higher[1].x/300*100}%`,"--q1y":`${y.higher[1].y/200*100}%`,"--q2x":`${y.higher[2].x/300*100}%`,"--q2y":`${y.higher[2].y/200*100}%`,"--q3x":`${y.higher[3].x/300*100}%`,"--q3y":`${y.higher[3].y/200*100}%`,"--q4x":`${y.higher[4].x/300*100}%`,"--q4y":`${y.higher[4].y/200*100}%`,"--q5x":`${y.higher[5].x/300*100}%`,"--q5y":`${y.higher[5].y/200*100}%`,"--q6x":`${y.higher[6].x/300*100}%`,"--q6y":`${y.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${y.lower[0].x/300*100}%`,"--q0y":`${y.lower[0].y/200*100}%`,"--q1x":`${y.lower[1].x/300*100}%`,"--q1y":`${y.lower[1].y/200*100}%`,"--q2x":`${y.lower[2].x/300*100}%`,"--q2y":`${y.lower[2].y/200*100}%`,"--q3x":`${y.lower[3].x/300*100}%`,"--q3y":`${y.lower[3].y/200*100}%`,"--q4x":`${y.lower[4].x/300*100}%`,"--q4y":`${y.lower[4].y/200*100}%`,"--q5x":`${y.lower[5].x/300*100}%`,"--q5y":`${y.lower[5].y/200*100}%`,"--q6x":`${y.lower[6].x/300*100}%`,"--q6y":`${y.lower[6].y/200*100}%`}})]})})}),M===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),M===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},R.id)}),!s&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:c.title}),c.body&&e.jsx("p",{children:c.body}),c.micro&&e.jsx("p",{className:"cogita-intro-micro",children:c.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:S,children:c.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:v,children:"Otwórz pokaz"})]})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:t.map((R,M)=>e.jsx("button",{type:"button",className:`dot ${n===M?"active":""}`,"aria-label":R.title,onClick:()=>h(M)},R.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:j,children:"Pomiń"})]})]})}const Kr=6,Fr=4;function Dr({copy:t,onAuthAction:n,authLabel:s,showProfileMenu:i,onProfileNavigate:o,onToggleSecureMode:u,onLogout:h,secureMode:j,onNavigate:v,language:S,onLanguageChange:l}){const f=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}v("home")},c=a.useRef(null),d=a.useRef([]),w=a.useMemo(()=>{let U=Date.now()%2147483647;const ce=()=>(U=U*48271%2147483647,U/2147483647);return Array.from({length:Kr},(G,xe)=>{const re=6+ce()*8,te=7+ce()*10,Se=6+ce()*9,Re=-ce()*re,Pe=-ce()*te,Le=-ce()*Se,Ge=.18+ce()*.28,it=12+ce()*18,ke=4+ce()*8,Ue=(ce()-.5)*3.2,gt=(ce()-.5)*3.8,We=ce()>.5?"alternate":"alternate-reverse",Be=ce()>.5?"alternate":"alternate-reverse",et=ce()>.5?"alternate":"alternate-reverse",rt=.18+ce()*.42,qe=30+ce()*60,Ne=-45-ce()*38,Te=188+ce()*32,ze=.1+ce()*.2;return{id:`wave-${xe+1}`,style:{"--wave-sway-duration":`${re}s`,"--wave-scale-duration":`${te}s`,"--wave-drift-duration":`${Se}s`,"--wave-sway-delay":`${Re}s`,"--wave-scale-delay":`${Pe}s`,"--wave-drift-delay":`${Le}s`,"--wave-sway-dir":We,"--wave-scale-dir":Be,"--wave-drift-dir":et,"--wave-scale":`${Ge}`,"--wave-shift":`${it}%`,"--wave-xshift":`${ke}%`,"--wave-x0":`${Ue}%`,"--wave-y0":`${gt}%`,"--wave-opacity":`${rt}`,"--wave-blur":`${qe}px`,"--wave-bottom":`${Ne}%`,"--wave-hue":`${Te}`,"--wave-glow":`${ze}`}}})},[]),p=a.useMemo(()=>{let U=Date.now()*3%2147483647;const ce=()=>(U=U*48271%2147483647,U/2147483647);return Array.from({length:Fr},(G,xe)=>{const re=180+ce()*220,te=220+ce()*280,Se=-ce()*re,Re=-ce()*te,Pe=.12+ce()*.22,Le=3+ce()*7,Ge=1+ce()*3,it=(ce()-.5)*2.8,ke=(ce()-.5)*2.2;return{id:`mesh-${xe+1}`,seed:1e3+xe*991+Math.floor(ce()*999),style:{"--mesh-sway-duration":`${re}s`,"--mesh-drift-duration":`${te}s`,"--mesh-sway-delay":`${Se}s`,"--mesh-drift-delay":`${Re}s`,"--mesh-scale":`${Pe}`,"--mesh-shift":`${Le}%`,"--mesh-xshift":`${Ge}%`,"--mesh-x0":`${ke}%`,"--mesh-y0":`${it}%`}}})},[]),C=a.useMemo(()=>{const U=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],ce=t.cogita.introSlides,G=new Map(ce.map(xe=>[xe.id,xe]));return U.map(xe=>{var te;const re=G.get(xe.id);return{...xe,...re,title:(re==null?void 0:re.title)??"Cogita",cta:(re==null?void 0:re.cta)??((te=t.cogita.introSlides[0])==null?void 0:te.cta)??t.cogita.loginCta,secondary:re==null?void 0:re.secondary}})},[t.cogita.introSlides]),[z,b]=a.useState(0),[m,ae]=a.useState(!0),[_,y]=a.useState(!1),O=C.length-1,k=a.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),Y=a.useCallback(()=>{k(),n()},[k,n]),K=a.useCallback(()=>{ae(!0),b(0)},[]),L=a.useCallback(()=>{ae(!1),b(O)},[O]),le=a.useCallback(U=>{b(Math.max(0,Math.min(O,U)))},[O]),ge=a.useCallback(()=>{z>=O?Y():le(z+1)},[z,le,Y,O]),je=a.useCallback(()=>{le(z-1)},[z,le]);a.useEffect(()=>{var G;const U=(G=window.matchMedia)==null?void 0:G.call(window,"(prefers-reduced-motion: reduce)");if(!U)return;const ce=()=>y(U.matches);return ce(),U.addEventListener?(U.addEventListener("change",ce),()=>U.removeEventListener("change",ce)):(U.addListener(ce),()=>U.removeListener(ce))},[]),a.useEffect(()=>{if(!m)return;const U=ce=>{const G=ce.target;if(!G)return;const xe=G.tagName;if(!(G.isContentEditable||xe==="INPUT"||xe==="TEXTAREA"||xe==="SELECT"||xe==="BUTTON"||xe==="A"||G.closest('button, a, [role="button"], [role="link"]'))){if(ce.key==="Escape"){L();return}if(ce.key==="ArrowLeft"||ce.key==="ArrowUp"){je();return}(ce.key==="ArrowRight"||ce.key==="ArrowDown"||ce.code==="Space"||ce.key===" ")&&(ce.preventDefault(),ge())}};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[L,ge,je,m]),a.useEffect(()=>{m&&z===O&&k()},[z,m,O,k]),a.useEffect(()=>{const U=c.current;if(!U)return;const ce=d.current.filter(Ne=>!!Ne);if(!ce.length)return;const G=1,xe=.6,re=.6,te=Math.max(1,Math.min(G,window.devicePixelRatio||1));let Se=0,Re=0,Pe=xe,Le=0,Ge=0;const it=Ne=>{let Te=Ne%2147483647;return Te<=0&&(Te+=2147483646),(ze,B)=>{Te=Te*48271%2147483647;const E=Te/2147483647;return ze+E*(B-ze)}},ke={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},Ue=Ne=>{const Te=Math.sin(Ne*12.9898)*43758.5453;return Te-Math.floor(Te)},gt=Ne=>{const Te=Ue(Ne+.1)||1e-4,ze=Ue(Ne+.7)||1e-4;return Math.sqrt(-2*Math.log(Te))*Math.cos(2*Math.PI*ze)},We=(Ne,Te)=>{const ze=Math.floor(Ne),B=ze+1,E=Ne-ze,R=E*E*(3-2*E),M=Ue(ze*12.9898+Te*78.233),x=Ue(B*12.9898+Te*78.233);return M+(x-M)*R},Be=Ne=>{const Te=it(Ne),ze=Math.min(4,Math.max(4,Math.floor(Se/1200*ke.filamentCount)));return Array.from({length:ze},(B,E)=>{const R=Math.max(-1,Math.min(1,gt(Ne+E*.37))),M=Math.min(1,Math.max(0,Ue(Ne+E*1.31))),x=Math.min(ke.depthLayers-1,Math.floor(M*ke.depthLayers));return{seed:Te(0,Math.PI*2)+Ne*.01,offset:R,freqA:ke.freq1*(.75+Te(0,.5)),freqB:ke.freq2*(.75+Te(0,.5)),ampA:ke.amp1*(.6+Te(0,.7)),ampB:ke.amp2*(.6+Te(0,.7)),width:2+E%5*.32,depth:M,layer:x}})},et=(Ne,Te,ze)=>{const B=Math.max(30,Math.floor(Se*Re/14e4));Ne.save(),Ne.globalAlpha=.6;for(let E=0;E<B;E+=1){const R=Ue(E*9.1+Se*.11)*Te+ze,M=Ue(E*3.7+Re*.23)*Re,x=1.2+Ue(E*5.9)*2.4,N=Ne.createRadialGradient(R,M,0,R,M,x*2);N.addColorStop(0,"rgba(10, 30, 60, 0.45)"),N.addColorStop(1,"rgba(10, 30, 60, 0)"),Ne.fillStyle=N,Ne.beginPath(),Ne.arc(R,M,x*2,0,Math.PI*2),Ne.fill()}Ne.restore()},rt=(Ne,Te)=>{Ne.clearRect(0,0,Se,Re);const ze=Re*ke.waveCenter,B=ke.waveBandPx,E=ke.segments,R=ke.colors.filaments,M=Le||Se,x=0;et(Ne,M,x),Ne.strokeStyle=R,Ne.lineCap="round",Ne.lineJoin="round";for(let N=0;N<Te.length;N+=1){const I=Te[N],F=I.offset*B*(.85+Ue(I.seed)*.4),V=1-Math.min(1,Math.abs(F)/B),q=Math.exp(-Math.pow(F/ke.crestThickness,2)),me=I.layer===0?1.1:I.layer===1?.85:.6,ie=.35+(1-I.depth)*.65,se=V*ie*me*(.34+q*.45);Ne.globalAlpha=se,Ne.lineWidth=I.width*(1+(1-I.depth)*.8);const oe=[];for(let W=0;W<=E;W+=1){const $e=W/E*M+x,Me=(We($e*.012,I.seed)-.5)*ke.xJitter,Ie=$e+Me,nt=(We(Ie*I.freqA,I.seed)-.5)*ke.jitterA,ht=(We(Ie*I.freqB,I.seed*1.7)-.5)*ke.jitterB,Ye=ze+Math.sin(Ie*I.freqA+I.seed)*I.ampA+Math.sin(Ie*I.freqB+I.seed*1.3)*I.ampB+F+nt+ht;oe.push({x:Ie,y:Ye})}Ne.beginPath(),Ne.moveTo(oe[0].x,oe[0].y);for(let W=1;W<oe.length-1;W+=1){const $e=(oe[W].x+oe[W+1].x)/2,Me=(oe[W].y+oe[W+1].y)/2;Ne.quadraticCurveTo(oe[W].x,oe[W].y,$e,Me)}const J=oe[oe.length-1];Ne.quadraticCurveTo(J.x,J.y,J.x,J.y),Ne.stroke()}Ne.save(),Ne.globalCompositeOperation="lighter",Ne.strokeStyle=ke.colors.glow,Ne.lineCap="round",Ne.lineJoin="round";for(let N=0;N<Te.length;N+=1){const I=Te[N];if(Math.abs(I.offset)*B>ke.crestThickness)continue;const F=ke.glowAlpha*(.7+(1-I.depth)*.6);Ne.globalAlpha=F,Ne.lineWidth=1.6+(1-I.depth)*1.2;const V=[];for(let me=0;me<=E;me+=1){const ie=me/E*M+x,se=Math.sin(ie*.02+I.seed)*3,oe=ze+Math.sin(ie*I.freqA+I.seed)*I.ampA+Math.sin(ie*I.freqB+I.seed*1.3)*I.ampB+I.offset*B*.35+se;V.push({x:ie,y:oe})}Ne.beginPath(),Ne.moveTo(V[0].x,V[0].y);for(let me=1;me<V.length-1;me+=1){const ie=(V[me].x+V[me+1].x)/2,se=(V[me].y+V[me+1].y)/2;Ne.quadraticCurveTo(V[me].x,V[me].y,ie,se)}const q=V[V.length-1];Ne.quadraticCurveTo(q.x,q.y,q.x,q.y),Ne.stroke()}Ne.restore()},qe=()=>{Se=Math.floor(U.clientWidth),Re=Math.floor(U.clientHeight),Le=Math.floor(Se*1.8),Ge=Re,Pe=Se<820?re:xe,ce.forEach(Ne=>{const Te=Ne.getContext("2d");if(!Te)return;Ne.width=Math.floor(Le*te*Pe),Ne.height=Math.floor(Ge*te*Pe),Ne.style.width=`${Le}px`,Ne.style.height=`${Ge}px`,Ne.style.left=`${-(Le-Se)/2}px`,Te.setTransform(te*Pe,0,0,te*Pe,0,0);const ze=Number(Ne.dataset.seed||1),B=Be(ze);rt(Te,B)})};return qe(),window.addEventListener("resize",qe,{passive:!0}),()=>window.removeEventListener("resize",qe)},[p]);const Oe=C[Math.min(z,C.length-1)],ue=m?Oe:C[C.length-1],$=(ue==null?void 0:ue.theme)??C[0].theme,pe={"--cogita-bg0":$.bg0,"--cogita-bg1":$.bg1,"--cogita-bg2":$.bg2,"--cogita-bloom":$.bloom,"--cogita-sat":$.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:f,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Rs,{value:S,onChange:l}),e.jsx(As,{copy:t,label:s,isAuthenticated:i,secureMode:j,onLogin:n,onProfileNavigate:o,onToggleSecureMode:u,onLogout:h,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:c,className:"cogita-section cogita-home",style:pe,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[p.map((U,ce)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:U.style,"data-seed":U.seed,ref:G=>{d.current[ce]=G}},U.id)),w.map(U=>e.jsx("div",{className:"cogita-home-wave",style:U.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},U.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(Pr,{slides:C,activeIndex:z,introOpen:m,prefersReducedMotion:_,onNext:ge,onPrev:je,onSelect:le,onExit:L,onOpen:K,onRegister:Y})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}const so=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:Dr},Symbol.toStringTag,{value:"Module"})),Os=a.createContext(!1);function Et({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,headerExtra:l,children:f}){if(a.useContext(Os))return e.jsx(e.Fragment,{children:f});const d=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}j("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:d,children:t.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:t.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Rs,{value:v,onChange:S}),e.jsxs("div",{className:"cogita-header-right",children:[l,e.jsx(As,{copy:t,label:n,isAuthenticated:s,secureMode:h,onLogin:()=>j("home"),onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,variant:"ghost"})]})]}),e.jsx("main",{className:"cogita-main",children:f}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:t.footer.headline})]})]})}function ha(t){const[n,s]=a.useState("Cogita library"),[i,o]=a.useState(null);return a.useEffect(()=>{let u=!1;return Es().then(h=>{if(u)return;const j=h.find(v=>v.libraryId===t);j&&s(j.name)}).catch(()=>{u||s("Cogita library")}),()=>{u=!0}},[t]),a.useEffect(()=>{let u=!1;return nr(t).then(h=>{u||o(h)}).catch(()=>{u||o(null)}),()=>{u=!0}},[t]),{libraryName:n,stats:i}}function is({slices:t}){const n=t.reduce((i,o)=>i+Math.max(0,o.value),0),s=a.useMemo(()=>{if(n<=0)return"conic-gradient(rgba(120, 160, 200, 0.3) 0deg 360deg)";let i=0;return`conic-gradient(${t.map(u=>{const j=Math.max(0,u.value)/n*360,v=i,S=i+j;return i=S,`${u.color} ${v}deg ${S}deg`}).join(",")})`},[t,n]);return e.jsxs("div",{className:"cogita-overview-pie-wrap",children:[e.jsx("div",{className:"cogita-overview-pie",style:{background:s}}),e.jsx("div",{className:"cogita-overview-legend",children:t.map(i=>e.jsxs("div",{className:"cogita-overview-legend-item",children:[e.jsx("span",{style:{background:i.color}}),e.jsx("strong",{children:i.value}),e.jsx("small",{children:i.label})]},i.label))})]})}function zr({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l}){const{libraryName:f,stats:c}=ha(l),[d,w]=a.useState("infos"),[p,C]=a.useState(0),[z,b]=a.useState(0),[m,ae]=a.useState(0),_=(c==null?void 0:c.totalInfos)??0,y=(c==null?void 0:c.totalCollections)??0,O=0,k=0,Y=0,K=Math.max(0,_-Y-z),L=Math.max(0,_-z-m);a.useEffect(()=>{let ge=!1;return(async()=>{try{const Oe=await za({libraryId:l,limit:200}),ue=await Promise.all(Oe.items.map($=>qn({libraryId:l,collectionId:$.collectionId}).catch(()=>[])));if(ge)return;C(ue.reduce(($,pe)=>$+pe.length,0))}catch{ge||C(0)}})(),()=>{ge=!0}},[l]),a.useEffect(()=>{let ge=!1;return(async()=>{try{const[Oe,ue,$]=await Promise.all([as({libraryId:l,type:"computed",limit:1}).catch(()=>({total:0})),as({libraryId:l,type:"source",limit:1}).catch(()=>({total:0})),Un({libraryId:l}).catch(()=>({items:[]}))]);if(ge)return;b((Oe.total??0)+(ue.total??0));const pe=new Set($.items.filter(U=>U.childItemType.toLowerCase()==="info").map(U=>U.childItemId).filter(Boolean));ae(pe.size)}catch{ge||(b(0),ae(0))}})(),()=>{ge=!0}},[l]);const le=[{key:"infos",label:t.cogita.library.overview.stats.totalInfos,value:_},{key:"collections",label:t.cogita.library.overview.stats.collections,value:y},{key:"revisions",label:t.cogita.library.overview.stats.revisions,value:p},{key:"storyboards",label:t.cogita.library.overview.stats.storyboards,value:O},{key:"texts",label:t.cogita.library.overview.stats.texts,value:k}];return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsx("div",{children:e.jsx("h1",{className:"cogita-library-title",children:f})})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsx("div",{className:"cogita-overview-counters",children:le.map(ge=>e.jsxs("button",{type:"button",className:`cogita-overview-counter ${d===ge.key?"active":""}`,onClick:()=>w(ge.key),children:[e.jsx("span",{children:ge.label}),e.jsx("strong",{children:ge.value})]},ge.key))}),e.jsxs("section",{className:"cogita-overview-main-card",children:[e.jsx("header",{children:e.jsx("h2",{children:t.cogita.library.overview.statsCardTitle})}),d==="infos"?e.jsxs("div",{className:"cogita-overview-main-grid",children:[e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.knownChartTitle}),e.jsx(is,{slices:[{label:t.cogita.library.overview.known,value:Y,color:"#75d79a"},{label:t.cogita.library.overview.unknown,value:K,color:"#85b9ff"},{label:t.cogita.library.overview.excluded,value:z,color:"#9ca6bb"}]})]}),e.jsxs("article",{children:[e.jsx("h3",{children:t.cogita.library.overview.checksChartTitle}),e.jsx(is,{slices:[{label:t.cogita.library.overview.availableChecks,value:m,color:"#75d79a"},{label:t.cogita.library.overview.unavailableChecks,value:L,color:"#7ea4d6"}]})]})]}):e.jsxs("div",{className:"cogita-overview-placeholder",children:[e.jsx("p",{children:t.cogita.library.overview.statsCardHint}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]})]})})]})})}const tt=(t,n)=>{const s=t.cogita.library.infoTypes,i=t.cogita.library.connectionTypes,o=t.cogita.library.groupTypes;return{any:s.any,vocab:s.vocab,book:o.book,citation:o.citation,language:s.language,word:s.word,sentence:s.sentence,topic:s.topic,collection:s.collection,person:s.person,institution:s.institution,collective:s.collective,orcid:s.orcid,address:s.address,email:s.email,phone:s.phone,media:s.media,work:s.work,geo:s.geo,music_piece:s.musicPiece,music_fragment:s.musicFragment,source:s.source,question:s.question,computed:s.computed,"word-language":i.wordLanguage,"citation-language":i.citationLanguage,"language-sentence":i.languageSentence,translation:i.translation,"word-topic":i.wordTopic,reference:i.reference,"source-resource":i.sourceResource,"work-contributor":i.workContributor,"work-medium":i.workMedium,"orcid-link":i.orcidLink}[n]??String(n)},_r=t=>[{value:"any",label:tt(t,"any")},{value:"language",label:tt(t,"language")},{value:"word",label:tt(t,"word")},{value:"sentence",label:tt(t,"sentence")},{value:"topic",label:tt(t,"topic")},{value:"collection",label:tt(t,"collection")},{value:"person",label:tt(t,"person")},{value:"institution",label:tt(t,"institution")},{value:"collective",label:tt(t,"collective")},{value:"orcid",label:tt(t,"orcid")},{value:"address",label:tt(t,"address")},{value:"email",label:tt(t,"email")},{value:"phone",label:tt(t,"phone")},{value:"media",label:tt(t,"media")},{value:"work",label:tt(t,"work")},{value:"geo",label:tt(t,"geo")},{value:"music_piece",label:tt(t,"music_piece")},{value:"music_fragment",label:tt(t,"music_fragment")},{value:"source",label:tt(t,"source")},{value:"question",label:tt(t,"question")},{value:"citation",label:tt(t,"citation")},{value:"computed",label:tt(t,"computed")},{value:"vocab",label:tt(t,"vocab")},{value:"book",label:tt(t,"book")},{value:"word-language",label:tt(t,"word-language")},{value:"citation-language",label:tt(t,"citation-language")},{value:"language-sentence",label:tt(t,"language-sentence")},{value:"translation",label:tt(t,"translation")},{value:"word-topic",label:tt(t,"word-topic")},{value:"reference",label:tt(t,"reference")},{value:"source-resource",label:tt(t,"source-resource")},{value:"work-contributor",label:tt(t,"work-contributor")},{value:"work-medium",label:tt(t,"work-medium")},{value:"orcid-link",label:tt(t,"orcid-link")}],Br=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}],Nn={key:"languageId",labelKey:"language",kind:"select",path:"languageId",optionsSource:"languages",matcher:"equals"},Vr={language:{infoType:"language",entityKind:"single",structure:{payloadFields:["label","name","code"]},filterFields:[]},word:{infoType:"word",entityKind:"single",structure:{payloadFields:["label","lemma","languageId"],connections:[{relationType:"word-language",role:"language",targetType:"language"}]},filterFields:[Nn]},sentence:{infoType:"sentence",entityKind:"single",structure:{payloadFields:["label","text","languageId"],connections:[{relationType:"language-sentence",role:"language",targetType:"language"}]},filterFields:[Nn]},topic:{infoType:"topic",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},collection:{infoType:"collection",entityKind:"complex",structure:{payloadFields:["label","name"]},filterFields:[]},person:{infoType:"person",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},institution:{infoType:"institution",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},collective:{infoType:"collective",entityKind:"single",structure:{payloadFields:["label","name"]},filterFields:[]},orcid:{infoType:"orcid",entityKind:"single",structure:{payloadFields:["label","orcid"]},filterFields:[{key:"orcid",label:"ORCID",kind:"text",path:"orcid",matcher:"contains"}]},address:{infoType:"address",entityKind:"single",structure:{payloadFields:["label","street","city","postalCode","country"]},filterFields:[]},email:{infoType:"email",entityKind:"single",structure:{payloadFields:["label","email","address"]},filterFields:[]},phone:{infoType:"phone",entityKind:"single",structure:{payloadFields:["label","phone","number"]},filterFields:[]},media:{infoType:"media",entityKind:"single",structure:{payloadFields:["label","name","url","kind"]},filterFields:[]},work:{infoType:"work",entityKind:"single",structure:{payloadFields:["label","title","subtitle","doi","isbn","issn","languageId","originalLanguageId"]},filterFields:[Nn,{key:"originalLanguageId",labelKey:"originalLanguage",kind:"select",path:"originalLanguageId",optionsSource:"languages",matcher:"equals"},{key:"doi",labelKey:"doi",kind:"text",path:"doi",matcher:"contains"}]},geo:{infoType:"geo",entityKind:"single",structure:{payloadFields:["label","name","country","region","city"]},filterFields:[]},music_piece:{infoType:"music_piece",entityKind:"single",structure:{payloadFields:["label","title","composer"]},filterFields:[]},music_fragment:{infoType:"music_fragment",entityKind:"single",structure:{payloadFields:["label","title","text"]},filterFields:[]},source:{infoType:"source",entityKind:"single",structure:{payloadFields:["label","title","sourceKind","locator"],connections:[{relationType:"source-resource",role:"resource",targetType:"work"}]},filterFields:[{key:"sourceKind",labelKey:"sourceKind",kind:"select",path:"sourceKind",optionsSource:"sourceKinds",matcher:"equals"},{key:"locator",labelKey:"locator",kind:"text",path:"locator",matcher:"locator_contains"}]},citation:{infoType:"citation",entityKind:"single",structure:{payloadFields:["title","text"],connections:[{relationType:"citation-language",role:"language",targetType:"language"},{relationType:"reference",role:"source",targetType:"source"}]},filterFields:[{key:"text",labelKey:"citationText",kind:"text",path:"text",matcher:"contains"}]},question:{infoType:"question",entityKind:"single",structure:{payloadFields:["definition"]},filterFields:[{key:"questionType",labelKey:"type",kind:"text",path:"definition.type",matcher:"contains"},{key:"questionText",labelKey:"text",kind:"text",path:"definition.question",matcher:"contains"}]},computed:{infoType:"computed",entityKind:"complex",structure:{payloadFields:["label","title","definition"]},filterFields:[]},translation:{infoType:"translation",entityKind:"connection",structure:{payloadFields:["note","tagIds"],connections:[{relationType:"translation",role:"wordA",targetType:"word"},{relationType:"translation",role:"wordB",targetType:"word"},{relationType:"word-language",role:"languageA",targetType:"language"},{relationType:"word-language",role:"languageB",targetType:"language"}]},filterFields:[{key:"languageAId",labelKey:"languageA",kind:"select",optionsSource:"languages",matcher:"equals"},{key:"languageBId",labelKey:"languageB",kind:"select",optionsSource:"languages",matcher:"equals"}]}},os={infoType:"default",entityKind:"single",structure:{payloadFields:["label"]},filterFields:[]};function Or(t){return t?Vr[t]??os:os}function qr(t,n){return t.optionsSource==="languages"?n.languages.map(s=>({value:s.infoId,label:s.label})):t.optionsSource==="sourceKinds"?Br:[]}const Ur="cogita.revision.seed:";function qs(t){return`${Ur}${t}`}function Jr(t,n){if(typeof window>"u")return null;const s=Array.from(new Set(n.map(u=>u.trim()).filter(Boolean)));if(!s.length)return null;const i=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,o={kind:"info-selection",libraryId:t,infoIds:s,createdAt:new Date().toISOString()};return window.localStorage.setItem(qs(i),JSON.stringify(o)),i}function ls(t,n){if(typeof window>"u")return null;const s=window.localStorage.getItem(qs(n));if(!s)return null;try{const i=JSON.parse(s);if(i.kind!=="info-selection"||i.libraryId!==t||!Array.isArray(i.infoIds))return null;const o=i.infoIds.map(u=>String(u??"").trim()).filter(Boolean);return o.length?{infoIds:o}:null}catch{return null}}const Hr="cogita.collection-draft:";function Us(t){return`${Hr}${t}`}function Wr(t,n){if(typeof window>"u")return null;const s=Array.from(new Set(n.map(u=>u.trim()).filter(Boolean)));if(!s.length)return null;const i=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,o={kind:"info-selection",libraryId:t,infoIds:s,createdAt:new Date().toISOString()};return window.localStorage.setItem(Us(i),JSON.stringify(o)),i}function Qr(t,n){if(typeof window>"u")return null;const s=window.localStorage.getItem(Us(n));if(!s)return null;try{const i=JSON.parse(s);if(i.kind!=="info-selection"||i.libraryId!==t||!Array.isArray(i.infoIds))return null;const o=i.infoIds.map(u=>String(u??"").trim()).filter(Boolean);return o.length?{infoIds:o}:null}catch{return null}}const Sn=60,Gr=500;function Js(t){return`cogita.info-selection:${t}`}function cs(t){if(typeof window>"u")return{};const n=window.localStorage.getItem(Js(t));if(!n)return{};try{const s=JSON.parse(n);return!s||typeof s!="object"?{}:s}catch{return{}}}function Yr({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,mode:f}){var _t;const c=dn(),d=Ba(),w=t.cogita.library.list,[p,C]=a.useState("any"),[z,b]=a.useState(""),[m,ae]=a.useState("relevance"),[_,y]=a.useState("details"),[O,k]=a.useState(!1),[Y,K]=a.useState("idle"),[L,le]=a.useState([]),[ge,je]=a.useState(Sn),[Oe,ue]=a.useState(null),[$,pe]=a.useState(()=>cs(l)),[U,ce]=a.useState({}),[G,xe]=a.useState([]),[re,te]=a.useState([]),[Se,Re]=a.useState(null),[Pe,Le]=a.useState(null),[Ge,it]=a.useState(null),[ke,Ue]=a.useState("idle"),[gt,We]=a.useState([]),[Be,et]=a.useState(""),[rt,qe]=a.useState(null),[Ne,Te]=a.useState("idle"),[ze,B]=a.useState(null),[E,R]=a.useState(null),[M,x]=a.useState("idle"),[N,I]=a.useState([]),[F,V]=a.useState("idle"),q=a.useMemo(()=>_r(t),[t]),me=a.useMemo(()=>[{value:"relevance",label:w.sortRelevance},{value:"label_asc",label:w.sortLabelAsc},{value:"label_desc",label:w.sortLabelDesc},{value:"type_asc",label:w.sortTypeAsc},{value:"type_desc",label:w.sortTypeDesc}],[w.sortLabelAsc,w.sortLabelDesc,w.sortRelevance,w.sortTypeAsc,w.sortTypeDesc]);a.useEffect(()=>{pe(cs(l)),ce({}),k(!1)},[l]),a.useEffect(()=>{Un({libraryId:l}).then(r=>it(r)).catch(()=>it({items:[]}))},[l]),a.useEffect(()=>{sr({libraryId:l}).then(r=>We(r)).catch(()=>We([]))},[l]),a.useEffect(()=>{kn({libraryId:l,type:"language",filters:{sourceKind:"info"},limit:200}).then(r=>{const D=r.map(he=>({infoId:he.infoId??"",infoType:he.entityType,label:he.title})).filter(he=>he.infoId.length>0);xe(D)}).catch(()=>xe([]))},[l]),a.useEffect(()=>{kn({libraryId:l,type:"source",filters:{sourceKind:"info"},limit:200}).then(r=>{const D=r.map(he=>({infoId:he.infoId??"",infoType:he.entityType,label:he.title})).filter(he=>he.infoId.length>0);te(D)}).catch(()=>te([]))},[l]),a.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Js(l),JSON.stringify($))},[l,$]);const ie=a.useMemo(()=>Or(p==="any"?null:p),[p]),se=a.useMemo(()=>new URLSearchParams(d.search),[d.search]),oe=a.useMemo(()=>d.pathname.split("/").filter(Boolean),[d.pathname]),J=oe.findIndex(r=>r==="infos"),W=J>=0&&(oe[J+1]??"").trim()||null,$e=J>=0?(oe[J+2]??"").trim():"",Me=J>=0?$e==="checkcards"?"cards":$e==="collections"?"collections":"overview":"",Ie=W??((se.get("infoId")??"").trim()||null),nt=W?Me:(se.get("infoView")??"overview").trim(),ht=nt==="overview"&&!!Ie,Ye=nt==="collections"&&!!Ie,Qe=a.useMemo(()=>({language:w.typeFilterLanguage,languageA:w.typeFilterLanguageA,languageB:w.typeFilterLanguageB,originalLanguage:w.typeFilterOriginalLanguage,doi:w.typeFilterDoi,sourceKind:w.typeFilterSourceKind,locator:w.typeFilterLocator,citationText:w.typeFilterCitationText}),[w.typeFilterDoi,w.typeFilterLanguage,w.typeFilterLanguageA,w.typeFilterLanguageB,w.typeFilterLocator,w.typeFilterOriginalLanguage,w.typeFilterCitationText,w.typeFilterSourceKind]),Nt=a.useMemo(()=>ie.filterFields.map(r=>({...r,label:r.labelKey?Qe[r.labelKey]:r.label??r.key,options:qr(r,{languages:G})})),[Qe,G,ie.filterFields]),xt=a.useMemo(()=>Nt.some(r=>(U[r.key]??"").trim().length>0),[Nt,U]);a.useEffect(()=>{ce({})},[p]),a.useEffect(()=>{const r={sourceKind:"info"};if(xt)for(const H of Nt){const Xe=(U[H.key]??"").trim();Xe&&(r[H.path??H.key]=Xe)}const D=(U.__referenceId??"").trim();D&&(r["link.references"]=D),K("loading");const he=window.setTimeout(()=>{kn({libraryId:l,type:p==="any"?void 0:p,query:z.trim()||void 0,filters:r,limit:Gr}).then(H=>{const Xe=H.map(ot=>({infoId:ot.infoId??"",infoType:ot.entityType,label:ot.title})).filter(ot=>ot.infoId.length>0);le(Xe),K("ready")}).catch(()=>{le([]),K("ready")})},240);return()=>window.clearTimeout(he)},[xt,l,z,p,Nt,U]),a.useEffect(()=>{if(!Ie||nt!=="overview"&&nt!=="collections"){Re(null),Le(null),Ue("idle");return}let r=!1;return Ue("loading"),Promise.all([ua({libraryId:l,infoId:Ie}),rr({libraryId:l,itemType:"info",itemId:Ie}).catch(()=>null)]).then(([D,he])=>{r||(Re(D),Le(he),Ue("ready"))}).catch(()=>{r||(Re(null),Le(null),Ue("error"))}),()=>{r=!0}},[l,Ie,nt]),a.useEffect(()=>{if(!Ie||nt!=="collections"){I([]),V("idle");return}let r=!1;return V("loading"),ir({libraryId:l,infoId:Ie}).then(D=>{r||(I(D),V("ready"))}).catch(()=>{r||(I([]),V("error"))}),()=>{r=!0}},[l,Ie,nt]),a.useEffect(()=>{if(!Ie||nt!=="overview"){B(null),R(null),x("idle");return}let r=!1;return x("loading"),Promise.all([Ga({libraryId:l,infoId:Ie}),Ya({libraryId:l,infoId:Ie})]).then(([D,he])=>{r||(B(D),R(he),x("ready"))}).catch(()=>{r||(B(null),R(null),x("error"))}),()=>{r=!0}},[l,Ie,nt]);const Ct=a.useMemo(()=>Se?gt.filter(r=>r.sourceInfoTypes.some(D=>D.toLowerCase()===Se.infoType.toLowerCase())):[],[gt,Se]);a.useEffect(()=>{if(!Se){et("");return}et(r=>{var D;return r&&Ct.some(he=>he.approachKey===r)?r:((D=Ct[0])==null?void 0:D.approachKey)??""})},[Ct,Se]),a.useEffect(()=>{if(!Se||!Be){qe(null),Te("idle");return}let r=!1;return Te("loading"),Ps({libraryId:l,infoId:Se.infoId,approachKey:Be}).then(D=>{r||(qe(D),Te("ready"))}).catch(()=>{r||(qe(null),Te("error"))}),()=>{r=!0}},[l,Be,Se]);const vt=a.useMemo(()=>{const r=L.slice(),D=he=>tt(t,he);return m==="relevance"?r:m==="label_asc"?r.sort((he,H)=>he.label.localeCompare(H.label)):m==="label_desc"?r.sort((he,H)=>H.label.localeCompare(he.label)):m==="type_asc"?r.sort((he,H)=>he.infoType===H.infoType?he.label.localeCompare(H.label):D(he.infoType).localeCompare(D(H.infoType))):r.sort((he,H)=>he.infoType===H.infoType?he.label.localeCompare(H.label):D(H.infoType).localeCompare(D(he.infoType)))},[t,L,m]),Mt=a.useMemo(()=>vt.slice(0,ge),[vt,ge]),aa=Mt.length<vt.length,At=a.useMemo(()=>new Set(Object.keys($)),[$]),St=a.useMemo(()=>Object.values($),[$]),ma=a.useMemo(()=>{const r=new Map;for(const D of St)r.set(D.infoType,(r.get(D.infoType)??0)+1);return Array.from(r.entries()).sort((D,he)=>he[1]-D[1]||D[0].localeCompare(he[0]))},[St]),It=a.useMemo(()=>{if(!Ie||!Ge)return 0;const r=new Set;for(const D of Ge.items)D.childItemType!=="info"||D.childItemId!==Ie||r.add([D.parentItemType,D.parentItemId,D.parentCheckType??"",D.parentDirection??""].join("|"));return r.size},[Ge,Ie]);a.useEffect(()=>{je(Sn);const r=new Set(L.map(D=>D.infoId));ue(D=>D&&r.has(D)?D:null)},[L]);const pt=r=>{pe(D=>({...D,[r.infoId]:{infoId:r.infoId,infoType:r.infoType,label:r.label}}))},wt=r=>{pe(D=>{if(!D[r])return D;const he={...D};return delete he[r],he})},ft=(r,D)=>{if(D){pt(r);return}wt(r.infoId)},mt=r=>{c(`/cogita/library/${l}/infos/${encodeURIComponent(r)}`,{replace:!0})},Pt=()=>{c(`/cogita/library/${l}/list`,{replace:!0})},at=()=>{Ie&&c(`/cogita/library/${l}/edit/${encodeURIComponent(Ie)}`,{replace:!0})},_e=()=>{const r=Jr(l,St.map(D=>D.infoId));r&&c(`/cogita/library/${l}/revision/run?libraryTarget=revisions&scope=info-selection&seed=${encodeURIComponent(r)}`)},ut=()=>{const r=Wr(l,St.map(D=>D.infoId));r&&c(`/cogita/library/${l}/collections/new?draft=${encodeURIComponent(r)}&draftType=info-selection`)},Jt=St.length===1?((_t=St[0])==null?void 0:_t.infoId)??null:null,Kt=w.selectionCount.replace("{count}",String(St.length)),Dt=f==="collection"?"grid":f==="detail"?"wide":_,ee=Zr(v),Xt=Pe?Math.max(0,Math.min(100,Math.round((Pe.score??0)*100))):0,na=Pe?ei(Pe,ee):ee.noKnownnessData;return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":Dt,children:e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[ht?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:ee.kicker}),e.jsx("h2",{className:"cogita-card-title",children:Se?ds(Se.payload,Se.infoType,Se.infoId):ee.loading}),Se?e.jsxs("p",{className:"cogita-card-subtitle",children:[tt(t,Se.infoType)," · ",Se.infoId]}):null]}),e.jsxs("div",{className:"cogita-info-overview-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:Pt,children:ee.backToSearch}),e.jsx("button",{type:"button",className:"cta",onClick:at,disabled:!Ie||ke!=="ready",children:w.editInfo})]})]}),ke==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:ee.loading})}):ke==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:ee.loadError})}):Se?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-info-overview-metrics",children:[e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:ee.knownness}),e.jsxs("div",{className:"cogita-info-metric-value",children:[Xt,"%"]}),e.jsx("div",{className:"cogita-info-progress","aria-hidden":"true",children:e.jsx("span",{style:{width:`${Xt}%`}})}),e.jsx("p",{className:"cogita-library-hint",children:na})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:ee.reviews}),e.jsx("div",{className:"cogita-info-metric-value",children:(Pe==null?void 0:Pe.totalReviews)??0}),e.jsx("p",{className:"cogita-library-hint",children:ee.correct.replace("{correct}",String((Pe==null?void 0:Pe.correctReviews)??0)).replace("{total}",String((Pe==null?void 0:Pe.totalReviews)??0))}),e.jsx("p",{className:"cogita-library-hint",children:Pe!=null&&Pe.lastReviewedUtc?`${ee.lastReview}: ${Xr(Pe.lastReviewedUtc,v)}`:ee.noLastReview})]}),e.jsxs("article",{className:"cogita-info-metric-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:ee.linkedCards}),e.jsx("div",{className:"cogita-info-metric-value",children:It}),e.jsx("p",{className:"cogita-library-hint",children:ee.linkedCardsHint})]})]}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:ee.checkcards}),M==="loading"?e.jsx("p",{className:"cogita-library-hint",children:ee.loadingCheckcards}):M==="error"?e.jsx("p",{className:"cogita-library-hint",children:ee.loadCheckcardsError}):e.jsxs("div",{className:"cogita-info-tree",children:[e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:ee.checkcardCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(ze==null?void 0:ze.items.length)??0})]}),e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:ee.dependencyCount}),e.jsx("div",{className:"cogita-info-tree-value",children:(E==null?void 0:E.items.length)??0})]})]})]}),Ct.length>0?e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsxs("div",{className:"cogita-info-approach-header",children:[e.jsx("h3",{children:ee.approach}),e.jsx("select",{value:Be,onChange:r=>et(r.target.value),"aria-label":ee.approach,children:Ct.map(r=>e.jsx("option",{value:r.approachKey,children:r.label},r.approachKey))})]}),Ne==="loading"?e.jsx("p",{className:"cogita-library-hint",children:ee.loadingApproach}):Ne==="error"?e.jsx("p",{className:"cogita-library-hint",children:ee.loadApproachError}):rt?e.jsx(Za,{value:rt.projection,emptyLabel:ee.empty}):e.jsx("p",{className:"cogita-library-hint",children:ee.noApproachData})]}):null,e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:ee.payload}),e.jsx(Za,{value:Se.payload,emptyLabel:ee.empty})]}),e.jsxs("section",{className:"cogita-info-overview-panel",children:[e.jsx("h3",{children:ee.links}),e.jsx(ti,{links:Se.links,emptyLabel:ee.noLinks})]})]})]}):null]})}):null,Ye?e.jsx("section",{className:"cogita-library-search-surface",children:e.jsxs("section",{className:"cogita-info-overview",children:[e.jsxs("div",{className:"cogita-info-overview-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Informacja"}),e.jsx("h2",{className:"cogita-card-title",children:Se?ds(Se.payload,Se.infoType,Se.infoId):Ie??""}),e.jsx("p",{className:"cogita-card-subtitle",children:"Collections using this info"})]}),e.jsx("div",{className:"cogita-info-overview-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Pt,children:"Back to search"})})]}),F==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading collections..."})}):null,F==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load collections."})}):null,F==="ready"&&N.length===0?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"This info is not used in any collection yet."})}):null,F==="ready"&&N.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:N.map(r=>e.jsx("article",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`/#/cogita/library/${l}/collections/${r.collectionId}?libraryTarget=collections`,children:[e.jsx("div",{className:"cogita-card-type",children:"Collection"}),e.jsx("h3",{className:"cogita-card-title",children:r.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[r.itemCount," items"]})]})},r.collectionId))}):null]})}):null,!ht&&!Ye?e.jsxs("section",{className:"cogita-library-search-surface",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsx("div",{className:"cogita-library-search",children:e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{"aria-label":w.typeLabel,value:p,onChange:r=>C(r.target.value),children:q.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsx("input",{type:"text",value:z,onChange:r=>b(r.target.value),placeholder:w.searchPlaceholder}),e.jsx("select",{"aria-label":w.sortLabel,value:m,onChange:r=>ae(r.target.value),children:me.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsxs("select",{"aria-label":w.viewLabel,value:_,onChange:r=>y(r.target.value),children:[e.jsx("option",{value:"details",children:w.viewDetails}),e.jsx("option",{value:"wide",children:w.viewWide}),e.jsx("option",{value:"grid",children:w.viewGrid})]})]})})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:w.cardCount.replace("{shown}",String(Mt.length)).replace("{total}",String(vt.length))}),e.jsx("span",{children:Y==="loading"?w.loading:w.ready})]}),e.jsxs("div",{className:"cogita-filters-toggle-row",children:[e.jsx("button",{type:"button",className:"ghost cogita-filters-toggle",onClick:()=>k(r=>!r),children:O?w.hideFilters:w.showFilters}),e.jsx("span",{className:"cogita-sidebar-note",children:w.filtersOptionalHint})]}),O?e.jsx("section",{className:"cogita-library-filters cogita-library-filters--compact",children:e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:w.typeLabel}),e.jsx("select",{value:p,onChange:r=>C(r.target.value),children:q.map(r=>e.jsx("option",{value:r.value,children:r.label},`advanced-type:${r.value}`))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Reference"}),e.jsxs("select",{value:U.__referenceId??"",onChange:r=>ce(D=>({...D,__referenceId:r.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),re.map(r=>e.jsx("option",{value:r.infoId,children:r.label},`reference:${r.infoId}`))]})]}),Nt.map(r=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:r.label}),r.kind==="select"?e.jsxs("select",{value:U[r.key]??"",onChange:D=>ce(he=>({...he,[r.key]:D.target.value})),children:[e.jsx("option",{value:"",children:t.cogita.library.filters.clear}),(r.options??[]).map(D=>e.jsx("option",{value:D.value,children:D.label},`${r.key}:${D.value}`))]}):e.jsx("input",{type:"text",value:U[r.key]??"",onChange:D=>ce(he=>({...he,[r.key]:D.target.value}))})]},`type-filter:${r.key}`))]})}):null,e.jsxs("div",{className:"cogita-info-selection-bar",children:[e.jsx("span",{children:Kt}),e.jsxs("div",{className:"cogita-info-selection-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>{pe(r=>{const D={...r};for(const he of Mt)D[he.infoId]={infoId:he.infoId,infoType:he.infoType,label:he.label};return D})},disabled:Mt.length===0,children:w.selectAllVisible}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>pe({}),disabled:St.length===0,children:w.clearSelection}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>Jt&&mt(Jt),disabled:!Jt,title:Jt?void 0:w.openSelectedDisabled,children:w.openSelected})]})]}),Dt==="details"?e.jsxs("div",{className:"cogita-details-grid",role:"table","aria-label":w.searchTitle,children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:w.detailColumnName}),e.jsx("span",{children:w.detailColumnType}),e.jsx("span",{children:w.detailColumnId}),e.jsx("span",{})]}),Mt.length?Mt.map(r=>{const D=tt(t,r.infoType),he=At.has(r.infoId),H=Oe===r.infoId;return e.jsxs("div",{className:`cogita-details-row ${H||he?"active":""}`,role:"row",onClick:()=>ue(r.infoId),children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:he,onChange:Xe=>ft(r,Xe.target.checked),onClick:Xe=>Xe.stopPropagation()}),e.jsx("span",{})]}),e.jsx("span",{title:r.label,children:r.label}),e.jsx("span",{title:D,children:D}),e.jsx("span",{title:r.infoId,children:r.infoId}),e.jsx("button",{type:"button",className:"ghost cogita-details-open",onClick:Xe=>{Xe.stopPropagation(),mt(r.infoId)},"aria-label":w.editInfo,children:">"})]},r.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:w.noMatch})})]}):e.jsx("div",{className:`cogita-card-list cogita-card-list--${Dt}`,"data-view":Dt,children:Mt.length?Mt.map(r=>{const D=tt(t,r.infoType),he=At.has(r.infoId),H=Oe===r.infoId;return e.jsx("article",{className:"cogita-card-item","data-selected":H||he,children:e.jsxs("div",{className:"cogita-info-result-row",children:[e.jsxs("label",{className:"cogita-info-checkbox",children:[e.jsx("input",{type:"checkbox",checked:he,onChange:Xe=>ft(r,Xe.target.checked)}),e.jsx("span",{})]}),e.jsxs("button",{type:"button",className:"cogita-info-result-main",onClick:()=>ue(r.infoId),children:[e.jsx("div",{className:"cogita-card-type",children:D}),e.jsx("h3",{className:"cogita-card-title",children:r.label}),e.jsx("p",{className:"cogita-card-subtitle",children:r.infoId})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>mt(r.infoId),children:w.editInfo})]})},r.infoId)}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:w.noMatch})})}),aa?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>je(r=>r+Sn),children:w.loadMore})}):null,St.length>0?e.jsxs("section",{className:"cogita-selection-stack",children:[e.jsx("p",{className:"cogita-user-kicker",children:w.selectedStackTitle}),e.jsx("p",{className:"cogita-library-hint",children:w.selectedStackHint}),e.jsx("div",{className:"cogita-selection-overview",children:ma.map(([r,D])=>e.jsxs("span",{className:"cogita-tag-chip",children:[e.jsx("span",{children:tt(t,r)}),e.jsx("span",{className:"cogita-tag-count",children:D})]},`stack:type:${r}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:_e,disabled:St.length===0,children:"Start revision"}),e.jsx("button",{type:"button",className:"ghost",onClick:ut,disabled:St.length===0,children:"Create collection from selection"})]})]}):null]}):null]})})})})}function ds(t,n,s){if(t&&typeof t=="object"&&!Array.isArray(t)){const i=t,o=["title","name","label","value","text","quote","term"];for(const u of o){const h=i[u];if(typeof h=="string"&&h.trim())return h.trim()}}return`${n} · ${s}`}function Xr(t,n){try{const s=n==="pl"?"pl-PL":n==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(s,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}catch{return t}}function Zr(t){return t==="pl"?{kicker:"Informacja",backToSearch:"Wróć do wyszukiwania",loading:"Ładowanie informacji...",loadError:"Nie udało się wczytać informacji.",knownness:"Znajomość",reviews:"Sprawdzenia",correct:"Poprawne: {correct} / {total}",lastReview:"Ostatnie sprawdzenie",noLastReview:"Brak sprawdzeń",linkedCards:"Powiązane karty",linkedCardsHint:"Karty sprawdzające zależne od tej informacji",payload:"Treść informacji",links:"Powiązania",empty:"Brak danych",noLinks:"Brak powiązań",checkcards:"Karty sprawdzające",loadingCheckcards:"Ładowanie kart sprawdzających...",loadCheckcardsError:"Nie udało się wczytać kart sprawdzających.",noCheckcards:"Brak kart sprawdzających.",checkcardCount:"Liczba kart",dependencyCount:"Zależności (efektywne)",approach:"Podejście",loadingApproach:"Ładowanie widoku...",loadApproachError:"Nie udało się wczytać widoku.",noApproachData:"Brak danych widoku.",noKnownnessData:"Brak danych o znajomości",developmentStart:"Początek nauki",developmentGrowing:"Rozwój w toku",developmentStable:"Utrwalona wiedza",developmentStrong:"Bardzo dobra znajomość"}:t==="de"?{kicker:"Information",backToSearch:"Zur Suche",loading:"Information wird geladen...",loadError:"Information konnte nicht geladen werden.",knownness:"Kenntnisstand",reviews:"Abfragen",correct:"Richtig: {correct} / {total}",lastReview:"Letzte Abfrage",noLastReview:"Noch keine Abfragen",linkedCards:"Verknüpfte Karten",linkedCardsHint:"Prüfkarten, die von dieser Information abhängen",payload:"Inhalt",links:"Verknüpfungen",empty:"Keine Daten",noLinks:"Keine Verknüpfungen",checkcards:"Prüfkarten",loadingCheckcards:"Prüfkarten werden geladen...",loadCheckcardsError:"Prüfkarten konnten nicht geladen werden.",noCheckcards:"Keine Prüfkarten.",checkcardCount:"Anzahl Karten",dependencyCount:"Abhängigkeiten (effektiv)",approach:"Ansicht",loadingApproach:"Ansicht wird geladen...",loadApproachError:"Ansicht konnte nicht geladen werden.",noApproachData:"Keine Ansichtsdaten.",noKnownnessData:"Keine Kenntnisdaten",developmentStart:"Lernbeginn",developmentGrowing:"Aufbauphase",developmentStable:"Stabil",developmentStrong:"Sehr sicher"}:{kicker:"Info",backToSearch:"Back to search",loading:"Loading info...",loadError:"Failed to load info.",knownness:"Knownness",reviews:"Reviews",correct:"Correct: {correct} / {total}",lastReview:"Last review",noLastReview:"No reviews yet",linkedCards:"Linked checking cards",linkedCardsHint:"Checking cards depending on this info",payload:"Information",links:"Links",empty:"No data",noLinks:"No links",checkcards:"Checkcards",loadingCheckcards:"Loading checkcards...",loadCheckcardsError:"Failed to load checkcards.",noCheckcards:"No checkcards.",checkcardCount:"Checkcard count",dependencyCount:"Dependencies (effective)",approach:"Approach",loadingApproach:"Loading view...",loadApproachError:"Failed to load view.",noApproachData:"No view data.",noKnownnessData:"No knownness data",developmentStart:"Just started",developmentGrowing:"In progress",developmentStable:"Stable",developmentStrong:"Strong"}}function ei(t,n){return t.totalReviews<=0?n.noKnownnessData:t.totalReviews<3||t.score<.35?n.developmentStart:t.totalReviews<8||t.score<.65?n.developmentGrowing:t.score<.85?n.developmentStable:n.developmentStrong}function ti({links:t,emptyLabel:n}){return!t||Object.keys(t).length===0?e.jsx("p",{className:"cogita-library-hint",children:n}):e.jsx("div",{className:"cogita-info-tree",children:Object.entries(t).map(([s,i])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:s}),e.jsx("div",{className:"cogita-info-tree-value",children:Array.isArray(i)?i.length?e.jsx("div",{className:"cogita-selection-overview",children:i.map(o=>e.jsx("span",{className:"cogita-tag-chip",children:o},`${s}:${o}`))}):e.jsx("span",{className:"cogita-library-hint",children:"[]"}):i?e.jsx("span",{className:"cogita-tag-chip",children:i}):e.jsx("span",{className:"cogita-library-hint",children:"null"})})]},s))})}function Za({value:t,emptyLabel:n}){if(t==null)return e.jsx("p",{className:"cogita-library-hint",children:n});if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)});if(Array.isArray(t))return t.length===0?e.jsx("p",{className:"cogita-library-hint",children:"[]"}):e.jsx("div",{className:"cogita-info-tree",children:t.map((s,i)=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:i+1}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(Za,{value:s,emptyLabel:n})})]},i))});if(typeof t=="object"){const s=Object.entries(t);return s.length===0?e.jsx("p",{className:"cogita-library-hint",children:n}):e.jsx("div",{className:"cogita-info-tree",children:s.map(([i,o])=>e.jsxs("div",{className:"cogita-info-tree-row",children:[e.jsx("div",{className:"cogita-info-tree-key",children:i}),e.jsx("div",{className:"cogita-info-tree-value",children:e.jsx(Za,{value:o,emptyLabel:n})})]},i))})}return e.jsx("div",{className:"cogita-info-tree-value",children:String(t)})}const ja=5,us=50,hs=2,gs=[];function Qt({libraryId:t,infoType:n,label:s,placeholder:i,value:o,onChange:u,values:h,onChangeMultiple:j,helperText:v,searchFailedText:S,createFailedText:l,createLabel:f,savingLabel:c,loadMoreLabel:d,allowCreate:w=!0,inputRef:p,autoAdvance:C,onCommit:z,multiple:b}){const m=b?h??gs:gs,[ae,_]=a.useState(b?"":(o==null?void 0:o.label)??""),[y,O]=a.useState([]),[k,Y]=a.useState(ja),[K,L]=a.useState(-1),[le,ge]=a.useState(!1),[je,Oe]=a.useState(!1),[ue,$]=a.useState(null),pe=a.useRef(0),U=a.useRef(new Map),ce=a.useMemo(()=>w?b?ae.trim().length>0:ae.trim().length>0&&!o:!1,[w,ae,o,b]);a.useEffect(()=>{b||_((o==null?void 0:o.label)??"")},[o,b]),a.useEffect(()=>{const re=ae.trim();if(!re||re.length<hs){O([]),ge(!1),Y(ja),L(-1),Oe(!1),$(null);return}const te=re.toLowerCase(),Se=`${t}:${n}:${te}`,Re=U.current.get(Se);if(Re){if(b&&m.length>0){const Le=new Set(m.map(Ge=>Ge.id));O(Re.filter(Ge=>!Le.has(Ge.id)))}else O(Re);Y(ja),L(-1),ge(Re.length>0),Oe(!1),$(null);return}const Pe=window.setTimeout(async()=>{const Le=Date.now();pe.current=Le,Oe(!0),$(null);try{const Ge=await Jn({libraryId:t,type:n,query:re,limit:us});if(pe.current!==Le)return;const it=Ge.slice(0,us).map(ke=>({id:ke.infoId,label:ke.label,infoType:ke.infoType}));if(U.current.set(Se,it),b&&m.length>0){const ke=new Set(m.map(Ue=>Ue.id));O(it.filter(Ue=>!ke.has(Ue.id)))}else O(it);Y(ja),L(-1),ge(!0)}catch{if(pe.current!==Le)return;$(S??"Search failed.")}finally{pe.current===Le&&Oe(!1)}},250);return()=>window.clearTimeout(Pe)},[t,n,ae,m]);const G=re=>{if(b){const te=m.some(Se=>Se.id===re.id)?m:[...m,re];j==null||j(te),_(""),ge(!1),L(-1);return}u==null||u(re),_(re.label),ge(!1),L(-1),C&&(z==null||z())},xe=async()=>{const re=ae.trim();if(re){Oe(!0),$(null);try{const te=await zn({libraryId:t,infoType:n,payload:{label:re}}),Se={id:te.infoId,label:re,infoType:te.infoType};if(re.length>=hs){const Re=`${t}:${n}:${re.toLowerCase()}`,Pe=U.current.get(Re)??[];U.current.set(Re,[Se,...Pe])}if(b){j==null||j([...m,Se]),_(""),ge(!1),L(-1);return}u==null||u(Se),ge(!1),L(-1),C&&(z==null||z())}catch{$(l??"Create failed.")}finally{Oe(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:s}),e.jsx("input",{value:ae,placeholder:i,onChange:re=>{_(re.target.value),!b&&o&&(u==null||u(null))},onKeyDown:re=>{if(re.key==="ArrowDown"){if(re.preventDefault(),!y.length)return;ge(!0),L(te=>{const Se=Math.min(y.length,k)-1,Re=te<0?0:Math.min(te+1,Se);return Re===Se&&y.length>k?(Y(Pe=>Math.min(Pe+ja,y.length)),Math.min(te+1,Math.min(y.length,k+ja)-1)):Re});return}if(re.key==="ArrowUp"){if(re.preventDefault(),!y.length)return;ge(!0),L(te=>te<=0?0:te-1);return}if(re.key==="Enter"){if(re.preventDefault(),K>=0&&y[K]){G(y[K]);return}if(ce){xe();return}}},onFocus:()=>{y.length>0&&ge(!0)},autoComplete:"off",ref:p})]}),b&&m.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:m.map(re=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>j==null?void 0:j(m.filter(te=>te.id!==re.id)),children:[re.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},re.id))}),v&&e.jsx("p",{className:"cogita-help",children:v}),ue&&e.jsx("p",{className:"cogita-error",children:ue}),le&&y.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[y.slice(0,k).map((re,te)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":te===K,onClick:()=>G(re),children:[e.jsx("strong",{children:re.label}),e.jsx("span",{children:re.infoType})]},re.id)),k<y.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>Y(re=>Math.min(re+ja,y.length)),children:d??"Load more"})]}),ce&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:xe,disabled:je,children:je?c??"Saving...":f??`Create new ${n}`})]})}const ms=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],ps=8;function fs({libraryId:t,copy:n,language:s,sourceKindOptions:i,value:o,onChange:u,labels:h}){const[j,v]=a.useState(!1),[S,l]=a.useState(-1),f=a.useMemo(()=>{const p=s;return ms.map(C=>{var m;const z=(C==null?void 0:C[p])??(C==null?void 0:C.en)??(C==null?void 0:C.la);return{label:`${z.abbr} — ${z.name}`,latin:((m=C==null?void 0:C.la)==null?void 0:m.abbr)??z.abbr}})},[s]),c=(p,C=!1)=>{const z=p.trim().toLowerCase();return z?f.filter(b=>b.label.toLowerCase().includes(z)).slice(0,ps):C?f.slice(0,ps):[]},d=(p,C)=>{const z=p.trim().toLowerCase();if(!z)return null;const b=ms;for(const m of b){const ae=m==null?void 0:m.la,_=(m==null?void 0:m[C])??(m==null?void 0:m.en)??ae,y=(_==null?void 0:_.abbr)??"",O=(_==null?void 0:_.name)??"";if(y.toLowerCase()===z||O.toLowerCase()===z||`${y} — ${O}`.toLowerCase()===z)return{book:m,entry:_,la:ae}}return null};a.useEffect(()=>{if(o.sourceKind==="bible"&&o.locatorValue&&!j){const p=d(o.locatorValue,s);if(p){const C=`${p.entry.abbr} — ${p.entry.name}`;C!==o.bibleBookDisplay&&u({...o,bibleBookDisplay:C})}}},[s,o,j,u]);const w=p=>u({...o,...p});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:h.sourceKindLabel}),e.jsx("select",{value:o.sourceKind,onChange:p=>w({sourceKind:p.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:i.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),o.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:h.bibleBookLabel}),e.jsx("input",{type:"text",value:o.bibleBookDisplay,onChange:p=>{const C=p.target.value;w({bibleBookDisplay:C,locatorValue:""}),v(!0),l(-1)},onKeyDown:p=>{var z;const C=c(o.bibleBookDisplay);if(C.length){if(p.key==="ArrowDown")p.preventDefault(),l(b=>Math.min(b+1,C.length-1));else if(p.key==="ArrowUp")p.preventDefault(),l(b=>Math.max(b-1,0));else if((p.key==="Enter"||p.key==="Tab")&&S>=0&&C[S]){const b=C[S],m=d(b.label,s);if(!m)return;w({bibleBookDisplay:b.label,locatorValue:((z=m.la)==null?void 0:z.abbr)??o.locatorValue}),v(!1)}}},onFocus:()=>v(!0),onBlur:()=>window.setTimeout(()=>v(!1),100),placeholder:h.bibleBookPlaceholder})]}),j&&c(o.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:c(o.bibleBookDisplay,!0).map((p,C)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":C===S,tabIndex:-1,onMouseDown:()=>{var b;const z=d(p.label,s);z&&w({bibleBookDisplay:p.label,locatorValue:((b=z.la)==null?void 0:b.abbr)??o.locatorValue})},children:e.jsx("strong",{children:p.label})},p.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:h.bibleRestLabel}),e.jsx("input",{type:"text",value:o.locatorAux,onChange:p=>w({locatorAux:p.target.value}),placeholder:h.bibleRestPlaceholder})]})]}),o.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:o.sourceUrl,onChange:p=>w({sourceUrl:p.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:o.sourceAccessedDate,onChange:p=>w({sourceAccessedDate:p.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),o.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(Qt,{libraryId:t,infoType:"work",label:h.churchDocumentLabel,placeholder:h.churchDocumentPlaceholder,value:o.churchDocument,onChange:p=>w({churchDocument:p}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:h.locatorLabel}),e.jsx("input",{type:"text",value:o.locatorValue,onChange:p=>w({locatorValue:p.target.value}),placeholder:h.locatorPlaceholder})]})]}),o.sourceKind==="work"&&e.jsx(Qt,{libraryId:t,infoType:"work",label:h.workLabel,placeholder:h.workPlaceholder,value:o.work,onChange:p=>w({work:p}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),o.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(Qt,{libraryId:t,infoType:"media",label:h.bookLabel,placeholder:h.bookPlaceholder,value:o.bookMedia,onChange:p=>w({bookMedia:p}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:h.locatorLabel}),e.jsx("input",{type:"text",value:o.locatorValue,onChange:p=>w({locatorValue:p.target.value}),placeholder:h.locatorPlaceholder})]})]}),o.sourceKind!=="website"&&o.sourceKind!=="bible"&&o.sourceKind!=="book"&&o.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:h.locatorLabel}),e.jsx("input",{type:"text",value:o.locatorValue,onChange:p=>w({locatorValue:p.target.value}),placeholder:h.locatorPlaceholder})]})]})}const Ea=JSON.stringify({type:"selection",title:"Question title",question:"Question text",options:["Option A","Option B","Option C"],answer:[0]},null,2);function Ja(t="selection"){return t==="matching"?{type:t,title:"",question:"",columns:[[""],[""]],answer:{paths:[]},matchingPaths:[["",""]]}:t==="ordering"?{type:t,title:"",question:"",options:[""]}:t==="truefalse"?{type:t,title:"",question:"",answer:!0}:t==="text"||t==="date"?{type:t,title:"",question:"",answer:""}:t==="number"?{type:t,title:"",question:"",answer:""}:{type:t,title:"",question:"",options:[""],answer:[]}}function ai(t){return["selection","truefalse","text","number","date","matching","ordering"].includes(t)}function Pa(t){if(!t||typeof t!="object")return null;const n=t,s=typeof n.type=="string"?n.type:typeof n.kind=="string"?n.kind:"selection",i=s==="multi_select"||s==="single_select"?"selection":s==="boolean"?"truefalse":s==="order"?"ordering":s,o=ai(i)?i:"selection",u=typeof n.title=="string"?n.title:"",h=typeof n.question=="string"?n.question:"";if(o==="matching"){let S=[];Array.isArray(n.columns)?S=n.columns.map(p=>Array.isArray(p)?p.map(C=>typeof C=="string"?C:""):[""]):Array.isArray(n.left)&&Array.isArray(n.right)&&(S=[n.left.map(p=>typeof p=="string"?p:""),n.right.map(p=>typeof p=="string"?p:"")]),S.length<2&&(S=[[""],[""]]);const l=n.answer&&typeof n.answer=="object"?n.answer:null,c=(Array.isArray(l==null?void 0:l.paths)?l==null?void 0:l.paths:Array.isArray(n.correctPairs)?n.correctPairs:[]).map(p=>Array.isArray(p)?p.map(C=>Number(C)).filter(C=>Number.isInteger(C)&&C>=0):[]).filter(p=>p.length>0),d=Array.isArray(n.matchingPaths)?n.matchingPaths.map(p=>Array.isArray(p)?Array.from({length:S.length},(C,z)=>String(p[z]??"")):new Array(S.length).fill("")):null,w=d&&d.length>0?d:[...c.map(p=>p.map(String)),new Array(S.length).fill("")];return{type:o,title:u,question:h,columns:S,answer:{paths:c},matchingPaths:w}}if(o==="ordering"){const S=Array.isArray(n.options)?n.options.map(l=>typeof l=="string"?l:""):Array.isArray(n.items)?n.items.map(l=>typeof l=="string"?l:""):[""];return{type:o,title:u,question:h,options:S.length?S:[""]}}if(o==="truefalse"){const S=typeof n.answer=="boolean"?n.answer:typeof n.expected=="boolean"?n.expected:!0;return{type:o,title:u,question:h,answer:S}}if(o==="number")return typeof n.answer=="number"?{type:o,title:u,question:h,answer:n.answer}:typeof n.answer=="string"?{type:o,title:u,question:h,answer:n.answer}:typeof n.expected=="number"?{type:o,title:u,question:h,answer:n.expected}:{type:o,title:u,question:h,answer:""};if(o==="text"||o==="date"){const S=typeof n.answer=="string"?n.answer:typeof n.expected=="string"?n.expected:"";return{type:o,title:u,question:h,answer:S}}const j=Array.isArray(n.options)?n.options.map(S=>typeof S=="string"?S:""):[""],v=Array.isArray(n.answer)?n.answer.map(S=>Number(S)).filter(S=>Number.isInteger(S)&&S>=0):Array.isArray(n.correct)?n.correct.map(S=>Number(S)).filter(S=>Number.isInteger(S)&&S>=0):[];return{type:o,title:u,question:h,options:j.length?j:[""],answer:v}}function ni(t){const n=(t.title??"").trim(),s=(t.question??"").trim();switch(t.type){case"matching":{const i=(t.columns??[[""],[""]]).map(f=>f.map(c=>c.trim()).filter(Boolean)).filter(f=>f.length>0),o=i.length>=2?i:[[""],[""]],u=t.answer&&typeof t.answer=="object"&&"paths"in t.answer?t.answer.paths:[],h=(t.matchingPaths??[]).map(f=>f.map(c=>String(c??""))),j=o.length,v=h.map(f=>f.slice(0,j).map(c=>c.trim())).filter(f=>f.some(Boolean)).map(f=>f.map(c=>Number(c))).filter(f=>f.length===j&&f.every(c=>Number.isInteger(c)&&c>=0)),S=(Array.isArray(u)?u:[]).map(f=>Array.isArray(f)?f.map(c=>Number(c)).filter(c=>Number.isInteger(c)&&c>=0):[]).filter(f=>f.length===j),l=Array.from(new Set([...S,...v].map(f=>JSON.stringify(f)))).map(f=>JSON.parse(f));return JSON.stringify({type:t.type,...n?{title:n}:{},question:s,columns:o,answer:{paths:l}},null,2)}case"ordering":{const i=(t.options??[]).map(o=>o.trim()).filter(Boolean);return JSON.stringify({type:t.type,...n?{title:n}:{},question:s,options:i},null,2)}case"truefalse":return JSON.stringify({type:t.type,...n?{title:n}:{},question:s,answer:!!t.answer},null,2);case"number":return JSON.stringify({type:t.type,...n?{title:n}:{},question:s,answer:typeof t.answer=="number"||typeof t.answer=="string"?t.answer:""},null,2);case"date":case"text":return JSON.stringify({type:t.type,...n?{title:n}:{},question:s,answer:String(t.answer??"")},null,2);case"selection":default:{const i=(t.options??[]).map(h=>h.trim()).filter(Boolean),o=Array.isArray(t.answer)?t.answer:[],u=Array.from(new Set(o.filter(h=>Number.isInteger(h)&&h>=0&&h<i.length))).sort((h,j)=>h-j);return JSON.stringify({type:t.type,...n?{title:n}:{},question:s,options:i,answer:u},null,2)}}}const bs=[{value:"string",label:"string"},{value:"book",label:"book"},{value:"website",label:"website"},{value:"bible",label:"bible"},{value:"number_document",label:"number_document"},{value:"work",label:"work"},{value:"other",label:"other"}];function Fa(){return{sourceKind:"string",locatorValue:"",locatorAux:"",bibleBookDisplay:"",sourceUrl:"",sourceAccessedDate:"",churchDocument:null,bookMedia:null,work:null}}function ys(t){return t==null?"":typeof t=="string"?t:JSON.stringify(t)}function xs(t,n){if(!t||typeof t!="object")return n;const s=t,i=s.definition&&typeof s.definition=="object"?s.definition:null,o=[s.label,s.name,s.title,s.text,s.orcid,s.email,s.number];i&&o.unshift(i.title,i.question);for(const u of o)if(typeof u=="string"&&u.trim())return u.trim();return n}function vs(t,n){var i;if(!(t instanceof Ks))return n;const s=(i=t.message)==null?void 0:i.trim();if(!s)return n;try{const o=JSON.parse(s);if(typeof o.error=="string"&&o.error.trim())return o.error.trim()}catch{}return s}function si(t){const n=t.trim();if(!n)return null;try{const s=JSON.parse(n);return s&&typeof s=="object"&&!Array.isArray(s)?s:null}catch{return null}}function oa(t,n){const s=t==null?void 0:t[n];return typeof s=="string"?s:""}function ri(t,n){return n?t==="book"&&n.infoType==="media"?{bookMedia:n}:t==="work"&&n.infoType==="work"?{work:n}:t==="number_document"&&n.infoType==="work"?{churchDocument:n}:{}:{}}function ii(t,n){const s=Fa(),i=(t.sourceKind??"").trim()||s.sourceKind,o=t.locator??"",u=si(o);let h="",j="",v="",S="",l="";return i==="website"?(S=oa(u,"url"),l=oa(u,"accessedDate"),h=oa(u,"value")):i==="bible"?(h=oa(u,"book")||o.trim(),j=oa(u,"passage")||oa(u,"rest"),v=oa(u,"bookDisplay")):u?(h=oa(u,"value")||oa(u,"locator"),j=oa(u,"aux")):h=o,{...s,sourceKind:i,locatorValue:h,locatorAux:j,bibleBookDisplay:v,sourceUrl:S,sourceAccessedDate:l,...ri(i,n)}}function Tn(t){return t.sourceKind==="book"?t.bookMedia:t.sourceKind==="work"?t.work:t.sourceKind==="number_document"?t.churchDocument:null}function Cn(t){const n=t.locatorValue.trim(),s=t.locatorAux.trim(),i=t.sourceUrl.trim(),o=t.sourceAccessedDate.trim();switch(t.sourceKind){case"website":return{url:i,accessedDate:o};case"bible":return{book:n,bookDisplay:t.bibleBookDisplay.trim(),passage:s};case"book":case"work":case"number_document":return s?{value:n,aux:s}:n;default:return s?{value:n,aux:s}:n}}function ws(t){var o,u,h;const n=t.locatorValue.trim(),s=t.locatorAux.trim(),i=[n,s].filter(Boolean).join(" ");switch(t.sourceKind){case"website":return t.sourceUrl.trim()||"website";case"bible":return i||"bible";case"book":return[(o=t.bookMedia)==null?void 0:o.label,i].filter(Boolean).join(" · ")||"book";case"work":return[(u=t.work)==null?void 0:u.label,i].filter(Boolean).join(" · ")||"work";case"number_document":return[(h=t.churchDocument)==null?void 0:h.label,i].filter(Boolean).join(" · ")||"number_document";default:return i||t.sourceKind||"source"}}function js(t){return t.sourceKind.trim()?t.sourceKind==="website"?!!t.sourceUrl.trim():t.sourceKind==="bible"?!!(t.locatorValue.trim()&&t.locatorAux.trim()):t.sourceKind==="book"?!!t.bookMedia:t.sourceKind==="work"?!!t.work:t.sourceKind==="number_document"?!!(t.churchDocument&&t.locatorValue.trim()):!!t.locatorValue.trim():!1}function oi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,editInfoId:f}){var Ne,Te,ze;const{libraryName:c}=ha(l),d=!!f,[w,p]=a.useState([]),[C,z]=a.useState("word"),[b,m]=a.useState({}),[ae,_]=a.useState({}),[y,O]=a.useState({}),[k,Y]=a.useState({}),[K,L]=a.useState(null),[le,ge]=a.useState("idle"),[je,Oe]=a.useState(Fa),[ue,$]=a.useState({}),[pe,U]=a.useState({}),[ce,G]=a.useState({}),[xe,re]=a.useState(null),[te,Se]=a.useState(()=>Pa(JSON.parse(Ea))??Ja()),[Re,Pe]=a.useState(Ea),Le=a.useMemo(()=>w.find(B=>B.infoType===C),[C,w]),Ge=a.useMemo(()=>w.find(B=>B.infoType==="source"),[w]),it=a.useMemo(()=>w.map(B=>({value:B.infoType,label:tt(t,B.infoType)})),[t,w]),ke=B=>{const E=Pa(B)??Ja(),R=ni(E);Se(E),m(M=>({...M,definition:R}))};a.useEffect(()=>{let B=!1;return or({libraryId:l}).then(E=>{var R;if(!B&&(p(E),!d)){const M=(R=E[0])==null?void 0:R.infoType;M&&z(M)}}).catch(()=>{B||p([])}),()=>{B=!0}},[d,l]),a.useEffect(()=>{if(d||!Le)return;const B={},E={},R={},M={};for(const x of Le.payloadFields)Le.infoType==="question"&&x.key==="definition"&&x.inputType==="json"?B[x.key]=Ea:B[x.key]="";for(const x of Le.linkFields)x.multiple?R[x.key]=[]:E[x.key]=null,x.targetTypes.length>0&&(M[x.key]=x.targetTypes[0]);m(B),_(E),O(R),Y(M)},[Le==null?void 0:Le.infoType,d]),a.useEffect(()=>{if(C!=="question")return;const B=b.definition??"";if(!B.trim()){const E=Pa(JSON.parse(Ea))??Ja();Se(E),Pe(Ea);return}try{const E=JSON.parse(B),R=Pa(E);if(!R)return;Se(R),Pe(JSON.stringify(E,null,2))}catch{}},[b.definition,C]),a.useEffect(()=>{if(!d||!f||w.length===0)return;let B=!1;return ge("loading"),L(null),(async()=>{const R=await ua({libraryId:l,infoId:f});if(B)return;const M=R.infoType;z(M);const x=w.find(se=>se.infoType===M);if(!x){ge("idle");return}const N=R.payload??{},I={};for(const se of x.payloadFields)I[se.key]=ys(N[se.key]);m(I);const F=R.links??{}??{},V={},q={},me={},ie=[];for(const se of x.linkFields){se.targetTypes.length>0&&(me[se.key]=se.targetTypes[0]);const oe=F[se.key];if(se.multiple){const J=Array.isArray(oe)?oe.filter(W=>typeof W=="string"):[];q[se.key]=[];for(const W of J)ie.push(ua({libraryId:l,infoId:W}).then($e=>{if(B)return;const Me={id:W,infoType:$e.infoType,label:xs($e.payload,W)};me[se.key]=Me.infoType,q[se.key]=[...q[se.key],Me]}).catch(()=>{}))}else{const J=typeof oe=="string"?oe:null;V[se.key]=null,J&&ie.push(ua({libraryId:l,infoId:J}).then(W=>{if(B)return;const $e={id:J,infoType:W.infoType,label:xs(W.payload,J)};me[se.key]=$e.infoType,V[se.key]=$e}).catch(()=>{}))}}await Promise.all(ie),!B&&(_(V),O(q),Y(me),ge("idle"))})().catch(()=>{B||(L("Failed to load info details."),ge("idle"))}),()=>{B=!0}},[f,d,l,w]),a.useEffect(()=>{C==="source"&&Oe(ii(b,ae.resource??null))},[C,b.sourceKind,b.locator,(Ne=ae.resource)==null?void 0:Ne.id,(Te=ae.resource)==null?void 0:Te.infoType,(ze=ae.resource)==null?void 0:ze.label]);const Ue=B=>{var x,N;const E=((x=Ge==null?void 0:Ge.payloadFields.find(I=>I.key==="sourceKind"))==null?void 0:x.keepOnCreate)??!1,R=((N=Ge==null?void 0:Ge.linkFields.find(I=>I.key==="resource"))==null?void 0:N.keepOnCreate)??!1,M=Fa();return M.sourceKind=E?B.sourceKind:M.sourceKind,R&&(M.work=B.work,M.bookMedia=B.bookMedia,M.churchDocument=B.churchDocument),E&&B.sourceKind==="bible"&&(M.locatorValue=B.locatorValue,M.bibleBookDisplay=B.bibleBookDisplay),E&&B.sourceKind==="website"&&(M.sourceUrl=B.sourceUrl,M.sourceAccessedDate=B.sourceAccessedDate),M},gt=a.useMemo(()=>({sourceKindLabel:t.cogita.library.add.info.sourceKindLabel,bibleBookLabel:t.cogita.library.add.info.sourceBibleBookLabel,bibleBookPlaceholder:t.cogita.library.add.info.sourceBibleBookPlaceholder,bibleRestLabel:t.cogita.library.add.info.sourceBibleRestLabel,bibleRestPlaceholder:t.cogita.library.add.info.sourceBibleRestPlaceholder,churchDocumentLabel:t.cogita.library.add.info.sourceResourceLabel,churchDocumentPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,workLabel:t.cogita.library.add.info.sourceResourceLabel,workPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,bookLabel:t.cogita.library.add.info.sourceResourceLabel,bookPlaceholder:t.cogita.library.add.info.sourceResourcePlaceholder,locatorLabel:t.cogita.library.list.typeFilterLocator,locatorPlaceholder:t.cogita.library.list.typeFilterLocator}),[t]),We=async B=>{const E=pe[B]??Fa();if(!js(E)){G(R=>({...R,[B]:t.cogita.library.add.info.referenceMissingSource}));return}re(B),G(R=>({...R,[B]:null}));try{const R=Tn(E),M=R?{resource:R.id}:{},x={label:ws(E),sourceKind:E.sourceKind.trim(),locator:Cn(E)},I={id:(await zn({libraryId:l,infoType:"source",payload:x,links:M})).infoId,infoType:"source",label:x.label};if(O(F=>{const V=F[B]??[];return V.some(q=>q.id===I.id)?F:{...F,[B]:[...V,I]}}),d&&f){const F=await ua({libraryId:l,infoId:f}),V=F.links&&typeof F.links=="object"?{...F.links}:{},q=V[B],me=Array.isArray(q)?q.filter(ie=>typeof ie=="string"):typeof q=="string"?[q]:[];me.includes(I.id)||(V[B]=[...me,I.id],await ns({libraryId:l,infoId:f,payload:F.payload,links:V}))}U(F=>({...F,[B]:Ue(E)})),G(F=>({...F,[B]:null}))}catch(R){G(M=>({...M,[B]:vs(R,t.cogita.library.lookup.createFailed)}))}finally{re(R=>R===B?null:R)}},Be=async()=>{var R;if(!Le)return;const B={};for(const M of Le.payloadFields){if(C==="source"&&(M.key==="sourceKind"||M.key==="locator"))continue;const x=(b[M.key]??"").trim();if(!x){if(M.required){L(`Field '${M.label}' is required.`);return}continue}if(M.inputType==="json")try{B[M.key]=JSON.parse(x)}catch{L(`Field '${M.label}' must be valid JSON.`);return}else B[M.key]=x}const E={};for(const M of Le.linkFields)if(!(C==="source"&&M.key==="resource"))if(M.multiple){const x=(y[M.key]??[]).map(N=>N.id);if(M.required&&x.length===0){L(`Link '${M.label}' is required.`);return}x.length>0&&(E[M.key]=x)}else{const x=((R=ae[M.key])==null?void 0:R.id)??null;if(M.required&&!x){L(`Link '${M.label}' is required.`);return}x&&(E[M.key]=x)}if(C==="source"){if(!js(je)){L(t.cogita.library.add.info.referenceMissingSource);return}const M=je.sourceKind.trim();B.sourceKind=M,B.locator=Cn(je),(typeof B.label!="string"||!B.label.trim())&&(B.label=ws(je));const x=Tn(je);x&&(E.resource=x.id)}ge("saving"),L(null);try{if(d&&f)await ns({libraryId:l,infoId:f,payload:B,links:E}),L("Info updated.");else{await zn({libraryId:l,infoType:C,payload:B,links:E}),L("Info saved.");const M={};for(const I of Le.payloadFields)M[I.key]=I.keepOnCreate?b[I.key]??"":"";m(M);const x={},N={};for(const I of Le.linkFields)I.multiple?N[I.key]=I.keepOnCreate?y[I.key]??[]:[]:x[I.key]=I.keepOnCreate?ae[I.key]??null:null;_(I=>({...I,...x})),O(I=>({...I,...N})),C==="source"&&Oe(I=>{const F=Ue(I),V=Tn(F);return m(q=>({...q,sourceKind:F.sourceKind,locator:ys(Cn(F))})),_(q=>({...q,resource:V})),V&&Y(q=>({...q,resource:V.infoType})),F})}}catch(M){L(vs(M,"Failed to save info."))}finally{ge("idle")}},et=B=>{const E=b[B.key]??"";if(C==="question"&&B.key==="definition"&&B.inputType==="json"){const M=te.type,x=ie=>{const se=te.title??"",oe=te.question??"";ke({...Ja(ie),title:se,question:oe})},N=ie=>ie.length===0?[""]:ie[ie.length-1].trim()?[...ie,""]:ie,I=ie=>{const se=(ie.length?ie:[[""],[""]]).map(oe=>N(oe));return se.length>=2?se:[...se,[""]]},F=(ie,se)=>{const oe=ie.map(W=>Array.from({length:se},($e,Me)=>W[Me]??"")).filter(W=>W.some($e=>$e.trim())||W===ie[ie.length-1]);return oe.length===0?[new Array(se).fill("")]:oe[oe.length-1].some(W=>W.trim())?[...oe,new Array(se).fill("")]:oe},V=Array.isArray(te.answer)?te.answer:[],q=I(te.columns??[[""],[""]]),me=F(te.matchingPaths??[[]],q.length);return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:B.label}),e.jsxs("div",{className:"cogita-library-panel",style:{display:"grid",gap:"0.8rem"},children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Question type"}),e.jsxs("select",{value:M,onChange:ie=>x(ie.target.value),children:[e.jsx("option",{value:"selection",children:"Selection"}),e.jsx("option",{value:"truefalse",children:"True / false"}),e.jsx("option",{value:"text",children:"Text answer"}),e.jsx("option",{value:"number",children:"Number answer"}),e.jsx("option",{value:"date",children:"Date answer"}),e.jsx("option",{value:"matching",children:"Matching"}),e.jsx("option",{value:"ordering",children:"Right order"})]})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Title"}),e.jsx("input",{type:"text",value:te.title??"",onChange:ie=>ke({...te,title:ie.target.value}),placeholder:"Optional title"})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Question"}),e.jsx("textarea",{rows:3,value:te.question??"",onChange:ie=>ke({...te,question:ie.target.value}),placeholder:"Question text"})]}),M==="selection"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Options / correct indices"}),N(te.options??[""]).map((ie,se,oe)=>{const J=new Set(V.filter($e=>Number.isInteger($e))),W=se===oe.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"0.5rem",alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:J.has(se),disabled:!ie.trim(),onChange:$e=>{const Me=$e.target.checked?[...J,se]:[...J].filter(Ie=>Ie!==se);ke({...te,answer:Me})}}),e.jsx("input",{type:"text",value:ie,placeholder:`Answer ${se+1}`,onChange:$e=>{const Me=[...te.options??[""]];Me[se]=$e.target.value;const Ie=N(Me),nt=Ie.length-1,ht=V.filter(Ye=>Ye>=0&&Ye<nt);ke({...te,options:Ie,answer:ht})}}),W?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const Me=(te.options??[""]).filter((nt,ht)=>ht!==se),Ie=V.filter(nt=>nt!==se).map(nt=>nt>se?nt-1:nt);ke({...te,options:N(Me),answer:Ie})},children:"Remove"})]},`question-option:${se}`)})]}):null,M==="text"||M==="date"||M==="number"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Answer"}),e.jsx("input",{type:M==="date"?"date":"text",value:typeof te.answer=="string"||typeof te.answer=="number"?String(te.answer):"",onChange:ie=>ke({...te,answer:ie.target.value})})]}):null,M==="truefalse"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Answer"}),e.jsxs("select",{value:String(!!te.answer),onChange:ie=>ke({...te,answer:ie.target.value==="true"}),children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]}):null,M==="matching"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Columns"}),q.map((ie,se)=>e.jsxs("div",{style:{display:"grid",gap:"0.35rem",border:"1px solid rgba(120,170,220,0.22)",borderRadius:"0.6rem",padding:"0.55rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{fontSize:"0.8rem",color:"rgba(184,209,234,0.85)"},children:["Column ",se+1]}),q.length>2?e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const oe=q.filter((W,$e)=>$e!==se),J=me.map(W=>W.filter(($e,Me)=>Me!==se));ke({...te,columns:I(oe),matchingPaths:F(J,Math.max(2,oe.length))})},children:"Remove column"}):null]}),ie.map((oe,J)=>{const W=J===ie.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"0.4rem",alignItems:"center"},children:[e.jsx("input",{type:"text",value:oe,placeholder:`Option ${J+1}`,onChange:$e=>{const Me=q.map(Ie=>[...Ie]);Me[se][J]=$e.target.value,ke({...te,columns:I(Me),matchingPaths:F(me,q.length)})}}),W?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const $e=q.map(Me=>[...Me]);$e[se]=$e[se].filter((Me,Ie)=>Ie!==J),ke({...te,columns:I($e),matchingPaths:F(me,q.length)})},children:"Remove"})]},`question-column:${se}:row:${J}`)})]},`question-column:${se}`)),e.jsx("div",{className:"cogita-form-actions",style:{justifyContent:"flex-start"},children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>{const ie=[...q.map(oe=>[...oe]),[""]],se=me.map(oe=>[...oe,""]);ke({...te,columns:I(ie),matchingPaths:F(se,ie.length)})},children:"Add column"})}),e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Correct paths (0-based indices)"}),me.map((ie,se)=>{const oe=se===me.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:`repeat(${q.length}, minmax(0,1fr)) auto`,gap:"0.35rem",alignItems:"center"},children:[ie.map((J,W)=>e.jsx("input",{type:"number",min:0,step:1,value:J,placeholder:`${W}`,onChange:$e=>{const Me=me.map(ht=>[...ht]);Me[se][W]=$e.target.value;const Ie=F(Me,q.length),nt=Ie.map(ht=>ht.map(Ye=>Ye.trim())).filter(ht=>ht.every(Ye=>Ye!=="")).map(ht=>ht.map(Ye=>Number(Ye))).filter(ht=>ht.every(Ye=>Number.isInteger(Ye)&&Ye>=0));ke({...te,matchingPaths:Ie,answer:{paths:nt}})}},`question-path:${se}:${W}`)),oe?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>{const J=me.filter((Me,Ie)=>Ie!==se),W=F(J,q.length),$e=W.map(Me=>Me.map(Ie=>Ie.trim())).filter(Me=>Me.every(Ie=>Ie!=="")).map(Me=>Me.map(Ie=>Number(Ie))).filter(Me=>Me.every(Ie=>Number.isInteger(Ie)&&Ie>=0));ke({...te,matchingPaths:W,answer:{paths:$e}})},children:"Remove"})]},`question-path:${se}`)})]}):null,M==="ordering"?e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"Ordered options (correct order = listed order)"}),N(te.options??[""]).map((ie,se,oe)=>{const J=se===oe.length-1;return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"0.5rem",alignItems:"center"},children:[e.jsxs("span",{style:{color:"rgba(184,209,234,0.75)",minWidth:"1.5rem"},children:[se+1,"."]}),e.jsx("input",{type:"text",value:ie,placeholder:`Step ${se+1}`,onChange:W=>{const $e=[...te.options??[""]];$e[se]=W.target.value,ke({...te,options:N($e)})}}),J?e.jsx("span",{}):e.jsx("button",{type:"button",className:"ghost",onClick:()=>ke({...te,options:N((te.options??[]).filter((W,$e)=>$e!==se))}),children:"Remove"})]},`question-order:${se}`)})]}):null,e.jsxs("div",{style:{display:"grid",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.82rem",color:"rgba(184,209,234,0.8)"},children:"JSON import"}),e.jsx("textarea",{rows:8,value:Re,onChange:ie=>Pe(ie.target.value),placeholder:"Paste question JSON"}),e.jsx("div",{className:"cogita-form-actions",style:{justifyContent:"flex-start"},children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>{try{const ie=JSON.parse(Re),se=Pa(ie);if(!se){L("Question JSON must be an object.");return}ke(se),L(null)}catch{L("Question JSON is invalid.")}},children:"Interpret JSON"})})]})]})]},`payload:${B.key}`)}const R=B.inputType==="textarea"||B.inputType==="json";return e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:B.label}),R?e.jsx("textarea",{rows:B.inputType==="json"?8:4,value:E,onChange:M=>m(x=>({...x,[B.key]:M.target.value})),placeholder:B.key}):e.jsx("input",{type:"text",value:E,onChange:M=>m(x=>({...x,[B.key]:M.target.value})),placeholder:B.key})]},`payload:${B.key}`)},rt=B=>{const E=k[B.key]??B.targetTypes[0],R=B.key==="references"&&B.multiple&&B.targetTypes.includes("source"),M=pe[B.key]??Fa(),x=ue[B.key]??!1,N=ce[B.key];return e.jsxs("div",{className:"cogita-field full",children:[e.jsx("span",{children:B.label}),B.targetTypes.length>1?e.jsx("select",{value:E,onChange:I=>Y(F=>({...F,[B.key]:I.target.value})),children:B.targetTypes.map(I=>e.jsx("option",{value:I,children:tt(t,I)},`${B.key}:${I}`))}):null,B.multiple?e.jsx(Qt,{libraryId:l,infoType:E,label:B.label,placeholder:B.key,multiple:!0,values:y[B.key]??[],onChangeMultiple:I=>O(F=>({...F,[B.key]:I})),allowCreate:!R,searchFailedText:"Search failed",createFailedText:"Create failed"}):e.jsx(Qt,{libraryId:l,infoType:E,label:B.label,placeholder:B.key,value:ae[B.key]??null,onChange:I=>_(F=>({...F,[B.key]:I})),searchFailedText:"Search failed",createFailedText:"Create failed"}),R?e.jsxs("div",{children:[e.jsxs("label",{className:"cogita-field",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:x,onChange:I=>$(F=>({...F,[B.key]:I.target.checked}))}),e.jsx("span",{children:t.cogita.library.add.info.referenceToggle})]}),x?e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.add.info.referenceTitle}),e.jsx(fs,{libraryId:l,copy:t,language:v,sourceKindOptions:[...bs],value:M,onChange:I=>U(F=>({...F,[B.key]:I})),labels:gt}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:()=>We(B.key),disabled:xe===B.key,children:xe===B.key?t.cogita.library.lookup.saving:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.source)})}),N?e.jsx("p",{className:"cogita-library-subtitle",children:N}):null]}):null]}):null]},`link:${B.key}`)},qe=()=>e.jsxs("div",{className:"cogita-library-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.add.info.referenceTitle}),e.jsx(fs,{libraryId:l,copy:t,language:v,sourceKindOptions:[...bs],value:je,onChange:Oe,labels:gt})]});return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:d?"Edit info":"Create info"}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:"Specification-driven editor"})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:`/#/cogita/library/${l}/list`,children:"Back to list"})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("article",{className:"cogita-library-panel",children:[d?null:e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Info type"}),e.jsx("select",{value:C,onChange:B=>z(B.target.value),children:it.map(B=>e.jsx("option",{value:B.value,children:B.label},B.value))})]}),le==="loading"&&d?e.jsx("p",{children:"Loading..."}):null,Le&&!(le==="loading"&&d)?e.jsxs("div",{className:"cogita-form-grid",children:[Le.payloadFields.filter(B=>!(C==="source"&&(B.key==="sourceKind"||B.key==="locator"))).map(et),C==="source"?qe():null,Le.linkFields.filter(B=>!(C==="source"&&B.key==="resource")).map(rt)]}):le==="loading"&&d?null:e.jsx("p",{children:"No specification found for this info type."}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:Be,disabled:le==="saving"||!Le,children:le==="saving"?"Saving...":d?"Update info":"Create info"})}),K?e.jsx("p",{className:"cogita-library-subtitle",children:K}):null]})})})]})})}const ks=t=>/\s/.test(t),en=t=>/[\p{L}\p{N}]/u.test(t),Ns=(t,n)=>{const s=n>0?t[n-1]:"",i=n<t.length?t[n]:"";if(!s||!i)return 0;const o=ks(s),u=ks(i);if(o||u)return 3;const h=en(s),j=en(i);return h!==j?2:!h&&!j?1:0},In=(t,n,s,i,o)=>{const u=Math.max(i-n,s-i);for(let h=0;h<=u;h+=1){const j=i-h;if(j>=n&&j<=s&&Ns(t,j)>=o)return j;const v=i+h;if(v>=n&&v<=s&&Ns(t,v)>=o)return v}return null},Mn=(t,n)=>{const s=n>0?t[n-1]:"",i=n<t.length?t[n]:"";return!s||!i?!0:en(s)!==en(i)},li=(t,n,s,i)=>{const o=s-n,u=n+i,h=s-i;if(o<=i*2||h<=u)return null;const j=Math.floor((n+s)/2),v=In(t,u,h,j,3);if(v!==null&&Mn(t,v))return v;const S=In(t,u,h,j,2);if(S!==null&&Mn(t,S))return S;const l=In(t,u,h,j,1);return l!==null&&Mn(t,l)?l:null},ka=(t,n)=>{const s=Math.max(1,7),i=Math.max(s,13),o={},u=(v,S,l,f,c)=>{const d=String(f),w={id:d,start:v,end:S,text:t.slice(v,S),depth:l,index:f,parentId:c};if(o[d]=w,S-v>i){let C=li(t,v,S,s);if(C!==null&&C>v&&C<S){const z=u(v,C,l+1,f*2+1,d),b=u(C,S,l+1,f*2+2,d);w.leftId=z.id,w.rightId=b.id}}return w},h=u(0,t.length,0,0),j=Object.values(o).sort((v,S)=>S.depth-v.depth||v.start-S.start).map(v=>v.id);return{text:t,rootId:h.id,nodes:o,order:j}},Ia=(t,n,s,i,o,u,h)=>{const j=u==="reverse"?t.order.slice().sort((v,S)=>t.nodes[S].start-t.nodes[v].start||t.nodes[S].depth-t.nodes[v].depth):t.order;for(const v of j){if(h&&v===h||n.has(v))continue;const S=t.nodes[v];if(S){if(o&&(S.leftId||S.rightId)){const l=S.leftId?s[S.leftId]??0:i,f=S.rightId?s[S.rightId]??0:i;if((l+f)/2<i)continue}return S}}return null},Hn=(t,n)=>({before:t.slice(0,n.start),fragment:t.slice(n.start,n.end),after:t.slice(n.end)});function ci({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l}){const f=`/#/cogita/library/${l}`,[c,d,w]=Bn([]),[p,C,z]=Vn([]),[b,m]=a.useState(null),[ae,_]=a.useState(null),[y,O]=a.useState(null),[k,Y]=a.useState(null),K=a.useMemo(()=>c.find($=>$.id===b)??null,[c,b]);a.useEffect(()=>{let $=!0;return lr({libraryId:l}).then(pe=>{if(!$)return;const U=pe.nodes.map(ce=>{var G,xe,re;return{id:ce.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:ce.payload&&typeof ce.payload=="object"&&"label"in ce.payload?String(ce.payload.label):"Item",nodeType:ce.nodeType,itemType:((G=ce.payload)==null?void 0:G.itemType)??"info",itemId:((xe=ce.payload)==null?void 0:xe.itemId)??null,infoType:((re=ce.payload)==null?void 0:re.infoType)??null}}});d(U),C(pe.edges.map(ce=>({id:ce.edgeId,source:ce.fromNodeId,target:ce.toNodeId})))}).catch(()=>{$&&(d([]),C([]))}),()=>{$=!1}},[l]),a.useEffect(()=>{cr({libraryId:l}).then(_).catch(()=>_(null))},[l,c,p]);const L=a.useCallback($=>{C(pe=>On($,pe))},[]),le=()=>{const $=crypto.randomUUID();d(pe=>[...pe,{id:$,type:"default",position:{x:140+pe.length*40,y:120+pe.length*30},data:{label:t.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},ge=()=>{const $=crypto.randomUUID();d(pe=>[...pe,{id:$,type:"default",position:{x:180+pe.length*40,y:160+pe.length*30},data:{label:t.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},je=async()=>{O(null);try{const $=c.map(U=>({nodeId:U.id,nodeType:U.data.nodeType,payload:{itemType:U.data.itemType,itemId:U.data.itemId??null,label:U.data.label,infoType:U.data.infoType??null}})),pe=p.map(U=>({edgeId:U.id,fromNodeId:U.source,toNodeId:U.target}));await dr({libraryId:l,nodes:$,edges:pe}),O(t.cogita.library.graph.saveSuccess)}catch{O(t.cogita.library.graph.saveFail)}},Oe=$=>{K&&d(pe=>pe.map(U=>U.id===K.id?{...U,data:{...U.data,itemId:($==null?void 0:$.infoId)??null,itemType:"collection",infoType:"collection",label:($==null?void 0:$.label)??t.cogita.library.infoTypes.collection}}:U))},ue=$=>{K&&d(pe=>pe.map(U=>U.id===K.id?{...U,data:{...U.data,itemId:($==null?void 0:$.infoId)??null,itemType:"info",infoType:($==null?void 0:$.infoType)??null,label:($==null?void 0:$.label)??t.cogita.library.infoTypes.any}}:U))};return a.useEffect(()=>{if(!K||K.data.nodeType!=="info"||K.data.infoType!=="citation"||!K.data.itemId){Y(null);return}let $=!0;return ua({libraryId:l,infoId:K.data.itemId}).then(pe=>{if(!$)return;const U=pe.payload,ce=(U==null?void 0:U.text)??"";if(!ce){Y(null);return}const G=ka(ce),xe=Object.values(G.nodes).sort((re,te)=>re.depth-te.depth||re.start-te.start).map(re=>({id:re.id,text:re.text,depth:re.depth}));Y({title:(U==null?void 0:U.title)??K.data.label,fragments:xe})}).catch(()=>Y(null)),()=>{$=!1}},[l,K]),e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:t.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:f,children:t.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:je,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:le,children:t.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ge,children:t.cogita.library.actions.addInfo}),ae?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(ae.totalCollections))})}):null,y?e.jsx("p",{className:"cogita-help",children:y}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(un,{nodes:c,edges:p,onNodesChange:w,onEdgesChange:z,onConnect:L,onNodeClick:($,pe)=>m(pe.id),fitView:!0,children:[e.jsx(hn,{gap:18,size:1}),e.jsx(gn,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),K?e.jsxs("div",{className:"cogita-graph-inspector",children:[K.data.nodeType==="collection"?e.jsx(Qt,{libraryId:l,infoType:"collection",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:K.data.itemId?{id:K.data.itemId,label:K.data.label,infoType:"collection"}:null,onChange:Oe,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.collection),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}):e.jsx(Qt,{libraryId:l,infoType:"any",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:K.data.itemId?{id:K.data.itemId,label:K.data.label,infoType:K.data.infoType??void 0}:null,onChange:ue,searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.any),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),k?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:k.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:k.fragments.map($=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:$.id}),e.jsx("span",{children:$.text})]},$.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}function Wn({children:t,flashState:n,flashTick:s=0,feedbackToken:i,className:o}){const u=i??(n?`${n}-${s}`:"idle");return e.jsx("section",{className:o?`cogita-revision-card ${o}`:"cogita-revision-card","data-feedback":u,children:t})}function Qn({copy:t,currentCard:n,currentTypeLabel:s,prompt:i,languages:o,answer:u,onAnswerChange:h,computedExpected:j,computedAnswers:v,onComputedAnswerChange:S,answerTemplate:l,outputVariables:f,variableValues:c,computedFieldFeedback:d,feedback:w,canAdvance:p,quoteContext:C,quotePlaceholder:z,onCheckAnswer:b,onSkip:m,onLanguageSelect:ae,onMarkReviewed:_,onAdvance:y,showCorrectAnswer:O,setShowCorrectAnswer:k,onRevealCorrect:Y,answerMask:K,expectedAnswer:L,hasExpectedAnswer:le,handleComputedKeyDown:ge,answerInputRef:je,computedInputRefs:Oe,scriptMode:ue,setScriptMode:$,matchPairs:pe,matchLeftOrder:U,matchRightOrder:ce,matchSelection:G,matchActiveLeft:xe,matchActiveRight:re,matchFeedback:te,onMatchLeftSelect:Se,onMatchRightSelect:Re,disableCheckAnswer:Pe=!1,hideSkipAction:Le=!1,allowRevealBeforeCheck:Ge=!1,autoRevealAfterAnswer:it=!1,disableCheckAfterAnswer:ke=!1}){const Ue=a.useMemo(()=>{var se;const E=!l&&j.length===2?`The {${j[0].key}} is of type {${j[1].key}}`:null,R=l??E;if(!R)return null;const M=new Map(j.map(oe=>[oe.key,oe.expected])),x=new Set,N=[],I=/\{([^}]+)\}/g;let F=0,V,q=null;for(;(V=I.exec(R))!==null;){const oe=R.slice(F,V.index);oe&&N.push({type:"text",value:oe});const J=((se=V[1])==null?void 0:se.trim())??"",W=J&&M.has(J)?J:J&&f&&f[J]?f[J]:null;J&&x.add(J),W&&x.add(W),W&&M.has(W)?(N.push({type:"input",value:W}),q||(q=W)):J&&c&&c[J]!==void 0?N.push({type:"text",value:c[J]}):N.push({type:"text",value:V[0]}),F=V.index+V[0].length}const me=R.slice(F);return me&&N.push({type:"text",value:me}),j.filter(oe=>!x.has(oe.key)).length>0?null:{parts:N,expectedByKey:M,firstInputKey:q}},[l,j,f,c]),gt=()=>{if(!Ue)return null;const{parts:E,expectedByKey:R,firstInputKey:M}=Ue;return e.jsx("div",{className:"cogita-revision-inline-answer",children:E.map((x,N)=>{var I,F;return x.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:x.value},`text-${N}`):e.jsx("input",{ref:V=>{Oe.current[x.value]=V},autoFocus:x.value===M,value:v[x.value]??"",onChange:V=>S(x.value,V.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":d[x.value]??(w==="correct"?"correct":w==="incorrect"?"incorrect":void 0),onKeyDown:V=>rt(V)||ge(V),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,((I=v[x.value])==null?void 0:I.length)??0,((F=R.get(x.value))==null?void 0:F.length)??6)}ch`}},`input-${x.value}-${N}`)})})},We=a.useMemo(()=>{const E=new Map;return(pe??[]).forEach(R=>E.set(R.leftId,R)),E},[pe]),Be=a.useMemo(()=>{const E=new Map;return(pe??[]).forEach(R=>E.set(R.rightId,R)),E},[pe]);a.useEffect(()=>{var N;if(n.cardType!=="info"||n.infoType!=="computed"||j.length===0)return;const E=typeof document<"u"?document.activeElement:null;if(E&&(E.tagName==="INPUT"||E.tagName==="TEXTAREA"))return;const R=(Ue==null?void 0:Ue.firstInputKey)??((N=j[0])==null?void 0:N.key);if(!R)return;const M=Oe.current[R];if(!M)return;const x=requestAnimationFrame(()=>{M.focus()});return()=>cancelAnimationFrame(x)},[n,j,Ue]);const et=(()=>{const E=[L??"",...j.map(x=>x.expected??"")].join(""),R=[u,...Object.values(v)].join(""),M=`${E}${R}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(M)})(),rt=E=>E.ctrlKey&&(E.key==="^"||E.key==="6")?(E.preventDefault(),$(R=>R==="super"?null:"super"),!0):E.ctrlKey&&(E.key==="_"||E.key==="-")?(E.preventDefault(),$(R=>R==="sub"?null:"sub"),!0):!1,qe=()=>{if(!L||!K)return L??"";const E=L.split(""),R=Array.from(K),M=R.length>0?R.reduce((x,N)=>x+N,0)/R.length:127;return E.map((x,N)=>{const I=R[N]??M,F=Math.max(0,Math.min(255,Math.round(I)));let V=255,q=0;return F<=127?q=Math.round(F/127*255):(q=255,V=Math.round(255*(1-(F-127)/128))),e.jsx("span",{style:{color:`rgb(${V}, ${q}, 0)`},children:x},`mask-${N}`)})},Ne=n.cardType==="info"&&n.infoType==="citation"?(C==null?void 0:C.title)||n.label:n.description,Te=O||it&&w!==null,ze=Pe||ke&&(w!==null||Te),B=le&&(Ge||w==="incorrect"||Te);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[s?e.jsx("span",{children:s}):null,e.jsx("strong",{children:Ne})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&pe?e.jsxs("div",{className:"cogita-revision-body",children:[i?e.jsx("h2",{children:i}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(U??[]).map(E=>{const R=We.get(E);if(!R)return null;const M=(G==null?void 0:G[E])??null,x=(te==null?void 0:te[E])??null,N=xe===E;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":N,"data-state":x??void 0,"data-locked":M?"true":void 0,onClick:()=>Se==null?void 0:Se(E),children:[e.jsx("span",{children:R.leftLabel}),M&&O?e.jsx("em",{children:"✓"}):null]},E)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(ce??[]).map(E=>{const R=Be.get(E);if(!R)return null;const M=Object.values(G??{}).includes(E),x=re===E;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":M||x,"data-locked":M?"true":void 0,onClick:()=>Re==null?void 0:Re(E),children:e.jsx("span",{children:R.rightLabel})},E)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:n.checkType==="translation-match"||ze,children:t.cogita.library.revision.checkAnswer}),Le?null:e.jsx("button",{type:"button",className:"ghost",onClick:m,children:t.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:je,value:u,onChange:E=>h(E.target.value),placeholder:t.cogita.library.revision.answerPlaceholder,"data-state":w==="correct"?"correct":w==="incorrect"?"incorrect":void 0,onKeyDown:E=>{if(E.key==="Enter")if(E.preventDefault(),E.stopPropagation(),p)y();else{if(ze)return;b()}}})]}),et?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ue==="super",onClick:()=>$(E=>E==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ue==="sub",onClick:()=>$(E=>E==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:ze,children:t.cogita.library.revision.checkAnswer}),Le?null:e.jsx("button",{type:"button",className:"ghost",onClick:m,children:t.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,l?null:e.jsx(ur,{value:i??"",mode:"auto"}),j.length>0?(()=>{const E=gt();return E?e.jsx("div",{className:"cogita-inline-answer-wrap",children:E}):e.jsx("div",{className:"cogita-form-grid",children:j.map((R,M)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:R.key}),e.jsx("textarea",{ref:x=>{Oe.current[R.key]=x},autoFocus:M===0,value:v[R.key]??"",onChange:x=>S(R.key,x.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":d[R.key]??(w==="correct"?"correct":w==="incorrect"?"incorrect":void 0),onKeyDown:x=>rt(x)||ge(x)})]},R.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:je,value:u,onChange:E=>h(E.target.value),placeholder:t.cogita.library.revision.answerPlaceholderComputed,"data-state":w==="correct"?"correct":w==="incorrect"?"incorrect":void 0,onKeyDown:E=>{if(!rt(E)&&E.key==="Enter")if(E.preventDefault(),E.stopPropagation(),p)y();else{if(ze)return;b()}}})]})}),et?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":ue==="super",onClick:()=>$(E=>E==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":ue==="sub",onClick:()=>$(E=>E==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:ze,children:t.cogita.library.revision.checkAnswer}),Le?null:e.jsx("button",{type:"button",className:"ghost",onClick:m,children:t.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="citation"&&C?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.quoteProgress.replace("{done}",String(C.completed)).replace("{total}",String(C.total))}),e.jsx("p",{className:"cogita-quote-text",children:C.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.answerLabel}),e.jsx("input",{ref:je,value:u,onChange:E=>h(E.target.value),placeholder:z??t.cogita.library.revision.quoteMissingPlaceholder,"data-state":w==="correct"?"correct":w==="incorrect"?"incorrect":void 0,onKeyDown:E=>{if(E.key==="Enter")if(E.preventDefault(),E.stopPropagation(),p)y();else{if(ze)return;b()}}})]}),e.jsx("p",{className:"cogita-quote-text",children:C.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:ze,children:t.cogita.library.revision.checkAnswer}),Le?null:e.jsx("button",{type:"button",className:"ghost",onClick:m,children:t.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:o.length?o.map(E=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ae(E.label),children:E.label},E.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:t.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:m,children:t.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:i}),e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:_,children:t.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:m,children:t.cogita.library.revision.skip})]})]}),w&&e.jsx("div",{className:"cogita-revision-feedback","data-state":w,children:w==="correct"?t.cogita.library.revision.correct:t.cogita.library.revision.tryAgain}),B?e.jsxs("div",{className:"cogita-revision-reveal",children:[Te?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>k(E=>{const R=!E;return R&&Y(),R}),children:t.cogita.library.revision.showAnswer}),Te?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.correctAnswerLabel}),j.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[j.map(E=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:E.key}),e.jsx("span",{children:E.expected})]},E.key)),L?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:L})]}):null]}):e.jsx("p",{children:K?qe():L})]}):null]}):null,p?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:y,children:t.cogita.library.revision.nextQuestion})}):null]})}const Ss={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},di=(t,n)=>{const s=Math.max(t.length,n.length,1),i=Math.abs(t.length-n.length);return Math.max(0,1-i/s)},ui=(t,n)=>{const s=new Uint8Array(t.length),i=di(t,n);for(let o=0;o<t.length;o+=1){const u=t[o]===(n[o]??"")?128:0,h=t.length-1-o,j=n.length-1-o,v=t[h]===(n[j]??"")?127:0,S=Math.round((u+v)*i);s[o]=Math.max(0,Math.min(255,S))}return s},hi=(t,n)=>t===n||(Ss[t]??[]).includes(n)?!0:(Ss[n]??[]).includes(t),Ha=(t,n,s)=>s?hi(t,n):t===n,tn=(t,n,s)=>{const i=new Uint8Array(t.length);if(!t.length)return i;const o=(s==null?void 0:s.allowSimilarChars)??!0,u=[];for(let j=0;j<=t.length-3;j+=1)u.push({index:j,text:t.slice(j,j+3)});let h=!1;return u.forEach(j=>{for(let v=0;v<=n.length-3;v+=1){const S=n.slice(v,v+3);let l=0;for(let p=0;p<3;p+=1)Ha(j.text[p],S[p],o)&&(l+=1);if(l<2)continue;let f=j.index-1,c=v-1;for(;f>=0&&c>=0;){const p=t[f],C=n[c];if(p===C){i[f]=Math.max(i[f],255),f-=1,c-=1,h=!0;continue}if(Ha(p,C,o)&&p!==C){i[f]=Math.max(i[f],127),f-=1,c-=1,h=!0;continue}if(f>0&&t[f-1]===C){i[f]=Math.max(i[f],0),f-=1,h=!0;continue}if(c>0&&t[f]===n[c-1]){c-=1,h=!0;continue}break}for(let p=0;p<3;p+=1){const C=j.index+p,z=j.text[p],b=S[p],m=z===b?255:Ha(z,b,o)?127:0;i[C]=Math.max(i[C],m),h=!0}let d=j.index+3,w=v+3;for(;d<t.length&&w<n.length;){const p=t[d],C=n[w];if(p===C){i[d]=Math.max(i[d],255),d+=1,w+=1,h=!0;continue}if(Ha(p,C,o)&&p!==C){i[d]=Math.max(i[d],127),d+=1,w+=1,h=!0;continue}if(d+1<t.length&&t[d+1]===C){i[d]=Math.max(i[d],0),d+=1,h=!0;continue}if(w+1<n.length&&t[d]===n[w+1]){w+=1,h=!0;continue}break}}}),h?i:ui(t,n)},Ln=t=>/[\p{L}\p{N}]/u.test(t),Ts=t=>t.trim().toLowerCase(),ya=(t,n)=>{if(t.length===0)return 100;const s=(n==null?void 0:n.treatSimilarCharsAsSame)??!1,i=Array.from(t).reduce((o,u)=>s&&u===127?o+255:o+u,0);return Math.round(i/(t.length*255)*100)},an=(t,n,s)=>{const i=Math.max(0,Math.min(100,(s==null?void 0:s.thresholdPercent)??100)),o=(s==null?void 0:s.treatSimilarCharsAsSame)??!0,u=(s==null?void 0:s.ignorePunctuationAndSpacing)??!1,h=Ts(t),j=Ts(n);if(!u){const b=tn(h,j,{allowSimilarChars:o}),m=ya(b,{treatSimilarCharsAsSame:o});return{mask:b,percent:m,isCorrect:m>=i,normalizedExpected:h,normalizedAnswer:j}}const v=Array.from(h),S=Array.from(j),l=[],f=[],c=[];v.forEach((b,m)=>{Ln(b)&&(l.push(b),f.push(m))}),S.forEach(b=>{Ln(b)&&c.push(b)});const d=l.join(""),w=c.join(""),p=tn(d,w,{allowSimilarChars:o}),C=new Uint8Array(v.length);for(let b=0;b<C.length;b+=1)C[b]=Ln(v[b]??"")?0:255;for(let b=0;b<p.length;b+=1){const m=f[b];m!==void 0&&(C[m]=p[b])}const z=ya(p,{treatSimilarCharsAsSame:o});return{mask:C,percent:z,isCorrect:z>=i,normalizedExpected:d,normalizedAnswer:w}},Ma=(t,n,s)=>{const i=t.trim().toLowerCase(),o=n.trim().toLowerCase();return s==="prefix"||s==="bidirectional"?tn(i,o,{allowSimilarChars:!0}):tn(i,o,{allowSimilarChars:!0})};function la(t){return[t.cardId,t.checkType??"",t.direction??""].join("|")}function Cs(t){return[t.parentItemId,t.parentCheckType??"",t.parentDirection??""].join("|")}function Is(t){const n=t.checkType??"info";return t.direction?`${n} / ${t.direction}`:n}function gi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,infoId:f,selectedReviewerRoleId:c}){const[d,w]=a.useState(f),[p,C]=a.useState([]),[z,b]=a.useState([]),[m,ae]=a.useState("loading"),[_,y]=a.useState(null),[O,k]=a.useState(null),[Y,K]=a.useState(null),[L,le]=a.useState(null),[ge,je]=a.useState(""),[Oe,ue]=a.useState(null),[$,pe]=a.useState(1),[U,ce]=a.useState(null),[G,xe]=a.useState(0),[re,te]=a.useState(!1),[Se,Re]=a.useState(null),[Pe,Le]=a.useState({}),[Ge,it]=a.useState({}),[ke]=a.useState({}),[Ue,gt]=a.useState(null),We=a.useRef(null),Be=a.useRef({}),et=dn();a.useEffect(()=>{let F=!1;return ae("loading"),Promise.all([ua({libraryId:l,infoId:f}).catch(()=>null),Ga({libraryId:l,infoId:f}),Ya({libraryId:l,infoId:f})]).then(([V,q,me])=>{if(F)return;const ie=(V==null?void 0:V.payload)??{},se=typeof ie.title=="string"&&ie.title||typeof ie.label=="string"&&ie.label||typeof ie.name=="string"&&ie.name||f;w(se),k(ie),K((V==null?void 0:V.infoType)??null),C(q.items),b(me.items),ae("ready")}).catch(()=>{F||(k(null),K(null),C([]),b([]),ae("error"))}),()=>{F=!0}},[l,f]),a.useEffect(()=>{if(Y!=="translation"){le(null);return}Ps({libraryId:l,infoId:f,approachKey:"vocab-card"}).then(F=>le(F.projection??null)).catch(()=>le(null))},[Y,f,l]);const rt=a.useMemo(()=>{var oe;const F=new Map(p.map(J=>[la(J),J])),V=new Map,q=new Map;for(const J of p)V.set(la(J),0),q.set(la(J),[]);for(const J of z){const W=Cs({parentItemId:J.parentItemId,parentCheckType:J.parentCheckType,parentDirection:J.parentDirection}),$e=[J.childItemId,J.childCheckType??"",J.childDirection??""].join("|");!F.has(W)||!F.has($e)||((oe=q.get(W))==null||oe.push($e),V.set($e,(V.get($e)??0)+1))}const me=Array.from(V.entries()).filter(([,J])=>J===0).map(([J])=>J),ie=new Map;for(const J of me)ie.set(J,0);for(;me.length;){const J=me.shift(),W=ie.get(J)??0;for(const $e of q.get(J)??[]){const Me=Math.max(ie.get($e)??0,W+1);ie.set($e,Me),V.set($e,(V.get($e)??1)-1),(V.get($e)??0)<=0&&me.push($e)}}const se=new Map;for(const J of p){const W=la(J),$e=ie.get(W)??0,Me=se.get($e)??[];Me.push(W),se.set($e,Me)}return p.map(J=>{const W=la(J),$e=ie.get(W)??0,Me=se.get($e)??[W],Ie=Math.max(0,Me.indexOf(W));return{id:W,position:{x:40+Ie*290+($e%2?18:0),y:30+$e*120},draggable:!1,selectable:!0,data:{label:J.label,subtitle:Is(J),checkType:J.checkType??"info",direction:J.direction??null},style:{width:250,borderRadius:10,border:"1px solid rgba(120,170,220,0.22)",background:"rgba(8,20,34,0.88)",color:"#e8f2ff",padding:8}}})},[p,z]),qe=a.useMemo(()=>new Map(p.map(F=>[la(F),F])),[p]),Ne=a.useMemo(()=>{const F=[];for(const V of z){const q=Cs({parentItemId:V.parentItemId,parentCheckType:V.parentCheckType,parentDirection:V.parentDirection}),me=[V.childItemId,V.childCheckType??"",V.childDirection??""].join("|");!qe.has(q)||!qe.has(me)||F.push({id:`${q}->${me}`,source:q,target:me,selectable:!1,animated:!1,style:{stroke:"rgba(148, 202, 248, 0.7)"}})}return F},[qe,z]),Te=a.useMemo(()=>_?qe.get(_)??null:null,[qe,_]);a.useEffect(()=>{je(""),ce(null),xe(0),te(!1),Re(null),ue(null),it({})},[_]);const ze=a.useMemo(()=>{var ie,se;if(!Te)return null;const F=Y??Te.infoType??null,V=Te.checkType??"info",q=Te.direction??null,me=O??{};if(Te.cardType==="vocab"&&L&&Array.isArray(L.words)){const oe=L.words,J=((ie=oe[0])==null?void 0:ie.label)??"?",W=((se=oe[1])==null?void 0:se.label)??"?";return q==="a-to-b"?{kind:"vocab",prompt:String(J),expected:String(W)}:q==="b-to-a"?{kind:"vocab",prompt:String(W),expected:String(J)}:{kind:"generic",prompt:`${J} ↔ ${W}`,expected:`${J} ↔ ${W}`}}if(F==="citation"&&V==="quote-fragment"&&q&&typeof me.text=="string"){const oe=q,J=ka(me.text),W=J.nodes[oe];if(W){const $e=Hn(me.text,W);return{kind:"citation-fragment",expected:W.text,quoteContext:{title:d,before:$e.before,after:$e.after,total:Object.keys(J.nodes).length,completed:0},quotePlaceholder:W.text.length>0?".".repeat(Math.max(4,Math.min(18,W.text.length))):"..."}}}return{kind:"generic",prompt:Te.description||Te.label,expected:Te.label}},[Y,O,Te,d,L]),B=async F=>{if(Te&&c)try{await hr({libraryId:l,outcome:{itemType:"info",itemId:Te.cardId,checkType:Te.checkType??"info",direction:Te.direction??null,revisionType:"direct",evalType:"direct-check",correct:F,clientId:"cogita-info-checkcards",clientSequence:$,personRoleId:c}}),pe(V=>V+1),ue(F?"Saved as correct.":"Saved as incorrect.")}catch{ue("Failed to save answer.")}},E=Te?la(Te):null,R=E?!!Pe[E]:!1,M=async()=>{if(!Te||!ze)return;const F=la(Te);if(Pe[F]){ue("This card was already checked.");return}const V=ze.expected,q=ze.kind==="citation-fragment",me=an(V,ge,{thresholdPercent:q?90:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:q}),ie=me.isCorrect;ce(ie?"correct":"incorrect"),xe(se=>se+1),Re(me.mask),te(!0),ue(c?null:"Answer checked locally (not saved: no person selected)."),Le(se=>({...se,[F]:!0})),c&&await B(ie)},x=()=>{if(!Te||!ze)return;const F=la(Te);Pe[F]||(Le(q=>({...q,[F]:!0})),ue("Answer revealed (not saved)."));const V=an(ze.expected,ze.expected,{thresholdPercent:100,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:ze.kind==="citation-fragment"});Re(V.mask)},N=a.useMemo(()=>Te?Te.infoType==="citation"?{...Te,description:d}:{...Te,description:Te.label}:null,[Te,d]),I=a.useMemo(()=>Y?tt(t,Y):t.cogita.library.infoTypes.any,[t,Y]);return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-info-checkcards-page",children:[e.jsxs("header",{className:"cogita-info-checkcards-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:I}),e.jsx("h2",{className:"cogita-card-title",children:d}),e.jsx("p",{className:"cogita-card-subtitle",children:f})]}),e.jsxs("div",{className:"cogita-selection-overview",children:[e.jsx("span",{className:"cogita-tag-chip",children:`Cards: ${p.length}`}),e.jsx("span",{className:"cogita-tag-chip",children:`Dependencies: ${z.length}`}),e.jsx("button",{type:"button",className:"cta",disabled:p.length===0,onClick:()=>et(`/cogita/library/${l}/revision/run?libraryTarget=revisions&scope=info&infoId=${encodeURIComponent(f)}`),children:"Start revision"})]})]}),m==="loading"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Loading checkcards..."})}):m==="error"?e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:"Failed to load checkcards."})}):e.jsxs("div",{className:"cogita-info-checkcards-layout",children:[e.jsxs("div",{className:"cogita-info-checkcards-main",children:[e.jsx("div",{className:"cogita-info-checkcards-graph",children:e.jsxs(un,{nodes:rt,edges:Ne,fitView:!0,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!0,onNodeClick:(F,V)=>y(V.id),panOnDrag:!0,children:[e.jsx(hn,{}),e.jsx(gn,{showInteractive:!1})]})}),Te?e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[ze&&N?e.jsx(Wn,{flashState:U,flashTick:G,children:e.jsx(Qn,{copy:t,currentCard:N,currentTypeLabel:"",prompt:ze.kind==="citation-fragment"?null:ze.prompt,languages:[],answer:ge,onAnswerChange:je,computedExpected:[],computedAnswers:Ge,onComputedAnswerChange:(F,V)=>it(q=>({...q,[F]:V})),answerTemplate:null,outputVariables:null,variableValues:null,computedFieldFeedback:ke,feedback:U,canAdvance:!1,quoteContext:ze.kind==="citation-fragment"?ze.quoteContext:null,quotePlaceholder:ze.kind==="citation-fragment"?ze.quotePlaceholder:null,onCheckAnswer:()=>void M(),onSkip:()=>y(null),onLanguageSelect:()=>{},onMarkReviewed:()=>{},onAdvance:()=>{},showCorrectAnswer:re,setShowCorrectAnswer:te,onRevealCorrect:x,answerMask:Se,expectedAnswer:ze.expected,hasExpectedAnswer:!0,handleComputedKeyDown:()=>{},answerInputRef:We,computedInputRefs:Be,scriptMode:Ue,setScriptMode:gt,matchPairs:void 0,matchLeftOrder:void 0,matchRightOrder:void 0,matchSelection:void 0,matchActiveLeft:null,matchActiveRight:null,matchFeedback:void 0,onMatchLeftSelect:void 0,onMatchRightSelect:void 0,disableCheckAnswer:R||re,hideSkipAction:!0,allowRevealBeforeCheck:!0,autoRevealAfterAnswer:!0,disableCheckAfterAnswer:!0})}):null,c?null:e.jsx("p",{className:"cogita-library-hint",children:"Result can be checked without a person; saving knowness requires a selected person in the header."}),Oe?e.jsx("p",{className:"cogita-library-hint",children:Oe}):null]}):e.jsxs("div",{className:"cogita-info-checkcards-selected",children:[e.jsx("h4",{children:"Select a checking card"}),e.jsx("p",{className:"cogita-card-subtitle",children:"Choose a node in the dependency tree to preview and answer it."})]})]}),e.jsxs("aside",{className:"cogita-info-checkcards-panel",children:[e.jsx("h3",{children:"Checking cards"}),e.jsx("div",{className:"cogita-info-tree",children:p.map(F=>{const V=la(F),q=_===V;return e.jsxs("button",{type:"button",className:`ghost cogita-checkcard-row ${q?"active":""}`,onClick:()=>y(V),children:[e.jsx("span",{children:F.label}),e.jsx("small",{children:Is(F)})]},V)})})]})]})]})})})})})}function Wa(t,n){var s,i;return((i=(s=t.fields.find(o=>o.fieldType===n))==null?void 0:s.plainValue)==null?void 0:i.trim())??""}function mi(t){return Wa(t,"role_kind").toLowerCase()==="person"}function pi(t){return Wa(t,"label")||Wa(t,"display_name")||Wa(t,"name")||t.roleId}function fi({copy:t,onPersonCreated:n}){const[s,i]=a.useState([]),[o,u]=a.useState("loading"),[h,j]=a.useState(null),[v,S]=a.useState(!1),[l,f]=a.useState(""),c=async()=>{u("loading");try{const p=await Fs();i(p),u("ready")}catch{i([]),u("error")}};a.useEffect(()=>{c()},[]);const d=a.useMemo(()=>s.filter(mi).map(p=>({roleId:p.roleId,label:pi(p)})).sort((p,C)=>p.label.localeCompare(C.label)),[s]),w=async()=>{const p=l.trim();if(!p){j("Name is required.");return}S(!0),j(null);try{const C=await gr({fields:[{fieldType:"role_kind",plainValue:"person"},{fieldType:"label",plainValue:p},{fieldType:"display_name",plainValue:p}]});f(""),j("Person role created."),n==null||n(C.roleId),await c()}catch{j("Failed to create person role.")}finally{S(!1)}};return e.jsx("section",{className:"cogita-library-dashboard","data-mode":"detail",children:e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-browser-panel",children:[e.jsx("div",{className:"cogita-info-overview-head",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Cogita"}),e.jsx("h2",{className:"cogita-card-title",children:"Persons"}),e.jsx("p",{className:"cogita-card-subtitle",children:"Select reviewer persons in the header and create new person roles here."})]})}),e.jsxs("div",{className:"cogita-info-overview-panels",children:[e.jsxs("article",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Create"}),e.jsx("h3",{className:"cogita-detail-title",children:"New person role"})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{type:"text",value:l,onChange:p=>f(p.target.value),placeholder:"e.g. Anna Kowalska",disabled:v})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:w,disabled:v,children:v?"Creating...":"Create person"})}),h?e.jsx("p",{className:"cogita-library-hint",children:h}):null]})]}),e.jsxs("article",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:"Overview"}),e.jsx("h3",{className:"cogita-detail-title",children:"All person roles"})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[o==="loading"?e.jsx("p",{children:"Loading persons..."}):null,o==="error"?e.jsx("p",{children:"Failed to load persons."}):null,o==="ready"&&d.length===0?e.jsx("p",{children:"No person roles found."}):null,o==="ready"&&d.length>0?e.jsxs("div",{className:"cogita-details-grid",children:[e.jsxs("div",{className:"cogita-details-grid-head",role:"row",children:[e.jsx("span",{}),e.jsx("span",{children:"Name"}),e.jsx("span",{children:"Type"}),e.jsx("span",{children:"Role ID"}),e.jsx("span",{})]}),d.map(p=>e.jsxs("div",{className:"cogita-details-row",role:"row",children:[e.jsx("span",{}),e.jsx("span",{title:p.label,children:p.label}),e.jsx("span",{children:"person"}),e.jsx("span",{title:p.roleId,children:p.roleId}),e.jsx("span",{})]},p.roleId))]}):null]})]})]})]})})})})}function bi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,collectionId:f}){const{libraryName:c}=ha(l),[d,w]=a.useState([]),[p,C]=a.useState("loading"),[z,b]=a.useState("idle"),m=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ae=`/#/cogita/library/${l}`,_=()=>{C("loading"),Ds({libraryId:l}).then(k=>{w(k),C("idle")}).catch(()=>{w([]),C("error")})};a.useEffect(()=>{_()},[l]);const y=async k=>{try{await zs({libraryId:l,shareId:k}),_()}catch{_()}},O=async k=>{const Y=`${m}/${k}`;try{await navigator.clipboard.writeText(Y),b("copied")}catch{b("failed")}};return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:ae,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${ae}/collections`,children:t.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[p==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):p==="error"?e.jsx("p",{children:t.cogita.library.revision.shareError}):d.filter(k=>!f||k.collectionId===f).length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:d.filter(k=>!f||k.collectionId===f).map(k=>e.jsxs("div",{className:"cogita-share-row","data-state":k.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:k.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(k.createdUtc).toLocaleString(),k.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]}),k.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${m}/${k.shareCode}`}):null]}),k.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[k.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>O(k.shareCode),children:t.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>y(k.shareId),children:t.cogita.library.revision.shareRevokeAction})]})]},k.shareId))}),z==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):z==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function yi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l}){const{libraryName:f}=ha(l),[c,d]=a.useState(null),[w,p]=a.useState(null),[C,z]=a.useState(null),[b,m]=a.useState(null),[ae,_]=a.useState(null),[y,O]=a.useState(null),k=a.useRef(null),Y=le=>{if(!Number.isFinite(le))return"0 B";if(le<1024)return`${le} B`;const ge=le/1024;if(ge<1024)return`${ge.toFixed(1)} KB`;const je=ge/1024;return je<1024?`${je.toFixed(1)} MB`:`${(je/1024).toFixed(1)} GB`},K=async()=>{d(null),_({loadedBytes:0,totalBytes:null,percent:null});try{d(t.cogita.library.overview.exporting);const le=await mr(l,_),ge=URL.createObjectURL(le),je=document.createElement("a");je.href=ge,je.download=`cogita-library-${f||l}.json`,je.click(),URL.revokeObjectURL(ge),d(t.cogita.library.overview.exportReady)}catch{d(t.cogita.library.overview.exportFail)}finally{_(le=>le??{loadedBytes:0,totalBytes:null,percent:null})}},L=async le=>{var je;p(null),z(null),m(null);const ge=(je=le.target.files)==null?void 0:je[0];if(ge)try{p(t.cogita.library.overview.importing),O({loadedBytes:0,totalBytes:ge.size,percent:0});const Oe=await pr(l,ge,O,ue=>{const $=ue.stage==="infos"?t.cogita.library.overview.importStageInfos:ue.stage==="connections"?t.cogita.library.overview.importStageConnections:t.cogita.library.overview.importStageCollections;m(t.cogita.library.overview.importLiveProgress.replace("{stage}",$).replace("{done}",String(ue.processed)).replace("{total}",String(ue.total)).replace("{infos}",String(ue.infos)).replace("{connections}",String(ue.connections)).replace("{collections}",String(ue.collections)))});z({infos:Oe.infosImported,connections:Oe.connectionsImported,collections:Oe.collectionsImported}),p(t.cogita.library.overview.importDone)}catch(Oe){const ue=Oe instanceof Ks&&Oe.message?` ${Oe.message}`:"";p(`${t.cogita.library.overview.importFail}${ue}`)}finally{k.current&&(k.current.value="")}};return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.overview.transferTitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("div",{children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.overview.transferTitle})})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:K,children:t.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[t.cogita.library.overview.import,e.jsx("input",{ref:k,type:"file",accept:"application/json",onChange:L})]})]}),ae?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:ae.percent??void 0,max:ae.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.exportProgress.replace("{loaded}",Y(ae.loadedBytes)).replace("{total}",ae.totalBytes?Y(ae.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,y?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:y.percent??void 0,max:y.totalBytes?100:void 0}),e.jsx("span",{children:t.cogita.library.overview.importProgress.replace("{loaded}",Y(y.loadedBytes)).replace("{total}",y.totalBytes?Y(y.totalBytes):t.cogita.library.overview.progressUnknown)})]}):null,c?e.jsx("p",{className:"cogita-help",children:c}):null,w?e.jsx("p",{className:"cogita-help",children:w}):null,b?e.jsx("p",{className:"cogita-help",children:b}):null,C?e.jsx("p",{className:"cogita-help",children:t.cogita.library.overview.importSummary.replace("{infos}",String(C.infos)).replace("{connections}",String(C.connections)).replace("{collections}",String(C.collections))}):null]})]})})})]})})}function xi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l}){const{libraryName:f}=ha(l),[c,d]=a.useState(""),[w,p]=a.useState([]),C=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.storyboardsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.storyboardsNewLabel}),e.jsx("input",{type:"text",value:c,onChange:z=>d(z.target.value),placeholder:t.cogita.library.modules.storyboardsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const z=c.trim();z&&(p(b=>[{id:C(),name:z},...b]),d(""))},children:t.cogita.library.modules.storyboardsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.storyboardsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[w.length===0?e.jsx("p",{children:t.cogita.library.modules.storyboardsEmpty}):null,w.map(z=>e.jsx("button",{type:"button",className:"ghost",children:z.name},z.id))]})]})]})})})]})})}function vi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l}){const{libraryName:f}=ha(l),[c,d]=a.useState(""),[w,p]=a.useState([]),C=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsx("header",{className:"cogita-library-dashboard-header",children:e.jsxs("div",{children:[e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.modules.textsSubtitle})]})}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsTitle})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.modules.textsNewLabel}),e.jsx("input",{type:"text",value:c,onChange:z=>d(z.target.value),placeholder:t.cogita.library.modules.textsNewPlaceholder})]}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:()=>{const z=c.trim();z&&(p(b=>[{id:C(),name:z},...b]),d(""))},children:t.cogita.library.modules.textsCreate})}),e.jsx("p",{className:"cogita-help",children:t.cogita.library.modules.draftInfo})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.modules.textsExisting})}),e.jsxs("div",{className:"cogita-detail-body",children:[w.length===0?e.jsx("p",{children:t.cogita.library.modules.textsEmpty}):null,w.map(z=>e.jsx("button",{type:"button",className:"ghost",children:z.name},z.id))]})]})]})})})]})})}function wi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l}){const{libraryName:f}=ha(l),c=`/#/cogita/library/${l}`,[d,w]=a.useState(""),[p,C]=a.useState([]),[z,b]=a.useState("idle"),[m,ae]=a.useState(0),[_,y]=a.useState(null);a.useEffect(()=>{b("loading");const k=window.setTimeout(()=>{za({libraryId:l,query:d.trim()||void 0,limit:30}).then(Y=>{C(Y.items),ae(Y.total),y(Y.nextCursor??null),b("ready")}).catch(()=>{C([]),ae(0),y(null),b("ready")})},240);return()=>window.clearTimeout(k)},[l,d]);const O=async()=>{if(_){b("loading");try{const k=await za({libraryId:l,query:d.trim()||void 0,limit:30,cursor:_});C(Y=>[...Y,...k.items]),y(k.nextCursor??null),ae(k.total),b("ready")}catch{b("ready")}}};return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:f}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${c}/collections/new`,children:t.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:d,onChange:k=>w(k.target.value),placeholder:t.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:t.cogita.library.collections.countLabel.replace("{shown}",String(p.length)).replace("{total}",String(m||p.length))}),e.jsx("span",{children:z==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:p.length?p.map(k=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${c}/collections/${k.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:k.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[t.cogita.library.collections.itemCountLabel.replace("{count}",String(k.itemCount))," ·"," ",k.notes||t.cogita.library.collections.noNotes]})]})},k.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${c}/collections/new`,children:t.cogita.library.collections.emptyAction})]})}),_?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:O,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const ve=t=>`${t.cardType}:${t.cardId}:${t.checkType??""}:${t.direction??""}`,Yt=(t,n,s,i)=>`${t}:${n}:${s??""}:${i??""}`;function ji({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,collectionId:f}){ha(l);const c=`/#/cogita/library/${l}`,[d,w]=a.useState(t.cogita.library.collections.defaultName),[p,C]=a.useState(null),[z,b]=a.useState(0),[m,ae]=a.useState([]),[_,y]=a.useState("idle"),[O,k]=a.useState(null),Y=a.useMemo(()=>t.cogita.library.list.cardCount.replace("{shown}",String(m.length)).replace("{total}",String(z||m.length)),[t,m.length,z]);a.useEffect(()=>{mn(l,f).then(L=>{w(L.name),C(L.notes??null),b(L.itemCount)}).catch(()=>{w(t.cogita.library.collections.defaultName),C(null)})},[l,f]),a.useEffect(()=>{y("loading"),Xa({libraryId:l,collectionId:f,limit:40}).then(L=>{ae(L.items),k(L.nextCursor??null),b(L.total),y("ready")}).catch(()=>{ae([]),k(null),y("ready")})},[l,f]);const K=async()=>{if(O){y("loading");try{const L=await Xa({libraryId:l,collectionId:f,limit:40,cursor:O});ae(le=>[...le,...L.items]),k(L.nextCursor??null),b(L.total),y("ready")}catch{y("ready")}}};return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:d}),e.jsx("p",{className:"cogita-library-subtitle",children:p||t.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:c,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${c}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${c}/collections/${f}/graph`,children:t.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${c}/collections/${f}/revision`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:Y}),e.jsx("span",{children:_==="loading"?t.cogita.library.collections.loading:t.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:m.length?m.map(L=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:L.cardType==="vocab"?t.cogita.library.list.cardTypeVocab:L.cardType==="connection"?t.cogita.library.list.cardTypeConnection:t.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:L.label}),e.jsx("p",{className:"cogita-card-subtitle",children:L.description})]})},ve(L))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:t.cogita.library.collections.noCards})})}),O?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:K,children:t.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:t.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${c}/collections/${f}/revision`,children:t.cogita.library.actions.startRevision})})]})})]})})})]})})}const Ms=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],ki={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Ni=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Si=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Ti({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,onCreated:f}){const c=Ba(),{libraryName:d}=ha(l),w=`/#/cogita/library/${l}`,[p,C]=a.useState(null),[z,b]=a.useState(""),[m,ae]=a.useState(""),[_,y,O]=Bn([]),[k,Y,K]=Vn([]),[L,le]=a.useState(null),[ge,je]=a.useState(null),Oe=a.useRef(null),ue=a.useMemo(()=>_.find(G=>G.id===L)??null,[_,L]);a.useEffect(()=>{const G=new URLSearchParams(c.search),xe=(G.get("draft")??"").trim(),re=(G.get("draftType")??"").trim();if(!xe||re!=="info-selection"||Oe.current===xe)return;const te=Qr(l,xe);if(!te||te.infoIds.length===0)return;const Se=crypto.randomUUID(),Re=te.infoIds.length>1?crypto.randomUUID():null,Pe=te.infoIds.map((ke,Ue)=>({id:crypto.randomUUID(),type:"default",position:{x:80,y:80+Ue*100},data:{nodeType:"source.info",label:"Selected info",params:{infoId:ke,infoType:"any"}}})),Le=Re?[{id:Re,type:"default",position:{x:360,y:120+Math.max(0,(te.infoIds.length-1)*50)},data:{nodeType:"logic.or",label:"Selected infos",params:{}}}]:[],Ge={id:Se,type:"default",position:{x:660,y:140+Math.max(0,(te.infoIds.length-1)*35)},data:{nodeType:"output.collection",label:"Collection output",params:{}}},it=Pe.map(ke=>({id:crypto.randomUUID(),source:ke.id,target:Re??Se}));Re&&it.push({id:crypto.randomUUID(),source:Re,target:Se}),y([...Pe,...Le,Ge]),Y(it),le(Se),je(`Draft loaded from ${te.infoIds.length} selected infos. Set name and save to create collection.`),Oe.current=xe},[l,c.search,Y,y]);const $=G=>{var Se;const xe=crypto.randomUUID(),re=((Se=Ms.find(Re=>Re.type===G))==null?void 0:Se.label)??G,te={...ki[G]};y(Re=>[...Re,{id:xe,type:"default",position:{x:120+Re.length*40,y:120+Re.length*40},data:{nodeType:G,label:re,params:te}}]),le(xe)},pe=a.useCallback(G=>{Y(xe=>On({...G,id:crypto.randomUUID()},xe))},[Y]),U=G=>{ue&&y(xe=>xe.map(re=>re.id===ue.id?{...re,data:{...re.data,params:G}}:re))},ce=async()=>{if(je(null),!z.trim()){je(t.cogita.library.collections.saveRequiredName);return}try{const G={nodes:_.map(te=>({nodeId:te.id,nodeType:te.data.nodeType,payload:{position:te.position,params:te.data.params}})),edges:k.map(te=>({edgeId:te.id,fromNodeId:te.source,fromPort:te.sourceHandle??null,toNodeId:te.target,toPort:te.targetHandle??null}))};let xe=p,re=!1;if(xe)await _s({libraryId:l,collectionId:xe,nodes:G.nodes,edges:G.edges});else{const te=await fr({libraryId:l,name:z.trim(),notes:m.trim()||void 0,items:[],graph:G});xe=te.collectionId,re=!0,C(te.collectionId)}je(re?t.cogita.library.collections.saveSuccess:t.cogita.library.graph.saveSuccess),f(xe)}catch{je(p?t.cogita.library.graph.saveFail:t.cogita.library.collections.saveFail)}};return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.createKicker}),e.jsx("h1",{className:"cogita-library-title",children:d}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.collections.createSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:w,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${w}/collections`,children:t.cogita.library.actions.collections}),e.jsx("button",{type:"button",className:"cta",onClick:ce,children:t.cogita.library.actions.saveCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.collections.collectionInfoTitle}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.collections.nameLabel}),e.jsx("input",{value:z,onChange:G=>b(G.target.value),placeholder:t.cogita.library.collections.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.collections.notesLabel}),e.jsx("textarea",{value:m,onChange:G=>ae(G.target.value),placeholder:t.cogita.library.collections.notesPlaceholder})]}),ge?e.jsx("p",{className:"cogita-help",children:ge}):null,e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:Ms.map(G=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>$(G.type),children:G.label},G.type))})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(un,{nodes:_,edges:k,onNodesChange:O,onEdgesChange:K,onConnect:pe,onNodeClick:(G,xe)=>le(xe.id),fitView:!0,children:[e.jsx(hn,{color:"rgba(120,160,200,0.2)"}),e.jsx(gn,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),ue?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:ue.data.label}),ue.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Qt,{libraryId:l,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:ue.data.params.tagId?{id:ue.data.params.tagId,label:ue.data.params.tagLabel??"",infoType:"topic"}:null,onChange:G=>U({...ue.data.params,tagId:(G==null?void 0:G.id)??null,tagLabel:(G==null?void 0:G.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:ue.data.params.scope??"any",onChange:G=>U({...ue.data.params,scope:G.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),ue.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Qt,{libraryId:l,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:ue.data.params.languageId?{id:ue.data.params.languageId,label:ue.data.params.languageLabel??"",infoType:"language"}:null,onChange:G=>U({...ue.data.params,languageId:(G==null?void 0:G.id)??null,languageLabel:(G==null?void 0:G.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:ue.data.params.scope??"any",onChange:G=>U({...ue.data.params,scope:G.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),ue.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:ue.data.params.infoType??"word",onChange:G=>U({...ue.data.params,infoType:G.target.value}),children:Si.map(G=>e.jsx("option",{value:G.value,children:G.label},G.value))})]}),e.jsx(Qt,{libraryId:l,infoType:ue.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:ue.data.params.infoId?{id:ue.data.params.infoId,label:ue.data.params.infoLabel??"",infoType:ue.data.params.infoType??"word"}:null,onChange:G=>U({...ue.data.params,infoId:(G==null?void 0:G.id)??null,infoLabel:(G==null?void 0:G.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),ue.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:ue.data.params.connectionType??"translation",onChange:G=>U({...ue.data.params,connectionType:G.target.value}),children:Ni.map(G=>e.jsx("option",{value:G.value,children:G.label},G.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:ue.data.params.connectionId??"",onChange:G=>U({...ue.data.params,connectionId:G.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(ue.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const ca=t=>{if(!t.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=t.length,s=t.filter(u=>u.correct).length,i=pn(Gn(t));return{score:Math.round(Math.max(0,Math.min(100,i.knowness*100))*100)/100,total:n,correct:s,lastReviewedUtc:i.lastReviewedUtc??null}},Ci=t=>{if(t.maskBase64)try{const n=br(t.maskBase64);if(!n.length)return t.correct?1:0;const s=n.reduce((i,o)=>i+o,0);return Math.max(0,Math.min(1,s/n.length/255))}catch{return t.correct?1:0}return t.correct?1:0},Gn=t=>t.map(n=>({correctness:Ci(n),createdUtc:n.createdUtc})),pn=(t,n=Date.now())=>{var z;if(!t.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const i=t.slice().sort((b,m)=>b.createdUtc.localeCompare(m.createdUtc)).slice(-5),o=i.reduce((b,m)=>b+m.correctness,0)/i.length,u=5,h=2,j=.15;let v=0,S=0;for(let b=0;b<i.length;b+=1){const m=new Date(i[b].createdUtc).getTime(),ae=b===i.length-1?n:new Date(i[b+1].createdUtc).getTime(),_=Math.max(0,(ae-m)/(1e3*60)),y=1-Math.exp(-_/u);v+=y,i[b].correctness>.5&&(S+=j)}let l=o*v*h+S;const f=((z=i[i.length-1])==null?void 0:z.createdUtc)??null,c=f?Math.max(0,(n-new Date(f).getTime())/(1e3*60)):0,w=1/(1+Math.log1p(c/60));return l*=w,i.length===1&&i[0].correctness>.5&&(l+=5.44*Math.exp(-c/2)),{knowness:l,avgCorrectness:o,lastReviewedUtc:f}},_a=t=>{const n=t.slice();for(let s=n.length-1;s>0;s-=1){const i=Math.floor(Math.random()*(s+1));[n[s],n[i]]=[n[i],n[s]]}return n},Qa=t=>t[Math.floor(Math.random()*t.length)],Ii=(t,n)=>{const s=new Map;return t.forEach(i=>s.set(i,Math.random())),t.sort((i,o)=>{const u=n(i)-n(o);return u!==0?u:(s.get(i)??0)-(s.get(o)??0)})},fn=(t,n,s,i,o)=>{if(!t.length)return null;const u=t.filter(j=>!(o!=null&&o.has(ve(j))));if(u.length===0)return null;const h=u.filter(j=>ve(j)!==s);return Qa(h.length?h:u)},Mi=(t,n,s,i,o)=>{if(!t.length)return null;let u=Number.POSITIVE_INFINITY;for(const S of t){const l=ve(S);if(s.has(l))continue;const f=n[l]??1;f<u&&(u=f)}if(!Number.isFinite(u))return null;const h=t.filter(S=>{const l=ve(S);return!s.has(l)&&(n[l]??1)===u}),j=h.filter(S=>!o||ve(S)!==o),v=i?j.filter(S=>!i.has(ve(S))):j;return v.length>0?Qa(v):j.length>0?Qa(j):o&&h.some(S=>ve(S)===o)?h.find(S=>ve(S)===o)??null:h.length?Qa(h):null},Hs=(t,n,s,i,o)=>{const u=[],h=t.filter(v=>!o.has(ve(v))&&!s.has(ve(v))&&(n[ve(v)]??0)<1),j=Ii(h,v=>n[ve(v)]??0);for(const v of j){if(u.length>=i)break;u.push(v),o.add(ve(v))}if(u.length<i){const v=_a(t.filter(S=>!o.has(ve(S))&&s.has(ve(S))));for(const S of v){if(u.length>=i)break;u.push(S),o.add(ve(S))}}return u},Li=(t,n,s,i)=>Hs(t,n,s,i,new Set),Yn=(t,n,s,i,o,u)=>{const h=Math.max(1,s.stackSize??n),v=_a(t).filter((w,p,C)=>C.findIndex(z=>ve(z)===ve(w))===p),S=Li(v,i,o,h),l=new Set,f=new Set,c=fn(S,{},null,l,f),d=c?[c]:[];return c&&f.add(ve(c)),{queue:d,meta:{pool:v,active:S,knownessMap:i,unknownSet:o,outcomesById:u,asked:l,queued:f}}},_n={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:t=>t,prepare:(t,n)=>{const i=_a(t).filter((o,u,h)=>h.findIndex(j=>ve(j)===ve(o))===u);return{queue:i.slice(0,Math.min(n,i.length)),meta:{}}},applyOutcome:t=>t},Xn=(t,n,s,i)=>{const o=Math.max(1,s.stackSize??n),h=_a(t).filter((p,C,z)=>z.findIndex(b=>ve(b)===ve(p))===C),j={},v=new Set,S=new Set,l=new Set,f=Math.max(1,s.levels??1);h.forEach(p=>{const C=ve(p),z=i==null?void 0:i[C],b=typeof z=="number"&&Number.isFinite(z)?z:1;j[C]=Math.min(f,Math.max(1,Math.round(b)))});const c=[];if(h.length>0){const p=new Map;h.forEach(z=>{var m;const b=j[ve(z)]??1;p.has(b)||p.set(b,[]),(m=p.get(b))==null||m.push(z)});const C=Array.from(p.keys()).sort((z,b)=>z-b);for(const z of C){if(c.length>=o)break;const b=_a(p.get(z)??[]);for(const m of b){if(c.length>=o)break;c.push(m)}}}const d=fn(c,j,null,v,S),w=d?[d]:[];return d&&S.add(ve(d)),{queue:w,meta:{pool:h,active:c,levelMap:j,asked:v,queued:S,wrongSinceCorrect:l}}},$i={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,n)=>Math.max(1,n.stackSize??t),getProgressTotal:()=>null,prepare:(t,n,s)=>Xn(t,n,s),applyOutcome:(t,n,s,i,o)=>{if(!n)return t;const u=Math.max(1,i.levels??1),h=t.meta.pool??[],j=t.meta.active??[],v={...t.meta.levelMap??{}},S=new Set(t.meta.asked??[]),l=new Set(t.meta.queued??[]),f=new Set(t.meta.wrongSinceCorrect??[]),c=ve(n);l.delete(c),S.add(c);const d=v[c]??1;o.correct?(v[c]=f.has(c)?1:Math.min(d+1,u),f.delete(c)):(v[c]=1,f.add(c));const w=o.correct?j.filter(z=>ve(z)!==c):j.slice();if(o.correct&&w.length<Math.max(1,i.stackSize??1)){const z=new Set(w.map(m=>ve(m))),b=Mi(h,v,z,S,c);b&&w.push(b)}const p=t.queue.slice(),C=fn(w,v,c,S,l);return C&&(p.push(C),l.add(ve(C))),{queue:p,meta:{pool:h,active:w,levelMap:v,asked:S,queued:l,wrongSinceCorrect:f}}}},Ri={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(t,n)=>Math.max(1,n.stackSize??t),getProgressTotal:()=>null,prepare:(t,n,s)=>Yn(t,n,s,{},new Set,{}),applyOutcome:(t,n,s,i,o)=>{if(!n)return t;const u=t.meta.pool??[],h=t.meta.active??[],j={...t.meta.knownessMap??{}},v=new Set(t.meta.unknownSet??[]),S={...t.meta.outcomesById??{}},l=new Set(t.meta.asked??[]),f=new Set(t.meta.queued??[]),c=ve(n);f.delete(c),l.add(c);const d={correctness:Math.max(0,Math.min(1,o.correctness??(o.correct?1:0))),createdUtc:o.createdUtc??new Date().toISOString()},p=(S[c]??[]).concat(d).sort((_,y)=>_.createdUtc.localeCompare(y.createdUtc)).slice(-5);S[c]=p,v.delete(c);const C=Date.now();u.forEach(_=>{const y=ve(_),O=S[y]??[];if(O.length===0){j[y]=0,v.add(y);return}const k=pn(O,C);j[y]=k.knowness});const z=h.slice();if((j[c]??0)>=1){const _=z.filter(y=>ve(y)!==c);z.length=0,z.push(..._)}const m=Math.max(1,i.stackSize??s);if(z.length<m){const _=new Set(z.map(O=>ve(O))),y=Hs(u,j,v,m-z.length,_);z.push(...y)}const ae=t.queue.slice();if(ae.length===0||ve(ae[ae.length-1])===c){const _=fn(z,{},c,l,f);_&&(ae.push(_),f.add(ve(_)))}return{queue:ae,meta:{pool:u,active:z,knownessMap:j,unknownSet:v,outcomesById:S,asked:l,queued:f}}}},Ws={random:_n,levels:$i,temporal:Ri},Ai=Object.values(Ws),Zn=t=>{if(!t)return _n;const n=t.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?Ws[n]:_n},bn=(t,n)=>{const s={...t.defaultSettings};return n&&Object.entries(n).forEach(([i,o])=>{typeof o=="number"&&Number.isFinite(o)&&(s[i]=o),typeof o=="string"&&(s[i]=o)}),t.settingsFields.forEach(i=>{var u;const o=s[i.key];if(i.type==="number"){if(typeof o!="number"||Number.isNaN(o)){s[i.key]=t.defaultSettings[i.key]??0;return}i.min!==void 0&&(s[i.key]=Math.max(i.min,s[i.key])),i.max!==void 0&&(s[i.key]=Math.min(i.max,s[i.key]));return}if(i.type==="select"){const h=((u=i.options)==null?void 0:u.map(j=>j.value))??[];(typeof o!="string"||h.length>0&&!h.includes(o))&&(s[i.key]=t.defaultSettings[i.key]??h[0]??"")}}),s},Qs=(t,n)=>{const s={};return t.settingsFields.forEach(i=>{const o=n.get(i.key);if(o){if(i.type==="number"){const u=Number(o);Number.isNaN(u)||(s[i.key]=u);return}s[i.key]=o}}),bn(t,s)},Ei=(t,n)=>{const s=new URLSearchParams;return t.settingsFields.forEach(i=>{const o=n[i.key];(typeof o=="number"||typeof o=="string")&&s.set(i.key,String(o))}),s};function Ls({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,collectionId:f,revisionId:c}){const d=dn(),{libraryName:w}=ha(l),p=`/#/cogita/library/${l}`,[C,z]=a.useState(t.cogita.library.collections.defaultName),[b,m]=a.useState([]),[ae,_]=a.useState(f??""),[y,O]=a.useState(""),[k,Y]=a.useState(20),[K,L]=a.useState("random"),[le,ge]=a.useState({}),[je,Oe]=a.useState("exact"),[ue,$]=a.useState([]),[pe,U]=a.useState(null),[ce,G]=a.useState([]),[xe,re]=a.useState([]),[te,Se]=a.useState(""),[Re,Pe]=a.useState("idle"),[Le,Ge]=a.useState(null),[it,ke]=a.useState("idle"),[Ue,gt]=a.useState("idle"),[We,Be]=a.useState("idle"),et=a.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),rt=a.useMemo(()=>Zn(K),[K]),qe=a.useMemo(()=>bn(rt,le),[rt,le]),Ne=a.useMemo(()=>Ei(rt,qe).toString(),[rt,qe]),Te=a.useMemo(()=>{const x=te.trim().toLocaleLowerCase();return x?xe.filter(N=>N.name.toLocaleLowerCase().includes(x)):xe},[te,xe]);a.useEffect(()=>{_(f??"")},[f]),a.useEffect(()=>{if(!ae){z(t.cogita.library.collections.defaultName);return}mn(l,ae).then(x=>z(x.name)).catch(()=>z(t.cogita.library.collections.defaultName))},[t.cogita.library.collections.defaultName,l,ae]),a.useEffect(()=>{za({libraryId:l,limit:200}).then(x=>m(x.items.map(N=>({collectionId:N.collectionId,name:N.name})))).catch(()=>m([]))},[l]),a.useEffect(()=>{qn({libraryId:l}).then(x=>re(x)).catch(()=>re([]))},[l]),a.useEffect(()=>{c&&Bs({libraryId:l,revisionId:c}).then(x=>{_(x.collectionId),O(x.name),L(x.mode||"random"),Oe(x.check||"exact"),Y(x.limit||20),ge(x.revisionSettings??{})}).catch(()=>{O("")})},[l,c]),a.useEffect(()=>{Vs({libraryId:l}).then(x=>{$(x),!pe&&x.length>0&&U(x[0].roleId)}).catch(()=>{$([])})},[l]);const ze=()=>{gt("loading"),Ds({libraryId:l}).then(x=>{G(x),gt("idle")}).catch(()=>{G([]),gt("error")})};a.useEffect(()=>{ze()},[l]);const B=async()=>{Pe("working"),ke("idle");try{if(!ae){Pe("error");return}const x=await xr({libraryId:l,collectionId:ae,revisionType:rt.id,revisionSettings:qe,mode:K,check:je,limit:k});Ge(`${et}/${x.shareCode}${Ne?`?${Ne}`:""}`),Pe("ready"),ze()}catch{Pe("error")}},E=async()=>{if(c){Be("saving");try{await yr({libraryId:l,collectionId:f??ae,revisionId:c,targetCollectionId:ae,name:y||C,revisionType:rt.id,revisionSettings:qe,mode:K,check:je,limit:k}),Be("saved"),ae&&d(`/cogita/library/${l}/revisions/${encodeURIComponent(c)}`,{replace:!0})}catch{Be("error")}}},R=async()=>{if(Le)try{await navigator.clipboard.writeText(Le),ke("copied")}catch{ke("failed")}},M=async x=>{try{await zs({libraryId:l,shareId:x}),ze()}catch{ze()}};return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:C}),e.jsx("p",{className:"cogita-library-subtitle",children:w})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:p,children:t.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${p}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:ae?`${p}/collections/${ae}`:`${p}/collections`,children:t.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${p}${c?`/revisions/${encodeURIComponent(c)}/run`:ae?`/collections/${ae}/revision/run`:"/revision/run"}?mode=${encodeURIComponent(K)}&check=${encodeURIComponent(je)}&limit=${k}${Ne?`&${Ne}`:""}${pe?`&reviewer=${encodeURIComponent(pe)}`:""}${c?`&revisionId=${encodeURIComponent(c)}`:""}`,children:t.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:te,onChange:x=>Se(x.target.value),placeholder:t.cogita.workspace.revisionForm.namePlaceholder})}),e.jsxs("div",{className:"cogita-card-list","data-view":"list",children:[e.jsxs("a",{className:"cogita-card-select",href:`${p}/revisions/new`,style:{display:"block"},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.workspace.layers.revision}),e.jsx("h3",{className:"cogita-card-title",children:t.cogita.workspace.revisionForm.createAction})]}),Te.map(x=>e.jsxs("a",{className:"cogita-card-select",href:`${p}/revisions/${encodeURIComponent(x.revisionId)}`,style:{display:"block"},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.workspace.layers.revision}),e.jsx("h3",{className:"cogita-card-title",children:x.name})]},x.revisionId))]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.actions.collections}),e.jsx("select",{value:ae,onChange:x=>_(x.target.value),children:b.map(x=>e.jsx("option",{value:x.collectionId,children:x.name},x.collectionId))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:y,onChange:x=>O(x.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.modeLabel}),e.jsx("select",{value:K,onChange:x=>L(x.target.value),children:Ai.map(x=>e.jsx("option",{value:x.id,children:t.cogita.library.revision[x.labelKey]},x.id))})]}),rt.settingsFields.map(x=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision[x.labelKey]}),x.type==="select"?e.jsx("select",{value:String(qe[x.key]??""),onChange:N=>ge(I=>({...I,[x.key]:N.target.value})),children:(x.options??[]).map(N=>e.jsx("option",{value:N.value,children:t.cogita.library.revision[N.labelKey]},N.value))}):e.jsx("input",{type:"number",min:x.min,max:x.max,step:x.step,value:qe[x.key]??0,onChange:N=>ge(I=>({...I,[x.key]:Number(N.target.value||0)}))})]},x.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.checkLabel}),e.jsx("input",{value:t.cogita.library.revision.checkValue,disabled:!0})]}),rt.id!=="levels"&&rt.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:k,onChange:x=>Y(Number(x.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:pe??"",onChange:x=>U(x.target.value||null),children:ue.map(x=>e.jsx("option",{value:x.roleId,children:x.label},x.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.previewBody1}),e.jsx("p",{children:t.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[c?e.jsx("button",{type:"button",className:"cta ghost",onClick:E,disabled:We==="saving",children:We==="saving"?"...":t.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${p}${c?`/revisions/${encodeURIComponent(c)}/run`:ae?`/collections/${ae}/revision/run`:"/revision/run"}?mode=${encodeURIComponent(K)}&check=${encodeURIComponent(je)}&limit=${k}${Ne?`&${Ne}`:""}${pe?`&reviewer=${encodeURIComponent(pe)}`:""}${c?`&revisionId=${encodeURIComponent(c)}`:""}`,children:t.cogita.library.actions.startRevision})]}),We==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:t.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:t.cogita.library.revision.shareBody}),Le?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:Le,readOnly:!0})]}):null,Re==="error"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareError}):null,it==="copied"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopied}):it==="failed"?e.jsx("p",{className:"cogita-help",children:t.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:B,disabled:Re==="working",children:Re==="working"?t.cogita.library.revision.shareWorking:t.cogita.library.revision.shareAction}),Le?e.jsx("button",{type:"button",className:"cta ghost",onClick:R,children:t.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareListTitle}),Ue==="loading"?e.jsx("p",{children:t.cogita.library.revision.shareListLoading}):ce.length===0?e.jsx("p",{children:t.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:ce.map(x=>e.jsxs("div",{className:"cogita-share-row","data-state":x.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:x.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(x.createdUtc).toLocaleString(),x.revokedUtc?` · ${t.cogita.library.revision.shareRevoked}`:""]})]}),x.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>M(x.shareId),children:t.cogita.library.revision.shareRevokeAction})]},x.shareId))})]})]})]})]})})})]})})}const $n=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function Gs(t,n,s){if(!t)return null;const i=new Map(t.nodes.map(_=>[_.id,_])),o=new Map,u=new Set,h=_=>{if(typeof _=="number")return _;if(typeof _=="string"){const y=Number(_);return Number.isFinite(y)?y:0}return 0},j=_=>{if(o.has(_))return o.get(_);if(u.has(_))return 0;const y=i.get(_);if(!y)return 0;u.add(_);const O=Y=>{var L,le;return(Y?((L=y.inputsByHandle)==null?void 0:L[Y])??[]:y.inputs??((le=y.inputsByHandle)==null?void 0:le.in)??[]).map(ge=>j(ge))};let k=0;switch(y.type){case"input.random":{const Y=y.min??0,K=y.max??Y+10,L=Math.min(Y,K),le=Math.max(Y,K);k=Math.floor(Math.random()*(le-L+1))+L;break}case"input.const":{k=y.value??0;break}case"input.list":{const Y=(y.list??[]).filter(Boolean),K=Math.round(h(O("index")[0]));k=Y.length?Y[Math.max(0,Math.min(Y.length-1,K))]:String(K);break}case"compute.add":{k=O("in").map(K=>h(K)).reduce((K,L)=>K+L,0);break}case"compute.sub":{const Y=O("add").map(L=>h(L)),K=O("sub").map(L=>h(L));k=Y.reduce((L,le)=>L+le,0)-K.reduce((L,le)=>L+le,0);break}case"compute.mul":{const Y=O("in").map(K=>h(K));k=Y.length?Y.reduce((K,L)=>K*L,1):0;break}case"compute.div":{const Y=h(O("num")[0]),K=O("den").map(L=>h(L)).reduce((L,le)=>L+le,0);k=Math.abs(K)<Number.EPSILON?0:Y/K;break}case"compute.pow":{const Y=h(O("base")[0]),K=h(O("exp")[0]);k=Math.pow(Y,K);break}case"compute.exp":{const Y=h(O("base")[0]),K=h(O("exp")[0]);k=Math.pow(Y,K);break}case"compute.log":{const Y=h(O("value")[0]),K=h(O("base")[0]),L=Math.max(Y,Number.EPSILON);k=Math.abs(K)<Number.EPSILON?Math.log(L):Math.log(L)/Math.log(K);break}case"compute.abs":{k=Math.abs(h(O("in")[0]));break}case"compute.min":{const Y=O("in").map(K=>h(K));k=Y.length?Math.min(...Y):0;break}case"compute.max":{const Y=O("in").map(K=>h(K));k=Y.length?Math.max(...Y):0;break}case"compute.floor":{k=Math.floor(h(O("in")[0]));break}case"compute.ceil":{k=Math.ceil(h(O("in")[0]));break}case"compute.round":{k=Math.round(h(O("in")[0]));break}case"compute.mod":{const Y=h(O("a")[0]),K=h(O("b")[0]);k=Math.abs(K)<Number.EPSILON?0:Y%K;break}case"compute.concat":{const K=["in1","in2","in3","in4","in5","in6"].flatMap(je=>O(je)),L=K.length?K:O("in");k=(L.length?L:O()).map(je=>je==null?"":String(je)).join("");break}case"compute.trim":{const Y=O("text")[0]??O("in")[0]??"",K=Y==null?"":String(Y),L=Math.max(0,Math.round(h(O("start")[0]))),le=Math.max(0,Math.round(h(O("end")[0])));L+le>=K.length?k="":k=K.substring(L,K.length-le);break}case"output":{k=O("in")[0]??0;break}default:k=0}return u.delete(_),o.set(_,k),k},v=t.outputs&&t.outputs.length>0?t.outputs:t.output?[t.output]:t.nodes.filter(_=>_.type==="output").map(_=>_.id);t.nodes.forEach(_=>j(_.id)),v.forEach(_=>j(_));const S=_=>Math.abs(_%1)<1e-5?String(Math.round(_)):_.toFixed(3).replace(/\.?0+$/,""),l=_=>typeof _=="number"?S(_):_??"",f=new Map;v.forEach(_=>{var K,L,le,ge;const y=i.get(_);if(!y)return;const O=(L=(K=y.inputsByHandle)==null?void 0:K.name)==null?void 0:L[0],k=O?l(o.get(O)):"",Y=(k==null?void 0:k.toString().trim())||((le=y.outputLabel)==null?void 0:le.trim())||((ge=y.name)==null?void 0:ge.trim())||_;f.set(_,Y)});const c={},d={},w={};v.forEach(_=>{var k,Y;const y=i.get(_);if(!y)return;const O=f.get(_)??(((k=y.outputLabel)==null?void 0:k.trim())||((Y=y.name)==null?void 0:Y.trim())||_);c[O]=l(o.get(_)),y.name&&(d[y.name.trim()]=O),d[_]=O});const p=(_,y)=>{let O=_;return t.nodes.forEach(k=>{var ge,je;const Y=l(o.get(k.id)),K=v.includes(k.id),L=K?f.get(k.id)??((ge=k.outputLabel)==null?void 0:ge.trim())??((je=k.name)==null?void 0:je.trim())??k.id:"",le=K&&y?L:Y;O=O.replace(new RegExp(`\\{\\s*${$n(k.id)}\\s*\\}`,"gi"),le),k.name&&(O=O.replace(new RegExp(`\\{\\s*${$n(k.name)}\\s*\\}`,"gi"),le)),K&&k.outputLabel&&(O=O.replace(new RegExp(`\\{\\s*${$n(k.outputLabel)}\\s*\\}`,"gi"),L))}),O},C=n;let z=C.trim().length>0?C:"";z||(z=v.length?`Compute ${v.join(", ")}`:"Compute"),z=p(z,!0);const b=(s==null?void 0:s.trim())??"",m=b?p(b,!1):"",ae={};return o.forEach((_,y)=>{ae[y]=_,w[y]=l(_);const O=i.get(y);O!=null&&O.name&&(w[O.name.trim()]=l(_))}),{prompt:z,answers:c,values:ae,answerText:m,outputVariables:d,variableValues:w}}function Ys(t){var s;const n=Object.entries(t.answers);return{prompt:t.prompt,expectedAnswer:t.answerText??((s=n[0])==null?void 0:s[1])??"",expectedAnswers:t.answers,values:t.values,expectedAnswerIsSentence:!!(t.answerText&&t.answerText.trim().length>0),outputVariables:t.outputVariables,variableValues:t.variableValues}}const Rn=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function Xs({outcomes:t}){const[n,s]=a.useState("day"),i=a.useMemo(()=>{const o=Rn.find(j=>j.id===n)??Rn[1],u=Date.now()-o.ms,h=t.filter(j=>new Date(j.createdUtc).getTime()>=u);return ca(h)},[t,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:Rn.map(o=>e.jsx("button",{type:"button",className:"ghost","data-active":n===o.id,onClick:()=>s(o.id),children:o.label},o.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[i.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[i.correct," / ",i.total]})]})}const Pi="cogita-revision",Ki=1,nn="outcomes",Fi=()=>new Promise((t,n)=>{const s=indexedDB.open(Pi,Ki);s.onupgradeneeded=()=>{const i=s.result;if(!i.objectStoreNames.contains(nn)){const o=i.createObjectStore(nn,{keyPath:"id"});o.createIndex("byItem","itemKey",{unique:!1}),o.createIndex("byPending","pending",{unique:!1})}},s.onerror=()=>n(s.error),s.onsuccess=()=>t(s.result)}),Va=async(t,n)=>{const s=await Fi();return new Promise((i,o)=>{const u=s.transaction(nn,t),h=u.objectStore(nn);n(h).then(i).catch(o),u.onerror=()=>o(u.error)})},Zs=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const t=new Uint8Array(16);crypto.getRandomValues(t);const n=Array.from(t).map(s=>s.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Di=()=>{const t="cogita_revision_client_id",n=localStorage.getItem(t);if(n)return n;const s=Zs();return localStorage.setItem(t,s),s},zi=()=>{const t="cogita_revision_client_seq",n=Number(localStorage.getItem(t)??"0"),s=Number.isFinite(n)?n+1:1;return localStorage.setItem(t,String(s)),s},er=(t,n,s,i)=>Yt(t,n,s,i),sn=async t=>{const n=Di(),s=zi(),i=new Date().toISOString(),o={...t,clientId:n,clientSequence:s,createdUtc:i,id:Zs(),pending:!0};return await Va("readwrite",u=>new Promise((h,j)=>{const v={...o,itemKey:er(o.itemType,o.itemId,o.checkType,o.direction)},S=u.add(v);S.onsuccess=()=>h(),S.onerror=()=>j(S.error)})),o},rn=async(t,n,s,i)=>{if(!n)return[];try{const o=er(t,n,s,i);return await Va("readonly",u=>new Promise((h,j)=>{const S=u.index("byItem").getAll(o);S.onsuccess=()=>{const f=(S.result??[]).map(c=>({itemType:c.itemType,itemId:c.itemId,checkType:c.checkType??null,direction:c.direction??null,revisionType:c.revisionType,evalType:c.evalType,correct:c.correct,createdUtc:c.createdUtc,maskBase64:c.maskBase64,payloadBase64:c.payloadBase64,payloadHashBase64:c.payloadHashBase64,clientId:c.clientId,clientSequence:c.clientSequence,personRoleId:c.personRoleId??null})).sort((c,d)=>c.createdUtc.localeCompare(d.createdUtc));h(f)},S.onerror=()=>j(S.error)}))}catch{return[]}},da=async()=>{try{return await Va("readonly",t=>new Promise((n,s)=>{const i=t.getAll();i.onsuccess=()=>{const u=(i.result??[]).map(h=>({itemType:h.itemType,itemId:h.itemId,checkType:h.checkType??null,direction:h.direction??null,revisionType:h.revisionType,evalType:h.evalType,correct:h.correct,createdUtc:h.createdUtc,maskBase64:h.maskBase64,payloadBase64:h.payloadBase64,payloadHashBase64:h.payloadHashBase64,clientId:h.clientId,clientSequence:h.clientSequence,personRoleId:h.personRoleId??null}));n(u)},i.onerror=()=>s(i.error)}))}catch{return[]}},_i=async(t=100)=>{try{return await Va("readonly",n=>new Promise((s,i)=>{const u=n.index("byPending").getAll(!0);u.onsuccess=()=>{const h=u.result??[];s(h.slice(0,t))},u.onerror=()=>i(u.error)}))}catch{return[]}},Bi=async t=>{if(t.length!==0)try{await Va("readwrite",n=>new Promise((s,i)=>{let o=t.length;t.forEach(u=>{const h=n.get(u);h.onsuccess=()=>{const j=h.result;if(j){j.pending=!1;const v=n.put(j);v.onsuccess=()=>{o-=1,o===0&&s()},v.onerror=()=>i(v.error)}else o-=1,o===0&&s()},h.onerror=()=>i(h.error)})}))}catch{}},An=async(t,n)=>{const s=await _i(200);if(s.length===0)return;const i=new Map;s.forEach(o=>{var h;const u=o.personRoleId??n??"";i.has(u)||i.set(u,[]),(h=i.get(u))==null||h.push(o)});for(const[o,u]of i.entries()){const h=u.map(j=>({itemType:j.itemType,itemId:j.itemId,checkType:j.checkType??null,direction:j.direction??null,revisionType:j.revisionType,evalType:j.evalType,correct:j.correct,clientId:j.clientId,clientSequence:j.clientSequence,maskBase64:j.maskBase64??null,payloadHashBase64:j.payloadHashBase64??null,payloadBase64:j.payloadBase64??null,personRoleId:o||null}));try{await vr({libraryId:t,outcomes:h}),await Bi(u.map(j=>j.id))}catch{}}},Ft=t=>t.trim().toLowerCase(),Ut=t=>{const n=t==null?void 0:t.trim();return n?{fragmentId:n}:null},on=(t,n)=>{const s=Ut(n);if(!s)return!0;const i=Ut(t);return(i==null?void 0:i.fragmentId)===s.fragmentId},kt=t=>{const n=t==null?void 0:t.trim().toLowerCase();return n||null},tr=(t,n)=>{if((kt(t.childItemType)??"info")!==(n.cardType??"").toLowerCase()||t.childItemId!==n.cardId)return!1;const i=kt(t.childCheckType),o=kt(t.childDirection),u=kt(n.checkType),h=kt(n.direction);return!(i&&i!==u||o&&o!==h)},Vi={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},Oi={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},ln=(t,n,s)=>{if(!s||!n.startsWith(t))return n;const i=n.slice(t.length);if(!i)return n;const o=s==="super"?Vi:Oi,u=i.split("").map(h=>o[h]??h).join("");return t+u},cn=(t,n,s)=>{var h,j,v;if(!t)return((h=n[0])==null?void 0:h.key)??null;const i=new Set(n.map(S=>S.key)),o=/\{([^}]+)\}/g;let u;for(;(u=o.exec(t))!==null;){const S=((j=u[1])==null?void 0:j.trim())??"";if(!S)continue;if(i.has(S))return S;const l=s==null?void 0:s[S];if(l&&i.has(l))return l}return((v=n[0])==null?void 0:v.key)??null},Da=t=>(()=>{const n=new Set;return t.flatMap(s=>{if(s.cardType!=="info"||s.infoType!=="citation")return[s];const i=s.description??"";if(!i.trim())return[s];const o=ka(i),u=Object.keys(o.nodes);return u.length===0?[s]:u.map(h=>({...s,checkType:"quote-fragment",direction:h})).filter(h=>{const j=[h.cardId,h.checkType??"",h.direction??""].join("|");return n.has(j)?!1:(n.add(j),!0)})})})();function En({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,collectionId:f,revisionId:c}){const d=Ba(),w=`/#/cogita/library/${l}`,p=a.useMemo(()=>new URLSearchParams(d.search),[d.search]),C=Math.max(1,Number(p.get("limit")??20)),z=p.get("mode")??"random",b=a.useMemo(()=>Zn(z),[z]),m=a.useMemo(()=>bn(b,Qs(b,p)),[b,p]),ae=p.get("check")??"exact",_=p.get("reviewer"),y=(p.get("scope")??"").trim(),O=y==="info"||y==="info-selection"?y:"collection",k=O==="info"?(p.get("infoId")??"").trim():"",Y=O==="info-selection"?(p.get("seed")??"").trim():"",[K,L]=a.useState(null),le=f??K??void 0,ge=O==="collection"&&!!le,je=a.useMemo(()=>t.cogita.library.revision[b.labelKey]??z,[t,z,b]),Oe=a.useMemo(()=>ae==="exact"?t.cogita.library.revision.checkValue:ae,[t,ae]),[ue,$]=a.useState(t.cogita.library.collections.defaultName),[pe,U]=a.useState([]),[ce,G]=a.useState([]),[xe,re]=a.useState("idle"),[te,Se]=a.useState({current:0,total:0}),[Re,Pe]=a.useState(0),[Le,Ge]=a.useState(""),[it,ke]=a.useState(null),[Ue,gt]=a.useState(null),[We,Be]=a.useState(null),[et,rt]=a.useState(null),[qe,Ne]=a.useState([]),[Te,ze]=a.useState({}),[B,E]=a.useState({}),[R,M]=a.useState(null),[x,N]=a.useState(null),[I,F]=a.useState(null),[V,q]=a.useState(null),[me,ie]=a.useState(null),[se,oe]=a.useState({}),J=a.useRef(0),[W,$e]=a.useState(null),Me=a.useRef(null),Ie=a.useRef(null),[nt,ht]=a.useState(null),[Ye,Qe]=a.useState(!1),[Nt,xt]=a.useState(null),[Ct,vt]=a.useState([]),[Mt,aa]=a.useState(null),At=a.useRef(null),St=a.useRef(null),[ma,It]=a.useState(null),[pt,wt]=a.useState(0),ft=a.useRef(null),mt=a.useRef({}),[Pt,at]=a.useState(!1),[_e,ut]=a.useState({}),[Jt,Kt]=a.useState([]),Dt=a.useRef(new Map),[ee,Xt]=a.useState(new Set),[na,_t]=a.useState(!1),r=a.useRef(null),D=a.useRef(new Set),he=a.useRef({});a.useEffect(()=>{if(!c||f){L(null);return}Bs({libraryId:l,revisionId:c}).then(g=>L(g.collectionId)).catch(()=>L(null))},[f,l,c]);const H=pe[Re]??null,Xe=(H==null?void 0:H.checkType)==="translation-match"&&me,ot=a.useRef(new Map),bt=a.useRef(new Map),Tt=a.useRef(new Map),$t=a.useRef(new Map),yt=a.useMemo(()=>H?H.cardType==="vocab"?t.cogita.library.revision.vocabLabel:H.infoType?tt(t,H.infoType):t.cogita.library.revision.infoLabel:"",[t,H]),Ht=a.useMemo(()=>{var T;return b.id!=="levels"?pe.length:((T=_e.pool)==null?void 0:T.length)??b.getFetchLimit(C,m)},[_e,m,b,pe.length,C]),Zt=b.getProgressTotal?b.getProgressTotal(pe,_e,C,m):b.id==="levels"?Math.min(C,Ht):pe.length,sa=Zt?Math.min(Re+1,Zt):0,Bt=Math.max(1,Number(m.tries??1)),ra=m.compare??"anchors",Rt=Math.max(0,Math.min(100,Number(m.minCorrectness??0))),jt=(m.considerDependencies??"on")==="on",ea=Math.max(0,Math.min(100,Number(m.dependencyThreshold??85))),Gt=g=>{const T=g.slice();for(let P=T.length-1;P>0;P-=1){const ne=Math.floor(Math.random()*(P+1));[T[P],T[ne]]=[T[ne],T[P]]}return T},xa=g=>ya(g,{treatSimilarCharsAsSame:!0})>=Rt,Oa=async()=>{const g=await da(),T=new Map,P=new Map,ne=new Map;g.forEach(Q=>{const we=`${Q.itemType}:${Q.itemId}`,De=Yt(Q.itemType,Q.itemId,Q.checkType,Q.direction);if(T.has(we)||T.set(we,[]),T.get(we).push(Q),P.has(De)||P.set(De,[]),P.get(De).push(Q),Q.itemType==="info"&&Q.checkType==="quote-fragment"&&Q.direction){const He=`${Q.itemId}:${Q.direction}`;ne.has(He)||ne.set(He,[]),ne.get(He).push(Q)}});const de=new Map,Z=new Map,fe=new Map;return T.forEach((Q,we)=>de.set(we,ca(Q).score)),P.forEach((Q,we)=>Z.set(we,ca(Q).score)),ne.forEach((Q,we)=>fe.set(we,ca(Q).score)),{itemKnowness:de,cardKnowness:Z,fragmentKnowness:fe}},Wt=async g=>{const T=[];let P=null;for(;;){const ne=await Xa({libraryId:l,collectionId:g,limit:200,cursor:P});if(T.push(...ne.items),!ne.nextCursor)break;P=ne.nextCursor}return Da(T)},Na=async(g,T)=>{if(Dt.current.has(g))return Dt.current.get(g)??0;const P=await Wt(g);if(P.length===0)return Dt.current.set(g,0),0;const de=P.reduce((Z,fe)=>{const Q=ve(fe);return Z+(T.get(Q)??0)},0)/P.length;return Dt.current.set(g,de),de},Sa=(g,T)=>{if(!jt||g.cardType!=="info"||g.infoType!=="citation"||g.checkType!=="quote-fragment")return!0;const P=Ut(g.direction);if(!(P!=null&&P.fragmentId))return!0;const ne=g.description??"";if(!ne.trim())return!0;const Z=ka(ne).nodes[P.fragmentId];if(!Z||!Z.leftId&&!Z.rightId)return!0;const fe=[Z.leftId,Z.rightId].filter(De=>!!De);if(fe.length===0)return!0;const Q=fe.map(De=>{const He=Yt("info",g.cardId,"quote-fragment",De);return T.get(He)??0});return Q.reduce((De,He)=>De+He,0)/Q.length>=ea},La=async g=>{const T=_e,P=g.concat(T.active??[]).concat(T.pool??[]).filter((Q,we,De)=>De.findIndex(He=>ve(He)===ve(Q))===we);if(!jt){Xt(new Set(P.map(ve)));return}const{itemKnowness:ne,cardKnowness:de}=await Oa(),Z=Jt.filter(Q=>kt(Q.childItemType)==="collection"&&Q.childItemId===f&&!kt(Q.childCheckType)&&!kt(Q.childDirection)),fe=new Set;for(const Q of P){if(Q.cardType!=="info"){fe.add(ve(Q));continue}if(!Sa(Q,de))continue;const we=Jt.filter(Ve=>tr(Ve,Q)).concat(Z);if(we.length===0){fe.add(ve(Q));continue}let De=0;for(const Ve of we)if(kt(Ve.parentItemType)==="collection")De+=await Na(Ve.parentItemId,de);else if(kt(Ve.parentCheckType)||kt(Ve.parentDirection)){const Ze=kt(Ve.parentCheckType),st=kt(Ve.parentDirection),lt=Yt(Ve.parentItemType,Ve.parentItemId,Ze,st);De+=de.get(lt)??0}else{const Ze=`${Ve.parentItemType}:${Ve.parentItemId}`;De+=ne.get(Ze)??0}De/we.length>=ea&&fe.add(ve(Q))}Xt(fe)},qa=g=>{for(let T=g;T<pe.length;T+=1){const P=pe[T];if(P&&(!jt||P.cardType!=="info"||ee.has(ve(P))))return T}return-1},$a=g=>!jt||g.cardType!=="info"||ee.has(ve(g)),yn=g=>{if(b.id!=="temporal"&&b.id!=="levels")return null;const T=_e,P=(T.active??[]).concat(T.pool??[]),ne=new Set;for(const de of P){const Z=ve(de);if(!(ne.has(Z)||g.has(Z))&&(ne.add(Z),$a(de)))return de}return null},Vt=a.useMemo(()=>{if(b.id!=="levels")return null;const g=_e,T=g.pool??[],P=g.active??[],ne=g.levelMap??{},de=Math.max(1,Number(m.levels??1)),Z=Array.from({length:de},()=>0),fe=new Set(P.map(He=>ve(He)));T.forEach(He=>{const Ve=Math.min(de,Math.max(1,ne[ve(He)]??1));Z[Ve-1]+=1});const Q=T.length||1,we=Z.map(He=>He/Q*100),De=H?ne[ve(H)]??1:null;return{counts:Z,percentages:we,currentLevel:De,levelsCount:de,activeCount:P.length,poolCount:T.length,activeSet:fe}},[_e,m,b,H]),Ot=a.useMemo(()=>{if(b.id!=="temporal")return null;const g=_e,T=g.pool??[],P=g.active??[],ne=g.knownessMap??{},de=new Set(g.unknownSet??[]);let Z=0;T.forEach(we=>{(ne[ve(we)]??0)>1&&(Z+=1)});const fe=de.size,Q=P.map(we=>({id:ve(we),value:de.has(ve(we))?0:Math.max(0,Math.min(1,ne[ve(we)]??0))}));return{knownCount:Z,unknownCount:fe,dots:Q}},[_e,b]),xn=a.useMemo(()=>{if(!jt)return 0;const g=_e;return pe.concat(g.active??[]).concat(g.pool??[]).filter((P,ne,de)=>de.findIndex(Z=>ve(Z)===ve(P))===ne).filter(P=>P.cardType==="info"&&!ee.has(ve(P))).length},[jt,_e,pe,ee]);a.useEffect(()=>{if(!jt||xe!=="ready")return;const g=_e,P=pe.concat(g.active??[]).concat(g.pool??[]).filter((Z,fe,Q)=>Q.findIndex(we=>ve(we)===ve(Z))===fe).filter(Z=>Z.cardType!=="info"||ee.has(ve(Z))).length,ne=At.current;if(At.current=P,ne===null||P<=ne)return;const de=P-ne;aa(`New card available (+${de})`),St.current&&window.clearTimeout(St.current),St.current=window.setTimeout(()=>aa(null),2200)},[jt,xe,_e,pe,ee]),a.useEffect(()=>()=>{St.current&&window.clearTimeout(St.current)},[]);const zt=(g,T)=>{const P=b.applyOutcome({queue:pe,meta:_e},H,C,m,{correct:g,correctness:T,createdUtc:new Date().toISOString()});U(P.queue),ut(P.meta);const ne=P.queue[Re+1];ne&&ga(ne,Re+1)};a.useEffect(()=>{if(ge&&le){mn(l,le).then(g=>$(g.name)).catch(()=>$(t.cogita.library.collections.defaultName));return}if(O==="info"&&k){ua({libraryId:l,infoId:k}).then(g=>{const T=g.payload??{};$(T.title||T.label||T.name||k)}).catch(()=>$(k||t.cogita.library.revision.runKicker));return}if(O==="info-selection"){const g=Y?ls(l,Y):null,T=(g==null?void 0:g.infoIds.length)??0;$(T>0?`Selected infos (${T})`:"Selected infos");return}$(t.cogita.library.collections.defaultName)},[t,le,ge,l,O,k,Y]),a.useEffect(()=>{Jn({libraryId:l,type:"language"}).then(g=>G(g)).catch(()=>G([]))},[l]),a.useEffect(()=>{ge&&Un({libraryId:l}).then(g=>Kt(g.items??[])).catch(()=>Kt([]))},[ge,l]),a.useEffect(()=>{An(l,_)},[l,_]),a.useEffect(()=>{La(pe)},[pe,Jt,jt,ea,le]),a.useEffect(()=>{if(!H||!jt){_t(!1);return}if(H.cardType!=="info"||ee.has(ve(H))){_t(!1);return}const g=qa(Re+1);if(g>=0){_t(!1),Pe(g);return}if(b.id==="temporal"||b.id==="levels"){const T=pe.slice(0,Re+1),P=pe.slice(Re+1).filter($a),ne=T.concat(P),de=new Set(ne.map(ve)),Z=yn(de);if(Z){const Q=ve(Z);de.has(Q)||(ne.push(Z),de.add(Q),ut(we=>{const De=we,He=new Set(De.queued??[]);return He.add(Q),{...De,queued:He}}))}const fe=ne.findIndex((Q,we)=>we!==Re&&$a(Q));if(fe>=0){U(ne),Pe(fe),_t(!1);return}}_t(!0)},[H,ee,jt,Re,pe,_e,b.id]),a.useEffect(()=>{let g=!0;return(async()=>{re("loading"),Se({current:0,total:b.id==="levels"?0:b.getFetchLimit(C,m)});try{if(!ge){if(Kt([]),O==="info"){if(!k){g&&(U([]),Kt([]),ut({}),Pe(0),re("ready"));return}const[Ve,Ze]=await Promise.all([Ga({libraryId:l,infoId:k}),Ya({libraryId:l,infoId:k})]);if(!g)return;const st=Da(Ve.items??[]);Kt(Ze.items??[]);const lt=b.prepare(st,C,m);U(lt.queue),ut(lt.meta),Pe(0),re("ready"),Se({current:st.length,total:st.length});return}if(O==="info-selection"){const Ve=Y?ls(l,Y):null,Ze=(Ve==null?void 0:Ve.infoIds)??[];if(!Ze.length){g&&(U([]),Kt([]),ut({}),Pe(0),re("ready"));return}const st=await Promise.all(Ze.map(async pa=>{const[qt,Ua]=await Promise.all([Ga({libraryId:l,infoId:pa}),Ya({libraryId:l,infoId:pa})]);return{cards:qt.items??[],deps:Ua.items??[]}}));if(!g)return;const lt=new Map;st.forEach(pa=>{Da(pa.cards).forEach(qt=>{lt.set(ve(qt),qt)})});const ct=Array.from(lt.values()),dt=new Set(ct.map(ve)),Lt=new Map;st.forEach(pa=>{(pa.deps??[]).forEach(qt=>{const Ua=Yt(qt.parentItemType,qt.parentItemId,kt(qt.parentCheckType),kt(qt.parentDirection)),es=Yt(qt.childItemType,qt.childItemId,kt(qt.childCheckType),kt(qt.childDirection));if(!dt.has(Ua)||!dt.has(es))return;const ts=`${Ua}->${es}`;Lt.has(ts)||Lt.set(ts,qt)})}),Kt(Array.from(Lt.values()));const wa=b.prepare(ct,C,m);U(wa.queue),ut(wa.meta),Pe(0),re("ready"),Se({current:ct.length,total:ct.length});return}}const P=[];let ne=null,de=null;do{const Ve=await Xa({libraryId:l,collectionId:le,limit:300,cursor:ne});if(P.push(...Ve.items),(b.id==="levels"||b.id==="temporal")&&Ve.total&&(de=Ve.total),Se(Ze=>({current:P.length,total:Ze.total||Ve.total||b.getFetchLimit(C,m)})),ne=Ve.nextCursor??null,de!==null&&P.length>=de||b.id!=="levels"&&b.id!=="temporal"&&P.length>=b.getFetchLimit(C,m))break}while(ne);if(!g)return;const Z=Da(P);let fe;if(b.id==="levels"){const Ve=Math.max(1,Number(m.levels??1)),st=(await da()).reduce((lt,ct)=>{const dt=Yt(ct.itemType,ct.itemId,ct.checkType,ct.direction);return lt[dt]||(lt[dt]=[]),lt[dt].push(ct),lt},{});fe={},Z.forEach(lt=>{const ct=ve(lt),dt=st[ct]??[],Lt=dt.length>0?ca(dt).score:0,wa=Math.max(1,Math.min(Ve,Math.ceil(Lt/100*Ve)));fe[ct]=wa})}let Q=null,we=null,De=null;if(b.id==="temporal"){const Ve=await da(),Ze=new Set(Z.map(ct=>ve(ct))),st=Ve.reduce((ct,dt)=>{const Lt=Yt(dt.itemType,dt.itemId,dt.checkType,dt.direction);return Ze.has(Lt)&&(ct[Lt]||(ct[Lt]=[]),ct[Lt].push(dt)),ct},{});Q={},we=new Set,De={};const lt=Date.now();Z.forEach(ct=>{const dt=ve(ct),Lt=st[dt]??[];if(Lt.length===0){Q[dt]=0,we.add(dt),De[dt]=[];return}const wa=Gn(Lt);De[dt]=wa;const pa=pn(wa,lt);Q[dt]=pa.knowness})}const He=b.id==="levels"?Xn(Z,C,m,fe):b.id==="temporal"?Yn(Z,C,m,Q??{},we??new Set,De??{}):b.prepare(Z,C,m);U(He.queue),ut(He.meta),Pe(0),re("ready"),Se(Ve=>({current:Math.min(Ve.current,Ve.total),total:Ve.total}))}catch{g&&re("error")}})(),()=>{g=!1}},[le,ge,l,C,O,m,b,_,k,Y]),a.useEffect(()=>{if(Ge(""),ke(null),It(null),wt(0),Ne([]),ze({}),E({}),N(null),F(null),q(null),Qe(!1),at(!1),ht(null),ie(null),oe({}),!H){gt(null),Be(null),M(null),xt(null);return}H.cardType==="info"&&H.infoType==="computed"&&gt(t.cogita.library.revision.loadingComputed);let g=!0;return ga(H,Re).then(T=>{!g||!T||(gt(T.prompt),Be(T.expectedAnswer),Ne(T.computedExpected),ze(T.computedAnswers),M(T.computedValues),N(T.answerTemplate),F(T.outputVariables),q(T.variableValues))}),()=>{g=!1}},[H,t]),a.useEffect(()=>{if(!H||H.cardType!=="info"||H.infoType!=="citation"){r.current=null,D.current=new Set,rt(null);return}const g=H.description??"",T=(H.label??"").trim(),P=T.replace(/\s+/g," ").trim(),ne=g.replace(/\s+/g," ").trim(),de=P&&P!==ne?T:t.cogita.library.infoTypes.citation;if(!g){rt(null),Be(null);return}const Z=ka(g);r.current=Z,gt(de);let fe=!0;return Oa().then(({fragmentKnowness:Q})=>{if(!fe)return;const we=new Set,De={};Q.forEach((Ze,st)=>{const[lt,ct]=st.split(":",2);if(lt!==H.cardId)return;const dt=Ut(ct);if(!dt)return;const{fragmentId:Lt}=dt;De[Lt]=Ze,Ze>=ea&&we.add(Lt)}),D.current=we,he.current=De;const He=Ut(H.direction);if(He!=null&&He.fragmentId&&Z.nodes[He.fragmentId]){A(Z,He.fragmentId,de);return}const Ve=Ia(Z,we,De,ea,jt,H.direction);A(Z,(Ve==null?void 0:Ve.id)??null,de)}).catch(()=>{D.current=new Set,he.current={};const Q=Ut(H.direction);if(Q!=null&&Q.fragmentId&&Z.nodes[Q.fragmentId]){A(Z,Q.fragmentId,de);return}const we=Ia(Z,D.current,{},ea,jt,H.direction);A(Z,(we==null?void 0:we.id)??null,de)}),()=>{fe=!1}},[H,t,jt,ea]),a.useEffect(()=>{if(!H||H.cardType!=="vocab"||H.checkType!=="translation-match"){ie(null),oe({});return}const P=(_e.pool??_e.active??pe).filter(Q=>Q.cardType==="vocab"&&Q.checkType==="translation-match").filter((Q,we,De)=>De.findIndex(He=>He.cardId===Q.cardId)===we);P.some(Q=>Q.cardId===H.cardId)||P.unshift(H);const de=Gt(P).slice(0,6).map(Q=>{const we=Q.label.split("↔").map(Ve=>Ve.trim()).filter(Boolean);if(we.length<2)return null;const De=`${Q.cardId}:L`,He=`${Q.cardId}:R`;return{cardId:Q.cardId,leftId:De,rightId:He,leftLabel:we[0],rightLabel:we[1]}}).filter(Boolean),Z=de.map(Q=>Q.leftId),fe=Gt(de.map(Q=>Q.rightId));ie({pairs:de,leftOrder:Z,rightOrder:fe,selection:{},activeLeft:null,activeRight:null,locked:{}})},[H,pe,_e]),a.useEffect(()=>()=>{Me.current&&window.clearTimeout(Me.current),Ie.current&&window.clearTimeout(Ie.current)},[]);const ia=a.useRef(null);a.useEffect(()=>{if(!H)return;const g=ve(H),T=typeof document<"u"?document.activeElement:null;if(ia.current===g&&T&&(T.tagName==="INPUT"||T.tagName==="TEXTAREA"))return;let P=0;const ne=()=>{if(H){if(H.cardType==="info"&&H.infoType==="computed"){if(qe.length>0){const Z=cn(x,qe,I),fe=Z?mt.current[Z]:null;if(fe&&(fe.focus(),document.activeElement===fe)){ia.current=g;return}}if(ft.current&&(ft.current.focus(),document.activeElement===ft.current)){ia.current=g;return}}else if(H.cardType==="vocab"&&ft.current&&(ft.current.focus(),document.activeElement===ft.current)){ia.current=g;return}P<6&&(P+=1,window.setTimeout(ne,40))}},de=window.setTimeout(ne,40);return()=>window.clearTimeout(de)},[H,qe,x,I]),a.useEffect(()=>{if(!Pt)return;const g=T=>{T.key==="Enter"&&(T.preventDefault(),Ca())};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[Pt]);const Ta=g=>{vt(g),xt(ca(g))};a.useEffect(()=>{if(!H){xt(null),vt([]);return}const g=H.cardType==="info"?"info":"connection";if(H.cardType==="info"&&H.infoType==="citation"){da().then(T=>{const P=T.filter(ne=>ne.itemType==="info"&&ne.itemId===H.cardId&&ne.checkType==="quote-fragment"&&on(ne.direction,H.direction));Ta(P)}).catch(()=>{xt(null),vt([])});return}rn(g,H.cardId,H.checkType,H.direction).then(T=>Ta(T)).catch(()=>{xt(null),vt([])})},[l,H,_]);const va=(g,T,P,ne)=>{if(g==="info"&&P==="quote-fragment"){da().then(de=>{const Z=de.filter(fe=>fe.itemType==="info"&&fe.itemId===T&&fe.checkType==="quote-fragment"&&on(fe.direction,ne));Ta(Z)}).catch(()=>{xt(null),vt([])});return}rn(g,T,P,ne).then(de=>Ta(de)).catch(()=>{xt(null),vt([])})},Ra=(g,T,P)=>{var fe;const ne=((fe=P.pairs.find(Q=>Q.leftId===g))==null?void 0:fe.rightId)??null;if(!ne)return P;const de=ne===T;oe(Q=>({...Q,[g]:de?"correct":"incorrect"})),Me.current&&window.clearTimeout(Me.current),Ie.current&&window.clearTimeout(Ie.current),J.current+=1;const Z={kind:de?"correct":"incorrect",tick:J.current};if($e(null),Me.current=window.setTimeout(()=>$e(Z),0),Ie.current=window.setTimeout(()=>$e(null),420),de){const Q={...P.locked,[g]:!0};return Object.keys(Q).length>=P.pairs.length?(ke("correct"),at(!0)):ke("correct"),{...P,selection:{...P.selection,[g]:T},activeLeft:null,activeRight:null,locked:Q}}return ke("incorrect"),{...P,activeLeft:null,activeRight:null}},vn=g=>{ie(T=>!T||T.locked[g]?T:T.activeRight?Ra(g,T.activeRight,T):{...T,activeLeft:T.activeLeft===g?null:g})},wn=g=>{ie(T=>T&&(T.activeLeft?Ra(T.activeLeft,g,T):{...T,activeRight:T.activeRight===g?null:g}))},Ca=()=>{var g;if(H&&H.cardType==="info"&&H.infoType==="citation"&&r.current&&et&&!((g=Ut(H.direction))!=null&&g.fragmentId)){const T=Ia(r.current,D.current,he.current,ea,jt,H.direction,et.fragmentId);if(T){ke(null),Ge(""),Qe(!1),E({}),at(!1),It(null),wt(0),A(r.current,T.id,et.title);return}}ke(null),Ge(""),Qe(!1),E({}),at(!1),It(null),wt(0),Pe(T=>Math.min(T+1,pe.length))},ta=g=>{if(!H)return;const T=g.expected??null,P=g.answer??"";let ne=T??"",de=P;if(!T&&g.expectedMap&&g.answerMap){const Ve=Object.keys(g.expectedMap).sort((Ze,st)=>Ze.localeCompare(st));ne=Ve.map(Ze=>{var st;return((st=g.expectedMap)==null?void 0:st[Ze])??""}).join("|"),de=Ve.map(Ze=>{var st;return((st=g.answerMap)==null?void 0:st[Ze])??""}).join("|")}const Z=ne?Ma(ne,de,ra):new Uint8Array,fe={revisionType:b.id,evalType:g.evalType,direction:g.direction,prompt:Ue??"",expected:T,answer:P,expectedAnswers:g.expectedMap??null,answers:g.answerMap??null,correct:g.correct,maskBase64:Z.length?ba(Z):null,values:R??null,checkMode:ae,compareMode:ra,minCorrectness:Rt},Q=new TextEncoder().encode(JSON.stringify(fe)),we=H.cardType==="info"?"info":"connection",De=g.overrideCheckType??H.checkType??null,He=g.overrideDirection??H.direction??null;sn({itemType:we,itemId:H.cardId,checkType:De,direction:He,revisionType:b.id,evalType:g.evalType,correct:g.correct,maskBase64:Z.length?ba(Z):null,payloadBase64:ba(Q),personRoleId:_??null}).then(()=>{va(we,H.cardId,De,He),La(pe),An(l,_)}).catch(()=>{})},jn=(g,T)=>{const P=ot.current.get(T);if(P)return Promise.resolve(P);const ne=bt.current.get(T);if(ne)return ne;const de=ua({libraryId:l,infoId:g}).then(Z=>{var Ve,Ze;const fe=Z.payload,Q=((Ve=fe.definition)==null?void 0:Ve.graph)??null,we="",De=((Ze=fe.definition)==null?void 0:Ze.answerTemplate)??"",He=Gs(Q,we,De);if(He){const lt={sample:Ys(He),answerTemplate:De||null};return ot.current.set(T,lt),lt}return ss({libraryId:l,infoId:g}).then(st=>{const lt={sample:st,answerTemplate:null};return ot.current.set(T,lt),lt})}).catch(()=>ss({libraryId:l,infoId:g}).then(Z=>{const fe={sample:Z,answerTemplate:null};return ot.current.set(T,fe),fe}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{bt.current.delete(T)});return bt.current.set(T,de),de},ga=(g,T)=>{var Q;const P=`${ve(g)}:${T}`,ne=Tt.current.get(P);if(ne)return Promise.resolve(ne);const de=$t.current.get(P);if(de)return de;const Z=we=>(Tt.current.set(P,we),we);let fe;if(g.cardType==="vocab"){if(g.checkType==="translation-match")return fe=Promise.resolve(Z({prompt:g.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),fe;const we=g.label.split("↔").map(De=>De.trim()).filter(Boolean);if(we.length>=2){const He=(g.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",Ve=He?we[0]:we[1],Ze=He?we[1]:we[0];fe=Promise.resolve(Z({prompt:Ve,expectedAnswer:Ze,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else fe=Promise.resolve(Z({prompt:g.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(g.cardType==="info"&&g.infoType==="word"){const we=(Q=g.description)!=null&&Q.startsWith("Language: ")?g.description.replace("Language: ",""):null;fe=Promise.resolve(Z({prompt:g.label,expectedAnswer:we,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else g.cardType==="info"&&g.infoType==="computed"?fe=jn(g.cardId,P).then(we=>{var st,lt;if(!we.sample)return Z({prompt:g.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const De=we.sample,He=De.expectedAnswers?Object.entries(De.expectedAnswers).map(([ct,dt])=>({key:ct,expected:dt})):[],Ve=He.reduce((ct,dt)=>(ct[dt.key]="",ct),{}),Ze=De.expectedAnswerIsSentence&&((st=De.expectedAnswer)==null?void 0:st.trim())||null;return Z({prompt:De.prompt,expectedAnswer:He.length>0?Ze:((lt=De.expectedAnswer)==null?void 0:lt.trim())||null,computedExpected:He,computedAnswers:Ve,computedValues:De.values??null,answerTemplate:we.answerTemplate,outputVariables:De.outputVariables??null,variableValues:De.variableValues??null})}).catch(()=>Z({prompt:g.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{$t.current.delete(P)}):fe=Promise.resolve(Z({prompt:g.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return $t.current.set(P,fe),fe},A=(g,T,P)=>{const ne=Object.keys(g.nodes).length,de=D.current.size;if(!T){rt({title:P,before:g.text,after:"",fragmentId:null,total:ne,completed:de}),Be(null),at(!0);return}const Z=g.nodes[T];if(!Z)return;const fe=Hn(g.text,Z);rt({title:P,before:fe.before,after:fe.after,fragmentId:Z.id,total:ne,completed:de}),Be(fe.fragment),at(!1)},X=()=>{const g=r.current;g&&rt(T=>T&&{...T,total:Object.keys(g.nodes).length,completed:D.current.size})},be=()=>{const g=pe[Re+1];g&&ga(g,Re+1)},Ke=()=>{if(be(),H&&H.cardType==="vocab"&&H.checkType==="translation-match"&&me){if(me.pairs.length===0){ke("incorrect"),at(!0);return}const Z=me.pairs.reduce((Ze,st)=>(Ze[st.rightId]=st.rightLabel,Ze),{});let fe=0;const Q={};me.pairs.forEach(Ze=>{const lt=me.selection[Ze.leftId]===Ze.rightId;Q[Ze.leftId]=lt?"correct":"incorrect",lt&&(fe+=1)});const we=me.pairs.length||1,De=fe/we,He=fe===me.pairs.length;oe(Ze=>({...Ze,...Q})),He?(ke("correct"),at(!0),wt(0)):(ke("incorrect"),at(!1),wt(Ze=>{const st=Ze+1;return st>=Bt&&(Qe(!0),at(!0),ie(lt=>{if(!lt)return lt;const ct=lt.pairs.reduce((dt,Lt)=>(dt[Lt.leftId]=Lt.rightId,dt),{});return{...lt,selection:ct}})),st})),zt(He,De);const Ve="connection";Promise.all(me.pairs.map(Ze=>{const st=me.selection[Ze.leftId]??null,lt=st?Z[st]:"",ct={left:Ze.leftLabel,expected:Ze.rightLabel,answer:lt,checkType:"translation-match"},dt=new TextEncoder().encode(JSON.stringify(ct));return sn({itemType:Ve,itemId:Ze.cardId,checkType:"translation-match",direction:null,revisionType:b.id,evalType:"translation-match",correct:st===Ze.rightId,maskBase64:null,payloadBase64:ba(dt),personRoleId:_??null})})).then(()=>{va(Ve,H.cardId,H.checkType,H.direction),An(l,_)}).catch(()=>{});return}if(qe.length>0){const Z=qe.reduce((Q,we)=>{const De=Te[we.key]??"";return Q[we.key]=Ft(De)===Ft(we.expected)?"correct":"incorrect",Q},{});qe.every(({key:Q,expected:we})=>{const De=Te[Q]??"";return ae==="exact"&&Ft(De)===Ft(we)})?(ke("correct"),E(Z),at(!0),wt(0),zt(!0,1),ta({correct:!0,direction:Ue?`${Ue} -> computed`:"computed",expectedMap:qe.reduce((Q,we)=>(Q[we.key]=we.expected,Q),{}),answerMap:Te,evalType:"computed"})):(ke("incorrect"),E(Z),at(!1),wt(Q=>{const we=Q+1;return we>=Bt&&Je&&(Qe(!0),at(!0)),we}),zt(!1,0),window.setTimeout(()=>{var we;const Q=cn(x,qe,I);Q&&mt.current[Q]&&((we=mt.current[Q])==null||we.focus())},40),ta({correct:!1,direction:Ue?`${Ue} -> computed`:"computed",expectedMap:qe.reduce((Q,we)=>(Q[we.key]=we.expected,Q),{}),answerMap:Te,evalType:"computed"}));return}if(H&&H.cardType==="info"&&H.infoType==="citation"&&(et!=null&&et.fragmentId)){if(!We)return;const Z=Ut(H.direction),fe=(Z==null?void 0:Z.fragmentId)??et.fragmentId,Q=an(We,Le,{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}),we=Q.mask,De=Q.isCorrect,He=Q.percent;De?(he.current[et.fragmentId]=Math.max(he.current[et.fragmentId]??0,He),(he.current[et.fragmentId]??0)>=ea&&D.current.add(et.fragmentId),X(),ke("correct"),E({}),at(!0),It(we),wt(0),He<100&&Bt<=1&&Qe(!0),zt(!0,He/100),ta({correct:!0,direction:`quote:${et.fragmentId}`,expected:We,answer:Le,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:fe})):(ke("incorrect"),E({}),at(!1),It(we),wt(Ve=>{const Ze=Ve+1;return Ze>=Bt&&Je&&(Qe(!0),at(!0)),Ze}),zt(!1,He/100),window.setTimeout(()=>{var Ve;return(Ve=ft.current)==null?void 0:Ve.focus()},40),ta({correct:!1,direction:`quote:${et.fragmentId}`,expected:We,answer:Le,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:fe}));return}if(!We)return;const g=Ma(We,Le,ra),T=ae==="exact"&&Ft(Le)===Ft(We),P=xa(g),ne=T||P,de=ya(g);ne?(ke("correct"),E({}),at(!0),It(g),wt(0),de<100&&Bt<=1&&Qe(!0),zt(!0,de/100),ta({correct:!0,direction:Ue?`${Ue} -> ${We}`:null,expected:We,answer:Le,evalType:"text"})):(ke("incorrect"),E({}),at(!1),It(g),wt(Z=>{const fe=Z+1;return fe>=Bt&&Je&&(Qe(!0),at(!0)),fe}),zt(!1,de/100),window.setTimeout(()=>{var Z;return(Z=ft.current)==null?void 0:Z.focus()},40),ta({correct:!1,direction:Ue?`${Ue} -> ${We}`:null,expected:We,answer:Le,evalType:"text"}))},Fe=g=>{if(be(),!We)return;const T=Ma(We,g,ra),P=Ft(g)===Ft(We),ne=xa(T),de=P||ne,Z=ya(T);de?(ke("correct"),E({}),at(!0),It(T),wt(0),Z<100&&Bt<=1&&Qe(!0),zt(!0,Z/100),ta({correct:!0,direction:"word->language",expected:We,answer:g,evalType:"language-select"})):(ke("incorrect"),E({}),at(!1),It(T),wt(fe=>{const Q=fe+1;return Q>=Bt&&Je&&(Qe(!0),at(!0)),Q}),zt(!1,Z/100),ta({correct:!1,direction:"word->language",expected:We,answer:g,evalType:"language-select"}))},ye=()=>{be(),ke("correct"),at(!0),wt(0),zt(!0,1),We&&ta({correct:!0,direction:"manual",expected:We,answer:Le,evalType:"manual"})},Ae=()=>{if(zt(!1,0),H&&H.cardType==="info"&&H.infoType==="citation"){ke(null),Ge(""),Qe(!1),E({}),at(!1),It(null),wt(0),Pe(g=>Math.min(g+1,pe.length));return}Ca()};a.useEffect(()=>{be()},[Re,pe]);const Ce=g=>{var P;if(g.key!=="Enter")return;if(g.preventDefault(),g.stopPropagation(),Pt){Ca();return}const T=qe.find(ne=>!(Te[ne.key]??"").trim());if(T){(P=mt.current[T.key])==null||P.focus();return}Ke()},Ee=t.cogita.library.revision.revealModeAfterIncorrect,Je=qe.length>0||!!We;return e.jsxs(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:[xe==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${te.total?Math.min(100,Math.max(0,te.current/te.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:te.total?`${Math.min(te.current,te.total)} / ${te.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:ue}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",je).replace("{check}",Oe)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:w,children:t.cogita.library.actions.libraryOverview}),ge?e.jsxs(e.Fragment,{children:[e.jsx("a",{className:"cta ghost",href:`${w}/collections`,children:t.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${w}/collections/${le}`,children:t.cogita.library.actions.collectionDetail})]}):e.jsx("a",{className:"cta ghost",href:`${w}/list`,children:t.cogita.library.actions.allCards})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Nt?`${Nt.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Vt?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Vt.currentLevel??"-"," / ",Vt.levelsCount]}):null,Nt?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(Nt.correct)).replace("{total}",String(Nt.total))}),Nt.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(Nt.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(Xs,{outcomes:Ct})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[Mt?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:Mt})}):null,e.jsx(Wn,{feedbackToken:W?`${W.kind}-${W.tick}`:Xe?"idle":it??"idle",children:H?e.jsx(e.Fragment,{children:na?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(Qn,{copy:t,currentCard:H,currentTypeLabel:yt,prompt:Ue,languages:ce,answer:Le,onAnswerChange:g=>Ge(T=>ln(T,g,nt)),computedExpected:qe,computedAnswers:Te,onComputedAnswerChange:(g,T)=>ze(P=>({...P,[g]:ln(P[g]??"",T,nt)})),answerTemplate:x,outputVariables:I,variableValues:V,computedFieldFeedback:B,feedback:it,canAdvance:Pt,quoteContext:et,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ke,onSkip:Ae,onLanguageSelect:Fe,onMarkReviewed:ye,onAdvance:Ca,showCorrectAnswer:Ye,setShowCorrectAnswer:Qe,onRevealCorrect:()=>at(!0),answerMask:ma,expectedAnswer:We,hasExpectedAnswer:Je,handleComputedKeyDown:Ce,answerInputRef:ft,computedInputRefs:mt,scriptMode:nt,setScriptMode:ht,matchPairs:me==null?void 0:me.pairs,matchLeftOrder:me==null?void 0:me.leftOrder,matchRightOrder:me==null?void 0:me.rightOrder,matchSelection:me==null?void 0:me.selection,matchActiveLeft:me==null?void 0:me.activeLeft,matchActiveRight:me==null?void 0:me.activeRight,matchFeedback:se,onMatchLeftSelect:vn,onMatchRightSelect:wn})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:ge?`${w}/collections/${le}`:`${w}/list`,children:ge?t.cogita.library.actions.collectionDetail:t.cogita.library.actions.allCards})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Zt?`${sa} / ${Zt}`:t.cogita.library.revision.progressUnlimited}),xe==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),xe==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),xe==="ready"&&pe.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:Ee}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",Bt]})]})]}),Vt?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Vt.activeCount," / ",Vt.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Vt.counts.map((g,T)=>{const P=T+1,ne=Vt.currentLevel===P,de=Vt.percentages[T]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":ne,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:P}),e.jsx("strong",{children:g})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,de))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[de.toFixed(1),"%"]})]},`level-${P}`)})})]}):null,Ot?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:Ot.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:Ot.dots.map(g=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,g.value*100))}%`,background:`rgba(${Math.round(255*(1-g.value))}, ${Math.round(200*g.value)}, 80, 0.9)`}},g.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:Ot.knownCount})]})]}):null,jt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:xn})]})}):null]})]})]})})})]})]})}const Pn=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],qi={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},Ui=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Ji=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Hi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:l,collectionId:f}){const[c,d]=a.useState(""),[w,p,C]=Bn([]),[z,b,m]=Vn([]),[ae,_]=a.useState(null),[y,O]=a.useState(null),[k,Y]=a.useState(null),K=`/#/cogita/library/${l}`;a.useEffect(()=>{mn(l,f).then($=>d($.name)).catch(()=>d(t.cogita.library.collections.defaultName))},[l,f,t]),a.useEffect(()=>{wr({libraryId:l,collectionId:f}).then($=>{if(!$.graphId||$.graphId==="00000000-0000-0000-0000-000000000000"){p([]),b([]);return}const pe=$.nodes.map(ce=>{var te;const G=ce.payload??{},xe=G.position??{x:120,y:120},re=G.params??{};return{id:ce.nodeId,type:"default",position:xe,data:{nodeType:ce.nodeType,label:((te=Pn.find(Se=>Se.type===ce.nodeType))==null?void 0:te.label)??ce.nodeType,params:re}}}),U=$.edges.map(ce=>({id:ce.edgeId,source:ce.fromNodeId,target:ce.toNodeId,sourceHandle:ce.fromPort??void 0,targetHandle:ce.toPort??void 0}));p(pe),b(U)}).catch(()=>{p([]),b([])})},[l,f,b,p]);const L=a.useMemo(()=>w.find($=>$.id===ae)??null,[w,ae]),le=$=>{var G;const pe=crypto.randomUUID(),U=((G=Pn.find(xe=>xe.type===$))==null?void 0:G.label)??$,ce={...qi[$]};p(xe=>[...xe,{id:pe,type:"default",position:{x:120+xe.length*40,y:120+xe.length*40},data:{nodeType:$,label:U,params:ce}}]),_(pe)},ge=a.useCallback($=>{b(pe=>On({...$,id:crypto.randomUUID()},pe))},[b]),je=async()=>{O(null);try{await _s({libraryId:l,collectionId:f,nodes:w.map($=>({nodeId:$.id,nodeType:$.data.nodeType,payload:{position:$.position,params:$.data.params}})),edges:z.map($=>({edgeId:$.id,fromNodeId:$.source,fromPort:$.sourceHandle??null,toNodeId:$.target,toPort:$.targetHandle??null}))}),O(t.cogita.library.graph.saveSuccess)}catch{O(t.cogita.library.graph.saveFail)}},Oe=async()=>{try{const $=await jr({libraryId:l,collectionId:f});Y($)}catch{Y(null)}},ue=$=>{L&&p(pe=>pe.map(U=>U.id===L.id?{...U,data:{...U.data,params:$}}:U))};return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:c}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${K}/collections/${f}`,children:t.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:Oe,children:t.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:je,children:t.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:Pn.map($=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>le($.type),children:$.label},$.type))}),y?e.jsx("p",{className:"cogita-help",children:y}):null,k&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:t.cogita.library.graph.previewLabel.replace("{total}",String(k.total))}),e.jsx("p",{children:t.cogita.library.graph.previewBreakdown.replace("{connections}",String(k.connections)).replace("{infos}",String(k.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(un,{nodes:w,edges:z,onNodesChange:C,onEdgesChange:m,onConnect:ge,onNodeClick:($,pe)=>_(pe.id),fitView:!0,children:[e.jsx(hn,{color:"rgba(120,160,200,0.2)"}),e.jsx(gn,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.graph.inspector}),L?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:L.data.label}),L.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Qt,{libraryId:l,infoType:"topic",label:t.cogita.library.graph.tagLabel,placeholder:t.cogita.library.graph.tagPlaceholder,value:L.data.params.tagId?{id:L.data.params.tagId,label:L.data.params.tagLabel??"",infoType:"topic"}:null,onChange:$=>ue({...L.data.params,tagId:($==null?void 0:$.id)??null,tagLabel:($==null?void 0:$.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.topic),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:L.data.params.scope??"any",onChange:$=>ue({...L.data.params,scope:$.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:t.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),L.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Qt,{libraryId:l,infoType:"language",label:t.cogita.library.graph.languageLabel,placeholder:t.cogita.library.graph.languagePlaceholder,value:L.data.params.languageId?{id:L.data.params.languageId,label:L.data.params.languageLabel??"",infoType:"language"}:null,onChange:$=>ue({...L.data.params,languageId:($==null?void 0:$.id)??null,languageLabel:($==null?void 0:$.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.language),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:L.data.params.scope??"any",onChange:$=>ue({...L.data.params,scope:$.target.value}),children:[e.jsx("option",{value:"any",children:t.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:t.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:t.cogita.library.graph.scopeWordB})]})]})]}),L.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:L.data.params.infoType??"word",onChange:$=>ue({...L.data.params,infoType:$.target.value}),children:Ji.map($=>e.jsx("option",{value:$.value,children:$.label},$.value))})]}),e.jsx(Qt,{libraryId:l,infoType:L.data.params.infoType??"word",label:t.cogita.library.graph.specificInfoLabel,placeholder:t.cogita.library.graph.specificInfoPlaceholder,value:L.data.params.infoId?{id:L.data.params.infoId,label:L.data.params.infoLabel??"",infoType:L.data.params.infoType??"word"}:null,onChange:$=>ue({...L.data.params,infoId:($==null?void 0:$.id)??null,infoLabel:($==null?void 0:$.label)??null}),searchFailedText:t.cogita.library.lookup.searchFailed,createFailedText:t.cogita.library.lookup.createFailed,createLabel:t.cogita.library.lookup.createNew.replace("{type}",t.cogita.library.infoTypes.word),savingLabel:t.cogita.library.lookup.saving,loadMoreLabel:t.cogita.library.lookup.loadMore})]}),L.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:L.data.params.connectionType??"translation",onChange:$=>ue({...L.data.params,connectionType:$.target.value}),children:Ui.map($=>e.jsx("option",{value:$.value,children:$.label},$.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:t.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:L.data.params.connectionId??"",onChange:$=>ue({...L.data.params,connectionId:$.target.value||null}),placeholder:t.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(L.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:t.cogita.library.graph.emptyInspector})]})]})})})]})})}const Kn="cogita.preferences",Fn="cogita.reviewer.preferences",ar=["library_overview","all_cards","all_collections","all_revisions","storyboards","texts","dependencies","transfer"],Dn={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},all_revisions:{requiresCollection:!1,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},transfer:{requiresCollection:!1,allowsRevision:!1},storyboards:{requiresCollection:!1,allowsRevision:!1},new_storyboard:{requiresCollection:!1,allowsRevision:!1},texts:{requiresCollection:!1,allowsRevision:!1},new_text:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},Wi=["settings","run","shared"];function Qi(t,n=""){const s=t.split("/").filter(Boolean);if(s[0]!=="cogita"||s[1]!=="library")return{};const i=s[2];if(!i)return{};if(!s[3])return{libraryId:i,target:"library_overview"};const o=new URLSearchParams(n),u=o.get("revisionId")??void 0,h=o.get("infoId")??void 0,j=o.get("infoView"),v=j==="cards"?"cards":j==="collections"?"collections":"overview",S=o.get("collectionView")==="overview"?"overview":"infos",l=o.get("collectionAction"),f=o.get("libraryAction"),d=o.get("libraryTarget")==="revisions"?"all_revisions":"all_collections";if(s[3]==="list")return{libraryId:i,target:f==="new-info"?"new_card":"all_cards",cardMode:"list",revisionId:u,infoId:h,infoView:v,libraryAction:f==="new-info"?"new-info":void 0};if(s[3]==="detail"||s[3]==="collection")return{libraryId:i,target:"all_cards",cardMode:s[3],revisionId:u,infoId:h,infoView:v};if(s[3]==="new"||s[3]==="add")return{libraryId:i,target:"new_card",revisionId:u,libraryAction:"new-info"};if(s[3]==="edit")return{libraryId:i,target:"new_card",revisionId:u,infoId:s[4]};if(s[3]==="infos"){const p=s[4];return p?s[5]==="checkcards"?{libraryId:i,target:"all_cards",cardMode:"list",revisionId:u,infoId:p,infoView:"cards"}:s[5]==="collections"?{libraryId:i,target:"all_cards",cardMode:"list",revisionId:u,infoId:p,infoView:"collections"}:{libraryId:i,target:"all_cards",cardMode:"list",revisionId:u,infoId:p,infoView:"overview"}:{libraryId:i,target:"all_cards",cardMode:"list",revisionId:u}}if(s[3]==="shared-revisions")return{libraryId:i,target:d,revisionId:u};if(s[3]==="revisions"){const p=s[4];return p?p==="new"?{libraryId:i,target:"all_revisions",revisionView:"new"}:s[5]==="run"?{libraryId:i,target:"all_revisions",revisionId:p,revisionView:"run"}:s[5]==="shared"?{libraryId:i,target:"all_revisions",revisionId:p,revisionView:"shared"}:{libraryId:i,target:"all_revisions",revisionId:p,revisionView:"settings"}:{libraryId:i,target:"all_revisions"}}if(s[3]==="revision"&&s[4]==="run")return{libraryId:i,target:d,revisionView:"run",revisionId:u,infoId:h,infoView:v};if(s[3]==="dependencies")return{libraryId:i,target:"dependencies"};if(s[3]==="transfer")return{libraryId:i,target:"transfer"};if(s[3]==="storyboards")return s[4]==="new"?{libraryId:i,target:"new_storyboard"}:{libraryId:i,target:"storyboards"};if(s[3]==="texts")return s[4]==="new"?{libraryId:i,target:"new_text"}:{libraryId:i,target:"texts"};if(s[3]!=="collections")return{libraryId:i,target:"library_overview"};if(s[4]==="new")return{libraryId:i,target:"new_collection",revisionId:u};const w=s[4];return w?s[5]==="graph"?{libraryId:i,target:d,collectionId:w,revisionId:u,revisionView:"graph"}:s[5]==="shared-revisions"?{libraryId:i,target:d,collectionId:w,revisionId:u,revisionView:"shared"}:s[5]==="revision"?{libraryId:i,target:d,collectionId:w,revisionId:u,revisionView:s[6]==="run"?"run":"settings",collectionView:S}:l==="new-revision"?{libraryId:i,target:d,collectionId:w,revisionId:u,revisionView:"new"}:{libraryId:i,target:d,collectionId:w,revisionId:u,revisionView:"detail",collectionView:S}:l==="new-collection"?{libraryId:i,target:"new_collection",collectionAction:"new-collection"}:{libraryId:i,target:d}}function $s(t,n="library_overview",s,i,o,u,h="overview",j="infos"){const v=(S,l)=>{const f=new URLSearchParams;l!=null&&l.revisionId&&f.set("revisionId",l.revisionId),l!=null&&l.collectionAction&&f.set("collectionAction",l.collectionAction),l!=null&&l.libraryAction&&f.set("libraryAction",l.libraryAction),l!=null&&l.libraryTarget&&f.set("libraryTarget",l.libraryTarget),l!=null&&l.infoId&&f.set("infoId",l.infoId),l!=null&&l.infoView&&(l!=null&&l.infoId)&&f.set("infoView",l.infoView),l!=null&&l.collectionView&&l.collectionView!=="infos"&&f.set("collectionView",l.collectionView);const c=f.toString();return c?`${S}?${c}`:S};if(!t)return"/cogita";if(n==="library_overview")return v(`/cogita/library/${t}`,{revisionId:o});if(n==="all_cards")return u?h==="cards"?v(`/cogita/library/${t}/infos/${u}/checkcards`,{revisionId:o}):h==="collections"?v(`/cogita/library/${t}/infos/${u}/collections`,{revisionId:o}):v(`/cogita/library/${t}/infos/${u}`,{revisionId:o}):v(`/cogita/library/${t}/list`,{revisionId:o,infoId:u,infoView:h});if(n==="new_card")return u?v(`/cogita/library/${t}/edit/${u}`,{revisionId:o}):v(`/cogita/library/${t}/list`,{revisionId:o,libraryAction:"new-info"});if(n==="all_collections"||n==="all_revisions"){const S=n==="all_revisions"?"revisions":void 0;return n==="all_revisions"&&o?i==="run"?v(`/cogita/library/${t}/revisions/${o}/run`,{revisionId:o}):i==="shared"?v(`/cogita/library/${t}/revisions/${o}/shared`,{revisionId:o}):v(`/cogita/library/${t}/revisions/${o}`,{revisionId:o}):n==="all_revisions"&&i==="new"?v(`/cogita/library/${t}/revisions/new`,{revisionId:o}):n==="all_revisions"?i==="run"?v(`/cogita/library/${t}/revision/run`,{revisionId:o,libraryTarget:S}):v(`/cogita/library/${t}/revisions`,{revisionId:o}):!s&&i==="run"?v(`/cogita/library/${t}/revision/run`,{revisionId:o,libraryTarget:S}):s?i==="graph"?v(`/cogita/library/${t}/collections/${s}/graph`,{revisionId:o,libraryTarget:S}):i==="settings"?v(`/cogita/library/${t}/collections/${s}/revision`,{revisionId:o,libraryTarget:S}):i==="run"?v(`/cogita/library/${t}/collections/${s}/revision/run`,{revisionId:o,libraryTarget:S}):i==="shared"?v(`/cogita/library/${t}/collections/${s}/shared-revisions`,{revisionId:o,libraryTarget:S}):i==="new"?v(`/cogita/library/${t}/collections/${s}`,{revisionId:o,libraryTarget:S,collectionAction:"new-revision"}):v(`/cogita/library/${t}/collections/${s}`,{revisionId:o,libraryTarget:S,collectionView:j}):v(`/cogita/library/${t}/collections`,{revisionId:o,libraryTarget:S})}return n==="new_collection"?v(`/cogita/library/${t}/collections`,{revisionId:o,collectionAction:"new-collection"}):n==="transfer"?v(`/cogita/library/${t}/transfer`,{revisionId:o}):n==="storyboards"?v(`/cogita/library/${t}/storyboards`,{revisionId:o}):n==="new_storyboard"?v(`/cogita/library/${t}/storyboards/new`,{revisionId:o}):n==="texts"?v(`/cogita/library/${t}/texts`,{revisionId:o}):n==="new_text"?v(`/cogita/library/${t}/texts/new`,{revisionId:o}):n==="dependencies"?v(`/cogita/library/${t}/dependencies`,{revisionId:o}):v(`/cogita/library/${t}`,{revisionId:o})}function fa(t){return t.length>1&&t.endsWith("/")?t.slice(0,-1):t}function Gi(t){return typeof t=="string"&&ar.includes(t)}function Yi(t,n){var j;if(!t.length)return null;const s=t.filter(v=>n.has(v.roleId)),i=s.length>0?s:t,o=i.map(v=>{var l,f;const S=((f=(l=v.fields.find(c=>c.fieldType==="role_kind"))==null?void 0:l.plainValue)==null?void 0:f.toLowerCase())??"";return{roleId:v.roleId,roleKind:S}}),u=o.find(v=>v.roleKind.includes("master"));if(u)return u.roleId;const h=o.find(v=>v.roleKind.includes("account")||v.roleKind.includes("user"));return h?h.roleId:((j=i[0])==null?void 0:j.roleId)??null}function Xi(t){if(!t)return{version:1,byLibrary:{}};try{const n=JSON.parse(t);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Zi({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S}){const l=dn(),f=Ba(),c=a.useMemo(()=>Qi(f.pathname,f.search),[f.pathname,f.search]),d=t.cogita.workspace,[w,p]=a.useState([]),[C,z]=a.useState([]),[b,m]=a.useState([]),[ae,_]=a.useState([]),[y,O]=a.useState(void 0),[k,Y]=a.useState("library_overview"),[K,L]=a.useState(void 0),[le,ge]=a.useState(void 0),[je,Oe]=a.useState("detail"),[ue,$]=a.useState(void 0),[pe,U]=a.useState(!1),[ce,G]=a.useState(!0),[xe,re]=a.useState(!1),[te,Se]=a.useState(!1),[Re,Pe]=a.useState(null),[Le,Ge]=a.useState(0),[it,ke]=a.useState(""),[Ue,gt]=a.useState(""),[We,Be]=a.useState(""),[et,rt]=a.useState([]),[qe,Ne]=a.useState(""),[Te,ze]=a.useState(0),[B,E]=a.useState(null),[R,M]=a.useState(null),x=a.useRef({version:1,byLibrary:{}}),N=a.useRef(!1),I=a.useRef(!1),F=a.useRef(null),V=a.useMemo(()=>w.find(r=>r.libraryId===y)??null,[w,y]),q=a.useMemo(()=>C.find(r=>r.collectionId===K)??null,[C,K]),me=fa(f.pathname)==="/cogita/persons";a.useEffect(()=>{if(!y){rt([]),Ne("");return}let r=!1;return Vs({libraryId:y}).then(D=>{if(r)return;const he=D.filter(H=>(H.roleKind??"").trim().toLowerCase()==="person");rt(he);try{const H=window.localStorage.getItem(Fn),ot=(H?JSON.parse(H):{})[y]??"",bt=ot&&he.some(Tt=>Tt.roleId===ot)?ot:"";Ne(bt)}catch{Ne("")}}).catch(()=>{r||(rt([]),Ne(""))}),()=>{r=!0}},[y,Te]),a.useEffect(()=>{if(y)try{const r=window.localStorage.getItem(Fn),D=r?JSON.parse(r):{};qe?D[y]=qe:delete D[y],window.localStorage.setItem(Fn,JSON.stringify(D))}catch{}},[y,qe]);const ie=a.useMemo(()=>ae.find(r=>r.revisionId===le)??null,[ae,le]),se=a.useMemo(()=>({detail:d.revisions.detail,graph:d.revisions.graph,settings:d.revisions.settings,run:d.revisions.run,shared:d.targets.sharedRevisions,new:d.revisionForm.createAction}),[d.revisions.detail,d.revisions.graph,d.revisions.run,d.revisions.settings,d.targets.sharedRevisions,d.revisionForm.createAction]),oe=a.useMemo(()=>k==="new_card"?"all_cards":k==="new_collection"?"all_collections":k==="new_storyboard"?"storyboards":k==="new_text"?"texts":k,[k]),J=a.useMemo(()=>je==="new"?"settings":je,[je]),W=k==="all_collections"||k==="all_revisions",$e=a.useMemo(()=>k==="new_collection"?"create":k==="all_collections"&&K?"selected":"search",[K,k]),Me=a.useMemo(()=>c.infoId?"selected":k==="new_card"?"create":"search",[c.infoId,k]),Ie=a.useMemo(()=>b.find(r=>r.infoId===c.infoId)??null,[b,c.infoId]),nt=a.useMemo(()=>({library_overview:d.targets.libraryOverview,all_cards:d.targets.allCards,new_card:d.targets.newCard,all_collections:d.targets.allCollections,all_revisions:d.targets.allRevisions,new_collection:d.targets.newCollection,transfer:d.targets.transfer,storyboards:d.targets.storyboards,new_storyboard:d.targets.newStoryboard,texts:d.targets.texts,new_text:d.targets.newText,dependencies:d.targets.dependencies}),[d.targets]),ht=a.useMemo(()=>nt[oe]??oe,[oe,nt]),Ye=se[J],Qe=!!y,Nt=a.useMemo(()=>{const r=v==="pl"?"Ruch na teraz: utwórz bibliotekę i wpisz pierwszy element wiedzy.":v==="de"?"Nächster Schritt: Erstelle eine Bibliothek und füge den ersten Wissenseintrag hinzu.":"Next action: create one library and add your first knowledge item.";return v==="pl"?[{step:"Krok 1",title:"Czym jest Cogita?",lead:"To centrum budowania i prowadzenia procesu nauki po zalogowaniu.",passages:["W jednym miejscu łączysz treści, ćwiczenia i współpracę zespołu.","Zamiast luźnych notatek dostajesz spójny przepływ: biblioteka → kolekcja → powtórka."],focus:["Jedna przestrzeń robocza","Spójny proces"],action:r},{step:"Krok 2",title:"Zacznij od biblioteki",lead:"Biblioteka jest bazą dla całego tematu.",passages:["Nazwij bibliotekę jasno: np. „Historia Kościoła – semestr 1”.","Każdy kolejny moduł korzysta z tej samej biblioteki jako źródła."],focus:["Nazwa tematyczna","Jeden punkt startowy"],action:r},{step:"Krok 3",title:"Dodawaj informacje",lead:"Twórz krótkie, konkretne jednostki wiedzy.",passages:["Wpisy typu info opisują pojęcia, osoby, źródła i cytaty.","Małe jednostki łatwiej łączyć, powtarzać i aktualizować."],focus:["Krótko i konkretnie","Łatwe aktualizacje"],action:r},{step:"Krok 4",title:"Pracuj na typach",lead:"Formularze dostosowują się do rodzaju informacji.",passages:["Każdy typ pokazuje właściwe pola i porządkuje dane.","To zmniejsza chaos i poprawia jakość wyszukiwania."],focus:["Lepsza struktura","Mniej błędów"],action:r},{step:"Krok 5",title:"Łącz wiedzę linkami",lead:"Buduj kontekst przez relacje między wpisami.",passages:["Połącz temat z definicją, źródłem i przykładem.","Graf relacji pomaga zobaczyć, czego brakuje przed kolejnym etapem."],focus:["Relacje między wpisami","Pełniejszy kontekst"],action:r},{step:"Krok 6",title:"Twórz kolekcje celu",lead:"Kolekcja grupuje wpisy pod konkretny scenariusz.",passages:["Osobna kolekcja dla lekcji, osobna dla quizu lub egzaminu.","Nie duplikujesz treści — tylko wybierasz, co jest potrzebne."],focus:["Celowe grupowanie","Bez duplikatów"],action:r},{step:"Krok 7",title:"Dodawaj powtórki",lead:"Powtórka definiuje jak przebiega sprawdzanie.",passages:["Ustaw tempo, kolejność i zakres materiału.","Dla jednej kolekcji możesz mieć kilka powtórek o różnych poziomach."],focus:["Kontrola tempa","Różne poziomy"],action:r},{step:"Krok 8",title:"Info vs karta",lead:"Rozróżniaj źródło wiedzy i widok ćwiczeniowy.",passages:["Info to rekord bazowy, który przechowuje treść.","Karta to forma pytania/utrwalenia generowana z info."],focus:["Źródło danych","Widok ćwiczeń"],action:r},{step:"Krok 9",title:"Uruchamiaj sesję",lead:"Tryb Run prowadzi uczestników krok po kroku.",passages:["Prowadzący kontroluje rytm i przejścia między etapami.","Uczestnicy mają jasny przebieg bez zgadywania, co dalej."],focus:["Płynny przebieg","Lepsza dynamika grupy"],action:r},{step:"Krok 10",title:"Czytaj graf zależności",lead:"Graf pokazuje priorytety nauki.",passages:["Węzły centralne oznaczają tematy, które wpływają na wiele innych.","Najpierw utrwal fundamenty, potem przechodź do warstw zaawansowanych."],focus:["Priorytety materiału","Lepsza kolejność"],action:r},{step:"Krok 11",title:"Storyboard i teksty",lead:"Plan i notatki trzymaj blisko wiedzy źródłowej.",passages:["Storyboard układa narrację i przebieg spotkania.","Teksty zbierają komentarze, wnioski i gotowe treści do publikacji."],focus:["Lepsze przygotowanie","Notatki w kontekście"],action:r},{step:"Krok 12",title:"Udostępniaj bezpiecznie",lead:"Dziel się materiałem bez utraty kontroli.",passages:["Możesz dać dostęp tylko do odczytu dla wybranych osób.","Edycja pozostaje po stronie autora lub zespołu prowadzącego."],focus:["Kontrola uprawnień","Bezpieczne współdzielenie"],action:r},{step:"Krok 13",title:"Nawiguj warstwowo",lead:"Sidebar i breadcrumb prowadzą przez poziomy.",passages:["Zawsze widzisz, czy pracujesz na bibliotece, kolekcji czy powtórce.","Mniej kliknięć „w ciemno”, więcej świadomej nawigacji."],focus:["Orientacja w systemie","Szybsze decyzje"],action:r},{step:"Krok 14",title:"Plan wdrożenia 30 minut",lead:"Najpierw prosty pilot, potem rozwijaj.",passages:["Plan: 1 biblioteka, 10 wpisów info, 1 kolekcja, 1 powtórka testowa.","Po pierwszej sesji popraw strukturę i dodaj kolejne scenariusze."],focus:["Szybki start","Iteracyjne doskonalenie"],action:"Gotowe? Załóż bibliotekę po prawej i przejdź do pierwszego wpisu."}]:v==="de"?[{step:"Schritt 1",title:"Was ist Cogita?",lead:"Ein zentraler Workspace für Lernen und Moderation nach dem Login.",passages:["Du verbindest Inhalte, Übungen und Teamarbeit in einem Ablauf.","Der Prozess bleibt klar: Bibliothek → Sammlung → Wiederholung."],focus:["Ein Workspace","Klarer Ablauf"],action:r},{step:"Schritt 2",title:"Mit Bibliothek starten",lead:"Die Bibliothek ist der Startpunkt für dein Thema.",passages:["Vergib einen klaren Namen für Kurs oder Modul.","Alle weiteren Bereiche greifen auf diese Basis zu."],focus:["Sauberer Start","Gemeinsame Basis"],action:r},{step:"Schritt 3",title:"Infos anlegen",lead:"Erfasse Wissen in kleinen, klaren Einträgen.",passages:["Info-Einträge enthalten Begriffe, Personen, Quellen und Zitate.","Kleinere Einheiten lassen sich besser verknüpfen und trainieren."],focus:["Kleine Einheiten","Leicht wartbar"],action:r},{step:"Schritt 4",title:"Typbasierte Eingabe",lead:"Formulare passen sich automatisch dem Info-Typ an.",passages:["Dadurch bleiben Daten strukturiert und konsistent.","Das verbessert Qualität und Auffindbarkeit."],focus:["Konsistenz","Bessere Suche"],action:r},{step:"Schritt 5",title:"Wissen verlinken",lead:"Verbinde Einträge zu einem Kontextnetz.",passages:["Thema, Quelle und Beispiel werden als Beziehung sichtbar.","So erkennst du Lücken vor der nächsten Lernphase."],focus:["Kontextnetz","Lücken erkennen"],action:r},{step:"Schritt 6",title:"Ziel-Sammlungen bauen",lead:"Eine Sammlung bündelt Inhalte für einen konkreten Zweck.",passages:["Nutze getrennte Sammlungen für Unterricht, Quiz oder Prüfung.","Du wählst Inhalte aus statt sie zu kopieren."],focus:["Zielorientierung","Keine Duplikate"],action:r},{step:"Schritt 7",title:"Wiederholungen erstellen",lead:"Wiederholungen definieren den Prüfungsablauf.",passages:["Tempo, Reihenfolge und Umfang sind pro Wiederholung steuerbar.","Mehrere Wiederholungen pro Sammlung sind möglich."],focus:["Ablaufsteuerung","Mehrere Niveaus"],action:r},{step:"Schritt 8",title:"Info und Karte",lead:"Datenobjekt und Trainingsansicht sind getrennt.",passages:["Info ist die Quelle der Inhalte.","Die Karte ist die Übungsansicht für Frage und Antwort."],focus:["Sauberes Modell","Wiederverwendbar"],action:r},{step:"Schritt 9",title:"Sitzung durchführen",lead:"Im Run-Modus führst du die Gruppe Schritt für Schritt.",passages:["Moderation steuert Übergänge und Timing.","Teilnehmende folgen einem klaren Ablauf."],focus:["Klare Moderation","Stabile Dynamik"],action:r},{step:"Schritt 10",title:"Abhängigkeitsgraph lesen",lead:"Der Graph zeigt Lernprioritäten.",passages:["Zentrale Knoten beeinflussen viele weitere Themen.","Starte mit Grundlagen und baue danach auf."],focus:["Priorisierung","Lernreihenfolge"],action:r},{step:"Schritt 11",title:"Storyboard & Texte",lead:"Plane Ablauf und sammle Notizen im selben Kontext.",passages:["Storyboards strukturieren Sequenzen und Rollen.","Texte halten Erkenntnisse und veröffentlichungsreife Inhalte fest."],focus:["Planung","Dokumentation"],action:r},{step:"Schritt 12",title:"Sicher teilen",lead:"Teile Inhalte ohne Kontrollverlust.",passages:["Leserechte sind separat von Bearbeitungsrechten steuerbar.","So bleibt der Kernbestand geschützt."],focus:["Rechtekontrolle","Sicheres Teilen"],action:r},{step:"Schritt 13",title:"Ebenen-Navigation",lead:"Sidebar und Breadcrumb zeigen deinen aktuellen Kontext.",passages:["Du siehst sofort, auf welcher Ebene du arbeitest.","Das spart Zeit und reduziert Fehlklicks."],focus:["Orientierung","Effizienz"],action:r},{step:"Schritt 14",title:"30-Minuten-Startplan",lead:"Starte klein und erweitere iterativ.",passages:["Plan: 1 Bibliothek, 10 Infos, 1 Sammlung, 1 Test-Wiederholung.","Nach der ersten Runde verbesserst du Struktur und Ablauf."],focus:["Schneller Einstieg","Iteratives Vorgehen"],action:"Jetzt starten: Bibliothek rechts anlegen und den ersten Eintrag erfassen."}]:[{step:"Step 1",title:"What is Cogita?",lead:"A post-login workspace to design, run, and improve knowledge journeys.",passages:["You can keep content, training flow, and collaboration in one place.","The path stays explicit: library → collection → revision → session."],focus:["Single workspace","Clear learning flow"],action:r},{step:"Step 2",title:"Start with a library",lead:"Your library is the root container for one domain or program.",passages:["Name it after your course, cohort, or topic scope.","Every next module reuses this foundation."],focus:["Root container","Consistent base"],action:r},{step:"Step 3",title:"Add information units",lead:"Build knowledge from small, reusable info entries.",passages:["Capture terms, references, people, concepts, and citations.","Smaller entries are easier to link, review, and update."],focus:["Reusable units","Easy maintenance"],action:r},{step:"Step 4",title:"Use type-based forms",lead:"Each info type has a matching data structure and fields.",passages:["Form layouts adapt automatically to the selected type.","This improves consistency and lowers input mistakes."],focus:["Structured input","Fewer errors"],action:r},{step:"Step 5",title:"Link the knowledge graph",lead:"Relationships turn isolated facts into usable context.",passages:["Connect topics, sources, and supporting examples.","Dependency links show what must be learned first."],focus:["Context building","Better sequencing"],action:r},{step:"Step 6",title:"Build goal collections",lead:"Collections package selected infos for a concrete objective.",passages:["Create separate collections for class, quiz, exam, or workshop.","You curate from existing entries instead of duplicating content."],focus:["Goal-oriented sets","No duplication"],action:r},{step:"Step 7",title:"Create revisions",lead:"Revisions define how practice and checking should run.",passages:["Set pacing, order, and scope for each session style.","One collection can host multiple revision strategies."],focus:["Practice design","Multiple modes"],action:r},{step:"Step 8",title:"Understand info vs card",lead:"Data objects and practice views are intentionally separate.",passages:["Info is the canonical source object.","Card is the generated training/checking view."],focus:["Clear model","Reusable content"],action:r},{step:"Step 9",title:"Run live sessions",lead:"Run mode helps facilitators guide each step with control.",passages:["Move through prompts, responses, and timing intentionally.","Participants get a predictable and focused session rhythm."],focus:["Facilitator control","Group clarity"],action:r},{step:"Step 10",title:"Read dependency graphs",lead:"Graph views expose prerequisites and high-impact nodes.",passages:["Central nodes usually deserve priority in onboarding.","Use this to plan revision order and reduce confusion."],focus:["Priority mapping","Smarter progression"],action:r},{step:"Step 11",title:"Use storyboards and texts",lead:"Plan narratives and keep notes near source knowledge.",passages:["Storyboards model session structure and transitions.","Texts capture outcomes, drafts, and reusable explanations."],focus:["Planning layer","Contextual notes"],action:r},{step:"Step 12",title:"Share safely",lead:"Share read access without losing editorial control.",passages:["Keep editing rights restricted to owners or maintainers.","Collaborators can consume material while core data stays protected."],focus:["Access control","Safe collaboration"],action:r},{step:"Step 13",title:"Navigate by layers",lead:"Sidebar and breadcrumb make system depth understandable.",passages:["You always know whether you are at library, collection, or revision level.","Clear location awareness reduces wrong actions."],focus:["Fast orientation","Lower friction"],action:r},{step:"Step 14",title:"30-minute launch plan",lead:"Start with a minimum viable setup, then iterate.",passages:["Plan: create 1 library, add 10 infos, build 1 collection, run 1 revision.","After the first run, refine structure and scale by scenario."],focus:["Immediate execution","Iterative improvement"],action:"Ready now? Create your first library on the right and start adding knowledge."}]},[v]),xt=Nt.length,Ct=Math.max(0,Math.min(Le,xt-1)),vt=Nt[Ct],Mt=!!K,aa=Qe&&k==="all_collections",At=Mt&&k==="all_collections",St=Qe&&(k==="all_revisions"||Mt&&k==="all_collections")&&(J==="settings"||J==="run"||J==="shared"||k==="all_revisions"),ma=St,It=St&&!!le,pt=a.useCallback(r=>{const D=!!r.libraryId;let he=r.target,H=r.collectionId,Xe=r.revisionId,ot=r.revisionView,bt=r.infoId,Tt=r.infoView??c.infoView??"overview",$t=r.collectionView??c.collectionView??"infos";D?Dn[he].requiresCollection&&!H?(he=he==="all_revisions"?"all_revisions":"all_collections",Xe=void 0,ot="detail"):he!=="all_collections"&&he!=="all_revisions"?(H=void 0,Xe=void 0,he!=="new_card"&&he!=="all_cards"&&(bt=void 0,Tt="overview"),he!=="new_collection"&&($t="infos")):Dn[he].allowsRevision?Wi.includes(ot)||(Xe=void 0):ot="detail":(he="library_overview",H=void 0,Xe=void 0,ot="detail",bt=void 0,Tt="overview",$t="infos"),O(r.libraryId),Y(he),L(H),ge(Xe),Oe(ot),U(!1);const yt=fa($s(r.libraryId,he,H,ot,Xe,bt,Tt,$t));fa(`${f.pathname}${f.search}`)!==yt&&(F.current=yt,l(yt))},[f.pathname,f.search,l,c.collectionView,c.infoView]),wt=a.useMemo(()=>[{key:"library",label:d.layers.library,visible:!0,value:y??"",selectedLabel:(V==null?void 0:V.name)??d.path.noLibrarySelected,disabled:ce||w.length===0,options:w.map(r=>({value:r.libraryId,label:r.name})),emptyOption:d.noLibraryOption,onSelect:r=>{const D=r||void 0;pt({libraryId:D,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:d.layers.target,visible:Qe,value:oe,selectedLabel:ht,disabled:!Qe,options:ar.map(r=>({value:r,label:nt[r]})),onSelect:r=>{const D=r;pt({libraryId:y,target:D,collectionId:K,revisionId:le,revisionView:je,infoId:D==="new_card"?c.infoId:void 0})}},{key:"info_mode",label:d.layers.target,visible:oe==="all_cards",value:Me,selectedLabel:Me==="create"?d.infoMode.create:Me==="selected"?(Ie==null?void 0:Ie.label)??ue??t.cogita.library.list.selectedEmpty:d.infoMode.search,disabled:!Qe,options:[{value:"search",label:d.infoMode.search},{value:"create",label:d.infoMode.create},...c.infoId?[{value:"selected",label:(Ie==null?void 0:Ie.label)??ue??t.cogita.library.list.selectedEmpty}]:[]],onSelect:r=>{if(r==="selected"){if(!c.infoId)return;pt({libraryId:y,target:"all_cards",collectionId:K,revisionId:le,revisionView:je,infoId:c.infoId,infoView:"overview"});return}if(r==="create"){pt({libraryId:y,target:"new_card",collectionId:K,revisionId:le,revisionView:je,infoId:void 0});return}pt({libraryId:y,target:"all_cards",collectionId:K,revisionId:le,revisionView:je,infoId:void 0,infoView:"overview"})}},{key:"info_selected_action",label:d.layers.target,visible:oe==="all_cards"&&!!c.infoId,value:k==="new_card"&&c.infoId?"edit":c.infoView==="cards"?"cards":c.infoView==="collections"?"collections":"overview",selectedLabel:k==="new_card"&&c.infoId?d.infoActions.edit:c.infoView==="cards"?d.infoActions.seeCards:c.infoView==="collections"?"Kolekcje":d.infoActions.overview,disabled:!Qe||!c.infoId,options:[{value:"overview",label:d.infoActions.overview},{value:"edit",label:d.infoActions.edit},{value:"cards",label:d.infoActions.seeCards},{value:"collections",label:"Kolekcje"}],onSelect:r=>{if(c.infoId){if(r==="edit"){pt({libraryId:y,target:"new_card",collectionId:K,revisionId:le,revisionView:je,infoId:c.infoId});return}if(r==="cards"){pt({libraryId:y,target:"all_cards",collectionId:K,revisionId:le,revisionView:je,infoId:c.infoId,infoView:"cards"});return}pt({libraryId:y,target:"all_cards",collectionId:K,revisionId:le,revisionView:je,infoId:c.infoId,infoView:"overview"})}}},{key:"collection_mode",label:d.layers.collection,visible:Qe&&(k==="all_collections"||k==="new_collection"),value:$e,selectedLabel:$e==="create"?t.cogita.library.actions.createCollection:$e==="selected"?(q==null?void 0:q.name)??d.path.noCollectionSelected:t.cogita.library.actions.collections,disabled:!Qe,options:[{value:"search",label:t.cogita.library.actions.collections},{value:"create",label:t.cogita.library.actions.createCollection},...K&&q?[{value:"selected",label:q.name}]:[]],onSelect:r=>{if(r==="create"){pt({libraryId:y,target:"new_collection",collectionId:void 0,revisionId:void 0,revisionView:"detail"});return}if(r==="selected"&&K){const D=W?k:"all_collections";pt({libraryId:y,target:D,collectionId:K,revisionId:le,revisionView:D==="all_revisions"?"settings":"detail"});return}if(r==="collections"){pt({libraryId:y,target:"all_cards",collectionId:K,revisionId:le,revisionView:je,infoId:c.infoId,infoView:"collections"});return}pt({libraryId:y,target:W?k:"all_collections",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"collection",label:d.layers.collection,visible:aa&&$e!=="create",value:K??"",selectedLabel:(q==null?void 0:q.name)??d.path.noCollectionSelected,disabled:!Qe||xe||C.length===0,options:C.map(r=>({value:r.collectionId,label:r.name})),emptyOption:d.selectCollectionOption,onSelect:r=>{const D=r||void 0,he=W?k:"all_collections";pt({libraryId:y,target:he,collectionId:D,revisionId:void 0,revisionView:he==="all_revisions"?"settings":"detail"})}},{key:"collection_selected_action",label:d.layers.revision,visible:At,value:k==="all_revisions"?"revisions":J==="graph"?"edit":J==="settings"||J==="run"||J==="shared"?"revisions":(c.collectionView??"infos")==="overview"?"overview":"infos",selectedLabel:k==="all_revisions"?d.targets.allRevisions:J==="graph"?"Edytuj":J==="settings"||J==="run"||J==="shared"?d.targets.allRevisions:(c.collectionView??"infos")==="overview"?"Przegląd":"Informacje",disabled:!K,options:[{value:"overview",label:"Przegląd"},{value:"edit",label:"Edytuj"},{value:"infos",label:"Informacje"},{value:"revisions",label:d.targets.allRevisions}],onSelect:r=>{if(K){if(r==="edit"){pt({libraryId:y,target:W?k:"all_collections",collectionId:K,revisionId:void 0,revisionView:"graph"});return}if(r==="revisions"){pt({libraryId:y,target:W?k:"all_collections",collectionId:K,revisionId:le,revisionView:"settings"});return}pt({libraryId:y,target:W?k:"all_collections",collectionId:K,revisionId:void 0,revisionView:"detail",infoId:c.infoId,infoView:c.infoView,collectionView:r==="overview"?"overview":"infos"})}}},{key:"revision_entry",label:d.layers.revision,visible:ma,value:le??"",selectedLabel:(ie==null?void 0:ie.name)??d.status.noRevisions,disabled:(k==="all_revisions"?!Qe:!Mt)||te||ae.length===0,options:ae.map(r=>({value:r.revisionId,label:r.name})),emptyOption:d.status.noRevisions,onSelect:r=>{pt({libraryId:y,target:W?k:"all_collections",collectionId:K,revisionId:r||void 0,revisionView:J==="settings"||J==="run"||J==="shared"?J:"settings"})}},{key:"revision_selected_action",label:d.layers.revision,visible:It,value:J==="run"?"run":J==="shared"?"shared":"settings",selectedLabel:J==="run"?d.revisions.run:J==="shared"?d.targets.sharedRevisions:d.revisions.settings,disabled:!K||!le,options:[{value:"settings",label:d.revisions.settings},{value:"run",label:d.revisions.run},{value:"shared",label:d.targets.sharedRevisions}],onSelect:r=>{!K||!le||pt({libraryId:y,target:W?k:"all_collections",collectionId:K,revisionId:le,revisionView:r==="run"?"run":r==="shared"?"shared":"settings"})}}],[C,xe,Me,b,w,ce,pt,ae,te,q,K,Ie,ie,le,ue,Mt,Qe,V,W,y,Ye,je,k,J,oe,ht,aa,At,ma,It,nt,t.cogita.library.list.selectedEmpty,c.infoId,c.infoView,c.collectionView,d.infoActions.edit,d.infoActions.overview,d.infoActions.seeCards,d.layers.collection,d.layers.library,d.layers.revision,d.layers.target,d.noLibraryOption,d.path.noCollectionSelected,d.path.noLibrarySelected,d.selectCollectionOption,d.targets.allRevisions,d.revisions.run,d.revisions.settings,d.targets.sharedRevisions,$e]),ft=a.useMemo(()=>wt.filter(r=>r.visible),[wt]),mt=a.useMemo(()=>ft.filter(r=>r.key!=="library"&&r.key!=="collection"),[ft]),Pt=a.useMemo(()=>mt.find(r=>r.key==="target")??null,[mt]),at=a.useMemo(()=>mt.find(r=>r.key==="info_mode")??null,[mt]),_e=a.useMemo(()=>mt.find(r=>r.key==="info_selected_action")??null,[mt]),ut=a.useMemo(()=>mt.find(r=>r.key==="collection_mode")??null,[mt]),Jt=a.useMemo(()=>mt.find(r=>r.key==="collection_selected_action")??null,[mt]),Kt=a.useMemo(()=>mt.find(r=>r.key==="revision_entry")??null,[mt]),Dt=a.useMemo(()=>mt.find(r=>r.key==="revision_selected_action")??null,[mt]),ee=a.useCallback((r,D)=>r?e.jsx("div",{className:"cogita-sidebar-actions",children:r.options.map(he=>e.jsx("button",{type:"button",className:`ghost ${String(r.value)===he.value?"active":""}`,onClick:()=>r.onSelect(he.value),disabled:r.disabled,children:he.label},`${D}:${r.key}:${he.value}`))}):null,[]),Xt=a.useMemo(()=>{const r=c.libraryId;if(!r||!f.pathname.startsWith("/cogita/library/"))return null;const D={copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,libraryId:r};if(c.target==="library_overview")return e.jsx(zr,{...D});if(c.target==="all_cards")return c.infoId&&c.infoView==="cards"?e.jsx(gi,{...D,infoId:c.infoId,selectedReviewerRoleId:qe||null}):e.jsx(Yr,{...D,mode:c.cardMode??"list"});if(c.target==="new_card")return e.jsx(oi,{...D,editInfoId:c.infoId});if(c.target==="dependencies")return e.jsx(ci,{...D});if(c.target==="transfer")return e.jsx(yi,{...D});if(c.target==="storyboards"||c.target==="new_storyboard")return e.jsx(xi,{...D});if(c.target==="texts"||c.target==="new_text")return e.jsx(vi,{...D});if(c.target==="all_collections"||c.target==="all_revisions"){if(c.target==="all_revisions"&&!c.collectionId)return c.revisionView==="run"?e.jsx(En,{...D,revisionId:c.revisionId}):e.jsx(Ls,{...D,revisionId:c.revisionId});if(!c.collectionId&&c.revisionView==="run")return e.jsx(En,{...D,revisionId:c.revisionId});if(c.collectionId){const he={...D,collectionId:c.collectionId};return c.revisionView==="graph"?e.jsx(Hi,{...he}):c.revisionView==="shared"?e.jsx(bi,{...D,collectionId:c.collectionId}):c.revisionView==="settings"?e.jsx(Ls,{...he,revisionId:c.revisionId}):c.revisionView==="run"?e.jsx(En,{...he,revisionId:c.revisionId}):e.jsx(ji,{...he})}return e.jsx(wi,{...D})}return c.target==="new_collection"?e.jsx(Ti,{...D,onCreated:he=>{pt({libraryId:r,target:k==="all_revisions"?"all_revisions":"all_collections",collectionId:he,revisionId:void 0,revisionView:"graph"})}}):null},[n,pt,t,v,f.pathname,l,S,u,j,i,o,c.cardMode,c.collectionId,c.infoId,c.libraryId,c.revisionId,c.revisionView,c.target,h,s,k,qe]);a.useEffect(()=>{let r=!1;return(async()=>{var he,H,Xe,ot,bt;G(!0);try{await kr();const[Tt,$t,yt]=await Promise.all([Es(),Fs(),Nr()]);if(r)return;p(Tt);const Ht=new Set(yt.nodes.filter(Rt=>Rt.nodeType==="role"&&Rt.canLink).map(Rt=>Rt.roleId??"")),Zt=Yi($t,Ht);if(E(Zt),Zt){const Rt=yt.nodes.find(jt=>jt.nodeType==="data"&&jt.roleId===Zt&&(jt.fieldType===Kn||jt.label===Kn));M((Rt==null?void 0:Rt.dataKeyId)??null),x.current=Xi(Rt==null?void 0:Rt.value)}const sa=(he=Tt.find(Rt=>Rt.libraryId===c.libraryId))==null?void 0:he.libraryId,Bt=sa?(Xe=(H=x.current.byLibrary)==null?void 0:H[sa])==null?void 0:Xe.lastTarget:void 0,ra=Gi(Bt)?Bt:"library_overview";O(sa),Y(c.target??ra),ge(c.revisionId??(sa?(bt=(ot=x.current.byLibrary)==null?void 0:ot[sa])==null?void 0:bt.lastRevisionId:void 0)),Oe(c.revisionView??"detail"),N.current=!0}catch{r||Pe(d.status.loadFailed)}finally{r||G(!1)}})(),()=>{r=!0}},[d.status.loadFailed]),a.useLayoutEffect(()=>{if(N.current){if(!c.libraryId){O(void 0),Y(c.target??"library_overview"),L(void 0),ge(void 0),Oe("detail");return}c.libraryId&&w.some(r=>r.libraryId===c.libraryId)&&O(c.libraryId),c.target&&Y(c.target),L(c.collectionId),ge(c.revisionId),c.revisionView&&Oe(c.revisionView)}},[w,c.collectionId,c.libraryId,c.revisionId,c.revisionView,c.target]),a.useEffect(()=>{if(!y){z([]),L(void 0),m([]),_([]),ge(void 0);return}let r=!1;return re(!0),za({libraryId:y,limit:200}).then(D=>{var Xe;if(r)return;const he=D.items;z(he);const H=(Xe=he.find(ot=>ot.collectionId===c.collectionId))==null?void 0:Xe.collectionId;L(H)}).catch(()=>{r||(z([]),L(void 0))}).finally(()=>{r||re(!1)}),()=>{r=!0}},[c.collectionId,y]),a.useEffect(()=>{if(!y||oe!=="all_cards"&&k!=="new_card"){m([]);return}let r=!1;return Jn({libraryId:y,limit:200}).then(D=>{r||m(D)}).catch(()=>{r||m([])}),()=>{r=!0}},[oe,y,k]),a.useEffect(()=>{if(!y||k!=="all_revisions"&&!K){_([]),k!=="all_revisions"&&ge(void 0);return}let r=!1;return Se(!0),qn({libraryId:y,collectionId:k==="all_revisions"?void 0:K}).then(D=>{var Xe,ot,bt,Tt;if(r)return;_(D);const he=(ot=(Xe=x.current.byLibrary)==null?void 0:Xe[y])==null?void 0:ot.lastRevisionId,H=((bt=D.find($t=>$t.revisionId===c.revisionId))==null?void 0:bt.revisionId)??((Tt=D.find($t=>$t.revisionId===he))==null?void 0:Tt.revisionId);ge(H)}).catch(()=>{r||(_([]),ge(void 0))}).finally(()=>{r||Se(!1)}),()=>{r=!0}},[c.revisionId,K,y,k]),a.useEffect(()=>{const r=c.infoId;if(!y||!r){$(void 0);return}let D=!1;return ua({libraryId:y,infoId:r}).then(he=>{if(D)return;const H=he.payload??{},Xe=H.definition&&typeof H.definition=="object"?H.definition:null,ot=typeof(Xe==null?void 0:Xe.title)=="string"?Xe.title:void 0,bt=typeof(Xe==null?void 0:Xe.question)=="string"?Xe.question:void 0,Tt=typeof H.label=="string"?H.label:void 0,$t=typeof H.name=="string"?H.name:void 0,yt=typeof H.title=="string"?H.title:void 0;$(ot??bt??Tt??$t??yt??he.infoId)}).catch(()=>{D||$(r)}),()=>{D=!0}},[c.infoId,y]),a.useEffect(()=>{if(!N.current||c.libraryId&&w.some(Xe=>Xe.libraryId===c.libraryId)&&c.libraryId!==y||c.target&&c.target!==k||c.revisionView&&c.revisionView!==je||c.revisionId&&c.revisionId!==le||Dn[k].requiresCollection&&!K&&(c.target==="all_collections"||c.target==="all_revisions")&&c.collectionId)return;const r=fa(`${f.pathname}${f.search}`);if(fa(f.pathname)==="/cogita"&&!c.libraryId&&!y){F.current=null;return}if(fa(f.pathname)==="/cogita/persons"){F.current=null;return}if(fa(f.pathname)===`/cogita/library/${y}/revision/run`&&c.revisionView==="run"&&!c.collectionId&&(k==="all_collections"||k==="all_revisions")&&je==="run"&&!K){F.current=null;return}const H=fa($s(y,k,K,je,le,c.infoId,c.infoView??"overview",c.collectionView??"infos"));if(r===H){F.current=null;return}F.current!==H&&(F.current=H,l(H,{replace:!0}))},[w,f.pathname,f.search,l,c.collectionId,c.infoId,c.infoView,c.collectionView,c.libraryId,c.revisionId,c.revisionView,c.target,K,y,le,je,k]),a.useEffect(()=>{if(typeof window>"u")return;const r=()=>{window.innerWidth>920&&U(!1)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),a.useEffect(()=>{if(!N.current||!B||!y||I.current)return;const r=x.current,D={...r.byLibrary??{}},he={...D[y]??{},lastCollectionId:K,lastRevisionId:le,lastRevisionView:je,lastTarget:k},H={version:1,lastLibraryId:y,byLibrary:{...D,[y]:he}},Xe=JSON.stringify(r),ot=JSON.stringify(H);if(Xe===ot)return;x.current=H,I.current=!0,(async()=>{try{if(R)await Sr(R,{plainValue:ot});else{const Tt=await Tr(B,{itemName:Kn,itemType:"data",plainValue:ot});M(Tt.dataItemId)}}catch{Pe(d.status.savePrefsFailed)}finally{I.current=!1}})()},[R,B,K,y,le,je,k,d.status.savePrefsFailed]);const na=async()=>{const r=it.trim();if(!r){Pe(t.cogita.user.libraryNameRequired);return}Pe(null);try{const D=await Ir({name:r});p(he=>[D,...he]),O(D.libraryId),Y("library_overview"),L(void 0),ke("")}catch{Pe(t.cogita.user.libraryCreateFailed)}},_t=async()=>{if(!y||!K){Pe(d.status.selectLibraryFirst);return}const r=We.trim();if(!r){Pe(d.revisionForm.nameLabel);return}Pe(null);try{const D=await Cr({libraryId:y,collectionId:K,name:r,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});_(he=>[D,...he]),ge(D.revisionId),Y(k==="all_revisions"?"all_revisions":"all_collections"),Oe("settings"),Be("")}catch{Pe(d.status.loadFailed)}};return e.jsx(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,headerExtra:e.jsxs("div",{className:"cogita-header-reviewer-actions",children:[e.jsxs("label",{className:"cogita-header-reviewer",children:[e.jsx("span",{children:"Person"}),e.jsxs("select",{value:qe,disabled:!y,onChange:r=>{const D=r.target.value;if(D==="__new_person__"){l("/cogita/persons");return}Ne(D)},children:[e.jsx("option",{value:"",children:y?"No person":"Select library first"}),et.map(r=>e.jsx("option",{value:r.roleId,children:r.label},r.roleId)),e.jsx("option",{value:"__new_person__",children:"+ Create new person"})]})]}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>l("/cogita/persons"),children:"Persons"})]}),children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${pe?"open":""}`,"aria-label":d.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(V==null?void 0:V.name)??d.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:V?d.sidebar.libraryActionsHint:d.status.selectLibraryFirst}),ee(Pt,"sidebar"),k==="all_revisions"&&Kt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:d.targets.allRevisions}),ee(Kt,"sidebar"),Dt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(ie==null?void 0:ie.name)??d.status.noRevisions}),ee(Dt,"sidebar")]}):null]}):null,at?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:d.sidebar.infoActionsHint}),ee(at,"sidebar"),_e?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(Ie==null?void 0:Ie.label)??ue??t.cogita.library.list.selectedEmpty}),e.jsx("p",{className:"cogita-sidebar-note",children:d.sidebar.selectedInfoActionsHint}),ee(_e,"sidebar")]}):null]}):null,ut?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:d.sidebar.collectionActionsHint}),ee(ut,"sidebar"),q&&Jt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:q.name}),ee(Jt,"sidebar"),k!=="all_revisions"&&Kt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:(ie==null?void 0:ie.name)??d.status.noRevisions}),ee(Kt,"sidebar"),Dt?e.jsxs("div",{className:"cogita-sidebar-actions-nested","data-level":"branch",children:[e.jsx("p",{className:"cogita-sidebar-note",children:d.layers.revision}),ee(Dt,"sidebar")]}):null]}):null]}):null]}):null]}),e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:d.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:i,children:d.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{j("cogita"),U(!1)},children:d.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:o,children:h?t.account.secureModeDisable:t.account.secureModeEnable})]})]})]}),pe?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":d.sidebar.closeMenu,onClick:()=>U(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":d.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>U(r=>!r),"aria-label":pe?d.sidebar.closeMenu:d.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),ft.map((r,D)=>e.jsxs("div",{className:"cogita-browser-segment",children:[D>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,r.options.length===0?e.jsx("span",{className:"cogita-browser-static","aria-label":r.label,children:r.selectedLabel}):e.jsxs("select",{"aria-label":r.label,value:r.value,onChange:he=>r.onSelect(he.target.value),disabled:r.disabled,children:[r.emptyOption?e.jsx("option",{value:"",children:r.emptyOption}):null,r.options.map(he=>e.jsx("option",{value:he.value,children:he.label},`${r.key}:${he.value}`))]})]},`menu:${r.key}`))]}),Xt?e.jsxs(e.Fragment,{children:[(k==="all_collections"||k==="all_revisions")&&je==="new"?e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:d.revisionForm.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.library.actions.collections}),e.jsxs("select",{value:K??"",onChange:r=>L(r.target.value||void 0),children:[e.jsx("option",{value:"",children:d.selectCollectionOption}),C.map(r=>e.jsx("option",{value:r.collectionId,children:r.name},r.collectionId))]})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:d.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:We,onChange:r=>Be(r.target.value),placeholder:d.revisionForm.namePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:_t,children:d.revisionForm.createAction}),Re?e.jsx("p",{className:"cogita-form-error",children:Re}):null]}):null,e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Os.Provider,{value:!0,children:Xt})})]}):null,Xt?null:e.jsxs(e.Fragment,{children:[me?e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(fi,{copy:t,onPersonCreated:r=>{ze(D=>D+1)}})}):null,!y&&!me?e.jsxs("section",{className:"cogita-browser-intro",children:[e.jsx("div",{className:"cogita-browser-intro-main",children:e.jsxs("article",{className:"cogita-browser-panel cogita-browser-tutorial",children:[e.jsxs("div",{className:"cogita-browser-tutorial-head",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-browser-tutorial-step",children:vt.step}),e.jsx("h2",{children:vt.title})]}),e.jsxs("p",{children:[Ct+1," / ",xt]})]}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-lead",children:vt.lead}),e.jsx("div",{className:"cogita-browser-tutorial-passages",children:vt.passages.map(r=>e.jsx("p",{children:r},r))}),e.jsx("div",{className:"cogita-browser-tutorial-focus",children:vt.focus.map(r=>e.jsx("span",{children:r},r))}),e.jsx("p",{className:"cogita-browser-note cogita-browser-tutorial-action",children:vt.action}),e.jsx("div",{className:"cogita-browser-tutorial-progress",role:"list","aria-label":"Tutorial progress",children:Nt.map((r,D)=>e.jsx("button",{type:"button",className:`ghost ${D===Ct?"active":""}`,onClick:()=>Ge(D),"aria-label":`${D+1}`,children:D+1},`tutorial:${r.title}:${D}`))}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost",disabled:Ct===0,onClick:()=>Ge(r=>Math.max(0,r-1)),children:"Previous"}),e.jsx("button",{type:"button",className:"cta",disabled:Ct===xt-1,onClick:()=>Ge(r=>Math.min(xt-1,r+1)),children:"Next"})]})]})}),e.jsxs("div",{className:"cogita-browser-intro-side",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.createLibraryTitle}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:t.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:it,onChange:r=>ke(r.target.value),placeholder:t.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:na,children:t.cogita.user.createLibraryAction}),Re?e.jsx("p",{className:"cogita-form-error",children:Re}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:t.cogita.user.availableLibraries}),w.length===0?e.jsx("p",{className:"cogita-browser-note",children:t.cogita.user.noLibraries}):null,w.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:w.map(r=>e.jsxs("button",{type:"button",className:"cogita-card-item",onClick:()=>{pt({libraryId:r.libraryId,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})},children:[e.jsx("div",{className:"cogita-card-type",children:t.cogita.user.libraryRoleLabel}),e.jsx("h3",{className:"cogita-card-title",children:r.name})]},r.libraryId))}):null]})]})]}):null]})]})]})})}const ro=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Zi},Symbol.toStringTag,{value:"Module"}));function eo({copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,shareId:l}){const[f,c]=a.useState(null),[d,w]=a.useState("loading"),[p,C]=a.useState(t.cogita.library.collections.defaultName),[z,b]=a.useState("Cogita Library"),[m,ae]=a.useState([]),[_,y]=a.useState([]),[O,k]=a.useState("idle"),[Y,K]=a.useState({current:0,total:0}),[L,le]=a.useState(0),[ge,je]=a.useState(""),[Oe,ue]=a.useState(null),[$,pe]=a.useState(null),[U,ce]=a.useState(null),[G,xe]=a.useState(null),[re,te]=a.useState([]),[Se,Re]=a.useState({}),[Pe,Le]=a.useState({}),[Ge,it]=a.useState(null),[ke,Ue]=a.useState(null),[gt,We]=a.useState(null),[Be,et]=a.useState(null),[rt,qe]=a.useState({}),Ne=a.useRef(0),[Te,ze]=a.useState(null),B=a.useRef(null),E=a.useRef(null),[R,M]=a.useState(null),[x,N]=a.useState(!1),[I,F]=a.useState(null),[V,q]=a.useState([]),[me,ie]=a.useState(null),se=a.useRef(null),oe=a.useRef(null),[J,W]=a.useState(null),[$e,Me]=a.useState(0),Ie=a.useRef(null),nt=a.useRef({}),[ht,Ye]=a.useState(!1),[Qe,Nt]=a.useState({}),xt=a.useRef(null),Ct=a.useRef(new Set),vt=a.useRef({}),[Mt,aa]=a.useState([]),[At,St]=a.useState(new Set),[ma,It]=a.useState(!1),pt=Ba(),wt=a.useMemo(()=>new URLSearchParams(pt.search),[pt.search]),ft=a.useMemo(()=>wt.get("key")??"",[wt]),mt=(f==null?void 0:f.mode)??"random",Pt=(f==null?void 0:f.check)??"exact",at=(f==null?void 0:f.limit)??20,_e=a.useMemo(()=>Zn((f==null?void 0:f.revisionType)??mt),[f,mt]),ut=a.useMemo(()=>{const A=f==null?void 0:f.revisionSettings,X=Qs(_e,wt);return bn(_e,A??X)},[f,wt,_e]),Jt=a.useMemo(()=>t.cogita.library.revision[_e.labelKey]??mt,[t,mt,_e]),Kt=a.useMemo(()=>Pt==="exact"?t.cogita.library.revision.checkValue:Pt,[t,Pt]),ee=d==="ready"?m[L]??null:null,Xt=(ee==null?void 0:ee.checkType)==="translation-match"&&Be,na=a.useRef(new Map),_t=a.useRef(new Map),r=a.useRef(new Map),D=a.useRef(new Map),he=a.useMemo(()=>ee?ee.cardType==="vocab"?t.cogita.library.revision.vocabLabel:ee.infoType?tt(t,ee.infoType):t.cogita.library.revision.infoLabel:"",[t,ee]),H=a.useMemo(()=>{var X;return _e.id!=="levels"?m.length:((X=Qe.pool)==null?void 0:X.length)??_e.getFetchLimit(at,ut)},[Qe,ut,_e,m.length,at]),Xe=_e.getProgressTotal?_e.getProgressTotal(m,Qe,at,ut):_e.id==="levels"?Math.min(at,H):m.length,ot=Xe?Math.min(L+1,Xe):0,bt=Math.max(1,Number(ut.tries??1)),Tt=ut.compare??"anchors",$t=Math.max(0,Math.min(100,Number(ut.minCorrectness??0))),yt=(ut.considerDependencies??"on")==="on",Ht=Math.max(0,Math.min(100,Number(ut.dependencyThreshold??85))),Zt=A=>{const X=A.slice();for(let be=X.length-1;be>0;be-=1){const Ke=Math.floor(Math.random()*(be+1));[X[be],X[Ke]]=[X[Ke],X[be]]}return X},sa=A=>ya(A,{treatSimilarCharsAsSame:!0})>=$t,Bt=async()=>{const A=await da(),X=new Map,be=new Map;A.forEach(ye=>{const Ae=`${ye.itemType}:${ye.itemId}`,Ce=Yt(ye.itemType,ye.itemId,ye.checkType,ye.direction);X.has(Ae)||X.set(Ae,[]),X.get(Ae).push(ye),be.has(Ce)||be.set(Ce,[]),be.get(Ce).push(ye)});const Ke=new Map,Fe=new Map;return X.forEach((ye,Ae)=>Ke.set(Ae,ca(ye).score)),be.forEach((ye,Ae)=>Fe.set(Ae,ca(ye).score)),{itemKnowness:Ke,cardKnowness:Fe}},ra=async A=>{const X=Qe,be=A.concat(X.active??[]).concat(X.pool??[]).filter((g,T,P)=>P.findIndex(ne=>ve(ne)===ve(g))===T);if(!yt){St(new Set(be.map(ve)));return}const{itemKnowness:Ke,cardKnowness:Fe}=await Bt(),ye=g=>{if(g.cardType!=="info"||g.infoType!=="citation"||g.checkType!=="quote-fragment")return!0;const T=Ut(g.direction);if(!(T!=null&&T.fragmentId))return!0;const P=g.description??"";if(!P.trim())return!0;const de=ka(P).nodes[T.fragmentId];if(!de||!de.leftId&&!de.rightId)return!0;const Z=[de.leftId,de.rightId].filter(we=>!!we);if(Z.length===0)return!0;const fe=Z.map(we=>{const De=Yt("info",g.cardId,"quote-fragment",we);return Fe.get(De)??0});return fe.reduce((we,De)=>we+De,0)/fe.length>=Ht},Ae=(f==null?void 0:f.collectionId)??null,Ce=Ae?Mt.filter(g=>kt(g.childItemType)==="collection"&&g.childItemId===Ae&&!kt(g.childCheckType)&&!kt(g.childDirection)):[],Ee=Ae&&be.length>0?be.reduce((g,T)=>g+(Fe.get(ve(T))??0),0)/be.length:0,Je=new Set;for(const g of be){if(g.cardType!=="info"){Je.add(ve(g));continue}if(!ye(g))continue;const T=Mt.filter(de=>tr(de,g)).concat(Ce);if(T.length===0){Je.add(ve(g));continue}let P=0;for(const de of T)if(kt(de.parentItemType)==="collection")P+=de.parentItemId===Ae?Ee:0;else if(kt(de.parentCheckType)||kt(de.parentDirection)){const Z=kt(de.parentCheckType),fe=kt(de.parentDirection),Q=Yt(de.parentItemType,de.parentItemId,Z,fe);P+=Fe.get(Q)??0}else{const Z=`${de.parentItemType}:${de.parentItemId}`;P+=Ke.get(Z)??0}P/T.length>=Ht&&Je.add(ve(g))}St(Je)},Rt=A=>{for(let X=A;X<m.length;X+=1){const be=m[X];if(be&&(!yt||be.cardType!=="info"||At.has(ve(be))))return X}return-1},jt=A=>!yt||A.cardType!=="info"||At.has(ve(A)),ea=A=>{if(_e.id!=="temporal"&&_e.id!=="levels")return null;const X=Qe,be=(X.active??[]).concat(X.pool??[]),Ke=new Set;for(const Fe of be){const ye=ve(Fe);if(!(Ke.has(ye)||A.has(ye))&&(Ke.add(ye),jt(Fe)))return Fe}return null},Gt=a.useMemo(()=>{if(_e.id!=="levels")return null;const A=Qe,X=A.pool??[],be=A.active??[],Ke=A.levelMap??{},Fe=Math.max(1,Number(ut.levels??1)),ye=Array.from({length:Fe},()=>0),Ae=new Set(be.map(g=>ve(g)));X.forEach(g=>{const T=Math.min(Fe,Math.max(1,Ke[ve(g)]??1));ye[T-1]+=1});const Ce=X.length||1,Ee=ye.map(g=>g/Ce*100),Je=ee?Ke[ve(ee)]??1:null;return{counts:ye,percentages:Ee,currentLevel:Je,levelsCount:Fe,activeCount:be.length,poolCount:X.length,activeSet:Ae}},[Qe,ut,_e,ee]),xa=a.useMemo(()=>{if(_e.id!=="temporal")return null;const A=Qe,X=A.pool??[],be=A.active??[],Ke=A.knownessMap??{},Fe=new Set(A.unknownSet??[]);let ye=0;X.forEach(Ee=>{(Ke[ve(Ee)]??0)>1&&(ye+=1)});const Ae=Fe.size,Ce=be.map(Ee=>({id:ve(Ee),value:Fe.has(ve(Ee))?0:Math.max(0,Math.min(1,Ke[ve(Ee)]??0))}));return{knownCount:ye,unknownCount:Ae,dots:Ce}},[Qe,_e]),Oa=a.useMemo(()=>{if(!yt)return 0;const A=Qe;return m.concat(A.active??[]).concat(A.pool??[]).filter((be,Ke,Fe)=>Fe.findIndex(ye=>ve(ye)===ve(be))===Ke).filter(be=>be.cardType==="info"&&!At.has(ve(be))).length},[yt,Qe,m,At]);a.useEffect(()=>{if(!yt||O!=="ready")return;const A=Qe,be=m.concat(A.active??[]).concat(A.pool??[]).filter((ye,Ae,Ce)=>Ce.findIndex(Ee=>ve(Ee)===ve(ye))===Ae).filter(ye=>ye.cardType!=="info"||At.has(ve(ye))).length,Ke=se.current;if(se.current=be,Ke===null||be<=Ke)return;const Fe=be-Ke;ie(`New card available (+${Fe})`),oe.current&&window.clearTimeout(oe.current),oe.current=window.setTimeout(()=>ie(null),2200)},[yt,O,Qe,m,At]),a.useEffect(()=>()=>{oe.current&&window.clearTimeout(oe.current)},[]);const Wt=(A,X)=>{const be=_e.applyOutcome({queue:m,meta:Qe},ee,at,ut,{correct:A,correctness:X,createdUtc:new Date().toISOString()});ae(be.queue),Nt(be.meta);const Ke=be.queue[L+1];Ke&&zt(Ke,L+1)};a.useEffect(()=>{if(!l){w("error");return}w("loading"),Mr({shareId:l,key:ft}).then(A=>{c(A),C(A.collectionName),b(A.libraryName),w("ready")}).catch(()=>{w("error")})},[l,ft]),a.useEffect(()=>{l&&Lr({shareId:l,key:ft,type:"language"}).then(A=>y(A)).catch(()=>y([]))},[l,ft]),a.useEffect(()=>{!l||d!=="ready"||$r({shareId:l,key:ft}).then(A=>aa(A.items??[])).catch(()=>aa([]))},[l,ft,d]),a.useEffect(()=>{if(!l||d!=="ready")return;let A=!0;return(async()=>{k("loading"),K({current:0,total:_e.id==="levels"?0:_e.getFetchLimit(at,ut)});try{const be=[];let Ke=null,Fe=null;do{const T=await Rr({shareId:l,key:ft,limit:300,cursor:Ke});if(be.push(...T.items),(_e.id==="levels"||_e.id==="temporal")&&T.total&&(Fe=T.total),K(P=>({current:be.length,total:P.total||T.total||_e.getFetchLimit(at,ut)})),Ke=T.nextCursor??null,Fe!==null&&be.length>=Fe||_e.id!=="levels"&&_e.id!=="temporal"&&be.length>=_e.getFetchLimit(at,ut))break}while(Ke);if(!A)return;const ye=Da(be);let Ae;if(_e.id==="levels"){const T=Math.max(1,Number(ut.levels??1));Ae={},ye.forEach(P=>{const ne=ve(P);Ae[ne]=Math.max(1,Math.min(T,1))})}let Ce=null,Ee=null,Je=null;if(_e.id==="temporal"){const T=await da(),P=new Set(ye.map(Z=>ve(Z))),ne=T.reduce((Z,fe)=>{const Q=Yt(fe.itemType,fe.itemId,fe.checkType,fe.direction);return P.has(Q)&&(Z[Q]||(Z[Q]=[]),Z[Q].push(fe)),Z},{});Ce={},Ee=new Set,Je={};const de=Date.now();ye.forEach(Z=>{const fe=ve(Z),Q=ne[fe]??[];if(Q.length===0){Ce[fe]=0,Ee.add(fe),Je[fe]=[];return}const we=Gn(Q);Je[fe]=we;const De=pn(we,de);Ce[fe]=De.knowness})}const g=_e.id==="levels"?Xn(ye,at,ut,Ae):_e.id==="temporal"?Yn(ye,at,ut,Ce??{},Ee??new Set,Je??{}):_e.prepare(ye,at,ut);ae(g.queue),Nt(g.meta),le(0),k("ready"),K(T=>({current:Math.min(T.current,T.total),total:T.total}))}catch{A&&k("error")}})(),()=>{A=!1}},[l,ft,at,_e,ut,d]),a.useEffect(()=>{ra(m)},[m,Mt,yt,Ht,f==null?void 0:f.collectionId]),a.useEffect(()=>{if(!ee||!yt){It(!1);return}if(ee.cardType!=="info"||At.has(ve(ee))){It(!1);return}const A=Rt(L+1);if(A>=0){It(!1),le(A);return}if(_e.id==="temporal"||_e.id==="levels"){const X=m.slice(0,L+1),be=m.slice(L+1).filter(jt),Ke=X.concat(be),Fe=new Set(Ke.map(ve)),ye=ea(Fe);if(ye){const Ce=ve(ye);Fe.has(Ce)||(Ke.push(ye),Fe.add(Ce),Nt(Ee=>{const Je=Ee,g=new Set(Je.queued??[]);return g.add(Ce),{...Je,queued:g}}))}const Ae=Ke.findIndex((Ce,Ee)=>Ee!==L&&jt(Ce));if(Ae>=0){ae(Ke),le(Ae),It(!1);return}}It(!0)},[ee,At,yt,L,m,Qe,_e.id]),a.useEffect(()=>{if(je(""),ue(null),W(null),Me(0),te([]),Re({}),Le({}),it(null),Ue(null),We(null),N(!1),Ye(!1),M(null),et(null),qe({}),!ee){pe(null),ce(null);return}ee.cardType==="info"&&ee.infoType==="computed"&&pe(t.cogita.library.revision.loadingComputed);let A=!0;return zt(ee,L).then(X=>{!A||!X||(pe(X.prompt),ce(X.expectedAnswer),te(X.computedExpected),Re(X.computedAnswers),it(X.answerTemplate),Ue(X.outputVariables),We(X.variableValues))}),()=>{A=!1}},[ee,l,t]),a.useEffect(()=>{if(!ee||ee.cardType!=="info"||ee.infoType!=="citation"){xt.current=null,Ct.current=new Set,xe(null);return}const A=ee.description??"",X=(ee.label??"").trim(),be=X.replace(/\s+/g," ").trim(),Ke=A.replace(/\s+/g," ").trim(),Fe=be&&be!==Ke?X:t.cogita.library.infoTypes.citation;if(!A){xe(null),ce(null);return}const ye=ka(A);xt.current=ye,pe(Fe);let Ae=!0;return da().then(Ce=>{if(!Ae)return;const Ee=new Map;Ce.forEach(ne=>{if(ne.itemType!=="info"||ne.checkType!=="quote-fragment"||!ne.direction)return;const de=Ut(ne.direction);if(!de)return;const Z=`${ne.itemId}:${de.fragmentId}`;Ee.has(Z)||Ee.set(Z,[]),Ee.get(Z).push(ne)});const Je={},g=new Set;Ee.forEach((ne,de)=>{const[Z,fe]=de.split(":",2);if(Z!==ee.cardId)return;const Q=ca(ne).score;Je[fe]=Q,Q>=Ht&&g.add(fe)}),Ct.current=g,vt.current=Je;const T=Ut(ee.direction);if(T!=null&&T.fragmentId&&ye.nodes[T.fragmentId]){ia(ye,T.fragmentId,Fe);return}const P=Ia(ye,g,Je,Ht,yt,ee.direction);ia(ye,(P==null?void 0:P.id)??null,Fe)}).catch(()=>{Ct.current=new Set,vt.current={};const Ce=Ut(ee.direction);if(Ce!=null&&Ce.fragmentId&&ye.nodes[Ce.fragmentId]){ia(ye,Ce.fragmentId,Fe);return}const Ee=Ia(ye,Ct.current,{},Ht,yt,ee.direction);ia(ye,(Ee==null?void 0:Ee.id)??null,Fe)}),()=>{Ae=!1}},[ee,t,yt,Ht]),a.useEffect(()=>{if(!ee||ee.cardType!=="vocab"||ee.checkType!=="translation-match"){et(null),qe({});return}const be=(Qe.pool??Qe.active??m).filter(Ce=>Ce.cardType==="vocab"&&Ce.checkType==="translation-match").filter((Ce,Ee,Je)=>Je.findIndex(g=>g.cardId===Ce.cardId)===Ee);be.some(Ce=>Ce.cardId===ee.cardId)||be.unshift(ee);const Fe=Zt(be).slice(0,6).map(Ce=>{const Ee=Ce.label.split("↔").map(T=>T.trim()).filter(Boolean);if(Ee.length<2)return null;const Je=`${Ce.cardId}:L`,g=`${Ce.cardId}:R`;return{cardId:Ce.cardId,leftId:Je,rightId:g,leftLabel:Ee[0],rightLabel:Ee[1]}}).filter(Boolean),ye=Fe.map(Ce=>Ce.leftId),Ae=Zt(Fe.map(Ce=>Ce.rightId));et({pairs:Fe,leftOrder:ye,rightOrder:Ae,selection:{},activeLeft:null,activeRight:null,locked:{}})},[ee,m,Qe]),a.useEffect(()=>()=>{B.current&&window.clearTimeout(B.current),E.current&&window.clearTimeout(E.current)},[]);const Na=a.useRef(null);a.useEffect(()=>{if(!ee)return;const A=ve(ee),X=typeof document<"u"?document.activeElement:null;if(Na.current===A&&X&&(X.tagName==="INPUT"||X.tagName==="TEXTAREA"))return;let be=0;const Ke=()=>{if(ee){if(ee.cardType==="info"&&ee.infoType==="computed"){if(re.length>0){const ye=cn(Ge,re,ke),Ae=ye?nt.current[ye]:null;if(Ae&&(Ae.focus(),document.activeElement===Ae)){Na.current=A;return}}if(Ie.current&&(Ie.current.focus(),document.activeElement===Ie.current)){Na.current=A;return}}else if(ee.cardType==="vocab"&&Ie.current&&(Ie.current.focus(),document.activeElement===Ie.current)){Na.current=A;return}be<6&&(be+=1,window.setTimeout(Ke,40))}},Fe=window.setTimeout(Ke,40);return()=>window.clearTimeout(Fe)},[ee,re,Ge,ke]),a.useEffect(()=>{if(!ht)return;const A=X=>{X.key==="Enter"&&(X.preventDefault(),Vt())};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[ht]);const Sa=A=>{q(A),F(ca(A))};a.useEffect(()=>{if(!ee){F(null),q([]);return}const A=ee.cardType==="info"?"info":"connection";if(ee.cardType==="info"&&ee.infoType==="citation"){da().then(X=>{const be=X.filter(Ke=>Ke.itemType==="info"&&Ke.itemId===ee.cardId&&Ke.checkType==="quote-fragment"&&on(Ke.direction,ee.direction));Sa(be)}).catch(()=>{F(null),q([])});return}rn(A,ee.cardId,ee.checkType,ee.direction).then(X=>Sa(X)).catch(()=>{F(null),q([])})},[ee]);const La=(A,X,be,Ke)=>{if(A==="info"&&be==="quote-fragment"){da().then(Fe=>{const ye=Fe.filter(Ae=>Ae.itemType==="info"&&Ae.itemId===X&&Ae.checkType==="quote-fragment"&&on(Ae.direction,Ke));Sa(ye)}).catch(()=>{F(null),q([])});return}rn(A,X,be,Ke).then(Fe=>Sa(Fe)).catch(()=>{F(null),q([])})},qa=(A,X,be)=>{var Ae;const Ke=((Ae=be.pairs.find(Ce=>Ce.leftId===A))==null?void 0:Ae.rightId)??null;if(!Ke)return be;const Fe=Ke===X;qe(Ce=>({...Ce,[A]:Fe?"correct":"incorrect"})),B.current&&window.clearTimeout(B.current),E.current&&window.clearTimeout(E.current),Ne.current+=1;const ye={kind:Fe?"correct":"incorrect",tick:Ne.current};if(ze(null),B.current=window.setTimeout(()=>ze(ye),0),E.current=window.setTimeout(()=>ze(null),420),Fe){const Ce={...be.locked,[A]:!0};return Object.keys(Ce).length>=be.pairs.length?(ue("correct"),Ye(!0)):ue("correct"),{...be,selection:{...be.selection,[A]:X},activeLeft:null,activeRight:null,locked:Ce}}return ue("incorrect"),{...be,activeLeft:null,activeRight:null}},$a=A=>{et(X=>!X||X.locked[A]?X:X.activeRight?qa(A,X.activeRight,X):{...X,activeLeft:X.activeLeft===A?null:A})},yn=A=>{et(X=>X&&(X.activeLeft?qa(X.activeLeft,A,X):{...X,activeRight:X.activeRight===A?null:A}))},Vt=()=>{var A;if(ee&&ee.cardType==="info"&&ee.infoType==="citation"&&xt.current&&G&&!((A=Ut(ee.direction))!=null&&A.fragmentId)){const X=Ia(xt.current,Ct.current,vt.current,Ht,yt,ee.direction,G.fragmentId);if(X){ue(null),je(""),N(!1),Le({}),Ye(!1),W(null),Me(0),ia(xt.current,X.id,G.title);return}}ue(null),je(""),N(!1),Le({}),Ye(!1),W(null),Me(0),le(X=>Math.min(X+1,m.length))},Ot=A=>{if(!ee)return;const X=A.expected??null,be=A.answer??"";let Ke=X??"",Fe=be;if(!X&&A.expectedMap&&A.answerMap){const T=Object.keys(A.expectedMap).sort((P,ne)=>P.localeCompare(ne));Ke=T.map(P=>{var ne;return((ne=A.expectedMap)==null?void 0:ne[P])??""}).join("|"),Fe=T.map(P=>{var ne;return((ne=A.answerMap)==null?void 0:ne[P])??""}).join("|")}const ye=Ke?Ma(Ke,Fe,Tt):new Uint8Array,Ae={revisionType:_e.id,evalType:A.evalType,direction:A.direction,prompt:$??"",expected:X,answer:be,expectedAnswers:A.expectedMap??null,answers:A.answerMap??null,correct:A.correct,maskBase64:ye.length?ba(ye):null,checkMode:Pt,compareMode:Tt,minCorrectness:$t},Ce=new TextEncoder().encode(JSON.stringify(Ae)),Ee=ee.cardType==="info"?"info":"connection",Je=A.overrideCheckType??ee.checkType??null,g=A.overrideDirection??ee.direction??null;sn({itemType:Ee,itemId:ee.cardId,checkType:Je,direction:g,revisionType:_e.id,evalType:A.evalType,correct:A.correct,maskBase64:ye.length?ba(ye):null,payloadBase64:ba(Ce)}).then(()=>{La(Ee,ee.cardId,Je,g),ra(m)}).catch(()=>{})},xn=(A,X)=>{const be=na.current.get(X);if(be)return Promise.resolve(be);const Ke=_t.current.get(X);if(Ke)return Ke;const Fe=Ar({shareCode:l,infoId:A,key:ft}).then(ye=>{var T,P;const Ae=ye.payload,Ce=((T=Ae.definition)==null?void 0:T.graph)??null,Ee="",Je=((P=Ae.definition)==null?void 0:P.answerTemplate)??"",g=Gs(Ce,Ee,Je);if(g){const de={sample:Ys(g),answerTemplate:Je||null};return na.current.set(X,de),de}return rs({shareId:l,infoId:A,key:ft}).then(ne=>{const de={sample:ne,answerTemplate:null};return na.current.set(X,de),de})}).catch(()=>rs({shareId:l,infoId:A,key:ft}).then(ye=>{const Ae={sample:ye,answerTemplate:null};return na.current.set(X,Ae),Ae}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{_t.current.delete(X)});return _t.current.set(X,Fe),Fe},zt=(A,X)=>{var Ce;const be=`${ve(A)}:${X}`,Ke=r.current.get(be);if(Ke)return Promise.resolve(Ke);const Fe=D.current.get(be);if(Fe)return Fe;const ye=Ee=>(r.current.set(be,Ee),Ee);let Ae;if(A.cardType==="vocab"){if(A.checkType==="translation-match")return Ae=Promise.resolve(ye({prompt:A.description||t.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),Ae;const Ee=A.label.split("↔").map(Je=>Je.trim()).filter(Boolean);if(Ee.length>=2){const g=(A.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",T=g?Ee[0]:Ee[1],P=g?Ee[1]:Ee[0];Ae=Promise.resolve(ye({prompt:T,expectedAnswer:P,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else Ae=Promise.resolve(ye({prompt:A.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if(A.cardType==="info"&&A.infoType==="word"){const Ee=(Ce=A.description)!=null&&Ce.startsWith("Language: ")?A.description.replace("Language: ",""):null;Ae=Promise.resolve(ye({prompt:A.label,expectedAnswer:Ee,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else A.cardType==="info"&&A.infoType==="computed"?Ae=xn(A.cardId,be).then(Ee=>{var ne,de;if(!Ee.sample)return ye({prompt:A.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const Je=Ee.sample,g=Je.expectedAnswers?Object.entries(Je.expectedAnswers).map(([Z,fe])=>({key:Z,expected:fe})):[],T=g.reduce((Z,fe)=>(Z[fe.key]="",Z),{}),P=Je.expectedAnswerIsSentence&&((ne=Je.expectedAnswer)==null?void 0:ne.trim())||null;return ye({prompt:Je.prompt,expectedAnswer:g.length>0?P:((de=Je.expectedAnswer)==null?void 0:de.trim())||null,computedExpected:g,computedAnswers:T,answerTemplate:Ee.answerTemplate,outputVariables:Je.outputVariables??null,variableValues:Je.variableValues??null})}).catch(()=>ye({prompt:A.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{D.current.delete(be)}):Ae=Promise.resolve(ye({prompt:A.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return D.current.set(be,Ae),Ae},ia=(A,X,be)=>{const Ke=Object.keys(A.nodes).length,Fe=Ct.current.size;if(!X){xe({title:be,before:A.text,after:"",fragmentId:null,total:Ke,completed:Fe}),ce(null),Ye(!0);return}const ye=A.nodes[X];if(!ye)return;const Ae=Hn(A.text,ye);xe({title:be,before:Ae.before,after:Ae.after,fragmentId:ye.id,total:Ke,completed:Fe}),ce(Ae.fragment),Ye(!1)},Ta=()=>{const A=xt.current;A&&xe(X=>X&&{...X,total:Object.keys(A.nodes).length,completed:Ct.current.size})},va=()=>{const A=m[L+1];A&&zt(A,L+1)},Ra=()=>{if(va(),ee&&ee.cardType==="vocab"&&ee.checkType==="translation-match"&&Be){if(Be.pairs.length===0){ue("incorrect"),Ye(!0);return}const ye=Be.pairs.reduce((P,ne)=>(P[ne.rightId]=ne.rightLabel,P),{});let Ae=0;const Ce={};Be.pairs.forEach(P=>{const de=Be.selection[P.leftId]===P.rightId;Ce[P.leftId]=de?"correct":"incorrect",de&&(Ae+=1)});const Ee=Be.pairs.length||1,Je=Ae/Ee,g=Ae===Be.pairs.length;qe(P=>({...P,...Ce})),g?(ue("correct"),Ye(!0),Me(0)):(ue("incorrect"),Ye(!1),Me(P=>{const ne=P+1;return ne>=bt&&(N(!0),Ye(!0),et(de=>{if(!de)return de;const Z=de.pairs.reduce((fe,Q)=>(fe[Q.leftId]=Q.rightId,fe),{});return{...de,selection:Z}})),ne})),Wt(g,Je);const T="connection";Promise.all(Be.pairs.map(P=>{const ne=Be.selection[P.leftId]??null,de=ne?ye[ne]:"",Z={left:P.leftLabel,expected:P.rightLabel,answer:de,checkType:"translation-match"},fe=new TextEncoder().encode(JSON.stringify(Z));return sn({itemType:T,itemId:P.cardId,checkType:"translation-match",direction:null,revisionType:_e.id,evalType:"translation-match",correct:ne===P.rightId,maskBase64:null,payloadBase64:ba(fe)})})).then(()=>{La(T,ee.cardId,ee.checkType,ee.direction),ra(m)}).catch(()=>{});return}if(re.length>0){const ye=re.reduce((Ce,Ee)=>{const Je=Se[Ee.key]??"";return Ce[Ee.key]=Ft(Je)===Ft(Ee.expected)?"correct":"incorrect",Ce},{});re.every(({key:Ce,expected:Ee})=>{const Je=Se[Ce]??"";return Pt==="exact"&&Ft(Je)===Ft(Ee)})?(ue("correct"),Le(ye),Ye(!0),Me(0),Wt(!0,1),Ot({correct:!0,direction:$?`${$} -> computed`:"computed",expectedMap:re.reduce((Ce,Ee)=>(Ce[Ee.key]=Ee.expected,Ce),{}),answerMap:Se,evalType:"computed"})):(ue("incorrect"),Le(ye),Ye(!1),Me(Ce=>{const Ee=Ce+1;return Ee>=bt&&ga&&(N(!0),Ye(!0)),Ee}),Wt(!1,0),window.setTimeout(()=>{var Ee;const Ce=cn(Ge,re,ke);Ce&&nt.current[Ce]&&((Ee=nt.current[Ce])==null||Ee.focus())},40),Ot({correct:!1,direction:$?`${$} -> computed`:"computed",expectedMap:re.reduce((Ce,Ee)=>(Ce[Ee.key]=Ee.expected,Ce),{}),answerMap:Se,evalType:"computed"}));return}if(ee&&ee.cardType==="info"&&ee.infoType==="citation"&&(G!=null&&G.fragmentId)){if(!U)return;const ye=Ut(ee.direction),Ae=(ye==null?void 0:ye.fragmentId)??G.fragmentId,Ce=an(U,ge,{thresholdPercent:90,treatSimilarCharsAsSame:!0,ignorePunctuationAndSpacing:!0}),Ee=Ce.mask,Je=Ce.isCorrect,g=Ce.percent;Je?(vt.current[G.fragmentId]=Math.max(vt.current[G.fragmentId]??0,g),(vt.current[G.fragmentId]??0)>=Ht&&Ct.current.add(G.fragmentId),Ta(),ue("correct"),Le({}),Ye(!0),W(Ee),Me(0),g<100&&bt<=1&&N(!0),Wt(!0,g/100),Ot({correct:!0,direction:`quote:${G.fragmentId}`,expected:U,answer:ge,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:Ae})):(ue("incorrect"),Le({}),Ye(!1),W(Ee),Me(T=>{const P=T+1;return P>=bt&&ga&&(N(!0),Ye(!0)),P}),Wt(!1,g/100),window.setTimeout(()=>{var T;return(T=Ie.current)==null?void 0:T.focus()},40),Ot({correct:!1,direction:`quote:${G.fragmentId}`,expected:U,answer:ge,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:Ae}));return}if(!U)return;const A=Ma(U,ge,Tt),X=Pt==="exact"&&Ft(ge)===Ft(U),be=sa(A),Ke=X||be,Fe=ya(A);Ke?(ue("correct"),Le({}),Ye(!0),W(A),Me(0),Fe<100&&bt<=1&&N(!0),Wt(!0,Fe/100),Ot({correct:!0,direction:$?`${$} -> ${U}`:null,expected:U,answer:ge,evalType:"text"})):(ue("incorrect"),Le({}),Ye(!1),W(A),Me(ye=>{const Ae=ye+1;return Ae>=bt&&ga&&(N(!0),Ye(!0)),Ae}),Wt(!1,Fe/100),window.setTimeout(()=>{var ye;return(ye=Ie.current)==null?void 0:ye.focus()},40),Ot({correct:!1,direction:$?`${$} -> ${U}`:null,expected:U,answer:ge,evalType:"text"}))},vn=A=>{if(va(),!U)return;const X=Ma(U,A,Tt),be=Ft(A)===Ft(U),Ke=sa(X),Fe=be||Ke,ye=ya(X);Fe?(ue("correct"),Le({}),Ye(!0),W(X),Me(0),ye<100&&bt<=1&&N(!0),Wt(!0,ye/100),Ot({correct:!0,direction:"word->language",expected:U,answer:A,evalType:"language-select"})):(ue("incorrect"),Le({}),Ye(!1),W(X),Me(Ae=>{const Ce=Ae+1;return Ce>=bt&&ga&&(N(!0),Ye(!0)),Ce}),Wt(!1,ye/100),Ot({correct:!1,direction:"word->language",expected:U,answer:A,evalType:"language-select"}))},wn=A=>{var be;if(A.key!=="Enter")return;if(A.preventDefault(),A.stopPropagation(),ht){Vt();return}const X=re.find(Ke=>!(Se[Ke.key]??"").trim());if(X){(be=nt.current[X.key])==null||be.focus();return}Ra()},Ca=()=>{va(),ue("correct"),Ye(!0),Me(0),Wt(!0,1),U&&Ot({correct:!0,direction:"manual",expected:U,answer:ge,evalType:"manual"})},ta=()=>{if(Wt(!1,0),ee&&ee.cardType==="info"&&ee.infoType==="citation"){ue(null),je(""),N(!1),Le({}),Ye(!1),W(null),Me(0),le(A=>Math.min(A+1,m.length));return}Vt()};a.useEffect(()=>{va()},[L,m]);const jn=t.cogita.library.revision.revealModeAfterIncorrect,ga=re.length>0||!!U;return e.jsxs(Et,{copy:t,authLabel:n,showProfileMenu:s,onProfileNavigate:i,onToggleSecureMode:o,onLogout:u,secureMode:h,onNavigate:j,language:v,onLanguageChange:S,children:[(d==="loading"||O==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:d==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${Y.total?Math.min(100,Math.max(0,Y.current/Y.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:Y.total?`${Math.min(Y.current,Y.total)} / ${Y.total}`:t.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:p}),e.jsx("p",{className:"cogita-library-subtitle",children:z}),e.jsx("p",{className:"cogita-library-subtitle",children:t.cogita.library.revision.modeSummary.replace("{mode}",Jt).replace("{check}",Kt)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:I?`${I.score.toFixed(1)} / 100`:t.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Gt?e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.levelsCurrentLabel})," ",Gt.currentLevel??"-"," / ",Gt.levelsCount]}):null,I?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:t.cogita.library.revision.knownessStats.replace("{correct}",String(I.correct)).replace("{total}",String(I.total))}),I.lastReviewedUtc&&e.jsx("p",{children:t.cogita.library.revision.knownessLast.replace("{date}",new Date(I.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:t.cogita.library.revision.knownessHint}),e.jsx(Xs,{outcomes:V})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[me?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:me})}):null,e.jsx(Wn,{feedbackToken:Te?`${Te.kind}-${Te.tick}`:Xt?"idle":Oe??"idle",children:d!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:d==="loading"?t.cogita.library.revision.shareLoading:t.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]}):ee?e.jsx(e.Fragment,{children:ma?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:t.cogita.library.revision.dependenciesBlocked})}):e.jsx(Qn,{copy:t,currentCard:ee,currentTypeLabel:he,prompt:$,languages:_,answer:ge,onAnswerChange:A=>je(X=>ln(X,A,R)),computedExpected:re,computedAnswers:Se,onComputedAnswerChange:(A,X)=>Re(be=>({...be,[A]:ln(be[A]??"",X,R)})),answerTemplate:Ge,outputVariables:ke,variableValues:gt,computedFieldFeedback:Pe,feedback:Oe,canAdvance:ht,quoteContext:G,quotePlaceholder:t.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ra,onSkip:ta,onLanguageSelect:vn,onMarkReviewed:Ca,onAdvance:Vt,showCorrectAnswer:x,setShowCorrectAnswer:N,onRevealCorrect:()=>Ye(!0),answerMask:J,expectedAnswer:U,hasExpectedAnswer:ga,handleComputedKeyDown:wn,answerInputRef:Ie,computedInputRefs:nt,scriptMode:R,setScriptMode:M,matchPairs:Be==null?void 0:Be.pairs,matchLeftOrder:Be==null?void 0:Be.leftOrder,matchRightOrder:Be==null?void 0:Be.rightOrder,matchSelection:Be==null?void 0:Be.selection,matchActiveLeft:Be==null?void 0:Be.activeLeft,matchActiveRight:Be==null?void 0:Be.activeRight,matchFeedback:rt,onMatchLeftSelect:$a,onMatchRightSelect:yn})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:t.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:t.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:Xe?`${ot} / ${Xe}`:t.cogita.library.revision.progressUnlimited}),d==="error"&&e.jsx("p",{children:t.cogita.library.revision.shareInvalid}),d==="loading"&&e.jsx("p",{children:t.cogita.library.revision.shareLoading}),d==="ready"&&O==="loading"&&e.jsx("p",{children:t.cogita.library.revision.loading}),d==="ready"&&O==="error"&&e.jsx("p",{children:t.cogita.library.revision.error}),d==="ready"&&O==="ready"&&m.length===0&&e.jsx("p",{children:t.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:jn}),e.jsxs("p",{children:[e.jsx("strong",{children:t.cogita.library.revision.triesLabel})," ",bt]})]})]}),Gt?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:t.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[t.cogita.library.revision.levelsStackLabel," ",Gt.activeCount," / ",Gt.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Gt.counts.map((A,X)=>{const be=X+1,Ke=Gt.currentLevel===be,Fe=Gt.percentages[X]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":Ke,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:be}),e.jsx("strong",{children:A})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,Fe))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[Fe.toFixed(1),"%"]})]},`level-${be}`)})})]}):null,xa?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:xa.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:xa.dots.map(A=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-A.value))}, ${Math.round(200*A.value)}, 80, 0.9)`}},A.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:t.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:xa.knownCount})]})]}):null,yt?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Oa})]})}):null]})]})]})})})]})]})}const io=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:eo},Symbol.toStringTag,{value:"Module"}));export{so as C,ro as a,io as b};
