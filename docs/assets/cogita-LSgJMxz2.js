import{r as i,j as e,R as Ut,B as Wt,C as zt,H as Lr,P as Cr,a as jt,b as oi,c as si,u as xr,d as yr,e as vr,f as ci}from"./vendor-DrCXrCXJ.js";import{L as Kr,A as Or,g as qr,a as di,c as ui,e as gi,i as hi,b as bi,s as Vr,d as Xa,f as Mr,h as br,j as Rt,k as mr,l as mi,m as ir,n as ut,u as pi,o as oa,p as fi,q as xi,r as yi,t as _r,v as Ur,w as $t,x as Wr,y as zr,z as Ht,B as Et,C as vi,D as ji,E as ki,F as wi,G as Ti,H as Ni,I as Li,J as _a,K as Ci,M as Mi,N as Si,O as Ii,P as Pi,Q as Ri,R as $i,S as Ei,T as Fi,U as Ai,V as Bi,W as Di,X as Ki,Y as Oi,Z as qi,_ as Sr}from"./recreatio-core-D7NEYQA9.js";import"./vendor-cogita-ui-DLgJCpO3.js";const vt={width:420,height:320,paddingX:28,paddingY:18,levels:[1,4,6,6,5,4,4]},yt={moveMs:900,pauseMs:220,errorMs:900},Vi=(a=11)=>{let n=a;const s=()=>(n=(n*1664525+1013904223)%4294967296,n/4294967296),{width:g,height:h,paddingX:v,paddingY:x,levels:A}=vt,O=(h-x*2)/(A.length-1),q=[],l=[],I=[];A.forEach((b,p)=>{const ne=h-x-p*O,F=g-v*2,k=[];for(let Q=0;Q<b;Q+=1){const R=v+(Q+1)*F/(b+1),oe=(s()-.5)*18,B=Math.max(v,Math.min(g-v,R+oe)),D=p===0?3:p<2?2.1:1.4,pe=p===0?"root":`l${p}-${Q}`;k.push({id:pe,x:p===0?g/2:B,y:ne,r:D,level:p,role:p===0?"root":void 0})}I.push(k),q.push(...k)});const m=I[I.length-1];if(m!=null&&m.length){const b=m[Math.floor(m.length/2)];b.role="goal",b.r=2}for(let b=1;b<I.length;b+=1){const p=I[b-1];I[b].forEach(F=>{const k=[...p].sort((B,D)=>Math.abs(B.x-F.x)-Math.abs(D.x-F.x)),Q=k[0],R=k[1]&&s()<.45?k[1]:null;(R?[Q,R]:[Q]).forEach(B=>{l.push({from:B.id,to:F.id,key:`${B.id}-${F.id}`})}),s()<.2&&k[2]&&l.push({from:k[2].id,to:F.id,key:`${k[2].id}-${F.id}`})})}const j=new Map;l.forEach(b=>{const p=j.get(b.to)??[];p.push(b.from),j.set(b.to,p)});const U=new Map,G=new Map,W=new Map;l.forEach(b=>{const p=U.get(b.from)??[];p.push(b.key),U.set(b.from,p);const ne=G.get(b.from)??[];ne.push(b.to),G.set(b.from,ne);const F=W.get(b.from)??[];F.push(b.to),W.set(b.from,F);const k=W.get(b.to)??[];k.push(b.from),W.set(b.to,k)});const d=new Map;return q.forEach(b=>{d.set(b.id,b)}),{nodes:q,links:l,parentsById:j,linksByFrom:U,childrenByFrom:G,neighborsById:W,nodesById:d}};function _i({slides:a,activeIndex:n,introOpen:s,prefersReducedMotion:g,onNext:h,onPrev:v,onSelect:x,onExit:A,onOpen:O,onRegister:q}){const l=n===a.length-1,I=s&&n===0?"entry":"docked",m=a[a.length-1],[j,U]=i.useState(!1),G=i.useMemo(()=>Array.from({length:20},(y,N)=>({src:`/cogita/logo/Cogita${String(N).padStart(2,"0")}.png`,kind:N<=11?"bubble":N<=17?"text":"recreatio"})),[]),W=s&&n===0;i.useEffect(()=>{if(!s){U(!1);return}n>0&&!j&&U(!0)},[n,s,j]);const d=i.useRef(0),b=i.useRef(null),p=i.useMemo(()=>{const y={x:40,y:160},N={x:260,y:48},Y=6,t=N.x-y.x,r=y.y-N.y,u=t/Y,T=[.3,.45,.6,.65,1.4,2.2],K=T.reduce((se,ve)=>se+ve,0),re=T.map(se=>r*se/K),le=[y];let ee=y.x,de=y.y;for(let se=1;se<=Y;se+=1){const ve=(Math.random()-.5)*14,Xe=(Math.random()-.5)*28;ee=Math.max(y.x+se*14,Math.min(N.x-(Y-se)*14,ee+u+ve));const Qe=re[se-1]??re[re.length-1];de=de-Qe+Xe;const Ze=Math.max(N.y,Math.min(y.y-4,de));le.push({x:Math.round(ee),y:Math.round(Ze)})}return le[le.length-1]=N,le},[]),ne=i.useMemo(()=>{const r=(K,re,le)=>Math.min(le,Math.max(re,K)),u=p.map(K=>{const re=10+Math.random()*36;return{x:r(K.x,40,260),y:r(K.y-re,40,140)}}),T=p.map((K,re)=>{var de;const le=12+Math.random()*40,ee=((de=u[re])==null?void 0:de.y)??K.y;return{x:r(K.x,40,260),y:r(Math.max(ee+10,K.y+le),60,170)}});return{upper:u,lower:T}},[p]),F=i.useMemo(()=>{var N;const y=((N=p[4])==null?void 0:N.x)??260;return Math.max(0,Math.min(240,y-40))},[p]),k=i.useMemo(()=>{var re,le;const y=(ee,de,se)=>Math.min(se,Math.max(de,ee)),N=(ee,de,se)=>p.map((ve,Xe)=>{var ia,ze;const Qe=((ia=ne.upper[Xe])==null?void 0:ia.y)??ve.y,Ze=((ze=ne.lower[Xe])==null?void 0:ze.y)??ve.y,P=(Math.random()-.5)*70,Le=ve.y+ee+P,we=y(ve.y+de,Qe+6,Ze-6),_e=y(ve.y+se,Qe+6,Ze-6);return{x:ve.x,y:y(Le,Math.min(we,_e),Math.max(we,_e))}}),Y=-14+Math.random()*28,t=14+Math.random()*28,r=N(Y,-80,12),u=N(t,-12,80);for(let ee=4;ee<p.length;ee+=1){const de=p[ee],se=((re=ne.upper[ee])==null?void 0:re.y)??de.y,ve=((le=ne.lower[ee])==null?void 0:le.y)??de.y;r[ee]={x:de.x,y:y(de.y-12,se+6,ve-6)},u[ee]={x:de.x,y:y(de.y+12,se+6,ve-6)}}const T=ne.upper.length?ne.upper[ne.upper.length-1].y:40,K=ne.lower.length?ne.lower[ne.lower.length-1].y:170;return r[r.length-1]={x:p[p.length-1].x,y:y(p[p.length-1].y-14,T,K)},u[u.length-1]={x:p[p.length-1].x,y:y(p[p.length-1].y+12,T,K)},{higher:r,lower:u}},[p,ne]),Q=1e4,R=i.useMemo(()=>{let y=17;const N=()=>(y=(y*1664525+1013904223)%4294967296,y/4294967296);return[{x:-180,y:-70},{x:-60,y:-70},{x:60,y:-70},{x:180,y:-70},{x:-120,y:60},{x:0,y:60},{x:120,y:60}].map((t,r)=>{const u=(N()-.5)*240,T=(N()-.5)*180,K=(N()-.5)*24;return{id:`card-${r+1}`,throw:{x:`${u.toFixed(0)}px`,y:`${T.toFixed(0)}px`,rot:`${K.toFixed(1)}deg`},grid:{x:`${t.x}px`,y:`${t.y}px`},delay:`${r*.12}s`}})},[]),oe=i.useMemo(()=>[{x:"-80px",y:"-120px"},{x:"-80px",y:"-15px"},{x:"-80px",y:"90px"},{x:"-80px",y:"195px"}],[]),[B,D]=i.useState([]),pe=i.useMemo(()=>[{id:"round-1",x:"14%",y:"calc(80% + var(--round-card-drop))"},{id:"round-2",x:"30%",y:"calc(80% + var(--round-card-drop))"},{id:"round-3",x:"46%",y:"calc(80% + var(--round-card-drop))"},{id:"round-4",x:"62%",y:"calc(80% + var(--round-card-drop))"},{id:"round-5",x:"78%",y:"calc(80% + var(--round-card-drop))"}],[]),ke=i.useMemo(()=>{const N=[],t=(u,T)=>u+Math.random()*(T-u);for(let u=0;u<6;u+=1){let T=!1;for(let K=0;K<80;K+=1){const re=t(14,86),le=t(10,34);if(N.every(de=>{const se=de.x-re,ve=de.y-le;return Math.hypot(se,ve)>=12})){N.push({x:re,y:le}),T=!0;break}}T||N.push({x:t(16,84),y:t(12,32)})}return N.map((u,T)=>({id:`p${T+1}`,x:`${u.x.toFixed(1)}%`,y:`${u.y.toFixed(1)}%`,xNum:u.x,yNum:u.y,jitterX:`${(Math.random()-.5)*12}px`,jitterY:`${(Math.random()-.5)*10}px`,delay:`${(Math.random()*1.2).toFixed(2)}s`}))},[]),[ce,V]=i.useState(0),[he,o]=i.useState(0),[X,w]=i.useState([]),M=1e4,ye=i.useMemo(()=>{if(ke.length<2)return[];const y=T=>{let K=T+1831565813;return K=Math.imul(K^K>>>15,K|1),K^=K+Math.imul(K^K>>>7,K|61),((K^K>>>14)>>>0)/4294967296},N=(T,K)=>Math.floor(y(T)*K),Y=new Set,t=[],r=Math.min(3,ke.length);let u=0;for(;t.length<r&&u<30;){u+=1;const T=N(ce*13+u*5,ke.length),K=N(ce*29+u*7,ke.length);if(T===K)continue;const re=T<K?`${T}-${K}`:`${K}-${T}`;Y.has(re)||(Y.add(re),t.push({id:`link-${re}`,from:ke[T],to:ke[K],delay:`${(u*.35).toFixed(2)}s`}))}return t},[ce,ke]);i.useEffect(()=>{if(!s||n!==2)return;const y=()=>{const Y=R.map(t=>t.id);for(let t=Y.length-1;t>0;t-=1){const r=Math.floor(Math.random()*(t+1));[Y[t],Y[r]]=[Y[r],Y[t]]}return Y.slice(0,4)};D(y());const N=window.setInterval(()=>{D(y())},Q);return()=>window.clearInterval(N)},[n,s,R,Q]),i.useEffect(()=>{if(!s||n!==3)return;const y=()=>{o(Math.floor(Math.random()*pe.length)),w(ke.map(()=>Math.random()<.6?"good":"bad")),V(Y=>Y+1)};y();const N=window.setInterval(y,M);return()=>window.clearInterval(N)},[n,s,pe.length,ke,M]);const ie=i.useMemo(()=>Vi(11),[]),[ae,Ne]=i.useState(new Set(["root"])),[Ee,Me]=i.useState(new Set),[Ae,Se]=i.useState(new Set),[Je,Ke]=i.useState({fromId:"root",toId:"root",key:0}),Fe=i.useRef(ae),Ue=i.useRef("root"),ra=i.useRef(0),Ie=i.useRef(null),_=i.useRef(null),te=i.useRef([]);i.useEffect(()=>{Fe.current=ae},[ae]);const Be=i.useMemo(()=>{const y=new Set;return ae.forEach(N=>{const Y=ie.linksByFrom.get(N);Y&&Y.forEach(t=>y.add(t))}),y},[ae,ie]),Ce=ie.nodesById.get(Je.toId)??ie.nodesById.get("root"),be=Ce?`${Ce.x/vt.width*100}%`:"50%",$e=Ce?`${Ce.y/vt.height*100}%`:"90%";i.useEffect(()=>{if(!s||n!==1||g)return;(()=>{Ne(new Set(["root"])),Me(new Set),Se(new Set),Ke({fromId:"root",toId:"root",key:0}),_.current=null,ra.current=0,Ue.current="root",te.current=[]})();const N=()=>{const t=Ue.current,r=Fe.current,T=(ie.childrenByFrom.get(t)??[]).filter(ve=>!r.has(ve));if(T.length)return T[Math.floor(Math.random()*T.length)];if(r.size>=ie.nodes.length){const ve=ie.neighborsById.get(t)??[];return ve.length?ve[Math.floor(Math.random()*ve.length)]:null}const K=ve=>(ie.childrenByFrom.get(ve)??[]).some(Qe=>!r.has(Qe)),re=[t],le=new Set([t]),ee=new Map;let de=null;for(;re.length;){const ve=re.shift();if(!ve)break;if(ve!==t&&K(ve)){de=ve;break}(ie.neighborsById.get(ve)??[]).forEach(Qe=>{le.has(Qe)||(le.add(Qe),ee.set(Qe,ve),re.push(Qe))})}if(!de)return null;let se=de;for(;ee.get(se)&&ee.get(se)!==t;)se=ee.get(se)??se;return se},Y=(t,r)=>{if(t===r){const u=N();u&&Y(t,u);return}ra.current+=1,Ke({fromId:t,toId:r,key:ra.current}),Ue.current=r,Ie.current=window.setTimeout(()=>{const u=ie.parentsById.get(r)??[],T=Fe.current,K=u.filter(de=>!T.has(de));if(!K.length){const de=new Set(T);de.add(r),Ne(de),Ie.current=window.setTimeout(()=>{for(;te.current.length;){const ve=te.current[te.current.length-1];if(!de.has(ve)){if(ve!==r){Y(r,ve);return}break}te.current.pop()}const se=N();se&&Y(r,se)},yt.pauseMs);return}const re=new Set([r,...K]),le=new Set(K.map(de=>`${de}-${r}`));Me(re),Se(le),te.current.includes(r)||te.current.push(r);const ee=K[Math.floor(Math.random()*K.length)];_.current={fromId:r,toId:ee},Ie.current=window.setTimeout(()=>{Me(new Set),Se(new Set);const de=_.current;de&&Y(de.fromId,de.toId)},yt.errorMs)},yt.moveMs)};return Ie.current=window.setTimeout(()=>{const t=N();t&&Y(Ue.current,t)},yt.pauseMs),()=>{Ie.current&&window.clearTimeout(Ie.current)}},[n,s,ie,g]);const De=y=>{if(!s)return;const N=Date.now();N-d.current<520||Math.abs(y.deltaY)<10||(d.current=N,y.deltaY>0?h():v(),y.preventDefault())},qe=y=>{if(!s)return;const N=y.touches[0];N&&(b.current={x:N.clientX,y:N.clientY})},Ve=y=>{if(!s)return;const N=b.current;if(b.current=null,!N)return;const Y=y.changedTouches[0];if(!Y)return;const t=Y.clientX-N.x,r=Y.clientY-N.y;Math.abs(r)<40||Math.abs(r)<Math.abs(t)||(r<0?h():v())};return e.jsxs("div",{className:`cogita-intro ${s?"is-open":"is-closed"} ${g?"is-reduced":""} ${l?"is-final":""}`,"data-slide":n+1,onWheel:De,onTouchStart:qe,onTouchEnd:Ve,children:[e.jsxs("div",{className:"cogita-intro-stage",children:[e.jsx("div",{className:"cogita-intro-logo","data-state":I,"aria-hidden":"true",children:e.jsx("div",{className:`cogita-logo-layers ${W&&!j?"is-entry":""}`,children:G.map((y,N)=>e.jsx("img",{src:y.src,alt:"",className:`cogita-logo-layer ${N===0?"is-base":""} ${y.kind==="text"?"is-text":y.kind==="recreatio"?"is-recreatio":""} ${y.kind==="bubble"?"is-bubble":""}`},y.src))})}),s&&a.map((y,N)=>{const Y=N===n;return e.jsxs("section",{className:`cogita-intro-slide slide-${N+1} ${Y?"is-active":""}`,"aria-hidden":!Y,children:[e.jsxs("div",{className:"cogita-intro-text",children:[y.subtitle?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h1",{children:y.title}),e.jsx("p",{className:"cogita-intro-subtitle",children:y.subtitle})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:y.title}),y.body&&e.jsx("p",{children:y.body.split(`
`).map((t,r)=>e.jsxs("span",{children:[t,r===0&&e.jsx("br",{})]},String(r)))})]}),y.micro&&e.jsx("p",{className:"cogita-intro-micro",children:y.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:l?q:h,children:y.cta}),l&&y.secondary&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>x(0),children:y.secondary})]})]}),e.jsxs("div",{className:"cogita-intro-visual","aria-hidden":"true",children:[N===1&&e.jsxs("div",{className:"cogita-learning-map",children:[e.jsxs("svg",{className:"learning-map-svg",viewBox:`0 0 ${vt.width} ${vt.height}`,preserveAspectRatio:"none",children:[ie.links.map(t=>{const r=ie.nodesById.get(t.from),u=ie.nodesById.get(t.to);if(!r||!u)return null;const T=Be.has(t.key),K=Ae.has(t.key);return e.jsx("line",{className:`map-link ${T?"is-active":""} ${K?"is-error":""}`,x1:r.x,y1:r.y,x2:u.x,y2:u.y},t.key)}),ie.nodes.map(t=>{const r=ae.has(t.id),u=Ee.has(t.id);return e.jsx("circle",{className:`map-node ${t.role?`is-${t.role}`:""} ${r?"is-active":""} ${u?"is-error":""}`,cx:t.x,cy:t.y,r:t.r},t.id)})]}),Ce&&e.jsx("span",{className:"map-explorer-dot",style:{left:be,top:$e,"--move":`${yt.moveMs}ms`}})]}),N===2&&e.jsx("div",{className:"cogita-index-cards",children:R.map(t=>{const r=B.indexOf(t.id),u=r>=0?oe[r]:null,T=(u==null?void 0:u.x)??"140px",K=(u==null?void 0:u.y)??"140px",re=r>=0?1:0;return e.jsxs("div",{className:"cogita-index-card",style:{"--throw-x":t.throw.x,"--throw-y":t.throw.y,"--throw-rot":t.throw.rot,"--grid-x":t.grid.x,"--grid-y":t.grid.y,"--stack-x":T,"--stack-y":K,"--stack-opacity":re,"--delay":t.delay},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"}),e.jsx("span",{className:"card-quote"}),e.jsx("span",{className:"card-source"}),e.jsxs("span",{className:"card-tags",children:[e.jsx("i",{}),e.jsx("i",{}),e.jsx("i",{})]})]},t.id)})}),N===3&&e.jsxs("div",{className:"cogita-round-board",children:[e.jsxs("div",{className:"round-cards",children:[pe.map((t,r)=>e.jsxs("div",{className:`round-card ${r===he?"is-active":""}`,style:{"--card-x":t.x,"--card-y":t.y},children:[e.jsx("span",{className:"card-title"}),e.jsx("span",{className:"card-line"}),e.jsx("span",{className:"card-line short"})]},t.id)),pe[he]&&e.jsx("span",{className:"round-ring",style:{"--card-x":pe[he].x,"--card-y":`calc(${pe[he].y} - var(--round-card-lift))`}})]}),e.jsx("div",{className:"round-players",children:ke.map(t=>e.jsx("span",{className:"player-dot",style:{left:t.x,top:t.y,"--jitter-x":t.jitterX,"--jitter-y":t.jitterY,"--breath-delay":t.delay}},t.id))}),e.jsx("svg",{className:"round-link-layer",viewBox:"0 0 100 100",preserveAspectRatio:"none","aria-hidden":"true",children:ye.map(t=>e.jsx("line",{className:"round-link",x1:t.from.xNum,y1:t.from.yNum,x2:t.to.xNum,y2:t.to.yNum,style:{"--delay":t.delay}},t.id))}),e.jsx("div",{className:"round-flows",children:ke.map((t,r)=>{const u=X[r]??"good",T=pe[he];if(!T)return null;const K=`calc(${T.y} - var(--round-card-lift))`;return e.jsxs("div",{className:"round-flow",children:[e.jsx("span",{className:"flow-dot",style:{"--from-x":t.x,"--from-y":t.y,"--to-x":T.x,"--to-y":K,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`return-dot is-${u}`,style:{"--from-x":T.x,"--from-y":K,"--to-x":t.x,"--to-y":t.y,"--delay":`${r*.12}s`}}),e.jsx("span",{className:`result-pop is-${u}`,style:{"--at-x":t.x,"--at-y":t.y,"--delay":`${r*.12}s`}})]},`${t.id}-${ce}`)})})]},`round-${ce}`),N===4&&e.jsx("div",{className:"cogita-progress-story",children:e.jsx("div",{className:"progress-chart progress-chart--steps",children:e.jsxs("div",{className:"progress-chart-content",children:[e.jsxs("svg",{className:"progress-svg",viewBox:"0 0 300 200",preserveAspectRatio:"none",role:"presentation",children:[e.jsxs("g",{className:"chart-grid",children:[e.jsx("line",{x1:"40",y1:"30",x2:"40",y2:"170"}),e.jsx("line",{x1:"75",y1:"30",x2:"75",y2:"170"}),e.jsx("line",{x1:"110",y1:"30",x2:"110",y2:"170"}),e.jsx("line",{x1:"145",y1:"30",x2:"145",y2:"170"}),e.jsx("line",{x1:"180",y1:"30",x2:"180",y2:"170"}),e.jsx("line",{x1:"215",y1:"30",x2:"215",y2:"170"}),e.jsx("line",{x1:"250",y1:"30",x2:"250",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"150",x2:"260",y2:"150"}),e.jsx("line",{x1:"40",y1:"130",x2:"260",y2:"130"}),e.jsx("line",{x1:"40",y1:"110",x2:"260",y2:"110"}),e.jsx("line",{x1:"40",y1:"90",x2:"260",y2:"90"}),e.jsx("line",{x1:"40",y1:"70",x2:"260",y2:"70"}),e.jsx("line",{x1:"40",y1:"50",x2:"260",y2:"50"})]}),e.jsxs("g",{className:"chart-axes",children:[e.jsx("line",{x1:"40",y1:"170",x2:"260",y2:"170"}),e.jsx("line",{x1:"40",y1:"170",x2:"40",y2:"30"})]}),e.jsxs("g",{className:"chart-paths",children:[e.jsx("path",{className:"chart-seg seg-1",d:`M${p[0].x} ${p[0].y} L${p[1].x} ${p[1].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-2",d:`M${p[1].x} ${p[1].y} L${p[2].x} ${p[2].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-3",d:`M${p[2].x} ${p[2].y} L${p[3].x} ${p[3].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-4",d:`M${p[3].x} ${p[3].y} L${p[4].x} ${p[4].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-5",d:`M${p[4].x} ${p[4].y} L${p[5].x} ${p[5].y}`,pathLength:"100"}),e.jsx("path",{className:"chart-seg seg-6",d:`M${p[5].x} ${p[5].y} L${p[6].x} ${p[6].y}`,pathLength:"100"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"chart-range-clip",clipPathUnits:"userSpaceOnUse",children:e.jsx("rect",{x:"40",y:"30",width:"0",height:"140",children:e.jsx("animate",{attributeName:"width",dur:"24s",begin:"0s",repeatCount:"indefinite",values:`0;0;${F};${F};240;240`,keyTimes:"0;0.25;0.3125;0.75;0.9167;1",calcMode:"linear"})})})}),e.jsxs("g",{className:"chart-range",clipPath:"url(#chart-range-clip)",children:[e.jsx("animate",{attributeName:"opacity",dur:"24s",begin:"0s",repeatCount:"indefinite",values:"0;0;0.9;0.7;0.7",keyTimes:"0;0.1667;0.2917;0.6;1",calcMode:"linear"}),e.jsx("path",{className:"chart-range-fill",d:`${ne.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")} ${ne.lower.slice().reverse().map(t=>`L${t.x} ${t.y}`).join(" ")} Z`}),e.jsx("path",{className:"chart-range-line range-top",d:`${ne.upper.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`}),e.jsx("path",{className:"chart-range-line range-bottom",d:`${ne.lower.map((t,r)=>`${r===0?"M":"L"}${t.x} ${t.y}`).join(" ")}`})]}),e.jsxs("g",{className:"chart-peers",children:[k.higher.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-1 seg-${r+1}`,d:`M${t.x} ${t.y} L${k.higher[r+1].x} ${k.higher[r+1].y}`,pathLength:"100"},`peer-1-${r}`)),k.lower.slice(0,6).map((t,r)=>e.jsx("path",{className:`chart-peer-seg peer-2 seg-${r+1}`,d:`M${t.x} ${t.y} L${k.lower[r+1].x} ${k.lower[r+1].y}`,pathLength:"100"},`peer-2-${r}`))]})]}),e.jsxs("span",{className:"chart-orbit","aria-hidden":"true",children:[e.jsx("span",{className:"chart-orbit-ring"}),e.jsx("span",{className:"chart-orbit-triangle",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent fast",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})}),e.jsx("span",{className:"chart-orbit-triangle accent slow",children:e.jsx("svg",{viewBox:"0 0 100 100",role:"presentation",children:e.jsx("polygon",{points:"100 50 25 93.3 25 6.7"})})})]}),e.jsx("span",{className:"chart-dot-step",style:{"--p0x":`${p[0].x/300*100}%`,"--p0y":`${p[0].y/200*100}%`,"--p1x":`${p[1].x/300*100}%`,"--p1y":`${p[1].y/200*100}%`,"--p2x":`${p[2].x/300*100}%`,"--p2y":`${p[2].y/200*100}%`,"--p3x":`${p[3].x/300*100}%`,"--p3y":`${p[3].y/200*100}%`,"--p4x":`${p[4].x/300*100}%`,"--p4y":`${p[4].y/200*100}%`,"--p5x":`${p[5].x/300*100}%`,"--p5y":`${p[5].y/200*100}%`,"--p6x":`${p[6].x/300*100}%`,"--p6y":`${p[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-1",style:{"--q0x":`${k.higher[0].x/300*100}%`,"--q0y":`${k.higher[0].y/200*100}%`,"--q1x":`${k.higher[1].x/300*100}%`,"--q1y":`${k.higher[1].y/200*100}%`,"--q2x":`${k.higher[2].x/300*100}%`,"--q2y":`${k.higher[2].y/200*100}%`,"--q3x":`${k.higher[3].x/300*100}%`,"--q3y":`${k.higher[3].y/200*100}%`,"--q4x":`${k.higher[4].x/300*100}%`,"--q4y":`${k.higher[4].y/200*100}%`,"--q5x":`${k.higher[5].x/300*100}%`,"--q5y":`${k.higher[5].y/200*100}%`,"--q6x":`${k.higher[6].x/300*100}%`,"--q6y":`${k.higher[6].y/200*100}%`}}),e.jsx("span",{className:"chart-dot-peer dot-peer-2",style:{"--q0x":`${k.lower[0].x/300*100}%`,"--q0y":`${k.lower[0].y/200*100}%`,"--q1x":`${k.lower[1].x/300*100}%`,"--q1y":`${k.lower[1].y/200*100}%`,"--q2x":`${k.lower[2].x/300*100}%`,"--q2y":`${k.lower[2].y/200*100}%`,"--q3x":`${k.lower[3].x/300*100}%`,"--q3y":`${k.lower[3].y/200*100}%`,"--q4x":`${k.lower[4].x/300*100}%`,"--q4y":`${k.lower[4].y/200*100}%`,"--q5x":`${k.lower[5].x/300*100}%`,"--q5y":`${k.lower[5].y/200*100}%`,"--q6x":`${k.lower[6].x/300*100}%`,"--q6y":`${k.lower[6].y/200*100}%`}})]})})}),N===5&&e.jsxs("div",{className:"cogita-shield",children:[e.jsxs("svg",{viewBox:"0 0 120 140",role:"presentation",children:[e.jsx("path",{d:"M60 10l42 16v44c0 30-19 54-42 62C37 124 18 100 18 70V26z",fill:"none"}),e.jsx("path",{d:"M44 66l10 12 22-26",fill:"none"})]}),e.jsx("span",{className:"cogita-shield-glow"})]}),N===6&&e.jsx("div",{className:"cogita-final-glow"})]})]},y.id)}),!s&&e.jsx("section",{className:"cogita-intro-static",children:e.jsxs("div",{className:"cogita-intro-text",children:[e.jsx("p",{className:"cogita-intro-kicker",children:"Cogita"}),e.jsx("h2",{children:m.title}),m.body&&e.jsx("p",{children:m.body}),m.micro&&e.jsx("p",{className:"cogita-intro-micro",children:m.micro}),e.jsxs("div",{className:"cogita-intro-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:q,children:m.cta}),e.jsx("button",{type:"button",className:"ghost",onClick:O,children:"Otwórz pokaz"})]})]})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cogita-intro-dots","aria-label":"Nawigacja slajdów",children:a.map((y,N)=>e.jsx("button",{type:"button",className:`dot ${n===N?"active":""}`,"aria-label":y.title,onClick:()=>x(N)},y.id))}),e.jsx("button",{type:"button",className:"cogita-intro-skip",onClick:A,children:"Pomiń"})]})]})}const Ui=6,Wi=4;function zi({copy:a,onAuthAction:n,authLabel:s,showProfileMenu:g,onProfileNavigate:h,onToggleSecureMode:v,onLogout:x,secureMode:A,onNavigate:O,language:q,onLanguageChange:l}){const I=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}O("home")},m=i.useRef(null),j=i.useRef([]),U=i.useMemo(()=>{let w=Date.now()%2147483647;const M=()=>(w=w*48271%2147483647,w/2147483647);return Array.from({length:Ui},(ye,ie)=>{const ae=6+M()*8,Ne=7+M()*10,Ee=6+M()*9,Me=-M()*ae,Ae=-M()*Ne,Se=-M()*Ee,Je=.18+M()*.28,Ke=12+M()*18,Fe=4+M()*8,Ue=(M()-.5)*3.2,ra=(M()-.5)*3.8,Ie=M()>.5?"alternate":"alternate-reverse",_=M()>.5?"alternate":"alternate-reverse",te=M()>.5?"alternate":"alternate-reverse",Be=.18+M()*.42,Ce=30+M()*60,be=-45-M()*38,$e=188+M()*32,De=.1+M()*.2;return{id:`wave-${ie+1}`,style:{"--wave-sway-duration":`${ae}s`,"--wave-scale-duration":`${Ne}s`,"--wave-drift-duration":`${Ee}s`,"--wave-sway-delay":`${Me}s`,"--wave-scale-delay":`${Ae}s`,"--wave-drift-delay":`${Se}s`,"--wave-sway-dir":Ie,"--wave-scale-dir":_,"--wave-drift-dir":te,"--wave-scale":`${Je}`,"--wave-shift":`${Ke}%`,"--wave-xshift":`${Fe}%`,"--wave-x0":`${Ue}%`,"--wave-y0":`${ra}%`,"--wave-opacity":`${Be}`,"--wave-blur":`${Ce}px`,"--wave-bottom":`${be}%`,"--wave-hue":`${$e}`,"--wave-glow":`${De}`}}})},[]),G=i.useMemo(()=>{let w=Date.now()*3%2147483647;const M=()=>(w=w*48271%2147483647,w/2147483647);return Array.from({length:Wi},(ye,ie)=>{const ae=180+M()*220,Ne=220+M()*280,Ee=-M()*ae,Me=-M()*Ne,Ae=.12+M()*.22,Se=3+M()*7,Je=1+M()*3,Ke=(M()-.5)*2.8,Fe=(M()-.5)*2.2;return{id:`mesh-${ie+1}`,seed:1e3+ie*991+Math.floor(M()*999),style:{"--mesh-sway-duration":`${ae}s`,"--mesh-drift-duration":`${Ne}s`,"--mesh-sway-delay":`${Ee}s`,"--mesh-drift-delay":`${Me}s`,"--mesh-scale":`${Ae}`,"--mesh-shift":`${Se}%`,"--mesh-xshift":`${Je}%`,"--mesh-x0":`${Fe}%`,"--mesh-y0":`${Ke}%`}}})},[]),W=i.useMemo(()=>{const w=[{id:"entry",panel:{x:"0px",y:"0px",scale:"1"},theme:{bg0:"#06162a",bg1:"#0c2d49",bg2:"#0a1c2f",bloom:"rgba(120, 170, 220, 0.18)",sat:"1"}},{id:"workspace",panel:{x:"-6px",y:"-4px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0b3b56",bg2:"#081f33",bloom:"rgba(129, 190, 235, 0.18)",sat:"1.05"}},{id:"library",panel:{x:"-2px",y:"4px",scale:"1.01"},theme:{bg0:"#071a2f",bg1:"#0c2f4a",bg2:"#081f33",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.96"}},{id:"live",panel:{x:"4px",y:"-2px",scale:"1.02"},theme:{bg0:"#07182d",bg1:"#0c2a4a",bg2:"#081f35",bloom:"rgba(115, 170, 225, 0.15)",sat:"0.98"}},{id:"quiz",panel:{x:"2px",y:"6px",scale:"1.01"},theme:{bg0:"#071526",bg1:"#0d2946",bg2:"#081a30",bloom:"rgba(120, 175, 230, 0.14)",sat:"0.97"}},{id:"protection",panel:{x:"-3px",y:"2px",scale:"1.01"},theme:{bg0:"#071a2a",bg1:"#0a2742",bg2:"#07192d",bloom:"rgba(150, 200, 240, 0.16)",sat:"1"}},{id:"register",panel:{x:"0px",y:"-4px",scale:"1.02"},theme:{bg0:"#081c30",bg1:"#0f3754",bg2:"#0b2239",bloom:"rgba(160, 210, 245, 0.2)",sat:"1.05"}}],M=a.cogita.introSlides,ye=new Map(M.map(ie=>[ie.id,ie]));return w.map(ie=>{var Ne;const ae=ye.get(ie.id);return{...ie,...ae,title:(ae==null?void 0:ae.title)??"Cogita",cta:(ae==null?void 0:ae.cta)??((Ne=a.cogita.introSlides[0])==null?void 0:Ne.cta)??a.cogita.loginCta,secondary:ae==null?void 0:ae.secondary}})},[a.cogita.introSlides]),[d,b]=i.useState(0),[p,ne]=i.useState(!0),[F,k]=i.useState(!1),Q=W.length-1,R=i.useCallback(()=>{try{if(typeof window>"u")return;window.localStorage.setItem("cogitaIntroSeen","true")}catch{}},[]),oe=i.useCallback(()=>{R(),n()},[R,n]),B=i.useCallback(()=>{ne(!0),b(0)},[]),D=i.useCallback(()=>{ne(!1),b(Q)},[Q]),pe=i.useCallback(w=>{b(Math.max(0,Math.min(Q,w)))},[Q]),ke=i.useCallback(()=>{d>=Q?oe():pe(d+1)},[d,pe,oe,Q]),ce=i.useCallback(()=>{pe(d-1)},[d,pe]);i.useEffect(()=>{var ye;const w=(ye=window.matchMedia)==null?void 0:ye.call(window,"(prefers-reduced-motion: reduce)");if(!w)return;const M=()=>k(w.matches);return M(),w.addEventListener?(w.addEventListener("change",M),()=>w.removeEventListener("change",M)):(w.addListener(M),()=>w.removeListener(M))},[]),i.useEffect(()=>{if(!p)return;const w=M=>{const ye=M.target;if(!ye)return;const ie=ye.tagName;if(!(ye.isContentEditable||ie==="INPUT"||ie==="TEXTAREA"||ie==="SELECT"||ie==="BUTTON"||ie==="A"||ye.closest('button, a, [role="button"], [role="link"]'))){if(M.key==="Escape"){D();return}if(M.key==="ArrowLeft"||M.key==="ArrowUp"){ce();return}(M.key==="ArrowRight"||M.key==="ArrowDown"||M.code==="Space"||M.key===" ")&&(M.preventDefault(),ke())}};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[D,ke,ce,p]),i.useEffect(()=>{p&&d===Q&&R()},[d,p,Q,R]),i.useEffect(()=>{const w=m.current;if(!w)return;const M=j.current.filter(be=>!!be);if(!M.length)return;const ye=1,ie=.6,ae=.6,Ne=Math.max(1,Math.min(ye,window.devicePixelRatio||1));let Ee=0,Me=0,Ae=ie,Se=0,Je=0;const Ke=be=>{let $e=be%2147483647;return $e<=0&&($e+=2147483646),(De,qe)=>{$e=$e*48271%2147483647;const Ve=$e/2147483647;return De+Ve*(qe-De)}},Fe={colors:{filaments:"rgba(143, 208, 255, 0.25)",glow:"rgba(167, 224, 255, 0.35)"},filamentCount:1,segments:20,waveBandPx:120,crestThickness:40,waveCenter:.82,amp1:48,amp2:22,freq1:.01,freq2:.021,jitterA:12,jitterB:8,xJitter:4,glowAlpha:.25,depthLayers:2},Ue=be=>{const $e=Math.sin(be*12.9898)*43758.5453;return $e-Math.floor($e)},ra=be=>{const $e=Ue(be+.1)||1e-4,De=Ue(be+.7)||1e-4;return Math.sqrt(-2*Math.log($e))*Math.cos(2*Math.PI*De)},Ie=(be,$e)=>{const De=Math.floor(be),qe=De+1,Ve=be-De,y=Ve*Ve*(3-2*Ve),N=Ue(De*12.9898+$e*78.233),Y=Ue(qe*12.9898+$e*78.233);return N+(Y-N)*y},_=be=>{const $e=Ke(be),De=Math.min(4,Math.max(4,Math.floor(Ee/1200*Fe.filamentCount)));return Array.from({length:De},(qe,Ve)=>{const y=Math.max(-1,Math.min(1,ra(be+Ve*.37))),N=Math.min(1,Math.max(0,Ue(be+Ve*1.31))),Y=Math.min(Fe.depthLayers-1,Math.floor(N*Fe.depthLayers));return{seed:$e(0,Math.PI*2)+be*.01,offset:y,freqA:Fe.freq1*(.75+$e(0,.5)),freqB:Fe.freq2*(.75+$e(0,.5)),ampA:Fe.amp1*(.6+$e(0,.7)),ampB:Fe.amp2*(.6+$e(0,.7)),width:2+Ve%5*.32,depth:N,layer:Y}})},te=(be,$e,De)=>{const qe=Math.max(30,Math.floor(Ee*Me/14e4));be.save(),be.globalAlpha=.6;for(let Ve=0;Ve<qe;Ve+=1){const y=Ue(Ve*9.1+Ee*.11)*$e+De,N=Ue(Ve*3.7+Me*.23)*Me,Y=1.2+Ue(Ve*5.9)*2.4,t=be.createRadialGradient(y,N,0,y,N,Y*2);t.addColorStop(0,"rgba(10, 30, 60, 0.45)"),t.addColorStop(1,"rgba(10, 30, 60, 0)"),be.fillStyle=t,be.beginPath(),be.arc(y,N,Y*2,0,Math.PI*2),be.fill()}be.restore()},Be=(be,$e)=>{be.clearRect(0,0,Ee,Me);const De=Me*Fe.waveCenter,qe=Fe.waveBandPx,Ve=Fe.segments,y=Fe.colors.filaments,N=Se||Ee,Y=0;te(be,N,Y),be.strokeStyle=y,be.lineCap="round",be.lineJoin="round";for(let t=0;t<$e.length;t+=1){const r=$e[t],u=r.offset*qe*(.85+Ue(r.seed)*.4),T=1-Math.min(1,Math.abs(u)/qe),K=Math.exp(-Math.pow(u/Fe.crestThickness,2)),re=r.layer===0?1.1:r.layer===1?.85:.6,le=.35+(1-r.depth)*.65,ee=T*le*re*(.34+K*.45);be.globalAlpha=ee,be.lineWidth=r.width*(1+(1-r.depth)*.8);const de=[];for(let ve=0;ve<=Ve;ve+=1){const Xe=ve/Ve*N+Y,Qe=(Ie(Xe*.012,r.seed)-.5)*Fe.xJitter,Ze=Xe+Qe,P=(Ie(Ze*r.freqA,r.seed)-.5)*Fe.jitterA,Le=(Ie(Ze*r.freqB,r.seed*1.7)-.5)*Fe.jitterB,we=De+Math.sin(Ze*r.freqA+r.seed)*r.ampA+Math.sin(Ze*r.freqB+r.seed*1.3)*r.ampB+u+P+Le;de.push({x:Ze,y:we})}be.beginPath(),be.moveTo(de[0].x,de[0].y);for(let ve=1;ve<de.length-1;ve+=1){const Xe=(de[ve].x+de[ve+1].x)/2,Qe=(de[ve].y+de[ve+1].y)/2;be.quadraticCurveTo(de[ve].x,de[ve].y,Xe,Qe)}const se=de[de.length-1];be.quadraticCurveTo(se.x,se.y,se.x,se.y),be.stroke()}be.save(),be.globalCompositeOperation="lighter",be.strokeStyle=Fe.colors.glow,be.lineCap="round",be.lineJoin="round";for(let t=0;t<$e.length;t+=1){const r=$e[t];if(Math.abs(r.offset)*qe>Fe.crestThickness)continue;const u=Fe.glowAlpha*(.7+(1-r.depth)*.6);be.globalAlpha=u,be.lineWidth=1.6+(1-r.depth)*1.2;const T=[];for(let re=0;re<=Ve;re+=1){const le=re/Ve*N+Y,ee=Math.sin(le*.02+r.seed)*3,de=De+Math.sin(le*r.freqA+r.seed)*r.ampA+Math.sin(le*r.freqB+r.seed*1.3)*r.ampB+r.offset*qe*.35+ee;T.push({x:le,y:de})}be.beginPath(),be.moveTo(T[0].x,T[0].y);for(let re=1;re<T.length-1;re+=1){const le=(T[re].x+T[re+1].x)/2,ee=(T[re].y+T[re+1].y)/2;be.quadraticCurveTo(T[re].x,T[re].y,le,ee)}const K=T[T.length-1];be.quadraticCurveTo(K.x,K.y,K.x,K.y),be.stroke()}be.restore()},Ce=()=>{Ee=Math.floor(w.clientWidth),Me=Math.floor(w.clientHeight),Se=Math.floor(Ee*1.8),Je=Me,Ae=Ee<820?ae:ie,M.forEach(be=>{const $e=be.getContext("2d");if(!$e)return;be.width=Math.floor(Se*Ne*Ae),be.height=Math.floor(Je*Ne*Ae),be.style.width=`${Se}px`,be.style.height=`${Je}px`,be.style.left=`${-(Se-Ee)/2}px`,$e.setTransform(Ne*Ae,0,0,Ne*Ae,0,0);const De=Number(be.dataset.seed||1),qe=_(De);Be($e,qe)})};return Ce(),window.addEventListener("resize",Ce,{passive:!0}),()=>window.removeEventListener("resize",Ce)},[G]);const V=W[Math.min(d,W.length-1)],he=p?V:W[W.length-1],o=(he==null?void 0:he.theme)??W[0].theme,X={"--cogita-bg0":o.bg0,"--cogita-bg1":o.bg1,"--cogita-bg2":o.bg2,"--cogita-bloom":o.bloom,"--cogita-sat":o.sat};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:I,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Kr,{value:q,onChange:l}),e.jsx(Or,{copy:a,label:s,isAuthenticated:g,secureMode:A,onLogin:n,onProfileNavigate:h,onToggleSecureMode:v,onLogout:x,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:e.jsxs("section",{ref:m,className:"cogita-section cogita-home",style:X,children:[e.jsxs("div",{className:"cogita-home-bg","aria-hidden":"true",children:[G.map((w,M)=>e.jsx("canvas",{className:"cogita-home-canvas cogita-home-canvas-layer",style:w.style,"data-seed":w.seed,ref:ye=>{j.current[M]=ye}},w.id)),U.map(w=>e.jsx("div",{className:"cogita-home-wave",style:w.style,children:e.jsx("div",{className:"cogita-home-wave-sway",children:e.jsx("div",{className:"cogita-home-wave-shape"})})},w.id)),e.jsx("div",{className:"cogita-home-glow"})]}),e.jsx(_i,{slides:W,activeIndex:d,introOpen:p,prefersReducedMotion:F,onNext:ke,onPrev:ce,onSelect:pe,onExit:D,onOpen:B,onRegister:oe})]})}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}const Yn=Object.freeze(Object.defineProperty({__proto__:null,CogitaPage:zi},Symbol.toStringTag,{value:"Module"})),Hr=i.createContext(!1);function Ma({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:l}){if(i.useContext(Hr))return e.jsx(e.Fragment,{children:l});const m=()=>{if(typeof window<"u"&&window.history.length>1){window.history.back();return}A("home")};return e.jsxs("div",{className:"portal-page cogita",children:[e.jsxs("header",{className:"portal-header cogita-header",children:[e.jsxs("div",{className:"portal-header-left",children:[e.jsx("button",{type:"button",className:"ghost portal-back",onClick:m,children:a.cogita.shell.back}),e.jsx("a",{className:"ghost portal-up",href:"/#/cogita",children:a.cogita.shell.up}),e.jsx("a",{className:"portal-brand",href:"/#/cogita",children:e.jsx("img",{src:"/cogita/logo/Cogita_Plain.svg",alt:"Cogita"})})]}),e.jsx(Kr,{value:O,onChange:q}),e.jsx(Or,{copy:a,label:n,isAuthenticated:s,secureMode:x,onLogin:()=>A("home"),onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,variant:"ghost"})]}),e.jsx("main",{className:"cogita-main",children:l}),e.jsxs("footer",{className:"portal-footer cogita-footer",children:[e.jsx("a",{className:"portal-brand portal-footer-brand",href:"/#/",children:e.jsx("img",{src:"/logo_inv.svg",alt:"Recreatio"})}),e.jsx("span",{children:a.footer.headline})]})]})}function Ua(a){const[n,s]=i.useState("Cogita library"),[g,h]=i.useState(null);return i.useEffect(()=>{let v=!1;return qr().then(x=>{if(v)return;const A=x.find(O=>O.libraryId===a);A&&s(A.name)}).catch(()=>{v||s("Cogita library")}),()=>{v=!0}},[a]),i.useEffect(()=>{let v=!1;return di(a).then(x=>{v||h(x)}).catch(()=>{v||h(null)}),()=>{v=!0}},[a]),{libraryName:n,stats:g}}function Hi({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l}){const{libraryName:I,stats:m}=Ua(l),[j,U]=i.useState(null),[G,W]=i.useState(null),[d,b]=i.useState(null),[p,ne]=i.useState(null),[F,k]=i.useState(null),[Q,R]=i.useState(null),[oe,B]=i.useState(null),D=i.useRef(null),pe=`/#/cogita/library/${l}`,ke=o=>{if(!Number.isFinite(o))return"0 B";if(o<1024)return`${o} B`;const X=o/1024;if(X<1024)return`${X.toFixed(1)} KB`;const w=X/1024;return w<1024?`${w.toFixed(1)} MB`:`${(w/1024).toFixed(1)} GB`},ce=async()=>{U(null);try{const o=await ui(l);U(a.cogita.library.overview.seedSuccess.replace("{languages}",String(o.languages)).replace("{translations}",String(o.translations)))}catch{U(a.cogita.library.overview.seedFail)}},V=async()=>{W(null),R({loadedBytes:0,totalBytes:null,percent:null});try{W(a.cogita.library.overview.exporting);const o=await gi(l,R),X=URL.createObjectURL(o),w=document.createElement("a");w.href=X,w.download=`cogita-library-${I||l}.json`,w.click(),URL.revokeObjectURL(X),W(a.cogita.library.overview.exportReady)}catch{W(a.cogita.library.overview.exportFail)}finally{R(o=>o??{loadedBytes:0,totalBytes:null,percent:null})}},he=async o=>{var w;b(null),ne(null),k(null);const X=(w=o.target.files)==null?void 0:w[0];if(X)try{b(a.cogita.library.overview.importing),B({loadedBytes:0,totalBytes:X.size,percent:0});const M=await hi(l,X,B,ye=>{const ie=ye.stage==="infos"?a.cogita.library.overview.importStageInfos:ye.stage==="connections"?a.cogita.library.overview.importStageConnections:a.cogita.library.overview.importStageCollections;k(a.cogita.library.overview.importLiveProgress.replace("{stage}",ie).replace("{done}",String(ye.processed)).replace("{total}",String(ye.total)).replace("{infos}",String(ye.infos)).replace("{connections}",String(ye.connections)).replace("{collections}",String(ye.collections)))});ne({infos:M.infosImported,connections:M.connectionsImported,collections:M.collectionsImported}),b(a.cogita.library.overview.importDone)}catch(M){const ye=M instanceof bi&&M.message?` ${M.message}`:"";b(`${a.cogita.library.overview.importFail}${ye}`)}finally{D.current&&(D.current.value="")}};return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h1",{className:"cogita-library-title",children:I}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.overview.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${pe}/list`,children:a.cogita.library.actions.openList}),e.jsx("a",{className:"cta ghost",href:`${pe}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${pe}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsxs("div",{className:"cogita-library-content",children:[e.jsxs("div",{className:"cogita-library-stats",children:[e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.totalInfos}),e.jsx("strong",{children:(m==null?void 0:m.totalInfos)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.connections}),e.jsx("strong",{children:(m==null?void 0:m.totalConnections)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.words}),e.jsx("strong",{children:(m==null?void 0:m.totalWords)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.sentences}),e.jsx("strong",{children:(m==null?void 0:m.totalSentences)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.languages}),e.jsx("strong",{children:(m==null?void 0:m.totalLanguages)??0})]}),e.jsxs("div",{className:"cogita-stat-card",children:[e.jsx("span",{children:a.cogita.library.overview.stats.collections}),e.jsx("strong",{children:(m==null?void 0:m.totalCollections)??0})]})]}),e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.quickActionsTitle}),e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.overview.quickActionsText}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("a",{className:"cta ghost",href:`${pe}/list`,children:a.cogita.library.overview.browseList}),e.jsx("a",{className:"cta ghost",href:`${pe}/collections`,children:a.cogita.library.overview.viewCollections}),e.jsx("a",{className:"cta",href:`${pe}/new`,children:a.cogita.library.overview.addInfo})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta ghost",onClick:ce,children:a.cogita.library.overview.seedMock}),j?e.jsx("p",{className:"cogita-help",children:j}):null]})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.focusTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.focusBody1}),e.jsx("p",{children:a.cogita.library.overview.focusBody2})]})]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.overview.kicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.overview.transferTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.overview.transferBody}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:V,children:a.cogita.library.overview.export}),e.jsxs("label",{className:"cta ghost cogita-file-button",children:[a.cogita.library.overview.import,e.jsx("input",{ref:D,type:"file",accept:"application/json",onChange:he})]})]}),Q?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:Q.percent??void 0,max:Q.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.exportProgress.replace("{loaded}",ke(Q.loadedBytes)).replace("{total}",Q.totalBytes?ke(Q.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,oe?e.jsxs("div",{className:"cogita-progress",children:[e.jsx("progress",{value:oe.percent??void 0,max:oe.totalBytes?100:void 0}),e.jsx("span",{children:a.cogita.library.overview.importProgress.replace("{loaded}",ke(oe.loadedBytes)).replace("{total}",oe.totalBytes?ke(oe.totalBytes):a.cogita.library.overview.progressUnknown)})]}):null,G?e.jsx("p",{className:"cogita-help",children:G}):null,d?e.jsx("p",{className:"cogita-help",children:d}):null,F?e.jsx("p",{className:"cogita-help",children:F}):null,p?e.jsx("p",{className:"cogita-help",children:a.cogita.library.overview.importSummary.replace("{infos}",String(p.infos)).replace("{connections}",String(p.connections)).replace("{collections}",String(p.collections))}):null]})]})]})]})]})})]})})}const me=a=>`${a.cardType}:${a.cardId}:${a.checkType??""}:${a.direction??""}`,Fa=(a,n,s,g)=>`${a}:${n}:${s??""}:${g??""}`,Ge=(a,n)=>{const s=a.cogita.library.infoTypes;return{any:s.any,vocab:s.vocab,language:s.language,word:s.word,sentence:s.sentence,topic:s.topic,collection:s.collection,person:s.person,institution:s.institution,collective:s.collective,orcid:s.orcid,address:s.address,email:s.email,phone:s.phone,media:s.media,work:s.work,geo:s.geo,music_piece:s.musicPiece,music_fragment:s.musicFragment,source:s.source,quote:s.quote,computed:s.computed}[n]??String(n)},Jr=a=>[{value:"any",label:Ge(a,"any")},{value:"language",label:Ge(a,"language")},{value:"word",label:Ge(a,"word")},{value:"sentence",label:Ge(a,"sentence")},{value:"topic",label:Ge(a,"topic")},{value:"collection",label:Ge(a,"collection")},{value:"person",label:Ge(a,"person")},{value:"institution",label:Ge(a,"institution")},{value:"collective",label:Ge(a,"collective")},{value:"orcid",label:Ge(a,"orcid")},{value:"address",label:Ge(a,"address")},{value:"email",label:Ge(a,"email")},{value:"phone",label:Ge(a,"phone")},{value:"media",label:Ge(a,"media")},{value:"work",label:Ge(a,"work")},{value:"geo",label:Ge(a,"geo")},{value:"music_piece",label:Ge(a,"music_piece")},{value:"music_fragment",label:Ge(a,"music_fragment")},{value:"source",label:Ge(a,"source")},{value:"quote",label:Ge(a,"quote")},{value:"computed",label:Ge(a,"computed")}],Ji=a=>[{value:"word-language",label:a.cogita.library.connectionTypes.wordLanguage},{value:"quote-language",label:a.cogita.library.connectionTypes.quoteLanguage},{value:"word-topic",label:a.cogita.library.connectionTypes.wordTopic},{value:"language-sentence",label:a.cogita.library.connectionTypes.languageSentence},{value:"translation",label:a.cogita.library.connectionTypes.translation},{value:"reference",label:a.cogita.library.connectionTypes.reference},{value:"source-resource",label:a.cogita.library.connectionTypes.sourceResource},{value:"work-contributor",label:a.cogita.library.connectionTypes.workContributor},{value:"work-medium",label:a.cogita.library.connectionTypes.workMedium},{value:"orcid-link",label:a.cogita.library.connectionTypes.orcidLink}],Yi=a=>[{value:"vocab",label:a.cogita.library.groupTypes.vocab},{value:"citation",label:a.cogita.library.groupTypes.citation},{value:"book",label:a.cogita.library.groupTypes.book}],Qi=a=>[{value:"any",label:Ge(a,"any")},{value:"vocab",label:Ge(a,"vocab")},...Jr(a).filter(n=>n.value!=="any")],Ga=5,Ir=50,Pr=2,Rr=[];function Oe({libraryId:a,infoType:n,label:s,placeholder:g,value:h,onChange:v,values:x,onChangeMultiple:A,helperText:O,searchFailedText:q,createFailedText:l,createLabel:I,savingLabel:m,loadMoreLabel:j,inputRef:U,autoAdvance:G,onCommit:W,multiple:d}){const b=d?x??Rr:Rr,[p,ne]=i.useState(d?"":(h==null?void 0:h.label)??""),[F,k]=i.useState([]),[Q,R]=i.useState(Ga),[oe,B]=i.useState(-1),[D,pe]=i.useState(!1),[ke,ce]=i.useState(!1),[V,he]=i.useState(null),o=i.useRef(0),X=i.useRef(new Map),w=i.useMemo(()=>d?p.trim().length>0:p.trim().length>0&&!h,[p,h,d]);i.useEffect(()=>{d||ne((h==null?void 0:h.label)??"")},[h,d]),i.useEffect(()=>{const ie=p.trim();if(!ie||ie.length<Pr){k([]),pe(!1),R(Ga),B(-1),ce(!1),he(null);return}const ae=ie.toLowerCase(),Ne=`${a}:${n}:${ae}`,Ee=X.current.get(Ne);if(Ee){if(d&&b.length>0){const Ae=new Set(b.map(Se=>Se.id));k(Ee.filter(Se=>!Ae.has(Se.id)))}else k(Ee);R(Ga),B(-1),pe(Ee.length>0),ce(!1),he(null);return}const Me=window.setTimeout(async()=>{const Ae=Date.now();o.current=Ae,ce(!0),he(null);try{const Se=await Vr({libraryId:a,type:n,query:ie,limit:Ir});if(o.current!==Ae)return;const Je=Se.slice(0,Ir).map(Ke=>({id:Ke.infoId,label:Ke.label,infoType:Ke.infoType}));if(X.current.set(Ne,Je),d&&b.length>0){const Ke=new Set(b.map(Fe=>Fe.id));k(Je.filter(Fe=>!Ke.has(Fe.id)))}else k(Je);R(Ga),B(-1),pe(!0)}catch{if(o.current!==Ae)return;he(q??"Search failed.")}finally{o.current===Ae&&ce(!1)}},250);return()=>window.clearTimeout(Me)},[a,n,p,b]);const M=ie=>{if(d){const ae=b.some(Ne=>Ne.id===ie.id)?b:[...b,ie];A==null||A(ae),ne(""),pe(!1),B(-1);return}v==null||v(ie),ne(ie.label),pe(!1),B(-1),G&&(W==null||W())},ye=async()=>{const ie=p.trim();if(ie){ce(!0),he(null);try{const ae=await Xa({libraryId:a,infoType:n,payload:{label:ie}}),Ne={id:ae.infoId,label:ie,infoType:ae.infoType};if(ie.length>=Pr){const Ee=`${a}:${n}:${ie.toLowerCase()}`,Me=X.current.get(Ee)??[];X.current.set(Ee,[Ne,...Me])}if(d){A==null||A([...b,Ne]),ne(""),pe(!1),B(-1);return}v==null||v(Ne),pe(!1),B(-1),G&&(W==null||W())}catch{he(l??"Create failed.")}finally{ce(!1)}}};return e.jsxs("div",{className:"cogita-lookup",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:s}),e.jsx("input",{value:p,placeholder:g,onChange:ie=>{ne(ie.target.value),!d&&h&&(v==null||v(null))},onKeyDown:ie=>{if(ie.key==="ArrowDown"){if(ie.preventDefault(),!F.length)return;pe(!0),B(ae=>{const Ne=Math.min(F.length,Q)-1,Ee=ae<0?0:Math.min(ae+1,Ne);return Ee===Ne&&F.length>Q?(R(Me=>Math.min(Me+Ga,F.length)),Math.min(ae+1,Math.min(F.length,Q+Ga)-1)):Ee});return}if(ie.key==="ArrowUp"){if(ie.preventDefault(),!F.length)return;pe(!0),B(ae=>ae<=0?0:ae-1);return}if(ie.key==="Enter"){if(ie.preventDefault(),oe>=0&&F[oe]){M(F[oe]);return}if(w){ye();return}}},onFocus:()=>{F.length>0&&pe(!0)},autoComplete:"off",ref:U})]}),d&&b.length>0&&e.jsx("div",{className:"cogita-lookup-chips",children:b.map(ie=>e.jsxs("button",{type:"button",className:"cogita-lookup-chip",onClick:()=>A==null?void 0:A(b.filter(ae=>ae.id!==ie.id)),children:[ie.label,e.jsx("span",{"aria-hidden":"true",children:"×"})]},ie.id))}),O&&e.jsx("p",{className:"cogita-help",children:O}),V&&e.jsx("p",{className:"cogita-error",children:V}),D&&F.length>0&&e.jsxs("div",{className:"cogita-lookup-results",children:[F.slice(0,Q).map((ie,ae)=>e.jsxs("button",{type:"button",className:"cogita-lookup-option","data-active":ae===oe,onClick:()=>M(ie),children:[e.jsx("strong",{children:ie.label}),e.jsx("span",{children:ie.infoType})]},ie.id)),Q<F.length&&e.jsx("button",{type:"button",className:"cogita-lookup-more",onClick:()=>R(ie=>Math.min(ie+Ga,F.length)),children:j??"Load more"})]}),w&&e.jsx("button",{type:"button",className:"cogita-lookup-create",onClick:ye,disabled:ke,children:ke?m??"Saving...":I??`Create new ${n}`})]})}function Gi({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l,mode:I}){const{libraryName:m}=Ua(l),j=`/#/cogita/library/${l}`,[U,G]=i.useState("any"),[W,d]=i.useState(""),[b,p]=i.useState([]),[ne,F]=i.useState("idle"),[k,Q]=i.useState(null),[R,oe]=i.useState(null),[B,D]=i.useState("idle"),[pe,ke]=i.useState(0),[ce,V]=i.useState(null),[he,o]=i.useState("idle"),[X,w]=i.useState(null),[M,ye]=i.useState(null),[ie,ae]=i.useState(null),[Ne,Ee]=i.useState(null),Me=i.useMemo(()=>({languageAId:(X==null?void 0:X.id)??void 0,languageBId:(M==null?void 0:M.id)??void 0,topicId:(ie==null?void 0:ie.id)??void 0,levelId:(Ne==null?void 0:Ne.id)??void 0}),[X,M,ie,Ne]),Ae=i.useMemo(()=>U==="vocab"||U==="any",[U]);i.useEffect(()=>{F("loading");const Ie=window.setTimeout(()=>{Mr({libraryId:l,type:U==="any"?void 0:U,query:W.trim()||void 0,limit:30,languageAId:Ae?Me.languageAId:void 0,languageBId:Ae?Me.languageBId:void 0,topicId:Ae?Me.topicId:void 0,levelId:Ae?Me.levelId:void 0}).then(_=>{p(_.items),ke(_.total),V(_.nextCursor??null),F("ready"),Q(_.items[0]??null)}).catch(()=>{p([]),ke(0),V(null),F("ready")})},240);return()=>window.clearTimeout(Ie)},[l,W,U,Ae,Me]),i.useEffect(()=>{if(!k||k.cardType!=="info"||k.infoType!=="computed"){oe(null),D("idle"),o("idle");return}D("loading"),br({libraryId:l,infoId:k.cardId}).then(Ie=>{oe(Ie),D("ready")}).catch(()=>{oe(null),D("ready")})},[l,k]);const Se=async()=>{if(ce){F("loading");try{const Ie=await Mr({libraryId:l,type:U==="any"?void 0:U,query:W.trim()||void 0,limit:30,cursor:ce,languageAId:Ae?Me.languageAId:void 0,languageBId:Ae?Me.languageBId:void 0,topicId:Ae?Me.topicId:void 0,levelId:Ae?Me.levelId:void 0});p(_=>[..._,...Ie.items]),V(Ie.nextCursor??null),ke(Ie.total),F("ready")}catch{F("ready")}}},Je=async()=>{if(!(!k||k.cardType!=="connection"&&k.cardType!=="vocab"||!window.confirm(a.cogita.library.list.deleteConnectionConfirm))){o("loading");try{await mi({libraryId:l,connectionId:k.cardId});let _=null;p(te=>{const Be=te.filter(Ce=>Ce.cardId!==k.cardId);return _=Be[0]??null,Be}),ke(te=>Math.max(0,te-(k.cardType==="vocab"?3:1))),Q(te=>te&&te.cardId===k.cardId?_:te),o("idle")}catch{o("error")}}},Ke=i.useMemo(()=>I==="collection"?"grid":I==="list"?"list":"detail",[I]),Fe=k?me(k):null,Ue=i.useMemo(()=>Qi(a),[a]),ra=i.useMemo(()=>{const Ie=pe||b.length;return a.cogita.library.list.cardCount.replace("{shown}",String(b.length)).replace("{total}",String(Ie))},[a,b.length,pe]);return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":Ke,children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.list.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta",href:`${j}/new`,children:a.cogita.library.actions.addInfo})]})]}),e.jsx("div",{className:"cogita-library-modes",children:["detail","collection","list"].map(Ie=>e.jsx("a",{className:"ghost","data-active":I===Ie,href:`${j}/${Ie}`,children:Ie==="detail"?a.cogita.library.list.modes.detail:Ie==="collection"?a.cogita.library.list.modes.collection:a.cogita.library.list.modes.list},Ie))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-library-controls",children:[e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.searchTitle}),e.jsxs("div",{className:"cogita-search-field",children:[e.jsx("select",{value:U,onChange:Ie=>G(Ie.target.value),children:Ue.map(Ie=>e.jsx("option",{value:Ie.value,children:Ie.label},Ie.value))}),e.jsx("input",{type:"text",value:W,onChange:Ie=>d(Ie.target.value),placeholder:a.cogita.library.list.searchPlaceholder})]})]}),(U==="vocab"||U==="any")&&e.jsxs("div",{className:"cogita-library-filters",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.filters.title}),e.jsxs("div",{className:"cogita-filter-grid",children:[e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageA,placeholder:a.cogita.library.filters.placeholderLanguageA,value:X,onChange:w,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.filters.languageB,placeholder:a.cogita.library.filters.placeholderLanguageB,value:M,onChange:ye,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.topic,placeholder:a.cogita.library.filters.placeholderTopic,value:ie,onChange:ae,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"topic",label:a.cogita.library.filters.level,placeholder:a.cogita.library.filters.placeholderLevel,value:Ne,onChange:Ee,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.filters.level),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),(X||M||ie||Ne)&&e.jsx("button",{type:"button",className:"ghost",onClick:()=>{w(null),ye(null),ae(null),Ee(null)},children:a.cogita.library.filters.clear})]})]}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:ra}),e.jsx("span",{children:ne==="loading"?a.cogita.library.list.loading:a.cogita.library.list.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":I==="collection"?"grid":"list",children:b.length?b.map(Ie=>e.jsxs("button",{type:"button",className:"cogita-card-item","data-selected":Fe===me(Ie),onClick:()=>Q(Ie),children:[e.jsx("div",{className:"cogita-card-type",children:Ie.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:Ie.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:Ie.label}),e.jsx("p",{className:"cogita-card-subtitle",children:Ie.description})]},me(Ie))):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.list.noMatch}),e.jsx("a",{className:"ghost",href:`${j}/new`,children:a.cogita.library.list.addInfo})]})}),ce?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Se,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsxs("div",{className:"cogita-detail-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.selectedTitle}),e.jsx("h3",{className:"cogita-detail-title",children:(k==null?void 0:k.label)??a.cogita.library.list.selectedEmpty})]}),e.jsxs("div",{className:"cogita-detail-actions",children:[(k==null?void 0:k.cardType)==="info"?e.jsx("a",{className:"ghost",href:`${j}/edit/${k.cardId}`,children:a.cogita.library.list.editInfo}):null,(k==null?void 0:k.cardType)==="connection"||(k==null?void 0:k.cardType)==="vocab"?e.jsx("button",{type:"button",className:"ghost danger",onClick:Je,disabled:he==="loading",children:a.cogita.library.list.deleteConnection}):null,e.jsx("a",{className:"ghost",href:`${j}/new`,children:a.cogita.library.actions.addInfo})]})]}),k?e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:k.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:k.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("p",{children:a.cogita.library.list.selectedHint}),he==="error"&&(k.cardType==="connection"||k.cardType==="vocab")?e.jsx("p",{children:a.cogita.library.list.deleteConnectionFailed}):null,k.cardType==="info"&&k.infoType==="computed"&&e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.list.computedSampleTitle}),B==="loading"&&e.jsx("p",{children:a.cogita.library.list.computedLoading}),B!=="loading"&&R?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:a.cogita.library.list.computedPromptLabel})}),e.jsx(Rt,{value:R.prompt,mode:"auto"}),R.expectedAnswers&&Object.keys(R.expectedAnswers).length>0?e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(R.expectedAnswers).map(([Ie,_])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:Ie}),e.jsx(mr,{value:_,mode:"auto"})]},Ie))}):e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.list.computedAnswerLabel})," ",e.jsx(mr,{value:R.expectedAnswer,mode:"auto"})]})]}):B!=="loading"?e.jsx("p",{children:a.cogita.library.list.computedEmpty}):null]})]}):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.list.selectedEmpty})})]})})]})})})]})})}const Ft=[{id:"gen",la:{abbr:"Gen",name:"Genesis"},en:{abbr:"Gen",name:"Genesis"},de:{abbr:"Gen",name:"Genesis"},pl:{abbr:"Rdz",name:"Księga Rodzaju"}},{id:"ex",la:{abbr:"Ex",name:"Exodus"},en:{abbr:"Ex",name:"Exodus"},de:{abbr:"Ex",name:"Exodus"},pl:{abbr:"Wj",name:"Księga Wyjścia"}},{id:"lev",la:{abbr:"Lev",name:"Leviticus"},en:{abbr:"Lev",name:"Leviticus"},de:{abbr:"Lev",name:"Levitikus"},pl:{abbr:"Kpł",name:"Księga Kapłańska"}},{id:"num",la:{abbr:"Num",name:"Numeri"},en:{abbr:"Num",name:"Numbers"},de:{abbr:"Num",name:"Numeri"},pl:{abbr:"Lb",name:"Księga Liczb"}},{id:"deut",la:{abbr:"Deut",name:"Deuteronomium"},en:{abbr:"Deut",name:"Deuteronomy"},de:{abbr:"Dtn",name:"Deuteronomium"},pl:{abbr:"Pwt",name:"Księga Powtórzonego Prawa"}},{id:"ios",la:{abbr:"Ios",name:"Iosue"},en:{abbr:"Josh",name:"Joshua"},de:{abbr:"Jos",name:"Josua"},pl:{abbr:"Joz",name:"Księga Jozuego"}},{id:"iudg",la:{abbr:"Iudg",name:"Iudicum"},en:{abbr:"Judg",name:"Judges"},de:{abbr:"Ri",name:"Richter"},pl:{abbr:"Sdz",name:"Księga Sędziów"}},{id:"ruth",la:{abbr:"Ruth",name:"Ruth"},en:{abbr:"Ruth",name:"Ruth"},de:{abbr:"Rut",name:"Rut"},pl:{abbr:"Rt",name:"Księga Rut"}},{id:"1sam",la:{abbr:"1 Sam",name:"I Samuelis"},en:{abbr:"1 Sam",name:"1 Samuel"},de:{abbr:"1 Sam",name:"1 Samuel"},pl:{abbr:"1 Sm",name:"1 Księga Samuela"}},{id:"2sam",la:{abbr:"2 Sam",name:"II Samuelis"},en:{abbr:"2 Sam",name:"2 Samuel"},de:{abbr:"2 Sam",name:"2 Samuel"},pl:{abbr:"2 Sm",name:"2 Księga Samuela"}},{id:"1reg",la:{abbr:"1 Reg",name:"I Regum"},en:{abbr:"1 Kgs",name:"1 Kings"},de:{abbr:"1 Kön",name:"1 Könige"},pl:{abbr:"1 Krl",name:"1 Księga Królewska"}},{id:"2reg",la:{abbr:"2 Reg",name:"II Regum"},en:{abbr:"2 Kgs",name:"2 Kings"},de:{abbr:"2 Kön",name:"2 Könige"},pl:{abbr:"2 Krl",name:"2 Księga Królewska"}},{id:"1par",la:{abbr:"1 Par",name:"I Paralipomenon"},en:{abbr:"1 Chr",name:"1 Chronicles"},de:{abbr:"1 Chr",name:"1 Chronik"},pl:{abbr:"1 Krn",name:"1 Księga Kronik"}},{id:"2par",la:{abbr:"2 Par",name:"II Paralipomenon"},en:{abbr:"2 Chr",name:"2 Chronicles"},de:{abbr:"2 Chr",name:"2 Chronik"},pl:{abbr:"2 Krn",name:"2 Księga Kronik"}},{id:"esd",la:{abbr:"Esd",name:"Esdrae"},en:{abbr:"Ezra",name:"Ezra"},de:{abbr:"Esra",name:"Esra"},pl:{abbr:"Ezd",name:"Księga Ezdrasza"}},{id:"neh",la:{abbr:"Neh",name:"Nehemiae"},en:{abbr:"Neh",name:"Nehemiah"},de:{abbr:"Neh",name:"Nehemia"},pl:{abbr:"Ne",name:"Księga Nehemiasza"}},{id:"tob",la:{abbr:"Tob",name:"Tobiae"},en:{abbr:"Tob",name:"Tobit"},de:{abbr:"Tob",name:"Tobit"},pl:{abbr:"Tb",name:"Księga Tobiasza"}},{id:"iudt",la:{abbr:"Iudt",name:"Iudith"},en:{abbr:"Jdt",name:"Judith"},de:{abbr:"Jdt",name:"Judit"},pl:{abbr:"Jdt",name:"Księga Judyty"}},{id:"est",la:{abbr:"Est",name:"Esther"},en:{abbr:"Est",name:"Esther"},de:{abbr:"Est",name:"Ester"},pl:{abbr:"Est",name:"Księga Estery"}},{id:"1macc",la:{abbr:"1 Macc",name:"I Maccabaeorum"},en:{abbr:"1 Mc",name:"1 Maccabees"},de:{abbr:"1 Makk",name:"1 Makkabäer"},pl:{abbr:"1 Mch",name:"1 Księga Machabejska"}},{id:"2macc",la:{abbr:"2 Macc",name:"II Maccabaeorum"},en:{abbr:"2 Mc",name:"2 Maccabees"},de:{abbr:"2 Makk",name:"2 Makkabäer"},pl:{abbr:"2 Mch",name:"2 Księga Machabejska"}},{id:"iob",la:{abbr:"Iob",name:"Iob"},en:{abbr:"Job",name:"Job"},de:{abbr:"Ijob",name:"Ijob"},pl:{abbr:"Hi",name:"Księga Hioba"}},{id:"ps",la:{abbr:"Ps",name:"Psalmi"},en:{abbr:"Ps",name:"Psalms"},de:{abbr:"Ps",name:"Psalmen"},pl:{abbr:"Ps",name:"Księga Psalmów"}},{id:"prov",la:{abbr:"Prov",name:"Proverbia"},en:{abbr:"Prov",name:"Proverbs"},de:{abbr:"Spr",name:"Sprichwörter"},pl:{abbr:"Prz",name:"Księga Przysłów"}},{id:"ecc",la:{abbr:"Ecc",name:"Ecclesiastes"},en:{abbr:"Eccl",name:"Ecclesiastes"},de:{abbr:"Koh",name:"Kohelet"},pl:{abbr:"Koh",name:"Księga Koheleta"}},{id:"cant",la:{abbr:"Cant",name:"Canticum Canticorum"},en:{abbr:"Song",name:"Song of Songs"},de:{abbr:"Hld",name:"Hoheslied"},pl:{abbr:"Pnp",name:"Pieśń nad Pieśniami"}},{id:"sap",la:{abbr:"Sap",name:"Sapientia"},en:{abbr:"Wis",name:"Wisdom"},de:{abbr:"Weish",name:"Weisheit"},pl:{abbr:"Mdr",name:"Księga Mądrości"}},{id:"sir",la:{abbr:"Sir",name:"Ecclesiasticus (Sirach)"},en:{abbr:"Sir",name:"Sirach"},de:{abbr:"Sir",name:"Jesus Sirach"},pl:{abbr:"Syr",name:"Mądrość Syracha"}},{id:"isa",la:{abbr:"Isa",name:"Isaias"},en:{abbr:"Isa",name:"Isaiah"},de:{abbr:"Jes",name:"Jesaja"},pl:{abbr:"Iz",name:"Księga Izajasza"}},{id:"ier",la:{abbr:"Ier",name:"Ieremias"},en:{abbr:"Jer",name:"Jeremiah"},de:{abbr:"Jer",name:"Jeremia"},pl:{abbr:"Jr",name:"Księga Jeremiasza"}},{id:"lam",la:{abbr:"Lam",name:"Lamentationes"},en:{abbr:"Lam",name:"Lamentations"},de:{abbr:"Klgl",name:"Klagelieder"},pl:{abbr:"Lm",name:"Lamentacje"}},{id:"bar",la:{abbr:"Bar",name:"Baruch"},en:{abbr:"Bar",name:"Baruch"},de:{abbr:"Bar",name:"Baruch"},pl:{abbr:"Ba",name:"Księga Barucha"}},{id:"ez",la:{abbr:"Ez",name:"Ezechiel"},en:{abbr:"Ezek",name:"Ezekiel"},de:{abbr:"Ez",name:"Ezechiel"},pl:{abbr:"Ez",name:"Księga Ezechiela"}},{id:"dan",la:{abbr:"Dan",name:"Daniel"},en:{abbr:"Dan",name:"Daniel"},de:{abbr:"Dan",name:"Daniel"},pl:{abbr:"Dn",name:"Księga Daniela"}},{id:"hos",la:{abbr:"Hos",name:"Osee"},en:{abbr:"Hos",name:"Hosea"},de:{abbr:"Hos",name:"Hosea"},pl:{abbr:"Oz",name:"Księga Ozeasza"}},{id:"ioel",la:{abbr:"Ioel",name:"Ioel"},en:{abbr:"Joel",name:"Joel"},de:{abbr:"Joel",name:"Joel"},pl:{abbr:"Jl",name:"Księga Joela"}},{id:"amos",la:{abbr:"Amos",name:"Amos"},en:{abbr:"Am",name:"Amos"},de:{abbr:"Am",name:"Amos"},pl:{abbr:"Am",name:"Księga Amosa"}},{id:"abd",la:{abbr:"Abd",name:"Abdias"},en:{abbr:"Obad",name:"Obadiah"},de:{abbr:"Obd",name:"Obadja"},pl:{abbr:"Abd",name:"Księga Abdiasza"}},{id:"ion",la:{abbr:"Ion",name:"Ionas"},en:{abbr:"Jon",name:"Jonah"},de:{abbr:"Jona",name:"Jona"},pl:{abbr:"Jon",name:"Księga Jonasza"}},{id:"mich",la:{abbr:"Mich",name:"Michaeas"},en:{abbr:"Mic",name:"Micah"},de:{abbr:"Mi",name:"Micha"},pl:{abbr:"Mi",name:"Księga Micheasza"}},{id:"nah",la:{abbr:"Nah",name:"Nahum"},en:{abbr:"Nah",name:"Nahum"},de:{abbr:"Nah",name:"Nahum"},pl:{abbr:"Na",name:"Księga Nahuma"}},{id:"hab",la:{abbr:"Hab",name:"Habacuc"},en:{abbr:"Hab",name:"Habakkuk"},de:{abbr:"Hab",name:"Habakuk"},pl:{abbr:"Ha",name:"Księga Habakuka"}},{id:"soph",la:{abbr:"Soph",name:"Sophonias"},en:{abbr:"Zeph",name:"Zephaniah"},de:{abbr:"Zef",name:"Zefanja"},pl:{abbr:"So",name:"Księga Sofoniasza"}},{id:"agg",la:{abbr:"Agg",name:"Aggaeus"},en:{abbr:"Hag",name:"Haggai"},de:{abbr:"Hag",name:"Haggai"},pl:{abbr:"Ag",name:"Księga Aggeusza"}},{id:"zach",la:{abbr:"Zach",name:"Zacharias"},en:{abbr:"Zech",name:"Zechariah"},de:{abbr:"Sach",name:"Sacharja"},pl:{abbr:"Za",name:"Księga Zachariasza"}},{id:"mal",la:{abbr:"Mal",name:"Malachias"},en:{abbr:"Mal",name:"Malachi"},de:{abbr:"Mal",name:"Maleachi"},pl:{abbr:"Ml",name:"Księga Malachiasza"}},{id:"mt",la:{abbr:"Mt",name:"Matthaeus"},en:{abbr:"Matt",name:"Matthew"},de:{abbr:"Mt",name:"Matthäus"},pl:{abbr:"Mt",name:"Ewangelia wg św. Mateusza"}},{id:"mc",la:{abbr:"Mc",name:"Marcus"},en:{abbr:"Mark",name:"Mark"},de:{abbr:"Mk",name:"Markus"},pl:{abbr:"Mk",name:"Ewangelia wg św. Marka"}},{id:"lc",la:{abbr:"Lc",name:"Lucas"},en:{abbr:"Luke",name:"Luke"},de:{abbr:"Lk",name:"Lukas"},pl:{abbr:"Łk",name:"Ewangelia wg św. Łukasza"}},{id:"io",la:{abbr:"Io",name:"Ioannes"},en:{abbr:"John",name:"John"},de:{abbr:"Joh",name:"Johannes"},pl:{abbr:"J",name:"Ewangelia wg św. Jana"}},{id:"act",la:{abbr:"Act",name:"Actus Apostolorum"},en:{abbr:"Acts",name:"Acts"},de:{abbr:"Apg",name:"Apostelgeschichte"},pl:{abbr:"Dz",name:"Dzieje Apostolskie"}},{id:"rom",la:{abbr:"Rom",name:"ad Romanos"},en:{abbr:"Rom",name:"Romans"},de:{abbr:"Röm",name:"Römer"},pl:{abbr:"Rz",name:"List do Rzymian"}},{id:"1cor",la:{abbr:"1 Cor",name:"I ad Corinthios"},en:{abbr:"1 Cor",name:"1 Corinthians"},de:{abbr:"1 Kor",name:"1 Korinther"},pl:{abbr:"1 Kor",name:"1 List do Koryntian"}},{id:"2cor",la:{abbr:"2 Cor",name:"II ad Corinthios"},en:{abbr:"2 Cor",name:"2 Corinthians"},de:{abbr:"2 Kor",name:"2 Korinther"},pl:{abbr:"2 Kor",name:"2 List do Koryntian"}},{id:"gal",la:{abbr:"Gal",name:"ad Galatas"},en:{abbr:"Gal",name:"Galatians"},de:{abbr:"Gal",name:"Galater"},pl:{abbr:"Ga",name:"List do Galatów"}},{id:"eph",la:{abbr:"Eph",name:"ad Ephesios"},en:{abbr:"Eph",name:"Ephesians"},de:{abbr:"Eph",name:"Epheser"},pl:{abbr:"Ef",name:"List do Efezjan"}},{id:"phil",la:{abbr:"Phil",name:"ad Philippenses"},en:{abbr:"Phil",name:"Philippians"},de:{abbr:"Phil",name:"Philipper"},pl:{abbr:"Flp",name:"List do Filipian"}},{id:"col",la:{abbr:"Col",name:"ad Colossenses"},en:{abbr:"Col",name:"Colossians"},de:{abbr:"Kol",name:"Kolosser"},pl:{abbr:"Kol",name:"List do Kolosan"}},{id:"1thess",la:{abbr:"1 Thess",name:"I ad Thessalonicenses"},en:{abbr:"1 Thess",name:"1 Thessalonians"},de:{abbr:"1 Thess",name:"1 Thessalonicher"},pl:{abbr:"1 Tes",name:"1 List do Tesaloniczan"}},{id:"2thess",la:{abbr:"2 Thess",name:"II ad Thessalonicenses"},en:{abbr:"2 Thess",name:"2 Thessalonians"},de:{abbr:"2 Thess",name:"2 Thessalonicher"},pl:{abbr:"2 Tes",name:"2 List do Tesaloniczan"}},{id:"1tim",la:{abbr:"1 Tim",name:"I ad Timotheum"},en:{abbr:"1 Tim",name:"1 Timothy"},de:{abbr:"1 Tim",name:"1 Timotheus"},pl:{abbr:"1 Tm",name:"1 List do Tymoteusza"}},{id:"2tim",la:{abbr:"2 Tim",name:"II ad Timotheum"},en:{abbr:"2 Tim",name:"2 Timothy"},de:{abbr:"2 Tim",name:"2 Timotheus"},pl:{abbr:"2 Tm",name:"2 List do Tymoteusza"}},{id:"tit",la:{abbr:"Tit",name:"ad Titum"},en:{abbr:"Titus",name:"Titus"},de:{abbr:"Tit",name:"Titus"},pl:{abbr:"Tt",name:"List do Tytusa"}},{id:"phlm",la:{abbr:"Phlm",name:"ad Philemonem"},en:{abbr:"Phlm",name:"Philemon"},de:{abbr:"Phlm",name:"Philemon"},pl:{abbr:"Flm",name:"List do Filemona"}},{id:"heb",la:{abbr:"Heb",name:"ad Hebraeos"},en:{abbr:"Heb",name:"Hebrews"},de:{abbr:"Hebr",name:"Hebräer"},pl:{abbr:"Hbr",name:"List do Hebrajczyków"}},{id:"iac",la:{abbr:"Iac",name:"Iacobi"},en:{abbr:"Jas",name:"James"},de:{abbr:"Jak",name:"Jakobus"},pl:{abbr:"Jk",name:"List św. Jakuba"}},{id:"1pet",la:{abbr:"1 Pet",name:"I Petri"},en:{abbr:"1 Pet",name:"1 Peter"},de:{abbr:"1 Petr",name:"1 Petrus"},pl:{abbr:"1 P",name:"1 List św. Piotra"}},{id:"2pet",la:{abbr:"2 Pet",name:"II Petri"},en:{abbr:"2 Pet",name:"2 Peter"},de:{abbr:"2 Petr",name:"2 Petrus"},pl:{abbr:"2 P",name:"2 List św. Piotra"}},{id:"1io",la:{abbr:"1 Io",name:"I Ioannis"},en:{abbr:"1 John",name:"1 John"},de:{abbr:"1 Joh",name:"1 Johannes"},pl:{abbr:"1 J",name:"1 List św. Jana"}},{id:"2io",la:{abbr:"2 Io",name:"II Ioannis"},en:{abbr:"2 John",name:"2 John"},de:{abbr:"2 Joh",name:"2 Johannes"},pl:{abbr:"2 J",name:"2 List św. Jana"}},{id:"3io",la:{abbr:"3 Io",name:"III Ioannis"},en:{abbr:"3 John",name:"3 John"},de:{abbr:"3 Joh",name:"3 Johannes"},pl:{abbr:"3 J",name:"3 List św. Jana"}},{id:"iud",la:{abbr:"Iud",name:"Iudae"},en:{abbr:"Jude",name:"Jude"},de:{abbr:"Jud",name:"Judas"},pl:{abbr:"Jud",name:"List św. Judy"}},{id:"apoc",la:{abbr:"Apoc",name:"Apocalypsis Ioannis"},en:{abbr:"Rev",name:"Revelation"},de:{abbr:"Offb",name:"Offenbarung"},pl:{abbr:"Ap",name:"Apokalipsa św. Jana"}}],$r=8;function Er({libraryId:a,copy:n,language:s,sourceKindOptions:g,value:h,onChange:v,labels:x}){const[A,O]=i.useState(!1),[q,l]=i.useState(-1),I=i.useMemo(()=>{const G=s;return Ft.map(W=>{var p;const d=(W==null?void 0:W[G])??(W==null?void 0:W.en)??(W==null?void 0:W.la);return{label:`${d.abbr} — ${d.name}`,latin:((p=W==null?void 0:W.la)==null?void 0:p.abbr)??d.abbr}})},[s]),m=(G,W=!1)=>{const d=G.trim().toLowerCase();return d?I.filter(b=>b.label.toLowerCase().includes(d)).slice(0,$r):W?I.slice(0,$r):[]},j=(G,W)=>{const d=G.trim().toLowerCase();if(!d)return null;const b=Ft;for(const p of b){const ne=p==null?void 0:p.la,F=(p==null?void 0:p[W])??(p==null?void 0:p.en)??ne,k=(F==null?void 0:F.abbr)??"",Q=(F==null?void 0:F.name)??"";if(k.toLowerCase()===d||Q.toLowerCase()===d||`${k} — ${Q}`.toLowerCase()===d)return{book:p,entry:F,la:ne}}return null};i.useEffect(()=>{if(h.sourceKind==="bible"&&h.locatorValue&&!A){const G=j(h.locatorValue,s);if(G){const W=`${G.entry.abbr} — ${G.entry.name}`;W!==h.bibleBookDisplay&&v({...h,bibleBookDisplay:W})}}},[s,h,A,v]);const U=G=>v({...h,...G});return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.sourceKindLabel}),e.jsx("select",{value:h.sourceKind,onChange:G=>U({sourceKind:G.target.value,churchDocument:null,bookMedia:null,work:null,locatorValue:"",locatorAux:"",bibleBookDisplay:""}),children:g.map(G=>e.jsx("option",{value:G.value,children:G.label},G.value))})]}),h.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.bibleBookLabel}),e.jsx("input",{type:"text",value:h.bibleBookDisplay,onChange:G=>{const W=G.target.value;U({bibleBookDisplay:W,locatorValue:""}),O(!0),l(-1)},onKeyDown:G=>{var d;const W=m(h.bibleBookDisplay);if(W.length){if(G.key==="ArrowDown")G.preventDefault(),l(b=>Math.min(b+1,W.length-1));else if(G.key==="ArrowUp")G.preventDefault(),l(b=>Math.max(b-1,0));else if((G.key==="Enter"||G.key==="Tab")&&q>=0&&W[q]){const b=W[q],p=j(b.label,s);if(!p)return;U({bibleBookDisplay:b.label,locatorValue:((d=p.la)==null?void 0:d.abbr)??h.locatorValue}),O(!1)}}},onFocus:()=>O(!0),onBlur:()=>window.setTimeout(()=>O(!1),100),placeholder:x.bibleBookPlaceholder})]}),A&&m(h.bibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:m(h.bibleBookDisplay,!0).map((G,W)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":W===q,tabIndex:-1,onMouseDown:()=>{var b;const d=j(G.label,s);d&&U({bibleBookDisplay:G.label,locatorValue:((b=d.la)==null?void 0:b.abbr)??h.locatorValue})},children:e.jsx("strong",{children:G.label})},G.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.bibleRestLabel}),e.jsx("input",{type:"text",value:h.locatorAux,onChange:G=>U({locatorAux:G.target.value}),placeholder:x.bibleRestPlaceholder})]})]}),h.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:h.sourceUrl,onChange:G=>U({sourceUrl:G.target.value}),placeholder:n.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:n.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:h.sourceAccessedDate,onChange:G=>U({sourceAccessedDate:G.target.value}),placeholder:n.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),h.sourceKind==="number_document"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:a,infoType:"work",label:x.churchDocumentLabel,placeholder:x.churchDocumentPlaceholder,value:h.churchDocument,onChange:G=>U({churchDocument:G}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:h.locatorValue,onChange:G=>U({locatorValue:G.target.value}),placeholder:x.locatorPlaceholder})]})]}),h.sourceKind==="work"&&e.jsx(Oe,{libraryId:a,infoType:"work",label:x.workLabel,placeholder:x.workPlaceholder,value:h.work,onChange:G=>U({work:G}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.work),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),h.sourceKind==="book"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:a,infoType:"media",label:x.bookLabel,placeholder:x.bookPlaceholder,value:h.bookMedia,onChange:G=>U({bookMedia:G}),searchFailedText:n.cogita.library.lookup.searchFailed,createFailedText:n.cogita.library.lookup.createFailed,createLabel:n.cogita.library.lookup.createNew.replace("{type}",n.cogita.library.infoTypes.media),savingLabel:n.cogita.library.lookup.saving,loadMoreLabel:n.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:h.locatorValue,onChange:G=>U({locatorValue:G.target.value}),placeholder:x.locatorPlaceholder})]})]}),h.sourceKind!=="website"&&h.sourceKind!=="bible"&&h.sourceKind!=="book"&&h.sourceKind!=="number_document"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:x.locatorLabel}),e.jsx("input",{type:"text",value:h.locatorValue,onChange:G=>U({locatorValue:G.target.value}),placeholder:x.locatorPlaceholder})]})]})}const Xi=[],Zi=[];function en({data:a}){const n=a.value!==void 0&&a.value!==null&&(typeof a.value=="string"?a.value.trim()!=="":Number.isFinite(a.value)),s=a.subtitle&&(!a.title||a.subtitle.trim().toLowerCase()!==a.title.trim().toLowerCase()),g=a.handles.length,h=g>1?(g-1)*18:0;return e.jsxs("div",{className:"cogita-graph-node",style:{minHeight:96+h,paddingBottom:12+h*.4},children:[e.jsxs("div",{className:"cogita-graph-node-labels",children:[e.jsx("strong",{children:a.title}),s?e.jsx("span",{children:a.subtitle}):null]}),a.name?e.jsx("div",{className:"cogita-graph-node-meta",children:a.name}):null,a.outputLabel?e.jsx("div",{className:"cogita-graph-node-meta",children:a.outputLabel}):null,n?e.jsx("div",{className:"cogita-graph-node-value",children:a.value}):null,a.handles.map((v,x)=>e.jsx(Lr,{type:"target",id:v.id,position:Cr.Left,style:{top:46+x*28},children:v.id!=="in"?e.jsx("span",{className:"cogita-graph-handle-label",children:v.label}):null},v.id)),a.output!==!1?e.jsx(Lr,{type:"source",id:"out",position:Cr.Right}):null]})}function an({copy:a,value:n,onChange:s}){var Ke,Fe,Ue,ra,Ie,_,te,Be,Ce,be,$e,De,qe,Ve;const g=i.useMemo(()=>({"input.random":{label:a.cogita.library.graph.nodeTypes.inputRandom,handles:[],output:!0},"input.const":{label:a.cogita.library.graph.nodeTypes.inputConst,handles:[],output:!0},"input.list":{label:a.cogita.library.graph.nodeTypes.inputList,handles:[{id:"index",label:a.cogita.library.graph.handleLabels.index,limitOne:!0}],output:!0},"compute.add":{label:a.cogita.library.graph.nodeTypes.add,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.sub":{label:a.cogita.library.graph.nodeTypes.sub,handles:[{id:"add",label:a.cogita.library.graph.handleLabels.add},{id:"sub",label:a.cogita.library.graph.handleLabels.sub}],output:!0},"compute.mul":{label:a.cogita.library.graph.nodeTypes.mul,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.div":{label:a.cogita.library.graph.nodeTypes.div,handles:[{id:"num",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"den",label:a.cogita.library.graph.handleLabels.denominator}],output:!0},"compute.pow":{label:a.cogita.library.graph.nodeTypes.pow,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.exp":{label:a.cogita.library.graph.nodeTypes.exp,handles:[{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0},{id:"exp",label:a.cogita.library.graph.handleLabels.exponent,limitOne:!0}],output:!0},"compute.log":{label:a.cogita.library.graph.nodeTypes.log,handles:[{id:"value",label:a.cogita.library.graph.handleLabels.value,limitOne:!0},{id:"base",label:a.cogita.library.graph.handleLabels.base,limitOne:!0}],output:!0},"compute.abs":{label:a.cogita.library.graph.nodeTypes.abs,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.min":{label:a.cogita.library.graph.nodeTypes.min,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.max":{label:a.cogita.library.graph.nodeTypes.max,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input}],output:!0},"compute.floor":{label:a.cogita.library.graph.nodeTypes.floor,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.ceil":{label:a.cogita.library.graph.nodeTypes.ceil,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.round":{label:a.cogita.library.graph.nodeTypes.round,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0}],output:!0},"compute.mod":{label:a.cogita.library.graph.nodeTypes.mod,handles:[{id:"a",label:a.cogita.library.graph.handleLabels.numerator,limitOne:!0},{id:"b",label:a.cogita.library.graph.handleLabels.denominator,limitOne:!0}],output:!0},"compute.concat":{label:a.cogita.library.graph.nodeTypes.concat,handles:[{id:"in1",label:"1",limitOne:!0},{id:"in2",label:"2",limitOne:!0},{id:"in3",label:"3",limitOne:!0},{id:"in4",label:"4",limitOne:!0},{id:"in5",label:"5",limitOne:!0},{id:"in6",label:"6",limitOne:!0}],output:!0},"compute.trim":{label:a.cogita.library.graph.nodeTypes.trim,handles:[{id:"text",label:a.cogita.library.graph.handleLabels.text,limitOne:!0},{id:"start",label:a.cogita.library.graph.handleLabels.start,limitOne:!0},{id:"end",label:a.cogita.library.graph.handleLabels.end,limitOne:!0}],output:!0},output:{label:a.cogita.library.graph.nodeTypes.output,handles:[{id:"in",label:a.cogita.library.graph.handleLabels.input,limitOne:!0},{id:"name",label:a.cogita.library.graph.handleLabels.name,limitOne:!0}],output:!1}}),[a]),h=y=>!y||y.nodes.length===0?Xi:y.nodes.map((N,Y)=>{var t,r,u,T;return{id:N.id,type:"computed",position:N.position??{x:40+Y*160,y:60+Y%3*80},data:{title:N.name||((t=g[N.type])==null?void 0:t.label)||N.type,subtitle:((r=g[N.type])==null?void 0:r.label)||N.type,type:N.type,name:N.name,outputLabel:N.outputLabel,min:N.min,max:N.max,value:N.type==="input.const"?N.value:void 0,list:N.list,handles:((u=g[N.type])==null?void 0:u.handles)??[],output:((T=g[N.type])==null?void 0:T.output)??!0}}}),v=y=>{if(!y||y.nodes.length===0)return Zi;const N=new Set(y.nodes.map(r=>r.id)),Y=[];let t=0;return y.nodes.forEach(r=>{const u=r.inputsByHandle??(r.inputs?{in:r.inputs}:{});Object.entries(u).forEach(([T,K])=>{K.forEach(re=>{N.has(re)&&Y.push({id:`${r.id}-${T}-${re}-${t++}`,source:re,target:r.id,targetHandle:T==="in"?void 0:T})})})}),Y},x=i.useMemo(()=>h(n),[n,g]),A=i.useMemo(()=>v(n),[n]),O=(y,N)=>{if(!y)return"null";const Y=y.nodes.map(r=>{const u=(r.list??[]).join(","),T=r.inputs?r.inputs.join(","):"",K=r.inputsByHandle?Object.entries(r.inputsByHandle).map(([le,ee])=>`${le}:${[...ee].sort().join(",")}`).sort().join("|"):"",re=N&&r.position?`${r.position.x},${r.position.y}`:"";return[r.id,r.type,r.name??"",r.outputLabel??"",r.min??"",r.max??"",u,T,K,re].join(":")}).sort().join("||"),t=y.outputs?[...y.outputs].sort().join(","):y.output??"";return`${Y}::${t}`},q=i.useMemo(()=>{var N;const y=!!((N=n==null?void 0:n.nodes)!=null&&N.some(Y=>!!Y.position));return O(n,y)},[n]),[l,I]=i.useState(x),[m,j]=i.useState(A),[U,G]=i.useState(null),[W,d]=i.useState([]),[b,p]=i.useState(null),[ne,F]=i.useState(null),[k,Q]=i.useState({}),[R,oe]=i.useState(0),B=i.useRef(s),D=i.useRef(q),pe=i.useRef(q),ke=i.useRef(O(n,!1)),ce=i.useMemo(()=>U?l.find(y=>y.id===U)??null:null,[l,U]),V=i.useMemo(()=>{const y=["in1","in2","in3","in4","in5","in6"],N=new Map;return m.forEach(Y=>{if(!Y.target)return;const t=Y.targetHandle??"in1";N.has(Y.target)||N.set(Y.target,new Set),N.get(Y.target).add(t)}),l.map(Y=>{var t;if(((t=Y.data)==null?void 0:t.type)==="compute.concat"){const r=N.get(Y.id)??new Set,u=[];let T=!1;return y.forEach(K=>{var re,le;if(r.has(K)||!T){const ee=(le=(re=g["compute.concat"])==null?void 0:re.handles)==null?void 0:le.find(de=>de.id===K);ee&&u.push(ee),r.has(K)||(T=!0)}}),{...Y,selected:Y.id===U,data:{...Y.data,handles:u}}}return{...Y,selected:Y.id===U}})},[l,U,m,g]);i.useEffect(()=>{p(null),F(null)},[U]),i.useEffect(()=>{if(W.length===0)return;const y=N=>{if(N.key!=="Delete"&&N.key!=="Backspace")return;const Y=N.target;Y&&(Y.tagName==="INPUT"||Y.tagName==="TEXTAREA"||Y.isContentEditable)||(N.preventDefault(),j(t=>t.filter(r=>!W.includes(r.id))),d([]))};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[W,j]),i.useEffect(()=>{B.current=s},[s]),i.useEffect(()=>{if(D.current!==q){if(pe.current===q||ke.current===q){D.current=q;return}D.current=q,I(x),j(A),G(null),p(null),F(null),Q({}),oe(y=>y+1)}},[x,A,j,I,q]),i.useEffect(()=>{const y=l.filter(u=>{var T;return((T=u.data)==null?void 0:T.type)==="output"}).map(u=>u.id).sort(),N=new Map;m.forEach(u=>{let T=N.get(u.target);T||(T={},N.set(u.target,T));const K=u.targetHandle||"in";T[K]||(T[K]=[]),T[K].push(u.source)}),N.forEach(u=>{Object.values(u).forEach(T=>T.sort())});const Y={nodes:l.map(u=>{var T,K,re,le,ee,de,se,ve,Xe;return{id:u.id,type:((T=u.data)==null?void 0:T.type)??"compute.add",position:u.position,name:(K=u.data)==null?void 0:K.name,outputLabel:(re=u.data)==null?void 0:re.outputLabel,min:(le=u.data)==null?void 0:le.min,max:(ee=u.data)==null?void 0:ee.max,value:((de=u.data)==null?void 0:de.type)==="input.const"?(se=u.data)==null?void 0:se.value:void 0,list:(ve=u.data)==null?void 0:ve.list,inputs:(Xe=N.get(u.id))==null?void 0:Xe.in,inputsByHandle:N.get(u.id)}}),output:y[0]??null,outputs:y},t=O(Y,!0),r=O(Y,!1);t===pe.current||r===ke.current||(pe.current=t,ke.current=r,B.current(Y))},[l,m]),i.useEffect(()=>{const y={};let N=!1;l.forEach(Y=>{var K,re,le,ee,de;if(((K=Y.data)==null?void 0:K.type)!=="input.random")return;if(k[Y.id]!==void 0){y[Y.id]=k[Y.id];return}const t=Number.isFinite((re=Y.data)==null?void 0:re.min)?Number((le=Y.data)==null?void 0:le.min):0,r=Number.isFinite((ee=Y.data)==null?void 0:ee.max)?Number((de=Y.data)==null?void 0:de.max):t+10,u=Math.min(t,r),T=Math.max(t,r);y[Y.id]=Math.floor(Math.random()*(T-u+1))+u,N=!0}),(N||Object.keys(y).length!==Object.keys(k).length)&&Q(y)},[l,k,R]);const he=i.useMemo(()=>l.map(N=>{var t,r,u,T,K;const Y=(((t=N.data)==null?void 0:t.list)??[]).join(",");return[N.id,((r=N.data)==null?void 0:r.type)??"",((u=N.data)==null?void 0:u.name)??"",((T=N.data)==null?void 0:T.min)??"",((K=N.data)==null?void 0:K.max)??"",Y].join(":")}).sort().join("|"),[l]),o=i.useMemo(()=>m.map(N=>`${N.source}:${N.target}:${N.targetHandle??""}`).sort().join("|"),[m]),X=i.useMemo(()=>{const y=new Map(l.map(le=>[le.id,le])),N=new Map;m.forEach(le=>{let ee=N.get(le.target);ee||(ee={},N.set(le.target,ee));const de=le.targetHandle||"in";ee[de]||(ee[de]=[]),ee[de].push(le.source)});const Y=new Map,t=new Set,r=le=>{if(typeof le=="number")return le;if(typeof le=="string"){const ee=Number(le);return Number.isFinite(ee)?ee:0}return 0},u=(le,ee)=>{var de,se;return ee?((de=N.get(le.id))==null?void 0:de[ee])??[]:((se=N.get(le.id))==null?void 0:se.in)??[]},T=(le,ee)=>u(le,ee).map(de=>r(re(de))),K=(le,ee)=>u(le,ee).map(de=>re(de)),re=le=>{var ve,Xe,Qe,Ze;if(Y.has(le))return Y.get(le);if(t.has(le))return 0;const ee=y.get(le);if(!ee)return 0;t.add(le);const de=((ve=ee.data)==null?void 0:ve.type)??"";let se=0;switch(de){case"input.random":{se=k[le]??0;break}case"input.const":{se=Number.isFinite((Xe=ee.data)==null?void 0:Xe.value)?Number((Qe=ee.data)==null?void 0:Qe.value):0;break}case"input.list":{const P=(((Ze=ee.data)==null?void 0:Ze.list)??[]).filter(Boolean),Le=Math.round(T(ee,"index")[0]??0);se=(P.length?P[Math.max(0,Math.min(P.length-1,Le))]:"")||String(Le);break}case"compute.add":{se=T(ee,"in").reduce((P,Le)=>P+Le,0);break}case"compute.sub":{se=T(ee,"add").reduce((P,Le)=>P+Le,0)-T(ee,"sub").reduce((P,Le)=>P+Le,0);break}case"compute.mul":{const P=T(ee,"in");se=P.length?P.reduce((Le,we)=>Le*we,1):0;break}case"compute.div":{const P=T(ee,"num")[0]??0,Le=T(ee,"den").reduce((we,_e)=>we+_e,0);se=Math.abs(Le)<Number.EPSILON?0:P/Le;break}case"compute.pow":{const P=T(ee,"base")[0]??0,Le=T(ee,"exp")[0]??0;se=Math.pow(P,Le);break}case"compute.exp":{const P=T(ee,"base")[0]??0,Le=T(ee,"exp")[0]??0;se=Math.pow(P,Le);break}case"compute.log":{const P=T(ee,"value")[0]??0,Le=T(ee,"base")[0]??0,we=Math.max(P,Number.EPSILON);se=Math.abs(Le)<Number.EPSILON?Math.log(we):Math.log(we)/Math.log(Le);break}case"compute.abs":{se=Math.abs(T(ee,"in")[0]??0);break}case"compute.min":{const P=T(ee,"in");se=P.length?Math.min(...P):0;break}case"compute.max":{const P=T(ee,"in");se=P.length?Math.max(...P):0;break}case"compute.floor":{se=Math.floor(T(ee,"in")[0]??0);break}case"compute.ceil":{se=Math.ceil(T(ee,"in")[0]??0);break}case"compute.round":{se=Math.round(T(ee,"in")[0]??0);break}case"compute.mod":{const P=T(ee,"a")[0]??0,Le=T(ee,"b")[0]??0;se=Math.abs(Le)<Number.EPSILON?0:P%Le;break}case"compute.concat":{const Le=["in1","in2","in3","in4","in5","in6"].flatMap(ze=>K(ee,ze)),we=Le.length?Le:K(ee,"in");se=(we.length?we:K(ee)).map(ze=>ze==null?"":String(ze)).join("");break}case"compute.trim":{const P=K(ee,"text")[0]??K(ee,"in")[0]??"",Le=P==null?"":String(P),we=Math.max(0,Math.round(T(ee,"start")[0]??0)),_e=Math.max(0,Math.round(T(ee,"end")[0]??0));se=we+_e>=Le.length?"":Le.substring(we,Le.length-_e);break}case"output":{const P=u(ee,"in")[0];se=P?re(P):0;break}default:se=0}return t.delete(le),Y.set(le,se),se};return l.forEach(le=>re(le.id)),Y},[he,o,k]),w=i.useRef(X);i.useEffect(()=>{w.current=X},[X]);const M=i.useCallback(y=>{const N=w.current.get(y.id);return e.jsx(en,{data:{...y.data,value:N}})},[]),ye=i.useMemo(()=>({computed:M}),[M]),ie=y=>{var r;if(!y.target||!y.targetHandle){j(u=>jt(y,u));return}const N=l.find(u=>u.id===y.target),Y=N?g[((r=N.data)==null?void 0:r.type)??""]:null,t=Y==null?void 0:Y.handles.find(u=>u.id===y.targetHandle);j(u=>{let T=u;return t!=null&&t.limitOne&&(T=u.filter(K=>!(K.target===y.target&&K.targetHandle===y.targetHandle))),jt(y,T)})},ae=y=>{const N=crypto.randomUUID(),Y=g[y]??{label:y,handles:[]},t=Y.label;I(r=>[...r,{id:N,type:"computed",position:{x:80+r.length*40,y:80+r.length*30},data:{title:t,subtitle:Y.label,type:y,name:"",handles:Y.handles,list:y==="input.list"?[]:void 0,output:Y.output??!0}}])},Ne=y=>{if(U){if(y.name!==void 0){const N=y.name.trim(),Y=N===""||/^[A-Za-z][A-Za-z0-9_]*$/.test(N);if(F(Y?null:a.cogita.library.graph.invalidName),!N)p(null);else{const t=l.find(r=>{var u;return r.id!==U&&((u=r.data)==null?void 0:u.name)&&r.data.name.trim().toLowerCase()===N.toLowerCase()});p(t?a.cogita.library.graph.duplicateName:null)}}I(N=>N.map(Y=>{var t,r,u,T;return Y.id===U?{...Y,data:{...Y.data,...y,title:y.name?y.name:(t=Y.data)==null?void 0:t.title,subtitle:((u=g[y.type??((r=Y.data)==null?void 0:r.type)??""])==null?void 0:u.label)??((T=Y.data)==null?void 0:T.subtitle)}}:Y}))}},Ee=()=>{U&&(I(y=>y.filter(N=>N.id!==U)),j(y=>y.filter(N=>N.source!==U&&N.target!==U)),Q(y=>{const N={...y};return delete N[U],N}),G(null),p(null))},Me=i.useRef({nodeId:null,edgeIds:[]}),Ae=y=>{var T;const N=((T=y.nodes[0])==null?void 0:T.id)??null,Y=y.edges.map(K=>K.id),t=Me.current,r=t.nodeId===N,u=t.edgeIds.length===Y.length&&t.edgeIds.every((K,re)=>K===Y[re]);r&&u||(Me.current={nodeId:N,edgeIds:Y},G(N),d(Y))},Se=y=>{const N=y.filter(Y=>Y.type!=="select"&&Y.type!=="dimensions");N.length!==0&&I(Y=>si(N,Y))},Je=y=>{const N=y.filter(Y=>Y.type!=="select");N.length!==0&&j(Y=>oi(N,Y))};return e.jsxs("div",{className:"cogita-collection-graph cogita-computed-graph",children:[e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Ut,{nodeTypes:ye,nodes:V,edges:m,onNodesChange:Se,onEdgesChange:Je,onConnect:ie,onNodeClick:(y,N)=>G(N.id),onSelectionChange:Ae,nodesDraggable:!0,nodesConnectable:!0,elementsSelectable:!0,fitView:!0,children:[e.jsx(Wt,{gap:18,size:1}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-collection-graph-sidebar",children:[e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.palette}),e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("button",{type:"button",onClick:()=>ae("input.random"),children:a.cogita.library.graph.nodeTypes.inputRandom}),e.jsx("button",{type:"button",onClick:()=>ae("input.const"),children:a.cogita.library.graph.nodeTypes.inputConst}),e.jsx("button",{type:"button",onClick:()=>ae("input.list"),children:a.cogita.library.graph.nodeTypes.inputList}),e.jsx("button",{type:"button",onClick:()=>ae("compute.add"),children:a.cogita.library.graph.nodeTypes.add}),e.jsx("button",{type:"button",onClick:()=>ae("compute.sub"),children:a.cogita.library.graph.nodeTypes.sub}),e.jsx("button",{type:"button",onClick:()=>ae("compute.mul"),children:a.cogita.library.graph.nodeTypes.mul}),e.jsx("button",{type:"button",onClick:()=>ae("compute.div"),children:a.cogita.library.graph.nodeTypes.div}),e.jsx("button",{type:"button",onClick:()=>ae("compute.pow"),children:a.cogita.library.graph.nodeTypes.pow}),e.jsx("button",{type:"button",onClick:()=>ae("compute.exp"),children:a.cogita.library.graph.nodeTypes.exp}),e.jsx("button",{type:"button",onClick:()=>ae("compute.log"),children:a.cogita.library.graph.nodeTypes.log}),e.jsx("button",{type:"button",onClick:()=>ae("compute.abs"),children:a.cogita.library.graph.nodeTypes.abs}),e.jsx("button",{type:"button",onClick:()=>ae("compute.min"),children:a.cogita.library.graph.nodeTypes.min}),e.jsx("button",{type:"button",onClick:()=>ae("compute.max"),children:a.cogita.library.graph.nodeTypes.max}),e.jsx("button",{type:"button",onClick:()=>ae("compute.floor"),children:a.cogita.library.graph.nodeTypes.floor}),e.jsx("button",{type:"button",onClick:()=>ae("compute.ceil"),children:a.cogita.library.graph.nodeTypes.ceil}),e.jsx("button",{type:"button",onClick:()=>ae("compute.round"),children:a.cogita.library.graph.nodeTypes.round}),e.jsx("button",{type:"button",onClick:()=>ae("compute.mod"),children:a.cogita.library.graph.nodeTypes.mod}),e.jsx("button",{type:"button",onClick:()=>ae("compute.concat"),children:a.cogita.library.graph.nodeTypes.concat}),e.jsx("button",{type:"button",onClick:()=>ae("compute.trim"),children:a.cogita.library.graph.nodeTypes.trim}),e.jsx("button",{type:"button",onClick:()=>ae("output"),children:a.cogita.library.graph.nodeTypes.output})]})]}),e.jsxs("div",{className:"cogita-graph-section",children:[e.jsx("p",{className:"cogita-graph-section-title",children:a.cogita.library.graph.inspector}),ce?e.jsxs("div",{className:"cogita-graph-inspector",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.nameLabel}),e.jsx("input",{type:"text",value:((Ke=ce.data)==null?void 0:Ke.name)??"",placeholder:a.cogita.library.graph.namePlaceholder,onChange:y=>Ne({name:y.target.value})}),b?e.jsx("em",{className:"cogita-help",children:b}):null,ne?e.jsx("em",{className:"cogita-help",children:ne}):null,e.jsx("em",{className:"cogita-help",children:a.cogita.library.graph.nameHint})]}),e.jsxs("p",{className:"cogita-graph-readonly",children:[a.cogita.library.graph.typeLabel," ",((Ue=g[((Fe=ce.data)==null?void 0:Fe.type)??""])==null?void 0:Ue.label)??((ra=ce.data)==null?void 0:ra.type)]}),((Ie=ce.data)==null?void 0:Ie.type)==="output"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.outputLabel}),e.jsx("input",{type:"text",value:((_=ce.data)==null?void 0:_.outputLabel)??"",onChange:y=>Ne({outputLabel:y.target.value}),placeholder:a.cogita.library.graph.outputPlaceholder})]}),((te=ce.data)==null?void 0:te.type)==="input.random"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Min"}),e.jsx("input",{type:"number",value:((Be=ce.data)==null?void 0:Be.min)??0,onChange:y=>Ne({min:Number(y.target.value)})})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Max"}),e.jsx("input",{type:"number",value:((Ce=ce.data)==null?void 0:Ce.max)??10,onChange:y=>Ne({max:Number(y.target.value)})})]})]}),((be=ce.data)==null?void 0:be.type)==="input.const"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:"Value"}),e.jsx("input",{type:"number",value:(($e=ce.data)==null?void 0:$e.value)??0,onChange:y=>Ne({value:Number(y.target.value)})})]}),((De=ce.data)==null?void 0:De.type)==="input.list"&&e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.listLabel}),e.jsx("textarea",{value:(((qe=ce.data)==null?void 0:qe.list)??[]).join(`
`),onChange:y=>Ne({list:y.target.value.split(`
`).map(N=>N.replace(/\r$/,"")).filter(N=>N.length>0)}),placeholder:a.cogita.library.graph.listPlaceholder})]}),((Ve=ce.data)==null?void 0:Ve.type)==="input.random"&&e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:()=>{U&&(Q(y=>{var u,T,K,re;const N=Number.isFinite((u=ce.data)==null?void 0:u.min)?Number((T=ce.data)==null?void 0:T.min):0,Y=Number.isFinite((K=ce.data)==null?void 0:K.max)?Number((re=ce.data)==null?void 0:re.max):N+10,t=Math.min(N,Y),r=Math.max(N,Y);return{...y,[U]:Math.floor(Math.random()*(r-t+1))+t}}),oe(y=>y+1))},children:a.cogita.library.graph.regenerateRandom})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:Ee,children:a.cogita.library.graph.deleteNode})})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})]})}const nr=a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function jr(a,n,s){if(!a)return null;const g=new Map(a.nodes.map(F=>[F.id,F])),h=new Map,v=new Set,x=F=>{if(typeof F=="number")return F;if(typeof F=="string"){const k=Number(F);return Number.isFinite(k)?k:0}return 0},A=F=>{if(h.has(F))return h.get(F);if(v.has(F))return 0;const k=g.get(F);if(!k)return 0;v.add(F);const Q=oe=>{var D,pe;return(oe?((D=k.inputsByHandle)==null?void 0:D[oe])??[]:k.inputs??((pe=k.inputsByHandle)==null?void 0:pe.in)??[]).map(ke=>A(ke))};let R=0;switch(k.type){case"input.random":{const oe=k.min??0,B=k.max??oe+10,D=Math.min(oe,B),pe=Math.max(oe,B);R=Math.floor(Math.random()*(pe-D+1))+D;break}case"input.const":{R=k.value??0;break}case"input.list":{const oe=(k.list??[]).filter(Boolean),B=Math.round(x(Q("index")[0]));R=oe.length?oe[Math.max(0,Math.min(oe.length-1,B))]:String(B);break}case"compute.add":{R=Q("in").map(B=>x(B)).reduce((B,D)=>B+D,0);break}case"compute.sub":{const oe=Q("add").map(D=>x(D)),B=Q("sub").map(D=>x(D));R=oe.reduce((D,pe)=>D+pe,0)-B.reduce((D,pe)=>D+pe,0);break}case"compute.mul":{const oe=Q("in").map(B=>x(B));R=oe.length?oe.reduce((B,D)=>B*D,1):0;break}case"compute.div":{const oe=x(Q("num")[0]),B=Q("den").map(D=>x(D)).reduce((D,pe)=>D+pe,0);R=Math.abs(B)<Number.EPSILON?0:oe/B;break}case"compute.pow":{const oe=x(Q("base")[0]),B=x(Q("exp")[0]);R=Math.pow(oe,B);break}case"compute.exp":{const oe=x(Q("base")[0]),B=x(Q("exp")[0]);R=Math.pow(oe,B);break}case"compute.log":{const oe=x(Q("value")[0]),B=x(Q("base")[0]),D=Math.max(oe,Number.EPSILON);R=Math.abs(B)<Number.EPSILON?Math.log(D):Math.log(D)/Math.log(B);break}case"compute.abs":{R=Math.abs(x(Q("in")[0]));break}case"compute.min":{const oe=Q("in").map(B=>x(B));R=oe.length?Math.min(...oe):0;break}case"compute.max":{const oe=Q("in").map(B=>x(B));R=oe.length?Math.max(...oe):0;break}case"compute.floor":{R=Math.floor(x(Q("in")[0]));break}case"compute.ceil":{R=Math.ceil(x(Q("in")[0]));break}case"compute.round":{R=Math.round(x(Q("in")[0]));break}case"compute.mod":{const oe=x(Q("a")[0]),B=x(Q("b")[0]);R=Math.abs(B)<Number.EPSILON?0:oe%B;break}case"compute.concat":{const B=["in1","in2","in3","in4","in5","in6"].flatMap(ce=>Q(ce)),D=B.length?B:Q("in");R=(D.length?D:Q()).map(ce=>ce==null?"":String(ce)).join("");break}case"compute.trim":{const oe=Q("text")[0]??Q("in")[0]??"",B=oe==null?"":String(oe),D=Math.max(0,Math.round(x(Q("start")[0]))),pe=Math.max(0,Math.round(x(Q("end")[0])));D+pe>=B.length?R="":R=B.substring(D,B.length-pe);break}case"output":{R=Q("in")[0]??0;break}default:R=0}return v.delete(F),h.set(F,R),R},O=a.outputs&&a.outputs.length>0?a.outputs:a.output?[a.output]:a.nodes.filter(F=>F.type==="output").map(F=>F.id);a.nodes.forEach(F=>A(F.id)),O.forEach(F=>A(F));const q=F=>Math.abs(F%1)<1e-5?String(Math.round(F)):F.toFixed(3).replace(/\.?0+$/,""),l=F=>typeof F=="number"?q(F):F??"",I=new Map;O.forEach(F=>{var B,D,pe,ke;const k=g.get(F);if(!k)return;const Q=(D=(B=k.inputsByHandle)==null?void 0:B.name)==null?void 0:D[0],R=Q?l(h.get(Q)):"",oe=(R==null?void 0:R.toString().trim())||((pe=k.outputLabel)==null?void 0:pe.trim())||((ke=k.name)==null?void 0:ke.trim())||F;I.set(F,oe)});const m={},j={},U={};O.forEach(F=>{var R,oe;const k=g.get(F);if(!k)return;const Q=I.get(F)??(((R=k.outputLabel)==null?void 0:R.trim())||((oe=k.name)==null?void 0:oe.trim())||F);m[Q]=l(h.get(F)),k.name&&(j[k.name.trim()]=Q),j[F]=Q});const G=(F,k)=>{let Q=F;return a.nodes.forEach(R=>{var ke,ce;const oe=l(h.get(R.id)),B=O.includes(R.id),D=B?I.get(R.id)??((ke=R.outputLabel)==null?void 0:ke.trim())??((ce=R.name)==null?void 0:ce.trim())??R.id:"",pe=B&&k?D:oe;Q=Q.replace(new RegExp(`\\{\\s*${nr(R.id)}\\s*\\}`,"gi"),pe),R.name&&(Q=Q.replace(new RegExp(`\\{\\s*${nr(R.name)}\\s*\\}`,"gi"),pe)),B&&R.outputLabel&&(Q=Q.replace(new RegExp(`\\{\\s*${nr(R.outputLabel)}\\s*\\}`,"gi"),D))}),Q},W=n;let d=W.trim().length>0?W:"";d||(d=O.length?`Compute ${O.join(", ")}`:"Compute"),d=G(d,!0);const b=(s==null?void 0:s.trim())??"",p=b?G(b,!1):"",ne={};return h.forEach((F,k)=>{ne[k]=F,U[k]=l(F);const Q=g.get(k);Q!=null&&Q.name&&(U[Q.name.trim()]=l(F))}),{prompt:d,answers:m,values:ne,answerText:p,outputVariables:j,variableValues:U}}function Yr(a){var s;const n=Object.entries(a.answers);return{prompt:a.prompt,expectedAnswer:a.answerText??((s=n[0])==null?void 0:s[1])??"",expectedAnswers:a.answers,values:a.values,expectedAnswerIsSentence:!!(a.answerText&&a.answerText.trim().length>0),outputVariables:a.outputVariables,variableValues:a.variableValues}}function tn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l,editInfoId:I}){const{libraryName:m}=Ua(l),j=!!I,U=`/#/cogita/library/${l}`,[G,W]=i.useState("info"),[d,b]=i.useState({infoType:"word",label:"",language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:"work",sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",referenceEnabled:!1,referenceSourceKind:"string",referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:"",referenceSourceUrl:"",referenceSourceAccessedDate:"",referenceChurchDocument:null,referenceBookMedia:null,referenceWork:null}),[p,ne]=i.useState(""),[F,k]=i.useState(null),[Q,R]=i.useState(null),[oe,B]=i.useState("idle"),[D,pe]=i.useState(null),[ke,ce]=i.useState(-1),[V,he]=i.useState({connectionType:"translation",language:null,word:null,wordA:null,wordB:null,sentence:null,topic:null,quote:null,source:null,referencedInfoType:"word",referencedInfo:null,work:null,contributorType:"person",contributor:null,contributorRole:"",medium:null,orcidEntityType:"person",orcidEntity:null,orcid:null,sourceResourceType:"work",sourceResource:null,note:""}),[o,X]=i.useState({groupType:"vocab",languageA:null,wordA:null,languageB:null,wordB:null,wordATags:[],wordBTags:[],translationTags:[],citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:!1,citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:null,citationBookMedia:null,citationWork:null,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}),[w,M]=i.useState(null),[ye,ie]=i.useState("idle"),[ae,Ne]=i.useState(null),[Ee,Me]=i.useState(null),[Ae,Se]=i.useState(null),Je=i.useRef(null),Ke=i.useRef(null),Fe=i.useRef(null),Ue=i.useMemo(()=>Jr(a),[a]),ra=i.useMemo(()=>Ji(a),[a]),Ie=i.useMemo(()=>Yi(a),[a]),_=i.useMemo(()=>[{value:"string",label:"String"},{value:"book",label:"Book"},{value:"website",label:"Website"},{value:"bible",label:"Bible"},{value:"number_document",label:"Numbered document"},{value:"work",label:a.cogita.library.infoTypes.work},{value:"other",label:"Other"}],[a]),te=i.useMemo(()=>({sourceKindLabel:a.cogita.library.add.group.citationSourceKindLabel,bibleBookLabel:a.cogita.library.add.group.citationBibleBookLabel,bibleBookPlaceholder:a.cogita.library.add.group.citationBibleBookPlaceholder,bibleRestLabel:a.cogita.library.add.group.citationBibleRestLabel,bibleRestPlaceholder:a.cogita.library.add.group.citationBibleRestPlaceholder,churchDocumentLabel:a.cogita.library.add.group.citationChurchDocumentLabel,churchDocumentPlaceholder:a.cogita.library.add.group.citationChurchDocumentPlaceholder,workLabel:a.cogita.library.add.group.citationWorkLabel,workPlaceholder:a.cogita.library.add.group.citationWorkPlaceholder,bookLabel:a.cogita.library.add.group.citationBookLabel,bookPlaceholder:a.cogita.library.add.group.citationBookPlaceholder,locatorLabel:a.cogita.library.add.group.citationLocatorValueLabel,locatorPlaceholder:a.cogita.library.add.group.citationLocatorValuePlaceholder}),[a]),Be=i.useMemo(()=>Ue.filter(t=>t.value!=="any"&&t.value!=="computed"&&t.value!=="source"&&t.value!=="quote"),[Ue]),Ce=i.useMemo(()=>{const t=O;return Ft.map(r=>{var K;const u=(r==null?void 0:r[t])??(r==null?void 0:r.en)??(r==null?void 0:r.la);return{label:`${u.abbr} — ${u.name}`,latin:((K=r==null?void 0:r.la)==null?void 0:K.abbr)??u.abbr}})},[O]),be=(t,r=!1)=>{const u=t.trim().toLowerCase();return u?Ce.filter(T=>T.label.toLowerCase().includes(u)).slice(0,8):r?Ce.slice(0,8):[]},$e=(t,r)=>{const u=t.trim().toLowerCase();if(!u)return null;const T=Ft;for(const K of T){const re=K==null?void 0:K.la,le=(K==null?void 0:K[r])??(K==null?void 0:K.en)??re;if([le==null?void 0:le.abbr,le==null?void 0:le.name,re==null?void 0:re.abbr,re==null?void 0:re.name,`${le==null?void 0:le.abbr} — ${le==null?void 0:le.name}`].filter(Boolean).map(de=>de.toLowerCase()).some(de=>de===u))return{book:K,entry:le,la:re}}return null};i.useEffect(()=>{if(!V.language||!V.word){Ne(null);return}const t=window.setTimeout(()=>{ir({libraryId:l,languageId:V.language.id,wordId:V.word.id}).then(r=>{Ne(r.exists?a.cogita.library.add.connection.pairExists:null)}).catch(()=>{Ne(null)})},200);return()=>window.clearTimeout(t)},[l,V.language,V.word]),i.useEffect(()=>{if(!o.languageA||!o.wordA){Me(null);return}const t=window.setTimeout(()=>{ir({libraryId:l,languageId:o.languageA.id,wordId:o.wordA.id}).then(r=>{Me(r.exists?a.cogita.library.add.group.pairExistsA:null)}).catch(()=>{Me(null)})},200);return()=>window.clearTimeout(t)},[l,o.languageA,o.wordA]),i.useEffect(()=>{if(!o.languageB||!o.wordB){Se(null);return}const t=window.setTimeout(()=>{ir({libraryId:l,languageId:o.languageB.id,wordId:o.wordB.id}).then(r=>{Se(r.exists?a.cogita.library.add.group.pairExistsB:null)}).catch(()=>{Se(null)})},200);return()=>window.clearTimeout(t)},[l,o.languageB,o.wordB]),i.useEffect(()=>{if(!j||!I)return;let t=!1;return ie("loading"),M(null),ut({libraryId:l,infoId:I}).then(async r=>{var T,K;if(t)return;const u=r.payload??{};if(b(re=>({...re,infoType:r.infoType,label:u.label??"",notes:u.notes??"",language:u.languageId?{id:u.languageId,label:u.languageId,infoType:"language"}:null,sourceKind:u.sourceKind??"string",sourceResourceType:re.sourceResourceType??"work",sourceResource:null,sourceLocatorValue:"",sourceLocatorAux:"",quoteText:u.text??"",workLanguage:u.languageId?{id:u.languageId,label:u.languageId,infoType:"language"}:null,workOriginalLanguage:u.originalLanguageId?{id:u.originalLanguageId,label:u.originalLanguageId,infoType:"language"}:null,workDoi:u.doi??"",mediaType:u.mediaType??"book",mediaPublisher:u.publisher??"",mediaPublicationPlace:u.publicationPlace??"",mediaPublicationYear:u.publicationYear??"",mediaPages:u.pages??"",mediaIsbn:u.isbn??"",mediaCover:u.cover??"",mediaHeight:u.height??"",mediaLength:u.length??"",mediaWidth:u.width??"",mediaWeight:u.weight??"",mediaCollection:u.collection??"",mediaLocation:u.location??"",sourceUrl:"",sourceAccessedDate:""})),r.infoType==="source"&&u.locator&&typeof u.locator=="object"){const re=u.locator;if(u.sourceKind==="website")b(le=>({...le,sourceUrl:typeof re.url=="string"?re.url:"",sourceAccessedDate:typeof re.date=="string"?re.date:""}));else if(u.sourceKind==="bible"){const le=typeof re.book=="string"?re.book:"",ee=le?$e(le,O):null,de=ee?`${ee.entry.abbr} — ${ee.entry.name}`:le;b(se=>({...se,sourceLocatorValue:le,sourceLocatorAux:typeof re.rest=="string"?re.rest:"",sourceBibleBookDisplay:de}))}else u.sourceKind==="book"?b(le=>({...le,sourceLocatorValue:typeof re.page=="string"?re.page:""})):u.sourceKind==="number_document"?b(le=>({...le,sourceLocatorValue:typeof re.number=="string"?re.number:""})):typeof re.text=="string"&&b(le=>({...le,sourceLocatorValue:re.text}))}if(u.languageId&&r.infoType!=="work")try{const re=await ut({libraryId:l,infoId:u.languageId});if(t)return;b(le=>{var ee;return{...le,language:{id:u.languageId,label:((ee=re.payload)==null?void 0:ee.label)??u.languageId,infoType:"language"}}})}catch{}if(u.languageId&&r.infoType==="work")try{const re=await ut({libraryId:l,infoId:u.languageId});if(t)return;b(le=>{var ee;return{...le,workLanguage:{id:u.languageId,label:((ee=re.payload)==null?void 0:ee.label)??u.languageId,infoType:"language"}}})}catch{}if(u.originalLanguageId)try{const re=await ut({libraryId:l,infoId:u.originalLanguageId});if(t)return;b(le=>{var ee;return{...le,workOriginalLanguage:{id:u.originalLanguageId,label:((ee=re.payload)==null?void 0:ee.label)??u.originalLanguageId,infoType:"language"}}})}catch{}r.infoType==="computed"?(ne(((T=u.definition)==null?void 0:T.answerTemplate)??""),k(((K=u.definition)==null?void 0:K.graph)??null),R(null),B("idle")):(ne(""),k(null),R(null),B("idle")),W("info")}).catch(()=>{t||M(a.cogita.library.add.info.failed)}).finally(()=>{t||ie("idle")}),()=>{t=!0}},[a,I,j,l]),i.useEffect(()=>{if(d.sourceKind==="bible"&&d.sourceLocatorValue&&D!=="source"){const t=$e(d.sourceLocatorValue,O);if(t){const r=`${t.entry.abbr} — ${t.entry.name}`;r!==d.sourceBibleBookDisplay&&b(u=>({...u,sourceBibleBookDisplay:r}))}}},[O,d.sourceKind,d.sourceLocatorValue,d.sourceBibleBookDisplay]);const De=async()=>{var t,r;M(null);try{const u={label:d.infoType==="quote"||d.infoType==="source"?"":d.label,notes:d.infoType==="computed"?"":d.notes};if(d.language&&(d.infoType==="word"||d.infoType==="sentence")&&(u.languageId=d.language.id),d.infoType==="source"&&(u.sourceKind=d.sourceKind,d.sourceKind==="website"?u.locator={url:d.sourceUrl.trim(),date:d.sourceAccessedDate.trim()}:d.sourceKind==="bible"?u.locator={book:d.sourceLocatorValue.trim(),rest:d.sourceLocatorAux.trim()}:d.sourceKind==="book"?u.locator={page:d.sourceLocatorValue.trim()}:d.sourceKind==="number_document"?u.locator={number:d.sourceLocatorValue.trim()}:u.locator={text:d.sourceLocatorValue.trim()}),d.infoType==="quote"&&(u.text=d.quoteText),d.infoType==="work"&&(u.languageId=((t=d.workLanguage)==null?void 0:t.id)??null,u.originalLanguageId=((r=d.workOriginalLanguage)==null?void 0:r.id)??null,u.doi=d.workDoi.trim()),d.infoType==="media"&&(u.mediaType=d.mediaType,u.publisher=d.mediaPublisher.trim(),u.publicationPlace=d.mediaPublicationPlace.trim(),u.publicationYear=d.mediaPublicationYear.trim(),u.pages=d.mediaPages.trim(),u.isbn=d.mediaIsbn.trim(),u.cover=d.mediaCover.trim(),u.height=d.mediaHeight.trim(),u.length=d.mediaLength.trim(),u.width=d.mediaWidth.trim(),u.weight=d.mediaWeight.trim(),u.collection=d.mediaCollection.trim(),u.location=d.mediaLocation.trim()),d.infoType==="computed"){if(!F){M(a.cogita.library.add.info.computedRequired);return}if(!p.trim()){M(a.cogita.library.add.info.computedAnswerRequired);return}if(F.nodes.find(se=>se.name&&!/^[A-Za-z][A-Za-z0-9_]*$/.test(se.name))){M(a.cogita.library.add.info.computedInvalidName);return}const K=F.nodes.map(se=>{var ve;return(ve=se.name)==null?void 0:ve.trim()}).filter(Boolean),re=new Set;for(const se of K){const ve=se.toLowerCase();if(re.has(ve)){M(a.cogita.library.add.info.computedDuplicateName);return}re.add(ve)}const le=F.nodes.filter(se=>se.type==="output"),ee=le.map(se=>{var ve;return(ve=se.name)==null?void 0:ve.trim()}).filter(Boolean);if(ee.length!==le.length){M(a.cogita.library.add.info.computedAnswerMissingOutput);return}if(!ee.every(se=>new RegExp(`\\{\\s*${se}\\s*\\}`,"i").test(p))){M(a.cogita.library.add.info.computedAnswerMissingOutput);return}u.definition={answerTemplate:p,graph:F}}if(j&&I)ie("saving"),await pi({libraryId:l,infoId:I,payload:u}),M(a.cogita.library.add.info.updated),ie("idle");else{let T=null;if(d.referenceEnabled){const se={sourceKind:d.referenceSourceKind,locatorValue:d.referenceLocatorValue,locatorAux:d.referenceLocatorAux,bibleBookDisplay:d.referenceBibleBookDisplay,sourceUrl:d.referenceSourceUrl,sourceAccessedDate:d.referenceSourceAccessedDate,churchDocument:d.referenceChurchDocument,bookMedia:d.referenceBookMedia,work:d.referenceWork},{payload:ve,resourceInfoId:Xe,error:Qe}=qe(se);if(Qe){M(a.cogita.library.add.info.referenceMissingSource);return}T={payload:ve,resourceInfoId:Xe}}const K=await Xa({libraryId:l,infoType:d.infoType,payload:u});if(d.infoType==="source"&&d.sourceResource&&await oa({libraryId:l,connectionType:"source-resource",infoIds:[K.infoId,d.sourceResource.id]}),d.infoType==="quote"&&d.language&&await oa({libraryId:l,connectionType:"quote-language",infoIds:[K.infoId,d.language.id]}),T){const se=await Xa({libraryId:l,infoType:"source",payload:T.payload});T.resourceInfoId&&await oa({libraryId:l,connectionType:"source-resource",infoIds:[se.infoId,T.resourceInfoId]}),await oa({libraryId:l,connectionType:"reference",infoIds:[K.infoId,se.infoId]})}M(a.cogita.library.add.info.saved);const re=d.infoType==="word"||d.infoType==="sentence",le=d.referenceEnabled,ee=d.referenceSourceKind,de={referenceEnabled:le,referenceSourceKind:le?ee:"string",referenceSourceUrl:le&&ee==="website"?d.referenceSourceUrl:"",referenceSourceAccessedDate:le&&ee==="website"?d.referenceSourceAccessedDate:"",referenceChurchDocument:le&&ee==="number_document"?d.referenceChurchDocument:null,referenceBookMedia:le&&ee==="book"?d.referenceBookMedia:null,referenceWork:le&&ee==="work"?d.referenceWork:null,referenceLocatorValue:le&&ee==="bible"?d.referenceLocatorValue:"",referenceLocatorAux:"",referenceBibleBookDisplay:le&&ee==="bible"?d.referenceBibleBookDisplay:""};b({infoType:d.infoType,label:"",language:re?d.language:null,notes:"",sourceKind:"string",sourceLocatorValue:"",sourceLocatorAux:"",sourceBibleBookDisplay:"",sourceResourceType:d.sourceResourceType,sourceResource:null,quoteText:"",workLanguage:null,workOriginalLanguage:null,workDoi:"",mediaType:"book",mediaPublisher:"",mediaPublicationPlace:"",mediaPublicationYear:"",mediaPages:"",mediaIsbn:"",mediaCover:"",mediaHeight:"",mediaLength:"",mediaWidth:"",mediaWeight:"",mediaCollection:"",mediaLocation:"",sourceUrl:"",sourceAccessedDate:"",...de}),d.infoType==="computed"&&(ne(""),k(null),R(null),B("idle"))}}catch{M(a.cogita.library.add.info.failed)}},qe=t=>{let r=null;if(t.sourceKind==="number_document"){if(!t.churchDocument)return{payload:{},resourceInfoId:r,error:!0};r=t.churchDocument.id}if(t.sourceKind==="book"){if(!t.bookMedia)return{payload:{},resourceInfoId:r,error:!0};r=t.bookMedia.id}if(t.sourceKind==="work"){if(!t.work)return{payload:{},resourceInfoId:r,error:!0};r=t.work.id}const u={sourceKind:t.sourceKind};if(t.sourceKind==="website"){const T=t.sourceUrl.trim();return T?(u.locator={url:T,date:t.sourceAccessedDate.trim()},{payload:u,resourceInfoId:r}):{payload:{},resourceInfoId:r,error:!0}}return t.sourceKind==="bible"?!t.locatorValue.trim()||!t.locatorAux.trim()?{payload:{},resourceInfoId:r,error:!0}:(u.locator={book:t.locatorValue.trim(),rest:t.locatorAux.trim()},{payload:u,resourceInfoId:r}):(t.sourceKind==="book"?u.locator={page:t.locatorValue.trim()}:t.sourceKind==="number_document"?u.locator={number:t.locatorValue.trim()}:t.sourceKind!=="website"&&(u.locator={text:t.locatorValue.trim()}),t.sourceKind!=="website"&&t.sourceKind!=="bible"&&!t.locatorValue.trim()?{payload:{},resourceInfoId:r,error:!0}:{payload:u,resourceInfoId:r})},Ve=()=>{if(B("idle"),!F){R(null),B("error");return}const t=jr(F,"",p);if(!t){R(null),B("error");return}R({prompt:t.prompt,answers:t.answers,answerText:t.answerText}),B("ready")},y=async()=>{M(null);try{if(V.connectionType==="reference"){if(!V.referencedInfo||!V.source){M(a.cogita.library.add.connection.selectReference);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.referencedInfo.id,V.source.id]})}else if(V.connectionType==="source-resource"){if(!V.source||!V.sourceResource){M(a.cogita.library.add.connection.selectSourceResource);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.source.id,V.sourceResource.id]})}else if(V.connectionType==="quote-language"){if(!V.quote||!V.language){M(a.cogita.library.add.connection.selectQuoteLanguage);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.quote.id,V.language.id]})}else if(V.connectionType==="work-contributor"){if(!V.work||!V.contributor||!V.contributorRole.trim()){M(a.cogita.library.add.connection.selectWorkContributor);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.work.id,V.contributor.id],payload:{role:V.contributorRole.trim()}})}else if(V.connectionType==="work-medium"){if(!V.work||!V.medium){M(a.cogita.library.add.connection.selectWorkMedium);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.work.id,V.medium.id]})}else if(V.connectionType==="orcid-link"){if(!V.orcidEntity||!V.orcid){M(a.cogita.library.add.connection.selectOrcidLink);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.orcidEntity.id,V.orcid.id]})}else if(V.connectionType==="word-language"){if(!V.language||!V.word){M(a.cogita.library.add.connection.selectWordLanguage);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.language.id,V.word.id],payload:{note:V.note}})}else if(V.connectionType==="word-topic"){if(!V.word||!V.topic){M(a.cogita.library.add.connection.selectWordTopic);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.word.id,V.topic.id],payload:{note:V.note}})}else if(V.connectionType==="translation"){if(!V.wordA||!V.wordB){M(a.cogita.library.add.connection.selectTwoWords);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.wordA.id,V.wordB.id],payload:{note:V.note}})}else if(V.connectionType==="language-sentence"){if(!V.language||!V.sentence){M(a.cogita.library.add.connection.selectLanguageSentence);return}await oa({libraryId:l,connectionType:V.connectionType,infoIds:[V.language.id,V.sentence.id],payload:{note:V.note}})}M(a.cogita.library.add.connection.saved),he(t=>({connectionType:t.connectionType,language:t.connectionType==="word-language"||t.connectionType==="language-sentence"?t.language:null,word:null,wordA:null,wordB:null,sentence:null,topic:t.connectionType==="word-topic"?t.topic:null,source:t.connectionType==="reference"||t.connectionType==="source-resource"?t.source:null,referencedInfoType:t.referencedInfoType,referencedInfo:null,sourceResourceType:t.sourceResourceType,sourceResource:null,work:null,contributorType:t.contributorType,contributor:null,contributorRole:"",medium:null,orcidEntityType:t.orcidEntityType,orcidEntity:null,orcid:null,note:""}))}catch{M(a.cogita.library.add.connection.failed)}},N=async()=>{var t,r;M(null);try{if(o.groupType==="citation"){const T=o.citationTitle.trim(),K=o.citationQuoteText.trim();if(!K){M(a.cogita.library.add.group.citationMissingQuote);return}let re=null;if(o.citationReferenceEnabled){const de={sourceKind:o.citationSourceKind,locatorValue:o.citationLocatorValue,locatorAux:o.citationLocatorAux,bibleBookDisplay:o.citationBibleBookDisplay,sourceUrl:o.citationSourceUrl,sourceAccessedDate:o.citationSourceAccessedDate,churchDocument:o.citationChurchDocument,bookMedia:o.citationBookMedia,work:o.citationWork},{payload:se,resourceInfoId:ve,error:Xe}=qe(de);if(Xe){M(a.cogita.library.add.info.referenceMissingSource);return}re={payload:se,resourceInfoId:ve}}const le={text:K};T&&(le.title=T);const ee=await Xa({libraryId:l,infoType:"quote",payload:le});if(o.citationLanguage&&await oa({libraryId:l,connectionType:"quote-language",infoIds:[ee.infoId,o.citationLanguage.id]}),re){const de=await Xa({libraryId:l,infoType:"source",payload:re.payload});re.resourceInfoId&&await oa({libraryId:l,connectionType:"source-resource",infoIds:[de.infoId,re.resourceInfoId]}),await oa({libraryId:l,connectionType:"reference",infoIds:[ee.infoId,de.infoId]})}M(a.cogita.library.add.group.savedCitation),X(de=>({...de,citationTitle:"",citationQuoteText:"",citationLanguage:null,citationReferenceEnabled:de.citationReferenceEnabled,citationSourceKind:de.citationReferenceEnabled?de.citationSourceKind:"string",citationLocatorValue:"",citationLocatorAux:"",citationBibleBookDisplay:"",citationSourceUrl:"",citationSourceAccessedDate:"",citationChurchDocument:de.citationReferenceEnabled?de.citationChurchDocument:null,citationBookMedia:de.citationReferenceEnabled?de.citationBookMedia:null,citationWork:de.citationReferenceEnabled?de.citationWork:null}));return}if(o.groupType==="book"){const T=o.bookTitle.trim();if(!T){M(a.cogita.library.add.group.bookMissingTitle);return}const K=o.bookWorkTitle.trim();if(!K){M(a.cogita.library.add.group.bookMissingWork);return}if(o.bookContributors.find(se=>se.contributor&&!se.role.trim()||!se.contributor&&se.role.trim())){M(a.cogita.library.add.group.bookMissingContributor);return}const le=await Xa({libraryId:l,infoType:"media",payload:{label:T,mediaType:"book",publisher:o.bookPublisher.trim(),publicationPlace:o.bookPublicationPlace.trim(),publicationYear:o.bookPublicationYear.trim(),pages:o.bookPages.trim(),isbn:o.bookIsbn.trim(),cover:o.bookCover.trim(),height:o.bookHeight.trim(),length:o.bookLength.trim(),width:o.bookWidth.trim(),weight:o.bookWeight.trim(),collection:o.bookCollection.trim(),location:o.bookLocation.trim()}}),ee=await Xa({libraryId:l,infoType:"work",payload:{label:K,languageId:((t=o.bookWorkLanguage)==null?void 0:t.id)??null,originalLanguageId:((r=o.bookWorkOriginalLanguage)==null?void 0:r.id)??null,doi:o.bookWorkDoi.trim()}});await oa({libraryId:l,connectionType:"work-medium",infoIds:[ee.infoId,le.infoId]});const de=o.bookContributors.filter(se=>se.contributor&&se.role.trim());for(const se of de)await oa({libraryId:l,connectionType:"work-contributor",infoIds:[ee.infoId,se.contributor.id],payload:{role:se.role.trim()}});M(a.cogita.library.add.group.savedBook),X(se=>({...se,bookTitle:"",bookPublisher:"",bookPublicationPlace:"",bookPublicationYear:"",bookPages:"",bookIsbn:"",bookCover:"",bookHeight:"",bookLength:"",bookWidth:"",bookWeight:"",bookCollection:"",bookLocation:"",bookWorkTitle:"",bookWorkLanguage:null,bookWorkOriginalLanguage:null,bookWorkDoi:"",bookContributors:[{contributorType:"person",contributor:null,role:""}]}));return}if(!o.languageA||!o.wordA||!o.languageB||!o.wordB){M(a.cogita.library.add.group.selectBoth);return}const u=T=>Array.from(new Map(T.map(K=>[K.id,K])).values());Ee||await oa({libraryId:l,connectionType:"word-language",infoIds:[o.languageA.id,o.wordA.id]}),Ae||await oa({libraryId:l,connectionType:"word-language",infoIds:[o.languageB.id,o.wordB.id]});for(const T of u(o.wordATags))await oa({libraryId:l,connectionType:"word-topic",infoIds:[o.wordA.id,T.id]});for(const T of u(o.wordBTags))await oa({libraryId:l,connectionType:"word-topic",infoIds:[o.wordB.id,T.id]});await oa({libraryId:l,connectionType:"translation",infoIds:[o.wordA.id,o.wordB.id],payload:{tagIds:u(o.translationTags).map(T=>T.id)}}),M(a.cogita.library.add.group.savedVocab),X(T=>({...T,groupType:o.groupType,languageA:o.languageA,wordA:null,languageB:o.languageB,wordB:null,wordATags:o.wordATags,wordBTags:o.wordBTags,translationTags:o.translationTags})),requestAnimationFrame(()=>{var T;return(T=Je.current)==null?void 0:T.focus()})}catch{M(a.cogita.library.add.group.failed)}},Y=o.groupType==="citation"?a.cogita.library.add.group.saveCitation:o.groupType==="book"?a.cogita.library.add.group.saveBook:a.cogita.library.add.group.saveVocab;return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.add.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:U,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${U}/list`,children:a.cogita.library.actions.openList})]})]}),e.jsx("div",{className:"cogita-add-tabs",children:["info","connection","group"].map(t=>e.jsxs("button",{type:"button",className:"cogita-type-card","data-active":G===t,onClick:()=>{j||W(t)},disabled:j&&t!=="info",children:[e.jsx("span",{className:"cogita-type-label",children:a.cogita.library.add.tabs[t]}),e.jsxs("span",{className:"cogita-type-desc",children:[t==="info"&&a.cogita.library.add.tabDesc.info,t==="connection"&&a.cogita.library.add.tabDesc.connection,t==="group"&&a.cogita.library.add.tabDesc.group]})]},t))}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-add-center",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-create",children:[G==="info"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.typeLabel}),e.jsx("select",{value:d.infoType,onChange:t=>{j||b(r=>({...r,infoType:t.target.value}))},disabled:j,children:Ue.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.infoType!=="quote"&&d.infoType!=="source"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.labelLabel}),e.jsx("input",{type:"text",value:d.label,onChange:t=>b(r=>({...r,label:t.target.value})),placeholder:a.cogita.library.add.info.labelPlaceholder})]}),(d.infoType==="word"||d.infoType==="sentence"||d.infoType==="quote")&&e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.languageLabel,placeholder:a.cogita.library.add.info.languagePlaceholder,value:d.language,onChange:t=>b(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),d.infoType==="work"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:d.workLanguage,onChange:t=>b(r=>({...r,workLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:d.workOriginalLanguage,onChange:t=>b(r=>({...r,workOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:d.workDoi,onChange:t=>b(r=>({...r,workDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]})]}),d.infoType==="media"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaTypeLabel}),e.jsx("input",{type:"text",value:d.mediaType,onChange:t=>b(r=>({...r,mediaType:t.target.value})),placeholder:a.cogita.library.add.info.mediaTypePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:d.mediaPublisher,onChange:t=>b(r=>({...r,mediaPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:d.mediaPublicationPlace,onChange:t=>b(r=>({...r,mediaPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:d.mediaPublicationYear,onChange:t=>b(r=>({...r,mediaPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:d.mediaPages,onChange:t=>b(r=>({...r,mediaPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:d.mediaIsbn,onChange:t=>b(r=>({...r,mediaIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:d.mediaCover,onChange:t=>b(r=>({...r,mediaCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:d.mediaHeight,onChange:t=>b(r=>({...r,mediaHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:d.mediaLength,onChange:t=>b(r=>({...r,mediaLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:d.mediaWidth,onChange:t=>b(r=>({...r,mediaWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:d.mediaWeight,onChange:t=>b(r=>({...r,mediaWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:d.mediaCollection,onChange:t=>b(r=>({...r,mediaCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:d.mediaLocation,onChange:t=>b(r=>({...r,mediaLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]})]}),d.infoType==="quote"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.quoteTextLabel}),e.jsx("textarea",{value:d.quoteText,onChange:t=>b(r=>({...r,quoteText:t.target.value})),placeholder:a.cogita.library.add.info.quoteTextPlaceholder})]}),d.infoType==="source"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceKindLabel}),e.jsx("select",{value:d.sourceKind,onChange:t=>{const r=t.target.value,u=r==="book"||r==="media"?"media":r==="bible"||r==="number_document"||r==="work"?"work":d.sourceResourceType;b(T=>({...T,sourceKind:r,sourceResourceType:u,sourceResource:null,sourceLocatorValue:r==="bible"?"":T.sourceLocatorValue,sourceLocatorAux:r==="bible"?"":T.sourceLocatorAux,sourceBibleBookDisplay:r==="bible"?T.sourceBibleBookDisplay:""}))},children:_.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.sourceKind==="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-lookup full",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleBookLabel}),e.jsx("input",{type:"text",value:d.sourceBibleBookDisplay,onChange:t=>{const r=t.target.value;b(u=>({...u,sourceBibleBookDisplay:r,sourceLocatorValue:""})),pe("source"),ce(-1)},onKeyDown:t=>{const r=be(d.sourceBibleBookDisplay);if(r.length){if(t.key==="ArrowDown")t.preventDefault(),ce(u=>Math.min(u+1,r.length-1));else if(t.key==="ArrowUp")t.preventDefault(),ce(u=>Math.max(u-1,0));else if((t.key==="Enter"||t.key==="Tab")&&ke>=0&&r[ke]){const u=r[ke],T=$e(u.label,O);if(!T)return;b(K=>{var re;return{...K,sourceBibleBookDisplay:u.label,sourceLocatorValue:((re=T.la)==null?void 0:re.abbr)??K.sourceLocatorValue}}),pe(null)}}},onFocus:()=>pe("source"),onBlur:()=>window.setTimeout(()=>pe(t=>t==="source"?null:t),100),placeholder:a.cogita.library.add.info.sourceBibleBookPlaceholder})]}),D==="source"&&be(d.sourceBibleBookDisplay,!0).length>0&&e.jsx("div",{className:"cogita-lookup-results",children:be(d.sourceBibleBookDisplay,!0).map((t,r)=>e.jsx("button",{type:"button",className:"cogita-lookup-option","data-active":r===ke,tabIndex:-1,onMouseDown:()=>{const u=$e(t.label,O);u&&b(T=>{var K;return{...T,sourceBibleBookDisplay:t.label,sourceLocatorValue:((K=u.la)==null?void 0:K.abbr)??T.sourceLocatorValue}})},children:e.jsx("strong",{children:t.label})},t.latin))})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceBibleRestLabel}),e.jsx("input",{type:"text",value:d.sourceLocatorAux,onChange:t=>b(r=>({...r,sourceLocatorAux:t.target.value})),placeholder:a.cogita.library.add.info.sourceBibleRestPlaceholder})]})]}),d.sourceKind==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceUrlLabel}),e.jsx("input",{type:"text",value:d.sourceUrl,onChange:t=>b(r=>({...r,sourceUrl:t.target.value})),placeholder:a.cogita.library.add.info.sourceUrlPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceAccessedDateLabel}),e.jsx("input",{type:"text",value:d.sourceAccessedDate,onChange:t=>b(r=>({...r,sourceAccessedDate:t.target.value})),placeholder:a.cogita.library.add.info.sourceAccessedDatePlaceholder})]})]}),d.sourceKind!=="website"&&d.sourceKind!=="bible"&&e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationLocatorValueLabel}),e.jsx("input",{type:"text",value:d.sourceLocatorValue,onChange:t=>b(r=>({...r,sourceLocatorValue:t.target.value})),placeholder:a.cogita.library.add.group.citationLocatorValuePlaceholder})]}),d.sourceKind!=="string"&&d.sourceKind!=="website"&&d.sourceKind!=="bible"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.sourceResourceTypeLabel}),e.jsx("select",{value:d.sourceResourceType,disabled:["book","media","bible","number_document","work"].includes(d.sourceKind),onChange:t=>b(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Be.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Oe,{libraryId:l,infoType:d.sourceResourceType,label:a.cogita.library.add.info.sourceResourceLabel,placeholder:a.cogita.library.add.info.sourceResourcePlaceholder,value:d.sourceResource,onChange:t=>b(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,d.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]})]}),d.infoType!=="computed"?e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.notesLabel}),e.jsx("textarea",{value:d.notes,onChange:t=>b(r=>({...r,notes:t.target.value})),placeholder:a.cogita.library.add.info.notesPlaceholder})]}):null,d.infoType==="computed"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx("textarea",{value:p,onChange:t=>ne(t.target.value),placeholder:a.cogita.library.add.info.computedAnswerPlaceholder})]}),e.jsx("div",{className:"cogita-field full",children:e.jsx(an,{copy:a,value:F,onChange:t=>k(t)})}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Ve,children:a.cogita.library.add.info.computedPreview})}),Q&&oe==="ready"?e.jsxs("div",{className:"cogita-detail-sample",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.add.info.computedPreviewTitle}),e.jsx(Rt,{value:Q.prompt,mode:"auto"}),e.jsx("div",{className:"cogita-detail-sample-grid",children:Object.entries(Q.answers).map(([t,r])=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:t}),e.jsx(mr,{value:r,mode:"auto"})]},t))}),Q.answerText?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.add.info.computedAnswerLabel}),e.jsx(Rt,{value:Q.answerText,mode:"auto"})]}):null]}):oe==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.add.info.computedPreviewFail}):null]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:d.referenceEnabled,onChange:t=>b(r=>({...r,referenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),d.referenceEnabled&&e.jsx(Er,{libraryId:l,copy:a,language:O,sourceKindOptions:_,labels:te,value:{sourceKind:d.referenceSourceKind,locatorValue:d.referenceLocatorValue,locatorAux:d.referenceLocatorAux,bibleBookDisplay:d.referenceBibleBookDisplay,sourceUrl:d.referenceSourceUrl,sourceAccessedDate:d.referenceSourceAccessedDate,churchDocument:d.referenceChurchDocument,bookMedia:d.referenceBookMedia,work:d.referenceWork},onChange:t=>b(r=>({...r,referenceSourceKind:t.sourceKind,referenceLocatorValue:t.locatorValue,referenceLocatorAux:t.locatorAux,referenceBibleBookDisplay:t.bibleBookDisplay,referenceSourceUrl:t.sourceUrl,referenceSourceAccessedDate:t.sourceAccessedDate,referenceChurchDocument:t.churchDocument,referenceBookMedia:t.bookMedia,referenceWork:t.work}))}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:De,disabled:ye==="saving"||ye==="loading",children:j?a.cogita.library.add.info.update:a.cogita.library.add.info.save})})]}):null,G==="connection"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.typeLabel}),e.jsx("select",{value:V.connectionType,onChange:t=>he(r=>({...r,connectionType:t.target.value})),children:ra.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),V.connectionType==="word-language"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:V.language,onChange:t=>he(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:V.word,onChange:t=>he(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),ae&&e.jsx("p",{className:"cogita-help",children:ae})]}),V.connectionType==="word-topic"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordLabel,placeholder:a.cogita.library.add.connection.wordPlaceholder,value:V.word,onChange:t=>he(r=>({...r,word:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"topic",label:a.cogita.library.add.connection.topicLabel,placeholder:a.cogita.library.add.connection.topicPlaceholder,value:V.topic,onChange:t=>he(r=>({...r,topic:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.connectionType==="translation"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordALabel,placeholder:a.cogita.library.add.connection.wordAPlaceholder,value:V.wordA,onChange:t=>he(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"word",label:a.cogita.library.add.connection.wordBLabel,placeholder:a.cogita.library.add.connection.wordBPlaceholder,value:V.wordB,onChange:t=>he(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.connectionType==="quote-language"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"quote",label:a.cogita.library.add.connection.quoteLabel,placeholder:a.cogita.library.add.connection.quotePlaceholder,value:V.quote,onChange:t=>he(r=>({...r,quote:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.quote),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:V.language,onChange:t=>he(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.connectionType==="language-sentence"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.connection.languageLabel,placeholder:a.cogita.library.add.connection.languagePlaceholder,value:V.language,onChange:t=>he(r=>({...r,language:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"sentence",label:a.cogita.library.add.connection.sentenceLabel,placeholder:a.cogita.library.add.connection.sentencePlaceholder,value:V.sentence,onChange:t=>he(r=>({...r,sentence:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.sentence),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.connectionType==="reference"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.referencedInfoTypeLabel}),e.jsx("select",{value:V.referencedInfoType,onChange:t=>he(r=>({...r,referencedInfoType:t.target.value,referencedInfo:null})),children:Ue.filter(t=>t.value!=="any").map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Oe,{libraryId:l,infoType:V.referencedInfoType,label:a.cogita.library.add.connection.referencedInfoLabel,placeholder:a.cogita.library.add.connection.referencedInfoPlaceholder,value:V.referencedInfo,onChange:t=>he(r=>({...r,referencedInfo:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,V.referencedInfoType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:V.source,onChange:t=>he(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.connectionType==="source-resource"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"source",label:a.cogita.library.add.connection.sourceLabel,placeholder:a.cogita.library.add.connection.sourcePlaceholder,value:V.source,onChange:t=>he(r=>({...r,source:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.source),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.sourceResourceTypeLabel}),e.jsx("select",{value:V.sourceResourceType,onChange:t=>he(r=>({...r,sourceResourceType:t.target.value,sourceResource:null})),children:Be.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsx(Oe,{libraryId:l,infoType:V.sourceResourceType,label:a.cogita.library.add.connection.sourceResourceLabel,placeholder:a.cogita.library.add.connection.sourceResourcePlaceholder,value:V.sourceResource,onChange:t=>he(r=>({...r,sourceResource:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,V.sourceResourceType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.connectionType==="work-contributor"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:V.work,onChange:t=>he(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:V.contributorType,onChange:t=>he(r=>({...r,contributorType:t.target.value,contributor:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ge(a,t)},t))})]}),e.jsx(Oe,{libraryId:l,infoType:V.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:V.contributor,onChange:t=>he(r=>({...r,contributor:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,V.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:V.contributorRole,onChange:t=>he(r=>({...r,contributorRole:t.target.value})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]})]}),V.connectionType==="work-medium"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"work",label:a.cogita.library.add.connection.workLabel,placeholder:a.cogita.library.add.connection.workPlaceholder,value:V.work,onChange:t=>he(r=>({...r,work:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.work),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"media",label:a.cogita.library.add.connection.mediumLabel,placeholder:a.cogita.library.add.connection.mediumPlaceholder,value:V.medium,onChange:t=>he(r=>({...r,medium:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.media),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),V.connectionType==="orcid-link"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"cogita-orcid-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.cogita.library.add.connection.orcidEntityHeader}),e.jsx("th",{children:a.cogita.library.add.connection.orcidHeader})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:V.orcidEntityType,onChange:t=>he(r=>({...r,orcidEntityType:t.target.value,orcidEntity:null})),children:["person","institution","collective"].map(t=>e.jsx("option",{value:t,children:Ge(a,t)},t))})]}),e.jsx(Oe,{libraryId:l,infoType:V.orcidEntityType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:V.orcidEntity,onChange:t=>he(r=>({...r,orcidEntity:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,V.orcidEntityType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),e.jsx("td",{children:e.jsx(Oe,{libraryId:l,infoType:"orcid",label:a.cogita.library.infoTypes.orcid,placeholder:a.cogita.library.infoTypes.orcid,value:V.orcid,onChange:t=>he(r=>({...r,orcid:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.orcid),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})})]})})]})})}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.connection.noteLabel}),e.jsx("textarea",{value:V.note,onChange:t=>he(r=>({...r,note:t.target.value})),placeholder:a.cogita.library.add.connection.notePlaceholder})]}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:y,children:a.cogita.library.add.connection.save})})]}):null,G==="group"?e.jsxs("div",{className:"cogita-form-grid",children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.typeLabel}),e.jsx("select",{value:o.groupType,onChange:t=>X(r=>({...r,groupType:t.target.value})),children:Ie.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),o.groupType==="citation"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.citationLanguageLabel,placeholder:a.cogita.library.add.group.citationLanguagePlaceholder,value:o.citationLanguage,onChange:t=>X(r=>({...r,citationLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationTitleLabel}),e.jsx("input",{type:"text",value:o.citationTitle,onChange:t=>X(r=>({...r,citationTitle:t.target.value})),placeholder:a.cogita.library.add.group.citationTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.citationQuoteTextLabel}),e.jsx("textarea",{value:o.citationQuoteText,onChange:t=>X(r=>({...r,citationQuoteText:t.target.value})),placeholder:a.cogita.library.add.group.citationQuoteTextPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.referenceTitle}),e.jsxs("div",{className:"cogita-checkbox",children:[e.jsx("input",{type:"checkbox",checked:o.citationReferenceEnabled,onChange:t=>X(r=>({...r,citationReferenceEnabled:t.target.checked}))}),e.jsx("span",{children:a.cogita.library.add.info.referenceToggle})]})]}),o.citationReferenceEnabled&&e.jsx(Er,{libraryId:l,copy:a,language:O,sourceKindOptions:_,labels:te,value:{sourceKind:o.citationSourceKind,locatorValue:o.citationLocatorValue,locatorAux:o.citationLocatorAux,bibleBookDisplay:o.citationBibleBookDisplay,sourceUrl:o.citationSourceUrl,sourceAccessedDate:o.citationSourceAccessedDate,churchDocument:o.citationChurchDocument,bookMedia:o.citationBookMedia,work:o.citationWork},onChange:t=>X(r=>({...r,citationSourceKind:t.sourceKind,citationLocatorValue:t.locatorValue,citationLocatorAux:t.locatorAux,citationBibleBookDisplay:t.bibleBookDisplay,citationSourceUrl:t.sourceUrl,citationSourceAccessedDate:t.sourceAccessedDate,citationChurchDocument:t.churchDocument,citationBookMedia:t.bookMedia,citationWork:t.work}))})]}),o.groupType==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.bookTitleLabel}),e.jsx("input",{type:"text",value:o.bookTitle,onChange:t=>X(r=>({...r,bookTitle:t.target.value})),placeholder:a.cogita.library.add.group.bookTitlePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublisherLabel}),e.jsx("input",{type:"text",value:o.bookPublisher,onChange:t=>X(r=>({...r,bookPublisher:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublisherPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationPlaceLabel}),e.jsx("input",{type:"text",value:o.bookPublicationPlace,onChange:t=>X(r=>({...r,bookPublicationPlace:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationPlacePlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPublicationYearLabel}),e.jsx("input",{type:"text",value:o.bookPublicationYear,onChange:t=>X(r=>({...r,bookPublicationYear:t.target.value})),placeholder:a.cogita.library.add.info.mediaPublicationYearPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaPagesLabel}),e.jsx("input",{type:"text",value:o.bookPages,onChange:t=>X(r=>({...r,bookPages:t.target.value})),placeholder:a.cogita.library.add.info.mediaPagesPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaIsbnLabel}),e.jsx("input",{type:"text",value:o.bookIsbn,onChange:t=>X(r=>({...r,bookIsbn:t.target.value})),placeholder:a.cogita.library.add.info.mediaIsbnPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCoverLabel}),e.jsx("input",{type:"text",value:o.bookCover,onChange:t=>X(r=>({...r,bookCover:t.target.value})),placeholder:a.cogita.library.add.info.mediaCoverPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaHeightLabel}),e.jsx("input",{type:"text",value:o.bookHeight,onChange:t=>X(r=>({...r,bookHeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaHeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLengthLabel}),e.jsx("input",{type:"text",value:o.bookLength,onChange:t=>X(r=>({...r,bookLength:t.target.value})),placeholder:a.cogita.library.add.info.mediaLengthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWidthLabel}),e.jsx("input",{type:"text",value:o.bookWidth,onChange:t=>X(r=>({...r,bookWidth:t.target.value})),placeholder:a.cogita.library.add.info.mediaWidthPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaWeightLabel}),e.jsx("input",{type:"text",value:o.bookWeight,onChange:t=>X(r=>({...r,bookWeight:t.target.value})),placeholder:a.cogita.library.add.info.mediaWeightPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaCollectionLabel}),e.jsx("input",{type:"text",value:o.bookCollection,onChange:t=>X(r=>({...r,bookCollection:t.target.value})),placeholder:a.cogita.library.add.info.mediaCollectionPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.mediaLocationLabel}),e.jsx("input",{type:"text",value:o.bookLocation,onChange:t=>X(r=>({...r,bookLocation:t.target.value})),placeholder:a.cogita.library.add.info.mediaLocationPlaceholder})]}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.group.workTitleLabel}),e.jsx("input",{type:"text",value:o.bookWorkTitle,onChange:t=>X(r=>({...r,bookWorkTitle:t.target.value})),placeholder:a.cogita.library.add.group.workTitlePlaceholder})]}),e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workLanguageLabel,placeholder:a.cogita.library.add.info.workLanguagePlaceholder,value:o.bookWorkLanguage,onChange:t=>X(r=>({...r,bookWorkLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.info.workOriginalLanguageLabel,placeholder:a.cogita.library.add.info.workOriginalLanguagePlaceholder,value:o.bookWorkOriginalLanguage,onChange:t=>X(r=>({...r,bookWorkOriginalLanguage:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.add.info.workDoiLabel}),e.jsx("input",{type:"text",value:o.bookWorkDoi,onChange:t=>X(r=>({...r,bookWorkDoi:t.target.value})),placeholder:a.cogita.library.add.info.workDoiPlaceholder})]}),e.jsxs("div",{className:"cogita-contributor-header",children:[e.jsx("span",{children:a.cogita.library.add.group.contributorsLabel}),e.jsx("button",{type:"button",className:"cogita-contributor-add",onClick:()=>X(t=>({...t,bookContributors:[...t.bookContributors,{contributorType:"person",contributor:null,role:""}]})),children:a.cogita.library.add.group.addContributor})]}),o.bookContributors.map((t,r)=>e.jsxs("div",{className:"cogita-contributor-row",children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorTypeLabel}),e.jsx("select",{value:t.contributorType,onChange:u=>X(T=>({...T,bookContributors:T.bookContributors.map((K,re)=>re===r?{...K,contributorType:u.target.value,contributor:null}:K)})),children:["person","institution","collective"].map(u=>e.jsx("option",{value:u,children:Ge(a,u)},u))})]}),e.jsx(Oe,{libraryId:l,infoType:t.contributorType,label:a.cogita.library.add.connection.contributorLabel,placeholder:a.cogita.library.add.connection.contributorPlaceholder,value:t.contributor,onChange:u=>X(T=>({...T,bookContributors:T.bookContributors.map((K,re)=>re===r?{...K,contributor:u}:K)})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",Ge(a,t.contributorType)),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.add.connection.contributorRoleLabel}),e.jsx("input",{type:"text",value:t.role,onChange:u=>X(T=>({...T,bookContributors:T.bookContributors.map((K,re)=>re===r?{...K,role:u.target.value}:K)})),placeholder:a.cogita.library.add.connection.contributorRolePlaceholder})]}),e.jsx("button",{type:"button",className:"cogita-contributor-remove",onClick:()=>X(u=>{const T=u.bookContributors.filter((K,re)=>re!==r);return T.length===0?{...u,bookContributors:[{contributorType:"person",contributor:null,role:""}]}:{...u,bookContributors:T}}),children:a.cogita.library.add.group.removeContributor})]},`book-contributor-${r}`))]}),o.groupType==="vocab"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageALabel,placeholder:a.cogita.library.add.group.languageAPlaceholder,value:o.languageA,onChange:t=>X(r=>({...r,languageA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.add.group.languageBLabel,placeholder:a.cogita.library.add.group.languageBPlaceholder,value:o.languageB,onChange:t=>X(r=>({...r,languageB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordALabel,placeholder:a.cogita.library.add.group.wordAPlaceholder,value:o.wordA,onChange:t=>X(r=>({...r,wordA:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Je,autoAdvance:!0,onCommit:()=>{var t;return(t=Ke.current)==null?void 0:t.focus()}}),e.jsx(Oe,{libraryId:l,infoType:"word",label:a.cogita.library.add.group.wordBLabel,placeholder:a.cogita.library.add.group.wordBPlaceholder,value:o.wordB,onChange:t=>X(r=>({...r,wordB:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore,inputRef:Ke,autoAdvance:!0,onCommit:()=>{var t;return(t=Fe.current)==null?void 0:t.focus()}}),e.jsx("div",{className:"cogita-lookup full",children:e.jsx(Oe,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.translationTagsLabel,placeholder:a.cogita.library.add.group.translationTagsPlaceholder,multiple:!0,values:o.translationTags,onChangeMultiple:t=>X(r=>({...r,translationTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})}),e.jsx(Oe,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordATagsLabel,placeholder:a.cogita.library.add.group.wordATagsPlaceholder,multiple:!0,values:o.wordATags,onChangeMultiple:t=>X(r=>({...r,wordATags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsx(Oe,{libraryId:l,infoType:"topic",label:a.cogita.library.add.group.wordBTagsLabel,placeholder:a.cogita.library.add.group.wordBTagsPlaceholder,multiple:!0,values:o.wordBTags,onChangeMultiple:t=>X(r=>({...r,wordBTags:t})),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),o.groupType==="vocab"&&Ee&&e.jsx("p",{className:"cogita-help",children:Ee}),o.groupType==="vocab"&&Ae&&e.jsx("p",{className:"cogita-help",children:Ae}),e.jsx("div",{className:"cogita-form-actions full",children:e.jsx("button",{type:"button",className:"cta",onClick:N,ref:Fe,children:Y})})]}):null,w?e.jsx("p",{className:"cogita-form-error",children:w}):null]})})})})})]})})}const Fr=a=>/\s/.test(a),At=a=>/[\p{L}\p{N}]/u.test(a),Ar=(a,n)=>{const s=n>0?a[n-1]:"",g=n<a.length?a[n]:"";if(!s||!g)return 0;const h=Fr(s),v=Fr(g);if(h||v)return 3;const x=At(s),A=At(g);return x!==A?2:!x&&!A?1:0},lr=(a,n,s,g,h)=>{const v=Math.max(g-n,s-g);for(let x=0;x<=v;x+=1){const A=g-x;if(A>=n&&A<=s&&Ar(a,A)>=h)return A;const O=g+x;if(O>=n&&O<=s&&Ar(a,O)>=h)return O}return null},or=(a,n)=>{const s=n>0?a[n-1]:"",g=n<a.length?a[n]:"";return!s||!g?!0:At(s)!==At(g)},rn=(a,n,s,g)=>{const h=s-n,v=n+g,x=s-g;if(h<=g*2||x<=v)return null;const A=Math.floor((n+s)/2),O=lr(a,v,x,A,3);if(O!==null&&or(a,O))return O;const q=lr(a,v,x,A,2);if(q!==null&&or(a,q))return q;const l=lr(a,v,x,A,1);return l!==null&&or(a,l)?l:null},bt=(a,n)=>{const s=Math.max(1,7),g=Math.max(s,13),h={},v=(O,q,l,I,m)=>{const j=String(I),U={id:j,start:O,end:q,text:a.slice(O,q),depth:l,index:I,parentId:m};if(h[j]=U,q-O>g){let W=rn(a,O,q,s);if(W!==null&&W>O&&W<q){const d=v(O,W,l+1,I*2+1,j),b=v(W,q,l+1,I*2+2,j);U.leftId=d.id,U.rightId=b.id}}return U},x=v(0,a.length,0,0),A=Object.values(h).sort((O,q)=>q.depth-O.depth||O.start-q.start).map(O=>O.id);return{text:a,rootId:x.id,nodes:h,order:A}},gt=(a,n,s,g,h,v,x)=>{const A=v==="reverse"?a.order.slice().sort((O,q)=>a.nodes[q].start-a.nodes[O].start||a.nodes[q].depth-a.nodes[O].depth):a.order;for(const O of A){if(x&&O===x||n.has(O))continue;const q=a.nodes[O];if(q){if(h&&(q.leftId||q.rightId)){const l=q.leftId?s[q.leftId]??0:g,I=q.rightId?s[q.rightId]??0:g;if((l+I)/2<g)continue}return q}}return null},Qr=(a,n)=>({before:a.slice(0,n.start),fragment:a.slice(n.start,n.end),after:a.slice(n.end)});function nn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l}){const I=`/#/cogita/library/${l}`,[m,j,U]=xr([]),[G,W,d]=yr([]),[b,p]=i.useState(null),[ne,F]=i.useState(null),[k,Q]=i.useState(null),[R,oe]=i.useState(null),B=i.useMemo(()=>m.find(o=>o.id===b)??null,[m,b]);i.useEffect(()=>{let o=!0;return fi({libraryId:l}).then(X=>{if(!o)return;const w=X.nodes.map(M=>{var ye,ie,ae;return{id:M.nodeId,type:"default",position:{x:80+Math.random()*300,y:60+Math.random()*260},data:{label:M.payload&&typeof M.payload=="object"&&"label"in M.payload?String(M.payload.label):"Item",nodeType:M.nodeType,itemType:((ye=M.payload)==null?void 0:ye.itemType)??"info",itemId:((ie=M.payload)==null?void 0:ie.itemId)??null,infoType:((ae=M.payload)==null?void 0:ae.infoType)??null}}});j(w),W(X.edges.map(M=>({id:M.edgeId,source:M.fromNodeId,target:M.toNodeId})))}).catch(()=>{o&&(j([]),W([]))}),()=>{o=!1}},[l]),i.useEffect(()=>{xi({libraryId:l}).then(F).catch(()=>F(null))},[l,m,G]);const D=i.useCallback(o=>{W(X=>jt(o,X))},[]),pe=()=>{const o=crypto.randomUUID();j(X=>[...X,{id:o,type:"default",position:{x:140+X.length*40,y:120+X.length*30},data:{label:a.cogita.library.infoTypes.collection,nodeType:"collection",itemType:"collection",itemId:null,infoType:"collection"}}])},ke=()=>{const o=crypto.randomUUID();j(X=>[...X,{id:o,type:"default",position:{x:180+X.length*40,y:160+X.length*30},data:{label:a.cogita.library.infoTypes.any,nodeType:"info",itemType:"info",itemId:null,infoType:null}}])},ce=async()=>{Q(null);try{const o=m.map(w=>({nodeId:w.id,nodeType:w.data.nodeType,payload:{itemType:w.data.itemType,itemId:w.data.itemId??null,label:w.data.label,infoType:w.data.infoType??null}})),X=G.map(w=>({edgeId:w.id,fromNodeId:w.source,toNodeId:w.target}));await yi({libraryId:l,nodes:o,edges:X}),Q(a.cogita.library.graph.saveSuccess)}catch{Q(a.cogita.library.graph.saveFail)}},V=o=>{B&&j(X=>X.map(w=>w.id===B.id?{...w,data:{...w.data,itemId:(o==null?void 0:o.infoId)??null,itemType:"collection",infoType:"collection",label:(o==null?void 0:o.label)??a.cogita.library.infoTypes.collection}}:w))},he=o=>{B&&j(X=>X.map(w=>w.id===B.id?{...w,data:{...w.data,itemId:(o==null?void 0:o.infoId)??null,itemType:"info",infoType:(o==null?void 0:o.infoType)??null,label:(o==null?void 0:o.label)??a.cogita.library.infoTypes.any}}:w))};return i.useEffect(()=>{if(!B||B.data.nodeType!=="info"||B.data.infoType!=="quote"||!B.data.itemId){oe(null);return}let o=!0;return ut({libraryId:l,infoId:B.data.itemId}).then(X=>{if(!o)return;const w=X.payload,M=(w==null?void 0:w.text)??"";if(!M){oe(null);return}const ye=bt(M),ie=Object.values(ye.nodes).sort((ae,Ne)=>ae.depth-Ne.depth||ae.start-Ne.start).map(ae=>({id:ae.id,text:ae.text,depth:ae.depth}));oe({title:(w==null?void 0:w.title)??B.data.label,fragments:ie})}).catch(()=>oe(null)),()=>{o=!1}},[l,B]),e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:a.cogita.library.navLabel}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:I,children:a.cogita.library.actions.libraryOverview}),e.jsx("button",{type:"button",className:"cta",onClick:ce,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("button",{type:"button",className:"cta ghost",onClick:pe,children:a.cogita.library.collections.create}),e.jsx("button",{type:"button",className:"cta ghost",onClick:ke,children:a.cogita.library.actions.addInfo}),ne?e.jsx("div",{className:"cogita-graph-summary",children:e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(ne.totalCollections))})}):null,k?e.jsx("p",{className:"cogita-help",children:k}):null]}),e.jsx("div",{className:"cogita-collection-graph-canvas",children:e.jsxs(Ut,{nodes:m,edges:G,onNodesChange:U,onEdgesChange:d,onConnect:D,onNodeClick:(o,X)=>p(X.id),fitView:!0,children:[e.jsx(Wt,{gap:18,size:1}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),B?e.jsxs("div",{className:"cogita-graph-inspector",children:[B.data.nodeType==="collection"?e.jsx(Oe,{libraryId:l,infoType:"collection",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:B.data.itemId?{id:B.data.itemId,label:B.data.label,infoType:"collection"}:null,onChange:V,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.collection),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}):e.jsx(Oe,{libraryId:l,infoType:"any",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:B.data.itemId?{id:B.data.itemId,label:B.data.label,infoType:B.data.infoType??void 0}:null,onChange:he,searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.any),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),R?e.jsxs("div",{className:"cogita-quote-preview",children:[e.jsx("p",{className:"cogita-user-kicker",children:R.title}),e.jsx("div",{className:"cogita-detail-sample-grid",children:R.fragments.map(o=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:o.id}),e.jsx("span",{children:o.text})]},o.id))})]}):null]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function ln({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l,collectionId:I}){const{libraryName:m}=Ua(l),[j,U]=i.useState([]),[G,W]=i.useState("loading"),[d,b]=i.useState("idle"),p=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),ne=`/#/cogita/library/${l}`,F=()=>{W("loading"),_r({libraryId:l}).then(R=>{U(R),W("idle")}).catch(()=>{U([]),W("error")})};i.useEffect(()=>{F()},[l]);const k=async R=>{try{await Ur({libraryId:l,shareId:R}),F()}catch{F()}},Q=async R=>{const oe=`${p}/${R}`;try{await navigator.clipboard.writeText(oe),b("copied")}catch{b("failed")}};return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.shareTitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:ne,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${ne}/collections`,children:a.cogita.library.actions.collections})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsx("div",{className:"cogita-library-grid",children:e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[G==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):G==="error"?e.jsx("p",{children:a.cogita.library.revision.shareError}):j.filter(R=>!I||R.collectionId===I).length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:j.filter(R=>!I||R.collectionId===I).map(R=>e.jsxs("div",{className:"cogita-share-row","data-state":R.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:R.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(R.createdUtc).toLocaleString(),R.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]}),R.shareCode?e.jsx("div",{className:"cogita-share-meta",children:`${p}/${R.shareCode}`}):null]}),R.revokedUtc?null:e.jsxs("div",{className:"cogita-detail-actions",children:[R.shareCode?e.jsx("button",{type:"button",className:"ghost",onClick:()=>Q(R.shareCode),children:a.cogita.library.revision.shareCopyAction}):null,e.jsx("button",{type:"button",className:"ghost",onClick:()=>k(R.shareId),children:a.cogita.library.revision.shareRevokeAction})]})]},R.shareId))}),d==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):d==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]})]})})})})})]})})}function on({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l}){const{libraryName:I}=Ua(l),m=`/#/cogita/library/${l}`,[j,U]=i.useState(""),[G,W]=i.useState([]),[d,b]=i.useState("idle"),[p,ne]=i.useState(0),[F,k]=i.useState(null);i.useEffect(()=>{b("loading");const R=window.setTimeout(()=>{$t({libraryId:l,query:j.trim()||void 0,limit:30}).then(oe=>{W(oe.items),ne(oe.total),k(oe.nextCursor??null),b("ready")}).catch(()=>{W([]),ne(0),k(null),b("ready")})},240);return()=>window.clearTimeout(R)},[l,j]);const Q=async()=>{if(F){b("loading");try{const R=await $t({libraryId:l,query:j.trim()||void 0,limit:30,cursor:F});W(oe=>[...oe,...R.items]),k(R.nextCursor??null),ne(R.total),b("ready")}catch{b("ready")}}};return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"list",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h1",{className:"cogita-library-title",children:I}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.listSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta",href:`${m}/collections/new`,children:a.cogita.library.actions.createCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("div",{className:"cogita-search-field",children:e.jsx("input",{type:"text",value:j,onChange:R=>U(R.target.value),placeholder:a.cogita.library.collections.searchPlaceholder})})]})}),e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:a.cogita.library.collections.countLabel.replace("{shown}",String(G.length)).replace("{total}",String(p||G.length))}),e.jsx("span",{children:d==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:G.length?G.map(R=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("a",{className:"cogita-card-select",href:`${m}/collections/${R.collectionId}`,children:[e.jsx("div",{className:"cogita-card-type",children:a.cogita.library.collections.collectionLabel}),e.jsx("h3",{className:"cogita-card-title",children:R.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[a.cogita.library.collections.itemCountLabel.replace("{count}",String(R.itemCount))," ·"," ",R.notes||a.cogita.library.collections.noNotes]})]})},R.collectionId)):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.collections.emptyTitle}),e.jsx("a",{className:"ghost",href:`${m}/collections/new`,children:a.cogita.library.collections.emptyAction})]})}),F?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:Q,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.listKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})})]})})]})})})]})})}const Br=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],sn={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},cn=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],dn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function un({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l,onCreated:I}){const{libraryName:m}=Ua(l),j=`/#/cogita/library/${l}`,[U,G]=i.useState(null),[W,d]=i.useState(""),[b,p]=i.useState(""),[ne,F,k]=xr([]),[Q,R,oe]=yr([]),[B,D]=i.useState(null),[pe,ke]=i.useState(null),ce=i.useMemo(()=>ne.find(w=>w.id===B)??null,[ne,B]),V=w=>{var ae;const M=crypto.randomUUID(),ye=((ae=Br.find(Ne=>Ne.type===w))==null?void 0:ae.label)??w,ie={...sn[w]};F(Ne=>[...Ne,{id:M,type:"default",position:{x:120+Ne.length*40,y:120+Ne.length*40},data:{nodeType:w,label:ye,params:ie}}]),D(M)},he=i.useCallback(w=>{R(M=>jt({...w,id:crypto.randomUUID()},M))},[R]),o=w=>{ce&&F(M=>M.map(ye=>ye.id===ce.id?{...ye,data:{...ye.data,params:w}}:ye))},X=async()=>{if(ke(null),!W.trim()){ke(a.cogita.library.collections.saveRequiredName);return}try{const w={nodes:ne.map(ie=>({nodeId:ie.id,nodeType:ie.data.nodeType,payload:{position:ie.position,params:ie.data.params}})),edges:Q.map(ie=>({edgeId:ie.id,fromNodeId:ie.source,fromPort:ie.sourceHandle??null,toNodeId:ie.target,toPort:ie.targetHandle??null}))};let M=U,ye=!1;if(M)await zr({libraryId:l,collectionId:M,nodes:w.nodes,edges:w.edges});else{const ie=await Wr({libraryId:l,name:W.trim(),notes:b.trim()||void 0,items:[],graph:w});M=ie.collectionId,ye=!0,G(ie.collectionId)}ke(ye?a.cogita.library.collections.saveSuccess:a.cogita.library.graph.saveSuccess),I(M)}catch{ke(U?a.cogita.library.graph.saveFail:a.cogita.library.collections.saveFail)}};return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.createKicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.collections.createSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:j,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${j}/collections`,children:a.cogita.library.actions.collections}),e.jsx("button",{type:"button",className:"cta",onClick:X,children:a.cogita.library.actions.saveCollection})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.collectionInfoTitle}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{value:W,onChange:w=>d(w.target.value),placeholder:a.cogita.library.collections.namePlaceholder})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.collections.notesLabel}),e.jsx("textarea",{value:b,onChange:w=>p(w.target.value),placeholder:a.cogita.library.collections.notesPlaceholder})]}),pe?e.jsx("p",{className:"cogita-help",children:pe}):null,e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:Br.map(w=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>V(w.type),children:w.label},w.type))})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Ut,{nodes:ne,edges:Q,onNodesChange:k,onEdgesChange:oe,onConnect:he,onNodeClick:(w,M)=>D(M.id),fitView:!0,children:[e.jsx(Wt,{color:"rgba(120,160,200,0.2)"}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),ce?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:ce.data.label}),ce.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:ce.data.params.tagId?{id:ce.data.params.tagId,label:ce.data.params.tagLabel??"",infoType:"topic"}:null,onChange:w=>o({...ce.data.params,tagId:(w==null?void 0:w.id)??null,tagLabel:(w==null?void 0:w.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:ce.data.params.scope??"any",onChange:w=>o({...ce.data.params,scope:w.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),ce.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:ce.data.params.languageId?{id:ce.data.params.languageId,label:ce.data.params.languageLabel??"",infoType:"language"}:null,onChange:w=>o({...ce.data.params,languageId:(w==null?void 0:w.id)??null,languageLabel:(w==null?void 0:w.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:ce.data.params.scope??"any",onChange:w=>o({...ce.data.params,scope:w.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),ce.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:ce.data.params.infoType??"word",onChange:w=>o({...ce.data.params,infoType:w.target.value}),children:dn.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),e.jsx(Oe,{libraryId:l,infoType:ce.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:ce.data.params.infoId?{id:ce.data.params.infoId,label:ce.data.params.infoLabel??"",infoType:ce.data.params.infoType??"word"}:null,onChange:w=>o({...ce.data.params,infoId:(w==null?void 0:w.id)??null,infoLabel:(w==null?void 0:w.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),ce.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:ce.data.params.connectionType??"translation",onChange:w=>o({...ce.data.params,connectionType:w.target.value}),children:cn.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:ce.data.params.connectionId??"",onChange:w=>o({...ce.data.params,connectionId:w.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(ce.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}function gn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l,collectionId:I}){Ua(l);const m=`/#/cogita/library/${l}`,[j,U]=i.useState(a.cogita.library.collections.defaultName),[G,W]=i.useState(null),[d,b]=i.useState(0),[p,ne]=i.useState([]),[F,k]=i.useState("idle"),[Q,R]=i.useState(null),oe=i.useMemo(()=>a.cogita.library.list.cardCount.replace("{shown}",String(p.length)).replace("{total}",String(d||p.length)),[a,p.length,d]);i.useEffect(()=>{Ht(l,I).then(D=>{U(D.name),W(D.notes??null),b(D.itemCount)}).catch(()=>{U(a.cogita.library.collections.defaultName),W(null)})},[l,I]),i.useEffect(()=>{k("loading"),Et({libraryId:l,collectionId:I,limit:40}).then(D=>{ne(D.items),R(D.nextCursor??null),b(D.total),k("ready")}).catch(()=>{ne([]),R(null),k("ready")})},[l,I]);const B=async()=>{if(Q){k("loading");try{const D=await Et({libraryId:l,collectionId:I,limit:40,cursor:Q});ne(pe=>[...pe,...D.items]),R(D.nextCursor??null),b(D.total),k("ready")}catch{k("ready")}}};return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h1",{className:"cogita-library-title",children:j}),e.jsx("p",{className:"cogita-library-subtitle",children:G||a.cogita.library.collections.detailSubtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:m,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${m}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${m}/collections/${I}/graph`,children:a.cogita.library.graph.kicker}),e.jsx("a",{className:"cta",href:`${m}/collections/${I}/revision`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsxs("div",{className:"cogita-library-pane",children:[e.jsxs("div",{className:"cogita-card-count",children:[e.jsx("span",{children:oe}),e.jsx("span",{children:F==="loading"?a.cogita.library.collections.loading:a.cogita.library.collections.ready})]}),e.jsx("div",{className:"cogita-card-list","data-view":"list",children:p.length?p.map(D=>e.jsx("div",{className:"cogita-card-item",children:e.jsxs("div",{className:"cogita-card-select",children:[e.jsx("div",{className:"cogita-card-type",children:D.cardType==="vocab"?a.cogita.library.list.cardTypeVocab:D.cardType==="connection"?a.cogita.library.list.cardTypeConnection:a.cogita.library.list.cardTypeInfo}),e.jsx("h3",{className:"cogita-card-title",children:D.label}),e.jsx("p",{className:"cogita-card-subtitle",children:D.description})]})},me(D))):e.jsx("div",{className:"cogita-card-empty",children:e.jsx("p",{children:a.cogita.library.collections.noCards})})}),Q?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta ghost",onClick:B,children:a.cogita.library.list.loadMore})}):null]}),e.jsx("div",{className:"cogita-library-panel",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.collections.detailKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.collections.detailFocusTitle})]})}),e.jsx("div",{className:"cogita-detail-body",children:e.jsx("p",{children:a.cogita.library.collections.detailFocusBody})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${m}/collections/${I}/revision`,children:a.cogita.library.actions.startRevision})})]})})]})})})]})})}const Aa=a=>{if(!a.length)return{score:0,total:0,correct:0,lastReviewedUtc:null};const n=a.length,s=a.filter(v=>v.correct).length,g=Jt(kr(a));return{score:Math.round(Math.max(0,Math.min(100,g.knowness*100))*100)/100,total:n,correct:s,lastReviewedUtc:g.lastReviewedUtc??null}},hn=a=>{if(a.maskBase64)try{const n=vi(a.maskBase64);if(!n.length)return a.correct?1:0;const s=n.reduce((g,h)=>g+h,0);return Math.max(0,Math.min(1,s/n.length/255))}catch{return a.correct?1:0}return a.correct?1:0},kr=a=>a.map(n=>({correctness:hn(n),createdUtc:n.createdUtc})),Jt=(a,n=Date.now())=>{var d;if(!a.length)return{knowness:0,avgCorrectness:0,lastReviewedUtc:null};const g=a.slice().sort((b,p)=>b.createdUtc.localeCompare(p.createdUtc)).slice(-5),h=g.reduce((b,p)=>b+p.correctness,0)/g.length,v=5,x=2,A=.15;let O=0,q=0;for(let b=0;b<g.length;b+=1){const p=new Date(g[b].createdUtc).getTime(),ne=b===g.length-1?n:new Date(g[b+1].createdUtc).getTime(),F=Math.max(0,(ne-p)/(1e3*60)),k=1-Math.exp(-F/v);O+=k,g[b].correctness>.5&&(q+=A)}let l=h*O*x+q;const I=((d=g[g.length-1])==null?void 0:d.createdUtc)??null,m=I?Math.max(0,(n-new Date(I).getTime())/(1e3*60)):0,U=1/(1+Math.log1p(m/60));return l*=U,g.length===1&&g[0].correctness>.5&&(l+=5.44*Math.exp(-m/2)),{knowness:l,avgCorrectness:h,lastReviewedUtc:I}},kt=a=>{const n=a.slice();for(let s=n.length-1;s>0;s-=1){const g=Math.floor(Math.random()*(s+1));[n[s],n[g]]=[n[g],n[s]]}return n},Pt=a=>a[Math.floor(Math.random()*a.length)],bn=(a,n)=>{const s=new Map;return a.forEach(g=>s.set(g,Math.random())),a.sort((g,h)=>{const v=n(g)-n(h);return v!==0?v:(s.get(g)??0)-(s.get(h)??0)})},Yt=(a,n,s,g,h)=>{if(!a.length)return null;const v=a.filter(A=>!(h!=null&&h.has(me(A))));if(v.length===0)return null;const x=v.filter(A=>me(A)!==s);return Pt(x.length?x:v)},mn=(a,n,s,g,h)=>{if(!a.length)return null;let v=Number.POSITIVE_INFINITY;for(const q of a){const l=me(q);if(s.has(l))continue;const I=n[l]??1;I<v&&(v=I)}if(!Number.isFinite(v))return null;const x=a.filter(q=>{const l=me(q);return!s.has(l)&&(n[l]??1)===v}),A=x.filter(q=>!h||me(q)!==h),O=g?A.filter(q=>!g.has(me(q))):A;return O.length>0?Pt(O):A.length>0?Pt(A):h&&x.some(q=>me(q)===h)?x.find(q=>me(q)===h)??null:x.length?Pt(x):null},Gr=(a,n,s,g,h)=>{const v=[],x=a.filter(O=>!h.has(me(O))&&!s.has(me(O))&&(n[me(O)]??0)<1),A=bn(x,O=>n[me(O)]??0);for(const O of A){if(v.length>=g)break;v.push(O),h.add(me(O))}if(v.length<g){const O=kt(a.filter(q=>!h.has(me(q))&&s.has(me(q))));for(const q of O){if(v.length>=g)break;v.push(q),h.add(me(q))}}return v},pn=(a,n,s,g)=>Gr(a,n,s,g,new Set),wr=(a,n,s,g,h,v)=>{const x=Math.max(1,s.stackSize??n),O=kt(a).filter((U,G,W)=>W.findIndex(d=>me(d)===me(U))===G),q=pn(O,g,h,x),l=new Set,I=new Set,m=Yt(q,{},null,l,I),j=m?[m]:[];return m&&I.add(me(m)),{queue:j,meta:{pool:O,active:q,knownessMap:g,unknownSet:h,outcomesById:v,asked:l,queued:I}}},pr={id:"random",labelKey:"modeValue",defaultSettings:{tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:a=>a,prepare:(a,n)=>{const g=kt(a).filter((h,v,x)=>x.findIndex(A=>me(A)===me(h))===v);return{queue:g.slice(0,Math.min(n,g.length)),meta:{}}},applyOutcome:a=>a},Tr=(a,n,s,g)=>{const h=Math.max(1,s.stackSize??n),x=kt(a).filter((G,W,d)=>d.findIndex(b=>me(b)===me(G))===W),A={},O=new Set,q=new Set,l=new Set,I=Math.max(1,s.levels??1);x.forEach(G=>{const W=me(G),d=g==null?void 0:g[W],b=typeof d=="number"&&Number.isFinite(d)?d:1;A[W]=Math.min(I,Math.max(1,Math.round(b)))});const m=[];if(x.length>0){const G=new Map;x.forEach(d=>{var p;const b=A[me(d)]??1;G.has(b)||G.set(b,[]),(p=G.get(b))==null||p.push(d)});const W=Array.from(G.keys()).sort((d,b)=>d-b);for(const d of W){if(m.length>=h)break;const b=kt(G.get(d)??[]);for(const p of b){if(m.length>=h)break;m.push(p)}}}const j=Yt(m,A,null,O,q),U=j?[j]:[];return j&&q.add(me(j)),{queue:U,meta:{pool:x,active:m,levelMap:A,asked:O,queued:q,wrongSinceCorrect:l}}},fn={id:"levels",labelKey:"modeValueLevels",defaultSettings:{levels:5,stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"levels",labelKey:"levelsLabel",type:"number",min:1,max:20,step:1},{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"minCorrectness",labelKey:"minCorrectnessLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,s)=>Tr(a,n,s),applyOutcome:(a,n,s,g,h)=>{if(!n)return a;const v=Math.max(1,g.levels??1),x=a.meta.pool??[],A=a.meta.active??[],O={...a.meta.levelMap??{}},q=new Set(a.meta.asked??[]),l=new Set(a.meta.queued??[]),I=new Set(a.meta.wrongSinceCorrect??[]),m=me(n);l.delete(m),q.add(m);const j=O[m]??1;h.correct?(O[m]=I.has(m)?1:Math.min(j+1,v),I.delete(m)):(O[m]=1,I.add(m));const U=h.correct?A.filter(d=>me(d)!==m):A.slice();if(h.correct&&U.length<Math.max(1,g.stackSize??1)){const d=new Set(U.map(p=>me(p))),b=mn(x,O,d,q,m);b&&U.push(b)}const G=a.queue.slice(),W=Yt(U,O,m,q,l);return W&&(G.push(W),l.add(me(W))),{queue:G,meta:{pool:x,active:U,levelMap:O,asked:q,queued:l,wrongSinceCorrect:I}}}},xn={id:"temporal",labelKey:"modeValueTemporal",defaultSettings:{stackSize:20,tries:2,compare:"anchors",minCorrectness:70,considerDependencies:"on",dependencyThreshold:85},settingsFields:[{key:"stackSize",labelKey:"stackLabel",type:"number",min:1,max:200,step:1},{key:"tries",labelKey:"triesLabel",type:"number",min:1,max:10,step:1},{key:"dependencyThreshold",labelKey:"dependencyThresholdLabel",type:"number",min:0,max:100,step:1},{key:"considerDependencies",labelKey:"considerDependenciesLabel",type:"select",options:[{value:"on",labelKey:"considerDependenciesOn"},{value:"off",labelKey:"considerDependenciesOff"}]}],getFetchLimit:(a,n)=>Math.max(1,n.stackSize??a),getProgressTotal:()=>null,prepare:(a,n,s)=>wr(a,n,s,{},new Set,{}),applyOutcome:(a,n,s,g,h)=>{if(!n)return a;const v=a.meta.pool??[],x=a.meta.active??[],A={...a.meta.knownessMap??{}},O=new Set(a.meta.unknownSet??[]),q={...a.meta.outcomesById??{}},l=new Set(a.meta.asked??[]),I=new Set(a.meta.queued??[]),m=me(n);I.delete(m),l.add(m);const j={correctness:Math.max(0,Math.min(1,h.correctness??(h.correct?1:0))),createdUtc:h.createdUtc??new Date().toISOString()},G=(q[m]??[]).concat(j).sort((F,k)=>F.createdUtc.localeCompare(k.createdUtc)).slice(-5);q[m]=G,O.delete(m);const W=Date.now();v.forEach(F=>{const k=me(F),Q=q[k]??[];if(Q.length===0){A[k]=0,O.add(k);return}const R=Jt(Q,W);A[k]=R.knowness});const d=x.slice();if((A[m]??0)>=1){const F=d.filter(k=>me(k)!==m);d.length=0,d.push(...F)}const p=Math.max(1,g.stackSize??s);if(d.length<p){const F=new Set(d.map(Q=>me(Q))),k=Gr(v,A,O,p-d.length,F);d.push(...k)}const ne=a.queue.slice();if(ne.length===0||me(ne[ne.length-1])===m){const F=Yt(d,{},m,l,I);F&&(ne.push(F),I.add(me(F)))}return{queue:ne,meta:{pool:v,active:d,knownessMap:A,unknownSet:O,outcomesById:q,asked:l,queued:I}}}},Xr={random:pr,levels:fn,temporal:xn},yn=Object.values(Xr),Nr=a=>{if(!a)return pr;const n=a.trim().toLowerCase();return n==="random"||n==="levels"||n==="temporal"?Xr[n]:pr},Qt=(a,n)=>{const s={...a.defaultSettings};return n&&Object.entries(n).forEach(([g,h])=>{typeof h=="number"&&Number.isFinite(h)&&(s[g]=h),typeof h=="string"&&(s[g]=h)}),a.settingsFields.forEach(g=>{var v;const h=s[g.key];if(g.type==="number"){if(typeof h!="number"||Number.isNaN(h)){s[g.key]=a.defaultSettings[g.key]??0;return}g.min!==void 0&&(s[g.key]=Math.max(g.min,s[g.key])),g.max!==void 0&&(s[g.key]=Math.min(g.max,s[g.key]));return}if(g.type==="select"){const x=((v=g.options)==null?void 0:v.map(A=>A.value))??[];(typeof h!="string"||x.length>0&&!x.includes(h))&&(s[g.key]=a.defaultSettings[g.key]??x[0]??"")}}),s},Zr=(a,n)=>{const s={};return a.settingsFields.forEach(g=>{const h=n.get(g.key);if(h){if(g.type==="number"){const v=Number(h);Number.isNaN(v)||(s[g.key]=v);return}s[g.key]=h}}),Qt(a,s)},vn=(a,n)=>{const s=new URLSearchParams;return a.settingsFields.forEach(g=>{const h=n[g.key];(typeof h=="number"||typeof h=="string")&&s.set(g.key,String(h))}),s};function jn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l,collectionId:I,revisionId:m}){const{libraryName:j}=Ua(l),U=`/#/cogita/library/${l}`,[G,W]=i.useState(a.cogita.library.collections.defaultName),[d,b]=i.useState(""),[p,ne]=i.useState(20),[F,k]=i.useState("random"),[Q,R]=i.useState({}),[oe,B]=i.useState("exact"),[D,pe]=i.useState([]),[ke,ce]=i.useState(null),[V,he]=i.useState([]),[o,X]=i.useState("idle"),[w,M]=i.useState(null),[ye,ie]=i.useState("idle"),[ae,Ne]=i.useState("idle"),[Ee,Me]=i.useState("idle"),Ae=i.useMemo(()=>typeof window>"u"?"/#/cogita/public/revision":`${window.location.origin}/#/cogita/public/revision`,[]),Se=i.useMemo(()=>Nr(F),[F]),Je=i.useMemo(()=>Qt(Se,Q),[Se,Q]),Ke=i.useMemo(()=>vn(Se,Je).toString(),[Se,Je]);i.useEffect(()=>{Ht(l,I).then(te=>W(te.name)).catch(()=>W(a.cogita.library.collections.defaultName))},[l,I]),i.useEffect(()=>{m&&ji({libraryId:l,collectionId:I,revisionId:m}).then(te=>{b(te.name),k(te.mode||"random"),B(te.check||"exact"),ne(te.limit||20),R(te.revisionSettings??{})}).catch(()=>{b("")})},[I,l,m]),i.useEffect(()=>{ki({libraryId:l}).then(te=>{pe(te),!ke&&te.length>0&&ce(te[0].roleId)}).catch(()=>{pe([])})},[l]);const Fe=()=>{Ne("loading"),_r({libraryId:l}).then(te=>{he(te),Ne("idle")}).catch(()=>{he([]),Ne("error")})};i.useEffect(()=>{Fe()},[l]);const Ue=async()=>{X("working"),ie("idle");try{const te=await Ti({libraryId:l,collectionId:I,revisionType:Se.id,revisionSettings:Je,mode:F,check:oe,limit:p});M(`${Ae}/${te.shareCode}${Ke?`?${Ke}`:""}`),X("ready"),Fe()}catch{X("error")}},ra=async()=>{if(m){Me("saving");try{await wi({libraryId:l,collectionId:I,revisionId:m,name:d||G,revisionType:Se.id,revisionSettings:Je,mode:F,check:oe,limit:p}),Me("saved")}catch{Me("error")}}},Ie=async()=>{if(w)try{await navigator.clipboard.writeText(w),ie("copied")}catch{ie("failed")}},_=async te=>{try{await Ur({libraryId:l,shareId:te}),Fe()}catch{Fe()}};return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h1",{className:"cogita-library-title",children:G}),e.jsx("p",{className:"cogita-library-subtitle",children:j})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:U,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${U}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${U}/collections/${I}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("a",{className:"cta",href:`${U}/collections/${I}/revision/run?mode=${encodeURIComponent(F)}&check=${encodeURIComponent(oe)}&limit=${p}${Ke?`&${Ke}`:""}${ke?`&reviewer=${encodeURIComponent(ke)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane",children:e.jsx("div",{className:"cogita-library-controls",children:e.jsxs("div",{className:"cogita-library-search",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.workspace.revisionForm.nameLabel}),e.jsx("input",{value:d,onChange:te=>b(te.target.value)})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.modeLabel}),e.jsx("select",{value:F,onChange:te=>k(te.target.value),children:yn.map(te=>e.jsx("option",{value:te.id,children:a.cogita.library.revision[te.labelKey]},te.id))})]}),Se.settingsFields.map(te=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision[te.labelKey]}),te.type==="select"?e.jsx("select",{value:String(Je[te.key]??""),onChange:Be=>R(Ce=>({...Ce,[te.key]:Be.target.value})),children:(te.options??[]).map(Be=>e.jsx("option",{value:Be.value,children:a.cogita.library.revision[Be.labelKey]},Be.value))}):e.jsx("input",{type:"number",min:te.min,max:te.max,step:te.step,value:Je[te.key]??0,onChange:Be=>R(Ce=>({...Ce,[te.key]:Number(Be.target.value||0)}))})]},te.key)),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.checkLabel}),e.jsx("input",{value:a.cogita.library.revision.checkValue,disabled:!0})]}),Se.id!=="levels"&&Se.id!=="temporal"?e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.cardsPerSessionLabel}),e.jsx("input",{type:"number",min:1,max:200,value:p,onChange:te=>ne(Number(te.target.value||1))})]}):null,e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.reviewerLabel}),e.jsx("select",{value:ke??"",onChange:te=>ce(te.target.value||null),children:D.map(te=>e.jsx("option",{value:te.roleId,children:te.label},te.roleId))})]})]})})}),e.jsxs("div",{className:"cogita-library-panel",children:[e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.settingsKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.previewTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.previewBody1}),e.jsx("p",{children:a.cogita.library.revision.previewBody2})]}),e.jsxs("div",{className:"cogita-form-actions",children:[m?e.jsx("button",{type:"button",className:"cta ghost",onClick:ra,disabled:Ee==="saving",children:Ee==="saving"?"...":a.cogita.workspace.revisionForm.createAction}):null,e.jsx("a",{className:"cta",href:`${U}/collections/${I}/revision/run?mode=${encodeURIComponent(F)}&check=${encodeURIComponent(oe)}&limit=${p}${Ke?`&${Ke}`:""}${ke?`&reviewer=${encodeURIComponent(ke)}`:""}${m?`&revisionId=${encodeURIComponent(m)}`:""}`,children:a.cogita.library.actions.startRevision})]}),Ee==="error"?e.jsx("p",{className:"cogita-help",children:"Failed to save revision."}):null]}),e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareKicker}),e.jsx("h3",{className:"cogita-detail-title",children:a.cogita.library.revision.shareTitle})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{children:a.cogita.library.revision.shareBody}),w?e.jsxs("div",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.shareLinkLabel}),e.jsx("input",{value:w,readOnly:!0})]}):null,o==="error"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareError}):null,ye==="copied"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopied}):ye==="failed"?e.jsx("p",{className:"cogita-help",children:a.cogita.library.revision.shareCopyError}):null]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:Ue,disabled:o==="working",children:o==="working"?a.cogita.library.revision.shareWorking:a.cogita.library.revision.shareAction}),w?e.jsx("button",{type:"button",className:"cta ghost",onClick:Ie,children:a.cogita.library.revision.shareCopyAction}):null]}),e.jsxs("div",{className:"cogita-detail-body",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareListTitle}),ae==="loading"?e.jsx("p",{children:a.cogita.library.revision.shareListLoading}):V.length===0?e.jsx("p",{children:a.cogita.library.revision.shareListEmpty}):e.jsx("div",{className:"cogita-share-list",children:V.map(te=>e.jsxs("div",{className:"cogita-share-row","data-state":te.revokedUtc?"revoked":"active",children:[e.jsxs("div",{children:[e.jsx("strong",{children:te.collectionName}),e.jsxs("div",{className:"cogita-share-meta",children:[new Date(te.createdUtc).toLocaleString(),te.revokedUtc?` · ${a.cogita.library.revision.shareRevoked}`:""]})]}),te.revokedUtc?null:e.jsx("button",{type:"button",className:"ghost",onClick:()=>_(te.shareId),children:a.cogita.library.revision.shareRevokeAction})]},te.shareId))})]})]})]})]})})})]})})}function ei({copy:a,currentCard:n,currentTypeLabel:s,prompt:g,languages:h,answer:v,onAnswerChange:x,computedExpected:A,computedAnswers:O,onComputedAnswerChange:q,answerTemplate:l,outputVariables:I,variableValues:m,computedFieldFeedback:j,feedback:U,canAdvance:G,quoteContext:W,quotePlaceholder:d,onCheckAnswer:b,onSkip:p,onLanguageSelect:ne,onMarkReviewed:F,onAdvance:k,showCorrectAnswer:Q,setShowCorrectAnswer:R,onRevealCorrect:oe,answerMask:B,expectedAnswer:D,hasExpectedAnswer:pe,handleComputedKeyDown:ke,answerInputRef:ce,computedInputRefs:V,scriptMode:he,setScriptMode:o,matchPairs:X,matchLeftOrder:w,matchRightOrder:M,matchSelection:ye,matchActiveLeft:ie,matchActiveRight:ae,matchFeedback:Ne,onMatchLeftSelect:Ee,onMatchRightSelect:Me}){const Ae=i.useMemo(()=>{var Y;const _=!l&&A.length===2?`The {${A[0].key}} is of type {${A[1].key}}`:null,te=l??_;if(!te)return null;const Be=new Map(A.map(t=>[t.key,t.expected])),Ce=new Set,be=[],$e=/\{([^}]+)\}/g;let De=0,qe,Ve=null;for(;(qe=$e.exec(te))!==null;){const t=te.slice(De,qe.index);t&&be.push({type:"text",value:t});const r=((Y=qe[1])==null?void 0:Y.trim())??"",u=r&&Be.has(r)?r:r&&I&&I[r]?I[r]:null;r&&Ce.add(r),u&&Ce.add(u),u&&Be.has(u)?(be.push({type:"input",value:u}),Ve||(Ve=u)):r&&m&&m[r]!==void 0?be.push({type:"text",value:m[r]}):be.push({type:"text",value:qe[0]}),De=qe.index+qe[0].length}const y=te.slice(De);return y&&be.push({type:"text",value:y}),A.filter(t=>!Ce.has(t.key)).length>0?null:{parts:be,expectedByKey:Be,firstInputKey:Ve}},[l,A,I,m]),Se=()=>{if(!Ae)return null;const{parts:_,expectedByKey:te,firstInputKey:Be}=Ae;return e.jsx("div",{className:"cogita-revision-inline-answer",children:_.map((Ce,be)=>{var $e,De;return Ce.type==="text"?e.jsx("span",{className:"cogita-inline-text",children:Ce.value},`text-${be}`):e.jsx("input",{ref:qe=>{V.current[Ce.value]=qe},autoFocus:Ce.value===Be,value:O[Ce.value]??"",onChange:qe=>q(Ce.value,qe.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":j[Ce.value]??(U==="correct"?"correct":U==="incorrect"?"incorrect":void 0),onKeyDown:qe=>Ue(qe)||ke(qe),className:"cogita-inline-input",style:{minWidth:"5rem",width:`${Math.max(6,(($e=O[Ce.value])==null?void 0:$e.length)??0,((De=te.get(Ce.value))==null?void 0:De.length)??6)}ch`}},`input-${Ce.value}-${be}`)})})},Je=i.useMemo(()=>{const _=new Map;return(X??[]).forEach(te=>_.set(te.leftId,te)),_},[X]),Ke=i.useMemo(()=>{const _=new Map;return(X??[]).forEach(te=>_.set(te.rightId,te)),_},[X]);i.useEffect(()=>{var be;if(n.cardType!=="info"||n.infoType!=="computed"||A.length===0)return;const _=typeof document<"u"?document.activeElement:null;if(_&&(_.tagName==="INPUT"||_.tagName==="TEXTAREA"))return;const te=(Ae==null?void 0:Ae.firstInputKey)??((be=A[0])==null?void 0:be.key);if(!te)return;const Be=V.current[te];if(!Be)return;const Ce=requestAnimationFrame(()=>{Be.focus()});return()=>cancelAnimationFrame(Ce)},[n,A,Ae]);const Fe=(()=>{const _=[D??"",...A.map(Ce=>Ce.expected??"")].join(""),te=[v,...Object.values(O)].join(""),Be=`${_}${te}`;return/[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿⁱ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓ]/.test(Be)})(),Ue=_=>_.ctrlKey&&(_.key==="^"||_.key==="6")?(_.preventDefault(),o(te=>te==="super"?null:"super"),!0):_.ctrlKey&&(_.key==="_"||_.key==="-")?(_.preventDefault(),o(te=>te==="sub"?null:"sub"),!0):!1,ra=()=>{if(!D||!B)return D??"";const _=D.split(""),te=Array.from(B),Be=te.length>0?te.reduce((Ce,be)=>Ce+be,0)/te.length:127;return _.map((Ce,be)=>{const $e=te[be]??Be,De=Math.max(0,Math.min(255,Math.round($e)));let qe=255,Ve=0;return De<=127?Ve=Math.round(De/127*255):(Ve=255,qe=Math.round(255*(1-(De-127)/128))),e.jsx("span",{style:{color:`rgb(${qe}, ${Ve}, 0)`},children:Ce},`mask-${be}`)})},Ie=n.cardType==="info"&&n.infoType==="quote"?(W==null?void 0:W.title)||n.label:n.description;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-revision-header",children:[e.jsx("span",{children:s}),e.jsx("strong",{children:Ie})]}),n.cardType==="vocab"&&n.checkType==="translation-match"&&X?e.jsxs("div",{className:"cogita-revision-body",children:[g?e.jsx("h2",{children:g}):null,e.jsxs("div",{className:"cogita-revision-match",children:[e.jsx("div",{className:"cogita-revision-match-column",children:(w??[]).map(_=>{const te=Je.get(_);if(!te)return null;const Be=(ye==null?void 0:ye[_])??null,Ce=(Ne==null?void 0:Ne[_])??null,be=ie===_;return e.jsxs("button",{type:"button",className:"cogita-revision-match-item","data-active":be,"data-state":Ce??void 0,"data-locked":Be?"true":void 0,onClick:()=>Ee==null?void 0:Ee(_),children:[e.jsx("span",{children:te.leftLabel}),Be&&Q?e.jsx("em",{children:"✓"}):null]},_)})}),e.jsx("div",{className:"cogita-revision-match-column",children:(M??[]).map(_=>{const te=Ke.get(_);if(!te)return null;const Be=Object.values(ye??{}).includes(_),Ce=ae===_;return e.jsx("button",{type:"button",className:"cogita-revision-match-item","data-active":Be||Ce,"data-locked":Be?"true":void 0,onClick:()=>Me==null?void 0:Me(_),children:e.jsx("span",{children:te.rightLabel})},_)})})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,disabled:n.checkType==="translation-match",children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}):n.cardType==="vocab"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:g}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ce,value:v,onChange:_=>x(_.target.value),placeholder:a.cogita.library.revision.answerPlaceholder,"data-state":U==="correct"?"correct":U==="incorrect"?"incorrect":void 0,onKeyDown:_=>{_.key==="Enter"&&(_.preventDefault(),_.stopPropagation(),G?k():b())}})]}),Fe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":he==="super",onClick:()=>o(_=>_==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":he==="sub",onClick:()=>o(_=>_==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="computed"?e.jsxs("div",{className:"cogita-revision-body",children:[n.label?e.jsx("p",{className:"cogita-revision-hint",children:n.label}):null,l?null:e.jsx(Rt,{value:g??"",mode:"auto"}),A.length>0?(()=>{const _=Se();return _?e.jsx("div",{className:"cogita-inline-answer-wrap",children:_}):e.jsx("div",{className:"cogita-form-grid",children:A.map((te,Be)=>e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:te.key}),e.jsx("textarea",{ref:Ce=>{V.current[te.key]=Ce},autoFocus:Be===0,value:O[te.key]??"",onChange:Ce=>q(te.key,Ce.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":j[te.key]??(U==="correct"?"correct":U==="incorrect"?"incorrect":void 0),onKeyDown:Ce=>Ue(Ce)||ke(Ce)})]},te.key))})})():e.jsx("div",{className:"cogita-form-grid",children:e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("textarea",{ref:ce,value:v,onChange:_=>x(_.target.value),placeholder:a.cogita.library.revision.answerPlaceholderComputed,"data-state":U==="correct"?"correct":U==="incorrect"?"incorrect":void 0,onKeyDown:_=>{Ue(_)||_.key==="Enter"&&(_.preventDefault(),_.stopPropagation(),G?k():b())}})]})}),Fe?e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"ghost","data-active":he==="super",onClick:()=>o(_=>_==="super"?null:"super"),children:"x²"}),e.jsx("button",{type:"button",className:"ghost","data-active":he==="sub",onClick:()=>o(_=>_==="sub"?null:"sub"),children:"x₂"})]}):null,e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="quote"&&W?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsxs("div",{className:"cogita-quote-block",children:[e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.quoteProgress.replace("{done}",String(W.completed)).replace("{total}",String(W.total))}),e.jsx("p",{className:"cogita-quote-text",children:W.before}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.revision.answerLabel}),e.jsx("input",{ref:ce,value:v,onChange:_=>x(_.target.value),placeholder:d??a.cogita.library.revision.quoteMissingPlaceholder,"data-state":U==="correct"?"correct":U==="incorrect"?"incorrect":void 0,onKeyDown:_=>{_.key==="Enter"&&(_.preventDefault(),_.stopPropagation(),G?k():b())}})]}),e.jsx("p",{className:"cogita-quote-text",children:W.after})]}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:b,children:a.cogita.library.revision.checkAnswer}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}):n.cardType==="info"&&n.infoType==="word"?e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:g}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintSelectLanguage}),e.jsx("div",{className:"cogita-choice-grid",children:h.length?h.map(_=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>ne(_.label),children:_.label},_.infoId)):e.jsx("span",{className:"cogita-revision-hint",children:a.cogita.library.revision.noLanguages})}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})})]}):e.jsxs("div",{className:"cogita-revision-body",children:[e.jsx("h2",{children:g}),e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.hintReview}),e.jsxs("div",{className:"cogita-form-actions",children:[e.jsx("button",{type:"button",className:"cta",onClick:F,children:a.cogita.library.revision.markDone}),e.jsx("button",{type:"button",className:"ghost",onClick:p,children:a.cogita.library.revision.skip})]})]}),U&&e.jsx("div",{className:"cogita-revision-feedback","data-state":U,children:U==="correct"?a.cogita.library.revision.correct:a.cogita.library.revision.tryAgain}),U==="incorrect"&&pe?e.jsxs("div",{className:"cogita-revision-reveal",children:[e.jsx("button",{type:"button",className:"ghost",onClick:()=>R(_=>{const te=!_;return te&&oe(),te}),children:a.cogita.library.revision.showAnswer}),Q?e.jsxs("div",{className:"cogita-revision-answer",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.correctAnswerLabel}),A.length>0?e.jsxs("div",{className:"cogita-detail-sample-grid",children:[A.map(_=>e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:_.key}),e.jsx("span",{children:_.expected})]},_.key)),D?e.jsxs("div",{className:"cogita-detail-sample-item",children:[e.jsx("span",{children:a.cogita.library.revision.answerSentenceLabel}),e.jsx("span",{children:D})]}):null]}):e.jsx("p",{children:B?ra():D})]}):null]}):null,G?e.jsx("div",{className:"cogita-form-actions",children:e.jsx("button",{type:"button",className:"cta",onClick:k,children:a.cogita.library.revision.nextQuestion})}):null]})}const sr=[{id:"hour",label:"1h",ms:60*60*1e3},{id:"day",label:"24h",ms:24*60*60*1e3},{id:"month",label:"30d",ms:30*24*60*60*1e3},{id:"year",label:"1y",ms:365*24*60*60*1e3}];function ai({outcomes:a}){const[n,s]=i.useState("day"),g=i.useMemo(()=>{const h=sr.find(A=>A.id===n)??sr[1],v=Date.now()-h.ms,x=a.filter(A=>new Date(A.createdUtc).getTime()>=v);return Aa(x)},[a,n]);return e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:"Card knowness"}),e.jsx("div",{className:"cogita-form-actions",children:sr.map(h=>e.jsx("button",{type:"button",className:"ghost","data-active":n===h.id,onClick:()=>s(h.id),children:h.label},h.id))}),e.jsxs("h3",{className:"cogita-detail-title",children:[g.score.toFixed(1)," / 100"]}),e.jsxs("p",{children:[g.correct," / ",g.total]})]})}const kn="cogita-revision",wn=1,Bt="outcomes",Tn=()=>new Promise((a,n)=>{const s=indexedDB.open(kn,wn);s.onupgradeneeded=()=>{const g=s.result;if(!g.objectStoreNames.contains(Bt)){const h=g.createObjectStore(Bt,{keyPath:"id"});h.createIndex("byItem","itemKey",{unique:!1}),h.createIndex("byPending","pending",{unique:!1})}},s.onerror=()=>n(s.error),s.onsuccess=()=>a(s.result)}),Tt=async(a,n)=>{const s=await Tn();return new Promise((g,h)=>{const v=s.transaction(Bt,a),x=v.objectStore(Bt);n(x).then(g).catch(h),v.onerror=()=>h(v.error)})},ti=()=>{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID();if(typeof crypto<"u"&&typeof crypto.getRandomValues=="function"){const a=new Uint8Array(16);crypto.getRandomValues(a);const n=Array.from(a).map(s=>s.toString(16).padStart(2,"0"));return`${n.slice(0,4).join("")}-${n.slice(4,6).join("")}-${n.slice(6,8).join("")}-${n.slice(8,10).join("")}-${n.slice(10,16).join("")}`}return`client-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`},Nn=()=>{const a="cogita_revision_client_id",n=localStorage.getItem(a);if(n)return n;const s=ti();return localStorage.setItem(a,s),s},Ln=()=>{const a="cogita_revision_client_seq",n=Number(localStorage.getItem(a)??"0"),s=Number.isFinite(n)?n+1:1;return localStorage.setItem(a,String(s)),s},ri=(a,n,s,g)=>Fa(a,n,s,g),Dt=async a=>{const n=Nn(),s=Ln(),g=new Date().toISOString(),h={...a,clientId:n,clientSequence:s,createdUtc:g,id:ti(),pending:!0};return await Tt("readwrite",v=>new Promise((x,A)=>{const O={...h,itemKey:ri(h.itemType,h.itemId,h.checkType,h.direction)},q=v.add(O);q.onsuccess=()=>x(),q.onerror=()=>A(q.error)})),h},Kt=async(a,n,s,g)=>{if(!n)return[];try{const h=ri(a,n,s,g);return await Tt("readonly",v=>new Promise((x,A)=>{const q=v.index("byItem").getAll(h);q.onsuccess=()=>{const I=(q.result??[]).map(m=>({itemType:m.itemType,itemId:m.itemId,checkType:m.checkType??null,direction:m.direction??null,revisionType:m.revisionType,evalType:m.evalType,correct:m.correct,createdUtc:m.createdUtc,maskBase64:m.maskBase64,payloadBase64:m.payloadBase64,payloadHashBase64:m.payloadHashBase64,clientId:m.clientId,clientSequence:m.clientSequence,personRoleId:m.personRoleId??null})).sort((m,j)=>m.createdUtc.localeCompare(j.createdUtc));x(I)},q.onerror=()=>A(q.error)}))}catch{return[]}},Ba=async()=>{try{return await Tt("readonly",a=>new Promise((n,s)=>{const g=a.getAll();g.onsuccess=()=>{const v=(g.result??[]).map(x=>({itemType:x.itemType,itemId:x.itemId,checkType:x.checkType??null,direction:x.direction??null,revisionType:x.revisionType,evalType:x.evalType,correct:x.correct,createdUtc:x.createdUtc,maskBase64:x.maskBase64,payloadBase64:x.payloadBase64,payloadHashBase64:x.payloadHashBase64,clientId:x.clientId,clientSequence:x.clientSequence,personRoleId:x.personRoleId??null}));n(v)},g.onerror=()=>s(g.error)}))}catch{return[]}},Cn=async(a=100)=>{try{return await Tt("readonly",n=>new Promise((s,g)=>{const v=n.index("byPending").getAll(!0);v.onsuccess=()=>{const x=v.result??[];s(x.slice(0,a))},v.onerror=()=>g(v.error)}))}catch{return[]}},Mn=async a=>{if(a.length!==0)try{await Tt("readwrite",n=>new Promise((s,g)=>{let h=a.length;a.forEach(v=>{const x=n.get(v);x.onsuccess=()=>{const A=x.result;if(A){A.pending=!1;const O=n.put(A);O.onsuccess=()=>{h-=1,h===0&&s()},O.onerror=()=>g(O.error)}else h-=1,h===0&&s()},x.onerror=()=>g(x.error)})}))}catch{}},cr=async(a,n)=>{const s=await Cn(200);if(s.length===0)return;const g=new Map;s.forEach(h=>{var x;const v=h.personRoleId??n??"";g.has(v)||g.set(v,[]),(x=g.get(v))==null||x.push(h)});for(const[h,v]of g.entries()){const x=v.map(A=>({itemType:A.itemType,itemId:A.itemId,checkType:A.checkType??null,direction:A.direction??null,revisionType:A.revisionType,evalType:A.evalType,correct:A.correct,clientId:A.clientId,clientSequence:A.clientSequence,maskBase64:A.maskBase64??null,payloadHashBase64:A.payloadHashBase64??null,payloadBase64:A.payloadBase64??null,personRoleId:h||null}));try{await Ni({libraryId:a,outcomes:x}),await Mn(v.map(A=>A.id))}catch{}}},Dr={a:["ą","à","á","â","ä","ã","å"],c:["ć","č"],e:["ę","è","é","ê","ë"],i:["ì","í","î","ï"],l:["ł"],n:["ń"],o:["ò","ó","ô","ö","õ"],s:["ś","š"],u:["ù","ú","û","ü"],y:["ý","ÿ"],z:["ź","ż","ž"]},Sn=(a,n)=>{const s=Math.max(a.length,n.length,1),g=Math.abs(a.length-n.length);return Math.max(0,1-g/s)},In=(a,n)=>{const s=new Uint8Array(a.length),g=Sn(a,n);for(let h=0;h<a.length;h+=1){const v=a[h]===(n[h]??"")?128:0,x=a.length-1-h,A=n.length-1-h,O=a[x]===(n[A]??"")?127:0,q=Math.round((v+O)*g);s[h]=Math.max(0,Math.min(255,q))}return s},St=(a,n)=>a===n||(Dr[a]??[]).includes(n)?!0:(Dr[n]??[]).includes(a),Ot=(a,n)=>{const s=new Uint8Array(a.length);if(!a.length)return s;const g=[];for(let v=0;v<=a.length-3;v+=1)g.push({index:v,text:a.slice(v,v+3)});let h=!1;return g.forEach(v=>{for(let x=0;x<=n.length-3;x+=1){const A=n.slice(x,x+3);let O=0;for(let j=0;j<3;j+=1)St(v.text[j],A[j])&&(O+=1);if(O<2)continue;let q=v.index-1,l=x-1;for(;q>=0&&l>=0;){const j=a[q],U=n[l];if(j===U){s[q]=Math.max(s[q],255),q-=1,l-=1,h=!0;continue}if(St(j,U)){s[q]=Math.max(s[q],127),q-=1,l-=1,h=!0;continue}if(q>0&&a[q-1]===U){s[q]=Math.max(s[q],0),q-=1,h=!0;continue}if(l>0&&a[q]===n[l-1]){l-=1,h=!0;continue}break}for(let j=0;j<3;j+=1){const U=v.index+j,G=v.text[j],W=A[j],d=G===W?255:St(G,W)?127:0;s[U]=Math.max(s[U],d),h=!0}let I=v.index+3,m=x+3;for(;I<a.length&&m<n.length;){const j=a[I],U=n[m];if(j===U){s[I]=Math.max(s[I],255),I+=1,m+=1,h=!0;continue}if(St(j,U)){s[I]=Math.max(s[I],127),I+=1,m+=1,h=!0;continue}if(I+1<a.length&&a[I+1]===U){s[I]=Math.max(s[I],0),I+=1,h=!0;continue}if(m+1<n.length&&a[I]===n[m+1]){m+=1,h=!0;continue}break}}}),h?s:In(a,n)},ht=(a,n,s)=>{const g=a.trim().toLowerCase(),h=n.trim().toLowerCase();return Ot(g,h)},mt=a=>a.trim().toLowerCase().replace(/[^\p{L}\p{N}]+/gu,""),ii=(a,n,s)=>{const g=mt(a),h=mt(n);return Ot(g,h)},fa=a=>a.trim().toLowerCase(),Pn=a=>a==="reverse"?"reverse":"forward",wt=(a,n)=>`${a}|${n}`,ka=a=>{if(!a)return null;const[n,s]=a.split("|",2);return(n==="forward"||n==="reverse")&&s?{mode:n,fragmentId:s}:{mode:"forward",fragmentId:a}},qt=(a,n)=>{var g;const s=ka(n);return s?s.fragmentId&&n?(a??null)===n:(((g=ka(a))==null?void 0:g.mode)??"forward")===s.mode:!0},da=a=>{const n=a==null?void 0:a.trim().toLowerCase();return n||null},ni=(a,n)=>{if((da(a.childItemType)??"info")!==(n.cardType??"").toLowerCase()||a.childItemId!==n.cardId)return!1;const g=da(a.childCheckType),h=da(a.childDirection),v=da(n.checkType),x=da(n.direction);return!(g&&g!==v||h&&h!==x)},Rn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",n:"ⁿ",i:"ⁱ"},$n={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ"},Vt=(a,n,s)=>{if(!s||!n.startsWith(a))return n;const g=n.slice(a.length);if(!g)return n;const h=s==="super"?Rn:$n,v=g.split("").map(x=>h[x]??x).join("");return a+v},_t=(a,n,s)=>{var x,A,O;if(!a)return((x=n[0])==null?void 0:x.key)??null;const g=new Set(n.map(q=>q.key)),h=/\{([^}]+)\}/g;let v;for(;(v=h.exec(a))!==null;){const q=((A=v[1])==null?void 0:A.trim())??"";if(!q)continue;if(g.has(q))return q;const l=s==null?void 0:s[q];if(l&&g.has(l))return l}return((O=n[0])==null?void 0:O.key)??null},fr=a=>a.flatMap(n=>{if(n.cardType!=="info"||n.infoType!=="quote")return[n];const s=n.description??"";if(!s.trim())return[n];const g=ka(n.direction),h=(g==null?void 0:g.mode)??Pn(n.direction),v=bt(s),x=Object.keys(v.nodes);return x.length===0?[n]:x.map(A=>({...n,checkType:"quote-fragment",direction:wt(h,A)}))});function En({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l,collectionId:I,revisionId:m}){const j=vr(),U=`/#/cogita/library/${l}`,G=i.useMemo(()=>new URLSearchParams(j.search),[j.search]),W=Math.max(1,Number(G.get("limit")??20)),d=G.get("mode")??"random",b=i.useMemo(()=>Nr(d),[d]),p=i.useMemo(()=>Qt(b,Zr(b,G)),[b,G]),ne=G.get("check")??"exact",F=G.get("reviewer"),k=i.useMemo(()=>a.cogita.library.revision[b.labelKey]??d,[a,d,b]),Q=i.useMemo(()=>ne==="exact"?a.cogita.library.revision.checkValue:ne,[a,ne]),[R,oe]=i.useState(a.cogita.library.collections.defaultName),[B,D]=i.useState([]),[pe,ke]=i.useState([]),[ce,V]=i.useState("idle"),[he,o]=i.useState({current:0,total:0}),[X,w]=i.useState(0),[M,ye]=i.useState(""),[ie,ae]=i.useState(null),[Ne,Ee]=i.useState(null),[Me,Ae]=i.useState(null),[Se,Je]=i.useState(null),[Ke,Fe]=i.useState([]),[Ue,ra]=i.useState({}),[Ie,_]=i.useState({}),[te,Be]=i.useState(null),[Ce,be]=i.useState(null),[$e,De]=i.useState(null),[qe,Ve]=i.useState(null),[y,N]=i.useState(null),[Y,t]=i.useState({}),r=i.useRef(0),[u,T]=i.useState(null),K=i.useRef(null),re=i.useRef(null),[le,ee]=i.useState(null),[de,se]=i.useState(!1),[ve,Xe]=i.useState(null),[Qe,Ze]=i.useState([]),[P,Le]=i.useState(null),we=i.useRef(null),_e=i.useRef(null),[ia,ze]=i.useState(null),[ua,aa]=i.useState(0),ga=i.useRef(null),xa=i.useRef({}),[ya,ea]=i.useState(!1),[sa,Ta]=i.useState({}),[Da,Na]=i.useState([]),ba=i.useRef(new Map),[ta,va]=i.useState(new Set),[wa,He]=i.useState(!1),na=i.useRef(null),$a=i.useRef(new Set),Ka=i.useRef({}),Te=B[X]??null,je=(Te==null?void 0:Te.checkType)==="translation-match"&&y,Za=i.useRef(new Map),Oa=i.useRef(new Map),et=i.useRef(new Map),at=i.useRef(new Map),pt=i.useMemo(()=>Te?Te.cardType==="vocab"?a.cogita.library.revision.vocabLabel:Te.infoType?Ge(a,Te.infoType):a.cogita.library.revision.infoLabel:"",[a,Te]),Gt=i.useMemo(()=>{var f;return b.id!=="levels"?B.length:((f=sa.pool)==null?void 0:f.length)??b.getFetchLimit(W,p)},[sa,p,b,B.length,W]),tt=b.getProgressTotal?b.getProgressTotal(B,sa,W,p):b.id==="levels"?Math.min(W,Gt):B.length,rt=tt?Math.min(X+1,tt):0,Ia=Math.max(1,Number(p.tries??1)),ja=p.compare??"anchors",qa=Math.max(0,Math.min(100,Number(p.minCorrectness??0))),ha=(p.considerDependencies??"on")==="on",la=Math.max(0,Math.min(100,Number(p.dependencyThreshold??85))),Sa=c=>{const f=c.slice();for(let S=f.length-1;S>0;S-=1){const L=Math.floor(Math.random()*(S+1));[f[S],f[L]]=[f[L],f[S]]}return f},Wa=c=>c.length?c.reduce((S,L)=>S+L,0)/c.length/255*100:0,Va=c=>Wa(c)>=qa,it=async()=>{const c=await Ba(),f=new Map,S=new Map,L=new Map;c.forEach(E=>{const H=`${E.itemType}:${E.itemId}`,ue=Fa(E.itemType,E.itemId,E.checkType,E.direction);if(f.has(H)||f.set(H,[]),f.get(H).push(E),S.has(ue)||S.set(ue,[]),S.get(ue).push(E),E.itemType==="info"&&E.checkType==="quote-fragment"&&E.direction){const ge=`${E.itemId}:${E.direction}`;L.has(ge)||L.set(ge,[]),L.get(ge).push(E)}});const J=new Map,C=new Map,z=new Map;return f.forEach((E,H)=>J.set(H,Aa(E).score)),S.forEach((E,H)=>C.set(H,Aa(E).score)),L.forEach((E,H)=>z.set(H,Aa(E).score)),{itemKnowness:J,cardKnowness:C,fragmentKnowness:z}},Xt=async c=>{const f=[];let S=null;for(;;){const L=await Et({libraryId:l,collectionId:c,limit:200,cursor:S});if(f.push(...L.items),!L.nextCursor)break;S=L.nextCursor}return fr(f)},ft=async(c,f)=>{if(ba.current.has(c))return ba.current.get(c)??0;const S=await Xt(c);if(S.length===0)return ba.current.set(c,0),0;const J=S.reduce((C,z)=>{const E=me(z);return C+(f.get(E)??0)},0)/S.length;return ba.current.set(c,J),J},Zt=(c,f)=>{if(!ha||c.cardType!=="info"||c.infoType!=="quote"||c.checkType!=="quote-fragment")return!0;const S=ka(c.direction);if(!(S!=null&&S.fragmentId))return!0;const L=c.description??"";if(!L.trim())return!0;const C=bt(L).nodes[S.fragmentId];if(!C||!C.leftId&&!C.rightId)return!0;const z=[C.leftId,C.rightId].filter(ue=>!!ue);if(z.length===0)return!0;const E=z.map(ue=>{const ge=Fa("info",c.cardId,"quote-fragment",wt(S.mode,ue));return f.get(ge)??0});return E.reduce((ue,ge)=>ue+ge,0)/E.length>=la},nt=async c=>{const f=sa,S=c.concat(f.active??[]).concat(f.pool??[]).filter((E,H,ue)=>ue.findIndex(ge=>me(ge)===me(E))===H);if(!ha){va(new Set(S.map(me)));return}const{itemKnowness:L,cardKnowness:J}=await it(),C=Da.filter(E=>da(E.childItemType)==="collection"&&E.childItemId===I&&!da(E.childCheckType)&&!da(E.childDirection)),z=new Set;for(const E of S){if(E.cardType!=="info"){z.add(me(E));continue}if(!Zt(E,J))continue;const H=Da.filter(xe=>ni(xe,E)).concat(C);if(H.length===0){z.add(me(E));continue}let ue=0;for(const xe of H)if(da(xe.parentItemType)==="collection")ue+=await ft(xe.parentItemId,J);else if(da(xe.parentCheckType)||da(xe.parentDirection)){const fe=da(xe.parentCheckType),Pe=da(xe.parentDirection),Re=Fa(xe.parentItemType,xe.parentItemId,fe,Pe);ue+=J.get(Re)??0}else{const fe=`${xe.parentItemType}:${xe.parentItemId}`;ue+=L.get(fe)??0}ue/H.length>=la&&z.add(me(E))}va(z)},er=c=>{for(let f=c;f<B.length;f+=1){const S=B[f];if(S&&(!ha||S.cardType!=="info"||ta.has(me(S))))return f}return-1},La=c=>!ha||c.cardType!=="info"||ta.has(me(c)),lt=c=>{if(b.id!=="temporal"&&b.id!=="levels")return null;const f=sa,S=(f.active??[]).concat(f.pool??[]),L=new Set;for(const J of S){const C=me(J);if(!(L.has(C)||c.has(C))&&(L.add(C),La(J)))return J}return null},Pa=i.useMemo(()=>{if(b.id!=="levels")return null;const c=sa,f=c.pool??[],S=c.active??[],L=c.levelMap??{},J=Math.max(1,Number(p.levels??1)),C=Array.from({length:J},()=>0),z=new Set(S.map(ge=>me(ge)));f.forEach(ge=>{const xe=Math.min(J,Math.max(1,L[me(ge)]??1));C[xe-1]+=1});const E=f.length||1,H=C.map(ge=>ge/E*100),ue=Te?L[me(Te)]??1:null;return{counts:C,percentages:H,currentLevel:ue,levelsCount:J,activeCount:S.length,poolCount:f.length,activeSet:z}},[sa,p,b,Te]),ma=i.useMemo(()=>{if(b.id!=="temporal")return null;const c=sa,f=c.pool??[],S=c.active??[],L=c.knownessMap??{},J=new Set(c.unknownSet??[]);let C=0;f.forEach(H=>{(L[me(H)]??0)>1&&(C+=1)});const z=J.size,E=S.map(H=>({id:me(H),value:J.has(me(H))?0:Math.max(0,Math.min(1,L[me(H)]??0))}));return{knownCount:C,unknownCount:z,dots:E}},[sa,b]),ot=i.useMemo(()=>{if(!ha)return 0;const c=sa;return B.concat(c.active??[]).concat(c.pool??[]).filter((S,L,J)=>J.findIndex(C=>me(C)===me(S))===L).filter(S=>S.cardType==="info"&&!ta.has(me(S))).length},[ha,sa,B,ta]);i.useEffect(()=>{if(!ha||ce!=="ready")return;const c=sa,S=B.concat(c.active??[]).concat(c.pool??[]).filter((C,z,E)=>E.findIndex(H=>me(H)===me(C))===z).filter(C=>C.cardType!=="info"||ta.has(me(C))).length,L=we.current;if(we.current=S,L===null||S<=L)return;const J=S-L;Le(`New card available (+${J})`),_e.current&&window.clearTimeout(_e.current),_e.current=window.setTimeout(()=>Le(null),2200)},[ha,ce,sa,B,ta]),i.useEffect(()=>()=>{_e.current&&window.clearTimeout(_e.current)},[]);const pa=(c,f)=>{const S=b.applyOutcome({queue:B,meta:sa},Te,W,p,{correct:c,correctness:f,createdUtc:new Date().toISOString()});D(S.queue),Ta(S.meta);const L=S.queue[X+1];L&&xt(L,X+1)};i.useEffect(()=>{Ht(l,I).then(c=>oe(c.name)).catch(()=>oe(a.cogita.library.collections.defaultName))},[l,I]),i.useEffect(()=>{Vr({libraryId:l,type:"language"}).then(c=>ke(c)).catch(()=>ke([]))},[l]),i.useEffect(()=>{Li({libraryId:l}).then(c=>Na(c.items??[])).catch(()=>Na([]))},[l]),i.useEffect(()=>{cr(l,F)},[l,F]),i.useEffect(()=>{nt(B)},[B,Da,ha,la,I]),i.useEffect(()=>{if(!Te||!ha){He(!1);return}if(Te.cardType!=="info"||ta.has(me(Te))){He(!1);return}const c=er(X+1);if(c>=0){He(!1),w(c);return}if(b.id==="temporal"||b.id==="levels"){const f=B.slice(0,X+1),S=B.slice(X+1).filter(La),L=f.concat(S),J=new Set(L.map(me)),C=lt(J);if(C){const E=me(C);J.has(E)||(L.push(C),J.add(E),Ta(H=>{const ue=H,ge=new Set(ue.queued??[]);return ge.add(E),{...ue,queued:ge}}))}const z=L.findIndex((E,H)=>H!==X&&La(E));if(z>=0){D(L),w(z),He(!1);return}}He(!0)},[Te,ta,ha,X,B,sa,b.id]),i.useEffect(()=>{let c=!0;return(async()=>{V("loading"),o({current:0,total:b.id==="levels"?0:b.getFetchLimit(W,p)});try{const S=[];let L=null,J=null;do{const xe=await Et({libraryId:l,collectionId:I,limit:300,cursor:L});if(S.push(...xe.items),(b.id==="levels"||b.id==="temporal")&&xe.total&&(J=xe.total),o(fe=>({current:S.length,total:fe.total||xe.total||b.getFetchLimit(W,p)})),L=xe.nextCursor??null,J!==null&&S.length>=J||b.id!=="levels"&&b.id!=="temporal"&&S.length>=b.getFetchLimit(W,p))break}while(L);if(!c)return;const C=fr(S);let z;if(b.id==="levels"){const xe=Math.max(1,Number(p.levels??1)),Pe=(await Ba()).reduce((Re,We)=>{const Ye=Fa(We.itemType,We.itemId,We.checkType,We.direction);return Re[Ye]||(Re[Ye]=[]),Re[Ye].push(We),Re},{});z={},C.forEach(Re=>{const We=me(Re),Ye=Pe[We]??[],ca=Ye.length>0?Aa(Ye).score:0,Qa=Math.max(1,Math.min(xe,Math.ceil(ca/100*xe)));z[We]=Qa})}let E=null,H=null,ue=null;if(b.id==="temporal"){const xe=await Ba(),fe=new Set(C.map(We=>me(We))),Pe=xe.reduce((We,Ye)=>{const ca=Fa(Ye.itemType,Ye.itemId,Ye.checkType,Ye.direction);return fe.has(ca)&&(We[ca]||(We[ca]=[]),We[ca].push(Ye)),We},{});E={},H=new Set,ue={};const Re=Date.now();C.forEach(We=>{const Ye=me(We),ca=Pe[Ye]??[];if(ca.length===0){E[Ye]=0,H.add(Ye),ue[Ye]=[];return}const Qa=kr(ca);ue[Ye]=Qa;const li=Jt(Qa,Re);E[Ye]=li.knowness})}const ge=b.id==="levels"?Tr(C,W,p,z):b.id==="temporal"?wr(C,W,p,E??{},H??new Set,ue??{}):b.prepare(C,W,p);D(ge.queue),Ta(ge.meta),w(0),V("ready"),o(xe=>({current:Math.min(xe.current,xe.total),total:xe.total}))}catch{c&&V("error")}})(),()=>{c=!1}},[l,I,W,p,b,F]),i.useEffect(()=>{if(ye(""),ae(null),ze(null),aa(0),Fe([]),ra({}),_({}),be(null),De(null),Ve(null),se(!1),ea(!1),ee(null),N(null),t({}),!Te){Ee(null),Ae(null),Be(null),Xe(null);return}Te.cardType==="info"&&Te.infoType==="computed"&&Ee(a.cogita.library.revision.loadingComputed);let c=!0;return xt(Te,X).then(f=>{!c||!f||(Ee(f.prompt),Ae(f.expectedAnswer),Fe(f.computedExpected),ra(f.computedAnswers),Be(f.computedValues),be(f.answerTemplate),De(f.outputVariables),Ve(f.variableValues))}),()=>{c=!1}},[Te,a]),i.useEffect(()=>{if(!Te||Te.cardType!=="info"||Te.infoType!=="quote"){na.current=null,$a.current=new Set,Je(null);return}const c=Te.description??"",f=(Te.label??"").trim(),S=f.replace(/\s+/g," ").trim(),L=c.replace(/\s+/g," ").trim(),J=S&&S!==L?f:a.cogita.library.infoTypes.quote;if(!c){Je(null),Ae(null);return}const C=bt(c);na.current=C,Ee(J);let z=!0;return it().then(({fragmentKnowness:E})=>{if(!z)return;const H=getQuoteMode(Te.direction),ue=new Set,ge={};E.forEach((Pe,Re)=>{const[We,Ye]=Re.split(":",2);if(We!==Te.cardId)return;const ca=ka(Ye);if(!ca||ca.mode!==H)return;const Qa=ca.fragmentId;ge[Qa]=Pe,Pe>=la&&ue.add(Qa)}),$a.current=ue,Ka.current=ge;const xe=ka(Te.direction);if(xe!=null&&xe.fragmentId&&C.nodes[xe.fragmentId]){Ea(C,xe.fragmentId,J);return}const fe=gt(C,ue,ge,la,ha,Te.direction);Ea(C,(fe==null?void 0:fe.id)??null,J)}).catch(()=>{$a.current=new Set,Ka.current={};const E=ka(Te.direction);if(E!=null&&E.fragmentId&&C.nodes[E.fragmentId]){Ea(C,E.fragmentId,J);return}const H=gt(C,$a.current,{},la,ha,Te.direction);Ea(C,(H==null?void 0:H.id)??null,J)}),()=>{z=!1}},[Te,a,ha,la]),i.useEffect(()=>{if(!Te||Te.cardType!=="vocab"||Te.checkType!=="translation-match"){N(null),t({});return}const S=(sa.pool??sa.active??B).filter(E=>E.cardType==="vocab"&&E.checkType==="translation-match").filter((E,H,ue)=>ue.findIndex(ge=>ge.cardId===E.cardId)===H);S.some(E=>E.cardId===Te.cardId)||S.unshift(Te);const J=Sa(S).slice(0,6).map(E=>{const H=E.label.split("↔").map(xe=>xe.trim()).filter(Boolean);if(H.length<2)return null;const ue=`${E.cardId}:L`,ge=`${E.cardId}:R`;return{cardId:E.cardId,leftId:ue,rightId:ge,leftLabel:H[0],rightLabel:H[1]}}).filter(Boolean),C=J.map(E=>E.leftId),z=Sa(J.map(E=>E.rightId));N({pairs:J,leftOrder:C,rightOrder:z,selection:{},activeLeft:null,activeRight:null,locked:{}})},[Te,B,sa]),i.useEffect(()=>()=>{K.current&&window.clearTimeout(K.current),re.current&&window.clearTimeout(re.current)},[]);const za=i.useRef(null);i.useEffect(()=>{if(!Te)return;const c=me(Te),f=typeof document<"u"?document.activeElement:null;if(za.current===c&&f&&(f.tagName==="INPUT"||f.tagName==="TEXTAREA"))return;let S=0;const L=()=>{if(Te){if(Te.cardType==="info"&&Te.infoType==="computed"){if(Ke.length>0){const C=_t(Ce,Ke,$e),z=C?xa.current[C]:null;if(z&&(z.focus(),document.activeElement===z)){za.current=c;return}}if(ga.current&&(ga.current.focus(),document.activeElement===ga.current)){za.current=c;return}}else if(Te.cardType==="vocab"&&ga.current&&(ga.current.focus(),document.activeElement===ga.current)){za.current=c;return}S<6&&(S+=1,window.setTimeout(L,40))}},J=window.setTimeout(L,40);return()=>window.clearTimeout(J)},[Te,Ke,Ce,$e]),i.useEffect(()=>{if(!ya)return;const c=f=>{f.key==="Enter"&&(f.preventDefault(),ct())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[ya]);const Ha=c=>{Ze(c),Xe(Aa(c))};i.useEffect(()=>{if(!Te){Xe(null),Ze([]);return}const c=Te.cardType==="info"?"info":"connection";if(Te.cardType==="info"&&Te.infoType==="quote"){Ba().then(f=>{const S=f.filter(L=>L.itemType==="info"&&L.itemId===Te.cardId&&L.checkType==="quote-fragment"&&qt(L.direction,Te.direction));Ha(S)}).catch(()=>{Xe(null),Ze([])});return}Kt(c,Te.cardId,Te.checkType,Te.direction).then(f=>Ha(f)).catch(()=>{Xe(null),Ze([])})},[l,Te,F]);const Nt=(c,f,S,L)=>{if(c==="info"&&S==="quote-fragment"){Ba().then(J=>{const C=J.filter(z=>z.itemType==="info"&&z.itemId===f&&z.checkType==="quote-fragment"&&qt(z.direction,L));Ha(C)}).catch(()=>{Xe(null),Ze([])});return}Kt(c,f,S,L).then(J=>Ha(J)).catch(()=>{Xe(null),Ze([])})},Lt=(c,f,S)=>{var z;const L=((z=S.pairs.find(E=>E.leftId===c))==null?void 0:z.rightId)??null;if(!L)return S;const J=L===f;t(E=>({...E,[c]:J?"correct":"incorrect"})),K.current&&window.clearTimeout(K.current),re.current&&window.clearTimeout(re.current),r.current+=1;const C={kind:J?"correct":"incorrect",tick:r.current};if(T(null),K.current=window.setTimeout(()=>T(C),0),re.current=window.setTimeout(()=>T(null),420),J){const E={...S.locked,[c]:!0};return Object.keys(E).length>=S.pairs.length?(ae("correct"),ea(!0)):ae("correct"),{...S,selection:{...S.selection,[c]:f},activeLeft:null,activeRight:null,locked:E}}return ae("incorrect"),{...S,activeLeft:null,activeRight:null}},st=c=>{N(f=>!f||f.locked[c]?f:f.activeRight?Lt(c,f.activeRight,f):{...f,activeLeft:f.activeLeft===c?null:c})},Ra=c=>{N(f=>f&&(f.activeLeft?Lt(f.activeLeft,c,f):{...f,activeRight:f.activeRight===c?null:c}))},ct=()=>{var c;if(Te&&Te.cardType==="info"&&Te.infoType==="quote"&&na.current&&Se&&!((c=ka(Te.direction))!=null&&c.fragmentId)){const f=gt(na.current,$a.current,Ka.current,la,ha,Te.direction,Se.fragmentId);if(f){ae(null),ye(""),se(!1),_({}),ea(!1),ze(null),aa(0),Ea(na.current,f.id,Se.title);return}}ae(null),ye(""),se(!1),_({}),ea(!1),ze(null),aa(0),w(f=>Math.min(f+1,B.length))},Ca=c=>{if(!Te)return;const f=c.expected??null,S=c.answer??"";let L=f??"",J=S;if(!f&&c.expectedMap&&c.answerMap){const xe=Object.keys(c.expectedMap).sort((fe,Pe)=>fe.localeCompare(Pe));L=xe.map(fe=>{var Pe;return((Pe=c.expectedMap)==null?void 0:Pe[fe])??""}).join("|"),J=xe.map(fe=>{var Pe;return((Pe=c.answerMap)==null?void 0:Pe[fe])??""}).join("|")}const C=L?ht(L,J,ja):new Uint8Array,z={revisionType:b.id,evalType:c.evalType,direction:c.direction,prompt:Ne??"",expected:f,answer:S,expectedAnswers:c.expectedMap??null,answers:c.answerMap??null,correct:c.correct,maskBase64:C.length?_a(C):null,values:te??null,checkMode:ne,compareMode:ja,minCorrectness:qa},E=new TextEncoder().encode(JSON.stringify(z)),H=Te.cardType==="info"?"info":"connection",ue=c.overrideCheckType??Te.checkType??null,ge=c.overrideDirection??Te.direction??null;Dt({itemType:H,itemId:Te.cardId,checkType:ue,direction:ge,revisionType:b.id,evalType:c.evalType,correct:c.correct,maskBase64:C.length?_a(C):null,payloadBase64:_a(E),personRoleId:F??null}).then(()=>{Nt(H,Te.cardId,ue,ge),nt(B),cr(l,F)}).catch(()=>{})},Ja=(c,f)=>{const S=Za.current.get(f);if(S)return Promise.resolve(S);const L=Oa.current.get(f);if(L)return L;const J=ut({libraryId:l,infoId:c}).then(C=>{var xe,fe;const z=C.payload,E=((xe=z.definition)==null?void 0:xe.graph)??null,H="",ue=((fe=z.definition)==null?void 0:fe.answerTemplate)??"",ge=jr(E,H,ue);if(ge){const Re={sample:Yr(ge),answerTemplate:ue||null};return Za.current.set(f,Re),Re}return br({libraryId:l,infoId:c}).then(Pe=>{const Re={sample:Pe,answerTemplate:null};return Za.current.set(f,Re),Re})}).catch(()=>br({libraryId:l,infoId:c}).then(C=>{const z={sample:C,answerTemplate:null};return Za.current.set(f,z),z}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{Oa.current.delete(f)});return Oa.current.set(f,J),J},xt=(c,f)=>{var E;const S=`${me(c)}:${f}`,L=et.current.get(S);if(L)return Promise.resolve(L);const J=at.current.get(S);if(J)return J;const C=H=>(et.current.set(S,H),H);let z;if(c.cardType==="vocab"){if(c.checkType==="translation-match")return z=Promise.resolve(C({prompt:c.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),z;const H=c.label.split("↔").map(ue=>ue.trim()).filter(Boolean);if(H.length>=2){const ge=(c.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",xe=ge?H[0]:H[1],fe=ge?H[1]:H[0];z=Promise.resolve(C({prompt:xe,expectedAnswer:fe,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else z=Promise.resolve(C({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else if(c.cardType==="info"&&c.infoType==="word"){const H=(E=c.description)!=null&&E.startsWith("Language: ")?c.description.replace("Language: ",""):null;z=Promise.resolve(C({prompt:c.label,expectedAnswer:H,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}))}else c.cardType==="info"&&c.infoType==="computed"?z=Ja(c.cardId,S).then(H=>{var Pe,Re;if(!H.sample)return C({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null});const ue=H.sample,ge=ue.expectedAnswers?Object.entries(ue.expectedAnswers).map(([We,Ye])=>({key:We,expected:Ye})):[],xe=ge.reduce((We,Ye)=>(We[Ye.key]="",We),{}),fe=ue.expectedAnswerIsSentence&&((Pe=ue.expectedAnswer)==null?void 0:Pe.trim())||null;return C({prompt:ue.prompt,expectedAnswer:ge.length>0?fe:((Re=ue.expectedAnswer)==null?void 0:Re.trim())||null,computedExpected:ge,computedAnswers:xe,computedValues:ue.values??null,answerTemplate:H.answerTemplate,outputVariables:ue.outputVariables??null,variableValues:ue.variableValues??null})}).catch(()=>C({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{at.current.delete(S)}):z=Promise.resolve(C({prompt:c.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null}));return at.current.set(S,z),z},Ea=(c,f,S)=>{const L=Object.keys(c.nodes).length,J=$a.current.size;if(!f){Je({title:S,before:c.text,after:"",fragmentId:null,total:L,completed:J}),Ae(null),ea(!0);return}const C=c.nodes[f];if(!C)return;const z=Qr(c.text,C);Je({title:S,before:z.before,after:z.after,fragmentId:C.id,total:L,completed:J}),Ae(z.fragment),ea(!1)},Ct=()=>{const c=na.current;c&&Je(f=>f&&{...f,total:Object.keys(c.nodes).length,completed:$a.current.size})},dt=()=>{const c=B[X+1];c&&xt(c,X+1)},Mt=()=>{if(dt(),Te&&Te.cardType==="vocab"&&Te.checkType==="translation-match"&&y){if(y.pairs.length===0){ae("incorrect"),ea(!0);return}const C=y.pairs.reduce((fe,Pe)=>(fe[Pe.rightId]=Pe.rightLabel,fe),{});let z=0;const E={};y.pairs.forEach(fe=>{const Re=y.selection[fe.leftId]===fe.rightId;E[fe.leftId]=Re?"correct":"incorrect",Re&&(z+=1)});const H=y.pairs.length||1,ue=z/H,ge=z===y.pairs.length;t(fe=>({...fe,...E})),ge?(ae("correct"),ea(!0),aa(0)):(ae("incorrect"),ea(!1),aa(fe=>{const Pe=fe+1;return Pe>=Ia&&(se(!0),ea(!0),N(Re=>{if(!Re)return Re;const We=Re.pairs.reduce((Ye,ca)=>(Ye[ca.leftId]=ca.rightId,Ye),{});return{...Re,selection:We}})),Pe})),pa(ge,ue);const xe="connection";Promise.all(y.pairs.map(fe=>{const Pe=y.selection[fe.leftId]??null,Re=Pe?C[Pe]:"",We={left:fe.leftLabel,expected:fe.rightLabel,answer:Re,checkType:"translation-match"},Ye=new TextEncoder().encode(JSON.stringify(We));return Dt({itemType:xe,itemId:fe.cardId,checkType:"translation-match",direction:null,revisionType:b.id,evalType:"translation-match",correct:Pe===fe.rightId,maskBase64:null,payloadBase64:_a(Ye),personRoleId:F??null})})).then(()=>{Nt(xe,Te.cardId,Te.checkType,Te.direction),cr(l,F)}).catch(()=>{});return}if(Ke.length>0){const C=Ke.reduce((E,H)=>{const ue=Ue[H.key]??"";return E[H.key]=fa(ue)===fa(H.expected)?"correct":"incorrect",E},{});Ke.every(({key:E,expected:H})=>{const ue=Ue[E]??"";return ne==="exact"&&fa(ue)===fa(H)})?(ae("correct"),_(C),ea(!0),aa(0),pa(!0,1),Ca({correct:!0,direction:Ne?`${Ne} -> computed`:"computed",expectedMap:Ke.reduce((E,H)=>(E[H.key]=H.expected,E),{}),answerMap:Ue,evalType:"computed"})):(ae("incorrect"),_(C),ea(!1),aa(E=>{const H=E+1;return H>=Ia&&Z&&(se(!0),ea(!0)),H}),pa(!1,0),window.setTimeout(()=>{var H;const E=_t(Ce,Ke,$e);E&&xa.current[E]&&((H=xa.current[E])==null||H.focus())},40),Ca({correct:!1,direction:Ne?`${Ne} -> computed`:"computed",expectedMap:Ke.reduce((E,H)=>(E[H.key]=H.expected,E),{}),answerMap:Ue,evalType:"computed"}));return}if(Te&&Te.cardType==="info"&&Te.infoType==="quote"&&(Se!=null&&Se.fragmentId)){if(!Me)return;const C=ka(Te.direction),z=(C==null?void 0:C.mode)??getQuoteMode(Te.direction),E=C!=null&&C.fragmentId&&Te.direction?Te.direction:wt(z,Se.fragmentId),H=ii(Me,M,ja),ue=ne==="exact"&&mt(M)===mt(Me),ge=Va(H),xe=ue||ge,fe=Wa(H);xe?(Ka.current[Se.fragmentId]=Math.max(Ka.current[Se.fragmentId]??0,fe),(Ka.current[Se.fragmentId]??0)>=la&&$a.current.add(Se.fragmentId),Ct(),ae("correct"),_({}),ea(!0),ze(H),aa(0),fe<100&&Ia<=1&&se(!0),pa(!0,fe/100),Ca({correct:!0,direction:`quote:${Se.fragmentId}`,expected:Me,answer:M,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:E})):(ae("incorrect"),_({}),ea(!1),ze(H),aa(Pe=>{const Re=Pe+1;return Re>=Ia&&Z&&(se(!0),ea(!0)),Re}),pa(!1,fe/100),window.setTimeout(()=>{var Pe;return(Pe=ga.current)==null?void 0:Pe.focus()},40),Ca({correct:!1,direction:`quote:${Se.fragmentId}`,expected:Me,answer:M,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:E}));return}if(!Me)return;const c=ht(Me,M,ja),f=ne==="exact"&&fa(M)===fa(Me),S=Va(c),L=f||S,J=Wa(c);L?(ae("correct"),_({}),ea(!0),ze(c),aa(0),J<100&&Ia<=1&&se(!0),pa(!0,J/100),Ca({correct:!0,direction:Ne?`${Ne} -> ${Me}`:null,expected:Me,answer:M,evalType:"text"})):(ae("incorrect"),_({}),ea(!1),ze(c),aa(C=>{const z=C+1;return z>=Ia&&Z&&(se(!0),ea(!0)),z}),pa(!1,J/100),window.setTimeout(()=>{var C;return(C=ga.current)==null?void 0:C.focus()},40),Ca({correct:!1,direction:Ne?`${Ne} -> ${Me}`:null,expected:Me,answer:M,evalType:"text"}))},ar=c=>{if(dt(),!Me)return;const f=ht(Me,c,ja),S=fa(c)===fa(Me),L=Va(f),J=S||L,C=Wa(f);J?(ae("correct"),_({}),ea(!0),ze(f),aa(0),C<100&&Ia<=1&&se(!0),pa(!0,C/100),Ca({correct:!0,direction:"word->language",expected:Me,answer:c,evalType:"language-select"})):(ae("incorrect"),_({}),ea(!1),ze(f),aa(z=>{const E=z+1;return E>=Ia&&Z&&(se(!0),ea(!0)),E}),pa(!1,C/100),Ca({correct:!1,direction:"word->language",expected:Me,answer:c,evalType:"language-select"}))},tr=()=>{dt(),ae("correct"),ea(!0),aa(0),pa(!0,1),Me&&Ca({correct:!0,direction:"manual",expected:Me,answer:M,evalType:"manual"})},rr=()=>{if(pa(!1,0),Te&&Te.cardType==="info"&&Te.infoType==="quote"){ae(null),ye(""),se(!1),_({}),ea(!1),ze(null),aa(0),w(c=>Math.min(c+1,B.length));return}ct()};i.useEffect(()=>{dt()},[X,B]);const Ya=c=>{var S;if(c.key!=="Enter")return;if(c.preventDefault(),c.stopPropagation(),ya){ct();return}const f=Ke.find(L=>!(Ue[L.key]??"").trim());if(f){(S=xa.current[f.key])==null||S.focus();return}Mt()},$=a.cogita.library.revision.revealModeAfterIncorrect,Z=Ke.length>0||!!Me;return e.jsxs(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:[ce==="loading"&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${he.total?Math.min(100,Math.max(0,he.current/he.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:he.total?`${Math.min(he.current,he.total)} / ${he.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.runKicker}),e.jsx("h1",{className:"cogita-library-title",children:R}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",k).replace("{check}",Q)})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:U,children:a.cogita.library.actions.libraryOverview}),e.jsx("a",{className:"cta ghost",href:`${U}/collections`,children:a.cogita.library.actions.collections}),e.jsx("a",{className:"cta ghost",href:`${U}/collections/${I}`,children:a.cogita.library.actions.collectionDetail})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:ve?`${ve.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[Pa?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",Pa.currentLevel??"-"," / ",Pa.levelsCount]}):null,ve?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(ve.correct)).replace("{total}",String(ve.total))}),ve.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(ve.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ai,{outcomes:Qe})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[P?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:P})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":u?`${u.kind}-${u.tick}`:je?"idle":ie??"idle",children:Te?e.jsx(e.Fragment,{children:wa?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ei,{copy:a,currentCard:Te,currentTypeLabel:pt,prompt:Ne,languages:pe,answer:M,onAnswerChange:c=>ye(f=>Vt(f,c,le)),computedExpected:Ke,computedAnswers:Ue,onComputedAnswerChange:(c,f)=>ra(S=>({...S,[c]:Vt(S[c]??"",f,le)})),answerTemplate:Ce,outputVariables:$e,variableValues:qe,computedFieldFeedback:Ie,feedback:ie,canAdvance:ya,quoteContext:Se,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Mt,onSkip:rr,onLanguageSelect:ar,onMarkReviewed:tr,onAdvance:ct,showCorrectAnswer:de,setShowCorrectAnswer:se,onRevealCorrect:()=>ea(!0),answerMask:ia,expectedAnswer:Me,hasExpectedAnswer:Z,handleComputedKeyDown:Ya,answerInputRef:ga,computedInputRefs:xa,scriptMode:le,setScriptMode:ee,matchPairs:y==null?void 0:y.pairs,matchLeftOrder:y==null?void 0:y.leftOrder,matchRightOrder:y==null?void 0:y.rightOrder,matchSelection:y==null?void 0:y.selection,matchActiveLeft:y==null?void 0:y.activeLeft,matchActiveRight:y==null?void 0:y.activeRight,matchFeedback:Y,onMatchLeftSelect:st,onMatchRightSelect:Ra})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:`${U}/collections/${I}`,children:a.cogita.library.actions.collectionDetail})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:tt?`${rt} / ${tt}`:a.cogita.library.revision.progressUnlimited}),ce==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),ce==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),ce==="ready"&&B.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:$}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",Ia]})]})]}),Pa?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",Pa.activeCount," / ",Pa.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:Pa.counts.map((c,f)=>{const S=f+1,L=Pa.currentLevel===S,J=Pa.percentages[f]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":L,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:S}),e.jsx("strong",{children:c})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,J))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[J.toFixed(1),"%"]})]},`level-${S}`)})})]}):null,ma?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:ma.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:ma.dots.map(c=>e.jsx("span",{style:{left:`${Math.min(100,Math.max(0,c.value*100))}%`,background:`rgba(${Math.round(255*(1-c.value))}, ${Math.round(200*c.value)}, 80, 0.9)`}},c.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:ma.knownCount})]})]}):null,ha?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:ot})]})}):null]})]})]})})})]})]})}const dr=[{type:"source.translation",label:"Translation source"},{type:"source.info.all",label:"All infos"},{type:"source.info",label:"Info source"},{type:"source.connection",label:"Connection source"},{type:"filter.tag",label:"Tag filter"},{type:"filter.language",label:"Language filter"},{type:"logic.and",label:"AND"},{type:"logic.or",label:"OR"},{type:"output.collection",label:"Collection output"}],Fn={"filter.tag":{scope:"any"},"filter.language":{scope:"any"},"source.info":{infoType:"word"},"source.connection":{connectionType:"translation"}},An=[{value:"translation",label:"Translation"},{value:"word-language",label:"Word ↔ Language"},{value:"language-sentence",label:"Language ↔ Sentence"},{value:"word-topic",label:"Word ↔ Topic"}],Bn=[{value:"word",label:"Word"},{value:"sentence",label:"Sentence"},{value:"language",label:"Language"},{value:"topic",label:"Topic"},{value:"computed",label:"Computed"}];function Dn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:l,collectionId:I}){const[m,j]=i.useState(""),[U,G,W]=xr([]),[d,b,p]=yr([]),[ne,F]=i.useState(null),[k,Q]=i.useState(null),[R,oe]=i.useState(null),B=`/#/cogita/library/${l}`;i.useEffect(()=>{Ht(l,I).then(o=>j(o.name)).catch(()=>j(a.cogita.library.collections.defaultName))},[l,I,a]),i.useEffect(()=>{Ci({libraryId:l,collectionId:I}).then(o=>{if(!o.graphId||o.graphId==="00000000-0000-0000-0000-000000000000"){G([]),b([]);return}const X=o.nodes.map(M=>{var Ne;const ye=M.payload??{},ie=ye.position??{x:120,y:120},ae=ye.params??{};return{id:M.nodeId,type:"default",position:ie,data:{nodeType:M.nodeType,label:((Ne=dr.find(Ee=>Ee.type===M.nodeType))==null?void 0:Ne.label)??M.nodeType,params:ae}}}),w=o.edges.map(M=>({id:M.edgeId,source:M.fromNodeId,target:M.toNodeId,sourceHandle:M.fromPort??void 0,targetHandle:M.toPort??void 0}));G(X),b(w)}).catch(()=>{G([]),b([])})},[l,I,b,G]);const D=i.useMemo(()=>U.find(o=>o.id===ne)??null,[U,ne]),pe=o=>{var ye;const X=crypto.randomUUID(),w=((ye=dr.find(ie=>ie.type===o))==null?void 0:ye.label)??o,M={...Fn[o]};G(ie=>[...ie,{id:X,type:"default",position:{x:120+ie.length*40,y:120+ie.length*40},data:{nodeType:o,label:w,params:M}}]),F(X)},ke=i.useCallback(o=>{b(X=>jt({...o,id:crypto.randomUUID()},X))},[b]),ce=async()=>{Q(null);try{await zr({libraryId:l,collectionId:I,nodes:U.map(o=>({nodeId:o.id,nodeType:o.data.nodeType,payload:{position:o.position,params:o.data.params}})),edges:d.map(o=>({edgeId:o.id,fromNodeId:o.source,fromPort:o.sourceHandle??null,toNodeId:o.target,toPort:o.targetHandle??null}))}),Q(a.cogita.library.graph.saveSuccess)}catch{Q(a.cogita.library.graph.saveFail)}},V=async()=>{try{const o=await Mi({libraryId:l,collectionId:I});oe(o)}catch{oe(null)}},he=o=>{D&&G(X=>X.map(w=>w.id===D.id?{...w,data:{...w.data,params:o}}:w))};return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-library-dashboard","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.kicker}),e.jsx("h1",{className:"cogita-library-title",children:m}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.graph.subtitle})]}),e.jsxs("div",{className:"cogita-library-actions",children:[e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita}),e.jsx("a",{className:"cta ghost",href:`${B}/collections/${I}`,children:a.cogita.library.actions.collectionDetail}),e.jsx("button",{type:"button",className:"cta ghost",onClick:V,children:a.cogita.library.graph.preview}),e.jsx("button",{type:"button",className:"cta",onClick:ce,children:a.cogita.library.graph.save})]})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-collection-graph",children:[e.jsxs("div",{className:"cogita-graph-palette",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.palette}),e.jsx("div",{className:"cogita-graph-palette-grid",children:dr.map(o=>e.jsx("button",{type:"button",className:"ghost",onClick:()=>pe(o.type),children:o.label},o.type))}),k?e.jsx("p",{className:"cogita-help",children:k}):null,R&&e.jsxs("div",{className:"cogita-graph-preview",children:[e.jsx("p",{children:a.cogita.library.graph.previewLabel.replace("{total}",String(R.total))}),e.jsx("p",{children:a.cogita.library.graph.previewBreakdown.replace("{connections}",String(R.connections)).replace("{infos}",String(R.infos))})]})]}),e.jsx("div",{className:"cogita-graph-canvas",children:e.jsxs(Ut,{nodes:U,edges:d,onNodesChange:W,onEdgesChange:p,onConnect:ke,onNodeClick:(o,X)=>F(X.id),fitView:!0,children:[e.jsx(Wt,{color:"rgba(120,160,200,0.2)"}),e.jsx(zt,{})]})}),e.jsxs("div",{className:"cogita-graph-panel",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.graph.inspector}),D?e.jsxs("div",{className:"cogita-graph-panel-body",children:[e.jsx("p",{className:"cogita-graph-node-title",children:D.data.label}),D.data.nodeType==="filter.tag"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"topic",label:a.cogita.library.graph.tagLabel,placeholder:a.cogita.library.graph.tagPlaceholder,value:D.data.params.tagId?{id:D.data.params.tagId,label:D.data.params.tagLabel??"",infoType:"topic"}:null,onChange:o=>he({...D.data.params,tagId:(o==null?void 0:o.id)??null,tagLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.topic),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:D.data.params.scope??"any",onChange:o=>he({...D.data.params,scope:o.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"translation",children:a.cogita.library.graph.scopeTranslation}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),D.data.nodeType==="filter.language"&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{libraryId:l,infoType:"language",label:a.cogita.library.graph.languageLabel,placeholder:a.cogita.library.graph.languagePlaceholder,value:D.data.params.languageId?{id:D.data.params.languageId,label:D.data.params.languageLabel??"",infoType:"language"}:null,onChange:o=>he({...D.data.params,languageId:(o==null?void 0:o.id)??null,languageLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.language),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.scopeLabel}),e.jsxs("select",{value:D.data.params.scope??"any",onChange:o=>he({...D.data.params,scope:o.target.value}),children:[e.jsx("option",{value:"any",children:a.cogita.library.graph.scopeAny}),e.jsx("option",{value:"wordA",children:a.cogita.library.graph.scopeWordA}),e.jsx("option",{value:"wordB",children:a.cogita.library.graph.scopeWordB})]})]})]}),D.data.nodeType==="source.info"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.infoTypeLabel}),e.jsx("select",{value:D.data.params.infoType??"word",onChange:o=>he({...D.data.params,infoType:o.target.value}),children:Bn.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsx(Oe,{libraryId:l,infoType:D.data.params.infoType??"word",label:a.cogita.library.graph.specificInfoLabel,placeholder:a.cogita.library.graph.specificInfoPlaceholder,value:D.data.params.infoId?{id:D.data.params.infoId,label:D.data.params.infoLabel??"",infoType:D.data.params.infoType??"word"}:null,onChange:o=>he({...D.data.params,infoId:(o==null?void 0:o.id)??null,infoLabel:(o==null?void 0:o.label)??null}),searchFailedText:a.cogita.library.lookup.searchFailed,createFailedText:a.cogita.library.lookup.createFailed,createLabel:a.cogita.library.lookup.createNew.replace("{type}",a.cogita.library.infoTypes.word),savingLabel:a.cogita.library.lookup.saving,loadMoreLabel:a.cogita.library.lookup.loadMore})]}),D.data.nodeType==="source.connection"&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionTypeLabel}),e.jsx("select",{value:D.data.params.connectionType??"translation",onChange:o=>he({...D.data.params,connectionType:o.target.value}),children:An.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("label",{className:"cogita-field",children:[e.jsx("span",{children:a.cogita.library.graph.connectionIdLabel}),e.jsx("input",{value:D.data.params.connectionId??"",onChange:o=>he({...D.data.params,connectionId:o.target.value||null}),placeholder:a.cogita.library.graph.connectionIdPlaceholder})]})]}),["logic.and","logic.or","output.collection","source.translation","source.info.all"].includes(D.data.nodeType)&&e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.noParams})]}):e.jsx("p",{className:"cogita-help",children:a.cogita.library.graph.emptyInspector})]})]})})})]})})}const ur="cogita.preferences",Kn=["library_overview","all_cards","new_card","all_collections","new_collection","dependencies"],gr={library_overview:{requiresCollection:!1,allowsRevision:!1},all_cards:{requiresCollection:!1,allowsRevision:!1},new_card:{requiresCollection:!1,allowsRevision:!1},all_collections:{requiresCollection:!0,allowsRevision:!0},new_collection:{requiresCollection:!1,allowsRevision:!1},dependencies:{requiresCollection:!1,allowsRevision:!1}},On=["detail","graph","settings","run","shared"];function qn(a,n=""){const s=a.split("/").filter(Boolean);if(s[0]!=="cogita"||s[1]!=="library")return{};const g=s[2];if(!g)return{};if(!s[3])return{libraryId:g,target:"library_overview"};const v=new URLSearchParams(n).get("revisionId")??void 0;if(s[3]==="list")return{libraryId:g,target:"all_cards",cardMode:"list",revisionId:v};if(s[3]==="detail"||s[3]==="collection")return{libraryId:g,target:"all_cards",cardMode:s[3],revisionId:v};if(s[3]==="new"||s[3]==="add")return{libraryId:g,target:"new_card",revisionId:v};if(s[3]==="shared-revisions")return{libraryId:g,target:"all_collections",revisionId:v};if(s[3]==="dependencies")return{libraryId:g,target:"dependencies"};if(s[3]!=="collections")return{libraryId:g,target:"library_overview"};if(s[4]==="new")return{libraryId:g,target:"new_collection",revisionId:v};const x=s[4];return x?s[5]==="graph"?{libraryId:g,target:"all_collections",collectionId:x,revisionId:v,revisionView:"graph"}:s[5]==="shared-revisions"?{libraryId:g,target:"all_collections",collectionId:x,revisionId:v,revisionView:"shared"}:s[5]==="revision"?{libraryId:g,target:"all_collections",collectionId:x,revisionId:v,revisionView:s[6]==="run"?"run":"settings"}:{libraryId:g,target:"all_collections",collectionId:x,revisionId:v,revisionView:"detail"}:{libraryId:g,target:"all_collections"}}function hr(a,n="library_overview",s,g,h){const v=x=>h?`${x}?revisionId=${encodeURIComponent(h)}`:x;return a?v(n==="library_overview"?`/cogita/library/${a}`:n==="all_cards"?`/cogita/library/${a}/list`:n==="new_card"?`/cogita/library/${a}/add`:n==="all_collections"?s?g==="graph"?`/cogita/library/${a}/collections/${s}/graph`:g==="settings"?`/cogita/library/${a}/collections/${s}/revision`:g==="run"?`/cogita/library/${a}/collections/${s}/revision/run`:g==="shared"?`/cogita/library/${a}/collections/${s}/shared-revisions`:`/cogita/library/${a}/collections/${s}`:`/cogita/library/${a}/collections`:n==="new_collection"?`/cogita/library/${a}/collections/new`:n==="dependencies"?`/cogita/library/${a}/dependencies`:`/cogita/library/${a}`):"/cogita"}function It(a){return a.length>1&&a.endsWith("/")?a.slice(0,-1):a}function Vn(a,n){var A;if(!a.length)return null;const s=a.filter(O=>n.has(O.roleId)),g=s.length>0?s:a,h=g.map(O=>{var l,I;const q=((I=(l=O.fields.find(m=>m.fieldType==="role_kind"))==null?void 0:l.plainValue)==null?void 0:I.toLowerCase())??"";return{roleId:O.roleId,roleKind:q}}),v=h.find(O=>O.roleKind.includes("master"));if(v)return v.roleId;const x=h.find(O=>O.roleKind.includes("account")||O.roleKind.includes("user"));return x?x.roleId:((A=g[0])==null?void 0:A.roleId)??null}function _n(a){if(!a)return{version:1,byLibrary:{}};try{const n=JSON.parse(a);return!n||typeof n!="object"?{version:1,byLibrary:{}}:{version:1,lastLibraryId:n.lastLibraryId,byLibrary:n.byLibrary??{}}}catch{return{version:1,byLibrary:{}}}}function Un({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q}){const l=ci(),I=vr(),m=i.useMemo(()=>qn(I.pathname,I.search),[I.pathname,I.search]),j=a.cogita.workspace,[U,G]=i.useState([]),[W,d]=i.useState([]),[b,p]=i.useState([]),[ne,F]=i.useState(void 0),[k,Q]=i.useState("library_overview"),[R,oe]=i.useState(void 0),[B,D]=i.useState(void 0),[pe,ke]=i.useState("detail"),[ce,V]=i.useState(!1),[he,o]=i.useState(!0),[X,w]=i.useState(!1),[M,ye]=i.useState(!1),[ie,ae]=i.useState(null),[Ne,Ee]=i.useState(""),[Me,Ae]=i.useState(""),[Se,Je]=i.useState(""),[Ke,Fe]=i.useState(null),[Ue,ra]=i.useState(null),Ie=i.useRef({version:1,byLibrary:{}}),_=i.useRef(!1),te=i.useRef(!1),Be=i.useRef(null),Ce=i.useMemo(()=>U.find(P=>P.libraryId===ne)??null,[U,ne]),be=i.useMemo(()=>W.find(P=>P.collectionId===R)??null,[W,R]),$e=i.useMemo(()=>b.find(P=>P.revisionId===B)??null,[b,B]),De=i.useMemo(()=>({detail:j.revisions.detail,graph:j.revisions.graph,settings:j.revisions.settings,run:j.revisions.run,shared:j.targets.sharedRevisions}),[j.revisions.detail,j.revisions.graph,j.revisions.run,j.revisions.settings,j.targets.sharedRevisions]),qe=i.useMemo(()=>On.map(P=>({value:P,label:De[P]})),[De.detail,De.graph,De.run,De.settings,De.shared]),Ve=i.useMemo(()=>({library_overview:j.targets.libraryOverview,all_cards:j.targets.allCards,new_card:j.targets.newCard,all_collections:j.targets.allCollections,new_collection:j.targets.newCollection,dependencies:j.targets.dependencies}),[j.targets]),y=i.useMemo(()=>Ve[k]??k,[k,Ve]),N=De[pe],Y=!!ne,t=!!R,r=Y&&k==="all_collections",u=t&&k==="all_collections",T=i.useCallback(P=>{const Le=!!P.libraryId;let we=P.target,_e=P.collectionId,ia=P.revisionId,ze=P.revisionView;Le?gr[we].requiresCollection&&!_e?(we="all_collections",ia=void 0,ze="detail"):we!=="all_collections"?(_e=void 0,ia=void 0):gr[we].allowsRevision||(ze="detail"):(we="library_overview",_e=void 0,ia=void 0,ze="detail"),F(P.libraryId),Q(we),oe(_e),D(ia),ke(ze),V(!1);const ua=It(hr(P.libraryId,we,_e,ze,ia));It(`${I.pathname}${I.search}`)!==ua&&(Be.current=ua,l(ua))},[I.pathname,I.search,l]),K=P=>{T({libraryId:ne,target:"all_collections",collectionId:R,revisionId:B,revisionView:P})},re=i.useMemo(()=>[{key:"library",label:j.layers.library,visible:!0,value:ne??"",selectedLabel:(Ce==null?void 0:Ce.name)??j.path.noLibrarySelected,disabled:he||U.length===0,options:U.map(P=>({value:P.libraryId,label:P.name})),emptyOption:j.noLibraryOption,onSelect:P=>{const Le=P||void 0;T({libraryId:Le,target:"library_overview",collectionId:void 0,revisionId:void 0,revisionView:"detail"})}},{key:"target",label:j.layers.target,visible:Y,value:k,selectedLabel:y,disabled:!Y,options:Kn.map(P=>({value:P,label:Ve[P]})),onSelect:P=>{T({libraryId:ne,target:P,collectionId:R,revisionId:B,revisionView:pe})}},{key:"collection",label:j.layers.collection,visible:r,value:R??"",selectedLabel:(be==null?void 0:be.name)??j.path.noCollectionSelected,disabled:!Y||X||W.length===0,options:W.map(P=>({value:P.collectionId,label:P.name})),emptyOption:j.selectCollectionOption,onSelect:P=>{T({libraryId:ne,target:"all_collections",collectionId:P||void 0,revisionId:void 0,revisionView:pe})}},{key:"revision_entry",label:j.layers.revision,visible:t,value:B??"",selectedLabel:($e==null?void 0:$e.name)??j.status.noRevisions,disabled:!t||M||b.length===0,options:b.map(P=>({value:P.revisionId,label:P.name})),emptyOption:j.status.noRevisions,onSelect:P=>{T({libraryId:ne,target:"all_collections",collectionId:R,revisionId:P||void 0,revisionView:pe})}},{key:"revision",label:j.layers.revision,visible:u,value:pe,selectedLabel:N,disabled:!R,options:qe.map(P=>({value:P.value,label:P.label})),onSelect:P=>{K(P)}}],[W,X,U,he,T,b,M,qe,be,R,$e,B,t,Y,Ce,ne,N,pe,k,y,r,u,Ve,j.layers.collection,j.layers.library,j.layers.revision,j.layers.target,j.noLibraryOption,j.path.noCollectionSelected,j.path.noLibrarySelected,j.selectCollectionOption]),le=i.useMemo(()=>re.filter(P=>P.visible),[re]),ee=i.useMemo(()=>le.filter(P=>P.key!=="library"&&P.key!=="collection"&&P.key!=="revision_entry"),[le]),de=i.useMemo(()=>ee.find(P=>P.key==="target")??null,[ee]),se=i.useMemo(()=>ee.find(P=>P.key==="revision")??null,[ee]),ve=i.useMemo(()=>{const P=m.libraryId;if(!P||!I.pathname.startsWith("/cogita/library/"))return null;const Le={copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,libraryId:P};if(m.target==="library_overview")return e.jsx(Hi,{...Le});if(m.target==="all_cards")return e.jsx(Gi,{...Le,mode:m.cardMode??"list"});if(m.target==="new_card")return e.jsx(tn,{...Le});if(m.target==="dependencies")return e.jsx(nn,{...Le});if(m.target==="all_collections"){if(m.collectionId){const we={...Le,collectionId:m.collectionId};return m.revisionView==="graph"?e.jsx(Dn,{...we}):m.revisionView==="shared"?e.jsx(ln,{...Le,collectionId:m.collectionId}):m.revisionView==="settings"?e.jsx(jn,{...we,revisionId:m.revisionId}):m.revisionView==="run"?e.jsx(En,{...we,revisionId:m.revisionId}):e.jsx(gn,{...we})}return e.jsx(on,{...Le})}return m.target==="new_collection"?e.jsx(un,{...Le,onCreated:we=>l(`/cogita/library/${P}/collections/${we}/graph`)}):null},[n,a,O,I.pathname,l,q,v,A,g,h,m.cardMode,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target,x,s]);i.useEffect(()=>{let P=!1;return(async()=>{var we,_e,ia,ze,ua,aa,ga;o(!0);try{await Ii();const[xa,ya,ea]=await Promise.all([qr(),Pi(),Ri()]);if(P)return;G(xa);const sa=new Set(ea.nodes.filter(ta=>ta.nodeType==="role"&&ta.canLink).map(ta=>ta.roleId??"")),Ta=Vn(ya,sa);if(Fe(Ta),Ta){const ta=ea.nodes.find(va=>va.nodeType==="data"&&va.roleId===Ta&&(va.fieldType===ur||va.label===ur));ra((ta==null?void 0:ta.dataKeyId)??null),Ie.current=_n(ta==null?void 0:ta.value)}const Da=Ie.current.lastLibraryId,Na=((we=xa.find(ta=>ta.libraryId===m.libraryId))==null?void 0:we.libraryId)??(xa.length===1?xa[0].libraryId:void 0)??((_e=xa.find(ta=>ta.libraryId===Da))==null?void 0:_e.libraryId)??((ia=xa[0])==null?void 0:ia.libraryId),ba=(Na&&((ua=(ze=Ie.current.byLibrary)==null?void 0:ze[Na])==null?void 0:ua.lastTarget))??"library_overview";F(Na),Q(m.target??ba),D(m.revisionId??(Na?(ga=(aa=Ie.current.byLibrary)==null?void 0:aa[Na])==null?void 0:ga.lastRevisionId:void 0)),ke(m.revisionView??"detail"),_.current=!0}catch{P||ae(j.status.loadFailed)}finally{P||o(!1)}})(),()=>{P=!0}},[j.status.loadFailed]),i.useLayoutEffect(()=>{_.current&&(m.libraryId&&U.some(P=>P.libraryId===m.libraryId)&&F(m.libraryId),m.target&&Q(m.target),oe(m.collectionId),D(m.revisionId),m.revisionView&&ke(m.revisionView))},[U,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target]),i.useEffect(()=>{if(!ne){d([]),oe(void 0),p([]),D(void 0);return}let P=!1;return w(!0),$t({libraryId:ne,limit:200}).then(Le=>{var ia;if(P)return;const we=Le.items;d(we);const _e=(ia=we.find(ze=>ze.collectionId===m.collectionId))==null?void 0:ia.collectionId;oe(_e)}).catch(()=>{P||(d([]),oe(void 0))}).finally(()=>{P||w(!1)}),()=>{P=!0}},[m.collectionId,ne]),i.useEffect(()=>{if(!ne||!R){p([]),D(void 0);return}let P=!1;return ye(!0),Si({libraryId:ne,collectionId:R}).then(Le=>{var ia,ze,ua,aa;if(P)return;p(Le);const we=(ze=(ia=Ie.current.byLibrary)==null?void 0:ia[ne])==null?void 0:ze.lastRevisionId,_e=((ua=Le.find(ga=>ga.revisionId===m.revisionId))==null?void 0:ua.revisionId)??((aa=Le.find(ga=>ga.revisionId===we))==null?void 0:aa.revisionId);D(_e)}).catch(()=>{P||(p([]),D(void 0))}).finally(()=>{P||ye(!1)}),()=>{P=!0}},[m.revisionId,R,ne]),i.useEffect(()=>{if(!_.current||m.libraryId&&U.some(we=>we.libraryId===m.libraryId)&&m.libraryId!==ne||m.target&&m.target!==k||m.revisionView&&m.revisionView!==pe||m.revisionId&&m.revisionId!==B||gr[k].requiresCollection&&!R&&m.target==="all_collections"&&m.collectionId)return;const P=It(`${I.pathname}${I.search}`),Le=It(hr(ne,k,R,pe,B));if(P===Le){Be.current=null;return}Be.current!==Le&&(Be.current=Le,l(Le,{replace:!0}))},[U,I.pathname,l,m.collectionId,m.libraryId,m.revisionId,m.revisionView,m.target,R,ne,B,pe,k]),i.useEffect(()=>{if(typeof window>"u")return;const P=()=>{window.innerWidth>920&&V(!1)};return window.addEventListener("resize",P),()=>window.removeEventListener("resize",P)},[]),i.useEffect(()=>{if(!_.current||!Ke||!ne||te.current)return;const P=Ie.current,Le={...P.byLibrary??{}},we={...Le[ne]??{},lastCollectionId:R,lastRevisionId:B,lastRevisionView:pe,lastTarget:k},_e={version:1,lastLibraryId:ne,byLibrary:{...Le,[ne]:we}},ia=JSON.stringify(P),ze=JSON.stringify(_e);if(ia===ze)return;Ie.current=_e,te.current=!0,(async()=>{try{if(Ue)await $i(Ue,{plainValue:ze});else{const aa=await Ei(Ke,{itemName:ur,itemType:"data",plainValue:ze});ra(aa.dataItemId)}}catch{ae(j.status.savePrefsFailed)}finally{te.current=!1}})()},[Ue,Ke,R,ne,B,pe,k,j.status.savePrefsFailed]);const Xe=async()=>{const P=Ne.trim();if(!P){ae(a.cogita.user.libraryNameRequired);return}ae(null);try{const Le=await Fi({name:P});G(we=>[Le,...we]),F(Le.libraryId),Q("library_overview"),oe(void 0),Ee("")}catch{ae(a.cogita.user.libraryCreateFailed)}},Qe=async()=>{if(!ne){ae(j.status.selectLibraryFirst);return}const P=Me.trim();if(!P){ae(a.cogita.library.collections.saveRequiredName);return}ae(null);try{const Le=await Wr({libraryId:ne,name:P,items:[]}),we=await $t({libraryId:ne,limit:200});d(we.items),oe(Le.collectionId),D(void 0),Q("all_collections"),ke("detail"),Ae("")}catch{ae(a.cogita.library.collections.saveFail)}},Ze=async()=>{if(!ne||!R){ae(j.status.selectLibraryFirst);return}const P=Se.trim();if(!P){ae(j.revisionForm.nameLabel);return}ae(null);try{const Le=await Ai({libraryId:ne,collectionId:R,name:P,revisionType:"random",revisionSettings:null,mode:"random",check:"exact",limit:20});p(we=>[Le,...we]),D(Le.revisionId),Q("all_collections"),ke("settings"),Je("")}catch{ae(j.status.loadFailed)}};return e.jsx(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:e.jsxs("section",{className:"cogita-browser-shell",children:[e.jsxs("aside",{className:`cogita-browser-sidebar ${ce?"open":""}`,"aria-label":j.sidebar.title,children:[e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h2",{children:(Ce==null?void 0:Ce.name)??j.path.noLibrarySelected}),e.jsx("p",{className:"cogita-sidebar-note",children:Ce?j.sidebar.libraryActionsHint:j.status.selectLibraryFirst}),de?e.jsx("div",{className:"cogita-sidebar-actions",children:de.options.map(P=>e.jsx("button",{type:"button",className:`ghost ${String(de.value)===P.value?"active":""}`,onClick:()=>de.onSelect(P.value),disabled:de.disabled,children:P.label},`sidebar:target:${P.value}`))}):null]}),be?e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:be.name}),e.jsx("p",{className:"cogita-sidebar-note",children:j.sidebar.collectionActionsHint}),se?e.jsx("div",{className:"cogita-sidebar-actions",children:se.options.map(P=>e.jsx("button",{type:"button",className:`ghost ${String(se.value)===P.value?"active":""}`,onClick:()=>se.onSelect(P.value),disabled:se.disabled,children:P.label},`sidebar:revision:${P.value}`))}):null]}):null,e.jsxs("div",{className:"cogita-browser-sidebar-section",children:[e.jsx("h3",{children:j.sidebar.alwaysAvailable}),e.jsxs("div",{className:"cogita-sidebar-actions",children:[e.jsx("button",{type:"button",className:"ghost",onClick:g,children:j.sidebar.accountSettings}),e.jsx("button",{type:"button",className:"ghost",onClick:()=>{A("cogita"),V(!1)},children:j.sidebar.cogitaHome}),e.jsx("button",{type:"button",className:"ghost",onClick:h,children:x?a.account.secureModeDisable:a.account.secureModeEnable})]})]})]}),ce?e.jsx("button",{type:"button",className:"cogita-sidebar-backdrop","aria-label":j.sidebar.closeMenu,onClick:()=>V(!1)}):null,e.jsxs("div",{className:"cogita-browser-page",children:[e.jsxs("nav",{className:"cogita-browser-menu","aria-label":j.navigationAria,children:[e.jsx("button",{type:"button",className:"ghost cogita-sidebar-toggle",onClick:()=>V(P=>!P),"aria-label":ce?j.sidebar.closeMenu:j.sidebar.openMenu,children:e.jsxs("span",{className:"cogita-sidebar-toggle-icon","aria-hidden":"true",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})}),le.map((P,Le)=>e.jsxs("div",{className:"cogita-browser-segment",children:[Le>0?e.jsx("span",{className:"cogita-browser-separator",children:"›"}):null,e.jsxs("select",{"aria-label":P.label,value:P.value,onChange:we=>P.onSelect(we.target.value),disabled:P.disabled,children:[P.emptyOption?e.jsx("option",{value:"",children:P.emptyOption}):null,P.options.map(we=>e.jsx("option",{value:we.value,children:we.label},`${P.key}:${we.value}`))]})]},`menu:${P.key}`))]}),ve?e.jsx("section",{className:"cogita-browser-embedded",children:e.jsx(Hr.Provider,{value:!0,children:ve})}):null,ve?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cogita-browser-layout",children:[e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:j.panels.currentPosition}),e.jsxs("p",{className:"cogita-browser-path",children:[le.map((P,Le)=>e.jsxs("span",{children:[Le>0?e.jsx("span",{children:" / "}):null,e.jsx("strong",{children:P.selectedLabel})]},`path:${P.key}`)),r?null:e.jsxs("span",{children:[e.jsx("span",{children:" / "}),e.jsx("strong",{children:j.path.noCollectionLayer})]})]}),e.jsxs("p",{className:"cogita-browser-note",children:[j.path.currentRoute," ",e.jsx("code",{children:hr(ne,k,R,pe,B)})]}),ne?e.jsxs("div",{className:"cogita-browser-links",children:[e.jsx("a",{className:"ghost",href:`/#/cogita/library/${ne}`,children:j.links.libraryOverview}),e.jsx("a",{className:"ghost",href:`/#/cogita/library/${ne}/list`,children:j.links.allCards}),R?e.jsx("a",{className:"ghost",href:`/#/cogita/library/${ne}/collections/${R}/shared-revisions`,children:j.links.sharedRevisions}):null]}):null]}),e.jsxs("article",{className:"cogita-browser-panel",children:[e.jsx("h2",{children:j.panels.quickCreate}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.user.libraryNameLabel}),e.jsx("input",{type:"text",value:Ne,onChange:P=>Ee(P.target.value),placeholder:a.cogita.user.libraryNamePlaceholder})]}),e.jsx("button",{type:"button",className:"cta",onClick:Xe,children:a.cogita.user.createLibraryAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:a.cogita.library.collections.nameLabel}),e.jsx("input",{type:"text",value:Me,onChange:P=>Ae(P.target.value),placeholder:a.cogita.library.collections.namePlaceholder,disabled:!ne})]}),e.jsx("button",{type:"button",className:"cta",onClick:Qe,disabled:!ne,children:a.cogita.library.collections.createAction}),e.jsxs("label",{className:"cogita-field full",children:[e.jsx("span",{children:j.revisionForm.nameLabel}),e.jsx("input",{type:"text",value:Se,onChange:P=>Je(P.target.value),placeholder:j.revisionForm.namePlaceholder,disabled:!R})]}),e.jsx("button",{type:"button",className:"cta",onClick:Ze,disabled:!R,children:j.revisionForm.createAction}),ie?e.jsx("p",{className:"cogita-form-error",children:ie}):null]})]}),e.jsxs("section",{className:"cogita-browser-collections",children:[e.jsx("h2",{children:j.panels.collections}),X?e.jsx("p",{className:"cogita-library-subtitle",children:j.status.loadingCollections}):null,!X&&W.length===0?e.jsx("p",{className:"cogita-library-subtitle",children:j.status.noCollections}):null,W.length>0?e.jsx("div",{className:"cogita-card-list","data-view":"list",children:W.map(P=>e.jsxs("button",{type:"button",className:`cogita-card-item ${P.collectionId===R?"active":""}`,onClick:()=>{oe(P.collectionId),D(void 0),ke("detail")},children:[e.jsx("div",{className:"cogita-card-type",children:j.cards.collectionType}),e.jsx("h3",{className:"cogita-card-title",children:P.name}),e.jsxs("p",{className:"cogita-card-subtitle",children:[P.itemCount," ",j.cards.itemsSuffix]})]},P.collectionId))}):null]})]})]})]})})}const Qn=Object.freeze(Object.defineProperty({__proto__:null,CogitaWorkspacePage:Un},Symbol.toStringTag,{value:"Module"}));function Wn({copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,shareId:l}){const[I,m]=i.useState(null),[j,U]=i.useState("loading"),[G,W]=i.useState(a.cogita.library.collections.defaultName),[d,b]=i.useState("Cogita Library"),[p,ne]=i.useState([]),[F,k]=i.useState([]),[Q,R]=i.useState("idle"),[oe,B]=i.useState({current:0,total:0}),[D,pe]=i.useState(0),[ke,ce]=i.useState(""),[V,he]=i.useState(null),[o,X]=i.useState(null),[w,M]=i.useState(null),[ye,ie]=i.useState(null),[ae,Ne]=i.useState([]),[Ee,Me]=i.useState({}),[Ae,Se]=i.useState({}),[Je,Ke]=i.useState(null),[Fe,Ue]=i.useState(null),[ra,Ie]=i.useState(null),[_,te]=i.useState(null),[Be,Ce]=i.useState({}),be=i.useRef(0),[$e,De]=i.useState(null),qe=i.useRef(null),Ve=i.useRef(null),[y,N]=i.useState(null),[Y,t]=i.useState(!1),[r,u]=i.useState(null),[T,K]=i.useState([]),[re,le]=i.useState(null),ee=i.useRef(null),de=i.useRef(null),[se,ve]=i.useState(null),[Xe,Qe]=i.useState(0),Ze=i.useRef(null),P=i.useRef({}),[Le,we]=i.useState(!1),[_e,ia]=i.useState({}),ze=i.useRef(null),ua=i.useRef(new Set),aa=i.useRef({}),[ga,xa]=i.useState([]),[ya,ea]=i.useState(new Set),[sa,Ta]=i.useState(!1),Da=vr(),Na=i.useMemo(()=>new URLSearchParams(Da.search),[Da.search]),ba=i.useMemo(()=>Na.get("key")??"",[Na]),ta=(I==null?void 0:I.mode)??"random",va=(I==null?void 0:I.check)??"exact",wa=(I==null?void 0:I.limit)??20,He=i.useMemo(()=>Nr((I==null?void 0:I.revisionType)??ta),[I,ta]),na=i.useMemo(()=>{const $=I==null?void 0:I.revisionSettings,Z=Zr(He,Na);return Qt(He,$??Z)},[I,Na,He]),$a=i.useMemo(()=>a.cogita.library.revision[He.labelKey]??ta,[a,ta,He]),Ka=i.useMemo(()=>va==="exact"?a.cogita.library.revision.checkValue:va,[a,va]),je=j==="ready"?p[D]??null:null,Za=(je==null?void 0:je.checkType)==="translation-match"&&_,Oa=i.useRef(new Map),et=i.useRef(new Map),at=i.useRef(new Map),pt=i.useRef(new Map),Gt=i.useMemo(()=>je?je.cardType==="vocab"?a.cogita.library.revision.vocabLabel:je.infoType?Ge(a,je.infoType):a.cogita.library.revision.infoLabel:"",[a,je]),tt=i.useMemo(()=>{var Z;return He.id!=="levels"?p.length:((Z=_e.pool)==null?void 0:Z.length)??He.getFetchLimit(wa,na)},[_e,na,He,p.length,wa]),rt=He.getProgressTotal?He.getProgressTotal(p,_e,wa,na):He.id==="levels"?Math.min(wa,tt):p.length,Ia=rt?Math.min(D+1,rt):0,ja=Math.max(1,Number(na.tries??1)),qa=na.compare??"anchors",ha=Math.max(0,Math.min(100,Number(na.minCorrectness??0))),la=(na.considerDependencies??"on")==="on",Sa=Math.max(0,Math.min(100,Number(na.dependencyThreshold??85))),Wa=$=>{const Z=$.slice();for(let c=Z.length-1;c>0;c-=1){const f=Math.floor(Math.random()*(c+1));[Z[c],Z[f]]=[Z[f],Z[c]]}return Z},Va=$=>$.length?$.reduce((c,f)=>c+f,0)/$.length/255*100:0,it=$=>Va($)>=ha,Xt=async()=>{const $=await Ba(),Z=new Map,c=new Map;$.forEach(L=>{const J=`${L.itemType}:${L.itemId}`,C=Fa(L.itemType,L.itemId,L.checkType,L.direction);Z.has(J)||Z.set(J,[]),Z.get(J).push(L),c.has(C)||c.set(C,[]),c.get(C).push(L)});const f=new Map,S=new Map;return Z.forEach((L,J)=>f.set(J,Aa(L).score)),c.forEach((L,J)=>S.set(J,Aa(L).score)),{itemKnowness:f,cardKnowness:S}},ft=async $=>{const Z=_e,c=$.concat(Z.active??[]).concat(Z.pool??[]).filter((H,ue,ge)=>ge.findIndex(xe=>me(xe)===me(H))===ue);if(!la){ea(new Set(c.map(me)));return}const{itemKnowness:f,cardKnowness:S}=await Xt(),L=H=>{if(H.cardType!=="info"||H.infoType!=="quote"||H.checkType!=="quote-fragment")return!0;const ue=ka(H.direction);if(!(ue!=null&&ue.fragmentId))return!0;const ge=H.description??"";if(!ge.trim())return!0;const fe=bt(ge).nodes[ue.fragmentId];if(!fe||!fe.leftId&&!fe.rightId)return!0;const Pe=[fe.leftId,fe.rightId].filter(Ye=>!!Ye);if(Pe.length===0)return!0;const Re=Pe.map(Ye=>{const ca=Fa("info",H.cardId,"quote-fragment",wt(ue.mode,Ye));return S.get(ca)??0});return Re.reduce((Ye,ca)=>Ye+ca,0)/Re.length>=Sa},J=(I==null?void 0:I.collectionId)??null,C=J?ga.filter(H=>da(H.childItemType)==="collection"&&H.childItemId===J&&!da(H.childCheckType)&&!da(H.childDirection)):[],z=J&&c.length>0?c.reduce((H,ue)=>H+(S.get(me(ue))??0),0)/c.length:0,E=new Set;for(const H of c){if(H.cardType!=="info"){E.add(me(H));continue}if(!L(H))continue;const ue=ga.filter(fe=>ni(fe,H)).concat(C);if(ue.length===0){E.add(me(H));continue}let ge=0;for(const fe of ue)if(da(fe.parentItemType)==="collection")ge+=fe.parentItemId===J?z:0;else if(da(fe.parentCheckType)||da(fe.parentDirection)){const Pe=da(fe.parentCheckType),Re=da(fe.parentDirection),We=Fa(fe.parentItemType,fe.parentItemId,Pe,Re);ge+=S.get(We)??0}else{const Pe=`${fe.parentItemType}:${fe.parentItemId}`;ge+=f.get(Pe)??0}ge/ue.length>=Sa&&E.add(me(H))}ea(E)},Zt=$=>{for(let Z=$;Z<p.length;Z+=1){const c=p[Z];if(c&&(!la||c.cardType!=="info"||ya.has(me(c))))return Z}return-1},nt=$=>!la||$.cardType!=="info"||ya.has(me($)),er=$=>{if(He.id!=="temporal"&&He.id!=="levels")return null;const Z=_e,c=(Z.active??[]).concat(Z.pool??[]),f=new Set;for(const S of c){const L=me(S);if(!(f.has(L)||$.has(L))&&(f.add(L),nt(S)))return S}return null},La=i.useMemo(()=>{if(He.id!=="levels")return null;const $=_e,Z=$.pool??[],c=$.active??[],f=$.levelMap??{},S=Math.max(1,Number(na.levels??1)),L=Array.from({length:S},()=>0),J=new Set(c.map(H=>me(H)));Z.forEach(H=>{const ue=Math.min(S,Math.max(1,f[me(H)]??1));L[ue-1]+=1});const C=Z.length||1,z=L.map(H=>H/C*100),E=je?f[me(je)]??1:null;return{counts:L,percentages:z,currentLevel:E,levelsCount:S,activeCount:c.length,poolCount:Z.length,activeSet:J}},[_e,na,He,je]),lt=i.useMemo(()=>{if(He.id!=="temporal")return null;const $=_e,Z=$.pool??[],c=$.active??[],f=$.knownessMap??{},S=new Set($.unknownSet??[]);let L=0;Z.forEach(z=>{(f[me(z)]??0)>1&&(L+=1)});const J=S.size,C=c.map(z=>({id:me(z),value:S.has(me(z))?0:Math.max(0,Math.min(1,f[me(z)]??0))}));return{knownCount:L,unknownCount:J,dots:C}},[_e,He]),Pa=i.useMemo(()=>{if(!la)return 0;const $=_e;return p.concat($.active??[]).concat($.pool??[]).filter((c,f,S)=>S.findIndex(L=>me(L)===me(c))===f).filter(c=>c.cardType==="info"&&!ya.has(me(c))).length},[la,_e,p,ya]);i.useEffect(()=>{if(!la||Q!=="ready")return;const $=_e,c=p.concat($.active??[]).concat($.pool??[]).filter((L,J,C)=>C.findIndex(z=>me(z)===me(L))===J).filter(L=>L.cardType!=="info"||ya.has(me(L))).length,f=ee.current;if(ee.current=c,f===null||c<=f)return;const S=c-f;le(`New card available (+${S})`),de.current&&window.clearTimeout(de.current),de.current=window.setTimeout(()=>le(null),2200)},[la,Q,_e,p,ya]),i.useEffect(()=>()=>{de.current&&window.clearTimeout(de.current)},[]);const ma=($,Z)=>{const c=He.applyOutcome({queue:p,meta:_e},je,wa,na,{correct:$,correctness:Z,createdUtc:new Date().toISOString()});ne(c.queue),ia(c.meta);const f=c.queue[D+1];f&&Ca(f,D+1)};i.useEffect(()=>{if(!l){U("error");return}U("loading"),Bi({shareId:l,key:ba}).then($=>{m($),W($.collectionName),b($.libraryName),U("ready")}).catch(()=>{U("error")})},[l,ba]),i.useEffect(()=>{l&&Di({shareId:l,key:ba,type:"language"}).then($=>k($)).catch(()=>k([]))},[l,ba]),i.useEffect(()=>{!l||j!=="ready"||Ki({shareId:l,key:ba}).then($=>xa($.items??[])).catch(()=>xa([]))},[l,ba,j]),i.useEffect(()=>{if(!l||j!=="ready")return;let $=!0;return(async()=>{R("loading"),B({current:0,total:He.id==="levels"?0:He.getFetchLimit(wa,na)});try{const c=[];let f=null,S=null;do{const ue=await Oi({shareId:l,key:ba,limit:300,cursor:f});if(c.push(...ue.items),(He.id==="levels"||He.id==="temporal")&&ue.total&&(S=ue.total),B(ge=>({current:c.length,total:ge.total||ue.total||He.getFetchLimit(wa,na)})),f=ue.nextCursor??null,S!==null&&c.length>=S||He.id!=="levels"&&He.id!=="temporal"&&c.length>=He.getFetchLimit(wa,na))break}while(f);if(!$)return;const L=fr(c);let J;if(He.id==="levels"){const ue=Math.max(1,Number(na.levels??1));J={},L.forEach(ge=>{const xe=me(ge);J[xe]=Math.max(1,Math.min(ue,1))})}let C=null,z=null,E=null;if(He.id==="temporal"){const ue=await Ba(),ge=new Set(L.map(Pe=>me(Pe))),xe=ue.reduce((Pe,Re)=>{const We=Fa(Re.itemType,Re.itemId,Re.checkType,Re.direction);return ge.has(We)&&(Pe[We]||(Pe[We]=[]),Pe[We].push(Re)),Pe},{});C={},z=new Set,E={};const fe=Date.now();L.forEach(Pe=>{const Re=me(Pe),We=xe[Re]??[];if(We.length===0){C[Re]=0,z.add(Re),E[Re]=[];return}const Ye=kr(We);E[Re]=Ye;const ca=Jt(Ye,fe);C[Re]=ca.knowness})}const H=He.id==="levels"?Tr(L,wa,na,J):He.id==="temporal"?wr(L,wa,na,C??{},z??new Set,E??{}):He.prepare(L,wa,na);ne(H.queue),ia(H.meta),pe(0),R("ready"),B(ue=>({current:Math.min(ue.current,ue.total),total:ue.total}))}catch{$&&R("error")}})(),()=>{$=!1}},[l,ba,wa,He,na,j]),i.useEffect(()=>{ft(p)},[p,ga,la,Sa,I==null?void 0:I.collectionId]),i.useEffect(()=>{if(!je||!la){Ta(!1);return}if(je.cardType!=="info"||ya.has(me(je))){Ta(!1);return}const $=Zt(D+1);if($>=0){Ta(!1),pe($);return}if(He.id==="temporal"||He.id==="levels"){const Z=p.slice(0,D+1),c=p.slice(D+1).filter(nt),f=Z.concat(c),S=new Set(f.map(me)),L=er(S);if(L){const C=me(L);S.has(C)||(f.push(L),S.add(C),ia(z=>{const E=z,H=new Set(E.queued??[]);return H.add(C),{...E,queued:H}}))}const J=f.findIndex((C,z)=>z!==D&&nt(C));if(J>=0){ne(f),pe(J),Ta(!1);return}}Ta(!0)},[je,ya,la,D,p,_e,He.id]),i.useEffect(()=>{if(ce(""),he(null),ve(null),Qe(0),Ne([]),Me({}),Se({}),Ke(null),Ue(null),Ie(null),t(!1),we(!1),N(null),te(null),Ce({}),!je){X(null),M(null);return}je.cardType==="info"&&je.infoType==="computed"&&X(a.cogita.library.revision.loadingComputed);let $=!0;return Ca(je,D).then(Z=>{!$||!Z||(X(Z.prompt),M(Z.expectedAnswer),Ne(Z.computedExpected),Me(Z.computedAnswers),Ke(Z.answerTemplate),Ue(Z.outputVariables),Ie(Z.variableValues))}),()=>{$=!1}},[je,l,a]),i.useEffect(()=>{if(!je||je.cardType!=="info"||je.infoType!=="quote"){ze.current=null,ua.current=new Set,ie(null);return}const $=je.description??"",Z=(je.label??"").trim(),c=Z.replace(/\s+/g," ").trim(),f=$.replace(/\s+/g," ").trim(),S=c&&c!==f?Z:a.cogita.library.infoTypes.quote;if(!$){ie(null),M(null);return}const L=bt($);ze.current=L,X(S);let J=!0;return Ba().then(C=>{if(!J)return;const z=getQuoteMode(je.direction),E=new Map;C.forEach(fe=>{if(fe.itemType!=="info"||fe.checkType!=="quote-fragment"||!fe.direction)return;const Pe=ka(fe.direction);if(!Pe||Pe.mode!==z)return;const Re=`${fe.itemId}:${Pe.fragmentId}`;E.has(Re)||E.set(Re,[]),E.get(Re).push(fe)});const H={},ue=new Set;E.forEach((fe,Pe)=>{const[Re,We]=Pe.split(":",2);if(Re!==je.cardId)return;const Ye=Aa(fe).score;H[We]=Ye,Ye>=Sa&&ue.add(We)}),ua.current=ue,aa.current=H;const ge=ka(je.direction);if(ge!=null&&ge.fragmentId&&L.nodes[ge.fragmentId]){Ja(L,ge.fragmentId,S);return}const xe=gt(L,ue,H,Sa,la,je.direction);Ja(L,(xe==null?void 0:xe.id)??null,S)}).catch(()=>{ua.current=new Set,aa.current={};const C=ka(je.direction);if(C!=null&&C.fragmentId&&L.nodes[C.fragmentId]){Ja(L,C.fragmentId,S);return}const z=gt(L,ua.current,{},Sa,la,je.direction);Ja(L,(z==null?void 0:z.id)??null,S)}),()=>{J=!1}},[je,a,la,Sa]),i.useEffect(()=>{if(!je||je.cardType!=="vocab"||je.checkType!=="translation-match"){te(null),Ce({});return}const c=(_e.pool??_e.active??p).filter(C=>C.cardType==="vocab"&&C.checkType==="translation-match").filter((C,z,E)=>E.findIndex(H=>H.cardId===C.cardId)===z);c.some(C=>C.cardId===je.cardId)||c.unshift(je);const S=Wa(c).slice(0,6).map(C=>{const z=C.label.split("↔").map(ue=>ue.trim()).filter(Boolean);if(z.length<2)return null;const E=`${C.cardId}:L`,H=`${C.cardId}:R`;return{cardId:C.cardId,leftId:E,rightId:H,leftLabel:z[0],rightLabel:z[1]}}).filter(Boolean),L=S.map(C=>C.leftId),J=Wa(S.map(C=>C.rightId));te({pairs:S,leftOrder:L,rightOrder:J,selection:{},activeLeft:null,activeRight:null,locked:{}})},[je,p,_e]),i.useEffect(()=>()=>{qe.current&&window.clearTimeout(qe.current),Ve.current&&window.clearTimeout(Ve.current)},[]);const ot=i.useRef(null);i.useEffect(()=>{if(!je)return;const $=me(je),Z=typeof document<"u"?document.activeElement:null;if(ot.current===$&&Z&&(Z.tagName==="INPUT"||Z.tagName==="TEXTAREA"))return;let c=0;const f=()=>{if(je){if(je.cardType==="info"&&je.infoType==="computed"){if(ae.length>0){const L=_t(Je,ae,Fe),J=L?P.current[L]:null;if(J&&(J.focus(),document.activeElement===J)){ot.current=$;return}}if(Ze.current&&(Ze.current.focus(),document.activeElement===Ze.current)){ot.current=$;return}}else if(je.cardType==="vocab"&&Ze.current&&(Ze.current.focus(),document.activeElement===Ze.current)){ot.current=$;return}c<6&&(c+=1,window.setTimeout(f,40))}},S=window.setTimeout(f,40);return()=>window.clearTimeout(S)},[je,ae,Je,Fe]),i.useEffect(()=>{if(!Le)return;const $=Z=>{Z.key==="Enter"&&(Z.preventDefault(),st())};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[Le]);const pa=$=>{K($),u(Aa($))};i.useEffect(()=>{if(!je){u(null),K([]);return}const $=je.cardType==="info"?"info":"connection";if(je.cardType==="info"&&je.infoType==="quote"){Ba().then(Z=>{const c=Z.filter(f=>f.itemType==="info"&&f.itemId===je.cardId&&f.checkType==="quote-fragment"&&qt(f.direction,je.direction));pa(c)}).catch(()=>{u(null),K([])});return}Kt($,je.cardId,je.checkType,je.direction).then(Z=>pa(Z)).catch(()=>{u(null),K([])})},[je]);const za=($,Z,c,f)=>{if($==="info"&&c==="quote-fragment"){Ba().then(S=>{const L=S.filter(J=>J.itemType==="info"&&J.itemId===Z&&J.checkType==="quote-fragment"&&qt(J.direction,f));pa(L)}).catch(()=>{u(null),K([])});return}Kt($,Z,c,f).then(S=>pa(S)).catch(()=>{u(null),K([])})},Ha=($,Z,c)=>{var J;const f=((J=c.pairs.find(C=>C.leftId===$))==null?void 0:J.rightId)??null;if(!f)return c;const S=f===Z;Ce(C=>({...C,[$]:S?"correct":"incorrect"})),qe.current&&window.clearTimeout(qe.current),Ve.current&&window.clearTimeout(Ve.current),be.current+=1;const L={kind:S?"correct":"incorrect",tick:be.current};if(De(null),qe.current=window.setTimeout(()=>De(L),0),Ve.current=window.setTimeout(()=>De(null),420),S){const C={...c.locked,[$]:!0};return Object.keys(C).length>=c.pairs.length?(he("correct"),we(!0)):he("correct"),{...c,selection:{...c.selection,[$]:Z},activeLeft:null,activeRight:null,locked:C}}return he("incorrect"),{...c,activeLeft:null,activeRight:null}},Nt=$=>{te(Z=>!Z||Z.locked[$]?Z:Z.activeRight?Ha($,Z.activeRight,Z):{...Z,activeLeft:Z.activeLeft===$?null:$})},Lt=$=>{te(Z=>Z&&(Z.activeLeft?Ha(Z.activeLeft,$,Z):{...Z,activeRight:Z.activeRight===$?null:$}))},st=()=>{var $;if(je&&je.cardType==="info"&&je.infoType==="quote"&&ze.current&&ye&&!(($=ka(je.direction))!=null&&$.fragmentId)){const Z=gt(ze.current,ua.current,aa.current,Sa,la,je.direction,ye.fragmentId);if(Z){he(null),ce(""),t(!1),Se({}),we(!1),ve(null),Qe(0),Ja(ze.current,Z.id,ye.title);return}}he(null),ce(""),t(!1),Se({}),we(!1),ve(null),Qe(0),pe(Z=>Math.min(Z+1,p.length))},Ra=$=>{if(!je)return;const Z=$.expected??null,c=$.answer??"";let f=Z??"",S=c;if(!Z&&$.expectedMap&&$.answerMap){const ue=Object.keys($.expectedMap).sort((ge,xe)=>ge.localeCompare(xe));f=ue.map(ge=>{var xe;return((xe=$.expectedMap)==null?void 0:xe[ge])??""}).join("|"),S=ue.map(ge=>{var xe;return((xe=$.answerMap)==null?void 0:xe[ge])??""}).join("|")}const L=f?ht(f,S,qa):new Uint8Array,J={revisionType:He.id,evalType:$.evalType,direction:$.direction,prompt:o??"",expected:Z,answer:c,expectedAnswers:$.expectedMap??null,answers:$.answerMap??null,correct:$.correct,maskBase64:L.length?_a(L):null,checkMode:va,compareMode:qa,minCorrectness:ha},C=new TextEncoder().encode(JSON.stringify(J)),z=je.cardType==="info"?"info":"connection",E=$.overrideCheckType??je.checkType??null,H=$.overrideDirection??je.direction??null;Dt({itemType:z,itemId:je.cardId,checkType:E,direction:H,revisionType:He.id,evalType:$.evalType,correct:$.correct,maskBase64:L.length?_a(L):null,payloadBase64:_a(C)}).then(()=>{za(z,je.cardId,E,H),ft(p)}).catch(()=>{})},ct=($,Z)=>{const c=Oa.current.get(Z);if(c)return Promise.resolve(c);const f=et.current.get(Z);if(f)return f;const S=qi({shareCode:l,infoId:$,key:ba}).then(L=>{var ue,ge;const J=L.payload,C=((ue=J.definition)==null?void 0:ue.graph)??null,z="",E=((ge=J.definition)==null?void 0:ge.answerTemplate)??"",H=jr(C,z,E);if(H){const fe={sample:Yr(H),answerTemplate:E||null};return Oa.current.set(Z,fe),fe}return Sr({shareId:l,infoId:$,key:ba}).then(xe=>{const fe={sample:xe,answerTemplate:null};return Oa.current.set(Z,fe),fe})}).catch(()=>Sr({shareId:l,infoId:$,key:ba}).then(L=>{const J={sample:L,answerTemplate:null};return Oa.current.set(Z,J),J}).catch(()=>({sample:null,answerTemplate:null}))).finally(()=>{et.current.delete(Z)});return et.current.set(Z,S),S},Ca=($,Z)=>{var C;const c=`${me($)}:${Z}`,f=at.current.get(c);if(f)return Promise.resolve(f);const S=pt.current.get(c);if(S)return S;const L=z=>(at.current.set(c,z),z);let J;if($.cardType==="vocab"){if($.checkType==="translation-match")return J=Promise.resolve(L({prompt:$.description||a.cogita.library.revision.matchLabel,expectedAnswer:null,computedExpected:[],computedAnswers:{},computedValues:null,answerTemplate:null,outputVariables:null,variableValues:null})),J;const z=$.label.split("↔").map(E=>E.trim()).filter(Boolean);if(z.length>=2){const H=($.direction??(Math.random()>=.5?"a-to-b":"b-to-a"))!=="b-to-a",ue=H?z[0]:z[1],ge=H?z[1]:z[0];J=Promise.resolve(L({prompt:ue,expectedAnswer:ge,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else J=Promise.resolve(L({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else if($.cardType==="info"&&$.infoType==="word"){const z=(C=$.description)!=null&&C.startsWith("Language: ")?$.description.replace("Language: ",""):null;J=Promise.resolve(L({prompt:$.label,expectedAnswer:z,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}))}else $.cardType==="info"&&$.infoType==="computed"?J=ct($.cardId,c).then(z=>{var xe,fe;if(!z.sample)return L({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null});const E=z.sample,H=E.expectedAnswers?Object.entries(E.expectedAnswers).map(([Pe,Re])=>({key:Pe,expected:Re})):[],ue=H.reduce((Pe,Re)=>(Pe[Re.key]="",Pe),{}),ge=E.expectedAnswerIsSentence&&((xe=E.expectedAnswer)==null?void 0:xe.trim())||null;return L({prompt:E.prompt,expectedAnswer:H.length>0?ge:((fe=E.expectedAnswer)==null?void 0:fe.trim())||null,computedExpected:H,computedAnswers:ue,answerTemplate:z.answerTemplate,outputVariables:E.outputVariables??null,variableValues:E.variableValues??null})}).catch(()=>L({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null})).finally(()=>{pt.current.delete(c)}):J=Promise.resolve(L({prompt:$.label,expectedAnswer:null,computedExpected:[],computedAnswers:{},answerTemplate:null,outputVariables:null,variableValues:null}));return pt.current.set(c,J),J},Ja=($,Z,c)=>{const f=Object.keys($.nodes).length,S=ua.current.size;if(!Z){ie({title:c,before:$.text,after:"",fragmentId:null,total:f,completed:S}),M(null),we(!0);return}const L=$.nodes[Z];if(!L)return;const J=Qr($.text,L);ie({title:c,before:J.before,after:J.after,fragmentId:L.id,total:f,completed:S}),M(J.fragment),we(!1)},xt=()=>{const $=ze.current;$&&ie(Z=>Z&&{...Z,total:Object.keys($.nodes).length,completed:ua.current.size})},Ea=()=>{const $=p[D+1];$&&Ca($,D+1)},Ct=()=>{if(Ea(),je&&je.cardType==="vocab"&&je.checkType==="translation-match"&&_){if(_.pairs.length===0){he("incorrect"),we(!0);return}const L=_.pairs.reduce((ge,xe)=>(ge[xe.rightId]=xe.rightLabel,ge),{});let J=0;const C={};_.pairs.forEach(ge=>{const fe=_.selection[ge.leftId]===ge.rightId;C[ge.leftId]=fe?"correct":"incorrect",fe&&(J+=1)});const z=_.pairs.length||1,E=J/z,H=J===_.pairs.length;Ce(ge=>({...ge,...C})),H?(he("correct"),we(!0),Qe(0)):(he("incorrect"),we(!1),Qe(ge=>{const xe=ge+1;return xe>=ja&&(t(!0),we(!0),te(fe=>{if(!fe)return fe;const Pe=fe.pairs.reduce((Re,We)=>(Re[We.leftId]=We.rightId,Re),{});return{...fe,selection:Pe}})),xe})),ma(H,E);const ue="connection";Promise.all(_.pairs.map(ge=>{const xe=_.selection[ge.leftId]??null,fe=xe?L[xe]:"",Pe={left:ge.leftLabel,expected:ge.rightLabel,answer:fe,checkType:"translation-match"},Re=new TextEncoder().encode(JSON.stringify(Pe));return Dt({itemType:ue,itemId:ge.cardId,checkType:"translation-match",direction:null,revisionType:He.id,evalType:"translation-match",correct:xe===ge.rightId,maskBase64:null,payloadBase64:_a(Re)})})).then(()=>{za(ue,je.cardId,je.checkType,je.direction),ft(p)}).catch(()=>{});return}if(ae.length>0){const L=ae.reduce((C,z)=>{const E=Ee[z.key]??"";return C[z.key]=fa(E)===fa(z.expected)?"correct":"incorrect",C},{});ae.every(({key:C,expected:z})=>{const E=Ee[C]??"";return va==="exact"&&fa(E)===fa(z)})?(he("correct"),Se(L),we(!0),Qe(0),ma(!0,1),Ra({correct:!0,direction:o?`${o} -> computed`:"computed",expectedMap:ae.reduce((C,z)=>(C[z.key]=z.expected,C),{}),answerMap:Ee,evalType:"computed"})):(he("incorrect"),Se(L),we(!1),Qe(C=>{const z=C+1;return z>=ja&&Ya&&(t(!0),we(!0)),z}),ma(!1,0),window.setTimeout(()=>{var z;const C=_t(Je,ae,Fe);C&&P.current[C]&&((z=P.current[C])==null||z.focus())},40),Ra({correct:!1,direction:o?`${o} -> computed`:"computed",expectedMap:ae.reduce((C,z)=>(C[z.key]=z.expected,C),{}),answerMap:Ee,evalType:"computed"}));return}if(je&&je.cardType==="info"&&je.infoType==="quote"&&(ye!=null&&ye.fragmentId)){if(!w)return;const L=ka(je.direction),J=(L==null?void 0:L.mode)??getQuoteMode(je.direction),C=L!=null&&L.fragmentId&&je.direction?je.direction:wt(J,ye.fragmentId),z=ii(w,ke,qa),E=va==="exact"&&mt(ke)===mt(w),H=it(z),ue=E||H,ge=Va(z);ue?(aa.current[ye.fragmentId]=Math.max(aa.current[ye.fragmentId]??0,ge),(aa.current[ye.fragmentId]??0)>=Sa&&ua.current.add(ye.fragmentId),xt(),he("correct"),Se({}),we(!0),ve(z),Qe(0),ge<100&&ja<=1&&t(!0),ma(!0,ge/100),Ra({correct:!0,direction:`quote:${ye.fragmentId}`,expected:w,answer:ke,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:C})):(he("incorrect"),Se({}),we(!1),ve(z),Qe(xe=>{const fe=xe+1;return fe>=ja&&Ya&&(t(!0),we(!0)),fe}),ma(!1,ge/100),window.setTimeout(()=>{var xe;return(xe=Ze.current)==null?void 0:xe.focus()},40),Ra({correct:!1,direction:`quote:${ye.fragmentId}`,expected:w,answer:ke,evalType:"quote-fragment",overrideCheckType:"quote-fragment",overrideDirection:C}));return}if(!w)return;const $=ht(w,ke,qa),Z=va==="exact"&&fa(ke)===fa(w),c=it($),f=Z||c,S=Va($);f?(he("correct"),Se({}),we(!0),ve($),Qe(0),S<100&&ja<=1&&t(!0),ma(!0,S/100),Ra({correct:!0,direction:o?`${o} -> ${w}`:null,expected:w,answer:ke,evalType:"text"})):(he("incorrect"),Se({}),we(!1),ve($),Qe(L=>{const J=L+1;return J>=ja&&Ya&&(t(!0),we(!0)),J}),ma(!1,S/100),window.setTimeout(()=>{var L;return(L=Ze.current)==null?void 0:L.focus()},40),Ra({correct:!1,direction:o?`${o} -> ${w}`:null,expected:w,answer:ke,evalType:"text"}))},dt=$=>{if(Ea(),!w)return;const Z=ht(w,$,qa),c=fa($)===fa(w),f=it(Z),S=c||f,L=Va(Z);S?(he("correct"),Se({}),we(!0),ve(Z),Qe(0),L<100&&ja<=1&&t(!0),ma(!0,L/100),Ra({correct:!0,direction:"word->language",expected:w,answer:$,evalType:"language-select"})):(he("incorrect"),Se({}),we(!1),ve(Z),Qe(J=>{const C=J+1;return C>=ja&&Ya&&(t(!0),we(!0)),C}),ma(!1,L/100),Ra({correct:!1,direction:"word->language",expected:w,answer:$,evalType:"language-select"}))},Mt=$=>{var c;if($.key!=="Enter")return;if($.preventDefault(),$.stopPropagation(),Le){st();return}const Z=ae.find(f=>!(Ee[f.key]??"").trim());if(Z){(c=P.current[Z.key])==null||c.focus();return}Ct()},ar=()=>{Ea(),he("correct"),we(!0),Qe(0),ma(!0,1),w&&Ra({correct:!0,direction:"manual",expected:w,answer:ke,evalType:"manual"})},tr=()=>{if(ma(!1,0),je&&je.cardType==="info"&&je.infoType==="quote"){he(null),ce(""),t(!1),Se({}),we(!1),ve(null),Qe(0),pe($=>Math.min($+1,p.length));return}st()};i.useEffect(()=>{Ea()},[D,p]);const rr=a.cogita.library.revision.revealModeAfterIncorrect,Ya=ae.length>0||!!w;return e.jsxs(Ma,{copy:a,authLabel:n,showProfileMenu:s,onProfileNavigate:g,onToggleSecureMode:h,onLogout:v,secureMode:x,onNavigate:A,language:O,onLanguageChange:q,children:[(j==="loading"||Q==="loading")&&e.jsx("div",{className:"cogita-revision-loading",children:e.jsxs("div",{className:"cogita-revision-loading-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:j==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.loading}),e.jsx("div",{className:"cogita-revision-loading-bar",children:e.jsx("span",{style:{width:`${oe.total?Math.min(100,Math.max(0,oe.current/oe.total*100)):0}%`}})}),e.jsx("p",{className:"cogita-revision-loading-meta",children:oe.total?`${Math.min(oe.current,oe.total)} / ${oe.total}`:a.cogita.library.revision.loading})]})}),e.jsxs("section",{className:"cogita-library-dashboard cogita-revision-run","data-mode":"detail",children:[e.jsxs("header",{className:"cogita-library-dashboard-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.shareRunKicker}),e.jsx("h1",{className:"cogita-library-title",children:G}),e.jsx("p",{className:"cogita-library-subtitle",children:d}),e.jsx("p",{className:"cogita-library-subtitle",children:a.cogita.library.revision.modeSummary.replace("{mode}",$a).replace("{check}",Ka)})]}),e.jsx("div",{className:"cogita-library-actions",children:e.jsx("a",{className:"cta ghost",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}),e.jsx("div",{className:"cogita-library-layout",children:e.jsx("div",{className:"cogita-library-content",children:e.jsxs("div",{className:"cogita-library-grid",children:[e.jsx("div",{className:"cogita-library-pane cogita-revision-stats",children:e.jsxs("section",{className:"cogita-library-detail",children:[e.jsx("div",{className:"cogita-detail-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.knownessTitle}),e.jsx("h3",{className:"cogita-detail-title",children:r?`${r.score.toFixed(1)} / 100`:a.cogita.library.revision.knownessEmpty})]})}),e.jsxs("div",{className:"cogita-detail-body",children:[La?e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.levelsCurrentLabel})," ",La.currentLevel??"-"," / ",La.levelsCount]}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:a.cogita.library.revision.knownessStats.replace("{correct}",String(r.correct)).replace("{total}",String(r.total))}),r.lastReviewedUtc&&e.jsx("p",{children:a.cogita.library.revision.knownessLast.replace("{date}",new Date(r.lastReviewedUtc).toLocaleString())})]}):e.jsx("p",{children:a.cogita.library.revision.knownessHint}),e.jsx(ai,{outcomes:T})]})]})}),e.jsxs("div",{className:"cogita-library-panel",children:[re?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:re})}):null,e.jsx("section",{className:"cogita-revision-card","data-feedback":$e?`${$e.kind}-${$e.tick}`:Za?"idle":V??"idle",children:j!=="ready"?e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:j==="loading"?a.cogita.library.revision.shareLoading:a.cogita.library.revision.shareInvalid}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]}):je?e.jsx(e.Fragment,{children:sa?e.jsx("div",{className:"cogita-revision-body",children:e.jsx("p",{className:"cogita-revision-hint",children:a.cogita.library.revision.dependenciesBlocked})}):e.jsx(ei,{copy:a,currentCard:je,currentTypeLabel:Gt,prompt:o,languages:F,answer:ke,onAnswerChange:$=>ce(Z=>Vt(Z,$,y)),computedExpected:ae,computedAnswers:Ee,onComputedAnswerChange:($,Z)=>Me(c=>({...c,[$]:Vt(c[$]??"",Z,y)})),answerTemplate:Je,outputVariables:Fe,variableValues:ra,computedFieldFeedback:Ae,feedback:V,canAdvance:Le,quoteContext:ye,quotePlaceholder:a.cogita.library.revision.quoteMissingPlaceholder,onCheckAnswer:Ct,onSkip:tr,onLanguageSelect:dt,onMarkReviewed:ar,onAdvance:st,showCorrectAnswer:Y,setShowCorrectAnswer:t,onRevealCorrect:()=>we(!0),answerMask:se,expectedAnswer:w,hasExpectedAnswer:Ya,handleComputedKeyDown:Mt,answerInputRef:Ze,computedInputRefs:P,scriptMode:y,setScriptMode:N,matchPairs:_==null?void 0:_.pairs,matchLeftOrder:_==null?void 0:_.leftOrder,matchRightOrder:_==null?void 0:_.rightOrder,matchSelection:_==null?void 0:_.selection,matchActiveLeft:_==null?void 0:_.activeLeft,matchActiveRight:_==null?void 0:_.activeRight,matchFeedback:Be,onMatchLeftSelect:Nt,onMatchRightSelect:Lt})}):e.jsxs("div",{className:"cogita-card-empty",children:[e.jsx("p",{children:a.cogita.library.revision.completed}),e.jsx("div",{className:"cogita-form-actions",children:e.jsx("a",{className:"cta",href:"/#/cogita",children:a.cogita.library.actions.backToCogita})})]})}),e.jsxs("section",{className:"cogita-revision-insights",children:[e.jsxs("div",{className:"cogita-revision-insight-grid",children:[e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.progressTitle}),e.jsx("h3",{className:"cogita-detail-title",children:rt?`${Ia} / ${rt}`:a.cogita.library.revision.progressUnlimited}),j==="error"&&e.jsx("p",{children:a.cogita.library.revision.shareInvalid}),j==="loading"&&e.jsx("p",{children:a.cogita.library.revision.shareLoading}),j==="ready"&&Q==="loading"&&e.jsx("p",{children:a.cogita.library.revision.loading}),j==="ready"&&Q==="error"&&e.jsx("p",{children:a.cogita.library.revision.error}),j==="ready"&&Q==="ready"&&p.length===0&&e.jsx("p",{children:a.cogita.library.revision.empty})]}),e.jsxs("div",{className:"cogita-revision-insight-card",children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.revealModeLabel}),e.jsx("h3",{className:"cogita-detail-title",children:rr}),e.jsxs("p",{children:[e.jsx("strong",{children:a.cogita.library.revision.triesLabel})," ",ja]})]})]}),La?e.jsxs("div",{className:"cogita-revision-levels",children:[e.jsx("div",{className:"cogita-revision-levels-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"cogita-user-kicker",children:a.cogita.library.revision.levelsCountsLabel}),e.jsxs("h3",{className:"cogita-detail-title",children:[a.cogita.library.revision.levelsStackLabel," ",La.activeCount," / ",La.poolCount]})]})}),e.jsx("div",{className:"cogita-revision-level-grid",children:La.counts.map(($,Z)=>{const c=Z+1,f=La.currentLevel===c,S=La.percentages[Z]??0;return e.jsxs("div",{className:"cogita-revision-level-column","data-active":f,children:[e.jsxs("div",{className:"cogita-revision-level-head",children:[e.jsx("span",{children:c}),e.jsx("strong",{children:$})]}),e.jsx("div",{className:"cogita-revision-level-bar",children:e.jsx("span",{style:{width:`${Math.min(100,Math.max(0,S))}%`}})}),e.jsxs("div",{className:"cogita-revision-level-meta",children:[S.toFixed(1),"%"]})]},`level-${c}`)})})]}):null,lt?e.jsxs("div",{className:"cogita-revision-temporal",children:[e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalUnknownLabel}),e.jsx("strong",{children:lt.unknownCount})]}),e.jsx("div",{className:"cogita-revision-temporal-dots",children:lt.dots.map($=>e.jsx("span",{style:{background:`rgba(${Math.round(255*(1-$.value))}, ${Math.round(200*$.value)}, 80, 0.9)`}},$.id))}),e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:a.cogita.library.revision.temporalKnownLabel}),e.jsx("strong",{children:lt.knownCount})]})]}):null,la?e.jsx("div",{className:"cogita-revision-temporal",children:e.jsxs("div",{className:"cogita-revision-temporal-count",children:[e.jsx("span",{children:"Blocked cards"}),e.jsx("strong",{children:Pa})]})}):null]})]})]})})})]})]})}const Gn=Object.freeze(Object.defineProperty({__proto__:null,CogitaRevisionShareRunPage:Wn},Symbol.toStringTag,{value:"Module"}));export{Yn as C,Qn as a,Gn as b};
